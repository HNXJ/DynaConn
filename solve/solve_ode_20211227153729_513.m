function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.662388784501522e-02   +1.034252351059098e-01   +7.416254445160574e-02   +1.370463326994608e-02   +1.203410383884266e-01   +3.829991733259239e-02   +5.401355601168359e-02   +8.355487873088360e-02   +7.507107851796035e-04   +1.254692225384382e-01   +2.619969674324818e-01   +1.951790771044838e-01   +5.470845758155818e-02   +8.525337877820255e-02   +1.868657715624000e-01   +3.905490009483700e-03; +4.634398059247375e-02   -6.998546380278661e-03   +6.969923817271741e-02   +1.808986365143537e-01   +9.406288481740875e-02   +1.886027813703302e-01   +6.216455717756576e-02   +2.623378599657016e-02   +7.277885518084198e-02   +7.967317266022171e-02   +9.630121486147013e-02   -4.201130974545391e-03   +2.048499870214383e-01   +9.877700307389603e-02   +1.660501604660705e-01   +1.146765499938827e-01; +1.617312359427055e-01   +1.098089407526946e-01   +8.416461134000866e-02   +7.190944255073486e-02   +4.534268598228967e-02   -1.586069516940625e-04   +1.215049845944766e-01   +5.210864005742723e-02   +5.677571648312634e-02   +1.857261413336967e-01   -2.958719860986481e-02   +1.062601520212129e-01   +2.195324275550222e-02   +1.017671854800304e-01   +3.307363662182941e-02   +1.138068661772210e-01; +1.287918921066933e-01   +1.441099241864319e-01   +1.460402343177809e-01   +1.592612452049937e-01   +1.269932200091025e-01   +4.101358545400452e-02   +9.779990414567724e-02   +1.469660322727705e-01   +6.287134424618820e-02   +1.089624275950982e-01   -1.038047359760346e-02   -1.344863882351657e-02   +1.437652738829698e-01   -3.418127644991378e-02   +1.469789643675908e-01   +4.980886238945958e-02; +8.491083600857205e-02   +1.511099189943395e-01   +1.940366727894259e-01   +6.886341756429595e-02   -1.957854468044726e-02   +2.008213699423658e-02   +1.975235676916339e-01   +1.004622498055287e-01   +5.829522755030745e-02   -1.076752005829777e-02   +3.008235744470270e-02   +5.285566804214120e-02   +8.689989448263952e-02   +5.055201182168460e-02   +1.665296341105477e-01   +1.856937908660793e-01; +1.144489646952280e-01   +9.475779722812416e-02   +1.033285059096646e-02   +2.115981817876393e-01   +3.661866714827883e-02   +9.874790602902143e-03   +1.023744033065772e-01   +4.624658139982445e-02   +1.386169055670293e-01   +4.091511091281223e-02   +1.682659687423798e-01   +2.118437426411512e-01   +1.934217923281660e-02   +1.044416427527647e-01   +1.108766246489864e-01   +6.091781879188229e-02; +8.672046142592808e-03   +8.734396157860694e-02   +4.570492008262516e-02   +1.557755609968867e-01   +6.965628917867261e-02   +5.333369789328713e-03   +1.227406849857933e-01   +2.021332385038577e-02   +1.732687024316885e-01   +9.608985973953615e-02   +3.976938957471460e-02   +1.103489789481169e-01   +3.174946089206240e-02   +1.167152044871014e-01   +1.086806103596865e-01   +8.487283413351511e-02; +1.193324795960738e-01   +5.771094590446366e-02   +4.285395020153559e-02   -7.347024297277197e-03   +5.557867717413456e-02   +2.053337000433642e-01   +7.625412814151995e-02   +7.575966971217446e-02   -1.926921683316628e-02   +7.678995790561799e-02   +1.234919441336906e-01   +5.677110695896444e-02   +5.914511706601148e-02   +1.137589288872877e-01   -9.469326259599103e-03   +4.089812876188688e-02; +1.685234350259263e-01   +1.136383321274193e-02   +8.138738977958894e-02   +1.227234601764845e-01   +1.015669673334274e-01   +3.573562568856624e-02   +5.495483747008104e-02   +4.826086428083258e-02   +1.081069428456349e-01   +1.372517737893760e-02   +1.777678465884958e-01   -1.046898298092517e-02   +8.622057114530476e-02   +4.509879693354702e-02   +9.778852155330148e-02   +6.540698390252059e-02; +1.123790232719693e-01   +1.178530600228383e-01   +1.196236217335330e-01   +1.180370176889326e-01   +1.891830943240901e-01   +1.829020596554323e-01   +7.537376843947118e-02   +9.626694135729429e-03   +3.651199851908817e-02   +1.793831136017222e-01   +1.081167040461682e-01   +1.171075337694568e-01   +1.966879271148468e-01   +1.198025719741755e-01   +1.349605026321775e-01   -5.340645358387075e-04; +5.395761687719473e-02   +2.389932967152979e-03   +1.359334174582727e-01   +4.001080930911398e-02   +5.223190655258868e-02   +2.670971228621357e-01   +7.440726091668158e-02   +4.467656629121641e-02   +3.160605188865828e-02   +3.175841261207830e-02   -2.888471268307645e-02   +1.012716753998276e-01   +3.164444880402331e-02   +7.916380464239206e-02   +1.186073765753679e-01   +1.097809342363999e-01; +6.362106781477288e-02   +3.976051768634496e-02   +2.526942046593072e-02   +1.444878292744223e-01   +1.214527638150445e-01   -4.562623970727728e-02   +1.716733524513770e-01   +1.572955097614623e-01   +1.235148392215662e-01   +1.007331256575686e-01   +1.372839363763282e-01   +1.687416570039841e-01   +7.803966892912333e-02   +1.190847844367377e-01   +1.299346366441408e-01   +1.439543491163873e-01; +2.323875589795826e-01   +1.196051924709465e-01   +7.050173503103230e-02   +1.273359615341479e-02   +7.453287847847456e-02   +6.610559731493570e-02   +1.096938292017036e-01   +2.528077187826171e-02   +1.151399006206837e-01   +1.674000754087329e-01   +1.528755054708733e-01   +2.372408999257906e-02   +7.849850853559910e-02   +8.167717681655763e-02   +1.631288787564974e-01   +7.035447541174993e-02; +1.384224886043292e-01   +6.907428500696455e-02   +4.855671259666895e-02   +1.589057765637774e-01   +1.758420475653020e-01   +7.175986613962528e-02   +9.494067652416310e-02   +3.919915670364620e-02   +1.240184407805473e-01   +1.228527644807037e-01   +1.551940532616979e-01   +1.849183163917195e-01   +1.677383024782632e-01   +1.846148047313304e-01   +1.724337203138344e-01   +7.222277780555632e-02; +1.228651299044298e-01   +2.864342385102254e-02   +1.483324328718298e-01   +1.777672315883583e-01   +1.372664069316856e-01   -9.738192119615862e-04   +1.111742782768349e-01   +8.929691013299268e-02   +1.135045438398244e-01   +1.318230275757642e-01   +9.079303572398342e-02   -2.711796252169696e-02   +1.437051613099163e-01   +3.650472299423588e-02   +6.370818107664628e-02   +1.706337130571058e-01; +2.163627983574771e-01   +1.434616997733382e-01   +1.272691863710198e-01   +1.178718644152839e-02   +1.448458414611848e-01   +1.473786548975665e-01   +9.205738868762491e-02   +1.000200509963822e-01   +1.017015396967144e-01   +6.586869461474316e-02   +5.337897900070435e-02   +3.846908560882648e-02   +7.717266963512953e-02   +4.622241691960725e-02   +1.333814124867314e-01   +1.678385454637289e-01];
L1E_L1I_iGABA_netcon = [+1.852606883960326e-02   +2.237916374213628e-01   +1.948703807433588e-01   +1.700703496226928e-01   +1.140129499586620e-01   +1.315569008891071e-01   +1.599326284973624e-01   +6.449373260036914e-02   +1.507330869323514e-01   +9.758572225723846e-03   +1.354870926671817e-01   +3.429967887876165e-02   +5.519091787090565e-02   +1.310906890783344e-01   +1.012796778141631e-01   +1.904735373551587e-01; +1.637562372252241e-01   +6.446989169502787e-02   +8.799976456416822e-02   +6.283167391215627e-02   -3.673044020912943e-02   +1.181601431295590e-01   +7.538405560414360e-02   +1.090929193817673e-01   -3.468246159596644e-02   -2.793579161968184e-02   +1.727511507570827e-01   +6.431674335547030e-02   +9.621951309914002e-02   +1.025777888645109e-01   +1.268428036005526e-02   +1.022685577461038e-01; +7.067631061843485e-03   +1.604501288175262e-01   +4.339112495797096e-02   +3.102668961080546e-02   -8.315127742393741e-03   +3.548065099236056e-02   +9.049567255916773e-02   +1.242006141705131e-01   +5.757389612958121e-02   +9.287837520003138e-03   +1.034336254280155e-01   +1.218044458969639e-01   +5.272361249800992e-02   -9.427458972124313e-03   +9.740451178801149e-02   +1.244406079350720e-01; +7.626744795076265e-02   +8.164200808462184e-02   +1.439093797022497e-01   +9.634094882729252e-02   +7.933600431942107e-02   +2.162013754284997e-01   +1.174587789938666e-01   -1.332649847887687e-02   +1.001919652376554e-01   +1.727945431749460e-01   +1.517340840104108e-01   +1.531269072107679e-01   +7.907572564432486e-02   +1.538993442342224e-01   +2.719090064895714e-02   +8.665813888797372e-02; +8.342877608409226e-02   +1.927291156642324e-01   +2.073351905760033e-01   +1.640410218707340e-01   +3.950622411280192e-02   +7.312420174148412e-02   +1.285187073697278e-01   +1.182621004004127e-01   +2.034445248663371e-01   +8.835558013627853e-02   +1.716857330200979e-01   +1.064326196005703e-01   +3.533142438257481e-02   -3.668573111131409e-02   +4.977671117317452e-02   +1.842584521687452e-01; +1.759811605598171e-01   +1.069644127551500e-01   +6.760523206404033e-02   +1.229563841167715e-01   +7.576720486742233e-02   -7.994914041213269e-03   +3.341198074849294e-02   +7.238850934324038e-02   +1.955058976533841e-01   +1.037766764089167e-01   +1.246426055578608e-01   -5.110277982503832e-02   +1.120781599682503e-01   -1.535756869001885e-02   +7.387467841486414e-02   +4.703670865157170e-02; +7.844037438045437e-03   +1.406698401686402e-01   +2.008487656373450e-01   +2.496975446723807e-02   +5.391947469662906e-02   +3.472548530525741e-03   +1.834902758069230e-01   +1.322457946509084e-01   -1.719035484139845e-02   +1.571481041019703e-01   -8.434288641413844e-03   +1.351633459430424e-01   +1.041226283177950e-01   +9.270018976021611e-02   +3.095602411542527e-02   +2.996420924799723e-02; -2.434991480764100e-03   +8.415880027766626e-02   +6.243096256279747e-02   +7.816882968083874e-02   +1.230601443847265e-01   +2.971068876980319e-02   +7.370959801746220e-02   +1.184536461003347e-02   +1.141893194057546e-01   +1.246627035326555e-01   +3.269231539682897e-03   +6.724404674936101e-02   +1.468649344229863e-02   +7.364641063276678e-02   +3.259712993659299e-02   +2.329222613363415e-01; +9.631860121435129e-02   +1.978410101561254e-01   +1.245251184342365e-01   +8.278969950076562e-02   +1.593727918461812e-02   +4.071262017542740e-02   +2.985624612410959e-02   -1.256267558240373e-02   +1.450423798529377e-01   -3.898207818508252e-02   -1.990607951035594e-03   +1.506587702491435e-01   +1.220050785306983e-01   +1.545669903375528e-01   +1.674401780780413e-01   +1.340348789569895e-01; +8.344566695749800e-02   +1.781246752316284e-01   -1.032918818352646e-02   +2.833848900312328e-02   +4.240358614266695e-02   +7.771387066640091e-02   +1.401361706278869e-01   +4.656042485738882e-02   +1.596902809032031e-01   +3.720517491902065e-02   +9.266744802099215e-02   +5.246237374664562e-02   +1.387184641864272e-01   +2.054641826922109e-01   +1.553858702762097e-01   +1.349680584581845e-01; +8.901973957614193e-02   +8.092457019913518e-02   +6.594880449803747e-02   +6.237484260780650e-02   +1.743623098932371e-01   +2.200802260693147e-01   +1.300339369102371e-01   +1.081529535950123e-01   +6.321492144460517e-02   +4.272907022170087e-02   +4.287850799057791e-02   +1.719211281533020e-01   +3.633182481423784e-02   +5.937223932394850e-02   +5.947896883114133e-02   +8.849887583176069e-02; +1.767617336636814e-01   +5.091563073609086e-02   +3.277000740075100e-02   +1.099958102007314e-01   +1.467015176733168e-01   +1.920725094478881e-02   +1.433985799431473e-01   +1.065496385870755e-01   -5.949289299453982e-03   +4.776378618632135e-02   +1.217844096521899e-01   +2.711999872265973e-02   -6.181043471177082e-03   +1.351813348099329e-01   +1.712336477827918e-01   +1.298159231384770e-01; +2.294869286542051e-02   +5.417262093117371e-02   +1.444113702096885e-01   +9.786058301315051e-02   +1.140048279178012e-01   +4.525288134160522e-02   +9.554164361810452e-02   +1.435337348510635e-01   +1.108295034184046e-01   +1.527125221586978e-01   +6.708983859277488e-02   +1.078316596082370e-01   +2.546448376068013e-02   +1.129681649608235e-01   +7.759418103371893e-02   +5.762192359188580e-02; +1.504147541032619e-03   +7.211563266869543e-02   +5.720147096717436e-02   +1.079931397577425e-01   +1.361396977546927e-01   +6.399148081937513e-02   +1.371529198194408e-01   +4.846367748265343e-02   +1.017409185538432e-01   +7.859565620871840e-02   +7.559076142897941e-02   +5.957882955406885e-02   +1.511898033189983e-01   +1.603475494507674e-01   +4.387308618126567e-02   +6.658717408306918e-03; +8.522672206967931e-02   +2.900221467686950e-02   +8.304558170940080e-03   +1.392279187573542e-01   +5.166558854007006e-02   +6.837894842292828e-02   +6.532419863831583e-02   +6.869105961868488e-02   +8.710682522013509e-02   +1.140418794264409e-01   +7.468245576033648e-02   +9.394304464792060e-02   +1.285763250035069e-02   +6.901317230168469e-02   +8.489821822744312e-02   +1.558792906821229e-01; +8.073223724839858e-02   +6.687917893553151e-02   +5.002773865204005e-02   +2.135112132090938e-02   +1.014347482676233e-01   +2.026251035182481e-01   -5.584570240903897e-02   +1.441011503519053e-01   +1.306758229534571e-01   +1.691269920421904e-01   +1.518455680157441e-01   +8.412862864198764e-02   +9.191681040198951e-02   +2.187425709499892e-01   +3.113599260960049e-02   +6.892050727419685e-02];
L2I_L1I_iGABA_netcon = [+1.031508993901701e-01   +1.416176309596034e-01   +5.194789387227440e-02   +8.996585419272018e-02   +8.753911266867084e-02   +9.250448710877167e-02   +7.170462513307974e-02   +1.107433424129219e-01; +5.255869223094291e-02   +1.591205388709888e-01   +5.748427445859934e-02   +1.175630332807636e-01   +7.541198815205340e-02   +1.155936120100924e-01   +1.538007781551168e-01   +7.730035923900010e-02; +5.585273272679956e-02   +7.749845748596734e-02   +1.761899245671296e-01   +2.300931024091134e-02   +1.179845597045438e-01   +6.077799672193705e-03   +1.484416398060650e-01   +1.268955935357805e-01; +7.545366095556133e-02   +1.360937335490261e-01   +7.596488919954794e-02   +1.204528548039425e-01   +7.082362492493474e-02   +1.439935434724515e-01   +6.330206219325130e-02   +1.376482128975714e-01; +1.838349685678200e-01   +8.188909562666141e-02   +1.218941777337153e-01   +4.334472204628198e-02   +1.642713680022335e-01   +1.541142550105792e-01   +8.032807646113584e-02   +1.363977752553680e-01; +6.780071060794163e-02   +1.286269011385264e-01   +1.689734790943001e-01   +6.283448058538074e-02   +9.362813633077303e-02   +9.354170047477385e-02   +7.964431502909539e-02   +1.006023337507332e-01; +1.461078736975177e-01   +4.862626347338440e-02   +1.555193948472471e-03   +1.383566253135122e-01   +3.856616610345372e-02   +3.323632976807475e-02   +1.109532857827528e-01   +8.724138447406377e-02; +5.517571831276209e-02   +9.388683918181774e-02   +3.936987351272785e-02   +2.469611054504470e-01   +4.571330857657512e-02   +1.511661999326800e-01   +4.765622643950349e-02   +2.572204939986762e-02; +1.042855869707206e-01   +8.914123280185743e-02   +3.604297457250868e-03   +1.516349613336378e-01   +1.093477039309645e-01   +2.081415675970122e-01   +2.289292027327030e-01   -2.704402602495583e-03; +6.209179993548174e-02   +1.807627734236095e-01   +6.966003058630811e-02   +1.925325067349504e-01   +1.443497392432297e-01   +1.053945888582300e-02   -7.669475938881670e-03   -3.794871794986587e-02; +1.433771173740932e-01   +6.680678266186763e-02   +2.032687936786942e-01   +8.279299885891318e-02   +8.908541007612585e-02   +2.832925859947925e-02   +1.921769236778190e-01   -4.027481352569838e-02; +5.487154923317780e-02   +1.318201739274092e-01   +6.620667599116344e-02   +1.005117426657010e-01   +2.048078992691830e-01   +1.221459089510717e-01   +6.674377735573016e-02   +1.837780294559659e-02; +9.527490113882298e-02   -1.039867818390677e-02   +3.495709479166295e-02   +1.656522746439579e-01   +3.412050460149451e-02   +1.248591583591753e-01   +1.393902690952755e-01   +4.894916613439759e-02; -6.075919396527465e-02   +1.323373566794313e-01   +2.513448032848928e-02   +1.550905754673677e-03   +1.249955410996714e-01   +1.189596690770217e-01   +1.389901308594148e-01   +1.300320239537094e-01; +2.756690010167365e-02   +1.913770313933458e-02   +8.931314641894295e-02   +1.149111991759369e-01   +6.094096239689839e-02   +1.115890095925493e-01   +1.631172414783878e-01   +1.052631289205508e-01; +1.809427329936250e-02   +1.200904456412378e-01   +3.147517777294378e-02   +1.572858740953544e-01   +4.265168042101481e-02   +8.732223246774860e-02   +5.496350189309522e-02   +4.570449105618062e-02];
L1I_L2I_iGABA_netcon = [+4.741767397472646e-02   +9.525319534014587e-02   +3.215865833357129e-02   +4.279757888797364e-02   +1.702915196473584e-01   +5.061793634309331e-02   +8.458901603385571e-02   +1.146355951725821e-01   +6.205675206473313e-02   +1.410372668538082e-02   +6.218204801703847e-02   +1.700678610342761e-01   +4.081476189620662e-02   +1.873731606804759e-01   +3.635109567556492e-02   +1.102268514719976e-01; +1.523657538220927e-01   +5.146859876558284e-02   +6.394150113037037e-02   +1.463898382059711e-01   +8.027038114491185e-02   +1.319566159324263e-01   +1.831063479977976e-01   +6.671913290982247e-02   +1.278877539832618e-01   +1.729846693082582e-01   +2.758216006155466e-02   -2.708078269149275e-03   +1.488288780592792e-01   +4.108342958820593e-02   +2.829441507263596e-02   +6.856710743799649e-02; +1.016281469063936e-01   +1.687996314227187e-01   +1.115773196342984e-01   -2.776017561776103e-02   +1.229318870279420e-01   +3.265509848689113e-02   +3.793108041526138e-02   +3.623643083008532e-02   +4.331822499843455e-02   +2.116167481815343e-01   +1.649021407961449e-01   +1.126984533578901e-01   +1.702434012013695e-01   +4.943813250830831e-02   +6.757102837563657e-02   +6.194512588724657e-02; +8.746319098936192e-02   +8.677679879203333e-02   +1.391794705779700e-01   -2.259449938617975e-02   +7.573571724983724e-02   +8.754871974543087e-02   +1.072294293348174e-01   +1.171116454514215e-01   +1.393300250691493e-01   +1.591773973852877e-01   +1.430361580919632e-01   +8.819606323102337e-02   +1.620292026376162e-01   +2.600888335647739e-02   +4.655140888935773e-02   +2.142364295449278e-01; +9.437297794571929e-02   +1.212336316020859e-01   +1.804855681916753e-01   +1.183808872144789e-01   +1.887334515981525e-01   +2.230388277086750e-01   +7.738567622049325e-02   +9.078993020777082e-02   +3.928105146863381e-02   +7.199274218199077e-02   +6.543171984751593e-02   +1.364310921797410e-01   +1.433226336150073e-01   +4.932153634674256e-02   +1.424596104202956e-01   +1.803980720002676e-01; +6.189162966370118e-02   +7.782815099856319e-02   +3.868665296082676e-02   +1.363277782177860e-01   +1.835608939517505e-01   +1.625387766815286e-02   -1.239130092328660e-02   +1.181035461930021e-01   +5.487877688845755e-02   +1.460079013501753e-01   +1.375775819425911e-01   +5.099515411584889e-02   +7.900955445456639e-02   +1.063258790403246e-01   +1.259402275313859e-01   +1.959683097410075e-01; +1.491469991035812e-01   +5.395621733462012e-02   +1.865231527951902e-01   +1.168274392732536e-01   -2.932915410269929e-02   +1.207843986720091e-01   +7.707905042200637e-02   +2.909564236106366e-02   +9.291923398243619e-03   +2.215301894268988e-01   +1.107231714352001e-01   +1.422456853958837e-01   +1.175324825363900e-01   +1.714031528724387e-02   +7.343971935397414e-02   +1.036733139663342e-01; +8.838160702529888e-02   +4.649343408216967e-02   +1.038608868919546e-01   +3.839146850965783e-02   +2.262186988327841e-02   +1.368020575975000e-01   +1.474182751736258e-01   -9.993796479834952e-03   +1.864187486854404e-01   +5.749666451242121e-02   +1.240414019394706e-01   +1.571672393345314e-01   +1.135263442674388e-01   +1.151004445559471e-01   +1.146157568832861e-01   +4.142702217432612e-02];
L2E_L1E_iAMPA_netcon = [+5.893090725076998e-02   +1.749450954424774e-01   +2.503991155559245e-01   +9.408264625012203e-02   -1.519119085134533e-02   +6.637565626313678e-02   +3.870892915273756e-02   +5.815069419983449e-02; +9.090455287608319e-02   +2.958455725754928e-02   +1.233994279802394e-01   +1.066741607544416e-01   +8.047608765851852e-02   -4.217436379450535e-02   +1.146683087610374e-01   -4.108036322255200e-02; +5.641294423577090e-02   +8.056567665795542e-02   +7.161734762574568e-02   +1.295328927048447e-01   +1.639887867084529e-01   +1.784255909985311e-01   +1.736525031243375e-01   -3.701544383536721e-02; +1.350427656453158e-01   +5.396576385669553e-02   +2.528718824428912e-02   +6.577890665591871e-03   +7.303505271767083e-02   +1.757663825656817e-01   +1.273822475505949e-01   -1.793056373609482e-02; +1.485501291365045e-01   +1.729463890193658e-01   +1.399184404157108e-01   +1.237474989257445e-01   +8.458981993952544e-02   +8.762170570769018e-02   +4.142121600747792e-02   +1.261488460731976e-02; +1.892908643719079e-01   +1.731687662080573e-01   +3.360664743692839e-03   +1.532512520995770e-01   -3.805076192710127e-02   +1.528112442690271e-01   +8.588486583984060e-02   +9.524735309344842e-02; +7.404735703008848e-04   +1.608033568770523e-01   +4.724298393438734e-02   +2.991082970700688e-02   +3.725124571464461e-02   +1.972486348662425e-01   +7.306306806824123e-02   +1.581039331910198e-01; +8.604881519596223e-02   +2.188408733108344e-01   +1.590218743979807e-01   +1.634704551722897e-01   +1.595579890023236e-01   +6.725674656235037e-02   +1.580975592597103e-01   +7.931529385169743e-02; +6.610293014635295e-02   +5.175038102245920e-02   +4.346586027246128e-02   +1.062174877645246e-01   +1.863458851947160e-01   +1.250925353287388e-01   +5.793540786589010e-02   +1.499199137318026e-01; +4.952057597954199e-03   +2.176572979913640e-01   +1.553579930980879e-01   +1.582145663903564e-01   +2.261014451831223e-01   +9.916267038551317e-02   +8.275713828782622e-02   +5.139471858721519e-02; +1.250107579025390e-01   +1.351771365538352e-01   -1.233450545845230e-02   +3.315461836560768e-02   +5.642749441415671e-02   +1.980162666029978e-01   +1.307859988435732e-01   -5.652286055338632e-02; +2.408367120264439e-01   +8.440536424642464e-02   +2.912608337129701e-02   +1.439784136838321e-01   +1.403640069847213e-01   +2.548735097333307e-01   +8.670501627186730e-02   +1.684171709466606e-01; +7.017900019939498e-02   +1.973073590590034e-01   +2.203991044185331e-01   +6.441423089196170e-02   +1.325660008393973e-01   -7.973839526690948e-02   +1.185282188123979e-01   +1.465840179204687e-01; +8.439405288808191e-02   +7.439133324907943e-02   +8.389108122609407e-02   +8.923693296468085e-02   +2.617883822648050e-02   +1.077850369729905e-01   +1.229136183916420e-01   +1.089142734453240e-01; +1.270482302499231e-01   +1.728272461141316e-01   +1.329721979119311e-02   +2.157458983161496e-02   +9.705230302959186e-02   +1.329010431553943e-01   +1.107156194013459e-01   +3.528918799747164e-02; +1.537020112828628e-01   +9.314427673785221e-02   +1.350832154376916e-01   +2.949351215200014e-02   +6.257885566019233e-02   +1.137599683416304e-02   +1.411715398722386e-01   +2.440961834444500e-02];
L1E_L2E_iAMPA_netcon = [+1.148558295033864e-01   +8.560046555002385e-02   +1.562578271157608e-01   +1.248641755408991e-01   +1.313187470024199e-01   +4.583181432376463e-02   +1.175690585510066e-01   +1.947487970486064e-01   +1.074039649007792e-01   +7.347689142170874e-02   +2.004798277166355e-01   -1.241773080944667e-02   +5.202922175924658e-02   +9.881480413435556e-02   +1.575241223582583e-01   +1.977089745635685e-01; +1.741515655856167e-01   +1.737425348015137e-01   +1.102190672415910e-01   +2.621094537270198e-02   +4.125931700933383e-02   +1.093060768078002e-01   +1.034408567463614e-01   +4.353489907487181e-02   -1.093097074299338e-02   -2.944403017902094e-02   +2.964038553854329e-02   +5.593924954217924e-02   +4.239861861769193e-02   -6.856860124035397e-02   +3.234370527443753e-02   +7.041080486760433e-02; +7.578769048739929e-02   +1.146268017738767e-01   +2.102076293844912e-01   +1.330960564017317e-01   +8.943202232606216e-03   +1.531494431159580e-01   +1.624109439539906e-02   +1.251093008035288e-01   +8.207844405865689e-02   +1.041285771756681e-01   +1.131164864750395e-02   +1.264896520120725e-01   +4.833539941271857e-04   +4.039535831117197e-02   +7.022770950798481e-02   +8.445551756826458e-02; +8.499989480959128e-02   +7.270661562564558e-02   +2.566495346464042e-02   +2.278743878728644e-01   +6.804498377602112e-03   +1.399846389326111e-02   +2.284070128812535e-02   +1.715119750621182e-01   +2.005670397784325e-01   +2.074186487800593e-01   +7.986284577463984e-02   -4.066862204122157e-02   +6.552354985609415e-02   +6.417203703568647e-02   +4.618219878265321e-02   +1.712590145915581e-01; +1.248905670121407e-01   +6.562514228625227e-02   +1.426992801932444e-02   +1.499091267823668e-02   +1.523455863068267e-01   +1.627969093469590e-01   +1.807931496796145e-01   +8.009306327701403e-02   +3.725994407092702e-02   +6.059484977704849e-02   +2.192344614170013e-01   +3.888110657064387e-02   +1.313217188337829e-01   +1.678142725513981e-01   +9.610616485966299e-02   +3.416240909733549e-02; +1.852164147699798e-02   +4.493117828133414e-02   +6.122450126631856e-02   -5.200030792557693e-02   +1.316755721976482e-01   +3.107384139223465e-02   +1.134878508949403e-01   +1.528161007960050e-01   +1.770118886291852e-01   +1.555540736351842e-01   +2.831237874919778e-02   +6.063847636243148e-02   +1.583900089285870e-01   +1.098378600036395e-01   +2.690393904220451e-02   +1.398835873130816e-01; +3.165126647959984e-02   +8.720109806000904e-02   +7.523259346994790e-02   +7.473505538942510e-02   +9.599315792938062e-02   -1.561781033187396e-02   +2.740104516292277e-02   +6.000003180094823e-02   +8.329774099069719e-02   +9.055862125141978e-02   +4.997061773753417e-02   +6.217660655337667e-02   +2.118276635756361e-01   +1.481651460978267e-01   +2.269077366373083e-01   +1.272813474830991e-01; +6.740019765869715e-02   +2.803602363460711e-02   +1.859323137504350e-01   +1.693154558934411e-01   +1.296381777638120e-01   +1.076165974949126e-01   +1.594974419294775e-01   +1.958466967104178e-02   +3.871965282631232e-02   +1.707955240574583e-01   +1.899074165553119e-01   -5.155885159818834e-03   +1.704189340545468e-01   +5.804508980998803e-02   +1.742545214099371e-01   +9.267184420544201e-02];
L2I_L2E_iAMPA_netcon = [+4.468888149157096e-02   +2.900023674632601e-02   +3.731541414532752e-02   +3.869665364094735e-02   +1.625910363949923e-01   +8.518914608389150e-02   +1.552994781191560e-02   +5.317023826440324e-02; +2.791564148064216e-02   +7.737813163763693e-02   +2.064676988734939e-01   +4.463992838773153e-03   +8.267374664782104e-02   +4.192641246360040e-02   +4.495834610591467e-02   +1.116203053268363e-01; +2.512095328702154e-02   +1.815500907944624e-01   +9.783942404013937e-03   +6.279831855430414e-02   +1.486352144432843e-01   +2.035637121793278e-01   +9.354940811894757e-02   +5.359137432775568e-02; +1.165561298596371e-01   +2.163354966502333e-01   +2.056920484107018e-01   +7.554229059772319e-02   +9.391513571154952e-02   +1.313421498571012e-01   +8.783310673772318e-04   +1.361605156398503e-01; +1.569203846336641e-01   +1.347532072699997e-01   +5.938903441798400e-02   -5.090578972131103e-02   +7.408717407542206e-02   +1.330323816671982e-01   +6.196361749420976e-02   +1.810990165952396e-01; +3.423833182482701e-02   +1.097599303734524e-01   +2.293576711848692e-01   +6.235078170521393e-02   +1.559383281435190e-02   +3.403747927527742e-02   +1.685486908377041e-02   +9.784696182392606e-02; +4.481225083742238e-02   +8.955022369926771e-02   +2.122579191662252e-01   +4.114057907481874e-02   -7.410232500919953e-02   +5.896538063501730e-02   +5.739287108041708e-02   +2.217038361194990e-01; -1.087686355906307e-02   +1.141152056959206e-01   +1.554006561345864e-01   +2.440280992171490e-01   +1.921389821331272e-01   +1.478014353402065e-01   +1.776377054490560e-01   +4.479001040235248e-02];
L2E_L2I_iGABA_netcon = [+1.457056384308395e-01   +8.653394927215659e-02   +1.061325200521430e-01   -1.198510185314468e-02   +4.158488986366060e-04   +1.968510557046537e-01   +1.495103892669555e-01   +1.220864651297601e-01; +2.421717971097705e-01   +5.500557669866764e-03   +4.457792711529808e-02   +2.154279605508123e-01   +7.672910293803353e-02   +3.798118015118056e-02   +5.967162564089826e-03   +1.010722775440397e-01; +8.344346274375450e-02   +8.214407915848271e-02   +1.111608721119613e-01   +7.553403567930148e-02   +7.164801137568239e-02   +1.528289980669801e-01   -1.733722019055155e-02   +9.005521125621826e-02; +1.265627682939433e-01   +7.063396491385882e-02   +5.766223026488932e-02   +5.425418151618017e-02   +1.096529792133187e-01   +1.804303615287980e-01   +1.079377168522148e-01   +1.114760201325680e-01; +6.940395070919174e-02   +1.597590908240692e-01   +1.661376659508237e-01   -5.521051344620175e-03   +2.989807905238547e-02   +7.289522250749803e-02   +1.591195419014372e-01   +2.075617744057585e-02; +1.349817497600757e-01   +4.047350588770710e-02   +2.118575562052321e-02   +1.170465164261133e-01   +9.018728011911800e-02   +1.528035746435883e-01   +1.021654416872172e-01   -3.443874719929997e-02; +1.541674212692723e-01   +8.619397698720892e-02   +1.328483966558081e-01   -1.853517084346388e-02   +7.824292201038927e-02   -3.141608605900565e-02   +1.192117077169167e-01   +2.840335724046536e-02; -6.066037171724065e-03   +1.079326386750691e-01   +7.161105649000384e-02   +2.011751625780629e-02   +1.126765404677792e-01   +1.407090689597832e-01   +4.590591066271141e-02   +2.990089740107622e-02];
L3E_L2E_iAMPA_netcon = [+4.685808314579060e-02   +8.809015750968054e-02   +1.269219405029105e-02   +2.529560623440836e-02   +1.262339121078851e-01   +3.959123587551359e-02   +1.559715620483102e-01   +9.910502552576843e-02   +1.584936364458416e-01   +1.256749923715206e-01   +4.997678338483667e-02   +1.233262685578812e-01; +5.308014413963390e-02   +1.921088840538577e-01   +1.416727133082376e-01   -2.179447714166345e-02   +1.323307312740735e-01   +1.164259925757942e-01   +8.658710970162375e-02   +2.078282080647358e-02   +1.446174269586830e-01   -3.611270898011598e-02   +1.540577617475080e-01   +1.263918143627961e-01; +1.486300619470501e-01   +1.051714867067877e-01   +1.901866505180550e-01   +1.110092782317178e-01   +9.938505477325915e-03   +7.529695484200398e-02   +1.619831467177402e-01   -8.944068337072418e-03   +6.532904812271603e-02   +1.961803262956982e-01   +1.186918211858076e-01   +3.085963195904302e-02; +9.978366146759002e-02   +1.302295334448355e-01   +6.417851279087955e-02   +3.328388704215391e-02   +1.881460459778291e-01   +8.137213348081307e-02   -1.100018815339694e-02   +9.815562586555514e-02   +9.315008520165445e-03   +9.047549431098666e-02   +1.252433601662434e-01   +2.166315694209774e-02; +1.198011373184170e-01   +2.030376182547434e-01   +1.623303923071913e-01   +1.931845061900762e-01   +1.436832913594946e-01   +2.283100765330121e-01   +1.243397930453302e-01   +7.540886877779972e-02   -3.261951187259352e-02   +2.761165378282676e-02   +1.448303036307851e-01   +7.585889832023932e-02; +7.552399853190964e-02   +8.786566072745297e-02   -2.405338755068633e-03   +7.532653073645550e-02   +1.248694779492833e-01   +6.218091479607704e-02   +2.299104215658704e-01   +1.641653160560952e-01   +1.635939527991007e-01   +8.193191293306863e-02   +1.619322378420467e-01   -1.928012764030186e-02; +1.680438999697768e-01   +1.037170717220723e-01   +6.256390456022959e-02   +3.474490676103266e-02   +4.874507642488550e-02   +7.126752876159506e-02   +6.360221054662321e-02   +6.022901971563801e-02   +3.969015139310286e-02   +3.900662613535254e-02   +1.733947186824033e-01   +1.329257402119581e-01; +1.760555416449849e-01   +1.249569889310419e-01   +9.598883838366763e-02   +1.356577204009096e-01   +1.878635587014246e-01   +9.630451685620255e-02   -5.904211807532924e-02   +5.395311452559479e-02   +3.960050877419400e-02   -2.118917560245253e-02   +6.097971745660499e-02   +5.136520449506911e-02];
L3I_L2I_iGABA_netcon = [+1.094233423756231e-01   +2.065119497877554e-01   -2.604771013030399e-02   +1.420117669397213e-01   +4.460678033974506e-02   +1.405036341740722e-01   +1.476246188793990e-01   +5.096260482974001e-02   +2.523553583992193e-02   +2.578251581270576e-02   +9.157369615498570e-02   -1.672633694619832e-02; +8.990868584393014e-02   +1.084840656756132e-01   +6.730864071072160e-02   +1.072357476914792e-01   +1.157704707330364e-01   +1.115725213025427e-02   +1.811091719229289e-01   +2.564258994837974e-02   -4.608853188044607e-03   +1.061693348822931e-01   +8.780912855547451e-02   +5.874022240994640e-03; +1.030144884281985e-01   +1.763149797946597e-01   +1.410947893166252e-01   +1.252924311833230e-01   +1.320610530215612e-01   +1.113510099590596e-01   +4.324178323838176e-02   +8.968353866132345e-02   +1.181635942130947e-01   -2.270796719085151e-02   +1.710520580380544e-01   +8.444798681268842e-02; +1.107973953632200e-01   +2.184047560321827e-01   +1.569173131361896e-01   +8.858426762321872e-02   +1.086927983665069e-01   +1.175529648940390e-01   -3.233988091251201e-03   +3.747506179854010e-02   +1.331219188193164e-01   +1.839036947491881e-01   +4.503928678098221e-02   +1.340617003328445e-01; +3.184329157098566e-02   +1.693637871811635e-01   +1.759220391628016e-01   +9.334356423745797e-02   +2.021401591501692e-01   +5.565017708144382e-02   +6.601066641686963e-02   +1.520557970640389e-01   +3.966128691608301e-02   +1.447429707755324e-02   +7.211594059441793e-03   +9.499213758049367e-02; +1.134913033339908e-01   +5.794702004469742e-02   +1.557057077503013e-01   +8.974102553636834e-02   +1.166907095369353e-01   +1.604192114063971e-01   +8.242247157790412e-02   +1.244564018675263e-01   +3.717330144295711e-02   +4.060548723821167e-02   +9.490455420427095e-02   +9.344923313984491e-02; +6.721573304660415e-02   +6.010848291036301e-02   +1.843858763457327e-01   +1.927260367841807e-01   +1.051074600979241e-01   +1.696874570801043e-01   +6.034272114627318e-02   +2.381504878182229e-02   +3.143891183285304e-02   +1.333267783098155e-01   +1.901753958935290e-01   +8.577344459738070e-02; +5.478716758252695e-02   +6.663901870717161e-02   +1.341452909202903e-01   +3.929109639203670e-02   +1.571893876331506e-01   +1.514890008010520e-01   +1.641132017614366e-01   +1.277224951909208e-01   +6.169273677597966e-02   +1.087148543495552e-01   -1.375900677453344e-02   +1.383255503919608e-01];
L2E_L3E_iAMPA_netcon = [+2.086128888652386e-01   +1.203809145227079e-01   +1.515055954370255e-01   +6.893424050559738e-02   +6.670433391926917e-02   +1.550573681810836e-01   +6.488127520596018e-02   -1.338274093038519e-02; +1.313973356330816e-01   +1.343721349906395e-01   +1.396151682386687e-01   +1.176866463110203e-01   +2.297226019272503e-01   +3.142555444269850e-02   +9.390093418255156e-02   +1.627536473365616e-01; +3.818961209648865e-02   +7.891486794582943e-02   +1.038505731078682e-01   +1.234790729797833e-01   +7.105997125549897e-02   +1.429023879391885e-01   +1.064301778592664e-01   +3.343450874495640e-02; +8.418124953813391e-02   +2.923129205910210e-02   +7.692047693924316e-02   +1.499361837957248e-01   +8.667398227130316e-02   +1.667569425787925e-01   +1.273040464615221e-01   +5.309615880994295e-02; +1.126636349401874e-01   +1.320324571708811e-01   +1.898408544394901e-01   +1.252003776363277e-02   +1.619533184371897e-01   +7.964386127151105e-02   +8.985928735209001e-02   +3.562546190274633e-02; +5.271492114610914e-02   +1.873303728114932e-01   +1.191855637182747e-01   +4.412257805402608e-02   +2.033226209318784e-01   +4.785180509939078e-02   +6.561555223598826e-02   +9.700539530213440e-02; +1.250490661158216e-01   -9.326742614909050e-03   +7.262871676769404e-02   +4.871224166107393e-02   +1.106334053541721e-01   +7.643915076385553e-02   +1.421223296811518e-01   +7.826847844218007e-02; +1.020934363326901e-01   -7.617004848671539e-03   -2.063366012317831e-02   -4.538810247583066e-02   +1.492744276001308e-01   +3.505116301524680e-02   +4.141176822688562e-02   +1.608572677348440e-01; +2.165929652063139e-01   +2.043229526744936e-01   -6.072348821541534e-04   +1.196791413581591e-01   -1.822821552595353e-02   +7.832138871599685e-02   +1.918983323868039e-01   +8.701356462868505e-02; +6.120754812672698e-02   +6.727026233005889e-02   +1.559883810092964e-01   +4.917328699981961e-02   +5.490073552456767e-02   +8.574066555077212e-02   +1.784175129113272e-01   +1.138186692622986e-01; +1.277135216447521e-01   +3.315862851388931e-02   +6.256353382532563e-02   +1.216854350263268e-01   +4.907179563896065e-02   -1.306589592830475e-02   +1.182940397427948e-02   +1.838441583286428e-01; +1.158415958513590e-01   +2.375111752098159e-02   +1.724485202597266e-01   +1.385621552573719e-01   +8.889566083892783e-02   +5.923638716228549e-02   +1.046688579572171e-01   +5.386973833662770e-02];
L2I_L3I_iGABA_netcon = [+6.518176118773267e-02   +6.907555508124487e-02   +7.427883336908180e-02   +1.100349860142625e-01   +1.005269548022728e-01   +7.084531083502305e-02   +3.650588775145949e-02   +1.096128220063737e-01; +7.440469974020744e-02   +1.530601282581560e-01   +4.108976849707148e-02   +1.630950239479956e-01   +5.799681789458860e-04   +1.262095395938800e-01   +4.457218019511874e-02   +6.636889180192429e-02; +1.889890218632929e-02   +1.820113100402361e-01   +1.280494092010546e-01   +1.835350045840206e-01   +5.637385531765846e-02   +8.909595931810131e-02   +1.764898655327390e-01   +1.910755364741463e-01; +1.808170524710233e-01   +1.879501010530231e-02   +1.183910856626549e-01   +7.272606576484583e-02   +8.616719245257548e-02   +1.151342246446257e-01   +1.546906469691848e-01   +1.100602158250703e-02; +6.426597724831609e-02   +1.995890277780407e-01   +1.071586453120033e-01   +1.245734498683716e-01   +2.816045505081723e-02   +1.227896915194216e-01   +1.213876193828935e-01   -1.161445606930513e-03; +7.278011402730425e-02   +1.181839663772471e-01   +3.757454894609229e-02   +2.038031617790469e-01   +5.105806750165123e-02   +3.626079165787136e-02   +1.040937881868821e-01   +9.177801149450077e-02; +5.236549834485611e-03   +1.582029542358118e-01   +3.368498231291367e-02   +2.300588021947059e-01   +3.932357327482090e-02   -3.862114210001943e-02   +1.223471156948280e-01   +1.110698378798297e-01; +2.901168958540630e-02   +2.791626205177851e-02   +1.207429394894911e-01   +8.403760234551443e-02   +1.430492798405514e-01   +9.805417167875249e-02   +2.033997093132298e-02   +2.103315595410834e-02; +8.208007165450718e-02   -8.680200118184303e-02   +2.314972192957895e-01   +2.147670719595224e-01   +1.189807165436951e-01   -2.570111949184283e-04   +3.954246115169759e-02   +1.610105870138712e-01; -9.741519137614962e-03   +4.754050610869286e-02   +9.564949802735645e-03   +1.380740231803614e-01   +1.452591544094255e-01   +2.234668077353345e-02   +1.271299849957611e-01   +6.037935793573326e-02; +2.020613505488530e-02   +1.544571270439644e-01   -8.244341928145344e-03   +9.346055588856203e-02   -2.557095799705924e-02   +1.466584915059882e-01   -9.878038913530913e-03   +6.457904944907432e-02; -5.365906716799498e-02   +7.547924952042030e-02   +7.284661646855414e-02   +2.650034411389932e-03   +1.567030998214934e-01   +1.240314001389711e-01   +5.907521897496545e-02   +3.942799476291524e-02];
L3I_L3E_iAMPA_netcon = [+4.235985179546133e-02   +1.080770979032838e-01   +1.034473092980236e-01   +1.308277075829601e-01   +1.020604436372008e-02   +1.572174266024910e-01   +3.506185221971763e-02   +5.850239046963070e-02   -2.855143158941228e-02   +2.201659845699309e-02   +1.134615477113563e-01   +4.319026084607890e-02; +1.630328168506353e-01   +3.408316919060583e-02   +6.443749493461853e-02   +2.096355012906252e-01   +1.244662744918902e-01   +1.358067606650754e-01   +1.371594299666216e-01   +1.816285578869525e-01   +6.435711083412346e-02   +9.134183231769226e-02   +9.408567634893497e-02   +1.550610308264707e-01; +4.422208750938271e-02   +1.288080452275353e-01   +5.129829396364027e-03   +8.533290062157509e-02   +1.528582540139099e-01   +1.839159463924500e-01   +1.288044491955702e-01   +6.642658828929132e-02   -1.163234845650389e-03   +1.806792388953053e-01   +6.545069687149885e-02   +1.461079748440966e-01; +1.649765629283560e-01   +3.270082736158801e-02   +1.065141037687708e-01   +1.709411517471540e-01   +9.914080812996598e-02   +4.423974231264585e-02   +1.042908002942909e-01   +1.721090956554021e-01   +1.236381037753893e-01   +1.761028659472421e-01   +5.899093009449340e-02   +1.404142206584339e-01; +6.826501742469814e-02   +1.857507891023309e-01   +4.098594850085134e-02   +1.891304041985477e-02   +3.083003585282563e-02   +5.318166389773311e-02   -3.009142784817063e-02   +1.117530313189256e-01   +6.924094917777870e-02   +2.721952100916663e-02   +1.611284772349352e-01   +1.587821425682372e-01; +6.065614700059353e-02   +1.398230276181630e-01   +9.638898929235493e-02   +2.219808620810085e-01   +4.333828145975512e-02   +2.999649953335817e-02   +8.876989625028313e-02   +1.594902152400106e-02   +1.955637241652497e-02   +1.452271963650484e-01   +1.325883331046831e-01   +6.851007651577566e-02; +1.330601337641511e-01   +8.768825603213745e-02   +1.374135908983425e-01   +1.697194304542320e-01   +1.647831413776415e-01   +7.534476795741159e-02   +8.244401970934150e-02   +1.825554063260075e-01   +1.122345388284499e-01   -1.712477573633879e-02   -9.269873058401357e-02   -5.340931565480575e-02; +2.044403255286758e-01   +1.114387460051451e-01   +5.784844992772130e-02   +1.246097197608427e-01   +5.885683204641314e-02   +2.235971615117443e-02   +6.105263658642587e-02   +1.970884680279233e-01   +1.030611827865849e-01   +1.024833017767572e-01   -1.954676177330487e-02   +4.641402441094065e-02; +6.519972059435462e-03   +5.552664761595827e-02   +4.760338438499160e-02   +2.567041184066299e-02   +2.090687837545735e-02   +6.122227653809572e-03   +1.112093727617711e-01   +5.497471155954774e-02   +7.273355792143564e-02   +1.784655822370269e-01   +9.144649876496608e-02   +1.495343840902623e-01; +1.398219061324664e-01   +1.693284931369974e-02   +1.197742530414499e-01   +4.248032354277001e-02   +6.633341989169403e-02   +7.238748356078757e-02   +1.113534669061995e-01   +1.903464995760364e-01   +1.281948195194189e-01   +7.064083359157514e-02   +3.599711789914829e-02   -2.949934947130289e-03; +1.744930950240369e-01   +9.483960336201414e-02   +3.470849689493904e-02   +2.814076210776700e-02   -4.794757657624641e-03   +1.240823204251979e-01   +1.030594407413825e-01   +1.518975873165133e-01   +5.207704885726493e-03   +4.797903686081172e-02   +9.001629999634998e-02   +1.396812840931186e-01; +1.104424679561861e-01   +4.822232480958243e-02   +5.879815592087118e-02   +2.032709624337260e-01   -3.931036767610295e-02   +4.599160548576928e-02   +1.421216206028529e-01   +6.526133655378230e-02   +2.853411775956158e-02   +2.503515351901927e-02   +1.015647870366776e-01   +2.078282471534337e-01];
L3E_L3I_iGABA_netcon = [-1.337450723779842e-02   +1.823464128799542e-01   +7.398253245208643e-02   +1.854587371336112e-01   +1.848540415775074e-01   +1.374369865527074e-01   -4.632451870973370e-02   +5.560450641481324e-02   +1.550370439248933e-01   +1.445233917977751e-01   +2.042933935679066e-01   +1.013225965529331e-01; -1.042539467501593e-02   -3.309429639557073e-02   +2.264733952068795e-01   +1.126027032167933e-01   +9.454572035893707e-02   +1.023148273882365e-01   +1.466048847520996e-01   +5.403760366933955e-02   +1.837285658020228e-02   +2.188803938562386e-01   +9.319573638649137e-02   +1.161697973532810e-01; +9.010070189063803e-02   +1.643644178684560e-01   +1.457063113755084e-01   +1.852890931359277e-01   +5.473085563801398e-02   +1.566562117796954e-01   +7.012698694213128e-02   +3.270556971968673e-02   +1.261020185125350e-02   +1.393653432962363e-01   +2.257299877591922e-02   -2.434509001514353e-03; +9.995153774987145e-02   +1.304008481478117e-01   -3.219576427522501e-02   -4.093236928523082e-02   +4.806616669824326e-02   +1.927037145589680e-01   +1.064302934174266e-01   +1.364321461863692e-01   -2.571676887736402e-02   -1.054704929752559e-02   +1.099131136449918e-01   +5.986518845767850e-03; +1.416783115341376e-01   +1.219337580386886e-01   +2.569221241677174e-01   +2.425174194449015e-02   +1.626872555252620e-01   +2.942187505143705e-02   +1.393650565806131e-01   +7.149523410865166e-02   +3.905149248114486e-02   +1.966533674205970e-01   +4.949099037410825e-02   +4.890815426802855e-02; +4.730807114071192e-02   +2.088057036582808e-02   +2.575897215270272e-02   +3.585001087464636e-02   +3.921069893900431e-02   +1.823811845285637e-01   +6.462056520437855e-02   +6.002848275014425e-02   +1.335388347923156e-01   +1.752477722011258e-01   +1.313768755514200e-01   +5.010322766763246e-02; +1.281733539137407e-01   +1.160253617225258e-01   +5.940345904002132e-02   +3.783864146909188e-02   +9.235946851368104e-02   +1.825542875184205e-01   +1.741684142176981e-01   +1.662499160233950e-01   +1.198399247782837e-01   +1.534196010248263e-01   +1.171737727860485e-01   +5.875923872094123e-02; +1.082988147075527e-01   +1.083893777406963e-01   +1.273628317981144e-01   +1.991561309479666e-01   +1.238062559751515e-01   +4.812443897577451e-02   +6.204166894113430e-02   +1.128598188748262e-01   +4.771212708075346e-02   +4.774938181570380e-02   +6.694754008242763e-02   +1.230701450184330e-01; +1.831780552547743e-01   +7.308199861089409e-02   +1.297351700053324e-01   +6.007594050715297e-02   +1.654953822629031e-01   +5.387952044756091e-02   +7.158316899428234e-02   +1.267214054003919e-01   +9.946861342326749e-02   +2.152519233412508e-01   +1.613466864913709e-01   +1.430958401260914e-01; +1.182218785995145e-01   +1.068580766507584e-01   +1.057804470277555e-01   +7.999538532305405e-03   -1.470978349926108e-02   +9.476423700511197e-02   +6.341083022268616e-02   +9.702298254279375e-03   +7.210597944126673e-02   +1.117620300901421e-01   +7.280484861071052e-02   +7.721099769558334e-02; +8.045727489969014e-02   +1.364363228157076e-01   +6.582606117567133e-02   +2.358635744756191e-01   +1.690409061160137e-02   +1.459929621340695e-02   -1.188489060556711e-02   +6.982713342601073e-02   -2.855933727518893e-02   -5.925821445397070e-02   +1.879627139951448e-01   +1.829639810513826e-01; +1.045325143584763e-01   +1.150056311402306e-01   -1.478404650754376e-02   +9.679575364709161e-02   +1.239390172893889e-01   +6.556725943736250e-02   +1.493635856593746e-01   +1.267250696625739e-01   +2.474704433303949e-02   +2.592040357771069e-02   -1.687732924226501e-02   +6.112673395486463e-02];
L2E_Input1_iAMPA_netcon = [+8.683098679200751e-02   +6.657558669311467e-02   +7.391096694315989e-02   +8.489215489517131e-02   +1.390367295323150e-01   +1.075695810701927e-01   +4.382334487557347e-02   +1.380199506598992e-01];
L2I_Input2_iAMPA_netcon = [+8.587925407638253e-02   +4.053359859628278e-02   +1.914899324631149e-01   +1.270633095374978e-01   +1.173637585223078e-01   +5.657663854387827e-02   +1.284483461381545e-01   +1.830402290946455e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
