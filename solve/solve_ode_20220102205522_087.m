function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.285967179162242e-01   -3.661079970056390e-01   +2.239957724575170e-01   +3.224955628360746e-01   -1.291637475322171e-02   +1.606349174452682e-01   -6.009518130274881e-01   +3.535159960567058e-01   +6.203975788940098e-01   +5.192382305314633e-01   +2.485555482307366e-01   +2.337985201168988e-01   +3.362020366874293e-01   -1.731764089773185e-01   -1.841752517281374e-01   +1.764921564122809e-01; +7.486983882134706e-01   +1.203937355124151e-01   +7.220273977477848e-03   -3.929505369532101e-02   -9.258862773285935e-02   +6.573204999527674e-01   -6.287120210688062e-01   -6.302616177756845e-02   +4.427711452350563e-01   -1.360113183607813e-01   +5.421934385203100e-01   +4.756308190963853e-01   +4.718985642246892e-01   +1.992067862260509e-02   +1.673233027564268e-01   -1.410976123134754e-01; +5.616642206975609e-01   +1.677005710793240e-01   -1.506220312887077e-02   +2.742420301557528e-01   +7.583069973673834e-04   +2.963834699147569e-01   +3.515708693212067e-01   -7.006694421427150e-02   +3.751527595992354e-01   +3.426228197457201e-01   +4.247913944616765e-01   +3.410328629199370e-01   +2.123990762178528e-01   -3.319123719161893e-01   -3.011507230692323e-01   +5.121030961713194e-03; -6.458284066208318e-02   -7.874856312037200e-02   -5.223393616307440e-02   +8.009263632258050e-01   +5.838110309359165e-02   +5.527716776799441e-01   +6.901512014740128e-01   +7.939706281873325e-01   +4.352853413919548e-01   -1.039409809104698e-01   +6.492534671558065e-01   +3.649923008139879e-01   +3.311499094157859e-01   +6.782529959403252e-01   +1.332777105759067e-01   +7.988509162582491e-01; +2.564637106115781e-01   +3.128931771919357e-01   +5.216244866506787e-01   +3.905572182727847e-01   -1.123319654617485e-01   +2.987352664146059e-01   +5.742359711784874e-02   +7.135300419679244e-02   -9.455357141007067e-02   +4.441463207558689e-01   +6.634369786562397e-01   -1.796383360808400e-01   +5.272891434588937e-01   +2.028911426184353e-01   +2.497495359454169e-01   +1.846514791911866e-01; +1.192994467301490e-01   +7.147758743778767e-01   +3.569400538635410e-01   -5.110384131324308e-02   +4.014674906485893e-01   +3.072441888861543e-01   +4.447681325673152e-01   -2.315374498166552e-01   +5.289325561855943e-01   +2.449556929881835e-01   +4.752226209326957e-01   -3.215861052512312e-01   +2.080717412193896e-01   +2.713808452242225e-01   -1.709050517478334e-01   -5.610596827211328e-01; +3.670147821488007e-01   +3.688481781296342e-01   +4.936958323113594e-01   +4.176972925257395e-01   -1.602043209657523e-01   +4.582661317544701e-01   +2.210039264899445e-01   +8.732102213272057e-02   -8.071152994370558e-01   +1.857359052536288e-01   -1.781943840257242e-01   +1.912143683900518e-01   +4.603069682089070e-01   -2.927159306595170e-01   +3.512673933470424e-01   +6.683594875301953e-01; +5.875035917669528e-01   +3.934930663863558e-01   -1.150222393375192e-01   +2.651346918091169e-01   +2.686224446937246e-01   -2.216935989489530e-01   +2.497306063556828e-01   +5.374869089910614e-01   +4.152929341706343e-01   +1.077521732509967e-01   +5.995346384211246e-01   +9.154997368247135e-02   -4.933510384511842e-02   +2.349324198675453e-01   -1.923020219818125e-01   +3.189156784755018e-01; +3.308358436929826e-02   +6.183315929246093e-01   -2.980592309200175e-01   +1.660351643139101e-01   +2.330312522807328e-01   +6.039852906127436e-01   -1.201709773246731e-01   -3.408984556731015e-01   +4.331597601613089e-01   +9.514887084059444e-02   +6.506578720754173e-01   -1.719237088223879e-01   +2.676563080060897e-01   +4.723094770707928e-01   +1.290414304941200e-01   -3.187479956124379e-01; +2.765132212998507e-01   +7.054232277081368e-01   +3.888634419535285e-01   +1.830911395496330e-01   +1.963149562746171e-01   +2.050586572416904e-01   +5.764608371073381e-01   -1.139050115251621e-01   +2.145232566143314e-01   +3.475881380046287e-01   +8.259235466415854e-01   +7.145476493587868e-02   +5.032765899475540e-01   +4.085520420756029e-02   +1.369784726352871e-01   +4.219631607786857e-01; +9.132502185596057e-02   +8.257042893962875e-01   -1.445211674219066e-01   +2.864710457849418e-01   +8.102918544437639e-01   +1.623753682351232e-01   +1.729070272680406e-01   +9.553985428807213e-03   -9.409976769011415e-02   +5.167184678109193e-01   -4.540127661812903e-01   +1.263772316396523e-01   -5.059858705905652e-01   +1.154513062343739e-01   +4.359145012251232e-01   +1.957091380479064e-01; +2.734144797700981e-01   +3.332993621788298e-01   +1.811844400705339e-01   +1.039059124477821e-02   -4.550154658071322e-02   +1.388282797037496e-01   +4.217171373645173e-01   +2.535666602999039e-01   +5.723067690331345e-01   -1.328688455802153e-01   +4.091055180167452e-01   +7.715255737736628e-01   +8.021632974245732e-01   +5.725988437165463e-02   -2.175353545649633e-01   -8.028314542353640e-02; +8.300785029234758e-03   +2.639369175655767e-01   +4.704700470968315e-01   +1.457145743639609e-01   +8.773165281756767e-01   +5.775255192293824e-01   +1.798045339229872e-01   +1.009656294486100e-01   +6.333834665735977e-01   +3.379448171233991e-01   +5.157984988101075e-01   +5.363905022008445e-01   -3.502401422187591e-01   -3.984683743974956e-02   +3.216143751209990e-01   -1.336867510242668e-01; +3.629274887489652e-02   +3.422569799582765e-01   +2.750927236388622e-01   -5.137327312747482e-01   +1.753548104992922e-01   +4.867760367109574e-01   +1.111515255469369e-01   +4.030722370091455e-01   -1.346274110829776e-01   +3.099559838064770e-02   +5.394661605849026e-01   -2.141674707878074e-01   +3.714917261085927e-02   +7.350769954151580e-01   -1.945046890000773e-01   -1.953425570678262e-01; +6.366049872557783e-01   -3.063924599630942e-01   +6.008800784102128e-01   +4.030135141961392e-01   -3.773689851067608e-01   +2.205575623003284e-02   +4.198806776984446e-01   -1.743039568615490e-01   +1.426141439207250e-01   -2.532911266427361e-01   -2.018720710695895e-01   +1.570621299766926e-01   +5.273666045381733e-01   +1.705188491752967e-01   +2.971201877009151e-01   -3.937127023723578e-01; -6.829851365334488e-01   +3.536152364622794e-01   -1.110439697983946e-01   +3.967419847675112e-01   +7.888696938589642e-01   +6.307083828279076e-01   +9.158391799160986e-02   +7.709590822654738e-01   +1.391240662196844e-02   +5.877374483862834e-01   +5.314193522835892e-01   +4.225874538183064e-01   +3.146715614264122e-01   +3.677667493028057e-01   +5.637875408146918e-01   +5.606256598148593e-02];
L1E_L1I_iGABA_netcon = [+8.447516800600202e-02   +3.138260417873930e-01   -5.395961936572120e-01   -1.315162682631119e-01   +7.594202642352622e-01   -1.557738855062190e-01   +4.688458993737861e-01   +3.462085935578649e-01   +3.032061227734712e-02   -2.273125134311150e-01   +2.779702378556239e-01   +1.670242302172071e-01   +7.460296119233306e-01   -3.157854172443407e-01   +3.623424116146083e-01   +9.487964812782299e-01; -4.656668272584604e-01   -2.351341448416110e-01   +6.167302813558510e-01   -4.223924312850931e-01   +2.985147446628838e-01   -4.335175428573207e-01   +3.462518220137300e-01   +5.505929442302736e-01   +2.841033335705545e-01   -3.022180421996955e-02   +3.623404148511661e-01   -9.729695190782355e-02   +6.949427662690911e-01   +2.666051655069665e-01   +3.524398018134061e-01   -2.003659740260642e-02; -8.797230261125337e-02   +3.464239957277455e-01   -4.349190882394701e-01   +3.520227785804224e-01   -2.248448485702528e-01   -1.181416884042018e-01   -6.404974513613246e-02   +9.589638262917122e-02   -2.303567164782921e-02   +1.350599895075023e-01   +1.661517939302399e-01   +2.784497551576644e-01   +1.105722283622332e-01   -2.204658721123144e-01   +6.672336490153131e-01   +2.952242274743469e-02; +5.463084186164370e-01   -3.831803149680980e-01   -1.908562033826172e-01   +4.025176604264030e-02   +8.251398917050587e-02   +3.885615800209924e-01   -1.259795092679746e-01   +5.936347210350635e-02   +3.529487067539387e-02   +6.302970648945479e-02   +2.644000793326266e-01   +3.033074382170075e-01   -1.923433393807910e-01   +2.743821881154505e-01   -6.651514324144760e-02   -2.490438639350358e-01; -2.219993463534780e-01   -6.738329063872739e-02   +8.698149002926218e-02   +2.437592759055611e-01   +3.714247192745980e-01   -1.805488640513726e-01   +2.854214170894745e-01   -4.962144202610150e-01   -5.025751910387070e-02   +1.110588338480565e-01   -2.768323157059765e-01   +4.832145572021536e-01   +3.626556246812173e-01   +5.394640893610431e-01   +3.314483394478188e-02   +2.010759727436852e-01; +4.838230181016632e-02   +1.369399137259115e-01   +1.942204157486441e-01   -3.988389644361053e-01   -3.291003921088645e-01   +6.767262833763421e-01   -2.709221946158801e-02   -1.872659546965693e-01   -1.815400381320236e-01   +1.256495297340884e-01   -3.291327582061739e-01   +6.077955586277464e-01   -7.646706398075837e-02   -2.141362643166134e-01   +2.667915765975046e-01   +1.080783184671274e-01; -2.225427765989917e-01   -5.752092888575552e-02   -3.071538279892019e-01   -3.030708815478166e-01   +4.641990504733511e-01   +3.666475768067350e-02   +2.359350928442185e-01   -2.337269922948379e-01   +1.330914541265895e-01   +3.659076437495104e-01   +7.313385582247701e-01   +1.563505382614108e-01   +1.438502348574290e-01   +8.857571317194865e-02   +8.148272312541672e-01   -2.084545467418893e-01; +1.183175228498405e-01   +3.725802724016383e-01   -1.776340111800101e-01   -1.293356806574951e-02   +7.714106770837227e-02   -2.720854646088037e-01   +8.327262335308593e-01   +1.953995118765282e-01   +4.809956598656557e-01   +1.535639428122693e-01   +1.714571324578232e-01   -1.729729901044960e-01   +4.927443151516188e-01   +3.533262523918785e-01   +3.625340134711663e-01   +5.049849418757233e-01; +5.628628015633445e-01   +6.867031305123594e-01   +6.719952367767915e-02   -8.555628836106145e-02   -3.113301126199736e-01   +4.567122755222057e-01   -1.302866294275409e-01   -2.432119369083452e-02   -6.240875623573497e-02   -1.032962957288949e-01   +2.202647842090797e-01   -2.047882751077941e-01   -1.173383722098703e-01   -1.255578798214356e-01   +5.650056792716276e-01   -3.211171034640574e-01; +1.263458148359643e-01   +4.824766110852315e-01   +1.456827699263506e-02   -2.290841554139009e-01   -2.626362109889774e-01   -1.534744659862652e-02   -1.387144705224457e-01   -2.639540735726562e-02   +4.373614916509396e-01   +1.897034222609900e-01   -4.598443363918379e-01   -1.623419843706807e-01   +3.616508229832689e-01   +4.692396813138641e-01   +2.668040660570429e-01   +3.649718994262522e-01; +3.187745218413497e-01   +3.063275232720157e-02   +1.567048236234983e-01   +5.981817408934456e-01   +2.989925213864490e-01   +1.682551530362945e-03   +1.015534889103906e-01   -1.325021114996441e-01   +5.316080807055346e-01   +4.046255435314112e-01   +1.254727460526956e-01   +4.900519499501273e-01   +8.975981453155392e-01   +2.882801880539742e-01   +2.832857559932047e-01   -4.762724368345337e-01; +1.563814142692650e-01   +1.942632819721909e-01   +8.247009022650187e-03   -6.329426340295086e-01   -1.728922951662918e-01   +1.497764521421011e-01   -1.146579834927062e-01   +1.459222249622545e-01   -1.329104962044881e-01   -1.498857528871766e-01   +4.051642506091106e-01   +2.564573079505926e-01   -8.034008032640097e-02   +3.586639499676589e-02   +3.011024567809908e-01   +3.792680506984097e-01; +4.033878976002107e-01   +5.940980040515456e-01   +1.864336366759750e-01   +2.564160025568419e-01   -8.999874037198725e-02   +2.231397767977437e-01   -4.573681650215615e-02   +3.173267736051304e-01   +5.684114144825212e-01   -4.618406575898535e-02   +1.320346627607280e-02   +1.785229149033747e-01   +1.430190795123220e-01   +1.129671160407757e-01   +3.124657477637558e-01   +4.882655278122405e-01; +6.892134509152328e-01   -1.108305238113760e-02   -9.327919717437291e-02   +1.647381496282213e-01   -2.766074394856792e-02   -9.694976342706384e-02   +2.863856465966337e-01   +2.362013740991785e-01   +4.632453311656140e-01   -4.311217647107576e-01   +1.867315085068245e-01   +6.866992052388103e-02   +9.445953049014541e-02   -8.760039855992865e-02   -1.276442343627767e-01   -1.670949932617070e-01; +5.219894990833437e-01   +2.231500472786193e-01   +1.650218657758885e-01   -1.157291307939877e-01   -2.900529636313562e-02   +1.027370139558235e-01   +3.373792260725051e-01   -1.498483979918387e-02   +5.329609051537425e-01   -1.056406359663994e-01   +2.722581059136694e-01   +1.770178087310646e-02   +4.912758144563332e-02   -5.690230038260348e-01   +7.187920120381087e-01   +1.793501742902274e-01; -1.537942429133744e-01   +2.889652495159195e-01   +3.887637499213337e-02   +5.020870137845775e-02   +7.739983346388549e-03   +7.112415995694966e-02   +5.766292058830294e-03   -4.255904910522369e-02   -2.175363147539829e-02   +3.172621110327558e-01   +1.141793515942880e-01   +2.055605282556525e-01   +3.049207728447184e-01   +2.294674293754176e-01   +1.336413111116682e-01   +6.018532666825190e-01];
L2I_L1I_iGABA_netcon = [-1.740467025754612e-01   -2.149805716121621e-01   +5.809466302545627e-02   +2.593921484983727e-01   -2.044616003016976e-01   +2.287978461399391e-01   +3.244605282518224e-01   -2.445538580859348e-01; +3.632867313455910e-01   +7.330340502851533e-01   -1.864296171458097e-01   +1.531503322424012e-01   +6.255728738576126e-01   +4.346239650597118e-01   +1.366548113990056e-01   +6.141189775420607e-02; +7.780160998442263e-01   +1.339461273767231e-01   +1.934245184214881e-01   +1.198548079672774e-01   +3.750966259144811e-01   +2.829775563932647e-02   +1.007377569653156e-01   +5.112137251255184e-02; +4.100868492859733e-01   +1.420495986352424e-01   +9.418499713676638e-01   +2.657132722254709e-01   +3.746951126886509e-01   +4.815032305184678e-01   +4.684818633111536e-01   -9.522289444675180e-03; +1.375078085625578e-01   -6.270071783191412e-02   +4.633360862271610e-01   +2.908769607009335e-01   +4.410717954963512e-01   +7.708043029592297e-02   +9.352533004640810e-02   -5.442764184933963e-02; +1.450644444301672e-01   -3.290571610883458e-01   +2.122571104631207e-01   +1.426836592009643e-01   +8.344823102721179e-02   +4.452053781611452e-01   +2.447543698142006e-01   +7.287456643378328e-01; +5.573759125339692e-01   -4.810775056142882e-02   +4.097170197037112e-01   -7.641040696634289e-02   +2.060471601274989e-01   +7.322568493258941e-01   +4.945138317258060e-01   +3.636824690888855e-01; -6.336182391816361e-02   +4.217284940261743e-01   +2.124096294989345e-01   +2.676915330926571e-01   +2.460910520731109e-01   -1.110336047192977e-01   +7.908654785125646e-02   +7.627779959349154e-02; +3.125080533225950e-01   +1.000000000000000e+00   -6.929027777191730e-01   +4.369867162623453e-01   -1.278171931371176e-02   +2.838007102647127e-01   +2.555009737002705e-01   -3.779221076545473e-02; +1.366932020103707e-02   -7.251441213049574e-02   +8.131377559301262e-02   +1.984642349719399e-01   +6.371528362994274e-01   -1.700342210787153e-01   -3.033564405828693e-02   +4.582485380126536e-01; +1.221857472378148e-01   +2.694860147811193e-02   +3.316494737823905e-01   +9.865309565423835e-02   +8.386374943468454e-02   -3.170341924005817e-02   +2.417401412550192e-01   +7.120508998031279e-02; +4.038032823151337e-01   +3.574823959882164e-01   +3.049208045943919e-01   +1.824622204292767e-01   -8.932095755767573e-02   +2.631427361054882e-01   +5.779114211217775e-01   +6.360274464669021e-01; +4.196238625207955e-01   +3.545824957602449e-01   +4.242807736439643e-01   +5.540456268815105e-02   +3.185353080196940e-01   +9.893145534535358e-02   -4.571043856539787e-02   +2.530508206829128e-01; +1.817599025123125e-01   -2.237824118739871e-01   +1.266133201892927e-01   -3.906424997002435e-01   +3.250420587868406e-01   -1.730258344099182e-01   +4.830559732893426e-01   +2.118148407461636e-01; +2.423823597540409e-01   +3.411732606053231e-02   +3.400021042634802e-01   -4.781890068337544e-02   -1.970018880506816e-01   +9.666024619398830e-01   +4.301822984372274e-01   +6.762603725324322e-01; +7.731383853352974e-02   +1.481450521079969e-01   +1.058354329470774e-01   +4.536706081046270e-01   +2.044576839903019e-01   +1.125754557814655e-01   +8.917332691167697e-02   -6.269934418077326e-02];
L1I_L2I_iGABA_netcon = [+3.888776220238708e-01   -2.352520285356111e-01   -9.538486821599290e-02   +3.258906643620137e-01   +1.285527882576037e-01   +8.337646464082783e-02   -1.048318609115547e-01   +2.075373834197086e-01   -6.046710482171042e-02   +4.249338615778044e-01   -2.065372072292354e-01   +1.381317045129249e-01   +1.226511989174346e-01   -1.093350325303673e-03   -9.215151882410501e-02   +2.091911824853119e-01; +3.823402381348042e-01   -1.703745317769042e-01   +9.352364556593727e-02   -3.448411111351593e-01   -1.785286981467554e-03   +6.347822150200408e-02   +2.968493648487140e-01   +1.865098539525432e-01   +2.405405664610817e-01   +7.099658830338192e-01   +1.538019663988241e-01   -1.740346602435776e-01   -1.764021996636565e-01   -4.913740702953722e-01   +4.310579727022241e-01   +3.027190108609061e-01; +1.676059245099225e-01   -2.012002173998375e-01   +3.701802289225751e-01   -3.843757199483033e-02   +1.970025640757070e-01   -1.872076237047923e-01   +5.077678363546393e-01   +3.321388309274151e-01   -1.713367446101388e-01   -1.281120602694250e-01   -1.701191361934658e-01   +1.953549451848958e-01   +2.156648256024898e-01   +5.660887166095463e-01   +9.311146920095487e-01   +2.323679977760029e-01; +4.612669302161576e-01   +6.873612351445608e-01   +5.482615115388647e-01   +2.701738672534144e-01   +4.033720908789449e-01   +7.397948771652528e-01   +4.515373158626597e-01   +3.546495211946112e-01   +1.203284653829951e-02   +7.979658605543130e-01   +5.594552164863725e-01   +2.956237379288136e-01   +4.428417523508105e-01   +1.894050831564273e-01   +3.449714258275590e-01   +1.968490186067113e-01; -3.556364939232438e-01   +2.503567347686804e-01   +1.412754065067273e-03   +5.091199990283798e-01   -1.803559386583184e-02   +6.608572897757078e-01   +5.131202334069168e-01   +4.879575757620929e-01   +4.414434727933742e-01   +3.480825038625189e-01   -2.948549075493441e-01   +5.084657041630519e-02   -5.391800203302315e-01   +2.699129199824211e-02   +2.356202881568690e-01   +4.316074934814318e-01; +3.162551247807840e-01   +2.931404969532585e-01   -2.213966839887295e-01   +4.527160948145612e-01   -3.414843839509296e-02   +1.483334335607354e-01   +2.904019426352731e-01   -1.435547447334490e-01   +2.539240933340053e-03   +5.065027886558479e-02   +1.695441594677624e-01   -9.195487929244409e-02   +5.603971404931534e-01   +9.075210435955182e-01   +2.481516846894534e-01   +5.589112528305214e-02; +1.779441077142661e-01   +2.706648397968048e-01   -4.788821703248096e-01   +2.957233955053651e-01   +4.689305136429186e-01   -3.652589052075565e-01   +1.890787305015149e-01   -1.415266048694225e-01   -2.019833249313666e-01   -1.127039950036540e-01   +3.061226269780868e-01   +3.527320945652551e-01   -4.752189027528007e-02   +2.872553324352013e-02   +4.034230167643635e-03   +1.987399931446130e-01; +4.297300714497378e-01   +8.517098494214126e-02   -2.334164897674280e-01   +1.077033877909690e-01   +2.888443325346716e-01   +4.138878124307721e-01   +2.873660109540355e-02   +1.564325497897467e-01   -7.428692443814167e-03   +2.154580846132233e-01   +2.613884678765537e-01   +7.230405342453965e-01   +1.050137418800154e-01   -1.193057215147654e-01   +4.029806508452969e-01   +3.492315766116786e-01];
L2E_L1E_iAMPA_netcon = [+5.410432204757591e-01   -1.686436258596335e-01   +6.403092357713894e-02   +3.659594742633046e-01   +8.921410105965046e-01   +5.376757704963756e-01   +5.046639537061466e-01   +2.870787127065889e-01; -1.665441447246197e-01   +2.934706073553039e-01   -1.293257231455546e-02   -8.713508568194264e-02   +3.382188992041255e-01   +4.228700937399986e-01   +4.366446452668763e-01   +2.996060908377147e-01; +3.011424476307398e-01   +4.393422277235567e-01   +1.193335409781599e-01   +5.238347060888470e-02   -1.063527682784077e-01   -2.082857351421508e-01   -1.315935184164180e-03   +3.144626231409300e-01; +5.993872885772505e-01   +2.500134551728470e-02   -3.595297677988369e-01   +4.280961210901485e-01   -9.207513376273993e-03   +3.073474714533819e-01   -4.009562531710207e-01   -4.826095454688549e-02; -7.109653003773397e-03   -1.047235945635711e-01   +5.663913942876809e-01   -3.072137312359040e-01   -2.063514913471379e-01   -5.399808687095635e-02   +5.641163687687196e-02   +2.815919211479546e-01; +3.834968507687302e-01   -3.235507716510418e-01   +8.685464645445362e-02   +1.477856386231466e-01   +1.869598263134445e-01   +7.303634416609713e-01   +3.755025586290912e-01   +4.154495562981906e-01; -4.686393626728068e-02   +5.153778094517283e-01   +2.180849124702808e-01   -9.253151823353689e-02   -1.256257902955911e-01   +3.399981287326712e-01   +6.025026643758060e-01   -3.446785782238022e-01; +2.119880192859443e-01   +4.265249961622632e-01   +1.000000000000000e+00   +2.638096233586448e-01   -1.131203598631949e-01   +3.141453866660139e-01   +3.770928899132988e-01   +2.312748032089055e-01; +4.301325209377224e-01   -1.333359099008492e-01   +3.421172232864442e-01   +6.004665958352617e-01   -3.159080161037292e-01   +6.969082045774848e-01   +5.464446560512167e-01   -1.308577585495726e-01; -6.802859021569439e-02   +2.435654274645631e-01   +3.108147343302922e-01   +1.038008988225483e-01   +1.479739665070862e-01   -1.096116817225494e-01   -9.137646009430195e-02   +2.113585478303522e-01; -9.294601490893087e-02   +6.889638070290187e-01   +7.469434110117683e-01   -1.763667199873002e-01   -9.676563622959096e-02   -9.911724878149797e-02   +1.163945157150245e-01   +2.689882024768025e-01; -9.961479083245154e-04   -2.772901830251890e-02   +4.985681988123037e-01   +5.570162533998160e-02   -2.629762724538307e-01   +1.562249758320706e-01   -2.449298475446646e-01   -1.567856906383173e-01; -1.153226684438626e-01   +3.008748724041436e-01   +1.929408577499362e-01   -2.740957312510928e-01   +7.228992864775600e-01   -3.459561123797465e-01   +4.028041100693389e-01   -1.958237765226998e-01; -1.376374964152950e-03   +7.548981280646104e-01   -3.571713023782081e-01   +1.271497308460436e-01   +4.012927430546548e-01   +3.596011394672545e-01   -2.041544668755577e-01   +1.528871679821871e-01; +1.391242975395068e-01   +2.584990333584180e-02   -8.506732767063006e-02   +2.348538003563468e-01   +2.253009868078782e-01   -1.831880404874719e-01   -2.042937601591810e-01   +2.891444335354214e-02; +1.587874800198572e-01   -1.391257512778256e-01   -4.426289227566617e-01   -4.935251305822758e-02   +3.362947217256860e-01   +4.352758267446612e-01   +4.690008224307970e-01   +5.563955224347488e-02];
L1E_L2E_iAMPA_netcon = [+3.192280783792276e-01   +3.589946970263416e-01   +2.215701792589524e-01   -2.624240823448923e-01   +3.112088186367505e-01   +1.754811861391718e-01   +1.666532597037252e-01   +1.032498572888956e-01   -1.008055619588154e-01   -1.312049906127209e-01   +4.395065863252749e-01   +1.888534086241354e-02   +2.024612709510699e-01   -7.015422360938850e-02   -3.855931700956706e-01   -1.095934971012880e-01; +1.881499085491947e-01   -2.423179957134264e-01   +5.466324285156978e-01   -6.154600153376334e-02   +1.153166969010508e-01   +2.852530399221946e-01   +4.493605634071101e-01   +1.230654568222002e-01   -1.379745294356379e-01   +4.381166505201119e-02   +3.450663219187736e-01   +5.419150425559893e-01   +4.243203154277601e-01   +2.250973837630068e-01   +6.184802174762571e-02   -2.486505349151678e-01; +7.570071470880821e-01   +1.861083906739045e-01   +1.431518345333268e-02   +3.713934449827242e-02   +1.543078189105642e-01   +3.067417148637724e-01   +6.244014998145133e-03   +3.333341065235673e-01   -4.006635220023674e-02   -3.575923453788523e-01   +5.943592622124261e-02   +5.591786233267555e-01   -9.848916888023515e-02   +3.562523978280813e-01   -1.950203003661986e-01   +2.778359571204089e-02; +9.459188783609168e-02   +3.128235970765722e-02   -2.614327361781389e-02   +1.617430318917367e-01   +2.438193802402444e-02   +5.752316456016212e-01   +1.000000000000000e+00   -1.612346566941122e-01   -1.260470640476297e-01   +3.947338943678902e-01   +3.570854300763088e-01   -3.741661313772346e-01   -2.971658482657423e-01   +7.502107105451945e-01   +3.102829783170146e-01   -2.026680216591173e-01; -7.570985589694400e-02   -4.451746929574824e-01   +1.693042051463124e-01   +4.557041278148344e-02   +2.199945581529419e-01   +1.287887685329618e-01   +3.082390109172379e-01   +2.062791223308299e-01   +3.808389815495618e-01   -2.848013817660020e-02   +4.202554579783625e-02   -4.206336956215975e-01   +1.665854770743638e-01   +1.494895557208001e-01   +4.132506422584570e-01   -2.099457255335374e-01; +1.896485381051294e-01   +4.972756854348807e-01   +1.061737868556520e-01   +5.392634739731205e-01   -3.860893595539637e-02   -5.716981678347473e-02   +8.597605893327094e-01   -1.081283530585875e-01   +2.888396996340900e-01   -1.141040929682993e-01   +2.809509610670102e-01   -4.705741375668680e-02   -2.603743256727301e-01   -3.302147781085882e-02   -2.256278838535474e-01   +4.438339165495375e-01; +1.176711447576497e-01   +2.918008519373984e-01   +6.037630368027444e-02   +2.224398898897965e-01   +2.783163898668131e-01   +1.906559840201278e-01   +2.237513542375311e-01   -3.507576561089617e-01   -2.886459744196495e-01   +1.202831205886030e-01   -2.379767673561231e-02   -3.462288742696253e-02   -2.154048486635815e-01   +5.733619890176181e-01   +5.476263478445783e-01   +2.417190422270684e-01; +3.940696149268105e-01   +3.561494981956739e-01   +4.533347871467849e-01   +5.332191118129521e-01   +2.082275013126093e-01   +5.522745214454431e-01   +4.009645789790772e-01   +1.000645686886012e-01   +3.996386242123610e-01   -1.786273207204273e-02   -1.656058461614567e-01   -6.884130133951556e-02   -5.568435826585341e-01   +2.190740249306501e-01   +3.138299318326468e-01   +3.252299037156643e-01];
L2I_L2E_iAMPA_netcon = [+1.642780055798919e-01   +6.003144012833980e-01   +2.477169834898491e-01   +2.559986681453338e-02   +4.493296413076832e-02   +4.692244203857166e-01   +1.093765326262945e-01   +5.837126829293123e-01; +6.873304660848329e-01   +1.568427679052835e-01   +5.482129580998735e-01   +6.830599594612164e-01   +3.673814659723126e-01   +2.627859878638202e-02   +1.508245498211264e-01   +1.061956070646505e-01; -1.019615398390681e-01   +2.204710978685355e-01   -2.408141231640309e-01   +1.465422243326067e-01   +4.773441415914112e-02   -5.829330022808969e-02   +1.802461581223503e-01   +1.396737414423600e-01; +2.466713639502535e-01   +1.871638832840379e-01   -4.206345594744800e-01   +1.815151640297387e-01   +5.707180067615638e-01   -1.996748235589219e-01   +4.124513693113935e-01   +2.178883016345236e-01; +4.322701384895442e-01   -1.176678377335355e-02   +1.705808852869833e-01   +4.990668729681887e-01   +6.669113431548981e-01   -1.963557338256773e-01   +3.581593861036795e-01   -5.799496391703179e-02; +5.048765154729199e-01   +2.575311395369125e-01   -2.195876088683114e-01   +6.332735625817946e-01   -1.526129269819500e-01   +1.666332980795885e-01   +2.503217096650607e-01   -5.129057975900490e-02; +5.091927864884496e-01   -5.574065250615351e-01   +3.207805928251588e-01   +4.176730991848218e-01   +1.464952732469016e-01   -2.850870961651850e-01   +8.195683471835244e-01   -2.645150893630683e-01; +3.437266010197875e-01   -1.053182087997820e-01   -6.111388031419813e-01   +3.693678526856724e-01   +1.256996792897186e-01   -2.222151701255449e-01   -4.691649859458372e-02   +6.654384143421039e-01];
L2E_L2I_iGABA_netcon = [+1.291053274099114e-01   +4.040548427707009e-01   +2.270608062121298e-01   -5.300638360272784e-01   -2.115240390670878e-01   -1.135319981596756e-03   -2.059492782811523e-01   +6.307931466160743e-01; +2.448496354293306e-01   +2.259060092421812e-01   +1.785859371846369e-01   +9.617196939681636e-01   +7.274411989588743e-01   +2.041468052446835e-01   -5.165243962189080e-01   +2.743239365000845e-01; +3.399599328102001e-01   +7.406986843853771e-01   -4.401149446568382e-01   -3.353207051570221e-01   +2.161915973858314e-01   +8.273905793469016e-01   +3.481384930122378e-01   +6.160906565501766e-02; +1.440214000354953e-01   +6.691712342446012e-01   -8.975576460962237e-02   +6.140704883892141e-01   +8.943788230487649e-01   -4.170839387849423e-01   -2.429458249446722e-01   -4.517782076921251e-02; -1.545076613482099e-01   -2.520398067161812e-01   -1.095491722846409e-01   +3.151217152230930e-01   +8.315266079432350e-01   +5.098231750874083e-01   +5.944428188664795e-02   +6.762069749589224e-02; +8.742905697023909e-01   +6.264783492811837e-01   +4.009517657032736e-01   +6.008953430596348e-01   +5.387798039685329e-01   -4.620493586418004e-01   +4.084925094679984e-01   -3.549449685805257e-01; +3.388392789533355e-01   +7.261607785942321e-02   -3.595715229326981e-01   -1.078772184817392e-02   +2.221937701137672e-01   -4.798037857346207e-01   +3.298367182189609e-02   +7.955836409083931e-01; +1.053375342219073e-01   +4.299796247474625e-01   +4.967613280211632e-01   +1.993109692019810e-01   +2.823838757533438e-01   +4.691084894863689e-01   +4.083167764223495e-01   +6.761332959680343e-01];
L3E_L2E_iAMPA_netcon = [+5.637510904568198e-01   -1.696551329704438e-01   -2.484645279468398e-01   +1.647983241928968e-01   +4.891840375695882e-01   +5.058158501751608e-01   -2.387914127107027e-01   +5.776919541929646e-01   +3.040736585138803e-01   +2.537779172675625e-01   +1.698271352792781e-01   -5.397076439130380e-01; +2.411832961961178e-02   +3.020385622991307e-01   +2.385313205558183e-01   -1.163115410546030e-01   -8.284839556774043e-02   -9.426035185343483e-02   -3.431129880381010e-01   +8.845749156975792e-02   +2.559652883856015e-01   +2.240707705640151e-01   -2.420517691468125e-01   +6.504748337560365e-01; -4.134137559412313e-01   -3.759194532888757e-01   +4.155889082688402e-01   +3.913301088161196e-01   +2.289814890480427e-01   -2.054502537426589e-02   +1.911281382019620e-01   +2.450719980504474e-01   +6.823698749042740e-01   -4.458982916432375e-01   +9.239650257840137e-01   +3.895475604551577e-01; +3.237811907620278e-01   +2.303418067125202e-01   +1.907559137053514e-01   +8.833550043801215e-02   +3.187227639731868e-01   +1.894885281000813e-01   +7.263752111884132e-03   +6.371433373718315e-01   +1.134771946238336e-01   -2.551783292310964e-01   -1.780297965744984e-01   +5.132593768684750e-01; +1.587546736915142e-01   +4.409616126478291e-01   +3.558106373281001e-01   +5.090756042788338e-01   +4.643800151403792e-01   +5.262770397781285e-01   -1.054834019720301e-01   +1.393567849524715e-01   -1.055612201331854e-01   +4.583693865993747e-01   +2.862574716583347e-01   +4.925790292818620e-01; +4.527145527505267e-01   -1.775028957395907e-01   +1.411580728172581e-01   +4.989642948203880e-02   +4.696000651226276e-01   +5.590738927934412e-01   -4.837608770445155e-01   -2.725594273802345e-01   +1.921328274449562e-01   +3.571015890931384e-01   -1.798669484489572e-01   -3.217490969432696e-01; +2.705940315262824e-01   +1.263302296061403e-01   +2.468283614704935e-01   -1.457072130724922e-02   +1.903722335084563e-01   +2.696796090378278e-01   +2.799441441795120e-02   +2.692247145195986e-01   +1.156397373810606e-01   +4.300361871389379e-01   -1.499604330074058e-01   +3.818177988284359e-01; -3.395441610271047e-03   +6.583993103570370e-01   +1.602276960605627e-01   -7.021696764122345e-01   +5.541976970146989e-01   -2.670510938488411e-01   -5.103946902605508e-01   -2.974621938654904e-01   +2.391565016983183e-01   +1.583479283878406e-01   +1.381069685979200e-01   -2.034130076194287e-02];
L3I_L2I_iGABA_netcon = [+9.330467519978823e-01   +5.560984302199491e-01   -8.486927740111856e-02   +4.319455701428229e-01   -4.264664811576784e-01   -6.406323988677362e-02   +9.116203874013231e-01   +5.872449509977372e-01   +5.747467773324947e-01   +7.042783503223120e-02   +6.682348857368912e-02   +7.139900665261492e-02; +3.582702829217630e-02   +9.607743309639345e-02   +7.720707295756166e-02   -3.661713717431170e-01   +5.945095428536502e-01   +7.963576435952191e-02   +1.953075212705441e-02   +1.033646424885158e-01   +3.163111141430022e-02   -9.912885512685916e-02   +5.220869582630495e-02   -3.342081526555898e-02; +7.102335668948370e-02   +1.908761665561994e-01   +9.323331155532003e-02   -2.509336816771279e-01   -7.869726444411165e-02   +3.125524459703576e-01   +2.898751567631472e-01   +1.038324346738232e-01   +3.034837130090716e-01   -9.301714247331044e-02   +4.956602106213694e-02   +9.390733787296500e-01; +4.464658474226378e-01   +1.095197603201171e-01   +8.127425970321214e-01   +1.998911278355624e-02   +2.003356207702320e-01   -1.337278044275476e-01   +2.809419948081725e-01   -3.332357545088099e-02   +3.963307642305062e-01   +5.900217606292634e-01   +5.305128241259562e-01   -1.856628490570202e-01; +4.487941977521150e-01   +3.056731571437721e-01   +7.358189815281987e-02   -8.236208383858208e-02   +3.763554379456635e-01   +6.770706510998118e-01   +3.504681192380350e-02   +6.595674339633810e-01   +6.069041520491147e-01   +1.956218491558969e-01   +3.115679770936016e-01   +1.122934075075552e-01; -2.103890792110472e-03   +5.044440192322273e-01   +6.858826910392175e-01   -2.704064684120031e-02   +2.429103332406382e-01   +2.589401355597276e-01   +1.099667000371680e-01   -2.964662491334998e-01   +3.429494103958876e-01   +3.637842933506609e-01   -4.677113519810057e-01   +3.994941393035356e-02; +3.969849608558187e-01   +3.638927623549694e-02   +5.103315024552996e-01   +2.000733757862157e-01   +6.330625262171029e-01   +8.134883077215694e-01   +4.737225132965643e-01   +1.441544481521188e-01   -6.550339068898149e-01   +5.114139711346204e-01   +6.961217314799002e-02   -3.327995395916993e-01; -1.652853592878589e-02   -3.101592370475317e-02   +5.889168864963452e-01   +8.357525726670492e-02   -2.508922214409942e-02   +4.570105170499167e-01   +5.760591410469380e-01   +5.606810253601462e-01   +5.176369019688111e-01   +1.707688477479020e-01   +4.752684834355521e-02   +3.125712423193672e-01];
L2E_L3E_iAMPA_netcon = [+4.387067834687646e-01   +1.397494057270623e-01   +5.991275011680642e-01   -6.067649856210292e-01   +6.954434684781877e-02   +5.327596726887693e-01   +7.262085973774571e-01   +6.210306406530919e-01; +7.870412109927089e-02   -9.136468099091967e-02   -2.812283552153991e-02   +4.407007614558634e-01   +5.531725764827877e-01   -2.162769800729536e-01   -5.271395462259502e-01   -5.816225619467043e-01; -1.436276320724995e-01   -3.759064976259673e-02   +1.598704180364299e-01   +1.563940476405669e-01   +2.592900724610073e-01   +9.404426257474149e-02   +2.326080318777202e-01   +1.825677309119350e-02; +3.156450377933159e-01   +4.625263646231327e-01   +8.330728862209900e-01   +9.405970485855377e-01   +5.984611751609833e-02   +6.164789816357588e-01   -1.706645080448262e-01   -5.698704330260054e-01; -3.954993708417475e-02   +2.267438924267712e-01   +2.112564216371067e-01   +5.867592120111003e-01   +1.259413782723586e-02   +1.306000256897872e-01   +8.558354201640028e-03   -3.116566490773310e-01; +1.539364221325552e-01   +3.291844742452480e-01   +5.777708726171772e-01   +6.573505695044825e-01   +2.536476903291641e-01   +2.153470849413947e-01   -1.837344072008641e-01   +3.257477790310570e-01; +2.809973086681264e-01   +8.850563362495689e-01   +4.696710266620197e-01   -2.795041584605127e-01   +2.981221454535961e-01   +1.021960642903523e-01   +2.609024080950751e-01   -8.367522635494842e-02; +2.545837917548520e-01   +3.470682042803277e-01   +6.759534970249617e-02   +3.875957026499857e-01   -2.220838867540230e-01   +2.541454353712812e-02   -1.464874606149476e-02   +5.279367933108609e-01; +9.862529590676486e-02   +4.577947022409125e-01   +5.952264789884842e-01   +5.815330243907793e-01   -3.746114829230247e-02   -1.149155762098620e-01   +6.764214401876351e-01   -3.817305133322671e-01; -9.686989855265762e-02   +3.654796988594568e-02   +2.501971662774991e-01   +6.875279442268095e-02   +1.723455279646675e-01   -3.194288914472627e-01   +2.970022964789755e-01   -6.295453693460273e-02; +3.958578914112937e-01   +4.038772323886112e-01   -1.501939272585256e-01   +7.486856352823206e-01   +1.617287018116030e-01   +7.316499430398040e-01   -4.499144488303422e-01   +2.461976252901952e-01; -2.741175353590275e-01   +5.369192187253843e-01   +4.556084167927096e-01   +2.380602782082614e-01   +9.252188747334984e-02   +6.788087366758291e-02   -3.797344162836580e-02   +2.628001372900049e-01];
L2I_L3I_iGABA_netcon = [-1.861671194629651e-01   +5.731448039798339e-02   +2.813051039787800e-01   +2.111649312465695e-01   +4.146048520707277e-01   +8.134170983907496e-01   +4.160997623826789e-01   +1.724582297517899e-02; -3.068506241933902e-01   +2.504203970563557e-01   +1.020394637507177e-01   +1.762950924062031e-02   -2.858142281212093e-02   -3.921821047819087e-01   +4.862718199392999e-01   +1.573921434756390e-02; +2.065759053643606e-01   +9.142867018979334e-01   -9.457562798475252e-02   +4.545948345154504e-01   +1.219066094981690e-01   +7.216025367705405e-01   -1.301129508430014e-01   +5.122166222478335e-02; -1.910714961113265e-01   -3.173586343694042e-02   +9.397404247740577e-01   -1.422242335381129e-01   +9.075416585270966e-02   +5.408139183574516e-01   +4.848682295712272e-01   +1.762788922203095e-01; +1.781002152069180e-01   +3.254730395447583e-01   +4.982520020360904e-01   +3.987312685155816e-01   +1.248574156668683e-01   +2.291807344845627e-01   +2.364010996267241e-01   -7.285421335138186e-02; +1.334418378521589e-01   +5.355223779868313e-01   +3.521560339676547e-01   +1.559333913551262e-01   +4.492733165453168e-01   +5.220027949307787e-01   -2.049425423898183e-01   +5.917403483199259e-02; +1.839315248352123e-02   +6.485535502389042e-01   +2.029387037522398e-01   +2.802616312990077e-01   -1.673821765975639e-01   +2.343023504100045e-01   +1.000000000000000e+00   +4.226345662042649e-01; -2.827355975811851e-01   +3.414869906420760e-01   +3.494503263365400e-01   +1.690746632761738e-03   +7.525596406985652e-02   +5.670580081112883e-01   +1.801092102911735e-01   +4.533185082227639e-01; -3.268757662664862e-01   +5.637630525871526e-01   +7.845533851388264e-01   -6.730881977576383e-02   +1.509800105794556e-01   +3.752797515016844e-02   +2.903703948156338e-01   +2.205492690179479e-01; -5.839859328829409e-03   -1.107099835116965e-01   +1.092591974716483e-01   -7.408024198034902e-02   +2.804867905848883e-01   +4.683477405641366e-01   +1.712178434399182e-01   +4.915171068983259e-02; +5.356323253610261e-01   +1.624269894606370e-01   -3.871803677174517e-01   +2.975561231662847e-01   +1.251550245809259e-01   -3.104996757347781e-01   +2.182980531136602e-01   +5.290425752523931e-01; -3.335550827987828e-01   +4.568579073078871e-01   -1.978661712643720e-01   +4.905538937906370e-01   +3.403383644955322e-01   +3.381006643525707e-01   +6.326986643192332e-02   -4.215501963385592e-01];
L3I_L3E_iAMPA_netcon = [-6.096097331507841e-02   -2.755406968605147e-01   +4.473643918190031e-01   +2.968625347261581e-01   -9.253776744158040e-02   -9.661722141843072e-02   +1.375629227242011e-01   +5.925117218136942e-01   +4.447514955942359e-01   +5.878463789274821e-01   -5.120548787715531e-03   +4.692177259432690e-01; +3.462893113145495e-01   -1.034724399429695e-01   +3.526936664208273e-01   +7.214072395769511e-01   +4.929129443391062e-01   -9.542260480221619e-02   +3.354971181285153e-01   +5.845038381735655e-01   +4.732914061359263e-01   +4.767935709208102e-01   -2.574182655547355e-01   -2.959948712357633e-01; +2.648484607065016e-01   +6.231557605639231e-01   +1.377291147392353e-01   -1.495533123743439e-02   +9.824145462214836e-01   +4.510662617088069e-01   +3.627804412954058e-01   -3.553405497673866e-02   +2.881294961175003e-01   +2.968084053871989e-01   -1.073677768688975e-01   +7.006520901374269e-02; +2.096050793636138e-01   +3.028062504532052e-01   +3.783750823005104e-01   -1.223612081967144e-01   -7.627872682995669e-02   +3.152923873920789e-01   +2.246310944183846e-02   +2.536614340518411e-01   +2.947912391591421e-02   +2.282910078185175e-01   -1.671034787852229e-01   +1.174622741868907e-01; +1.278276418149577e-01   +3.389971697371784e-01   +8.388742396651248e-01   +4.648922615078492e-01   -8.085151036809360e-02   -1.356684375073612e-02   -3.499729804710749e-02   +4.747296378825454e-01   +3.378970603037443e-01   +1.684304968266361e-01   +2.789256788265256e-01   +1.293848666108717e-01; +1.108136933521295e-01   -1.384893081181242e-01   -3.009752016305124e-02   +5.304580972465234e-02   -1.130957593322873e-02   -1.667595394794340e-01   +4.194071243385286e-01   -5.374523217592866e-02   +3.333452626681241e-01   +1.286078634064828e-01   +2.106044471296513e-02   +8.224108030802730e-01; +1.981193348400426e-01   -9.653128433631232e-02   -4.314219896596603e-01   -1.316503818401044e-01   +9.273370429940503e-02   +2.813993674664268e-02   +5.036697964950052e-01   +1.071961139439949e-03   +1.785740530990032e-01   -1.418833404568456e-01   +2.920665535565217e-01   -8.776745996815027e-02; +7.024587682090792e-04   +1.673148622767464e-01   -3.115771200453584e-01   -5.037363609329349e-02   +5.602568015295171e-01   +4.440923894075987e-01   -1.727660855873919e-01   +4.922204947110681e-02   -4.803998636615988e-01   -2.845331859919075e-01   +2.972600335630591e-02   +2.742967880140770e-01; -3.551102239201638e-01   +6.312964963852314e-01   +1.430221292717542e-02   +4.988986254233430e-01   +1.713005720455660e-01   +3.511325465883191e-01   +4.731335113692859e-01   +3.938169555575307e-01   +1.419999515965162e-01   +6.958142455796354e-02   +1.467650966341350e-01   +7.737054138049096e-01; +8.044657868209877e-01   -5.050885556303223e-01   +8.118093744651123e-01   +1.155449006460159e-01   -5.937117941870043e-02   -1.412388758046159e-01   +2.457401673517935e-01   +3.216743345630886e-01   -3.807681693540277e-02   -7.105060863970174e-02   +7.608492277232117e-01   -2.970109176493926e-01; -3.743892009657943e-01   +5.284948381312354e-01   +6.211847286446698e-01   +3.110054761681029e-01   +1.576334304436295e-01   +9.138745803989082e-02   +3.213163871118594e-01   +1.294487074525752e-01   +6.102610907073216e-01   +8.844257048442525e-02   -2.301745421442897e-01   +4.531106955192787e-01; +1.174726948012558e-01   +7.057623131738229e-02   +2.303637124640215e-01   +5.469314616134762e-01   -2.347123333497371e-01   -3.563964953541795e-01   -3.512322412232634e-01   +3.718316249805438e-01   +1.803184785046663e-01   -2.910338173734974e-01   +2.322056032492519e-01   -4.386072229000484e-02];
L3E_L3I_iGABA_netcon = [-7.278575563350557e-02   +8.185917484519267e-02   +8.177611059501311e-02   +3.984713414097273e-01   +1.793638549492112e-01   -1.100882138062506e-01   -2.519741497358562e-01   +9.351007806740901e-02   -3.428207739060508e-02   +6.742068040862612e-01   +2.380558067243605e-01   +7.879712800378369e-02; +2.556951862466794e-01   +1.794411385417902e-01   +4.126235643440077e-01   +2.536530230593635e-01   +6.993758904488152e-01   +1.333537118139251e-01   +1.464833540043145e-01   +8.841396871770997e-02   -5.754874288685147e-01   +9.998674486816456e-02   -7.260483583596906e-01   +5.898552668655070e-02; -2.054341809192507e-01   +2.032066158391469e-02   -3.259650344513249e-01   +3.244621168310322e-02   +1.775384466492496e-01   +8.706785526981371e-02   +3.540494656303095e-01   +7.998183899230039e-02   -1.235168318431059e-01   +1.946599614733433e-01   -1.426975389619617e-01   +1.297204340487126e-01; +2.863587935972150e-01   -2.120898456463379e-02   -4.696823634292617e-01   +7.537127294398291e-01   +8.005735536096985e-01   -1.143882198116771e-01   +4.142234010473955e-02   +8.745803847836889e-02   +6.684145373913942e-01   +5.856836417616152e-01   +3.404367644709367e-01   -2.733609444739781e-01; +1.594178726386456e-01   +2.122658085265686e-01   -1.799666164337892e-01   +1.165290503223956e-01   -5.647951801369443e-02   -6.392654725187127e-02   +2.406846622404374e-01   +4.752098667966731e-01   -3.047342091742736e-01   +5.379869617541834e-01   +3.584153282736376e-01   -7.329990502368863e-02; +3.226584580149531e-01   -5.034401539323879e-01   +1.529555476071227e-02   +9.207054710702763e-03   +7.685902014755408e-02   +8.164993978122101e-02   +2.233002577410406e-01   +4.761878171996107e-03   +4.128282496895305e-01   +2.481741125697398e-01   -1.348547238317772e-01   -1.185522806976558e-02; -8.385718240679388e-02   +2.662846435759814e-01   +6.791525468783925e-02   +8.313935005491592e-01   +3.956899116894956e-02   +2.514985179821630e-01   +4.824277263914892e-01   +5.379661265607919e-01   +1.562625015843764e-02   +2.734616301036979e-01   +3.958082815830833e-01   +2.764604359388663e-01; -7.595437099040052e-02   +4.663998826618790e-01   +4.202302229247427e-01   +2.010905940337174e-01   +1.615691431749820e-01   -3.975553991961254e-01   -5.460471789119883e-01   +5.009667649561049e-01   -1.775135375802194e-01   -1.070675300978061e-01   +3.558837136878107e-01   +4.067422007216188e-01; +5.298309746453650e-01   +6.710664038657861e-02   +3.208429091703918e-01   -1.470979507765333e-01   +3.216475046721689e-01   +2.032973781373903e-02   -6.781744928685272e-01   -1.381187220710232e-01   +4.527008024424818e-01   +2.375045895387107e-01   +2.002712758159214e-01   +3.003081900727710e-01; +1.608498694082794e-01   +7.737591013828810e-02   +3.803274256116182e-01   -9.606056556306307e-02   -6.003213870377893e-01   -9.263316008902803e-02   -2.862520483006724e-01   +1.565666763964880e-01   -1.427929919085471e-01   +6.915551819460757e-02   +1.101446498675743e-01   +2.968945652301884e-01; +1.075329778393520e-01   -2.439918953812444e-02   +1.420302570587915e-01   -1.523889540936864e-01   +7.088197426729322e-02   -9.568199329230047e-02   +3.713785193982099e-01   -2.152856977168544e-01   -3.159264533967730e-01   -9.751473300735630e-02   +3.756306898557128e-02   +3.531611059873486e-01; -8.046709264081200e-02   -3.087418764252880e-02   -4.830571945443621e-01   -2.452510269422330e-01   +8.647738641534677e-01   +3.818679644559873e-01   +2.832113071124607e-01   +2.424035758800219e-01   +1.975289194163141e-02   -4.611414386767107e-01   +3.477947343765449e-01   -3.901878946375972e-01];
L2E_Input1_iAMPA_netcon = [+8.474238750902754e-01   +8.986835629709100e-01   +5.330886033691269e-01   +4.971143120468576e-01   +5.690758207822207e-01   +4.781695217340045e-01   +8.920248537641098e-01   +6.039460447950881e-01];
L2I_Input2_iAMPA_netcon = [+5.534061920134833e-01   +5.349509820567230e-01   +5.786443452305862e-01   +1.788472377124200e-01   +6.739676683466070e-02   +8.934464673159228e-01   -3.399449571545556e-02   +1.306808438683357e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
