function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.130928354190990e-01   +9.496618464062175e-01   +6.988176553125018e-01   +1.648706248795899e-01   +9.175356317991055e-01   +2.156027001372878e-01   +7.417262799446486e-01   +3.068076853005832e-01   +5.403113204214347e-01   +8.399739675623513e-01   +9.721406878933251e-01   +9.715894992959874e-01   +7.002358406353043e-01   +3.662759030078978e-01   +2.974836208501070e-01   +3.827014731611838e-01; +3.492926509565907e-01   +7.280336086601211e-03   +1.385369089417358e-01   +1.696542502312638e-01   +7.698536510477204e-02   +8.118408650481841e-01   +7.957704302420242e-01   +7.596481692889886e-01   +7.907284965070922e-01   +1.910831134853041e-01   +4.716544322347914e-01   +6.651836002329974e-01   +3.696586954142006e-01   +2.778592177069663e-01   +6.895673468627905e-01   +9.644526525841544e-01; +2.030222730503769e-01   +4.759470703906613e-01   +8.466358940722382e-02   +7.064956492633763e-01   +3.173273348920362e-01   +3.809193070103867e-01   +6.580427566139662e-01   +9.556364602570044e-01   +4.968881816765910e-02   +9.245546384885395e-01   +8.702911526190604e-01   +2.006433851413471e-01   +5.480660486589850e-01   +7.373644439856138e-02   +7.830713508612384e-01   +8.092432012021495e-01; +2.730669108627458e-02   +4.866563765902233e-01   +4.270066845355032e-01   +8.355775480270841e-01   +6.337646768874140e-01   +8.572694871140308e-01   +4.383342352666399e-01   +4.619586447610020e-03   +4.622524974393227e-01   +4.198900111396280e-01   +9.420720198682592e-01   +9.021928175484096e-01   +5.127866932324860e-01   +1.600321723868143e-01   +7.139444382296397e-01   +8.919419572116397e-01; +7.691929028505926e-01   +5.138312579774272e-01   +9.001432154036282e-01   +8.233759218395548e-02   +9.049129368529070e-01   +3.224223268615534e-01   +5.798255251910537e-01   +4.005483667160888e-01   +9.372117067356770e-01   +3.045128097608047e-01   +2.423663268087651e-01   +4.812894763130255e-01   +7.686481693507865e-01   +3.631770838331200e-01   +2.723636623334227e-01   +6.588904818647044e-02; +5.720288260958545e-01   +2.898938372101086e-01   +7.169510745588302e-01   +8.331258251447834e-01   +8.007903761734555e-01   +3.798717685470929e-01   +5.113555799329107e-01   +1.584756494346754e-01   +4.810253513721119e-01   +3.540904984797963e-01   +9.203987142512206e-01   +6.682194594139864e-01   +7.673442703033960e-02   +7.144106822335389e-01   +2.033052621517144e-02   +9.008531904573079e-01; +5.774144563648798e-01   +5.591283739310425e-01   +6.847281608094894e-01   +5.516036654781019e-01   +6.472258858610880e-01   +6.445758872975332e-01   +7.291694737100768e-01   +8.311478313965414e-01   +7.800608530077188e-01   +9.755569030217716e-01   +6.352944820956770e-01   +5.294549597582816e-01   +7.163750017382990e-03   +5.421039356519862e-01   +1.395471845649921e-02   +6.736666525985981e-01; +3.906642672909474e-01   +5.193762872432323e-01   +2.039788555303620e-01   +9.654332173611633e-01   +4.461073832838387e-01   +3.931784587325069e-01   +2.240020055052670e-01   +2.868373241979682e-01   +1.115898329239468e-01   +5.374492410415226e-01   +2.882647984424710e-01   +7.049353588963574e-01   +4.015994549436868e-01   +2.319024253183176e-01   +9.286833613123947e-01   +3.457002982066215e-01; +5.530765308159291e-01   +6.739564673391250e-01   +5.270768859926563e-01   +6.714932608671728e-01   +7.481688497791312e-01   +7.197767626004074e-02   +1.000000000000000e+00   +9.827244368894987e-01   +5.205882152256563e-01   +7.964184525828595e-01   +8.490295282196159e-01   +7.123678090229388e-01   +6.607451922490905e-01   +4.649436182700766e-01   +9.332915768491895e-01   +8.403563583963778e-01; +1.863931580512148e-01   +6.193401385420805e-01   +8.220113580973701e-01   +3.386730824602323e-01   +8.303658066404166e-01   +1.390286171333151e-02   +6.201794478680412e-01   +6.234806215958942e-01   +6.376897281930237e-01   +8.030983292515590e-01   +1.646208218911113e-01   +2.992772790037587e-01   +3.737860096745571e-01   +7.180886224520922e-01   +3.716423783234593e-01   +1.951593208209270e-01; +1.157231352635276e-01   +5.680865543362794e-01   +1.816570221053357e-01   +2.123379968312553e-01   +3.477626588637707e-01   +8.772798601045144e-01   +9.934740277825929e-01   +7.430391408497917e-01   +5.783738174638331e-01   +1.372181639892252e-01   +8.264873977569139e-01   +1.092034282522893e-01   +3.962182524274118e-01   +5.199051697647424e-01   +1.040197782923395e-01   +8.473130895189642e-01; +5.318259819797783e-02   +5.078031285715413e-01   +5.142357403798340e-01   +5.699378860135570e-01   +1.518601625564253e-01   +1.635057809045960e-01   +4.926550587612667e-01   +8.850676474308198e-01   +8.408627920227236e-01   +4.544055959172396e-01   +2.202605754898894e-01   +3.319365278723727e-01   +1.377896785731793e-01   +5.127446523252656e-01   +7.205714130760132e-01   +4.286699589895490e-01; +9.366085133963339e-01   +6.710030910364564e-01   +3.557698231132470e-01   +4.286837748372119e-03   +5.032548624521148e-01   +9.174264210051948e-01   +5.314147965277236e-01   +3.355374950894245e-01   +1.160936464467682e-01   +4.519859655165138e-01   +2.762959822897359e-01   +4.621920131606588e-01   +3.399337540059134e-01   +3.961399361521194e-01   +4.554454042022862e-01   +5.547900180070953e-01; +7.437383607111191e-01   +6.362066249947571e-01   +6.537916263215177e-01   +5.940374194310564e-01   +4.099416113756329e-01   +5.631160005063288e-01   +8.598585735657182e-01   +9.309216121991384e-02   +5.211764284256555e-02   +9.612666654911739e-01   +9.246261072749459e-02   +7.170914773035152e-01   +1.217208807840651e-01   +4.786091718276018e-01   +1.255597454810901e-02   +4.448352150418607e-01; +2.359050352618182e-01   +1.441135845770537e-01   +2.819415459815822e-01   +8.950979756329198e-01   +1.745285830301142e-01   +9.255708509189531e-01   +2.527781780557506e-01   +4.477145110488571e-01   +5.175829384978533e-01   +5.139228603466993e-02   +9.164565238625734e-01   +4.007864417627400e-01   +3.683323019633236e-01   +7.435972768319251e-01   +1.178759077448837e-01   +7.630886548244614e-01; +2.040389604940653e-01   +1.832430935451140e-01   +4.351740358530124e-01   +2.572685928250083e-01   +4.952070877715162e-01   +5.976607450266866e-01   +5.761598582322707e-01   +2.394748899743460e-01   +7.023953943619843e-01   +3.893714201038127e-02   +7.302805835348175e-01   +2.419647101290411e-01   +2.474345272337857e-01   +7.031528111270922e-01   +6.629525926334650e-01   +9.451859671872831e-02];
L1E_L1I_iGABA_netcon = [+8.419832303504540e-01   +7.535399560763452e-01   +8.689225204930541e-01   +4.355273227025284e-01   +9.192241555535192e-01   +7.715384451861441e-01   +3.237308734450152e-01   +6.429532775377452e-01   +9.565831393899252e-02   +2.929018443625952e-02   +1.275549989031812e-01   +5.171339499970267e-01   +8.815763708711113e-01   +5.743814594280003e-01   +1.736725709863187e-01   +6.401057888368498e-01; +6.211665161630912e-01   +9.936437297369350e-01   +3.130507381926242e-01   +1.400944376028962e-01   +8.942065686026912e-01   +2.778458808430023e-01   +9.679275873936971e-01   +4.412925661683470e-01   +2.979831276337365e-01   +5.111932133954135e-01   +4.359050932979965e-01   +2.064027747334296e-01   +8.043139507662511e-01   +2.918975495523048e-01   +5.482753785851736e-02   +3.407568358067069e-01; +6.666763384826752e-01   +3.729280753959796e-01   +4.304106344497062e-01   +6.526521270246837e-01   +5.882838860246157e-01   +5.223299877643217e-01   +3.521878390317715e-01   +4.814451689872675e-01   +3.306350351502076e-01   +8.662904007442929e-01   +4.823101091931289e-01   +7.754377335067639e-01   +6.498823628718529e-01   +1.444312603378836e-01   +2.219514281375308e-01   +1.525705350007858e-01; +7.840176290557709e-01   +5.093830490567537e-01   +3.806916136615924e-01   +7.294368505983065e-01   +8.360227380386356e-01   +4.135665406053503e-01   +3.198770522792077e-01   +9.843265201817700e-02   +4.780259380746860e-01   +5.774028540567188e-01   +6.779928388564000e-01   +3.886525159327801e-01   +7.345856326266887e-01   +4.496931468390893e-02   +2.023422032859787e-01   +4.012247864896334e-01; +3.176890774000224e-01   +7.598594075715750e-01   +6.578837603439763e-01   +1.741544684133685e-01   +7.816303299165025e-01   +7.856298413892120e-01   +9.164308471892944e-01   +8.062076992532426e-01   +2.416104492531505e-01   +4.252775874675481e-01   +3.517720718219932e-01   +6.873934489995565e-02   +6.658398882432702e-01   +6.208589548868854e-01   +2.112889831743468e-01   +9.159978815504565e-01; +3.222088388660385e-01   +1.377675787204297e-01   +2.442565901105960e-01   +3.399664779801106e-01   +7.917616921831638e-01   +2.575303652197409e-02   +8.854936291754087e-01   +6.185561599134284e-02   +4.567007170035852e-01   +7.240404153870076e-01   +4.693019385185427e-02   +7.509275878743678e-01   +8.883123239178230e-01   +6.087156305778231e-01   +5.815256665145511e-01   +1.547024160920502e-01; +6.279771030874416e-01   +5.201789110095593e-01   +6.893229985225617e-01   +1.032870422651886e-01   +6.964518120191912e-01   +4.068366511428105e-01   +3.603074172016617e-01   +9.543226869031334e-01   +7.565190093433970e-01   +2.282902895429940e-01   +2.937803266223016e-01   +4.590180670684906e-01   +8.545268971547547e-01   +3.744791356803291e-01   +3.569870436411555e-02   +4.658905507370487e-01; +9.012619139846741e-01   +9.118604541414917e-01   +3.283974847955255e-01   +4.591511115922126e-02   +1.668140014051872e-02   +8.310421557224192e-01   +7.418350806336740e-01   +7.774516862214987e-01   +7.148012259552234e-01   +5.702239543303281e-02   +8.047913257339412e-01   +3.116093067259752e-01   +4.105970158302410e-01   +8.345712972733617e-01   +7.971558017653249e-01   +8.204439733076625e-02; +3.715384392927352e-01   +1.008732598328212e-01   +8.773477627997773e-01   +4.745322844748389e-01   +3.278663322897703e-01   +5.919641618495085e-01   +1.215186273730669e-01   +4.468451465961636e-01   +2.326927467123704e-01   +9.772058879401764e-01   +6.499262321826388e-01   +2.725186745992262e-01   +1.143567509273473e-01   +5.180173530747867e-01   +1.400950632927317e-01   +3.362409503256089e-01; +8.899414598842500e-01   +1.843071604590965e-01   +1.000000000000000e+00   +4.742858974238467e-01   +9.509006498361582e-01   +2.118584424007360e-01   +5.950872705204338e-01   +1.662262044098510e-01   +6.981585123116338e-01   +9.748116378643947e-01   +7.122974371531843e-01   +5.776674194916698e-01   +4.114204646022643e-01   +8.150330369663757e-01   +5.768774943652414e-01   +4.880748143061807e-01; +1.128368123961252e-01   +1.766932054243747e-01   +6.873191127418909e-01   +5.505520453678362e-01   +4.084989579603361e-01   +2.928739569489435e-01   +4.367251787852776e-01   +7.804442890554761e-02   +3.031204644020712e-01   +1.289626921305407e-01   +7.594358295355492e-01   +9.145289354495352e-01   +3.325737351288624e-01   +5.828637629424612e-01   +8.210053941871569e-02   +5.018670271568221e-01; +9.369701674229867e-02   +5.343086773656667e-01   +3.495925084975056e-01   +6.431015908281882e-01   +6.257162815720936e-01   +2.707916351081471e-01   +9.682364442764491e-01   +7.453806149695346e-01   +4.693146838904491e-01   +2.588780617903892e-03   +3.895906860895245e-01   +4.504540726429043e-01   +1.055788425074446e-01   +7.124285459079777e-01   +2.287573857207928e-01   +1.304988688171175e-01; +5.422982957734008e-01   +9.776439561721508e-01   +5.580611567197221e-01   +3.483948494768749e-01   +8.530549341360089e-01   +9.393183435747376e-01   +9.770237056585214e-01   +5.359302881027211e-01   +4.356691642799322e-01   +9.348789822200612e-01   +3.646675599946979e-01   +9.818668365190204e-01   +8.630911553825625e-01   +7.322407364085677e-01   +4.400071300151424e-01   +7.622691729164741e-02; +6.012636435393480e-01   +8.422508102993179e-01   +8.936962766914721e-01   +2.554303363111996e-01   +3.704742269211488e-01   +5.579967940018606e-01   +2.474707805395391e-01   +4.860680554810705e-01   +7.312795075417396e-01   +7.401828292523466e-01   +8.121426596400012e-01   +1.043726457692008e-01   +9.043266751971861e-01   +4.476205750608875e-01   +1.747548514145943e-01   +6.715658029222012e-01; +7.260686719972075e-01   +6.698000924038349e-01   +6.519448576449351e-01   +1.842570323785418e-01   +2.046966027654360e-01   +4.353918520044777e-01   +7.796952041269289e-01   +8.874435947407698e-01   +8.772896898491380e-01   +4.281296981431030e-01   +3.876879855576859e-01   +4.223251677077136e-01   +6.931012471439763e-01   +2.797075334926947e-01   +4.148807232071045e-01   +1.171421997803826e-01; +9.912337991884751e-01   +1.249293384224471e-02   +3.818344036131158e-01   +4.802736499190969e-01   +9.105478628994916e-01   +3.253931207309845e-01   +7.103440856312231e-01   +5.861115495847010e-01   +9.115725758293299e-01   +9.448667173356152e-01   +8.715251116987187e-01   +3.908597707369049e-01   +7.456507766232656e-01   +1.595887596729862e-01   +9.663203326409743e-01   +9.854668697432043e-01];
L2I_L1I_iGABA_netcon = [+5.751190128870078e-01   +5.662919054338346e-01   +1.060990030147986e-01   +4.541200028891773e-01   +8.013869299233222e-01   +9.716558984212271e-01   +2.228404382549173e-01   +7.560328684941199e-01; +5.585829696301366e-01   +9.489367626556027e-01   +1.372402104434206e-01   +5.671469666434115e-01   +5.445737278440239e-01   +4.226616616341121e-01   +6.539897312534289e-02   +5.003834531810185e-01; +6.041715913223522e-01   +1.526016653047356e-02   +4.380207478344368e-01   +8.192803461499850e-01   +2.574289220686111e-01   +3.887589316744717e-01   +8.307739330500620e-01   +8.251395613871265e-01; +4.655958438591582e-01   +1.238961967521177e-01   +9.300579519872635e-01   +3.633497933859108e-01   +7.796692258664670e-01   +4.590534827285469e-01   +3.796352857324741e-02   +9.157357326171960e-01; +4.386971746523982e-01   +8.543751744043793e-01   +1.382143562784144e-01   +2.391181083179791e-01   +7.788913386571148e-01   +1.328226682374475e-01   +9.115943627679300e-01   +7.064796355592990e-01; +6.943847556742927e-02   +2.200065920638420e-01   +8.195759356695642e-01   +7.662620258942413e-01   +1.510801622710853e-01   +4.654452702978460e-01   +4.573282159700841e-01   +8.029803136726947e-01; +6.383965056692656e-01   +6.992232028400555e-01   +9.331495135744005e-01   +4.109310004891965e-03   +8.281541702593281e-01   +2.666890557118250e-01   +2.837645792736665e-01   +9.618691811284245e-01; +4.270571885029941e-01   +7.794269630933366e-01   +5.735539290139754e-01   +2.775042112470340e-01   +6.224155761117542e-01   +1.025215544374904e-01   +7.550281781263716e-01   +9.488677126233046e-01; +7.539840671725593e-01   +4.275894401264916e-01   +4.974814788013868e-01   +3.144469975686050e-02   +4.656382518010158e-01   +6.563205863803229e-01   +9.292473379210260e-01   +2.933996117789083e-01; +3.041233363780274e-01   +7.307260750386813e-01   +9.246342765152911e-01   +6.649445425089249e-01   +4.892529771940900e-01   +9.369226758261796e-01   +1.379951350755627e-01   +3.576981413507784e-01; +5.977482462488771e-01   +4.531689705588764e-01   +8.601442104738116e-01   +9.746301268790456e-01   +2.213567310245282e-01   +7.690093220564067e-01   +9.463355247614110e-01   +5.448513217226503e-01; +3.308158386593592e-01   +8.066418311334960e-01   +2.502734649976346e-01   +9.477246785399563e-01   +8.534893596698251e-01   +4.235834494528809e-02   +3.123694089323107e-01   +2.095424997848687e-01; +6.450814858746161e-01   +4.345148727990558e-01   +4.558594717571411e-01   +5.342585209508342e-02   +8.795328044936400e-01   +2.576511961626499e-01   +2.042428046846647e-01   +7.745077903928016e-02; +2.890378812930311e-03   +1.502527048441896e-01   +7.380433613004973e-01   +2.899075801321051e-01   +8.348911145879885e-01   +6.451220761782672e-01   +4.640106238197332e-01   +5.095582476824871e-01; +1.465788139094959e-01   +8.009369471702724e-01   +7.506495993188272e-01   +4.803473278459555e-01   +4.401055835923920e-01   +8.481353843984117e-02   +5.977115749994674e-01   +1.947759870078555e-01; +2.501242248773240e-01   +3.765358016518570e-01   +2.379252615067499e-01   +8.857050226435953e-01   +5.439178120629813e-01   +7.399876744919598e-02   +5.475878746735667e-01   +1.418941190526127e-01];
L1I_L2I_iGABA_netcon = [+7.145285695804932e-01   +8.753968980042036e-01   +6.176178238439972e-01   +5.013732107680707e-02   +1.517225069294452e-01   +2.366535273873644e-01   +8.456745242932252e-01   +3.715257480225947e-01   +7.149919251195065e-01   +3.910089649121002e-01   +2.433674221421294e-01   +6.810053006434760e-01   +1.630950969016210e-01   +5.763415425617895e-01   +5.056319605044918e-02   +4.728129486950498e-02; +6.117581194162540e-01   +8.039309469813984e-01   +6.203185920374819e-01   +5.337819700274787e-02   +7.518314992383659e-01   +5.537258978972124e-01   +1.985326093690435e-01   +5.676853562034979e-01   +1.934301567131549e-01   +7.300063805094629e-01   +5.088471938080685e-01   +3.396125263855206e-01   +1.135113665009101e-01   +8.181043494926880e-01   +4.351557951710798e-01   +9.296526534510382e-01; +1.616637267823126e-01   +6.227242710956493e-01   +3.118185720174902e-01   +6.025683330062577e-01   +9.525441159567825e-01   +1.159540091049042e-01   +6.149995024991745e-01   +8.404116647180969e-01   +2.369662756707024e-01   +6.362654554705359e-01   +7.379181483103362e-01   +5.507791937663343e-01   +7.498481091027005e-01   +6.789556418074673e-01   +9.264121373075899e-01   +1.793174564946447e-01; +4.871962118694725e-01   +4.801791269863050e-01   +1.348232973371000e-01   +6.640448939008885e-01   +2.610648174033010e-01   +8.286501963258337e-01   +1.565157216325715e-01   +7.200042631750704e-01   +9.985879435232746e-01   +9.910787000118965e-02   +7.845063316062766e-01   +5.372337144456764e-01   +2.192658213941100e-01   +4.437362591657760e-01   +8.853468888915687e-01   +7.513812561039550e-01; +2.876840213250864e-01   +2.181195788611275e-02   +6.056368925217064e-01   +4.905154511004400e-01   +9.383733953953016e-02   +6.572048716073067e-01   +5.865299685580778e-01   +1.110554398017405e-01   +9.067066844982902e-01   +5.005003965909923e-01   +6.852384432933341e-01   +9.089947944605186e-01   +4.879815671415590e-01   +8.969925322177535e-01   +9.328861522785677e-02   +4.698221246971299e-01; +4.000706795831017e-01   +1.280464606415125e-01   +8.988722294471075e-01   +9.833507759051513e-01   +2.307355072710765e-01   +2.299107524912407e-01   +5.454602921801086e-01   +7.469162931955414e-01   +1.020491323490697e-02   +5.576988485544381e-01   +8.181621804972348e-01   +2.866318989617238e-01   +4.510983677414643e-02   +7.899474044793819e-01   +6.861120055545847e-01   +2.488677599945949e-01; +4.912029721714271e-01   +7.237931313397044e-01   +5.686290678001293e-01   +8.662458154438373e-01   +8.981266265779263e-01   +3.029696506200610e-01   +6.917696431321011e-01   +9.249525739129209e-01   +8.402916628956876e-01   +5.575920047759513e-02   +4.262889384456748e-01   +1.362084572117181e-01   +5.821483447397522e-01   +5.928031308180832e-01   +1.648182222241763e-02   +6.632974913536474e-01; +8.643560512221830e-01   +6.706614156775116e-01   +6.389815087275441e-01   +9.624565974365101e-01   +1.982523105831751e-01   +3.256740635720853e-01   +7.031688383131649e-01   +9.296477819977267e-01   +2.524556836934584e-01   +8.391701135884633e-02   +4.943392285075617e-01   +9.609875012466589e-01   +4.987979606484085e-01   +6.273627090182872e-01   +1.259995723729148e-01   +6.166877426130900e-01];
L2E_L1E_iAMPA_netcon = [+3.728380447836869e-01   +5.651728594152691e-01   +2.002333403194227e-01   +5.201039321705553e-01   +2.934066786944667e-01   +7.050059873666335e-02   +2.818189194129485e-01   +2.640075106470132e-01; +4.392925042969369e-01   +1.857014377335437e-01   +1.463847889764244e-01   +6.841514512403827e-01   +6.146797327728125e-01   +5.905269325354634e-01   +9.306182520861374e-01   +8.967517221178172e-01; +7.237046773540567e-01   +6.048556470974786e-01   +7.538630360455077e-02   +2.151159112479121e-01   +8.671861374337703e-01   +7.746833414883722e-02   +7.585784543993267e-01   +1.585290928219491e-01; +1.969199977495087e-01   +7.304083271246519e-01   +9.341685740904911e-02   +9.702482158494754e-01   +8.159257280556946e-01   +3.954895561610901e-01   +2.611624764469968e-01   +5.503133249401397e-01; +4.654059871355168e-02   +8.378919545665980e-01   +5.487188054674957e-01   +3.453295233966981e-01   +2.096642546504438e-01   +5.171077387712107e-02   +2.436376805374816e-01   +4.230180461755829e-01; +3.097153337279543e-01   +2.780711116202044e-01   +7.332867386470877e-01   +1.826299622996587e-01   +7.541450424942390e-01   +1.258576512004310e-01   +1.623554411412673e-01   +5.460026370744151e-01; +7.935914315333807e-01   +6.071853113304482e-01   +5.467681608278000e-01   +2.456027635687806e-01   +2.025995284159893e-01   +2.380241427323501e-01   +2.931025370546439e-01   +7.486744968108010e-01; +4.244657902555227e-02   +5.499813213024097e-01   +4.365412686859115e-02   +2.617542465696857e-01   +5.822789582497651e-01   +9.439444483354875e-01   +5.677400526887975e-01   +1.356393601276777e-02; +2.122739917945358e-01   +2.791660220486415e-01   +6.401733066109628e-01   +2.183139239353088e-01   +8.762917536935664e-01   +2.058216527564010e-01   +3.974063709249143e-01   +1.154208712572093e-04; +2.700876535184494e-01   +3.370560210459464e-01   +9.898728374992366e-01   +3.876003740726041e-02   +7.188779503223921e-01   +3.274854129712698e-01   +9.854081041992399e-01   +2.075223779416209e-02; +7.912624306993126e-01   +5.735221030114717e-01   +9.157917900572451e-01   +3.505972307582614e-01   +6.980258070358228e-01   +8.672006301197940e-01   +5.473493757427127e-01   +3.465828109490031e-01; +9.813433733105237e-01   +7.481954504608342e-01   +7.749970915000624e-01   +8.998608610642236e-01   +4.604954404341699e-01   +9.243610844008010e-01   +9.352692305273654e-01   +4.285068620960574e-01; +9.196204037964216e-02   +7.647391183041548e-01   +1.940797135515361e-01   +1.372422965244423e-01   +5.043259777225109e-01   +2.041601369951462e-02   +9.866668685762305e-01   +5.411622784580693e-01; +1.966623707621890e-01   +4.025854212432247e-01   +3.279628093502592e-02   +9.509752682262025e-01   +7.974912179084931e-01   +3.639341438510767e-01   +8.301525598716836e-01   +4.821874043429875e-01; +1.190042967601948e-01   +1.559246069089765e-01   +3.799237973677791e-01   +9.028689692574962e-01   +9.371554052137243e-01   +5.346492031223621e-01   +1.808571494811820e-01   +9.121158878609521e-01; +6.422244473417612e-01   +2.044672162108143e-01   +5.748772439285913e-01   +4.097934969567951e-01   +7.936795454781750e-01   +4.098077774628333e-01   +3.143541939143706e-01   +4.174367637080619e-01];
L1E_L2E_iAMPA_netcon = [+4.985348882142577e-01   +4.576958509430155e-01   +6.173224890400517e-01   +4.922115603862727e-01   +2.381711240465056e-01   +7.156611650553181e-01   +6.826272100532950e-01   +6.373851682415015e-01   +5.206777534045685e-01   +2.422879793535188e-01   +8.711083249837446e-01   +1.763832693311966e-01   +1.354909260829879e-01   +2.429295814019957e-01   +1.845846407599683e-01   +3.128288975745136e-02; +8.389085239256397e-01   +3.653305427433378e-01   +9.962797300305659e-02   +6.626799232895956e-01   +8.350626572896115e-01   +3.772276725857532e-01   +9.742511271104164e-01   +6.217771125855166e-01   +6.727845336825707e-01   +7.316713608398647e-01   +6.644271133388608e-01   +2.982338443782924e-01   +2.900584165387010e-01   +7.442506196049187e-01   +1.531534604643120e-01   +2.513341677561682e-01; +1.806638375541189e-01   +2.928439428449824e-01   +7.590933730769007e-01   +1.771582470590297e-01   +7.324574537419004e-01   +3.794883612900353e-01   +7.569313240408848e-01   +4.091680993967574e-01   +7.763347979914318e-01   +1.245507800020612e-01   +5.466016175111457e-01   +1.055803754859488e-01   +3.814538487447822e-03   +9.307164997075362e-01   +1.347680284067765e-01   +9.880147941614853e-01; +3.403838919649313e-01   +2.369751517197996e-01   +5.409501996620886e-01   +4.744299915494365e-01   +4.889377596883163e-01   +7.150427120331353e-01   +5.531073043048456e-01   +4.353857624459506e-01   +4.621435927422345e-01   +3.774413572523985e-02   +2.433461978788667e-01   +4.578677318237388e-01   +3.067601976311163e-01   +3.701294595070481e-02   +1.652667472276386e-01   +6.327569533067252e-01; +6.936953384571602e-01   +1.372498484214578e-01   +4.472025133765215e-01   +5.030536986869374e-01   +8.483529323489361e-01   +8.310095665351427e-01   +2.655880561249144e-02   +5.131254023009251e-01   +9.083476862513493e-01   +6.492978682061012e-01   +1.085702520922103e-01   +5.860521931102495e-01   +9.083968578571184e-01   +4.278628263982243e-01   +9.246890720383794e-01   +3.543784922477474e-01; +6.885093351078018e-01   +1.014191790063545e-01   +7.414773121657071e-01   +5.981810797986300e-01   +7.190692191257820e-01   +6.679604412884380e-01   +1.917704297134883e-01   +2.625906646679244e-01   +2.180626848528736e-02   +1.970420279381681e-01   +9.679163018683595e-01   +2.183070923898661e-01   +2.949389969640084e-01   +8.226867774772373e-01   +2.624312092718908e-01   +1.012500085477439e-01; +3.704952367351146e-01   +2.390081368229256e-01   +3.865401457457114e-01   +2.452471857329054e-01   +5.192972672524179e-01   +6.466695449129963e-01   +9.420386132437008e-01   +4.199667097201886e-01   +4.875620625518663e-01   +9.742528804574718e-01   +5.859919479529654e-01   +1.064781689180581e-01   +8.272782847667528e-01   +9.965696898045285e-01   +2.057097508586259e-01   +4.117726087167159e-01; +2.969358229805070e-02   +3.476435049468968e-01   +5.331540704315120e-01   +5.195506881820172e-01   +9.368248250934617e-01   +5.599951637430468e-01   +3.943667419944397e-01   +5.170984662511496e-01   +2.719809681325157e-01   +8.271587250047299e-01   +8.146066982116601e-01   +5.619518916916608e-01   +7.365003636219031e-01   +9.221811175486210e-01   +6.183708536805368e-01   +9.293080223856508e-01];
L2I_L2E_iAMPA_netcon = [+6.798595495411339e-01   +6.148866283435428e-01   +3.713380560621608e-02   +7.996856440180160e-01   +5.201192689949379e-01   +8.238659516491312e-01   +6.482993078598693e-01   +3.848154724243653e-01; +2.161179518565968e-02   +9.417587004342826e-01   +5.368001968589035e-02   +9.364357644350932e-01   +6.351312920568301e-02   +1.076386760346764e-01   +3.385521615508643e-02   +1.680153549356172e-01; +7.299840004778547e-01   +9.643721407385367e-01   +4.077562281452118e-01   +9.395752730898823e-01   +2.892906323212106e-01   +2.308448302625249e-02   +5.644240501071499e-01   +4.442532300602924e-01; +2.151054657702156e-01   +3.675021481478792e-01   +9.786452912273835e-01   +1.452445213628339e-01   +7.146963317087424e-01   +1.001674456028897e-02   +3.111742692319299e-01   +8.734873959222215e-01; +8.538096840992412e-01   +7.917832269107522e-01   +7.088804668082963e-01   +3.249683811429297e-01   +8.863148255276654e-01   +3.354593605249184e-01   +2.632617888809421e-01   +4.049522852754104e-01; +1.576457098807107e-01   +7.203858048294447e-01   +9.935956289076531e-01   +4.249567758895147e-01   +3.673856554525348e-01   +6.668220256391145e-01   +7.197890551362224e-01   +1.671480963280859e-01; +6.706120559056172e-01   +9.515607848096965e-01   +6.501576141653067e-01   +7.071504319649855e-01   +5.612327643418692e-01   +5.916374863461813e-01   +3.062730462285789e-01   +6.636429725747568e-01; +9.319748299658903e-01   +1.425118345487004e-02   +5.038329707159395e-01   +6.191149196713100e-01   +8.801154456721264e-01   +8.100222946284687e-02   +9.026130477044562e-01   +9.294634368010686e-01];
L2E_L2I_iGABA_netcon = [+6.450596261589617e-02   +5.226489577544841e-01   +3.422595164665706e-01   +2.569616377922810e-01   +4.427730619676556e-02   +9.055873098733997e-01   +3.415670893024700e-01   +4.565673395991488e-01; +3.564806921231261e-01   +6.102207035684661e-02   +5.546781606299185e-01   +9.827133326034992e-01   +3.616983762624281e-01   +5.561781970355583e-01   +9.371548063482549e-01   +6.700042764333755e-01; +9.265531425132222e-01   +1.811912112017325e-01   +6.863455765065809e-01   +3.507950943175797e-01   +4.231322642487233e-02   +7.115281708754516e-01   +9.115772876812729e-01   +7.708503782588854e-01; +2.408211714022633e-01   +3.140495047863903e-01   +4.035368743972963e-03   +3.934129220223675e-01   +4.884298134126088e-01   +7.171982437863685e-01   +7.286195780462750e-01   +9.283194411597960e-01; +1.120064390430837e-01   +2.446714946621876e-01   +5.066380693784756e-02   +7.501912859680058e-01   +7.296106250403736e-01   +1.738398736977274e-01   +4.432753230966724e-01   +6.507774059297167e-01; +7.097935798502177e-01   +3.184796288254664e-01   +3.073307385804298e-01   +1.102988843429559e-01   +1.391587469100514e-02   +3.518651582489729e-01   +1.467390558799479e-01   +5.044787420570983e-01; +5.191000307533781e-03   +8.720242796126147e-01   +8.751819583556213e-01   +5.987262915941328e-01   +5.047241190251379e-01   +3.704140578757598e-01   +8.319783533183527e-01   +3.445150917105982e-01; +1.793994242873171e-01   +2.999879689264721e-01   +6.267578731138274e-01   +1.233193540485768e-01   +2.502525471546790e-01   +7.588481416255696e-01   +2.485469177281621e-01   +9.407172394715658e-01];
L3E_L2E_iAMPA_netcon = [+7.706606731391942e-02   +1.824949033978440e-02   +3.710078228866550e-01   +4.914199844119421e-01   +1.825563634419883e-02   +9.646746156763727e-01   +3.591828942664358e-01   +2.048968739833165e-02   +2.033838015181852e-01   +6.663731242682240e-02   +2.430990956244869e-01   +9.984850622474820e-01; +9.548848550630910e-01   +9.844652488715702e-01   +1.220125170153225e-01   +6.626538187178629e-02   +8.096443148672318e-01   +3.866405994496200e-01   +2.314752751871688e-01   +1.279647599578102e-01   +3.554944937788168e-01   +7.506655657246724e-01   +5.404165895031913e-01   +3.409295324299522e-01; +6.647087782583850e-01   +7.243944027643286e-01   +5.084562153664872e-01   +8.706109631154089e-01   +7.983662004772409e-01   +6.607435102973571e-01   +7.252028527290488e-01   +6.690138608521861e-01   +8.969587935399550e-01   +9.970978182293051e-01   +3.363371211160417e-01   +8.313774660552227e-01; +1.701082030291588e-01   +8.781385747730341e-01   +5.584294001884514e-03   +9.974550848460002e-01   +4.148211840645169e-01   +5.833399636068820e-01   +7.765883894571397e-01   +5.120983159368684e-01   +8.196107288747563e-01   +7.703914683963432e-01   +6.703774662740016e-01   +1.141414061860943e-01; +1.998154673976595e-01   +8.144698595799167e-01   +8.716457452329311e-01   +1.211158419272330e-01   +6.403459895753822e-01   +4.785969225364069e-02   +3.367786066492939e-01   +7.508959576408020e-02   +3.152547212297414e-01   +8.906085506872866e-01   +8.789773495207839e-01   +7.805068788758593e-01; +9.880229299706569e-01   +3.708488928431114e-02   +9.090317659921888e-01   +1.053929788841804e-01   +5.677031651961674e-01   +7.864356186756330e-02   +5.712467695066525e-01   +5.361282640227130e-01   +5.985039385998807e-01   +4.312944574273919e-02   +9.751656466519576e-01   +1.545776019162023e-01; +9.378541177608389e-01   +9.450384184035519e-02   +1.112596496581671e-01   +1.485009667559129e-01   +9.132469458520661e-01   +2.296018245802976e-01   +6.380473739727458e-01   +6.857277997624895e-01   +7.043425515232900e-01   +7.977907599326872e-01   +1.339675138845224e-01   +7.312792506193945e-01; +9.809321202514338e-01   +9.806078232039546e-02   +4.066096618376455e-02   +1.286411160285393e-01   +7.537438154170153e-01   +4.136330128669134e-01   +3.660646137928697e-01   +5.890936580551609e-01   +1.783621740133567e-01   +7.129824387315501e-01   +8.830063538796428e-01   +1.165436989900396e-01];
L3I_L2I_iGABA_netcon = [+7.673535872221547e-01   +5.406038335808286e-01   +5.992985438617294e-01   +3.070310226547138e-01   +9.618833891976838e-01   +1.115847555316455e-01   +2.962329986636616e-01   +7.921023729096583e-01   +9.186289567807515e-01   +9.952903954307724e-01   +3.092387136178000e-01   +9.951272134240793e-01; +6.386536091150211e-01   +4.502119283311822e-01   +5.631294323948448e-01   +7.588642011197699e-01   +5.458201929911828e-01   +6.442016732750477e-02   +1.670118470608446e-01   +5.010512521641858e-02   +3.864030553150267e-01   +2.902514513764972e-01   +4.412386760272963e-01   +9.191481945525595e-01; +8.006793049095458e-01   +1.130591976360837e-01   +7.237699183632651e-02   +6.508536724508975e-01   +9.783021537833285e-01   +4.462748703159442e-02   +7.237915940308951e-01   +1.847556046626204e-01   +7.502506705764451e-01   +5.221402808244943e-01   +2.031732552989233e-01   +6.945090339724953e-01; +9.653081358653555e-01   +7.166984684300262e-01   +7.643532656188387e-01   +3.294740712895432e-01   +1.239100633381440e-01   +1.284335352192902e-01   +2.961982396251075e-01   +2.482161892220935e-01   +8.771274615849125e-01   +3.640272026356322e-01   +9.427727362312850e-01   +2.205318610172785e-01; +7.130340470456907e-01   +1.850502116869604e-01   +8.703788304283515e-01   +9.785866316476493e-01   +1.578371611303561e-01   +4.927624941554549e-01   +6.756847901014259e-01   +2.562639251501689e-01   +4.013981577228121e-01   +5.221171589634611e-01   +2.898594902822082e-01   +3.085627865500915e-01; +6.468724229198731e-01   +3.260289400033397e-01   +7.008697857118679e-01   +5.301679367922189e-01   +3.351654390715862e-01   +4.675423346773663e-01   +7.528698983122520e-01   +6.501468898261604e-01   +1.688239729099451e-01   +4.950724212489921e-01   +1.160202236383581e-01   +2.294185725843620e-01; +5.172549312971277e-01   +9.712291181752581e-01   +1.131739849555718e-01   +7.521491566166014e-01   +5.282939763794925e-01   +1.568992806906413e-01   +7.453151450908426e-01   +9.965637819850086e-02   +4.420139891326030e-01   +1.858580955192825e-01   +6.571975470783147e-02   +7.030701820160318e-01; +9.548347723153251e-01   +6.924053473981616e-01   +6.612918971479715e-01   +2.639725114483257e-01   +6.881457293375783e-01   +1.328168051154543e-01   +7.784547824803473e-01   +4.698676328832782e-01   +8.539251950194932e-01   +4.880946834519754e-01   +7.273037963350774e-01   +3.754798786112841e-01];
L2E_L3E_iAMPA_netcon = [+6.505420792493701e-01   +3.828124741021942e-01   +2.317127575957200e-01   +4.665584202859910e-01   +9.105182416968783e-01   +9.507401793751566e-01   +7.607390288961811e-01   +3.536482159403652e-01; +3.779756990575783e-01   +2.736996417869744e-02   +9.102815148879727e-01   +2.880665319451082e-01   +6.823954256594743e-01   +1.885576051920136e-02   +8.917181261419894e-01   +6.642256941908858e-01; +3.061022588811483e-01   +3.306444947837948e-01   +4.882633066996890e-01   +2.750022069298884e-01   +8.452518644154143e-01   +5.014501984998542e-01   +7.913338710467018e-01   +5.938976905851526e-01; +1.575032107689699e-01   +4.951981043534999e-01   +5.901916764993692e-01   +1.453618304848396e-01   +9.433897424645173e-02   +3.338127362827937e-01   +9.423496232363254e-01   +5.317513987844847e-02; +7.772096862167963e-01   +2.691737063752835e-01   +9.558333631536667e-01   +1.403304231552613e-01   +7.362198481495251e-01   +6.659653813793400e-01   +5.334531548902680e-01   +2.106125088797579e-01; +7.163647005182674e-01   +5.334944321601141e-01   +8.582922384762114e-02   +2.651706973942370e-01   +5.508232331872400e-01   +1.618965847651405e-01   +1.599293462395996e-01   +5.965463067228994e-01; +1.773017422475133e-01   +4.175749947589824e-01   +2.225978094934540e-01   +6.057174255692244e-01   +2.512479289079542e-01   +2.228440200210757e-01   +1.340940944393390e-01   +2.666053121313997e-01; +4.487812477790265e-01   +6.888739982301181e-03   +1.607975921417664e-01   +1.015638835950410e-01   +7.221627537040353e-01   +1.117360021241096e-01   +2.641652114469467e-02   +1.188927407855793e-01; +8.400579466692351e-01   +8.965091389920412e-01   +3.894647039087366e-01   +4.915760879864477e-01   +3.639293774254133e-01   +9.918994912744745e-01   +6.879316716631922e-01   +2.151506761284817e-01; +7.002842548596049e-01   +2.379673051690608e-01   +1.857346356040171e-01   +8.939786492729217e-01   +8.470519532826791e-01   +1.472353279747764e-01   +5.801025008801101e-01   +8.784013818398521e-01; +7.648125556019846e-01   +8.048298130781117e-01   +7.623370799219285e-01   +1.844528546355166e-01   +8.243614873471039e-01   +7.644901065437415e-01   +2.970461583343073e-01   +4.633659518332842e-01; +9.758715719780812e-01   +5.818579126469077e-01   +2.337038501486715e-01   +5.214483268515840e-02   +6.190835286429999e-01   +6.260668174986053e-01   +7.384899743239912e-02   +7.302053887332042e-01];
L2I_L3I_iGABA_netcon = [+5.877401205062424e-01   +1.450804943786680e-01   +3.431143291296208e-01   +3.731310945702213e-01   +5.960105444144603e-01   +5.124635121229013e-01   +7.738878174536016e-01   +2.632414529236278e-01; +8.424398267326675e-01   +9.913629715988908e-01   +4.369398653953672e-02   +5.356334568156074e-01   +4.766549377161735e-01   +2.436084630004837e-01   +1.820171032719944e-01   +5.975072845535899e-01; +6.043012123947137e-01   +4.792299242312892e-01   +9.483164195806241e-01   +9.711335930763458e-01   +3.767993292135255e-01   +2.663500789685721e-01   +4.520850858573891e-01   +6.833453308075501e-01; +7.478624243688263e-01   +4.124344578069876e-02   +8.602943398512165e-01   +9.973618630439923e-01   +9.802342647595170e-01   +4.136606231080826e-01   +3.036043216100662e-01   +4.171063293775215e-01; +8.528041904116249e-01   +2.713419716070443e-01   +1.384721269227079e-01   +4.071836806862321e-01   +1.370245495456340e-01   +2.638348061728709e-01   +3.799287080823940e-01   +5.179347047572849e-01; +1.459562562578000e-01   +6.720941652188384e-01   +5.818171341269696e-01   +4.495617630916665e-01   +2.704630670253129e-01   +8.537546901076684e-01   +7.940001568783550e-01   +8.141955727024265e-01; +7.371238241321645e-01   +1.415816333608653e-01   +6.142085212221934e-02   +2.403373772870586e-01   +2.264082566349241e-01   +4.829963109831392e-01   +7.805461584656711e-01   +5.451942781215616e-01; +1.439488647299930e-02   +7.734512691629184e-01   +9.532788685592690e-01   +5.951229045753105e-01   +7.906901580380751e-01   +3.337593227643957e-01   +6.437065624155263e-01   +5.916380417784386e-01; +2.333869566854463e-01   +2.662077510957559e-01   +4.981370270438450e-01   +7.417679438716770e-02   +8.193325507379586e-01   +6.332138908344174e-01   +2.413458128328691e-01   +5.378430836337317e-01; +5.401484877785540e-01   +8.830982894707187e-01   +2.554638059885788e-02   +9.112391492544396e-01   +8.022622684387563e-01   +4.186649861378361e-01   +6.035724421158633e-01   +5.460466123683915e-01; +7.104856739965821e-01   +3.622566472226357e-01   +5.197107947108599e-02   +4.736819876037682e-01   +1.202344863494725e-01   +5.425846163895033e-01   +4.205944700698200e-01   +1.530781691947382e-01; +4.328041439739909e-01   +1.410854989310690e-02   +3.104550921037941e-01   +5.020305782152250e-01   +6.404039000628090e-01   +3.381039281600171e-01   +3.008811185723965e-01   +6.999630321640569e-01];
L3I_L3E_iAMPA_netcon = [+6.160614805011708e-02   +7.799713078917150e-01   +5.573179941734704e-01   +5.682949119862203e-01   +9.151082366491067e-01   +8.354111812005015e-01   +8.522522471250910e-01   +8.672426001529651e-01   +5.306171279999364e-01   +9.932883454033297e-01   +4.798770082015376e-01   +3.528531182145052e-01; +9.232231262912877e-01   +8.334261834679997e-01   +8.512501533445748e-01   +9.354287951727412e-01   +5.894305322202468e-01   +3.991178813002235e-01   +6.281913071232573e-01   +8.565651508511997e-01   +5.714722977643095e-01   +7.002987331005091e-01   +7.401837100077561e-01   +3.973588820696665e-01; +1.820802611635652e-01   +5.960058337352703e-01   +9.718896153325680e-01   +7.756326078723659e-01   +5.773301866087707e-01   +6.831470940427710e-02   +4.426638537248903e-01   +9.461838739299926e-01   +9.814055142236433e-01   +8.382137780742971e-01   +5.896085033529453e-01   +9.960122287031641e-01; +5.361422377946181e-01   +7.608080317653974e-01   +4.694094114235757e-01   +6.008951955444226e-01   +6.507726960759317e-01   +3.765410944187393e-01   +2.296788776129115e-01   +6.959581892156164e-01   +9.619415443704656e-01   +7.303355930628048e-01   +2.557422526553179e-01   +2.896854595092059e-01; +3.966823296224972e-01   +6.607399626007465e-01   +7.757349099908779e-01   +6.444364269784433e-02   +4.316913549792877e-01   +8.592372844946078e-01   +4.853659448232303e-02   +3.629044873491053e-01   +5.589984591040965e-01   +9.995877240239366e-01   +6.149861068110294e-01   +2.356364456626312e-01; +8.376293132390722e-03   +5.877424482165969e-01   +2.574283925602219e-02   +5.346301498275229e-01   +9.393817270258144e-01   +2.831163178071126e-02   +7.059197754455030e-01   +3.830193184419024e-01   +5.249322410535925e-01   +5.044506913563315e-01   +2.286618469483509e-01   +3.329269994316884e-01; +1.090599903705489e-01   +2.116184606308539e-02   +6.762646551991116e-01   +8.609029334856477e-01   +1.040968197893700e-01   +4.262670235310633e-01   +8.525726506970278e-01   +8.551994279312440e-01   +4.733856650555147e-01   +1.954713120556656e-01   +1.903393017511380e-01   +1.668540627663804e-01; +8.566066063611204e-01   +6.889134801993010e-01   +8.398807517429444e-01   +3.430083321764894e-01   +4.108970198128672e-01   +2.488012276334922e-01   +4.014602361821262e-01   +3.843810844278067e-01   +8.962109231778845e-01   +9.550596772203653e-01   +3.496692607590479e-03   +3.849273737599835e-01; +3.350543559852042e-01   +3.245800703442628e-01   +6.928870571807036e-01   +1.818527282568498e-01   +8.953900225443842e-01   +6.978298751772027e-02   +2.912336744387780e-01   +7.727692531974710e-01   +4.818003884513520e-01   +4.519103306185467e-01   +6.528153379468993e-01   +5.287124763627329e-01; +1.416443393633200e-01   +8.938802478139078e-02   +8.996009274805303e-01   +8.865517287907981e-01   +7.365782202061910e-01   +9.203198214632022e-01   +2.548903613519581e-01   +7.826274051444883e-01   +4.916125925177685e-01   +6.020940229926787e-01   +4.006362522491681e-01   +5.944582696623791e-01; +7.981700706828034e-01   +7.487986764867794e-01   +9.023474975031243e-02   +8.445197703526811e-01   +9.601078990857231e-01   +2.671213744045174e-01   +5.113018155700900e-01   +4.260940380042424e-01   +3.106582704288076e-01   +6.437193570405434e-01   +2.692785246012068e-01   +1.674333780069763e-01; +6.535793795714284e-01   +9.725009121159516e-01   +7.774840510146172e-02   +8.259103545433826e-01   +9.755836148123338e-01   +1.069718359602182e-01   +1.168113581708310e-01   +4.884981303504717e-01   +8.584648278867942e-01   +7.551577696471529e-01   +8.052892830663521e-03   +6.081690184728137e-02];
L3E_L3I_iGABA_netcon = [+4.442419548419469e-01   +6.383344100780168e-02   +7.192155858358713e-03   +5.011969113569590e-01   +5.412645363713159e-01   +2.488293716177122e-01   +7.220519448468837e-01   +7.601986437791211e-01   +3.795024343752799e-01   +4.473522869327587e-01   +2.021966989591747e-01   +6.530849828008445e-01; +5.799189960184759e-02   +8.048116904754157e-01   +1.282171971598937e-01   +1.927168448735946e-01   +2.221187341582227e-01   +3.369705790808544e-01   +2.233781625454055e-01   +8.850851042771718e-01   +6.087756295070834e-01   +3.899588543116745e-01   +8.311430397789724e-01   +9.007997646456144e-01; +6.279839836134576e-01   +9.118673371970348e-01   +3.076946300396630e-01   +6.457410677423590e-01   +2.676441178706763e-01   +5.996972520820048e-01   +4.938953513365983e-01   +7.298496279750847e-01   +1.606113860141771e-01   +6.761746231896723e-01   +4.409957160462925e-01   +8.372254118329434e-01; +8.078052680778580e-01   +4.232248388776625e-01   +2.357653001033422e-01   +2.557047453693881e-01   +1.364036660859035e-01   +4.797644443392867e-01   +4.753995849531079e-01   +6.869247683596647e-01   +1.030531531582669e-01   +3.255349275626806e-02   +4.326084058752840e-02   +1.643025336000712e-01; +4.017825552430984e-01   +1.890577586919047e-01   +6.530906518642914e-01   +9.424067879992146e-01   +1.295391929577222e-02   +9.011834912295305e-01   +4.344194174840015e-01   +6.518952482148869e-01   +6.176231785626125e-01   +7.801424594071197e-01   +7.651941761855380e-01   +1.597395610929453e-01; +8.873367937202336e-01   +1.845293083247644e-01   +8.040283710575918e-01   +2.923563423761155e-01   +1.317061489774047e-02   +2.871664127444387e-01   +5.571687566425991e-01   +6.233318645607693e-01   +9.586289581158028e-01   +3.727561922762041e-01   +9.489310013021211e-02   +1.349791928121017e-01; +7.171595434422955e-01   +6.697828459721415e-01   +7.355464772851112e-01   +1.446863561045970e-01   +9.897915454392472e-01   +7.831393075599777e-02   +2.064820282732428e-01   +7.666626999954275e-02   +6.681513565046089e-01   +6.363212981351656e-01   +6.563821677955796e-01   +1.541483996539197e-01; +2.050357570110461e-01   +5.204019467544525e-01   +1.181508575537477e-01   +8.640456210779450e-01   +6.485960155404722e-01   +3.832303799829130e-01   +2.781128074730155e-01   +5.486517268367664e-01   +4.742820712813516e-01   +4.926258598631214e-01   +2.637324477316467e-01   +3.982424238608368e-01; +3.721973589434508e-01   +7.798175899869652e-01   +1.719286395688788e-01   +8.846314499013134e-01   +8.077032629793324e-01   +1.866553964344276e-01   +8.016025486117153e-01   +8.754732824770689e-01   +3.332271287125619e-01   +2.287166527980777e-01   +4.427205862912107e-01   +6.600107614285632e-01; +2.127285865439603e-01   +3.028258522720065e-01   +2.650871289631060e-01   +6.588317821107560e-01   +2.808686805076292e-01   +7.288494928349382e-01   +1.013451385002453e-01   +9.831807469549683e-01   +5.895302937368749e-01   +2.129990853943224e-01   +8.460353656435761e-01   +2.223260248057800e-01; +2.569219777027523e-01   +4.700069555117076e-01   +8.182731800774488e-01   +9.958321357504556e-01   +1.588315160834975e-02   +4.285685055588185e-01   +3.567813024284525e-02   +6.766800213446439e-02   +5.479976696154056e-01   +4.506364310022760e-01   +9.045276014296950e-01   +6.421875941081269e-01; +9.938003664386821e-01   +7.081519859853086e-01   +5.879415139052976e-01   +2.591174234815560e-01   +1.003838670797492e-01   +2.650471988821291e-01   +7.331294366119571e-02   +3.032363076411797e-02   +4.103505538561491e-02   +6.279133527005955e-01   +2.811635572324142e-01   +6.122317960781234e-01];
L2E_Input1_iAMPA_netcon = [+9.990006026525113e-01   +9.977519470618872e-01   +9.973439133065050e-01   +9.935995346585680e-01   +9.948016249986631e-01   +1.000000000000000e+00   +9.915258234736075e-01   +9.939081102020116e-01];
L2I_Input2_iAMPA_netcon = [+9.985186455016881e-01   +9.968679733748330e-01   +9.976581167924998e-01   +9.947066772559903e-01   +9.973791725756049e-01   +9.972801934024602e-01   +9.973756598612732e-01   +9.985951019547061e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
