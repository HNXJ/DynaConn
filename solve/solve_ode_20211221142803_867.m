function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.602161536409717e-01   +5.660662442952668e-01   -4.052950735365534e-01   -7.736162498717686e-02   -7.505646616194863e-01   -1.984629120704184e-01   +3.113329097339277e-01   -2.016663093290433e-01   +3.769923444512974e-01   -2.209747783911968e-01   -3.961800453256699e-01   -2.372951154856422e-02   -2.189116513719598e-01   -1.159497091192778e-01   +4.206818114702652e-01   -2.743312249991812e-01; -2.392762101048413e-02   +3.902015660595275e-01   -3.088295949505273e-01   +5.662265718881095e-02   -3.510703746210841e-01   -8.063029131458879e-01   +3.646950485608418e-01   -1.900662953597809e-02   -1.924176980876335e-01   +5.126789829386163e-03   -6.050622470654750e-01   +2.482454632708984e-01   +2.044106774208177e-01   +4.390411246433705e-01   +2.821606789245884e-01   -6.619036031748891e-02; +3.244039082740766e-01   +4.078446943443709e-01   +3.779675371252214e-01   -4.710879026226890e-01   +1.358999392943647e-01   +4.707042535384417e-01   -6.881278113240323e-02   +4.797989076866250e-01   +1.575223313249941e-01   -1.939412401208703e-01   -1.861322317780301e-01   +4.263196492630927e-01   +4.478844135962103e-02   +2.374330181008865e-01   +2.075603586905299e-01   -1.797697203498936e-03; -3.664311739330662e-01   -2.726545172415766e-01   +4.702797329343236e-01   +2.169121123106702e-02   -1.180980760422019e-01   -3.857310979604607e-01   -2.305481024749318e-01   -2.288651039632041e-01   -1.756526390074271e-01   +4.550705161417807e-01   +9.784721195472572e-02   +3.110250943648952e-01   -2.858028257751590e-01   +2.239830872837985e-02   +3.079881816305648e-01   -4.891783675750780e-01; +1.554324384266840e-01   -5.566494173066576e-01   +1.085328655016824e-01   -4.759139480194656e-02   -2.169493069533552e-01   -8.885542313251989e-02   -4.531513066158395e-01   +3.820582724177297e-01   +6.325902471556800e-02   +6.703339814969869e-02   -5.268075295912134e-02   -5.067368840189250e-01   +2.187955313077376e-01   -5.833695070491403e-01   -1.624475562075571e-01   +7.542314698804489e-01; +7.642794872503389e-02   -3.545428384574463e-01   +1.479976218256461e-01   +3.294215694645196e-02   -3.899799822290327e-01   -2.123345725558213e-02   +6.135809295685514e-01   +1.757238420332081e-01   -8.611086610954012e-02   +4.048713704309232e-01   +2.079911903788398e-01   -2.650186232851246e-02   -1.512688845005357e-01   +4.091540764285107e-01   -1.017693867547348e-02   +1.770484136627998e-01; +9.717708057658139e-02   -8.569013004231257e-02   +1.344592382485280e-01   +4.313359090971718e-01   +4.185267231342774e-01   +1.402612309711606e-01   -2.803689579357344e-01   -1.343574832500575e-01   +1.384919433388319e-01   -8.907724979690165e-02   -9.066099457129288e-02   +3.717863923097370e-01   -2.336545514130024e-02   +1.848992230056264e-01   -4.738517940114501e-02   -4.609784700037762e-01; -2.304659057079365e-01   -3.172255393686361e-01   +5.394172860755445e-01   -5.106074406959299e-01   +5.286946324778325e-01   +3.280565475373826e-01   -3.763627788314732e-01   +2.720681874416319e-02   +1.186721286481989e-01   -1.204604507205872e-01   -8.949677619710948e-02   -4.470053619385179e-01   +6.803699372268609e-01   +5.862713729480734e-01   +3.729550374708606e-01   +1.939554622204494e-01; +3.043396554650240e-01   -1.672460491529812e-01   -9.707974303357460e-02   -2.546648566609260e-01   -7.120733591064419e-01   +8.050738322353312e-02   +7.056355198816524e-01   +3.077049728676146e-01   -3.157570951716264e-01   +5.182683302848096e-01   -2.833509315011633e-01   +3.637061396453649e-01   +4.340443719417487e-01   +4.640039520662330e-01   -9.101646013593510e-02   -3.770520382102742e-01; -2.629372849232182e-01   -4.349620421873722e-01   -5.077973731364047e-02   +6.499113510923649e-02   -1.488490411183963e-01   -3.208148063309038e-01   -2.892120780343943e-01   -1.710492492374676e-01   +6.019239194170397e-01   -8.366945963446260e-02   -1.429040645821819e-01   +1.494747827502207e-01   +4.112396594699168e-01   +4.392813904496184e-01   +3.348798115379604e-01   -5.904457780300082e-01; -1.756103005194964e-01   -2.106808444718530e-02   +5.806051354432876e-01   -6.005862596610022e-01   -2.008953466197453e-01   +6.295888303608185e-01   +5.573416585219406e-01   +2.594299153918978e-01   -4.002580643818260e-01   +1.881904245503240e-02   -5.422340517520536e-01   -7.211929465589819e-01   +5.126850477631316e-01   +1.543553728927977e-01   -2.422868134341011e-01   -6.260280316235196e-01; -6.143812686738344e-02   -1.000000000000000e+00   -6.564481180809335e-02   +2.069078780707510e-02   -5.997144106822255e-02   +3.440415642062651e-01   -1.448733797822765e-01   -6.490906082517082e-01   +3.515111270819856e-02   +2.878897022974106e-01   +3.994876760837917e-01   +5.639970711700266e-01   +5.842348827970684e-01   -6.874662878654637e-01   +4.052473167817565e-03   -1.277625019029682e-01; +1.501387905751746e-01   +7.204752829952199e-01   +5.251123250317651e-01   +2.984070080635432e-01   +1.578077282309107e-01   +3.948919849411940e-01   +1.208961708690384e-01   +3.592261863630544e-01   +5.240386805435743e-01   -6.291060085939278e-01   -2.204636383492565e-01   -1.149509808000488e-01   +4.957117787072142e-01   -2.686641817413893e-01   -9.401867883466409e-03   -1.450161910049236e-02; -3.187898275752576e-01   +4.940309547423697e-01   -1.612284175981187e-01   +6.958422714383561e-01   -2.675718554850454e-01   -1.143637065878680e-01   -4.088030875526700e-01   -2.396103774874380e-02   -3.167023324057440e-02   +4.611848804586920e-01   -5.950926740284644e-01   -9.293780874791903e-02   +2.383670177899687e-01   +1.618087190525564e-01   +1.290340290680883e-01   -4.807846649297897e-01; -4.521679685953693e-01   +1.778951219243701e-01   -5.767886222974923e-01   +5.518123842052913e-01   -1.039632446523356e-01   -2.692067928549615e-01   -9.424201560888705e-02   -1.981449985506824e-01   +2.902647344176157e-01   -8.745584366598015e-02   -1.662922768205180e-01   +7.904477990698520e-01   -4.244689091696541e-02   -2.430078270840993e-01   +4.844617568161812e-01   +1.636530940240226e-01; +3.639045286709242e-01   -3.016819640387366e-01   -1.018905908014550e-01   -6.613652043534372e-02   -4.793427035788776e-02   +5.381051221846073e-01   +5.339912380268482e-02   -8.001315753368685e-02   -2.820517486576636e-01   +1.489047822840280e-01   -4.867028543941442e-01   +1.442189230477637e-01   -4.843652376491063e-01   -5.570552018745306e-01   +5.987055665323320e-01   +5.972522118433858e-01];
L1E_L1I_iGABA_netcon = [+7.539321329868177e-01   +5.462650128106052e-01   -5.342457343946756e-01   +3.729653958696113e-02   -4.363465560436582e-01   -6.264930548694954e-01   +3.360573128620064e-01   -1.310446539470008e-01   +7.361052325848597e-01   -2.939502506872345e-01   -9.904470689762147e-02   -1.140511506190619e-01   -4.693001461741951e-01   +1.352189818094054e-01   -1.005180437678649e-01   -6.993378193127832e-01; -4.879956269501223e-01   -1.907345473249321e-01   -2.834343965077067e-01   -9.892198841312488e-02   -7.490379101665931e-02   -9.067813927244993e-02   -5.192186998555876e-01   -4.020298328566801e-01   +2.566596186939468e-01   +7.077896545313377e-01   +6.785243635674029e-01   +1.043936223757636e-01   +1.970637762423157e-01   +6.135224497765683e-01   +4.141118863946805e-01   -1.868492999450684e-01; +1.846665435118212e-01   +9.785377194703758e-02   +7.437896082878130e-01   -6.814124219545502e-01   +3.075822496882672e-01   -3.248456855079648e-01   +6.960223786190101e-01   -8.385775505860824e-01   +2.457723644004280e-01   -5.388060416397705e-01   -6.211585309691510e-01   -5.687308267276972e-02   -4.973941460350555e-02   -3.926359990362102e-01   +4.160025308562448e-01   +1.868754791354613e-01; -7.746633828253181e-02   -5.568638158252773e-01   +1.220470000929685e-01   +3.542310334300928e-01   -3.331347234203231e-01   +5.881809791213372e-02   -6.352544275207233e-01   -5.931951737812902e-01   -2.116001063707925e-01   -2.587534775566521e-01   -6.163944895910376e-01   +3.797754284874464e-01   +3.517650300333481e-01   -1.348063626305692e-01   +1.071394957382539e-02   -8.963388382481612e-02; +2.770102133548264e-01   +7.277835391195470e-01   -3.807752700476786e-01   -4.139684386454089e-01   +2.993511945216976e-01   +1.285490904036022e-01   +6.208499913313996e-03   -1.589924603468282e-01   +2.262370916235669e-01   +3.024503938253129e-01   -5.862122885561251e-01   -3.084581710588693e-02   +3.994903187193735e-01   +2.010564746365263e-01   +2.514042993639934e-01   -6.959166479692872e-01; -2.569437751032589e-02   -7.070893572401156e-01   +1.948765584349741e-02   -3.975408728855258e-01   -2.969360479240396e-02   +1.479270383399186e-01   -3.397228097260320e-01   -2.866295788740671e-01   -9.875021732115893e-02   -4.597336617146975e-02   +2.521417511598490e-01   +1.126693638688889e-01   -1.998680676358412e-01   +1.617641967957121e-01   -5.304474873641700e-02   +3.337018055362312e-01; -5.677845297927450e-01   +6.020868376823659e-01   +3.121477895203864e-01   -4.295511937043286e-01   +1.338590657967791e-01   -8.600272049461084e-01   +2.825158186978510e-01   -2.044496058568910e-01   -4.302288369685309e-01   +1.223328125512636e-01   +4.558534057348199e-01   -6.913717366698815e-01   +3.206718661473744e-01   -4.867213533149483e-01   +3.450359871033432e-01   -2.773169369223060e-01; -4.956887722719781e-01   +2.937402150875805e-01   +2.752341464084165e-01   -5.892838985861334e-01   +2.897249952213842e-01   -6.413277028771792e-02   +8.529734343217945e-01   +9.121071487761571e-02   +4.959706202760178e-01   -7.870448236956029e-02   -7.799644691089824e-01   +6.431486032937147e-01   +1.598460629485057e-01   +3.823286737200396e-01   +5.411412062892896e-01   +6.696702726147674e-02; +3.050247778231213e-01   +1.162711195365253e-01   -6.306256340120096e-01   +5.021206027094568e-01   -3.327257980073642e-01   -3.443599119036866e-01   -8.556865078349206e-01   +4.181749384046185e-01   -2.432126647444171e-01   -2.126948905142264e-01   +5.873084350621679e-01   -5.600814306105482e-01   -2.151081506325191e-02   +2.865683072767067e-01   -4.114640778449792e-01   -2.650592492033393e-01; -4.327227938537552e-01   +1.826780651189319e-01   -7.631530095012395e-02   -4.395545133286295e-01   -3.959336226400409e-01   +3.426302618541368e-01   +4.423457609641307e-02   +5.106751693589070e-02   +4.756087983491255e-01   +1.060521612456543e-01   +3.098740010716171e-01   -7.244869745021221e-01   -1.378195926372269e-01   -6.827588442922456e-01   -4.471678670299807e-01   -5.182231239953777e-01; -3.553513055049843e-01   -2.767223452055495e-01   +5.625925850688221e-02   +6.203951580332724e-01   +1.207899050463609e-01   +2.782319598452345e-01   +5.288414844183472e-01   +7.547797905642363e-02   -3.014581145916480e-01   +5.386347652711663e-01   +3.003818837874744e-01   +4.345446716059354e-02   +7.590247413049682e-01   -2.441905083249540e-01   +3.189343779592534e-01   -4.654362462941031e-01; -2.158587982868420e-01   -4.154442061689184e-01   -6.614216632118911e-01   +4.909371273142517e-01   +5.180035877825681e-01   -4.706903439741204e-01   -4.361144204693462e-01   +9.629726209306572e-02   -2.535542614914802e-01   +1.974119614645282e-01   -2.079943852044087e-01   -1.435875879446681e-01   +4.816764470542826e-01   -3.629831635059825e-01   +2.180040464289233e-01   -5.874547229971933e-01; -2.195135263360133e-01   +3.957253209627571e-01   +3.677339264542760e-01   +3.262251553618805e-01   +2.492540487060289e-01   +2.056670204100104e-01   +1.189704454909397e-01   +2.275709224357609e-01   +4.599817257671667e-01   +1.391312553922244e-01   -3.626512945450445e-01   -7.228314068764105e-02   +8.121402325207491e-01   +1.080705590065768e-01   -8.542632856875152e-01   -1.631398907024700e-01; +3.568537414041111e-01   -3.276599398696016e-01   +3.223899680711853e-01   +3.351598727214538e-01   -6.453043361179118e-01   -1.938531323321916e-01   +7.117972535906673e-01   +4.636378239775369e-01   -1.647895847138349e-01   -4.698110952895565e-02   +5.028138374896767e-02   +3.621254246572161e-01   -1.129295120747347e-01   -3.787288728831384e-01   -6.192306171746020e-01   -3.889660311478359e-01; +4.405459596276358e-01   -2.742456618507432e-01   +5.064131401426626e-01   +6.731800646375619e-02   +5.111310585217738e-02   +4.496789848417909e-01   -2.069082184119973e-01   -4.799007405238379e-01   +8.658496511943251e-01   +1.078415843027499e-01   +1.762236283439652e-01   -1.000000000000000e+00   -6.220284841454987e-02   +8.480577655585318e-02   +4.948805473294372e-01   +5.087667540510882e-01; +2.229852631223696e-01   +4.978293950027163e-01   +3.205860793760763e-02   -1.493985081419518e-01   -6.284402094288281e-01   +9.583658167760770e-01   +4.717023030654944e-02   +3.955788697562844e-01   -4.393642398196703e-01   -3.150049902031118e-01   -9.250575888279121e-01   -4.798879669114833e-01   -5.057847995880359e-01   +6.934461967233474e-01   -1.706836873206948e-01   -2.689742125010782e-01];
L2I_L1I_iGABA_netcon = [-2.720202985815895e-01   -2.681005975650352e-01   +4.129605115405466e-01   +9.135989204394916e-02   +1.819976119743362e-01   -1.058562079509981e-01   +1.062966548021948e-01   -2.289858016067378e-01; -7.683404128304712e-01   -3.491769099739093e-01   -8.478717071586218e-01   +1.694804103439974e-01   +3.169662247407717e-01   -4.309759214782299e-01   +4.057382508157522e-01   -2.931161917859964e-01; -3.957871031307357e-01   +1.712224817830332e-01   +1.307651680342329e-01   -2.379065643684921e-01   -2.094387814466481e-01   +2.309813392157835e-01   +2.931739787002088e-01   -1.716381895602399e-01; +9.876753185357151e-02   -1.686768195770471e-01   +1.946248733525210e-01   +3.444500690636729e-01   -1.183092131233456e-01   -3.617929356155257e-01   -4.542200607839400e-01   +4.444570602857242e-02; -5.360089576577267e-01   +3.190262589917868e-01   +4.118156379460641e-01   -1.188122751043591e-01   +4.869421413281714e-02   +6.015875467895998e-03   +1.000000000000000e+00   -2.848343270771989e-01; -8.873413549626856e-02   +1.217015470562277e-01   +8.444109616873036e-01   -2.588592891762754e-02   -2.352591089117379e-01   -2.649694771534002e-01   -3.870386106189027e-01   -4.062491073872516e-01; -5.237685911269254e-01   +9.081876514212055e-02   -4.829113716974253e-01   -4.322512623960226e-01   +3.858106876920037e-01   +1.364076594217057e-01   +4.592677615905845e-01   -3.253107868724903e-01; +4.563500518718834e-01   +3.044463381909919e-01   +9.895681903542386e-02   +2.366120685054547e-01   +7.268706062156847e-01   +1.574296764830988e-01   -1.615658726131030e-01   +1.735807073939493e-03; +1.658507109784346e-01   -1.368547909626946e-01   +3.249916901224220e-01   +2.107228295605911e-01   +2.254119836349183e-01   -5.658132074044673e-02   +1.753964501744464e-01   -1.798198908326607e-02; -3.189861963614609e-01   -8.997300064040378e-02   -2.165652807299164e-01   +3.217416103680567e-01   +6.486777743120482e-01   -1.135018630222188e-01   +1.162588522727531e-01   -2.697667808775494e-01; +1.260102254375776e-01   +7.194632848811611e-02   -1.660405332039999e-01   -2.938060840790946e-01   -6.244479101439238e-01   +3.509834687781370e-01   +1.142450389259645e-01   +4.061936499722849e-02; -4.749900122033306e-01   +5.032968525184282e-02   +8.839733640458081e-02   -5.994351284417105e-01   +7.458170049439543e-02   -2.508181644677500e-01   -3.119500594359706e-01   +2.588389510287500e-01; -2.265940215549092e-01   +2.742949901055479e-01   -8.070616823611325e-01   -2.713139160784539e-01   -8.710435048379089e-02   +2.509528455678724e-01   -2.596467131745213e-01   +2.870452251661461e-01; +2.233565715543351e-01   -1.901256685931197e-01   -2.054776581082602e-01   +1.278552280416759e-01   +5.222504166479561e-02   -3.679446150883637e-01   -1.576535070116685e-01   +9.298453891337913e-02; -3.675217326284905e-01   -1.832127838117470e-01   +4.187821875395951e-01   +1.493721190689554e-01   -2.106675936066790e-01   +5.133693906202948e-02   -6.355151560055000e-02   -1.531121266188727e-02; -1.743597830953316e-02   -7.845599024479636e-01   -1.401739041539666e-01   -1.523807940017855e-01   +1.202909346111810e-01   +1.380588195398910e-01   -1.744438280892991e-01   +7.364516945187713e-02];
L1I_L2I_iGABA_netcon = [+1.220518181713525e-01   +2.981791226651124e-01   +1.857342673796165e-01   +5.812646469812699e-01   +3.241887719280395e-01   -7.577173980839821e-02   +4.973303465265183e-01   -9.778079555541912e-02   +2.528511924984971e-01   -3.647199677521992e-01   -2.484224276180262e-01   +4.541378799882170e-01   -2.824262815055186e-01   -6.241022456442726e-01   +2.214534259589577e-01   -1.709254535090125e-01; +1.038365695947394e-01   -2.174152125388865e-01   +6.467243504328537e-01   -5.421028902547382e-01   +5.157063085911077e-01   +4.987330569005263e-01   +8.302715400664278e-01   -7.175885008603474e-01   +1.249518287974968e-01   +7.834213487860227e-01   -7.635203456856341e-01   +7.657302817095452e-02   -7.320813778940544e-01   +3.751209314238960e-01   +1.728668552103638e-01   -6.131165106896326e-01; +1.434453523916365e-01   +4.914881249330607e-01   +1.116297871456897e-01   +7.073620927149482e-01   -4.507420737525567e-01   -2.269949193874254e-01   +4.292400343177490e-01   -1.467583707646432e-01   +1.438780911911436e-01   +5.756549006284293e-01   +2.594813352403780e-01   +4.854861410278581e-01   +4.473081671666370e-01   -5.168884969572909e-01   -2.505953459067368e-01   -1.785357830177627e-01; -5.089914191038205e-01   -7.705983022173239e-02   +4.214963188497124e-01   -6.639425313843397e-01   -7.737257973477641e-01   +2.623546067830471e-01   +2.270018764132483e-01   +9.194399818526236e-02   +5.583818533627234e-01   -2.068925881971987e-01   +2.919935405952264e-01   -1.003606802295723e-01   -9.523967581101966e-02   +1.775391570756149e-01   -2.621402808391436e-01   +4.747378122365006e-01; +2.420258947254179e-01   +1.668651013425004e-01   +3.835920595092510e-01   +9.226186922029182e-02   -7.974862979054791e-01   -4.372679347458160e-01   -3.587421827793597e-01   -1.269281604419525e-02   +1.507822617717602e-01   -3.228925956233039e-01   -2.522629306353823e-02   -5.966165847991057e-01   +1.105425106860849e-01   -8.009204835889224e-01   +4.154718760806768e-01   +6.408340414964547e-01; +6.029311717151648e-02   +2.013276337121866e-01   -5.744598058100601e-02   +5.400685957672746e-01   +1.460904317245299e-01   -1.341926334965214e-01   -2.840854560402519e-01   -8.202832748702570e-02   -5.080347583346514e-01   +2.458585559113432e-01   +7.457690683856931e-02   +1.236348599520610e-01   -1.718549785226689e-01   +1.256217086975223e-01   -8.449135806548844e-02   -9.975237984713398e-02; +2.719786295104768e-01   -1.610128145473139e-01   -2.187191671180133e-02   -1.819136103995702e-01   +2.565822993974221e-01   +3.684818757258391e-01   -1.190882944713641e-01   -8.754841195319477e-02   -2.166972781532913e-01   +2.975667856787866e-01   +1.218164214185470e-02   -1.000000000000000e+00   +3.683541685164135e-02   -2.671648353263485e-01   +4.391105696926923e-01   +3.910861965074501e-01; +1.674037323495616e-01   +1.129680814932301e-01   +2.386595605811146e-01   -3.575429192784708e-01   +1.934424232217247e-01   -3.384049573967724e-01   +2.809467683394198e-01   +4.606430098207790e-01   +5.502141294743924e-01   +3.925832892976851e-02   -3.370396476893692e-01   -3.225274454058615e-01   -6.863649882148002e-01   +6.952097928019602e-01   +5.064691055428050e-01   +1.858335740463541e-01];
L2E_L1E_iAMPA_netcon = [-1.376698539803793e-02   -4.170472624531105e-02   +3.208118104065533e-01   -4.896616576439669e-01   -6.141780067523310e-01   +2.623828138153984e-01   -2.028328463763334e-01   -1.005800146616534e-01; -5.039314067168533e-01   +6.217201184137677e-01   -6.017375678374982e-02   -2.684460699667778e-01   -4.961033148130928e-01   +1.334579059081482e-01   +2.375325965500379e-01   -2.053572481311656e-01; +6.006979094565985e-01   -7.506246670745826e-01   -3.236643097972878e-01   -2.094115790682126e-02   -6.190363770699101e-01   +3.829231044241677e-01   +2.193870753513095e-02   +7.219296230308074e-01; +1.704283339689088e-01   +3.646317946562032e-01   +1.220240127556996e-01   +4.153391904560875e-01   +9.378344661097915e-02   -1.907499524353791e-01   -4.332621703727119e-01   +5.715849075932444e-01; -7.303461535417957e-02   +1.604929075841522e-02   +1.462160847853392e-01   -1.246823653803300e-01   +7.523535765766778e-01   +8.404990972985273e-02   -3.173016710313474e-01   +1.780739247899170e-01; -3.110060677687291e-01   -1.061952832284990e-01   -8.162327572518306e-01   +2.117552447764619e-01   +4.314693785009711e-01   -3.077212161517233e-01   -1.244296053703800e-01   -2.102931202380280e-01; +2.991539530339425e-01   -6.110652215951603e-01   +1.351841481810214e-01   +2.310942871027001e-01   -2.240521844019588e-01   -1.249106234974164e-01   -7.173766343549290e-02   +6.393663809097245e-01; -4.270996134427388e-01   -5.589125810826249e-01   -2.958895722291566e-01   +5.344911371372387e-01   -3.977150125968705e-01   -8.762705313056838e-01   -3.310366327637755e-01   +3.298658491136212e-01; -1.214453074652894e-01   -4.572696115651086e-01   +5.457634543177553e-01   -2.540004930363878e-01   +5.455904611436138e-01   -3.854680766340984e-01   -4.020387633685545e-01   +6.280988088445011e-01; -2.417735390968310e-01   -5.796756677641008e-01   +2.670912947284933e-01   +3.690978414949889e-01   +3.648716074488120e-01   -2.132629531947642e-01   +2.315925452130231e-01   +2.049733537456644e-01; +1.434307064735322e-02   +6.182396634002921e-01   +2.610389298376131e-01   +5.998462783747209e-01   +1.017529420307100e-01   +5.144090862466518e-01   +2.850618339390720e-01   +3.618711837415143e-01; -3.493679933702233e-01   -5.160890836154985e-01   -9.843361544251852e-02   +4.929052981123767e-01   -5.193116900345099e-02   -5.504722692331248e-01   -2.829036778937828e-02   +1.165289318394071e-01; -1.000000000000000e+00   +1.204667161994681e-02   +3.808127491797552e-01   -3.274462622263532e-01   +1.344094411861842e-01   +2.455668181926373e-01   -1.988704277014841e-01   +2.179975875075994e-01; +7.928053737926753e-02   +8.257065936625992e-02   -3.601778842988849e-01   -1.297030580699264e-02   +4.830307906095814e-01   +1.610702165348876e-02   -5.067993719003487e-01   +5.092205590565866e-01; +7.128375648107846e-01   -4.677444435667432e-01   +1.716141890289507e-01   +2.370613378589993e-01   +4.315204170514891e-01   +5.636929759340572e-01   +2.623329071595769e-01   -2.526326430368813e-01; -4.821601143480427e-01   -9.184337455858460e-02   +8.594009951046956e-02   +1.229738471356737e-01   +5.586288916195092e-02   +1.070993100240642e-01   +5.446043860274550e-01   +3.771846053707628e-01];
L1E_L2E_iAMPA_netcon = [-2.647102915515340e-01   -4.973979668272734e-01   +5.123159035153615e-01   -4.977405838572763e-02   +3.546810287805363e-01   +7.627762103317840e-01   -2.287195710904662e-01   -1.463325583408936e-01   +1.401932329457050e-01   +5.739746925078432e-02   -7.838579152077187e-01   +3.300191116352645e-01   +3.925738478261275e-01   +3.008022221576510e-01   -7.404242992318566e-03   -1.891732206340766e-01; -7.618883114997713e-02   -1.477148604516553e-01   -3.261481814642765e-01   +2.745778588190806e-01   +5.137419985311069e-01   +3.803482164285492e-01   -4.497310090782425e-02   +7.106430166089366e-01   -2.795773657769043e-01   -7.612488777979030e-01   -3.100369147187309e-01   -3.930558628555482e-01   -9.850370394442337e-01   -6.168225167139507e-01   +6.750247429856472e-01   -6.533566651154661e-01; -1.315013500314636e-01   -2.507675389748560e-01   -1.121042832435289e-01   +6.262447080318003e-01   -2.098372102804808e-01   -2.352599799109129e-01   +1.899228788101509e-01   -7.019729070675171e-01   -5.049226054620982e-01   -7.039608499298152e-01   -1.490649479520113e-01   +2.196973714840844e-01   +1.502431435227015e-01   +4.303943471008033e-01   +1.813678050352339e-01   +2.064028214053330e-01; -1.713350240489820e-01   -1.660789238675273e-01   +5.160465226888067e-02   +1.456436180442253e-01   +3.237428798690717e-01   -5.180775004272613e-01   +7.321520159398412e-02   -4.970542393510096e-01   +1.066368311053703e-01   -1.261705558615088e-01   +8.544493820331005e-01   +1.251348326243487e-01   -4.497463741320606e-01   -1.275397112402460e-02   +8.349417175360069e-02   +8.205829024708127e-01; -6.617749151405437e-01   +1.670567494949903e-01   -1.664308802935228e-01   +3.906318984750859e-01   -9.745094165002584e-01   +2.098657806632144e-01   +3.201768155161242e-01   +8.056783513797557e-01   -6.969778038916279e-01   +6.426034322497032e-01   -2.932710179699588e-01   +5.982275932207042e-01   +5.573363539224070e-02   -3.323394219420429e-01   -5.986195619497214e-02   +2.678889399809622e-01; +7.540252465414254e-01   +2.109316778305606e-01   +8.825015028064248e-02   +2.062753822917647e-01   -1.902340964305808e-01   +1.218649657203030e-02   -2.971908411982854e-01   -4.921532922975057e-01   -9.335378141299182e-02   -1.819940516243897e-01   -5.705470368447376e-01   -5.149248750348909e-01   +8.542433416002453e-01   +2.361664263096482e-01   -1.093814873158388e-01   +3.892839212657553e-01; -4.306353499187267e-01   -2.500090064415732e-01   -4.095577397493898e-01   +1.029247366766202e-01   -5.733482578305217e-01   +1.854687875121497e-01   -1.554829758407528e-01   +1.965657692447025e-01   +5.816407357010844e-01   -7.275619527950812e-01   +6.711579437392889e-01   -1.294541729402852e-01   -1.397467937383505e-02   -4.229417314764894e-02   +1.508253661795969e-01   +2.188736874520216e-01; +9.595369112478846e-01   +2.513091438008778e-01   -7.651860954206769e-01   -1.010984779261380e-01   -7.850115129625219e-01   -1.070290201206698e-01   -3.691698889249119e-01   -6.121899344940458e-01   -6.650519092856844e-01   +5.416162716201691e-01   +3.727841461214306e-01   -6.458783687974251e-02   -2.220663875377230e-01   -5.669167373625109e-01   +4.354554409554301e-02   +3.432172837400410e-02];
L2I_L2E_iAMPA_netcon = [-2.727057374267681e-01   -5.298333494324227e-01   +2.055800469007757e-01   +6.993387406343613e-01   -1.075706533096902e-01   -8.187507672277641e-02   +1.693936441063161e-01   -3.513720624810468e-01; -4.915476702472458e-01   +2.714924607238835e-01   -1.000000000000000e+00   -1.790305377284638e-01   -2.736584812875158e-01   +7.068703514078926e-01   +1.477092742255331e-01   -1.039424360567495e-01; -4.588857180047445e-01   +2.001336576400071e-01   +2.192122845227862e-01   -2.459060479099252e-01   +1.964272542450261e-01   +2.531909155269060e-01   -7.290724779025078e-01   +4.539152438325356e-01; +2.853298459989549e-01   -8.560372712379899e-01   -9.168308561297545e-02   -1.400786256199409e-01   -3.278514423573922e-01   -2.088038952349829e-01   +2.866467581050769e-01   +9.617843941940743e-02; -4.768696427020524e-01   +5.136970047374102e-01   +5.906719448517351e-01   -2.428559481930027e-01   +2.840097708086164e-01   -4.344717585610436e-01   -5.927512324130908e-01   +1.601163742545806e-01; -4.075805073537295e-01   -1.961152734041711e-01   -1.469169250672482e-01   -1.443507204625656e-02   -3.697492695448102e-01   +8.321600473735470e-02   -3.730339187656880e-01   -2.654329926769807e-01; -2.540931476216737e-02   -4.937059826744638e-01   +5.882364900945309e-01   -1.004428541176704e-01   -5.852711702539487e-01   -1.587697870736487e-01   -5.169372028398110e-01   -7.505930745188331e-01; +9.130787967052097e-02   -4.901957742559166e-01   +2.463649128381232e-01   -1.222473377902874e-02   -1.426842630322662e-01   -2.187644795794375e-01   -3.022517132252985e-01   -4.275353955244224e-01];
L2E_L2I_iGABA_netcon = [-8.330074065954637e-02   -3.477127677845580e-01   -5.454975982635493e-01   +1.392266772598043e-01   +3.302123515485617e-01   -2.890593567351608e-01   -3.050990260750122e-01   +3.570590474418270e-01; +1.764545035797255e-01   -1.180371987025758e-02   +2.634948382828836e-01   -6.671249487050923e-02   -5.466923301441383e-01   +4.195852862516880e-01   +1.290463133293847e-01   -1.703761351116923e-01; +9.200862445305125e-02   -3.077299873679558e-01   -5.998240971476221e-01   -1.119685388969033e-02   +2.533079266855176e-01   +3.273807879951683e-01   -2.338296515936851e-01   +2.648982391942931e-01; +3.255519885754945e-01   +5.209563265476425e-01   -6.145691634774385e-01   +5.033630844523129e-01   -3.913203201228048e-01   -3.651254147340861e-01   +4.440024253143526e-02   +1.300837476648292e-01; -1.638096306690825e-01   +3.188820954545996e-01   -4.212128878063674e-02   +1.239826475799492e-02   -4.474455594674331e-02   -2.041088802676571e-02   -8.936435325025247e-01   +4.698817857408468e-01; +3.370199519295684e-01   -2.126044951998001e-01   +2.183618416369312e-01   +3.406991494039631e-01   +2.711718542380283e-01   -6.255857251068171e-01   -1.606979762472275e-01   -1.459393040579803e-01; -4.992697030834265e-01   -1.525113118514272e-01   -4.671547830160306e-03   -6.672159343259751e-01   -6.096580149426923e-01   -1.695745070028823e-01   -4.279879518806073e-01   +2.233630273258786e-01; -6.649339112236123e-01   -2.797620053196956e-01   +7.592822934266311e-01   +2.176295601719282e-01   +6.650196972524429e-01   +5.431234565284229e-03   -1.600995613942919e-01   +1.000000000000000e+00];
L3E_L2E_iAMPA_netcon = [-2.458340222939751e-01   +3.870970086787843e-01   -5.872164128044000e-01   -1.667545857955295e-01   +2.668319710569047e-01   -1.826806049388149e-01   -4.993851900140936e-01   +8.782660406852105e-02   -1.225135913106478e-01   +1.467118171539598e-01   +2.447513659698589e-01   +8.467698296088768e-01; +2.511253957853624e-01   -3.354186630253189e-01   -1.919027153763894e-01   -1.180672152740470e-01   +7.261113913231132e-02   -4.270233568722703e-02   +4.598658595561674e-01   -8.233595008831832e-02   +7.882668897011547e-01   +1.149049530200727e-01   +5.088864386223604e-01   -4.610532632833836e-01; +4.383549694449517e-01   -3.875931125325084e-01   -2.487836954762106e-02   +2.999079465616312e-01   -6.657177324860717e-01   +5.239538588330196e-02   +6.053771872184707e-01   +1.835270417289491e-01   +3.868725705516256e-01   -5.231386208650406e-01   -6.064509137908856e-01   +1.391439671907659e-01; +5.999629037700052e-01   +2.528575851102118e-01   -2.335633124402095e-01   -3.555030530759390e-01   +2.017193873925547e-01   +6.300283942560769e-02   -4.602768382710318e-01   -3.059334839182536e-01   -4.281986487607843e-01   +2.332140056306134e-01   -6.567813691217164e-02   +3.778535397477421e-01; -7.496566444695476e-01   -3.391208242100123e-01   +9.624101691917661e-02   +9.834105583553182e-02   +7.622098467732699e-01   +3.928495884354601e-01   -7.333506427180616e-01   +6.094330003065884e-02   -5.326009201380542e-01   +2.653276230858367e-01   -2.387091826035329e-02   -1.602772157365143e-01; +5.882344089837612e-01   +3.132308868988923e-03   -6.527996290851764e-01   -8.071604138901939e-01   +1.709699325805723e-01   +1.532519530812952e-01   +3.724418220936597e-01   -4.484621869351025e-01   -5.865840652300622e-01   +6.074336098924914e-01   +6.223178517825094e-01   +6.145395445143448e-02; +3.754631284832616e-01   +3.937528531334613e-01   +3.087874054025319e-01   -4.461628697506758e-01   -8.235417818365718e-01   -3.900416942452423e-01   -4.801530518322003e-01   +4.318426733229391e-01   -5.119743825913716e-01   -7.294013150695912e-01   -5.521784673166092e-01   +5.039464511395790e-01; +1.961569193509466e-01   +8.776878758363860e-02   -2.830377665487546e-01   +1.675120886935152e-02   -4.813058133306279e-02   +5.909662156201347e-01   -4.302761920303759e-01   -1.857652194717463e-01   -3.443417508451797e-01   -2.142313504010789e-01   -2.798063097627778e-01   +6.216567865961748e-01];
L3I_L2I_iGABA_netcon = [+4.018156824323074e-02   -5.843969638700277e-01   +3.991110690454269e-03   +2.755804296541010e-01   -3.810878295309476e-01   +1.442113121556163e-01   -1.003950789784505e-01   +1.153063523849094e-01   +3.210128319949273e-01   -5.073869364585165e-02   +3.620045706832336e-01   -7.224215192067625e-01; -5.241556058927100e-01   -3.715827355303480e-02   +1.061525044628751e-01   +5.260775390016506e-01   -3.036832197901196e-01   +4.615441920415179e-02   -2.119933971060676e-01   +7.337701050660854e-01   +2.949811146905109e-02   +1.764606101544105e-01   -9.753564937313007e-02   +2.386786566498496e-01; -2.325279560700716e-01   +4.058434960800053e-01   +9.603120058878192e-01   +1.301317493450547e-01   +6.385851190631248e-01   +5.642563917511348e-01   +1.882784333726149e-01   +2.216348477964043e-01   +3.494382488004331e-03   +3.115348609692924e-01   -5.263057168758023e-01   +5.880836147583686e-01; +6.216556175228993e-02   -6.081078398515143e-01   -5.489389284457606e-01   +4.825150728140193e-01   +1.739998456863414e-01   -1.565253786004717e-01   +1.466540709392349e-01   +1.693857412277113e-01   -3.587645574629269e-01   -8.302756612472645e-01   +4.409296846737021e-01   -5.629412133417915e-01; -2.353752041021397e-02   +9.628021846336386e-02   -9.231442085412483e-02   +5.249294683671167e-01   -7.500136700699405e-03   -6.847793534042552e-01   -6.549671538214570e-01   -5.182238599074608e-01   +2.855148685021471e-01   -4.120738366701359e-01   -1.088915819381762e-01   -4.291090856765173e-01; +4.852287505368947e-01   -8.770428049029146e-02   +2.086009336037999e-01   +4.927011658976035e-01   -3.551231368064934e-01   -2.179885556040192e-01   +7.319592555687466e-01   -2.766869432878358e-01   -1.000000000000000e+00   +1.218479594727397e-01   -7.972733964187224e-01   +6.737297844980876e-01; -1.209532172906276e-01   -2.086685699179922e-01   -8.501386795558711e-01   -5.349171988534278e-01   +4.472485548285237e-02   -8.320017870012035e-02   +4.797297914163364e-01   +7.025642834834420e-01   +4.566787170821832e-02   -1.520073743236995e-01   -6.975111152440107e-02   -4.876676207262223e-01; +3.294906211152727e-03   +2.845362206931482e-01   +3.711746143921364e-01   +9.407415615059651e-01   -7.893829006755894e-02   +2.528288154941009e-01   +7.241102213568564e-01   -1.544175327036137e-01   -5.861079083602299e-01   +4.765352294496092e-01   +6.345332081801631e-02   -2.440905150286733e-01];
L2E_L3E_iAMPA_netcon = [+4.961154011636921e-01   +9.818378311175843e-02   +7.742349877119978e-01   -4.424049719905747e-01   -1.391156669654306e-01   +6.327140521855295e-01   -3.409385041886052e-01   -3.880294636360520e-01; -6.275007036839046e-01   +4.721212844621580e-01   +4.272452873720039e-01   +1.546710787317457e-01   +1.724402285700154e-01   -5.383882940549852e-01   -1.814190599119309e-01   -3.396671988049098e-01; +3.937778335068826e-01   -5.609739037894539e-01   -1.463241188163857e-01   +8.266053337379464e-03   +2.713378849338547e-01   +4.020092103149642e-02   +2.400982008204157e-01   +2.411832137206575e-01; -4.172124239936873e-01   -1.733579914651433e-01   +4.803326252231384e-02   +1.314181850848672e-01   +1.296151394624768e-01   -1.000000000000000e+00   -1.983632274146997e-01   +1.749805718141581e-01; +2.558885689841883e-01   +4.041965785204800e-01   -3.830516492130275e-01   +3.410024250229010e-01   -1.329227877782047e-01   +7.920624335332438e-03   +1.441712251635853e-01   -8.692443241247474e-02; -3.795600716553572e-01   -3.468372336673561e-01   +5.237453059861001e-01   +2.959537898867087e-01   +1.643827191587636e-01   -2.033549242315596e-01   -5.097654513945747e-01   -6.441451764041997e-01; -1.316228484097429e-01   +1.371232221586356e-01   +1.943899446083419e-01   -3.367066621237695e-01   -1.218919644101954e-02   -4.906030486790849e-03   +3.432852009033758e-01   +3.804992824342920e-01; -1.633888914050571e-01   -1.044287562833713e-01   +5.990334619760331e-01   +4.800513142951648e-02   -1.314187365158809e-01   +7.956953171694542e-02   -6.154228681990582e-01   -6.284509299296931e-01; +1.809780225805726e-01   +3.901111466994476e-01   +6.592278734070426e-01   +2.610658179897092e-01   +1.205509717972292e-01   -3.961605657002148e-01   +2.865085676191061e-01   +3.967020279677100e-01; -6.193351061833947e-01   +4.269288726650803e-01   +5.065588916191773e-01   +4.097920776165548e-01   -1.922712293764394e-01   +3.116809325080087e-01   +2.228583029813799e-01   +4.841062589455920e-01; +1.179246453691772e-01   +4.893629789351583e-01   -8.045274192525174e-01   +2.262650032155533e-01   +3.159300597766569e-01   -1.469538965989837e-01   +4.746046702128307e-01   +3.346147834110790e-01; +2.711290329913597e-01   -8.365811603060898e-02   -8.838979282945794e-01   +6.403640912817072e-03   -1.163119466717190e-02   -8.877247378983349e-02   -7.780485492605174e-01   +1.461893589547271e-01];
L2I_L3I_iGABA_netcon = [+1.263955980563256e-01   -6.223140479474873e-01   +1.731482507085843e-01   +5.105107398545439e-01   -4.404686952075308e-01   -5.954888985956712e-02   -2.764599706602883e-02   +6.756866553827283e-01; -3.893023539271792e-01   +7.103044505945231e-01   -4.598231602071098e-01   -9.841107270726694e-01   -8.112188075100075e-01   -6.656716940050535e-01   -4.446661673812995e-01   -7.557527820108539e-02; +8.512603422996152e-01   -3.702684900877733e-01   -1.013150437455115e-01   +5.005313200946506e-01   -6.116022753841890e-01   -5.900348521477601e-01   -3.194792818372812e-01   +4.873588033385615e-01; +3.630546822283905e-01   +2.574564974851315e-01   -3.124355199309237e-01   -4.437538610312664e-01   +3.123510713681861e-01   -1.990674392308946e-01   -2.368520859399365e-01   +5.203014443764203e-02; -1.430536203082708e-01   +7.439769790841277e-01   +5.198043366704356e-01   +8.965326453626701e-01   -3.907070400559165e-01   +3.491567788407076e-01   +7.298600856223685e-01   +8.687279017042118e-02; -3.082751401951453e-02   +5.445822961572292e-01   +2.730217953668064e-01   +9.769208105420187e-02   +1.593290321879959e-01   +3.468352948962216e-02   +2.878384711561716e-01   +2.341761167615677e-01; +8.269651992163622e-01   +5.746797308883009e-01   -1.849846524567977e-02   +2.200898173445635e-01   -3.149452921529338e-01   -1.420072252263788e-03   -3.730989483175523e-01   -1.146344010239966e-01; -4.036951473166984e-01   -5.263662434007770e-01   -2.172644050410608e-01   +3.448638357400179e-01   +8.365209883497433e-03   +7.349571510020324e-01   -8.037012036871427e-01   +8.347255495531421e-02; -2.803018433226863e-01   -1.898014589314069e-01   +3.128871673178851e-01   -1.069322998551895e-01   -5.139989053548794e-01   -1.713181556177974e-01   +4.699737266749451e-01   -2.049362392936232e-01; -6.177943169980561e-01   -8.243488718239078e-01   +3.975566020070750e-01   +5.894311489505071e-01   -5.237600962341659e-01   -1.465382002297721e-01   -7.379328259541018e-01   -7.334504001084571e-01; +8.124321835442523e-01   -6.837115418996933e-01   +8.542035554291424e-01   -1.945447166583185e-01   -2.219920330892587e-01   +3.365197271171963e-02   +3.373180384279981e-01   +5.160146633250320e-01; +2.821007765499621e-01   +1.245524696400406e-01   -7.035513455212106e-01   -1.245734784772110e-01   -9.706655400539330e-01   -4.403536635931521e-01   -3.330563499074413e-01   +5.894168477806510e-01];
L3I_L3E_iAMPA_netcon = [-6.238816388215953e-01   +9.642969585720329e-02   +4.949228709323839e-02   +6.863982057515313e-01   +7.724620936471601e-03   +1.485175524884139e-01   -3.241529299079460e-01   -3.285174563888120e-01   +4.093578350101540e-01   -2.399530483410716e-01   +5.014175112217036e-02   +3.706043221858165e-01; +1.930749151915752e-01   -5.263066629430179e-01   -5.490250162120499e-03   +2.117880580883323e-01   -2.144356096833848e-02   +2.476190306860126e-01   +1.181551874727744e-01   +1.426458548598131e-01   -7.039298028984818e-02   +6.233300687456007e-01   -5.068353650063867e-01   +5.400979010919496e-01; +3.264545739288569e-01   -5.874120217138005e-01   +5.476594756444862e-01   +4.993208764435357e-01   +8.570776928698756e-02   -1.643314847825655e-01   -1.362469334761928e-01   +3.742294301689851e-01   +3.475354347857435e-01   +5.842492650903821e-01   +1.939070780698200e-01   +5.618373847260641e-02; +4.458379413481002e-01   -8.009738542419272e-01   +3.985731485013126e-01   -3.430351466825226e-01   +1.139242545820053e-02   -1.404744327259941e-02   +2.143544582637890e-01   -1.964135923465159e-01   +4.273108411643008e-01   +5.396364136396626e-01   -6.956266280401507e-02   -5.264601528435761e-01; +3.945593094650444e-01   -6.092341398509120e-01   +1.954722336605150e-02   +2.686897240913154e-01   +6.483201030757070e-02   +2.688114581637716e-01   -2.703048459187593e-01   +1.838518923719654e-01   -3.376715457418508e-01   -6.784385264415068e-01   -1.127477282420012e-01   +5.781684230874719e-02; +3.313481239688058e-01   -3.884589742690191e-01   +5.580767072894578e-01   -4.239872828943603e-01   +1.777484895389302e-01   -7.052218032238120e-01   -2.334990902278424e-01   -4.777650683737851e-01   -4.999760211841514e-01   -3.831497351917520e-01   +7.818378022800366e-01   +3.750724079906735e-01; -9.081482997323176e-01   -1.401898406127988e-01   -6.326540356203842e-01   -5.849655172544277e-01   +4.677464975535862e-01   -4.967850566416675e-02   +1.134716179042514e-01   +4.802574364507448e-01   +7.758099675220225e-01   -1.701120623490111e-01   +7.575728793641485e-02   -6.374701288280328e-01; -2.747323010968003e-01   +2.095652042037264e-01   +3.072526865717819e-02   +4.626243544003162e-01   +6.967441533272271e-01   -5.781964083441424e-01   -4.808635133672757e-01   -7.092821788645137e-02   -2.246580015893587e-02   +1.407827295391756e-01   -2.166208629037177e-01   +7.178886213343506e-01; +3.652626405336376e-01   -1.148487815408224e-01   +2.023396181982065e-01   -1.000000000000000e+00   -9.018223871847104e-02   -5.541352422098293e-01   +4.535532215048371e-01   -1.079533731616030e-02   -9.287052197803834e-02   +9.123780382916842e-02   +1.417211934084395e-01   -8.478393662982492e-01; -2.357376089258272e-01   -1.723766789978120e-01   -7.439892678930722e-03   -2.560044262036764e-01   -7.149445111222111e-02   +6.574108558944505e-02   +9.080857736859512e-03   +6.208605278301872e-01   -1.528321601749869e-01   -1.603122292491405e-01   +7.594068863947916e-01   -1.166009301674207e-01; +3.026865594787220e-01   +2.211422378588697e-01   -5.588533193309183e-01   +4.075662953210356e-01   -3.081250632341785e-01   -5.898679298439321e-01   +4.936712159828578e-01   -5.270338066358299e-01   -1.520275282258701e-01   -1.472206285410605e-01   +2.321629094737749e-01   +4.577952865870799e-01; -1.928460693329871e-01   -2.272049256254941e-01   -3.945593509249745e-01   +4.095918279893648e-01   -8.562229835979568e-01   -1.277862794894797e-01   -2.626186319941965e-01   +5.010134156899982e-02   -3.783305243350817e-01   +1.813601295894094e-01   -2.716392871211071e-01   +1.080203854584378e-01];
L3E_L3I_iGABA_netcon = [-1.718552460676061e-01   +4.235702391397561e-01   -8.188296899800849e-01   -9.234002983471516e-01   +2.751823825362774e-01   +5.686597858012288e-04   +4.643373268970526e-01   -3.799187486428215e-01   +3.208885613716794e-01   +3.107569471178113e-01   -4.666620287396721e-01   +7.520979549573490e-01; +2.411110857527994e-01   -6.324882253706149e-01   +3.425815647041618e-01   +3.029459207822516e-02   +1.626856992062418e-01   -3.961649677164306e-02   +1.843865393725008e-02   -1.993888674344490e-01   -3.358577544169739e-02   -9.439947498091314e-02   +1.775888121414697e-01   +2.415630795193180e-01; +9.668268827222906e-02   +2.728442209416903e-01   -1.589755583954344e-01   -2.531801317162630e-01   -1.437684568756732e-01   -2.632745250634848e-02   -6.379368304310480e-02   +3.120213751362362e-01   +2.777455983884408e-01   -6.651089747529606e-01   +3.826300834058963e-01   -1.684705780254086e-01; -1.473418686155343e-01   -2.802469564705040e-02   -2.047058404662679e-01   +4.885508099966411e-01   +3.653974513895714e-02   +7.199344783972773e-01   +2.446110539930779e-01   +8.543459307190718e-02   -4.871162276320434e-01   +7.417950467398038e-02   -1.821658027084821e-01   -4.953477912881039e-01; -1.239639341896057e-01   +9.265934995841038e-01   -2.337654489985028e-01   -1.170071199670437e-01   +4.399036399974378e-01   +8.854763831649487e-01   -2.399972357755996e-01   -2.034909979520150e-01   -5.623993939260716e-01   +1.665091114548988e-01   -3.159760225697932e-01   -5.279643679555531e-01; -8.066658290713374e-03   +4.000650995693245e-01   -1.823565298877216e-01   -4.648912005222165e-01   +3.913728511913683e-01   +5.864357475432442e-01   -1.650227671168928e-01   -1.401211628393806e-02   +5.779323747779108e-01   +2.892044400162327e-01   +3.038234043823204e-01   -6.908731045223835e-01; +2.297462557779194e-01   +3.361242363105843e-01   -4.319217308368604e-01   +8.173047167514907e-02   -2.174537537581152e-01   -1.533965741392724e-01   +3.309692223764293e-01   -4.693201195927428e-01   -1.039574719909376e-01   +5.831446642124298e-01   -4.315054463607140e-01   -1.094883913324193e-01; +4.846475703536565e-02   +6.012642413832060e-01   +1.719996270382585e-01   +3.619605676100551e-01   -4.806872762432635e-02   +7.523513021274451e-01   -2.212031141884864e-01   -3.752141899750757e-01   +9.235440793497924e-01   -1.340502952399059e-01   -3.520374246117189e-01   -2.092216202784218e-01; +7.541417360874401e-01   +2.577120580587254e-01   +7.410709695502624e-02   +7.938041576014132e-03   +5.947216688098272e-01   -9.193910919090634e-02   -2.222258042920806e-01   +2.351364818944785e-01   -9.705725449886497e-02   +2.015442753870494e-01   +1.035663632378853e-01   -2.826079833562775e-01; -2.983521119484822e-01   -5.418336212094303e-01   -2.973788865401633e-02   -8.978959037398926e-02   -3.546849908980740e-02   +4.086847843221773e-01   +3.605245290075018e-01   +9.069236877388936e-02   +5.801093398802565e-01   +5.782917002603589e-01   -7.492475980918993e-01   -2.526368945576450e-01; +4.684210417750881e-01   -4.195366554374419e-02   +5.302804074995539e-02   -5.428638644124471e-01   +2.711132096206093e-02   +7.744349251688744e-01   +7.565457889646039e-01   +8.939775170144612e-01   +2.730649883585192e-01   +6.159870146394714e-02   -1.932791235644598e-01   -6.844276325390197e-01; -5.841848007597136e-01   +4.047233630421531e-01   -2.730075308510879e-01   +6.610011425890699e-01   +3.061864338421397e-01   +4.515713477380987e-01   -4.239541231018066e-01   +5.731000976744599e-01   -6.857929031149854e-01   +2.150341864858611e-01   +2.554632153288433e-01   -3.069693560646713e-02];
L2E_Input1_iAMPA_netcon = [-1.416773855547579e-01   -1.758712263837099e-01   -6.140831607272396e-01   +1.000000000000000e+00   -3.903930439593654e-01   +4.876726875974156e-02   +1.357013973804327e-01   -3.335345519071204e-01];
L2I_Input2_iAMPA_netcon = [-5.941487066425785e-02   -1.170898708916761e-01   -2.102373945157755e-01   +2.895996948713929e-01   +3.296218377183436e-01   -2.487667467821381e-01   +1.000000000000000e+00   -4.845573161729416e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
