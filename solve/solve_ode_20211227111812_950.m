function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.227725596113832e-02   +1.528353179230552e-02   -2.535494924675906e-02   +4.491578743132205e-02   +1.151387491384569e-01   +3.584328313497079e-01   +8.985272429041785e-02   -1.129053818189131e-01   +2.008694880417914e-01   +2.483153410560867e-01   +2.794035349449903e-02   +2.644978411029280e-01   -2.144216135866882e-01   -6.643176376990773e-03   +1.511305434609256e-01   +2.787669966058856e-01; +6.047902681446835e-02   +1.754388529818324e-02   +3.486530295512722e-01   -1.810300144696023e-01   +3.595431551839203e-01   -4.168441238572252e-02   -2.214105579734892e-01   +1.135876858304521e-01   +2.644844982728543e-02   +2.051867064770376e-01   -8.088046614483292e-03   -3.717192783090594e-01   +1.256744446947132e-01   +6.706065539642261e-02   +8.006938874777074e-02   -1.098842523004398e-02; +3.055683768547230e-01   +4.699090454358792e-01   -2.366386395489644e-01   +1.759836034872059e-01   +2.461064561201861e-01   +2.025183875556633e-01   -8.196145843933696e-02   -2.956807387493686e-01   +1.482781457515966e-01   -3.248732820723228e-01   -2.226770726017137e-01   -1.543667745971177e-01   -4.291915325811614e-01   +1.203894402055863e-01   +8.836996338009050e-02   +4.554388006956692e-02; -5.064265763166375e-02   -1.189817068058009e-01   -2.646435679407501e-01   +1.850504651772966e-01   +8.551853968698050e-02   +6.881635505853508e-02   -5.533262984403980e-02   +2.543913873998827e-01   +1.530168845832833e-02   +4.020839241849621e-01   +3.881877249315999e-01   -1.232956819011954e-02   +5.246006599155643e-02   +1.145922343063016e-03   +1.493105962329787e-01   +3.939038530482006e-01; +1.141418578088635e-01   -1.278225200582596e-02   +7.588303144757533e-02   +9.165780941298309e-03   +4.308633029555096e-01   -2.314996938393957e-02   -1.877982354273549e-01   -2.985519681504946e-02   +1.509881577388393e-01   +3.511606407013624e-01   +9.673868336397647e-02   +4.867915853542309e-01   -1.651485395946155e-01   +3.601093339389899e-01   -9.896082395247413e-02   +2.146961430060121e-01; +2.970659419523640e-01   +5.180237610520415e-01   -2.590024013114914e-02   -2.256022897218029e-01   +3.927532821639044e-01   -3.839422137504474e-01   +1.698689074741624e-02   +1.966885996657018e-01   +8.020857258691461e-02   +1.700239123147753e-01   +2.466208801660119e-01   +5.730972506872722e-02   +1.932096488729370e-01   +1.599915489491864e-01   -6.492795161516399e-02   -1.799000389156070e-01; +2.655974478381314e-01   +2.886779604721864e-01   +1.690743404708646e-01   +5.450849156974565e-02   -3.717684381639250e-01   -3.809845288748110e-01   -2.882386014475593e-01   -1.855039704968530e-01   +2.757509295380717e-01   +1.482997932021761e-01   -5.036949447031009e-02   +9.768060721436804e-02   +2.032850736533068e-01   -1.132055089210479e-01   +3.478766029019678e-01   +3.894073464274091e-01; +1.157210637361842e-01   +1.201765329303866e-01   +3.565033033866873e-02   +1.450481283874267e-01   +1.034230512789117e-01   -2.929311250010499e-01   -2.878972273073863e-02   -1.111911681582901e-01   -1.281783857645470e-02   -7.962651821886112e-02   +4.145866036293036e-01   +3.353081800654731e-01   -1.393288162995081e-01   +3.051695803681469e-01   -2.102378946261482e-01   -1.197891177784209e-01; -1.588832928172577e-01   -3.444843805208569e-02   -8.318552408982061e-02   -9.834822694042442e-03   -2.232234146809015e-01   -5.527020464774883e-02   +3.420011115615154e-01   +2.034664432295989e-02   -4.307872291317605e-02   +5.554421576123114e-02   +5.134922999058873e-01   +5.476473529896164e-02   +1.248674721719218e-01   +2.596854523245127e-01   +1.763991543410614e-01   -4.346792337691275e-01; -6.049833752756428e-02   -3.729552495023895e-01   +1.468908085197269e-01   +8.750199919524906e-02   +6.370555466998407e-02   +3.720180640266202e-01   +1.499770217491302e-01   -4.606020444411982e-01   -2.311286563978524e-01   +1.077013592336528e-01   -2.620917672965614e-03   -8.813785897811849e-02   -8.370174134775601e-03   +1.773574377765114e-01   -3.300030637434826e-01   +5.822528664575904e-02; -4.973475361120371e-01   -1.139408554650913e-01   -1.303075039393514e-01   -1.145150254295506e-01   +3.495811383315536e-01   +1.140270895241303e-01   -1.086113089827902e-01   -2.049220155415966e-01   +1.686566733053764e-01   -4.159255072880380e-01   -3.441208334731050e-03   +5.461225239934467e-02   +4.197186643314797e-01   +1.060297610979068e-01   -3.584136292622284e-02   +1.470069818793721e-01; -2.440465845891314e-01   -3.198824606232420e-01   +1.899003010454969e-02   +1.074817930949283e-01   -4.159428979189922e-01   -2.582334950018036e-01   +2.540842007899297e-02   +2.140047780156700e-01   +1.625204645599723e-01   +1.669451560405185e-01   +8.615696230741275e-02   -3.861630644068186e-02   +1.054442141864293e-01   +3.443017243569458e-01   +8.794015469156499e-02   -2.246849586166466e-02; +1.483738549184472e-01   -3.532777359268753e-01   +6.727828334267447e-02   -2.457153174693062e-01   -6.193543508288611e-02   +2.520136596690936e-01   +8.198099409580147e-02   -4.968855689067395e-01   -3.235578334224853e-01   -6.332071839230845e-02   -3.574710459228041e-02   +4.545743835783438e-01   -1.778233464839822e-02   +2.803829947537081e-01   -3.089426543479221e-02   +7.237220940574290e-02; +1.437018178135108e-01   -3.441098102138643e-01   -1.069433288053169e-01   +2.557754449738397e-01   +2.167858467001104e-01   +2.529615314645723e-01   -5.789137770154557e-01   +2.732797394559222e-01   -5.106892467818204e-01   -2.249486193249252e-01   -5.178337115106359e-02   +3.275148400125226e-01   +5.632197106843345e-03   -1.444676217207106e-01   -3.025722039261435e-01   -2.719795406047632e-01; +5.265888433402048e-01   -1.661664424224205e-01   -4.746891423176803e-01   +4.471582724011854e-02   +1.202625035112353e-01   -3.752885047011513e-02   +4.625413504877406e-01   -3.670998796328932e-02   -1.068670935506758e-01   +2.827486713135218e-02   -2.386194510361215e-01   -3.293916010191689e-02   +1.939740136466778e-01   -3.581945735962573e-02   +2.357915753794818e-01   -9.051544166821657e-02; +3.140423672873956e-01   +1.334976218103557e-01   +3.800196150383347e-01   -3.580061692796202e-01   +1.819849392525222e-01   +1.602568816045762e-01   -2.580739881579244e-01   +2.115006788151386e-02   -4.574057019953717e-02   -2.514990448812767e-01   +4.611734945781436e-01   -1.818077465998542e-01   +2.027497154073174e-01   +1.962893539377100e-01   +6.209082337850044e-02   -4.108058064423761e-02];
L1E_L1I_iGABA_netcon = [-1.883199909432202e-01   -3.403362259643832e-01   -3.115324530549911e-01   -1.435407920439045e-01   +3.687367852584233e-01   +2.978896407402622e-01   +1.661364340570343e-01   +1.782305925723064e-01   +1.994743435429784e-01   +5.275080791186639e-01   +3.756781903445382e-02   -3.998907845194205e-01   -4.278787330081954e-01   -2.486156137594155e-01   -2.261318739417441e-01   -3.031059640628846e-01; +7.288213731878750e-02   +2.721032135044009e-01   -7.150130645553748e-02   +8.912856657339918e-02   +6.775897142975641e-03   +4.045432227773904e-02   -2.776889766392374e-01   -1.890972241306939e-01   +1.528222843879468e-01   -3.228533177399052e-01   -1.367372057227881e-01   -4.081599579580827e-02   +1.452254981757803e-01   +2.063811688101059e-01   -1.710096480011409e-01   -8.707626976354052e-02; +9.343500843247718e-02   +1.701881341793099e-01   +6.942250662322091e-02   +2.237902808314664e-02   -1.620673084635864e-01   +3.670119657932649e-01   -1.837302466583777e-01   +4.092781555953731e-01   +2.416538473232386e-01   -2.489486956428346e-01   +2.643047135006251e-01   +6.804659903301352e-02   +6.946551561232281e-02   -8.841534368259703e-02   +1.290217271793493e-01   -3.088639980390639e-01; -1.091797952922557e-01   -1.654267082718262e-01   -7.379356020129055e-02   -2.077566781550175e-01   -4.237488228365986e-01   +6.531480794393395e-02   +2.789588272377045e-01   +1.506790159245032e-01   -8.226341103387555e-02   -3.694149847230551e-01   +2.356920632658168e-02   +2.003564509543673e-01   -4.581946097667231e-01   +1.980434625880178e-01   -4.063297017093841e-02   -4.176950511762445e-01; +9.503184993337915e-02   +2.131480222092661e-01   -2.566333364404379e-01   -5.955511605983449e-02   +2.011721958556142e-01   -6.498516457582122e-02   +2.799715174211589e-01   +1.626825115751880e-01   +5.553630684657117e-02   -2.830512367458503e-02   -3.282316819887424e-02   -1.178497937760675e-01   +1.054440766163681e-01   +7.693703902740753e-02   -2.659713618830774e-01   -3.380932036800836e-01; +1.623690172620239e-01   +1.172561590854609e-01   +1.507554032425479e-01   -5.840261988766448e-02   +1.296262279805120e-01   +3.503621769784535e-01   -3.571288713398948e-01   +1.890903676101129e-01   -1.972807810039677e-01   +8.796555305086409e-02   -2.368468026320331e-01   -3.738350950484652e-01   -8.216560502420955e-02   -1.584753403964264e-01   +8.838609268760289e-02   -1.982978031985463e-01; -1.507192881713654e-01   +1.218585309315642e-01   -9.077402726537825e-02   -8.941554630430289e-02   -2.533045968772755e-01   -3.374166669641295e-01   -3.151723159889273e-01   +1.230459176606960e-01   +7.946240927444428e-02   +5.100440219626264e-02   -3.226388895658099e-01   +1.005185440720367e-01   -8.401264477302160e-02   -1.329828853138866e-01   +1.866591358912229e-01   +4.805485488416160e-01; -2.238069708599323e-01   +2.393885375358533e-01   -1.461060815009641e-01   +3.066399888890164e-01   -1.195694406248516e-01   -2.830052225025595e-01   +2.742928696252380e-01   +4.591773486684093e-01   -3.896454733883126e-02   +4.410360427652597e-02   -2.072963266834838e-01   -6.225694807301428e-02   -4.927619371497515e-01   -6.215979989941401e-02   +1.174343232943193e-01   +1.008558387433260e-01; -1.737393653107894e-01   -2.272377858405753e-01   -5.533582718090266e-02   -2.453410379771732e-02   -5.697944572482662e-02   +5.415318669325417e-01   +6.076825252410850e-03   +3.299802255573168e-01   +2.395748451542490e-01   +2.286361529123070e-01   -3.163176342309061e-01   -1.391986187673714e-01   -2.245666113868747e-01   -2.716741328034169e-01   -1.646310108794808e-01   +4.129860092657434e-01; -1.946596837409221e-01   -2.002251293554062e-01   +3.133524807008338e-01   -3.516205533589777e-01   +3.871888529071841e-01   +7.274364305602429e-02   +2.360209937670838e-01   -8.381803127650102e-02   +4.025528167678796e-02   -2.405849440888046e-01   -4.671196621955431e-01   +5.556912750551849e-01   +1.374329233680198e-01   +2.360526544179363e-01   +1.592287468852829e-02   +4.187726164171627e-01; +2.977270317209461e-01   -2.003482186006898e-01   -1.560257606202823e-01   +2.957764982307430e-01   +1.841444789531070e-01   -4.722154833801481e-02   -8.607179306857046e-02   -3.173598385056715e-01   -2.492792787990367e-01   -1.959678125469979e-01   -6.343115852843442e-02   +1.403645715500988e-01   +3.326065440119747e-01   -1.530213905966809e-01   -2.377178437896753e-01   +2.464636278166178e-01; +4.598346347471119e-02   +2.658383900862442e-01   -1.202738372478798e-01   -3.277236911459733e-02   +4.701738196739835e-02   +6.856391227910286e-02   -1.502182336302146e-01   +3.042137107081224e-01   -1.446225591441537e-01   +1.960032817393117e-01   +4.294277210235730e-01   +4.265323315700069e-01   -4.066987027980792e-01   -3.195652277558969e-01   +7.685114891822332e-02   -3.253301230082026e-02; +8.360054188854704e-02   -1.116468749831680e-01   +3.680085273562467e-01   +4.215974843931264e-02   -2.387561042272822e-01   +7.243285631601111e-02   +5.949925010372762e-02   +3.446180997553538e-01   -2.136833954810629e-01   -1.840240368347540e-03   +3.851539171042689e-02   +6.897521039082893e-03   -1.697503588219987e-01   -6.696437411591562e-02   -1.086899500771060e-01   -3.670944124298480e-01; +1.534552024328133e-01   +5.304421111514900e-02   +3.567529376479279e-01   +5.343203105459471e-02   +3.544429144544690e-01   -3.743215687211415e-01   +1.555995855100156e-01   -1.925476533216432e-01   +3.978758497966347e-01   +1.707566972914908e-01   +2.381726721505628e-01   -1.274775202586735e-01   +1.380129702182552e-01   +1.100555575165123e-01   -1.317113009970665e-01   -4.876185431365940e-01; -4.990524218325657e-02   -2.426416499759941e-01   +1.376105334967616e-01   +1.906522814571156e-01   -9.159510640279075e-02   +6.079869222269213e-02   -2.473948580262850e-02   -2.956160488138727e-01   +6.070107633717661e-02   -4.393990102217878e-01   -2.031982465050817e-01   -4.743827424810810e-01   -2.859754717392382e-01   +2.470924234168261e-01   -2.714072651945390e-01   -4.822672476031725e-02; -4.202316131647689e-01   +1.194643931534432e-01   +1.021992758570431e-01   +2.288095505780277e-01   +2.118313405096527e-01   -2.302237287574340e-01   -1.546672651571007e-01   +1.357885171564973e-01   +1.486014074705186e-01   +2.695341838692111e-01   -3.463394445501778e-01   +3.438602481288852e-01   +1.119318721904372e-01   -3.284252662440670e-01   -4.559053518781140e-01   -2.804485057896946e-01];
L2I_L1I_iGABA_netcon = [-2.393366653888575e-01   +1.132535666167490e-01   -2.250976530498246e-01   -2.633424912918373e-01   -1.002083467349522e-02   -2.764284788523622e-01   -4.434340651680521e-01   -4.890396067512131e-01; -1.976041983264149e-01   -9.542790409078825e-02   +2.136380337500511e-01   +4.009439202123610e-02   -4.562291164982061e-01   -8.195605836099355e-02   -1.361980246643100e-01   +2.460116732550830e-01; -3.372904749212237e-01   -2.891937498756656e-01   +3.011513881699495e-01   +7.979247451791743e-02   +2.811157787161546e-01   -3.552883352200900e-01   -2.208585079543508e-01   +3.028042548528777e-01; +2.397185482013399e-01   +1.475787706425063e-01   +2.417024312003808e-01   +3.668880785680642e-01   -2.053758306372620e-01   +3.092678093250333e-01   +2.695154293478489e-01   -2.269155289957031e-01; +8.660262380057922e-02   -3.331574132122068e-01   +2.919907876764877e-01   -2.085475242171413e-02   -1.293395542746119e-01   +2.890914504673433e-01   -1.139866973610822e-01   +1.813703038943288e-01; +2.378740432787155e-01   -4.438120724625383e-02   -1.691230329683197e-01   -5.124649587434873e-01   -6.431029131327043e-02   -1.224102639379376e-01   -4.885549491106794e-02   -2.861134958588074e-02; +4.815716835295221e-01   +1.412229338537193e-01   -1.435548811777957e-01   +4.426922526220091e-01   +2.894662018506210e-02   +1.686035903573284e-01   -1.773132895508975e-01   -1.796038269908390e-02; -1.482644107340975e-01   +2.478301051029302e-01   -2.262076014172060e-01   -1.266245771575956e-01   -3.752204507166266e-02   +1.081438378387306e-01   -1.653596862109940e-01   +7.091173309274271e-02; -2.056709504901303e-01   +1.832095704547970e-01   +2.133766505599844e-01   -1.079794358816314e-01   -1.616146532782186e-01   -1.780854217791510e-01   -2.248191124902335e-01   -2.221665815667275e-01; +3.436803881993744e-01   +4.233161639954400e-02   -1.908603548261026e-02   -1.662417142450989e-02   -8.327101974377507e-02   -3.036092090493086e-01   -3.124317116443413e-01   -3.441998813626632e-01; -2.160425509119469e-03   -2.700652094887593e-02   -3.870325768896889e-01   +2.855493130650891e-01   +2.973536297841974e-01   -4.356577659524851e-01   -3.345813848975253e-01   +7.070309074785439e-02; -3.333587636659977e-01   -3.861612068914972e-01   -1.975636600772441e-01   +1.877315464379617e-01   +5.882826633700246e-02   +9.497168190280156e-02   -1.236793295661872e-01   +2.242677373473186e-01; -7.380420249462810e-03   -2.775195741078509e-01   -3.318632032630502e-01   -2.513870177161118e-01   +4.392393935648731e-02   +2.449122114309711e-01   +2.058835631757808e-01   -4.706220729061779e-01; -3.861637273906873e-02   +1.993434372387496e-01   +6.738597465915278e-02   -2.179357060025451e-01   -8.533245782106448e-02   -3.833697641334198e-01   -1.888559379814548e-01   -3.715374220866355e-01; +1.961205290156097e-01   -7.460891462306882e-02   -8.880472130091493e-02   -2.094314312291096e-01   -2.979689400242537e-01   +1.415134657089618e-01   +1.051159411490698e-01   +1.129591273932955e-01; +1.049450994002254e-01   -1.090380728551186e-01   +4.059172419041195e-01   -1.420221636546716e-01   -3.251364360127489e-01   +2.331485624520636e-01   +7.827491631922817e-02   -2.411839484775297e-02];
L1I_L2I_iGABA_netcon = [-8.457373481985443e-02   +9.971564019369586e-02   +9.706601318159003e-02   +1.895041485241702e-01   +2.620297007091038e-01   -1.286749729509515e-01   -2.978478258912087e-02   +3.089181767591643e-01   -4.154880369154624e-01   +9.164728620313545e-02   -4.148999212397503e-01   +7.553978228639972e-02   +4.044501421312696e-01   -7.350846399113373e-02   -1.357116353040146e-01   -1.421583776845755e-01; -3.652150870105838e-01   +1.676096490303665e-02   +3.753985332676913e-01   +2.793025378607682e-01   +3.189284015056503e-01   +1.904680022717287e-01   +1.850681368508525e-01   -2.702393334750591e-01   -1.788090650193438e-01   +1.295547634322226e-01   +3.474078905063102e-01   -2.309697250540393e-01   -1.364584282359225e-01   -8.435181236439426e-02   -2.492648146184086e-01   +1.350401271850591e-01; -3.358946262568533e-01   -2.575191093675295e-01   +2.040981548703542e-01   -2.488986112472500e-01   +1.697161642950826e-01   -2.721924290400747e-01   +8.543987868428016e-02   -1.479794756239094e-01   +1.685778209983353e-01   -8.261771453441075e-02   -9.169757881228546e-02   +6.798285523851536e-02   +3.065666926297377e-01   -3.243058856879934e-01   -9.946110653782342e-03   +1.288134317545891e-01; +4.591167541603006e-02   +2.299649474985299e-01   -7.337047866481680e-02   +1.650037719808800e-01   -3.423582785794108e-01   -2.007166540455556e-01   +3.419040994168160e-01   +8.836919795534526e-02   -1.535056292659295e-01   -1.387409684438742e-01   -2.867251765436254e-01   +3.004149582154739e-01   +3.036900077336633e-01   +9.838612226059640e-04   -8.520364370620148e-02   +2.626012899738467e-01; +7.565715407883597e-02   +1.706215308894946e-01   -1.700155284287471e-01   -1.331529533492398e-01   -2.674468712520844e-01   -1.541533662440823e-01   -1.743544522889425e-01   +6.783124087786019e-02   +1.764753204578256e-02   +5.989974862787983e-02   +1.851303000896937e-01   +1.107939532291667e-02   +1.515596720253478e-01   +2.743765506790069e-02   +3.344995453872465e-01   +2.830047927362227e-01; +1.018138556593857e-01   +8.140919505925398e-02   +1.543905263152526e-01   -1.681130377307241e-01   -2.308211278332670e-01   +2.514134073302101e-01   +2.003822762008384e-01   +1.943913299640714e-01   +3.577807652739765e-01   +1.931098741230743e-02   +3.757086563390503e-01   +1.655495558641541e-01   +3.085218573097834e-01   -1.017016235185403e-01   +1.667047943009637e-01   -3.367189443261250e-01; +1.715598230010134e-01   +1.806511555419384e-01   +2.838091673520328e-01   +1.287764173883377e-03   +2.676149559234493e-02   +1.823153479336916e-01   -4.745522665107539e-02   -1.944255547165711e-01   +3.114317771227643e-01   -1.355630139319296e-01   +2.305407748944579e-01   -1.425270970252898e-01   -3.606727836766774e-01   -1.920338197509348e-01   +4.179018197966204e-02   -1.649063263761245e-01; +3.750006762788869e-01   +5.777120154691411e-02   -1.611746010498046e-01   -1.957629264783402e-01   +4.732998500934530e-01   -1.604219564385893e-01   +2.693127417507029e-01   +1.103508041512710e-01   +3.462437767001874e-01   +1.733700574035813e-01   -1.857367395132062e-01   +1.217497693750857e-02   -1.752510556754669e-01   -1.201767943121490e-02   +6.786772377132783e-02   -7.875463372673636e-02];
L2E_L1E_iAMPA_netcon = [-1.794862860331390e-01   -8.095338108486011e-02   -5.141703670010265e-01   -1.185071865626476e-01   -1.993647429655605e-01   +1.607066187612919e-01   +6.207125679180839e-02   -1.351540932049717e-01; -3.314906078614008e-01   +4.344822098866576e-01   -5.780498327641119e-01   +2.023255832051595e-01   -3.037470515340213e-01   -3.031038718053471e-01   +1.853287732238246e-02   +3.522718256001314e-02; -9.153967899417212e-02   +1.184316791130042e-01   -2.719806330871077e-01   -9.494129298924119e-02   +2.626535314880968e-01   -4.070856810003736e-01   +1.431945779946365e-02   +7.124604238955567e-02; +7.261272444152687e-02   +1.547878919163467e-01   -2.161613489665642e-01   -4.366970928124980e-01   -1.638243013524531e-01   -4.542100416016350e-01   -2.622802464440009e-01   +4.712681302896862e-02; -1.430811697078178e-01   -1.087174671776514e-02   +6.879839831649281e-02   -2.836173917447642e-01   -6.589582964307836e-02   -6.833958899900444e-02   +3.135940994827021e-01   -1.613153723645984e-01; -2.603873259267359e-01   +1.155947871516960e-02   +2.966633221324438e-01   +4.460315686033531e-02   -8.888149104477325e-02   -5.831659820958154e-02   -8.710417579025179e-02   -4.232643868921458e-01; -2.393001812968059e-01   +6.254270776499402e-02   +1.946886822232766e-01   -1.886600574696126e-01   +1.668325189392954e-01   +3.218323716457906e-01   -9.998173770863295e-02   -1.273683426852029e-01; -1.152756337312033e-01   -6.740027609959182e-02   +3.265258069785601e-03   -1.762518977523595e-01   -1.529422101356580e-01   -2.672179350800304e-01   -1.369637094535560e-01   +9.439403996069627e-02; +7.755385725564808e-02   +2.546710093883156e-02   -9.668491606151026e-02   +4.119682013269059e-01   +1.201127851457636e-01   +1.293535140043590e-01   -1.196294187309764e-01   +3.813030238583477e-02; -2.035997028359803e-01   -9.856914526272875e-02   +1.709409967191988e-03   -5.079864420149964e-02   -2.150088934734309e-01   -4.248910727697922e-01   +4.980372593731816e-02   -1.775551321880213e-01; -2.817570800336103e-01   +7.005906565411432e-01   +2.493578314500560e-01   +2.776983764492771e-01   +8.877413849689840e-03   +4.723065370308233e-02   -3.348715317400851e-01   -1.466634709857637e-01; +2.173365499388256e-02   -1.247331374396446e-01   +2.081426643074117e-01   -3.954292513107205e-02   -2.778626638368200e-02   +1.286185489200157e-01   -1.409740040395301e-01   -1.826632907325967e-01; -4.424261729743498e-01   +2.332761427333964e-01   -1.964490265377190e-01   -2.316104073730536e-01   -3.135934643423793e-01   -3.182829865649328e-01   +1.726870401549279e-01   -9.805141111028114e-02; -1.800833838531941e-01   +3.996923361222798e-02   +1.499334795272259e-02   +5.851530849622921e-03   -1.712993832828070e-01   +9.299217680389432e-02   -2.889897398481948e-01   +2.397290194256578e-01; +4.269178223012238e-02   -3.767191138279821e-02   -2.751412181910985e-01   -1.770552643206032e-02   -2.542932077904991e-01   -2.294631678775535e-01   +3.155387307603529e-02   +8.023829248298099e-02; +2.657749098222281e-01   +1.446819811067245e-01   +1.324430226956053e-01   +2.341123722078893e-02   +4.814810425789883e-01   +1.197937767532762e-01   +1.211066081205453e-01   -2.732817291166193e-01];
L1E_L2E_iAMPA_netcon = [+2.462187001396314e-01   +1.007641286716976e-01   +4.043793770621228e-01   +5.638283543962568e-02   +3.560984053252482e-02   -2.662014258715314e-01   +3.151443838744815e-01   -2.264862355558536e-01   +8.065556424016238e-02   -2.748557418184617e-01   -3.501013411342174e-01   -2.361898956664054e-01   +1.930732659706039e-02   -7.159458970055767e-02   -2.092069991192956e-01   -6.059096442602034e-02; -3.333191130388117e-01   +1.184654124145981e-01   +1.888947104450651e-01   -3.869711137251260e-01   +5.528825706289292e-02   +5.655984286351609e-02   -9.171309701655660e-02   -3.687031098656223e-01   +1.524258897394838e-01   -2.184196883924936e-01   -4.722111223882842e-02   +2.936343933024351e-01   -7.409933745187872e-02   +1.926598195116637e-02   +3.588828537537835e-01   -1.950229003298122e-01; -2.930880726569979e-01   +2.000169195541082e-01   +5.600651635068469e-01   -2.357535551932122e-01   +1.318251571415480e-01   -1.468352563339170e-01   +3.911746050662070e-01   +1.603703984650990e-01   +1.490418716617206e-01   +2.716024516565905e-01   +2.356037209800987e-01   -3.823096681276619e-02   -3.577744818294050e-01   +4.486662931104086e-01   +7.171908671140592e-02   +4.905208225815455e-02; +4.053957242890015e-01   +1.785480494219773e-01   +3.667370231909983e-02   -8.771806654973141e-02   -1.079935361979421e-01   -1.197546105503883e-02   -1.262286816429326e-01   +2.706730127515504e-01   +3.115587559536069e-01   -8.661874572076468e-02   -3.438859431785793e-01   -3.215469178620332e-01   +1.808546158593466e-01   +1.083133670070065e-01   -2.047292173585344e-01   -3.337464865729520e-02; -9.651745909542311e-02   +1.835774925002796e-02   -3.380884391849813e-01   +2.117436142350534e-01   +7.546833335565467e-02   +2.442150808675665e-02   -4.160143494613189e-03   +3.751020641857761e-01   -1.016225837994503e-03   +1.458478469667053e-01   +1.581726634969438e-01   -3.713867270439214e-01   +1.409435000428305e-02   +2.208943662221787e-02   +5.606766540367066e-02   -2.315656488877831e-01; +2.929277064480634e-01   +1.120061509158810e-01   +1.791266389471493e-01   +2.610187437269395e-01   +4.175120689927713e-01   -4.015503929461847e-01   -2.598253196384849e-01   +2.666620394815706e-03   +2.027826362186434e-01   +2.412809172935695e-01   -2.315431342339394e-01   +2.106845549626222e-01   -2.925028989810299e-01   +2.352501376109582e-01   +2.212342296455985e-01   +2.484118048559632e-01; -2.707434841707542e-01   +1.238149565866203e-01   -8.746543085560075e-02   -3.167696477510262e-02   -1.710647389628058e-01   +4.703040223573626e-02   +5.366059184287444e-02   -3.447373708136782e-01   -1.126925415451270e-02   +2.292205030487720e-01   -1.728887442167626e-01   -3.783235417836633e-01   +2.205830085091271e-01   +1.492787519079048e-02   +3.035882171626036e-01   -2.756244881192987e-01; +2.316309583615545e-01   -1.248797806739632e-02   +4.220377568169108e-02   -1.425071063963415e-02   +3.074491888460619e-01   +3.677744545455822e-01   +7.579836132505520e-03   +3.847148593823654e-01   +2.823552298779763e-01   -1.523648528380041e-01   -5.181790220308320e-02   -1.066125670970440e-01   +3.690344620045607e-01   -2.738669830482721e-01   -9.082365480601731e-02   -4.025250787138975e-01];
L2I_L2E_iAMPA_netcon = [+1.177089167674044e-01   +1.448048306171045e-01   +1.829976426051045e-01   -5.937352758978619e-02   -1.490303264345283e-01   +4.299509046909408e-01   -2.512873134177761e-02   +1.132264577286074e-01; +2.544344912405588e-01   -4.766108952481547e-02   -5.672782748826807e-03   +4.371515563170573e-01   -2.179493927145440e-01   +1.945933653160626e-01   +4.039200360848302e-02   +3.988333747028928e-01; +2.452552274097887e-01   +1.034109741217155e-01   -1.213806787229319e-01   +2.042443513618421e-01   -2.485410825888734e-01   +1.439377281464731e-01   +4.978863352584761e-02   +1.213278214553750e-01; +1.139725897176705e-01   -3.882018452075403e-01   +2.542487140552022e-01   +1.295289767732210e-01   -2.599729540766492e-02   -5.058489186834795e-01   +2.449593956802669e-01   -8.828632188111032e-02; -7.450617128728870e-02   -1.208928630599427e-01   -9.761990225666387e-02   -1.606267820538779e-01   -3.865508207584555e-01   +1.182949710235105e-01   +2.069488129671856e-01   -7.287446454590507e-03; -6.257833903872712e-02   -4.924206543084829e-02   +1.493201822464579e-01   -5.567713011488112e-01   -9.337195760018666e-03   +1.684179111180458e-01   -2.542921476315481e-01   +2.425931488707723e-01; +5.015196192838784e-01   +2.746148300941513e-01   -1.535692620446803e-01   +2.463560418085546e-01   -1.515990518410319e-01   -3.321409983964873e-01   -1.614612558407170e-01   -9.089527918038764e-02; +1.693744067071686e-01   +2.007120694958142e-01   -1.376073090612234e-01   -2.854603142026604e-01   -3.063097946630986e-01   +3.049039211018612e-02   -4.002062852356610e-02   -4.205632493081171e-01];
L2E_L2I_iGABA_netcon = [+3.441102000065684e-01   +2.764611711385654e-01   +1.247150695312219e-01   +3.745987689748118e-01   -1.229372326877408e-01   -2.212757064399722e-01   -4.212053127663717e-02   -7.846022039058195e-02; +1.047048008059365e-01   +8.114681052468112e-03   +2.943235286736330e-01   -1.961609474797203e-02   +1.122534566971477e-01   -1.492170112118371e-01   +6.673334937745802e-02   +3.076181543636965e-01; -1.699059951283222e-01   +6.662340601221543e-02   -3.385091112358204e-01   -1.438573901731129e-01   -2.541017457930418e-01   -1.841650132837464e-01   -4.216262938813853e-02   +9.307937051469484e-03; -1.814309989856686e-01   +3.190437464206534e-01   +2.247190607091515e-01   +1.929275245364252e-01   +2.633751358596015e-01   -1.382723633190794e-01   -2.241407335863210e-02   +2.072760722049810e-02; -1.012576112380769e-01   -2.188966258897479e-01   +6.019603803152407e-01   -9.394604951238850e-02   +3.472146502008528e-01   -2.648976474267810e-01   -2.123048674614885e-01   -4.291417170777312e-01; +2.905493724356393e-01   +3.025038614300365e-01   -2.117778811672821e-01   -2.026793778061552e-01   -1.197769976937491e-04   +1.986913390909109e-01   -2.778801910498868e-01   +5.022892137856853e-02; -5.531633481000003e-02   -9.486342940345299e-02   -3.649213753268224e-04   -2.426526884747761e-01   -5.659724097538851e-02   -2.625125934702037e-01   -1.990337187739339e-01   -2.028335210784321e-01; -3.242520527410922e-02   -1.919991285898183e-01   -9.540106261167861e-02   +1.815049072825502e-01   +3.629612223602071e-01   -1.920706659832965e-01   -1.894827426643763e-01   +1.679988023554848e-01];
L3E_L2E_iAMPA_netcon = [-9.973861727646151e-02   +3.312958790274482e-01   -6.520192420106946e-02   +2.450528608296311e-01   -2.376465690750418e-01   +4.863180077878838e-01   +7.011629003219720e-02   +2.247641297447976e-01   -6.538634877715348e-02   -3.068837034128479e-01   -2.054986975082724e-01   -3.935314901292816e-01; -6.559485256120806e-02   -3.089452705907949e-01   -3.141112750468686e-02   +1.688655767453124e-01   +3.920933017465635e-01   +1.388501751253080e-01   -3.837338524636016e-01   +8.799352002179914e-02   -1.431391318227177e-01   -2.692750803818498e-01   -1.463767205161969e-01   -1.098378648041182e-01; -1.039095069579822e-01   -1.249791361764921e-02   -1.780198520987820e-01   +2.740700285841852e-01   +2.218332833272976e-01   +1.338778070219724e-01   +2.919131016114206e-01   +2.345370563779758e-01   +2.447586289621751e-01   +7.073246422081805e-02   -3.603907027789866e-01   -9.726157038844263e-02; +2.416272774111381e-01   +3.906149494349626e-01   +2.700371203020160e-01   -8.882812447580671e-02   -4.096811304707506e-01   +4.664639658103558e-01   +2.859567098329743e-01   -1.274923022589397e-01   +1.507406373772730e-01   +1.650264909525795e-01   -6.647748577933082e-02   +9.041110645797301e-02; -1.416513784723720e-01   +2.048577613829800e-01   +3.703991280860072e-01   -3.430572779719129e-01   +8.096833875268794e-02   +1.627416827528331e-01   -3.681711780280946e-01   -1.345219682867983e-01   -2.448225745460464e-01   -1.742858746368873e-01   +5.506738825930016e-02   -5.867980680918322e-02; +3.198486632080315e-01   +2.093700376440125e-01   -4.796009430544854e-02   +1.848764541373846e-01   +3.728844942964871e-01   +4.254516092285854e-02   -9.416912444628583e-03   -2.924054178805228e-01   -1.724925158790133e-02   +1.212440911301449e-01   -8.360794088788298e-02   -1.472840410131317e-01; +3.883824588008117e-01   +3.386743252574036e-02   +1.520566791486896e-01   -3.476826478102685e-02   -5.463131903662208e-02   -3.471938972349997e-01   +7.765178888039692e-02   +5.788848943211075e-01   +1.178374256309384e-01   -1.376968449073497e-01   +1.964433057032273e-01   -3.289960477127635e-02; +2.511478985233588e-01   -1.290606788171912e-01   +1.047052346192522e-01   -2.678851213073429e-01   -1.019242561552072e-01   +5.148808395990857e-02   +3.354669708887610e-01   -2.239269699091556e-01   -6.365876046994823e-02   -2.175105705274603e-01   -3.314513121911626e-01   +3.413622328359590e-01];
L3I_L2I_iGABA_netcon = [-2.472464913111083e-02   +2.150135984852685e-01   +5.177059941077577e-02   +2.577281369348495e-01   -1.428471120349947e-01   -3.554530554767121e-01   +2.257634775646472e-02   +4.043330220532145e-01   +3.162502639990821e-01   -2.365609790753974e-01   -2.980508148522479e-01   +1.281104768756781e-01; +1.213352533424483e-02   -3.423863542692658e-01   -2.484421993738244e-01   +2.089337582149449e-02   +1.214635328075334e-01   +2.252592128546093e-02   +7.044150600095457e-02   +1.260971467958696e-01   -2.358782416113650e-01   -3.386225970984644e-01   -3.584364456550743e-01   -2.493338246629575e-01; -1.708229417952759e-01   -2.382529446631850e-01   -4.106305640724102e-02   -3.806664287078594e-02   +3.158310139542987e-01   +9.533824130056757e-02   +2.695422529518338e-01   +1.844309493586343e-01   +1.638657396395393e-01   +1.784517455911027e-01   +2.980369903301270e-01   +3.942678369483898e-01; -1.881370978816030e-01   +2.622287479466073e-02   -2.514310655174550e-01   -1.844240863048539e-02   -2.568082781001529e-01   -5.107426633192530e-02   +1.329499849443975e-01   +3.698978201505666e-01   +2.078229118816831e-01   -2.169162632140836e-01   +1.737280097981593e-01   -7.068404967901498e-02; -1.822037196240617e-01   +1.068170685550627e-01   +2.338674981072252e-01   +2.817682377712565e-01   -2.181979336922056e-01   +3.520496303776225e-01   -2.820590509614140e-01   -2.771200546434223e-01   +1.412583623898206e-01   -3.917097013981248e-02   +1.311419132775408e-01   -2.889514642123998e-01; +1.701451400265509e-01   +2.589275441058974e-02   +5.633752417513871e-01   +3.322058480604837e-01   -1.982324851120594e-01   -3.329532972397450e-01   -1.478542473385654e-01   +2.265825576112949e-01   +1.452104466405840e-02   -2.365794811044493e-01   -1.574604880066852e-01   -2.947151538005259e-01; -2.454995494979615e-01   -1.931094813043266e-03   +3.969698198405966e-01   -2.022824383362935e-01   +2.595192731589901e-01   +3.854050483835776e-01   +1.532787715491786e-01   +3.116873414771687e-01   -4.240238354799255e-02   +1.171401185084696e-01   -1.073647186728462e-01   +3.249101067378177e-02; +8.202812161105098e-02   -1.571345428182636e-01   -5.067228610617210e-03   -1.069034101949810e-01   +2.621342946308475e-02   +1.324135478506508e-02   -2.750157427218804e-01   -7.840116345107535e-02   +1.035673249468751e-01   +2.695781934001203e-01   -4.796388052353381e-02   -3.642752077299233e-02];
L2E_L3E_iAMPA_netcon = [+2.285732904778072e-01   -4.012324001972201e-01   +4.776600559445404e-02   -2.137544552471778e-01   +4.303679145601320e-01   +3.692710172108078e-02   +2.666935029277233e-01   +1.805229612186542e-01; -1.098057329600703e-01   -5.015882575970196e-01   +2.840016861517802e-01   -3.052454594725466e-01   -2.131698278824197e-01   -4.528712497424007e-02   -1.476949062175401e-01   +3.807995561876196e-01; +8.659900117665141e-02   +1.144314357050846e-01   -1.841815867479032e-02   +3.194593728307472e-01   +1.614527427982648e-01   -3.244154097418033e-01   +6.135295193547763e-02   +6.114921898751104e-02; -3.895394505124950e-01   +1.976696818816915e-01   -3.783855947623986e-01   -2.666794474214541e-01   +1.121728849360450e-01   -2.229729830279336e-01   +1.357908315924375e-01   +3.787386072898317e-01; +5.306442618458398e-02   +2.806246496109438e-02   -2.121758755598134e-01   -1.170451260893788e-01   +2.269518430514746e-02   +1.341952270289942e-01   +3.171237550893690e-01   +2.038189414010579e-01; -2.673334253737183e-01   -6.238449189557164e-02   -2.130169412344976e-02   -1.369587328815797e-01   -1.044081895904799e-01   -2.346975203731883e-01   +2.246431221662273e-01   +2.328505062121125e-01; +1.633589467675386e-01   +3.152878032743596e-01   -7.009692290005615e-02   +2.223650128107248e-01   +2.367067775929101e-01   -8.490194495099687e-02   -2.079629941151499e-01   -1.160856020140136e-01; -5.729778817370693e-02   +3.911473300458714e-01   -1.115173540843556e-01   +1.364866696201783e-01   -1.737534385086799e-01   -2.858242120551306e-02   +2.599012004655027e-01   -3.553437034761089e-02; -9.875471453004449e-02   -7.609489487637200e-02   +1.187834813600625e-01   +4.979845329713940e-01   -2.107105915129614e-01   -8.395070640791341e-02   -3.427468873397574e-02   -4.060212493200835e-02; -6.713346274219262e-02   +3.345767485312499e-01   -2.941977549813931e-01   -1.481965303749883e-01   -2.673959679911164e-02   -3.162996039944448e-02   +3.942042619307511e-01   +8.283816945628884e-02; +1.582550182016368e-01   +3.297230123719798e-01   -1.688900314038910e-01   -5.758048133238100e-02   +4.023368500517527e-01   -1.465246327198715e-01   +6.769276245796665e-03   -3.279703791092652e-01; +2.365623046160762e-01   -5.803831195343762e-02   +3.441923074753420e-01   -2.985636734396964e-01   -3.204449911092124e-02   +6.231373464584538e-02   +2.946728916477195e-02   +1.225692202288866e-01];
L2I_L3I_iGABA_netcon = [+1.881612902640092e-02   -3.504081373291714e-01   -3.107429221248303e-01   -1.219714416281986e-02   -5.172526891621161e-01   -1.389290172327680e-01   +1.209907443023519e-01   -1.253707580252492e-02; -2.061186400673504e-01   +1.906083415636961e-01   -4.521879818280616e-02   +9.154380864525988e-02   +3.273605181309450e-01   +3.882694899802711e-02   -1.735303974281981e-01   -1.204825663661583e-01; +4.414976341163518e-02   +1.213335121176080e-01   +2.379358320272558e-01   -1.704001166214741e-01   +4.309837618847158e-01   +3.381590261030481e-01   +2.013657088187937e-01   -1.909582279451896e-01; +2.886818901054266e-01   +2.362106052951765e-01   +6.354151843852425e-02   +2.560881367618335e-01   +2.057747162655541e-01   -2.000745366001448e-01   -4.450718328739066e-02   -1.589448628360415e-01; -4.401042495377881e-02   -7.573387840447006e-02   +2.929201566923199e-01   +2.175291969460253e-01   -2.531223693471629e-02   +2.871448486739308e-01   -1.864709909204770e-01   -1.809530087710332e-01; -8.810624666647733e-02   +3.282232407799388e-01   -2.193175235690953e-01   +1.711091244737987e-01   -1.922305658714900e-01   +9.530166638019189e-02   -1.238654268131464e-01   +2.746046698660795e-01; +6.812274258536757e-02   -1.736706208286388e-01   +1.290700354492774e-01   -1.132971425084996e-01   -3.187565950780935e-01   +9.515129867877123e-02   +6.161755557004781e-03   +3.972430356127258e-01; +2.221848071338032e-01   -3.753896885916880e-01   +6.734589658161116e-02   -1.463331708383099e-01   +1.115619094841608e-01   +2.399564852686917e-02   +3.473994127159206e-01   +8.630583449871958e-02; -4.034443358864140e-01   +1.000502792012336e-01   -5.928835676746431e-02   +3.610780669213799e-01   -1.241546070690632e-01   -2.165633099759729e-02   -1.642827507164368e-01   +4.938255157894945e-01; -1.046504686350659e-01   -5.027517728724812e-02   +3.341577453435535e-01   +9.713852175176035e-02   -1.529340515637388e-01   -3.459009800479222e-01   +4.997817625064420e-02   +7.323695117566650e-02; +3.527723943746257e-01   -2.347229994003623e-01   +6.308522194314337e-01   +1.539609908501430e-01   +1.827227295494704e-01   -5.670737611108792e-02   -1.890597718733679e-01   +1.805617398035148e-01; +1.910049721783488e-01   -2.202333356479813e-01   +4.754035218189319e-04   +4.740471022227876e-01   -2.210160962529319e-01   +1.873755980760637e-01   -3.285646545990829e-01   -2.773170931562593e-01];
L3I_L3E_iAMPA_netcon = [-3.835420602457950e-01   +2.154471719040912e-01   -7.541915762930648e-02   -2.326407253998606e-01   -1.118347913993889e-02   +7.582434065701363e-02   +2.807588583754141e-01   -1.940155957073849e-01   -2.596426426456471e-01   -1.553366963577745e-01   -2.020032623572092e-01   +8.835725066269766e-02; +1.936764352562059e-02   -4.759400354393241e-01   -7.393132673738213e-02   +9.042761429383483e-03   +8.378544813701916e-02   -9.654803268825130e-02   -1.607221760534427e-01   +1.394191846344643e-01   -3.257808332057440e-01   -1.472134637272677e-01   -4.340913384269758e-01   -1.305343718072779e-01; -2.035886020527084e-01   +3.124453671999686e-01   -3.393204666874434e-01   -3.818958976860441e-01   +4.641778737999330e-01   -4.026350814015614e-01   +1.862547415071462e-01   +1.218214164306747e-01   -1.156098488842816e-01   -1.257787260474257e-01   -2.023011168143428e-01   -1.146956114364439e-01; -1.114651748118142e-01   +1.930337153490368e-02   -2.929047670116849e-01   -1.811060691561967e-01   +2.592328339704723e-01   +9.446853305297284e-02   -9.675137718925308e-03   -6.244240716609618e-01   -3.790951763243949e-01   +2.995261620992534e-03   +9.362399037137133e-02   +1.910545359120528e-01; -1.742305309277711e-01   +4.057948116767443e-02   -2.419542315331898e-01   +4.284102342133648e-01   +7.188826118823610e-02   +3.731642716699116e-01   -2.651066279654745e-01   +5.889995560805408e-02   -3.285208483697467e-02   +4.133279685140238e-01   +2.215573747155677e-01   -9.989933183604138e-03; +2.556579231881345e-02   -1.605345878832172e-01   +5.756346669513730e-02   -7.307000631673261e-02   +4.336426421813118e-01   -9.368717585967064e-02   -7.253483346176996e-02   +1.871334531822753e-01   -4.589162520235140e-02   +3.738683950112620e-02   -3.109419262417079e-01   -2.791178983952813e-01; -1.124353500717152e-01   +9.322678670010109e-02   -2.018357075867643e-01   +2.735126622938108e-01   -2.413722790097569e-01   +2.343082974367919e-01   +1.128498285431654e-01   -2.433004969370827e-01   +2.795348634994188e-02   +1.187848599519975e-01   +2.959108989621282e-01   +1.164403192004468e-01; +4.241841377127324e-01   +2.752418130483913e-01   +7.040514674357937e-02   +3.990617484691114e-02   +9.498421247580879e-02   +4.298379464422744e-02   +1.014917002873040e-01   +8.011394680191539e-02   -3.956154852775275e-01   +1.956965555893338e-01   -2.656785255379271e-01   -4.527967015114789e-02; +1.413560425576914e-01   +5.025012172561649e-01   -1.013813620500616e-01   -1.696895264683621e-01   -2.786568893462398e-01   -2.381574111168387e-01   +3.269885096873069e-01   +1.335525807923680e-01   +2.828570262258541e-01   -4.664116847697887e-01   -2.053910263221146e-01   -4.111146123270651e-02; +1.213382946593662e-01   +2.640081137444465e-01   +9.370672617201270e-02   +2.770029757062293e-01   +1.640671992716171e-01   -1.463529548601648e-01   +7.328939799338052e-02   -3.710617593571563e-01   +7.358947033177288e-02   -2.551890944977482e-01   -2.395106934693229e-01   -2.859185897574737e-01; +1.551156812325848e-01   -5.079363805987600e-03   -1.996463612230796e-01   +3.632087811019926e-01   +8.606919332750321e-02   -3.657722953062860e-01   +8.661953278654377e-03   -1.617356906398200e-01   -5.999198605522332e-02   -1.339688105066424e-01   -3.863494087706276e-02   +3.431463423587106e-01; +1.085683502152920e-01   -1.083097243577091e-02   -1.134919306672774e-01   +1.680619360080332e-01   +3.116623619301808e-01   -3.478574369929667e-01   -1.723649192565732e-01   +3.316442831205146e-02   +2.681769755419442e-01   +1.019999373302778e-01   -2.425167225846852e-01   +3.686086153402065e-01];
L3E_L3I_iGABA_netcon = [+3.308999276241101e-01   -1.028918806031157e-02   +2.762169357038971e-01   +3.667285261287360e-01   +1.287622053241202e-01   +5.731251113886121e-02   +4.016847313238799e-01   +4.139879224767448e-01   +6.778101710164888e-02   -1.947936556984187e-01   -7.811582179110887e-02   -7.288675999321304e-02; -2.060656261048844e-01   -2.256122880018848e-01   +1.833929358207296e-01   +2.372597914524088e-01   -1.262914411427218e-01   -3.384120541996360e-01   +1.402308112450414e-01   -5.648805637753281e-03   +4.724051174627734e-01   -6.801081231912527e-02   +1.837403603523684e-01   +8.212704325580655e-02; -4.523317946053655e-01   -5.605946219906297e-01   -9.155019323998273e-02   +2.490329034065147e-01   -1.240263463140254e-01   -1.724631108293963e-01   +2.519438773665564e-02   -8.719474342151969e-02   -4.103160130370054e-01   +2.422021851577583e-02   -1.339080670092305e-01   +3.098080587110835e-01; -4.300082047705672e-01   -3.157387901466295e-01   +6.066025884271381e-03   +2.687022286732177e-01   +3.401932515371124e-02   -1.571141999402619e-01   -2.417747533648935e-01   -1.452953436804933e-01   -9.131823340376481e-02   -2.521902125582585e-01   -1.642083154293724e-01   -1.498844651215328e-01; +1.383668346361416e-01   +4.173900255093813e-01   +3.418364069014095e-01   +2.429098059558733e-02   +3.553399702001264e-01   -1.622188235859658e-01   -1.290272519939965e-01   -4.251201125563115e-01   +1.034107578404413e-01   -1.132028667710893e-01   -2.895680013998301e-01   +3.974847722124848e-01; -3.280128966523080e-02   +3.233597134118573e-01   -8.104137376253398e-02   -1.236300608724768e-01   +2.160012117665923e-01   -8.502975048146104e-02   +3.320015504941330e-02   +4.906950017189121e-02   +6.931867211577644e-02   +5.177105397735045e-01   +1.628476525540084e-01   +1.210921154713333e-01; -9.167057110779760e-02   +4.265535788384498e-01   +3.518623048146981e-03   -3.606509817131637e-01   +2.894533297223083e-02   +4.270375373321361e-01   -1.909413426732263e-01   +3.041504393075319e-01   -3.860681916421269e-01   -6.832393767309573e-02   -2.681458712631557e-02   +4.019987665901809e-01; +4.113762698543177e-02   -7.183238606568632e-02   +1.126769799147941e-01   +1.808193339065471e-01   -4.777523390056058e-02   +9.264342898235467e-02   -2.329888587788161e-01   -1.939520511626601e-01   -7.031503307427765e-03   +3.521007390384988e-01   -2.297093735920549e-02   -1.390211476163330e-01; +1.401061852940137e-01   -1.252969728647965e-01   +1.437874629758121e-01   +1.699361756902716e-01   -2.642437703041439e-01   -3.065207063200021e-01   +1.005836807808678e-01   +3.588918861915572e-01   -2.735888383155210e-01   -5.327373852057333e-01   -3.310965635697133e-01   -3.004298011411440e-01; +9.363198416025070e-02   -2.178571086083187e-01   -9.752479200286604e-02   +1.744821881422581e-01   +1.417740823862466e-01   +2.121888436406830e-01   -1.247583678643432e-01   -1.701929875805578e-01   -3.349343659053717e-01   +1.846292822590158e-01   +7.603477883859326e-02   +3.434022799008628e-01; -3.987624662251388e-04   +2.813694501081361e-01   -1.736574212046888e-01   -1.024891664858153e-01   -1.048349030543363e-01   +4.069821159729829e-02   +1.503592726617808e-02   -3.189344665449198e-01   +2.097725212336480e-01   -1.269259809514175e-01   -1.592094115860314e-01   +3.053385010961501e-01; +1.763569562370823e-01   +3.299647937642204e-01   -3.429547894355181e-01   +2.949259454524530e-01   +1.469814549158075e-01   +1.779686258562006e-01   -2.149820952120024e-01   +4.447955551546288e-01   -2.711975364795018e-01   +2.543313419009504e-01   +2.984898057130291e-01   -1.757380171383069e-01];
L2E_Input1_iAMPA_netcon = [-1.758937914696012e-01   +2.124976385383126e-01   +2.787095743489337e-01   +3.788386485924480e-01   +2.792966635246102e-02   -4.788250223302231e-01   +9.567651851165182e-02   +3.244577589052072e-02];
L2I_Input2_iAMPA_netcon = [+1.495467760460074e-01   -2.635074726740886e-01   +1.197671148904750e-01   -8.384155213598561e-02   -2.780514017759358e-01   +4.449108682219318e-01   -7.575202863208964e-02   -1.281740946590758e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
