function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.807318431692357e-01   +3.163623353700885e-01   +2.300576693981746e-01   +1.000459200948631e-01   +1.462068342206590e-01   +9.023292764965535e-02   +8.014542199374065e-03   +3.730390311382844e-01   +3.397381949172850e-01   +2.777146897367037e-01   +7.114189008932592e-02   +7.029938977795409e-01   +4.261075330543597e-01   +2.808219984834517e-01   +2.353230247008119e-01   +5.050286629617706e-01; +4.202438972540598e-01   +1.458611766880104e-01   +5.004523442182510e-01   +2.875490222297883e-01   +7.265498580512103e-01   +5.518320316922158e-01   +3.523080461440357e-01   +5.170114351627868e-01   +4.788632093927496e-01   +7.791310399099932e-01   +7.363073779910384e-01   +2.728028165567207e-01   +3.944749983194159e-01   +2.405395817447962e-02   +4.826862453675906e-01   +1.499093589660911e-01; +3.619339917996293e-01   +7.541058447548222e-01   +2.289062841583948e-01   +1.100131836115604e-01   +4.195672340556481e-01   +7.881731813443787e-01   +4.842060789273176e-01   +3.258150304972633e-01   +5.215410732938052e-01   +2.127159763236809e-01   +2.771143701126542e-01   +3.196806904778848e-01   +5.041521367630510e-01   +3.884804247998105e-01   +6.597302831076188e-01   +5.291787032736807e-01; +1.386617342178241e-01   +5.330230600558945e-01   +6.191150202582844e-01   +8.236992504882527e-02   +5.749276849233718e-01   +2.993969970935588e-01   +1.260746359640419e-01   +1.664863438464028e-01   +6.357530696504778e-01   +3.036802955287733e-01   +1.221630899770114e-01   +3.522937237967646e-01   +6.440622927907511e-01   +4.330508096722982e-01   +7.679842805720396e-01   +4.080426158276068e-01; +1.684598701177715e-01   +6.776307236382892e-01   +4.040914250366858e-01   +6.592695016440394e-01   +5.858422838852764e-01   +3.240467435792973e-01   +9.563951648097506e-02   +1.872640079059217e-01   +2.487311956425826e-01   +5.615088025070232e-01   +5.409411060392800e-01   +5.561069664570260e-01   +3.111677235679140e-01   +5.856550070003008e-01   +1.717993853304467e-02   +1.184987107036392e-01; +1.966600396395954e-01   +7.185279131617544e-01   +2.985584724197970e-01   +4.556332115977418e-01   +5.687079694862766e-01   +1.233180353016746e-01   +4.010859525044841e-01   +4.417190050430952e-01   +9.709092958741471e-02   +4.445728896198113e-01   +2.567817481704720e-02   +2.022904358482707e-01   +1.488672077623773e-02   +6.552887499183506e-01   +4.530140532897584e-01   +3.649699381781134e-01; +6.809740505203111e-01   +5.058708598545614e-01   +4.747475879414852e-01   +5.555079742117633e-01   +4.133848363382439e-01   +3.209163887809057e-01   +1.346584170690570e-01   +5.701287137402957e-01   +1.526630861282839e-01   +3.149353254991673e-01   +1.170779697279648e-01   +1.346838361554050e-01   +3.623601251736013e-01   +7.469160235728017e-02   +1.926559535935648e-01   +5.426923681766296e-01; +1.104037448059230e-01   +1.646544710721756e-01   +5.220350223725326e-01   +6.566134522126127e-01   +4.244870906215240e-01   +1.627197417631346e-01   +1.398898598943753e-01   +1.206550115721805e-01   +5.553874146219283e-01   +4.572644328635580e-02   +6.134773007400602e-01   +4.487281596274097e-01   +2.903660398071021e-01   +7.757336383439244e-01   +4.382159472997875e-01   +8.633892883344807e-02; +8.143775860460881e-02   +3.100527200526089e-02   +1.104382358536155e-02   +1.394985484397886e-01   +4.000056029224426e-01   +7.794260527379292e-01   +6.019650684799553e-01   +4.092262982149211e-01   +3.108329960845455e-01   +6.731103031544935e-01   +1.589088192905185e-01   +1.920626056454329e-01   +2.927704298622539e-01   +6.060097305737013e-01   +3.764619603390594e-01   +5.194958017820925e-01; +2.325789052132729e-01   +1.142008139429014e-01   +4.251835365221579e-01   +4.829135259314717e-01   +6.308149813130577e-01   +1.276739844633170e-01   +1.104466943280143e-01   +7.504750456709725e-01   +5.252125657821929e-02   +4.153065804277850e-01   +3.146976644466010e-01   +6.887973737961055e-01   +7.201902941814663e-01   +3.511617369228138e-01   +8.097545429458249e-02   +5.964785652043541e-02; +2.865234695842540e-01   +5.001552274179106e-01   +2.209311821897785e-01   +4.150133870645478e-02   +2.054394310964894e-01   +5.156352762445415e-01   +6.495657034540259e-01   +5.360767656998801e-01   +5.052600696297730e-01   +5.615305752453692e-02   +2.584635171442554e-01   +8.040890286765872e-01   +3.490297938219969e-01   +4.496842786891500e-01   +3.285739428726937e-01   +6.635558612140225e-01; +3.827502400432659e-01   +2.587085509631252e-01   +7.902215328085710e-01   +3.368996298411396e-02   +1.916519263548360e-01   +7.952795534135850e-01   +2.655305000844692e-01   +6.639199695935866e-01   +5.654017348349570e-02   +4.077056548236188e-01   +6.470327854663935e-01   +6.075814514483957e-01   +2.799516695107789e-01   +7.124144027050215e-01   +4.723925847437558e-01   +4.342869376841085e-01; +7.535794569840383e-02   +5.786707790248422e-01   +4.555009476196146e-01   +1.409024919434937e-01   +1.748703994405880e-01   +5.985125322118440e-01   +1.980789432981730e-01   +6.952669026818514e-01   +3.749662016612716e-01   +7.183400121348535e-01   +5.635250938267886e-01   +4.004026937814367e-01   +2.915174880696860e-01   +1.169392675596444e-01   +1.985771604004329e-01   +3.446616967806710e-01; +1.656969251545259e-01   +6.745766077794921e-01   +6.660116376709575e-01   +6.429082958295050e-01   +6.281475494353989e-01   +1.439757268589688e-01   +1.770958114594637e-01   +3.568647061134532e-01   +5.909217294436081e-01   +4.508313750993712e-01   +6.928994402571230e-01   +1.363471952987669e-01   +2.098111824761766e-01   +2.550679262488644e-01   +3.018532885528028e-01   +3.599680967565718e-01; +2.818803813425745e-01   +8.719570924673457e-02   +4.069032053590247e-01   +5.384128889109803e-01   +6.011622207824288e-03   +3.779166113543680e-01   +3.955848644292421e-01   +1.650371251990795e-01   +4.038396137951477e-01   +1.804984846166602e-01   +1.350025425055255e-01   +5.879235235621084e-01   +6.419404216633262e-02   +4.834813734121144e-01   +6.246252781364878e-01   +4.647564441695897e-01; +3.186796853318945e-03   +1.288162280220947e-01   +6.253821802677096e-01   +4.668543198939069e-02   +3.870896219891898e-01   +1.986788038468427e-02   +5.159784310986342e-01   +4.243890443132535e-01   +7.637997651131776e-01   +3.279572163058075e-01   +3.972358545395811e-01   +6.287074792913466e-01   +5.090321990607614e-01   +4.239659409946263e-01   +2.549318259512090e-01   +5.333844160225215e-01];
L1E_L1I_iGABA_netcon = [+2.969278527504894e-01   +6.174726037668865e-02   +1.590734324934955e-01   +7.262141020735359e-01   +5.706286615063402e-01   +2.709670799233136e-01   +4.258049632397621e-01   +7.079811523327169e-01   +2.487568250736172e-01   +4.625201295126763e-01   +3.362725414209940e-01   +4.516055674110085e-01   +7.930202232150886e-01   +1.939768104888853e-01   +7.594026019163307e-01   +4.688936622060124e-01; +8.042441511476713e-03   +6.743897483297883e-01   +4.217218028244742e-01   +3.324282984329295e-01   +1.542099681472926e-01   +5.484666121809807e-01   +1.623245919992247e-01   +5.166479437682486e-01   +5.597130753238119e-01   +4.563146483639786e-01   +5.841171476434138e-01   +2.308905382071212e-01   +6.419009567936803e-01   +4.150087874561651e-01   +7.470062807185646e-01   +5.027729138539556e-01; +5.418346023253492e-01   +6.831619248050268e-01   +3.253684594099695e-01   +5.510954768079097e-01   +4.015263481953303e-01   +5.949078095071076e-01   +4.182148079774845e-03   +3.303385305628654e-01   +2.817834881460202e-01   +6.834648513756006e-01   +2.118258174428334e-01   +4.400133205697335e-01   +5.736459749943871e-01   +4.559773256245392e-01   +2.415015659068185e-01   +7.693374628790640e-02; +5.256665227886962e-01   +7.307260078106153e-01   +4.425862629977745e-01   +5.533229224350328e-01   +1.042244090445995e-01   +5.672637285737118e-01   +3.103730751781671e-02   +5.420880128120757e-01   +4.782059115163133e-01   +5.845042210783071e-01   +3.395870619647452e-02   +3.094652224695461e-02   +5.423559797868870e-01   +1.835868044512283e-01   +1.050321255948292e-01   +4.020977415950396e-01; +3.763236688051167e-01   +5.409902689344479e-01   +3.268501396395577e-01   +2.305345831565578e-01   +4.990801239586063e-01   +5.066718232208918e-01   +4.191530695877857e-01   +3.834325106091610e-02   +4.915009632815017e-01   +3.013260869441949e-01   +1.228160026674273e-01   +1.831927866200353e-01   +1.259540130717748e-01   +4.582603090587159e-01   +3.788012343393727e-01   +4.556326053824402e-01; +2.574981811092814e-01   +5.970712587414979e-02   +1.503453001415996e-01   +4.528105255855927e-01   +5.020495233870096e-01   +6.314921119989075e-01   +2.740282824548188e-01   +4.404942992205631e-01   +5.370139296380687e-01   +4.579060048025754e-01   +4.110243188783163e-01   +5.445880881160577e-01   +7.922082709177174e-02   +6.380423535714126e-01   +1.082988674034171e-01   +3.283767063733070e-01; +1.073616294908863e-01   +3.254252796970830e-01   +6.099497899729172e-01   +6.703819468647398e-01   +2.935381487260778e-01   +1.430353051162030e-01   +1.355913405881855e-02   +1.566361775705164e-01   +4.050476867304129e-01   +4.387703289157006e-01   +7.044450442150377e-01   +3.450069519997058e-02   +6.768540570996937e-01   +4.851649480402126e-01   +4.281151048173355e-01   +6.289177321447283e-02; +2.336094667269244e-01   +6.485546845253323e-01   +1.658454719094195e-01   +6.917076290215904e-01   +1.587178511393061e-01   +1.386825948648958e-01   +6.570604669253117e-01   +1.204058491492874e-01   +1.365920230074391e-02   +3.567179802136464e-02   +3.452575109629860e-01   +6.280157035733113e-01   +5.020673377406960e-01   +6.231100639470004e-01   +7.182555150763311e-01   +2.270233442566684e-01; +1.509679716017953e-01   +7.477000666539761e-01   +5.910863925990703e-01   +5.914218160702570e-01   +6.769249915148813e-01   +2.405321839986364e-01   +4.170079269761969e-01   +5.488832248545078e-02   +5.565472036773600e-01   +2.796373804623106e-02   +5.517345446369518e-01   +6.412582307198393e-01   +6.645742032881857e-01   +1.720027521999463e-01   +4.288685179993912e-01   +7.940122578037238e-01; +7.563584232355187e-02   +4.681891919240421e-01   +7.285199099146631e-01   +1.399647197611457e-01   +3.300565123784858e-01   +2.438148864606848e-03   +3.216476132244164e-01   +6.327838212381139e-01   +7.580009075941020e-01   +1.189754014288641e-01   +2.263220549753499e-01   +3.562851205825182e-01   +1.946764127092055e-02   +2.402014570037821e-02   +5.321539716445204e-01   +9.182332553494321e-02; +5.721022325137580e-01   +5.367731997208746e-01   +1.106029353825057e-01   +6.577633118995344e-01   +4.297302802812775e-01   +1.861733446491244e-01   +4.334248422096882e-01   +1.758117642225245e-01   +6.758559003715855e-01   +9.720995839455118e-02   +4.206466352426650e-01   +1.604755243457975e-01   +1.999989753376120e-01   +3.405920249936185e-02   -2.531660366480030e-03   +4.492080421054901e-01; +2.827209166464929e-02   +5.736194431160818e-01   +6.646188680314669e-02   +5.288342337048436e-01   +7.067507283441810e-01   +3.606956216571387e-01   +3.044948227334606e-01   +6.946438047464686e-01   +7.394779947334961e-01   +7.526920301486790e-01   +7.078775680651342e-01   +7.312213875703502e-01   +4.587307984499301e-02   +1.763475038777462e-02   +6.878135062995573e-01   +3.061700280049788e-01; +6.916698031042503e-01   +5.537697821081599e-01   +1.009124917450268e-01   +3.003482079348827e-02   +5.080218147641218e-01   +5.173379380019494e-01   +4.156208804655536e-01   +3.851885714123493e-01   +5.752894212750865e-01   +3.779846256958141e-02   +5.780019261382818e-01   +1.039261846289763e-01   +1.813421051772451e-01   +2.165605311377943e-01   +4.636221174127457e-01   +2.623951488742381e-01; +4.795365011290328e-01   +4.458096847703435e-01   +6.313672376747923e-01   +3.430429429364659e-01   +2.395516396113595e-01   +1.066386524754647e-01   +5.236870959393151e-02   +3.358991202293451e-01   +1.623908280748390e-01   +5.832754377409127e-02   +4.728393854562175e-01   +3.962773828576540e-01   +2.139337928578382e-01   +5.722605571299478e-02   +2.450855388437175e-01   +1.610030833503317e-01; +3.701418482555066e-01   +7.785061209980449e-01   +4.821542111436337e-01   +4.842645770945753e-01   +4.853029382709532e-01   +2.200562134333145e-01   +3.507768856819762e-01   +4.301653625357817e-01   +6.880545913118460e-01   +5.052089524039041e-01   +7.638768554103919e-03   +6.152744449847358e-01   +9.098865024464735e-02   +6.489284538174427e-02   +3.618609450503263e-01   +3.019228917874311e-01; +5.740524067041681e-01   +5.501233900976817e-01   +1.025962728136214e-01   +4.515323745342077e-01   +2.230436768610242e-01   +3.968455396587209e-02   +1.021713462631272e-01   +7.007282586918701e-01   +1.828687565786187e-01   +5.890468432315251e-01   +5.625659948336225e-01   +4.608114322855321e-01   +3.307628017678325e-01   +7.049773373435119e-01   +3.052412754500986e-02   +7.485169452726282e-01];
L2I_L1I_iGABA_netcon = [+1.603675987491306e-01   +4.532805534608442e-01   +7.179547082239992e-01   +4.792312086374781e-03   +5.952142179279966e-01   +1.687403235690602e-01   +1.160280059475950e-01   +6.798306581130702e-01; +2.382933062652386e-01   +6.702154658787978e-01   +1.516105045611359e-01   +4.263972884492658e-01   +4.851499098055250e-04   +3.188602834145777e-01   +6.771944050014257e-01   +4.443902167144918e-01; +8.108807837968604e-02   +5.766243780212178e-02   +4.029949004111535e-01   +7.751520196543621e-01   +5.426254069058303e-01   +6.392330671424094e-01   +2.900332318223544e-02   +6.695413176509253e-01; +1.310565903864289e-01   +8.017791304992313e-01   +2.287350102380349e-02   +6.689439094044289e-02   +9.844389027829523e-02   +5.195338859763547e-02   +2.085246044501690e-01   +5.799059031748947e-02; +2.361082326928571e-01   +7.403515139219349e-01   +5.380511981246988e-01   +1.894930054205529e-01   +7.683015577759422e-01   +1.581781244610905e-01   +4.717610922784299e-01   +4.958398884153460e-01; +6.338341752946354e-01   +7.145662076338579e-01   +2.943132760955656e-01   +7.285786034420807e-01   +4.878582562412491e-01   +5.101524412013961e-01   +2.766339756056620e-01   +2.793982333559418e-01; +9.321157989797994e-02   +4.151373219776510e-01   +2.664706070957778e-01   +7.055287808765902e-02   +1.131628421359156e-01   +1.358588034870041e-01   +1.399958196111658e-01   +2.058527567246849e-01; +2.632550821388899e-01   +2.940342626537730e-01   +5.142197741371314e-01   +5.184090686483599e-01   +5.819426264900961e-02   +7.765355071936970e-01   +4.148054333879025e-01   +1.826804384056487e-01; +5.169618299833760e-01   +1.173064331623881e-01   +7.449756257926483e-01   +8.690254912772750e-02   +3.320305369737952e-01   +2.006936825250682e-01   +4.045354861335043e-01   +7.636050729776043e-01; +4.088287782807291e-01   +6.232230376722038e-01   +5.548379193207091e-01   +5.498324750055138e-01   +5.328643331212549e-01   +9.748157864706236e-02   +4.612666677748612e-01   +2.173094571577191e-01; +3.270347443902935e-01   +6.846639588507115e-01   +4.943477044971388e-01   +5.023904016168634e-01   +6.610672198604607e-01   +6.081356179668070e-01   +1.269766861776607e-02   +7.689163509770234e-01; +7.266706525808715e-01   +1.468275273446575e-01   +3.572637330900177e-01   +7.680395551455639e-01   +7.158982044390935e-01   +3.412897724260779e-01   +4.434920988643662e-01   +7.717145423379238e-01; +5.382442149865906e-01   +4.536084089663017e-01   +4.648385423774005e-01   +7.107123482107657e-01   +3.496400201395721e-01   +1.942903452466180e-01   +2.930935790564290e-01   +2.516479224351585e-01; +1.226213963538369e-01   +7.834195578092129e-01   +7.357191694310438e-01   +5.635605350451074e-01   +2.271731957870586e-01   +8.654460692009033e-02   +1.934728176877706e-01   +3.780368164650221e-01; +4.791107579349662e-01   +5.947238103265742e-01   +1.857706399457175e-01   +6.714948070507602e-02   +2.787945270687601e-01   +7.606629873312412e-02   +6.523544237241339e-01   +1.647467832204909e-01; +9.059869899085934e-02   +3.485126754732628e-01   +5.849299926338787e-01   +1.049347120960636e-02   +7.204776324235100e-01   +5.062343255681184e-01   +4.545516655490605e-01   +3.449188740097894e-01];
L1I_L2I_iGABA_netcon = [+2.403914506457197e-01   +2.198570842454784e-01   +2.394588578382350e-01   +4.812779438293112e-01   +5.326956432567278e-01   +2.610394318903716e-01   +1.840646770905965e-01   +5.902134158969208e-01   +2.901250027917763e-01   +3.095493048952582e-01   +5.500399733469011e-01   +1.703240909512381e-01   +3.228222472585318e-01   +5.544607200654524e-01   +6.653813612916162e-01   +6.439981147926696e-01; +5.701616850729571e-01   +4.527845698692431e-01   +7.023023666662216e-01   +5.323199009450060e-01   +7.576268507345854e-01   +2.311794657308433e-02   +4.440307470333794e-01   +2.041963497903287e-01   +2.702867729565809e-01   +1.217972736492818e-01   +7.289309625931474e-01   +5.557722479248669e-01   +7.695874980341011e-01   +5.991478348009749e-01   +3.585132641388198e-01   +4.486122569985282e-02; +4.336081779038953e-01   +5.020291482694577e-01   +5.542073721811578e-01   +4.830579893345640e-01   +1.684738696787959e-02   +6.240620599728826e-01   +7.706147541485128e-03   +3.866011278760114e-01   +7.897258966580569e-01   +1.101324363490333e-01   +2.963643997733541e-01   +4.479171928668367e-01   +1.292223865211366e-01   +7.150512284825881e-01   +4.493152956638721e-01   +6.474450331803047e-01; +2.435735665193660e-01   +2.811204049195124e-02   +2.838896570035139e-01   +2.249078535116245e-01   +5.118760151557601e-01   +5.993986410280434e-02   +4.208740392975019e-01   +2.944230314005156e-01   +7.176454728388149e-01   +5.939552157950725e-01   +5.316636105027314e-01   +2.922866071414915e-01   +6.077822886687939e-01   +6.986546185774843e-01   +3.185925833841352e-01   +3.530902298285916e-01; +6.376619046593468e-02   +6.669740570482431e-01   +1.283475654464258e-01   +2.699472135923798e-01   +3.640710440947907e-01   +5.457245147949806e-01   +7.421974690974765e-01   +7.459113017313833e-01   +6.947372067929994e-01   +2.898677435590049e-01   +7.132545777227372e-03   +3.998826863324413e-01   +1.429459265067725e-01   +5.992488640302180e-01   +1.387933709537082e-01   +6.281235544544449e-01; +6.021919382339992e-01   +1.660122201558430e-01   +4.572389716641029e-01   +3.188718836196739e-01   +6.802527072863652e-01   +2.515477053148377e-01   +1.818071658291188e-01   +6.611680066381288e-02   +2.333123494869698e-01   +5.361482517815560e-01   +7.859743171189761e-01   +1.265246799917910e-01   +3.873594795819014e-02   +4.336725701918839e-02   +4.635096632715826e-01   +3.536627930703219e-01; +5.564333354109973e-01   +5.951159948784351e-01   +2.902821116437156e-02   +5.849621865000713e-02   +5.323208625875337e-01   +7.620913163325007e-01   +2.062740314395653e-02   +6.740031107521766e-01   +1.420196130402716e-02   +7.563788097416626e-01   +6.087131722798739e-01   +4.956377251777699e-01   +4.198751973192813e-01   +5.119194620771896e-02   +5.312934203096334e-01   +6.925364147697418e-01; +7.362418001437282e-01   +6.536709261324820e-01   +7.594868432911749e-01   +3.121841749287456e-01   +1.195694840336910e-01   +4.095419464367115e-01   +2.706025491551434e-01   +4.440785977391263e-01   +1.581016513168392e-01   +2.395389773345549e-01   +5.550786346655406e-01   +2.951820642554318e-01   +6.061554428506971e-01   +1.981378937902891e-01   +1.548063907445692e-02   +3.370287286162336e-01];
L2E_L1E_iAMPA_netcon = [+6.739932299520229e-01   +4.759708934940460e-01   +4.521002507670657e-01   +6.650411120392422e-02   +7.904150127384416e-01   +3.212075321387852e-01   +6.279084968523772e-01   +4.082530246300133e-01; +7.166655143607402e-01   +1.186827481648006e-01   +6.827895904751903e-01   +7.732268262352666e-01   +6.390504982512912e-01   +2.976517940891340e-01   +2.314181844791005e-01   +2.146712250298435e-01; +4.982385941821067e-02   +6.870664571302399e-01   +6.763823056890572e-01   +2.643533607662396e-02   +2.783277670418255e-01   +1.970879378592622e-01   +7.563961295370840e-01   +7.133415563244943e-01; +3.778253881836870e-02   +8.931153643576580e-03   +6.965903099932358e-01   +3.179541969608501e-01   +5.343614124479805e-01   +2.974261889662035e-01   +6.084301400234184e-01   +4.318930407569467e-01; +2.960087722567008e-01   +2.897876268004677e-01   +2.926627476312360e-01   +2.560553116894063e-01   +6.249551164618099e-01   +7.148612420619366e-01   +2.842728837391947e-01   +8.759695842847748e-02; +7.482954346449971e-01   +5.696305733101354e-01   +3.996509404508438e-01   +4.890211108791670e-01   +5.280050074374995e-01   +1.340576910121131e-01   +7.398485790973530e-02   +3.892398635196218e-01; +1.155187014905511e-02   +1.914618475124767e-01   +6.615297194251093e-01   +1.641560821388341e-01   +9.435818189208771e-02   +7.219258792000338e-01   +6.353112445976054e-01   +1.000847232709345e-01; +6.525894044354051e-01   +4.516129862677670e-02   +8.308032956307759e-02   +6.380733161107823e-01   +5.372179334307959e-01   +6.654345266253592e-01   +5.109345419767813e-01   +3.885392593640590e-01; +2.781680413062818e-01   +7.706886979704901e-01   +1.356504026597319e-01   +2.565624497746171e-01   +6.548783381667941e-01   +5.197294758993344e-01   +2.455918770736604e-01   +4.149627593615722e-01; +9.414172710174634e-02   +5.756789504872020e-01   +6.287568594261559e-01   +7.412747010539315e-01   +7.820389369872419e-01   +4.195243647093183e-01   +7.340413158940743e-01   +6.424019193377039e-01; +4.309562756601639e-01   +3.308413053511637e-01   +6.394246682055997e-01   +5.489567343551123e-01   +4.525591919043209e-01   +5.048305465727942e-02   +4.847840473436555e-01   +6.073657639318544e-01; +5.700632268459342e-01   +4.734008758777014e-01   +6.828272952639163e-01   +7.244859185445907e-01   +5.488648233332449e-02   +3.652723587780043e-01   +4.337735399460965e-01   +4.883217719463881e-01; +1.676222088830271e-01   +1.173192433293378e-01   +6.601460978125052e-01   +3.581940642122466e-01   +6.123311407696350e-01   +4.112016037071167e-01   +7.679796552300638e-01   +7.352160881203698e-01; +6.132409240902816e-02   +4.915747264154145e-01   +2.209893042990989e-01   +3.059179496017552e-01   +7.666932482962331e-01   +2.951624894145808e-01   +6.228562433336673e-01   +5.179026564009888e-01; +1.662870040515774e-01   +3.034946065667694e-01   +6.797251015844694e-02   +1.406542446507294e-02   +1.427418466888383e-01   +1.211202960987052e-01   +2.596621813923100e-01   +7.454747125589206e-01; +1.981070627194798e-01   +3.415244045855826e-02   +8.880780290742701e-02   +5.300949743212378e-02   +5.572213638902074e-01   +1.631140211804898e-01   +2.557470405099596e-01   +7.131701814172507e-01];
L1E_L2E_iAMPA_netcon = [+6.506309578501874e-01   +2.680438918859597e-01   +4.967421073572736e-01   +7.843013536719620e-01   +6.956679039563664e-01   +1.906813986906554e-01   +5.732050265484612e-01   +3.444985625388180e-02   +6.535343348216351e-01   +4.555319191699918e-01   +2.389240705417217e-01   +3.569503981043396e-01   +2.630481137264196e-01   +7.231146272936104e-01   +7.928333994478440e-01   +1.375936428812612e-01; +7.439066341145607e-01   +6.414761094056201e-01   +4.411833264394211e-01   +2.866918416558275e-01   +4.430837886891819e-01   +3.293738125647709e-01   +4.299369820823226e-01   +1.947170527509904e-01   +7.962116441791417e-01   +5.501333722116408e-01   +7.363056847443091e-01   +6.398896666234262e-01   -3.047893887640893e-05   +5.150967227318133e-01   +5.568903075389704e-01   +3.262596723321072e-01; +6.670560661878672e-01   +3.772924691987645e-01   +2.682145204501037e-01   +7.765459190894279e-01   +6.413857946597226e-01   +6.252490100624524e-01   +1.550205792954980e-01   +4.448051760388474e-01   +3.602435401280706e-01   +3.011248659656219e-01   +5.208451595519713e-01   +2.526767246688937e-01   +2.187243803731165e-02   +8.384887135517777e-02   +4.222432642975954e-01   +3.938103913944250e-01; +2.406390679482210e-01   +4.198487513101454e-01   +4.793565454049010e-01   +5.294484400531398e-01   +6.813196619845077e-01   +4.595667968502101e-01   +6.843166785945084e-01   +2.457212916780229e-01   +2.247901943620401e-01   +1.350300227591970e-01   +6.037514175518044e-01   +3.380266817155193e-01   +5.995466908280354e-01   +1.782578089781144e-01   +7.507302447076867e-01   +1.218577973134090e-01; +5.497032922881883e-01   +3.084804684589037e-01   +4.875227423637594e-02   +7.027685483676911e-01   +1.077121904686647e-01   +7.293847748897928e-01   +5.644798940115061e-01   +5.845230039933363e-02   +4.105653246224953e-01   +3.185859422897836e-02   +6.993842125089351e-01   +1.248031328963036e-01   +5.471450413300784e-01   +3.099401756340772e-01   +3.712117976036385e-01   +4.831838091294662e-01; +7.609315453932469e-01   +6.399709461789524e-01   +7.357440123480661e-01   +3.149600954334655e-01   +6.464573998655436e-01   +4.430094761920976e-01   +5.180225406907779e-01   +7.312790351505682e-01   +2.815957439602578e-01   +6.156468517735194e-01   +6.919681494555165e-01   +5.597418953121294e-02   +1.710780477768390e-01   +3.953587136683244e-01   +1.435141503088903e-01   +4.874316929679832e-01; +2.921000613613323e-01   +6.781058477680950e-01   +2.342449636244533e-01   +7.908933943728905e-01   +3.769866288130776e-01   +5.085399453383231e-01   +7.244674692140286e-01   +3.379019713580809e-01   +1.739900007407335e-01   +7.844111605717067e-01   +1.588779723324297e-01   +7.297220265134471e-01   +6.377549750295471e-01   +8.653651938039686e-03   +2.638979844485916e-01   +4.884954488215503e-01; +1.283348211735919e-02   +7.957720097830459e-01   +3.090763395020633e-01   +3.978699485313084e-01   +2.387567449639401e-02   +2.002774227381287e-01   +4.738267578510875e-01   +1.789921736829362e-01   +1.270779274087011e-02   +6.168065741428895e-02   +6.442726407316881e-01   +4.413723961472751e-01   +4.936107592918750e-01   +6.492583428563333e-01   +6.592360316520801e-01   +1.296748409896840e-01];
L2I_L2E_iAMPA_netcon = [+3.337892337452720e-01   +2.794877229654923e-01   +6.624411033286818e-01   +4.223000475991076e-01   +4.008144290545068e-01   +2.497339753505798e-01   +7.768368932672924e-01   +3.755186692609533e-01; +3.938446599755305e-02   +6.216054029528750e-01   +5.031276586947905e-01   +7.760569052432690e-01   +1.257300521259463e-01   +6.452575806649700e-01   +8.033208853120329e-01   +5.703114517525290e-01; +7.214233828538854e-01   +5.409702783270768e-01   +2.898398734732523e-01   +6.089686317649631e-01   +9.372242308009339e-02   +5.904792806884446e-01   +3.788186886938348e-01   +8.729011005647032e-02; +5.533831951615744e-02   +3.848226580576974e-01   +3.950199516402498e-02   +1.688518931304691e-01   +2.885856351746482e-02   +3.667968505000699e-01   +6.015837611565150e-01   +7.728227878426568e-01; +4.398728046945074e-01   +4.796086256750385e-02   +5.755895417601133e-01   +2.192644854728362e-02   +1.991407034350495e-01   +7.321326785429296e-01   +1.457733699292621e-01   +5.451381949614508e-01; +3.351104475681197e-01   +6.758226381934860e-01   +1.481349224194514e-01   +2.824924337160264e-01   +4.736905066899278e-01   +3.866141403431810e-01   +1.564182529192080e-01   +5.653656109567345e-02; +4.950062922117255e-01   +4.453317289192108e-02   +3.383243958977389e-01   +6.936882159240660e-01   +4.704233395884773e-02   +3.988220962509205e-02   +4.676646476367769e-01   +9.509135529563720e-02; +2.480172581225127e-01   +1.166568971787327e-01   +5.642245703078832e-01   +4.084613312170792e-01   +2.031908263214261e-01   +5.653789652406638e-01   +4.317227054383227e-01   +1.017424971139024e-01];
L2E_L2I_iGABA_netcon = [+3.628484025575498e-01   +7.948254716129572e-01   +2.196349958269466e-01   +6.985763976607667e-01   +4.371118717194588e-01   +3.795519258029496e-01   +7.221906408112265e-01   +5.270096665609436e-01; +5.894122567159256e-01   +1.345096298425308e-01   +3.353214911431083e-01   +6.261965717284672e-01   +3.745314120725035e-01   +1.337257998750880e-01   +6.895553245772091e-01   +6.960181740215774e-01; +4.175588606116732e-01   +3.972140440338641e-01   +4.917951194109315e-01   +2.579516689770624e-01   +5.626433486870934e-01   +5.811756150955181e-01   +5.970960583823051e-01   +3.616794688987404e-01; +3.306562005714448e-01   +4.824243825929606e-01   +2.153171779188131e-01   +6.670395509512898e-01   +7.985023045747254e-01   +6.881184575306497e-01   +5.748261661460019e-01   +7.329582160872865e-01; +2.526028268608005e-01   +7.205600014768151e-01   +2.968815203608577e-02   +6.468498857730830e-01   +2.322619915193440e-01   +4.688721977555965e-01   +1.808920878158310e-01   +3.450703369128298e-01; +6.497397557603793e-01   +1.759584459234362e-01   +3.552861579309210e-02   +3.923171716290114e-01   +4.321580390625329e-01   +4.326451451272254e-01   +4.532252787094515e-01   +2.661478501721058e-01; +5.982229792478946e-02   +3.603293032962618e-01   +2.362042252384221e-01   +5.354214528888328e-01   +5.069325169894769e-01   +6.652597205913491e-01   +3.711017794495218e-01   +1.760439740829709e-01; +6.270256556495841e-01   +4.198434236433080e-01   +7.472479831482759e-01   +1.826957460280001e-01   +6.026324504009239e-01   +2.544472133466666e-01   +2.189108662840453e-02   +5.325233714597674e-01];
L3E_L2E_iAMPA_netcon = [+1.606788259262317e-01   +4.691389787752131e-01   +5.084719272257733e-01   +1.963340042771106e-01   +5.561558976527523e-01   +2.691162872006980e-01   +6.890067631563964e-01   +4.747280315856074e-01   +7.816590265509560e-01   +5.848272212951560e-01   +3.876659107090489e-01   +5.914643598948490e-01; +6.088349453964409e-01   +1.857755972197701e-01   +4.278006328425883e-01   +4.856849478135695e-01   +7.306563901168533e-01   +8.563804046572947e-02   +7.372438452969408e-01   +3.534768703788251e-01   +3.961686918047587e-01   +1.802649555110696e-02   +3.896468605914824e-01   +1.811143864427830e-01; +5.483336433413275e-01   +4.950394714331349e-01   +1.076144672453558e-01   +6.666657862957823e-01   +1.368462776453225e-01   +6.139901714532937e-03   +7.520530916739332e-01   +5.697413430103754e-01   +3.009852686264537e-01   +5.883387648341644e-01   +2.721592693710371e-01   +1.681905263458568e-02; +4.054846409649233e-01   +5.198233306004538e-01   +7.700214960277749e-01   +5.504568909149195e-02   +6.266242667611105e-01   +7.155009707195573e-02   +1.765383322624944e-01   +1.965253181245631e-01   +5.647685841009803e-01   +2.195785415876866e-01   +7.352163309190425e-02   +6.121228562870067e-01; +2.767798689154086e-01   +1.448492725233701e-01   +2.100466548752123e-01   +3.169401993581773e-01   +5.596870693559892e-01   +4.048113270824371e-01   +4.514322289116697e-01   +6.255894872742993e-01   +5.004912735992404e-01   +2.222359420986936e-01   +5.154469519216802e-01   +4.129960561254470e-01; +4.805011213789999e-01   +6.717167554978766e-01   +2.685908474447395e-01   +7.100334014423285e-01   +8.440783656883677e-02   +2.351277858993560e-01   +7.651869059088483e-01   +3.030006420045407e-01   +5.215102391181050e-01   +1.426167204824169e-02   +2.576966238671831e-01   +7.875191985338368e-01; +5.651869597218009e-01   +5.050199125158255e-01   +5.874293021116141e-01   +7.486947968556196e-01   +6.939271391815286e-01   +3.586369732034121e-01   +4.897612994296582e-01   +2.166319343712359e-01   +3.132709849140391e-01   +1.289191888592437e-01   +3.992592239662722e-01   +1.763380882081495e-01; +4.434550913896506e-01   +6.765696644544608e-01   +2.358647538619283e-01   +3.815894372332041e-01   +5.936617557005122e-01   +2.321296773060194e-01   +4.246291777045240e-01   +1.788919901020444e-01   +2.610605021990590e-01   +1.518395545021805e-02   +7.371915876731479e-01   +9.705628112642414e-02];
L3I_L2I_iGABA_netcon = [+2.513028201183027e-01   +1.941465918275770e-01   +6.249328086585528e-01   +3.872034585545488e-01   +5.201281081854154e-02   +4.901572435435641e-01   +2.688506043732365e-01   +3.172395412332437e-01   +7.975994691594177e-01   +3.768823340165402e-01   +6.929613325792799e-01   +6.040059386060274e-01; +3.082135952362030e-01   +5.202139499202969e-02   +5.309427410445308e-01   +5.084103052235729e-01   +7.914828080753774e-01   +3.987059212483934e-01   +4.770879900685774e-01   +7.888934456773042e-01   +3.071363297467523e-01   +1.594071977742955e-01   +5.428649303693660e-01   +4.800759753053875e-01; +3.535035157702585e-01   +4.483045346613238e-02   +4.621583734843035e-01   +3.579728807519418e-01   +6.077583997458783e-01   +5.003528753132723e-01   +2.618408012887287e-01   +7.163028298445593e-01   +5.435186715954388e-01   +3.608128242244115e-01   +5.865395129242538e-01   +3.589090608386309e-01; +4.155211009980086e-01   +1.735710842929671e-01   +5.423693210770839e-01   +1.088853291546540e-01   +4.720899253212354e-01   +4.873485074571947e-01   +2.291437465033279e-01   +5.464589053055610e-01   +5.707960581608830e-01   +7.907273528136476e-02   +2.867203122736096e-01   +6.989562766931445e-01; +6.592993907331370e-01   +3.138873641658879e-01   +5.858589042616428e-01   +6.480298852566497e-01   +5.562948054370326e-01   +5.454964528416600e-01   +5.690205524334115e-02   +3.735117203455799e-01   +1.125208995015627e-01   +6.663627219036831e-02   +2.176546032408416e-01   +9.392385028591717e-02; +1.251456750070191e-01   +2.938195247637881e-01   +6.849237457179522e-01   +4.509736408216828e-01   +1.127506715261780e-01   +6.687768142751476e-01   +3.351775999193253e-01   +1.976061649744483e-01   +1.225386867962185e-01   +5.941815370108835e-01   +1.762904614135275e-01   +4.206101879891692e-01; +7.206714029376838e-01   +7.623845882623609e-01   +2.315056777693872e-01   +5.128635699973771e-01   +1.557339367327920e-01   +1.747158845862217e-01   +2.638548952257338e-01   +2.914421741634732e-01   +7.762716397377036e-02   +5.084216763585566e-01   +3.844692624117231e-01   +7.699207278106278e-01; +7.678456977742907e-01   +2.240370533487538e-01   +4.704111836631775e-02   +6.373971788989075e-01   +7.849817148148043e-01   +7.618618041183832e-01   +5.200909084461901e-01   +3.184269023781386e-01   +2.143687154341066e-01   +5.490193369489121e-01   +3.231894732748486e-01   +2.663885972038498e-01];
L2E_L3E_iAMPA_netcon = [+7.908959036511692e-01   +1.660643116502948e-01   +3.009866748443272e-01   +6.215935230874101e-01   +4.542893910432203e-01   +6.067324293928810e-01   +4.723778233085333e-01   +3.612673884238043e-01; +8.293252886467098e-02   +1.122675845585371e-01   +3.261700728855020e-01   +3.017928726285184e-01   +1.173634972953989e-01   +4.703006292800766e-01   +5.690170152098197e-01   +7.252215119037315e-01; +1.065599531684095e-01   +3.552549792614722e-01   +6.220800730559960e-01   +6.918478194357520e-01   +7.911054156699533e-01   +2.021793390788788e-01   +7.700186889507010e-01   +3.424373529631670e-01; +7.354406419626716e-01   +7.114645592002810e-01   +3.945780059273717e-01   +7.335704520516558e-01   +4.071106746537762e-01   +5.534570411601619e-01   +6.222522393108046e-01   +7.773358591971147e-01; +7.030411510402990e-01   +7.816433785565110e-01   +2.152452363914173e-03   +4.205843158362021e-01   +3.698791993015431e-02   +6.255455775861996e-02   +2.801228149229159e-01   +5.453790318569114e-01; +7.518545750763289e-01   +5.880860229285725e-01   +3.720028070094428e-01   +5.825600547624485e-01   +3.877104289023651e-01   +4.856367058926057e-01   +1.839343613259160e-01   +2.516238440459571e-01; +1.282921138788852e-01   +5.785322700026468e-01   +4.088110513365735e-01   +8.459297496630311e-02   +9.392943190112319e-03   +3.778440519274678e-02   +1.954326806607909e-01   +3.777693447001283e-01; +3.149258095089073e-01   +3.504325273602975e-01   +4.215735164932267e-01   +6.221221591290150e-01   +2.687677636312998e-01   +5.345286519379145e-01   +1.400797956186739e-01   +4.833646530088089e-01; +6.926059216623285e-01   +1.000481757722095e-01   +7.696880340946615e-01   +4.151812250184422e-02   +6.435417249029993e-01   +3.865966235587546e-01   +3.900505412894681e-01   +6.692532864578268e-01; +3.263876231065694e-01   +3.059102215731491e-01   +4.805050272621698e-01   +4.462719187813591e-01   +6.228183587149220e-01   +5.255331420363212e-01   +4.686463131930656e-01   +7.143966008037547e-01; +9.724635905127120e-02   +5.799705691784173e-01   +3.001910679145829e-01   +3.354477465657301e-01   +5.378583691315114e-01   +3.389547294238767e-01   +3.376780414908064e-01   +3.802673578748599e-01; +2.973623248610602e-02   +5.497233638735758e-01   +5.925150330870858e-01   +4.616542292061537e-01   +5.307186193177982e-01   +5.978847068204645e-01   +3.360499914890072e-01   +1.327521293738360e-01];
L2I_L3I_iGABA_netcon = [+7.373124684086567e-03   +5.259314973655762e-01   +3.583295145281954e-01   +6.568264216201914e-01   +4.737516791689715e-01   +2.592842051807623e-01   +4.716012988226475e-01   +2.771028610162941e-02; +3.178126756722880e-01   +4.749760685363592e-01   +1.399056883785515e-02   +5.696960072501960e-01   +7.130557787786957e-01   +5.649775204219641e-01   +6.453121667012781e-01   +3.368874784222048e-01; +3.235126317100928e-01   +6.762094435826783e-01   +6.599573071872897e-02   +1.623372934573574e-01   +2.767973200119599e-01   +3.039587407222626e-01   +2.301000377278124e-01   +3.344995537581988e-01; +3.764091046238468e-01   +6.162757898071057e-01   +8.684685306791437e-02   +7.933996215347753e-01   +5.261942645058238e-03   +7.891326032689524e-01   +3.423165366228312e-01   +6.249445098894235e-01; +5.064406926167693e-01   +5.792728739098734e-01   +1.099871896577429e-01   +6.779465372652302e-01   +4.235577583369717e-01   +1.470996077067339e-01   +5.393054013574504e-01   +3.099067328354997e-01; +5.282212080524676e-01   +2.837401102249408e-01   +5.047600611949935e-01   +7.665600526801845e-01   +5.465109571037263e-01   +1.497934488084945e-01   +5.153844312220781e-01   +1.238334444065052e-01; +2.850062985261889e-01   +5.916822433205627e-01   +7.798849444533848e-02   +6.282024511793977e-02   +2.157900600073419e-01   +6.092682317988800e-01   +4.991998557611891e-01   +4.309732697823628e-01; +6.886732622737126e-01   +4.924609023733565e-01   +2.356696960061460e-01   +3.812953902330057e-01   +5.472989387261605e-01   +6.525518712284537e-01   +4.375039541154926e-01   +4.501156607692650e-01; +2.516489200501776e-01   +5.015112197526320e-01   +3.514366290452259e-01   +1.736004216499582e-01   +3.946119485202823e-01   +5.192364788481973e-01   +3.602048924297800e-01   +3.343130758471154e-01; +6.467432910389471e-01   +2.447267660635023e-02   +2.530968780947207e-01   +3.629620322043636e-01   +4.700386043000141e-01   +3.486473236466202e-01   +1.987271731531538e-01   +5.025075535867670e-01; +2.306457443634339e-01   +3.688270040374255e-01   +6.157001923336227e-01   +1.008822235208570e-01   +4.854496072873791e-01   +4.280202912395767e-02   +5.881972177070277e-01   +3.097680469452474e-01; +6.984190587434042e-01   +6.065417043274005e-01   +6.111301145945317e-01   +2.083355906632031e-01   +7.808855265508279e-01   +7.818815712462979e-02   +4.936906160833369e-01   +2.710916612799987e-01];
L3I_L3E_iAMPA_netcon = [+5.322891530866894e-02   +5.068984924593912e-01   +3.745334456155177e-01   +3.672992764631638e-01   +2.425756152191121e-01   +2.145121321232091e-01   +1.926813189565739e-01   +4.571847774294606e-01   +5.882209146424603e-01   +4.211038074601103e-01   +2.060494761300578e-01   +5.191419516967061e-01; +4.474886246082905e-01   +5.353564692008256e-01   +4.000292166981306e-01   +6.402286775565492e-01   +3.748855687211893e-01   +5.485408021888577e-01   +7.824900619041657e-01   +4.314800578649511e-01   +2.344995119723309e-01   +3.320822857469179e-01   +9.912206280715102e-02   +7.835351797498878e-01; +6.556139806492682e-01   +6.558930990449545e-01   +4.266282218349748e-01   +6.640717496495079e-01   +6.405144407456211e-01   +6.837036508792945e-01   +1.791237078679107e-01   +9.500744051196748e-02   +6.505495784407817e-01   +4.228766209863963e-01   +1.914186191558312e-01   +2.228574507881444e-01; +3.220971003305408e-01   +3.548286072803002e-01   +8.635498079347903e-02   +1.732212891501812e-01   +8.614443326032455e-02   +3.079519971059650e-01   +6.252419477262289e-01   +1.355250753583489e-01   +4.061023438926911e-01   +3.323519707774419e-01   +5.418809073568357e-01   +2.446777337311818e-01; +3.759269967400713e-01   +5.455247939696259e-01   +4.693450873416010e-01   +1.669313600854285e-01   +3.793299090464760e-01   +2.113624177488264e-01   +7.490640429968473e-02   +1.912114230629181e-01   +1.128720419121860e-01   +7.873408386440371e-02   +2.425934296482032e-01   +5.033478291661199e-01; +1.195311078924044e-01   +1.766052679934141e-01   +3.416242824227929e-02   +4.227966467662900e-01   +3.540103843851388e-01   +2.308960033972740e-01   +1.931743339607302e-01   +4.003011490356793e-01   +2.599700335093063e-01   +1.457364192333404e-01   +5.964706114131195e-01   +7.373759735265202e-01; +4.542769923964580e-01   +6.956651129982372e-01   +1.017790109982560e-01   +7.474080668253394e-01   +7.009565990212320e-01   +3.389008285550267e-01   +3.598803953979183e-01   +1.353028847911248e-01   +2.687784950453810e-01   +5.814102042962956e-01   +2.015591851573349e-01   +7.853328693866247e-01; +6.772399043897703e-02   +5.121605037664019e-01   +2.857248159051686e-01   +7.512934276223588e-01   +7.483060762077831e-01   +5.705258852168196e-01   +6.330047336374687e-01   +2.782416651935293e-01   +1.275577998604787e-01   +4.195843063739191e-01   +2.136241652744157e-01   +1.457505322330764e-01; +2.249073471155644e-01   +5.401094487913992e-01   +2.713583021836248e-01   +1.418392635755416e-01   +4.622019727027198e-01   +4.963369700019870e-01   +6.531501287096262e-01   +6.279680963531318e-01   +5.445020650719775e-01   +7.569862094042390e-01   +2.437520039800652e-01   +1.135799559636122e-01; +2.625528356401504e-01   +1.258368881534633e-01   +1.323933361744252e-01   +6.291219559942749e-04   +2.434312033129792e-01   +1.243823417894249e-01   +3.052818403529098e-01   +1.569808330997705e-01   +6.534876334964458e-01   +7.040562364388114e-01   +4.228960488164462e-01   +2.760740409748357e-02; +1.303979402669214e-01   +3.290272867273379e-01   +6.757538484052701e-01   +1.373025281585022e-01   +7.186889893518233e-01   +4.694468713280996e-01   +5.664797014403141e-01   +7.959803327869629e-01   +1.198641640503426e-01   +7.736470412993460e-02   +4.436798780585201e-01   +7.805717506128461e-01; +6.433993773379791e-01   +5.118966770819041e-01   +6.112290467133861e-01   +6.644165850528245e-01   +7.577458399023740e-01   +7.432892116363966e-01   +4.709243366162114e-01   +3.216341009789210e-01   +6.641343472717141e-01   +1.626234525746164e-01   +4.450411642424972e-01   +4.763521721399395e-01];
L3E_L3I_iGABA_netcon = [+3.326001546046335e-01   +2.262106166372606e-01   +1.706257951260397e-01   +7.719804413821838e-01   +5.752823735571837e-01   +6.888870215299542e-01   +4.477015322713659e-01   +2.338177152696342e-01   +2.049451627828036e-01   +7.412226540072548e-01   +7.234218871269088e-01   +4.070002757844812e-01; +2.762320890570937e-01   +5.302690200900403e-01   +2.095058074024542e-01   +9.387551209925016e-02   +4.340669593263011e-01   +7.077229626265891e-01   +7.622160408898609e-02   +6.204877642978393e-01   +3.472887348432260e-01   +4.783785807643121e-01   +3.891920821267418e-01   +1.319837611394820e-01; +5.424025676838359e-01   +3.460238930113130e-01   +5.681795054913261e-02   +1.365303892578116e-01   +2.571609969235386e-01   +6.429183275090338e-01   +5.439855286788232e-01   +4.317713759953057e-01   +6.597905940975201e-01   +5.011949465745091e-01   +6.679941975640945e-02   +3.405646431745317e-01; +1.719860704305115e-01   +4.102714883373258e-01   +1.588820912240281e-01   +1.569549263472842e-01   +2.066234490892457e-01   +6.781419495124893e-01   +1.800918386250750e-01   +5.874713622966566e-01   +7.320068266925647e-01   +6.251692024383073e-01   +7.041134196808246e-01   +5.472085112103273e-01; +3.845136926644697e-02   +3.030362606716955e-02   +6.638765037199621e-01   +4.957913977782058e-01   +7.815469705839437e-01   +3.896793331329483e-01   +4.421736433886023e-01   +6.867689107270849e-01   +5.746452311888172e-01   +4.240465563053068e-01   +4.141799681601109e-01   +4.247841919560554e-02; +3.955233333333019e-01   +1.661465234788197e-01   +3.790339557603269e-01   +2.222925901971738e-01   +5.485626839936436e-01   +2.295231661730048e-01   +5.443412962992044e-01   +2.943584240114846e-01   +7.852960472717136e-01   +2.572768249256372e-02   +5.189703487454010e-01   +4.264922888824882e-01; +6.744377311162513e-01   +5.774268443914344e-01   +2.164845128772131e-01   +1.129713951299352e-01   +3.199844716869305e-01   +3.410335989952417e-01   +5.692699562761875e-01   +2.346425536425274e-01   +5.466310952375353e-02   +6.882033113628107e-01   +3.505599705781405e-01   +1.564627906621918e-01; +2.795521916924780e-01   +7.914399709429406e-01   +4.299982275019055e-01   +1.051364635936031e-02   +3.296703320905138e-01   +1.674333604505745e-01   +8.091684540538674e-02   +7.343845270392786e-01   +6.320823429244941e-01   +1.202272003353866e-01   +4.933210238036749e-01   +3.932810993723241e-01; +4.435774985807419e-01   +2.793649187398741e-01   +7.584572278270484e-01   +1.272450673334046e-01   +7.330604338157457e-01   +3.355498344020946e-01   +1.650842700226668e-01   +6.318185237612835e-02   +4.601715292671574e-01   +7.848606900832292e-01   +1.680573410021589e-02   +3.255132554789212e-01; +2.606987048050341e-01   +3.576486421919275e-01   +6.004523629257863e-01   +1.324182568127283e-01   +3.253371993655662e-02   +4.131040455869742e-01   +1.243972637711997e-01   +3.653411918135384e-01   +2.345272258127083e-01   +9.364870259694198e-03   +1.343179126780960e-01   +5.093105320278527e-01; +4.251982939481802e-01   +1.336939301376358e-01   +4.041202421859198e-01   +7.109697767062205e-03   +2.590322518225333e-01   +5.468258475118568e-01   +6.525156888603200e-01   +2.977468735613872e-02   +7.531201704637493e-01   +3.120751018147151e-01   +6.784430446164222e-01   +5.320340262403343e-02; +5.536665110486749e-02   +5.492140212458181e-01   +3.115010186871396e-01   +3.302563898520186e-01   +6.708710836592456e-01   +4.526871006687605e-01   +2.018968826161378e-01   +5.699679175035370e-01   +2.183461651250981e-01   +5.305085892068311e-01   +2.629153212955411e-01   +3.795324779365761e-01];
L2E_Input1_iAMPA_netcon = [+1.799717461917670e-01   +7.832538582043305e-01   +6.966074965980409e-01   +4.650099251453693e-01   +4.105625829071687e-01   +3.840793972785495e-01   +6.312202296591578e-01   +3.368232340997862e-02];
L2I_Input2_iAMPA_netcon = [+1.903553329905752e-01   +5.771198943634879e-01   +4.969527585885054e-01   +6.468989187493217e-01   +3.114559965990211e-01   +2.778117313942308e-01   +6.285560137526305e-01   +2.647158987496130e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
