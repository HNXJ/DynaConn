function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.865797589660502e-01   +9.728079542715404e-01   +5.863579152064511e-01   +1.994020621549051e-01   +1.135976949343626e-01   -2.342376507890092e-01   +4.073000604070284e-01   +1.393273480062972e-01   -6.465279803758930e-02   +6.214336554329948e-01   +3.906224501054580e-01   +2.056900934206144e-01   +2.993137021873674e-01   +3.536131282255724e-01   +8.808858989712052e-01   +1.000000000000000e+00; +8.967445166945428e-01   +3.816088511715025e-01   +4.453688919794226e-01   +4.752113593276469e-01   +4.387046059310786e-01   -2.820465661931757e-01   +2.597576477493808e-01   +4.755951478447236e-01   +6.359711397810192e-01   +4.422050295753532e-01   +6.438252598910134e-01   +2.106115303284972e-01   +7.996621714077781e-01   +8.740939838839194e-02   +6.124654798413836e-01   +6.168011106192528e-02; +3.568269363032289e-01   +8.791873859888971e-01   -7.073891214349617e-02   -7.085151375661580e-02   +4.844202071069247e-01   +7.343711730306764e-01   +2.941161737809470e-01   +3.667676471047382e-01   +3.352195818324013e-01   +8.552480271397013e-01   +8.195419668624059e-01   +6.407338595422736e-01   +3.314303912567489e-01   +5.388787187747934e-01   +3.019300984570801e-01   +2.468555375816801e-01; +8.084985021325622e-02   +8.977381949252424e-01   -2.625262978354611e-03   -2.755157541927780e-01   +4.438698180636268e-01   +4.010118882675026e-01   +3.487783750066080e-01   +2.837024030448315e-01   +6.078001010972739e-01   +2.821895934446337e-01   +8.101576997028495e-02   +9.040137762605327e-01   +2.170679583004835e-01   +1.007318547162002e-01   +7.617668930740146e-01   +1.760724982367864e-01; +1.768470119248308e-01   +1.453318067808175e-01   +2.095087263739719e-01   +5.102983937902853e-01   +6.790316460710824e-01   +5.183138225421914e-01   +3.630249461434960e-01   +1.859860211370690e-01   -2.100637379348019e-01   -1.054635871796453e-01   +5.742053087440512e-01   -5.132477209380425e-02   -2.272779546815849e-01   +3.099252847639096e-01   +2.125265092546171e-01   +1.407089138738265e-01; -1.796033490136394e-01   +7.822856335695408e-01   -2.844708994188186e-01   +2.923191863173543e-01   +8.823527200440295e-01   +4.824456069584959e-01   +3.108029515256807e-01   +1.472166400810725e-01   +2.407694230149504e-01   +1.967656456334722e-01   +2.585666789174755e-01   +6.014734792173100e-01   +3.665105329168518e-01   -2.251169470727460e-02   -1.467816164737624e-01   +1.666459679101278e-01; +1.632223556149037e-01   +4.023280837783098e-01   +3.831206242540071e-01   +7.619072627019898e-01   +3.477344561337022e-02   +3.112386535885464e-01   +1.697875866986691e-01   +4.502114885014865e-01   +6.588370089902840e-01   +3.220168514154262e-01   +7.084146468989595e-01   +5.153661397530820e-01   +6.436814963802332e-01   +1.311942610149176e-01   +5.968627351411452e-01   -2.893828267274265e-02; +2.565402953892464e-01   +8.524360267009230e-01   +3.302881476723912e-01   +4.617861164245269e-01   +5.424989845886495e-01   +3.207460675476579e-01   +4.138952916140279e-01   +2.951524377270724e-01   +5.157531439912220e-01   +2.733430743380617e-01   +2.016943891430504e-01   +1.539582915194367e-01   +4.283463567620190e-01   +4.546698844023768e-01   +6.419116653266718e-01   +6.858742120671295e-01; +2.146982222358400e-01   +1.475711153452420e-01   -1.432881811047187e-01   +4.060420598020640e-01   +3.353864112316624e-01   +3.373705849542091e-01   +8.963340544394850e-01   +7.650093472443563e-01   +4.372125306082911e-01   +3.298529604690312e-01   +6.146994018978108e-01   +4.453906659189103e-01   +5.186376773591416e-01   +1.684177086749098e-01   +1.446568306636269e-01   +4.225171766470308e-01; +3.963886205213376e-01   +1.213877053746625e-01   +7.455830476480171e-01   +2.305346369622220e-01   +4.192196398849212e-01   +2.582600258029462e-01   +4.529387818115200e-01   -1.585678257539843e-01   +3.191436519630078e-02   +4.196700028691622e-01   +1.402199179469640e-01   +3.360814880969280e-01   +1.929083766629137e-01   +4.229827435234007e-01   +3.439297943946826e-01   +2.772259395109937e-01; +2.689590407940500e-01   +2.691781309953876e-01   +5.430221111000449e-01   +2.234587187418494e-01   +8.401680658180115e-02   +2.075643551636857e-01   +6.242549993807915e-01   +2.093749908437606e-01   +4.121585571670450e-01   +6.544617153768432e-01   +6.333455863420069e-01   +6.855021024930460e-01   +7.052614690885126e-01   +4.626015371003716e-01   +2.487577404814003e-01   +4.503205434611577e-01; -2.302318803022025e-01   +2.307149996038336e-01   +6.764760248466914e-01   +1.426157693427285e-01   +5.730646424772280e-01   +5.193896800083887e-01   -9.032930839250518e-02   +1.867488753053123e-01   +7.098157072545476e-01   +2.594832004538914e-01   +1.215243088885987e-01   +6.652587052737468e-01   -2.243033297964669e-02   +6.624406271440456e-01   +5.519948554374177e-01   +6.307369754342973e-01; +7.367353340502082e-01   +2.990107915405817e-01   -1.620704462944754e-01   +2.662198024654364e-01   +9.337990677011524e-01   +1.640073620345296e-01   +3.010309519263373e-01   +4.155825976617254e-01   +8.102407204515640e-01   +3.159247676075321e-01   +3.487974308042219e-01   +7.941342888424385e-02   +2.234701420896774e-01   +5.661864803296577e-01   +5.933220244336611e-01   +8.980490159156070e-02; +1.299532170613737e-01   +1.038335440705664e-01   -9.099323887818801e-03   +8.403408768697757e-01   +6.846366000989161e-02   +1.344230845427348e-01   +7.256444289783851e-01   +7.158492332273177e-01   +3.792114653765587e-01   +6.548597971702224e-01   +5.163566388490882e-01   +5.021530776503911e-01   +2.070980663996478e-01   +6.113880862809131e-01   +6.228585845040268e-01   +1.563045474811099e-01; +7.924433926119934e-01   +8.196945740422955e-01   +2.232068180695670e-01   +5.733243484026965e-01   +4.403977914044721e-01   +7.096313028221891e-01   -1.074013095968801e-01   +1.841384982082316e-01   +1.865229983185481e-01   +6.761683552519046e-01   +3.074782244239208e-01   +6.574071953403452e-01   -1.823499776239435e-01   +2.649680023756846e-01   +4.054899476893028e-01   +6.957687770714922e-02; +2.951622669330130e-01   +4.056095563114461e-01   +1.496373098508244e-01   +8.110706882518819e-01   +9.543010025696780e-02   +5.448815572246525e-01   +4.760294047776632e-01   +4.917887193951557e-01   -1.869127689900763e-01   +1.739680664947025e-02   +6.701033640187302e-01   +8.732301197618800e-01   +5.682540993074053e-01   +3.528911823417040e-01   +7.629924649284631e-01   +6.612152114140220e-01];
L1E_L1I_iGABA_netcon = [+3.477587896660022e-01   +3.295419712377873e-01   +3.893084829248383e-01   +5.402956117352911e-01   +9.901843219911562e-01   +6.222696424102359e-01   +5.554088991038576e-01   +6.262253056997077e-01   +2.141658143472143e-02   +9.873187836863168e-01   +7.077575053457719e-01   +3.596276463270254e-01   +4.973733518716993e-01   +2.357839852814345e-01   +6.730248135269489e-01   +8.102884702138796e-01; +3.095255291414423e-01   +3.632442424192858e-01   +9.478868768849692e-01   +4.273174290415332e-01   +2.595102794388862e-01   -7.284704840006481e-03   +8.638370775604147e-01   +8.521660503944906e-01   +1.507746065313733e-01   +4.887454556242186e-01   -1.708199376391857e-02   +6.988708415539183e-01   -1.345155711974068e-01   +3.378024392034887e-01   +7.584413812235815e-01   +4.522674793104388e-01; +2.992049410888953e-01   +2.120832773834398e-01   -1.099007817061540e-01   +6.952527650456140e-01   +2.389045312068901e-01   +9.399256675729685e-01   +9.523204193556270e-02   +5.457483121951920e-01   +7.367416980345206e-01   +2.870823779292427e-01   +4.843365772808711e-01   +6.771350189080649e-01   +6.079035670120738e-02   +3.454165640274471e-01   +6.361124098507348e-01   -1.586421793380889e-01; +1.648413519044117e-01   -2.009193990149981e-01   +5.633754414980029e-01   +5.557160820770226e-01   +2.926073556252395e-01   +3.863856467464751e-01   +5.182270842209558e-01   +3.791692643987571e-01   +2.841830467715631e-01   +4.320169227446419e-01   -2.322615052411084e-01   +4.547804927432793e-01   +5.347495749538230e-01   +2.793020227785972e-01   +4.131928574328835e-01   +6.269381898725396e-01; +4.632335649584858e-01   +3.828122994666602e-01   +2.280788288337744e-01   +5.937430747021677e-01   +3.076201722999090e-01   +4.006145361688738e-01   +6.765615567051339e-02   +6.594225601001605e-01   +7.313867150052944e-01   -1.101609356994713e-01   +2.681248635458381e-01   +6.477413355656673e-01   +3.384328904862893e-01   +4.638476503242050e-01   +1.104893429401480e-01   +1.747998573513740e-01; +3.453076239189670e-01   +7.329252025646057e-03   +4.471874132071277e-01   +1.275911280816121e-01   +5.853199763003758e-01   +3.360406914713512e-01   +4.683544037113987e-01   +9.155297421810138e-01   +9.129878128961951e-01   -9.615520929491257e-02   +3.044578873246677e-01   +6.270609530158654e-01   +5.373142869509057e-02   +3.784799681509090e-01   +4.320924211518077e-03   -4.717959176159139e-02; +6.270838347255191e-01   +3.631024696265613e-01   +8.430526228170689e-02   +4.425206236327248e-01   +7.127955979011261e-01   +1.000000000000000e+00   +1.848222701690314e-01   +3.949547253035721e-01   +7.412121751486488e-01   +1.989406923166995e-01   +1.379357218288458e-01   +1.418399486660369e-01   +3.189913344539452e-01   +4.121188425708370e-01   +2.832504125781855e-01   +7.506522198783422e-01; +1.389689927195008e-01   +6.355464891654797e-01   -5.914211354700137e-02   +4.851104007156827e-01   +2.902455162528957e-01   +2.832806204981290e-01   +1.404545230754810e-01   +8.974163068794804e-01   +8.239469423894334e-01   +6.364053158813474e-01   -2.326577632672025e-01   -6.346685197121170e-02   +9.902159200087599e-02   +3.795333021140296e-02   -1.158937638978395e-01   +5.055186088588266e-01; +7.528414188155000e-01   +8.441022404473028e-01   +7.333639996402373e-02   +6.579857030180848e-01   +7.996668990192510e-01   +1.990675762326286e-01   +5.521211662651193e-02   +1.559411409702997e-01   -1.598870514248157e-01   +4.038292125883395e-01   +4.316125499919625e-01   +1.944629672051222e-01   +4.160230240796566e-01   +3.590769896888997e-01   +3.717088779353375e-01   +2.420184461811150e-01; +1.279826623302197e-01   +9.604343264651576e-01   +7.823065670621434e-01   +3.916128896410142e-01   +1.458846932679341e-01   +2.261857441764778e-01   +3.334820679366074e-01   +7.328805395951901e-01   +2.376293250485072e-01   +1.812613394913312e-01   +1.946450897955080e-01   +6.798686877890550e-01   +1.845735124825813e-01   +1.742467018469731e-01   +8.336563656486752e-01   +1.258487694930052e-01; +5.827420445726004e-01   +6.219047629187255e-01   +2.528476792328591e-01   +1.421469028021041e-01   -7.684150140912889e-02   +1.885138005861708e-01   +8.908007852277948e-01   +6.217536751499839e-01   +1.673609607069078e-02   +7.960980271357572e-01   +4.287921222131338e-01   -7.909333278808899e-02   +2.364043786716854e-01   -1.021303727580151e-01   +4.250526249806719e-01   +6.672178867190883e-01; +3.922799441443126e-02   -2.036928446600931e-01   +1.649339191369388e-01   +7.241702416392631e-01   +1.459967291750133e-01   +2.249059239833434e-01   +3.227295316835856e-01   -2.495792562728501e-01   +1.066824418565863e-01   +7.266446524873132e-01   +7.709904120362266e-01   +2.252846962881632e-01   +4.694224222603737e-01   +3.683474850602584e-01   +9.823472288174177e-01   +6.381585276984335e-01; +1.725876887317136e-01   +4.508703562621725e-01   +5.392880277129389e-01   +8.178757152981977e-02   +2.401952979284060e-01   +8.201817910682024e-01   +2.627471391186694e-01   +7.812639980599708e-01   -2.169231958386611e-01   +5.944955584507410e-01   +8.913427723617826e-02   +2.852695849859900e-01   -2.212449322671578e-01   +3.765703587962286e-01   +2.717352816272106e-01   +6.821316377369356e-01; -2.787532384413718e-01   +2.400802912947432e-01   +4.415104972002026e-01   +5.312481099639440e-01   +6.714902609648908e-01   +2.309327797942764e-01   +1.679974297710203e-01   +4.679611112225661e-01   +2.840202451910411e-01   +8.278276066132161e-02   -8.661190018562909e-02   +6.436377306432285e-01   +1.857290821497850e-01   +1.916222267879493e-01   +6.035864960713847e-01   +3.206181565699951e-01; +5.625827727215928e-01   +7.246479871262865e-01   +3.539053024161955e-01   +6.168787912527417e-01   +3.700893774442955e-01   +4.819643277792918e-01   +4.834509802953460e-01   -2.514217361371594e-01   +3.453302700728842e-01   +3.132139670212995e-01   +8.408200936954496e-01   +7.276783464975338e-02   +4.494550130359998e-01   +1.314130812089985e-01   +8.527894112072717e-01   +2.055589258966256e-01; -1.090510210848419e-01   +7.691833754149329e-01   +6.427224905846717e-01   +9.105390248896087e-01   -6.253216298677129e-02   +2.385301367274157e-01   +6.449377706034541e-01   +4.722409246947158e-01   +4.609305286050713e-01   -3.358070213196705e-02   +4.438005115432217e-01   +4.636482970004921e-01   -3.645940612391638e-02   -1.081882241024326e-01   +1.703159278905909e-01   +6.567635294998548e-01];
L2I_L1I_iGABA_netcon = [+3.729466164826133e-01   +9.157655242841816e-01   -1.363423438954739e-01   +7.161057594113512e-01   +6.155495045228836e-01   +5.961857863532342e-01   +4.298519765468988e-01   +4.397494498846419e-01; +3.915003187730525e-01   +8.974150398000683e-01   -7.144045779227304e-02   +5.018873171263201e-01   +6.621220756044112e-02   +6.962895604794520e-01   +8.436289087036460e-01   -2.485600281683018e-01; -1.362038262625291e-01   +8.553254937620790e-01   +3.704778938017594e-01   -1.566933889072696e-01   +9.372892604628332e-01   +2.647700767759619e-01   -2.109810002537536e-01   +3.632516504042772e-02; +2.730818213200391e-01   +5.269225201808445e-01   +1.509047447081658e-01   +4.497766853907733e-01   -7.966355849102727e-02   +5.969365623508996e-01   +5.208153301540686e-01   +8.080119597735281e-01; +4.986403938921946e-01   -1.923730009329800e-01   +3.556143152341253e-01   +2.317098474068909e-01   +4.084342081145748e-01   +3.532981692615306e-01   +4.508080658528137e-01   +7.180995658848373e-02; +5.771065868747450e-01   +2.353342562346515e-01   +1.123853806311122e-01   +4.814197290033105e-01   +8.482602504147375e-01   +5.811002476933705e-01   +1.660580111355762e-01   +3.773684008975391e-02; +3.074191457596456e-01   +6.652197656547466e-01   +3.593052842180444e-01   +2.861067738370657e-01   +6.125036760849325e-01   +3.417411374236907e-01   +6.213006881227116e-01   +6.476343120219723e-02; -2.134816121569912e-01   +9.140816915024988e-01   +5.037830886825150e-01   +7.926508914748620e-01   +6.628728517695512e-01   +1.000000000000000e+00   +8.197803288495153e-01   +5.240553369113368e-01; +9.503512455277992e-02   +6.881312436611161e-01   +3.271594810659466e-02   +1.993400117707728e-01   +5.049524882962945e-01   +1.462230069088692e-01   -1.687894645029810e-01   +4.731670076647531e-01; +5.197340719207441e-01   +2.984069407170454e-01   +2.324817659145281e-01   +6.822933322717089e-01   +7.150915296821526e-01   -2.113834778289855e-01   +3.730909523978585e-01   +3.706164031791069e-01; +5.129544735076010e-01   +6.103954708979419e-01   +6.971923914848436e-01   +8.537775279439855e-01   +2.821980497673745e-01   +8.581392538357940e-01   +8.714939639269124e-01   +2.607174427917311e-01; +5.507024338977211e-01   +2.135382971861051e-01   +6.500380870433141e-01   +2.846963597277986e-01   +4.216241981374834e-01   +1.046310272057256e-01   -1.556523485509552e-01   +3.134112902846687e-01; +2.258935483323154e-01   +6.487433647986336e-01   +2.737110020531925e-01   -9.140711453235138e-02   +8.893864558135149e-02   +3.064587367734821e-01   +5.283969372419693e-01   +4.365330886354975e-01; +5.452294601928098e-01   +2.014595297885924e-01   +2.807355234164058e-01   +6.296350329925148e-01   +2.929915991560438e-01   +2.858917484567028e-01   +4.970081831575024e-01   +3.143672817572402e-01; +6.589761739184982e-01   +5.445211380426419e-01   +4.394781533200438e-01   +2.817975297668976e-01   +6.158969603853721e-01   +1.184231284267712e-01   -1.835856786483923e-01   -6.477119286379901e-02; +2.503412201596471e-01   +4.289631157868316e-01   +2.250506786681294e-02   +6.503261661499440e-01   -1.550066937507514e-01   -7.921458345521568e-02   +1.121320413637700e-01   +4.206085521597866e-01];
L1I_L2I_iGABA_netcon = [+5.612242590341000e-01   +3.426787973333322e-01   -9.000799541267548e-02   +4.235012629343454e-01   +3.464617266531445e-01   -2.002050235444897e-01   +4.939070745542355e-01   +2.362770263560724e-01   +4.231044407630939e-01   +4.266402074702451e-01   +1.229801824653184e-01   +7.477755047003853e-02   +2.363730687294511e-01   +3.124103245289653e-01   +4.311807781927597e-02   +3.599807294099490e-01; +4.652102308121086e-01   +6.130395477593724e-01   +4.301059451106792e-01   +4.624959042192366e-01   +8.510890076335471e-01   -1.776147893936279e-01   +1.079318570236490e-02   +2.284003597447071e-01   -8.416650517408353e-02   +7.036232299127619e-02   +1.483739782841407e-01   +3.238624404205709e-01   +6.546112729905209e-01   +3.193060894007679e-01   -5.852832981042037e-02   +3.914211411077516e-01; +5.396948692959129e-01   +1.346340208267570e-01   +5.670849697803940e-01   +7.252387885945056e-01   +2.082867671006302e-01   +1.895415791358794e-01   +8.616804261140254e-01   +1.751509925302195e-01   +6.186225067171145e-01   +7.369257942511540e-01   +3.413664484888612e-01   +4.385764082861715e-01   -7.902985947167103e-02   +3.502650262707704e-01   +4.853965770201413e-01   +2.345312721865000e-01; +7.556441673964308e-01   +9.274834897508140e-02   +3.926701835770037e-01   +5.643633322160921e-01   +2.384610430890735e-01   +4.415454839491158e-01   +9.698815149227587e-02   +6.520537795590049e-01   +1.000000000000000e+00   +2.928789108424377e-01   +5.295130428193862e-01   +7.582097577098849e-01   -2.315363348920838e-02   +6.663230051914071e-01   +3.755580641205189e-01   -1.671882415799205e-01; +1.967190791267894e-01   +3.271636124250978e-01   +1.591559689916396e-01   +3.319509274451388e-01   +2.034706213538505e-01   +5.987558260939442e-01   +6.455272206865051e-01   +8.759783259239722e-01   +1.486085122290710e-01   +3.456997267589067e-01   +7.742312659502734e-01   +3.886332437832982e-01   +3.928611909648988e-01   +3.182239454020812e-01   +2.078896066033823e-01   +3.372736805333758e-01; +5.233453252416386e-01   +4.505254299073011e-01   +9.554586230313692e-01   -4.756291777810902e-04   +5.736059380636190e-02   +4.086400757652622e-01   +2.803639198393964e-01   +5.893424829418679e-01   +7.281239065587201e-01   -2.510137037053656e-01   +3.991334953266674e-01   +5.130821893613575e-01   -1.012466892510631e-01   +3.043679671894186e-01   +8.879041178399126e-01   +4.673680263994335e-01; +2.797751497516412e-01   +4.155188438354103e-01   +5.335199380015186e-01   +3.541583839641304e-02   -1.560595437438639e-02   +8.305209564038331e-01   +1.018089116032607e-01   -3.292588466819089e-02   -2.126520291608383e-01   +7.013675954591622e-01   +3.486736217950324e-01   +7.916365864853188e-01   -2.520149390227688e-01   +5.443643844140256e-01   +6.264972162403991e-01   +6.942183980817085e-01; +5.018435695238408e-01   +7.890907456571155e-01   +3.416408742061276e-02   +4.376730232707879e-01   +4.895177032125550e-01   -1.544482252243409e-01   +4.725876144182742e-01   -9.833566357331999e-02   +4.038955033934895e-01   +2.948816405123337e-01   +1.443136882084210e-01   -8.858378129150289e-02   +6.123275903398047e-01   +7.205352395166111e-01   +6.822035555697962e-01   +2.885305495710020e-01];
L2E_L1E_iAMPA_netcon = [+1.278260895885144e-01   +4.277277955097865e-01   +4.619547411196876e-01   +6.388188116806801e-01   +4.597048998105946e-01   -2.807530131497510e-01   +3.616656817926643e-01   +2.722811890476888e-01; +1.471357558463611e-01   +8.429654253446752e-01   +7.659454376923616e-01   -2.176631005125612e-01   +9.184477683842902e-01   +7.479841572664598e-01   +3.830108122298470e-01   +3.318285908624263e-03; +3.245543976607029e-01   +7.195614785220961e-01   -1.186948111078030e-02   +2.160986359923669e-01   +8.091522667142432e-01   +6.002473399474051e-01   +4.593390576512748e-01   -4.349915009548427e-02; +1.720688377432230e-01   +3.342345989238852e-01   -1.166001525795518e-01   +1.107991423451096e-01   -4.867617339360222e-02   +4.000362770322854e-01   +9.771615647419871e-01   -2.705106005038745e-01; +3.548482598916447e-02   -2.155915760894994e-01   +7.204840988283594e-01   +3.375315448839071e-02   -3.857436134180119e-02   +7.285485145916556e-02   +6.095021432311418e-01   +3.038883196182975e-01; +2.306327017637710e-01   +4.411906011428920e-01   +2.958257200398559e-01   +4.741254420536953e-02   +4.488057643602417e-01   +6.445210455557026e-01   -3.613532072899620e-02   +6.994123283641241e-01; +4.083412423435356e-01   -1.409847302854705e-01   +8.352697862390456e-01   +5.319358402285566e-01   +2.312300939699602e-01   +9.092428394321130e-01   +8.583313354164107e-02   +9.083598066518501e-02; +2.867770004886317e-01   +3.221845971885917e-01   +1.433647219867150e-01   +4.754112718796468e-01   -2.734370183245349e-03   +6.999387661150321e-01   -2.671313274737696e-01   +3.184556417420414e-01; +5.658217663172610e-01   +4.162640581977923e-01   +2.697848568533235e-01   -2.509039160483217e-01   +7.144136824545620e-01   +4.316336212390557e-01   +2.587873462834496e-01   +2.409939955957757e-01; +4.245583623600392e-01   +6.584724733435852e-01   +7.001545282077761e-01   +7.253849725005740e-01   +1.257221060310536e-02   +7.261916645489055e-01   +4.189034643813960e-01   +6.240797553594107e-01; +3.227041879305492e-01   +5.562458948328692e-01   +5.813674272266545e-01   +2.442456113548450e-01   -1.666799697653706e-02   +2.846332237317704e-01   -3.084491288884272e-01   +7.739644753542356e-01; +6.828000397624513e-01   +2.263767192604054e-01   +5.776566647356745e-01   +6.321517461339152e-02   +4.264068920989966e-01   +4.067524452824833e-02   +1.300024785216105e-01   +1.176247868929005e-01; +3.746553077178273e-01   +3.077484883798650e-01   +6.323823838894277e-02   +5.409067768054653e-01   +3.408455248437510e-01   -9.611776228467755e-02   -1.460017170508781e-01   +9.022989380002243e-01; +2.157592256488486e-01   +8.482887398601553e-01   +3.931683002812059e-01   +5.604337572832895e-01   +4.046022544851700e-01   -7.213348030538475e-02   -2.462464548976207e-01   +5.191342624130304e-01; +8.216973601641608e-02   +4.396502309938365e-01   +2.434351867121005e-01   +3.330886254442942e-01   +5.334679984994425e-01   +6.420889161932103e-01   +6.486712582088336e-01   +2.951578069000337e-01; +1.342532583491179e-01   +6.019188851978984e-01   -5.022952360929286e-02   +7.530770391545475e-01   +4.967072770383153e-01   +6.814139762317815e-01   +6.705433260077036e-01   +6.203906853494797e-01];
L1E_L2E_iAMPA_netcon = [+4.072377997867420e-01   +5.004888920622000e-01   +5.749708903900232e-01   +5.744685702076829e-01   -2.185984681421823e-01   +4.637614437113536e-01   +6.661789300705998e-01   +5.611734373529393e-01   +4.174009055812266e-01   +8.464800672600986e-01   +2.154301091038553e-01   -1.654651534731360e-01   +6.228614958352959e-01   +1.547257051399967e-01   +4.656836284116910e-01   -1.511549576570494e-01; +6.740037230648612e-01   +3.805144635574955e-01   +7.861865468970517e-01   +4.093856887492030e-01   -8.354535960608979e-02   +2.737280349267023e-01   +2.234677527942842e-01   +4.599612450505665e-01   -3.312645073046741e-01   +7.834320618763556e-01   +7.444020924253935e-01   +6.643132435966393e-01   +6.790134689797312e-01   +5.551022979907270e-01   +4.876557651926473e-01   +4.226769704599390e-01; +3.041532504186676e-01   +2.274088285739167e-01   +8.026715991060906e-01   -1.001562445373826e-01   +1.292557090569002e-01   +3.994971282643294e-01   +2.807416957022172e-02   +7.658836920060917e-01   +1.000000000000000e+00   +3.642104437241642e-01   +6.808327407351954e-01   +6.546341223788490e-01   +6.866103873956728e-01   +5.165104591772759e-01   +3.121454380742755e-01   +8.802666988595469e-01; +5.485559889653968e-01   +1.344959363906801e-01   -6.548109693002863e-02   +8.030500251516823e-02   +1.412687917675881e-01   +7.041995516882676e-02   +8.854512953989567e-01   +1.648195198412425e-01   +6.633907657873642e-01   +2.131643209792743e-01   +7.544644249006949e-01   +5.959190559864125e-01   +3.394895919153610e-01   +3.291462903515930e-01   +4.512602836624811e-01   +5.957349491585653e-01; -6.449750560960868e-02   +6.550327095609227e-01   +6.099392577267639e-01   +4.205562294671560e-01   +7.369775430738157e-01   +6.930735411139568e-01   -3.117853118573569e-01   +6.946885964580564e-01   -2.177341418386542e-01   +2.090058051173970e-01   +3.112406862477126e-01   +3.347204403218323e-01   +6.114956520121287e-01   +6.445001748488615e-01   -1.741803167507996e-01   +5.143314198591288e-01; -1.600719924858616e-01   +1.712359447657053e-01   +8.360737605135202e-01   +8.398163668724569e-01   +2.594892561111308e-01   +2.434462499792491e-01   +4.891244769208474e-01   +6.923090439285911e-01   +4.930290115607640e-01   +1.026864647546413e-01   +5.433686250692296e-01   +3.108823960152269e-02   -2.455983733684094e-01   +3.639983521395506e-01   -1.521530929040652e-01   +3.462127709106541e-01; +2.878112320257884e-01   +2.891730746122714e-01   +3.111000384117226e-02   -1.542419021054475e-02   +6.729818173557291e-02   +9.649135535203469e-02   -1.936330349551670e-01   +4.556765764763693e-01   +3.948627523069766e-01   +3.196927078728925e-01   +3.523580087595691e-01   +9.349417384892504e-01   +4.715982362215035e-01   +4.173526921078203e-01   +7.083887154604638e-01   +2.673392248946823e-01; +7.338226640967821e-01   +2.007444194415687e-01   +7.462944292932393e-01   +2.212686386545224e-01   +8.013764375641753e-01   +5.944286728638382e-02   +7.006178476596330e-01   +3.133364530000543e-01   -4.765099491389957e-02   +2.350889513438811e-02   -7.892976593157200e-02   -2.242296355445911e-01   +3.230668518829579e-01   +4.000820164521273e-01   +6.925371381273874e-01   +4.861645572344058e-01];
L2I_L2E_iAMPA_netcon = [+1.603003923245675e-01   +3.387802623547698e-01   +2.436717394776983e-01   +3.280254508837425e-01   +3.924320161604221e-01   +4.760063819287086e-02   +5.664351990306754e-01   +5.121229651188185e-01; +3.851430349747618e-01   +8.343539911456520e-02   +7.113055592767052e-02   +5.622721460764174e-01   -1.741290718834827e-01   +8.275165454026755e-03   +2.272588320640028e-01   +4.943361723546160e-01; +5.554380258540182e-01   -1.193939053565480e-01   +2.312019667397092e-01   -4.686611489445227e-02   +2.529150773729571e-02   +1.049723269870292e-01   +4.902079113539007e-01   +5.724685241573905e-01; -2.915965637092040e-01   +4.515552728270606e-01   +8.088185511418462e-01   +4.718040620664740e-01   -2.143249353885234e-01   +1.787845879732295e-01   +1.000000000000000e+00   +3.604128887523614e-01; +1.035107486987532e-01   +7.996261421324745e-01   -9.392496570468414e-02   +5.146088313075409e-01   +5.539480871705574e-01   +2.329699613833653e-01   +6.631486172282843e-01   +8.739559087342463e-02; +2.869621924185731e-01   +2.713065521496439e-01   -6.748651945439066e-02   +3.990820598924527e-01   +3.808831443334189e-01   +8.200035883527357e-01   +7.708325699429688e-01   +6.650691531456157e-01; -2.313685390034123e-02   -5.797696598288321e-02   -4.148662869948089e-02   +8.581201094205753e-01   +3.670812150921507e-01   +3.423526105852509e-02   +2.938612345855390e-01   +5.678829882864953e-01; +2.933886746284093e-01   +3.542053879004178e-01   +2.382401488614671e-02   +8.105283398488461e-02   +2.367894894726567e-01   +1.613615012335103e-01   +3.749573781141606e-03   +4.156142083609914e-01];
L2E_L2I_iGABA_netcon = [+7.730562068996378e-01   +4.310384788354936e-01   +4.617872924334653e-01   +4.654172832186884e-01   +1.975004169666729e-01   +3.425383258021356e-01   +1.307796398619389e-01   +1.278909167210601e-01; +6.423565474330614e-01   -1.891297537196198e-01   +7.166358575429577e-02   +6.769113087157002e-01   +3.020558801378267e-01   -3.409826035583141e-03   +4.741647978500785e-01   +7.159589418191699e-02; +6.968455349307902e-01   +6.051359869830812e-01   -9.621313090490370e-02   +2.133315971802287e-01   +2.186876639225435e-01   +2.627843670211365e-01   +7.418011287865334e-01   +5.233682605577189e-01; +1.775040009104706e-01   +6.616895452429347e-01   +9.014026022375512e-01   +2.577222632074516e-01   -2.851001790086654e-01   +4.258356506682868e-01   +6.582131670599453e-02   +5.578400190375840e-01; +6.195149257330790e-01   +3.938858592611697e-01   +4.699057039869496e-01   +2.443628116044282e-01   +2.860937749467923e-01   +1.771028414652528e-01   +8.492180992401253e-02   +3.974570076178376e-01; +3.163130226723503e-01   +6.404504790627366e-01   +4.573091023172892e-01   +5.121442715779135e-01   +6.008302415972204e-01   +2.552632630129593e-01   +4.950740425142068e-01   -6.140090309079311e-03; -4.397459154060986e-02   +2.141762139624705e-01   +5.287340841561354e-02   +3.776775341147932e-01   +3.720434214710771e-01   +3.494217889920919e-01   +8.614939930985138e-02   +4.759098405450239e-01; +4.371685783034970e-01   +1.144515576323379e-01   -2.790838223970530e-01   +6.747228815359779e-01   +1.988667059308428e-02   +2.787407293426027e-01   +1.000000000000000e+00   +1.801440992251256e-01];
L3E_L2E_iAMPA_netcon = [+1.838489934701888e-01   +6.057090708199333e-01   +2.172835608809498e-01   +8.134575621583121e-01   +4.833741083865741e-01   +2.969591180661990e-01   +2.714066033508536e-01   +2.162676940891523e-01   +2.085096672478553e-01   +3.443318021109228e-01   +1.399197358353826e-01   +4.970770440821830e-01; +1.123283581825461e-01   +1.620044465993051e-01   +4.331865533802710e-02   +1.871551913517470e-01   +5.005841804890924e-01   +2.840066419920713e-01   +3.880926392147661e-01   +2.990765584975411e-01   +8.710560951820498e-01   +6.744022952467487e-01   +6.721432176232378e-01   +1.163519724582185e-01; +7.423372130447023e-02   +2.934784639999505e-01   +2.165244444926851e-01   +6.064339714263999e-01   -8.546302440180734e-02   +7.490472149334967e-01   +4.960933951224120e-01   +6.510308234524462e-01   +5.193349521003797e-01   +8.253844742545725e-01   +4.819857047316270e-01   +7.460574173651147e-01; +2.062734707860143e-01   +2.606412663547742e-01   +3.091799929900750e-01   +3.463487122099912e-01   +5.382515419831795e-01   +6.564684257167137e-02   -3.134545980600365e-02   +3.120882984532448e-01   +3.773367336590184e-01   +8.054301273052688e-01   +5.837567657993360e-01   +2.071303146860927e-01; +2.702825151974310e-01   +8.676991234796419e-02   +3.585820332285563e-01   -9.371789639862976e-02   +1.175948354364723e-01   +1.000000000000000e+00   +6.608874161056596e-01   +1.985730656596842e-01   -9.296768362401696e-02   +2.264561666346560e-01   +9.138646285609889e-02   +1.381375306866249e-02; +9.521652828215123e-02   +1.162130570401753e-01   +2.979447640199484e-02   +5.985608120337024e-01   -1.129341511011262e-01   +3.138871851034641e-01   +7.354516621633105e-01   +3.830181125253160e-01   +2.226236229021961e-01   +2.758070374078671e-01   +5.122134013918583e-01   +5.570108869036541e-01; +1.602214226116929e-01   +5.257743696911071e-01   +3.895938728059385e-01   +1.861100573455982e-01   +4.384962003796230e-01   +1.150850912051843e-01   +4.850514981704173e-01   +6.884434855451377e-01   +6.281828906905790e-01   -1.002886547769670e-02   +3.331293248829356e-01   +5.946511283022002e-01; +6.611902037431791e-02   +1.959225521314883e-01   +3.701077841219635e-01   +4.220635538556681e-01   +3.908392533021216e-01   +2.209286339873202e-01   +8.079576170192160e-01   +4.967196304712789e-01   +4.403227218790352e-01   +7.965059918797308e-02   -2.332359169247261e-01   +5.697686359438739e-01];
L3I_L2I_iGABA_netcon = [+4.079325606847796e-01   +7.032967703864879e-01   +6.066636709723222e-01   +4.325619009638298e-01   -1.772829544081392e-01   +4.415938300649805e-01   -1.783088291460247e-01   +1.506384692202307e-02   +1.493679743640852e-01   +3.628332781277609e-01   +9.415079416451914e-01   +3.402236416957065e-01; +6.854112797962841e-01   +2.762933107992637e-01   +4.623865087417329e-01   +2.454060223072692e-01   +8.278444843475639e-01   +4.398389011863643e-01   +2.987805915030627e-01   +8.298942653161328e-01   +1.318008293768516e-01   -1.724313828818803e-01   +3.130327334662018e-01   +2.845646191478261e-02; +6.213294901329337e-01   +4.395041697504362e-01   -2.334601159669702e-02   +2.170530338128164e-01   +4.827914341232672e-01   +6.810793315758205e-01   +5.020306099935766e-01   +1.733455497271637e-01   +3.883354605701180e-01   +3.915803847513856e-01   +5.768934486915744e-01   +9.220365267964587e-03; +7.533539905934779e-01   +3.715641694981544e-01   +5.496684910968520e-01   +2.733155084991985e-01   +9.253597020860056e-01   +7.005324809391585e-01   +1.000000000000000e+00   +5.587839705526169e-01   +2.122312990888181e-01   +6.538643644975899e-01   +2.161947446786275e-01   -3.853582529467059e-02; +1.685899337582998e-01   +3.845755758816891e-01   +8.730060445323132e-01   +7.603383888033166e-01   +5.127050716124614e-01   +2.665258146610648e-01   +5.517653881392929e-01   +7.320633813276608e-01   +2.000417995056772e-01   +4.912333901499329e-01   -5.964051256949886e-02   +1.211736998602599e-01; +7.624941778503636e-01   +1.151570190658217e-01   +3.519940745226288e-01   +4.354539641463050e-01   +3.331654036721746e-01   +3.380435012197374e-01   +2.336550578210271e-01   +5.190926105384690e-01   +9.177967191181530e-02   -1.094818353754040e-01   +9.531169603040503e-02   +4.686305393334366e-01; +7.019173262625975e-02   +2.554925494693272e-01   +5.407268612965377e-01   +5.035206134725346e-01   +8.379836107301478e-01   +7.393963743231754e-01   +8.095341035000726e-01   +8.323425280619741e-01   -1.552293634127885e-01   +5.369323729791363e-01   +2.488193638006605e-01   +1.443445258438959e-01; +8.103333046024430e-01   +4.896655107858924e-01   +6.117858663508480e-01   +5.828281175564276e-01   -9.030629255482747e-02   +3.203602654729857e-01   -1.438789624484314e-01   +2.010047030620648e-01   +2.363544806509894e-01   +6.256365936208345e-01   +6.560465900907404e-01   +2.856749925075174e-01];
L2E_L3E_iAMPA_netcon = [-1.213861791095667e-01   +3.329912751819230e-01   +7.011761952515694e-01   +1.191917286555534e-01   -3.185206444640348e-02   +1.000000000000000e+00   +6.474710097103398e-01   +6.725315333470008e-01; +2.441107558549096e-01   +9.269080248273227e-02   -4.195390578478458e-02   +6.436933355516544e-01   -5.266453448399749e-02   -8.198949026333714e-04   +2.975160451295660e-01   +6.647389154418808e-01; +9.181654991829118e-01   +4.767949502873881e-01   +2.633120265263450e-01   +5.746756701024785e-02   +7.520864123330534e-01   +1.987482171433115e-01   +4.798320524971061e-01   +8.849558175766365e-01; +4.224918530428214e-01   +5.731072077920908e-01   +4.927625359118034e-01   -1.088379803200997e-01   +5.422893058578242e-01   +8.134557613776026e-01   +3.519842633432178e-01   +3.057309978055375e-01; +3.077502325565399e-01   +7.298661526611825e-01   -1.799691849884918e-01   +1.807838382248412e-01   +2.259889857075755e-02   +8.392555695141508e-02   +4.617392524177343e-01   +3.504535018644994e-01; +7.657109283146299e-01   +4.634281061923375e-01   -5.859577570453795e-02   +8.515344688032618e-02   -1.630748662080495e-01   +3.954466944176021e-01   +4.199711761959630e-01   +5.213529405203593e-01; +2.547800579652987e-01   +3.432472362394235e-01   +6.007595225904594e-01   -8.005349957405167e-03   +2.680083667831129e-01   +4.779024213952625e-01   +4.310503233439071e-01   +2.495356336824481e-01; +7.378252849248685e-01   +2.815924571527519e-01   +6.070675157940955e-01   +6.769742889690532e-01   +6.122595737181280e-01   +1.124437024580963e-01   +2.350871694353429e-02   +1.458843175345402e-01; +4.317464977283302e-01   -4.072800891947045e-03   +1.007646018242265e-01   +4.880809774607470e-02   +2.537750873404638e-01   +6.345130818303396e-01   +2.377552619554154e-01   +7.369373846667215e-01; -1.250951750765238e-01   +4.967854812514725e-01   +2.547110963399219e-01   +2.507154467432753e-01   +1.869195594783243e-01   +9.542695708024846e-01   +4.743025818292615e-01   +1.884673982108206e-01; +3.408288449230746e-01   +7.247037477878265e-01   +1.858366657149174e-01   +4.523283677686207e-01   +4.778128656467955e-01   -2.460932411135284e-01   +8.125926431789873e-01   -2.448534724960925e-01; +2.715758635391005e-01   +7.679320361065078e-01   +3.356502238687020e-01   +3.978045008341204e-02   +4.046836670154275e-01   +7.059142712084727e-01   +3.190099207487251e-01   +7.967662642880629e-01];
L2I_L3I_iGABA_netcon = [+1.418880857692849e-01   +7.415612978821460e-01   +2.952554242624903e-01   +3.147800797090187e-01   -4.712756818346538e-02   +1.000000000000000e+00   +3.357646308028426e-01   +6.414294267030864e-01; +2.564488068603017e-01   +4.121900303019711e-01   +8.620200617881313e-01   +5.969605980083177e-01   +3.390727999139596e-01   +5.102826327765669e-01   -2.511542955503001e-01   -1.675432840732510e-01; +6.274621420792021e-01   +6.850693848895190e-01   +7.432479369753691e-01   +3.080307495039689e-01   +2.575573092133221e-01   +6.543879533271642e-01   +5.876759320654171e-01   +4.155071289923246e-02; +7.363301254636075e-01   +7.048585235357936e-01   +4.405820642813155e-01   +5.553290102622047e-01   +3.831082117371269e-01   +4.639679904331662e-01   +1.435030250551454e-01   +3.953696705652839e-01; +4.688976158610168e-01   +3.925927717452564e-01   +6.241853544442736e-01   +1.372659306281827e-01   +3.969693415881246e-01   +3.529997405795919e-01   +4.119312840349374e-01   +6.322971211980251e-01; +3.537367352943068e-01   +3.535293025166828e-01   +3.261106908859677e-01   +9.695617244956755e-01   +8.562275165992898e-02   +3.022565966260498e-01   +1.151065076240521e-01   +9.336938124576073e-01; +1.351081429591378e-01   +4.255192622924039e-02   +2.349068796752622e-01   -2.543598124609557e-02   +8.898016658871180e-01   +6.665314079837965e-01   +1.745295861962107e-01   -1.114354455494549e-01; +2.696450096113039e-01   -1.449783969467210e-01   +5.083437503395335e-01   +1.249754170568737e-01   +2.987600959285643e-01   +1.582497682004800e-01   -2.574683356212611e-01   +6.727216623436554e-01; +2.351421433670174e-01   +1.357674406532147e-01   +3.949224933275661e-01   -1.931702966213993e-01   -1.315998943211250e-01   +8.221358502868751e-01   +4.144717929410623e-01   +4.430884167065213e-03; +2.161635698767707e-02   +4.381985080906781e-01   +7.104764342323041e-01   +3.704849428778250e-01   -2.420539948495953e-01   +2.362289000496288e-01   -2.453419477120365e-01   +1.238617489556440e-01; +5.499108150261707e-01   +4.200724131506692e-01   +4.896866542743106e-01   +6.342679959597699e-01   +6.325379036106520e-01   +2.232857529472979e-01   +4.970006707750506e-01   +3.924152725215455e-01; +1.791796873946822e-01   +2.531325603566501e-01   +1.642380786103632e-03   +2.447572362551513e-01   +6.808570995719219e-01   +3.177520911732145e-01   +5.698933070386610e-01   +3.071196754227725e-01];
L3I_L3E_iAMPA_netcon = [+4.961710790159852e-01   +5.158992639342885e-01   +4.810525482671998e-02   +5.060030186775202e-01   +6.945604907130107e-01   +4.703377532130006e-02   -7.779260830162414e-02   -1.553613797344240e-03   +4.388220001716137e-01   +6.402988345282762e-02   +2.861910430688547e-01   +4.166530245095052e-01; +1.312374951657404e-01   +4.104616409957532e-01   +5.989404241882148e-01   +6.031439362136467e-01   +4.051135543393855e-01   +3.693053828876401e-01   -1.744922781222283e-01   +3.519729926940605e-01   +5.534907320593998e-01   +5.622569739377802e-01   -5.643492823411133e-02   +6.096137268665552e-01; +7.037800590327610e-01   +5.399150916657321e-01   +4.095450243262274e-02   -5.953353032056832e-02   +6.487163583307132e-01   +3.782333229397407e-01   +2.049906818500422e-01   +4.695261022636169e-01   -4.319000190380771e-02   +3.074192840998902e-01   +2.988430548243090e-01   -3.191181562164592e-01; +4.401005074157296e-01   +3.502129451142599e-02   +1.942766834501992e-01   +7.143945205382695e-01   +3.655618361845669e-01   +8.998148767409777e-01   +2.942950483252091e-01   +7.843850664038882e-01   +3.821107659539868e-01   +5.940216634905333e-01   +2.695527657164887e-01   +3.599179734216033e-01; +4.260630329609545e-01   +6.594874697013839e-01   +5.096394851712925e-01   +8.931347575839826e-02   +5.065409202190476e-01   +3.893873941448948e-01   +1.746926313649237e-01   +9.926557114853735e-02   -2.402136168813734e-01   +3.332104271635261e-01   +4.055721170932684e-01   -1.698169233800546e-01; +6.816715104260532e-01   +3.202213057164655e-01   +6.079586505830257e-01   +6.936573984428596e-01   +2.650104619032170e-01   +5.112181362276110e-01   +4.940223570497983e-02   +1.000000000000000e+00   +3.797833482796181e-01   -2.617774440643379e-01   -1.354712974097047e-01   +1.249936365740875e-01; +5.032664829961138e-02   +7.716943059360433e-01   +3.834433259481778e-01   -1.137455341870668e-01   +4.575427506737408e-01   +5.516676724682809e-01   +7.694717961041863e-01   +2.911478034071532e-01   +9.847288237838655e-01   +4.163486796157284e-01   +4.288125579811534e-01   +1.106472752399760e-01; +3.889809660789498e-01   +4.591449122976530e-01   +5.344119881710174e-01   +4.574532777897609e-01   +2.425771034073562e-01   +7.794577290393004e-01   -8.649491230674701e-02   +3.893333274652165e-01   +5.419385927435274e-01   -1.874803358441863e-01   +1.934611613557856e-01   +2.118377018270509e-01; +4.922876615208740e-02   +3.051193508140117e-01   +3.969952476328500e-01   +3.048876879714227e-01   +2.157466966844074e-01   -4.624553456926099e-03   +2.297451502418124e-01   +5.402692247683540e-01   +3.600658566987865e-01   +3.283906836241315e-02   +2.375712985085527e-01   +6.770203020154919e-01; +9.071848682480350e-01   +2.143677909751217e-01   -7.755756083786378e-03   +3.181284662810475e-01   +2.851012219712604e-01   +3.505729057932843e-01   +2.945314495909798e-01   +4.938202377227085e-02   +5.503029320551696e-01   +9.566002157086807e-01   +2.632320388411791e-01   +6.831283077444673e-01; +1.068303823579645e-01   +7.788572032432203e-02   -2.481507035371495e-01   +6.445607424433436e-01   +5.366236909818742e-01   +2.426793341944574e-01   +2.323053200682246e-01   +3.014192250209646e-01   +8.427019935757614e-02   -2.015647331779716e-01   +7.001886084522652e-01   +3.914771442664957e-01; +2.061151456297695e-01   +4.923987959939008e-01   +4.700136555279629e-01   +5.739254878401138e-01   +5.497518483440750e-01   +6.820187311285154e-01   +7.944212751003484e-01   +1.994905779137130e-01   +2.888328716130876e-01   +2.906326692097875e-01   +3.687232190733634e-01   +3.195938574076270e-01];
L3E_L3I_iGABA_netcon = [+1.496148194532022e-01   +7.968650463831962e-01   +4.093132177808995e-01   +6.611955004187795e-01   +4.773494263034069e-01   +5.752665063150190e-01   +3.336661904378644e-01   -1.597351259023707e-01   +2.992034513079729e-01   +7.201869951030817e-01   +6.700803055090111e-01   +2.888975536733742e-01; +3.815276770374187e-01   +6.379526975639507e-01   +1.449253826872293e-01   +2.727112544245784e-01   +2.402231122126486e-01   +8.912005132117392e-01   +6.449653365102323e-03   +6.791378180280678e-01   +5.058224714259282e-01   +4.945760537624895e-01   +7.811835802483522e-01   +2.206311503736566e-01; +5.144172920857979e-01   -3.904769281494520e-02   +7.097703731432574e-01   -1.125621439569573e-01   +8.084919646576886e-01   +4.633323114848731e-01   +1.482589921506042e-01   -9.613342142321706e-02   +5.499826474079599e-02   +5.819384846829881e-01   +8.927862067761930e-02   +4.011294962756181e-01; -9.013410763879801e-03   +6.502738537459687e-01   +3.177503757071076e-01   +4.156795284521576e-01   +8.618725651707602e-01   +7.366715825663822e-01   +2.596771569356494e-02   -1.634851340527519e-01   +3.574819936451638e-01   +8.110438066073522e-01   +5.795288105680525e-01   +3.392705063884999e-01; +6.234973500768846e-01   +4.087758379314006e-01   +3.521840032385024e-01   +5.165626829914053e-01   +3.358797301866280e-01   +4.992307472635794e-01   +1.842661060244624e-01   +4.950420489767468e-01   +2.474833130351061e-01   +2.735672189278410e-01   +2.827662251665816e-01   +1.558662666051633e-01; +5.108403685005568e-01   -1.557720236320581e-02   +3.818300495252063e-01   -2.167683331819035e-01   +1.782833048030027e-01   +1.852089023415642e-01   +3.329768089918484e-01   +2.482227092085318e-01   +2.141963574452530e-01   +8.425766345420357e-01   +2.042309914822947e-01   +8.307325453220219e-01; +6.061266320481453e-01   +4.610870434277191e-01   +2.875955068454715e-01   +2.801524367105890e-01   +2.679868139513688e-01   +3.574010054031959e-01   +4.348433588484567e-01   +2.606336247888563e-03   +3.035685612032219e-01   -1.374127615918553e-01   +3.299533105141884e-01   +6.693962861521542e-01; +1.761055513459967e-02   +1.300943310501508e-01   +8.257684971114447e-01   +8.058977783326050e-02   +4.462031475033217e-01   +3.480291592127152e-01   +1.926716210218218e-01   +7.250356639643974e-01   +5.135357942651081e-01   -7.634342181189895e-02   +4.018359188968515e-01   +3.871697417457894e-01; -1.652482063323881e-01   +5.998505670987935e-01   +1.341433723840054e-01   +6.405766314512645e-02   +6.423005306201175e-01   +4.904659371516067e-01   -8.878166277945453e-02   +1.070124364888855e-01   +4.819622105122140e-01   +6.510526492277806e-01   +1.348509162827714e-01   +3.295085392727132e-01; +6.626810761355203e-01   +3.555965528460946e-01   +8.189763102294668e-01   +7.700224181662535e-02   +3.768724756676483e-01   +1.983676251056458e-01   +2.441526955439477e-01   +5.704970118516145e-01   +1.301096182564924e-01   +3.149859546832489e-02   +1.000000000000000e+00   -1.283302696321482e-01; +5.425788821570576e-01   +1.266314700502586e-01   +1.413263421407693e-01   +3.966573791530361e-01   +2.217306891287912e-01   +9.920242249070817e-02   +4.717737586856939e-01   +3.587772247539772e-01   -1.480993161824796e-03   +6.702526437840199e-01   +6.289035204499991e-01   +3.976926791028216e-01; +5.908712082571322e-01   +4.421540713316203e-01   +7.098505425822806e-01   +3.392946384586843e-01   -2.617753401563264e-01   +4.694387325358524e-01   +2.165642871729706e-01   +7.789723823598308e-01   +1.724767942118823e-01   +2.941676524962879e-01   -1.997539911001015e-01   +4.092391933546199e-01];
L2E_Input1_iAMPA_netcon = [+2.180403508395914e-01   -1.044864829897333e-01   +8.793146419242112e-01   +3.598700797582642e-01   +5.968257650977812e-01   +8.672356666606651e-03   +1.896543455643978e-01   +3.356224570994814e-01];
L2I_Input2_iAMPA_netcon = [-1.821828935151238e-01   +2.001551063536592e-01   +9.200073330793607e-01   +6.140550257146533e-01   +3.048072880339442e-01   +2.287231694223736e-01   +8.823637628677885e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 30*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 30*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
