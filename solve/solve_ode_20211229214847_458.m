function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.837130848159146e-01   -2.508768844375808e-02   +3.279442846326580e-01   +1.764843558823139e-01   +2.634036051516254e-01   +1.964510142141599e-01   -2.656448818886997e-02   +6.036738635628907e-01   +4.812871522607248e-02   +4.060601030230311e-02   +2.663650628219811e-01   +3.625871222948178e-02   +2.108803038073300e-01   +4.842286784590091e-02   +2.290946177652335e-01   +3.868849200414184e-01; +2.896770855665800e-01   +3.395532955874223e-01   +3.610148617194187e-01   +7.843461088239567e-02   +3.358963403199861e-01   +3.660391432738856e-01   +6.963699732412463e-01   +7.334249781630137e-01   -6.616657402002138e-03   +2.332386760463684e-01   +3.268924132946494e-01   +4.170535898509631e-01   +2.371598411271003e-01   +1.805414896857847e-01   +3.520770770188034e-01   +2.518083697919468e-01; +3.334457799370916e-01   +3.261175057709985e-01   +4.753814142943735e-01   +2.973070377634076e-01   +1.542212392949737e-01   +4.857539388427019e-01   +5.070206497083096e-01   +4.285859038696293e-01   +3.682582456359302e-01   +1.388031809836797e-01   +5.484068830235111e-01   +3.663777455973455e-02   +6.102259058562846e-01   +4.971172104564169e-01   +3.970078403636996e-01   +4.559372006893462e-01; +1.876339502459146e-01   +4.679619249404091e-01   +3.200009170514726e-01   +5.839337332749619e-01   +3.847839560803039e-02   -4.568305618229136e-03   +2.973012837234087e-01   +3.105204990650273e-01   +5.342161828294028e-01   +2.892096034299405e-01   +8.078381799123130e-02   +1.178443608491073e-01   +1.947624462948154e-01   +6.658615228833802e-02   +5.190765196021553e-01   +6.897232419357011e-02; -1.785659551672368e-01   +1.237936367747633e-01   +5.542180832356216e-02   +3.755561246561511e-01   +4.046189334411330e-02   +3.028252166639600e-01   +6.165472792220821e-02   +3.986940471903924e-01   -9.632887545837748e-02   +4.229797638129089e-01   +6.435852150787276e-01   +9.414684224166718e-02   +3.022250849419607e-01   +5.698238272266209e-01   +6.311235354886447e-01   +5.519128578733286e-01; +6.120430537458342e-01   +1.808460726589976e-01   +4.171064276159943e-01   +4.750958916503796e-01   +4.429008161672964e-01   +6.151249070240246e-01   +4.431264289763128e-01   +1.591898374056835e-01   +3.446401654069545e-01   +3.613672168157136e-01   +5.006871920279513e-01   +9.607988998684876e-02   +1.053638135041076e-01   +6.720646242018963e-01   +6.004613219539784e-01   +4.541040224879626e-01; +3.989673212443121e-01   +1.260608281452470e-01   +3.341986110795611e-01   +4.149062594221228e-01   +3.193783337225071e-01   +4.006330163530394e-01   +5.453457746350902e-01   +4.758240381454943e-01   +2.463522843055703e-01   +4.873799275026423e-02   +5.029180200989405e-02   +5.650209126114563e-01   +2.413930311798717e-01   +7.299007688915861e-02   +7.362872749825253e-02   +4.668691199906760e-01; +3.145867006019598e-01   +3.791580479451533e-01   +6.632133581302171e-03   +4.331249375053551e-01   +2.143286802452416e-01   +2.147833095188984e-01   -6.411248970915430e-02   +3.500371133710385e-01   -1.061490966706912e-01   +6.304977274409059e-01   +4.379659858503841e-01   +3.420262436532032e-01   +4.282631078398080e-01   +4.200360437613642e-01   +2.006433436445297e-02   +4.920411320022198e-01; +1.192042940336551e-01   +6.914980418851200e-01   +2.630360960022131e-01   +4.145608196891011e-01   +7.105563693041107e-01   +3.879801572647896e-01   +5.730647429541585e-01   +3.220499179916193e-01   +1.462959358448914e-01   +5.410826523244674e-01   +2.898838358947726e-01   +7.188180003740977e-01   +4.618426879289046e-01   +1.292296682514930e-01   +5.002189476278059e-01   +4.813828749581422e-01; +8.794554001867858e-02   +1.523106416614801e-01   -2.067218678196992e-02   +7.186676958803845e-03   +7.525280818001898e-02   +4.926620798489203e-01   +2.291317167522948e-02   +9.529045062971275e-02   +4.834158287060960e-01   +5.215661003203951e-01   +2.283473029293513e-01   +3.691841707853520e-01   +5.211585485987368e-01   +1.932168393841078e-01   -1.564393656782000e-02   +4.925050523345044e-01; +6.230855255332488e-01   +3.284439534475885e-01   -2.909635918234585e-02   +6.127098147772594e-01   +2.035401130282674e-01   +1.740009734396251e-01   +1.836427114034000e-02   +5.298946029797998e-01   +3.633860381175645e-01   -3.689965732807481e-02   +3.179722187796812e-01   +9.008523183093606e-02   +2.750981176066734e-02   +1.180416316580007e-01   +1.389430285665884e-01   +2.547205444985902e-01; +1.994247964853530e-01   +1.470179712297856e-01   +1.825285530369791e-01   +1.674006003675878e-01   +1.593714335234874e-01   +1.135495316105194e-01   +5.655626444936096e-02   +4.770808073990069e-01   +5.379089615719685e-01   +1.231878939710332e-01   +3.331137943777700e-01   +3.217387464650189e-01   +6.012833873903680e-01   +7.325617512957668e-02   +1.858622908450473e-01   +1.376536313343854e-01; +3.338876927469432e-01   +8.857601403783187e-02   +1.864325307900092e-01   -7.509848066786113e-03   -4.754892115936017e-02   +2.192147119358025e-01   -6.694196406817347e-02   +6.210948152059413e-01   +6.209703839531946e-01   -5.897622939983299e-02   +2.013617150069464e-01   +1.851379933765117e-01   +4.680806746424556e-01   +2.548604248534584e-01   +4.465639958137835e-02   +4.334853874348559e-01; +5.205893760075436e-02   +8.029858274103264e-01   +4.477963635930080e-01   +3.225808255241980e-01   +1.681364185508752e-01   +4.381259161178941e-01   +2.748149355907196e-01   +6.204024435790747e-01   +3.789938639330905e-01   +6.201192596108794e-01   +5.764445096881999e-01   +4.404796518961739e-01   +6.086506723637777e-01   +1.330981960345970e-01   +5.211518527646368e-01   -3.395795863679010e-03; +3.904549421139068e-01   +6.481729698166553e-01   +2.070417626962607e-01   +5.876229666622769e-01   +7.063046826837889e-01   -2.709341267263152e-02   +6.965261056784048e-01   +9.947106620654057e-02   -2.909543301396902e-02   +4.196027799520831e-01   +7.096946493511178e-02   +1.210114627904638e-01   +2.003660254943525e-01   +3.605584774677010e-01   +2.407235837120877e-01   +4.251948869720178e-01; +5.425022879562502e-02   +5.444401727006783e-01   +2.185530730658027e-01   +5.977374070512909e-02   +2.477426518308513e-01   +6.845231038467261e-01   +1.689461000994170e-01   +3.770395135012097e-01   +6.950572614149976e-02   +3.975204328053606e-01   +2.920282023521805e-01   +5.064658846684877e-01   +4.316073454683003e-01   +4.905733647480325e-01   +2.394489305419827e-02   +3.702864840781188e-01];
L1E_L1I_iGABA_netcon = [+4.647945803313315e-01   -5.013848063269057e-02   +1.244832856986396e-01   +2.936214965203495e-01   +9.142469585665891e-02   +2.845673421950540e-01   +2.994161177015126e-01   +1.194418842289760e-01   -5.782342456155094e-02   +4.881988029818408e-01   +3.693348266064511e-01   -1.096455366314817e-01   +5.790649008269472e-01   +3.531918795666482e-01   +5.709185119968329e-01   +3.205377569464419e-01; +2.404995874596030e-01   +4.438496332893551e-01   +2.246805403286727e-01   +3.718853236310180e-01   +1.136719613996617e-02   +2.130075744246095e-01   +4.653914210528057e-01   +2.605066251695743e-01   +3.871088934721197e-01   +1.762560833936606e-01   +1.598684321335104e-01   +1.910944159867604e-01   +2.819339472357886e-01   +6.722163281146984e-01   +1.062925641945399e-01   +4.401347501790159e-01; +3.198653930004243e-01   +5.190554087281970e-01   +5.307184831124397e-01   +6.667739137650919e-02   +1.267500537436910e-01   +2.848384330544670e-01   -4.147211996464063e-02   +9.169382355417148e-02   +4.651594427443501e-01   +1.726849236086546e-01   -4.110047967068407e-02   -7.418232337227121e-02   +3.898898244149572e-01   +6.998470369009109e-02   +2.762044217891432e-01   +1.186014563812418e-01; +5.874553741362448e-01   +3.461622452081279e-01   +3.961322699139092e-01   +4.173189292943805e-01   +3.350145076312878e-01   +1.278727675281504e-01   +4.251605000989473e-01   +3.395438692078530e-01   +1.197787381022805e-01   +3.878900814400356e-01   +1.521150911476014e-01   +1.103780510522761e-01   +4.285672133931890e-01   +2.389935645825962e-01   +2.838099811325763e-01   +3.977873670291502e-01; -1.303660518831604e-01   +7.080199335133461e-01   +4.995898234525881e-01   +1.262590231716409e-01   +8.187020964889956e-02   +6.577313658304917e-01   +6.628731818463495e-01   +2.691410001370679e-01   -4.450263901658053e-02   +2.787367439656592e-01   +5.693881371453849e-01   +3.423220195068995e-01   -1.665443521623744e-02   +5.023789393842014e-01   +6.582621239880561e-02   +1.402071107574649e-01; +2.099412547763021e-01   +4.251356799216379e-01   +4.554885781826384e-01   -1.902410173856630e-01   +3.989620721029208e-03   -3.334166264211659e-02   +4.408766125704084e-01   +1.548988510709743e-01   +4.490041196849625e-01   +5.514411141991579e-01   +1.275960246861137e-01   +3.692417399486206e-01   +6.095702499985454e-01   +3.670305276090744e-01   +7.468451898364151e-02   +3.159854286474281e-01; +4.746673249742541e-01   +2.483838548910775e-01   +5.849161121034685e-01   +1.108912850177128e-01   +5.428103034472240e-01   +1.702529397682190e-01   +6.864576905074654e-02   +2.349821359545405e-01   +2.420418023201243e-01   +1.380914540001283e-01   +4.780457241293831e-02   +3.356625737060961e-01   +5.977072189028144e-01   +5.916735130779621e-01   -1.120625977995715e-01   +5.448666390641996e-01; +5.403850558390262e-01   +3.699703967258968e-01   +1.806525741603624e-01   +1.512226349663602e-01   +7.288738339544890e-01   +4.753355354293864e-01   +4.476047329705745e-01   +6.022599008121678e-01   +4.521400494139111e-01   +5.318691557978292e-01   +3.085118583073471e-01   +1.787838476489820e-01   +3.023822923788935e-01   +8.874815538615366e-02   +1.564884171348650e-02   +6.823299796486045e-01; +4.597961108141717e-01   +4.508468292439236e-01   +5.409132658302378e-01   +3.987622542358955e-01   +2.445253351624395e-02   +1.517095412197688e-01   +4.382843757092645e-01   +2.880602124876530e-01   +5.398661913539198e-01   +5.284522648086508e-01   +3.241669674394696e-01   +3.364033948010569e-01   +5.139635983254439e-01   +6.791566330699808e-02   +5.526769361123349e-01   +4.355695004396516e-01; +2.800995006998170e-01   +3.909571572572135e-01   +2.516703006378982e-01   +1.335154298608154e-01   +4.355130216237630e-01   +5.261417247991160e-01   +6.303359391401898e-01   +1.827443275074483e-01   +3.288887288390236e-01   +1.747342856622458e-01   +4.815708827894729e-01   +2.486136221094137e-01   +4.868516627427463e-01   +1.398352738773636e-01   +3.380617231001107e-02   +5.783889358004912e-01; +4.802847778758813e-01   +4.181311765326085e-01   +3.582162532686601e-01   +1.243563455198608e-01   +1.534259134527802e-01   +4.121104283006056e-01   +9.863274331515123e-02   +2.333716605840815e-01   +3.243430588514449e-01   +4.046288210772245e-01   +5.116353799900168e-01   +2.743071441383052e-01   +4.017101228039652e-01   +1.104692792001475e-01   +6.197046649207558e-01   +4.411815154235076e-01; +1.028056087475742e-01   +2.604581781519106e-01   +4.146216303809416e-01   +1.359266302283295e-01   +5.388572203394657e-01   +1.673213991898259e-01   +2.532489549970959e-01   +1.860539519925941e-01   +3.230827726322520e-01   +3.275249013745547e-01   +7.149249275118488e-01   +4.234721912295596e-01   +1.758260868486177e-01   +2.566974423488530e-01   +1.748916094600934e-01   -4.613250466909751e-02; +7.475588151914556e-02   +3.389059210768240e-01   +2.574436339448786e-01   +2.256714719847804e-01   +1.190254186489082e-01   +4.384506546071713e-02   +2.520943403943932e-01   +5.724391519078013e-01   +1.886556006055932e-01   +4.353173633735057e-01   +4.777492159109201e-01   +4.476896843600665e-01   +1.717985911292803e-01   +4.965733817122580e-01   +5.433416119332527e-01   +7.878267923359494e-02; +1.155123337978784e-01   +2.061922853145800e-01   +2.850393649009071e-01   +4.101228952837879e-01   +3.417826457345101e-01   +4.230905283486932e-01   -1.707129547500208e-02   +1.243787839917036e-01   -4.917863904297729e-02   +2.913162242249836e-01   +3.351842316576571e-01   +2.328050508561017e-01   +1.042385257603855e-01   +3.633981169027440e-01   +6.531578103308601e-01   +5.639378689617969e-01; +9.528683042069649e-03   +5.252274630873490e-01   +1.988984658127220e-01   +3.996038999149047e-01   +5.348461797813467e-01   +5.893342265234596e-01   +3.807051548476109e-01   +3.970920773168632e-02   +5.306127314395844e-01   +6.922789618858141e-02   +3.513663405390900e-01   -6.779070998182406e-02   +2.130158436534536e-01   +3.158865269028556e-01   +3.628905263258811e-01   +1.978558963927795e-01; +4.642105210304275e-01   +3.259666220902374e-01   +2.620250149860657e-01   +3.388766227601231e-01   +3.889778177543071e-01   +3.167137031722448e-01   -1.324168307321686e-01   +3.650609953731790e-01   +6.086017188249915e-01   +3.165637102102316e-02   +1.441647868444297e-01   +1.540173612525392e-01   +3.366814530552336e-01   +3.690408348148790e-01   +3.099861483542594e-01   +4.985614558451991e-01];
L2I_L1I_iGABA_netcon = [+5.850444041911980e-01   +5.321378707321269e-01   +3.350300056786676e-01   +5.094452854749970e-01   +1.958255118026391e-01   +1.357157728053541e-01   +2.401915942473059e-01   +2.706617118949173e-01; +5.592579455826689e-01   +4.223800741786127e-01   +1.618972806736803e-01   +3.906587352183797e-01   +5.054923364679446e-01   +2.845426890017311e-01   +4.539350688963226e-01   +3.296988856190233e-01; +1.210310741660171e-01   +2.183649147923878e-01   +4.246991507176986e-01   +4.820919988939478e-01   +1.487466911120510e-01   +1.641498577263144e-01   +3.053970068080611e-01   +4.012564639106578e-01; +1.008117647162450e-01   +3.320786979730945e-01   +5.176752686335412e-01   +2.653534952356743e-01   +2.337883191297344e-01   +5.328286079984264e-01   +1.816755087928327e-01   -1.076864936475645e-01; +6.184126125670270e-01   +4.917394757363534e-01   -7.599206535386728e-02   -1.278236664445004e-01   +7.123510125272083e-02   +4.696777542449450e-01   +3.293628948252637e-01   +2.139914692071693e-01; +3.375534723747080e-01   +3.485931186052181e-01   +5.372293545811082e-01   +1.334382677047999e-01   +4.993454621473671e-01   +4.396855330150786e-01   +3.665475551185046e-01   +3.750809636026825e-01; +2.519031311357998e-01   +3.029773826639815e-02   +3.996195495764431e-01   +9.143677415637526e-02   +1.754020043857933e-01   +3.171890960989180e-01   +4.603083641751410e-01   +7.856762207642858e-03; +4.996044881450913e-01   -5.902771941815285e-02   +3.967281623908264e-01   +5.087279312199506e-01   +5.183600632879777e-01   +1.639384611048692e-01   +1.539153543215763e-01   +1.376715484012282e-01; +1.597680236590151e-02   +2.063042061667932e-01   +5.321304138527128e-01   +2.030937869349179e-02   +3.757305372376157e-01   +5.684790131003529e-01   -3.056720705813736e-02   +5.080338714943970e-02; +1.363045925334422e-01   +4.386060765130334e-01   +5.211327950803744e-01   +6.351270188986897e-01   +6.131821865417804e-01   +5.148781695939556e-01   +7.620770988278239e-01   +7.048810347149365e-01; +1.473796722529842e-01   -6.593403992921212e-02   +6.925590500415187e-01   +7.071786757868876e-01   +6.322039623076119e-01   +1.663407821470983e-01   +6.252177147784523e-01   +3.592272145299757e-01; +3.431866240550140e-01   +4.198311432542606e-01   +4.177966033918145e-01   +3.038412629390489e-01   +5.667567023033616e-01   +4.692479442256680e-01   +3.870128839911828e-01   +2.393189618110160e-01; +2.239157717841333e-01   -1.591828469428830e-02   +6.827227994720596e-01   +6.331769853493314e-01   +1.850976634144383e-01   +5.008700554516705e-02   +1.527261520054749e-01   +3.312464001156583e-02; +1.641876911830646e-01   +3.723394338228670e-01   +4.644456626344455e-01   +6.143924416558894e-02   +2.494005158755869e-01   +3.934819143571519e-01   +2.940693614634834e-01   +2.857517008732889e-01; +6.577333541150432e-01   +6.353560145430316e-01   +1.881911604994225e-01   +1.236153228364133e-01   +1.583876550875597e-01   +1.838530950099143e-01   +4.252455688356694e-01   +6.451255444450005e-02; +6.104203001653646e-01   +3.980025880276140e-01   +9.647384385375153e-02   -1.339014801757210e-02   +4.431204694492065e-01   -1.572190573250945e-02   +7.524613160547633e-02   +1.994867876002088e-01];
L1I_L2I_iGABA_netcon = [+3.332144720754262e-01   +3.168213127529946e-01   +1.290952811064069e-01   +6.862485969286849e-01   +5.615304620172972e-01   +6.545675833876662e-01   +5.863265712958862e-01   +1.900831937021478e-01   +4.598226411128904e-01   -8.206518721781587e-02   +5.927408538190028e-01   +2.825416818837374e-01   +6.737939443512491e-01   +4.111947784069911e-01   +1.037293933204476e-01   +4.527667684506496e-01; +4.302777840200230e-01   +5.968208734285234e-01   +2.877973974716311e-01   +6.899855761361682e-01   +4.813629000721854e-01   +4.100117727388883e-01   +8.077110547848372e-02   +2.972808305511402e-01   +5.594900818779815e-01   +2.375569235191362e-01   +3.828666172275401e-01   +2.250562756084432e-01   +3.122220953945984e-01   +3.288411347868458e-01   +1.567689169614853e-01   +4.923356747660897e-01; +3.643367570705739e-01   +2.205804875510359e-01   +2.252594816240557e-01   +4.768171916204975e-01   +6.958078132060627e-01   +7.665300741229578e-01   +7.163903111080113e-01   +5.997924212950763e-01   +3.830157314935189e-01   +6.400418525904943e-01   +2.005735194692786e-01   +3.802722340997721e-01   +4.497510154685292e-01   +3.789755506584493e-01   +4.982907605310634e-01   +6.167437411509173e-01; +4.464446031952585e-01   +1.437777540798502e-01   +2.138344032221467e-01   +5.246615688406683e-01   +9.637040336897712e-02   +3.396029563218263e-01   +1.912569915444167e-01   +3.337598665060207e-01   -1.440994339425614e-01   +4.512008738711847e-01   +5.058016740404769e-01   +6.845005557745434e-02   +3.352205549226269e-01   +8.363734044069787e-03   +4.945414985517802e-01   +8.801855589346229e-02; +1.378244644113006e-01   +4.944864740117947e-01   +2.397091821841534e-01   +3.347560347621428e-01   +2.620797770642975e-01   +5.310973027913156e-01   +5.276812823469791e-01   +3.033775205069336e-01   +2.169798483204749e-01   +1.983555541793308e-02   +3.092853053757353e-01   +2.709776457350750e-01   -9.066295730902223e-03   +1.066337640134699e-01   +5.874928583373542e-01   +7.118026102565819e-02; +3.273683872222351e-01   +4.426685844192358e-01   +2.149317606247803e-01   +1.068175452295804e-01   +6.354757508340277e-01   +2.408838922665627e-01   +1.468699910267729e-01   +1.719781793430325e-03   +4.150720713534145e-01   +2.567813353122137e-01   +2.691529047603320e-01   +1.979207973523560e-02   +2.234000552004546e-01   +4.583881410418917e-01   +9.760169298937277e-02   +1.841476976633052e-01; +3.300249834494238e-01   +6.279971376078451e-01   +1.211717109600036e-01   +6.860432852103454e-01   +3.796403835638233e-01   +2.637377804235881e-01   +4.137525280147391e-01   +3.424642742746526e-01   -2.500824470331782e-02   +1.983826590850500e-01   +2.015809459567111e-01   +3.562982384575554e-01   -5.995509258550739e-02   +4.707544760391634e-01   +2.822370242301073e-01   -9.006496753775664e-02; +9.598474781959862e-02   +9.026695856403301e-02   +2.153980525389643e-01   +3.860098776630000e-01   +4.018088280106178e-01   +1.916281293487878e-01   -5.978197866873949e-02   +6.218841390358262e-02   +3.688505229102506e-01   +1.731228019211979e-01   +6.068523568798656e-01   +3.026229382905565e-01   +4.189474369617208e-01   +2.586697720436813e-01   +1.340418298958084e-01   +2.615590155373719e-01];
L2E_L1E_iAMPA_netcon = [+3.197520837738154e-01   +5.095511509411986e-01   +3.226707319987246e-01   +2.774546964228548e-01   +3.290328983714192e-01   +1.814515433865405e-01   +4.093991980158432e-01   +2.608016234072424e-01; +6.016940060184699e-01   +6.393540482481040e-01   +1.059133834454035e-01   +5.288167064290829e-01   +2.632965342488840e-01   +6.385970635564204e-01   +6.357934828305720e-01   +5.111051685528138e-01; +5.521356072193782e-01   +4.274743550344173e-01   +4.382582868939303e-01   +2.607339411688891e-01   +1.339105639542948e-01   +2.897250621796745e-01   +3.956134804173199e-01   +5.800796719041283e-01; +9.884183569664756e-02   +5.795447970615883e-01   +6.025120090534068e-01   +2.081068634777053e-01   +5.906037052057869e-01   -6.086785228516964e-03   +1.082965511070981e-01   +3.459910780437497e-01; +3.686958669771913e-01   +7.964700690151066e-02   +2.606789042644915e-01   +4.993968302859767e-01   +6.598713317544689e-01   +3.303870145367460e-01   +1.951144773126801e-01   +3.778186926484103e-01; +3.962784558336933e-01   +1.247416871178159e-02   +4.162443445261512e-01   +5.105995226757937e-03   +6.328187603984982e-01   +3.994465569308225e-01   +1.605842615981672e-01   +1.318029466373851e-02; +1.792523259188652e-01   +5.917507332253600e-01   +2.157392661474412e-02   -2.752635571393178e-02   +3.718535210598365e-01   +3.518768380680473e-01   +4.825571512897677e-01   +2.509032483853907e-02; +2.702158177165627e-01   +6.933780465317378e-01   -3.240944051654022e-02   +3.829553451060819e-01   +2.243576699206985e-01   +4.300279381450850e-01   +6.996335719888446e-01   +3.039134219068567e-01; +3.175604551424099e-01   +6.905656360202465e-01   +1.222661064762423e-01   +4.610240662894637e-01   +1.827958973726068e-01   +4.672990639646194e-01   +6.153032917323249e-01   +3.804579805023521e-01; +5.741890486352594e-01   +5.499582886969098e-01   +1.993495954657749e-01   +3.536737751514769e-01   +2.476052300792217e-01   +3.998413229343165e-01   +1.004912059687151e-01   +1.051930352229980e-01; +4.147709294391668e-01   +2.626558067668704e-01   +3.783048827150089e-01   +4.424747870324511e-01   +1.461616380333529e-01   +1.944326856549440e-01   +2.961802206001135e-01   +1.505321425526630e-01; +4.642791892062555e-01   +5.490767769565047e-01   +4.225301880037430e-01   +4.670770017108468e-01   +2.454935082817736e-01   +2.455179188772648e-01   +4.759356593061289e-01   +6.491016847950296e-01; +3.718214869881733e-02   +3.549038511986993e-01   +3.128148815299533e-01   +8.630068171973510e-04   +5.544714396334819e-01   +3.898723906442244e-01   +6.129459378815418e-01   +2.436622419568027e-01; +2.128365126572785e-01   +1.482912727020428e-01   +3.932647204003766e-01   +5.265939739454870e-01   +1.164548448250682e-01   +6.180776429092802e-01   +4.579337524071144e-01   +5.695184980004594e-01; +2.545417711102133e-01   +2.424806958180876e-01   +6.741572960846089e-02   +3.742831321763573e-02   -4.471409256499037e-02   +2.079468358482287e-03   +3.329540816456848e-01   +1.798105131759286e-01; +3.139110216579235e-01   -3.724520308526980e-02   +9.429820228513090e-02   +4.201207946216086e-01   +2.125051868596969e-01   +1.670145312044679e-01   +2.116348826448433e-02   +1.998470858149132e-01];
L1E_L2E_iAMPA_netcon = [-8.335827487870436e-03   +1.291509735706525e-01   +1.725074406225706e-01   +1.230126121609350e-01   +3.046120547297061e-01   +3.922957361310906e-01   -4.347695998105631e-02   +3.788646080809489e-01   +5.952453317320291e-03   +4.985569520518749e-01   +4.192458256524110e-01   +4.048646843959399e-01   +5.560179870023709e-01   +5.355789905660088e-02   +4.698868730267537e-01   +1.966328302264680e-01; +5.781192568978462e-01   +4.216334691604090e-01   +3.371892236928369e-01   +4.987575416612378e-01   +5.078794063094656e-01   +6.331095847032961e-01   +4.876216361180492e-01   +2.734710799612952e-01   +2.891468078848835e-01   +4.069219069292507e-01   +1.392849604745280e-01   +5.173229003344183e-01   +6.575815481343504e-01   +6.601839116960763e-01   +7.560289847981626e-01   +5.116709425510747e-01; +5.175410148408593e-01   +2.507777719514691e-01   +5.030191435514072e-01   +7.161487568235604e-01   +5.635777467567408e-01   +1.106616780578047e-01   -2.435381145889010e-02   +1.207413926460423e-01   +5.473095972737505e-01   +5.634007810203502e-01   +5.882775289713654e-02   +6.480084408364019e-01   +1.745645459882512e-01   +3.044969019632017e-01   +1.413392898223931e-01   +3.439744529034826e-01; +5.501949627336170e-01   +2.415948968861392e-01   +3.230170509027009e-01   +4.415403621304310e-01   +5.173037134607068e-01   +4.926415000675610e-01   +5.137021222878573e-01   +4.535475196241200e-01   +1.516774944806620e-01   -7.950910464213615e-02   +3.226613989872257e-01   +2.704254222303107e-01   +5.623849306503508e-01   +2.355808205585886e-01   +6.608177809896580e-01   +5.007507330903502e-01; +3.197836898580063e-01   +7.919420472156513e-01   +7.502525611791658e-02   +5.672238285965447e-02   +3.211898677182415e-01   +9.146659512463992e-02   +1.762730477113604e-01   +3.861161757318897e-01   +4.959771869087732e-01   +9.392808002818473e-02   +4.326265673144455e-01   +3.378008163041509e-01   +5.423156907375934e-01   +3.063022686389983e-01   +6.373808750929277e-01   +3.221704761420771e-01; +1.434351004924059e-01   +4.421493774638165e-01   +3.736057220492490e-01   +3.022047741078328e-01   +6.096030289943990e-02   +5.609364291281915e-01   +7.416834072025411e-01   +7.555123292594030e-01   +5.550221768799029e-01   +4.114157297337453e-01   +2.854572075683936e-01   +2.987668908696450e-01   +3.767312917469074e-01   +2.964756728736707e-01   +2.000828630032938e-01   +1.318143826548345e-01; +5.904865372025999e-01   +4.309929540336962e-01   +4.165427991505776e-01   +5.850238758183366e-01   +6.448791878321362e-01   +4.679633585881223e-01   +9.775818564778027e-02   +1.862397860350523e-01   -6.877702792248017e-02   +1.105246796420203e-01   +1.445420511236861e-01   +5.782809632045621e-02   +7.440729122914802e-01   +1.651902255257886e-01   +2.232901759472314e-01   +5.799707724593903e-01; +3.245840358670672e-01   +6.180201706701101e-01   +7.137395934110732e-02   +5.944558523313587e-02   +2.716747579720970e-02   +1.097110932988757e-01   +2.599555204238720e-01   +5.393242105664278e-02   +5.206474678979082e-01   +2.113642922478157e-01   +5.029451303389020e-01   +3.765819987579586e-01   -5.881423840900853e-02   +2.577043150147032e-01   +5.464171199895888e-01   +5.016195503151381e-01];
L2I_L2E_iAMPA_netcon = [+7.259881034734859e-01   +2.600908698837520e-01   +1.850233021970081e-01   +7.436184988093513e-01   +2.134850061520779e-01   +4.762471539267540e-01   +6.192960132049512e-01   +3.681103907727720e-01; +5.821910117322714e-02   +2.481932078387192e-02   +3.814806906098864e-01   +5.719106516957893e-01   +2.613484862221214e-01   +2.279167802840960e-01   +5.674838078396274e-01   +3.336597213098149e-01; -5.991181266058663e-03   +2.144351123516439e-01   +3.471835638805140e-01   +3.618995380318917e-01   +2.767223923157531e-01   +3.185975659210331e-01   +4.572910347526868e-01   +6.394804564207341e-01; +6.407453971213846e-02   +3.875310166955310e-01   +1.275329966308024e-01   +3.598734006187532e-01   +3.185320910358238e-01   +1.494193075818558e-01   +1.383358048396750e-01   +3.962171321385196e-01; +3.125199332755478e-01   +4.541537371365094e-01   +5.315699225055633e-01   +3.415698259456023e-01   +3.313424835639555e-01   +4.524981222075765e-01   +5.869733025958705e-01   +3.129455667208786e-01; +4.704147801859546e-01   +2.418663591986815e-01   +5.173969817216592e-01   -9.247985604015455e-02   +3.430011292987177e-01   +4.918336972475501e-02   +1.012681960700977e-01   +1.161125727193372e-01; +5.140233563955059e-01   +3.169283301127686e-01   +2.220541488570339e-01   +3.338012497400261e-01   +4.073668433072241e-01   +2.379949366328097e-01   +5.348254618677157e-01   +4.279801185321323e-01; +5.530977319738991e-01   +2.443111316795303e-01   +3.937152200400248e-01   +5.589134936858228e-01   +6.273056386677781e-01   +5.555035461009590e-01   +2.118675819312419e-01   +2.948344054924036e-02];
L2E_L2I_iGABA_netcon = [+2.695227376666229e-01   +2.436374305148856e-01   +3.338864420582486e-01   +7.900961513208428e-02   +2.601082013870874e-01   +1.486497262927029e-01   +5.647667847558487e-01   +2.344447451689105e-01; +5.034712582959222e-02   +3.012031570816621e-01   +5.024874092065260e-01   +6.684204376170227e-01   +2.228216315914416e-01   +9.671766278159509e-02   +2.808873770525460e-01   +5.176351882396035e-01; +6.766778328234846e-01   +2.906304390257032e-02   +5.965674602980978e-01   +5.686472528219531e-01   +2.849584872029892e-01   +2.717068940163849e-01   +4.161353594267669e-01   +5.608951080985138e-01; +3.076771514834790e-01   +6.464731720082946e-01   +5.367577156792085e-01   +5.376367129739571e-01   +5.048532192929061e-01   +1.900902270373575e-01   -9.148275018044172e-02   +1.165111583976138e-01; +2.515746533108125e-01   +4.050615971228408e-01   +6.840182845761784e-01   +5.552317346786788e-01   +6.050248169534929e-01   +2.466238139085903e-01   +6.026220107673776e-01   +3.932151402877775e-01; +5.593156482827430e-01   +3.584638816375346e-01   +4.011859118304977e-01   +4.509416912161544e-01   +4.379788570223295e-02   +5.972678893625953e-01   +1.055683928780265e-01   +5.816305260108858e-01; +5.114130799760768e-01   +7.988735793187487e-02   +4.403434831915895e-01   -2.868663941924834e-02   +4.357452868335513e-01   +2.481050559470715e-01   +8.159316067201169e-01   +7.394275972918927e-01; +1.382304824527562e-01   +3.793979985649596e-01   +4.999919637494973e-01   +4.472330851929196e-01   +3.651765833747027e-01   +1.062028133350378e-01   +2.431830713691049e-01   +6.513935668006380e-01];
L3E_L2E_iAMPA_netcon = [+5.566620409423799e-01   +4.926642229630303e-01   +1.011997708102000e-01   +8.553271958830662e-04   +4.728425291800101e-01   +1.474616773377525e-01   +9.865263042397844e-02   +2.092590445801106e-01   -2.942969812363233e-02   +1.421378857472952e-01   +1.023508004595361e-01   -7.759494285366278e-03; +4.600494692726937e-01   +1.388632956105873e-01   +5.597987969218658e-01   +3.860550051010112e-01   +1.414294451149984e-01   +5.700951161883099e-01   +3.580768160419716e-01   +1.603228161911443e-01   +3.493598761294684e-01   -1.894117455836418e-02   +4.277155112454006e-02   +5.438431252200933e-01; +3.019479579416324e-01   +3.363119264102339e-01   +2.085379234065099e-01   +2.375022499679613e-02   +1.973606168816169e-01   +3.277123801328923e-01   +6.001896932220507e-01   +4.957696365664114e-01   +4.358995296362944e-01   +3.725073710363931e-01   +7.112168887421251e-01   +4.567388312426415e-01; +1.570912705583295e-01   +2.007479104190704e-01   +1.086724705252697e-01   +2.453071656449227e-01   -6.257415713265838e-03   +5.661947324097234e-01   +2.438882002809283e-01   +2.268052207841209e-01   +1.127091573209167e-01   +4.816587194938233e-01   +1.696427933180442e-01   +5.201349203243288e-01; +1.504394336638103e-01   +4.563801628026041e-01   +5.321242032008877e-01   +2.725068845238048e-01   +2.223535050360410e-01   +1.928346219471651e-01   +2.961273546822460e-01   +3.237034351212304e-01   +2.751380193972573e-01   +3.117006325147827e-01   +2.746866119975916e-01   +1.921095285942295e-01; +4.216476340975288e-01   +6.622050345196521e-01   +1.414650508249261e-01   +3.174294868566191e-01   +1.471663259292377e-01   +5.611288773015015e-01   +1.764765446738671e-01   +5.475486645871974e-01   +5.225298359196089e-01   +3.863020951919967e-01   +1.020249493100161e-01   +1.463596282052109e-01; +5.801247993610341e-01   +3.790224002798071e-01   +1.668922216585832e-01   +1.688195293234956e-01   +5.701437446976432e-01   +3.091182683966989e-01   +3.471435306813490e-01   +4.821324514367431e-01   +5.502934217739469e-01   +2.824771902937525e-01   +5.094061980625701e-01   +1.889361819404547e-01; +6.284966520630696e-01   +5.418991776262536e-01   +7.225554237190673e-01   +1.179850127020780e-01   +1.051430504888839e-01   +3.728311303661239e-01   -1.870958690310265e-01   +3.252102124576903e-01   +3.749038327086664e-01   -9.861642797089579e-03   +6.344810096599556e-01   +6.134751129994742e-01];
L3I_L2I_iGABA_netcon = [+2.890128619806164e-01   +3.506905500834472e-01   +3.515032122854649e-01   +3.456895244437537e-01   +4.712544928253496e-01   +6.548497957878963e-01   +2.950542297824860e-01   +2.879416679966931e-01   +6.141572335827467e-01   +8.727125515374221e-02   +2.150517965339172e-01   +3.284747226034334e-01; -9.952167034775215e-02   +5.639110155404097e-01   +3.305276556063977e-01   +1.340825525173115e-01   +4.944351449917162e-01   +5.526159879650446e-01   +2.818467811009687e-01   +5.391430417730434e-01   +3.721911141495429e-01   +2.273857921617084e-01   +4.235947354236750e-01   +2.811728348087910e-01; +3.638880840987217e-02   +3.148950193326050e-01   +5.818590142177794e-01   +6.452409439107563e-01   +3.307284494995677e-01   +3.410247053012440e-01   +7.009115978022779e-01   +4.345944846934904e-01   +1.081743977038339e-01   -8.224456059300254e-02   +1.755192176922691e-01   -1.136821764625504e-01; +6.082576460231086e-01   +2.399335596863575e-01   +4.634763909622425e-01   -6.414680882943768e-02   +2.810756845535298e-01   +3.955754961694330e-01   +4.742986964960706e-01   +7.412465607253600e-01   -1.308900834265402e-01   +5.658424897988446e-02   +3.933846609382686e-01   +3.324065982939392e-01; +2.831467044719101e-01   +2.048491343124821e-01   +1.549663628923502e-01   +2.690145862126283e-01   +9.012904220786055e-03   +9.014134725611751e-02   +5.810085869990254e-01   +2.968003765024686e-02   +9.091158065212777e-02   +4.547330347309109e-02   +2.623583431043192e-01   +9.337761672257747e-02; +3.183651765947907e-01   +1.498968654316664e-01   +3.700989927772844e-01   +4.347991084479084e-01   +3.088282903104848e-01   +5.519197501425691e-01   +9.020242415008146e-02   +4.624828814593615e-01   +1.400016163578573e-01   +7.220248236783173e-01   +5.123603190699570e-01   +4.021961163942643e-01; +2.984233675579028e-01   +2.975872262951179e-01   +3.611454821776022e-01   +6.296207712262539e-01   +3.683177424750224e-01   +3.237993462688139e-01   +2.506725532662425e-01   +2.187758904321681e-01   +3.341522218143096e-01   +3.108229493606612e-01   +4.525135797290687e-02   +4.994551909127570e-01; +1.633981198732779e-01   +3.227027954674691e-01   +1.350004886414722e-01   +1.590805137931559e-01   -1.305667154274441e-01   +3.629912384522543e-01   +4.167099880866748e-01   +4.723404385369469e-01   +2.412749488850276e-01   +6.499415414102082e-01   +7.385497612117032e-01   +3.627973513300583e-01];
L2E_L3E_iAMPA_netcon = [+1.269755888418231e-01   -3.797724985761713e-02   +3.921933995965248e-01   +4.609930577486657e-01   -1.086626634911444e-01   +3.531848609470972e-01   +3.830687136895339e-01   +4.279836500163113e-01; +1.183224325135752e-02   +3.889241671202807e-01   +3.426870113561140e-01   +3.392864589687042e-01   +5.144263931417226e-01   +3.396587854744097e-01   +4.244954435193845e-01   +4.485460466864535e-01; +1.858104851938761e-01   +1.904552513445417e-01   +6.585294428319398e-01   +3.066611973893867e-01   +3.716530819507202e-01   +3.956133159294575e-02   +4.182522632546237e-01   +2.548050281888060e-01; +2.781595962494948e-01   +3.382242674298862e-01   +6.758525393935449e-02   +4.121038008197650e-02   +6.011407450607205e-01   -4.335512679397942e-02   +4.769666897113224e-01   +5.471223440998352e-01; +3.890874123684180e-01   +2.888357239561766e-01   +2.626234004765268e-02   +4.728428747870472e-01   +4.689268031400106e-01   +2.632711502171963e-01   +5.626866240437842e-01   -9.702958544752932e-02; +3.229826916696251e-01   +3.710216349456413e-01   +3.399998596769233e-01   -3.667129133536270e-02   +2.774422080172571e-01   +4.519109365419133e-01   +2.813147642830208e-01   +1.715965412293436e-01; +2.713246460432887e-01   +3.329274728720037e-01   +3.573859060072402e-01   +3.348112039790198e-01   +1.955152554880383e-01   +3.904847984637886e-01   +2.078753195248937e-01   +5.028476807389727e-01; +3.823351624324672e-01   +9.904767360728935e-02   +2.287183988009514e-02   +1.717830032301779e-01   +2.523790619777555e-01   +4.227102648690605e-02   +2.059931362419780e-01   +5.119480200484644e-02; +2.778681434455481e-01   +1.960562300742876e-01   +6.168601164695294e-01   +5.066902461173106e-01   +1.891091659246794e-01   +9.644733532928720e-02   +4.583380520519880e-01   +4.349560885217321e-01; +3.715282607292467e-01   +5.010199052815275e-01   +1.452676989274725e-01   +5.498328454698667e-01   +3.554407512837476e-01   +4.450338724192489e-01   +6.548905700936966e-01   +5.067749054723605e-01; +1.125734298424475e-01   +1.535221594455848e-02   +1.837973913655522e-02   +1.491604154975177e-01   +1.898785936746194e-02   +2.843930741963468e-02   +2.628333183970033e-01   +4.993716559472522e-02; +6.154763948538854e-01   +4.518212726148001e-01   +2.831658349530773e-01   +6.500908186865743e-02   -4.059983599526177e-02   -1.537883376713065e-01   +3.287389105721483e-01   +2.517480022354182e-01];
L2I_L3I_iGABA_netcon = [+1.426911619479557e-01   +7.336162534950477e-01   +1.373563970353942e-01   +3.924630739728205e-01   +1.882046505831972e-01   -3.363243558771045e-04   +2.326487802065963e-01   +7.171504296154577e-01; +4.323217772968082e-01   +5.182148942609572e-01   +2.331033323553668e-01   +4.798059153247386e-01   +5.858305370311395e-01   +1.650719233415244e-01   +2.150305917103124e-01   +1.228068509013503e-01; +1.309619112193591e-01   +2.241277892621149e-01   +1.648695507339706e-01   +4.308291487232020e-01   +5.498379407614812e-01   +2.488159877395028e-01   +5.139441490900840e-02   +2.321983494143535e-02; +2.508713055994313e-01   +4.030792850437420e-01   -1.016113153184595e-01   +6.461885494841962e-01   +7.062229528313799e-01   +6.154138716786260e-01   +7.183965444113406e-01   +1.900480942038835e-01; +3.625145121136231e-02   +4.106324827807927e-01   +5.857426439952255e-01   +4.220681030934710e-01   +1.505205506791953e-01   +5.325300371011956e-01   +5.436680544654335e-01   +2.497995856250498e-01; +1.126153850815586e-01   +3.841020330228536e-01   -5.572712320932093e-02   +2.302732417239872e-01   +2.731606757310946e-01   +5.339228107903247e-01   +5.091491973823541e-01   +4.944570452865927e-01; +2.007821291859803e-02   +2.542534082321990e-01   +5.333934106262889e-01   +3.186125034928178e-01   +1.194308394650684e-01   +4.360047942711349e-02   +2.670602174799619e-01   +1.701689931613488e-01; +1.079516778824114e-01   +6.682539916582827e-01   +7.201612045534330e-01   +1.615977695231616e-01   +1.135571572751809e-01   +4.796251360030470e-01   +8.731039185348372e-02   +6.604839671227843e-01; +4.846109256174058e-01   +2.801930123238857e-01   +1.303877934695366e-01   +1.334883342264268e-01   +2.971362226968838e-01   +2.188459303242538e-01   -2.941133075633269e-02   +5.817523986020081e-01; +3.243259395302467e-01   +1.588303022709435e-01   +3.397007026290795e-01   +4.259732280802098e-01   +3.083152758818372e-01   +4.045390177717942e-01   -1.109112675315363e-01   +4.303137941591020e-01; +5.517576360786971e-01   -1.097606665301072e-01   +6.283184776819882e-01   +1.089523554581504e-01   +4.469642864770305e-01   +7.842938995005469e-02   +1.413251782182560e-01   +4.698953305113960e-01; +2.755032509215427e-01   +4.887623909613592e-01   +5.008830581239013e-01   +2.995105002175111e-01   +4.268380031172346e-01   +1.362125297043204e-01   +2.446700176986696e-01   +6.737110359595330e-01];
L3I_L3E_iAMPA_netcon = [+4.058740713116240e-01   +3.962763786998472e-01   +1.803352399996162e-01   +3.397020800024737e-01   +5.567990704052650e-01   +1.210067157747409e-01   +1.515077000929795e-01   +4.562498399248234e-01   +3.473928408853911e-01   +1.449137218002627e-01   +4.175281282962082e-01   -2.549705087016282e-03; +2.101529405959722e-01   +1.881632391488544e-01   +4.000293513112712e-01   +5.635144925697311e-01   +1.659803255741502e-01   +1.627241684877056e-01   +6.820777150662646e-02   +2.936687718994941e-01   +5.900434861546836e-01   +1.611753789699286e-01   +2.803044418327914e-01   +5.219845227359882e-02; +4.757910124206889e-01   +6.639572608054295e-01   +5.190613068989155e-01   +2.851573472471416e-01   +2.987069964777780e-01   +5.929176256150595e-01   +6.309246527334103e-01   +5.529409699558593e-01   +3.404906441844229e-02   +3.610132322470981e-01   +3.325215703952470e-01   +6.148515858576383e-01; +5.011928125042373e-01   +2.106638934698121e-01   +3.464112443485753e-01   +4.216239649173019e-01   +3.477842981703189e-01   +5.452798265531298e-01   +2.834818194343262e-02   +1.332865775077384e-01   +6.062617595244162e-01   +2.250650960399168e-01   +3.585493150590459e-01   +2.291906023282677e-01; +2.971681762504861e-01   -1.030852783062706e-01   +2.227219463910243e-01   +4.834168799498131e-01   +4.815094666483048e-01   +4.390798997191406e-01   +7.153595882834130e-01   +5.315507253955725e-01   +1.016396903271907e-01   +2.045033794034443e-01   +4.456417287917620e-01   +2.758828385745372e-01; -1.321085745564990e-01   +4.015811317441721e-01   +7.395181997891891e-02   +5.474219750085467e-01   +3.778889577042217e-01   +8.658339078752626e-02   +6.757807072334671e-01   +3.222622980575270e-01   +7.394888919332638e-01   +9.143251177955779e-02   -3.210445355796786e-02   +1.223702841244189e-01; +3.506642024149134e-02   +5.871221928114486e-01   +2.813466219367466e-01   +1.377926517389607e-01   +2.206617029457999e-01   +2.804647193202696e-01   +2.947182569487058e-01   +2.204931843600067e-01   +1.767854954566647e-01   +2.756162904497674e-01   +5.703154762772524e-01   +2.988131636239748e-01; +1.343547568181565e-01   +1.494927922743809e-01   +2.444488830980406e-01   +1.518515157369054e-01   +4.457604317885073e-01   +6.055608321101820e-01   +2.692199462703805e-01   +5.388343353763548e-01   +4.813799106878915e-01   +2.681029128231764e-01   +9.174177945940451e-02   +6.568000953948371e-01; +2.488269442978867e-01   +3.769799821343746e-01   +4.518210486574911e-01   +2.809226329651474e-01   +3.906168070271211e-01   +1.348337062212830e-01   +5.890754164336093e-01   +4.376549408459509e-01   +1.007527845084061e-01   +4.221162829442567e-01   +2.208514919727502e-01   +9.370958909042201e-02; +1.836075059577653e-01   +3.888384517774863e-01   +4.159811195773087e-01   +7.122694132515209e-02   +4.667820415206762e-01   +4.688038559006970e-01   +3.601008417155771e-01   +2.707095967608326e-01   +9.387924449702932e-02   +6.028363762904740e-02   +3.254259931142457e-01   -1.659754938253707e-01; +2.464757097193858e-01   +5.247971544676842e-01   +3.167628317116474e-01   -3.204003393777474e-02   +2.205107022909475e-01   +1.221048822271380e-02   +1.962044877538737e-01   +4.946203335116459e-01   +1.937441763149125e-01   +3.149182279641545e-01   +3.213361712897422e-01   +6.217343222592613e-01; +6.111936036077976e-01   +3.431453864697310e-01   +3.779161382285272e-01   +9.830872110714985e-02   +6.133074778960659e-01   +1.756330919599598e-01   -7.188315189552613e-02   +1.601339009276115e-01   +3.666928714327225e-01   +4.647685010160538e-01   +1.217250285941399e-01   -4.986277001645380e-02];
L3E_L3I_iGABA_netcon = [+2.630291045106220e-01   +6.887542746405434e-02   +1.351417898754114e-01   +5.344065948498484e-01   -2.260323594251362e-02   +4.927653596237601e-01   +4.903704755297842e-01   +4.069550501561312e-01   +2.637070403011884e-01   +3.877083404053516e-01   +8.934834466740792e-02   -8.910934831183108e-02; +2.585751607887589e-01   +6.167422768161333e-01   +6.592082297947546e-02   +2.161273197774443e-01   +5.119843006981989e-01   +3.537271750685277e-01   +1.075558222108555e-01   +7.854113948602956e-02   +5.203714801367179e-01   +3.301524792861957e-01   +8.738868549884583e-02   +1.304700481263431e-01; +3.980716250824681e-01   +3.414043321992579e-01   +8.481644291782964e-02   +1.032281351485080e-01   +1.453012576649817e-01   +4.004699799270279e-01   +4.012597161483406e-01   +4.860398839671027e-01   +3.321163773605507e-01   +3.123247741121192e-01   +3.968548891869373e-01   -7.469772414343481e-02; +4.741262152148830e-01   +3.497070688894373e-01   +2.305586878950011e-01   +5.059974782833471e-02   +2.709596652637051e-01   +1.893618923181288e-01   +3.174616021210153e-01   +1.597016288095094e-01   +5.463816444789865e-01   +1.329225226744139e-01   +9.009744740532785e-02   +3.917503635859327e-01; +2.241880842015031e-01   +6.272922184267686e-01   +1.637403820616666e-02   +2.883473800105624e-01   +2.695784657896964e-01   +3.897294040678828e-01   +1.062663892765982e-01   +1.348692410533672e-01   +3.754153354066766e-01   +3.951995576600488e-01   +5.824908233197250e-01   +3.167807547919294e-01; +3.525163990126030e-01   +1.922208701383620e-01   -3.003424841541748e-02   +5.431444779684141e-01   -5.689392161467795e-02   +4.450618225290414e-01   +5.579407478561295e-01   +4.613344401959683e-01   +6.841439403666201e-01   +3.819014321048870e-01   +6.991063113525826e-01   +5.264683201655325e-01; +4.293021000750639e-01   -1.618449130301656e-01   +3.994719718068729e-01   +6.672176080062119e-02   +3.023290920941707e-01   +3.404507183148488e-01   +7.196450346550808e-01   +3.005383107059609e-01   +1.816035124910085e-01   +4.663404692667709e-01   +5.196483810610492e-01   +3.581457826782809e-01; +3.786055026652067e-01   +5.008833261188836e-01   +6.030669491495050e-01   +5.354675920782818e-01   +3.076960721600845e-01   +5.618665675648398e-01   +2.014338836301697e-01   +6.764947160526675e-01   +3.798857480180389e-01   -4.028108462252158e-02   +2.569970130896319e-01   +1.849915314649117e-01; +2.551846875055197e-01   +4.320304935470936e-01   +4.229150337553805e-01   +5.908247663755857e-01   +3.510333157276250e-01   +4.983969749922408e-01   +5.482361836171729e-02   +9.144878646286177e-02   +1.015197852223149e-01   +4.779627966491662e-01   -1.536589630651856e-02   +4.433153557454283e-02; +3.532540002110133e-01   -2.125006956420316e-02   +5.251339559677903e-01   +3.338816507840718e-01   +8.742671790683092e-02   -2.364145370794886e-02   -4.577357799425649e-02   -1.587639108071606e-02   -5.876235452167211e-02   +5.578335566141179e-01   +3.041741098607594e-01   +3.080852971938014e-02; +5.684864452808108e-01   +7.027539595153080e-02   +4.072787064674178e-01   +4.751748511944059e-01   +6.744245640116463e-02   +1.251673416205332e-01   +4.774846772570737e-01   +4.134032834025048e-01   +4.144963620732960e-02   +2.230046556716374e-01   -1.200093546112977e-02   +2.002284871028779e-01; +6.025315510293320e-01   +6.621036765963560e-01   +4.293081266090201e-01   +3.006071361075110e-01   +1.284397219204915e-01   -6.701489422430566e-02   +5.423775069747215e-01   +2.041109501228479e-01   +5.747148054875751e-01   +2.289693229210925e-01   +1.024467631705095e-01   +5.357774360336328e-01];
L2E_Input1_iAMPA_netcon = [+6.720582540449466e-01   +2.594163994672208e-01   +1.705656535479152e-01   +1.149573242450273e-01   +7.262825865973579e-02   +4.574476770565469e-01   +3.625252684393790e-01   +5.065814656091979e-01];
L2I_Input2_iAMPA_netcon = [+1.821471959967338e-01   +3.400909956159158e-01   +3.051072661961326e-01   +1.189100480519945e-01   +2.656960672564111e-01   +5.152505611060373e-01   +4.227212337995011e-01   +8.500802153570514e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
