function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.819606731753651e-01   +4.779137976673310e-01   -6.303611359606427e-02   -1.047701883456068e-01   +9.570919181773113e-02   -9.089145550327682e-02   +2.868952761229067e-01   +4.187786384796056e-01   -2.413139455705993e-02   -2.065409273287230e-01   +8.324349340459411e-02   -1.087186221611085e-01   -8.271641448105299e-03   +4.189064417318222e-01   -1.906008706608703e-03   -1.041695807107864e-01; +1.128644650671306e-01   +2.721433159266823e-01   -3.530874956507627e-01   +2.427787590255487e-02   +1.706706571388980e-01   +2.424765024760821e-01   +6.299583167611242e-01   +4.039392537472969e-01   +4.439168520181709e-01   +1.365133406258910e-01   +3.269781377351755e-02   +6.014512545286440e-01   -1.320065425046830e-01   +1.219737291387425e-01   +2.394109277653932e-01   +4.028869261253182e-01; -3.424302163130936e-02   +1.139965995568679e-02   -4.526629066526312e-01   -1.541571419741431e-01   +3.302255466478055e-01   -5.311060122472125e-02   -2.734096857964962e-01   -6.768919964728304e-02   +6.493341464435837e-01   +1.504231483778455e-01   +2.838909237368905e-01   -5.530498528998201e-02   +3.174312496313419e-01   -4.837832921554888e-04   +4.564227262443531e-01   +6.005524397431726e-01; +5.944524460142081e-02   +1.698606343917058e-01   +2.257091461447492e-01   +7.269943991078041e-02   +3.549559251491932e-01   +1.929799248360229e-01   -4.134143463138353e-01   +2.138605279379287e-02   +1.291930285955456e-01   +4.890851223652408e-01   -1.670494175984173e-01   -4.472056308602891e-01   +2.272652954087169e-01   -5.486942176915378e-02   +2.704934181798483e-01   -1.856008789515609e-01; +1.352053727370020e-01   -1.069973367003641e-01   +1.379622443777863e-01   -3.449719687368092e-02   +2.790521154850014e-01   +7.374778623465847e-02   -1.195006681927492e-02   -8.900989267393464e-02   +4.666317343134932e-01   +2.709153836725737e-01   -2.790871753948229e-01   +1.465058433022983e-01   +2.922003720968284e-01   +6.249664158174434e-03   +5.221885954200228e-01   +7.824762599154511e-02; +4.692109025884620e-01   +2.750323246642526e-01   +4.011770648146753e-01   -1.949296665528360e-01   -1.895406490953418e-01   +7.209887041616116e-02   +2.339912675421169e-01   -2.558125651901680e-01   +3.791627426586024e-01   -4.287896446301924e-01   +1.174104352672996e-01   +7.872287182828305e-02   -2.536212568250584e-02   -1.272709717312857e-01   +8.803074368530436e-03   +6.887894619527449e-02; +4.211998075863452e-01   +3.362657933139706e-01   +1.745380075692968e-01   +3.551458240837175e-01   +1.109530546055486e-01   +1.580384707309349e-01   -1.272251321225021e-01   -4.333675494954708e-01   +1.400189058760069e-01   +3.668538676829208e-01   -1.862136413889262e-01   -2.045849610157174e-01   +1.475289138424868e-01   +5.698025956862995e-01   +1.454929771902348e-01   +5.674593018765282e-02; +2.178357911232263e-01   +2.699845534119299e-01   -1.706791683290068e-01   +1.503930828256206e-01   +5.989855076396359e-01   +1.314443395673639e-01   -1.186602942128081e-01   +4.469632431526471e-01   +6.310382941502677e-01   -1.192403689623582e-01   +6.623201621074171e-01   +3.366325211308514e-02   +2.806017414067470e-01   +3.805867216550720e-01   +1.006068944128822e-01   +4.010620435130245e-01; +1.371539807654873e-01   +5.667591545451895e-01   +3.323259379592835e-01   +4.288102581342897e-01   +3.518769474458162e-01   +6.217907252970480e-01   -1.327673440351436e-01   +3.038717337476178e-01   +2.524504144189965e-01   +2.574973964467342e-01   +8.733906986111682e-02   +4.243593677348392e-01   -4.856202576035373e-02   +3.852120227402698e-01   +2.860818126303986e-01   +5.309507547520327e-01; -1.198981481154298e-01   +3.509507484544258e-01   -3.295077589906650e-02   +3.267442938834547e-01   +5.063316448589725e-01   +3.910246763178015e-01   +6.355667488761816e-01   +9.090056312760220e-03   +5.026515946656930e-01   +2.427783211104875e-01   +1.245655055370518e-01   +4.829882274064177e-01   +4.606511439250029e-01   +2.515568849051815e-01   +3.381903044605853e-01   -3.466049507450822e-02; +8.045273653689046e-02   +9.278429424077977e-02   +4.164657144759137e-01   +2.979785554643094e-02   +3.199956368313669e-01   -3.391053261395485e-01   +1.979843585536247e-01   -2.992040900358449e-01   +6.240750221533841e-01   +2.106456504370515e-01   +3.538912033048501e-01   +1.304654033759791e-01   +1.326312804180534e-01   +4.898510182946893e-01   +5.562295251396971e-01   +4.033825295125668e-01; +1.486154920709861e-01   +5.006554776720616e-01   -4.164003701441140e-01   +2.802063799084654e-01   +4.823209880053170e-02   +8.472837241082709e-02   +5.791593257504321e-01   -2.663596430864588e-01   +1.422376331317992e-01   +2.478766087203600e-01   +6.198191010265623e-01   +2.634830648492164e-01   -5.030635651934141e-02   -2.392265876697570e-01   +4.021581610809697e-01   +1.702464976262507e-01; +1.035002675817507e-01   +3.905295088211891e-01   -1.257415526849589e-01   -2.898631264661480e-01   +5.577721324792165e-01   +4.295914077190053e-01   +8.334384431912169e-02   -1.255472157835062e-01   -7.261141606316435e-02   +5.485535156568020e-01   +3.075025398580097e-01   +2.789937058235767e-01   +7.108224725455881e-02   +1.676944878243934e-01   +1.134240542778119e-01   -6.568967806747369e-02; +2.027319486148114e-01   +6.458614086922554e-02   +2.669509013222641e-01   +6.120992731549476e-01   +3.248574847013100e-01   +1.029760922401735e-01   +3.387902039323266e-01   +7.809083599563751e-02   +2.482798823005402e-01   +2.144264170307941e-01   -3.331081706721936e-01   +3.754271805785722e-01   +1.873901018372248e-01   -1.685419296238611e-02   +4.550250699646923e-01   -2.385637959597046e-01; +5.492725879763587e-01   +4.446429721117081e-01   +3.757774435229606e-01   -2.529523998701384e-02   +1.048438689515444e-01   -3.475624035196021e-01   +2.235189579345145e-02   +8.554065654808540e-02   +6.106570062987615e-01   +4.400008697124050e-01   +3.453452925198330e-01   +1.733094804991960e-01   +1.958473182476626e-01   -2.558775472911533e-01   -3.707562658037323e-01   -2.466083741462697e-01; +1.281955999067573e-01   -2.121769678666242e-01   +3.905091495296463e-01   +6.547436864587479e-02   -5.710740823486485e-02   -2.292620814303557e-01   +5.810640405409284e-01   -1.103474657564104e-01   +1.886462756694432e-01   +1.796980968662521e-01   +1.573418146537650e-01   +1.997205397383930e-01   +5.605908291920836e-01   -7.411745762881039e-02   +3.756919038124734e-01   +3.701758043556814e-01];
L1E_L1I_iGABA_netcon = [+8.190419327822268e-02   -2.110809316366788e-02   +3.603237795548171e-01   +1.167802060572854e-01   -2.804511036176550e-01   -2.965259554505016e-01   +3.154419732086337e-01   +3.037955980620278e-01   +2.662877030612852e-01   +2.909510374211022e-01   -1.745120192629321e-02   +4.340547313680565e-01   -9.974781286508022e-02   +1.217362180192352e-02   +2.154536706852729e-01   +2.933974588013621e-01; -2.386090127499714e-01   +3.445181866959936e-01   -2.346163706882903e-02   -1.072049132790711e-01   +1.402323083334216e-01   +2.947643564798343e-01   +2.495756311534718e-01   -3.196817677692830e-01   +3.457003195352469e-01   -6.616302611498955e-02   -3.149503271076361e-02   +7.328172522713872e-02   +1.350486335783875e-01   -1.047457941508480e-01   -1.407952123854555e-01   +3.260003068243769e-01; +7.581185759548179e-01   -5.054477608279451e-02   +1.888117506357294e-01   +1.474926623915895e-02   +4.717883083963795e-01   +1.651491393728575e-01   +2.300971390311823e-02   +3.989308538984500e-01   -1.909755157550874e-01   -2.595536765703373e-02   +6.177285377194135e-01   +1.371188388017500e-01   +2.516343745005745e-01   +5.987453850203364e-01   -2.053212533566990e-01   +1.097040640365633e-01; +4.387596073072323e-01   -1.778534075726678e-01   +1.654941561450406e-01   +3.094862309774543e-01   +2.662809303825018e-01   +4.118904553260774e-01   +4.323143041050534e-01   -3.077539750962638e-01   +1.436623594803511e-01   -1.087973185635036e-01   +5.635237580912537e-01   +2.171400745762487e-01   -2.439326827867938e-02   +3.688211931449223e-01   -5.935551114806749e-02   +2.295761532736657e-01; +3.540299968122373e-01   -1.135065589344261e-02   +1.323194039016390e-01   +1.850660364729304e-01   +6.859735060582463e-01   +5.427491547277491e-01   +1.816747131453035e-01   +2.008779420387519e-01   +3.083625436472713e-01   -2.788103404966896e-02   +1.857910338791648e-02   +6.379214238197412e-01   +4.794780886865150e-01   +6.103092667044560e-01   -2.430103407595428e-01   -1.413219247505001e-01; +2.505255682361832e-01   +3.077695034639265e-02   +3.142532551192714e-01   -2.327433278274826e-01   +6.933767263251117e-02   +1.303029075485182e-01   -2.750050373793556e-03   -1.423494878603959e-01   +2.089537544891295e-01   -3.055379187263373e-01   -2.052969822386488e-01   +2.161784025268257e-01   +2.509447815880706e-01   +4.302883852139733e-01   +4.820506200190743e-01   +2.362628600793945e-01; +2.784688448845272e-01   +2.998796684677998e-01   -9.736248116839763e-03   +6.518212501991310e-01   +5.764496017649257e-02   +1.271243414042514e-01   +2.771998846597122e-01   -2.826850982538172e-01   -1.959971895083859e-02   +3.150191402943414e-01   -1.699756618542656e-01   -3.080133441431666e-01   -2.264201309487607e-01   +5.366499268062123e-02   +3.032643064875643e-02   +2.374460314917871e-01; +4.913664025351721e-01   +5.015007991244864e-01   +2.181955956729457e-01   +2.315633165315800e-01   -1.440255011566403e-01   +2.311045382581997e-02   +6.136248683320589e-02   +1.552206894956891e-01   +3.120950761184449e-01   +2.635073154440495e-02   +4.150059868905779e-01   +9.501980249639368e-02   -1.805184660924869e-01   -3.528737333131110e-01   -2.091906773320318e-01   -3.287134945880303e-01; +5.162792406565797e-01   +1.889435507161992e-01   +9.855645751413718e-02   +1.269152357812825e-01   +1.089503846438551e-01   +6.819338790776388e-01   -3.379224626564609e-01   +3.804727865352855e-02   +3.044865512506369e-01   +1.557882632007572e-01   -3.910284759902060e-01   +4.939822807606338e-02   -7.588260890389091e-02   -6.266447331145230e-01   -1.141810102009603e-01   +7.278315182546311e-01; -1.404853969105811e-02   +1.138960926884221e-01   -4.008852124559149e-01   +1.829829046100704e-01   +2.730737963553989e-01   +3.739146729706670e-01   -1.962893981630263e-01   +1.564105524440424e-01   +7.074944246506865e-02   +3.957293901818996e-01   +2.291517620548896e-01   +4.251133022673574e-01   +4.057158592300334e-01   -1.756459195171247e-01   +5.421898429345078e-01   +3.382393286176855e-01; -1.220210937534624e-02   +5.571179434553192e-02   +2.272318182824131e-01   -1.951207602943229e-01   +3.997156990802559e-01   -3.076303702500403e-01   +8.229287114101335e-01   +3.081697286815752e-01   +8.244500815472677e-02   +2.094364479107360e-01   +9.764736057340642e-03   +3.365994702510975e-01   +4.152055747754078e-01   +2.637772135757046e-01   -5.767373830407388e-01   -2.774495491239005e-01; +2.236990304248448e-01   +2.492203344450139e-01   +5.297602999997646e-02   +2.431110252726004e-01   -3.409440110017508e-01   +7.228076464435109e-01   -3.076204736707160e-01   +1.326183187296258e-01   +3.237608701622144e-01   -4.840840586272446e-01   +2.554295445993769e-02   -1.585335286558974e-01   +2.027480265391057e-01   +1.138310016123126e-01   +3.107346164589412e-01   +1.369175113492226e-01; +1.363700112622376e-01   +2.110774484686996e-01   -5.699127850863216e-02   +2.814832014249288e-01   +1.729276915897968e-01   +6.113107728062892e-01   +2.501960245060985e-01   +2.345725847864593e-01   +9.975572794662324e-03   +4.349854948261574e-01   +7.805802912292550e-01   +3.589760052922691e-01   +1.555602242934035e-01   -1.328790925650420e-01   +8.510589464851369e-02   -1.785743609712750e-01; +2.495188696998289e-01   +3.962173526501812e-02   -2.694386469494752e-01   +5.836059809257471e-03   +3.246796462812218e-01   +2.075418820539480e-01   +4.453094498001304e-01   +1.836360348515386e-01   +3.139080188288954e-01   +6.101392268125353e-01   -5.849976574521554e-02   +1.455788462763496e-01   +2.286308171179411e-01   +8.112472026620256e-02   -4.171681662918481e-01   +2.640788476431081e-01; -2.326667487719499e-01   +7.993728258245003e-02   -5.849475921915999e-02   +2.824158201568596e-01   -2.613174034422890e-01   +5.302738401241687e-01   -1.950069221174690e-01   +1.019842141563786e-01   -2.628180241512325e-01   +1.866460784605462e-01   -1.448389042352841e-01   +4.233694129627554e-01   -1.505163758309861e-01   -4.761374454233849e-02   +4.719949131864152e-01   -6.708889414515427e-02; +3.791006689237912e-01   +4.058631785726983e-02   +4.290424543350545e-01   -8.506285050658091e-02   +6.152076964206191e-01   +5.107091990014342e-01   -7.910201449994381e-02   -2.939523819331277e-01   +1.966461108734641e-02   -7.787009878369230e-02   -2.138167639044425e-02   -2.316178747529639e-01   +6.744610237607046e-01   +1.860087780704722e-01   -2.176405453235327e-01   -2.080933372533676e-01];
L2I_L1I_iGABA_netcon = [+2.430418106768242e-01   +2.261891707873341e-01   +9.495120339786098e-02   +5.189675430787712e-01   +1.579083571145166e-01   -4.312836526066634e-02   -4.526900164088776e-02   -4.509465417071895e-03; -2.563705909985318e-01   +5.003856840667417e-02   -3.375475827000299e-01   -7.436579501686538e-02   +2.388174079059788e-01   +4.711441266912627e-01   +4.226628415940439e-02   +5.507617263460941e-01; +6.121929248224282e-01   +5.526341848364865e-02   +5.565271382559075e-01   +4.450479815442437e-01   +6.544375598264901e-01   +2.318318238527440e-01   -1.247071399512156e-01   +5.534082992772820e-01; +9.102020802410882e-02   +4.460660962314731e-01   +1.343471402217490e-01   +8.657748555109429e-02   -6.159646873667823e-03   +2.080262856570880e-01   +1.814028605893994e-01   -2.949029647964722e-01; -2.226590948386201e-01   +4.723155216652824e-01   -4.190863159067895e-02   +2.085385377569741e-01   +8.397173398997197e-02   +1.813896696241884e-01   +1.661977397654924e-02   +5.549345520048833e-01; +4.709389941011335e-01   +1.048896585766678e-01   +3.187688386082133e-01   +7.583828315904126e-02   +5.943333751324942e-02   +9.443798993414604e-03   -1.197167245808460e-01   +6.015486105777896e-01; +1.139922066562643e-01   +4.097096223818267e-01   -5.230121703027436e-02   +4.849679402804574e-01   -9.221247406445458e-02   +1.063626338414434e-01   +2.893802528021245e-01   +4.787388240650621e-01; -2.168246343228163e-01   +1.636950570359699e-01   -1.361423477206767e-01   +7.161925017877502e-02   -9.356600680358149e-02   -1.860139175769932e-01   -1.141192870884240e-01   -2.280569141281530e-01; +3.987068192369976e-01   +3.634017525802713e-01   -1.643093450586059e-01   +6.551087240631209e-02   -4.130510213821212e-01   +6.310102532873448e-02   +5.522986920347889e-03   +1.882671459079835e-01; +9.745377297374003e-02   +4.064234364748353e-01   -9.543780392793040e-02   -3.239208482170764e-01   -2.855897290422593e-02   +6.909891352899869e-02   +8.264625779265916e-02   -1.850177212913313e-01; +1.722176349619502e-01   +2.195921195453030e-01   +6.669798349999828e-01   +1.499101818739643e-01   +7.287997105930752e-02   -3.263451391164474e-01   -1.053049611900319e-01   +6.870194119187031e-02; +7.984443052197757e-02   +1.712428242752594e-02   +1.158123495622091e-01   +4.359486401292363e-01   +1.361640326141467e-02   +5.289446063780068e-02   -5.575510186875303e-01   +1.457933913356856e-01; +3.049205238328587e-01   +3.634726888115600e-01   +2.400359557440779e-01   +5.320146917262514e-02   +1.859769943825811e-01   +5.637259766428229e-02   -1.956755707353244e-01   +4.631747314519892e-01; +5.206838698909801e-01   +2.794802287784632e-01   -2.387327724046326e-01   +1.569078969159957e-01   -2.316541414048018e-01   +3.003837131695007e-01   +4.415859510734346e-02   -7.448415930939901e-02; +7.976696608421169e-01   -2.031396534043924e-02   +4.306193302914219e-02   +4.285244151515457e-01   +1.542037410016430e-01   +2.218267270537603e-01   +4.298990840004971e-01   +5.434414033610305e-01; +5.607255536593051e-01   +2.470686844146628e-01   +1.684951305962080e-01   -1.880746000999909e-01   +3.848873509220412e-01   +3.559290638013390e-01   +2.518723314866088e-01   -1.412606352539894e-02];
L1I_L2I_iGABA_netcon = [+3.927349810409341e-01   -6.372066972611840e-02   +4.569172485442189e-01   +4.011104710255508e-01   -1.305459720568056e-01   +8.630043052192484e-01   +4.232636482467366e-01   -9.606552155219543e-02   +3.390393470827857e-01   +3.488862114376685e-01   -1.365019419009164e-01   +8.877802290145020e-02   -4.176956009670194e-02   -1.655272115501467e-01   -8.288992672722635e-02   +5.125799368826796e-01; -1.710975656777950e-01   -2.330834093865466e-02   +3.318772709807805e-01   +3.422802553851017e-01   +6.656219887066422e-02   -1.421677960004319e-01   -1.605012384829427e-01   +5.096412981787495e-01   +1.436684200553895e-02   +1.828360907446517e-01   +3.466269145851134e-01   +2.166747763937739e-01   -1.139067030467607e-01   -5.149541452790614e-02   -2.487591341045554e-01   +3.187466834048098e-01; +5.667301930082635e-01   -4.039158887729095e-01   -2.487175379900324e-01   -1.741651704667562e-01   +1.749160209500726e-01   +4.598145630143613e-02   +4.799588951799581e-02   -3.961302443546710e-02   +4.541122417575423e-01   +3.877432157087025e-01   +3.603782032548282e-01   +3.251810481179730e-01   +3.769704732153772e-02   +3.008818934195783e-02   -2.085845144958486e-01   +2.049967922001975e-02; +6.012583603414574e-01   +5.288025487917037e-01   -5.989055560321516e-02   +1.684989723584730e-01   +8.186362732415824e-02   +2.985233237967592e-01   +1.670458725251643e-01   +5.798067058789825e-01   +7.939050514229379e-02   +3.596821519891954e-01   +3.301483548692772e-01   +4.701451906959149e-01   +3.085610518474181e-01   -3.164510666688219e-02   +1.361319761899699e-01   -2.339930104824134e-01; +8.143484144143700e-01   +3.648101057761195e-02   +5.710690717443819e-01   +2.991753415379559e-01   +2.381203239462751e-01   +2.512056508526300e-01   +8.635788222042071e-02   -3.576697471582978e-01   -1.261472294618105e-02   +1.483421946052557e-02   +7.049934013957415e-01   -2.423696506971631e-01   +4.399633988756314e-01   +1.241288370694980e-01   +1.401172071025222e-01   +3.710078203960527e-01; +5.980510705590760e-01   -1.763133472469689e-02   +4.484478997537614e-01   -3.503969909176893e-01   +3.655807866211969e-01   +4.824136370770926e-01   +2.193645151583699e-01   -3.080370989115794e-01   +5.320352802933527e-01   -4.839275640477246e-01   -1.124149933858128e-03   +3.584928080190701e-01   +3.553405461878596e-01   +3.889430486345050e-01   -5.345178381184940e-02   -7.332517780561321e-03; -2.041971192106934e-01   +2.958021912067021e-02   +3.866620662726359e-01   -9.913339582217420e-02   +2.033782489101674e-01   -1.343103712563848e-01   +1.507834935987652e-01   -8.119502372474972e-02   +3.342067219019630e-01   -1.631391579576972e-01   -1.068283691398114e-01   -2.516521008191197e-01   -3.223392595089125e-01   +6.859007499509808e-01   +3.858530209527669e-01   +6.798887211281189e-01; +1.637593691008679e-01   +1.256620209834133e-01   -1.001359629792303e-01   +2.920385251634557e-01   +4.038096452810491e-01   -5.276575189636988e-01   -1.492426304589082e-01   -1.967112214792696e-01   +2.151653141480683e-01   +2.571320916331361e-01   -5.267541300216738e-01   +3.700889884616805e-01   +1.450752062450805e-01   +3.739759418599194e-01   +6.104827413479855e-01   +3.516472213516521e-01];
L2E_L1E_iAMPA_netcon = [+5.032169106933152e-01   -1.928274047000665e-01   +3.714235593782275e-01   -2.747599305207444e-01   +9.320554238369240e-02   +3.698800198618466e-01   +1.169663686944956e-01   +8.309210774470024e-02; +2.773391894268658e-01   +9.039176963855602e-02   +9.737091160377888e-02   +2.334349200554426e-01   +5.103869074092223e-01   +8.519954641056418e-02   +1.157762670377949e-01   +1.087434353426105e-01; +4.309804746086750e-01   +5.574047094350093e-01   -1.203409745298603e-01   +1.284304689169397e-01   -1.542989497776539e-01   +7.678000235959398e-01   +3.518532980915651e-01   +1.563739003330201e-01; +6.250321016546726e-01   +7.607622731969045e-02   +1.849713923081976e-01   +1.013103546776201e-01   +2.740531546643242e-01   +1.179541590547512e-01   -1.647867599270278e-01   +4.277181231097636e-01; +3.151125733613397e-03   +8.570956835832482e-01   +3.016387972235282e-01   +2.784303102727946e-01   +3.039215407261238e-01   +2.114761723213265e-01   +3.127734210535477e-01   +1.220749623160207e-01; +1.552803825409357e-01   -1.754491720619962e-01   +4.291311001383418e-01   -3.561966722061370e-01   +2.092655458683849e-01   -2.978474497385605e-02   +7.317421006775594e-01   +7.568264573627909e-01; -1.910429222955222e-01   +3.962714733261167e-01   +3.035059292051449e-01   +3.616671350761078e-01   +7.562233364341266e-01   -4.581837713014314e-01   +1.718695663641917e-01   +3.654139807285610e-01; +1.958687738064131e-01   +4.371842285632517e-01   +1.948963976548310e-01   -4.171574747646796e-01   +2.556305365967741e-01   +2.077275417099665e-01   +4.438841209034264e-01   -1.985210001511793e-01; +7.142908453557385e-02   -1.475732472591350e-01   -2.437017139787191e-01   -1.332880414315063e-01   +4.106831944391711e-01   +2.925947180800501e-01   -1.199257271247392e-01   +3.551060036677290e-01; +9.255649618345158e-03   +5.537076706022045e-02   +5.934101003338395e-01   +3.169259514476273e-01   +1.503179379728500e-01   +4.620474062680046e-01   -1.920680104140797e-01   +4.021596146500986e-01; +2.861063473964567e-02   +4.072508714958039e-01   -1.153141222601012e-01   -1.534088263966407e-01   -1.643743438468769e-01   +9.754515939812725e-02   +2.330608480276787e-01   +4.690004112375435e-01; -6.569671594025212e-02   +6.602554580565542e-02   +4.464818733905364e-02   +2.527854585676341e-01   +3.580021221442291e-01   +4.135406789374617e-01   +2.232989182171584e-01   +3.036492915041062e-01; -7.142295512905852e-02   +5.710609284029966e-01   +4.343214585240059e-01   +2.040231707200272e-01   -2.669504102795847e-01   +2.973404548332270e-01   +4.528337384296092e-02   +1.306791236118209e-01; +4.475839149465870e-01   +8.560863546951854e-02   -3.217875650432757e-01   +2.489215773397105e-01   -9.092137131938655e-02   +2.054569488819156e-01   -9.911867811864464e-02   +3.882271831324714e-01; -2.430529830115949e-01   +2.553441864275898e-01   +1.493888613874443e-01   +2.054769150787091e-01   -7.068599066627593e-02   +8.190789213671396e-02   -6.153068709737730e-01   -4.262277741508166e-01; +4.182432120191224e-01   +3.163029569785774e-01   +1.086170581845630e-01   -1.671174779524518e-01   -7.226864193580911e-02   +9.010249731442291e-02   +4.916301211829134e-01   -6.299315786272677e-02];
L1E_L2E_iAMPA_netcon = [+2.242369341370934e-01   +7.114523681612410e-01   +3.413310311873911e-01   -2.560093322836603e-01   +4.722695453192470e-01   +1.918750750950579e-01   +5.180240752132403e-02   +3.855791845230075e-01   -1.081113485964623e-01   +1.749148095939796e-02   +4.140915773752245e-02   +4.876665402397490e-01   +1.728252473219868e-01   -1.070641569639228e-01   +4.507081567531221e-01   +4.712407804277383e-02; -8.870861008496879e-02   +7.990587002254699e-01   +3.713576537043962e-01   -1.551697116909529e-01   -5.552976300995696e-02   +8.076357343409332e-02   +5.930731740940798e-02   +6.435480753064732e-02   -3.698831812889824e-02   +1.977359562710571e-01   +2.177145077647234e-01   +4.182774345435343e-01   -2.966513338761829e-01   +3.882675122403262e-01   +3.930110482935849e-01   +7.674606459242134e-02; -1.604524606610828e-01   +4.099680147146299e-01   +2.985369813598652e-01   +6.641892626540992e-02   +1.357109951565280e-01   +3.472637610986319e-01   +2.459378854283004e-01   +7.087870145314225e-01   -5.187486160513152e-02   -4.912091160900514e-02   -3.175036373867319e-01   +2.699625908566811e-01   +3.563062680275564e-01   +3.800495758464389e-01   +1.733803745249447e-01   -1.558613225276573e-02; +1.836966033454930e-01   +1.936660587042089e-01   +1.961921308523141e-01   -1.960379622977734e-01   -7.055127148781365e-02   +4.666974795183194e-01   +4.935696191548498e-01   +4.319161311369566e-01   +5.123059693059393e-01   +3.447754382437671e-01   +5.538058777502883e-01   -1.001734888824241e-01   +4.135165594024567e-01   +4.025365105751519e-01   +1.594161393344747e-01   -7.265934782404969e-02; -1.577088848620166e-01   +1.650905012575738e-01   +4.791771772444031e-01   -1.893720904543705e-01   +2.863357802793856e-01   +2.063789689530576e-01   +4.011660016020301e-01   +6.504115605289307e-02   -1.113729959004508e-01   +2.740405737917631e-01   -7.244601136923073e-02   -2.248222251749604e-01   -1.897151431694136e-01   -2.957076486533791e-01   +8.004736642405630e-01   -2.157885064714878e-01; -1.049498221942144e-01   -4.577969269991505e-02   +1.226695206475414e-01   -1.637888684348118e-01   +6.874732595947065e-02   +4.935744051869607e-01   -1.461767163662847e-02   +4.972902116262625e-01   -1.459904982290330e-02   +3.902810640507174e-01   +2.383887960976817e-01   +7.595789212872074e-02   +1.332096402084116e-01   +4.616722414632656e-01   +6.750971696234844e-01   -8.525749429019223e-02; -7.177257471017548e-02   +7.027025011252971e-02   -4.691950067410432e-02   +6.163047551828849e-01   -3.004394061576171e-01   -3.267719458375047e-01   -8.284537039907389e-02   +3.801210716632059e-01   +5.058377194041658e-01   +4.750662256614838e-02   +3.736238159011872e-01   -1.758157840913832e-01   +1.430295170385160e-01   +2.315813705076425e-01   +4.976103336416476e-02   -9.000837344928125e-03; +1.209496233492713e-01   +1.497324175379669e-01   +1.415163583869790e-01   -2.120723460464674e-01   -9.605313864056673e-02   +3.616508650654365e-01   +5.355161782506355e-01   -6.440973346810655e-02   +2.595845922613128e-01   +2.011648521414904e-01   +4.100422063576067e-01   +1.784078316793515e-01   -4.804286492931054e-01   +2.625533198834860e-01   -6.128416379708015e-02   +3.073315192828966e-01];
L2I_L2E_iAMPA_netcon = [+1.819143402753149e-01   -2.107848396498586e-02   +1.042268410088916e-01   -1.282209781154352e-02   +2.385903786595588e-01   +2.456077351555681e-03   +3.471620773111913e-01   -3.549979184821949e-02; +2.443649419295957e-01   +2.794306300370030e-01   +7.898017219594351e-02   -4.483745025389702e-04   -1.674553614596833e-02   +2.578249293667541e-01   -1.789523008081815e-01   +1.053611957349599e-01; +4.177548087916953e-01   -4.804037688356241e-03   +1.272975184996378e-01   +8.715903103468600e-02   +9.650685892055408e-02   +6.083718899775102e-01   -3.379664704092497e-01   +3.224762796782477e-01; +6.818976015438648e-01   +1.507165887572148e-01   +5.083652846098508e-01   +2.592688461090406e-01   +3.332735215439010e-01   -8.908541399496445e-02   +1.439812544684190e-01   -1.653044103379168e-01; +2.099576403785984e-01   +8.182068760472680e-02   -1.946648337221512e-01   +4.139871338399372e-01   +9.174956364586113e-02   -1.910346478613295e-03   +5.725153600958049e-01   +2.800830169711275e-01; -3.115596887288750e-01   -6.472095622517587e-02   +6.083818590726491e-02   +2.266023985937785e-01   +4.242028813137333e-02   +4.481451304421551e-01   +3.479443081801816e-01   +3.868718791327520e-01; +4.757161313829567e-02   +7.600355708848725e-01   +1.183406398494942e-01   -1.958200452255553e-01   +2.379063657967479e-01   -1.070331670521297e-01   -2.340697444842513e-01   +3.309116309897970e-01; +9.987917232042545e-02   +2.273308520449265e-02   +4.780902973296444e-01   +2.626120431180495e-01   +5.216908953323252e-01   +3.969403837319024e-01   +5.206891889553114e-01   +2.425781077733120e-01];
L2E_L2I_iGABA_netcon = [+3.776143423297669e-01   -2.645637955035590e-01   +3.212701248428247e-01   +5.222782570920450e-01   -1.265166289368539e-01   +5.337087022527932e-02   -2.209103782972219e-02   +3.856279682595284e-01; +2.238877460924769e-01   -5.579720905362649e-02   +2.401153229539449e-01   +6.430561833793211e-01   -6.800988284365539e-02   -4.237902835084967e-02   +1.834575012326981e-01   +3.072006027996890e-01; +5.221309043248329e-01   -4.485373763843207e-01   +1.010886688715168e-01   -1.788763032479267e-01   +1.065971743865974e-01   +3.145053000754433e-01   +6.763630689707614e-01   +1.471521525659836e-01; +2.753039941192112e-01   +3.267235862997265e-01   +2.443449635197276e-01   -2.504533259059133e-01   +1.032701232034642e-01   +7.022096208645334e-01   +1.563630927029499e-01   +1.436247772780619e-02; +3.769761258015868e-01   +4.500981825871507e-01   +1.132962010785905e-01   -2.981860284474884e-01   +2.770681425020141e-01   +3.753706558873379e-01   -1.298615439763898e-01   +2.012089215087017e-01; +7.189797552077981e-02   -1.895103522519862e-01   +6.468685377731118e-01   -7.304487885557071e-02   +3.436566593999028e-01   -1.783674889890507e-02   +2.724415707573783e-01   +3.594671445769587e-01; +3.999822525541039e-01   +5.554969514797619e-01   -3.320255712539326e-01   +6.285352793206386e-02   +2.466935439592168e-01   +4.252092314201089e-01   +1.260485278895953e-01   -3.129979219093948e-01; -2.979557703927804e-01   +6.680044915093484e-01   +1.033796072646857e-01   -5.760812855937298e-02   +3.018848994114989e-01   -1.075397024762027e-01   +1.477617017595239e-01   +2.617540822976400e-01];
L3E_L2E_iAMPA_netcon = [-1.353391999342262e-01   +2.432393160756151e-01   -4.037916246067713e-01   +2.756059009018828e-01   +5.302588541426765e-01   +5.513207106074175e-01   +3.049027599621346e-01   +3.756989710665090e-02   +2.859970127917476e-01   +4.467820270236704e-02   +3.496926050853916e-01   +4.794810752572953e-01; +2.330419473895405e-01   +3.590442582514309e-01   +1.412205397499644e-01   +1.422307268893568e-01   +4.237515153914068e-01   +3.934290205201443e-01   -8.340422197889408e-02   -1.098857968872098e-01   +2.541397492900509e-01   +3.850671957079678e-01   +4.271786956334532e-02   -1.566010950186693e-01; +4.124054792919613e-02   +5.896873249600556e-01   +3.074084372852784e-01   +2.635065985386330e-01   +6.923597137602405e-01   -2.704328944244979e-01   -2.353100697693633e-01   -2.121192732039857e-02   +3.852613772508307e-01   +4.706323039491190e-01   +5.668718699080871e-01   -6.633448804198078e-02; +1.856664105244451e-01   -1.635692190326681e-01   +1.162333092887510e-02   +3.704714037233041e-01   +2.670311583501870e-01   +4.707529365534575e-02   +5.700145593272558e-01   +3.470171688948310e-01   +7.068727971813108e-01   +7.349477074705371e-02   +1.881812689183524e-01   +3.846530162659734e-01; +6.294538724968356e-02   +1.426504773277953e-01   -1.070241815639490e-01   +3.525041214382338e-01   +3.203819265484986e-01   +8.833431184170304e-01   +4.958546731010127e-01   +7.830743929007307e-02   +5.514766003571763e-01   +2.191033217159687e-01   +7.020838205993696e-01   +4.065656224028003e-01; +1.643127525286287e-01   +1.893938778836770e-01   -5.640978356136217e-02   -7.852530662152230e-02   -1.776352569700659e-01   -1.675598788245836e-01   +4.173979725932537e-01   -1.349500051821830e-01   +8.895172893297770e-02   +3.091733063117945e-01   -1.588061594781217e-01   -2.983450867794240e-01; +4.024216724743630e-01   +6.674039711347501e-02   -1.358951197915052e-01   +4.724031152098356e-01   +1.012753157284210e-01   +2.670569646071641e-01   +7.297530127314293e-01   +1.778718793411513e-02   +3.303035819452196e-01   +1.895282859931689e-01   -1.175229104403463e-01   -9.322149820284639e-02; +1.037453853654572e-01   +2.727193571065001e-01   +5.349847804598434e-01   +3.835129832849276e-01   +5.094848641312767e-01   -3.730279349005606e-01   +3.755032110858952e-01   -2.531670330854869e-01   +2.442670623064321e-01   +3.193463647735829e-01   +5.174693398417305e-01   +2.062266078726532e-02];
L3I_L2I_iGABA_netcon = [+2.288247182665662e-01   -2.194663376689170e-01   +3.981024753662983e-01   +4.679564722093968e-01   -2.230144357046600e-01   +4.163586123359478e-01   +4.007140666787763e-02   -5.325811744494852e-02   +7.080278953523756e-01   +1.005346357371757e-01   +4.418416870077839e-02   +3.003329214095060e-01; +7.789221939241362e-01   -4.171712270646210e-03   +1.583723342695140e-01   +4.315940821080465e-01   +5.434084181789919e-01   +1.758306199509171e-01   -4.053125903758219e-03   -1.566581350756718e-01   +2.877796119939062e-01   +6.769657790603281e-02   +2.550480806049088e-01   -1.771987646225811e-01; +4.275260510485821e-01   +1.110721338253642e-01   -4.961359662316805e-02   +1.648674236512509e-01   +6.094583303396550e-03   -2.318347235943565e-01   +2.679827751192641e-01   +4.074046950365595e-01   +3.363342099647106e-01   -2.951692449202043e-01   +3.161529848814292e-01   +5.137461065425850e-01; +2.615882855390336e-01   -2.662493903491233e-01   +2.461292273656073e-01   +9.930251633135101e-04   +1.211885930839652e-01   -2.453992141998055e-01   +3.328174743514022e-01   +7.906571055176045e-02   +2.037467074629845e-01   -2.488496534674330e-01   -1.107080078248707e-01   +2.589446003776814e-01; +4.933497095849915e-01   +6.837989324728192e-01   +1.291842328948674e-01   +7.753231079585055e-02   +1.109611304739798e-01   +2.167274384152381e-01   +5.922623857602513e-01   +1.779594028980517e-01   -4.719549058968196e-02   +2.389215062279724e-01   +1.244847893241410e-01   +5.500935564881525e-01; +3.531994226715468e-01   +1.029163441862456e-01   +1.248325918760190e-01   -5.137648660453911e-02   +5.985198791719634e-02   +5.330101028947460e-01   +3.760608413746189e-01   +9.628968434221727e-02   +3.704599158865202e-01   +7.732816771781841e-02   +1.809051355935326e-01   +7.686334394448158e-02; +3.160700857098790e-01   +6.105022461724191e-02   -2.510003206451593e-01   +1.846771351192994e-02   -3.568358380896887e-02   -1.251259707818636e-01   +5.186590650983112e-01   -9.423610529031229e-02   +6.937132822563410e-01   -2.993737986637876e-01   +4.062019886239006e-01   +3.049282606586979e-01; +1.283367417388583e-01   +1.603419323578642e-01   +3.779178876680500e-01   +5.017195437200888e-01   +7.058063583117456e-02   +2.714566043882979e-01   -6.071499371233045e-01   -2.612704654328263e-01   +2.179468898706128e-01   +1.602425444682966e-01   -3.155824964416883e-01   -2.378004739292579e-01];
L2E_L3E_iAMPA_netcon = [+2.778526213628171e-01   +2.054930285563107e-01   +3.754122089123407e-01   -3.297533314491100e-01   +9.537539879502487e-02   -3.434352443140217e-01   +4.831013796242953e-01   +5.138882474787000e-01; -2.335088991089658e-01   +1.244387417885658e-01   +2.526193237881746e-01   +1.482162188610380e-01   +6.611690682150893e-01   -2.759163333906407e-01   -1.165603972496186e-01   -1.684534437490192e-01; +2.187668632850156e-01   +4.172720224677212e-01   +3.656183068254688e-02   -3.510542341705778e-01   +4.262774447532954e-01   +2.753468748232652e-01   +3.882840343841029e-01   +3.954581882182408e-01; +2.797120321149476e-01   -4.402614334805008e-02   -7.789175146316588e-02   +1.711516213603324e-01   +1.288145172769273e-01   +4.829333538708965e-01   +3.866554483203930e-02   +1.893253091088359e-01; +6.017461012312344e-01   +4.203530140517209e-01   +6.466676322818968e-01   +2.121288878619412e-01   +7.115962572660477e-01   +2.760523878359976e-01   +9.265528986374033e-02   +1.269546986280075e-01; -1.964880903433311e-01   -1.306613605624860e-01   +3.774766893313120e-01   +3.492383013757339e-01   +3.547526851616356e-03   +3.539543303730445e-01   +1.723380563427393e-01   +5.186300995667021e-01; +1.376553172073414e-01   -4.097026473112869e-02   -1.548548986232879e-01   +1.565275209661209e-01   +2.031783003042499e-02   +5.630630537158207e-01   +6.406534591218141e-02   +4.130229946478303e-01; +4.943625971945011e-01   +3.928969568923116e-01   +5.104295203401858e-01   +7.953403363014968e-01   -2.620039572654145e-01   -2.200004370660998e-01   +7.706774764639917e-01   -1.148741117510584e-01; -7.882750114521386e-03   +5.156555300761672e-01   +2.335459261955152e-01   +6.202535446926347e-01   +1.580709729117316e-01   +1.278068438232288e-01   +8.120461412116871e-02   +2.784032376646597e-01; +2.752818961275390e-01   +7.328120977054492e-01   +1.247285243522864e-01   -4.017832785814441e-01   -3.553620598174272e-02   +3.604646157567013e-01   +2.403817320313251e-01   +1.514615900448638e-01; +1.401556961179806e-01   -2.835253075347932e-01   +2.331717744161346e-01   -3.630213476550493e-01   -1.867441809128758e-01   +4.102901526125441e-01   -1.082173438432686e-01   +6.527883278427784e-01; +1.899079457029001e-01   +6.278575347907936e-01   +6.943379557119154e-01   -1.159436201190115e-02   +3.166094131062981e-01   +1.864388406294308e-01   +3.282182962127554e-01   +3.522730928360051e-01];
L2I_L3I_iGABA_netcon = [+5.958606410272644e-01   +5.602171209944236e-01   +6.253003153392322e-02   -8.837471787194086e-02   +3.318037378129579e-01   +4.675222114969776e-01   -3.608085471559927e-02   -3.426944245570933e-01; -2.175404440149217e-01   +1.195155323390134e-01   +4.822085561343387e-01   +5.855871212196827e-02   +5.930283446203182e-01   +1.636951826444739e-01   +5.402603763422233e-02   +5.580856289239506e-01; +6.018337113084593e-02   +1.207002136851446e-01   -1.403372678234648e-01   +1.227394593519359e-01   +2.815723667995979e-01   +3.660228697081589e-01   +5.970123083321176e-01   -4.254563906332468e-02; -3.449892283927582e-02   -1.303010893138462e-01   +2.261335455782144e-01   +1.005034351318929e-02   +2.591382414237345e-01   +4.964414390219828e-02   +2.536688733675930e-01   +2.858428081992610e-01; -4.592383520706408e-02   +2.107330282984309e-01   +2.008895748457162e-01   +9.740280768951873e-02   +1.575328317783548e-01   +6.258408852056616e-02   +3.457254698868819e-01   -2.363427726321670e-01; +2.375728837280555e-01   +2.423801684395032e-01   -2.338015718335453e-01   -1.232786717683291e-01   +4.397619741366067e-02   +2.870289561334563e-01   +7.644294631397883e-02   +6.962443936281700e-01; +2.637786939540129e-01   +4.352007477712814e-01   +1.007591010282879e-01   +6.583328395566486e-02   +7.632613559572736e-02   +7.025090234991040e-02   -1.987157393440603e-03   +7.348335344014170e-02; -5.281390772258557e-02   -1.114396667807930e-01   +3.277520621631960e-01   -3.173589297312697e-01   +7.292709897306434e-01   +3.455410920814684e-01   +2.860108743200863e-01   -9.669514956728989e-02; -4.814237394573383e-01   +3.434609646974197e-01   +3.701371443885974e-01   -1.067509053423115e-01   +1.282350975506245e-01   +6.484315186800886e-01   +6.030445443843893e-01   +2.971622556313400e-01; +2.055030554157773e-01   -3.955750636765282e-01   +1.789676992990391e-01   +2.150680939193141e-01   +4.238364044889749e-01   +5.125813831375247e-01   -9.279481132977618e-02   +5.669939135100502e-02; +5.343586080655167e-01   +1.069691269307078e-01   +3.621345817755034e-01   -2.672790612351000e-01   +5.004232696609574e-01   -2.804437126972937e-01   +5.158421806208167e-01   +6.637528698726419e-01; +2.095558667164732e-01   +1.956377743459782e-01   +5.124702845266080e-01   -1.333154807255855e-01   -2.831575477197954e-01   -7.086363408787891e-03   +1.757858698261949e-01   +4.554947463093114e-01];
L3I_L3E_iAMPA_netcon = [+4.209113897967511e-01   +2.112560382926014e-01   +6.913937972230499e-03   +4.384789294730429e-02   +9.304632056394746e-02   +1.630347698574250e-01   +1.977583567120736e-02   -3.030313628056715e-02   -9.378429905103418e-02   +1.676555191021919e-01   -2.117666244693743e-01   +2.786577799671279e-01; -1.153581909623014e-01   -2.819050215493648e-01   +2.336323498378602e-01   +2.134528661133909e-01   -3.856258606130580e-01   +7.307748549461921e-01   +3.586521576358741e-01   +3.822309987451071e-01   -2.573147102846313e-01   +1.322557590886169e-01   +3.945216304866997e-02   +7.237139749124782e-01; +5.703062423366536e-01   +1.622478846787656e-02   +8.499702856810103e-02   +1.873136551652829e-01   +3.202981502403410e-01   +8.024367694116255e-02   +1.401996329617423e-01   +1.545875695932514e-02   +6.460426567606084e-02   +4.762841319943256e-01   +1.647503765962195e-01   +3.257502036053772e-01; -1.382334298253517e-01   +1.630914879954837e-01   -1.943272113848916e-01   +1.152455110306400e-01   +5.768155693474678e-01   -9.990778306363429e-02   +4.229806995519492e-02   +4.997032628493591e-01   +2.609530758142956e-01   -2.493450833893500e-01   +1.961757356618516e-01   +9.796981685477421e-02; -4.003082097603408e-01   +2.849169013804008e-01   -3.554296667892446e-01   +3.035366001301130e-01   +1.955009014713006e-01   +4.224321874358709e-01   +3.279655768318367e-01   -3.210155076266320e-02   -1.176583347892761e-01   +3.297826678339527e-01   +6.360051847802896e-02   +5.677417754780080e-02; +2.136003496911290e-02   +1.990097453888476e-01   -1.125028200455930e-01   +2.584297091002363e-02   +2.012142385849038e-01   +4.650057673844297e-01   +1.135238836548195e-01   +4.135641977819066e-01   +4.589957778783870e-01   +5.217978708787517e-01   +4.219572283938458e-01   -5.728454670573760e-02; -5.034838068596673e-02   +1.524641516847897e-01   +5.771846674886896e-01   +1.636130803629522e-01   +1.868033151346210e-01   +4.185794380239766e-01   -1.828418482927946e-01   +2.661880576205476e-01   +3.926512363870759e-01   +7.566909916328822e-01   +3.626514491433919e-01   +1.745018409381923e-01; +8.010439339092824e-02   +2.578338850351917e-01   +2.608894121091451e-01   +3.733143019750477e-01   -6.044490707664739e-02   +2.327223940233900e-01   +1.649638049588357e-01   +2.715241979893541e-01   +2.485448482644864e-01   +3.722801326719165e-01   +1.112262983286857e-01   -1.390897093952955e-02; +2.046713608226975e-01   +5.593855565472741e-01   +7.115275492332305e-01   -1.869138775493323e-01   +2.817958012191295e-02   +2.429466589945361e-01   +3.862359946122312e-01   +6.348829472859419e-03   +3.553334426691138e-01   +1.119681367444288e-01   +3.694994723928193e-01   -9.545870958221642e-02; -2.705838701783206e-01   +4.017673966108362e-01   +1.890949142559357e-01   +1.983649102407401e-01   +1.463462945759085e-01   +1.127266258344993e-01   +5.887473142628924e-02   -7.264393832573701e-02   +2.183792699454007e-01   +8.455642957633853e-03   +3.127585171384976e-01   +7.880173655878551e-01; +5.583692456092922e-01   +8.496900230326998e-02   +3.376095341376111e-01   +6.581125183190644e-01   +3.644337464591164e-01   -2.168917706183753e-01   +1.407877324937695e-01   +3.782195431032048e-01   +2.384314677581795e-02   +4.541013138267197e-01   +3.633010928249220e-01   -3.225100114698146e-01; -2.687724751142834e-02   +3.627583303118651e-01   +2.243998668581269e-01   +1.009343261008014e-01   +3.571038403925053e-01   +2.977540405953261e-01   +1.098675057203220e-01   +1.178841404118840e-01   +1.689347225654596e-01   +1.483651009738023e-02   +6.459786868148631e-03   +5.759396971449521e-01];
L3E_L3I_iGABA_netcon = [+1.383897381932567e-01   +2.039397701351999e-01   +1.372598989231372e-01   +6.665305309835452e-02   +5.107134534634672e-02   +5.192847967746187e-01   +3.505373224178834e-02   -2.030931039102767e-02   -2.277599640374432e-01   +2.133704338726133e-01   -1.829002105056072e-01   -3.356469102605442e-01; +4.598551248910631e-01   +4.072476955752202e-01   -4.216921187027312e-02   +4.161476668243160e-01   +2.588778517337645e-01   +2.194641298387993e-01   +8.980864800061570e-01   +3.655337721316514e-02   -1.418857329478885e-01   +2.407123564307555e-01   -2.591528716460634e-01   +2.847618049625099e-01; -6.237822436599068e-02   -3.045727851664293e-03   +6.651791815486222e-02   +7.306909597007764e-02   +5.918515867552055e-01   -4.393850826606707e-01   +3.180133117073959e-01   +2.814384236323078e-01   -1.960679811647590e-01   -2.259690873569966e-01   -6.358899933937094e-02   +5.676366169280026e-01; +7.120922074331903e-01   -1.022178439230970e-01   +4.548499597583219e-01   -6.070363920857148e-02   -2.318589187547886e-01   +3.501680204884360e-01   -2.272923455348309e-01   +3.650806216895441e-01   +3.680422697311964e-01   +3.492625734837698e-02   -3.069996372835468e-02   -5.398251631347929e-02; +5.732524614879692e-03   +3.163245840370388e-01   +3.687645777706610e-01   +8.411237376377741e-02   +3.744195665338013e-01   +2.595166845397869e-01   -2.464047766147544e-01   +2.285818415311392e-01   -1.430420561725572e-01   +2.143992054816314e-01   +3.149236172374065e-01   +5.720000695952953e-01; +2.477082548088048e-01   +1.681032866147307e-02   +6.318786482899658e-02   +1.595672923277537e-01   -1.182443550478181e-01   +3.322224357547936e-02   +5.214403965234111e-01   -5.100634488940853e-03   +4.261498744383300e-01   -2.354884032843099e-01   +4.505341519772470e-01   +4.397679144535686e-01; +2.872954484467262e-01   +4.561406198093993e-01   +2.067663827937708e-02   +6.045700057365910e-01   +4.452424193157968e-01   +9.326160213833307e-02   -1.964936065854905e-01   -2.261124193379632e-01   +2.756342864862819e-01   +5.934819202278436e-01   -4.716847722361781e-02   -8.884264088718523e-02; +6.447860580373882e-01   -2.620445930994008e-01   -1.114643930951956e-01   -1.508334968514538e-01   +2.332472789413756e-01   +3.228964567734703e-01   +3.175949620563506e-02   +2.699021990783613e-01   -2.196746283294205e-01   +2.023147423726420e-01   -2.536642792350832e-02   -2.883060943877686e-01; -1.539251862357609e-01   +3.763998432971906e-01   +6.287198975159767e-01   +2.715422370049385e-01   +5.730345459662732e-01   -9.539236520609261e-02   +4.162493585831847e-02   +1.102989628203068e-01   +1.162405291666073e-01   +5.665281078282621e-01   +4.212790524250541e-02   +3.105780861405161e-01; +3.394419732656786e-01   +2.446376279132937e-01   +4.255967502080210e-01   +2.582972778358923e-01   +5.004103214359364e-02   +6.232313855653651e-02   +1.022112418538097e-01   -5.227560396780635e-02   +2.490015425123425e-01   +1.173473185560507e-01   +4.319126651097817e-01   +1.268668882374231e-01; +4.379895793524200e-01   +3.884936593339345e-01   +3.080689704527930e-01   +6.201917685040461e-01   -3.321149224538893e-01   +4.982567807917680e-01   +3.508973236335395e-01   -3.289568429404121e-01   +1.716231411005422e-01   +3.971765612359837e-02   +2.665576021167961e-01   +1.089649621565722e-01; +8.347192361534361e-02   +4.061334662039587e-01   +2.278947670799175e-01   +2.141974551245477e-01   +4.425170479723129e-01   +6.380571960981185e-01   -3.487281241576087e-01   -7.321771980994357e-02   +7.036863730020076e-02   +2.120869734025507e-01   +4.181797615652005e-01   +3.096750743697925e-01];
L2E_Input1_iAMPA_netcon = [+1.072939487950970e-01   +2.872443165402174e-01   +2.880828565222015e-01   -2.646384007315851e-01   +2.653482613703835e-01   -4.147734462245233e-01   -3.676466229860658e-01   +4.366473383152021e-01];
L2I_Input2_iAMPA_netcon = [+1.208552317718131e-04   +2.487584209352786e-01   -3.040676683584510e-01   +2.271019842863432e-01   +3.573016686302599e-01   -4.695222790490615e-02   +2.636977573619130e-01   +6.544966736149757e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
