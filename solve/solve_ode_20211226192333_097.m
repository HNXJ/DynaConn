function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.575721563470180e-02   +8.617665203150036e-02   -1.810828136139611e-01   +5.863081931639492e-02   +1.888476905361268e-01   +1.286854293968717e-02   +1.305666018963277e-02   +1.897071643165744e-02   -1.959377048775874e-01   -1.432659217873032e-01   -2.929067982656035e-03   -4.510489936368657e-02   -2.267906905094145e-01   -1.375221636942000e-02   -4.135139310060901e-02   -4.089746889057106e-02; -3.400334525030768e-02   -1.865507077255712e-01   +2.462506660337443e-01   -5.300904161780148e-02   +8.875724073054758e-03   -6.336054383379144e-02   -1.163705606224636e-02   -5.746981109863703e-03   +1.390923313491050e-01   +2.352725829612663e-01   -9.041299319005858e-02   +9.838372503847592e-02   +7.448324300770505e-03   -8.906136148141801e-02   +4.230683890028283e-02   -1.344091437244750e-02; -3.978546401392213e-02   -1.240804200391348e-01   -1.170154450728537e-01   -4.382070666366228e-02   -1.390763741332355e-01   -5.314071497618063e-02   -8.454066765560006e-02   +1.009372369571855e-01   +1.949020990994611e-01   -4.335036976679873e-03   -1.405595615634177e-01   +8.005836242911287e-03   +7.987323892347595e-02   +5.017047219448186e-02   -2.535413756406229e-02   -1.107237646879865e-01; -3.324051949579803e-01   -1.858584684313561e-01   -7.194309622459755e-02   -3.601086224827989e-02   +3.760858678927498e-02   -4.338722542179031e-02   -1.268942719791354e-01   -2.498008371701214e-01   +1.083144993456236e-01   +6.292190798414797e-02   -1.030243495559333e-01   -1.149276183001115e-01   +3.725521898387350e-02   +1.493101297261496e-01   -3.780319770712839e-02   +5.061206831285200e-02; -1.947722739996549e-01   -2.528315530832834e-02   -6.467154493406667e-02   +5.470724125425004e-02   +1.642778799922446e-01   +1.798843192943551e-01   -1.117560018125162e-01   -1.242735590610665e-01   -8.310724032041077e-02   -9.900325957346885e-02   +4.539715037737081e-02   -7.961294062823285e-02   -7.709969759306654e-02   +1.388900356339131e-01   +3.300296354325170e-01   +3.113486447107612e-02; +6.729964629335922e-02   -1.834662965944388e-01   -3.059030348605164e-02   +1.928050646783379e-01   -1.247796398294474e-01   -3.537305796781357e-03   +2.240269957709556e-01   -5.962210440560517e-02   +1.517270047084861e-01   -1.346524221308646e-01   -1.878113617398436e-01   +2.157294480770034e-01   +1.096918639497903e-01   +2.018436818809663e-01   +6.519908105650223e-02   +1.704672210554215e-01; +4.370580556196960e-02   +1.971020610201402e-01   +6.782908812064845e-02   +3.398703033337917e-02   -2.536771316414049e-01   -5.757143509404327e-03   +6.384111792009434e-02   +1.619123038927466e-02   +2.466344147237617e-01   -2.047804231128846e-01   -2.372452987737308e-02   -3.411678942500958e-02   -2.022223736124232e-01   +3.337067680728439e-02   +2.937223844483658e-01   +9.441063390047462e-02; -1.095265226125991e-01   -8.266769775779176e-02   -2.096126815574335e-01   -8.303324228819388e-02   +7.365193216551444e-02   +1.240094694166754e-02   +1.788754841837539e-01   -9.122438144599515e-02   -2.902649592320822e-01   +1.346401345264734e-01   +1.969650603827710e-01   +3.926161372805648e-02   -2.950766780406218e-01   -2.645613874825448e-02   -1.241827288898810e-01   +6.815693776920203e-03; -3.865440535961850e-02   +2.989767497904255e-01   +1.902091421763674e-01   -6.221678594398794e-02   -1.271403098611897e-01   -2.495037448829710e-01   -9.121996645668880e-03   +6.829201459442545e-02   +1.585042052627682e-03   +1.428183775640641e-01   -9.151930149581808e-02   +3.005876510547218e-01   +2.747346436229212e-01   +1.049353655343020e-02   -2.830655924538539e-01   +2.062229030232269e-02; -1.134743593946439e-01   +2.584892844492896e-01   +2.518439947258496e-02   -2.493409451020504e-01   +4.937812317272617e-02   -3.459915687607052e-03   +9.561073997441380e-02   -2.537038005916904e-01   +2.020539723713336e-01   +1.236474255513644e-01   -1.115015665771428e-02   +5.177110358361341e-02   -2.152544703791211e-01   -1.794751677579657e-01   -9.810803446162975e-02   -2.613323501503729e-01; +2.807069934931550e-02   -3.069530231124959e-02   -1.836895023068483e-01   +1.379804088753682e-01   +1.476024157138224e-01   +2.478780336050968e-02   +3.193455837952427e-01   -2.084597418740741e-01   -6.094771528498839e-02   +5.460220174993176e-02   +5.958331541763315e-02   +8.226492727784587e-02   +2.040419116924593e-02   -1.132275075040955e-01   +1.353014235994797e-02   +2.077844471886987e-02; +2.217706991713142e-01   -1.565357021519080e-01   -5.042900947674547e-02   -4.167267359332787e-01   +6.727643092572039e-03   +4.712922192176500e-02   +1.606506551924053e-01   -5.116602153014368e-02   +7.613743904623389e-02   +2.090664992187097e-02   +2.087299764470321e-01   -1.953587158106079e-01   -2.386772522075897e-01   +2.185828685108636e-01   -1.942090439201171e-01   +3.649650687924468e-02; +5.922103239146177e-03   +7.740430558166275e-02   +2.681748782182072e-01   -1.179956677885738e-01   +5.898060578251892e-02   +2.089154361413319e-01   -9.137094358517078e-02   -5.475575423663626e-02   -4.600227791380396e-02   -6.665152702199650e-02   +9.536348047163226e-02   +1.047075585829689e-01   +1.153662446982361e-01   +1.759520440381283e-01   -8.228650346560830e-02   -1.489335237116094e-01; +1.380473849064237e-01   +5.657355219510642e-02   -1.437856105412436e-01   +7.448927408352971e-02   +1.387757966688596e-02   +1.386093121430946e-01   +1.447391923860063e-01   -7.178584938630439e-02   +1.956206826942834e-01   +8.037495391168475e-02   -3.495147179191035e-01   +5.755225787450857e-02   -8.690410056751185e-02   -2.040093024857786e-02   +1.117973072418799e-01   -2.320312755707837e-01; +7.184905897529069e-02   -1.503900346606925e-01   +1.825333676048713e-01   -1.041476681007523e-01   -4.168941978494385e-02   +7.371322845651607e-03   -3.574104166251429e-02   +3.461414030007233e-02   -7.359606469787645e-02   +5.406145802404188e-03   -7.893328080465696e-02   +1.315619355958323e-01   +1.557995665625443e-01   +4.013990905966408e-02   -1.028773347312672e-01   -1.318230073826881e-01; +1.154577397783805e-01   +2.543477943881751e-02   +1.061697282310836e-01   +1.372512823240685e-01   -1.739698011106057e-01   +1.420967624048156e-01   +1.921615541935848e-01   -4.810245124011741e-02   -1.443705310534521e-02   -2.573299432789544e-01   -6.104202021530676e-02   +1.371736614616293e-01   -2.057484681888869e-01   -5.044031544602191e-02   -3.031306889425849e-02   +2.724206999357893e-01];
L1E_L1I_iGABA_netcon = [-2.945483357215634e-02   +1.647108518914011e-01   -2.450253387110646e-02   +1.828786300132852e-01   -8.452868989647144e-02   +1.447709674407958e-01   -2.641262858613281e-01   -1.006231791060985e-01   +2.200228352763786e-01   -1.883053471941694e-01   -6.468552090343307e-02   +6.011964411239635e-02   -1.306743524872343e-01   +1.853370541351859e-01   +5.323224801259502e-02   +3.171930707566624e-02; +7.508657709794359e-02   +1.620913067920981e-01   -9.359513961611596e-03   +3.307047377880851e-02   -2.183340333423898e-01   +1.132677732014400e-01   +1.767683183268596e-01   +6.263489344277298e-03   +7.703739917780086e-02   +8.593879567998655e-02   +4.670302624067735e-02   +6.764256693725923e-02   -1.754343054309179e-01   -2.876729103036895e-01   -7.905525853366818e-02   -1.839126792543006e-01; -3.841517630565897e-02   +1.450145495621378e-01   -6.599364601347699e-02   -5.596166844502914e-02   -2.934640690777736e-03   -6.280338326569687e-02   +7.577033071324077e-03   -9.929652712958201e-02   +6.498953579378938e-02   +2.105413771035004e-02   -1.876000199119977e-01   -1.267250890405938e-01   -7.205444028931385e-02   -1.908448072755124e-01   -2.707523883785311e-01   +3.069236589091448e-01; +1.923153075996824e-01   -2.488538619120437e-01   -1.641604218777923e-01   +4.835820744203176e-02   +1.237291340834077e-01   +9.319208797932292e-02   -1.380935374433631e-01   +1.477186687292108e-01   +6.507789631362344e-02   +7.249666878082959e-03   -1.817259163477672e-01   +8.305994558125671e-02   -6.673323858027128e-02   +1.598075080749723e-01   +1.482677981940961e-01   -1.809140104278294e-02; -1.757663296427430e-01   +1.010966571143797e-01   -1.688268745968457e-03   -5.987881457768569e-02   -4.636574587691275e-02   -3.616468988625991e-04   -3.531257152249747e-02   -1.205539004435825e-01   +1.490666226275068e-01   +1.491457029870709e-01   -1.435045180147477e-02   +8.431484173297366e-02   -2.015406780514787e-01   +9.001538205247123e-02   +4.451219075368366e-02   -1.934717518027387e-01; +3.172884108669689e-01   -2.458051389944901e-01   +6.014439054443127e-03   -1.338929924040705e-01   -1.924157832404170e-01   -2.725418835834110e-01   -9.833242997589257e-03   -1.340960655377363e-01   +8.141374597585138e-02   -6.204919077114117e-02   -3.986815934767607e-02   -1.080423230636114e-01   +7.512661446193203e-02   +2.916713868049413e-01   -2.050099426310206e-02   -1.929346521137967e-01; -3.107000232937638e-02   -2.286348816296132e-01   +1.637669626846976e-01   +2.728556525470235e-02   -1.064227182175908e-01   +4.441273605648516e-02   -1.488246260405514e-01   +1.107885121652750e-01   -2.120605266306390e-01   +1.077156950108829e-01   -2.313826587278246e-01   -1.157920747748969e-01   +7.334778043764225e-03   +9.674032827067980e-02   +1.513360069234846e-01   -5.131503566325616e-02; +7.404434999173544e-02   -7.692073250203711e-02   -9.087314824621864e-02   +1.095726786371395e-01   -1.275503097749706e-01   +1.555189012792640e-01   +1.197396324840297e-01   +3.971966663493771e-02   +8.047643671318656e-02   -1.003986243552819e-01   +1.940141925874986e-01   +2.957434820309032e-01   -2.648023430558787e-01   +9.315725930521698e-03   +1.119539663343446e-01   +2.339590506539208e-02; -2.020079845791450e-01   +1.725001006868586e-01   -5.475591956156568e-02   +2.209202489886736e-01   +2.488820334940787e-02   -3.432240993666801e-02   +1.673186881097212e-02   +4.519205860743683e-02   +6.550781245145081e-02   +3.457675774905314e-01   +2.836483524646759e-02   +2.265296415090086e-01   -1.581456030643992e-01   +1.634862355775908e-01   +5.814914203060369e-02   +7.090836379588125e-02; -4.183837440188410e-02   -1.385573373881773e-01   -3.612021354214558e-01   +7.614394685944526e-02   -6.108657515965656e-02   +1.062133194364439e-01   -9.275105081495462e-02   +3.868771729888508e-02   -1.139900255154191e-01   -1.186068065196959e-01   -2.895305840629568e-01   -2.174425257224950e-04   -1.161860873466634e-01   -6.883370193778868e-02   -9.674272506982579e-03   +2.760172820802049e-01; +1.202034532017019e-01   +8.274554519147395e-02   +9.995856578338434e-03   +7.989716894420792e-02   +2.575717705793600e-01   -5.985001282226628e-02   -1.292812005444453e-01   +1.557777268831929e-01   +3.827460594793716e-02   +6.292935033324748e-02   -1.492920340796341e-02   +1.549443661384542e-01   -2.476259602432662e-01   +9.794054862594245e-02   -1.786478334440382e-01   +4.156781301366565e-03; -3.079248664484381e-02   +3.343426448565237e-02   -1.934995634001495e-01   +8.407313428775300e-02   -2.434493713416507e-01   +4.818873074710017e-02   -8.671219675878522e-02   +7.355752954754016e-03   +2.286119655650750e-01   -2.450451691679495e-02   -1.227258215893827e-01   -2.961109847883770e-01   -1.104424075840059e-01   -1.607425012990698e-02   +1.437859157435673e-01   -1.731265820350051e-01; -1.216350669415137e-01   +5.081521815483473e-02   +1.627119335539970e-01   +3.264468178796803e-02   +4.130499808527445e-02   +2.892819615508784e-03   -1.672731244875862e-02   -1.818143773617627e-02   +3.340594264822060e-02   -2.495945032965322e-01   +1.100201933380787e-01   +1.945326106162094e-01   -1.421211790923201e-01   +1.893039226882419e-01   +1.380746281420621e-01   -1.829494589884036e-01; +2.551266764975312e-01   +1.412735399830897e-02   -1.327270412929360e-01   +1.428188327849806e-01   -7.793487617432132e-02   +1.527159554614575e-01   -2.448819211789045e-01   -3.750489061929094e-02   -6.642062621739639e-02   -2.111683302920879e-03   +1.886768470077906e-01   +1.564177523927661e-01   -2.677542993175807e-02   +3.743193202725684e-01   +1.026064930920671e-01   +1.685072173870459e-01; +1.573771549099175e-01   +2.172438073621702e-01   -8.576481769194929e-03   +3.083165238409975e-03   +1.152391676032047e-01   +7.630349052876327e-02   -7.022860320973495e-02   +1.712237405957007e-01   +2.907870529428454e-01   -8.453414294003628e-02   +5.897380927343540e-02   -2.259611029061407e-01   -6.750175531215101e-02   +1.220460354649661e-01   +1.313816595515277e-01   -7.296101285737683e-03; +2.191185498197613e-02   -2.595930070640592e-04   -2.058556663032433e-01   -1.362025409465594e-02   +2.415606397245559e-01   +7.699992372695211e-02   +1.756878644624880e-01   +2.067139442813161e-01   +2.198214839540980e-01   -1.305526388392822e-01   -1.469045007160693e-01   +2.236110689061562e-01   +1.858725519304128e-01   +1.011029701715067e-01   +1.976844916381500e-02   +1.106282571309358e-01];
L2I_L1I_iGABA_netcon = [+7.653872176938270e-03   +9.524064571745712e-02   +2.007566254454320e-01   +1.438955665957345e-01   -2.189540796355337e-01   +1.424602065001886e-01   -2.677469286980169e-02   -1.040757146139189e-01; -2.694480744518488e-01   +1.293674555235647e-01   +1.833756999224431e-02   +1.803927078695042e-01   -2.515286830449260e-01   -1.378289714906310e-01   -1.305550668481316e-01   -1.482870300920193e-01; -3.130799198275619e-02   +1.210371248927100e-01   -4.390923631569238e-02   +1.065176252190315e-01   +2.636171089341443e-01   +3.830642264277916e-02   +1.239756318774197e-01   -1.358202319126436e-01; -2.091642412053554e-01   +1.200325794263546e-01   +4.708117173976020e-02   -1.617524916872866e-01   +1.112856682321543e-01   -1.981215929650981e-01   -4.359582373911712e-02   -2.903980412027288e-01; +1.961086895638806e-02   +4.369786857474810e-03   -1.198274954755301e-01   +9.154974461071963e-02   -1.268109181049308e-01   +2.726585078663449e-01   +1.415696460475629e-01   +2.186836388430621e-01; -7.558202595106485e-02   -1.459402352860901e-01   +1.239156038848923e-02   -7.278172356171234e-02   +1.958680726567895e-01   +6.461042942778106e-02   -2.720415108422413e-01   -7.981906121065187e-02; +2.342402977698633e-01   +7.768461154033349e-02   -2.545858951492618e-01   -1.825073686017413e-01   +9.458568165097242e-02   +1.201941566995673e-01   +2.627759076635005e-02   +1.502669921256021e-01; +3.159675691532436e-01   +5.264143268654198e-02   +5.879888257815164e-02   -3.476387965637626e-02   -8.260581477781516e-02   +3.128671272329447e-01   +8.362640564467128e-02   +7.749030407240776e-02; -2.922411679632931e-02   +3.117290335513657e-01   -2.664792780499402e-02   +1.784812271410770e-01   +2.183845560190433e-01   +1.758680342061449e-01   -1.913592441280735e-01   -4.851668690130818e-02; +1.906581571269390e-01   -8.489298857420895e-02   -3.974126585930601e-01   -1.797865459213115e-01   +1.122249928030096e-01   -7.537607477649677e-02   -1.180911962869842e-01   -8.980988872643096e-02; -1.477477951663281e-01   -6.693460346888468e-02   -4.696783717357011e-02   +1.899048291880881e-01   +2.793616143194792e-01   -8.738533450575425e-02   -2.506824896121379e-01   -1.724123334099150e-01; +1.691976082026064e-01   +2.803987763147929e-01   -4.619783962146080e-03   +4.160548868117657e-02   +3.303716386003990e-01   -2.171010046809812e-02   -2.851380345437378e-02   -2.974172142412383e-02; -1.388418395554533e-01   -4.972512780448170e-02   -1.785679137237467e-02   +2.457904748889317e-01   -1.665780687768956e-01   -1.998461950827263e-01   +2.825486183922802e-02   -1.477453267704167e-01; +1.496484413777111e-02   +1.288990922417823e-01   +5.956084161490157e-02   -2.162046882425934e-02   +9.099733745882983e-02   -5.036799114243500e-02   +2.375905005065561e-02   -1.137262658624562e-01; -3.397897709391779e-01   -5.673942536899643e-02   -3.396429650831691e-01   +3.989021794934201e-02   -2.163889394680706e-02   -5.816535246391297e-02   -1.453542807823082e-01   +7.908419091262936e-02; -4.425085920202465e-02   -5.004990540502240e-02   +1.637220461258912e-01   +1.109474774149218e-02   +3.624510151726486e-02   +8.825038505917658e-02   +6.473043730568329e-02   -1.302314011777656e-01];
L1I_L2I_iGABA_netcon = [-1.485316035554389e-01   -1.260968106242803e-02   -3.543471002651091e-02   -1.286649170870564e-01   -2.107324352251435e-01   +7.239962863301677e-02   -2.648995274732690e-01   +1.146119882009741e-01   +5.378660155248235e-02   -3.028497186165549e-01   -2.142514930120882e-01   -1.064615349431152e-01   -6.147074553846323e-02   -3.273634633274462e-03   +1.836547820937466e-01   +5.112537894822763e-02; -4.503390814782617e-02   -8.077721768429162e-02   +1.511294257278280e-01   -2.140073353045421e-01   -2.258121459472430e-01   -1.912591708126173e-01   -2.152539792170169e-01   +3.901002856979603e-01   +1.148968028085494e-01   +4.178807474625287e-02   +1.889461261060768e-02   -6.365821775288016e-02   -1.317989006677948e-01   +1.752088567989074e-01   -1.604016319833422e-01   +3.692784772680779e-02; -1.157471091936237e-02   -3.103787800077601e-01   +5.839515649088779e-02   -7.323675215116106e-02   -6.321054436459539e-02   +3.485831189078101e-02   -1.072398753546051e-02   +1.390737061034573e-01   -4.484488621164436e-02   -4.322567427178305e-02   -1.281908573682655e-01   -2.538280044795557e-02   +1.511398368415089e-01   +9.400157387641729e-02   +1.596353659440205e-01   -1.887677185505801e-02; +7.034064356296316e-02   -4.192844963908635e-02   +1.087489920131710e-01   +5.416819508296675e-02   -1.673148386602983e-01   +8.083335446669778e-03   +3.034092977778954e-02   -4.210844758015932e-02   +1.041970405032063e-01   -2.524875618624466e-01   -1.476935971571658e-02   -9.479144700199424e-02   -2.313295076993193e-02   -5.021469946980962e-02   +1.638208445502288e-01   +2.261251359287072e-02; +1.082397289696001e-01   -4.802315545682633e-02   +1.833687338440140e-02   +8.208392264101604e-02   -6.588682924456769e-02   -2.641719330877603e-01   +2.290899332986384e-01   -9.874565469657343e-02   -2.900849885597190e-01   -5.972936987498857e-02   -2.880289905622801e-01   -9.378514878532476e-02   +3.108276524806219e-02   +2.324002080195336e-02   +7.266546422500973e-02   -6.409641436674082e-02; +6.997606431973113e-03   +3.496890414901839e-01   -2.698568851327107e-01   -2.489039657037178e-01   -3.839005055239576e-02   +1.847701524241164e-01   +1.780001519894259e-01   -1.009316301720217e-01   -1.841924018505795e-01   +1.117151188764288e-01   -7.193162378188052e-02   -1.057772924516892e-01   -1.484456193511094e-02   -2.114646809763606e-01   -2.768061973019321e-01   -1.586002469236681e-01; +6.347740395037403e-02   -5.399671674772628e-02   -1.233183979918093e-01   +2.320515290728198e-01   -9.848065137837335e-03   +8.674694497170504e-02   +5.581432152424468e-02   +2.252491207365824e-01   -1.031571261128347e-01   +1.466367154029920e-01   +7.237874093697517e-02   -1.501615607766919e-01   +3.358372054801411e-02   +9.207378957413087e-02   -1.079725449874341e-01   -1.004614194341281e-01; -2.827095497466392e-01   +5.390566388810987e-02   -1.435482150600768e-01   +5.573132016410622e-04   +9.497687251951556e-02   -2.780143256169403e-01   +2.238857426705482e-01   +8.194653121064782e-02   -6.942376092886984e-02   +1.338597155045834e-01   -8.186435935568843e-02   -9.352393556222192e-02   +5.504452405561974e-02   -1.777947750952257e-01   +7.175126313944413e-02   +1.341983874471998e-01];
L2E_L1E_iAMPA_netcon = [+1.298273038376393e-01   +1.988646586186435e-01   +1.126782087568539e-01   -2.433298683399184e-01   -3.914700862085822e-02   +1.359193725201115e-01   -1.585227029914253e-01   -1.795665855313358e-01; -2.856698021144083e-01   -6.118845254105920e-02   +8.956886169501217e-02   +3.876541000111872e-02   -8.260007199099512e-02   -1.789002601009339e-01   -7.987895863598425e-02   -4.651357456190084e-02; +2.535541108202466e-01   -1.055755920847495e-01   -2.418358132034275e-01   -1.182724971827044e-02   -1.230337768402378e-01   -2.264833329624657e-01   +7.407786129525365e-02   +1.627781310918217e-01; -1.873043557510119e-01   +8.466552010702867e-02   +2.026340069188954e-01   +1.808797425197444e-01   -2.336783546960688e-02   -2.535582651199112e-01   -8.211721069150107e-03   +1.339064552131261e-01; +1.128874580390511e-01   +1.413743078890619e-01   -1.440645139196783e-01   +2.358493462018061e-01   +5.588779331593136e-02   -2.450948256675893e-01   -1.377187605376693e-01   -8.496798503993576e-02; -2.178540247334929e-01   +3.720341293084895e-02   +1.471191006330604e-01   +1.170915592986567e-01   -3.212375798323133e-01   -3.822035326419807e-02   +7.282622661119884e-02   -2.731004548515854e-02; -2.050581957880835e-01   -4.561287670385014e-02   +1.552573006218911e-01   +1.643390514386832e-01   +1.797248776095414e-01   +9.427661430387732e-02   +5.028129273229919e-02   -1.907321865158754e-01; -1.192089705418082e-01   +8.689986444926733e-02   -1.124983934007882e-01   -2.375463175762976e-01   +2.009315139845767e-01   -1.014984099830980e-01   -1.100772018328409e-01   +9.629031688193970e-04; +5.198775948275546e-02   +6.846048071350509e-02   -6.843237289467510e-02   -2.109979137156587e-01   -3.096323957100124e-02   +5.846240293041044e-02   +1.925512291293970e-01   -2.968495665276900e-01; +3.846159085426637e-02   +2.191166004997027e-01   -2.619812054666691e-02   +2.018210038637715e-01   +3.433978757447392e-01   +2.541367887719677e-02   -3.445410697607878e-01   +1.423701482152497e-01; +7.411443613280438e-02   -1.883923080283275e-01   +3.000628327150565e-01   +1.357865348708055e-01   +2.918184112774306e-01   +2.449645247668441e-02   -1.469116421350590e-02   +1.421226688759817e-01; -1.834035817050297e-01   -1.197692234654596e-01   +1.391935663799287e-01   +2.828059227745976e-02   +7.979750600814185e-02   -1.008453043014311e-01   -3.430937247571342e-01   +7.610749204808605e-02; +4.116681363819823e-02   +1.641150014825657e-01   -1.044612638596390e-01   +1.785164836790871e-01   +9.747228759854477e-02   -1.374413728733478e-01   +2.031805148890384e-01   +1.445590314999838e-02; +6.820544538750306e-02   -1.116958688198951e-01   +2.442539024018266e-01   -3.047445606803089e-02   -1.873341211733862e-01   -1.222048311611737e-01   -3.724474316863280e-02   -2.016025447535088e-01; +7.183119741932383e-02   +9.923643053047390e-02   -1.912167496854261e-02   -5.807273448878181e-02   +1.861117873158801e-03   +1.472748306201302e-02   +2.147735470377567e-02   -2.367960849534531e-01; -4.780091502255086e-02   -3.096610297459004e-01   -6.437310219630241e-02   -2.113086102815633e-01   -1.842122994738056e-01   -5.699611556638505e-02   -4.289544350866080e-02   +2.089960051443795e-01];
L1E_L2E_iAMPA_netcon = [+1.879007316662919e-01   -8.663587442335567e-02   -1.075670105998163e-01   +2.618613458380950e-01   -1.256754081972798e-01   +2.132572637028903e-01   -6.691872438163168e-02   +1.450517561916955e-01   +5.524106357140600e-02   +1.317928028998464e-01   +1.011630385477104e-01   -7.310007393839098e-02   -1.216782086072048e-01   +7.665037536442518e-02   +1.331831108954298e-01   -1.799544836636753e-01; -8.783004330333315e-02   -3.401474857144483e-01   -5.599917478014515e-02   +1.738174493446070e-01   -1.382686081229552e-01   +2.138049905294471e-01   -1.539275155505881e-02   +3.702116416230387e-02   +1.792829902899465e-01   +4.011544929915309e-02   -1.177982208396318e-01   -6.434002978048213e-02   +1.325709631362902e-01   -3.644289397674578e-02   +9.324581410451112e-02   +3.205556880292399e-03; -3.712242360201089e-01   +2.554279393401002e-01   +1.864668504659612e-01   -3.923154135487326e-01   -7.954720125032705e-02   +6.509501950329848e-02   +5.681679130680536e-02   -2.228322836460379e-02   +3.042407108902708e-02   -5.500658744926004e-02   -1.196028061613452e-01   -2.579316367236772e-02   -1.963512908480157e-01   +3.595197958482267e-03   +5.490410859764534e-02   +8.268319320125309e-02; -9.218757841762767e-02   -2.159929843783412e-01   +3.732317428293823e-03   +1.925527658751577e-01   +2.537247984201400e-01   -1.766349782482360e-01   -2.130682860690317e-01   -5.449681597801925e-02   -1.067127487304708e-01   -7.261923142661381e-02   -1.800866112944763e-01   +1.077473072645635e-01   +1.218734823570315e-01   +3.166622162017265e-03   +2.910416222545839e-02   -2.327534625440024e-01; -2.178609102488371e-01   -1.027836249391619e-01   +1.061569923897334e-01   +2.929932222675148e-02   +1.629631350459339e-01   +1.098087373361754e-01   -1.429304726502194e-01   +6.103335235031022e-02   +1.192586694108754e-01   +1.385515573544413e-02   -1.485382779346704e-01   +3.535290962911893e-02   +4.734225860989032e-02   -5.113299994131711e-02   +8.930071043016240e-02   +1.746630970679751e-01; +4.459972128959509e-02   -1.152826510481866e-01   +5.922032019728643e-03   +1.758367210274755e-01   -1.595278730525025e-01   +1.985860719248656e-01   -1.489772093235368e-01   +7.869645837681631e-02   -1.689818361397150e-01   +2.317362375749355e-01   -1.109367890181555e-01   +1.750910557505059e-01   +2.818536526207343e-01   +8.347004687472102e-02   +1.844520857551542e-01   +2.955786267435743e-02; -4.998302113586281e-02   -6.321409571004544e-02   +5.698881984310636e-02   -2.187251569808018e-01   +1.665834583515475e-01   -1.958228695483510e-01   +5.674438868952861e-02   +2.070983130155395e-01   +3.550451696036061e-01   -1.694528633761888e-01   -1.914214810886420e-02   -1.242213719032426e-01   -2.127056661515662e-01   -3.302057862136292e-01   -7.389833728431454e-02   -1.181155987549555e-01; +1.696433111138776e-01   -3.906991877744116e-02   -8.883265936627482e-02   -5.842281428029127e-02   +9.477958154252927e-02   -1.537189674367157e-01   -2.129480541001566e-01   +7.430210413809796e-02   -2.154114633245130e-02   -3.738761437887396e-02   +2.188476170135683e-01   +4.333296386987742e-02   -1.444119862223608e-01   +3.924130707454179e-02   +5.199578879283610e-02   +1.454453941778278e-02];
L2I_L2E_iAMPA_netcon = [-1.016980380070054e-01   -1.105159811587009e-01   +8.287823537833221e-02   +1.589524109835009e-01   +4.033643628799871e-02   -1.118164089543615e-01   -1.606394503442235e-01   +1.239759319241119e-01; +8.229849021971157e-02   +2.242244074671747e-01   +8.478373475108340e-02   +1.276573955180262e-02   +1.519830350140876e-01   +2.617886132037802e-01   -2.541598252546349e-02   +9.036031886843116e-02; +8.234031225848770e-02   +7.125095504491512e-02   -4.581364506067400e-01   -1.644947261487211e-01   +1.021342912516508e-01   +3.025853050894681e-02   -1.905871955376584e-01   -7.461224639416501e-02; -8.665905338118590e-02   +1.737575968741735e-01   -1.050521909163552e-01   -5.762985225422362e-02   +1.624325288664965e-01   +1.061474565683430e-01   -4.488464231798044e-02   -5.407570802319477e-02; -1.476058037254523e-01   +4.818115914520599e-02   -2.299054514953326e-01   -1.582976020899373e-01   -4.892950999212221e-02   +2.257173125446023e-01   -1.710393761639457e-01   -8.641384416678896e-02; +7.776954213953551e-02   -3.518212360143988e-02   +1.075586840834899e-01   -1.402391991302653e-01   -5.236978164554353e-02   +2.842723318705975e-01   +2.983685530700692e-02   -1.665196047308412e-01; +1.536934057956193e-01   -9.384918249741769e-02   +2.636261856085427e-01   -1.525598210035441e-02   -8.405926550488718e-02   -3.912909564873775e-02   -2.322909285751136e-01   +2.986189691682448e-01; -1.871515368636207e-01   -6.983880132463852e-02   -3.606656903566746e-01   +2.169425134655829e-01   +2.002182886732701e-01   +9.932396396785284e-02   +2.064741791175968e-01   +3.024480439076181e-01];
L2E_L2I_iGABA_netcon = [+9.240542033612109e-02   +1.983166441021343e-01   -8.938929148609093e-02   +4.653424101312761e-02   +1.728306405307974e-01   +7.352173242464130e-03   -1.682840311547953e-01   -4.018937756821956e-03; +1.857291003159505e-01   -1.163933501550744e-01   +1.880547321222475e-03   -1.845474629818121e-01   -1.081156627958860e-01   +1.868347044087432e-02   +2.202518635396144e-01   -1.653252272343305e-02; -1.849237006088577e-01   +1.610853919358284e-01   -5.229893402394047e-02   +2.020252690270757e-01   +1.617757743147272e-01   -1.142737137818683e-03   +1.541611109732785e-01   +2.045143449451999e-01; +2.057911684949693e-01   -8.216717484729055e-02   -1.935809603401492e-01   +3.285017555094613e-02   -4.147109855211471e-02   +2.013108805085623e-02   +9.794356483523359e-02   +1.583334930872293e-01; -1.782217920805598e-02   +1.855579474306536e-01   -1.597728799629472e-02   +2.139617240020361e-01   -8.358363157051082e-02   +1.535403540530643e-01   +1.828118665549869e-01   +1.650794104139968e-01; -3.729976567393240e-02   -4.682439733515013e-02   -8.515936295436551e-02   +1.791065690359822e-02   -1.186943029095106e-01   +2.827306208072331e-02   +1.902793392275765e-01   -1.994793396497677e-01; -1.671783920020821e-01   -2.465706810756303e-01   -2.346373446887988e-02   +2.095810463649352e-01   +7.451017992870981e-02   -2.337941893688977e-02   -8.640322151517096e-04   +5.452087023252649e-02; +7.533179347999557e-03   +5.274791894874728e-02   +5.861229475366943e-02   +2.251420969322199e-04   +2.677542941395170e-01   +5.761765912105950e-02   +1.329190524955943e-01   +1.009651366066553e-02];
L3E_L2E_iAMPA_netcon = [+1.989587945921830e-01   -9.287529823195115e-02   -7.172268914233942e-02   -1.199081895017699e-01   +1.908436354196724e-01   +2.219689092049413e-01   +9.997141745157165e-02   -1.655762979282586e-01   +1.327795144742858e-01   +1.083790299519181e-01   -5.762536190198260e-02   +9.354385210917932e-02; -2.298065883721357e-02   -1.059863008609528e-01   -9.327882352047956e-02   -1.525551253487313e-01   +2.305459926106274e-01   -8.155738498641822e-02   -1.012679172286453e-01   +9.019602043030646e-02   -8.476910608715627e-02   -1.485230922932667e-01   -1.427535407435769e-01   +4.392510980068252e-01; +2.018186376824596e-01   -3.278648582713375e-02   +2.949149583159697e-01   -1.191137806645466e-01   +1.319229714077420e-01   -7.589297126482426e-02   -1.510694735321984e-01   +9.906809628255422e-02   +2.500102918765317e-01   +2.267857247216540e-01   -2.431857954345948e-01   +2.284650235850446e-01; +2.356377500242611e-01   +1.193402616738092e-01   -5.750873822106561e-02   +7.682198141811267e-02   -2.183407413838644e-01   -1.840220268080481e-01   +6.912665855829321e-02   -1.079677289594170e-01   +1.307112176604456e-01   -1.946183854106244e-01   -7.531329260632622e-02   -1.056063412764706e-01; +1.171901811163008e-01   +1.853889059335285e-02   +1.231709327911435e-01   +1.225955218388568e-01   +2.675575572676159e-01   -2.406534021022172e-01   +1.768974079385998e-01   +7.061163173079889e-03   +1.216461746286333e-01   -1.600250234841310e-02   -6.419002790449427e-03   +5.674605026284181e-02; -6.281662398859988e-02   +9.313383972853076e-02   +3.611292171364217e-03   -8.081479736615482e-02   -1.809016860302571e-01   +1.937666540179632e-01   +9.715642718361826e-02   -8.910933749242884e-02   +2.276556900208374e-01   +9.273924659532652e-02   -1.345699036336493e-02   +2.243119152770396e-01; -1.165584229611124e-01   +1.166413538195866e-01   -5.583465109211316e-02   +3.998093320909359e-02   +1.514401929558807e-01   -2.206000897601419e-01   -1.920921271944058e-01   -1.524891059289796e-02   +1.372807396877448e-01   -3.288938664806104e-01   +3.116078776297338e-02   -5.006259930281171e-03; -2.211633815903842e-01   -6.152105181972661e-02   +6.348103648286585e-02   +8.607797854377366e-02   -1.237887614463129e-02   -3.125512120503833e-02   -1.207889427837935e-01   -4.490814744117030e-02   -4.125068665594944e-02   -1.500834718995043e-02   +1.008536136323836e-02   +1.323100796410954e-01];
L3I_L2I_iGABA_netcon = [-8.218952009225830e-02   -1.022606951437389e-01   +9.142194764702916e-02   -1.622076232815439e-01   -7.667234062635115e-03   +1.467714805093638e-01   -3.999044130912789e-02   +1.900295827889545e-01   +5.504014995673183e-03   +1.253681208776305e-01   +1.039771992175869e-01   -4.018282236967463e-02; -2.952517207627520e-01   +2.618678966273666e-01   -1.400473138833701e-01   -6.446988219259406e-02   +1.690713180110122e-01   +9.374007339459620e-03   -6.963071607278647e-02   +7.510088059972381e-02   +2.162931783724195e-01   +1.192771537914840e-01   -2.221419674149892e-02   -1.725673370425051e-01; +2.112859429162690e-01   +2.777378910770525e-03   +1.019944293067511e-01   -1.473389711677142e-01   -1.370565796932746e-01   -5.192745936020403e-02   +2.741748662736371e-01   +1.081041520703493e-01   +2.056662255046479e-01   -1.198751865690501e-01   -1.159294878203033e-01   +2.333908562084455e-02; +4.744516120337265e-02   +2.143931715385246e-01   +2.493318974035167e-01   -1.316741097616238e-02   +1.387281153315394e-01   -3.236093634894809e-02   -3.137683679611819e-02   +1.401089433316454e-01   +1.099613904983091e-01   +2.172336872653452e-01   -2.609815403205770e-01   +5.392594917655630e-02; -2.470388201140889e-02   -9.109534190452299e-03   -2.327548608747060e-01   -1.678078052984707e-02   -1.213179156795499e-01   -8.402216289712450e-02   +7.753097532385991e-02   +6.623510191373036e-02   +1.388201203631578e-01   +1.024571724638349e-01   -4.385230570720013e-02   +1.987103070569062e-01; -1.959664539185987e-01   +3.594246306267022e-02   -9.811199504954489e-02   -2.531606236198355e-02   +2.364528880833453e-01   -7.814689535141484e-02   -5.088148540349085e-02   +7.239204797363251e-02   +1.662936910448649e-01   +7.246696872885805e-02   -2.209536477098437e-02   -2.204396859936825e-02; -5.651883747383133e-02   -3.408344034135839e-02   +8.577417713565061e-02   -7.950319736507819e-02   -1.716297293952988e-02   +8.817633877494230e-02   -2.750665577159674e-01   +1.926061247606561e-01   -3.065222567577809e-01   +1.954419662247670e-01   -2.693018775161355e-01   -3.775573969309830e-02; +1.956308144117287e-02   +6.122174956633868e-02   -6.963061658316583e-02   -2.736012821129037e-01   +3.517969937555442e-03   -5.287048591379149e-02   -2.550950577979599e-01   +1.855196633802654e-03   -2.952302022065528e-02   -8.734949227456952e-02   +1.330863868102046e-01   -5.771809820169414e-02];
L2E_L3E_iAMPA_netcon = [-5.928069833380589e-02   +5.667479046972824e-02   +1.331716813284464e-01   -1.631930193431950e-01   +1.103582832958847e-01   +1.233739256550484e-01   +2.166442471583616e-01   +3.981909873610978e-02; -9.270684116336997e-02   -1.288535774709633e-01   -2.672612068650931e-02   -1.277485954116824e-01   +6.856727071603709e-02   -6.384887138680144e-02   +7.690683169543013e-02   +2.937041171826338e-01; +5.800147484493238e-02   +4.772318658061152e-02   +1.281773204568457e-01   -1.574645349343323e-01   +3.334524806726803e-02   +2.369655456742016e-02   +6.702181131652685e-02   +2.369590735999701e-02; +1.028208316179777e-01   -2.312328581181372e-02   +5.284697914818063e-02   -6.308081015354389e-03   -1.764970982132243e-01   -1.313256063524630e-01   +1.769311603954912e-01   +5.592947714052319e-02; +1.697714853898003e-02   -2.965434774668761e-02   -1.310546194555423e-01   +8.795086836538896e-02   +1.650929193306632e-01   -9.557955325035549e-04   +1.880614667906489e-01   +1.197523316808445e-01; -5.771408255956141e-02   +6.258897783478407e-02   +6.923871373265740e-02   +3.965769799890510e-02   +1.811776838891489e-02   +4.077039378080904e-04   +1.377320793108888e-01   -1.276362161340902e-01; +3.263450472527792e-01   +7.695364419075588e-02   -2.667004507025362e-02   +2.079122681315659e-02   -1.427768440872633e-01   -2.152389805501612e-01   +4.343126132045427e-02   +5.519507056378940e-02; +1.932285111420096e-01   +1.341614409682538e-01   +6.832617675323815e-02   -2.422856816673334e-01   +2.053373081970861e-03   -1.737972483400091e-01   +1.778731912599166e-01   -3.115774895409921e-02; +2.219574950319300e-01   -2.065542244638070e-01   +1.382349760106740e-01   +2.898855518352685e-01   -1.317736425852574e-02   -7.201827311059841e-02   -6.269735495805842e-02   +6.764229528317756e-02; -7.209949894527841e-03   +1.650691020491893e-01   +2.307380899314972e-01   -9.889477528551832e-02   +1.753385221114958e-02   -1.851797498951242e-01   +2.825250244319187e-01   -3.552817451770879e-02; +5.179533042483409e-02   -2.034871673257611e-01   -2.798860664622708e-01   +1.972743380685948e-01   +1.643604190305178e-01   +1.996908526194709e-01   +6.048138223711604e-02   +8.157072472416341e-02; -2.072016423370144e-03   -6.579420695370113e-02   -2.181377422574867e-02   -6.965069472923768e-02   -2.609717635772020e-01   -3.218786034929015e-01   -3.065825459946508e-01   -1.863528974108351e-01];
L2I_L3I_iGABA_netcon = [-2.778127705164511e-01   -3.334060558342427e-02   +5.578020977845997e-02   +6.717109844774594e-02   +2.697066826506068e-01   -1.325587814848194e-01   +8.784431008429688e-02   -9.813551123985595e-02; -1.448075880347024e-01   -2.722003641190172e-02   -2.713407248573628e-01   +3.862913699910625e-04   -1.160556070555918e-01   +3.439293219953853e-01   -3.080211086025664e-01   -1.017312700145220e-01; +2.894138501207650e-01   +1.960573815797038e-01   +9.144769045440121e-02   +8.627201709426476e-02   +1.756341172622777e-01   +2.172510903177887e-01   +2.065405423398897e-03   +1.854369634807198e-01; -5.565734113760118e-02   -3.882541433604533e-02   -8.121527307946935e-02   -1.544571286989637e-02   -2.643222004903708e-01   -8.430943081816455e-02   +2.433262740372783e-01   +9.005925465819142e-02; -1.325309794088379e-02   +8.998599735182206e-02   +2.562296912770342e-01   +5.611081026753288e-02   +3.600983562480992e-02   -1.980088653873109e-01   +3.037099942853498e-01   +2.968731844315192e-02; +3.449955815397315e-02   -3.641821112457434e-01   -2.631163246046053e-02   -7.580356408383052e-02   -3.664201972036835e-01   -1.057691672892180e-01   +1.324007260697830e-01   +1.149619119337751e-01; +1.283360465654116e-01   +7.137598965718345e-02   +3.402387739052907e-02   -3.934917157510050e-02   +2.255114968368131e-01   +2.663411890190487e-02   +2.982076201766064e-01   +3.298527535346296e-02; +7.018302246982711e-02   -1.936724728652992e-01   -7.444009058530646e-02   +2.387586662994287e-01   -1.795781607665861e-01   -1.079836605190430e-01   +2.767123346836958e-01   -3.372375335805762e-02; -1.291139326713129e-01   -1.352405245325081e-01   +1.585039288004978e-01   -3.344943746737149e-02   -2.285089610875983e-01   +9.674376217259985e-02   +1.939835230014888e-02   -2.169497510075155e-01; +2.015827967486406e-01   +3.265171905415204e-02   -9.702452125566904e-02   -1.784092432375252e-02   +1.882244096922982e-01   +3.494727514827358e-03   -2.883955124383080e-02   +1.554261057133589e-01; -1.927120167996280e-02   -7.321854580908552e-02   -5.746902363354163e-02   -2.015870187235686e-01   -2.778132256430153e-01   -1.203672547219161e-01   +3.388917008300346e-02   +3.649472262719239e-01; +1.001361467803397e-01   +5.063483057895838e-03   +6.611223106032876e-02   +4.622835609244313e-02   -7.111904933762954e-02   -5.186671929163435e-02   +1.038699913606781e-01   +4.951448964912739e-02];
L3I_L3E_iAMPA_netcon = [-6.311237346832765e-02   -5.111604453867747e-03   +1.004076173103105e-01   +4.880155477053612e-03   -6.764138603924452e-02   -2.066412355292798e-01   -2.567222269954815e-01   +2.699955137467678e-01   -3.289235568560999e-01   -1.216320583677031e-01   +1.535338428521494e-01   +1.813052917664361e-02; +1.635668472756122e-01   -5.414729618220327e-02   -2.408092834372451e-02   +6.008288395727428e-02   +2.278134083107195e-02   +1.938492341228449e-02   +1.822234986642685e-01   -2.718437149741166e-02   -7.580023511556960e-02   +1.661018447287742e-01   -1.123959110647655e-01   -2.156632823308823e-02; -1.471463829546933e-01   +3.425111142818403e-01   -9.572032614025060e-02   -6.012687512996680e-02   -1.071366641758417e-01   -1.292557054605007e-01   +2.890696487463516e-01   +3.638971314621509e-02   -2.728989764298816e-02   +1.117577972727775e-01   -1.391897649097757e-01   -2.149808064952211e-01; -6.570547214869424e-02   +1.815818680288331e-01   -1.448444931828043e-01   +7.696819226876142e-02   -4.587759000906395e-02   +1.116283788279066e-01   +3.887143646430084e-02   -1.942347420108896e-01   +1.721416146924129e-01   -3.158766542524775e-01   -1.798816724193432e-01   -1.453769819317579e-01; -1.147563514696790e-01   +2.958178368260263e-01   -1.726124993605316e-01   +3.378351892953992e-01   +1.683490113092449e-01   -2.263072182760822e-01   +3.985598143051494e-01   -3.032867943280161e-02   +1.619128824768739e-01   -1.622330348752699e-01   +2.363101989889977e-02   +2.486253764827643e-01; +1.165919650824637e-01   +1.348968050916915e-01   +4.545673524262448e-02   +2.670652853737894e-01   +6.117877717053252e-02   -5.592543667714905e-02   +3.067265245750032e-01   -9.277385271297940e-02   -4.507556620220987e-02   +1.012098587469518e-01   +1.248502910616611e-01   +1.007596608092280e-01; -2.956943852918832e-02   -1.217441551983509e-01   +3.591495743892631e-01   +1.136069288588323e-04   +8.909508713721423e-02   -3.173109794616959e-01   -2.477002298984471e-01   -1.604239293786199e-01   +5.334368839295908e-02   +2.403316110598096e-01   +6.890058171223307e-02   -1.673321849725780e-01; -6.648225686943506e-02   -2.957254032845824e-02   -7.006627186251148e-02   +3.178960793178696e-03   -4.744816060773576e-03   -2.817032904763504e-02   +1.700396543835947e-01   +4.183636010338356e-02   -5.641545274158723e-02   -1.084894849309045e-02   -8.752886318654117e-02   -5.710019701709591e-02; +2.657887492390901e-01   -1.207979792776430e-01   +7.532731690286260e-02   +7.183712610796113e-02   -7.941499468649099e-02   +8.534208297468517e-02   +8.866627254914629e-02   -1.223300484122349e-01   -2.960623194506554e-02   -1.657745238144392e-01   -2.386457624578180e-01   -1.978003925025621e-02; +1.234700916820785e-02   +1.169701443846240e-01   -1.708808253283146e-01   -5.943511621299501e-02   -2.128625356335748e-01   -2.698189676131740e-01   -1.604207791987952e-01   -3.013835660755686e-02   -9.234485293324383e-02   -2.135085811661337e-01   -1.666275268850149e-01   +1.760118965355648e-01; -1.757735855791502e-01   -7.502243444275995e-02   -1.880338130778620e-02   -4.239882512202667e-02   +7.112811093553597e-03   +4.174004570742186e-02   +1.826860058335478e-02   -9.096604184048094e-03   +6.572022667406179e-02   -2.750051748109083e-01   -3.228234453447825e-01   +6.049875455662736e-02; -3.376423021781067e-02   -9.922525892853071e-02   +4.513244954830586e-02   +2.305271680781215e-01   +1.735660221089894e-01   -1.949574845453034e-01   -3.508976899588158e-02   +2.639101890011538e-01   -3.784179449209407e-01   +3.703132534394109e-02   +4.154377659104494e-02   -2.198085841770993e-01];
L3E_L3I_iGABA_netcon = [-5.721500235472871e-02   -3.208538650447181e-01   +1.517306538378076e-01   +1.748423789304600e-01   -1.296277915148697e-01   +2.026658255041903e-01   -1.194346202346387e-01   -8.663620958563493e-03   +3.499896486766229e-02   +4.068063986508711e-02   +2.932236089843406e-01   +5.716749605552780e-02; +1.204341616435122e-01   -2.940959324390923e-02   -5.851434350253087e-02   -5.612371709801559e-02   +2.720378931072539e-02   +1.056389214842441e-01   +3.978816504724490e-02   -8.482897787646278e-04   -1.685249509403718e-01   +8.495819303854607e-02   -3.909167123855185e-02   -3.581978142710258e-02; +3.003039882920577e-02   +3.474852544356094e-01   -1.817516680878591e-01   +8.372148093731026e-03   +1.987153212092265e-01   +4.240920654461645e-02   +1.606757284003232e-01   +2.690560638460614e-02   +8.060882304214588e-02   -7.407911184626986e-02   -2.517994615886415e-02   -1.386172740176726e-01; -1.566273570973219e-01   -3.064025687189607e-01   -4.441401138979720e-02   -1.262558934448243e-01   -1.448506809307423e-01   +2.274749872424781e-02   -4.154515596841986e-01   +1.235317336447238e-01   +7.094939219675331e-02   +2.030221325159575e-01   +6.761807016418424e-02   +9.691646721071216e-02; +5.182121706290289e-02   +1.174348637341880e-01   +2.518733728692685e-01   +9.756649195512526e-02   +2.344906501579029e-01   +5.371328446478817e-03   +1.778684109041032e-01   +1.634448426820393e-01   +1.264885974234781e-01   -1.760037363496626e-01   -2.216861881057578e-01   -3.971951030312670e-04; +9.814768692995873e-02   +2.350436882740282e-01   +1.112972175441630e-01   -4.557546569404849e-02   +1.658020127490666e-01   +3.190815314360435e-02   -2.019771487187794e-01   +1.549679426416255e-01   +2.995749015483851e-01   -4.719704775203604e-02   +2.790568866885026e-01   -1.541129336241509e-01; -3.844167971476169e-01   +5.425135492019513e-02   +9.238343254278987e-02   +1.206370124369870e-01   +1.218856902750680e-01   -5.287591601531121e-02   +2.854476508425637e-02   +1.540232120427327e-01   +1.155416098233739e-01   +1.681999598900189e-01   -1.194399161299984e-01   -1.897408061864910e-01; -5.349647668758099e-02   +1.326002279880627e-01   -1.377189600881519e-01   +1.189612231904343e-02   -1.254896748594341e-01   -3.015261917057801e-01   +5.705037272012424e-02   -1.536631211304229e-01   -1.905517946079230e-01   +3.994398851115807e-02   +5.171482275448361e-02   +1.786561186132393e-01; -2.773603887182642e-01   -3.245176469838478e-01   +1.255721476825035e-01   -2.175565056531845e-02   +1.127633762192101e-02   -7.082826774689895e-02   +1.801635347217404e-01   +2.153543295288951e-01   +3.248015152193057e-01   -2.344329880080376e-02   +9.011817887196027e-02   +1.330682877713249e-01; +1.032592799418711e-01   -2.047102194023036e-01   -6.841659746941695e-02   -2.287141396251128e-01   -4.414594780700867e-02   -2.314930103728650e-01   +1.375426491850642e-01   +1.425114123729748e-01   +2.748919468654521e-01   +4.531638451132408e-02   -1.994613895792157e-01   +4.555913975217533e-01; +4.011971680210233e-02   -2.607113119536761e-01   +4.586242222442565e-02   +8.196308409978728e-02   -1.707595175150740e-01   -7.133493647139277e-03   +1.626102647413938e-02   +1.083822794438991e-01   -5.654297200122233e-02   -3.664611190667298e-01   -2.709567512548773e-01   -6.155023286292470e-02; -6.878207857971261e-02   -9.315991329659312e-02   +2.122938965929575e-01   -1.875337750709666e-01   -8.603468808735848e-02   +1.259370338242701e-01   +7.841984872807876e-02   -1.181466443864861e-01   +1.936936945695684e-01   +3.095008508066727e-02   -1.072777132994152e-01   +1.941743858866321e-02];
L2E_Input1_iAMPA_netcon = [-2.136345812038175e-01   +1.047595977874815e-01   -9.693068281360018e-02   -3.448607867118588e-02   +1.224384304223973e-01   +1.842642415629378e-02   -6.352749509468336e-02   -1.030525559349709e-01];
L2I_Input2_iAMPA_netcon = [-1.800161496484804e-01   +1.254670199709545e-01   +1.021002105813102e-01   -1.652673038371124e-01   -4.569821701416023e-02   -8.842873429371059e-02   +2.621839315443671e-02   +2.307570990671337e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
