function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.242681048037469e-01   +4.223756792344909e-01   +5.306411373329082e-01   +6.363633056369414e-01   +5.995710257076996e-01   +3.410067970216747e-01   +6.482158299831651e-01   +8.394166142089053e-01   +5.443673973696170e-01   +1.926563434172377e-01   +4.462576305438781e-02   +8.222795111863144e-01   +7.679203862862692e-01   +1.100904126224062e-01   -5.291053236428105e-04   +8.390136012860408e-02; +9.828427489170736e-01   +9.619208823607032e-02   +3.238311899475493e-01   +9.569863377637119e-01   +3.871436223918037e-01   +6.065097730062167e-01   +6.784296975418747e-01   +8.320874288775089e-01   +7.222086649730001e-01   +1.380736023529211e-01   +7.528934084069017e-01   +4.305181560929195e-01   +1.677895449079906e-01   +1.359381209002806e-01   +8.652188277301762e-01   +6.267666381089123e-01; +7.304392814317082e-01   +5.970763875738886e-01   +1.057296068213099e-01   +2.414912472801842e-01   +9.158935310934184e-01   +1.916395375910178e-01   +6.347318130012624e-01   +2.558815781926518e-01   +5.212163288486703e-01   +6.959229043609709e-01   +2.409734349742573e-01   +8.876275648911103e-01   +8.635267415096208e-01   +6.791718993645930e-01   +6.130508410307379e-01   +6.615510908997960e-01; +3.449023449173517e-01   +4.722705012935545e-01   +6.110658894685594e-01   +6.760977185212896e-01   +6.220901323358856e-04   +7.399162374604143e-01   +9.458912070334466e-01   +6.137763125792725e-01   +9.930686343456030e-01   +9.256288208381365e-02   +4.421428002827816e-01   +3.917213429334755e-01   +9.902732285265901e-01   +4.949637364570584e-01   +9.885511544356445e-01   +7.301118286425079e-01; +5.861194922008399e-01   +6.956768098712885e-01   +7.804457952052281e-01   +2.881880673708949e-01   +4.626190639299367e-01   +2.419103587033840e-01   +2.090624148890702e-01   +5.826347577772267e-01   +2.211122391069511e-01   +5.235115461357008e-01   +6.875594750185745e-01   +7.695861753365790e-01   +5.157738396528063e-01   +1.886338579438889e-01   +5.263812145036911e-01   +8.928262145002721e-01; +1.086582395707858e-01   +7.003603136117663e-01   +4.235208416946121e-01   +6.704756696699644e-01   +4.252771571032363e-01   +9.196124062861262e-01   +7.088768363972955e-01   +5.412641767305684e-01   +1.045521551214957e-01   +5.315997332989291e-01   +3.581714245517600e-01   +3.971192597852259e-01   +8.843952091685972e-01   +4.941063535011481e-01   +4.807613921268827e-01   +9.820553420546690e-01; +9.050897358622348e-01   +6.397776890943482e-01   +9.097296381925568e-02   +6.940359426299789e-01   +4.604485488014185e-01   +2.708117831883649e-01   +2.370716543319537e-01   +8.708858895843884e-01   +1.113141761400172e-01   +8.612083024254160e-01   +7.362888976108883e-01   +8.097501038388020e-01   +5.876292936776335e-01   +1.486141151450764e-01   +8.027530606319931e-01   +7.691528144725995e-01; +8.814842526646223e-01   +3.298107191086763e-02   +2.650854638756965e-01   +6.686831156964690e-02   +7.708674730611798e-01   +7.656995256723981e-01   +1.195868832219500e-01   +2.647344703774818e-01   +6.583667498681428e-02   +4.847502254447727e-01   +3.939225516946822e-01   +7.548818980010906e-01   +1.552636793931594e-01   +5.403675407397569e-02   +2.282175950199349e-01   +5.831787750515399e-01; +8.178538481945880e-01   +6.809394508865703e-02   +1.535985948878843e-01   +2.522499276553288e-01   +3.241045369819638e-01   +1.899488513452002e-01   +6.076322225872663e-01   +3.160794148623030e-01   +4.044182892553608e-01   +3.926770724504772e-01   +6.840784642553156e-01   +3.781668133230882e-01   +2.000047608147137e-01   +8.512662807457694e-01   +4.969544039818836e-01   +9.268255960617350e-01; +2.598035958086074e-01   +3.192173800727133e-01   +2.816201166823794e-01   +2.217271632891085e-01   +7.838886495615978e-01   +2.858493686360606e-01   +4.522940125002216e-01   +1.188758221883710e-01   +4.474351368169229e-01   +6.714044376188726e-01   +7.043422045301257e-01   +2.170513626734609e-01   +4.076592539482086e-01   +5.611289558842929e-01   +8.990035060496050e-01   +5.810480183325899e-01; +5.939160800884310e-01   +5.297780704086392e-01   +4.414946006956390e-01   +6.685783949303216e-01   +4.702514364676870e-01   +9.092075329862265e-02   +4.588205602264805e-01   +9.401586372419153e-01   +3.658936322051655e-01   +7.416986507021458e-01   +4.423997889698297e-01   +7.906058519467959e-01   +7.477453417833336e-01   +9.297767830601826e-01   +5.759032863422355e-01   +1.668654681096105e-02; +2.273580615401718e-02   +6.541593965785095e-01   +5.262334465078823e-01   +8.448399245702715e-01   +3.619868903408401e-02   +5.776966155089398e-01   +6.621278805446120e-01   +6.455443864449816e-01   +7.624212462007485e-01   +5.191824755131715e-01   +1.870482085600277e-02   +9.499782065285115e-01   +8.238840249316689e-01   +6.977192629689886e-01   +8.439133356665716e-01   +1.212353887828855e-01; +4.258936874595637e-01   +4.069053638342421e-01   +4.584898781092281e-01   +3.450509384910404e-01   +1.760696848637825e-01   +6.835375589083936e-01   +7.697992651790996e-01   +4.802597746006554e-01   +6.266772963456425e-01   +3.449915695899257e-01   +3.291082340594800e-01   +3.287209013464892e-01   +7.915484512116377e-01   +5.843194946564562e-01   +7.384434600256949e-01   +8.622751148763099e-01; +3.116735815995615e-01   +8.195418221476602e-01   +8.748699091255611e-01   +7.820336233449416e-01   +7.199463335089398e-01   +5.466260236770656e-01   +3.500923963269242e-01   +6.394847347408918e-01   +7.724692459478734e-01   +1.494259167951111e-01   +4.235617563614567e-01   +6.732415187941837e-01   +3.201048638283065e-01   +8.147995920143196e-01   +5.864563898666983e-01   +4.827273192099092e-01; +1.608215944275863e-01   +7.202550719646647e-01   +5.191501682624401e-01   +6.770340016472934e-01   +4.740999621814896e-01   +4.243131192858379e-01   +6.617248939879502e-01   +5.447494223374922e-01   +9.325384532436862e-01   +5.869773747767322e-01   +2.687663080437432e-01   +4.400046813142343e-01   +5.337694050361181e-01   +8.805520386719435e-01   +2.443925355685959e-01   +8.451270513286719e-01; +1.775791781387696e-01   +9.681020763390062e-01   +9.450993188085279e-01   +6.725576555661488e-03   +1.528925799983304e-01   +6.438745349069637e-01   +4.155074974568941e-01   +6.472524683421079e-01   +9.734063352917288e-01   +2.611245255876484e-01   +1.967116154752022e-01   +8.326928902481813e-01   +8.992913706059762e-02   +9.898745314829244e-01   +6.651785118916254e-01   +2.094712390892803e-01];
L1E_L1I_iGABA_netcon = [+5.508597373096958e-01   +6.945954483985667e-01   +1.053424257085609e-01   +1.769641414372984e-01   +5.408428165065652e-02   +1.787645579815260e-01   +5.962183131913640e-01   +9.969276243247672e-01   +3.392209453414067e-01   +7.786518923935956e-01   +6.835767904698586e-01   +3.655300588474128e-01   +7.827335178563262e-01   +4.321783564410218e-01   +5.949928287804417e-02   +9.652169770607777e-02; +6.311897828861799e-01   +4.988269616373716e-01   +1.429617246505942e-01   +3.986391925158614e-01   +1.776910033416578e-01   +3.608832222085529e-01   +3.002065207371272e-01   +3.308769480640810e-01   +2.942332016651852e-01   +3.379002596358001e-01   +1.322812507943943e-01   +3.694895211232088e-01   +1.010797831988346e-01   +6.553011402117487e-01   +3.139165144072759e-01   +1.413249745674418e-01; +3.207188941819050e-02   +5.355952496516801e-01   +1.678481031960310e-01   +1.338564535112400e-01   +6.607865067940578e-01   +5.598002642277530e-02   +1.345450062434034e-01   +2.971183773959428e-01   +7.459298666727472e-01   +6.079163207864530e-01   +7.233785494538074e-01   +6.849952137467702e-01   +2.931555460802724e-01   +1.115083850180597e-01   +7.718962565881115e-01   +1.680480126973925e-01; +6.141624759570358e-01   +4.434883606502992e-01   +6.227036634700039e-01   +2.904732386501903e-02   +3.326044902114842e-01   +5.225089296240055e-01   +2.110809738522420e-01   +6.226600033055055e-02   +1.055675017569976e-02   +7.414982400455095e-01   +1.094840717139975e-01   +5.977323773667349e-01   +2.360963261292715e-01   +9.317101363524537e-01   +6.958129241841143e-01   +1.959448629730791e-01; +3.634764213934842e-01   +1.241540054165403e-01   +5.738150629109557e-01   +9.382637192690014e-01   +8.982349595498413e-01   +3.344981051602708e-01   +8.962539048335746e-01   +2.980014138771128e-01   +4.744758645729929e-02   +1.051896712252398e-01   +1.171466663074246e-01   +7.890991850123311e-01   +5.300831372066787e-01   +1.855897930855296e-01   +1.254863170778283e-01   +3.180457795555250e-01; +4.978644291781398e-02   +4.914594275206227e-01   +5.353710696675845e-02   +3.028148702810255e-01   +1.167397877765222e-01   +1.737085807881619e-01   +7.154459512096821e-02   +4.445924985863506e-02   +6.674903786975280e-01   +1.266810476648020e-01   +6.407800580704943e-01   +3.682940277994319e-01   +9.298141487163318e-02   +2.660659339188189e-01   +1.276889627458724e-01   +3.176139527731091e-01; +4.870824519302249e-01   +8.533099043196815e-01   +9.320919937625981e-01   +2.957610341356569e-01   +9.888952346583622e-01   +2.110506721023023e-01   +2.427790822892112e-01   +5.055075457383224e-01   +6.043131824930920e-01   +5.489344192287458e-01   +3.290716777808212e-01   +2.054141902235454e-01   +4.053661084948119e-01   +7.983789200019639e-01   +9.153339006229928e-02   +2.170532874288697e-01; +1.919073030937274e-01   +8.743359044469444e-01   +7.284112838943508e-01   +3.354165653808701e-01   +5.416337618837326e-01   +9.053782348743202e-01   +5.458774675374737e-02   +7.610990150796438e-01   +5.265869009264553e-01   +4.851949698126813e-01   +6.540769298487322e-01   +8.727139657447920e-02   +1.044478129335276e-01   +4.879305122942154e-01   +8.346968548185356e-03   +2.518228068190648e-01; +1.219613275840858e-01   +2.711676206705934e-01   +7.374615501265031e-01   +4.685986077539337e-01   +7.056796134181905e-01   +6.749644717008760e-01   +4.411521265132015e-01   +6.311453989343165e-01   +7.300002387886002e-01   +8.896635645889632e-01   +7.503247701937071e-01   +7.718780101335121e-01   +1.101713522061109e-01   +7.691700702237118e-01   +4.244390642844689e-01   +8.931039777420255e-01; +2.063368501914307e-01   +2.101962351027614e-01   +6.341139256268027e-02   +6.476414705044314e-01   +9.993695730877603e-01   +4.684574645080793e-01   +1.476760206020776e-02   +9.144096646852290e-02   +7.079604376283489e-01   +7.998127454839513e-01   +5.844472333993354e-01   +2.075173523507362e-01   +7.860100760292236e-01   +3.977797549276070e-01   +6.556850039137392e-01   +7.027853515511809e-01; +1.464672022924719e-01   +5.636261583522636e-01   +8.597149892275323e-01   +2.434635710979055e-02   +2.879621346194006e-01   +9.122832310231596e-01   +8.972165330891122e-01   +8.085179702046570e-02   +7.806312849534744e-01   +7.351740456578836e-01   +7.409511158209336e-01   +3.896664635553009e-01   +2.911556754967535e-01   +2.726630494728835e-01   +7.228365110444174e-01   +5.552034767971908e-01; +1.888883932563387e-01   +6.388775111282338e-01   +9.329460924167173e-01   +8.427293077939751e-01   +4.131210120730037e-01   +1.041262566689787e-01   +1.954292149969611e-01   +7.749469628304704e-01   +2.883806396355933e-01   +5.308522932395243e-02   +2.344236807041719e-01   +5.512040924311198e-01   +6.040182655469010e-01   +3.741915024673936e-02   +5.305008171968842e-01   +1.842108586123353e-01; +4.292939163541622e-02   +4.159574523020760e-01   +9.839513253959162e-01   +5.582303159445215e-01   +4.664942855068744e-01   +7.444662339979878e-01   +9.317794336516354e-02   +9.054410346995757e-01   +6.909438686281977e-01   +7.314848868602991e-02   +7.344260036884069e-01   +2.290096570404837e-01   +9.643010904791902e-01   +6.731377694283094e-01   +1.083268510843905e-01   +2.121733199237604e-01; +6.356539619995104e-01   +2.065255871428251e-01   +8.578485034779183e-01   +8.536113887328246e-01   +7.645685772204878e-01   +7.377099517252260e-01   +3.074584753454637e-01   +5.333583294912785e-01   +5.551899754189811e-01   +8.690898796032819e-02   +9.711948722620545e-01   +6.419842536006575e-01   +4.315040781498597e-01   +4.311218923149032e-01   +6.323153340792264e-01   +7.678765151074611e-02; +2.819460982392485e-01   +9.486258336126384e-01   +7.856561355237744e-01   +3.489730867622151e-01   +8.174380741419736e-01   +5.623019195907251e-01   +4.556864275576618e-01   +1.077737822637814e-01   +3.951574882890918e-01   +7.961638514553016e-01   +8.677681155433158e-01   +4.828693841523469e-01   +6.947362935625319e-01   +4.509691952661583e-01   +1.291419577094432e-01   +9.137840512647868e-01; +5.383307607116719e-01   +8.066493585913832e-02   +5.142765857468357e-01   +4.465807214014731e-01   +9.923219061506861e-02   +1.851336729946006e-01   +1.021130575017798e-01   +8.269403414514611e-01   +6.175778291986737e-02   +9.418294916750214e-01   +8.721010223611968e-02   +1.515838920150585e-01   +7.579466655468164e-01   +6.093187740614402e-01   +1.340982850160564e-01   +7.068403890919177e-01];
L2I_L1I_iGABA_netcon = [+5.584468990605435e-01   +1.595030494110265e-01   +4.229423076552745e-01   +6.834929489810625e-01   +8.085022139107177e-01   +7.953420735129800e-01   +7.888110146680757e-01   +2.670712630884618e-02; +3.134239320426409e-01   +7.584247330740186e-01   +4.296683305559673e-01   +4.636492480275983e-01   +7.469368459084811e-01   +5.776701354307581e-01   +8.516614260548026e-01   +4.206634137610524e-01; +1.663626644808658e-01   +8.703003642999797e-01   +1.251809829759222e-01   +2.128873629063217e-01   +1.185981252324794e-01   +4.414500264163352e-01   +5.067341319119613e-01   +1.829785615747864e-01; +6.218935812120007e-01   +3.509920935510740e-01   +2.402741985975439e-02   +9.823531526881008e-02   +5.257164168440251e-01   +2.572668622780536e-01   +6.357367610707713e-01   +7.266345967174884e-01; +9.876650299057109e-01   +6.861234896430147e-01   +2.904652336485230e-01   +8.232859848322960e-01   +3.248064035823110e-01   +7.524105472084629e-01   +9.522467115215731e-01   +3.702435987055964e-01; +1.714066915092151e-01   +2.937709537333998e-01   +3.186074420892115e-01   +1.753720488181474e-01   +5.457443438721395e-01   +2.291537266394246e-01   +4.444015529909508e-01   +8.417710229524844e-01; +2.580138626664476e-01   +5.299217945062279e-01   +6.536834440183074e-01   +1.641875362417913e-01   +4.000007852736260e-01   +6.506546695029430e-02   +5.869588352911168e-02   +7.331930481687688e-01; +3.973540385453832e-01   +8.331420124316777e-01   +9.570323461128508e-01   +6.675056939498658e-01   +4.157846122128299e-01   +7.663788354712878e-01   +8.676884383146356e-01   +5.695913038306006e-01; +7.491961519710853e-02   +5.991638241442959e-01   +9.367184229663775e-01   +8.933723437024049e-01   +1.787965569730605e-01   +6.713549117616936e-01   +6.311397312900346e-01   +1.781697481620671e-01; +6.844445955354291e-01   +3.349392180099539e-01   +4.582888452533119e-01   +5.156651564382715e-01   +2.560828660975027e-01   +7.146895012264290e-01   +3.531592711605120e-01   +9.589259618911473e-01; +4.035259957840816e-01   +2.994500094421098e-01   +2.394655082512658e-01   +7.029245802623882e-01   +1.957002295709055e-02   +6.425496736258007e-01   +9.969874352797384e-01   +2.651378156163874e-01; +9.825629485314600e-01   +4.529051428336462e-01   +7.646975414024344e-01   +1.519970407800559e-01   +9.228482195866686e-01   +4.191942697218778e-01   +2.248785354480731e-01   +9.245528120045559e-01; +4.005213579750936e-01   +4.237607485707451e-01   +7.592708608981033e-01   +9.526254000780573e-01   +6.547712195001328e-01   +3.898334639846235e-01   +6.527008253059960e-01   +2.215327070084328e-01; +6.212464457044269e-01   +3.597997692296788e-01   +7.402131002465824e-01   +5.402828244125583e-01   +9.336646764723890e-01   +8.173251397467047e-01   +6.045751333601026e-01   +3.729324290057185e-01; +1.547516655365798e-01   +5.603034151301782e-01   +7.443456969548241e-01   +6.807974696844804e-01   +1.637518901884225e-01   +3.166278969203250e-01   +3.880583100793297e-01   +8.826873381804981e-02; +3.814830279764511e-01   +7.428447311773733e-01   +1.085230260959368e-01   +3.717910454509459e-02   +9.216829651470921e-01   +8.161774203552529e-01   +1.399978951298578e-01   +6.418407500525914e-01];
L1I_L2I_iGABA_netcon = [+1.809404439163868e-01   +9.117753891305632e-01   +2.760802236831058e-01   +8.735027071516530e-02   +5.333312811016258e-01   +1.063974636802591e-01   +9.882055625677717e-01   +4.119191731233344e-01   +7.194326818557302e-01   +2.175478269661577e-01   +9.220351250484984e-01   +6.736088398686383e-01   +1.072096333098316e-01   +5.562969322847090e-01   +6.307693067720600e-01   +4.836002280472042e-01; +4.567887638986069e-02   +7.996796066769626e-01   +2.472406037595665e-01   +8.031250620195302e-01   +8.874552094020315e-01   +6.153986241533875e-01   +7.669229381678168e-01   +6.003359074863728e-01   +9.965982938017486e-01   +1.260371461628078e-01   +7.705174143694498e-01   +4.773738238123906e-01   +1.809476014016242e-01   +7.714294188586062e-01   +9.983843839698091e-02   +8.945310005696853e-01; +7.236408091845362e-01   +7.445921219842656e-01   +4.519224933297126e-01   +9.892994540775937e-01   +8.979874629965049e-01   +9.405994015666572e-01   +3.361183586029267e-01   +7.497599773017656e-01   +3.546396362226884e-01   +3.091411520976877e-01   +4.206532270404235e-02   +6.237130423519019e-01   +9.990395131063992e-02   +3.121346308056074e-01   +3.920547617679474e-01   +1.388606018719113e-01; +3.483369705522028e-01   +8.128752257767323e-01   +2.264603074328597e-01   +6.645033322960507e-02   +6.251905677988862e-01   +3.535247773675679e-01   +6.632280716333466e-01   +5.839258295360181e-01   +9.704907687178749e-01   +7.247778185369336e-01   +3.792263512736917e-01   +2.376106479366403e-01   +4.901655879257655e-01   +1.779477732391602e-01   +5.557490656204846e-02   +3.889880093670114e-01; +6.605387140272748e-01   +3.839003599803749e-01   +8.042965723818943e-01   +9.399107630724721e-01   +1.374308727085419e-01   +4.108450290170407e-01   +2.460959061778868e-01   +5.512144490988449e-01   +3.477580893428643e-01   +7.833426814125194e-01   +7.037966380851732e-01   +1.775865690856553e-01   +1.927869224951169e-01   +3.382351879358902e-01   +5.006359566908767e-01   +9.276781954124402e-01; +3.854061643506699e-01   +6.176527619992952e-01   +9.854571974292466e-01   +1.809577476952630e-02   +2.187694494341769e-01   +9.832576946807815e-01   +2.946998948661380e-01   +5.809217975164621e-01   +8.859214216927940e-01   +6.921956024227375e-01   +7.276609978643488e-01   +8.287870462929198e-01   +8.939996500868035e-01   +2.098680213849723e-01   +4.313172796478840e-01   +9.187866362974374e-01; +6.281851175898567e-01   +5.771311906765521e-01   +3.022613887437755e-02   +6.851534720284247e-01   +1.818697987187624e-01   +9.457555361736448e-01   +6.780029377903777e-01   +5.109416290770795e-01   +4.549825347147790e-01   +9.659252246059924e-03   +2.252150791579441e-01   +7.660406876492099e-01   +9.904079813026817e-02   +5.103363488969224e-01   +9.978599199792937e-01   +7.159815649831075e-01; +2.270261292859401e-02   +5.278161092742198e-01   +5.355867631039414e-01   +7.832295436211840e-01   +4.193041266848851e-02   +6.768957225196511e-01   +5.269645248673722e-01   +8.061106824338091e-02   +4.147931827335090e-01   +8.455451891284772e-01   +2.689555100197663e-01   +9.348828049737140e-01   +4.524403094467720e-02   +9.047821925525036e-01   +8.104180402752199e-01   +6.176639365057910e-01];
L2E_L1E_iAMPA_netcon = [+3.420789049151672e-01   +7.583981013145694e-01   +5.899729373777204e-01   +5.012518711482730e-01   +8.493590347522799e-02   +4.773854438023314e-02   +9.236555972140930e-01   +4.756619469395186e-01; +9.367316392703317e-01   +4.143873052767358e-01   +6.609875421488161e-01   +4.889557624682435e-01   +9.742896946588104e-01   +3.436168661539544e-01   +8.008214842056086e-01   +3.635994719030728e-01; +1.234870844139616e-01   +4.942144156495676e-01   +4.776721288624813e-02   +8.780733097061362e-01   +6.512293081031935e-01   +7.379586173697366e-01   +2.861104695709193e-01   +7.881611767356088e-01; +7.318685107788293e-01   +6.961499211421928e-01   +3.486284922740047e-01   +3.514084304122258e-01   +2.309847688713483e-01   +7.952104011030656e-01   +5.444091416505539e-01   +7.801113005849919e-01; +6.470279725322569e-01   +9.743312436131573e-01   +4.489871944569765e-01   +4.485260384205965e-01   +4.029663248447935e-01   +5.446205728202824e-01   +9.845380994898077e-01   +6.684142040545725e-01; +8.336377434621340e-01   +3.275903347814211e-01   +2.392147128111725e-01   +9.645552342527215e-01   +1.210560991374636e-01   +6.874976353811910e-01   +7.152680826280712e-01   +1.337436286001016e-01; +3.970312638564470e-01   +8.369652818256705e-01   +7.150845089910719e-01   +4.274353021800800e-02   +2.678978691769605e-01   +8.953884057637983e-01   +8.383027809706038e-01   +2.041354894407302e-02; +7.500959619586480e-01   +7.396973697261682e-01   +8.573080951578995e-01   +9.741539244009439e-01   +2.555327436199487e-01   +5.405883122288721e-02   +4.337516957419437e-01   +5.598132177642743e-01; +8.353669095151464e-01   +9.538843178977401e-01   +2.830589812704764e-01   +1.878284080202376e-01   +3.328736683106560e-01   +3.038243529022776e-01   +4.711145059416212e-01   +3.008845667152192e-01; +3.242812811129386e-01   +3.314059399193656e-02   +7.315184426801534e-01   +6.653416408312804e-01   +1.494556689967545e-01   +4.533720948727156e-02   +5.611611338811581e-01   +9.391341891682650e-01; +5.515899764536858e-01   +3.550699204484190e-01   +1.397175884994521e-01   +5.878439038290350e-01   +3.468375076637227e-01   +1.954399614918922e-01   +2.700118867381645e-01   +9.819958706077091e-01; +9.814547693790950e-01   +6.620997158086809e-01   +8.388436979082488e-01   +6.755281731265279e-01   +1.204673435426728e-01   +7.185174723043956e-01   +7.482574663414042e-01   +2.859918092103887e-01; +5.490212226323563e-01   +2.817277026454709e-01   +1.389791669576714e-01   +3.592500608119167e-01   +8.833019444254808e-01   +7.226316154019055e-01   +5.048154260988660e-01   +8.000867671493097e-01; +3.311421458119620e-01   +2.310399724227871e-01   +5.870298242611808e-01   +6.196993924291254e-01   +9.509090790565138e-02   +8.774652291537507e-01   +6.470364098758938e-01   +8.950807237632459e-01; +6.193009758840021e-01   +7.102854949426975e-01   +3.667474960669854e-01   +8.110052288520224e-01   +9.312338382784483e-01   +5.810527084023577e-01   +3.072428980141446e-01   +5.984656358943519e-01; +3.615409834192115e-01   +6.234330357970145e-01   +8.055404289456524e-01   +1.957143330601327e-02   +4.000174299158034e-01   +7.211013850920468e-02   +1.390223741283289e-01   +8.840513270488927e-01];
L1E_L2E_iAMPA_netcon = [+9.429904379299388e-01   +3.731149700726120e-01   +6.682486757632417e-01   +4.852938296252636e-01   +2.471231685026367e-01   +4.524618008781066e-01   +1.237799770020808e-01   +4.968815863767671e-01   +8.826542132959418e-01   +3.250994918700765e-01   +5.148931097340155e-01   +8.639128872441622e-02   +6.319310359421880e-01   +4.288506746527757e-01   +6.127092373972767e-01   +5.034529764305948e-01; +5.484581388687568e-01   +9.360071033991588e-01   +2.081887405368361e-01   +7.570785613040310e-01   +7.843995379097687e-01   +2.060531925707729e-01   +4.064602983135991e-01   +6.931766893642114e-01   +7.203490426552824e-01   +2.462874821313975e-01   +6.577772443695584e-01   +1.632414856924721e-01   +8.583397604563732e-01   +4.921791307968106e-01   +8.206263486126081e-01   +6.121680662678448e-01; +7.285727795567969e-01   +8.286145703846673e-01   +6.536752802553373e-01   +4.162598844433496e-01   +8.826329160315874e-01   +8.985074631043066e-01   +2.753791326478603e-01   +8.338781345982550e-01   +1.860557371823162e-02   +3.424523694870572e-01   +9.512318025355837e-01   +3.244625317127212e-01   +9.758324620665183e-01   +7.127417928066010e-02   +8.867371526238623e-01   +8.196847330965903e-01; +5.771893237861883e-01   +8.507256557366879e-01   +7.204982510562126e-02   +9.720143129575030e-01   +9.126018035005722e-01   +7.630581560175235e-01   +7.172736552799622e-01   +6.118047968059594e-01   +6.746796288384805e-01   +3.757267410058548e-01   +7.225380420809336e-01   +3.010835188636234e-01   +5.698598779591020e-01   +8.875076489320659e-01   +9.303080710560963e-01   +5.332062404546187e-01; +2.581254157325780e-02   +3.719367946300787e-01   +4.067284965943381e-01   +9.898816242451844e-01   +5.585343479011168e-01   +8.836528138192435e-01   +2.824026420586390e-01   +5.750027951428355e-01   +4.388475640377970e-01   +5.458503100978408e-01   +3.994988716837970e-01   +1.123777846714020e-02   +9.964727957263736e-01   +6.477673499178159e-02   +1.920298417622325e-01   +2.026191432285679e-01; +4.472235921153203e-01   +5.929874322283966e-01   +6.664991747015612e-01   +8.638474398329281e-01   +5.986130981954120e-01   +2.866363403012684e-01   +8.953947260725664e-01   +3.245088039858699e-01   +4.362495323576356e-01   +5.630847874003159e-01   +8.342456168316011e-01   +5.409684605429815e-01   +5.537211999796475e-01   +4.362023528936905e-01   +2.575470449205427e-01   +4.542517218319609e-01; +6.480204642877989e-01   +8.743479593593411e-01   +9.360660813236582e-01   +3.879413757679701e-01   +1.481911215540457e-01   +6.705391585212270e-01   +8.265818988706370e-01   +4.558615574133476e-01   +1.159069694703860e-01   +3.954981419839289e-01   +1.354011323909892e-01   +9.652937521558114e-02   +5.152892648391056e-01   +8.250939000435022e-01   +8.970522864667096e-01   +4.286201509169599e-01; +5.220927014880823e-01   +9.336935638504310e-01   +8.094729320917904e-01   +4.531072719172397e-01   +9.017630740771054e-01   +6.639717840217298e-01   +3.898094509057833e-01   +7.140201248217916e-01   +8.145739114397014e-01   +3.970124859707979e-01   +6.033141073505598e-02   +1.467443100396695e-01   +3.314866379511487e-01   +3.922899355773811e-01   +5.935386875455539e-01   +9.653371814522052e-01];
L2I_L2E_iAMPA_netcon = [+6.190155724424441e-01   +6.960608708390393e-01   +7.341052666523096e-01   +5.904071318806897e-01   +6.697189147194718e-01   +5.503881588409890e-02   +9.897040714634349e-02   +8.481638084338601e-01; +6.973472210374263e-01   +4.261375827472969e-01   +4.299687050153822e-01   +4.588402342620018e-01   +5.004302644944041e-01   +1.535115231949705e-01   +9.082573072107205e-01   +9.174090853290222e-01; +7.213729187960325e-01   +8.366291349894669e-01   +6.932866679790238e-01   +5.180276036656994e-02   +2.201061448913125e-01   +1.999256148251363e-02   +1.105031043020658e-01   +9.864644454873875e-01; +3.473971326745359e-01   +7.304795540402140e-01   +9.450459851632200e-01   +2.287017014502216e-01   +5.718466206354231e-01   +4.350454797805673e-01   +5.184371192183542e-01   +5.043599781033240e-01; +5.169444177479774e-01   +3.601766519932675e-01   +7.846013193902648e-01   +8.341199226362960e-01   +1.222519193457937e-01   +8.313816871163807e-01   +1.425575034202052e-01   +2.712617159211249e-01; +5.571560294222416e-01   +4.540268622072883e-01   +7.048530503277984e-01   +1.550567429132211e-02   +6.708857570634250e-01   +6.175045711967379e-01   +5.594751938998649e-01   +1.016088666859223e-01; +1.580814894178194e-01   +3.881737858446118e-01   +1.097540495092086e-01   +8.640276440521468e-01   +5.992419858202961e-01   +5.196747876658820e-01   +4.610638996616283e-03   +5.080454498353529e-01; +5.636682075743730e-01   +7.746689272539737e-01   +3.897959614769047e-01   +7.930639179018335e-02   +5.620231278933360e-02   +8.638511597906455e-01   +7.682581923285653e-01   +5.846418235321511e-01];
L2E_L2I_iGABA_netcon = [+7.644458901008344e-01   +9.412991146480395e-01   +2.384323826691073e-01   +8.336462485598871e-01   +2.574969394022161e-01   +7.552744131852593e-02   +1.738282799430128e-01   +5.234848792196770e-01; +8.271397006947251e-02   +6.565259192225291e-01   +5.785591959009452e-01   +4.021480976341959e-01   +2.984288039333627e-01   +3.939800895531523e-01   +1.402784860593390e-01   +2.641240050498960e-01; +6.597990168099582e-01   +4.524480052446930e-01   +8.658392507179250e-01   +3.908143232934423e-01   +4.246903257757295e-01   +4.138927696194935e-03   +5.979456910184544e-01   +6.848416523183883e-02; +5.171997595304509e-01   +8.395685829527307e-01   +4.050298485614898e-01   +3.624800039888338e-01   +1.177086997534784e-01   +2.200252394408818e-01   +8.996833067989163e-01   +4.361484058276712e-01; +1.719187141678585e-01   +5.333589473075978e-01   +1.117578803493207e-01   +1.377593755563523e-01   +4.973045587274967e-01   +1.047277177318418e-03   +9.386637244538117e-01   +1.730970223255156e-01; +9.403350464587946e-01   +5.537080722860955e-01   +4.437194845858162e-01   +2.574605063518822e-01   +7.070586643413088e-01   +1.898985337221726e-01   +2.205249805420172e-01   +2.645395959794658e-02; +5.911663296029948e-01   +6.806336791299569e-01   +2.981284004078365e-01   +8.606012937231293e-02   +2.441517882359723e-01   +1.420511529676338e-01   +4.808923547726515e-01   +9.537453530432122e-01; +4.401472918975197e-01   +3.676570321669591e-01   +4.013666045341569e-01   +4.296508086263791e-01   +7.847399528028562e-01   +2.680859385474857e-01   +3.776745061277744e-01   +4.308369190309763e-01];
L3E_L2E_iAMPA_netcon = [+9.618030747493233e-01   +7.729390579043062e-01   +9.117360656694776e-01   +5.311664627806145e-01   +4.837698002602862e-02   +8.192307817965818e-01   +6.251814201788043e-01   +7.481614222018089e-01   +6.735776431585804e-01   +9.051359795091157e-01   +5.817746078556053e-01   +5.923629414584222e-02; +7.624741997619834e-01   +2.274524340185990e-01   +9.071885407737981e-01   +7.161242947627573e-01   +5.525186789077254e-01   +7.272778769555448e-01   +5.424919629920529e-01   +6.459188955755012e-01   +4.317731123099999e-01   +3.934099680142807e-01   +6.864965653941524e-01   +9.802831615814543e-01; +7.959105962902084e-03   +3.700364495985817e-01   +5.911331978944001e-01   +1.802801908446473e-01   +2.744371006177708e-01   +1.773126202020043e-01   +4.371764976017776e-01   +1.216843993445649e-01   +6.921667599421208e-01   +2.477089074492871e-02   +7.210227202506169e-01   +2.841899793103312e-01; +6.799421685808469e-01   +8.923649963824045e-01   +3.312165090952660e-01   +3.351565259988006e-01   +2.437106335599318e-01   +3.603003574569448e-01   +2.870432044650192e-01   +5.053221258180638e-01   +2.570981097847820e-01   +6.699891230623797e-01   +6.490220674986070e-01   +5.929477175039558e-01; +7.051108633670325e-01   +8.564828321623088e-01   +8.535169592962933e-01   +1.875148391523920e-01   +2.431115672724873e-01   +1.864832664153242e-01   +5.006410948056256e-01   +3.478629964312752e-01   +1.242972544966439e-02   +8.377628393348062e-01   +7.252387069746483e-01   +9.611104024605616e-01; +6.449282549655179e-01   +4.006846234745323e-01   +4.430568417980532e-01   +3.207895421254028e-01   +1.543748883999553e-01   +7.267049279187396e-04   +7.623255255295529e-01   +9.048532788241455e-02   +5.314111746881248e-01   +9.713191869754025e-01   +3.748514735998715e-01   +1.866371109996021e-01; +5.539300846333979e-01   +3.186025107246668e-01   +9.016192651108338e-01   +4.045389199791156e-01   +9.577635153815452e-01   +3.141471261012644e-01   +7.617074131155415e-01   +1.479113889767261e-01   +2.800819136875853e-01   +5.645064206972740e-02   +5.798482051296219e-01   +1.929419535718519e-01; +2.177585666947508e-01   +6.089781400060313e-01   +3.428207560751943e-02   +5.480904479528614e-01   +9.358009473273036e-01   +6.985715333358977e-01   +5.774063830691955e-01   +1.997104492355109e-01   +9.459664127094058e-01   +4.504180800680628e-01   +1.144241608538011e-01   +3.405708787156841e-01];
L3I_L2I_iGABA_netcon = [+9.333677932374475e-01   +9.287673599282735e-02   +6.258976258530011e-02   +2.789750977087466e-01   +2.538603000638244e-01   +4.042420964099922e-01   +5.290951430064965e-01   +1.083168345221602e-01   +9.120185256386640e-01   +5.837002059456213e-01   +2.085383942095779e-01   +9.080136613746781e-01; +3.910840833851647e-01   +6.169049867598208e-01   +4.950446742839741e-01   +7.456733359695452e-01   +8.574063645990597e-01   +9.874262182029385e-01   +8.295459541338296e-01   +2.708702526669507e-01   +6.394820776396085e-01   +2.836175488491435e-01   +3.179144160775047e-01   +5.516136801703078e-01; +2.720251242010406e-01   +1.088341451793723e-02   +6.432573512566707e-01   +2.380135421820117e-01   +9.113987718202378e-01   +8.991998195308060e-02   +8.575475478081629e-01   +5.235017227375101e-01   +2.553487256711783e-01   +8.283556629254800e-01   +1.337353473214888e-01   +3.455373368495609e-02; +1.523694723814237e-01   +5.737850667363570e-01   +2.227807225254105e-01   +9.579576556885641e-01   +6.991770271359595e-01   +3.227862452721657e-01   +7.879683891797581e-01   +9.728163528781997e-01   +9.055906179895676e-02   +1.921281723937679e-01   +6.731622571530449e-01   +5.388535596810826e-02; +3.970652302349355e-01   +7.878645715612363e-01   +8.378322209482189e-01   +6.217151412626910e-01   +7.254891707301505e-01   +5.134304558002466e-01   +3.189440582711314e-01   +7.089490334014312e-01   +8.386202818496700e-01   +4.414898404915711e-01   +5.699051059046885e-01   +8.062500584293212e-01; +3.749461332182447e-01   +2.348927193336696e-01   +9.710113371321717e-01   +6.010167829020470e-01   +2.302548113580549e-01   +5.924244688520870e-02   +4.528845413007813e-01   +3.109385457299502e-01   +5.844625359162348e-01   +3.928301308561099e-01   +1.702079937169788e-01   +4.511316491372382e-01; +1.299322115596461e-01   +4.478564976970259e-01   +8.463235182531900e-01   +1.725495599682791e-01   +5.748465041302840e-01   +7.258627014355282e-01   +7.532733412967094e-01   +2.941095512135098e-01   +9.486891452367781e-01   +8.269409590666973e-01   +1.479258099418275e-01   +3.808438909752637e-01; +4.339791124282694e-01   +5.697141756876347e-01   +5.067578221008682e-01   +9.016292566249232e-02   +8.113084391266272e-01   +5.572032889291152e-01   +1.108283983627020e-01   +8.501268297501736e-01   +6.111785917815424e-02   +6.792094632559837e-01   +4.764570540869784e-01   +7.911166574486376e-01];
L2E_L3E_iAMPA_netcon = [+3.649445129321992e-01   +7.552775464502575e-01   +7.360577421553423e-02   +5.172933243957175e-01   +7.581842550850617e-01   +4.324036527598869e-01   +2.001031764897769e-01   +8.758923767198288e-01; +5.317207173330714e-01   +9.970600588290749e-01   +5.917471259824836e-01   +9.943582973076530e-01   +9.953521040695081e-01   +5.428434670239224e-01   +1.935140045865325e-01   +7.868004645753338e-01; +7.130526274354079e-01   +1.873043331494641e-01   +9.103786152897880e-01   +8.567801658309638e-01   +9.622826140732728e-01   +7.120137052333605e-01   +3.265776755696577e-01   +4.673679740644501e-01; +8.702400159261058e-01   +7.808928112706987e-01   +1.919205230748464e-01   +9.609649292453202e-01   +5.360202773718376e-01   +1.551129204552779e-02   +8.804825630459540e-01   +8.135352095340784e-01; +3.288757950165223e-01   +1.961669687295048e-01   +4.316435156957041e-01   +6.784160755126554e-01   +9.658380039360064e-01   +8.018042693936794e-01   +4.718166483685990e-01   +8.962781320074633e-01; +6.495857321843325e-01   +9.919320864092025e-01   +7.494085749915427e-01   +4.028124107149653e-01   +1.166696169440707e-01   +1.423439197562648e-01   +4.039573576466951e-01   +4.280473336023997e-01; +9.762474378584257e-01   +8.012322434574143e-01   +4.055551585833248e-02   +9.341214300140807e-01   +5.017328470561946e-02   +4.790130415102170e-01   +1.805812236843259e-01   +3.341836218938248e-01; +7.655372526412833e-02   +4.241825922316015e-01   +9.457829802210808e-01   +4.796963621815819e-01   +3.034986446721575e-01   +2.556218579797150e-01   +9.696584398635418e-01   +5.958448628512750e-01; +5.883978751678289e-01   +7.287826696177995e-01   +7.636297597920589e-01   +2.297903889513205e-01   +5.816282062614112e-01   +3.687141101825943e-01   +4.089705056883596e-01   +9.015239255364346e-01; +4.125325496661999e-01   +4.980386840074562e-01   +5.570573051898563e-01   +3.964841639529237e-01   +5.325342602094048e-01   +6.610177642890970e-01   +8.443744883607730e-01   +7.022116204080580e-01; +3.082965289603595e-01   +8.087123732310515e-01   +1.833400744759334e-01   +7.042588817912825e-01   +9.001290502233894e-01   +1.680087998127538e-01   +6.167423844027456e-01   +3.787179953102676e-01; +2.635020527562735e-01   +3.566107971194272e-01   +5.001509392718655e-01   +5.592050424639402e-01   +5.408770812838577e-01   +2.800280428484371e-01   +3.741169446603207e-01   +7.351910964593157e-01];
L2I_L3I_iGABA_netcon = [+9.546200776639607e-01   +3.106413766390258e-02   +9.117564259810267e-02   +4.593933470650813e-01   +3.272316799080607e-01   +3.674708878317759e-01   +6.851438078096463e-01   +8.049077100862368e-01; +5.423593406932706e-01   +2.082003231489289e-01   +5.937320166271020e-01   +6.388976875137792e-01   +8.046622908892125e-01   +2.096114918755489e-01   +9.092063455173728e-01   +6.632717388559509e-02; +5.385820053411176e-01   +4.548363514937689e-01   +2.409525693614901e-01   +9.163925731036461e-01   +9.994489672357203e-01   +4.405111191979367e-01   +6.109559631053850e-01   +9.487999560951674e-01; +3.092856840671560e-01   +1.266073075124613e-01   +8.389929954818551e-01   +1.608552725104058e-01   +9.795047184518970e-01   +9.549155563600262e-01   +8.998089422750974e-01   +4.952523588993849e-01; +7.006280637476042e-02   +9.187790316182543e-03   +8.570604411631955e-01   +7.135826538303200e-01   +1.258005827707790e-01   +1.237575123962931e-01   +1.944383691573404e-01   +7.541502123487579e-01; +1.821081214461063e-01   +7.268857415179587e-01   +9.613614868741057e-01   +5.769183759069063e-01   +2.303569964513516e-01   +4.694247487018171e-01   +7.533616154358030e-01   +7.400774192847313e-01; +9.235169618548442e-02   +3.535810338725484e-01   +4.884353889474398e-01   +4.321751072411706e-01   +2.337044045150112e-02   +8.551663384933479e-01   +3.477118822972189e-01   +8.304472972983373e-01; +4.641243410933092e-01   +7.786192526950032e-01   +2.187049250714569e-01   +8.831927323660359e-01   +6.079317723751886e-01   +4.222746085614809e-02   +4.191440506772840e-01   +1.558757024233018e-01; +9.357948373450324e-03   +4.362583757831056e-01   +2.269676622542703e-01   +3.907440096113738e-01   +1.094736805414033e-01   +6.897005754360362e-01   +1.535126173010730e-01   +4.564320173836577e-01; +9.145192985891895e-01   +4.365916934495245e-01   +5.364987162079704e-01   +1.772756295008067e-01   +4.064782950099834e-01   +9.776262223208447e-01   +8.191928158194525e-01   +6.186472742584113e-01; +6.422917677519868e-01   +5.025628957761635e-02   +7.615163950599023e-01   +6.314410721159678e-01   +8.830704710189272e-01   +2.835177344566508e-01   +6.227625604869521e-01   +9.295753700799496e-01; -2.090809639245708e-04   +4.782674945771428e-02   +3.467832503580823e-01   +6.236122069704981e-01   +5.478640985964163e-01   +1.339788504141805e-01   +7.402351140221705e-01   +8.336964786108518e-01];
L3I_L3E_iAMPA_netcon = [+8.941543005658296e-01   +2.553325593100941e-01   +7.401045428023501e-01   +6.820469179287604e-01   +6.013217188904975e-01   +7.485808303671403e-01   +7.460782955752213e-01   +2.229872581374547e-01   +4.543071332594694e-02   +8.003590566466134e-01   +2.910157762620123e-01   +8.026172226096430e-01; +5.820277098356196e-01   +3.229372562094802e-01   +6.933707899720245e-01   +2.362048930741675e-01   +8.556326067888224e-01   +5.431733266095421e-01   +1.273536499820211e-01   +3.515160784228694e-01   +2.137266071907501e-01   +2.332204072729558e-01   +4.036371044274072e-01   +1.035567948413553e-01; +5.833810501281641e-01   +4.019006255218619e-01   +8.227665864361257e-01   +4.553699602093734e-01   +9.897382290107656e-01   +3.397902692518987e-01   +8.222570613941783e-01   +2.863211400226653e-01   +3.965970487033104e-01   +9.304316817749009e-01   +8.633278529276512e-01   +8.204046937671572e-01; +8.550657438601782e-01   +4.051524487844743e-01   +8.292887811513410e-01   +3.835733708536296e-01   +9.296830684404861e-01   +8.321624371379074e-01   +2.609325752059825e-02   +9.264824043373858e-01   +3.342305730796808e-01   +7.631777853693534e-01   +6.147650007742858e-01   +8.407804789242603e-01; +3.357044405055864e-02   +3.868190552279678e-01   +2.950267701026107e-01   +5.383897422111968e-01   +4.107446100287065e-01   +5.512070659442503e-01   +4.162536227330502e-01   +5.074379740101867e-02   +2.284694511907518e-01   +8.279834896244976e-01   +9.902632490414464e-01   +3.557985268970434e-01; +8.841798738012498e-01   +6.092654031928324e-01   +3.092313704877028e-01   +9.911170657210008e-01   +9.718342741315057e-04   +9.573398939737897e-01   +7.306766659819056e-01   +5.925067827712522e-01   +9.351337438160880e-01   +5.730400261391276e-01   +2.034843462698898e-01   +4.292533499136683e-01; +4.067735020789701e-01   +1.651740784515523e-01   +5.241868140806033e-01   +7.549611900701676e-01   +5.420880124197006e-01   +8.928526675994632e-01   +7.815903840376996e-01   +1.617628428496274e-01   +6.812466743205763e-01   +7.929647359685402e-01   +8.283150092883633e-01   +5.701463084402698e-01; +3.629519132048042e-02   +1.896334062838236e-01   +3.269081081233310e-01   +9.810328412425732e-01   +2.082443147182365e-01   +3.579882399990558e-01   +3.679054316575278e-01   +8.369960209360447e-01   +9.632455437077196e-01   +3.296292620241319e-01   +6.765608378832186e-01   +6.995244386089469e-01; +7.464353192869863e-01   +9.640584221531978e-02   +8.338584323048714e-01   +2.350433869207712e-01   +2.191818100345892e-01   +5.481205157123985e-01   +7.463351934150378e-01   +1.674403519944479e-01   +4.388480334038490e-01   +2.236812937077065e-01   +2.485493561782279e-01   +7.428644676614401e-01; +1.559901212845713e-01   +3.220462700825049e-01   +8.087551519408828e-01   +5.291583250543843e-01   +3.281105319548304e-01   +3.464288993569485e-01   +8.927416009663444e-01   +5.013327886370900e-01   +9.390398714719377e-01   +3.115105069456521e-01   +4.772752546502071e-01   +7.576947570338941e-01; +1.450568109873550e-01   +7.703769782726902e-01   +5.591868556715500e-01   +5.397702207848235e-02   +9.554124245412826e-02   +6.229949927597479e-01   +2.445231652275066e-01   +9.988006451452394e-01   +6.012114702983280e-03   +5.845306663641179e-01   +3.995315941614717e-01   +3.896552642490347e-01; +6.060159766594831e-01   +2.350447918351633e-01   +2.635113136054479e-01   +7.575985167022151e-01   +7.497378570887236e-01   +7.981812865784648e-01   +1.296532939698420e-01   +3.548011882069622e-01   +6.103005512704538e-01   +8.296538353482479e-01   +5.992794174003725e-01   +4.268591693115144e-01];
L3E_L3I_iGABA_netcon = [+9.557602941363749e-01   +8.844761294957740e-01   +8.002069427266991e-01   +9.853861391113978e-01   +9.020222011546063e-01   +9.621324519879414e-01   +6.532669516466282e-01   +4.957754029548118e-02   +1.084730135632305e-01   +4.522048198254267e-01   +8.290923857400366e-01   +5.811966364276678e-01; +5.726433889509631e-01   +4.375721259107109e-01   +9.862080803098436e-01   +5.604674791521939e-01   +9.947967049717835e-01   +5.425680678442095e-01   +6.544619656921642e-02   +4.667142630475581e-01   +4.615981338477433e-01   +3.344045583231364e-01   +6.265347098068864e-01   +6.365629515704880e-01; +8.504063376397621e-01   +7.820070482617533e-01   +1.589100398136329e-01   +9.326166298674786e-01   +6.519513474859332e-01   +3.134547673191757e-02   +2.751563719583530e-01   +3.244072624732256e-01   +4.507221795183512e-01   +5.914883034785686e-02   +5.397912568681290e-01   +6.507785928949917e-01; +2.764423728111043e-01   +1.493630289730949e-01   +2.373976537789448e-01   +7.205921216454203e-01   +1.073708246436701e-01   +6.956728360601977e-01   +2.815132506340146e-01   +6.308313334536622e-01   +5.507012585855444e-01   +7.403442449578572e-01   +6.501484890564954e-01   +8.630200808241881e-01; +6.223273221980904e-01   +6.200612613481461e-01   +7.018424504513245e-01   +4.847354840811536e-01   +3.735332936438185e-02   +5.198490727338392e-01   +8.790987620731342e-01   +2.294483533482272e-01   +8.065348082527313e-01   +5.060643675604235e-01   +7.262027888225581e-01   +5.654763502503789e-02; +5.898877452199547e-01   +2.601328853228289e-01   +3.775021738583289e-01   +6.394622146584273e-01   +6.189355116929046e-01   +6.028190549117719e-02   +4.447504958881020e-01   +5.803843599440935e-01   +7.012759012018422e-01   +2.016000197243445e-01   +9.421420266944515e-02   +8.187683789514493e-01; +9.642589562817588e-01   +4.449073171885559e-01   +9.749999881420139e-01   +8.875286224649401e-01   +5.656639862323730e-01   +8.890964225936383e-01   +7.578565336989977e-01   +6.038598865701894e-01   +8.723892324774615e-01   +4.266039912340112e-01   +8.788239941925816e-01   +5.289175051272110e-01; +8.693020210117476e-02   +8.450228823619230e-01   +9.705683065202566e-01   +1.975454387283447e-01   +9.619528375889663e-01   +3.304381164959080e-01   +6.015119927980910e-01   +5.995871593932239e-01   +5.223199204997241e-02   +1.677564288591286e-01   +1.253775739808656e-02   +6.952048355712932e-01; +5.014158030074138e-01   +1.979235270299777e-01   +6.421733861333396e-01   +3.963427443954035e-01   +7.472600015568581e-01   +2.286869465764557e-01   +7.829835546041257e-01   +4.479349964539396e-01   +2.192527186376031e-01   +7.513923421401784e-01   +2.922108876176095e-01   +2.123219299290980e-01; +5.216571850599847e-01   +3.032686136437264e-01   +8.601141007808567e-01   +9.918977012328635e-01   +6.628144253561022e-01   +1.140888267963428e-01   +1.143991399379283e-01   +3.400326236323267e-02   +4.586282724486069e-01   +3.668919419270013e-01   +1.795703862620140e-01   +5.438994083142927e-01; +9.066934928712564e-02   +4.804158353996987e-01   +4.017761165561803e-01   +4.012761445322335e-01   +5.240355923104383e-01   +3.119488292627492e-01   +9.775962430691919e-01   +5.126545065708834e-01   +9.588921571917105e-01   +9.421780444611746e-01   +9.265397149234811e-01   +7.040142885967072e-01; +9.067110589768831e-01   +3.373618390156235e-01   +6.314793412005676e-01   +6.591219247491332e-01   +2.594482202484601e-01   +2.268659523775784e-01   +8.490359967018348e-01   +4.068093492823480e-01   +7.922003318042811e-01   +1.551176286821428e-02   +6.884233790653468e-02   +9.552371399939593e-01];
L2E_Input1_iAMPA_netcon = [+9.967988900994804e-01   +1.000000000000000e+00   +9.982320337552114e-01   +9.990219496059629e-01   +9.968315088283050e-01   +9.968310067284792e-01   +9.978353829397077e-01   +9.965321971160893e-01];
L2I_Input2_iAMPA_netcon = [+9.985191317951215e-01   +9.983636668612732e-01   +9.987512091082219e-01   +9.991175137917612e-01   +9.984690025669423e-01   +9.973825802040552e-01   +1.000000000000000e+00   +9.980702511643669e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
