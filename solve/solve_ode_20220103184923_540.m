function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.147693406259642e-01   +9.462537301515773e-01   +6.992640707561588e-01   +1.554820934500972e-01   +9.217738362895910e-01   +2.195168591278417e-01   +7.404436253728381e-01   +3.018563560328408e-01   +5.327356212980722e-01   +8.294798639588319e-01   +9.688605559060439e-01   +9.644217277109920e-01   +6.958457370633421e-01   +3.712418170434992e-01   +2.974233662978103e-01   +3.787035380702403e-01; +3.447685315442509e-01   +1.360077286456139e-02   +1.413787407069579e-01   +1.751824592806290e-01   +7.158833031846785e-02   +8.072410082817844e-01   +7.949227971355350e-01   +7.579861534637042e-01   +7.844902921314072e-01   +1.815005154852635e-01   +4.661963905428704e-01   +6.563501127609208e-01   +3.755773956965985e-01   +2.749079954113798e-01   +6.854581696327566e-01   +9.532090182567634e-01; +2.079091693980889e-01   +4.674808558135345e-01   +8.355404611193029e-02   +7.033817054120443e-01   +3.141384911687431e-01   +3.823342846541480e-01   +6.637044392706318e-01   +9.526690101399558e-01   +4.879003730262270e-02   +9.266041711067591e-01   +8.695089661362947e-01   +2.090882195022362e-01   +5.413983940301342e-01   +7.527849683819605e-02   +7.723734858902062e-01   +8.114085120238721e-01; +2.504844661550667e-02   +4.897617592313736e-01   +4.330219708171572e-01   +8.318133737562402e-01   +6.273548989365010e-01   +8.564604159772686e-01   +4.420809324561792e-01   +8.185999439365299e-03   +4.628259089531199e-01   +4.205199661639294e-01   +9.459386278930770e-01   +8.977538674408514e-01   +5.181000893304651e-01   +1.510870056433125e-01   +7.204962236279211e-01   +8.914450658754181e-01; +7.658124084267213e-01   +5.155238768634639e-01   +8.948316034226131e-01   +8.155444426247664e-02   +9.053191361266070e-01   +3.243028603225279e-01   +5.749474712849535e-01   +4.074254845203113e-01   +9.382817414675088e-01   +3.011025036777163e-01   +2.325282039905991e-01   +4.880025512892607e-01   +7.639981683872332e-01   +3.648966466610377e-01   +2.785353886166977e-01   +6.811734628130611e-02; +5.709076683205948e-01   +2.872528878474612e-01   +7.323276109908952e-01   +8.353683627425779e-01   +7.969880351516276e-01   +3.791858352409473e-01   +5.179254964961348e-01   +1.510627557250536e-01   +4.725406288020824e-01   +3.484630723338381e-01   +9.184916718797207e-01   +6.613694320414201e-01   +7.966072612844989e-02   +7.183110681958427e-01   +1.363482899199275e-02   +9.030622159896092e-01; +5.764278548214675e-01   +5.646968966256164e-01   +6.800905718273452e-01   +5.409583562192334e-01   +6.428421648720328e-01   +6.371779082013010e-01   +7.246608405129766e-01   +8.211192108613060e-01   +7.789410260394183e-01   +9.723718880539063e-01   +6.348609599263245e-01   +5.262093870450321e-01   +5.109840879180276e-03   +5.327669979083276e-01   +1.481125247508492e-02   +6.680573833939850e-01; +3.907061952439492e-01   +5.098342891535271e-01   +2.010505734261293e-01   +9.627202556826377e-01   +4.403594885322171e-01   +3.880952697191160e-01   +2.227311592378328e-01   +2.875223214141003e-01   +1.093003371172765e-01   +5.309586666850862e-01   +2.836115083293949e-01   +7.083683421871425e-01   +4.001989586881332e-01   +2.325919069828158e-01   +9.367798217681274e-01   +3.468756568280284e-01; +5.564858926682684e-01   +6.782535044343198e-01   +5.293649566413892e-01   +6.774933890853088e-01   +7.480319628025823e-01   +6.717154211403735e-02   +9.980216166052446e-01   +9.784433911952145e-01   +5.226196237718040e-01   +7.902737738129035e-01   +8.551785928138655e-01   +7.187838147130938e-01   +6.620351475951549e-01   +4.706128907320472e-01   +9.336553761613523e-01   +8.365961089778825e-01; +1.834999547873488e-01   +6.154900278484835e-01   +8.301181963121620e-01   +3.366065405222783e-01   +8.253894949405385e-01   +1.687524918780696e-02   +6.202545771432955e-01   +6.253351333089958e-01   +6.363547836419933e-01   +7.934584963427331e-01   +1.656267126072652e-01   +2.949996599628140e-01   +3.679440003891443e-01   +7.170410605696041e-01   +3.743038838210205e-01   +1.989046802569734e-01; +1.185137242516820e-01   +5.652664048868292e-01   +1.746830269740305e-01   +2.208121685465946e-01   +3.410567128956516e-01   +8.792246406692654e-01   +9.798460798759284e-01   +7.439518887009258e-01   +5.783723124430536e-01   +1.453130889013797e-01   +8.285073040672188e-01   +1.168788436148440e-01   +3.919937905828991e-01   +5.143821060254106e-01   +1.092159154846630e-01   +8.419555185405603e-01; +5.855450714147214e-02   +5.046398168360450e-01   +5.187085186651614e-01   +5.694257404830739e-01   +1.396132336319262e-01   +1.574539316414462e-01   +4.950884632277993e-01   +8.729601866564314e-01   +8.351115432617718e-01   +4.559322782715436e-01   +2.167986649810799e-01   +3.250648270585437e-01   +1.345496486194588e-01   +5.144514791094886e-01   +7.193487717198446e-01   +4.253830665494309e-01; +9.327305715543112e-01   +6.680299960380779e-01   +3.556112892363432e-01   -2.350041091823232e-04   +5.037683668964592e-01   +9.141937489925416e-01   +5.232299518176839e-01   +3.289167394327704e-01   +1.158515412149476e-01   +4.585429374332622e-01   +2.682834956471470e-01   +4.566129531369508e-01   +3.382787049278088e-01   +3.857259068392557e-01   +4.493233054643973e-01   +5.587477909849428e-01; +7.454319551815397e-01   +6.327818500917910e-01   +6.446463357321399e-01   +5.886131530333308e-01   +4.135626311642766e-01   +5.558355499224297e-01   +8.550354226600045e-01   +9.885456796432848e-02   +5.248189250208300e-02   +9.537854027557766e-01   +8.631380988077834e-02   +7.171279260978056e-01   +1.221437731619584e-01   +4.797275350112780e-01   +1.243168541665782e-02   +4.482734881014154e-01; +2.428416077997451e-01   +1.454190704943484e-01   +2.821564809481972e-01   +8.913644687877963e-01   +1.716629886213641e-01   +9.222040087918578e-01   +2.537721237574174e-01   +4.507101149650077e-01   +5.173029275022978e-01   +5.368243395522199e-02   +9.163075537200581e-01   +4.050923952257948e-01   +3.691926250720604e-01   +7.398777009649061e-01   +1.239633577949815e-01   +7.599075783086514e-01; +2.041971927476934e-01   +1.791725073740196e-01   +4.369116422637616e-01   +2.546327095513213e-01   +4.940890155027107e-01   +5.974253581035391e-01   +5.825725733892700e-01   +2.396492305803843e-01   +6.973277426272019e-01   +3.645138862127637e-02   +7.265735670275445e-01   +2.415711968460097e-01   +2.509112785029684e-01   +7.017870020024490e-01   +6.586818329039853e-01   +9.602543617097613e-02];
L1E_L1I_iGABA_netcon = [+8.437125320739662e-01   +7.529385325868865e-01   +8.743479982434156e-01   +4.354097960522329e-01   +9.178390724492603e-01   +7.792003200296054e-01   +3.218036774422248e-01   +6.412294171354902e-01   +9.409835014834231e-02   +2.642730556140340e-02   +1.292653260615586e-01   +5.205061349763825e-01   +8.699987899563573e-01   +5.762927157792214e-01   +1.655541357671874e-01   +6.271084574535578e-01; +6.215989156678714e-01   +9.951468401205917e-01   +3.089622983205524e-01   +1.471739721469252e-01   +8.829985873074436e-01   +2.729648202452322e-01   +9.631602211710335e-01   +4.292454374644112e-01   +2.926618189412398e-01   +5.146693110976112e-01   +4.247586252918883e-01   +2.038890990251771e-01   +8.030189160463391e-01   +2.881101729434083e-01   +5.481471483985612e-02   +3.364778312376709e-01; +6.717285001034583e-01   +3.708349491324360e-01   +4.337937167043424e-01   +6.542023805123143e-01   +5.858016490806046e-01   +5.266256833228629e-01   +3.528553571573966e-01   +4.779229199308179e-01   +3.258976598279790e-01   +8.630969500473920e-01   +4.807790594685569e-01   +7.752960113000740e-01   +6.466055746836317e-01   +1.319813485155613e-01   +2.109918137007961e-01   +1.562662768420393e-01; +7.818782035075755e-01   +5.019380720375798e-01   +3.814625643244179e-01   +7.213776342862643e-01   +8.351239604560480e-01   +4.030060077281013e-01   +3.198694635723244e-01   +1.005347759981508e-01   +4.829558781293772e-01   +5.810842348910440e-01   +6.737706756981079e-01   +3.910091727801844e-01   +7.345291986493733e-01   +4.947626374291637e-02   +2.043196045855255e-01   +4.021749593313823e-01; +3.091510598308526e-01   +7.586969419140172e-01   +6.566976596155529e-01   +1.616957058174346e-01   +7.763334407564091e-01   +7.787995413218683e-01   +9.082440894360331e-01   +8.075197416031126e-01   +2.419316259446709e-01   +4.223209180207304e-01   +3.574974193988593e-01   +6.691035792848389e-02   +6.673250839971643e-01   +6.244196496460671e-01   +2.174943279181509e-01   +9.130516809744741e-01; +3.305703915013783e-01   +1.270180480945292e-01   +2.370948270887739e-01   +3.425086312577627e-01   +7.845866386837548e-01   +2.561352100430306e-02   +8.848592658880909e-01   +6.502143924550108e-02   +4.539199179433442e-01   +7.134140101199935e-01   +5.049146517271999e-02   +7.558363751166315e-01   +8.810479521379405e-01   +6.061458633608758e-01   +5.781914104631044e-01   +1.487452202879246e-01; +6.339844710809888e-01   +5.180996392388880e-01   +6.857632734769485e-01   +1.066555439850408e-01   +7.012066644383753e-01   +4.121557372467683e-01   +3.520603329483581e-01   +9.543460260619463e-01   +7.585899602404292e-01   +2.336852064766226e-01   +2.905145375544471e-01   +4.531054254477098e-01   +8.528741026576344e-01   +3.713797781854691e-01   +3.335003108648351e-02   +4.639027922861541e-01; +9.016639895672637e-01   +9.062228118352881e-01   +3.266459976317573e-01   +4.095333373925947e-02   +1.862292051832543e-02   +8.261216461835322e-01   +7.499284859937519e-01   +7.729776060718794e-01   +7.187513576610046e-01   +5.866251797996228e-02   +7.941971791156138e-01   +3.188161223076373e-01   +4.037571881843915e-01   +8.320362693451815e-01   +7.952344563878783e-01   +7.890069053239510e-02; +3.714500229587119e-01   +9.903385986841698e-02   +8.813849909854621e-01   +4.783748527301097e-01   +3.304253414926964e-01   +5.925366607507265e-01   +1.264251009423648e-01   +4.402116318764003e-01   +2.375631198547295e-01   +9.765483411112221e-01   +6.517539137131318e-01   +2.778094341837579e-01   +1.056931439231688e-01   +5.197826651548754e-01   +1.344565417174767e-01   +3.423542723239432e-01; +8.815929056583368e-01   +1.792247800571533e-01   +9.989883790789567e-01   +4.769700824852554e-01   +9.480070591172727e-01   +2.131692423044735e-01   +5.991958468845749e-01   +1.658744178477078e-01   +6.996123643885384e-01   +9.697938413399826e-01   +7.101239331581307e-01   +5.836445569838109e-01   +4.031098610673090e-01   +8.006795215508504e-01   +5.822432748099730e-01   +4.969008682281982e-01; +1.245386034504685e-01   +1.728948335769927e-01   +6.807462838572683e-01   +5.461573276984351e-01   +3.988732014174604e-01   +2.961342468472434e-01   +4.367189836489940e-01   +8.104409629863871e-02   +3.050847172562098e-01   +1.367548169484190e-01   +7.654173081069605e-01   +9.117368817192411e-01   +3.407876719473027e-01   +5.705324748537484e-01   +8.573264148293459e-02   +4.892322910670812e-01; +8.880976428577225e-02   +5.339876120694423e-01   +3.447020353797666e-01   +6.511764775983361e-01   +6.323340871345503e-01   +2.677592994935964e-01   +9.592021132391404e-01   +7.422517692204794e-01   +4.702521478274113e-01   -5.881394455781651e-04   +3.835858049900973e-01   +4.507627414183485e-01   +1.143553443251350e-01   +7.148066508191508e-01   +2.291244633152189e-01   +1.277099159005660e-01; +5.460288040867303e-01   +9.794566814392397e-01   +5.606925475819444e-01   +3.489414108301239e-01   +8.591365797720144e-01   +9.284892588485270e-01   +9.643308263419498e-01   +5.439623202116605e-01   +4.442887329633309e-01   +9.365645042009861e-01   +3.619176867232053e-01   +9.802127466502770e-01   +8.518789980765260e-01   +7.329072063241847e-01   +4.517030855311285e-01   +8.576806035707764e-02; +6.107785323525458e-01   +8.435044696822290e-01   +8.906554397197904e-01   +2.561332852962096e-01   +3.770059402167117e-01   +5.527672579215672e-01   +2.425220648609586e-01   +4.859627704974667e-01   +7.341609743943532e-01   +7.411310117219039e-01   +8.100889946228141e-01   +1.108860987591882e-01   +8.926539044442694e-01   +4.548183702886282e-01   +1.785004062676938e-01   +6.738899664890821e-01; +7.275766821747833e-01   +6.728322662453751e-01   +6.466109040567188e-01   +1.764883905089664e-01   +2.045625365109573e-01   +4.323490224229494e-01   +7.704044704445663e-01   +8.958079739367979e-01   +8.763321336086898e-01   +4.323825905262060e-01   +3.861325229994063e-01   +4.157068075644590e-01   +6.857957030342866e-01   +2.834123937877354e-01   +4.139493498956624e-01   +1.220278348958305e-01; +9.918106062435622e-01   +9.324891538972264e-03   +3.771608477563190e-01   +4.785085671123582e-01   +9.118309036484119e-01   +3.277194744816425e-01   +7.126721227943904e-01   +5.826588519613329e-01   +9.136663805726631e-01   +9.440976488123420e-01   +8.715559527978926e-01   +3.830784218623759e-01   +7.431803406774427e-01   +1.513428314983991e-01   +9.651089627673813e-01   +9.890289828203158e-01];
L2I_L1I_iGABA_netcon = [+5.738760373405155e-01   +5.645398247144039e-01   +1.081411296996965e-01   +4.598225791068222e-01   +7.969771362132578e-01   +9.783086502316791e-01   +2.239850637969906e-01   +7.584634535506272e-01; +5.583548497959259e-01   +9.531952702135789e-01   +1.186711523219403e-01   +5.668005881046869e-01   +5.421932530073523e-01   +4.222751733555518e-01   +6.635786125931520e-02   +5.064884456309209e-01; +6.112047899460470e-01   +8.732062235904375e-03   +4.338699521419715e-01   +8.168421350357706e-01   +2.574250502837342e-01   +3.932079586886350e-01   +8.357394992013547e-01   +8.285290164074495e-01; +4.669262150274126e-01   +1.262061144361809e-01   +9.321170496970318e-01   +3.556817746390626e-01   +7.811499950421482e-01   +4.611168514814648e-01   +4.129219895882696e-02   +9.274880851341961e-01; +4.343405457074423e-01   +8.538219233540000e-01   +1.399530474878724e-01   +2.484048598338252e-01   +7.795019306412722e-01   +1.215844429632933e-01   +9.096796333642720e-01   +7.106733886122018e-01; +6.272739871106191e-02   +2.182051603002661e-01   +8.258912666650611e-01   +7.708912227750437e-01   +1.444151593245303e-01   +4.542079754071188e-01   +4.494424429586066e-01   +7.978136245609752e-01; +6.469518838421026e-01   +7.100719397068638e-01   +9.329496603897655e-01   +1.880172238850392e-03   +8.237104231769981e-01   +2.646632748323364e-01   +2.846289830164063e-01   +9.589036353953948e-01; +4.262165737706252e-01   +7.747826183308639e-01   +5.728846674269322e-01   +2.763535651543839e-01   +6.232972194199363e-01   +9.267618294560373e-02   +7.556701584550808e-01   +9.517316829470795e-01; +7.562800058248685e-01   +4.215348211309231e-01   +4.988071712722753e-01   +2.309032325839632e-02   +4.566107087896589e-01   +6.620809208334186e-01   +9.267944205905772e-01   +2.953984967380519e-01; +3.062682162805209e-01   +7.256201537198833e-01   +9.311773933374471e-01   +6.700021499001644e-01   +4.835605149150884e-01   +9.448638851820732e-01   +1.408762514186494e-01   +3.521854461501300e-01; +5.972104430452533e-01   +4.579677524279818e-01   +8.626568534746339e-01   +9.670703666252269e-01   +2.191332600457178e-01   +7.648989789416123e-01   +9.554807423709641e-01   +5.413773430030275e-01; +3.343749233075086e-01   +8.052350327520369e-01   +2.538833605491997e-01   +9.456923203487586e-01   +8.576547576568334e-01   +4.319643762480596e-02   +3.044577768150286e-01   +2.127354146785239e-01; +6.432167775857099e-01   +4.280140707412094e-01   +4.583502667860853e-01   +4.601520540019725e-02   +8.801320292943519e-01   +2.607152990203093e-01   +2.095087038658280e-01   +8.088815017437917e-02; +7.490176201279863e-04   +1.490456878270670e-01   +7.408739113735440e-01   +2.867082415677167e-01   +8.460100548794783e-01   +6.346565539709567e-01   +4.639675141034496e-01   +5.067291322935855e-01; +1.442262125111674e-01   +8.049997314280918e-01   +7.526302751129410e-01   +4.875685651339633e-01   +4.429949836259029e-01   +8.936315002278764e-02   +5.973972451089409e-01   +1.947859352525761e-01; +2.477270775060993e-01   +3.815742876612978e-01   +2.298081331451072e-01   +8.877671134534462e-01   +5.429353398659408e-01   +7.516180732453309e-02   +5.518598854983713e-01   +1.455706642312909e-01];
L1I_L2I_iGABA_netcon = [+6.989964436283623e-01   +8.670812625092719e-01   +6.141970225301492e-01   +5.520626790221349e-02   +1.433526010997898e-01   +2.343832430132783e-01   +8.383967067706375e-01   +3.705250342733184e-01   +7.068461142148414e-01   +3.840974123337242e-01   +2.396736387751557e-01   +6.667380101783335e-01   +1.684434300975611e-01   +5.694717815199920e-01   +4.328125267406923e-02   +4.869254903432398e-02; +5.983075381708529e-01   +7.976817203824363e-01   +6.100343140407996e-01   +5.787136568931989e-02   +7.447278682089240e-01   +5.564537139276290e-01   +1.974579368868824e-01   +5.587369194589353e-01   +1.870890801396871e-01   +7.195055516841249e-01   +5.137082974149174e-01   +3.291027096549196e-01   +1.148335110783720e-01   +8.095735387179596e-01   +4.421319716991625e-01   +9.218044984601763e-01; +1.630724386351274e-01   +6.270441394366112e-01   +3.144295112695387e-01   +5.971154632301952e-01   +9.512845707685637e-01   +1.137938637489454e-01   +6.172956778421086e-01   +8.298279697897419e-01   +2.313610805430704e-01   +6.420124769955261e-01   +7.322739538679913e-01   +5.513685357344021e-01   +7.356957426923632e-01   +6.743103755780268e-01   +9.169968487216826e-01   +1.742681236861947e-01; +4.837897784076287e-01   +4.726145362176484e-01   +1.421631963472129e-01   +6.575375246115147e-01   +2.657824258065531e-01   +8.177454678953138e-01   +1.551917432544401e-01   +7.067315123975684e-01   +9.983524447221339e-01   +1.017607044558832e-01   +7.703361098548830e-01   +5.326036059670111e-01   +2.110883476746525e-01   +4.435421436542675e-01   +8.848171820169994e-01   +7.439028098645813e-01; +2.857319568511030e-01   +1.830692271769931e-02   +6.050557288613847e-01   +4.807862141666074e-01   +9.487082892058155e-02   +6.505894824670487e-01   +5.832622678178969e-01   +1.156504142547185e-01   +9.057803046311229e-01   +4.916347382022163e-01   +6.770853347317898e-01   +9.010029610941745e-01   +4.839425237444790e-01   +8.937652311856806e-01   +9.282264195552113e-02   +4.752385013384544e-01; +4.040563606341753e-01   +1.177582005421954e-01   +8.894193723849995e-01   +9.780901626095373e-01   +2.314809119495974e-01   +2.377129363005833e-01   +5.448764615653204e-01   +7.407154740170162e-01   +1.162299872192747e-02   +5.611854753408457e-01   +8.132424979808106e-01   +2.839551512596443e-01   +5.091157948280172e-02   +7.826887501972727e-01   +6.753924563253313e-01   +2.462608954430390e-01; +4.913513193414142e-01   +7.193573147645635e-01   +5.624223352470462e-01   +8.638537336857383e-01   +8.958222747180208e-01   +3.020982043156147e-01   +6.813395803879821e-01   +9.240768278154567e-01   +8.338932835318607e-01   +5.537158424557612e-02   +4.185582585823401e-01   +1.388327315060990e-01   +5.715330508262075e-01   +5.815332809935686e-01   +9.486558965853381e-03   +6.634743329063097e-01; +8.627006188195211e-01   +6.822275351984365e-01   +6.327916831701832e-01   +9.543828827894217e-01   +1.998688276656312e-01   +3.304873017189782e-01   +6.986565865970316e-01   +9.233452608950062e-01   +2.532876258204953e-01   +8.908681565294582e-02   +4.979247512019093e-01   +9.572429943735679e-01   +4.912326890921681e-01   +6.159605839019127e-01   +1.216978184506384e-01   +6.090756866496325e-01];
L2E_L1E_iAMPA_netcon = [+3.678117929687938e-01   +5.616689139822690e-01   +2.005048663268982e-01   +5.137001024103894e-01   +2.898942469720127e-01   +7.405193348104748e-02   +2.787782037618503e-01   +2.670377640238000e-01; +4.375382256028559e-01   +1.934348991792733e-01   +1.371015793067440e-01   +6.852291108173820e-01   +6.198999525414721e-01   +5.934700567637990e-01   +9.292126254661800e-01   +9.048526973784351e-01; +7.184192778203716e-01   +6.127322574519599e-01   +8.182505195455915e-02   +2.069811199665724e-01   +8.628297334582644e-01   +7.568773738806737e-02   +7.640239383153343e-01   +1.593904186147152e-01; +1.916757784795698e-01   +7.409714758348235e-01   +9.062869932338138e-02   +9.715186650108916e-01   +8.201266696178130e-01   +3.971698782051379e-01   +2.616259202417794e-01   +5.537602419279987e-01; +3.984255121702403e-02   +8.314114534528910e-01   +5.509979178773434e-01   +3.503650255309456e-01   +2.056225631823855e-01   +5.901619849657178e-02   +2.430018257390696e-01   +4.223897151407988e-01; +3.148025949314077e-01   +2.767440188112717e-01   +7.322104409026213e-01   +1.851482148905253e-01   +7.509475522843584e-01   +1.287539145354681e-01   +1.657791159864885e-01   +5.467516564491577e-01; +7.900250925644122e-01   +6.086534634764715e-01   +5.443522303216863e-01   +2.380122842952656e-01   +1.986156505453451e-01   +2.445948999422744e-01   +2.872720103058662e-01   +7.542937819777954e-01; +4.750437397377925e-02   +5.480290175368819e-01   +5.475616457431843e-02   +2.534841731077753e-01   +5.776521285469464e-01   +9.439174942324573e-01   +5.644025193298075e-01   +1.403768070034908e-02; +2.159345699808379e-01   +2.741594813496621e-01   +6.325115913669592e-01   +2.224233050575164e-01   +8.767831841802333e-01   +2.029200153075818e-01   +4.048281393902840e-01   -1.417457899675811e-03; +2.740169916308844e-01   +3.396034764993486e-01   +9.943285210112275e-01   +3.592280350274640e-02   +7.144299142190352e-01   +3.274868663730199e-01   +9.874316794995469e-01   +2.114694723975424e-02; +7.893701134991484e-01   +5.668704791495168e-01   +9.149412810684209e-01   +3.570420567710009e-01   +7.003958793198681e-01   +8.670008326530666e-01   +5.448332487485509e-01   +3.595605551114194e-01; +9.903719360726367e-01   +7.440834100774204e-01   +7.687149036422624e-01   +8.984376873753271e-01   +4.679149805621623e-01   +9.222921347736835e-01   +9.291087940761913e-01   +4.268238816418762e-01; +9.444490840394559e-02   +7.720146369004117e-01   +1.909817501570983e-01   +1.403203608581958e-01   +5.042079081716084e-01   +2.335559958568481e-02   +9.926144037879073e-01   +5.446410477079892e-01; +1.964312043518101e-01   +3.980346358925606e-01   +3.187826854028032e-02   +9.559387440088729e-01   +7.960714350580720e-01   +3.647156145756156e-01   +8.364626835162478e-01   +4.921553656934906e-01; +1.164999165402439e-01   +1.486127883073835e-01   +3.733231710777326e-01   +9.021819245604541e-01   +9.400500676147794e-01   +5.280820468287784e-01   +1.805478977972275e-01   +9.200988942841956e-01; +6.472329442058870e-01   +2.077529466785973e-01   +5.756577608939194e-01   +4.104128873135656e-01   +7.819141702380187e-01   +4.067053384396421e-01   +3.134701192117570e-01   +4.163012099545325e-01];
L1E_L2E_iAMPA_netcon = [+4.970204236523199e-01   +4.492024773849255e-01   +6.161858260638218e-01   +4.905803985192342e-01   +2.302437658767706e-01   +7.205465490161816e-01   +6.942480927897202e-01   +6.327729985970743e-01   +5.221683418176961e-01   +2.412596723706953e-01   +8.763861093619765e-01   +1.739969571216723e-01   +1.382922004134008e-01   +2.435420928004794e-01   +1.833377009795061e-01   +2.404742359073773e-02; +8.381682315529613e-01   +3.694846819746056e-01   +1.042544793403770e-01   +6.611883861573024e-01   +8.359445776447867e-01   +3.805879079597910e-01   +9.788875566074897e-01   +6.266203589793179e-01   +6.729090551231952e-01   +7.288526595638596e-01   +6.587657524618897e-01   +3.022808426330650e-01   +2.824585727432661e-01   +7.487881008894567e-01   +1.462684960849999e-01   +2.507957810552275e-01; +1.848960767611873e-01   +3.008237812260564e-01   +7.522726966595974e-01   +1.789136492155532e-01   +7.339016863275811e-01   +3.839153104965446e-01   +7.502601524736306e-01   +4.070414205964101e-01   +7.777065919289486e-01   +1.366657296460874e-01   +5.381486930431127e-01   +1.094660416817847e-01   +7.202442050036142e-03   +9.372798247505514e-01   +1.322748403925726e-01   +9.892673020557409e-01; +3.371154598247939e-01   +2.329110320851013e-01   +5.360832629132887e-01   +4.798618581916343e-01   +4.886274936315501e-01   +7.156788719760453e-01   +5.538768752127574e-01   +4.253074201399051e-01   +4.640772753992515e-01   +4.129771388295616e-02   +2.523362227314101e-01   +4.515818218373558e-01   +3.057362823443105e-01   +2.949353875805673e-02   +1.719808101322666e-01   +6.296031018305379e-01; +6.924750250314966e-01   +1.368761203796243e-01   +4.434470415179655e-01   +4.984529831444202e-01   +8.489455353603403e-01   +8.388562101269307e-01   +2.963029082630749e-02   +5.101810121259649e-01   +9.076870226867095e-01   +6.496140946957663e-01   +1.048374691580342e-01   +5.840606750097344e-01   +9.050535685341151e-01   +4.352053311591998e-01   +9.227044055016392e-01   +3.575021239184589e-01; +6.928799679900414e-01   +9.939135859772551e-02   +7.427041479419151e-01   +6.001674233618746e-01   +7.151742428614120e-01   +6.678760167196279e-01   +1.949166051211473e-01   +2.595098142160908e-01   +2.568538787911951e-02   +2.000850374119021e-01   +9.718133802198494e-01   +2.246202103733581e-01   +2.945991265439549e-01   +8.310910803282340e-01   +2.590959709912555e-01   +9.382117379344271e-02; +3.684567058728379e-01   +2.269451925328185e-01   +3.876096244656373e-01   +2.410371254421669e-01   +5.215655731957402e-01   +6.512666938272873e-01   +9.418026728058249e-01   +4.229246487034124e-01   +4.794991511810884e-01   +9.736485532819121e-01   +5.969200916541036e-01   +1.101086812883699e-01   +8.330382145593436e-01   +9.996893781970995e-01   +2.055980805217451e-01   +4.097008605831523e-01; +3.491721526477142e-02   +3.465375641872476e-01   +5.259785457417849e-01   +5.170871047105990e-01   +9.377219159818559e-01   +5.633923786517512e-01   +3.974630815284969e-01   +5.236263774943007e-01   +2.715688145424779e-01   +8.206618510485760e-01   +8.191655242113370e-01   +5.601742109047481e-01   +7.452790298595761e-01   +9.205887259457191e-01   +6.128799441312409e-01   +9.310314565987995e-01];
L2I_L2E_iAMPA_netcon = [+6.775009594469577e-01   +6.146244255222671e-01   +4.185135852310382e-02   +7.928455926225871e-01   +5.240793185873113e-01   +8.261194637060054e-01   +6.439041506377893e-01   +3.860462132794084e-01; +2.299643219999886e-02   +9.453504261925164e-01   +5.447247334493044e-02   +9.294276407463833e-01   +5.438530954254760e-02   +1.074624229987523e-01   +3.929675580873453e-02   +1.671202370251351e-01; +7.334733237615438e-01   +9.637204460762899e-01   +4.013329402837548e-01   +9.364781496252121e-01   +2.871647550019280e-01   +2.338534900489692e-02   +5.683975326707074e-01   +4.440103168195918e-01; +2.124260837573151e-01   +3.686940454281366e-01   +9.835065982872447e-01   +1.462813453076912e-01   +7.098373564479912e-01   +1.167596728264442e-02   +3.042061460472740e-01   +8.732398025179114e-01; +8.603567060687946e-01   +7.947423199650725e-01   +7.122345073877601e-01   +3.188732566245213e-01   +8.781998688056872e-01   +3.364637441862821e-01   +2.611744533323933e-01   +4.114297350182661e-01; +1.569957219909360e-01   +7.284879966365481e-01   +9.885169853939154e-01   +4.280476020259806e-01   +3.663848109672027e-01   +6.635696313830430e-01   +7.215139888762064e-01   +1.623623256197501e-01; +6.686762742241524e-01   +9.538480646854334e-01   +6.459045853583635e-01   +7.011242595905836e-01   +5.605632591594678e-01   +5.952951589918547e-01   +3.057414880651462e-01   +6.621907997826852e-01; +9.361853256611052e-01   +1.108170335416682e-02   +5.026823442447356e-01   +6.152891490448734e-01   +8.838258633150855e-01   +8.059152496755249e-02   +8.953717530093908e-01   +9.256054903826559e-01];
L2E_L2I_iGABA_netcon = [+6.020993970307952e-02   +5.191121423912797e-01   +3.527493867113315e-01   +2.620211391105224e-01   +4.232742042223255e-02   +8.908091371298290e-01   +3.443345836782135e-01   +4.512841871265383e-01; +3.537874454552612e-01   +6.943749997381148e-02   +5.571378177968814e-01   +9.846279906150968e-01   +3.604743649446313e-01   +5.406707801036466e-01   +9.354432099568176e-01   +6.715607105198271e-01; +9.318349986096217e-01   +1.844712200144786e-01   +6.923491014209573e-01   +3.495814509737264e-01   +3.574492235618397e-02   +7.171306531726844e-01   +9.184338712808939e-01   +7.688858057973013e-01; +2.418553178923680e-01   +3.171474279643932e-01   -6.521436823741399e-03   +4.025401250725376e-01   +4.856060072216277e-01   +7.113006285367274e-01   +7.248480875408757e-01   +9.271746791512698e-01; +1.022346623887785e-01   +2.440092597296841e-01   +4.737254807496100e-02   +7.522526132462515e-01   +7.234288461614758e-01   +1.694899591665301e-01   +4.428488794675783e-01   +6.582087733299762e-01; +7.164615903953057e-01   +3.226923658510038e-01   +3.080161099822073e-01   +1.013420513055027e-01   +1.410543772097486e-02   +3.523393661433122e-01   +1.512512116438660e-01   +5.016951525690687e-01; +5.721607669280104e-03   +8.791377476023781e-01   +8.689949830615198e-01   +5.907772202751933e-01   +5.170867174492070e-01   +3.790848211802668e-01   +8.315500674632351e-01   +3.420811800858278e-01; +1.851166387278396e-01   +3.010742710832338e-01   +6.272770633930285e-01   +1.239051119297943e-01   +2.389594049814172e-01   +7.576817185449646e-01   +2.568772477067618e-01   +9.462557652806423e-01];
L3E_L2E_iAMPA_netcon = [+7.960287879709249e-02   +1.524945792486097e-02   +3.684470021034149e-01   +4.963768661159654e-01   +1.748464972792986e-02   +9.558369587613055e-01   +3.592766350991699e-01   +1.389739825961218e-02   +2.037706121773423e-01   +6.187297433544608e-02   +2.431987898250272e-01   +9.988905862601445e-01; +9.524838074410404e-01   +9.770928300680859e-01   +1.166236296086650e-01   +6.580672589188225e-02   +8.061661645282981e-01   +3.871317720322191e-01   +2.243410960642890e-01   +1.211847484533427e-01   +3.566609915697213e-01   +7.414827240996916e-01   +5.339611701855862e-01   +3.447177844371702e-01; +6.625057117664493e-01   +7.243039157528015e-01   +5.143419738404433e-01   +8.622928875387442e-01   +7.916723716848034e-01   +6.642955972952647e-01   +7.247456090045680e-01   +6.699253528055036e-01   +8.877833091330462e-01   +9.906241162770000e-01   +3.335289327867853e-01   +8.222521593514264e-01; +1.691066767014399e-01   +8.720347917584660e-01   +6.854843481596953e-03   +9.966933277858364e-01   +4.237702352347622e-01   +5.855087478093004e-01   +7.722364033629499e-01   +5.083127976999018e-01   +8.083759760787299e-01   +7.674105902148384e-01   +6.747662728573034e-01   +1.090623411229184e-01; +1.971783455902763e-01   +8.148279129543521e-01   +8.688346470517744e-01   +1.223921329746647e-01   +6.306848574737721e-01   +5.912501607441908e-02   +3.423527017208322e-01   +7.022170025888413e-02   +3.196612311153459e-01   +8.819219947336450e-01   +8.751806314836862e-01   +7.735787040831044e-01; +9.955984992774967e-01   +3.008408418492016e-02   +9.039801945914007e-01   +1.000326989652824e-01   +5.682273492944090e-01   +7.597356118832391e-02   +5.761254750253029e-01   +5.353629525626091e-01   +6.010498663945688e-01   +3.626926524759658e-02   +9.830842400760573e-01   +1.502960444930364e-01; +9.259726362784350e-01   +9.678738802236758e-02   +1.131746799744828e-01   +1.492200659434059e-01   +8.958834273358948e-01   +2.278379126536927e-01   +6.430953442766998e-01   +6.775896223165295e-01   +6.984556094582167e-01   +7.943768183198233e-01   +1.459015710223571e-01   +7.311829554755341e-01; +9.819930002544536e-01   +8.522292485955729e-02   +4.407412861733349e-02   +1.287996951897667e-01   +7.488808569734131e-01   +4.210251039368361e-01   +3.662530300935227e-01   +5.884323825202920e-01   +1.781540455184333e-01   +7.066425008733098e-01   +8.770157013721170e-01   +1.089588570410175e-01];
L3I_L2I_iGABA_netcon = [+7.683437484249950e-01   +5.352365540390769e-01   +5.968452572517130e-01   +3.036926063231372e-01   +9.654107529444858e-01   +1.150479643357310e-01   +2.981155080830936e-01   +7.952235211044126e-01   +9.139858099720124e-01   +9.956703013701136e-01   +3.100012312713192e-01   +9.965446122440881e-01; +6.368110788631507e-01   +4.530803075529420e-01   +5.630543943952405e-01   +7.630430986680389e-01   +5.438205085420066e-01   +7.089422678372628e-02   +1.675891125763837e-01   +5.273372390332826e-02   +3.854624494994858e-01   +2.877160160170781e-01   +4.422222497666839e-01   +9.154245337424093e-01; +7.963819919161447e-01   +1.144945052051217e-01   +6.805473087310744e-02   +6.479631611428054e-01   +9.819734502029406e-01   +5.045710041553285e-02   +7.246096967521858e-01   +1.809262712651881e-01   +7.511950670566439e-01   +5.158366736842179e-01   +2.092762811591032e-01   +6.904758349059772e-01; +9.596013182505501e-01   +7.204501385130287e-01   +7.680554494868576e-01   +3.324464296310818e-01   +1.248093809477809e-01   +1.300904283301940e-01   +2.988470319688578e-01   +2.461489035224991e-01   +8.783923602866140e-01   +3.586653454277453e-01   +9.413425894784154e-01   +2.209588162727742e-01; +7.171268196831087e-01   +1.856739349882483e-01   +8.680868777079650e-01   +9.709294892927610e-01   +1.684782101913229e-01   +4.910208829385508e-01   +6.782017433672877e-01   +2.616356665150006e-01   +3.922006471745360e-01   +5.168922414185062e-01   +2.899904994223523e-01   +3.137571994912237e-01; +6.440717639250586e-01   +3.248079971540669e-01   +7.091083816645443e-01   +5.318470553507774e-01   +3.339093803052169e-01   +4.679893280900607e-01   +7.463049193683143e-01   +6.476669366450878e-01   +1.669861616743632e-01   +5.008433713444242e-01   +1.220594431785725e-01   +2.371227339775976e-01; +5.118096164843083e-01   +9.670974049984797e-01   +1.083354377395121e-01   +7.517581687769394e-01   +5.312419628252134e-01   +1.586007368630216e-01   +7.453269006982112e-01   +9.751170536626817e-02   +4.367839181000763e-01   +1.888393368712151e-01   +6.975626666769771e-02   +7.082039332875395e-01; +9.517987553292444e-01   +7.006727356375225e-01   +6.655950510433736e-01   +2.706343015848328e-01   +6.924773996571705e-01   +1.385504803658871e-01   +7.848180354656259e-01   +4.690182819937240e-01   +8.585369001372806e-01   +4.771895374659905e-01   +7.292856885180256e-01   +3.754836562410950e-01];
L2E_L3E_iAMPA_netcon = [+6.562420766122630e-01   +3.871935764434845e-01   +2.348292252515007e-01   +4.634848055624757e-01   +9.048659915012149e-01   +9.502005201272188e-01   +7.622001812797877e-01   +3.544814725645732e-01; +3.845828279829377e-01   +2.296342599179250e-02   +9.045774457707553e-01   +2.832201684640298e-01   +6.794936529363065e-01   +2.635630291419213e-02   +9.033529168345434e-01   +6.637177208825317e-01; +3.083279493243335e-01   +3.299370168543482e-01   +4.872668176767755e-01   +2.764366010087310e-01   +8.425866318271772e-01   +5.015825156540694e-01   +7.963043307199726e-01   +5.924308197078416e-01; +1.574479064922085e-01   +4.847068434367651e-01   +5.959675179121170e-01   +1.421698965730328e-01   +9.474181183087038e-02   +3.390311218973314e-01   +9.564446675342219e-01   +5.449198545336149e-02; +7.780425879540442e-01   +2.619022517750024e-01   +9.548909688553618e-01   +1.394907653227276e-01   +7.354671025604271e-01   +6.720732975874675e-01   +5.350572828882370e-01   +2.165253069591085e-01; +7.091643097108411e-01   +5.264043607771297e-01   +8.508484799892772e-02   +2.654367331405771e-01   +5.435356050724149e-01   +1.677900340263232e-01   +1.638559640876356e-01   +6.023175337636372e-01; +1.728157434132141e-01   +4.163535515626017e-01   +2.223593583042765e-01   +6.103433959654104e-01   +2.567124939641397e-01   +2.268168837391039e-01   +1.347793164304593e-01   +2.691313255853326e-01; +4.481472585374009e-01   -4.661513204800995e-03   +1.517319501708999e-01   +1.060870718765970e-01   +7.147075595562439e-01   +1.179362291338647e-01   +3.406354920824846e-02   +1.093248060535835e-01; +8.380155781622561e-01   +8.937689547628319e-01   +3.893522365185469e-01   +4.847804495767785e-01   +3.604421414310242e-01   +9.928441343612501e-01   +6.807903041787561e-01   +2.112827390866226e-01; +6.975063893268745e-01   +2.387311022000571e-01   +1.848687894930170e-01   +8.933971892951542e-01   +8.545646587411473e-01   +1.397844721331331e-01   +5.873466963676856e-01   +8.731236310757384e-01; +7.654669704834201e-01   +7.924104807142766e-01   +7.633580383778642e-01   +1.882083147522624e-01   +8.186369643658579e-01   +7.691695806079191e-01   +2.985821227719950e-01   +4.594516092257524e-01; +9.802229220571672e-01   +5.786980854365289e-01   +2.286011480524126e-01   +5.174259730883424e-02   +6.108346274629841e-01   +6.343808670644169e-01   +7.373206442043724e-02   +7.273289656891164e-01];
L2I_L3I_iGABA_netcon = [+5.894624272176494e-01   +1.476802693800844e-01   +3.445381598063277e-01   +3.697124528607552e-01   +5.994461213015178e-01   +5.071421877910335e-01   +7.730100178128106e-01   +2.647541810426171e-01; +8.457245820544050e-01   +9.903690593991896e-01   +4.660136077413730e-02   +5.373875701849636e-01   +4.785789635471382e-01   +2.368675796870208e-01   +1.793057261674714e-01   +5.853087799475598e-01; +6.049117182355948e-01   +4.806776512646680e-01   +9.420696071836985e-01   +9.748313296326762e-01   +3.766385990620608e-01   +2.722255571299369e-01   +4.544521941088263e-01   +6.790065502424937e-01; +7.441635056785577e-01   +3.509952622868652e-02   +8.675063826925635e-01   +9.968893784716231e-01   +9.783930123969211e-01   +4.050252004856664e-01   +3.055610231740888e-01   +4.153504846188653e-01; +8.493951350606934e-01   +2.694505007753893e-01   +1.333972657378315e-01   +4.150400120968860e-01   +1.383832827327837e-01   +2.602141067364091e-01   +3.875726928848599e-01   +5.117229360230152e-01; +1.466540897454784e-01   +6.758736849155613e-01   +5.911947134648280e-01   +4.512565534743748e-01   +2.709574724737361e-01   +8.537954588707390e-01   +8.035127149171704e-01   +8.143118189356522e-01; +7.416562456903045e-01   +1.472658430147684e-01   +6.217889065275350e-02   +2.551541252096242e-01   +2.253481419552974e-01   +4.791202101217247e-01   +7.779361795322554e-01   +5.446038553971055e-01; +1.685159790707001e-02   +7.739702969968064e-01   +9.469935446652913e-01   +6.013743709046853e-01   +7.909507647891231e-01   +3.413677264640735e-01   +6.454504562780468e-01   +5.894357547693903e-01; +2.281448228093409e-01   +2.671267424812285e-01   +4.967369278778656e-01   +7.783347423780643e-02   +8.173916686980578e-01   +6.390368606655696e-01   +2.418366660161307e-01   +5.352768287832982e-01; +5.374281943161864e-01   +8.807920179482949e-01   +2.627027649880525e-02   +9.122474156739757e-01   +7.919600553413073e-01   +4.154718383053708e-01   +6.093281528020412e-01   +5.415182102640610e-01; +7.207969081159857e-01   +3.688810595763879e-01   +5.745068626196665e-02   +4.727972610062631e-01   +1.127598539883168e-01   +5.431700676124477e-01   +4.201378810984170e-01   +1.517895024192354e-01; +4.339816136059013e-01   +1.021931179391277e-02   +3.006346797897059e-01   +5.083500146074719e-01   +6.326468042739987e-01   +3.393036193648598e-01   +2.942673551782703e-01   +7.028149115968759e-01];
L3I_L3E_iAMPA_netcon = [+6.436352582600735e-02   +7.735780393604458e-01   +5.552793124382991e-01   +5.732353647259510e-01   +9.197829338154585e-01   +8.350680754605558e-01   +8.490394401742453e-01   +8.624323533068222e-01   +5.341119327727671e-01   +9.884616412124968e-01   +4.816105546242893e-01   +3.506845772463706e-01; +9.224772976720967e-01   +8.390556397748298e-01   +8.442305276606988e-01   +9.352240684576392e-01   +5.923357444102835e-01   +3.926261454954950e-01   +6.278067685775996e-01   +8.559156677624575e-01   +5.668287813443366e-01   +7.010420641053756e-01   +7.396425783656529e-01   +3.996403653489329e-01; +1.804223476400204e-01   +5.928667750382073e-01   +9.691474093010800e-01   +7.785451237871047e-01   +5.751610723004494e-01   +6.976878055908980e-02   +4.448501240681253e-01   +9.496038427125347e-01   +9.799906538072605e-01   +8.442229516171842e-01   +5.952577658302153e-01   +9.877701285341981e-01; +5.435133271388826e-01   +7.673088933785257e-01   +4.667257201748550e-01   +5.973446636534020e-01   +6.585612029584157e-01   +3.736510786619618e-01   +2.346772146164937e-01   +6.938183670561466e-01   +9.674863409486638e-01   +7.377764440607194e-01   +2.627486334070347e-01   +2.969417309755993e-01; +3.968599602934776e-01   +6.586933442343448e-01   +7.761057147241407e-01   +5.814590683689185e-02   +4.354114634823901e-01   +8.494747442318658e-01   +5.091305686597982e-02   +3.631705299695627e-01   +5.600546498668831e-01   +9.961298861231866e-01   +6.073560590173256e-01   +2.245840840781656e-01; +9.495831167215659e-03   +5.889377271629925e-01   +2.147131579440010e-02   +5.437792474169619e-01   +9.353913004944348e-01   +2.439926351144237e-02   +7.128767819505953e-01   +3.736325427351657e-01   +5.325454278807688e-01   +5.080112680830468e-01   +2.323390687607931e-01   +3.305640360355316e-01; +1.025403209667808e-01   +2.652193274088492e-02   +6.776642224189764e-01   +8.647817415602610e-01   +1.023019205778993e-01   +4.218997258866922e-01   +8.485281103872951e-01   +8.427377811798997e-01   +4.787921096446103e-01   +1.893876785234291e-01   +1.949094028869431e-01   +1.647033527665420e-01; +8.561678928220875e-01   +6.929746571241067e-01   +8.356170783842611e-01   +3.382213015542972e-01   +4.094808811818882e-01   +2.550850426730334e-01   +4.047566223962578e-01   +3.838447924181390e-01   +9.009674010890300e-01   +9.596638811155646e-01   +2.131284652975348e-03   +3.841276118678871e-01; +3.382284383880045e-01   +3.272225280684943e-01   +6.843385370692006e-01   +1.787473483286010e-01   +8.927483166899310e-01   +7.426305727917676e-02   +2.865369147587911e-01   +7.698286106139262e-01   +4.822278403366351e-01   +4.524128888923379e-01   +6.462103758283678e-01   +5.255309319426271e-01; +1.499975329732151e-01   +7.567728640449897e-02   +8.960061266260640e-01   +8.814117112903758e-01   +7.386358696369676e-01   +9.206144252842348e-01   +2.626920326723545e-01   +7.721782333960588e-01   +4.874701279101628e-01   +6.055949333454974e-01   +4.000269340469465e-01   +5.951363201433776e-01; +8.074574364495513e-01   +7.441056323137704e-01   +9.555123054724475e-02   +8.416426202527396e-01   +9.586686772125717e-01   +2.680075962001780e-01   +5.050535285128462e-01   +4.334276364517635e-01   +3.138834332086852e-01   +6.437749335738907e-01   +2.722437639366909e-01   +1.702634440019436e-01; +6.559607307999161e-01   +9.649578240294284e-01   +7.088810824927204e-02   +8.337159169940594e-01   +9.698619026911768e-01   +1.010446924466844e-01   +1.168340594426885e-01   +4.875830813427288e-01   +8.596046139568885e-01   +7.664564424556629e-01   +4.098967367038759e-03   +7.257637766001021e-02];
L3E_L3I_iGABA_netcon = [+4.373510870715779e-01   +7.091684444444787e-02   +5.170147135909958e-03   +4.952736316728655e-01   +5.435066190617220e-01   +2.520058796001791e-01   +7.177954826599623e-01   +7.613428612620683e-01   +3.785044546515858e-01   +4.488144134116693e-01   +2.000768792571612e-01   +6.493530157734607e-01; +5.791380925631812e-02   +8.079945586745337e-01   +1.327621815062852e-01   +1.937677985347277e-01   +2.115697681260942e-01   +3.341160886645083e-01   +2.222977791569085e-01   +8.885211009162626e-01   +6.110575461496066e-01   +3.945342343771489e-01   +8.280742997822123e-01   +8.985966485186309e-01; +6.251454671480186e-01   +9.096950124802355e-01   +3.087092620995792e-01   +6.421456237413405e-01   +2.696236712522826e-01   +5.917797416840319e-01   +4.988693228222176e-01   +7.313133953328876e-01   +1.678588373795177e-01   +6.682692276084893e-01   +4.468564477968676e-01   +8.386454355091241e-01; +7.986103015794429e-01   +4.259431202384751e-01   +2.383823775725437e-01   +2.554803396530755e-01   +1.325605863671688e-01   +4.815978145827058e-01   +4.754080233623728e-01   +6.978162831276091e-01   +1.052665035279278e-01   +3.319346235639200e-02   +4.251714697744205e-02   +1.704682872980888e-01; +4.011166651300860e-01   +1.840841379822139e-01   +6.492675385670222e-01   +9.484258370922667e-01   +1.630301242973014e-02   +8.972338010504913e-01   +4.312360304374869e-01   +6.465154659073116e-01   +6.257867333087679e-01   +7.872094763717236e-01   +7.688429146644545e-01   +1.609214370106082e-01; +8.845075288859484e-01   +1.834429351424538e-01   +8.081630550466439e-01   +2.879322978454830e-01   +1.560094184701153e-02   +2.947650925079287e-01   +5.570790108299842e-01   +6.205287139324152e-01   +9.526489739480979e-01   +3.786456303268513e-01   +9.801937454270084e-02   +1.357469774484841e-01; +7.221328267929611e-01   +6.722042128841961e-01   +7.398411060316727e-01   +1.492102863625984e-01   +9.790278241572211e-01   +7.927417240122858e-02   +2.069818341346902e-01   +7.819076818386353e-02   +6.652677970807706e-01   +6.513402985527339e-01   +6.523129604299533e-01   +1.588546799095818e-01; +1.967865211501527e-01   +5.241572260024451e-01   +1.224197975334962e-01   +8.702927606119304e-01   +6.472905337854855e-01   +3.921154644805361e-01   +2.772444952083369e-01   +5.480301601921187e-01   +4.731015616968105e-01   +4.969646915658114e-01   +2.706685019297657e-01   +3.942494750708007e-01; +3.744272799529488e-01   +7.763579777060650e-01   +1.727117803033801e-01   +8.867657007670877e-01   +8.157065478321172e-01   +1.984467245640198e-01   +8.122672111549186e-01   +8.839975686410719e-01   +3.406044907682634e-01   +2.130119807404223e-01   +4.369308934079770e-01   +6.667073510308605e-01; +2.117195753114230e-01   +2.991356326756931e-01   +2.737723155123495e-01   +6.684095185388528e-01   +2.756311063537655e-01   +7.224681773451314e-01   +9.567038674414557e-02   +9.876925672459396e-01   +5.914054066229261e-01   +2.166195892081863e-01   +8.488200733502779e-01   +2.226968751228632e-01; +2.594767480218532e-01   +4.743113597150208e-01   +8.148441360277134e-01   +9.971271056094078e-01   +1.546300269062440e-02   +4.214933423274684e-01   +3.297744120988065e-02   +7.092271018552987e-02   +5.456765836561990e-01   +4.520683434489910e-01   +9.023515612150582e-01   +6.436173093602892e-01; +9.918418318338553e-01   +7.064940147324542e-01   +5.914423840354213e-01   +2.678451533217702e-01   +1.013814559754051e-01   +2.681000818183275e-01   +6.504237731265118e-02   +3.278357409284740e-02   +3.961241388022216e-02   +6.290989670319702e-01   +2.849250435688995e-01   +6.117243961401352e-01];
L2E_Input1_iAMPA_netcon = [+9.920088257537550e-01   +9.897122395682734e-01   +9.998902692398469e-01   +9.876383739314994e-01   +9.853062158692374e-01   +9.993186049953147e-01   +9.833204293861857e-01   +9.968731019567161e-01];
L2I_Input2_iAMPA_netcon = [+9.920386511535129e-01   +9.984738886188201e-01   +9.854212134043788e-01   +9.943378870655839e-01   +9.891317171604078e-01   +9.902693337438744e-01   +9.953376724713676e-01   +9.968764315456801e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
