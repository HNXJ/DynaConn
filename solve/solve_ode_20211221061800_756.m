function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.978952161666730e-01   +1.110167758131473e-02   +8.049034299205478e-02   -3.645291673129584e-01   +2.981627230012500e-01   +2.355374821918914e-01   +3.054233841949350e-01   -7.391671067546437e-01   +1.486308375532539e-01   -4.599098029521798e-01   -2.061680732736241e-01   +2.496072714589858e-01   -9.963980139964539e-02   -2.029971856399517e-01   +1.520139937959236e-01   -7.640935779780392e-01; -2.286876041087582e-02   +5.705435785439542e-01   -4.067499564501870e-01   +4.271172025333738e-01   +4.263203123650457e-01   +4.000302630648463e-01   +7.532277157796771e-01   +7.840433086561648e-01   -1.592860751365029e-01   -6.027034700789264e-01   +9.931109405814667e-02   -5.211670502817475e-02   -6.324999821604725e-01   +5.773088120791476e-01   -7.343742209630476e-02   -5.627583039189180e-02; +1.742250085274381e-01   +3.067380173484112e-01   +4.435832452511044e-01   -3.142419147676479e-01   -4.178058620933873e-01   +2.930160069926466e-01   -1.349558273981405e-01   -3.230273021073715e-01   -3.527249352686173e-01   -4.306218309155304e-01   -2.013189591785655e-01   -3.686614005779811e-01   +6.750535599338370e-01   +5.452562998838808e-01   -4.531436719407753e-01   -6.482619741211699e-01; -5.828263351255937e-01   -1.133543366012959e-01   -2.471205591525628e-01   -1.338108820207546e-01   +8.147101789664897e-01   -3.532451909002168e-01   +3.788181453526094e-02   +4.416289610345283e-01   +2.275266162108307e-01   -5.245114531326185e-01   -1.049061012535287e-01   +3.266298879718489e-01   -3.526603864322442e-01   -6.956187877265533e-01   -2.989872917684319e-01   +4.435536876429236e-02; -5.819405024987473e-01   +7.475774550911957e-01   -1.632613836815898e-01   +1.643092299307169e-01   +6.007820009943540e-01   -3.499830865199644e-01   +4.444918555439748e-01   -9.757479862881065e-02   +3.186353734181996e-01   -5.138951672540786e-01   -1.454515582606474e-01   +4.807043957972271e-01   -8.831705483389496e-02   +4.430412071709026e-04   -3.155070204776360e-01   +3.708227035156922e-01; +3.098856685837513e-01   +3.770211821717872e-01   -3.208390349842679e-01   -2.305489695526725e-02   +2.535025752900483e-01   +4.707772163977927e-01   -1.104051645162523e-01   -7.148056232190128e-01   -2.416287915582783e-01   +8.231616869946922e-01   -3.044218067495488e-01   -2.349926968455863e-01   -1.020086856211185e-02   +1.000000000000000e+00   +2.651189494965693e-01   -3.699904161276923e-01; +1.554563860408466e-01   +1.041205941171007e-01   +4.062672021342635e-01   -2.874661841574011e-01   +4.609064613568833e-01   -3.509135763152064e-02   -6.876895441724269e-02   -4.514093013807456e-01   +2.300502767094434e-01   +5.370270537791023e-02   -6.013804425098641e-01   +2.844401398603961e-01   +2.702609258523770e-01   +4.582910964209803e-01   +3.588931496728596e-01   -4.369786097237238e-01; +1.630866653159584e-01   +3.382461125093124e-02   -5.225379849816078e-01   -1.684475985614473e-01   +2.463014563812704e-01   -2.827403585886673e-01   +4.385842975622479e-01   -1.869126633154722e-01   -7.217439126986520e-01   +3.972543480905314e-02   -2.171291416680052e-01   -3.651015946234966e-01   +1.784346833701797e-01   -2.046163970737012e-02   +1.195479677887941e-01   +2.293989295428874e-01; -5.712970328300914e-01   +3.445319044557407e-01   -7.224629662286762e-02   -8.375768653920753e-01   +2.722802860878520e-01   +6.209850500672454e-02   -1.641725001758733e-01   +4.699151736280216e-01   -4.314813343910077e-01   +1.213035197156684e-02   +3.626462864512166e-01   +1.309349016086644e-01   -3.937376428594928e-01   -6.258065057647379e-02   +7.544303680676643e-01   +7.117182669810247e-01; -3.578684287945230e-01   -4.898410349249924e-01   -2.894843986827493e-01   -3.417619508670021e-01   +6.986683448954041e-01   -2.851847494230338e-01   -2.731555084399157e-01   -4.353149205529070e-01   -5.488359318219777e-01   +1.705891034400039e-01   -4.598208305058462e-01   -5.990878400273113e-01   +7.816822920326547e-02   -4.983224650508921e-01   +6.009479968911385e-01   +4.368669145951422e-01; +2.026299607582476e-01   +2.064494413562461e-01   -6.679667519077220e-01   -2.533908767683262e-01   +1.042366875103109e-01   -1.592548990571503e-01   -1.707635795808979e-01   -7.616104887371664e-02   -8.116076515827048e-02   +7.346047014653927e-02   +4.697284996912259e-01   -8.947407782005347e-01   +1.042831497307079e-01   -1.224250471569424e-01   -8.548523882685949e-02   -2.626462755365839e-01; +3.041442026637282e-01   +6.642701177101434e-01   -1.285825868975045e-02   -1.789961712397000e-02   -6.118881792416655e-01   +2.702046641495751e-01   -2.711734553518956e-02   -1.573243033898570e-01   +4.273387362863968e-01   -1.823359840397711e-01   -3.876779940014636e-01   -6.199729136209832e-01   -4.308538353978967e-01   +1.383027667947787e-01   +1.295840096962048e-01   -2.545560517978722e-01; -1.221426887777883e-01   -3.580712531306026e-01   -9.187090981420472e-02   -3.728360785232548e-01   -2.859531038906932e-01   -3.971649370047223e-02   +5.767553173602704e-01   +5.819583500407657e-02   +5.545514823836463e-01   +4.272888324468632e-01   -3.390884783835513e-01   -2.432146802631150e-01   -2.849499935302469e-01   -4.122171475423527e-01   +2.972998084367260e-01   -3.002904804703418e-01; -7.130232329451043e-01   -3.361064950738608e-01   +2.376843769584802e-02   -3.761867329131656e-01   +3.819870930150073e-01   +2.305176880936498e-01   -3.414804135506580e-01   +7.360838000016952e-02   -6.287086725616077e-02   -6.016090078569209e-02   -4.678214945479911e-01   +8.237261803942908e-02   -4.734986517260665e-01   +1.072470870353339e-01   -2.145306012001040e-01   +4.175905416261161e-01; +1.007617938250368e-01   +6.919966140357034e-02   -5.352022627644721e-01   -1.920107826900968e-01   +3.515096531501573e-01   +3.423351469443397e-01   -9.158783761487903e-01   +6.099457864995631e-01   +2.478455989728067e-02   +3.081821733562585e-01   -4.583881859654142e-02   +3.795219052582741e-01   -1.951125580167306e-01   +1.731887166690280e-01   +5.884371186418705e-01   +2.978585067218238e-01; -3.400678602064005e-01   -5.869194911746697e-01   +3.734683895327681e-02   +2.440319361734010e-01   +7.446362188747059e-02   +6.051894137479160e-01   +2.545018899091815e-01   +9.479790762387262e-02   +3.638490495825883e-01   +6.119708992952704e-02   -2.500742171386069e-01   -2.026963514419015e-01   +4.187277062265584e-01   -2.014450734593062e-01   -2.838167782061078e-01   -1.519622443797535e-01];
L1E_L1I_iGABA_netcon = [+4.294862620829078e-01   +1.676463004425520e-01   -1.349323716764810e-01   +5.253767081928541e-01   -2.637998621211756e-01   -4.677215106103249e-01   +5.931231964476100e-02   +2.257576435885989e-01   -4.026058935346657e-01   -8.731095122556886e-01   +5.220412964694142e-01   -6.302436057196370e-01   +1.012125200042271e-01   -3.720273643101273e-01   -4.429959365384212e-01   +1.360698852567695e-01; +6.191553159337561e-01   -1.370548685701398e-01   +3.320563719370894e-02   -9.320386740436779e-02   -1.236598922041240e-01   -4.542088965328829e-01   +2.532296745945432e-02   -4.637952985466726e-01   -8.177402163144946e-02   +2.258816921964720e-01   +5.827761074893476e-01   -7.039298423407141e-02   -7.804710030203381e-01   +4.317247184052081e-01   -3.155236172934444e-01   +1.758013766257712e-01; -2.518060876592955e-01   +2.970343267200263e-01   +4.960220701073086e-01   +5.543646073849364e-01   +6.250699149249930e-01   -2.731436118933674e-01   +6.743109952079737e-01   +3.100309872497536e-01   -5.662837153218642e-01   +9.123679921512853e-01   +4.768990394723497e-03   -2.606360953332714e-01   -4.902389714441063e-01   -5.807244634444932e-02   -3.674316100116577e-01   -5.257081398391916e-01; +5.492149331723763e-02   -7.821751389266194e-01   -2.810271798647089e-02   -4.923354470742526e-01   +3.004411224487333e-01   -1.316040016121485e-01   -4.204706751042120e-01   -1.119360836712542e-01   -1.973269405220490e-01   +8.263322268466440e-01   +7.227257075313498e-01   +1.743897807437178e-01   +2.740977624799060e-01   -3.496494314903862e-01   +4.361866843677492e-01   +4.828723604869786e-01; -1.193459588452159e-01   -6.572651881744228e-01   -2.933513976578219e-01   -4.721916661792012e-01   -3.775149663182916e-01   +2.949725671110897e-01   -3.491297442186273e-01   -4.149397295779638e-01   +7.404159864245433e-02   -6.069620072247413e-01   -1.554882230330485e-01   +5.696685250663639e-01   +1.888948830579430e-01   +1.769833698465192e-01   +6.505746674655613e-02   +8.680282394630977e-02; -5.759884945366725e-02   +5.455107671139362e-01   -7.411887472206863e-02   -4.054520064358281e-01   +2.736155612051624e-02   +5.484984208395537e-01   -6.852228062930413e-01   +3.083508498359220e-01   +7.038075121734723e-02   +4.026442196490650e-01   +8.642827850008631e-01   +8.506519620306903e-01   +3.713087437686681e-01   -1.446253341940983e-01   +5.381252626365299e-01   -4.473940959592314e-01; +4.530087084754768e-01   -6.788837152626237e-01   -9.162521634253989e-02   +3.910650004515753e-01   -1.666900230032230e-01   +6.619248498205929e-01   +3.981385631662781e-01   +4.256949237782711e-01   +6.189870744196868e-01   +5.633667017715254e-01   +3.640887912750894e-01   -6.429001952520474e-01   +3.170706807950461e-01   +6.668773971086397e-01   +1.701298770348171e-01   -4.078586158071908e-01; -1.821833082414015e-01   -4.579134344987777e-02   -8.478484978376070e-01   +2.293500939345847e-02   -4.444892648923395e-01   -5.149008825975807e-01   +2.297273898995003e-01   -8.294339436855296e-02   -5.982398769131095e-01   +2.356070745697499e-01   -6.605374031296918e-01   -5.468887135939200e-01   -5.329663280140822e-01   +2.185607971332822e-01   -5.925468982768994e-01   +1.804067638775114e-01; +4.890572466373261e-01   +6.609450775825321e-01   +3.206358553639577e-01   +6.244666955688087e-01   +6.489690459636285e-01   -4.492821568082633e-01   -5.094894098934528e-01   +5.151600858591682e-01   -1.155802149782578e-01   +4.120720512797508e-01   -2.301701915279125e-01   +3.100824389322134e-01   +8.459595900816792e-01   +6.474728637462920e-01   +2.358489300793325e-01   +4.371087469222596e-01; -2.140507658184345e-01   -4.734253551689924e-01   -5.884314234542749e-01   +3.488870557413853e-01   +7.151473676917220e-01   -1.259352223171799e-01   +1.872970524924761e-01   +3.859746766725743e-01   -1.262495140687659e-01   -7.752311755561879e-01   -6.800265493702247e-02   -1.001204485185403e-01   -5.242308676667025e-01   +3.412513698362168e-01   +1.345418688056057e-01   +2.973358614874616e-01; +1.819082576701933e-01   -8.108502362064350e-02   +1.039134034076287e-02   -7.629921399924093e-01   +3.040411803744352e-01   -4.015119276203988e-01   -6.779706779346606e-01   +1.944489697154949e-01   +9.326676275185200e-02   +2.429004877817845e-03   +2.064136957790580e-01   +5.602775014331678e-01   -5.466993082343689e-01   +1.004421366812782e-01   +4.744147966511849e-01   +4.470152643934153e-02; -7.031313563607294e-01   -3.162211619758996e-01   -3.764021819178254e-01   +4.164203455841521e-01   +1.837694184014575e-01   +1.510532104481335e-01   -1.994671985336307e-01   -6.194371393575052e-01   +2.109813437508259e-01   +4.613856520945283e-02   +3.296877588400973e-01   -1.032265365209682e-01   -3.077616267222630e-01   -4.462931385446918e-01   -7.219988483757365e-01   -5.942699993016195e-01; -1.546603174109139e-02   +3.281206936807584e-01   +6.109123574366117e-01   +5.007442645071578e-01   +1.364221698633918e-01   +2.373468571797302e-01   +8.290699284802992e-02   +1.891900906408698e-01   +3.324419463023518e-01   +5.952600350538351e-01   +6.227319982928429e-01   -1.000000000000000e+00   +4.950961578677410e-01   -2.645910264422675e-02   -7.153089443715693e-02   +1.660685009260897e-01; +7.053553820858489e-01   +2.060536681710908e-01   +6.777505919264279e-01   -1.930413412693726e-01   -1.350611017794279e-01   -1.350447144720773e-01   +2.803931013057495e-02   +4.478571475029365e-01   +6.162222200468789e-02   -3.979259385211223e-01   +6.016654146706811e-01   -6.080462770455782e-01   -8.424874479293888e-02   +7.762620886949674e-01   +1.186549463035184e-01   +1.944155058141911e-01; +1.886619380251056e-01   -1.474838945593452e-01   -2.262602938046027e-01   -3.402330809092017e-01   -4.809940411766773e-02   -6.890364433435739e-01   -6.211571314837601e-02   -3.483310170819650e-01   +4.132522778881937e-01   -8.134701667918790e-01   -9.277867919736000e-01   +3.054526317728452e-01   +6.772317674846894e-01   +1.129050929855615e-01   +4.605541963407228e-01   +3.747670734549108e-01; +3.393034683743444e-01   +5.241063515156704e-01   +8.310716464390839e-01   +8.791803301722407e-01   +6.251626511646358e-02   -5.163101256386712e-01   -3.414057025215756e-01   +3.999375700217469e-01   -2.264051024083572e-01   +4.514011165804310e-01   -8.721277452462124e-01   +1.090502911037483e-01   +2.058691317844587e-01   -4.224172246934254e-01   -5.076956490767338e-01   -2.773201855677864e-01];
L2I_L1I_iGABA_netcon = [+4.830733847085059e-01   +8.219628901580098e-02   +1.897785002302735e-01   -7.046995730096485e-03   -2.713003602689807e-01   -1.441565645324235e-01   -6.721452228542052e-01   +1.833433277231886e-01; -6.510372730646590e-01   +2.806400552458551e-02   -5.440886140401708e-01   -2.229643629767491e-01   +3.491027054325341e-01   +5.936206349964961e-01   +5.353666560431557e-02   -3.290402281753815e-01; -3.555205666596045e-01   +6.539136610521443e-01   -6.913131346333022e-01   -6.348231676046486e-01   -4.028800221637995e-01   -1.587402801688860e-01   -2.596464775225304e-01   +8.041843411097077e-01; -2.355115621385612e-01   -3.069532127798890e-02   -4.780016497627014e-01   -5.913144842201583e-01   -4.715542198074756e-01   +2.423031062804469e-01   -1.725570344868364e-01   -5.465401929010547e-01; +6.377179546982251e-01   -9.142074422169072e-01   +1.687812987894527e-01   +5.798140574083577e-01   -6.691885167920631e-01   +6.452234534365072e-01   -3.983114531871710e-01   +4.037806091826636e-01; -5.574677614375326e-01   -1.117183008222971e-01   -4.422324232926982e-01   -3.008145009686708e-01   -6.937002743209147e-01   -3.594989894804483e-01   -3.451278430336355e-01   +1.563495356192428e-01; +5.502089713789247e-01   +1.838068094442873e-02   +1.007934759660731e-01   -2.166702044149364e-01   -8.226898491257580e-02   +5.911472557001698e-01   -2.641086717247211e-01   +1.000000000000000e+00; +5.868373586423409e-01   -4.968769466737038e-01   +2.778829033079798e-01   -2.748390613291420e-01   -6.211695377169584e-01   -1.415925846884735e-01   +7.399398669050465e-02   -5.693874393726228e-01; -3.560111426211527e-01   -3.820548166849442e-01   +5.820184515450686e-01   +3.969968986357067e-01   -1.684974897906298e-01   -3.066727949511669e-01   +3.365701454310288e-01   +5.745702232180934e-01; -3.170352226185463e-01   +9.380962735014707e-02   +3.298590017653305e-01   +3.885500104541074e-01   -3.328114509298431e-01   +3.781878337658220e-01   +8.524598372790529e-01   +6.224268302661632e-01; +1.826275876262451e-01   -4.232890984317531e-01   +6.091163001259338e-01   +7.214928336214900e-01   -8.278296181641519e-02   +5.675268414827433e-01   +2.282464059818013e-01   -8.337270216577826e-01; -6.003491839749403e-01   -2.159190293577936e-01   +9.640329332599527e-02   +1.883836383105948e-01   +8.969944774084273e-01   -3.065886983556363e-01   -6.202489834870329e-01   -6.318329129485147e-03; +4.016488657792063e-01   -1.158830181380164e-01   -3.846856802745027e-01   -2.014064633462019e-01   -1.743806650946705e-02   +4.351238804603406e-02   -3.207302770178862e-02   +7.528907795082262e-02; -4.645564018958027e-01   +7.884711716262269e-01   -5.858246554931935e-01   -2.376144218096938e-02   -7.615883202260856e-02   -8.602118954266263e-02   +2.784433946852878e-01   -2.331775958656225e-01; +5.123524967926467e-01   +9.483150150386366e-02   -5.126478950601691e-01   -2.277704069114547e-01   +7.421750692744353e-02   +1.698515201137743e-02   +6.491377790270707e-01   +3.131415954915401e-01; -5.141281295581435e-01   -3.595119843334435e-01   +3.932368176525187e-01   +4.570243461302841e-01   +1.518429526034969e-01   +1.758380873970091e-01   +3.902011020008238e-01   +2.160696786590745e-01];
L1I_L2I_iGABA_netcon = [-2.822417374591050e-01   +5.630410649023153e-01   -8.534247507776703e-01   -3.221916941317158e-01   -9.634588737625924e-01   +5.736019074326150e-01   +6.335564495256764e-03   +5.623419834508616e-02   -7.164412201111313e-01   -8.353335236952988e-02   -1.504083691297000e-01   -4.219905390178847e-01   +2.484631165243324e-01   +2.794743628441107e-01   -4.009896283673072e-01   -3.857856243991621e-01; +2.274069625251333e-01   -2.371079281440183e-01   +2.183073743051950e-01   -2.534171989789378e-01   +7.094119852615396e-01   +4.428368816155237e-01   +3.549309554346001e-01   -6.359581956895126e-02   +2.758583116680159e-01   -4.449987812145723e-01   +6.429039112141591e-02   -6.083237685774178e-01   -1.282792253610848e-01   -6.699748675129932e-01   -2.236732451375504e-01   +1.502105871571502e-01; -4.195489757851132e-01   +6.152531910659693e-01   +1.191879311637367e-01   -4.511110799495169e-01   -4.429396200041468e-01   +9.980954954586313e-02   -2.412502678231828e-01   -8.920663109175569e-01   +3.835236571554146e-01   +5.166579111073453e-01   +6.101990088477127e-02   +4.992713984623059e-02   -2.745154458676956e-01   -5.836730837696349e-02   +1.262423682610505e-01   -5.882169670176488e-01; +1.798261855061705e-01   +4.444961212679778e-01   +3.016366581147018e-02   +1.481470334097913e-01   +2.328419545907765e-01   -4.944920361275185e-01   -1.327318394352264e-02   -3.223122194373121e-02   +1.839274633804843e-01   +5.684074111648539e-01   -2.680892001707806e-01   -4.421630102784458e-01   +3.362989898123954e-01   +9.355444392670496e-01   -4.580995134677839e-01   +5.864341272008792e-01; +4.338037578837792e-01   -6.363578003042768e-02   +8.752530565443808e-02   +2.176277625458155e-02   -3.476344820133225e-01   +4.058362714134878e-01   -7.740853727869595e-01   +1.078763002479816e-01   +6.914329605860098e-01   +6.013548172522607e-01   -2.721426711381265e-01   +2.388230014167861e-01   +3.321213514156935e-01   -2.125677161120053e-01   -2.618888953679842e-01   +2.309805725376922e-01; +8.229271324257070e-02   -8.505811934722387e-01   -3.785975729699538e-01   -1.459871753473879e-01   -4.724636536918640e-01   -1.929914892536809e-02   -6.446637803784031e-01   +2.493355542540164e-01   -1.466690530682547e-01   -3.683745807638767e-01   +9.530041321529754e-02   -4.966807782870498e-01   -9.859069389288692e-02   +5.876065061404502e-01   -8.064206487743660e-01   +7.088068082604261e-01; -8.206021551156577e-01   +3.374587591426696e-01   +2.095563642934090e-01   -9.708303711757836e-03   +5.995653100001880e-01   +8.083564049690813e-02   -5.770328186745469e-01   -7.608363247461034e-01   +2.520565151167909e-01   -8.161379440294743e-01   -9.968789810464935e-01   +1.000000000000000e+00   -8.441097033811286e-02   +1.168620663357493e-01   -5.811802853271930e-01   +1.284269040878972e-02; +5.298965510228002e-01   -4.043240448919445e-01   +2.994904548868185e-01   -1.492112939410407e-01   +2.247534531535427e-02   +3.239287642367743e-01   -3.791582480037045e-01   -2.520942726255042e-01   +3.921362437434658e-01   -1.364583975888188e-01   +3.182587365019109e-01   -1.418846308448901e-01   +3.264171924627436e-01   -2.520811140279200e-01   +1.049872059414420e-01   -6.072538685285866e-01];
L2E_L1E_iAMPA_netcon = [+2.517976740606989e-01   +3.947327449640941e-01   +1.707656200252377e-01   +3.936335357107619e-01   -4.563624454556210e-01   -3.363320577341641e-01   +2.600199611360652e-01   +8.478984611118378e-01; -6.695823451918682e-01   +4.879282237280024e-01   -8.748286748003010e-01   +4.515523084987927e-01   -4.723404449973148e-01   -2.153791450737023e-01   +3.622935779470403e-01   +6.812307842803088e-01; +2.112744705436550e-01   -1.191525116439075e-02   +5.207953282346108e-01   +2.806333817777576e-01   -2.515256543525317e-01   -9.294813408725451e-01   +3.549244966870159e-01   -6.626075897209212e-01; +2.423673552386724e-01   +3.954924738854693e-01   -1.624128690805124e-01   +3.005938879369734e-01   -3.993319046428233e-01   -4.398817704189411e-04   +2.274764548034488e-01   +5.265526335948982e-02; -3.514369821765263e-01   +3.454561159729456e-01   -3.759222680706564e-01   +1.113401015084413e-01   -3.891424467348547e-01   +4.414880009923638e-01   -6.438407665719196e-01   -9.351906691312865e-01; +1.000000000000000e+00   +4.338314200536578e-01   +1.367245844698358e-02   +3.681301017090961e-01   -1.727642004086175e-01   -2.492739655940382e-01   -8.542359712607456e-02   +4.016967669945224e-01; +5.202759841691723e-01   +4.999631932157320e-01   +1.829360979194762e-01   -9.670442004469401e-01   +7.773306296331436e-01   +4.940889987293934e-01   -4.821830116015224e-01   +1.525776492003859e-01; -2.898222436667999e-01   -3.506512475058924e-02   -5.353924705742453e-01   -5.442265124055019e-01   -1.066237525745012e-01   -6.871959141215297e-02   +3.894187077751251e-01   +1.619220985993393e-01; -8.307923827089707e-02   +1.198716461564691e-01   +4.149867754981945e-01   +2.209546626755219e-01   +6.037174205761556e-01   -5.357256753396520e-01   +7.285072128317447e-01   +1.492088343149368e-01; -8.130551998597750e-02   +2.219364089759259e-01   +1.040837476203768e-01   -5.087871912055374e-02   -7.407503437856232e-02   +1.106561180371979e-01   +8.285867292773243e-02   -4.548122425506153e-01; -2.058180689016288e-01   -6.579832475851481e-01   +2.530420485886702e-01   -4.711948206765137e-01   +1.908014063082759e-01   -3.732812396280452e-01   +4.028442169370520e-01   +9.934982133338785e-02; -6.639211113001686e-01   -1.407174438057580e-01   -1.854687575448875e-01   -3.072062632770747e-02   -5.982839907364346e-01   +6.517888705528472e-01   -3.647479032777223e-01   -3.902315462163222e-02; +2.630728270576022e-01   -1.975874356488575e-02   -4.203797804536765e-01   -2.236579014685908e-01   +4.235497874003642e-01   -7.835935460125592e-01   +1.068246726638094e-01   -7.875498233720772e-01; -6.633910464014184e-01   +5.445708555733892e-01   +1.851485249927582e-02   +3.226875171443251e-01   +2.722669840192691e-01   +5.776024816360766e-01   -7.779909653435650e-01   -3.943753348423525e-01; +5.286803874714867e-01   +3.406607585536746e-01   -5.416460631003307e-01   +6.403329140295289e-01   +4.815768743460779e-01   +5.649227952843976e-02   -1.456819137505684e-01   -2.216094908956681e-01; +2.923449734505053e-01   +6.204472866943550e-01   -9.097790663654703e-01   -2.031266005963492e-01   +4.515490338052741e-01   +2.924018722331233e-02   -3.495550044722446e-01   +6.179616241997953e-01];
L1E_L2E_iAMPA_netcon = [-4.128359624356187e-01   +6.654982557716217e-01   +6.652462146077411e-01   -1.121280144705921e-01   +5.426304627055093e-01   +1.166318837109877e-01   +2.358813741025768e-01   +7.112658136906217e-01   -5.224158340562852e-02   +8.010291893863482e-01   -2.655209313159564e-01   +3.239568138004918e-01   +6.349120100883830e-01   +8.160766543280603e-01   +2.659322060561715e-01   +7.470415833801418e-02; -2.055461736726303e-01   +4.221742321736477e-01   -1.754576334606561e-01   +5.770946300856282e-01   -1.744434202573150e-01   -4.185346667625534e-01   -2.494297627188985e-02   +8.105740251526315e-01   +5.082246574844187e-01   +6.559759757584747e-01   -1.000000000000000e+00   -6.011416806373268e-01   +2.968690780079363e-01   -5.468156423089059e-01   +2.279491605170731e-01   +1.581188655735976e-01; -8.393446815024002e-01   +3.418007661249031e-01   -6.735983840838666e-01   +3.357995873004761e-01   +1.580430991555077e-01   -2.938285509945847e-01   +3.222076178604976e-01   +4.366097953850455e-01   -5.428894909998685e-01   -2.303906099119905e-01   -3.753316083335260e-01   +1.371674521861145e-02   +3.262323856382126e-01   +6.891174671337610e-01   +3.548603749159135e-02   +2.937436793297556e-02; +4.424164590292004e-01   +5.477687574407041e-01   -4.822254291816985e-01   -5.880191032199945e-01   -4.914603086410966e-01   +3.057246079276773e-01   -2.544060175194774e-01   +5.768052221899266e-01   -1.248293241860177e-01   -5.130371730886121e-01   +4.040923328439240e-01   +4.793331718109537e-02   +5.380088413038290e-02   +9.423693282622587e-02   -8.660108611391789e-01   -5.606386519487573e-01; +6.274066796643385e-01   -4.296518191702469e-01   -6.009251543463044e-01   +3.382840365638476e-01   +3.696632853194466e-01   -2.635389940634374e-01   -1.057376959762863e-01   -4.581439925527286e-01   +6.726205410786882e-01   +2.853825232142052e-01   +8.333592871668075e-02   -1.945845065725244e-01   -4.525114334348270e-01   +3.807846803667130e-01   -8.319964908416942e-01   -5.131462144642865e-01; +3.269463169795372e-02   -6.546695180160136e-02   -7.668859210020165e-01   +5.449861218512270e-01   +4.416340870221497e-01   -4.709978393683840e-01   -2.319806344519336e-01   -5.166923726218377e-02   -4.240842520654499e-01   -3.294690104343482e-01   +6.881012106819067e-01   -7.475175077321594e-01   -4.049370972346615e-01   -5.970823251622331e-01   +2.262933456104184e-01   -2.487322650998366e-01; -1.549063462721317e-01   +1.275954110008539e-01   +3.283609630841044e-01   +6.246925252651936e-02   -3.698937509556294e-02   +5.453257798806513e-01   +8.409049838005451e-01   -3.675575317352074e-01   -6.961586975824836e-01   -3.000698667305866e-01   -2.294901214840746e-01   -1.671178740547782e-01   +2.629126319403329e-01   -3.883338788594507e-01   +6.951237645480424e-01   -5.487759371609905e-01; -3.352993836928300e-01   +8.542538049559525e-02   -2.686531635907927e-02   -7.982452737122819e-01   +4.347208256864536e-01   -7.191427980444862e-01   +2.330381034594846e-01   -7.436976619553787e-01   -6.165727521541270e-01   +2.935932496202260e-01   -9.384041876717765e-02   -5.543399306799599e-01   -5.815334908740206e-01   +5.345775724243729e-02   +1.860396013927549e-01   -5.697184684460977e-01];
L2I_L2E_iAMPA_netcon = [-7.278861914604625e-01   +2.378780317532642e-01   -4.309054657888204e-02   +6.333272464734551e-01   +1.916208862471586e-01   -4.686498161380146e-01   +7.211845654607628e-01   +2.114127778023521e-01; -3.756836788267879e-01   +1.084081492588469e-01   -2.654711725389018e-01   +7.436890998191630e-01   +4.932014943320018e-01   +7.346620680168996e-01   -6.734285235032572e-01   -8.695984358979664e-01; -1.061229556843838e-01   +5.276901034363837e-01   -2.121823557932568e-01   -4.728082984839477e-01   +3.761954769886031e-01   +4.125969173905943e-01   +1.572636684175904e-01   +9.469969387033174e-01; -2.010521973325775e-01   +3.965463099218621e-01   -2.809168384596431e-01   -1.167807235030740e-01   +6.417968951917915e-01   +3.657137124461670e-01   +4.377711281078554e-01   -2.847085326607541e-01; +5.364178499177685e-01   -4.197443981414195e-01   -3.667378007493415e-01   -6.770484436057195e-01   -6.264588969369740e-01   -5.832074370800751e-01   +9.836643172824205e-01   -2.100743197826664e-02; +5.487534502952557e-01   -1.127043152011655e-01   -2.665587837331139e-01   -2.079871820753509e-02   +8.250992096861587e-01   -1.802990404081718e-01   +2.269407368561594e-01   +4.357315764386539e-01; +2.646539745877742e-01   -5.292428207104388e-01   -4.148501162637683e-01   -2.601796249442965e-01   -1.836534527130665e-01   -8.086880371814462e-01   +1.311170814226829e-02   +4.252362604949080e-01; +7.101378775181209e-01   +1.594280796996045e-01   +4.737285139630424e-01   +3.444209208727509e-01   +1.000000000000000e+00   -3.675823174623368e-01   +1.199533891848631e-01   -1.819817130691792e-01];
L2E_L2I_iGABA_netcon = [-4.225081661021127e-01   -7.922623650427584e-01   +3.234304876022362e-01   -6.513429362514598e-03   +2.294832848333571e-02   -1.641336523980982e-01   -4.243671627912651e-01   -3.556034992007061e-01; -5.276167523760921e-01   -7.796509479791285e-02   -2.715562726332332e-01   -5.538236644351303e-01   -1.426267122760435e-01   +4.042867573168721e-01   -6.305731768728602e-01   -1.000000000000000e+00; +1.259447227636816e-01   -2.804950809854454e-01   -4.698641746253900e-01   +5.557133033222535e-01   -4.779757257431414e-01   -6.182337113122210e-01   +9.543789147431692e-02   -6.809654926757857e-01; -3.116789578219410e-01   +4.285884148227805e-01   -7.116496880380451e-01   +5.824466480794143e-01   -3.936979066404253e-01   +1.506244078774753e-01   -2.223426090517051e-02   +2.448403017961266e-01; +6.853336143801441e-01   -2.856849825001533e-02   +1.092077648567656e-01   -8.684933719833255e-01   +4.327694243006348e-01   +3.636149737334189e-02   -2.211673211659301e-01   +1.473368540978622e-01; +2.124829765570530e-01   -2.025051434744502e-01   -3.176288100832504e-01   -4.994155001834302e-01   +2.857520956410369e-01   -4.383107599860266e-01   +6.082714009325967e-02   +5.263575087700054e-02; -9.870905484951884e-01   +1.860535600853316e-01   +2.713206047789949e-01   +4.775406036712219e-01   -2.443408253529947e-01   +1.058679386630780e-01   -9.883832043466279e-02   -7.742707739429165e-01; +6.544802008502227e-01   -5.369487788519870e-01   -4.366477657368384e-01   -4.361055790993419e-01   +1.196063604812280e-01   -7.628938301308806e-01   +1.165762781097358e-01   -1.719716646009652e-01];
L3E_L2E_iAMPA_netcon = [-4.041610387459337e-01   +6.196144752006367e-01   +7.973753469543627e-01   +8.053629715691958e-01   -6.376661840621474e-01   +3.272741183272131e-01   -4.477967734343524e-01   -5.277239254543823e-01   -4.941798738343315e-01   +2.013346902241840e-01   +4.581213396289543e-01   +3.497271095715393e-01; -5.697764671423229e-01   +7.936368530095207e-01   +1.669961320315870e-01   -7.149259493166468e-01   +4.174439513001644e-01   +5.476999784615034e-01   -4.859828684383306e-01   -7.388745654761590e-01   +3.830909089050294e-03   +8.804061177845650e-02   +4.046454335424834e-01   -3.645488761980068e-02; +3.398247870952597e-01   -4.809644584155289e-01   +8.646655248287280e-01   -5.699076156520668e-01   -3.068377331411487e-01   +6.649085353336229e-02   +3.550222284060054e-01   +1.680184602575079e-01   +1.641414657238956e-02   -7.318224704794676e-01   -1.606791372645257e-01   -3.497159783124948e-01; -2.557395373183439e-01   -4.782677222623528e-02   +8.836230702473458e-02   +2.712380587633720e-01   +1.020690545648235e-01   +3.600038469786194e-01   +7.871021329500999e-02   +4.163440455419127e-01   -1.521144200273607e-01   +7.820811111840954e-03   -3.418531732372547e-01   +1.000000000000000e+00; -7.317638272098229e-01   -6.525215491221048e-01   +4.402852246420497e-02   -6.755439785079660e-01   +4.818732484322305e-01   +4.565245208241080e-01   +7.225961377657215e-01   -1.784013174629996e-01   -2.968622374166219e-01   -1.454515029710337e-01   -7.249073559603486e-01   +8.417020823088703e-02; -4.722121159384056e-01   +2.258734433950050e-01   -4.467401517818181e-01   -4.889311400002942e-01   -2.090053264457390e-01   +6.859733335152579e-01   -5.879516283054393e-01   +9.076944781757702e-01   +4.302639081783908e-01   +1.624835679995948e-01   -3.507677656894405e-01   +6.965916491618194e-01; +8.964258934221503e-02   +3.073145208948677e-01   -2.782130241532408e-01   +2.007560658633983e-01   -3.560359823352975e-01   +3.225254401676943e-01   +4.404507833791836e-01   +3.442153101354335e-01   +1.506921523053061e-03   +7.676307052635288e-01   -5.260682633599316e-01   -3.892585774130177e-01; -4.532654774304619e-01   +8.318667971559940e-01   +9.877916731373280e-01   +1.155414562425319e-01   +4.821598787785223e-01   +9.683187685628618e-02   -8.349303888124193e-02   +5.482669466642357e-01   -1.796863313171264e-01   +6.809626731216204e-01   +2.146904443036284e-01   -5.019750888630357e-01];
L3I_L2I_iGABA_netcon = [-3.315867288508484e-01   +2.324614508634077e-01   -2.007291136966249e-01   +1.435909143303551e-02   +2.144569625379549e-01   -5.400462469722740e-01   +3.974831679144240e-01   -6.018803468418115e-02   -5.471710210235317e-01   -7.377451299997764e-02   -1.972044158315094e-01   +5.981294376996237e-01; +5.144314865467784e-01   +1.209865159646368e-02   +3.406475156098800e-01   -9.302562074386395e-02   -1.648690040128039e-01   +1.879210230382676e-01   +8.542228476280030e-02   +2.296095124063221e-01   -5.586987801990176e-01   +7.073687208760681e-01   -5.025664798673587e-01   -3.139327688003843e-01; +5.303037090538244e-02   -1.334573363889720e-01   +8.169453763112079e-02   -1.711785566297392e-01   -3.160481755032207e-01   +5.750798302581053e-01   +2.470910425078652e-01   -3.008162794652024e-01   +2.196990783529138e-01   +5.252079518463031e-01   +3.673360434925881e-01   -3.507344243012360e-01; +5.708582706312028e-01   +1.252152409682234e-01   -6.973058399404460e-02   -4.281876496363016e-01   -7.831936647180271e-01   +2.761042300002060e-01   -3.650765973841064e-01   +3.844769421428564e-01   -3.703002381687675e-01   +6.271421302699169e-01   +3.869850345400998e-01   +9.856741754625992e-01; -5.769563920935674e-01   -5.322353422566894e-01   -2.403994652113691e-01   -6.485495563540385e-01   -1.166561951865508e-01   +5.610344866176640e-01   +9.512400071916750e-01   -1.268701723531777e-01   -4.779341625979257e-01   -1.385729943713879e-01   +5.108828528120102e-02   -4.596274919297295e-01; +6.207766749750138e-01   -8.232131306486041e-01   -5.211751040006811e-01   -3.917314926280471e-01   +1.410528179480599e-01   +3.679017939937355e-01   +1.457938367734086e-01   -2.724982077509747e-01   -6.460939862340639e-01   +3.762360591305971e-01   -3.424030019926317e-01   +1.693105618646173e-01; -1.721369708150148e-01   +6.742026189487070e-01   +1.965742803575402e-01   -1.771960933814828e-01   -1.000000000000000e+00   -3.828633412655353e-01   -1.214328758637982e-01   +3.928673959581234e-01   +4.550574757348383e-01   +1.574238829774177e-01   -1.430371547310062e-02   -1.413658433610854e-01; -2.241745014622565e-01   -1.489441793948075e-01   -3.554244471472988e-01   -6.985058694615741e-01   -1.468998158663819e-01   +6.795343504037012e-02   -3.989119817950246e-01   -4.530430390111088e-01   +9.287618273593606e-01   -3.853144851917605e-01   +2.005036489604144e-01   -3.936450958711192e-01];
L2E_L3E_iAMPA_netcon = [+5.307841730499728e-01   +6.912864784368460e-02   +6.782289716353423e-01   -2.808680727782934e-01   +2.324594220092156e-02   -2.035664908027825e-01   +4.270618360659597e-01   -2.963341704909099e-01; -3.386885911682496e-01   -2.764859838131818e-01   +5.318134269071280e-01   +3.749324073041047e-01   +5.789458176752896e-02   -5.776443889315714e-01   -1.000000000000000e+00   -1.257724366688113e-01; -4.796139392633993e-01   -7.732026959905838e-01   -7.831900503828641e-02   -4.488071131885043e-01   -2.303685481443924e-01   -4.060042287094646e-01   -1.723461650126376e-01   +1.083274886142819e-01; -1.414887753641161e-01   -1.611000323199256e-01   +9.773624064247680e-02   +4.198969786822409e-01   -6.289604988754002e-01   +1.839024295932251e-01   -8.148505015403033e-01   +1.461788265591882e-01; -3.495565010346464e-02   +2.223125010111789e-01   +4.553071100610159e-01   +1.255061081636590e-01   -3.817715755093020e-01   -3.369947554574430e-01   +7.332687802730242e-01   +6.625598316391312e-01; -3.204094733537765e-01   -2.601033912460429e-01   -7.352514713960541e-01   -2.020015002398313e-01   +3.621293801736077e-01   -7.451923987725979e-02   +7.777729664717055e-02   -1.984345106261418e-01; -5.125350039845705e-02   -7.464525087470669e-01   -9.919839635867116e-02   +6.600310185362168e-02   -3.080557067517092e-01   -6.015665192405185e-01   -2.796240388628461e-01   +3.456168458521887e-01; +4.798152181147278e-01   +1.488220488365138e-01   -8.292303887733415e-02   -4.008784789990255e-01   +5.056979977422683e-01   -4.462329660335880e-01   -6.423166796686913e-01   -6.464631988317140e-01; +3.177931490083008e-01   +5.648559509306591e-01   +5.167354950817916e-01   -4.010339115872488e-02   +7.885508303075925e-03   +7.073308036369577e-02   -8.620221742003483e-01   -1.968445431129007e-01; +3.264798875420821e-01   +1.312087409286377e-01   -1.355737452747008e-01   +3.347873184158842e-01   +8.362345037535560e-01   -7.075455297741180e-01   +1.175499020563895e-01   +8.268301328149226e-02; +6.144770002848771e-01   -6.233640061681288e-01   -9.748340196361729e-02   +8.574086646786476e-02   +2.822856460512889e-03   +4.824513328328828e-01   +4.030529663350005e-01   -9.073266666523359e-01; +7.582510628739286e-01   +2.170722486545384e-01   +4.565477385811091e-01   +5.557342743559871e-01   +6.486346835793667e-01   +4.509572446112198e-01   -4.978729403579945e-02   +1.341290261558377e-01];
L2I_L3I_iGABA_netcon = [-2.817183866766156e-01   -4.862452702935670e-01   +4.529934338873584e-01   -6.640035677644849e-01   -6.648277128267213e-02   -2.211797798610170e-01   -6.759174203406302e-01   -6.551466494877302e-02; +5.231441075379401e-01   -8.161004358329282e-01   -4.111892012213455e-01   +2.737098609613527e-01   +5.299393352988211e-01   -5.465456925647201e-01   -3.637069451874623e-01   -6.532814507336755e-01; +6.110339525669451e-01   +4.729281905423339e-01   +6.505381510788226e-01   -6.632728975913082e-03   -2.297032078100590e-01   +3.606537076910538e-01   -5.382806990181621e-01   +2.098329108894411e-01; +7.000179084216200e-01   -2.268752532897961e-01   -2.456726528179466e-01   -5.422799027628482e-01   -2.949812217928850e-01   -6.488936657380795e-01   +7.718000739772312e-01   +1.000000000000000e+00; -7.219750985942081e-01   -3.024749704621074e-01   -6.753632645297700e-02   +5.019941837443265e-02   +7.782130065866831e-01   +1.792369190032320e-01   +2.678545440527061e-01   +9.575821590412186e-01; -1.315730363505556e-01   -4.637444723473573e-01   +4.318750486634677e-01   +1.596646399255319e-01   +5.673632581199772e-01   -9.582518820822628e-02   +1.010877461382528e-01   +1.242965298090823e-01; +8.582740142850297e-01   -2.899254539119913e-01   -3.126443013836025e-03   -6.721310782946296e-02   +1.023496041305854e-01   -3.500781642813250e-01   -4.211793627766417e-02   -2.217401268161944e-01; -2.696685089422443e-01   -1.155223789565146e-01   +2.496595386976016e-02   +4.380288513438728e-01   -3.500818523835033e-01   +7.302467540001530e-02   +3.435890695063972e-01   -7.535497371534861e-01; +2.933817963844929e-01   -3.274078541496308e-01   +4.910968222780943e-01   +5.770418696233514e-01   -6.267883965342835e-01   +3.083349419275966e-01   -5.840284236581074e-01   -1.673898597339002e-01; -3.171431746306639e-01   -5.901387399504102e-01   -5.053807895468895e-02   +5.456865052466797e-01   +1.764130005429580e-01   -5.271631699436241e-01   -6.569847340652505e-01   -4.090572010469907e-01; +4.424037328183661e-01   +2.011749414642041e-01   +5.007727394381349e-01   +2.813213137421302e-01   -4.609612817899936e-01   -2.786894233697398e-01   -1.383618836207430e-01   -5.802085003613512e-01; +8.985902210465394e-02   -1.483598167563943e-04   -4.753445129514207e-01   -5.501268793500116e-01   +7.349478424972780e-01   +5.861519415906896e-01   -1.215568292394565e-01   -1.349972527344625e-01];
L3I_L3E_iAMPA_netcon = [+1.814757246859539e-01   -5.238036209433814e-01   -6.636190446962239e-01   +5.563214721101315e-01   -4.987580718407424e-01   -5.851657627701441e-01   -3.555515986806926e-01   +3.007441897366718e-01   +6.300250051665068e-01   -5.087562991562535e-01   -4.142051554722210e-01   -4.807948733429850e-02; -3.780757390545397e-01   -4.393931567756076e-01   +3.702571701932951e-01   +3.259196578046952e-01   -4.049904978044995e-02   +1.746045396592589e-01   +3.285415330671918e-01   +5.270083994786191e-01   -2.525947751203139e-01   -4.596077046548281e-01   +4.651319067263247e-01   +7.341575828767990e-01; +5.508831110296227e-01   +3.876512410921826e-01   +7.874954479517106e-01   -2.572348037478627e-01   +2.009234716421664e-01   +4.538043784528164e-02   -3.172365021240371e-02   +5.993706599738409e-01   +2.796735186817325e-01   +2.082578776663555e-01   -1.864509254099495e-01   -1.330431743462457e-01; +3.452969014877859e-01   +1.438938742848211e-01   +1.987918369761022e-01   +5.223894829572574e-01   +8.947875191277850e-02   -4.959363133911022e-01   +6.760773511590792e-02   -6.019008779180307e-01   +2.354297744298486e-01   -4.741154238768713e-01   -5.790716551809277e-01   -2.962141647031029e-01; -5.544240865313157e-02   -3.173434310717351e-01   +2.014078409999628e-01   +1.954583056416190e-01   -6.351890145899526e-01   -1.000000000000000e+00   -5.714943551406086e-01   -3.594893809346588e-01   +4.823994060141143e-01   +1.400922528432753e-03   -1.594512519216662e-01   -4.165265688379553e-01; -6.975501829780252e-01   +1.697671349430135e-01   +3.198550753425234e-01   -2.063063373656571e-01   +3.640564890029724e-01   -2.992859923507955e-01   +1.638353622526340e-01   +5.427071344594492e-01   -7.475507205660910e-01   -4.465389018620347e-01   +6.847210927701615e-01   -3.407338997436649e-01; -5.693645034545112e-01   -1.455455179712995e-01   -2.863216714849368e-01   -5.535128933993997e-01   -6.857774876766269e-01   +1.209743544523498e-01   -2.888664216063902e-01   -3.045617123244203e-01   -1.963606913323926e-01   -5.894147943837110e-01   +4.940022779543723e-02   +2.870723851834606e-01; -5.567437117619325e-01   -2.110355482624205e-01   +7.292588946977858e-01   +1.826930377352626e-01   +2.798059156167712e-01   -5.285034400420279e-01   -4.833214928925513e-01   +9.130979078515644e-02   -3.576318429654267e-01   -2.081724241435939e-01   -4.714696100403958e-01   +3.199706934133589e-01; -7.160415190914387e-03   +2.246241315356488e-01   -4.141348089361820e-01   -1.953002457358467e-02   +1.776734487815940e-01   +5.491769553956868e-01   -6.079006576935372e-01   +7.129930867493031e-01   +5.749797323457252e-01   +9.820802030291635e-02   +3.448235395414535e-02   +3.972571691169139e-01; +4.914630582957911e-01   -4.532188191325002e-01   -6.509463643784953e-02   -4.195660882290997e-01   +4.734418761211374e-01   +7.442602306455456e-01   +3.468699686129245e-01   -5.656537039307766e-01   +1.303994008152494e-01   -3.409844237139260e-01   +7.701967316837568e-01   +2.038022657239763e-01; +2.636493697359760e-01   +5.821850602796200e-02   +2.093488427864778e-01   -3.339194044685816e-01   -3.901313645141909e-01   +7.314227104774612e-01   +9.299201850465205e-02   -9.771800640636216e-02   +5.668446664179415e-01   +8.059107830148715e-02   -8.973986521802368e-02   -4.712561623017600e-01; -2.281843309601921e-01   -3.199788638970662e-02   +1.568661069900309e-01   -4.233860925768894e-01   -7.413845823929959e-01   +1.435711492507478e-01   +4.515864641394421e-02   +6.231051493676263e-01   -6.232247342584878e-01   +3.747222328256686e-01   -2.627079546332694e-01   +4.194791247950573e-01];
L3E_L3I_iGABA_netcon = [+4.484480588236571e-01   +3.451076927853018e-01   -1.486998629587316e-01   -3.791652575183804e-01   -5.015050338661411e-01   -1.360389825314378e-01   -1.352342034035326e-01   -2.900456411480821e-01   -6.698560372858141e-02   -1.285495494154746e-01   -6.785074517156892e-02   -3.818638027150682e-01; +5.063280230995070e-01   +8.055988572755034e-01   -3.090521119074358e-01   -7.822339544686487e-01   -3.705636831919095e-01   -7.928611332176382e-01   -5.308649705380802e-01   -3.849483923745715e-01   +6.434781385610175e-01   -5.652346390708016e-01   +7.128617512852951e-01   +4.739464808981775e-01; -3.733819238736184e-01   +2.473878950888169e-01   +1.287102149325528e-01   +3.726759107513443e-01   +4.502865230817496e-01   -1.684838236924723e-01   +4.370208162449501e-01   -4.620031451004248e-01   -3.569542535799308e-01   +4.938291242447047e-01   -5.943728273882821e-01   -1.379596675078884e-01; +1.477836547727032e-01   +7.242353020258842e-02   +3.359897140640601e-01   +2.163075892746686e-01   -3.047373085260300e-01   -3.166205878517404e-01   -6.588857056962687e-01   +7.203235423038650e-01   +3.176041392640577e-01   +9.012467907038931e-01   -4.399005241938108e-01   +7.409677956834534e-01; -3.420280203673312e-01   -2.652673469089277e-02   +5.158733245928282e-01   +6.140280999809755e-01   -1.624469183950263e-01   -1.473499920965508e-03   -3.868348151478573e-01   -7.037209716657220e-01   -1.060308962568755e-01   -6.417906585960527e-01   -4.645822836741681e-01   +1.417623566345594e-01; +4.783787047199583e-01   +2.074679311345976e-01   +3.455791957368294e-01   +1.048659362123193e-01   +3.701002356419247e-01   +3.365334148814159e-02   -5.951067830529791e-01   +6.501411819224133e-02   -5.089223757636675e-03   +5.232247961380988e-01   -3.855250277931824e-01   -8.134965187312193e-02; +7.562395091600100e-01   -6.373116547581736e-01   +6.328256682942149e-01   +2.625482313189814e-01   -3.374674469635700e-01   +1.776019945523976e-01   -1.094674122859812e-01   -5.065188449896126e-01   +1.386101654422218e-01   -1.136979597829811e-01   -1.362178669383498e-01   +4.314837860445136e-01; -4.274092392075019e-01   +2.622497094264833e-01   -4.024253210657089e-01   -7.107632992621652e-01   +5.180412838194536e-02   +1.034128030623058e-01   -2.894085207689591e-01   +1.000000000000000e+00   +1.333670864451885e-01   -3.925554488348275e-01   +7.277118216484484e-01   -2.746223866827408e-02; -5.379183376434469e-01   +6.269093457654168e-01   -7.073005873517054e-01   -7.463120549066389e-01   -1.396332798553611e-01   +5.765225754459397e-01   +6.916903500959698e-01   +2.865158139274538e-01   +4.095774169134307e-02   +2.738217250463743e-01   -5.096543656780422e-01   +3.593361921745723e-02; +4.846998286639603e-01   +4.339953047938024e-01   +6.676184926522166e-01   -1.348513050989552e-01   -4.814503274403273e-01   -7.928970780783589e-01   +3.314947712537031e-01   +1.529221319454635e-02   +7.343897977123026e-02   -8.555313317493386e-02   +3.344382730104569e-01   +1.872121528158262e-01; +7.831414545314454e-02   -3.472158101633703e-01   -3.122999903898553e-01   -5.061752165461657e-01   -1.904699828656972e-01   -7.210892354652588e-01   -1.555845073845205e-01   +6.284979199292274e-01   +2.010257481457491e-02   -1.720058486246802e-01   +2.373977829105029e-01   -4.187593733319663e-02; +3.038859661137441e-01   -4.672073934082272e-01   -2.865500613648313e-01   +5.388663325717943e-01   +1.731737517990549e-01   -1.228179987666501e-01   +5.752002206298947e-01   +2.133841330700830e-02   +8.745191022916620e-01   -4.459518699475930e-02   +9.403266072838600e-01   +1.982297730822617e-01];
L2E_Input1_iAMPA_netcon = [-4.477361252467985e-02   -6.069622552979002e-02   +5.533961196890034e-01   +9.441547502411027e-01   -7.952925635356249e-01   -5.424662190962624e-01   +5.334447309159185e-02   +6.109304451391786e-01];
L2I_Input2_iAMPA_netcon = [+3.821748883603732e-02   -1.121217311265933e-01   +4.322145321154834e-01   +1.417915726819954e-01   +3.836858994473564e-01   +5.122191057226677e-01   -7.591624135277664e-02   -2.816672624755411e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
