function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.339747196665863e-04   +7.481333500072432e-03   +1.105178894650427e-02   +1.371872740260521e-02   -1.123171358008848e-03   +1.180329177599426e-02   +4.712237073861181e-03   -1.213883680217995e-03   -3.263534955801360e-03   +9.619398174155191e-03   +7.873363521066332e-03   +2.788717594964390e-03   +1.010385490449954e-02   +4.369992670177428e-03   +5.068538865515865e-03   -5.796984344407058e-03; +6.202539270033349e-03   -7.706520993820145e-04   +1.091098729371867e-02   +9.499378853326697e-03   +2.599019931692528e-03   -9.280306527082055e-04   +7.878720031578917e-03   +4.047157603505864e-03   +4.382276436723330e-03   +1.104751593273647e-02   +8.812503711550353e-03   +2.479905301854509e-03   -5.102844441584929e-03   -3.388870835550031e-03   +1.198559016528393e-03   -1.613961456944495e-03; +4.278789042084449e-03   +5.574784855626889e-03   +9.481860403188502e-03   +8.958499594832673e-03   -5.001503250194740e-03   +8.202357943770704e-03   +1.173291003295720e-02   +4.909262776563265e-03   +2.920553641994480e-03   +4.759485059383266e-03   +9.595396302818698e-03   -1.757763721737139e-03   +6.113440161167607e-03   +3.636184987958696e-03   +6.074802157295944e-03   +4.157302439721331e-03; +1.451703882282955e-03   +7.200218687011737e-04   -2.638623571699714e-03   +1.850596043383855e-03   -7.562887006696800e-04   +4.008973292636862e-03   +5.940011124318498e-03   +2.636342812333586e-03   +8.672080247597681e-03   +1.526915906267759e-03   +1.332885798821220e-02   +6.023321136519103e-03   +4.248073920536062e-03   +1.056925334731280e-02   +3.298294975842293e-03   +2.924291780390838e-03; +3.316062566972143e-03   +3.409116102550429e-03   -9.173693554366080e-05   +7.961590323983784e-03   +1.058184377413184e-02   +9.963528393827935e-03   +3.019588331187787e-03   +1.868066599661979e-04   +3.523296863880820e-03   +1.081361527852924e-02   +2.562765895499536e-03   +4.748996807259268e-03   -2.507886034001302e-03   +7.836867308309762e-03   +9.135746675174170e-03   -4.562928663015268e-03; +1.114781265558591e-02   +4.781849486420486e-03   +4.188010846613278e-03   +2.564246437789829e-03   +6.428230720042808e-03   +4.862773343243355e-03   +4.542024929588611e-03   -5.828880866130290e-03   +5.701760517507103e-03   +6.873704083432431e-03   +6.673686567528798e-03   +7.550840579479492e-04   +4.861720629713109e-03   +7.860423091054518e-04   -5.146595905751407e-04   +8.962475345142940e-03; +3.256792453482356e-03   +3.790916167553440e-03   +5.452892640903668e-03   +8.646793696908458e-03   +1.039210415864604e-02   +2.455037612712717e-03   +4.214808305389828e-03   +1.509092878842336e-02   +1.322171211282165e-02   +2.646094951765651e-03   +5.519437077598903e-03   +3.303964819964303e-03   +3.206585858645880e-03   +5.200720951729521e-03   -2.466593344860596e-03   -6.424053958996204e-03; +6.066171412053537e-03   -4.522594375874776e-03   +8.723705890353917e-03   +8.097581063422031e-03   +3.407051993644532e-03   +7.553459814317279e-04   -4.666301208407563e-03   -3.601770714310150e-03   +1.029312017556343e-02   +1.152519513658825e-02   +3.650873838306792e-03   +9.382431799165796e-03   -3.032629228799728e-03   +1.922574889228385e-03   +3.773864229069370e-03   +6.060179066082708e-03; -2.792460485148709e-04   +5.418383738054425e-03   +5.637611798022072e-03   +9.481797208348335e-03   +5.477011809149276e-04   +1.013740246512206e-02   +2.916454477971225e-03   +5.858279987850587e-03   +4.050272741359101e-03   +9.203682838488270e-03   +2.984499485511313e-03   +3.835193895222361e-03   +8.303562079253899e-03   +8.066518531734410e-03   -6.057766379329291e-03   +5.669232021305247e-03; +2.493937021562015e-03   +5.710914856102397e-03   +1.743085175419953e-02   +7.884884221926737e-03   +2.259877881633583e-03   +1.267849399773817e-03   +3.594916501558859e-04   -4.779534173155355e-03   +4.519691181019625e-03   +3.180047725231242e-04   +4.655646134661177e-03   +3.310528815215508e-03   +3.412302210321511e-03   +2.564164126267605e-03   +1.526921641931871e-02   +8.011072347399385e-03; +8.331035483759203e-03   +7.612408097168851e-03   +7.395878381394291e-03   +8.240808489718679e-03   +5.089546734887105e-03   +5.628328596726431e-04   +7.081439991739524e-03   +1.030213116229885e-02   +1.894106590460888e-03   +7.788631499064460e-03   +9.054313593925388e-03   +4.253309795793866e-03   +5.276107150219327e-03   +3.863118753671439e-03   +1.065954608289782e-02   +5.764382140268334e-03; +3.584437675730705e-03   -2.909167088279583e-03   +1.752079636194435e-03   +1.738174479620059e-03   +5.821487910185516e-03   +1.129387652675272e-02   +3.266505853541721e-04   +4.171305899140028e-03   +3.331897701217835e-03   +3.062939810764115e-05   -3.062644289472040e-03   -8.727716881531131e-05   +3.839919050767627e-03   +3.860204507252566e-03   +5.598677384479009e-03   +5.111792194995924e-03; +2.918481145565401e-03   +4.574756330882509e-03   +9.060674498629424e-03   +2.756681029046530e-03   +1.326876431131048e-02   +4.324511901791320e-03   +9.221412157466143e-03   +1.499673217589919e-02   +6.346144386795217e-03   -1.100286059194089e-05   +1.797812493159743e-03   +3.537165567820444e-03   +8.128070953880295e-03   +9.500581991287690e-03   +8.897751554398675e-03   +9.048336040176796e-03; +7.159965900555790e-03   +8.968257051179056e-03   +7.363154853891220e-03   +9.155330964525563e-03   -3.605024288854830e-03   +2.592263552457398e-03   -1.038667937028485e-04   +6.695872943008239e-03   +2.332986265179414e-03   +5.892363700281913e-03   -5.558648227984855e-04   +9.553382668650025e-03   +6.239657271468553e-03   +6.343741984170399e-03   -1.253093318194432e-03   +4.905990482005120e-03; -4.420987637528083e-03   +1.041553079044677e-02   +1.060680339868557e-02   +9.827694142575073e-05   +1.380365189906541e-04   +3.424911733587257e-03   -9.971504122641543e-04   +3.438208697078339e-03   +4.041117845572936e-03   +1.048645102711344e-02   +1.408439147168125e-03   -6.041313499476488e-04   -4.209450515107958e-03   +1.428234801010221e-02   -3.203079004521469e-03   +5.517547068954547e-03; +3.639403069849653e-03   +4.482777512333330e-03   -6.162969949334265e-03   +1.099351093218904e-02   +2.737185620394627e-03   -1.302760809399066e-03   +6.419592491267995e-03   -1.051449590599276e-03   +5.847074043067160e-04   +1.375349571215928e-02   +7.898120376163942e-03   -4.873502621015907e-03   +5.758779372132447e-03   +4.774512185302522e-03   +1.011816720983889e-02   +1.305385425851770e-02];
L1E_L1I_iGABA_netcon = [+5.307666894563447e-03   +8.126871744316193e-03   +1.464317608234804e-03   +5.991014671592068e-03   +5.297184261243183e-03   +3.006723998106150e-03   +6.506342528805538e-03   -1.068777588879977e-03   +5.259753820294193e-04   -1.598833349843707e-03   +7.709773547518295e-04   +2.865523058098583e-03   +7.418495250517947e-03   +1.392066419640313e-02   +5.986271806397718e-04   +7.183056160190967e-03; +3.544499304098016e-03   +2.283016503027564e-03   +8.264093043232432e-03   +4.880925287272990e-03   +1.822511060105841e-03   +6.419795333455082e-03   +1.789407257781622e-04   +8.067087946898636e-03   +4.555837493995379e-03   -4.428070256169565e-03   -3.761353842009315e-03   +9.611734271525762e-03   +1.840641947928926e-04   +2.595554984124887e-03   -7.061513217378875e-04   +8.073441983453666e-03; +3.430124462775775e-03   +9.113645946647351e-03   +3.242629493736038e-03   +3.340610865100666e-03   -3.004350886432351e-07   +7.323776819867098e-03   +5.261157336512991e-03   +4.856336728980873e-03   +5.584242887437450e-03   +1.011507718234414e-02   +6.724747821554230e-03   +3.024709654250922e-03   +1.047089517300768e-02   +8.868570744855232e-03   +4.270190060784291e-03   +1.075768694283981e-02; +1.353378328855209e-03   +3.648753022875795e-03   +1.108582600409101e-02   +5.342417247006037e-03   -3.088161243815060e-03   +7.715109014308186e-03   +3.687021073983186e-03   +6.939807519986373e-03   +8.949467409395416e-03   +6.793615559721449e-03   +1.055513099908885e-02   +1.657833562061891e-03   +3.081471973576289e-03   +5.810052145722749e-03   +4.379356754308840e-03   +5.193977540498869e-03; +3.270104541957086e-03   +7.421623105683458e-03   +7.155755718525081e-03   +5.308762249011214e-03   +2.575958987327620e-03   +7.581449308674296e-03   +5.813224504667619e-03   +6.833993158783182e-03   -2.694069881766375e-03   +2.723845140332492e-04   +5.937624547230460e-03   +7.136824265598828e-03   +8.728655842524756e-04   -7.131046479013903e-04   +4.195916056887092e-03   +2.041826634009074e-03; +1.001159453999097e-02   +7.836722380591341e-03   -1.566900330981760e-03   +9.939409941636279e-03   -1.833936040159061e-03   -4.018402229141775e-03   +1.317974441540074e-02   +2.688375989907102e-03   +5.878318705481261e-03   +3.031562181872479e-03   +9.634065517984835e-03   +2.708171694966102e-03   +7.988987357001270e-03   -1.755450749991446e-03   +8.838341018284615e-04   -2.087305426142303e-03; +8.347723451268593e-03   +3.765193381424293e-03   -3.127163225829531e-03   +6.102672608100311e-03   +5.631323383782257e-03   +7.314519736822929e-03   +1.021396635650205e-02   +6.967637169258304e-03   +6.402950737271536e-03   +2.289189155714994e-03   +1.101355554057707e-02   +1.579928740898697e-02   +8.046456513541855e-03   +2.758281387169518e-03   +5.013925907257372e-03   +2.648520413728505e-03; +3.759782357559841e-03   +9.573095894353182e-05   +1.865448722905933e-03   +1.245913958417888e-03   +6.898027383137064e-03   +2.790638894706330e-03   +1.187800579924762e-02   +5.985016007229012e-03   -3.641310957054340e-03   +6.061693452913205e-03   +5.857136872123429e-03   +8.507433080404296e-03   -3.337581503132876e-04   +2.047494225166716e-03   +2.807311780716184e-03   +4.360012201855247e-03; +2.227669123545594e-03   -3.073234416593561e-03   +5.389809904463546e-03   -5.231305149064420e-03   +6.888339796580957e-03   +1.045787823078882e-02   +1.326323424996893e-02   +1.137391457437477e-02   -6.602092918945694e-04   +4.014590740146390e-03   +9.196426947462562e-03   +1.631261271045319e-03   +8.945644864818782e-03   +1.035179765948986e-02   +2.066052584564326e-03   +9.462069809862939e-03; -2.784734793285713e-03   +3.330207282200287e-03   -4.326387439785153e-03   +9.240872129409366e-03   +3.958232684659928e-03   +1.285648400186014e-02   -2.079712949348193e-04   +2.293745231827479e-03   +9.742001738143165e-03   +7.809877099615559e-03   -3.844191197955027e-03   +1.434413849617077e-02   +9.531798995476086e-03   +6.433392349718054e-03   +9.832089824055331e-03   +5.459339297040172e-03; +1.010145109680120e-02   -3.250270716378706e-03   +2.754785850295226e-03   +2.972439480464403e-03   +1.045870380495245e-02   +7.909409583305373e-04   +8.808561319859329e-03   +1.278191942240712e-02   +3.707249473675344e-03   +2.429726733345183e-03   +7.798447005929333e-03   +8.406570121372393e-03   +4.619455460339048e-03   +1.346934973037028e-02   +7.841350817030130e-03   +1.999666840548139e-04; +4.715721146000833e-03   +6.969190766759785e-03   +1.042102396444021e-02   +4.960103937650698e-03   +5.619529219968132e-03   +5.418088939037544e-03   +4.617770946469882e-03   +2.296142535963326e-03   +5.501289044209358e-03   +2.156669132756242e-03   -5.058561342953813e-03   +6.714372985338966e-03   +1.852205976176329e-03   +2.801119358688577e-03   +2.949902096257624e-03   +2.470056137426853e-03; +9.350989928402357e-03   +5.660724267117358e-03   +1.208135355749597e-02   -1.862851637147964e-03   +3.327952571530747e-03   +5.674941785514563e-03   +4.667792161631568e-03   +1.432257376027075e-04   +1.028855545989647e-02   +7.515884520942982e-03   +3.319611806493761e-03   +7.819323621429805e-03   +1.036847555849241e-02   +5.023882202337231e-04   +1.650212442800974e-03   +4.973015655915087e-03; +1.569768490036980e-03   +4.172798428791679e-03   -1.725267188697308e-04   -3.817928259695377e-03   -7.978685960887181e-04   +8.678799726867607e-03   +1.312885302656642e-02   +6.923826688577706e-03   +3.896780745807341e-03   +6.698616122475527e-03   +8.277037126927032e-03   +8.419087625725680e-03   +9.566343645935319e-03   +1.054456256697202e-02   +6.895210221979194e-03   +3.524099588226362e-03; +1.925116627607723e-03   -2.036679661394283e-03   +3.806405017723861e-03   +1.255959888522968e-02   +4.799955524193031e-03   +1.847599777889555e-03   +1.975815886634256e-03   +1.202189485111658e-03   +3.097766538776067e-03   +3.908959866653060e-03   +1.377937626453871e-03   +9.606191389109503e-03   +3.757212475370709e-03   +2.201960533851193e-03   +1.840272291403541e-03   +6.206612865179126e-03; +4.333216403735477e-03   +1.028633413920533e-03   -3.326607954347520e-04   +5.973513634794942e-03   +9.811014703140707e-03   +5.901424681021891e-03   +7.048648350550496e-03   +8.678410621035491e-03   +9.298481738855320e-03   +1.244803490805000e-03   -1.051738231384762e-03   +6.405734396052347e-03   +5.150699446436488e-03   +5.635037945056013e-03   +4.993275214572473e-03   +1.034834774748409e-02];
L2I_L1I_iGABA_netcon = [+8.880528907198575e-03   -2.200949379046247e-03   -7.598320679106734e-04   +1.273921371792287e-02   +9.004820334942956e-03   +5.611715355252034e-03   +4.282520860475697e-03   +7.600884768133831e-03; +7.662839940010801e-03   +2.657612346813617e-03   -1.054090702765993e-04   +5.164010979054129e-03   +4.271595331683026e-03   +3.765463436795449e-03   +5.876197066875141e-03   -4.297212782586149e-03; +3.173142508471582e-03   +4.245864970557454e-03   -3.389155792620412e-03   +1.046944017652663e-02   +1.378288578886101e-02   +1.437293332924569e-02   +6.406354814030140e-03   +6.905387325612999e-03; +3.348621064964498e-03   +5.396579271475638e-03   +6.355449471723320e-03   +8.714686184583948e-03   +1.090930800801461e-02   +5.286423904657704e-03   +5.370175768201799e-03   +1.099963468789813e-02; +4.131717109384253e-03   +3.380084853037508e-03   +5.910395003769560e-03   +7.861436926172151e-03   +2.980621266627410e-03   +7.549479203152770e-03   +2.152796900350852e-03   +3.485232151888943e-03; +1.255272210778262e-02   +1.009475111153981e-03   +2.685532959496489e-03   +1.021433747574180e-02   +6.863903225030230e-03   +6.501860758694745e-03   -3.723899339082514e-03   +5.582990397895631e-03; -1.553887768875388e-03   +2.988468787646281e-03   +5.321419184852029e-04   +2.648461682740311e-03   +7.959988508247764e-03   +2.217015028621887e-05   +4.509337759623756e-03   +1.311158664032515e-02; +7.628709113395238e-03   +5.286218622775760e-03   +6.485975554054143e-03   +6.530532355263956e-03   -2.779927893287443e-03   +1.082471159131218e-02   +5.392249545507115e-03   +1.450778295579939e-03; +3.151466764805408e-03   +1.609542578671353e-03   +2.711163965722909e-03   +2.259995925759203e-03   +4.658567135862187e-04   +3.516480516468443e-04   +5.223735090627227e-03   +7.122381553109309e-03; +7.466067113188557e-05   +3.716050338012612e-03   -3.232480511303195e-03   +1.650746421002429e-03   +5.689899895537295e-05   -2.317753715028977e-03   +1.037175721134608e-02   +2.961293964766198e-03; +2.179052944746323e-03   +1.150840694507333e-02   +1.135910160145415e-02   +4.779996968187201e-03   +9.815459408965962e-03   +4.962011508940893e-03   +4.857936732308122e-03   +4.177145191452241e-03; +9.958126697220742e-03   +7.832030688625709e-03   +2.001803685129177e-03   +3.810950747403261e-03   +1.213952044986703e-02   +7.128608765313628e-03   +9.828777262240180e-03   +5.492078319458691e-03; -4.376004645518438e-03   +8.292700386102702e-03   +5.047650101457891e-03   +3.880828696657165e-04   +4.326655255787056e-03   +2.616541900489685e-03   +1.085404471167175e-02   +7.611047644568669e-03; +7.182969714304325e-03   +4.955375498648612e-04   +9.445566000354974e-03   +3.037916230579834e-03   +6.979113165996878e-03   -2.946048029090678e-04   +9.805501143848138e-03   +5.696491412272013e-03; +3.157308509746990e-03   +5.040743583726634e-03   +1.275684060858379e-03   +1.138651695466209e-02   +9.906986754574600e-03   -1.652884289807817e-03   +6.779657278522067e-03   +6.353766278607112e-03; +2.605280024959479e-03   +4.897878213229784e-03   +6.506774803803562e-03   +4.582133237250383e-03   +1.023674509039066e-02   -4.736988834925007e-03   +4.982512711287905e-03   +5.499867107937267e-03];
L1I_L2I_iGABA_netcon = [+1.058985945905661e-02   +8.801446195153374e-03   -4.727712490884272e-04   +4.078352275313077e-03   +6.964539626947239e-04   +7.545793248227199e-03   +1.406586633878028e-02   +3.859189081384770e-03   +1.138063663262652e-02   +7.626833458083165e-03   -5.624373537864891e-03   -1.327410962191383e-03   +8.171860037387318e-03   +3.212618441506340e-03   -4.063186288435166e-03   +1.344775470387752e-02; +5.553028573952149e-03   +1.344936605398618e-03   +6.688160023383943e-04   +4.779751114704133e-03   +1.006828033378654e-02   +4.694680737898299e-03   +4.072888788079090e-03   +9.913803800535290e-03   +4.466280549091786e-03   +1.685091425318951e-02   +4.836220551238422e-03   +1.800474657083127e-03   +1.856548607535143e-03   +4.579671074134482e-03   -1.192268466477548e-03   +9.834205398159952e-03; +7.460517972081065e-03   +5.844902591428270e-03   -1.107593469189864e-04   +9.548878816001690e-03   -2.890755336548909e-03   +7.825866220504419e-03   +4.669105390010775e-03   +5.075783592304275e-03   +3.829259990446537e-03   +9.996340780438748e-03   +6.207988373972310e-03   -2.101272357066476e-03   +4.716817658284547e-03   +3.711968698204672e-03   +3.176432740764663e-03   +4.901246706326907e-03; +2.534034824266793e-03   +1.417496957588100e-03   +4.401516228486114e-03   +3.721081569024827e-03   +2.529964994395133e-04   -4.423955629071211e-03   +4.670684008209506e-03   +6.100681832245631e-03   +1.589058751214311e-03   +5.187479600857327e-03   +5.997489456265618e-03   +3.518474332309361e-03   +4.868978052094583e-03   -3.552288940284235e-03   +5.665178928867828e-03   +3.537742785312246e-03; +2.128760920371232e-03   +6.786704233917763e-03   +1.043207382249070e-02   +4.154444570739303e-03   +9.217338297630578e-03   +1.043492791391832e-02   +1.215094610082258e-02   +1.733824371639640e-02   +1.385676848259402e-03   +1.812929445619291e-03   +8.384516640888497e-03   +2.655368908087037e-03   +9.340308612089973e-03   +6.316903856276580e-03   +4.558170151038732e-03   +4.615626325174340e-03; +7.924086101886213e-03   +5.455581001180348e-03   -2.210834691927539e-03   +8.525572530019817e-03   +9.603360018863548e-03   +6.780338277211927e-03   +1.146465660171807e-02   +8.603151151428269e-03   +8.676721432593694e-03   +4.618719308580152e-03   +4.607078229136236e-03   +7.546839760897032e-03   +1.571377513818220e-03   +1.237927762797291e-02   +1.027363207305899e-02   +5.990693128861439e-03; +1.091678207260153e-02   +1.432133384544612e-03   +8.600429720941589e-03   +8.139978664276452e-03   +7.878270647506989e-03   +1.230094857105993e-02   +6.371781360304609e-03   +1.574388823028458e-03   -1.562074162784587e-03   +6.550406351857017e-03   -9.362639890898514e-05   +2.377345935392038e-03   +8.363819556449572e-03   +1.292291289522306e-03   +8.381070930570120e-03   +4.804897551275708e-03; +7.758016585967247e-03   +5.062239661491872e-03   +5.573342169406460e-03   +3.541942706116291e-03   -1.910997223982280e-03   +4.291406353349838e-03   +5.543242853972360e-03   +7.552870755248669e-03   +1.359820976195030e-05   +9.991362212416231e-03   +2.815983919858496e-03   +6.329105713530003e-04   +4.061507339497912e-03   +3.045229523295285e-03   +5.065292152796172e-03   +7.148626179863531e-03];
L2E_L1E_iAMPA_netcon = [+7.824999866707028e-03   +6.145119957757456e-04   +3.600984383381601e-04   +1.923340532634595e-03   -4.907073445394825e-03   +9.302435192781029e-04   +6.372393106747170e-03   +8.743965871533458e-05; +8.847387381016033e-03   +6.995409592746404e-03   +6.837972218318110e-03   +7.069480002315055e-03   +1.385373173627067e-02   -8.896901506066312e-04   +1.108093556590551e-02   +5.941078428400193e-03; -2.670977251005284e-03   +2.873326453622308e-03   +4.874798965664911e-03   +5.893485554741862e-03   +3.465315150692995e-03   +1.105198193704660e-02   +2.714529410385763e-03   +4.381584349203523e-03; -2.475563167628536e-03   +7.563499966962606e-03   +2.671290899657723e-03   +1.085438410498635e-02   +1.274567000342647e-02   +6.603307742192442e-03   +7.062006778582929e-03   +8.928684296672389e-03; +1.197348561751547e-03   +1.132758758820759e-02   -2.065703455897822e-03   -4.088436432183644e-03   +7.613642617872836e-03   +6.186935928636423e-03   +1.341083415823505e-02   +5.090761365648296e-03; +3.643121772226881e-03   +4.326366515725582e-03   +1.243381538637866e-02   +1.208069973922686e-02   +1.047445160521722e-02   -2.280376045965853e-03   +4.977422684352625e-03   +7.329339777481428e-03; +3.311336830141840e-03   +4.600790518561048e-03   -1.954986277138672e-03   +2.722298302635826e-04   +5.335605197599349e-03   +1.411952459495134e-03   -6.771231900266309e-04   +6.560451974081451e-03; -1.599894978909670e-03   -4.286514370695811e-03   +2.010808231022324e-03   +1.143706809538813e-02   +3.651271156102540e-03   +6.917303799208059e-03   +8.794844396901908e-03   +8.970788375953061e-03; +4.641391910680985e-03   +9.594375822316483e-03   -2.301804979114482e-03   +3.772706767855527e-03   +6.492724495259074e-04   +8.773202036719295e-03   +8.630208447927220e-03   +5.646993753231125e-03; +7.947764711588185e-03   -2.190209221059801e-03   +7.924054716660295e-03   +6.059512185604300e-03   +1.438368555585690e-02   +1.482679750358259e-04   -3.761493117261757e-03   +5.625725256215935e-03; +1.113737943254170e-02   +4.725621787962125e-03   -5.915130831520509e-03   +3.509237423251402e-03   +7.523984066967101e-03   -3.272284297385189e-03   +8.139982261403280e-03   +9.952175441628007e-03; -2.835540157763969e-03   +4.378765802836138e-03   +8.709596243322348e-03   +2.408010916601657e-03   +9.205730394167879e-03   -6.440512089697993e-03   +1.494589379889113e-02   +5.279293965175889e-03; +4.129337144721951e-03   +3.707230001664885e-03   -1.832979496315858e-04   +4.423543640885118e-03   +1.593077196436718e-02   +5.656441203325884e-04   +6.979787949166983e-03   +5.878753699498171e-03; +1.587029553507406e-03   +4.418798802303203e-04   +4.318605913468995e-03   +6.067867146897494e-03   +3.421028242895220e-03   +5.820031730081521e-03   +2.432565203631811e-03   +1.092952867705157e-02; +2.471487260640736e-03   +1.526384751243211e-03   +2.728881560667612e-03   +1.060815949779119e-02   +3.454391306403687e-03   +8.885990383438186e-04   +7.959963817962934e-03   +7.542023688024924e-04; +7.112041897475470e-03   +5.057150329251876e-03   -2.090228823485746e-03   +3.578901027128976e-03   -6.775425108286806e-03   +4.920060303824988e-03   +4.320672874379873e-03   +1.080757630147237e-02];
L1E_L2E_iAMPA_netcon = [+3.575955367111031e-03   +5.835719545759575e-04   +5.246915318331927e-03   +9.178385183876887e-03   +1.408732387196715e-02   +1.225287870472453e-02   +4.800856104365312e-03   +1.169049685541447e-02   +3.468344173987718e-03   +1.996017052704498e-03   +1.356044046320620e-03   -2.390971242678165e-03   +4.859799305847524e-03   +6.591226625144933e-03   +3.179896798020576e-03   +7.185716908567449e-03; +2.363256814878953e-03   +8.759958102303308e-03   +6.065280172003132e-03   +1.342380446041845e-03   -1.194147244088293e-03   +1.001383022536533e-02   +1.043599064784230e-03   +1.554464907487018e-03   -1.619738182293460e-04   +7.413460952566139e-03   +2.517503057054505e-03   +3.535442607211585e-03   -2.705289306405401e-03   +5.413343371742069e-03   +4.349023972945645e-03   +3.989534868426346e-04; +2.989739483092660e-03   +5.694090625809268e-03   +1.153098228029650e-02   +1.168910617526098e-02   +1.497045319692155e-02   +3.823335538209797e-03   +6.380685902454713e-03   -2.542003701497581e-04   +4.677753368304048e-03   +4.608218832982201e-03   -2.048804884940828e-03   +7.424406220756701e-06   +4.914054678764080e-03   +3.776058414990425e-03   +1.143271591546751e-02   -9.005884169395110e-04; +5.712077130330358e-03   -3.273926593376024e-03   -1.010694233002751e-03   +1.579898268315934e-03   +6.944065640352840e-03   +6.954596959171150e-03   +8.838998207833544e-03   +5.968152872978621e-03   +6.173446491576451e-03   +1.227020082308667e-02   +3.369599255997008e-03   +4.470626326675052e-03   +9.111707736448137e-03   -3.673112562495569e-04   +1.117335932734716e-02   +7.730575399586765e-03; +4.404645436925048e-03   +4.696465787979048e-03   +8.736364517317512e-03   +3.294613839605479e-03   +1.717642367882482e-03   +5.920754213277810e-03   +7.093228611098980e-03   +6.901202389986920e-03   +1.968677104805490e-03   +3.957895043664613e-03   -7.108967217621131e-04   +1.294164064848606e-02   +5.556293566588273e-03   +1.717291271794146e-03   +1.365466547361244e-02   +1.175414072588141e-03; +4.076962636295140e-03   +8.159846735084750e-03   -3.413477553723437e-03   +8.513904824139785e-03   +1.684540855660120e-02   +1.150572481575675e-02   +5.313038989185575e-03   +7.611136556566620e-03   +3.202180557392938e-03   +2.725284035598302e-03   +5.924082595577571e-03   +1.311143358769693e-02   +1.005068785649175e-02   +2.375043040720977e-05   +2.518864213015519e-03   +1.274928251004334e-02; +4.326756979613975e-03   +2.476918592773868e-03   +1.049433073649789e-02   -2.170472304695439e-03   +2.318919163134033e-03   +2.028729439674956e-03   +9.830564080216439e-03   +1.339498426439058e-02   +5.472273649763977e-03   +7.028121214042624e-03   +2.671269233253796e-03   -6.659036225797487e-03   +7.107284918086573e-03   +1.757537659391485e-03   -1.122118677317115e-03   +2.710379840691872e-03; -3.234948244995349e-03   +6.902539027339336e-03   +7.801673590423695e-03   -1.076014914794003e-03   +1.525093448261366e-03   +1.210085873166003e-02   +3.276827551252610e-03   +1.112475276061855e-02   +8.417271357891895e-03   +4.457447828535036e-03   -2.224997042597412e-03   +7.905691970233516e-03   +8.930915981742433e-03   +7.794705842220353e-03   +2.745392831785460e-04   +3.658758277708680e-03];
L2I_L2E_iAMPA_netcon = [+6.682093409753604e-03   +7.179077736954531e-03   +6.737344999930790e-03   +8.522704493044313e-03   +6.244514404777786e-03   +6.855321091019521e-03   +4.933826184186798e-03   +4.828155558143495e-03; +3.720290108926436e-06   +3.174738897858380e-03   +2.014255309350587e-03   +7.768949818729492e-03   +1.699835719155138e-03   +6.114010063941158e-04   +3.275805968161786e-03   +4.671030885981525e-03; +1.055784164723744e-02   +8.281484849106955e-03   +3.446261284596823e-03   +2.915920381755918e-03   +2.927738421663026e-03   +6.227758346416480e-03   +8.168106270498292e-03   +7.230401323379887e-03; -9.256109319502113e-04   +3.744068862065082e-03   +8.752498249805287e-03   +8.362158490728513e-04   +7.053757602114502e-03   +2.334955284132772e-03   +2.685490818706223e-03   +7.902788400070963e-03; +5.703900934507492e-03   +7.295181349588524e-03   +1.596099103237320e-04   -4.665491077790259e-03   +9.396520506046351e-03   +7.179628056326311e-03   +3.289160833989591e-03   +2.825060089776432e-03; +3.806818824552198e-03   +3.322514906425684e-04   +3.604943015652268e-03   +2.510365932030101e-03   +9.004654816051574e-03   +7.846968477113291e-03   -7.332215759267535e-03   +1.323041079197721e-02; +1.112834700297833e-02   +1.200713706015354e-03   -5.810289000144175e-04   -1.657746457834018e-03   -8.217033177650346e-03   +2.794621069796580e-03   -1.399364102093214e-03   +9.003880378914877e-03; +6.945707731957172e-03   -3.017120082238239e-03   -6.069795080015255e-05   +6.078778272864082e-03   +9.311133504765231e-03   +2.987013487602815e-03   +7.085619753386516e-03   +1.585585982490301e-04];
L2E_L2I_iGABA_netcon = [+6.084979034204598e-03   +2.295406272090346e-03   +4.338943727298938e-03   +3.104910224100283e-04   +1.403896672951501e-02   +7.996359990501850e-04   +2.830815906879646e-03   +5.842708293689979e-03; -2.976795701600473e-04   +6.089199511252722e-03   +4.470642576528732e-03   -2.276902992443854e-05   +7.779164615295201e-03   +6.217174859491985e-03   +6.946188728702388e-03   -1.742010258692999e-03; +2.753944040960068e-03   -5.622125623904023e-04   +1.714402668332856e-03   +1.073600769225682e-02   +6.941565326466339e-03   -1.982589125519046e-03   +9.525924929844174e-03   +1.130523817291595e-02; +9.614396043400223e-03   +1.146233894088614e-03   +1.608566570889832e-03   +8.457809761748184e-03   +2.956495643092574e-03   +5.685837327732176e-03   +5.298776892509575e-03   +2.039410272752489e-03; +3.211335640137472e-03   +3.836759800487109e-03   +9.788968617376888e-03   +7.789104868480851e-03   +3.863342711220359e-03   +2.175202365448817e-03   +8.266415249496489e-03   -2.414415646056254e-03; +9.075969831288307e-03   -3.548374226228334e-03   +4.920806903044162e-03   +9.509067464496417e-03   +1.077019134694127e-02   +1.663567742929348e-03   +6.223200227695340e-03   +8.171330466796396e-03; +4.626806615590243e-03   +1.183736106086742e-02   -1.712448041022761e-03   -6.217770619034758e-03   +7.489806131503974e-03   -4.356573715312992e-04   +4.279348979392597e-03   +1.538284297645952e-03; +9.272763063166902e-03   +2.586175262819534e-03   +3.568255946466825e-03   -7.332342597040114e-03   +2.749234672663867e-03   +8.311588441921487e-03   +1.040906236304725e-02   +1.094628085624430e-02];
L3E_L2E_iAMPA_netcon = [+6.093489176230540e-03   +1.182328725106363e-02   +1.608999326059462e-03   +5.729276681982625e-04   -6.263655855382357e-03   +9.077445643524432e-03   +4.062181587768277e-03   +1.001979997627046e-02   -1.758191063519360e-04   +3.703750749873846e-03   -9.658416475707409e-04   -2.391575435383459e-03; +6.692900685975798e-03   +1.295692749578015e-02   +6.408911503526847e-03   +5.689611434290855e-03   +4.409917838285086e-03   +1.270575643748216e-03   +8.434499875173987e-03   +9.559931265581327e-03   +9.868218582382940e-03   +6.491691492340843e-03   +3.517278961062415e-03   +2.969073426918913e-03; +1.294068227470657e-03   +5.992696026238612e-03   -2.431046473954100e-03   +5.410559080110079e-03   -2.882945729315652e-03   -5.813797891463245e-03   +5.968117191749059e-03   +1.113438403574153e-02   +5.702879694620145e-03   +5.424118308271960e-03   +7.152020335240131e-03   +1.011506175326544e-02; +3.248184032322461e-03   +1.420616672789896e-08   +6.530627585786482e-03   +1.421525976198071e-02   +2.136545425715847e-03   -1.061886087665957e-03   +8.298395265336879e-03   +2.906906633855572e-03   +4.792585356688131e-03   +6.799841914071765e-03   +3.475528882469982e-03   +4.957213774311404e-03; +8.816875717426790e-03   +9.774149293936096e-04   +6.828191100857201e-03   +1.245801873806608e-02   +5.745069327893866e-03   +3.551205049355837e-03   +1.063653141261440e-02   -3.099686333626364e-03   -3.801304064819633e-04   +1.033806057585571e-02   +8.280659522337796e-03   +4.555919429097801e-03; +6.493119218717055e-03   +1.953813905725312e-03   +2.089994611789834e-03   +2.543842249812466e-03   +1.131723136496413e-03   +1.640432338003213e-02   +9.791645028593128e-03   +9.021678003616399e-03   +8.016516907231408e-03   +1.453877970662286e-03   +1.239212980544214e-02   +1.012942176730285e-03; +3.936077789384885e-03   +8.994936586978325e-04   +1.076845244135488e-02   -8.223134501224836e-05   -3.332269616113537e-03   +2.310079245151966e-03   +1.324139659435741e-03   +6.216933292348125e-03   +2.088917992255203e-03   +5.450896623517028e-03   +3.405254991599882e-04   +9.925606056995991e-03; +8.971718669331037e-03   +1.016428133603014e-03   +1.343572452203884e-04   +1.117694661350661e-03   +1.202591805213379e-02   +4.905322472484788e-04   -1.343872211231237e-03   -1.240627164601442e-04   +2.163830374753013e-03   +9.600037939869870e-03   -9.409740179752952e-04   +3.254433454906063e-03];
L3I_L2I_iGABA_netcon = [+4.423530322754337e-03   +5.393375074439810e-03   +1.075351167428250e-02   +1.060355562689989e-02   +8.741407879303758e-03   +6.025809299992961e-03   +7.613515529966818e-04   -3.822240802441161e-03   +9.523631243003847e-03   +9.080554993631272e-03   -4.122347258099245e-03   +1.493223513843107e-02; +6.846843674859553e-03   +1.045996787347872e-02   +8.487981577763497e-03   -1.525276376780515e-04   +8.832130329459993e-03   +9.201463337967264e-03   +4.506501343645127e-03   +3.829855815011777e-03   +8.732693529424079e-03   +4.102631920073831e-03   -5.129362745264095e-04   -2.920863076274159e-03; -1.964273495572528e-03   +2.221909675940271e-03   +8.734198808794065e-03   -2.683239832730068e-03   +5.474511641638564e-03   -3.943169081325649e-03   +7.838576541331996e-03   +3.726359395638417e-03   +7.737097295841888e-03   -2.288196528092282e-03   +3.543675940307766e-03   +3.376731672202141e-03; +1.478318006041639e-02   +3.500850645322907e-05   -3.734251642027463e-03   +6.432474682145505e-03   +6.220324101271811e-03   +9.084912449276599e-03   -2.508803994016037e-03   +3.044901028518573e-03   +9.270271185780690e-03   +3.480316444149409e-03   +7.292906862158441e-03   +1.097758440736662e-02; +1.882509045830946e-03   +9.628847668068279e-03   +3.128135474004659e-03   -4.334765607175620e-03   +1.207607138734391e-03   +1.259402188646551e-02   -3.576292263592744e-03   +2.088542504012579e-03   +9.864749356744480e-03   +1.219152483286629e-02   -2.403436051719036e-03   +1.966425806320303e-03; -1.006976676331828e-03   +2.558737201785917e-03   +5.525008015862378e-03   +1.706476855067399e-03   +2.138755426177098e-03   +4.861528177266249e-03   +5.642745542108350e-03   +3.587383197492644e-03   +2.195989231384112e-03   +4.661623642836375e-03   +3.788838095464773e-03   +1.808709300306508e-03; +7.504182987859327e-03   +6.871687816560708e-03   +6.407132062767679e-03   +7.339544401399260e-03   +4.979878703630382e-03   +2.439370107433460e-03   +2.061564871353865e-03   +5.633054103373935e-03   +7.127774673803023e-03   +8.667020116848003e-03   +1.839211318805461e-03   +2.394238897774867e-03; +6.585537084613591e-04   +2.936443867841178e-03   +3.043705969418192e-03   +9.593632792094022e-03   +3.651319147398077e-03   +4.754193084919443e-03   -6.774820796019998e-04   -5.922340123304965e-04   +1.440958792834492e-02   +2.413701477511509e-03   +4.891482948944833e-03   +7.182669190488533e-03];
L2E_L3E_iAMPA_netcon = [+8.392406219956735e-03   +1.003371543383491e-02   +5.926743698762641e-03   +8.432217661152605e-03   -2.452219185721468e-03   +6.936023452024995e-03   +1.171471981982323e-02   +8.394356009323922e-03; +8.624232886155962e-03   +8.893994642495824e-03   +7.032481397780924e-03   +6.092229689839784e-03   +5.740644752490120e-03   +1.940095216772697e-03   +8.543111935330895e-03   +8.293085308588384e-03; +7.903293889513418e-03   +5.837221088123904e-03   +1.201280662413150e-02   +1.037948131548817e-02   +1.057270647195727e-02   +7.677303393229541e-03   +8.594824656404848e-03   +4.442489248062625e-03; +2.099653396161564e-03   +6.004602384363238e-03   +1.057393765020162e-02   +4.469715409991817e-05   +3.765909428196684e-03   +4.565877323510915e-03   -6.003712540814713e-03   +4.955654243717698e-03; +4.208727451719699e-03   +1.678027539655026e-03   -1.097492670632388e-03   -2.879248746899111e-03   -6.354339671647462e-04   -4.035419911643612e-04   +9.943025606051380e-03   +8.566404839587908e-03; +6.656364846491814e-03   +9.390093366464843e-03   +6.117468477961347e-03   +1.229166229836382e-03   +1.109381312664152e-02   +1.450541467451451e-02   +3.281234572684704e-03   +1.020081138004062e-02; +3.091584479581726e-03   +2.646852307078515e-03   +9.611534665545228e-03   +1.029394698391005e-03   +1.760929369663809e-03   +1.019707268857582e-02   +5.122290019493565e-03   +6.305330903789487e-03; +1.366329052554078e-02   +7.640507813448726e-03   +6.244574496850135e-03   +8.129087810545381e-03   +7.645143369642880e-03   +1.178791271340528e-02   +8.171350602225076e-03   -2.097191501364598e-03; +4.939479063788386e-03   +1.916483730677439e-03   +3.678001516921570e-03   +1.085052479569564e-02   +3.948936616707794e-03   +3.534312189835220e-03   +9.729308118960698e-03   +1.062914256836983e-04; -5.605581558864878e-04   +5.810247280610545e-03   +2.179711019466992e-03   +9.531773928615477e-03   +9.975690067463357e-03   +1.750071898295678e-03   +1.806465856160819e-03   +9.943156600638310e-03; +7.297928168828387e-03   +9.909218244230093e-04   +4.327988887696151e-03   +6.711409404977160e-03   +1.520893768072570e-02   +9.133071909281811e-03   +5.671704549181334e-03   +1.628998960710541e-03; -1.363868422864603e-05   +8.966719836098662e-03   +6.453527816055954e-03   +1.022006204071894e-02   +8.338585432657121e-03   +1.012515588141526e-03   +1.078226059846431e-02   +8.383093662872374e-03];
L2I_L3I_iGABA_netcon = [+1.218942735299689e-02   +1.050432066410363e-02   +3.067205525730751e-03   +7.188325332659711e-03   +1.146026283497636e-02   +8.244729653800232e-03   -4.014989347107912e-03   +4.798880010700007e-03; +1.920407330564862e-03   +5.890876491402699e-03   +1.447506302456810e-02   +1.872622894795292e-03   +8.311826128038479e-03   +5.495962707770041e-03   +1.712270055266050e-03   +8.852111033848862e-03; +5.772531840854706e-03   +1.037464010457983e-02   +4.232024555876805e-03   +2.877711189549184e-03   +6.238163233890628e-04   +5.217850010250286e-03   +8.139228440787606e-03   -2.614732986980346e-03; -2.822481983994927e-05   +8.256414934728609e-03   +1.354335337391257e-03   +4.798099170422194e-04   -1.837089741377021e-03   -3.125395137039551e-03   +5.593294748405502e-03   +6.423606864874154e-03; +1.792859270946072e-03   +1.928346655921995e-03   +3.505173796802082e-03   +2.650214015099746e-03   +1.151302690280094e-02   +4.899138434107735e-03   +2.735836154048897e-03   +8.931591803771728e-05; -4.314004748011980e-03   +6.723330024608547e-04   +1.003330555962806e-02   +4.423462237765447e-03   +4.294692317228812e-03   +6.683288278098373e-04   +3.617655901385772e-03   +1.253168184900890e-02; +3.985578988486551e-03   +4.826771980396822e-03   +1.160759006623297e-02   +8.667821435752685e-03   +3.711610511166552e-03   -1.963883895658631e-03   -2.198414439786520e-04   +9.616669351959359e-03; +2.054676805951952e-03   +1.326577287864624e-02   +4.199976542176615e-03   +3.374168490091519e-03   +3.965206134376105e-03   +1.090517415539692e-02   +6.606508752851996e-03   +2.218879541980878e-03; +9.301969661956365e-03   +5.613217987183531e-03   +1.473428557205781e-02   +5.206556121427768e-03   +5.650009010705589e-03   -4.503084668751784e-04   +3.668267574205032e-03   +3.535409339819715e-03; +9.929511968258429e-03   +6.503609869901486e-03   -2.235867430712413e-03   -1.229953533213297e-03   -2.070379834535174e-03   -3.855861489280152e-03   +4.976241321549638e-03   +5.099030424482165e-04; +7.891243172319946e-03   +1.028119727591369e-02   +4.179637656665522e-03   +4.723387684738373e-03   +4.579169196045565e-03   +5.712490506441670e-03   +7.737519143072467e-03   -2.729731829740926e-04; +2.824979359685618e-03   -2.228591403810097e-03   +1.762691252279279e-03   +5.121770143596779e-03   -1.337771835029377e-04   +9.516618379634101e-03   +9.023599660256423e-03   +6.531983829651389e-03];
L3I_L3E_iAMPA_netcon = [+8.522584298035780e-03   +7.842950336958823e-03   +4.357195069236087e-03   +1.080415230538242e-02   +1.302987527271504e-02   +8.754902972103799e-03   +3.279028986735664e-03   -7.722302848513228e-04   +6.494781026130938e-03   +2.446359787621831e-03   +1.902457482117286e-04   +1.948616670147443e-03; +3.627929807730616e-03   +7.657866099822203e-03   -1.437391067623259e-04   +3.104150648386667e-03   -4.937078509090046e-03   +5.079971319338667e-03   +7.417953429753874e-03   +4.962824861687404e-03   +4.241441704832501e-04   +3.120695594178302e-03   +5.963074409766190e-03   +9.054882233095198e-03; +2.097747030876324e-03   +9.844614588776187e-03   +4.286671234188084e-04   +1.034894158475252e-02   +1.215472144447294e-03   +8.951205337799138e-03   +8.981671975364968e-03   +3.896578490281008e-03   +7.872428274292843e-03   +9.767169236519048e-03   +5.139977815901371e-03   +5.946668667065419e-03; +1.113283004665397e-02   +1.128478453276808e-02   +7.235017766314899e-03   +3.950488740505556e-03   +3.457484861264018e-03   +7.829270595685379e-03   +1.179659634898670e-02   +4.065382050413980e-03   +8.454626055733775e-03   +1.325562045415689e-02   +6.593505467479025e-03   +8.916321263666684e-03; +2.799357373849151e-03   +8.251874480352120e-04   +4.635398144475531e-03   +8.225887220918840e-03   +3.731730061857896e-03   +4.430295581120380e-03   +6.929397300205803e-03   -1.907616291942214e-03   +7.919277110912250e-03   +1.731602859535153e-03   +1.793432164171789e-03   +4.558765317016343e-03; +2.522088086664219e-03   +6.886764916844293e-03   +7.667602341408269e-03   +8.837455285125501e-03   +9.202870512396891e-03   +4.510948229746712e-03   +7.403080503546206e-03   -1.711430609684050e-03   +6.336446800324798e-03   +3.115213599092849e-03   -9.221574094010118e-04   +2.669660860123254e-03; +4.847205040663320e-03   -8.903542092355464e-05   +4.775013164961896e-03   +9.684885249080291e-04   +6.463568247296847e-03   -3.634689386016576e-03   +1.714955114812367e-03   +8.235185055060226e-03   +6.665560854143605e-03   +1.187709861554771e-02   +1.762975142020483e-03   +1.140244822147975e-02; +5.053904804794746e-03   +4.375592717384060e-03   +1.171271949926134e-02   +4.010362501436346e-03   +7.384783588856026e-03   +3.284025762941712e-03   -2.802965915527902e-03   +4.310671092778156e-04   +1.749791248487653e-03   +2.998884331066201e-03   +3.835055416227005e-03   +7.544718973767648e-03; +9.270009205753266e-04   +5.987032329359916e-03   +4.442562949188125e-03   +8.955833877400385e-03   +2.496465103811056e-03   +7.306863399593834e-03   -1.071589586189166e-03   +1.408212823957529e-02   +1.409163615545992e-02   +7.438175901933851e-03   +4.459449368513084e-03   +1.007166579390208e-04; +7.129576041774927e-03   +8.120287774870118e-03   +9.322890225621036e-03   +3.148943963333648e-03   +8.740098213999244e-03   +9.780610108067484e-03   +4.009584453016832e-03   +1.221112429989980e-02   +4.729307616930885e-03   +1.064743373427229e-03   +8.788694155904900e-03   +5.268335362550875e-04; +3.694918980299659e-03   +2.125276012550450e-03   +1.425185061731253e-02   +9.607363887651042e-03   -2.202887667844914e-03   +8.616948061435415e-03   +4.281842289979292e-03   +4.886069769380972e-03   -2.570518466708716e-03   +9.283972243467525e-03   +2.361192502037419e-03   +1.147690346448753e-05; -3.519581514837127e-03   +8.848430167622032e-03   +4.932585854998444e-04   +8.836459224801857e-03   +3.651247904456816e-03   +1.768759725990917e-03   +1.615034045561954e-02   -4.308866683822117e-03   +8.653217116592936e-04   +4.727070383963026e-04   +1.269704705062384e-02   +6.536801279252514e-03];
L3E_L3I_iGABA_netcon = [+5.467155922109113e-04   +1.322296614854687e-03   +3.099771981404781e-03   +1.349889346246610e-02   +1.081140910349499e-02   +1.206769248904729e-02   +8.538466617250395e-04   +6.294694031453369e-03   +7.672263694320286e-03   +7.154865011812889e-03   +7.394564518529474e-03   -4.962247919764115e-03; +1.133537789869850e-02   +8.470720628864545e-03   +3.515022303953018e-03   +2.995595694852483e-03   +8.241457707043005e-03   +7.689717108088171e-03   +2.616510503253748e-03   +6.025622047302969e-03   +4.794964565497057e-03   +7.990738559235128e-03   +3.844028901145411e-03   +2.960071456734295e-03; +7.246964085506484e-04   +5.390046575441264e-03   +1.024792518187012e-02   +4.858001088977748e-03   +1.129099255903656e-03   +8.031352081134806e-03   +8.070640385173041e-03   +7.693628273723386e-03   +5.664890057880475e-03   +9.964658939475741e-04   +5.447831795657385e-03   -1.375800998439054e-03; +1.810420983560148e-03   +4.949221229096433e-03   +1.402234939134593e-04   +1.235139776409402e-02   +6.179127506149878e-03   +1.118833578823289e-03   +7.354104514026709e-04   +2.646238571207035e-03   +7.318463107563533e-03   +7.721430222481513e-04   -1.689777033995510e-03   +5.382969618914695e-03; -4.879096546550243e-04   +8.916031577301560e-03   +1.319612317250422e-02   +8.834378220869295e-03   +6.455170449265298e-03   +8.013432733364769e-03   +9.089981984369390e-03   +1.153933946570609e-02   +9.308843388439625e-03   +1.111714068788590e-02   +1.266419913191784e-02   +1.223833505017740e-03; +4.603369145944352e-03   +3.540939592070314e-03   +1.623518820210248e-02   +8.005936405033734e-03   +1.267536733154181e-03   +1.179751791239744e-02   +2.344994599021953e-03   -5.593937161762620e-03   +1.015126016461382e-02   +4.880732685694647e-03   +2.263710985526743e-03   -1.435623768000262e-03; +3.592035532320506e-03   +5.779160012865054e-03   +1.599869328454404e-03   +6.714851425437735e-03   +4.548623374428037e-03   +6.492215878808995e-03   +2.558546427278888e-03   -2.449585337037381e-03   +5.408712236534420e-03   -1.020288381064160e-04   +6.180546856757189e-04   +7.563311240362219e-03; +2.318065578246516e-03   +6.253043277102191e-03   +5.912664864482250e-03   +8.069086066699777e-03   +1.741174592277278e-03   +8.365305686755994e-03   +6.566286070315582e-03   -3.992705424327391e-04   +9.999397016266608e-03   +1.161136867085833e-02   -2.793610518600598e-03   +9.215708767304931e-03; +2.818088007165493e-03   +8.819802589644233e-04   +1.058411367134448e-02   +2.127309472981434e-03   +9.441480191748806e-03   +7.066659020281286e-03   +1.675230494267412e-03   +1.679109732106081e-02   -1.231400203511147e-03   +4.827279682683195e-03   +2.852430588988624e-03   +7.270780377839998e-03; +1.001906895943095e-02   -1.136208209942473e-03   +8.044928662240826e-03   -2.261061964723933e-03   -2.613826243216377e-03   +1.047666677536031e-02   +4.291242702465332e-03   +1.922645284821094e-03   +1.050575553733081e-02   +8.864971127095021e-03   +3.114434235539528e-03   -3.022675312075787e-03; +3.835241631721951e-03   -1.694020314965127e-03   -6.482354358885382e-04   +1.621666474963590e-03   +8.813864533256392e-03   +1.095122738369492e-03   +1.498865820910835e-02   +5.191296212417922e-03   +9.479783320473932e-03   +4.798158790231058e-03   -1.391910134372268e-03   +7.486176732041955e-03; +9.742519766249591e-03   +4.487961602073756e-03   +3.840612782293954e-03   +4.662030426366421e-03   +1.462414750017895e-04   +2.890886645164595e-03   +1.378763737271800e-02   -3.271649490090111e-03   +1.222013736889977e-02   +6.706847836789906e-03   +5.603406391372053e-03   +3.945216084447728e-03];
L2E_Input1_iAMPA_netcon = [+5.391503887159541e-03   +1.145274517197712e-02   +9.797500839384247e-03   +8.235863826240544e-03   +1.424510950570411e-02   +1.420930160456724e-02   +6.858341601987588e-03   +6.138787814123819e-03];
L2I_Input2_iAMPA_netcon = [+7.695626741026488e-03   +8.521627732339313e-03   +9.254002498823839e-03   +5.785683332213699e-03   +6.205864735726022e-03   +9.141252543867513e-03   +1.152286391498560e-02   +1.327351309585945e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
