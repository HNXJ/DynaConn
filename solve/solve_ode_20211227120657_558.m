function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.221988103729956e-02   -9.694513287575077e-02   +1.823128332655327e-01   -5.421281755363613e-02   +1.824123277191839e-01   -2.282267288059500e-01   +1.811345982440854e-01   -1.012156922298120e-01   -2.214520169072044e-01   +9.203238515795908e-02   +2.656250920688656e-01   +1.566162438532251e-01   +8.854193917109293e-02   -2.339588281665188e-01   +5.195089429212950e-03   +2.561367390306490e-01; -2.867885660364481e-01   +2.516952411152872e-01   +1.445454576014692e-01   +1.203109425267933e-01   -3.212242782072477e-01   -4.196908318054784e-02   -1.167992282504265e-01   +2.503933550328599e-01   +2.640981839366055e-02   +1.278312063574387e-02   -3.001649315487844e-02   -2.449046598096491e-02   +4.774842106526504e-02   +1.154524968405856e-01   -9.943574782940975e-02   -3.176747080577849e-02; -1.402977552983139e-01   -3.900789770040487e-02   -1.544992413395944e-01   +1.809340930838695e-01   +9.682643357521063e-03   +8.555759008751210e-02   -2.670852746994501e-01   -2.583225256737925e-01   +1.913923621658739e-01   -1.794297706001877e-01   +1.019928007853581e-01   -8.948119318160938e-02   -7.091443928469229e-02   -1.952213210667514e-01   -8.821013004663790e-02   +3.447382029253056e-02; +1.483946626822338e-01   +9.016301061254980e-02   -1.451951687566791e-01   +5.831640697463710e-02   +1.788335682910015e-01   -4.575979621837688e-02   -1.353841068824272e-01   -1.161350252068273e-01   +1.334061019621549e-01   +2.488466430375775e-01   +2.315692533040630e-01   -1.486724921255212e-01   -7.322725468396428e-02   -8.709284571708867e-02   +6.140969804023940e-02   -4.404832372820388e-02; +8.050064732085924e-02   -3.953819934053892e-01   -1.740940319992688e-01   -1.769354492619434e-02   -7.854177553924455e-02   -3.348358405128934e-01   +1.510547551308811e-01   -6.299592726502132e-02   +3.653954313667142e-03   -1.541470931360591e-01   +2.572797195899919e-02   +4.295055022325113e-02   -1.475883356240009e-01   +2.359057279617605e-01   +1.354443772964901e-02   -3.119051506316423e-02; +3.025401572845303e-01   +2.260484590764583e-01   -1.436239575617207e-01   +1.602656580548362e-01   +3.978298110627066e-02   +1.822683565612622e-01   -3.716324228043561e-03   -5.340063128526473e-03   +2.335857862330091e-02   -2.276666857720435e-01   +2.149288428260074e-01   -1.288370553226948e-01   +1.473457268983854e-01   +1.560597687483827e-01   -7.206063166414156e-02   +1.155533322049633e-01; -7.244930451240417e-02   -8.674866941268909e-02   -1.096357031191420e-01   -8.780399486074900e-02   +4.098286304525055e-02   -3.882487700119372e-01   -3.940937493038264e-02   -1.238692537675796e-03   -6.025041514551829e-03   -2.244209497063109e-01   -1.518978405409212e-02   +1.335713939402211e-01   +2.074777294760222e-01   -3.242851584407609e-01   +1.801183306107849e-01   +1.166737122988947e-02; -2.110192762421179e-01   -4.738578818018856e-02   +4.917718589699019e-02   -8.040911857205361e-02   +1.780229152759911e-01   -1.308386697173055e-01   +3.587722134957404e-01   -6.015510404730565e-02   -1.249700757412989e-02   -6.218082115620344e-02   +3.581013960487116e-01   +1.987277986261329e-01   -9.586777550741636e-02   -2.765338868487169e-01   +7.887319736953075e-02   -5.965246224112170e-02; -2.649961266404348e-01   +2.288846751713191e-01   +2.978868012419809e-01   -2.112936792300774e-01   -2.255926198552536e-01   -3.445012865136567e-01   -1.244212522686628e-01   -1.765298476272680e-01   +1.291036372399825e-01   +5.717982929307721e-02   +1.070324650160781e-01   -8.621088737656285e-02   -1.658226659124896e-01   +7.101681684533939e-02   +2.917226302210017e-02   +1.397410529527994e-01; -1.193981332621622e-01   +1.772730452933981e-02   +2.972810654938798e-01   +3.792498711801247e-01   +1.783800516069168e-01   -4.603246546923681e-02   -1.575998674376146e-02   -3.569576307919318e-01   +9.329362448528056e-02   +4.723053163237567e-02   +1.268107103045972e-01   -7.227016108723926e-02   +1.729580505831912e-02   -2.970404127850778e-02   -1.379892070695488e-01   +1.429749612441723e-02; -3.109760409082462e-01   +1.572717109720666e-01   -1.889653204376571e-01   +1.597080952295404e-01   +1.030484893005899e-01   +1.514621398766736e-01   -9.927463484598507e-02   -1.215298186392905e-01   -8.938108923245938e-02   -3.329695509414121e-01   -2.217298734128928e-02   +1.183482436367052e-01   -1.925602618133200e-01   -8.131174106580771e-02   +7.560267916110182e-02   -8.937232518403038e-02; -1.486388133699105e-01   -1.772795400225041e-01   -7.702557076919837e-02   +3.766382819513715e-01   -6.914178319896659e-02   +1.978717711608518e-01   -1.665367060075528e-01   -1.068320498337412e-01   +1.715028396258800e-02   +3.796150152709655e-01   +7.883196315618604e-02   -3.616828649148062e-02   -1.078952540239584e-01   +1.059037404896147e-01   +1.156422904097219e-01   +1.761247305142056e-01; +7.865501397291805e-02   +6.832823226547087e-02   -1.316887529192456e-01   +5.147294279088178e-02   -2.523359699514764e-01   -7.187513781225031e-02   +9.374885239725746e-02   +4.712837445223224e-02   +2.002616902948435e-02   +7.938625436349625e-02   +1.469307938119780e-01   -1.611619705794216e-01   -3.091113140942808e-01   +5.340350165038137e-02   +2.088547555383767e-01   +9.138256167526577e-02; -5.721700334192950e-02   -6.944356472196922e-02   -2.446305544675783e-01   +2.109083338989369e-02   +1.941703894314213e-01   +2.011478933773093e-01   -2.621183535537738e-01   +2.325836045823842e-01   +1.017107013987261e-01   -2.495248805824717e-01   +6.155502125357343e-02   +1.905581906269420e-01   +2.332989962122612e-01   +4.119983512554346e-02   -2.389787998927044e-01   -2.188377537952245e-01; -8.863349794418143e-02   -1.617261470079191e-01   -2.418506325914047e-01   +9.228779535254236e-03   -5.692874994373084e-03   +2.580979995660603e-01   +2.866370089452386e-01   +2.920785832630813e-01   -5.429247346005103e-02   -8.563255379092445e-03   +4.569036060008361e-03   -1.374541015769785e-01   +1.276922532972173e-01   -2.620554843330145e-01   -9.799629089863783e-02   -1.470016061712432e-01; -1.790248433729003e-01   +7.711441726853624e-02   +3.740922357741345e-02   -5.525659059284801e-02   +2.482900966577912e-01   +2.473074818119860e-02   +1.104610212818038e-01   +8.321570096557068e-02   +1.409513856570593e-02   -3.355418260772669e-01   +2.329877070787289e-02   +1.246774773358907e-01   +1.454500547036330e-01   -3.214823338573317e-01   -2.768097676806527e-02   +2.332402027610210e-02];
L1E_L1I_iGABA_netcon = [+1.703355636490662e-01   -1.635326813871874e-01   +1.321640786768302e-01   -1.208968247703118e-02   +1.742121828275332e-01   +3.293987737410692e-01   -2.943181512509341e-01   +6.615854281004346e-02   -6.705583174651572e-02   +1.435991185064607e-01   -3.053068554634429e-01   -9.772879861027667e-02   +1.022766362060917e-01   -1.635923631881460e-01   -1.676320163848816e-01   -1.693711836675458e-01; -2.244834091321027e-01   +9.630706600567857e-02   +1.738862679783357e-01   -1.436862257844167e-01   -8.827862477622500e-02   +1.456395656587359e-01   -2.705783088932909e-01   +5.830513072752071e-03   -1.905615443603215e-01   -2.852456449736791e-01   +1.057182563910217e-01   +1.718170411401866e-01   -5.052801702195418e-02   +4.878334582795763e-02   -1.049680499865560e-01   +2.066504350720985e-01; -8.486674060476868e-02   +2.797725891239691e-01   -3.612195710906560e-02   -2.575796481484403e-01   +1.421309222476531e-02   +1.381820248952036e-01   +2.543236107959637e-01   +2.598285596370990e-01   +1.027770754756713e-01   +1.928594508582218e-01   +2.840466329589508e-01   +9.328277462649985e-02   +8.183840229286750e-02   +2.776366068203251e-02   -6.537925290647863e-02   +2.456054434391362e-01; +8.660130491197034e-02   -1.362024064398055e-01   -2.782610029589299e-01   -7.179765326229380e-02   -2.208100649830602e-01   -1.545062721858752e-02   +1.546368471223522e-01   +2.344389383407354e-01   +8.395197406183891e-02   -3.480453463589588e-02   +6.336089498895688e-03   +2.071044348661727e-01   -5.561589257560361e-02   -1.459354041925521e-01   -1.989445747245114e-01   -8.320154318451776e-02; -1.753934088944647e-01   -3.973241690335569e-01   +9.495144618184514e-03   -1.675126315220710e-01   -1.102915970350287e-01   +7.914325693815308e-02   +2.311933483411232e-01   -1.380254544911074e-01   +1.978617386899778e-01   +1.644106304475513e-01   +3.705384346582204e-02   +8.510633418247950e-02   -4.011375696740493e-02   +3.293764061358605e-02   +1.230019241610607e-01   +2.991194468441113e-02; -1.853781478259221e-01   -4.578538503828919e-01   -1.262418399031410e-01   -5.322554417728707e-02   +5.883716816831903e-02   +1.277864467013355e-01   -9.451284198197357e-02   +9.371710882792722e-02   -1.067836639999380e-01   -1.382871734885997e-01   +1.382264534046005e-01   -1.044466313464534e-01   -3.268053484521884e-01   -6.941686754256146e-02   -3.881797077149157e-01   +1.059223488354943e-01; +1.984333277368129e-03   -7.465913244286287e-02   -5.803551475532333e-03   +2.864838264933339e-01   -2.415006518605459e-01   +5.223526356541577e-02   -4.772908094479029e-02   -2.252315893873946e-01   +2.014418884473766e-02   -1.274918837691695e-01   +6.160225664837930e-02   +1.987556100397819e-01   -1.287346047312184e-03   -1.058405070059586e-02   +1.280853500691615e-01   +5.723338414440614e-02; +1.353121633453892e-01   -4.662160127789387e-02   +2.330319319543712e-01   -8.358417392292786e-02   -1.494153411316825e-01   +3.190531534999557e-01   -1.572077787108001e-01   +9.410107945361407e-02   -9.033800945967738e-02   +1.006882322717392e-01   +6.994013738638762e-04   -3.740639256138058e-02   -2.385169190166108e-02   +1.452844481931422e-01   +1.485502198816292e-01   -3.061004467303173e-01; -2.955573215596018e-01   +2.858898342849190e-01   -1.694669303928323e-01   -1.487227881808699e-01   -2.071022786271237e-01   +2.497438637444270e-01   -1.582812629326345e-02   +5.816004800807613e-02   -3.359497903869903e-01   +2.355417853884457e-01   -1.955208242237343e-01   -3.750707752846960e-02   -1.490541353807422e-01   +4.585597115157355e-01   -3.033790781408276e-01   +1.601232479074485e-01; +4.529593588622700e-02   -1.047152234221174e-01   +9.104958309338612e-02   -5.966056193986574e-03   -1.693552230382824e-01   +2.136751600255730e-01   -1.235255285646372e-01   -3.838202857963919e-02   -1.722079963501164e-01   +9.636331190294421e-02   -1.364348918917454e-01   -2.599377520652612e-03   -3.481264763682824e-01   +1.430604015680441e-01   -6.262605212952629e-02   -3.318615264488027e-01; +1.237108454874182e-01   -2.881157034592739e-01   +2.595576291704886e-02   +1.243785880327725e-01   -3.906155918341057e-02   -5.925711293347569e-02   -8.523372860436586e-02   +1.529854187818222e-01   +1.595769621199488e-01   +4.430028899656959e-03   +4.010576728576635e-01   -1.244839018224439e-01   +1.062979375526541e-01   -4.577378190638581e-04   +2.449222166918242e-01   +2.314693095316887e-01; +1.537055512046476e-01   +2.195340932230676e-01   -7.299313113215790e-02   +2.639273438973071e-01   +3.236314650299189e-02   +9.446616463121037e-02   -1.779941310925685e-01   +1.247302467466530e-03   -1.401263448885650e-01   -2.786997044153245e-02   +2.465719996486601e-01   -1.124075335512431e-01   -7.202773855990281e-02   -3.166111618568998e-01   +2.051090441002294e-01   +1.529159762450652e-01; +2.181926020772875e-01   +7.985836120469025e-02   +1.590129812934967e-01   +3.284768119344217e-01   +2.203454865615789e-01   -5.429254001077261e-02   -1.973571026269821e-01   -1.205234235976661e-01   +1.323422684074040e-01   -8.546629941618238e-02   -1.048271449718349e-02   +2.447327097702598e-01   -1.365537502373442e-01   +7.522436298826241e-02   -2.833604823093334e-01   +2.800868639922241e-02; +2.734662255377534e-02   -1.403343813030705e-02   -1.787152288532557e-01   +1.142140428833724e-01   -1.668646573409032e-01   -9.114204082538008e-02   -2.180700068175673e-01   -9.358845846110314e-02   -3.718440301254736e-02   +1.504253477533012e-01   +1.290627967999096e-02   +2.092761112198920e-01   -1.595795887119295e-02   -7.681361543708425e-02   +7.122617526985284e-02   +1.253697817597485e-02; -8.652742241844628e-02   +1.924041045992927e-01   +2.061316958474504e-01   -1.258692078678826e-02   -1.613010627562339e-01   -1.275971986138486e-02   +2.260117783849264e-01   -1.746527228568911e-01   -4.028354845170692e-02   +1.962399197228543e-01   +4.426381586424205e-02   -1.864980285660054e-01   -6.495582673689190e-02   -1.023542469438281e-01   -1.488700074660292e-02   -1.241152762623068e-01; +6.052490820650101e-02   -1.081096741877564e-01   -4.934578205661006e-02   -9.724244987802695e-02   -1.009173539545326e-01   +1.577367479470402e-01   +2.552659424767070e-02   +1.154128015496063e-01   -6.832215023203334e-03   +2.744920622371744e-01   +3.889947082601462e-02   +4.578870586889513e-01   -2.441835783093811e-02   -1.235902680491121e-02   +1.579773547511336e-01   -2.328239001075679e-01];
L2I_L1I_iGABA_netcon = [+2.844090751667954e-01   -1.813969194493616e-01   -1.004962763533348e-01   +2.456514848098694e-02   -1.441733758880617e-02   +1.894679653364938e-01   +3.088405264147935e-01   +1.859184893892109e-02; -1.609645154545835e-01   -2.451290557350744e-01   +8.163414348418822e-02   +2.118461709298937e-01   -1.003625403426543e-01   +6.945919638249455e-03   +1.814971529224325e-01   +9.198538615004279e-02; +2.306239612533041e-02   -1.851596259448552e-01   -3.303765687210607e-02   +1.326409786328617e-02   -1.851971542158020e-02   +4.617112046374518e-02   +2.596820171234022e-01   +1.690291249688186e-01; -3.180630441490843e-01   +3.042422730157708e-01   -8.321419398836058e-02   +7.710085701062971e-02   +1.177076809222525e-01   -2.556050911695962e-01   +1.186251510525497e-02   -2.145614997491721e-01; -2.831130026108473e-01   +6.396979844300416e-02   +2.815655775099635e-01   +1.741726121015541e-01   +3.277423363283972e-01   -2.836451469101261e-02   -2.035755685625963e-02   -3.168787566609518e-01; -1.491028514061354e-01   -2.308968368629014e-01   +1.427890307892329e-01   +7.901752240483140e-02   +7.764293561755803e-02   -1.020738840227501e-01   -1.039648554409943e-01   +1.020389536645847e-01; -1.018227722979784e-01   -4.017219554390214e-01   -6.099961108926752e-02   -3.071377611820995e-02   +1.068153368452839e-01   +3.676379106154480e-01   +3.106139020175462e-01   +9.407400065785243e-02; +2.776966935716205e-01   +2.062151348060690e-01   +2.621661822267567e-01   +1.349054080886549e-01   -1.410283798467052e-01   +1.860107938499356e-01   -1.056023836500432e-01   -1.428554264924422e-02; +1.937261108223353e-01   +1.806463463838641e-01   +2.366947052859665e-01   +1.211564942651930e-01   -1.722870654294816e-01   +7.001346068590134e-02   +3.614753021609434e-01   -5.947261467409057e-02; -2.127883630804753e-01   +1.380345390085295e-01   +1.537215648553401e-01   -2.940973308208322e-01   -1.496449365324480e-01   +2.637276784493566e-01   -1.532265973746709e-01   -1.306451946730016e-01; -6.933532499580501e-02   -9.771568888408903e-03   +5.166547951452360e-02   +1.824711768679867e-01   -4.906784235302131e-02   -1.616409353849186e-01   +2.765454923629026e-03   +6.751220691265121e-02; -7.183044248372396e-02   -1.075947974885738e-01   +7.396990887730764e-02   +1.916994300440211e-01   +8.241056843309200e-02   +1.064729126654894e-01   -1.628583426093619e-01   +2.030498472803428e-01; -1.147554088988308e-01   +9.838782149219873e-02   -2.000183448770335e-02   +8.442107318934985e-02   -9.265772105423239e-02   -1.818225780088265e-01   -1.273842566096983e-01   -2.064729753349440e-01; +1.918347411058472e-01   -6.053919702917325e-02   +2.213667627948746e-01   -1.013106273678585e-01   +1.240245642084479e-01   +6.128170301121495e-02   +3.134896900701669e-01   +1.982582209777375e-02; -1.422661865130765e-01   -1.995759122950170e-01   +1.650724587407026e-01   -3.117428525905534e-01   +3.523078165177237e-01   +7.525862440148617e-03   -5.048101347244650e-02   -1.355121467941662e-04; -1.641959842351366e-01   +2.772076131784280e-01   -2.059525162699340e-01   -2.706705561827509e-01   -2.249337299352823e-02   +1.333006823131621e-01   +2.743314086770465e-01   -5.768333136911545e-02];
L1I_L2I_iGABA_netcon = [+1.519368671318065e-01   -1.211834136915356e-01   -1.046106833369690e-01   -2.374614037242935e-02   -9.694831802605623e-02   -1.745692030976297e-01   +1.141043588996119e-01   +1.460829994654818e-01   +8.422293989339716e-02   +7.441680302987688e-02   +3.607438251932184e-02   -4.777533441841889e-02   -9.657312008293641e-02   +5.424425595806003e-02   +1.431571721359050e-01   -2.949452623600028e-01; -1.966474545995051e-01   -1.070323497722984e-01   -1.254572489819885e-01   -6.221180914939375e-02   +2.459544231073903e-01   -1.840362481393309e-01   -2.424687225889314e-01   -1.886851189432474e-01   +5.818931628693896e-02   +8.016976420435330e-02   +3.201224067825962e-01   +4.522584199963094e-02   +8.005180964450515e-02   +7.025040943614411e-02   -5.671250930291739e-02   +2.250473615313076e-01; -1.500793030356789e-01   -9.889553605592163e-02   +2.057019590208648e-01   +4.542457047374993e-02   -1.075949274323845e-01   +2.285026414228386e-01   +5.160184915502233e-02   +1.412660159827452e-01   +1.895442724787980e-01   -1.549589111803704e-01   -5.757115886988898e-02   +4.786725044839672e-02   -3.744623841376986e-01   +1.186600553050412e-01   -2.700244628127811e-01   +4.116406351245885e-02; +2.468257243215993e-01   +8.139420737547297e-02   +3.700630195454825e-02   +1.568776880785387e-01   +1.350724087553366e-01   -3.976528740961091e-02   -3.091538868367556e-02   -4.010503286896538e-02   +9.202018844266413e-02   -7.386796839945302e-02   -2.765590711982829e-01   -9.242648161752692e-02   -2.927966034914065e-01   -1.966681743256471e-01   -9.629213538193444e-02   -2.566092356667360e-01; +3.825918181142082e-02   +1.199105338501565e-01   +1.240652702821440e-01   -1.861614319067661e-01   +1.701245280239470e-02   -7.342734860449761e-02   -3.244174058498182e-01   +3.292536505932372e-01   -1.780974720183842e-01   -1.656656619653196e-01   +3.648857336914593e-01   +2.308931445962747e-02   -4.228674141126320e-02   +1.887907118025718e-01   +5.091635265162638e-02   -8.067157588277965e-02; -2.095962322481695e-01   -1.818350544037645e-01   -3.477418030415215e-03   -1.911955944301163e-01   -8.514149196265190e-02   +1.254286379218322e-01   +2.010085647209314e-01   +5.880760501285431e-02   +2.318834839444916e-01   -1.722253446344619e-01   +2.009320693540936e-01   -4.961595315004350e-02   +1.904347572220086e-01   -3.195503175617838e-01   +4.289549041009901e-02   +9.614866628262274e-02; +4.646441242064325e-02   +1.177828324083930e-01   -2.010807679975904e-01   +1.009925112524569e-01   +4.481776789010744e-02   -1.160270175675211e-01   +3.276683919120608e-02   -1.593360377350312e-01   +1.646924634198623e-01   -1.644614334131238e-01   -2.480318363492059e-01   -1.662784148592923e-01   -8.075049631256295e-02   +1.062827996359909e-01   +2.411884557186854e-01   +9.216135322031350e-02; -5.809757880745413e-02   +2.393018952592946e-01   -2.830765527418442e-01   -2.392408685399184e-03   +1.716236334183813e-01   +3.044907653202881e-01   +9.694867569849790e-03   -6.173176237561497e-02   +9.293230498829794e-02   -1.413042370521253e-01   -1.021288492437077e-02   -3.351141877339039e-02   -7.988691059969428e-03   -2.132149688419498e-01   +3.635613080459342e-01   -9.964263584679818e-02];
L2E_L1E_iAMPA_netcon = [+4.201409594398506e-03   -1.765537679495350e-01   +7.283554116017102e-02   +2.303753937274897e-02   -1.389017411064161e-01   +2.620865876244264e-02   +1.466092944235015e-01   +2.215699992250399e-01; -2.488307816845926e-02   -1.368446323371975e-01   +2.309712701687362e-01   +2.374878863023424e-01   +1.859678133041215e-01   -1.803614814749138e-01   -4.395238958618133e-02   -1.874443462050903e-01; -2.370591484904471e-01   -9.620289072359577e-02   -1.293401942963170e-02   +1.639415799340552e-01   +1.493383348726210e-01   +4.084676946737191e-03   -1.456280160210144e-01   +1.601887524832993e-01; +1.560093760779150e-01   +1.657316420559059e-01   +1.302887057744228e-01   -1.059111544399988e-01   -5.032640579801807e-02   -2.878405134159932e-01   -3.237738417540315e-02   -2.637239619402585e-01; -1.294208044449294e-01   +8.204478383328637e-02   -1.516638652803405e-01   +9.589233279024405e-02   +1.567689116287037e-01   -2.771435283430658e-02   +5.795046529561886e-03   +2.548092168040864e-01; +6.635878384278383e-02   +5.373086002662317e-02   -8.345065545596123e-02   -2.605520053474252e-01   +3.152833372689303e-01   -1.557468536741280e-01   +1.063097854844086e-01   -7.184839991457767e-03; +1.122749774220649e-01   +1.066476803605457e-01   +1.534102117502415e-01   -4.381411414481578e-03   -2.375461900372474e-02   -1.833329344310804e-01   -9.199634732294824e-02   -1.847864550471616e-01; +1.621478300934086e-01   +2.344629881943436e-01   -1.575382433354082e-01   -1.482414739561942e-01   +1.888075175453795e-02   -2.140772678127561e-02   +9.201665618018744e-02   +1.590386853088676e-01; +5.133600840045224e-02   +1.836862438165967e-01   +9.924366643537791e-02   +1.080948371595024e-01   +1.938038236249623e-01   +3.105792883278978e-01   -1.993540265873239e-01   -8.966363686850794e-02; -3.128969786012455e-01   -1.892888205885800e-01   +1.540168315958173e-01   -2.455070181085401e-01   -1.512004763000262e-01   +1.262774447510148e-01   +5.939018218956149e-02   +2.446485253024331e-01; +3.613823491793873e-01   +3.339204362454018e-01   +1.491207926100973e-01   +2.175911893541385e-01   +6.701462005684289e-02   +1.140173505946474e-01   +1.314874121247066e-02   +1.586315229793273e-01; +3.652605680679760e-02   +1.529360721594311e-01   +8.955504683333254e-02   -3.354148439982542e-02   -4.669789583820205e-02   +1.676317130807780e-01   +2.887301649125674e-02   -3.610719892514540e-01; -1.472695500452349e-02   -2.803373308260413e-01   -5.032484219713194e-02   +6.654407240234303e-02   +8.405732324958720e-02   -1.575159643584036e-01   -2.389560959896706e-02   +1.409993059924421e-01; +2.451296917927891e-01   +2.059588501114026e-03   -1.655762626420037e-02   -2.558202801155080e-01   +1.458134484696432e-01   +4.165932761485022e-02   +3.472860641408509e-02   -9.349363818062667e-02; +1.499744675342962e-01   -4.365570527220743e-02   -1.549393620791676e-01   -1.558374456721555e-01   +2.538277947303601e-02   -3.485769824879949e-02   +1.237889115526948e-01   +9.825601370778278e-02; -1.067709289963358e-01   -7.152932942651627e-02   +3.369000190701965e-01   -1.570665934970610e-01   -1.699147865540875e-01   +9.746436090902259e-02   -6.580124588514706e-02   -3.243811851427783e-01];
L1E_L2E_iAMPA_netcon = [+5.284852745016084e-03   -7.476593302409096e-02   +1.874654097614376e-01   -2.005091002488970e-01   +7.197400822162660e-02   -4.606505078094423e-02   -1.520789040060894e-01   -6.898951971294023e-02   +1.644109364625769e-01   -1.483334690146879e-01   -1.005733027614419e-01   -1.495515080509537e-01   +2.962059183285567e-01   -4.561827585761181e-02   -2.666682816837438e-01   +7.775781866543970e-02; +1.366103005880109e-01   +2.376844929299515e-01   -1.510850123705058e-03   -2.199351609170752e-01   -5.084560903097282e-02   +2.645055989967371e-02   -2.468424267829185e-01   -2.565678456623579e-01   +9.954160205554954e-02   -4.841153784399838e-02   -3.318406112658950e-01   +2.097940599923077e-01   -2.242098435741143e-01   +1.075017067717286e-01   +7.723261916681795e-03   -1.368342872090623e-01; +1.890946379357884e-01   +1.172362186575418e-01   +1.262941642092984e-01   +2.644093883960608e-01   -1.236863715410528e-01   -2.602497311978014e-01   +1.184226091952429e-01   +9.418444116742816e-02   +1.587301562741416e-01   +3.526271539820400e-01   +3.311886638971269e-01   +2.120662528656288e-01   +4.280137840876090e-02   +1.871363744963269e-01   -3.304705297879501e-01   -1.158422361675336e-02; +2.032691983967764e-02   +1.496118909778266e-01   +9.517094706134339e-03   -2.924299502039418e-02   +4.854883747361975e-03   -3.889062474713942e-02   +1.237061649064110e-01   +7.219736304852892e-02   +1.424244596157037e-01   +8.186296308395440e-02   +1.323339161781286e-01   -7.951652523320055e-02   -2.056964529025309e-01   -1.780189032242124e-02   +2.576925925376543e-01   -4.062115796187466e-02; +2.101329167709954e-01   +1.441404703457854e-01   -2.444078196144567e-01   -3.726314908177209e-02   -1.006080915502651e-01   +1.360700966215828e-01   -2.299277949730677e-01   -1.651486258036840e-01   +2.452521704734133e-01   +1.324742080552570e-02   +8.672862031817949e-02   -1.351996258053640e-01   +2.770789149026792e-01   -1.197044398299314e-01   -2.021070663443959e-01   +2.439285893407803e-02; +6.702452515491894e-02   -6.418328747679235e-02   +4.213155321723197e-02   -1.118816281625696e-01   -1.149531744812539e-01   +1.592729311380873e-01   +9.145107424025428e-02   +2.319435094889354e-02   -2.235272533916038e-01   +1.360287629682295e-01   -2.323872503447917e-01   +3.617010213522098e-02   -7.491041740537502e-02   -6.793270650661969e-02   -1.474465703778938e-02   -3.903880278340964e-02; -1.295309287967595e-02   +8.434238806249156e-02   +7.278197086337762e-02   +1.103668799120260e-01   +6.387401733420731e-02   +1.625640647832579e-01   +1.323655472951572e-01   -6.275787740343768e-02   +7.864622312983635e-02   -2.925051624607100e-02   -6.512392490466934e-02   +1.883970928299752e-01   +6.399682451425966e-02   +1.948933170819664e-01   -1.387853355319405e-01   -4.615808378633014e-02; +1.365298990314999e-01   +3.290492330939630e-02   -1.701147985829735e-01   -6.014534866436221e-02   +1.410445028185487e-01   -5.246625797626060e-02   -9.104005202634072e-02   +4.496525690716431e-01   +3.075142460861591e-01   +1.838416390064852e-01   -1.064057961899903e-01   -3.177919319381159e-01   +1.902253718643232e-02   -5.435693015816054e-02   -2.718260200239694e-01   +1.114407747141942e-01];
L2I_L2E_iAMPA_netcon = [-9.204855516685338e-03   -7.184477476864175e-02   -1.403965399562195e-01   +3.964854272419998e-02   +2.011255031629055e-01   +6.130461430020511e-02   +7.998988096511163e-02   -7.874422182222339e-02; +2.623591238528736e-02   +1.545560346875203e-01   -4.755825839075430e-02   -2.289118075012695e-01   -2.626334127053939e-02   +3.180835368395490e-01   -1.018405502021990e-02   -3.372498727016675e-02; -5.588482113133279e-02   +2.198266733760370e-01   +1.490285001205953e-01   +2.925629472074571e-01   +2.196672858994982e-01   +3.356246221517195e-01   +1.274983137356603e-01   -2.078800935059683e-01; +1.803908772384948e-01   -1.002040316926083e-01   -2.921361878609789e-01   +9.646464654576975e-02   -1.369870660942349e-01   -8.661006789173682e-02   +3.070910546389486e-01   -1.652796767125319e-01; +1.495916756603619e-01   -8.759961199506242e-02   -2.082562662530912e-01   +9.542285827163689e-03   +1.654039966785406e-03   +1.501803686241518e-01   +2.732456221289340e-02   +2.043946825498137e-01; -1.518332812549056e-01   +1.063217298400731e-01   -1.068829900290455e-01   +2.350623277668047e-01   +1.113852547616406e-01   -1.108103301442897e-01   +6.132688818243340e-02   -1.129133501601723e-01; +1.609396613580183e-01   +1.100279504112840e-01   -1.746669527321901e-01   -4.105624871707540e-02   +5.765872363575930e-02   -2.071612621767013e-01   +1.794024333175241e-01   +1.906765148160911e-02; -2.812949068816695e-01   -5.010861753004349e-02   -1.492520092178156e-02   +3.228981482019346e-01   +2.930331560919701e-02   -2.815401742031930e-01   -3.476045456389164e-01   +2.499591395271331e-01];
L2E_L2I_iGABA_netcon = [-3.942533363081948e-02   -1.023123371993188e-01   +8.884416654741581e-02   +1.740308508451772e-01   -6.381716924223868e-02   -2.136342979228318e-01   -1.077081374128387e-01   -9.212989741547442e-02; +1.771730120391829e-01   -2.158214821277482e-01   -1.627160965460640e-01   -4.613407395116317e-01   +6.938787450352758e-02   -4.516506004819305e-02   +2.668166828319293e-01   +7.258139887944612e-02; -8.817017939125663e-02   +9.467924412816089e-02   -9.608882964461560e-02   +1.206343151372948e-01   -1.412917471309120e-01   -2.600586751393081e-01   -3.312430658377282e-01   +5.259314128239929e-02; +2.928628114366221e-01   +2.826996304782935e-01   +1.889779709837203e-01   +2.670630541693454e-01   -4.804730585488074e-02   +1.947286624089390e-01   -1.374353925556690e-01   +1.462930276881012e-01; +7.392599811318842e-03   -4.313034001884833e-02   +1.588738619101777e-01   -1.416289914760251e-01   +1.185594154332386e-01   +3.552430427464288e-02   +2.808226027660931e-02   -1.764306177666125e-01; -1.475284585480052e-01   +1.738130718793831e-01   +1.506537801243310e-01   -1.525295213062161e-01   -1.680360591353591e-01   -2.326889095484409e-02   +1.471228452724515e-01   -9.785047004038888e-02; +2.119119144779348e-01   -1.024903394556945e-01   -1.645989036888551e-01   -1.283446429748985e-01   -8.506745034638313e-02   +3.423295898749920e-02   +2.949103467879299e-01   +9.717038680926190e-02; -2.853228287156049e-01   -7.827803118831467e-03   +4.868408615982948e-02   +8.602617284670880e-02   -1.882066112836876e-02   -3.096335212504408e-01   +7.011809852392725e-02   -1.654879741982210e-01];
L3E_L2E_iAMPA_netcon = [-4.676325077487842e-02   +1.756797203324473e-02   -1.396242873724274e-02   +1.937011487216798e-01   -1.617613727257246e-01   +3.096440042382249e-01   +1.581829711713707e-01   -8.209818321168952e-02   +1.818697839119392e-01   +1.930218461485808e-02   -3.995822102437767e-01   +7.341564592354850e-02; +1.856769079993487e-01   +5.051166780521735e-02   +2.361442521628633e-01   +7.330116366629433e-03   -2.138813570222425e-01   +6.824615492062305e-02   -1.912028179579338e-01   +2.035243067801913e-01   -1.376137291173350e-01   +5.195784458382009e-02   +4.201607085288543e-03   +3.974784674205493e-02; +1.065066750223493e-01   -6.572715056525524e-02   -1.303410862287959e-01   +1.035221427540961e-01   -1.947752201014787e-02   -9.517171806305008e-02   -2.740613587479683e-01   +1.309534525279048e-01   +1.367378246241217e-01   +7.207653839272823e-02   +1.423276090898422e-01   +7.474365720487447e-02; +1.361022912571378e-01   -1.439103003474968e-01   -1.128178774747215e-01   +2.709337151022859e-03   -4.839689875995359e-02   +1.744558613114719e-01   -5.071369706777640e-02   -3.585230482949590e-02   +1.347039598471954e-02   -2.301020626959661e-01   -1.742520217469505e-01   +2.597447310229269e-02; -5.899081576120375e-02   -1.527188389234317e-02   +1.935073403697307e-02   +3.235237885060969e-02   -2.923191591619213e-01   -7.036754005051287e-03   -3.136230464298517e-01   -1.378426373349486e-01   -1.951434667004868e-01   +6.688036852171182e-02   +2.362000722133126e-01   +7.453254550524419e-02; -9.408491148605382e-02   -1.674687199268881e-01   +4.505871041983718e-02   +2.652415322021696e-01   +2.176433055224598e-01   -1.481532203656467e-01   -1.125258766607511e-01   -2.727686507019570e-01   -8.494776214240353e-02   +3.107144706479686e-02   -2.119524445103020e-01   -3.286629904508917e-01; -4.921091176223558e-02   -9.117164740388906e-02   +1.913175502527187e-01   -9.443588617257340e-02   -1.291630084592946e-01   +1.029942144550956e-01   +1.302348020061882e-01   +1.345231054732856e-01   +8.789727774175003e-02   -1.078201530931405e-01   -2.279827917192478e-01   -9.104944253794596e-02; -3.107079979367504e-01   -7.801472407844591e-02   -5.520306248592053e-02   +5.608173096305148e-02   +5.423446042666109e-02   +2.916610402133978e-01   +1.746194137442891e-01   -4.743763274899170e-02   +1.003049128872309e-01   -9.394942243818261e-02   -7.000161287620428e-03   -1.085564244270481e-01];
L3I_L2I_iGABA_netcon = [+1.053908646992340e-01   +1.842532554690068e-01   -3.641163655353875e-02   +7.699036726191422e-02   -1.716331864750207e-02   -1.954533851545726e-01   +4.971050244153417e-02   +3.074259801647062e-02   +8.131040795275237e-04   -1.018253739490010e-01   +7.442509718677537e-02   -3.786991821958360e-02; -2.371459834267047e-02   -1.292259011988321e-01   -2.097813667296204e-01   -2.610782504992291e-01   +1.541377510789288e-01   +4.182259855643740e-02   +3.669952091259071e-01   -8.166232603910262e-02   +1.398544777397158e-01   -2.057510296542819e-01   +1.566301782325388e-01   -9.309149127002940e-02; +2.659809193469229e-02   -2.319311953444460e-01   +1.370254942970566e-01   +1.116842054732638e-01   -1.202211522586847e-01   -3.921867246768140e-01   +1.215302977138378e-01   -1.837683370011457e-01   -2.017456600167813e-01   -3.994925979312787e-01   +1.453978544666902e-01   +1.652467398374647e-01; -1.966744027701768e-01   -2.813446674288754e-01   +3.880945643534123e-01   +2.060469240933002e-01   -2.956032977688421e-02   +5.386092752940079e-03   +1.769977360003345e-01   +2.711780120144412e-01   +1.582154102422334e-02   +2.081466433340082e-01   +7.353408811412998e-02   -1.923270108646936e-01; -3.096367933387407e-01   -1.718761796289643e-02   +1.898462058457002e-01   -1.895991474856575e-01   -1.056320561854774e-01   +2.645224401676234e-01   -8.222354140605312e-02   -2.220228573097822e-01   -3.434636836646369e-01   -1.481158521031266e-01   +4.580590871406635e-02   +1.261804337749773e-01; -1.168532339090296e-01   +4.072844537826617e-01   -2.222722859456087e-01   +1.360904294481000e-01   -2.866145481205949e-01   +1.490464576712281e-01   -2.377303850456851e-01   +1.142068048932863e-01   -2.886799540743371e-01   -9.856440025316701e-02   -5.523270965857986e-02   -1.042497877219371e-01; -1.005889741128210e-01   -3.333657181282167e-01   -4.575467042491040e-02   +2.169718421070373e-01   -6.404071901056578e-02   +2.248891998325676e-01   -1.209237344901548e-01   +3.611344124166276e-02   +1.167506233235187e-01   -3.493524505198012e-01   -1.356072109028139e-01   -1.609791578137400e-01; -2.027862629496031e-01   -4.099235646087297e-02   +1.256381901285702e-02   +1.783127058428396e-01   +1.985621408139220e-01   +1.176172555839504e-01   +1.241377639090626e-01   -7.054578578899887e-02   -1.516040726117138e-01   -1.438403149048998e-01   +1.398651537662004e-01   -5.655206710684620e-02];
L2E_L3E_iAMPA_netcon = [+5.739442316998982e-02   +1.129511280221888e-01   -1.222979774784412e-01   -4.460072335229902e-03   +2.295150213184244e-01   -1.277168409084352e-01   +2.350029157971542e-01   -3.384912973299565e-01; -6.068913625125424e-02   -3.832208439592315e-01   -2.580866333088987e-01   -5.069950473358165e-02   -2.513317902884600e-01   +6.897070821074532e-02   -2.541752418146089e-01   +9.296619425602264e-02; +1.835455918978495e-01   +4.613402943143412e-02   -2.185968969750400e-01   -1.172403545291934e-01   +2.669040358740221e-01   +4.645867724553580e-02   +5.442237211330719e-02   +9.829548422958276e-02; +1.365249289620970e-01   +7.901051719295907e-02   +9.425974997827687e-02   +4.026430098600365e-02   -9.089007601158657e-02   +6.785878469328963e-02   +6.117922686301826e-03   +7.334062350202042e-02; +6.283272049643485e-02   +4.623375417152633e-02   +3.018045373630165e-01   +1.531600929916776e-01   -6.223545461572710e-02   -9.309824858641425e-02   +2.359469467716421e-01   -1.425944616428835e-01; +3.612962025964401e-02   -3.315874116784374e-02   +1.301032662747842e-01   -2.335117545475376e-01   -2.319888017595585e-01   -1.390215396368294e-01   -1.873242028021472e-01   +5.514616836794994e-02; +1.418090577863488e-01   -1.412672532678279e-01   -2.232128399946429e-01   -8.688553403163288e-02   -1.770140031208775e-01   -2.645891216974089e-02   +4.236165400045162e-02   +9.353177000057399e-02; -1.696302110201891e-01   +2.989583131909095e-01   -1.871537462715035e-01   -1.532762100103772e-01   +1.080067850711012e-01   -1.206906672484009e-01   +6.614987317362103e-02   +2.991147301128898e-03; -5.400871222650279e-02   -1.524148435681251e-01   +2.516807627526915e-04   +2.845487438600457e-01   -3.128412099709927e-01   +1.778011673494569e-01   +7.659877509582146e-02   -9.578238273686784e-03; +4.784961093936209e-02   -1.002122767412596e-02   +7.380688371698202e-02   -1.140358688445463e-02   +4.033171991072908e-02   +2.255556520046127e-01   -2.341672785363695e-02   -1.068739486467741e-01; +2.096258957613082e-01   +6.944110736188613e-03   +3.176976478886698e-02   +8.897224017529069e-03   +2.306548057017058e-01   -1.165703809686795e-01   -1.061120613107828e-01   -5.123914312542324e-02; +2.167807004263837e-01   +3.034399556227529e-02   -5.875559047237702e-03   +2.188692621933641e-01   +1.738553573782863e-01   -2.635785456101320e-02   +3.046803740444775e-01   +1.303202292328523e-01];
L2I_L3I_iGABA_netcon = [+2.185918604898778e-01   -1.085033865972349e-01   +6.624500755092336e-02   -7.053889137997721e-02   +1.271917182952368e-01   +5.747014322142122e-02   -2.190818907569526e-01   +1.102862981226974e-01; +1.038236284766837e-01   +1.263774488030392e-01   +8.561402456328930e-02   -3.143940613198974e-03   +7.123412948880772e-02   +3.554246056884665e-02   -1.310565956147788e-01   -1.134570525329946e-01; -2.560676397150359e-02   -4.218445848463530e-03   -4.096809893654421e-03   -1.271458934412050e-01   +1.878859675875548e-01   -8.015401300832478e-02   -3.186019805318324e-01   -5.958738092575003e-02; -1.870815050253893e-01   -6.894035074966656e-02   -3.206192079834306e-01   +1.311990788487460e-01   -1.116017766675231e-02   -3.423675863218418e-03   +1.859192508782304e-01   -6.904154613026900e-02; -6.316611958401816e-02   -8.422586917851313e-02   +8.708369965830159e-02   -1.932107449761279e-01   -8.643022859128538e-02   -1.398689338613523e-01   -3.508572307152397e-02   +2.104092233244781e-01; +2.405287943698598e-01   +3.864768960986235e-01   -1.954444371719473e-01   +1.141058054601052e-01   +1.277266271946359e-01   +1.369611082682553e-02   +5.891135343973405e-02   -1.578919127923934e-01; -1.305419337280147e-01   -1.678932998065827e-01   -7.585718926086515e-02   +3.466666570019000e-02   -2.616503347280850e-01   -1.249644462753202e-01   -1.321189396636706e-01   +2.485515536422900e-01; -9.205724650551469e-03   +3.644159591576388e-01   -4.355189575921629e-02   +2.756581704396450e-01   -1.034017826747072e-01   +1.367865772130443e-01   +2.589146762708181e-01   -2.315391862295678e-01; +5.598322825680762e-02   -6.107862014876021e-02   -4.547483377493755e-02   +2.295905355339681e-02   +8.021649633964215e-02   +2.684635301372769e-01   +3.051877797655701e-02   -4.214563522340686e-02; +1.042007360296643e-01   +1.099943076505526e-01   +2.375738352030441e-01   -2.570269673551157e-01   +1.473195022172160e-01   +2.567925165017895e-01   +1.227522730478548e-01   +3.349497913667699e-01; -1.503489492391747e-01   -3.840870916460728e-02   -2.811726358063174e-01   -2.174363137301186e-01   -1.093905331360875e-01   -6.565012055920644e-02   +6.152578853725610e-02   +6.162452156065944e-02; +9.101189648123592e-02   +6.571510726669343e-02   +1.342323485618724e-01   +1.286784831825469e-01   +2.870879972244001e-01   -1.003194149245815e-01   -7.096926066247265e-02   -3.053109631596010e-01];
L3I_L3E_iAMPA_netcon = [+2.287592045101193e-01   -5.024682488730645e-02   +1.321877093966718e-01   -2.763991909951718e-02   -1.263410559928844e-01   -4.508740988733224e-02   +1.657645012181838e-01   +5.687926948062650e-03   +1.266097446384830e-01   -2.217016388979511e-01   -7.928725485908483e-02   -3.662401888995748e-01; -7.766645284534661e-02   -7.510478135394399e-02   -2.078957686321811e-01   +7.335729564006729e-03   -1.229266933599989e-02   -1.903382444733560e-01   +1.453990123482681e-01   +2.576661701735238e-01   +9.351682692201760e-02   -9.313416792657779e-02   -5.579397662687852e-02   -7.170878187060921e-02; -3.866887175729536e-02   -1.638892812975348e-01   -2.311711736596542e-01   +3.310640084705898e-01   +1.109334794801471e-01   +1.876798911432224e-01   +2.016097327179140e-01   -2.480501508681894e-01   +2.680547378517902e-01   -1.123939730555475e-01   +3.177933062188544e-01   -1.302424805487364e-01; +4.608249741714320e-02   +9.674208649650026e-02   +1.299111888602879e-01   +2.337476530730534e-01   +1.940679955482169e-01   +2.307663111582018e-01   +3.106891092675033e-02   +5.626419310556826e-02   +1.708508512327411e-01   +1.202268886896271e-01   -5.441685580677434e-02   +1.100275300368719e-01; +1.398475543143228e-01   -9.868847702879378e-02   -5.532482313418130e-04   +1.478517561549500e-01   -1.220622266524702e-01   -1.404652477419112e-01   -1.371293721761890e-01   +5.590538587825017e-03   -1.615800922233338e-01   -1.047748915336644e-01   -1.844621531789349e-01   +1.275962163299407e-02; +1.222996724376997e-01   +4.544504775200516e-04   -7.160608126282052e-02   +1.602706399880662e-01   -8.344577550658561e-02   +1.443701721418029e-01   -3.195535042558464e-02   +5.741075043865190e-02   +7.533683533649156e-02   +4.137440573488856e-02   -5.084461942812386e-02   -3.536334917067737e-02; -8.538919612316394e-02   +4.824227937292992e-02   +7.067476667609569e-02   -2.414585705370078e-02   +4.625436959745490e-01   -1.713330126528999e-01   +2.829902165194104e-02   +4.570212704848291e-03   +3.859097060524661e-02   +1.852769645613515e-01   +1.122960662104719e-01   -5.614698585789933e-02; -9.640653672941635e-02   +2.594526175917249e-02   +2.169377548987987e-02   +2.088530166548049e-01   -1.599001346360991e-03   +9.900386401966796e-02   +2.323102997942437e-01   -1.604501038010526e-01   -1.209013526947067e-01   +5.627426976481252e-02   -1.173304488676301e-01   -4.642164584186145e-02; -7.329512474028899e-02   +3.183553750603061e-01   +1.886480628110169e-01   -1.288255417292775e-01   +3.300957349978163e-01   -3.269517184123037e-01   -1.587194210733620e-01   +1.242800176987918e-02   +2.157625237746262e-01   -6.017280874285121e-02   -3.781571713161043e-01   -3.941672121904221e-01; -1.146662902611365e-01   +4.824602145516045e-02   +1.050340257921983e-01   +1.328771338591484e-01   -1.810420166294238e-01   -1.268925055311309e-02   -7.673816581491767e-02   +1.836967812250253e-01   +2.348290244784604e-01   -6.709327874733123e-02   +1.441692201705161e-02   -3.843651114122673e-01; +1.020636382371346e-01   -2.002529176413899e-01   -1.422630459748898e-01   +8.210108061881487e-03   +1.042219046864900e-02   +4.487406712442774e-02   -1.827545005752162e-01   +1.858851371508526e-01   -2.573322781020082e-01   +1.656581739916374e-01   +1.869222759604639e-01   +9.231123424223538e-02; +1.563863772759952e-01   -6.991701695668147e-02   +1.235803020408208e-01   -1.111690172886846e-01   +4.260992000395235e-02   +2.129286435056997e-01   -4.774088051782342e-02   +5.494448368289021e-02   -2.457009189601484e-02   -1.617753073390354e-01   -2.018972659689005e-01   -2.172439302015957e-01];
L3E_L3I_iGABA_netcon = [+1.117125091989171e-01   +1.608187888854689e-01   +1.147446195683214e-01   -1.134187872932086e-01   +2.357964942586241e-01   -1.469211178514461e-01   -1.874318701318160e-01   +1.683981906840122e-02   -2.037818282423104e-01   +5.446606043522607e-02   -1.045982658195955e-02   -1.529221979400965e-01; +1.069279875346651e-01   +8.029646196915939e-02   +1.960607687910973e-01   +3.223444279444990e-01   -1.390737910767116e-01   -2.453087034681163e-01   +7.589901394750928e-02   +4.252162449832457e-02   +2.936132227356977e-01   -2.129502824195144e-01   +1.248803648165284e-01   -1.911608933484195e-01; -2.353532945526178e-02   +1.905893123157900e-02   +2.098453107224089e-02   -1.716548842333233e-01   -8.341538567760751e-02   -8.762673029686875e-02   -1.637952165830885e-01   +2.011615223941441e-01   +5.084146699521535e-02   -1.022525294349102e-02   +2.501422598536432e-03   -1.017107978062275e-01; +1.368091063815735e-01   +2.332440303366435e-01   -5.000414665756168e-02   +7.671109156981215e-02   -2.421817192659205e-01   -2.966828701729185e-02   -1.569058707524856e-01   -1.098402749114139e-01   -4.921700414051100e-02   +2.422165376506125e-01   +8.919080069668111e-03   -1.336728804115059e-01; -2.896978359180398e-02   +3.984953616188380e-02   +1.489026669961402e-01   +2.149781409065680e-01   +1.762927092295649e-02   -2.229247536652128e-01   -8.641258195904038e-02   +9.389897408991892e-02   +3.811029806359484e-01   -4.358487362833371e-01   -1.651281673322488e-01   -7.623256802205837e-02; -4.290429876892077e-01   +4.045105623841857e-02   -2.299605495562325e-01   +1.663496726424283e-02   +1.544146350363926e-01   -4.805870446779265e-02   +7.667156615810825e-02   -3.620796760438569e-03   +2.580870763777371e-01   -1.524037033004300e-01   +2.676272196743434e-01   +4.221201231894789e-02; -3.153599565289049e-01   +2.974756671844140e-01   +3.858976622221365e-02   +2.608791130957469e-01   +1.848111604970048e-01   -2.385750858716703e-01   -2.464472081457527e-01   +1.896633018544983e-01   +6.323850854159933e-02   -2.227535953719885e-02   -3.539725267521790e-02   -1.591812474440301e-01; -3.140869159311127e-01   -2.421061223456720e-01   +2.034441281489438e-01   +1.719015980388074e-01   +3.024419481438828e-02   +2.287814645850608e-01   +3.457523283848011e-02   +9.374040272236213e-02   -2.950789547621027e-01   +2.847609939445357e-02   -1.438624389191508e-01   -2.163365267076887e-01; +3.981373677935856e-01   -9.921030637528516e-02   +2.267462435474144e-02   -1.007354939357107e-01   +2.095043730673594e-01   +1.472132376604347e-01   -8.098989101178343e-02   -8.735170822887387e-03   -1.756867601031357e-01   +2.407762964291769e-01   -2.590516179956923e-01   +3.592269877056291e-02; -2.589395237180394e-01   +8.140378557072556e-02   +6.663940652612696e-02   -9.406414634132509e-02   -2.246813466108277e-01   -6.672347274763685e-02   -1.492708942047961e-01   -8.309919026704921e-02   -5.562999568274080e-02   -7.671377676788090e-02   -1.024595557331622e-01   +8.588797057789417e-02; -8.298294655974950e-02   -1.683975070738205e-01   +1.967434523460587e-01   +7.514817126482332e-02   -1.266373123216932e-01   -3.030132217675162e-01   -3.989587281249007e-02   -8.781352807711676e-02   -2.122354399287812e-01   -1.242351341946774e-01   -1.003488538813263e-01   -1.555400547323831e-01; +1.500227928714033e-01   +4.224977906218418e-02   +6.130690863954059e-02   -4.478166821383643e-02   +2.341148174473885e-01   -3.242293577188980e-01   -1.272579775746771e-01   +3.152799342232036e-01   -1.968541898740365e-01   -1.981645651235293e-01   +2.487029216001647e-01   -8.940391738846262e-02];
L2E_Input1_iAMPA_netcon = [-2.382360416014156e-02   +2.531744123135179e-01   +4.972051144421306e-02   +1.140529360931267e-01   +2.090573668770667e-01   -1.409458761322845e-01   -1.009805807484405e-02   +4.046233488822364e-02];
L2I_Input2_iAMPA_netcon = [+2.361701861448663e-01   -1.515103693051424e-01   +1.071275057976233e-01   -1.128543879467897e-01   -5.312622300777503e-03   +6.458765410958421e-02   -7.777412593241273e-02   +3.908417355065191e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
