function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.065164701142214e-01   -5.931180843208937e-02   -1.747252834838277e-01   +1.363403320192276e-01   -1.294057825635523e-01   -1.629262670328874e-01   -8.030528440116161e-02   -3.066413964947837e-03   -6.950216400105295e-02   +1.041917887671467e-01   +1.638925919489178e-01   -1.875524409144443e-01   -1.377704279179504e-01   -6.816384083294216e-02   -7.986506108584450e-02   -1.342734997002051e-01; -1.138821349858743e-02   -9.261537742213040e-02   +2.306307703941828e-02   +3.115871942594369e-01   -1.608066981771276e-01   +2.001911243957035e-02   +7.722898175461569e-02   -2.301215114956025e-02   -3.363054595409827e-02   +1.641639863149696e-01   -8.034423803288988e-02   -3.587647591460872e-03   -4.882968397443076e-02   +7.752949763521124e-03   +3.228358939770546e-01   +8.460785833715245e-02; -6.672979378938022e-02   +1.785565027376998e-01   +6.099346160189111e-02   -2.031204338448414e-02   -2.191736928962761e-01   +1.467506715843366e-01   +1.561866793174669e-01   -9.626130612273413e-02   -1.655261773721474e-03   +3.954639889736816e-02   +1.156338279676116e-01   +6.083435462727608e-02   -2.058609256323808e-02   +2.206998563222530e-01   +4.681457879710355e-02   -1.724751825431873e-01; -1.265237750949413e-01   -5.484459101395125e-02   -1.146166397797784e-01   +1.663612728402018e-02   +5.301265664585565e-02   +1.003554829074824e-01   +2.264863568622810e-01   -1.380058000443507e-01   +6.942724162853965e-02   -8.235551247883567e-03   +2.679973389963290e-01   -1.815141973830064e-01   -5.538458786588610e-02   -2.149557251683284e-01   -1.641696029786310e-02   -2.330282154159767e-02; -2.800258879947771e-01   +4.455412289859055e-02   +6.343770248126426e-02   -1.686296723239656e-01   +1.559834778563961e-01   +1.746700130743554e-01   -2.725611511381599e-01   -1.824353506630488e-01   -1.101491988613617e-01   -7.894160741238805e-03   +1.410792303257102e-01   -2.193177863842058e-01   +1.456337053413294e-01   +2.158695338439678e-01   +5.859940155724639e-02   +2.787474761697616e-01; -6.546817148366844e-02   -2.714710859977286e-01   +9.175414745389730e-02   +2.528694728242668e-02   -5.523659626749766e-02   -5.861861147390598e-02   +1.716967403019455e-01   +8.849748401941665e-02   +2.796011295845678e-01   +8.751638272105904e-02   -9.208570659095443e-02   -4.658704665839979e-02   -7.709612994726699e-02   -1.086164408324515e-01   +1.060555272428188e-01   +1.744127860766957e-01; -1.997123986013300e-01   -2.315780783532500e-01   +3.767694322491303e-02   +2.257878198748536e-01   -1.647772638090714e-01   -1.206597068794394e-01   -3.688550690968475e-02   +3.303303139475435e-02   +3.263117432007087e-01   +2.000541041867523e-01   -8.820778478259986e-02   +9.064201663956749e-02   +2.628125212380684e-02   +4.834899886219673e-02   +1.430320139124381e-01   -3.810835083847521e-02; -9.505412414729203e-02   +1.688403372550545e-01   +1.784638824540425e-02   +9.910053209404614e-03   -8.435097906259677e-02   -2.213924761333121e-01   +1.249473047610250e-01   -1.571551683324343e-01   +1.462782820138062e-01   +4.908058083705689e-02   +4.295601636561303e-02   -6.011825085994760e-02   +7.748999898185716e-03   +4.660629648300799e-02   -2.069632525253969e-02   -3.556730893465242e-02; -2.064516066241374e-01   +1.476769031069351e-01   -8.252336540495676e-02   -2.794869567125102e-01   -1.153151940894803e-02   -2.312965854489963e-03   +1.097340450750782e-01   +4.558935206659753e-02   -2.192742653642412e-01   -2.875452071932567e-03   +1.571013203329035e-02   +9.895254178203967e-02   +1.863128925623446e-01   +6.451065331067997e-02   -1.278347869700626e-01   +5.757496659615315e-02; -2.507191726134289e-02   +6.152808814732109e-02   -1.514298922693955e-01   +1.488500737668501e-01   +1.556032817942413e-01   -4.715201999002990e-02   -4.978870444253424e-03   -1.089849449001853e-01   -5.919672915864581e-02   -5.619206972765871e-02   -1.529720860258623e-01   -7.284838067961306e-02   -3.176158643844548e-01   -1.237888338510247e-01   -1.064748211109753e-01   -2.057342109237481e-01; +6.402150997208822e-02   +4.608266504525665e-02   -3.345004307726757e-01   -8.513340112247482e-02   +8.013668779121666e-02   +1.274309490473789e-01   +1.919578092170628e-01   +8.132822511033305e-02   +5.681748119716461e-02   -5.427445916205335e-02   -3.192003664667280e-01   -5.615675924722563e-02   +1.604466286870908e-01   +1.575219473238973e-01   -1.831511399396642e-02   +1.630415110532972e-01; +2.202503753982364e-02   +1.361462076275891e-01   +4.955070655903214e-02   -2.006508764205854e-01   +1.906259739440406e-01   +3.361859583333791e-02   +2.050062401796266e-01   -1.949839367559249e-02   -4.281633202151949e-02   +5.272685598666894e-02   +1.333727808116326e-01   -2.831094358311721e-01   -2.865565886023887e-02   +5.216758264590850e-02   -4.543711246143012e-02   +4.663043502917286e-02; +6.094354740713613e-02   -1.744419656789999e-01   -1.506132218651250e-01   +1.081108505409557e-01   +3.140996826996491e-02   +1.312471419767540e-01   +1.176489226270356e-01   -1.318575444683925e-02   -2.673786310631046e-01   -2.239699226788230e-01   +1.147909475100798e-01   -7.276207004345964e-02   +7.647548186905787e-02   +2.124615481404060e-01   +9.093770226200226e-02   +1.077544519881663e-01; -1.981369937317813e-01   +2.897963294553676e-01   +3.256636296028824e-02   +1.268127170245358e-01   -2.351136767532024e-02   +1.458644902588709e-01   -9.924559890942149e-02   -6.050956593562043e-02   +2.583361304159451e-01   -2.102043026788221e-01   -2.188569512591392e-01   -2.929709348592787e-03   -2.337198571213903e-01   -8.499527869957038e-02   +1.674457913807593e-01   -8.557623008644030e-02; +5.096388590934071e-02   +1.702235611801657e-01   +2.664511060913581e-01   +5.874861593457470e-02   +1.997432761370807e-01   -2.522380371001315e-02   -1.909637587337142e-01   +2.553778770501072e-01   +2.141520081316450e-01   -3.107485739043339e-01   +1.061972506283011e-01   +2.678725611846584e-01   +1.635540468034889e-01   +5.823749107443363e-02   -1.060004574102002e-01   -2.310232719225579e-02; +3.929756853967713e-02   +8.185067796470381e-02   +3.523702219810351e-02   +1.305007084419869e-02   -1.689871360917684e-02   +2.214781834941288e-01   -3.660355512819799e-02   +1.852064199733745e-01   -1.045368773493683e-01   -1.208891415863644e-01   +5.229513476229503e-02   +1.413727936113960e-01   +1.345671280805064e-01   +1.019902245885567e-01   +2.942945440870569e-01   -1.911643920519668e-01];
L1E_L1I_iGABA_netcon = [-3.523711269345101e-02   +4.915081020297372e-02   -9.712194824229592e-02   -1.024489758427612e-01   -2.053424360778645e-01   +9.479399123837901e-02   +1.494710520532533e-01   +1.791115289132972e-01   -2.432471607316783e-02   -9.481326845641620e-02   -3.297916396072268e-02   +2.300114451300290e-01   -9.575424510696497e-02   -3.682323705130520e-02   +4.621747193116053e-02   -2.509342823969900e-03; +1.927147217462377e-02   +1.647603638287064e-02   -4.692686211185015e-02   -1.970549562189800e-01   +5.699715883362590e-02   +1.124911688501061e-01   -1.585073934942583e-01   -4.805833899152492e-02   +1.887158555917737e-01   -8.779038402077410e-02   +8.781214018181804e-02   +6.500014052935781e-02   +3.763918352752987e-02   +1.957569824588360e-03   -4.553609146024552e-02   -2.700188485490232e-01; -2.257959134803843e-01   +2.513007221393701e-01   -5.733875120638577e-02   +2.826765590889219e-01   +2.651518394211147e-01   +8.044582211873778e-02   +1.447533390583503e-01   -1.330911072049465e-01   -7.578365897134939e-02   -5.327209251426947e-02   -1.740802065526068e-01   -4.161836539594505e-02   -1.383908532744918e-01   +4.938704693945838e-02   +1.063642427677573e-01   +1.768706707371097e-01; +1.523029489119472e-01   -2.359783095285599e-01   +1.401501788749287e-01   -3.010778212722518e-01   -2.123084956608296e-01   +9.606767156155831e-02   +6.532990319511360e-02   -1.444613574804212e-01   +8.901229767221836e-03   +1.447900834680873e-01   -1.823518272079531e-01   -2.185585718061375e-01   +1.824794488961602e-01   -8.964611470358848e-02   +9.719715753382550e-02   -2.765171245319566e-01; +1.152988542130175e-02   +3.835820297074512e-02   -2.047203525983274e-01   +7.185607035365968e-02   -4.537928674160017e-03   -4.076094857177781e-02   +9.191888715389956e-02   +4.031547234005738e-02   +2.959948300896075e-02   -6.228556104978673e-02   -1.707303127556747e-01   -1.828649338453005e-01   -1.783683251646861e-01   -2.256407682991530e-01   +7.128170625983898e-02   +4.864086731029699e-02; +6.629120173373891e-02   -3.210064850746908e-01   +8.924552183004997e-02   +1.579308891932902e-01   -9.522711753664481e-02   -3.395943907613125e-01   +1.024777718244520e-01   +3.788648433274844e-02   +2.666494155758305e-02   -7.847442616378519e-02   -3.427877443343933e-02   +6.045718531230211e-02   +7.924605966007107e-02   +1.511726839732285e-01   -9.793333645734512e-02   +1.442681196018020e-01; -8.634749182133404e-02   -1.290849104416190e-01   -1.813723685379819e-01   -3.249424762600274e-01   +1.278424396654839e-01   +1.121803388630281e-01   -1.721796696532559e-01   +1.281436552869165e-01   -7.665777699677240e-02   -2.457537062835551e-01   -1.269378568514246e-01   -3.440529658813610e-02   +1.104130984624570e-01   -4.946656800185756e-02   -5.733998615054393e-03   -3.692591643732361e-02; +1.388972794715833e-01   -4.061359918533949e-01   +4.460211470263734e-02   +3.133394955772802e-01   -2.586860490403381e-01   +2.949445576252869e-01   +1.404256450197469e-01   +1.634529745247990e-01   +1.831147532709275e-01   +3.033185058023659e-01   +1.342900977011950e-01   -4.993565566068309e-02   -2.606668315661753e-01   +2.742013659902065e-01   -2.183225267913316e-01   +3.529800347624970e-01; -4.748437141019075e-02   +1.596099938161734e-01   +2.191601653375349e-01   +2.708037605862658e-01   +1.218570512651539e-02   +1.904868119988185e-01   -1.449898182410524e-01   -1.043443590555616e-01   +5.634925103066784e-02   +9.590084746432349e-02   -1.043687589918886e-02   -1.283182717595754e-01   -7.052929142717720e-02   -7.123684901472414e-02   +7.986177213344884e-04   +2.387685465107938e-01; -8.561490270213376e-03   -1.480492623275931e-01   -4.975719412505334e-02   -1.647679546619627e-01   -1.299610607607252e-01   +2.724329773053137e-01   -5.182831659882782e-02   +8.805645163191651e-02   -5.136767791418267e-02   -1.393313709061383e-01   -2.902627914141206e-01   +6.822980581946966e-02   -2.780508476636823e-01   +4.672243299273311e-03   -4.394593530465042e-03   +3.458703525005888e-01; +1.080023075872140e-01   +1.997242625760521e-01   -8.162496052325117e-02   -3.601185433215594e-02   +6.188093513814577e-02   -3.284171129666090e-01   -5.192290808113052e-02   -1.935033103902839e-01   -1.093851242204592e-01   -7.876713783706270e-02   +8.781218118767410e-02   +1.636460187855625e-01   -2.216827621546547e-01   -1.386300314828337e-01   +1.069145264040609e-01   -2.607129329094690e-01; -9.706270412149555e-02   -8.357089610582709e-02   +1.773818854697140e-01   -3.978389076644936e-02   +1.518914221843277e-01   +1.484600480578100e-02   +3.031907034919339e-01   +1.075542876917414e-01   +5.392797249844711e-02   +2.145783134821146e-01   -8.060820643761361e-02   +2.124568234477363e-01   +3.872708794968670e-02   +4.868345186345394e-02   +1.462012747532075e-02   -5.923610017231362e-02; +2.769165222262990e-02   -1.431878198905198e-01   +8.764182796266208e-02   +1.593417586073609e-01   -9.598562662984887e-02   +1.666048502046995e-01   +3.580034533809838e-02   +3.079247057697477e-01   -9.961322282910789e-02   +4.308630815637456e-02   +4.156082309073368e-02   +1.899193107724868e-02   +6.781314670264345e-02   +5.965972521546110e-02   -7.665610082103749e-02   -1.672271861273912e-01; +1.837220030921051e-01   -1.277464070887189e-01   +8.411497697009764e-02   -2.684752695699055e-02   -2.058489286230417e-03   +3.166562903569548e-01   -1.146517317646820e-01   +2.267548067581047e-01   -1.514691023309795e-01   -1.033735531882885e-01   +1.244680830268968e-01   +5.171155026580931e-02   -1.109401525990596e-01   +1.647413289529004e-01   -3.329729315566193e-02   +3.719522843647866e-01; +9.591947315175917e-02   +3.633114484745348e-01   -4.773813121457022e-02   -2.147761423693002e-01   -2.367256643620627e-01   +1.345325786775963e-01   -1.512866356571848e-01   -3.489821813365307e-02   +3.671236516434631e-01   -7.274560550703002e-02   -1.712940744667066e-01   -2.446138365453499e-01   +1.010490991210010e-01   -2.530473563857630e-01   +3.058076479035195e-01   +2.751619745830729e-01; +2.198354946347006e-01   +1.775866593832693e-01   +4.243982539766550e-01   +4.773353495852641e-04   -7.574248782835361e-03   +6.417248810262907e-02   +9.717611891154554e-02   -2.837418375076901e-02   +9.889521517635369e-02   -2.677545812487573e-02   -7.275799348658729e-02   -1.331202749840730e-02   +6.843853420239188e-02   -2.765286960984817e-01   +3.206325383824165e-02   +1.527642010009357e-01];
L2I_L1I_iGABA_netcon = [-1.892352774613579e-02   +1.006334531869632e-01   +1.489191846961914e-01   -1.663187065207945e-01   -3.870008136344167e-02   +4.712372181816647e-02   +6.428956701001025e-02   -9.882032110320908e-03; -1.128865896724169e-01   +3.740305095999417e-02   -2.165222464203282e-01   +1.673163721121145e-01   -9.703018582301441e-02   -1.572451004874356e-01   -1.054263039881040e-02   +8.188862888529377e-02; -1.073444146763342e-01   +9.814111122037625e-02   -2.032085827458184e-01   -3.138263586000675e-01   +2.243669945642368e-01   +2.402489116206753e-01   +8.097112310168574e-02   -1.589869551897635e-01; -3.007551717441293e-01   -1.024040080281165e-01   +1.909510576894639e-01   -7.555944999661015e-03   +1.941787165610815e-01   -1.453037217474840e-01   +2.929999067759585e-04   +1.167341799427259e-01; -1.036240429360210e-01   +1.221748646226497e-01   -4.903665133394834e-02   +2.154942677204588e-01   +1.046046951343923e-01   -1.077252110338747e-01   +1.345557441384664e-02   +6.689683158064376e-02; -1.932094973431497e-01   +6.050311935326218e-02   -3.781972381676151e-01   -1.301338925874711e-01   +1.941894802193219e-02   -1.461598251132578e-01   -5.894851021606404e-02   -6.603811937638407e-02; +6.703835322337101e-02   -1.277154811690477e-01   -2.082288590116665e-01   -1.500469955028161e-01   -6.218414281967878e-02   -1.779349074286728e-01   +8.093745133065192e-02   -1.401509469717186e-01; +1.800759073417686e-01   +3.184907592151066e-01   -8.876377358270245e-02   -2.337576224701674e-02   -1.555972345673656e-01   +1.864501356664514e-01   +2.862899544655143e-01   -1.551592172637470e-01; -2.687331047362906e-01   +1.789461296034885e-01   -1.026474556792998e-02   -1.159275944981662e-01   +2.562421397690493e-01   -9.472343133159605e-02   -8.868111731550861e-02   -1.766332269906595e-01; +1.955283042238833e-01   +2.986702800815046e-02   -1.741116506825171e-01   +5.651043056954364e-02   -2.219053344498064e-01   -1.311388730821086e-01   -3.048084759588845e-01   -1.156352811800489e-01; -7.337853189345954e-02   -2.536543922908270e-01   +4.369808549290752e-02   +1.524956935101362e-01   -4.775800135209909e-02   -4.968242110641904e-02   -1.617547455592721e-01   +4.789334768386236e-02; -9.548051405779863e-02   -6.250735650991084e-04   +2.269671516200461e-02   +2.833287469299062e-01   +1.705733128143177e-01   -1.810554528416553e-01   +1.332237399805227e-02   +2.081106683668536e-01; -9.792329279745055e-02   +2.011562277245470e-01   +9.660283954067028e-02   +3.550812195732421e-01   -3.346647965737381e-02   -7.514971420395680e-02   +9.138007722444549e-03   -2.734582462039221e-01; -1.656529621721834e-01   +8.292367682238701e-02   -7.160684347365529e-02   +3.246752704499414e-02   -1.401842969218016e-01   +1.581769430968930e-01   -5.443813725663328e-02   -2.703202445956974e-01; -2.449487087609704e-01   -1.323071058278285e-01   -7.864816458808171e-02   +1.098728903291575e-01   +1.309752014168026e-02   +4.032915668794709e-02   -4.342556031941411e-02   +6.886895221885575e-02; +2.396507209688904e-02   +4.854404143988190e-02   +1.275436808466193e-02   +2.203477751451144e-01   -3.010500285787304e-01   -2.542778926566365e-02   -2.453017426311902e-01   +8.604176031259446e-02];
L1I_L2I_iGABA_netcon = [+2.113357503813106e-02   -1.616884592779058e-01   -1.126209010796920e-01   -1.030633127652944e-01   +3.655929830032847e-02   +2.189742161744736e-01   -2.569829858471140e-01   +9.142524774776518e-02   +1.005099577641884e-01   -1.841921813727264e-01   -9.590024278470412e-02   -1.518949488109485e-01   -1.091348292747099e-01   +3.027927235810019e-01   +8.001283508620119e-02   +7.359358671776765e-02; -5.938427926994628e-02   -1.242049739246470e-01   -2.712806601116230e-01   -1.510142037555000e-01   +1.666421258007390e-01   +1.988136521455590e-01   -2.168704149341760e-01   +1.014052549037017e-01   +1.887261076455176e-01   -9.017841220378370e-02   +2.780687717802380e-03   -4.139119934880413e-01   +6.824314631056473e-02   +2.646905787083981e-01   +1.093031061100573e-01   +1.029075966550642e-01; +1.140377544363429e-01   -1.278635876661336e-01   +1.224819399200645e-01   -2.042875190753912e-03   +1.995030703454483e-01   +1.271952808396802e-01   -1.587578905513171e-01   +1.853800745419436e-01   -1.482520235965700e-01   -9.757778168813565e-02   -6.260136444752103e-02   +3.716815578148869e-02   +4.314035905485650e-02   -5.347779624814448e-02   +1.012068873490216e-01   -1.980987308691957e-01; +1.583377853933491e-01   -1.985789029787584e-01   -2.038672841895985e-01   -2.172830168753503e-01   +1.570670550809550e-01   -2.672338688728093e-02   +3.153052180464493e-01   -5.085360415334753e-02   -3.024479447920870e-01   -2.367660477023786e-01   -5.387569359641478e-02   -7.393189531568539e-02   -5.690546378799311e-02   +1.594638682437953e-01   -9.152242578503098e-02   +5.958226024645388e-02; +1.025385662540146e-01   -6.059867019346605e-02   +3.068788771076036e-01   -1.666467395787394e-01   -1.344039255443092e-01   -1.324771866018401e-01   +1.437218963613355e-01   +2.943606249707482e-01   -2.723969990124899e-01   +4.066352415265093e-02   -4.013708231293004e-02   -2.034565390205943e-01   -1.426977661080860e-02   -2.183322981695751e-01   -1.186212787299284e-02   -4.253326233484862e-02; -8.077841547385378e-02   +1.335811602378466e-01   +7.051773208844157e-03   +1.573221200962598e-01   +1.911325890486151e-01   +6.091713078721273e-02   -3.486318576415903e-02   -3.028325841915196e-02   +2.395224385590852e-01   +2.431073974866754e-02   +8.656911561799939e-02   +1.958281899042527e-02   +1.342295280772214e-01   +4.747312526173381e-03   +4.003293585092821e-02   -7.874776349714441e-02; -1.051447670661161e-01   -1.926005461853215e-01   -1.131824878376811e-01   +3.924032942218700e-01   -1.061469142192458e-01   -8.113004387900948e-02   -6.481741430141408e-02   -2.040109759514190e-02   +6.693985448971379e-02   +6.856702978307674e-02   +1.469337981417304e-02   -2.357749395722777e-02   -1.995717742324772e-02   +3.057308196315508e-01   +1.203426224500565e-02   +6.162779821040938e-02; -9.219954266799067e-02   -1.062195342279838e-01   -1.710339207495742e-01   +1.311530638537630e-01   -8.344834116705099e-03   +1.991654992428034e-01   +1.064272993175047e-01   +1.483876367843864e-01   +6.002860322281592e-02   +1.941670639231003e-03   -2.308806380154402e-01   -1.415975422270012e-01   +1.025230112378193e-01   -1.493975168783393e-01   -3.674760901110116e-02   +4.623717234720854e-02];
L2E_L1E_iAMPA_netcon = [-5.000641518382056e-02   +8.433746409015955e-02   -8.786510090788552e-02   -9.727323178761738e-03   -1.516956484733117e-01   -1.097994162222152e-02   +3.028911895757838e-01   -5.995664551470718e-02; +1.266695579399536e-01   -1.863086895111597e-01   -1.530979787343620e-01   +6.175070022910273e-02   +2.837145563790212e-01   +1.833688056818171e-01   -9.177761122800607e-02   -2.897418928900792e-01; +4.815746472938134e-02   -2.532154282807477e-02   -1.488937899462972e-01   -4.886858795066602e-02   +1.930936976683606e-01   -9.175881486722327e-02   -5.244754643213494e-02   +1.258595879720212e-01; +1.614511683370634e-01   -1.628994527802735e-02   +1.424460938701067e-01   -1.206439725392473e-01   +5.895098045389398e-02   -2.325252739850965e-01   -9.065915362252905e-02   +1.837811098593230e-01; -1.104018036341988e-01   +5.410355419754038e-02   -5.648477966132678e-02   -5.734424419922614e-02   -5.264118460388255e-02   -1.783697837809575e-01   -1.298897876680877e-01   +4.393715576200406e-02; +8.429009493382233e-02   +6.682049844208795e-03   +4.783871884786695e-02   +6.874959793321471e-02   -6.875425077661323e-02   +2.174882767803476e-01   -2.501794421502114e-03   +2.534434772414632e-02; +1.536543858520428e-01   -2.395626386905165e-01   -8.691236115979724e-02   -7.163547375135597e-02   +3.701089823374507e-02   -2.069484213170726e-01   -2.045195996950940e-01   -2.389688578057100e-01; +2.621646555191702e-02   -1.277922848657181e-01   -5.053758124725291e-02   -1.873183694152187e-01   +2.549702519316142e-01   -2.213309023712302e-01   +9.010261994028812e-02   -1.105566333910165e-01; +7.388617832974242e-02   -5.014692505496902e-02   -3.936435927892647e-02   -6.762576970870077e-02   +1.877944455291540e-01   +2.010419420789953e-02   +4.681334945771597e-02   +3.873720344052568e-02; +6.818910653004538e-02   -2.680297566827486e-01   +1.683077001834883e-01   +2.758373378119491e-01   -1.085895735804640e-01   -4.301451167778002e-02   -1.153708920258792e-01   +9.825025742111804e-02; +4.004359795183739e-02   +2.981112404406711e-01   -1.781272571018780e-01   +2.663448176767956e-01   +1.370508284761068e-01   +2.455364752917815e-01   +1.913902572542695e-01   +1.728145232590955e-02; +1.172850732156422e-01   -2.763863516610470e-02   -1.214763692226118e-01   -1.324571391064804e-01   -7.485436289823971e-02   -7.866466209403405e-02   -2.127598842039232e-01   +2.365344217333206e-01; -5.397875388875730e-02   -4.721333538729673e-02   -3.947744451756738e-01   -3.317662123833703e-04   +1.289109875959159e-01   -2.696319090415802e-01   +4.306073610418627e-02   -1.317675936428471e-01; +1.533154346711115e-01   +5.653521099112126e-02   -8.410341269293499e-02   -5.488830733059681e-02   +9.085551006004897e-02   -4.546982288523711e-02   -1.690519787396897e-01   -1.247997471367140e-01; +7.819708023237038e-02   +4.633747644136300e-02   +1.125741390929027e-01   -1.545077428880258e-01   -1.328687017000884e-01   +8.727733106369709e-02   +4.270361959891016e-02   +1.166733367299911e-02; -1.211379336820679e-01   -1.477245920476969e-01   +6.723096692282444e-02   +3.633222312444829e-02   -1.059040099788720e-01   +2.596208690387467e-02   -2.967339868751489e-02   +3.823999902406030e-02];
L1E_L2E_iAMPA_netcon = [-1.093575952660768e-02   -1.379997408190293e-01   -1.357124126230349e-01   +1.091329555937070e-01   -9.866863029657674e-02   -5.572168136905836e-02   +7.199058527189763e-02   +8.232082085294981e-02   -7.956237647628923e-02   -1.439127850672202e-02   +9.131400615008146e-02   -1.559470689692317e-01   +1.058109995806521e-01   +3.222628663118715e-01   +1.478754992049124e-01   +4.015131567193257e-02; -3.943927508477714e-02   -1.500516124959070e-01   +7.108951548134931e-02   -3.571744598526252e-02   -1.428840693884050e-01   -8.350840585765140e-02   -3.046800927805734e-02   -7.911867574480631e-02   -1.190057945963336e-01   +1.357854700436203e-02   -1.987132366711520e-01   +1.311465192820012e-01   +2.047071402110724e-02   +5.140382424679657e-02   +3.472552104230733e-01   -5.433663954750506e-02; -1.000847102994621e-01   -6.751206494510870e-02   +1.947522503294566e-01   -1.448014310649587e-01   -1.681492181228241e-01   +1.204536373249105e-01   -1.206638601462993e-01   +2.401229177328807e-01   +2.286273838308120e-01   -4.543363156294871e-03   +1.149965635699821e-01   +3.440910049318058e-02   -1.546473358265514e-01   -2.436922096755757e-02   +2.731659508001124e-01   +8.917285937179303e-03; +1.362736080341725e-01   -5.565241166067456e-02   +2.186929132966719e-01   -3.223798513623750e-02   +1.141274823662817e-01   +2.034478861314760e-01   +8.327703956017384e-02   -1.145345482199954e-02   +9.396091398623010e-02   -4.824752931408870e-02   -2.604686454136551e-01   +1.116030079205977e-02   -9.255056564112317e-02   +6.794874596611754e-02   -4.906598093976950e-02   -1.351696089074674e-01; +2.005919551556438e-01   -1.672257493572354e-01   +1.535028935287375e-01   +8.181701422097605e-02   -6.236311205074619e-02   +4.144834481401225e-02   -6.312169061237716e-02   +2.950423221568935e-01   +1.551888867578662e-01   +1.644224677315514e-01   +1.341453371034942e-01   +3.069180746078407e-03   +2.349960430627317e-01   +1.260183476475593e-02   -5.284415501009966e-02   +1.812806365540764e-01; -7.099831682798971e-03   +1.176486485607272e-02   +8.541682248074081e-02   +2.611003995015713e-03   +7.461475171361526e-02   +4.358870630219724e-02   -6.959887723526105e-02   -5.293531199125635e-02   -1.748498215258616e-01   -1.839838896970163e-01   -8.918542193626183e-02   -4.731973650292701e-02   -3.245798698870304e-02   -2.078632826275045e-01   -1.355072985368507e-01   -3.978110169477778e-02; -1.089441224835388e-01   +7.767270734637585e-02   -1.819658142227161e-02   -1.855811601752866e-01   +6.965194704380494e-02   -8.300907832824661e-02   +1.072231683125705e-01   +2.839593302216592e-01   -4.147928217374582e-02   -4.026663108368471e-02   +2.223076401405581e-01   +7.006294939813781e-02   -2.278461143225076e-01   -1.701597722281469e-01   +2.243669488232624e-01   +5.692734531388469e-02; -5.648460318916777e-02   -3.043832233110739e-01   -1.422051272819102e-01   +3.202623160396317e-01   +1.335062382169471e-01   +1.672917967175622e-01   -4.191288041601893e-02   +3.243950847824149e-01   +1.948758932411794e-01   -6.339763312549068e-02   -1.042064479549985e-02   +1.024393271475331e-02   -1.857961839878216e-01   +8.455398225465401e-02   -3.809151634914928e-02   -4.203767161895637e-01];
L2I_L2E_iAMPA_netcon = [+2.569047897573545e-01   -7.834338231669463e-02   +2.377971864185906e-01   +1.401718087518566e-01   -1.307882604754809e-01   +2.321961842538074e-03   -2.418542759451663e-01   +1.134323418225076e-01; +7.859157554101795e-02   +8.383018805318881e-02   +3.882246106045713e-02   +4.296338561017770e-02   +6.173425001263076e-02   +6.812813510270178e-02   +2.010574063625377e-01   +1.776919658978883e-01; -9.980883912740739e-02   -1.113735546408289e-01   -2.272871703267506e-01   -6.342487826015523e-02   +1.700804170009773e-01   -1.308776807220614e-01   -2.115961733154001e-01   +1.053207117564910e-01; +4.086385253577331e-02   -2.897028015776850e-02   -1.586798252180421e-01   -9.898725241538300e-02   -7.736507679666610e-02   +1.742152411335461e-01   -5.745613424556442e-03   -1.074116124018759e-01; -1.815002557968341e-01   -9.771097011007102e-02   -2.819629427265931e-01   -2.604518894252833e-02   -9.477610981026041e-02   -1.231734538861642e-01   +1.221144245856629e-01   -1.584494692198159e-01; +3.058427686016273e-01   +6.540139828855604e-02   -1.731873283104120e-02   +6.559154620429615e-02   +2.514673909497540e-01   -3.896966808484341e-02   +1.307557325348670e-01   +1.132336929401128e-01; -1.773061321203341e-02   -8.045713625506436e-02   +9.512016529158198e-03   -2.302603876965809e-01   -2.394054316999018e-02   +2.207890838436308e-02   -1.283522925979629e-01   +1.537335884664231e-01; -2.339459907615188e-01   +6.379164072108331e-02   +3.360155731771317e-02   +3.667242315029379e-01   +4.948377910596173e-03   -1.397088921840305e-01   +3.419250869930723e-02   +1.961548800274022e-01];
L2E_L2I_iGABA_netcon = [-1.860088210849729e-01   -2.764652749654498e-01   -7.451380796249443e-02   -1.206343221201748e-02   +2.665791506613637e-01   -2.155590601326720e-01   +8.528550495809278e-02   +2.781700645949993e-01; -5.974675977827759e-02   -1.306121513188152e-02   -1.491096579731276e-01   +1.518050725508039e-01   +1.552095816288313e-02   +4.690179343230063e-03   +1.660680654058537e-01   -1.235614325091278e-01; +4.412629919763952e-02   -4.072134821851618e-02   -2.443208699093131e-01   -1.323773701684209e-01   +2.796103598332259e-02   -4.967297630246791e-03   +2.556349179098440e-02   +1.611027062498097e-01; +2.558851874694052e-02   +1.335397184961886e-01   -1.984427259800144e-01   +1.340508657747523e-01   -1.147425572169351e-01   -5.191095812550357e-02   -1.484348191523386e-01   +5.571825871929359e-02; -8.892858464058982e-03   +1.357074646506493e-01   +1.151743700317306e-02   -1.170151982610791e-03   +1.782192754105025e-01   +1.106303376894272e-01   +3.209711772935479e-02   +1.191026806739991e-01; -7.095402901279287e-02   +1.265742961833061e-01   -1.290943128348018e-01   +1.770581779366625e-01   -7.949327864755094e-02   +9.548900325234803e-02   +2.010713789549348e-01   -2.300079801110400e-01; +2.361709902143466e-02   -9.542711617081175e-02   +1.633735814693163e-01   -1.728296101689239e-02   +5.561013400977825e-02   -2.374037318592825e-01   +2.178078569714868e-02   -8.944376814754562e-02; +3.046064798774430e-02   +2.735141239250772e-01   +1.755053210392650e-01   +6.594516632836947e-02   +8.045575544553048e-02   +2.003893394720225e-01   -1.326726515151241e-01   +5.830596573782235e-02];
L3E_L2E_iAMPA_netcon = [+3.057051173164774e-02   -1.103475954069986e-01   +2.104456954924135e-02   +1.510059444210845e-03   -1.105930420779033e-02   -2.713465400911868e-02   +1.015506125050959e-01   -1.448170676754596e-01   +4.999232720942388e-02   -4.063717423737717e-02   +2.546986242639651e-01   -6.269608359955434e-02; +8.348133358205491e-02   +1.482967667366848e-01   +1.471888897531527e-01   +1.458860823870720e-01   +8.792392724318532e-02   -3.671029997553801e-02   +1.211664178015344e-01   +8.394245544344758e-02   -2.049366773149393e-01   +8.375483319514679e-02   -4.545264911310141e-02   +6.936574511269251e-02; -7.940198069812604e-03   +3.276629573883331e-01   +3.368198411661425e-01   -1.088331113084832e-01   -9.205666405747659e-02   +2.757136659340867e-01   -4.407753428026610e-02   +7.909196805163723e-02   +3.738755370824025e-02   -6.188903360435542e-02   -1.032601010394773e-01   +9.076785046896821e-02; +3.359099821110870e-01   +8.918509202385075e-02   -1.462756163839001e-01   -1.522475446464607e-01   -3.725431387375121e-02   +1.005068933335998e-01   +1.658977686167955e-01   -8.957695498305465e-02   +5.137891886617262e-02   +1.298153699422614e-02   -1.744923954771076e-02   +1.229494214474205e-01; +7.878349931659451e-02   +1.901132130905404e-01   +1.750366185188717e-01   -2.894733023944750e-01   -9.686485559999172e-02   +2.030171888542215e-01   -7.177958401262079e-02   -5.743050518534226e-02   -7.398216206477710e-02   -1.554020161213317e-02   +1.098078474468489e-01   +9.590362416344732e-02; -1.282469363436987e-01   -2.579292630350224e-01   -1.117262498911959e-01   +2.058351939227448e-01   +1.304432675884534e-01   +1.248396343448081e-01   -6.123357723359302e-02   -1.063384016627961e-01   +7.702906443041070e-02   +1.412807033254431e-02   -4.143229594793194e-02   -1.968872281827730e-03; -2.268389307267109e-01   +1.524428810837166e-01   +1.930225503681171e-01   +9.707251235902450e-02   -1.711942070043846e-01   +3.586157540266110e-02   -1.097952164330414e-01   +1.877711566006252e-01   +1.329969742290443e-01   -2.367753140404431e-01   -2.701865024959189e-01   +2.963586878797861e-02; -1.644282545253119e-01   +2.163041537936214e-01   -2.518688709160384e-02   +1.053827029961549e-01   +3.458483546741276e-02   -1.769520901527852e-01   -1.651486790242747e-01   -1.621556531667657e-01   +9.260516560930873e-02   -5.988461660149973e-02   +5.539065424389105e-02   +7.284029450425692e-03];
L3I_L2I_iGABA_netcon = [-1.389250719011470e-01   -1.112216655976140e-01   -6.396850314745689e-02   +8.585460604323769e-02   -1.516954684744380e-01   +3.818094149516375e-02   +1.679374953884637e-01   +6.845120332465736e-02   +1.692042564896042e-01   -1.468431858199778e-01   -1.318572730109937e-02   -8.975050052822790e-03; -3.031616053076145e-01   +1.420391673127843e-01   -9.561023999333326e-02   -2.217558888668550e-01   -6.808987665763998e-02   +2.165592582699044e-01   +1.470248970618372e-02   -1.703819030625939e-01   -2.263116471452797e-01   +2.525724631688345e-02   +3.323405342512593e-02   +2.766025245490920e-02; -2.189850490127982e-02   +7.173722138873667e-02   +1.497635534517530e-01   +4.911192964803608e-02   +1.342172832358007e-02   +1.607061546412659e-02   +1.029862003727861e-01   +1.180568761301606e-01   +1.149301398273011e-01   +4.487466256275803e-02   +1.003871061537027e-01   -4.299363889220448e-02; -3.718270214783081e-03   +6.228054749521560e-02   -8.582369138114020e-03   -1.993286908460610e-01   +1.103832423140168e-01   +1.729285668991343e-01   +1.358692486864049e-02   +3.024944928971100e-01   +2.046206249855115e-01   +7.736370061094058e-02   -2.953323059929721e-01   -1.951799490338269e-01; +1.985651252763462e-01   +2.323165066054819e-01   +3.132640663028788e-02   +1.054481047049849e-01   -1.213465566615762e-01   -8.308816519321259e-02   +1.113177455867116e-01   +8.262380278661779e-02   +6.738904220584771e-02   +7.416797397852724e-03   +5.716705869185653e-02   +6.390681002751708e-02; +2.343363637035876e-01   +2.707190050854819e-01   -8.848892794594870e-02   -2.614569631118143e-01   +7.611653386005120e-02   +1.486707651488503e-01   +7.629403089155720e-02   +1.544918380095593e-01   +1.193050580899191e-01   -8.765069478854984e-02   -2.798955924825256e-02   +1.899030884267819e-01; +6.147060298704925e-02   -8.021826415212395e-02   -5.402705771414352e-02   +1.089028995926282e-01   +4.734076468874226e-02   +6.941432021766861e-02   -3.233055328875739e-02   +1.188336811669415e-01   -8.584211894817750e-02   +1.037708345995078e-02   -1.535679071118234e-01   -4.233715896401878e-02; -2.307212212334361e-01   -3.486597263715219e-01   -5.358475037885491e-02   -3.660379266513648e-02   +3.665568363604427e-02   -6.644798710729578e-02   -2.068277005911511e-02   -1.401751660810781e-01   +9.953113556945296e-02   -5.222635504361017e-02   -2.630205743576327e-01   +1.954138088566155e-02];
L2E_L3E_iAMPA_netcon = [-1.059941254633713e-02   -1.026645275272387e-01   +1.857301044843519e-01   -1.003119287849083e-01   -6.924722981621038e-02   +1.318794333026325e-01   -2.342975397898900e-02   -3.388700815440202e-01; +1.618787705036928e-01   -8.674212835197345e-02   -1.085760346147654e-02   +2.385989504794024e-01   +1.016286918497226e-01   -6.158205665552092e-02   -1.062855160644531e-01   +1.121663615768698e-01; -1.400809324665987e-02   -7.061062186075563e-02   -3.179019100567251e-02   -1.488481941640458e-01   +4.471986732223833e-02   +6.854679808841863e-02   +5.901984918784614e-02   +1.870992611346478e-01; -3.463379120043409e-01   -1.061115642885803e-01   +7.320996045485579e-03   +1.776624118568997e-01   +1.089187065536262e-01   -1.364086646654489e-01   +1.031640183966469e-01   -1.345155040093778e-01; +2.386034749753864e-01   -3.086047993702862e-02   +1.569589861725166e-02   -2.828750810105486e-02   -1.776316283256616e-02   -1.297714397894963e-01   +1.375039526602587e-01   -3.791360677956276e-02; -8.008984729791283e-02   -7.270437622409399e-03   -1.895606669877916e-02   -3.352564091227225e-01   -4.071409674772961e-02   -1.066229789641328e-01   +8.445948434066593e-03   -2.537051159885973e-01; +1.873792071379058e-01   +1.997957134788993e-01   -1.599525377264276e-02   +1.622995471746747e-01   -3.377839762527070e-02   -4.881228471662011e-02   -1.346723534117568e-01   +1.168924792185014e-01; -1.597343250259438e-01   -2.022401463298051e-01   +1.511508161503368e-01   -1.681602033748496e-01   -4.949917040490650e-02   -2.495575646141370e-02   +3.349934176053882e-02   +1.388856559037935e-01; +5.870390939274088e-02   -1.051514950769426e-01   -1.710461452483877e-01   -1.965409503297732e-01   +2.763488751159422e-01   +6.931318382110568e-02   +2.315524653568049e-01   -1.918271469596059e-01; +1.576158466623623e-01   -7.256742611198282e-02   -1.696289466305923e-01   +1.744181591854996e-01   +8.864911066060402e-02   -2.830610758782824e-01   +3.394283374546703e-02   -1.803502656637562e-01; +3.516725490604606e-02   -3.545999173178882e-02   -1.570546573875989e-01   +1.683086821686576e-02   -8.066488475216241e-02   +3.660696328556595e-02   +2.023907898535371e-01   -4.873683063918612e-02; -1.034767947150871e-01   -6.489835530930757e-02   +1.807321124377650e-02   +6.097772933127987e-02   +1.031318072822218e-01   -1.790562712017141e-01   -6.186598308938817e-02   +5.133955633090242e-05];
L2I_L3I_iGABA_netcon = [-1.681061770074082e-01   +6.022906655881020e-02   +3.184463514777373e-01   -7.353767518870029e-02   +1.465114571839898e-01   +2.127672434461631e-01   -1.580536813799508e-02   -1.365205071016674e-01; +2.679435133792909e-02   -1.583518277294527e-01   -2.564324259151747e-01   -3.163087480410028e-01   +1.770728246258265e-02   +3.632520352615016e-01   -9.696503154584337e-03   -2.410807345998973e-01; +3.502505775083833e-02   +2.747814712300762e-02   -9.494332366572114e-02   +1.351179302510692e-01   +2.269652902562531e-01   -4.129698612568498e-02   +1.531658396620658e-01   +4.399110262567157e-02; +5.372491961988866e-02   +1.064229945771165e-01   +1.519379733115527e-01   -1.960742660008753e-02   -3.532552102515264e-02   -1.713651610854723e-01   -1.447581596716853e-02   -2.130720072806381e-02; -2.544024997534217e-02   -5.785532845930528e-02   +1.661528256886989e-01   +4.863477093024376e-02   +3.112498823246555e-02   -7.395600048963438e-02   +7.831654190348580e-02   +3.574211097776912e-02; +1.319887208162729e-01   -1.126708732382059e-01   +8.075656584165626e-03   -1.310404449308409e-02   -1.058160968658050e-01   +1.559953080788009e-01   -2.864699614813235e-02   +2.425250123437287e-01; +8.930386761258233e-02   +5.005723083541335e-02   -1.355296800302476e-02   -3.401034804795283e-02   -5.974850459442674e-02   -4.020103710432216e-02   +7.657978617261386e-02   +1.252786411042066e-02; -2.895669460766104e-02   +1.718448728187579e-01   -6.201470374174967e-02   -2.183468862977691e-01   -2.307720557448502e-01   -3.664940460431480e-02   +2.484909841493868e-01   +2.737781882154483e-02; -1.205154423943008e-01   -2.569580513816800e-01   -1.639925961892832e-01   +2.069915126629055e-01   +2.526825442256494e-02   -2.755540901378814e-04   +1.136332380836406e-01   -2.079662591387281e-01; +1.114624355516160e-01   -2.329611928052100e-01   -1.077716630580935e-01   -9.429320135582153e-02   -3.511348957865707e-02   -1.126204219177210e-02   -1.573675425085704e-02   +1.571710805847424e-01; -2.455964956839518e-01   +5.456203081370669e-02   -2.310812222990234e-01   -3.142163234320426e-01   -8.117295566768842e-02   +9.575176529134755e-02   +1.908045583158025e-01   +3.241437060602687e-02; +7.437453033768127e-02   +6.096899263458264e-02   -5.685018585064261e-02   +1.151828677240725e-01   +8.396709527421814e-02   +6.746553573478534e-02   +2.883048140606894e-01   -7.877503795272937e-03];
L3I_L3E_iAMPA_netcon = [-9.319099010988244e-02   +5.244089173328130e-02   +5.631865440085914e-02   +1.947714880311448e-01   +7.537788656508342e-02   -3.243575486607442e-02   -5.620138919979437e-02   +9.730073573296735e-02   +1.240322885187828e-01   +1.478162291922271e-01   -2.150777353230853e-01   +2.538641872727143e-01; +1.865719314577817e-03   -9.260186903437696e-02   -1.188072900872708e-01   -6.995068697818939e-02   +6.756946541612316e-02   +1.562613085588512e-01   -1.270678047084746e-01   -4.161466948774409e-03   +1.668649151478884e-01   +3.016769510190055e-01   +1.012593449914547e-01   +3.350934166175863e-01; -4.244055227956184e-02   -1.847290626837196e-02   +1.510189352984135e-01   +1.513829448133688e-01   +4.991135853949055e-02   -3.324627108659424e-03   +8.336530976619132e-02   -8.358755637297394e-02   -6.446616517836253e-02   +7.378037182265132e-02   -1.325755545327274e-01   +3.963688784178989e-02; -1.701126628603067e-01   +3.362449713499348e-02   -1.462736071351045e-01   -3.095800249445546e-01   -1.634836591923237e-01   +2.285721852446068e-01   -1.464060088565842e-02   -3.769850933019175e-01   +2.298309606915467e-01   -2.519668922986332e-01   +2.674186476621251e-03   -7.152073607904431e-02; -1.662229312969924e-01   -3.030392807836139e-02   -1.625448842778187e-01   +2.127532664654421e-01   +8.856571573143236e-02   -1.107716388515119e-01   +2.661245859677263e-01   +5.249828451084973e-02   +1.882796750994103e-01   +6.087348135414936e-02   +2.092116002016541e-01   -5.641512543381042e-02; -1.026149028103300e-01   +8.520929026253466e-03   -5.798110674077856e-03   +2.014052372046525e-01   -2.429220694868836e-01   +3.142939271768035e-01   +4.465558104488700e-03   +3.260769270875637e-02   +1.206684861095115e-03   -2.092063575445833e-01   +1.066746645382519e-04   +2.935514343061595e-01; +2.005997114292731e-01   +6.363794339331807e-02   -5.355367437139355e-02   +1.444426175477735e-01   -6.995585025545281e-02   -1.648918033680008e-01   -2.137124150041506e-01   +1.885000486193132e-02   -2.399786887517432e-02   -4.119246151256428e-02   -1.339347745570754e-01   -2.151756661373697e-01; -6.363276781084007e-02   -1.798429951245830e-01   -1.551606206458190e-02   +2.894577266836318e-01   -4.692526795565868e-02   -4.153550626383139e-02   +2.472898671831811e-01   +2.713227159486279e-01   +1.870818410652088e-01   +6.418249586036429e-02   -8.553996358759589e-02   -1.693877694513706e-01; +6.591754729938099e-02   -1.535002774948044e-01   +1.859619897913677e-01   -4.942057942230444e-02   +3.444877991418056e-02   -2.107902705762781e-02   -2.709278994320280e-02   -1.708247286939466e-02   -1.569038832208181e-01   +1.259309316827308e-01   -1.515458244436359e-01   +1.344317556220258e-01; +7.245841678113285e-02   +7.231730380232523e-02   -1.354832243879981e-01   -2.088485916392539e-01   -5.494219585689001e-02   -1.573493705859204e-01   +4.604857876851225e-02   +1.083073722709143e-01   -4.147184319308991e-02   +1.010425032901967e-01   +1.140554121044011e-01   +1.601400560083562e-01; -6.036253396577095e-02   +8.778070859094876e-02   -1.065447364360110e-01   -1.556070926433592e-01   -7.346617991275355e-02   -1.353916121330331e-01   +1.422240908404695e-01   -1.257775700142591e-01   +1.146379399875502e-01   -1.304050829246997e-01   -9.596687447062945e-03   -8.154473152240570e-02; -1.926021049435854e-01   -7.168107460742017e-02   -3.523741451753910e-02   +1.311057236690698e-01   -4.934996204066997e-02   +2.348680699029262e-01   +2.753911540814453e-01   +7.153662803941428e-02   -1.585434083092006e-01   -2.496829464944048e-01   +4.021012278148314e-02   -1.714121712740035e-01];
L3E_L3I_iGABA_netcon = [+9.899125442063909e-02   -1.646204799472685e-01   +1.176681288072383e-01   -1.014109808882745e-01   -3.939563091117840e-02   -1.318597997683745e-01   -2.620436957515344e-02   -1.278325462670642e-02   -1.441919961336232e-01   -3.276785063302357e-02   +1.856858011020074e-01   +6.202450706818615e-02; +1.980890524687916e-01   -1.339337239426002e-01   +1.754835570194799e-01   +1.415208029799129e-01   -2.593509186596357e-01   -1.221905212601296e-01   +7.652380853914237e-02   +1.800206220388734e-01   -2.178654787241874e-01   -1.845227014522690e-01   +1.020274520389986e-01   -3.885957179345568e-02; -1.548305331413222e-01   +8.784391501161791e-02   -6.294473255228523e-02   +4.917895459763863e-02   -2.329893898281736e-01   -2.255260089214243e-01   +1.948113094632550e-01   +1.366380622357172e-01   -1.308870550563990e-01   +3.604025955671256e-02   +1.966477663576295e-02   -3.414801539456814e-01; -1.354527192184675e-01   +3.128680840961362e-02   +1.194677108099398e-01   +1.186359869483856e-01   +1.602904469197898e-02   -4.597200674354932e-02   -1.210821286924225e-01   +4.319710521820163e-02   -1.603952237339574e-04   +2.466905070411962e-01   +1.778208625131938e-01   +9.115258838312257e-02; +1.234013737744762e-02   -1.899224438057285e-01   -1.612317464542931e-01   -1.076732364447959e-01   +1.555792467943460e-01   +1.969603933564942e-01   -3.233923581092008e-01   +2.515323203970621e-01   +1.370391508361265e-01   -2.877252804062062e-02   -2.931908990883500e-01   -1.013425815612623e-01; +5.921200624876566e-02   -1.131025823104765e-02   +1.667863379596400e-01   +8.377483885999992e-02   +6.858132068978961e-03   +2.925246675715350e-01   +2.923603961789733e-02   -4.219612479103080e-02   +4.220130223852840e-02   -3.062148249531170e-01   +2.963049236325158e-01   +6.655656446805572e-02; -9.611705735669097e-03   +9.120784765759456e-05   +1.497618883877372e-01   -1.635069226744459e-01   -2.081141945756186e-01   -3.797292490804691e-02   -6.148552240292347e-02   +5.086775352441339e-02   +2.303044130843705e-01   +4.149448896003049e-02   +2.436877826908442e-01   +3.435309540571104e-02; +3.022952984977139e-02   +2.644754812735567e-01   -2.533288186918020e-02   +1.327662093366390e-01   +3.853646810355425e-02   -7.626041723004900e-02   -1.500222795351867e-01   -1.577727259621553e-01   -4.689492297871457e-02   -5.677086769347807e-03   -1.360148959389899e-01   -1.920034267589948e-01; -2.021700783316248e-01   +2.889153566004657e-02   +5.846576750875084e-02   +1.182062778389967e-01   +1.225910621507885e-01   -1.353342713045134e-01   +1.528853590449646e-01   +5.418519432198166e-02   +6.439088338671539e-02   +8.013550867853128e-02   +1.029864399584011e-01   +1.490396967087461e-01; -1.750131046238253e-01   -6.378292163657022e-02   -8.092461583057237e-02   -3.779806407150085e-02   -1.988696983008974e-01   -2.444874620425697e-01   -8.192558507748324e-02   -8.808875483130381e-02   +1.103973573318217e-01   -5.220280466733822e-02   -4.587086360408735e-02   +3.000600080201525e-01; +1.509343102580311e-01   +3.063466690908767e-01   -8.752129493058645e-03   -8.777735186094246e-04   -2.574765194323727e-01   -2.381966495812366e-01   -6.568191543768603e-02   -8.109309538058355e-02   +9.165535387359931e-03   -1.389867622720646e-01   -2.395156447313325e-01   +1.865413448209773e-01; +5.986271925055067e-02   -7.285060600345118e-02   +1.820432706423804e-01   -1.375611677506236e-01   -3.375352603605171e-01   +1.240963596159707e-01   -1.160122031241007e-02   +2.685611439561066e-01   +2.864055911532615e-01   -1.252760197158487e-01   -3.749245446672192e-02   +2.381026238248067e-01];
L2E_Input1_iAMPA_netcon = [-7.361552307381965e-02   +1.596073836718067e-01   +1.519240492855323e-01   -1.201446664528593e-01   -1.448326215025415e-02   -9.225964321339167e-04   +1.073508668723457e-02   -3.001901138999809e-02];
L2I_Input2_iAMPA_netcon = [+2.616096515515919e-02   -4.981077672900049e-02   +1.305751422223601e-02   -2.159104849821602e-01   -9.103209591237778e-03   +8.008780843531174e-02   +1.337257237146065e-01   -1.972664666944386e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
