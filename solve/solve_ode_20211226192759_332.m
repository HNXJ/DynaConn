function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.233376275321653e-01   +9.145781032728434e-02   -1.086749370525687e-01   +1.810332523875910e-01   +3.017278568369304e-01   +1.033679675080027e-01   +2.631544513750392e-02   +2.664235264878670e-02   +3.006400061269204e-01   -9.945446754850540e-02   -1.104900202712632e-01   +9.911684135375476e-02   -3.627547620769880e-01   +9.235031313854683e-03   -7.657527727394260e-03   +9.658003419211821e-02; +5.331458227982142e-02   -4.194372906986085e-01   -3.779669061435578e-02   -2.192955884009589e-01   -6.136154952781974e-02   +2.009211911842198e-01   +4.952743781905346e-02   -1.222779680741781e-01   -2.223193074810679e-01   -1.368845314111766e-01   +3.404669878011053e-02   -7.003318103736782e-02   +1.400194901902367e-01   -1.272651991524062e-01   +3.688362131779728e-01   -1.199755136113560e-01; +2.044365216497534e-01   -1.934096288950097e-01   -3.752675889746676e-03   +1.054305558632881e-03   -1.607960597674920e-01   +1.024667870764652e-01   +2.685365702214283e-01   +1.415974035064997e-01   -6.508009081691124e-02   -4.907136577230006e-03   -2.056082144555080e-01   +6.652942545569851e-02   +1.842204937104912e-01   -9.876525033520851e-02   -3.119112129320206e-01   -2.187939526919409e-01; +1.699585218845348e-03   +5.531122186668261e-02   +8.893857696303081e-02   -2.236448923131323e-01   +1.295614175197162e-01   -4.688114138285325e-02   -2.333415925939196e-02   -2.579318179174256e-01   +2.866158967919850e-01   +2.090191896836054e-01   +4.104457835882916e-02   -9.992787281281990e-02   +1.150899236491973e-01   -1.121769263092165e-01   +7.629980021228687e-02   +3.383133914964140e-01; +2.295670102141855e-01   +3.954522142139245e-02   -5.061710171248310e-01   +7.908686973261586e-02   +3.458379522447538e-01   -1.285591951239781e-02   -2.681975490515969e-01   -2.073396618661898e-01   -3.254081919964514e-01   -3.953269468120736e-01   +1.023494395564890e-01   -3.010016266535530e-01   -1.716054785607006e-01   +7.288068599909557e-02   +1.663285988992053e-01   +1.571223303960873e-01; -2.927470152130534e-01   -1.954786025830798e-01   -1.284056648064490e-01   +3.117360684811170e-01   +3.485347941157372e-01   -3.264315185374643e-02   +1.201147813370250e-01   -2.881069740807168e-01   -1.245938317588358e-01   -1.790721139472169e-01   -1.330135580352012e-01   -6.735135154243937e-02   +2.013049441967321e-01   +4.939538903271398e-01   +6.285805314876708e-02   +2.662621670476928e-01; +6.165536730224461e-02   +2.897245779845625e-01   -7.023349120829192e-03   -3.257891585607327e-02   +1.050919644765259e-01   -5.562500858741379e-02   +5.422112901525735e-02   +1.163089069892698e-01   +2.328337604141646e-03   -4.244983003941379e-02   -9.071511600091292e-02   -5.667301486659623e-02   +1.069890712387122e-01   -1.996859400772622e-01   -6.758847493604800e-02   +1.676574539733360e-01; -3.395639613373738e-01   +2.430886613947881e-01   -3.672821683367399e-01   -1.631872941904819e-01   +3.498448655245046e-01   +6.413533918808688e-02   +3.001692929837401e-01   +8.865903145644397e-02   -6.428208413232167e-02   -5.730895714079753e-04   +1.732977831007565e-01   -1.728020033107158e-01   +1.876632587259731e-02   -1.271985644447583e-01   -9.398674530766382e-02   -2.869274793859211e-01; -1.770827108473669e-01   -3.096292482253143e-01   +4.463050801300500e-02   +1.268526843187941e-01   -3.215896055333929e-01   +4.156236765689552e-02   -3.227489198011110e-01   -6.464999281130586e-02   -1.132239855036496e-01   +9.861186222786565e-02   -1.896419828458457e-01   +1.415267058140092e-01   +3.935186260277353e-01   -7.666196712697124e-02   -6.481289698732259e-02   -8.931703234758813e-02; +2.669455049218447e-02   +5.199303157853998e-01   +9.651384345704742e-02   -2.431596090218608e-01   +6.745228816318610e-02   +2.561247729717094e-01   +1.549293792817101e-01   -2.085158570149333e-01   +4.236774499402167e-01   +1.177454869856437e-02   +2.012702555204554e-01   -2.270465734023773e-01   -1.516010723586132e-01   +1.296535380225547e-01   -4.511484957300728e-01   -3.115767450503926e-01; -6.838380791640404e-02   -8.222633865689427e-02   -1.872186576700508e-01   +4.059955487006303e-01   +1.335494963270775e-02   -2.449006188201595e-01   +1.524794065618269e-01   -2.286730742134527e-02   -3.256387029977312e-01   -2.524592565877168e-01   +6.527421037441146e-02   +2.382210499063046e-01   -4.299634028548008e-02   -1.417529389168915e-02   -4.491043331988164e-02   +1.662701905970282e-01; +1.129663241863551e-02   -3.774871745280520e-01   +1.220537654889160e-01   -1.193282612036548e-01   -2.928306734100926e-01   +2.900905779926229e-01   -1.674908442973881e-01   -1.957627084162189e-01   -5.990717844664301e-02   -2.277863345041921e-01   +2.371595329988246e-01   -1.200474079424769e-01   +1.726610889091232e-01   +2.158107019016195e-01   -1.901880021245667e-01   -7.898077624401775e-02; +3.008385857312258e-01   -2.394231351763844e-02   +1.227126060993812e-01   -3.122233400087570e-01   +1.490186658524778e-01   +6.123024776145142e-02   -9.528672986231390e-02   +2.192995559246069e-01   +2.541759412343508e-01   +2.363722204096033e-01   -1.873534823962949e-01   -1.957426874947624e-01   -4.274546554022700e-02   +2.696558996537242e-01   -3.302024950628928e-01   +1.587293911217104e-01; -5.841625260638748e-02   +2.090530243806343e-02   -1.637830318270889e-01   -6.097926389749264e-04   -2.056000121839426e-01   +2.032922361914561e-01   +5.371517720790103e-02   -4.911176437096854e-01   +1.961400812206782e-01   +4.070299126915364e-02   -3.124189569485410e-01   -1.109448398294159e-01   +2.227103141115759e-01   -2.990812650439599e-01   +1.444351487565999e-01   +1.167518493421505e-01; +3.055840837016968e-01   +1.631247176512038e-02   +2.260091869934794e-01   +2.719173763234098e-01   -3.845349526564247e-01   -9.354528171080044e-02   -5.733936699999698e-02   +1.911048185598645e-01   -2.439393561773059e-02   -1.436514010667563e-01   +1.034285776864506e-01   +2.437631490239888e-01   -2.532093386955030e-01   -1.778735656373581e-01   -7.478427118475404e-02   -4.027908504749611e-01; +4.792511074630499e-01   +2.335188218274291e-01   -9.873651230036307e-02   +5.436922217629521e-02   -3.009594528726101e-01   +8.593220719123429e-02   +2.352385082599855e-01   -4.476136657941746e-01   -8.414165213379816e-02   -2.558412983697543e-01   +7.374522936962782e-02   +3.371409004769710e-01   -5.471446877970880e-01   -1.928187676835338e-01   +6.955889248320042e-02   +6.208255461098362e-02];
L1E_L1I_iGABA_netcon = [-7.596438397602689e-02   +4.446694833865239e-02   +4.205964830658547e-02   +6.174539789527619e-02   -2.688380629926603e-01   -3.089018757202255e-02   -2.921024264369616e-01   +1.275586689152090e-02   +1.371331756576132e-01   -3.410283810398926e-02   -2.619042906757029e-01   -1.611489035733532e-01   -1.004012454288893e-01   +7.520529757045774e-02   +1.922215512218689e-01   +2.900730633687014e-01; +1.699812622411502e-01   +4.092862056465963e-01   +3.125481941871283e-02   -2.488240975374949e-01   -7.510683747614061e-02   +6.912936713626638e-02   +3.676701055016238e-01   +6.498122859032146e-03   +1.717029673271324e-01   +3.276409942350266e-01   +1.969220175962226e-01   +1.723173554569552e-01   -1.346494755584585e-01   +8.383102787701742e-02   -4.055070155386646e-01   -1.803297930780650e-01; -1.346151487174569e-01   +1.891294597762229e-01   +2.545479477987560e-01   -3.034699544557984e-01   -2.563966741386086e-01   -1.948127723759210e-01   +6.139706590563102e-02   -3.229474886947986e-01   +2.515725527217681e-01   +1.294109160647604e-01   -2.359963372639597e-01   -1.852814966861808e-01   -3.778936641114336e-02   +7.762139566303558e-02   -2.660069722287502e-02   +1.571807113899544e-01; +1.036769858157377e-01   +2.413948369760239e-01   +2.862389545253037e-01   +1.332201462698038e-01   +6.465782123056042e-02   +2.813086581709135e-01   -1.685134131287999e-01   -1.764043785357584e-01   -1.480566611144370e-01   +1.123100968355983e-01   +2.048056706448369e-01   +5.866210402046461e-02   +2.321475664289682e-01   +1.601965893432374e-01   +3.034460788821260e-01   +7.243954907031171e-02; +1.344672428420722e-01   -1.613340532997772e-02   +1.016465742110023e-01   -2.405308755539485e-01   -6.802012801860949e-02   +1.604930141630108e-01   +3.136210175392284e-01   +5.813111575359155e-02   +1.778866115629618e-01   -1.255564614094943e-01   -4.369372686690885e-02   +1.132871123239534e-01   -3.875993666942236e-02   +8.893461880419368e-03   +4.858222175908730e-01   +8.571079694476075e-02; +5.958498745465677e-01   -1.255190807645176e-01   -3.102673288139532e-01   -3.032803774284812e-01   -4.051876056687428e-01   -3.355377291893766e-01   -2.061565308720358e-01   +6.853444878738402e-02   +2.249625856911736e-01   +1.056340220315371e-01   -2.912753938369957e-01   -2.766470359848970e-01   -2.634438702857556e-01   +5.273280464055442e-01   -6.399116288062855e-02   +6.361422710273804e-02; -1.253149333259650e-01   +3.679438461280330e-03   +6.951110926418097e-02   +4.377889236709849e-02   -2.881231674889224e-01   +2.671284508557393e-01   +3.235178265993986e-01   +8.357324954650142e-02   -2.097397324305806e-01   -1.532110131642899e-02   -7.244800856461987e-02   +2.321374940702821e-01   -8.847499034298235e-02   -1.412594326128583e-01   +2.814090528609191e-02   -8.034811577811704e-02; -1.995312972417949e-02   +2.246259813720552e-02   -4.510718045387498e-01   -3.796404866790337e-03   -6.704072988994592e-02   -1.299406999253043e-02   +2.963935347266575e-01   +1.595454367455059e-01   -5.889975305791226e-02   -7.063828247614225e-02   +8.770800686222396e-02   +1.317421683593468e-01   -1.991117508424195e-01   -2.078850116036711e-01   +3.631365575746653e-01   +1.877632834431164e-01; -1.941855498740563e-01   +2.897941957984930e-02   +1.944031453087702e-01   +4.255119153459608e-01   +1.166679027189288e-01   +1.444429747211581e-01   +2.374540877179313e-01   +3.285403289890464e-01   +8.584396225700794e-02   -1.031346530994096e-01   -1.542938469568279e-01   +1.890033884995024e-01   -3.188767681590540e-01   +3.697041385145184e-01   +6.882626795576303e-02   -2.141596987490521e-02; +1.906389424624835e-01   +5.584579039712773e-02   -2.510988163523730e-01   -1.927163751714154e-01   +1.057650239590352e-01   +2.674337415068762e-02   -1.833491747010901e-01   +1.041330918249585e-02   -2.907352378594009e-01   -4.458149623115373e-01   -1.522545287040561e-01   -5.743261174400701e-02   +1.560737719460246e-01   -4.193846074626583e-01   +1.195973734233865e-01   +3.663387393272925e-02; -5.434766918038707e-02   -8.906207732174773e-02   +5.039847888004484e-02   +1.611163351275553e-01   +3.260919055461723e-01   -3.991210472164572e-02   -4.296284701283049e-02   +2.076825895050378e-01   +4.008455226022535e-02   +1.146435704932872e-01   -7.501874585445567e-02   +2.301297659143276e-01   -6.400969017167786e-02   +8.431538991283667e-02   -2.008537819856699e-01   -6.893282118932795e-02; +1.353086164146899e-02   +4.235885137634315e-01   +2.099508015461413e-02   -2.759897818764762e-01   -3.765420587655892e-01   +1.421672071139305e-01   -3.861275443819756e-01   +1.062908506726370e-03   -1.348975439461365e-01   +2.904894191548301e-01   +2.568586884742471e-02   -2.685598466187048e-02   +4.306939029541372e-01   -5.755895128331574e-02   +2.176937650101835e-01   +9.140905996202270e-02; +2.386075037844662e-01   +4.871844594185544e-02   +2.153462872881608e-01   +3.192123178820446e-01   +1.811935479244137e-01   -6.377859898884372e-02   -1.667139548482730e-01   +3.259620998375017e-02   -1.817804324281049e-01   -4.263070912944976e-01   +1.411570650647685e-01   +9.516869447852404e-02   -1.247165856076797e-01   +5.298094333709578e-02   +4.027290523643950e-01   -3.392353423173667e-01; +4.256733691936846e-01   +6.861920602171959e-02   -1.146107310737764e-01   +2.431286648185671e-02   +6.225708081413053e-02   -2.551108645647282e-04   -1.030659397567312e-01   +2.015879991059139e-01   -8.700611423050647e-03   -2.982772458156291e-01   -1.657754374278657e-01   -4.836954584611454e-02   -1.639572310067437e-02   +9.193992122451655e-02   +2.244853240719032e-01   +7.867004991461052e-02; +1.012231841071366e-01   +4.113207632475494e-02   +2.936140352278431e-01   +8.569378819377627e-02   +1.147812199997989e-01   -1.123062025889431e-01   +6.691083481461288e-02   -6.525793505195390e-02   +3.529775828009036e-02   -3.628921323949899e-01   +7.055305348127870e-02   -2.629767777583832e-01   -5.611033766278237e-03   +2.299590276140802e-01   +5.817792856701712e-02   -5.846947131917611e-02; -4.099886446836090e-01   -1.192982413653100e-01   -6.169938740456063e-02   -1.312330188588247e-01   +1.768279246633436e-01   -4.477484499499407e-02   +4.237969181699642e-01   +2.038519264948424e-01   +1.323052540914263e-01   -2.858977596936836e-01   -1.162397540905856e-01   +4.821167200485753e-01   +3.406553682546609e-01   -8.176995830052945e-02   +1.999244553316436e-01   +7.994678890885344e-02];
L2I_L1I_iGABA_netcon = [+4.702357071266051e-02   -2.491597500108008e-02   +1.724756821458936e-01   -2.817171847065832e-01   -6.571366830406830e-02   +5.943499619150455e-02   +3.375782530813364e-01   +1.013773609755863e-01; -1.533645544751339e-01   -1.337345270410795e-01   +1.094487513396466e-01   +5.833224472923379e-03   -2.770864084950397e-01   -1.335651263072002e-01   -1.570747638343897e-01   +1.189643384478735e-01; -4.645611044389140e-02   +2.571031229309381e-01   -2.294911979875502e-01   -2.064215536046247e-01   +8.078080996139013e-02   +2.077813978331017e-01   +2.794583559880711e-01   -9.476273453149486e-02; +6.480277197861620e-02   -2.110395021264970e-03   -1.023843122343139e-03   -4.069036589250006e-01   +2.092625934534744e-02   -1.409799326307135e-01   +5.016139905393992e-02   -4.969617376567234e-02; -7.192721000241460e-02   +2.180826674633816e-01   -1.551556248764994e-02   +6.648127668992575e-02   +1.820447249757614e-01   -1.848583049369031e-01   +2.651646893114753e-01   -2.748081897282393e-02; +2.914804638639714e-01   +1.930265662984573e-01   -4.514075292604067e-02   -9.734347480374354e-02   +2.474076078086087e-01   -3.977726467629850e-01   -1.296445557476079e-01   -2.575766857064521e-02; +1.510342194733222e-01   +6.458106111516311e-02   -3.711662993601988e-01   -5.764788076315960e-03   +2.735075752133686e-01   +1.068593371857807e-01   -2.630964009945034e-01   -8.178309964736272e-02; +1.005272085616087e-01   +2.358260537028091e-01   +1.124213895269646e-01   +3.237344836417801e-01   -6.088738370053359e-03   +1.860476034861951e-01   -9.187024744404365e-02   +1.576854210350135e-01; -2.881671477775877e-03   +8.726634764590849e-02   +1.582073773722949e-01   -9.833264967263518e-02   +4.535926528025605e-02   +2.278318077707188e-01   -1.470731047266947e-01   +5.600172408685780e-02; +1.726069186409941e-01   -7.392100108790478e-02   -2.965074908541095e-01   +3.797800813612363e-02   -1.443606103377605e-01   -2.765308816113398e-01   -2.999197315824328e-01   -3.825181765260101e-01; +1.560311919881895e-01   -1.557242031382877e-01   +1.358767732482139e-01   +9.996433195597731e-03   -1.361177839233715e-01   -1.128296301005279e-01   -1.769974284070168e-01   -2.902033646210102e-02; +5.300030841932438e-01   +1.961149196272794e-01   -3.381903293218899e-01   +1.639890516038862e-01   +3.066786657977325e-01   -1.126221280955015e-01   -2.286284889245836e-01   -2.784011709473684e-01; -5.788061590561296e-02   -1.471321757519343e-01   -9.739249881097325e-03   +6.576518086142992e-02   +1.143257089480700e-01   +7.695646430312883e-03   -2.639086497182948e-01   +1.950440848486686e-01; -4.051823473355885e-01   -3.365727393518049e-02   -1.376177434082884e-01   +2.948810829218119e-02   +1.505881786077336e-01   +3.458998097921140e-01   -1.462998152111954e-01   +1.114489850301577e-01; -2.789065260577642e-01   +1.463990383873547e-01   -1.493244971653434e-01   -1.667665348074924e-01   -8.765066015904406e-02   -1.604767729842954e-01   +1.685525403698687e-01   +1.338388181323940e-01; -9.196039865768896e-02   -6.123989854933461e-03   +2.179489334310009e-02   -4.669394960576237e-03   +4.667583234765076e-01   +8.043582605680014e-02   +4.752542869931618e-02   -2.246954897418205e-01];
L1I_L2I_iGABA_netcon = [+1.842480970447855e-01   +5.376924674128383e-02   -1.835841583455783e-02   -2.783300674472221e-01   +4.772356229302419e-02   +3.613110261692477e-01   -5.826582838808014e-02   +7.790930293590898e-02   -1.409986383293350e-01   -2.503585728624496e-01   -3.845647109858504e-01   -1.190568540005010e-01   +2.828817511338266e-01   -3.977110834648248e-02   -7.446544419918008e-02   -1.970453830966410e-01; +4.569979223733878e-02   -6.547357447983920e-02   +1.303241977026771e-02   +2.514392156542957e-01   -3.009601785139045e-01   -2.464857404510081e-01   -1.062706346216668e-01   +4.295804045088474e-01   +3.410549327185521e-02   +2.465765761394177e-01   -5.521007423880600e-02   +5.762013584116056e-02   +4.771235687413569e-02   -5.842230101740287e-02   +1.002168156915502e-01   +1.479647397057902e-01; +1.374941834317217e-01   -3.287119855469033e-01   -1.466655990710299e-01   -3.611866757878460e-02   +1.670722976053481e-01   -8.633933318684027e-02   +3.561245628755730e-01   -1.074893562167503e-01   -1.317607861670210e-01   +2.373064537736306e-01   -2.027520920531214e-01   +2.287072931964627e-01   +2.487613614397879e-01   +6.681090936521733e-02   +6.148711005754925e-02   +2.579202708132854e-01; +5.180245815564953e-01   -2.800949208008552e-01   +2.089453984988035e-01   +2.089353071876947e-01   -1.227893462098462e-02   +1.057865381283190e-01   +5.035976373175922e-02   -4.348820178096915e-02   -3.528479357116186e-02   -3.569337269071596e-02   +7.259595360097910e-02   -2.946981357733047e-01   +7.548450147220649e-02   -2.478845649044948e-01   +2.004012139793488e-01   -1.498975236737446e-01; +5.014761021150949e-01   +1.181646260315414e-01   -1.526278268530635e-02   -3.174935237105524e-01   -1.417850173314197e-01   -2.106322603074666e-02   +5.095049369398330e-02   -3.155855993962134e-01   -1.094175832034911e-01   -1.246439664098900e-01   -7.407382797609657e-02   -1.150295729412503e-01   +8.973644074812631e-02   -9.454101080257502e-02   -1.569801565737461e-02   -5.739474764241523e-02; +1.439591654799265e-01   -2.835469260128870e-01   +3.833277989638501e-02   -4.695752490145192e-01   +3.790721225123523e-01   +4.484884360303254e-03   +1.581313895327313e-01   -5.630374995410718e-02   -2.403159383116070e-01   +2.372483139738236e-01   -1.889047259222301e-01   -6.384757052996258e-03   -7.022360430960466e-02   +2.080294461672517e-01   -1.283485280759271e-01   -3.543878028517029e-01; -1.851649971343110e-01   +4.409075787921332e-02   +1.967648649853296e-02   -1.598065389179875e-01   +4.826838489015293e-02   -2.177872933784544e-01   +9.802161576507883e-02   -4.384669610966606e-02   -3.033021154345037e-01   +2.281363364811417e-01   +2.459731753972364e-01   -3.531881370745217e-01   -1.161440905481066e-01   -3.171254942046756e-02   -2.915041460498718e-01   +1.243242883734007e-01; +3.902554758612689e-03   +4.064888516780527e-01   -1.878092792551018e-01   -9.991842750840266e-03   +3.245298641688314e-01   -1.879837839886531e-01   +3.468760550308785e-01   -2.739355922741650e-01   +1.186970218584473e-01   +1.997077771841585e-01   +4.176265236708308e-02   +3.028419840978541e-01   -4.733489228032285e-02   -5.851844478220013e-02   -1.499514121900028e-02   +2.563325110522185e-01];
L2E_L1E_iAMPA_netcon = [+1.313331075613265e-01   -1.469808746571989e-02   -4.900703626496987e-02   -1.301483152868662e-01   -1.296410012921791e-01   +2.168868703657816e-01   +5.527286368712667e-02   -4.751443495239578e-01; -3.855853282327070e-01   +1.113200057820554e-01   +2.881899457154751e-01   -3.595573735691858e-02   +2.985662728574804e-01   -1.807810303078943e-01   +9.287551852785078e-02   -1.455457565624537e-01; +5.999300151737396e-01   +1.262696269224849e-01   -2.941073081658733e-01   -3.934019249535124e-01   +1.873667683244482e-02   -1.621462316310217e-01   -3.082180668966372e-01   +1.058748143206726e-01; -3.252795085850806e-01   -3.841980692758720e-02   +2.373895154348885e-01   +3.275178955199475e-01   -3.819360340379671e-01   -1.345841192936612e-01   +1.547389554794857e-01   +1.587638101648608e-01; -2.232346558163442e-01   +1.861420967763959e-01   -3.307263352520168e-01   +4.068093155514159e-01   +2.574733821985069e-01   -2.065156617251396e-01   +2.369560651611249e-02   +3.369505615613506e-01; +6.510363087197781e-02   -7.923827201242239e-02   -9.839858195307702e-02   -1.085907294542843e-01   -2.785913048763483e-01   -9.592667111779515e-03   +8.494709229361069e-02   -9.473638902865689e-02; -3.497544387848056e-02   +2.519313829804287e-02   -2.103509577543398e-01   -2.909150405301594e-02   +4.224976530241196e-01   -4.553920528291397e-02   +3.616469577209767e-01   -2.580453728389884e-01; -8.675667246167784e-03   +4.559456376973550e-02   -3.574120839956259e-01   -2.346662475241233e-01   +1.422467987899769e-03   +2.597975188211667e-02   -1.239229738475620e-01   -1.237262211677792e-01; -1.204101731323355e-02   +3.118199278935645e-01   -2.262285888915697e-01   +2.325326723985363e-01   +2.117410444218308e-01   +2.891284558678839e-01   +1.331980631605893e-01   -3.197431422506665e-01; +5.799561186052901e-02   +4.334529892909659e-01   +2.419613407817722e-01   +1.810901596439137e-01   +7.611741759790819e-04   -1.137328672369098e-01   -3.104757504778369e-02   -2.402244126831216e-01; -8.333697640999743e-02   -3.036759739594822e-01   +4.799733961259489e-01   +4.458504091240081e-02   -1.055330547600938e-01   -7.811379668208497e-02   -1.100599088436498e-02   +1.730250923318393e-03; -3.027791676757981e-01   -4.274132656028444e-01   +6.760207945162827e-02   -2.705167972898426e-01   -1.686105363930671e-01   -2.942321791640538e-01   -8.197524809671611e-02   +1.270262755209068e-01; +1.875761610277886e-02   +3.184132181393299e-01   +2.305980862404036e-01   +1.939387382403694e-02   +3.494085261365928e-01   -8.417241432735456e-02   +2.326038391859099e-01   +2.677713918629904e-02; +2.709054110176464e-02   +1.648654801409629e-01   +3.214192108460558e-01   -1.398252939746168e-01   -2.048126299834345e-01   +2.399042926396172e-03   +7.575527471006663e-02   +1.002772375622021e-01; +6.146068892067717e-02   -7.286961980507045e-03   -2.573228582365189e-01   +4.141779636983128e-02   +9.448443798344058e-02   -7.234293936567743e-03   -2.930529284474238e-01   -1.125023468984574e-01; +2.224610115126355e-01   -2.180060903379563e-01   +1.749849169665653e-01   +8.928328360095777e-02   -3.591903583376648e-01   +1.075173359410155e-01   +8.136294537138765e-02   +3.040948130271351e-01];
L1E_L2E_iAMPA_netcon = [-5.673204829162262e-02   +1.817965775246480e-01   +6.689550292190932e-02   -8.470574592856221e-02   +1.597786444306884e-01   +3.300882358115181e-01   +2.755041779938755e-01   +1.917891833886255e-01   -2.117600186678830e-01   +2.482217771440281e-01   -1.128165560607200e-01   +5.323890392071103e-02   -1.003688860758731e-01   +5.741063785531599e-02   +8.055903957290136e-02   +1.140355137566243e-01; +5.388724943990564e-02   -4.114267951796570e-01   +1.410990994334870e-01   +3.048619742952880e-02   +2.442711785648075e-02   +1.487459327943249e-01   +1.451045135746956e-01   +1.701229024121259e-01   +2.806583200004924e-01   -5.309431896623859e-02   +5.664017069081857e-02   +9.529386603873435e-02   +3.229143225570575e-01   +8.702980202491953e-02   -9.406290107107147e-03   +1.539254387350871e-02; -2.329089011820290e-01   +3.267828487866914e-01   +3.652518494832081e-01   -3.027548712203338e-02   +1.162058814284210e-01   +2.093428963394657e-01   -3.759259202978590e-02   -1.802733260062807e-01   +1.483794079987824e-01   +1.126769182711941e-01   -3.168001878448506e-02   -6.799471924263011e-02   -5.594528187688957e-02   +1.257677222105142e-01   -3.283562548877545e-01   +1.293993395666316e-01; +3.816841364302568e-02   +5.107348421777413e-03   -1.494494092886880e-01   +1.163531846124362e-01   -3.538876302562458e-03   -2.170234557098226e-01   +1.475553913666855e-01   -3.753300783849374e-01   +1.740929053126220e-01   -2.461665934068877e-01   -3.033952729395323e-01   +2.078608139495433e-01   +8.084713204644270e-02   +6.517829647229550e-02   -8.877368634963587e-02   +2.667547238107821e-02; -1.295305796366766e-01   +1.399358402898163e-01   +4.558223108061225e-01   +3.309922456073803e-01   +2.096426666745002e-01   -2.759256054314445e-01   -4.803913528082035e-02   -5.082312798064459e-02   +3.490961344524161e-01   -7.730903007424392e-02   -1.917064491533549e-01   -8.177439922295679e-02   -4.239635892858741e-02   -2.799253512827298e-01   -2.879352469860738e-02   -1.416599427668942e-01; +2.590290569756454e-01   -2.019790193776293e-01   +1.589808323858174e-01   -6.642866111706396e-02   -3.093466443991491e-01   -2.957276677326354e-01   -3.339891974658363e-02   +2.291430451821007e-01   -1.825689830484879e-02   +2.372600776243214e-01   -1.442737216721941e-01   +1.014979104384534e-01   -4.676008768699363e-02   +1.599597210765102e-02   +2.591310537988839e-01   -9.837397488020329e-02; +2.961162720678333e-02   -3.282758632420826e-01   +9.731224587893361e-02   +2.718042974391166e-01   +1.372177114530904e-01   -1.670876236023529e-01   +3.148085281085033e-02   +1.113075680670941e-01   +1.932810251486508e-01   -1.485811479618332e-01   +6.471295460675568e-02   +6.856546136299276e-03   +7.492298393983733e-02   -2.263223526558639e-01   +9.145508748801991e-02   +3.021347029880366e-01; +3.802691883302822e-02   +5.048517673186948e-02   +1.559120796690352e-01   +2.330565021882484e-01   +1.534384881287575e-01   -5.219205555902907e-01   -3.989366709554860e-01   +1.251499785682207e-01   +6.636732820892816e-02   -8.141171664976411e-02   +2.976233732424270e-01   -1.761187193834181e-01   -1.804872516839825e-01   +6.066658562472886e-02   +2.245382805645174e-02   -2.318074801786062e-01];
L2I_L2E_iAMPA_netcon = [+4.049285974051153e-02   -9.860547239938400e-02   -7.345130006165915e-02   -2.643389506296628e-01   +3.401472535400159e-02   -2.582429863871001e-01   -2.825119939803602e-01   +2.176119858622285e-01; -1.185704825522334e-01   +3.191696623504256e-02   +9.998434612979898e-02   -3.637757105763841e-01   +2.176001661323432e-01   +2.866323214131282e-01   +3.485108605973020e-02   -1.238335521102732e-01; -2.017322197955640e-01   +2.272825504457718e-01   -2.766214591577724e-01   -2.179843743555994e-01   +9.775421355342009e-02   -2.058734176566238e-01   -5.848303882165359e-02   +1.295745066609748e-01; -2.770036526303654e-01   +3.441371973566607e-01   -2.372082081419943e-01   -1.565931746901756e-01   -1.382467899204572e-01   -2.942993774800649e-01   +2.774667992975001e-01   -1.394745302961654e-01; -3.840900032595609e-02   -1.312198493655020e-02   -3.407393206050990e-03   -2.707821152271038e-01   +1.266397109009778e-01   +2.208928789395988e-01   -2.779027522631668e-01   -1.767435762622990e-02; +3.778402787931102e-02   -6.500934037069894e-02   +5.177640990764630e-02   +9.106025019238889e-02   +7.839944381154881e-02   +5.008614691933304e-01   +1.882975506237791e-02   -8.997261431375955e-02; +1.188076075568316e-01   +7.919304432968259e-02   -2.372773841836220e-02   -2.879832824790662e-02   -5.160623474343988e-02   -5.830687137289112e-03   +1.490668088667085e-02   +2.671038578568291e-02; +2.513728242849754e-02   -1.444627056673251e-01   +1.149674962026130e-01   +2.159866234484041e-01   +3.014852081757038e-01   -1.764844900490310e-02   -2.453394767510881e-01   -2.154211623090045e-01];
L2E_L2I_iGABA_netcon = [-1.290939183148356e-01   +3.423142336501924e-01   -3.443866277351975e-01   +4.454379081649872e-02   +2.208299173778950e-02   +3.582133640013687e-01   -2.282447331409845e-01   +4.235370672675703e-02; +8.883587288934694e-02   -1.174270664053972e-01   +1.991558007465256e-01   -1.711010007559387e-01   +1.910602922159477e-01   -2.253139632692742e-01   +1.658278160843116e-02   -2.567811495766223e-01; +1.312733807953363e-02   +2.191628793910450e-01   +3.812469685550929e-02   +9.939910256893295e-03   +8.046235228109419e-02   +1.675951898684044e-01   +2.866457098256033e-01   +3.293010151639672e-02; -1.536280976814190e-01   +1.603848507659413e-01   -3.315259707757565e-01   -8.439756791090762e-02   +6.416807822497907e-02   -3.419814680735125e-01   +1.628696704163218e-02   +3.309670887452714e-01; -3.605714200334592e-01   +2.874805239215386e-01   -3.521879949810394e-02   +1.535752267779288e-01   +2.875923743923597e-01   +3.120727266014776e-01   -1.182812127415848e-01   +1.726526494692827e-01; -3.045797206909895e-03   -7.733547729286694e-03   -2.150809604743813e-01   +3.789771147311031e-01   -1.675433946270791e-01   +2.272444637508119e-01   -7.252297920121489e-02   +6.174183981335057e-02; -2.848636654806523e-01   -1.861269700328730e-01   -1.302188092546789e-01   +4.766338735714032e-02   +2.154912879545397e-01   -3.007353121581769e-01   -2.258302474120923e-01   -1.754667291905591e-01; -2.708784789757344e-01   +1.463093711784493e-01   -9.006922470413550e-02   -2.124179776334388e-01   +1.140222872093615e-01   -1.669239910542351e-02   -1.119233704110362e-01   -4.297951027285038e-01];
L3E_L2E_iAMPA_netcon = [+8.456554909443903e-02   +1.260604541411860e-01   +1.713133919300070e-01   +8.675190291292584e-02   +2.078257305486409e-01   +1.600029432808608e-01   +1.978901164052852e-01   +7.491098664780968e-02   -2.116898153160175e-01   -2.315626940432768e-01   +5.853926645409679e-03   -6.396243235337712e-02; +9.910447552580810e-02   -6.019466805268311e-02   +1.147531580156690e-01   +2.374285698093691e-02   +2.786909936614086e-01   -1.558939210282373e-01   +1.016371328535278e-01   +4.642238053232862e-01   -4.954991105339535e-02   -1.170638566650323e-01   -3.741914640492179e-01   -5.563296841659396e-02; +3.663071176987301e-01   -6.615060622413223e-02   +3.060515368450414e-01   -5.013126119716859e-01   +1.313613411118834e-01   -1.313509641573710e-01   -7.785751491505113e-02   +6.413445591109192e-02   +2.302570878830548e-01   +1.836766620942788e-01   -3.745268475409894e-01   +1.444881786982020e-01; -5.948582697620863e-02   +1.018794262889308e-01   +3.089009450796077e-01   -7.699198295710516e-03   -4.743099435952666e-01   +2.748566617509596e-01   -2.890560972841406e-02   +8.861213008371183e-02   +1.253382647604151e-01   -4.044883089401053e-01   -1.687524442589684e-01   -4.816185608612841e-01; +4.492107785048316e-02   +2.543617438706913e-02   +2.660785586191143e-02   -1.167678238542288e-01   +2.333751901024559e-01   -1.595711702461738e-02   +5.888338581449244e-02   +1.438783131010981e-02   -1.291672627961548e-01   +1.870708036206323e-01   -1.723088617614483e-01   -1.629220857562286e-02; +8.702484319377848e-02   +3.689086799823525e-01   -5.695354761120859e-02   -1.612930948515290e-01   -9.578601156099892e-02   +1.494478772025219e-01   +2.517944828248878e-01   -4.036404908533859e-01   +5.412513827347129e-02   +4.026761252982464e-01   -4.443483568042392e-02   +2.983939504091742e-01; +6.514157612539932e-02   +3.579547665376739e-01   +2.051096980716206e-01   -2.418793898207399e-02   -1.394729524964111e-01   -1.249274482598180e-01   +2.938394161977420e-01   +3.391585780555567e-02   +8.356211170357654e-02   +3.845857190995075e-03   -1.434310754895361e-01   -3.131309465826287e-01; -2.360568424520791e-01   +1.013942765614453e-01   -1.205888623646359e-01   -2.556829025519047e-01   +1.264587558001645e-01   +9.973004282312110e-02   -2.687631895319763e-01   -2.076720107352615e-01   -1.837655449336058e-02   -2.894801417754059e-01   -1.309673586873222e-01   +4.878751647401135e-02];
L3I_L2I_iGABA_netcon = [-1.034022425719352e-01   -3.122272127762429e-01   -1.288755296076224e-01   +1.629784732050086e-01   +2.254059456687434e-01   +3.445315471077127e-01   +2.979148361185707e-02   +8.851150299557468e-02   +2.843790226556159e-01   -1.201847440845104e-01   +1.343351628499580e-01   -9.855352176592228e-02; +7.243108977431184e-02   +2.467036141047947e-01   -1.210427836368519e-01   -1.145064015774685e-01   +2.328821024525030e-03   +1.707923421087576e-01   -1.320048347720942e-01   -1.159290994020835e-02   +3.725757600607553e-01   -2.001639320901646e-01   +8.451822878810417e-02   -2.523356863896690e-01; +1.910224218473000e-01   +5.446764500795435e-02   +1.891890699534277e-02   +3.497852721005891e-02   +5.335652647224835e-02   +5.875869836659384e-02   +2.040349783556502e-01   +1.507719456233091e-01   -9.580499517322166e-02   -3.739853524191712e-02   -4.508476869977150e-01   -8.503352860938991e-02; +3.231973434499594e-02   +2.513527529366045e-01   +3.756993558314001e-02   +3.692954240171130e-02   +2.233087564675064e-01   +8.260365713794615e-02   -3.001775074312443e-01   +2.920272597607607e-02   -5.005344119818680e-02   +2.425946566918174e-01   +1.341389020553454e-01   -1.254234284905032e-01; -2.967250862312011e-01   +1.490068531937335e-01   +2.454121036300396e-01   -8.829404278847411e-02   -9.192391095745477e-02   +3.789016411845367e-02   -8.426278369417861e-02   +1.362399653182773e-01   +1.905943574040712e-01   +2.029854850868960e-01   +1.054692555641222e-01   +2.424106643786289e-01; -2.537092019100511e-01   -3.342634983293751e-01   +2.000746631434585e-01   -3.417842687727350e-02   +1.758465972039810e-02   +8.444311471696957e-02   +2.593424939959305e-01   -9.207829446039124e-02   -8.024957592399798e-02   -5.155645939070293e-02   +9.134275230181250e-02   -1.418309758542015e-02; +3.300962442901456e-01   +2.624604768008361e-01   +1.654126213628472e-01   -1.304376660661290e-01   +2.510161079421785e-02   -2.381246229211252e-02   -1.839617157608789e-01   -1.388316770935715e-01   -2.009073548694838e-01   +2.103285826820538e-02   -1.603980132676442e-01   -2.336584232862133e-01; +2.486718134033976e-01   +1.509541966698887e-01   -4.735579062617697e-02   -7.012651916419650e-02   +4.939559435403487e-02   +4.163504095132192e-02   -2.215790149714753e-01   +1.111014543137992e-01   -2.394782612812751e-02   -1.824244453611177e-01   +3.849257338928901e-02   +1.253536309871251e-01];
L2E_L3E_iAMPA_netcon = [+6.284828952904434e-02   +7.577795256304208e-02   +1.708275593614386e-02   -1.756730746358153e-01   -1.036289927866788e-01   +3.354120641355406e-01   +1.761522683891201e-01   -3.350168241276693e-01; -8.659429734043307e-02   -1.388620652460091e-01   -2.316817972754477e-02   -1.956270833411663e-01   +2.179104179648736e-01   +1.321175451027352e-01   +4.133474098094989e-03   -3.730601916389628e-02; -3.239613343611388e-01   +2.150996515945585e-01   -5.479036495715427e-02   -8.767771309724941e-03   -7.338142653310131e-02   +8.162994774601470e-02   +3.741450903177738e-02   -9.264607728448664e-02; +5.413804212533628e-01   -4.724001963734414e-02   +3.594281699557069e-01   +3.130918447290601e-01   -6.435265404405219e-02   -1.236149536615960e-01   +4.289308774880193e-01   +7.252078680946750e-02; +5.294885500162799e-02   +1.900499591908658e-01   +7.070165497792678e-02   +5.554210647847171e-02   +6.600936689308314e-02   -1.790903063287705e-01   -1.285266094987548e-02   -1.710253117099265e-01; -1.982173792651562e-01   -1.335455294798364e-01   -1.569917678428872e-01   -4.762369683930459e-02   -1.373800811157082e-01   +1.799567286770123e-01   +1.452581266072301e-01   -9.520320998602814e-02; +4.517043389339052e-01   -3.256129527058313e-02   -5.937473816098081e-02   +1.576707859767945e-02   -3.526314407036968e-01   +1.317011090974411e-02   +8.267437123161191e-02   +4.522625640140853e-02; +2.568352481101951e-01   -7.598360307704065e-02   -2.183300822398982e-02   +8.332429421412504e-02   -2.008030463795656e-02   -1.494350164449223e-01   +1.699502111792459e-01   -1.273693614076443e-01; -6.595864740962470e-02   -1.012836131175036e-01   -1.081454563102331e-02   -6.886342120789030e-02   -8.586548481000253e-03   +3.598496832036863e-03   -8.651201384643580e-02   +1.997315637409307e-01; +1.798794682454023e-01   +1.908324411526020e-02   -1.161719302519954e-01   -4.497754865840031e-03   -2.848663309062348e-01   -7.799259030403337e-02   +2.536247056899082e-01   +1.464004010783534e-01; -2.166899613315916e-02   -5.852513382454011e-01   -3.622475100863240e-01   +8.207315814676282e-02   +6.529908077016519e-03   -8.254340111757248e-02   +1.757219879217196e-01   +2.635575312733938e-01; +3.170198385371305e-02   -3.591848791842533e-01   +6.858369914582201e-03   -2.913553766105487e-01   +3.699962487888447e-02   -7.721296250816079e-04   -2.581300839216705e-01   -6.597772253940912e-02];
L2I_L3I_iGABA_netcon = [-2.293019622373212e-01   +1.407664966095640e-02   +2.333329420567270e-01   +2.036350817740604e-03   +1.536840461818611e-01   -2.550200584797203e-01   -2.777807915111389e-01   -3.550996729042790e-01; -3.692471195353986e-01   +3.671126966673641e-01   -1.967493710045881e-01   +4.791984841597945e-02   +5.083762875540865e-02   +1.261212791181170e-01   -8.661757953062019e-02   -2.043316691780809e-01; +2.972599835510885e-01   +1.049263121017568e-01   -1.030133286157424e-02   +8.836268937678284e-02   -6.315933019061204e-02   -1.435058441561125e-01   -4.045672786240577e-02   -2.916669191621571e-02; +7.817006902153269e-02   -1.738879332090700e-01   +7.324105827676924e-02   +3.819226584563146e-02   -3.292897989555767e-01   -3.291763309919156e-01   +6.694514138188623e-02   -2.870174260874674e-01; -1.453379992094738e-01   -4.829951758769876e-02   +3.206989107281716e-01   +1.535642826338704e-01   +2.241720661973410e-01   +2.625964385508580e-02   -1.351005988285247e-01   -2.548917240119568e-01; +1.410020042431405e-01   -7.632477265999865e-02   -1.804172867416133e-01   +1.616957336152786e-01   -3.116553031514641e-01   +1.009984985032958e-01   +1.135444622167848e-01   -3.674858256909677e-02; +2.339959259464733e-01   +1.116010334667794e-01   +2.695156414763768e-02   +7.097379577910805e-02   -1.844989385720019e-01   +1.373273414995127e-01   -7.925319937894014e-02   +2.783480959353747e-01; -1.818495264260730e-01   -6.873766318430936e-02   -4.738158881961217e-02   -7.999455578277920e-02   -1.396679637696026e-01   +2.122260842893506e-01   +4.731645778278683e-01   +1.086113451047881e-02; -1.706510234067690e-01   -1.591590978811296e-01   +4.727646939369485e-01   -1.924445803437118e-01   -3.161531083492486e-01   +2.808423447233962e-01   +6.353537689322893e-02   +1.310001484873342e-01; +3.295529531284249e-01   +3.177975309338823e-01   +3.335585272780102e-02   -1.661674358784209e-01   +3.994891602471593e-01   +9.674659603715800e-02   +2.606466419264388e-02   -3.309602335110106e-01; -1.916167926270668e-01   +9.804694244594028e-02   +1.170056929161410e-01   -1.525718360119736e-01   -5.022286508296927e-01   -1.176782904976543e-01   +9.820172911785829e-02   +1.557279583233248e-01; -2.234447092788018e-01   +5.355974066758538e-02   -1.109276850716467e-01   -8.151079212258805e-02   -5.074926773807553e-02   +1.002194002468583e-01   +1.119245194380221e-01   -9.806737184408860e-02];
L3I_L3E_iAMPA_netcon = [-9.092567765557806e-02   -2.530969775762572e-01   +2.366248457438582e-01   +2.790114612067486e-01   +9.705240409230141e-02   +1.170731584347990e-01   -1.126780144035145e-01   -1.978388000361909e-01   -1.623841455991735e-01   +1.796382166246565e-01   +5.225936880327021e-02   +3.542021805276317e-02; -1.081716129202647e-01   -3.743279710784745e-01   -1.916195902770814e-01   -2.046116115617566e-01   +2.528413942683170e-01   -1.851234526892843e-01   -1.970767068052767e-01   -8.910290330443543e-02   -1.427906836788900e-01   +4.289865682579104e-01   -2.813034835847418e-02   -8.594244832031828e-02; -1.338884395841974e-01   +3.570629817759012e-01   +2.757339322156535e-01   -1.320886456547907e-01   +9.325610867112394e-02   +6.653695443634033e-02   +2.498083220210849e-01   -1.519776012257899e-01   -2.722451889692579e-02   +9.533858540554575e-02   -3.792345222691046e-01   -2.785444213518400e-01; -2.720135434521515e-01   +4.692969103953654e-01   -1.228021997574022e-02   +1.045662257452021e-01   -4.230611513216112e-01   -2.560310704905032e-01   -1.103236176446118e-01   -1.238567555984563e-01   +5.723521784932930e-02   -1.142124762717951e-01   -6.630180458030814e-02   -2.650762489668467e-01; -1.324023749414424e-01   -6.951393051576318e-02   -1.527603266619684e-01   +2.376180376869486e-01   +3.403785781024100e-01   -2.644882971193950e-01   +3.597506272878725e-01   +3.140180193018275e-01   +2.997295364177855e-01   -6.071136521551089e-02   -1.435688287441495e-01   -2.061341777537998e-01; +5.679660663196269e-02   +4.563912842354430e-01   +1.233138158162957e-01   +2.887858679544262e-01   +2.345182635488521e-02   -2.058460248658116e-01   +1.159933765613785e-01   -1.095444422967194e-01   -1.265874974501312e-01   +1.336785821046335e-01   +9.241552359472435e-02   +1.430222825725218e-01; -2.241008826330133e-01   -9.672246573506862e-02   +8.816317766794624e-02   -2.087176703763384e-02   +1.996903317476897e-01   -3.097775452051723e-01   -3.139127149962443e-01   +5.951441581636222e-02   -2.215413987816195e-01   +2.197378726687269e-01   +5.604154636295462e-02   -2.264073578642306e-01; +3.843466452284983e-01   -6.123657348445365e-02   -1.817215651965710e-01   +6.238354388937976e-02   -2.035258990186219e-01   -2.016027635997242e-02   +3.010978664904327e-01   -1.321907223149690e-01   +2.365302722928184e-01   +2.193862838658098e-01   +2.651027405376178e-01   +7.260974543070893e-02; +1.114179930609984e-01   -6.947594131592116e-02   +2.918246222380101e-01   -3.171704269049532e-01   -1.941196353819706e-01   -4.328506275376744e-02   +4.402525085534831e-02   -3.438603872370128e-01   -4.197940355939574e-01   -1.379912835432281e-01   +1.625286450266425e-01   -2.915463380253848e-01; +7.172897869087409e-02   -1.509174247851879e-02   +3.057069919615623e-01   -1.549767991355427e-01   -9.980543620600130e-02   -3.200806285620762e-01   -3.946822841986887e-01   -1.111049968794890e-02   -1.687636314209973e-01   -5.971727210167074e-02   -1.537236319057121e-01   -9.663983015550225e-02; -1.797325205434905e-01   -3.015036669323168e-01   -2.632073640835567e-01   -4.141599887483097e-01   -1.110995328633551e-01   -2.335186531154007e-01   -1.410117268639849e-01   +1.869611100423767e-01   +1.440483200476733e-02   -2.879070834278400e-01   +1.837824996965531e-02   -3.118963089381478e-01; -1.665803250642325e-02   -1.809960734463160e-01   -2.975409151641417e-01   +2.081091604414524e-01   +1.479701492900803e-02   -1.285522963111792e-01   +7.504204917956189e-02   +1.907198835241597e-03   -5.849963310973355e-02   +2.339218722083780e-01   +9.088802903608315e-02   +5.201647007426222e-02];
L3E_L3I_iGABA_netcon = [-3.326985731746115e-01   -6.332143141334812e-02   +4.059075029573768e-02   +1.518982616167424e-01   -3.526343879863796e-01   -1.369003099303148e-02   -1.396546501510130e-01   -2.021202547230657e-01   +2.246666202240821e-02   +2.360334830175309e-02   +6.795257479982195e-02   -2.690364137145317e-01; -5.765565351854808e-02   -4.915856540303958e-02   -5.813041842880984e-02   -2.367470967949302e-01   -4.135490774359458e-02   +1.474277489506910e-01   -1.555158772099252e-01   +1.707104215128579e-01   +1.819841474415320e-01   +2.652481318987425e-01   -3.516709564325886e-02   -1.234674547456388e-01; -9.100161023005301e-02   +1.333847436450065e-01   -9.123988870953409e-02   -9.194735928097898e-03   -3.547489003904029e-02   +3.519671498498280e-01   -1.938159475486308e-01   +2.413099346710666e-01   -1.976798186360390e-01   -5.901656929010532e-02   +2.477899412861529e-01   -1.264418771497995e-01; +1.785788129691652e-01   -6.409345617220202e-02   +3.278514836326721e-01   +3.032370548153288e-01   -1.629349676146019e-01   +1.320535537070866e-01   -2.028804244576269e-01   +1.789104567436100e-01   -5.271928409915341e-02   +2.535144025563820e-01   +4.038616139092664e-01   +3.796450375925825e-03; -6.846533983551345e-02   +1.949820750768136e-01   +4.207246156168675e-01   +1.789072109870619e-01   -1.074247418839346e-01   +2.634528479992153e-01   +4.894081519827734e-01   +4.457506776812664e-02   +1.960079546027059e-01   -5.077891770127997e-02   -5.650842821009527e-02   +1.532475077090162e-01; +1.060904370569718e-01   +1.949140527520128e-01   +1.937146721105178e-02   -9.474939020767101e-02   -9.420633437025608e-03   -2.647824484577120e-01   +6.272865744337920e-03   -3.288465269355793e-01   +1.407433737361753e-01   -2.495305787342859e-01   -7.007963827672503e-02   +2.687818817084744e-02; -4.350109731973075e-01   -1.633820602283180e-01   -1.291228119634475e-01   -2.601768992699375e-01   +1.188951507798267e-01   +4.001510179365004e-03   -3.546431460908686e-02   +1.146350726308487e-01   +1.934709665198959e-01   +4.931443003062069e-02   +1.654779991026870e-01   -1.909298285332174e-01; +2.302329811997401e-01   +1.300721481624368e-01   -2.370629039540580e-01   -2.220975535120609e-01   -1.539010449768828e-02   +6.721572330553618e-02   -4.713891452771568e-03   -7.230048175112450e-02   -1.086188065977391e-01   +6.878531032268365e-02   -7.211579097584503e-02   +4.085832104956128e-02; -3.085320795652491e-01   +1.440588448081875e-01   +1.422997160413310e-01   -1.282084753375188e-01   +1.152881054703896e-01   +1.369963329404716e-01   -1.662567281417869e-01   +2.012872037243358e-01   +2.144944472454830e-01   +8.111228784391741e-02   +7.233231179487927e-02   +2.276697170577427e-01; +1.767296622409037e-01   -2.551461104349296e-01   +9.786206788105592e-02   -4.988250501328790e-01   -9.365866505911508e-02   +1.240464420591756e-01   +4.629559114165795e-02   -4.700743913060905e-02   +2.172882528020707e-01   -7.087667331400244e-02   -1.828667030598214e-01   +3.769873756714079e-01; +2.663908217709495e-01   -2.235075389337590e-01   +3.430336903422996e-01   -3.629526651224422e-01   -1.724830600021523e-02   +1.026590872837340e-01   +2.885784884090491e-01   +1.485305902973015e-01   +1.696112897424051e-03   +1.391787579335257e-01   -2.104241386508019e-01   +3.324631916018224e-01; -3.870497530272271e-02   -7.480911145046831e-02   +1.249716583471475e-01   +3.689348570718308e-02   +3.356275157550380e-01   -9.779398191360661e-02   -2.202029911414022e-01   +1.301584443976713e-01   +1.561638165078016e-01   -1.583965488240312e-02   -3.144980717166850e-01   -3.584662614862293e-01];
L2E_Input1_iAMPA_netcon = [+9.559173596975741e-02   -1.010804150416423e-01   +3.268927481591374e-01   +2.721820999459054e-01   +1.414596369942563e-01   -9.475219092385867e-02   -2.566996556325262e-01   -3.868785219267703e-02];
L2I_Input2_iAMPA_netcon = [-4.254109689935769e-01   -3.419922872499684e-01   +1.082696908960000e-01   -3.225045677907337e-01   +8.882369877314088e-02   +2.237889559816261e-01   -8.730760771402231e-02   +2.498375028008011e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
