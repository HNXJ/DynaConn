function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.128784606732235e-01   +2.611699126591341e-01   +3.780120869758430e-01   +7.175663422505397e-01   +2.106715618420399e-01   +1.541731577287233e-01   +6.476962551915245e-01   +1.450651570122789e-01   +3.388318342120769e-01   +3.131593831863847e-01   +6.811588205395108e-02   +1.218521608751599e-01   +3.497668219299493e-01   +6.467807712975003e-01   +6.679710430491920e-01   +8.093588927595549e-01; +6.930941602889278e-01   +7.355351002571303e-01   +5.455088248067351e-01   +1.005829265769981e-01   +1.367528450244331e-01   +2.690457857308210e-01   +1.896171298104625e-01   +3.257020604444649e-01   +6.675755196140476e-01   +6.041585829428151e-01   +8.418187336943102e-01   +5.744885083721635e-01   +8.338207543946692e-01   +3.429773606133437e-01   +5.902222426950043e-01   +2.150747824403291e-02; +8.873926462460019e-01   +6.682742067161893e-01   +8.324820144427125e-01   +7.854400766700728e-01   +8.528577825061976e-01   +7.595667762462669e-01   +6.368745086764112e-03   +1.040726638526689e-01   +4.097512005406666e-02   +8.941683651603659e-01   +4.634925570540154e-01   +2.663382549225740e-01   +6.917799294790035e-02   +4.215352494479051e-01   +3.013823565727373e-01   +6.231514897240654e-01; +6.450880583515947e-02   +8.979078237274877e-01   +3.332786589118751e-01   +9.255893018087416e-02   +1.173861225653005e-01   +1.575491453246289e-01   +3.401566825511906e-01   +4.082170824002412e-01   +6.372038374990172e-02   +5.832729366562059e-01   +2.409107813964103e-01   +4.641472668762190e-01   +4.582826643757344e-01   +7.439465736526700e-01   +8.486233373019950e-01   +3.261736274216749e-02; +8.404056557451437e-01   +2.340691245504440e-01   +7.042621979945104e-01   +8.437287558270279e-01   +3.406912094625106e-01   +1.395498335774328e-01   +7.686537598127102e-01   +5.153040351766813e-01   +7.028210705617854e-02   +1.514713074787118e-01   +8.993955372429608e-01   +6.280553277508144e-01   +7.643571725609514e-01   +6.670449255618547e-01   +3.287562651539007e-01   +7.496800982877606e-01; +4.838257496514078e-01   +4.984025144943053e-01   +5.265896716275248e-01   +1.308444054301174e-01   +4.796332724296425e-01   +4.139471562048034e-01   +2.412659610847070e-01   +3.264759632027958e-01   +4.982442918161096e-01   +5.154402838659036e-01   +5.117619270611857e-01   +1.006580448823059e-01   +2.801110102495796e-01   +8.340531826264427e-01   +4.744550843018823e-01   +8.172968141403566e-01; +7.559622267152246e-01   +5.252183129806061e-01   +7.704845328972922e-01   +4.557542219864971e-01   +8.230006634288218e-01   +3.983691281789666e-01   +3.038209847116665e-01   +3.082407498213193e-01   +6.214411664058997e-01   +5.737665911762477e-01   +5.457539684073519e-01   +9.966091371367893e-02   +8.461605688093717e-02   +8.551807467736525e-01   +5.310082841361965e-01   +6.868110653851215e-01; +9.710364204666956e-03   +8.542749605588617e-01   +3.485373950939364e-01   +7.517965102771105e-01   +3.640204532199319e-01   +6.017438998247359e-02   +4.431328035416361e-02   +2.052824591215208e-02   +8.195449099588573e-02   +5.228674622016038e-01   +8.335909124887654e-01   +7.058311121184986e-01   +2.679512896697354e-01   +2.264502635645395e-01   +6.315070499077562e-01   +2.678146867762285e-01; +5.435061569359709e-01   +1.321121130114990e-02   +7.459589523231484e-02   +2.225406870568081e-01   +1.597055001576440e-01   +5.569824991893636e-01   +6.171087812110496e-01   +3.288236447540181e-01   +5.307413976693447e-01   +5.147071221754043e-01   +2.850821528056965e-01   +6.497292296027257e-01   +2.438563019488218e-01   +2.197089897986017e-01   +8.223326345192273e-01   +3.688000495301606e-01; +7.684724722992290e-01   +2.020744720996801e-01   +7.858614546732605e-01   +1.845054133877786e-01   +1.476851252299415e-01   +1.755949435444515e-01   +2.541454416627938e-01   +5.627307021214561e-02   +2.706417168274583e-02   +1.891383640440970e-01   +7.372000522844957e-01   +8.809643418745292e-01   +1.108461216038132e-01   +3.126875851695150e-01   +7.836932836094178e-01   +8.867184230956523e-01; +3.076847807167771e-01   +8.749046081755916e-01   +5.562064174744448e-01   +6.119065217416318e-01   +1.297283905407705e-01   +4.291354498672484e-01   +7.169157209778571e-01   +3.881297420334716e-01   +4.387438479079268e-01   +2.897900304679932e-01   +1.746391552628357e-01   +4.800715015030566e-02   +8.435196237596332e-01   +2.394877978560277e-01   +8.005419688223170e-01   +6.050887646377534e-01; +8.027271062604052e-01   +2.440102340783612e-01   +8.555417301189311e-01   +6.994779921603960e-01   +2.413846912953677e-01   +2.287796961591136e-02   +5.665122300662609e-01   +4.240442271552847e-01   +8.321111542308280e-01   +6.654978633530113e-01   +4.733482591508056e-02   +1.406173468210602e-01   +7.225735518618523e-01   +4.680633698721413e-01   +7.622166994666356e-01   +2.622894969066339e-01; +1.482148934970211e-02   +7.112777259915603e-01   +6.178825738198768e-01   +1.027817572028126e-01   +2.890457957982894e-01   +5.495337556363865e-01   +1.518509075959319e-01   +6.581111369481307e-01   +5.586561064763552e-01   +3.339480904605602e-01   +2.391975576685147e-01   +7.317704841777662e-01   +8.592355422779490e-01   +8.438992941005874e-01   +1.426742147571402e-01   +3.448130220511632e-01; +1.002619907836088e-01   +7.571929079023305e-01   +8.419997014006974e-01   +8.479037232606431e-01   +2.311721194102081e-01   +2.210460472714520e-02   +3.218730720932144e-01   +2.671916341028790e-01   +6.497339344903427e-01   +7.751456606863847e-01   +4.513709248790529e-01   +7.750169718438841e-01   +7.872471639978401e-01   +1.213314485038822e-01   +6.559877403594706e-01   +6.073984625571547e-01; +3.381575030334132e-01   +3.378675581915218e-01   +7.485710596087094e-01   +1.403115077662362e-01   +5.493234613698762e-01   +4.425029312122908e-01   +2.840464422764997e-01   +4.116642474669789e-01   +8.905976406598576e-02   +8.847633940633627e-03   +1.813407008098152e-01   +8.902218953368929e-01   +7.405985132940673e-01   +5.655134753086574e-01   +7.110384191626283e-01   +6.562051158877297e-01; +3.129709811654185e-01   +8.581671755916396e-01   +4.393076126330903e-01   +6.603276728310650e-01   +8.958927877066625e-01   +6.687546349429933e-02   +4.327139032726831e-01   +4.179508259414929e-01   +6.057329573774477e-01   +8.900299371010476e-01   +7.802637044287986e-01   +3.315993768247542e-01   +6.984067873095592e-01   +1.533702596036789e-01   +2.291485582954581e-01   +8.528478740280208e-01];
L1E_L1I_iGABA_netcon = [+5.195464932368965e-01   +5.498323437852849e-01   +2.938476418317408e-01   +7.525877325764792e-01   +2.912326712917597e-01   +8.133711065039315e-01   +5.077889525234774e-03   +1.484833021644516e-01   +3.429956153029285e-01   +8.549219461030602e-01   +3.241526268121820e-01   +5.430183265200252e-02   +1.352624440305704e-01   +5.845609374337695e-01   +7.045719506858096e-01   +4.197433006786260e-01; +2.932299114621258e-01   +1.193103046532843e-02   +5.934474765325726e-01   +8.279039891622543e-01   +8.819537170537456e-01   +5.081932177356479e-01   +1.227078597981253e-01   +8.956672351006787e-01   +5.166061281074353e-01   +7.675100644374148e-01   +1.822506517619002e-01   +8.228154021825653e-01   +1.890662963042039e-01   +8.608817660642581e-01   +5.336351256544087e-01   +7.190433937505645e-01; +8.301914810348202e-01   +6.980964342134719e-01   +1.777933081074986e-01   +8.496378402273016e-01   +8.877265675103646e-01   +4.693789015478954e-01   +8.480876842250454e-01   +4.569587559069880e-01   +3.065346190006362e-01   +1.469808347973540e-01   +1.200895917026936e-01   +3.840109508055994e-01   +2.036576302927930e-01   +7.913873443079964e-01   +2.849931611319522e-01   +2.837898721889735e-01; +2.555810299406285e-01   +2.645651260109156e-01   +8.806228657408239e-01   +3.576290564227909e-01   +5.712323415179680e-01   +7.366795727910741e-01   +1.117639881425112e-01   +7.007020738650273e-01   +8.597104568456903e-01   +6.560459792879980e-01   +8.337746028276599e-01   +3.211406601728588e-02   +3.742355790616549e-01   +6.226593787605492e-01   +6.069570642951625e-01   +6.679956233936043e-01; +7.758220123569478e-01   +1.042649311401246e-01   +4.320238787500958e-02   +1.410246160901253e-01   +9.020432503502571e-02   +2.090295567860369e-01   +4.864542659635926e-01   +5.369061900522336e-01   +2.978209126221609e-01   +3.207254441453880e-01   +4.654363267901472e-01   +1.533790689777825e-01   +3.678717498168194e-01   +3.981583260370949e-01   +3.756873035476332e-01   +3.404024250694675e-02; +7.998470114330105e-01   +1.577038384737805e-02   +1.293223212023545e-01   +4.572118489978730e-01   +6.507015900925579e-02   +2.768689327384076e-01   +6.284481588899523e-01   +8.651907011069677e-01   +4.353088695776123e-01   +4.799112639460237e-01   +6.239580907502204e-01   +6.065558912153800e-02   +3.092091679466002e-01   +3.706106871602814e-01   +1.270624365686372e-01   +1.414782374757761e-01; +8.890763955282428e-01   +3.643452234123037e-01   +8.013858560054542e-01   +3.967063449261948e-01   +7.720774005015624e-01   +1.561869439134858e-01   +7.700134930725312e-01   +3.786685132512062e-01   +4.167905139527412e-01   +4.798511410676926e-01   +3.096977190794838e-01   +7.899731166338597e-01   +1.070001052824426e-01   +5.550740212777849e-01   +7.262829486945980e-01   +1.552776288207937e-02; +8.547701564982103e-01   +1.481690950058893e-01   +1.379087394262094e-01   +5.264898733100231e-01   +7.712339496310168e-01   +1.399591527571946e-01   +1.614885584529817e-01   +1.370268459019327e-01   +1.149827959837334e-01   +2.634421318455467e-01   +1.863527418575960e-01   +2.904222892806527e-01   +7.198335402424761e-01   +1.086075166804910e-01   +4.200491091792171e-01   +1.770544445192288e-01; +6.925202652349486e-01   +4.862220240898851e-01   +7.588661368010776e-01   +1.657587026824406e-01   +6.673569722328546e-01   +6.868635555880822e-01   +8.970349663920323e-01   +1.144230962089807e-01   +8.093162480722956e-01   +3.068558346744251e-01   +5.985356749749132e-01   +5.444262684696625e-01   +7.697654070210928e-02   +3.137082372092341e-01   +7.372506918669238e-01   +2.720590429199986e-01; +5.648802177329635e-01   +8.131600318348472e-01   +3.849188945244773e-01   +4.512933854432407e-02   +8.621122466904587e-01   +3.205083023684038e-01   +4.716292322459666e-01   +5.172631643330416e-01   +6.981094862498162e-02   +7.276593534054897e-01   +1.865372425869685e-01   +2.802497784457561e-01   +3.970540018551327e-01   +5.347837181835889e-01   +9.127364156250316e-02   +5.991067058228836e-01; +7.612755538509151e-01   +6.930763801350464e-01   +4.256890206444605e-01   +5.047258973676574e-01   +3.161259819655098e-01   +2.319066605735766e-01   +4.133931750765120e-01   +9.384297423036810e-03   +2.742565182025589e-01   +4.025264038109134e-01   +3.577630000024236e-01   +6.650214647080235e-01   +5.967783118246032e-01   +1.802938670810760e-01   +4.004126102716509e-01   +8.369589015169365e-01; +3.376745977686210e-01   +3.825743747709940e-01   +5.409836973862204e-01   +6.750923890186967e-01   +5.866703784351266e-01   +2.621000698220228e-01   +2.295710591322294e-01   +6.287542102249294e-01   +4.531847729051268e-01   +6.766240815421020e-01   +7.304766309190558e-01   +1.433315041655288e-03   +7.219730101654974e-02   +4.269498655843953e-01   +7.434012805420761e-01   +3.965403506039574e-01; +6.667650001367608e-01   +1.892563243638181e-01   +5.424242346315171e-01   +7.720472883728785e-01   +6.463586076552397e-01   +4.975279968369947e-01   +3.588642105434171e-01   +4.755737066779513e-01   +3.561294567110060e-01   +3.374664875576568e-01   +2.361999018460996e-01   +2.469989874338682e-01   +7.390692189804675e-01   +8.953183343865071e-01   +3.386644674423300e-01   +4.630482197296252e-01; +3.723234407678617e-01   +1.502747228277201e-01   +4.300177884211356e-01   +3.327819555819228e-01   +3.422327851659601e-01   +6.304988796159710e-01   +7.295141843156318e-02   +8.433734208928159e-01   +8.659815961803305e-01   +7.022480460481472e-01   +1.002570498188549e-02   +3.902258854237125e-01   +1.241096692634701e-01   +2.197362132443222e-01   +1.820979796411241e-01   +7.988373351303234e-01; +5.641883646897511e-01   +1.097875743565495e-03   +3.612723922926425e-01   +1.034397666997634e-01   +1.767526440785692e-01   +7.153388629865087e-02   +7.808790813101758e-01   +4.366628130611362e-01   +8.485412169211237e-01   +5.874888755819577e-01   +3.709546796197302e-01   +7.878572576601349e-01   +3.419255848110141e-01   +8.620943805349548e-01   +8.499890900197317e-01   +6.740518465181069e-01; +3.035988154753710e-01   +1.454205443696972e-01   +1.477261551531896e-01   +4.720692166316110e-01   +6.107763933752397e-01   +8.493429693124026e-01   +3.528960926321837e-01   +6.954570525974539e-02   +8.883826338069604e-01   +2.529064944524485e-01   +5.260022304657876e-01   +5.687769133089285e-01   +1.035154893226874e-01   +8.153655684143662e-02   +1.133946279551958e-01   +2.288885700398701e-01];
L2I_L1I_iGABA_netcon = [+4.154675710194839e-01   +8.745080190865427e-01   +5.685663762085785e-02   +5.435329831543473e-01   +8.419662687814742e-01   +2.894305556850332e-01   +3.467741609669730e-01   +6.620547012733413e-02; +1.701831326211972e-01   +1.804201462134678e-02   +5.805154434047761e-01   +7.093837644827945e-01   +2.749731309189112e-01   +5.278970881749249e-01   +3.371367790466973e-01   +2.504712983357484e-01; +6.630518184657975e-01   +2.065864171047272e-01   +2.132061204758091e-01   +6.293816775839158e-01   +2.083403179555332e-01   +5.636994367772956e-01   +5.183311352741602e-01   +6.274059037144325e-01; +3.988743091213277e-01   +6.478247590988814e-01   +5.951130908870360e-01   +2.987537061020482e-01   +7.953749839622873e-01   +5.548466858984559e-01   +1.070238988768313e-01   +6.703950197571978e-01; +4.301844812767043e-01   +1.973753755060383e-01   +4.106093825778975e-02   +2.086285800767627e-01   +1.270148819308702e-01   +7.488742616682382e-01   +6.747508559216527e-01   +2.121636489502918e-01; +8.564282371326657e-01   +2.978367847634091e-01   +5.812140685465411e-01   +2.992999436025732e-01   +7.069197534036057e-01   +6.942263930155479e-01   +1.089529487442202e-01   +1.653271008799271e-01; +3.520904231084160e-01   +7.789992125978487e-01   +6.443483067927928e-01   +7.725463481208868e-01   +5.803679791454536e-01   +2.799107260406101e-02   +8.736755489882662e-01   +1.486945738788276e-01; +8.859101742980158e-01   +3.716971495689756e-01   +4.161508789296728e-02   +4.923582029092280e-01   +4.768753252245139e-01   +2.347038506544198e-01   +7.309032771565953e-01   +1.274152161240530e-01; +5.114192811404032e-01   +2.256136066417990e-01   +2.853123263012668e-02   +1.007265819876308e-01   +1.876547838226128e-01   +5.313454490439255e-02   +7.074679453153438e-01   +2.203231942154788e-01; +2.508069793917593e-01   +3.923045915803939e-01   +3.766865480351016e-01   +1.179334517974933e-01   +7.573768575406475e-01   +6.137516726635620e-01   +1.283103547381991e-01   +2.488148952960061e-01; +2.622165895945023e-01   +6.902397079463197e-01   +1.238491629001080e-01   +6.340270476638780e-02   +3.945046227471554e-01   +2.558825124638230e-01   +2.129647878950642e-02   +8.987537304242286e-01; +8.662493446782583e-01   +3.267765772110541e-01   +2.817884122709997e-01   +8.654712386227850e-01   +7.364196167708189e-01   +1.865645898665693e-01   +3.047139176759695e-01   +1.361679770771254e-01; +8.620652437081154e-02   +4.566499874429777e-01   +7.066705766381332e-01   +5.587484898661071e-01   +5.943857584229808e-01   +6.070238153799454e-02   +2.646256968498632e-01   +8.902757821195965e-01; +3.033246699598358e-01   +3.070408630847116e-01   +1.208122114393840e-01   +1.957762896339673e-01   +8.735449798305974e-01   +1.079478485401765e-01   +4.701502644853128e-02   +4.979676551516505e-01; +6.978788207118164e-01   +6.607049251379911e-01   +8.538429976744262e-01   +6.876572725554621e-01   +1.071025537635358e-01   +1.095011372931043e-01   +1.752287671019031e-01   +1.840432375343624e-01; +6.488843139867183e-01   +8.187676835358453e-01   +6.255741781011567e-02   +1.916669617617821e-02   +1.942067195941100e-01   +7.143076562411480e-01   +3.161248347163788e-02   +5.739592275205212e-01];
L1I_L2I_iGABA_netcon = [+3.111848668205660e-01   +5.669366992287287e-01   +7.903440375775547e-01   +1.867193623045843e-01   +3.105202308722672e-01   +6.559367059928076e-01   +8.555951548817614e-02   +1.279487368606365e-01   +1.304378904975650e-01   +6.608108824690302e-01   +3.400869622553235e-01   +4.810874609915056e-01   +6.980697784903309e-01   +7.390685906638383e-01   +7.124582667440604e-02   +4.129263189053519e-01; +2.927683735449347e-01   +3.151828514383473e-01   +2.097680241308348e-01   +3.575377645625945e-01   +7.752420934293592e-01   +1.622140442095471e-01   +5.361182302026893e-01   +1.932695406565882e-01   +4.454292499768187e-01   +1.500840228348252e-01   +8.453768977286865e-01   +6.070319888631859e-01   +9.040186684123086e-02   +1.966172118765013e-01   +5.984518860195680e-01   +5.533879528728962e-01; +4.744700523454491e-01   +2.696939786963565e-02   +1.552615753208291e-01   +8.854140881558804e-02   +3.201439975837204e-02   +1.618886948097342e-01   +7.170400448571663e-01   +2.871312031681270e-01   +5.542123008011263e-01   +4.648848467007737e-01   +6.090222740169947e-01   +3.647930576804314e-01   +6.270958891081241e-01   +5.431140312901296e-01   +4.000345221498367e-01   +4.591832679016120e-01; +5.188722426303415e-01   +9.417592283097725e-02   +3.707842805380027e-01   +9.093000383721118e-02   +5.156738810915101e-01   +6.450913118864426e-01   +5.765241293411634e-01   +3.160679022143481e-01   +5.554552900881130e-02   +6.906468376040981e-01   +9.599982249174040e-02   +7.059998258940476e-01   +4.419882440847752e-01   +5.665372199498191e-01   +1.421645951384709e-01   +8.636329788199701e-01; +1.032017570492662e-01   +7.741523190144226e-01   +8.677031510020285e-02   +5.477600700844503e-01   +3.085292151361176e-01   +4.057786839307216e-01   +4.869969185087515e-01   +5.871504717883457e-01   +4.789753241290274e-01   +6.288408019574490e-01   +4.035563643101329e-01   +5.646261994890228e-01   +2.228347012000491e-01   +7.096980861645760e-01   +8.374907586186748e-01   +2.537371026557022e-01; +1.351619257166221e-01   +4.905351331876684e-01   +8.289093773953262e-01   +7.209737678201792e-01   +6.319435173919397e-01   +8.012700403460428e-02   +3.883575001711422e-01   +1.157249924600451e-01   +1.770488576809288e-01   +3.165954510269363e-01   +1.958587386661091e-01   +4.392663239520581e-02   +8.161971405281971e-01   +4.828372830527079e-01   +7.675416982551798e-01   +3.393597219744711e-01; +5.420900982198549e-01   +3.071888071683193e-01   +1.282089329550017e-01   +6.907097491536359e-01   +1.136506698781616e-01   +5.814221107386942e-01   +2.819676209502843e-01   +6.040711891462940e-01   +4.178245288615385e-01   +7.990331167192191e-01   +7.281874051763467e-01   +3.298733178647267e-01   +5.653794551555282e-01   +5.271593777265734e-01   +5.746434375785869e-01   +2.391625603078838e-01; +4.416395420849266e-01   +8.478386459274299e-01   +1.981449559922861e-01   +8.322444342967084e-02   +5.805065056994724e-01   +6.683139444955126e-02   +5.316630835337547e-01   +2.314912527798628e-01   +5.238210792083466e-01   +2.195645039974456e-01   +8.038766035145885e-02   +4.622432515607115e-01   +7.237644025028324e-01   +2.628899763614664e-01   +6.910750578917192e-01   +3.424276625024213e-01];
L2E_L1E_iAMPA_netcon = [+8.158539680692217e-01   +7.648260595952641e-01   +6.887867852889550e-01   +8.626746338980011e-01   +7.365239023790146e-01   +6.529894935559679e-01   +5.252084565394714e-02   +8.886245943690331e-01; +4.408450516535694e-01   +1.160540626460423e-01   +2.267100580640065e-01   +1.881819620519042e-01   +3.462322293424263e-01   +3.569820798107451e-01   +1.294013080333896e-01   +2.754887084522777e-01; +1.384253561752297e-01   +6.035014871518050e-02   +4.922991642519884e-01   +4.412563770013792e-02   +6.358247995162978e-01   +5.357991432621978e-01   +7.195758327847617e-01   +8.932572206216396e-01; +6.505312111583219e-01   +4.674449253613956e-01   +8.936524759216858e-01   +8.607409225485804e-01   +7.858481899301241e-01   +5.141545580774061e-01   +3.454416749007050e-01   +1.178522744737690e-02; +7.168076072732110e-01   +5.162418230353389e-01   +4.666662284481933e-01   +5.954185530334193e-01   +4.214686787575401e-01   +8.223188540068990e-01   +7.540542431759713e-01   +3.154197097943505e-01; +5.242172583886874e-01   +8.948603228227106e-01   +7.418834832505851e-01   +2.202486499880493e-01   +3.550179427497575e-01   +3.899333439445900e-01   +2.698033268102134e-01   +7.695372399110625e-01; +2.461654466595579e-01   +6.581653115249203e-01   +7.670424017350335e-01   +2.368531139194957e-01   +7.826845868087735e-01   +4.477754041180295e-01   +2.220568239565301e-01   +2.434503234746403e-01; +5.492561939263996e-01   +7.973108219842880e-01   +7.210493098669915e-01   +8.912383553736687e-01   +4.538171640825623e-01   +3.610736902429058e-01   +8.307829946739087e-01   +2.663377515390816e-01; +4.753363497775288e-01   +5.066879671974945e-02   +2.941998411004805e-01   +3.634394335903805e-01   +3.942537781440810e-01   +3.678474669900622e-01   +7.049766242688594e-01   +1.370258835099042e-01; +8.288010636982946e-01   +6.110846402552814e-02   +4.418293619500210e-02   +7.425164695054968e-01   +7.283864909295946e-01   +7.099778052721057e-01   +5.478041879304499e-01   +2.757593448228137e-01; +6.635633771089842e-01   +7.896826424843078e-01   +1.818141875363722e-01   +4.906211237176289e-01   +3.367999880927994e-01   +3.828323650327293e-01   +5.301948234553351e-01   +6.605013971720726e-02; +5.130382297237173e-01   +6.979973754817549e-01   +8.909242521945816e-01   +6.309664168478758e-01   +4.709915828248969e-01   +6.988588667270268e-01   +3.892804051488644e-01   +7.458265975426996e-01; +1.026016737527287e-01   +8.681603734340601e-01   +1.619011824156757e-01   +5.705000760489442e-02   +5.148817100545469e-01   +8.094301814344524e-01   +2.514407404577508e-01   +5.876436349272450e-01; +8.788595555993820e-01   +6.737047475436083e-01   +5.190770758982645e-01   +3.659614911673129e-01   +7.995666155762525e-01   +6.888445160768041e-01   +4.461139746538391e-01   +5.239215961956801e-01; +3.175988195140482e-01   +6.350600524926809e-01   +5.294958107324175e-01   +6.737211307621234e-01   +4.091130258175389e-01   +6.389724571681126e-01   +5.598295271047144e-02   +2.314218016442968e-01; +4.690615099863938e-01   +3.311630075819710e-01   +2.494973949973259e-01   +3.764121975439509e-01   +5.845510235077980e-02   +6.053120785061219e-01   +4.155902850035327e-01   +1.440091973499719e-01];
L1E_L2E_iAMPA_netcon = [+3.560163236481977e-01   +5.571537217798970e-01   +6.803849409465018e-01   +8.180690090382985e-01   +7.328653766998158e-01   +8.497732295226876e-01   +5.615547664589949e-01   +7.168078786146816e-01   +4.549156404328147e-01   +4.663800823282904e-02   +2.703736126985422e-01   +6.484186049826594e-01   +4.319528499227563e-01   +1.441478068179196e-01   +1.345719574932391e-01   +2.745566026408511e-01; +4.834215872761048e-01   +4.240336782951937e-01   +5.444738088000725e-01   +3.685021851989642e-01   +8.864869975591648e-01   +2.366182566607535e-01   +3.868732100593395e-01   +4.860437611065219e-01   +5.438559781100279e-01   +7.201633835312641e-01   +8.758604147202014e-01   +2.432950139773394e-01   +1.740366043310400e-01   +1.626695832909275e-01   +6.581998325344141e-01   +1.579698028439224e-01; +5.382870476603232e-01   +8.152743692849010e-01   +2.888011729465114e-01   +7.788967769730111e-01   +1.361677624466040e-01   +4.804255039223383e-01   +4.503677932749659e-01   +4.823459905843442e-01   +8.708486767772343e-01   +6.522798049528015e-01   +5.440421873541842e-01   +7.923032567752660e-01   +4.736494061506158e-01   +6.002924298385774e-01   +5.021910050139635e-01   +7.661326861529424e-01; +2.351853310347496e-01   +5.326015088545898e-01   +5.653002800554593e-01   +1.273708364570693e-01   +3.903591078574457e-01   +9.251198440716506e-02   +6.476315584486472e-02   +1.086926376116821e-01   +5.196032820566711e-01   +5.695575851145493e-01   +4.661078442406934e-01   +4.140064267274826e-01   +3.310353167678917e-01   +9.680409148603027e-02   +8.601961978986549e-01   +6.133683009479696e-01; +2.551916929761199e-01   +4.674549841628629e-01   +6.236766972322274e-01   +7.036867726115446e-01   +8.512097933488262e-02   +2.148209449324371e-01   +3.046168118937483e-02   +1.500175752122432e-01   +7.537708463808527e-01   +4.512920386335374e-02   +3.354732363746109e-02   +1.844906561401229e-01   +4.051748189939811e-01   +8.718520869674878e-01   +4.947184381765957e-01   +8.870367473342341e-01; +1.965986704925167e-01   +3.678527962334244e-01   +5.295663486699197e-01   +6.216796967077861e-01   +2.843474137931115e-01   +2.744717630363675e-01   +2.277788317024443e-01   +8.896410540018813e-01   +6.910026867832435e-01   +4.488536398426529e-01   +8.458454378973072e-01   +6.366747589624273e-01   +3.675069863224497e-01   +2.887797333474162e-01   +2.569899887297165e-01   +2.314514866879954e-01; +7.734960669643705e-01   +2.225854209104186e-02   +7.937871552778334e-01   +4.222745746875372e-01   +5.816402852958479e-02   +8.332663444412878e-01   +3.665253498153125e-01   +4.425694772980039e-02   +7.683464799910475e-01   +4.633667155180002e-01   +4.662405092772663e-01   +1.687745617968367e-01   +6.568020969867788e-01   +5.772573508964904e-01   +2.489034403509567e-01   +8.813815821427753e-01; +7.900182841614266e-01   +3.680270229010806e-01   +7.526170741767333e-01   +3.403516791932002e-01   +2.254871744169053e-01   +4.003761823621382e-01   +7.184907438639619e-01   +6.462248564224274e-01   +4.705195568962945e-01   +3.063529920974564e-01   +2.156455765027829e-01   +4.714016917413035e-01   +4.814435655311992e-01   +3.174997906555038e-02   +3.145482263457487e-01   +1.551642755621139e-01];
L2I_L2E_iAMPA_netcon = [+6.710746932062062e-02   +1.087974517980010e-01   +5.830829736574542e-02   +1.196043518364220e-02   +5.218415460402150e-01   +8.078280649894625e-01   +8.245484896787728e-01   +8.914717805950446e-01; +7.176437860703828e-01   +3.926876171366713e-01   +3.760727383491621e-01   +5.418732319978184e-01   +5.348476662456481e-01   +5.029864637357310e-01   +3.850555301496444e-01   +4.698790969333995e-01; +1.056385238514966e-01   +5.024758140133596e-01   +1.117286562254173e-01   +5.835586509145049e-01   +2.385586897015697e-01   +5.748730222657709e-01   +6.518207134782089e-01   +1.049137487541344e-01; +3.272894203714138e-02   +5.602518707834546e-01   +8.029983817382026e-01   +7.805354312443300e-01   +4.659306702752615e-01   +6.233189102559635e-01   +4.923420220649327e-01   +3.318575841100612e-01; +7.503704167459704e-01   +5.461931912991057e-01   +4.389272362365920e-01   +6.932562656164486e-01   +7.667161307009209e-01   +6.885998296575542e-01   +4.193284131907333e-01   +5.981438717236424e-01; +6.267085073326283e-01   +2.209663539281524e-01   +5.643571045852135e-01   +9.831072983981134e-02   +2.530392232315127e-01   +6.674693915899762e-01   +8.038383071125750e-01   +2.695749935297105e-01; +7.142518958672678e-01   +7.548141088329412e-01   +5.399791472814859e-01   +8.193636010092856e-01   +4.702056203046660e-02   +9.009232500458303e-02   +8.552581083902236e-01   +8.562182832273491e-01; +4.657386728430345e-02   +2.548616854491341e-01   +7.902770551585182e-01   +5.638072989328915e-01   +3.473277609711856e-01   +4.713511547816522e-01   +2.638869730279732e-01   +1.540545986690622e-01];
L2E_L2I_iGABA_netcon = [+6.445529440389167e-01   +5.685452618413828e-01   +7.149459042354167e-01   +1.968407092123450e-01   +2.438716860913673e-01   +3.858066868099080e-02   +5.733642001151704e-01   +1.466311916615417e-01; +6.076916892047257e-01   +4.353135508973337e-01   +4.901514990564580e-01   +4.171613699710743e-01   +6.205209871861478e-01   +9.420944865850854e-02   +8.310883555746679e-02   +2.384166359279012e-02; +2.727623420588293e-01   +3.157882415689397e-01   +1.373909245150719e-01   +3.768436533196480e-01   +8.723809165674226e-01   +6.797916205738114e-02   +8.093324331253358e-01   +3.933054289086149e-01; +8.984570908368575e-01   +1.182134011119136e-01   +5.431613672955511e-01   +7.020373651724970e-02   +7.874069252681875e-01   +2.965435832001779e-01   +7.698243482121606e-01   +4.309892302703864e-01; +7.597086053303387e-01   +4.205772549985257e-02   +2.928994994844293e-02   +1.565386162569517e-01   +2.939245180372717e-01   +6.491602979686398e-01   +6.178219863313128e-01   +5.107134505170199e-01; +2.839199249477358e-01   +1.630209728220497e-01   +3.454154911466188e-01   +1.461681052211441e-01   +6.704427009400914e-02   +1.180846933079112e-02   +8.564803514187185e-03   +2.214936919537767e-01; +2.335698849326466e-01   +7.709852635910704e-01   +7.481804894273785e-01   +3.539628267322004e-01   +7.847755505026027e-01   +4.226845690433801e-01   +3.808482845312601e-01   +4.711553515456035e-01; +1.157120029241665e-01   +6.394789991587150e-01   +4.647880701548008e-01   +5.677164528760498e-01   +1.865434620994761e-01   +2.013305992871931e-01   +1.244394061610787e-01   +2.781517631882692e-01];
L3E_L2E_iAMPA_netcon = [+4.299087829223420e-01   +4.876355688638760e-01   +7.584180100135198e-01   +4.271007491091913e-01   +4.119447329410174e-01   +5.701806454659345e-01   +1.659186032946249e-02   +4.249744199173778e-01   +5.671067285414771e-01   +8.256676580348375e-01   +3.875979617678645e-01   +7.993763203783565e-01; +6.605133577047470e-01   +5.357949714875365e-01   +2.235656299138033e-01   +3.140353015623696e-01   +4.262113902067895e-02   +1.073700757944002e-01   +1.957133499986558e-01   +1.052580124371056e-01   +2.369485417386404e-01   +7.898176938769278e-01   +7.540404542580983e-02   +1.243956868087368e-02; +7.007089594760354e-01   +7.346574687805190e-01   +8.840147764448798e-01   +7.905471329673297e-01   +2.843095101078700e-01   +1.595967137673094e-01   +5.871170283871415e-02   +3.181341516847249e-01   +4.121443496898627e-01   +1.296635603704197e-01   +5.096101072977015e-01   +4.445372899946725e-01; +3.344584538302574e-01   +6.346123833684976e-01   +3.781192938211210e-01   +6.160296013466777e-01   +4.940604506017326e-01   +4.470190310537289e-01   +4.593796149578422e-01   +3.857023561030883e-01   +1.828526378080444e-01   +5.327011564990871e-01   +2.872508800334199e-01   +6.036271477507784e-01; +2.941873687643744e-01   +2.271997446889403e-01   +5.836855740791219e-01   +8.463666241494361e-01   +5.654426497826555e-01   +3.660570101571393e-01   +1.556863144518437e-01   +6.741012744041524e-01   +6.749115821869333e-01   +3.574242631609140e-01   +1.752250357312459e-01   +8.691739634378054e-01; +2.488224258598776e-01   +3.704457678850261e-01   +5.202881721725335e-02   +4.440210377778614e-01   +3.482284649354965e-01   +5.818803566774328e-01   +3.862626515887724e-01   +7.487659091454373e-01   +1.546095169178802e-01   +8.780530779975861e-01   +7.164468623517452e-01   +2.154725602825571e-01; +7.114166697107891e-01   +7.984535652563104e-01   +4.326688027091277e-01   +8.983744137390538e-01   +7.703800615733617e-01   +8.322457408595443e-01   +5.831221748537664e-01   +4.090387856239244e-01   +6.456826231859682e-03   +1.096323714991877e-01   +1.445809842301856e-01   +3.142206729968079e-01; +2.567717305506737e-01   +3.002539402719644e-01   +4.731753547041786e-01   +6.100453380745505e-01   +7.124934962461617e-01   +7.165308871010947e-02   +3.633889637626388e-02   +8.283755884999695e-01   +4.296519257419767e-01   +6.976815589260781e-01   +2.990868344177933e-01   +3.207567506764417e-01];
L3I_L2I_iGABA_netcon = [+7.237478233224925e-01   +6.076306006133519e-01   +5.497129007282668e-01   +8.144554022274827e-02   +5.078632197200355e-01   +2.353895657977208e-01   +4.378102458385581e-02   +8.097528963197008e-01   +2.057150398190496e-01   +3.801254360525165e-02   +6.401913721461304e-02   +5.577850701209832e-01; +6.053497625245344e-02   +7.779377991302074e-02   +2.974777352612812e-01   +5.305063271683882e-01   +7.197298625216204e-01   +4.975901379328099e-01   +3.152997506654236e-01   +8.062965784431851e-01   +6.968054564232914e-01   +4.795524786581516e-01   +8.931546510604976e-01   +2.616072626364167e-01; +4.455836860827582e-01   +2.272902580538306e-01   +5.877407653856373e-02   +3.980640009553108e-01   +6.828560995869517e-01   +4.331246007497323e-01   +4.799346758590049e-01   +3.258435386545828e-02   +5.877168594855370e-01   +1.257827083191703e-01   +3.041692610543084e-01   +4.810474241433532e-01; +1.607837140439448e-01   +2.224570051650785e-01   +7.488337848845750e-01   +4.451054087332230e-01   +6.252173458722390e-01   +6.091529942915985e-01   +2.664507018211008e-01   +1.894077811096832e-01   +2.859813248464595e-01   +4.496109284085884e-01   +3.665791751231557e-01   +4.213946043206972e-01; +4.131369483856659e-01   +2.702868148933418e-01   +8.119762902410310e-01   +8.013913441416985e-01   +1.005076950928969e-01   +2.256226521827993e-01   +6.594328472877533e-01   +6.150234859783564e-01   +2.082580499869304e-01   +5.128853603037824e-01   +2.857398436799333e-01   +2.143444731525334e-01; +1.240710953040560e-01   +8.848204462731567e-01   +1.758395347211966e-01   +7.063050641207147e-01   +2.953819708907641e-01   +7.324252192320397e-01   +6.321733368423127e-01   +8.679972913708514e-01   +5.811740329053393e-01   +7.934353015337612e-01   +8.813764998231148e-01   +1.025016560686611e-01; +7.105984741254059e-01   +3.082920705399385e-01   +4.168987679887424e-01   +2.854341970283991e-01   +1.381882685905543e-01   +3.408066759478622e-01   +6.889455407308744e-01   +6.822644504269383e-01   +5.055777339101720e-01   +1.205889877910487e-01   +3.020123813760600e-01   +2.421990943452748e-01; +2.396263421647036e-01   +6.955568818839317e-01   +5.723623841750902e-01   +8.756682229384183e-01   +7.946255532760146e-01   +7.254513939161579e-01   +1.601239783270020e-01   +4.209826607635989e-01   +1.503467191147544e-01   +4.177715745273508e-01   +8.611591372414146e-01   +6.506479597673426e-02];
L2E_L3E_iAMPA_netcon = [+6.208148121548429e-01   +1.197001425385598e-02   +1.491782703450463e-01   +5.505636400043050e-01   +4.522351135151423e-01   +5.350278394541955e-01   +6.392740363646580e-01   +3.794931822160225e-01; +8.692992693259157e-01   +7.446823878206406e-01   +8.471128234327902e-01   +5.628481562252210e-01   +5.246408526531263e-02   +6.403611993089114e-01   +3.848369211193822e-01   +8.142643799809632e-01; +4.657545411601510e-02   +6.278784840333576e-01   +3.830003144310575e-01   +5.116312834478817e-01   +6.634017262035168e-01   +1.560492817450704e-01   +1.325138433588760e-01   +4.090762037217074e-01; +4.535927776859980e-01   +5.242446015575889e-01   +2.408313035915496e-01   +2.778459119954406e-01   +8.599571682426470e-01   +4.316047668197748e-01   +7.714851118691496e-01   +5.379043406538764e-01; +3.286883989102252e-01   +8.366592811679603e-01   +6.301616376516866e-01   +5.462601666747461e-01   +2.246542123388245e-01   +7.669048488025585e-01   +2.056548033932074e-01   +4.669442375692876e-01; +8.313369104573357e-01   +7.783762054009530e-01   +2.994059612111080e-01   +2.228904489099021e-01   +9.920024788343228e-02   +8.175566901115163e-01   +4.482710511677883e-01   +1.342918650264002e-01; +3.702572506022576e-01   +6.066321171610833e-01   +4.589467439428921e-01   +5.290159800497695e-01   +6.149158435933856e-01   +8.623989661246038e-01   +2.913143211644206e-01   +9.143187269457695e-02; +4.687127001690404e-01   +2.972703815279695e-01   +4.044320563095499e-01   +3.401986870596767e-01   +6.587387520365917e-01   +4.032539122023749e-01   +7.125819848022157e-01   +4.980679920250863e-01; +6.308453067656530e-01   +5.469136018360076e-01   +5.455316239947448e-01   +2.151037559830772e-01   +7.015649430222595e-01   +7.648136448768983e-01   +3.558030076125102e-01   +3.502972688780636e-01; +5.459311192824817e-02   +3.712137793245507e-01   +7.495763168445628e-01   +9.758571366045377e-03   +1.388999834581558e-01   +8.645187659025277e-01   +5.212703761909697e-01   +7.934162070007128e-01; +8.827169392081861e-01   +7.820374395691637e-02   +6.652921286251771e-01   +1.494432789529007e-02   +6.020397010322275e-01   +5.179346177719215e-01   +7.145349473816942e-01   +7.749923843363230e-01; +7.264161651422135e-01   +7.360037882236665e-02   +4.163059626475602e-01   +2.467541227006811e-02   +8.079519852463392e-01   +7.943009757120113e-01   +3.478009443670566e-01   +2.002443070199276e-01];
L2I_L3I_iGABA_netcon = [+1.737737416384093e-01   +7.758018537669563e-01   +4.434989345549094e-01   +5.231878628991433e-01   +5.871067137894271e-01   +4.570616595316290e-01   +5.584051440503108e-01   +8.478451542816746e-01; +1.392123950310575e-02   +6.922673129824088e-01   +9.039337376619290e-02   +1.193432635882707e-02   +8.760830584596668e-01   +8.062136045504551e-01   +1.989920948378694e-01   +2.932213351467062e-01; +8.140163789186855e-01   +1.998308367550342e-01   +5.131051423224553e-01   +6.800698662677532e-01   +2.887353494392613e-02   +4.167925321375376e-01   +1.326474578879436e-02   +8.982876836971224e-01; +3.306567170257091e-01   +1.657529871270487e-01   +8.128025289997364e-01   +8.188967291746232e-01   +8.962288847424172e-01   +8.298251275305923e-02   +6.189746541377990e-01   +6.883061473579661e-01; +3.457883801830898e-01   +2.187542321528078e-01   +1.184305382669508e-01   +3.144943146961485e-01   +4.619267419307245e-01   +1.905344629179252e-01   +8.409408645295607e-02   +7.216176477097810e-01; +4.317776397361773e-01   +6.332065250444125e-01   +7.201305789617191e-01   +1.254581027903712e-01   +5.407546229851452e-02   +6.309227324321456e-01   +8.306800713456433e-01   +7.072789207500524e-01; +3.470378412761141e-01   +7.559861847135928e-01   +8.437114095239308e-01   +6.742880544263199e-01   +2.472576108086630e-01   +7.121008539076014e-01   +7.065171318290446e-01   +1.473774973836685e-01; +1.429075015305372e-01   +2.331225973782153e-01   +3.063056117977392e-01   +6.784305583429372e-02   +4.299216349689640e-01   +5.899546595872762e-01   +4.876624730596272e-01   +6.433578011543507e-01; +2.853632494381660e-02   +1.542636140643251e-02   +1.289130297890902e-01   +5.478317103311293e-01   +3.029480205342214e-02   +5.929283682120469e-01   +1.057851986161918e-01   +6.792102686900127e-01; +5.255552922246330e-01   +1.219515377698160e-01   +9.313964127718749e-02   +3.128435677719629e-01   +1.565866929269862e-01   +5.351311527685387e-01   +1.066689957638374e-01   +4.679116727545247e-01; +1.589654485429487e-03   +8.698904700983067e-01   +3.038333017006036e-01   +3.182936079338190e-03   +9.799614893567594e-02   +2.473019767535663e-01   +8.357990837956154e-01   +1.983955411573745e-01; +3.163117637455949e-01   +1.359088981447695e-01   +8.624527060626705e-01   +4.046500494464499e-01   +5.533515011084555e-01   +9.520147247916513e-02   +3.385414294649672e-01   +2.501745702323481e-01];
L3I_L3E_iAMPA_netcon = [+8.978796038674637e-01   +4.876377506878454e-01   +3.159710460999292e-01   +8.470660924442758e-01   +4.929711351252224e-02   +2.333967491947813e-01   +4.311819902519317e-01   +8.385741819823266e-01   +6.507396637941083e-01   +1.168843327750002e-01   +3.040804728384124e-01   +5.648114564540246e-01; +4.838750964298771e-01   +2.767003225493620e-01   +6.860999839241591e-01   +4.628157257688563e-01   +6.032053234445047e-01   +6.969702903635002e-01   +8.263610056624174e-01   +1.109639555723942e-03   +6.237661858005830e-01   +4.534436082715559e-02   +2.727720237566061e-01   +3.252171445988591e-01; +5.880479711570616e-02   +8.047310843655234e-01   +4.218116828975987e-01   +3.421772388509775e-01   +5.053938584749723e-01   +9.591404245369063e-02   +4.044924896638183e-01   +1.224333922813983e-01   +2.398900425089655e-01   +7.506078379025140e-01   +2.416554417468849e-02   +7.329694850794284e-01; +8.253603164027782e-01   +2.125244359807532e-02   +1.850814361005285e-02   +4.386808632297674e-01   +3.993670319640892e-01   +6.218773974786417e-01   +2.516515912086269e-01   +2.959654158161690e-01   +5.273619593379753e-01   +1.301811308989234e-01   +7.430185018402733e-01   +3.195610263284708e-01; +6.677340853032482e-01   +2.725931871319658e-01   +2.926441917468695e-01   +2.463419827904618e-01   +6.076867939909234e-01   +5.156380732632786e-01   +8.832674512383722e-01   +3.250570568370338e-01   +2.162026596431200e-02   +3.248421890240104e-01   +7.313865967964205e-01   +4.624981463358763e-01; +5.057273356504193e-01   +2.113439871474078e-01   +6.619568811599563e-01   +8.933654763364796e-01   +5.031002845522390e-01   +4.938471845373217e-01   +8.407598127605187e-01   +5.622176275204146e-01   +4.824423846219667e-01   +6.354487313186177e-01   +1.202320163632318e-01   +8.386645743917615e-01; +2.886948467968876e-01   +3.640044369550500e-01   +7.672771341851139e-01   +7.860522282898027e-01   +4.257722931608920e-01   +5.151334426030706e-01   +7.726461879109841e-01   +6.874945822724231e-01   +1.495857744634233e-01   +6.476831142429154e-01   +5.782172549901202e-01   +6.714692692609040e-01; +6.793003325187033e-01   +8.398676943468226e-01   +5.244778650107391e-01   +1.642125985442323e-01   +5.595521212981281e-01   +1.222464124858245e-01   +2.024431168461283e-01   +3.840310537199269e-01   +3.672393216806145e-02   +6.425932596962459e-01   +8.026603965100946e-01   +3.364637942920371e-01; +5.014182900644915e-01   +6.908707339436999e-01   +3.051600911914845e-01   +6.735804550550660e-01   +6.558133929599855e-01   +3.473845846383862e-01   +2.916564883961355e-01   +8.600897918237730e-01   +5.122761470463135e-01   +8.294412263285659e-01   +4.373820490102173e-01   +2.092384233639782e-01; +4.741764548896686e-01   +4.077779612631218e-01   +1.402560654362659e-01   +5.620522898734727e-01   +1.706906585692207e-01   +5.949283658305923e-01   +2.426111916996069e-01   +3.791711235545309e-01   +7.672158691675623e-01   +3.378337914468376e-01   +7.337840321148005e-01   +4.441720642027741e-01; +6.000160886992238e-01   +8.562147110491698e-01   +3.341989282104425e-01   +1.766734081245375e-01   +1.837182062333632e-01   +1.826531352897862e-01   +2.552010828918687e-02   +1.587499761896093e-02   +6.572275806459763e-02   +5.992403662276794e-01   +7.348411505855738e-01   +5.100294878139636e-01; +7.847667774899485e-01   +1.894271876838927e-01   +2.169401036011403e-01   +6.472867272617112e-01   +7.986835169932344e-01   +2.588835678217853e-01   +4.329972914213686e-01   +6.026072309673531e-01   +3.972242345569156e-01   +4.458463701259502e-01   +4.184602093451748e-01   +7.713763206998043e-01];
L3E_L3I_iGABA_netcon = [+3.095812562331876e-01   +4.704537224886686e-02   +1.970059848575592e-01   +1.413467980741239e-01   +6.865439822932194e-01   +1.581771904534112e-01   +1.451434383811410e-02   +8.103171306026893e-01   +3.413420602598039e-01   +3.748500612914901e-02   +1.782937135113588e-01   +6.121562858942772e-01; +2.975966675615539e-01   +5.416391742154995e-01   +8.869649101586323e-01   +3.208193883695826e-01   +8.797006108501589e-02   +4.696545915574849e-01   +1.918226983389380e-01   +5.000126571266735e-01   +3.346194398698957e-01   +8.697633111380549e-01   +3.215856791033196e-01   +3.290467816418548e-01; +2.438596515056437e-01   +8.447683105975933e-01   +2.501165829571527e-01   +4.267805892883055e-01   +4.095846835535864e-01   +6.435919384986437e-01   +8.176500015954692e-01   +5.968625288402864e-02   +1.517492470026792e-01   +2.485535012992706e-01   +5.862011804694902e-01   +7.550108760085976e-01; +2.071300724872699e-01   +8.047734938808895e-01   +4.092693342931950e-01   +7.044783625315583e-01   +2.489199201199321e-01   +8.418395390256803e-01   +8.827562280965618e-01   +5.514251456968483e-01   +5.225853851148032e-01   +3.374997579520913e-01   +5.950092602493456e-01   +4.990024987341395e-01; +6.921833130523943e-01   +4.725999633812400e-01   +6.473096434683708e-04   +8.497557117066703e-01   +1.228159845088006e-01   +4.329785969305613e-01   +7.779329054817921e-01   +4.718880909655269e-01   +3.833889177890220e-01   +8.621559099315782e-01   +4.146009580252622e-01   +4.379944475633515e-01; +8.462443773614895e-01   +6.009062467112747e-01   +4.204374531055428e-01   +3.136116295514619e-01   +6.614209370257658e-01   +2.127922422059413e-01   +4.236282596950157e-01   +7.260931020867309e-01   +2.486297341420919e-01   +2.190266287148324e-01   +1.056001601802447e-01   +6.323828807858686e-01; +6.687918625876309e-01   +1.527336180766521e-01   +8.556758660093960e-01   +3.503653334653724e-01   +3.009606408565174e-01   +5.984368221431986e-01   +5.710571923815511e-01   +6.829253157274888e-01   +4.746178918679051e-02   +8.535780422330037e-02   +1.832294026379603e-01   +2.523037486399947e-01; +2.455030650184267e-01   +2.825670853292379e-01   +5.049939664406807e-01   +4.415184338851044e-01   +8.039360292580446e-01   +6.112244881303951e-01   +4.902313361156548e-01   +1.930473916318917e-01   +7.435392821290058e-01   +5.305105572194040e-01   +9.698986332697182e-02   +4.367599616267385e-01; +2.788163937508492e-01   +4.663564142691066e-01   +3.966130447192187e-01   +2.656410912067462e-01   +7.300161286845701e-01   +4.598971305458571e-01   +1.361034094606741e-01   +6.392499090677995e-01   +8.493952217043671e-01   +1.883497827073714e-01   +2.034534565961005e-01   +7.483945397251118e-01; +1.356042575222968e-01   +1.455155967268568e-01   +3.940369727909797e-01   +8.848293393978919e-01   +5.154011786664701e-01   +9.728254790165899e-02   +7.531106689474938e-01   +2.643216290353225e-01   +5.493868661142818e-01   +6.417104998414292e-01   +1.262874007316712e-01   +5.875601807765691e-01; +7.751282686800869e-01   +2.558131100627342e-01   +2.740222668970738e-01   +4.177823382990584e-01   +2.823598277669793e-01   +2.972844051086388e-01   +8.925039458220611e-01   +5.941409548979132e-03   +1.778435582026271e-01   +1.827770784948491e-01   +6.509114454998514e-02   +3.970316223783488e-01; +2.418882352288082e-01   +4.944997495950463e-01   +1.211940262720337e-01   +4.489076915258363e-02   +8.720474059556491e-01   +5.912177266761155e-01   +3.901970542965587e-01   +2.721824720168451e-01   +9.720547969026669e-02   +3.602261817832610e-01   +7.898911907245582e-01   +1.630981291904815e-01];
L2E_Input1_iAMPA_netcon = [+2.244751292011251e-01   +5.346427297084168e-01   +2.043277957331321e-01   +1.218263421853922e-01   +5.535350718967946e-01   +1.898444597938440e-01   +6.513719797548205e-01   +3.834521094787854e-01];
L2I_Input2_iAMPA_netcon = [+8.894472587549379e-01   +4.450233044577513e-01   +4.539617138303890e-01   +2.193531588044652e-01   +1.333912707419368e-01   +1.226807396537277e-01   +6.599493882078623e-01   +5.180689242545423e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
