function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.921403732011461e-01   +9.093219618809080e-02   +7.466658590990222e-01   +1.366115842370644e-02   +2.217215395683667e-02   +7.202812805269900e-01   +2.314708078194379e-01   +1.794720804118412e-01   +3.279357252571460e-01   +7.368929787699942e-01   +1.359843220798125e-01   +3.451050494477691e-01   +1.455360475690613e-01   +2.413937446496998e-01   +8.193999167048567e-01   +2.103201594737764e-01; +7.932677414166315e-01   +6.387383345840172e-01   -7.787185802540050e-02   +2.841528895027445e-01   +7.840493323156246e-01   +4.583567854276407e-01   +2.104627079711617e-01   +4.214268039160673e-01   +5.820172540431071e-01   +3.285645178812142e-01   +5.858507112756351e-01   +5.236267537498477e-01   +6.242620037214871e-01   +8.826254605311544e-01   +2.571034716872910e-01   +2.523380247781668e-01; +4.514365791783547e-01   +4.614150856158202e-01   +2.986767397501540e-01   +5.762302253597641e-01   +5.304199106190224e-01   +1.280418728776520e-02   +1.696140590556260e-01   +3.202645236576229e-01   +4.339962736634507e-01   +4.160139451418655e-01   +1.689674518273911e-01   +5.627901760731722e-01   +5.471484395073865e-01   +6.755469161886603e-01   -1.126212783328477e-02   +5.227956336372801e-01; +7.022423474584490e-01   +6.005903686620234e-01   +6.888184753191114e-01   +9.513995874312607e-01   +8.377853438690546e-01   +1.597408976323896e-01   +7.858805185787777e-01   +9.310028061972516e-01   +7.458797110766925e-01   +4.640743421700815e-01   +1.904507593206165e-01   +3.946105053004435e-01   +1.527226974980553e-01   +3.356795140938191e-01   +3.713727421189822e-01   +4.242300951489330e-01; +5.712728049968582e-01   +6.956232015513474e-01   +4.163075413864442e-01   +9.611032800259200e-01   +2.268018258230253e-01   +1.028700626615220e-01   +1.595862100533374e-01   +8.212896035946987e-01   +7.375384020442668e-01   +8.591130902222583e-01   +1.000000000000000e+00   +1.530346231012095e-01   +8.556536996025310e-01   +6.475049024906328e-02   +2.822227192411536e-01   +3.102938677508233e-01; +2.838715616178977e-01   +2.730375391842909e-01   +3.413263332320589e-01   +7.809706272272967e-03   +2.027937174861121e-01   +9.097532655362850e-01   +8.714349408581608e-01   +4.460391057494660e-01   +1.562148102061804e-01   +7.080624221404660e-01   +1.174743131538476e-01   +9.883600929414651e-01   +3.271423875511754e-01   +2.390357589326730e-01   +4.563315907977761e-01   +5.364063174814213e-01; +5.006167769105544e-01   +9.905994140398611e-01   +1.814787357263128e-01   +7.621681371487893e-02   +6.590336880064463e-01   +7.747108175199756e-01   +7.123708994454195e-01   +3.567664354643085e-01   +2.047166879437970e-01   +5.888477964609515e-01   +7.451063628578191e-01   +8.297244431405815e-01   +4.122632536102763e-01   +3.108794649570720e-01   +9.220827809897741e-02   +7.503541005186744e-02; +6.875747713236540e-01   +7.855242615135569e-01   +6.619500671678344e-01   +4.739517644316876e-02   +5.281651606838837e-01   +1.573041546631621e-01   +5.100520597974200e-01   +1.716516532750927e-01   +5.126178335056475e-01   +6.669312061715149e-01   +4.005860618222857e-01   +1.175867408461937e-01   +3.541939011249605e-01   +4.348608742910912e-01   +5.022208966641182e-01   +7.794832926494615e-01; +1.046273246053403e-01   +1.943512745188414e-01   +2.639337599478914e-01   +7.747605947642991e-01   +9.059978679441750e-01   +5.018942482734168e-02   +5.970254322771318e-01   +4.523392949046493e-01   +4.431674416469656e-01   +8.218826531056136e-02   +7.148816014586787e-01   -2.984175911528790e-02   +1.544921639654452e-01   +1.812036820185960e-01   +3.349985154778541e-01   +1.026946645845861e-01; +5.797763042003244e-01   +7.495945464359446e-01   +3.668768434032568e-01   +5.383864246652121e-01   +7.295378625717235e-01   +7.963042469947065e-01   +3.818983888871286e-01   +4.607631747174857e-01   -2.184741171621653e-03   +2.990692622732828e-01   +1.898465625777294e-01   +8.020822119818799e-01   +6.431406283979284e-01   +5.696365709462929e-01   +2.975381958069591e-02   +4.690180404004168e-01; +4.678644934552139e-01   +6.792094783309141e-01   +2.921751411828400e-01   +8.692983588272154e-01   +4.729213894864249e-01   +4.788809320192443e-01   +6.706155050676901e-01   +8.721792667539453e-01   +6.759099776301402e-01   -2.370293391458600e-03   +3.622041284630798e-01   +9.134616392709886e-01   +3.855033431644304e-01   +5.724825463203860e-01   +3.036020484912352e-01   +2.567036753145036e-01; +4.717050957728491e-01   -4.101553584009040e-02   +7.082024158967520e-01   +5.667994676376501e-01   +4.779480836110587e-01   +8.879642907503256e-02   +4.238667833115957e-01   +2.141296392644635e-01   +1.066025908093156e-01   +4.620449850985248e-01   +4.375191294956037e-02   +1.165798052958514e-01   +9.278894980138920e-01   +5.444403617564333e-01   +7.475078804580741e-02   +2.508147326996653e-01; +4.532790821942995e-02   +4.510651854247491e-01   +9.609067934620393e-01   +8.460658176858689e-01   +8.272817168615545e-01   +9.146424098181953e-01   +3.368253186710294e-01   +5.627328928546820e-01   +1.574706847638006e-01   +3.115825877061265e-01   +4.088284779303129e-01   +5.612042876975432e-01   +4.992334406690884e-01   +9.028878712879176e-01   +6.828547584407271e-01   +5.410042702972866e-01; +4.208166752459455e-01   +9.137372359478739e-01   +7.279719776067993e-01   +7.201834587538297e-01   +8.886241186940994e-01   +4.903495793672714e-01   +1.645426231466223e-01   +3.765533100855736e-01   +8.104240672528483e-01   -1.852628474575779e-02   +6.448727732047703e-01   +1.363071496635575e-01   +6.384181960876578e-01   -6.629931898380009e-02   +1.630548778024717e-01   +4.316964956006585e-01; +3.248433146961074e-01   +6.755165722199172e-01   +5.824561554404759e-01   +5.011771738212791e-01   +6.966723161470384e-01   +9.229444690127795e-01   +1.071486319129156e-01   +4.902465417656672e-01   -8.280594183894682e-02   +5.495720040344831e-01   +2.713294668854949e-01   +7.814573891444230e-01   +9.412456939749813e-01   +8.994340468430896e-01   +3.735041953630928e-01   +3.739123249358434e-01; +6.784002589485737e-01   +1.714167716656088e-01   +9.281846887742971e-02   +3.576468647077636e-01   +4.012909750073421e-01   +3.967804578508957e-01   -4.054679638680347e-02   +3.089444722075566e-01   +5.391708985126068e-01   +6.636108481352844e-01   +7.338484851732107e-01   +4.226951262153012e-01   +6.426228213992956e-01   +1.251516404879108e-01   +5.718145443762237e-01   +4.752704473076022e-01];
L1E_L1I_iGABA_netcon = [+7.969558604827963e-01   +6.310131942325841e-01   +6.720443794837795e-01   +2.729896720723353e-01   +5.907945845350148e-02   +4.634051273278283e-01   +5.406147981879198e-01   +1.832435962462307e-01   +8.168937948088911e-01   +6.979219507477017e-01   +5.361308910396313e-01   +3.946064707394321e-01   +9.983929038413268e-01   +3.150879551555382e-01   +4.378522533854894e-01   +1.151716333031919e-01; +7.392624443392137e-02   +3.389250050170247e-01   +7.252122714658267e-02   +3.201333795457706e-01   +1.077274742646558e-01   +5.370816246421104e-01   +2.526953521115215e-01   +8.426093332931572e-02   +7.470464043491317e-01   +4.931746921039276e-01   +5.570846459054577e-01   +2.040074254232091e-02   +6.426921366535978e-01   +4.904528728509167e-01   +2.001705827727057e-01   +3.792839025707526e-01; +8.098226841914608e-01   +6.344884850672651e-01   +7.729812982072150e-01   +2.508587583804399e-01   +7.702052757428630e-01   +7.420052769164185e-01   +4.704784270832524e-01   +1.112562310034115e-01   +6.602503453804932e-01   +4.753627642274237e-01   +7.252294813770187e-01   +9.269633243395574e-01   +7.104428068863198e-01   +2.835665386303396e-02   +3.027044804595306e-01   +5.088867205392522e-01; +3.579409454598228e-01   +2.032028082170865e-01   +1.972911320683873e-01   +4.557349707790404e-01   +8.114077629810407e-01   +7.308397547645327e-01   +7.884266920985110e-01   +4.560838768296944e-01   +9.717346075583325e-02   +8.430905363919555e-01   +1.262080990503103e-01   +2.989868964410772e-01   +7.431956394837463e-01   -4.699310064774304e-02   +5.412640936524615e-01   +4.532853516224969e-01; +1.790585118394734e-01   +2.644546314830220e-01   +2.738850517107349e-01   +4.433344635665379e-01   +1.723245134634665e-01   +6.649273794578824e-01   +7.567347386433759e-01   +9.099555466246154e-01   +2.279420448352138e-01   +4.018651265493193e-01   +7.083973473051239e-01   +9.193000520309731e-01   +3.896718945131001e-01   +4.475951839265970e-01   +6.483409177737606e-01   +1.329391162392721e-01; +6.550355048127653e-01   +4.662368715878599e-01   +4.317972156857304e-01   +7.498476066770086e-02   +1.836018087163460e-01   +3.227099427104602e-01   +6.914783144694060e-01   +4.162622542923352e-01   +1.380380939324464e-01   +7.583381297498136e-01   +3.867217856008091e-01   +1.952635743355596e-01   +1.893606564429215e-01   +6.657594502267526e-01   +6.083477474012724e-01   +8.154879018714567e-01; +1.813267012444610e-01   +9.774289246705633e-01   +1.918467813914650e-01   +5.273604836216730e-01   +1.979418946477226e-01   -5.623609230572664e-02   +8.594206189365076e-01   +5.015612894776237e-01   +1.275912557597181e-01   +6.101064810548202e-02   +3.244383153664401e-01   +3.547046790175715e-02   +2.470677937473506e-01   +3.313295056406674e-01   +8.239561723392090e-01   +1.884899229138160e-01; +1.915401037077699e-01   +1.000000000000000e+00   +5.482949982872858e-01   +4.263764041712904e-01   +5.418809851716566e-01   +6.856271590965459e-01   +3.599443163608720e-02   -4.212047544063285e-02   +6.512971290009406e-01   +8.066973765271662e-01   +6.666821737042687e-01   +1.653539206365175e-01   +3.739893130638434e-01   +5.592658290196312e-01   +6.402271458351747e-01   +1.638761840516443e-01; +3.978559992864373e-01   +1.338472580853235e-01   +6.854079166496582e-01   +8.963591140013898e-01   +9.397199059960115e-01   +9.278214903641831e-02   +9.795007279124293e-01   +4.902542091254648e-02   +2.175853555334802e-01   +1.081102405605825e-01   +3.965634160822814e-01   +9.344034962318991e-02   +2.512563169330858e-01   +4.345594116442978e-01   +5.678903487189038e-01   +2.813251317293383e-01; +2.264622770154254e-01   +8.139783511787468e-01   +6.518818412872115e-01   +3.178215144134995e-01   +2.460020103187649e-01   +7.685755521938249e-01   +7.901979823109249e-01   +1.997845093712277e-01   +4.133779391428932e-01   +8.220329194945487e-01   +4.738787579884771e-01   +6.783944378367619e-01   +5.683798090417571e-01   +2.907407644290710e-01   +7.161268424646682e-01   +1.905750359786902e-01; +1.448282608575134e-01   +7.102862521840458e-01   +7.464274128498170e-01   +6.859366808118520e-01   +6.724980738680849e-01   +6.303372325111159e-02   +2.730119410424840e-01   +5.372368595055785e-01   +8.115890739336128e-01   +5.348304373957430e-01   +7.067778414033626e-01   +8.163444242959311e-01   +5.622186156045710e-01   +8.069632127649379e-01   +1.020423405962598e-01   +5.770617904926107e-01; +7.187672414879823e-01   +4.383923804862992e-02   +3.114839502409305e-01   +8.586282921646710e-01   +5.318803263622507e-01   +3.166254295576534e-01   +1.611479877505023e-01   +3.200804536272220e-01   +1.908928882009358e-01   +5.296255667280577e-02   +4.334155748214303e-01   +4.880131674789160e-01   +1.756481829198203e-01   +3.484506238631489e-01   +6.967726141684556e-01   +7.383452307775834e-01; +5.759756285144603e-01   +9.160975060694979e-01   +8.755113253155710e-01   +8.464425345657267e-02   +4.488996286834098e-01   +9.134482268757964e-01   +5.352043068049988e-01   +6.692603785931572e-01   +6.049081002973484e-01   +3.411365399084219e-01   +6.988116587146554e-01   +1.044368892475947e-01   +8.833667956827396e-01   +5.187903738211188e-01   +3.731565379112541e-01   +5.889429635714282e-01; +5.510562679178551e-01   +5.588941391876331e-01   +2.819897585124966e-01   +6.774833511467996e-01   +9.991071567914507e-01   +9.836374224623347e-01   +7.270830523278756e-01   +1.632322998074870e-01   +2.652094090500060e-03   +4.261244261978008e-01   +1.537082278077345e-01   +8.958249144731202e-01   +3.034056777523456e-01   +8.712214313906841e-01   +8.653029908165601e-01   +4.795144695495924e-01; +9.133241851585626e-01   +8.160259322360439e-01   +4.201333808726229e-01   +3.178368894732341e-01   +6.112704322501855e-01   +4.326289360385241e-01   +2.046631950171719e-01   +2.371082174868595e-01   +6.449820221289156e-01   +3.398667842082283e-01   +5.223868119746558e-01   +4.557553796979250e-01   +8.294234342168995e-01   +1.643485933709821e-01   +2.667502513747638e-01   +1.057346362414494e-01; +2.463250577672478e-01   +3.864576916970688e-01   +7.085834991081756e-01   +1.478126420251205e-01   +2.010172984373066e-01   +6.416705510507804e-01   +4.069162273393046e-01   +7.584237811992738e-01   +8.321904500393374e-01   +3.668967773857080e-01   +3.218498194551023e-01   +7.564111905645725e-01   +2.258617980729563e-01   +2.592093717862894e-01   +1.807734237441206e-01   +4.843003710512612e-01];
L2I_L1I_iGABA_netcon = [+3.089871392965982e-01   +2.749715274444465e-01   +8.276930370625174e-01   -2.900319849119246e-02   +9.909212677147116e-01   +8.416214163329241e-01   +7.909672103666594e-01   +9.797293511867171e-01; +2.727702673601296e-01   +2.390167156510784e-01   +5.094358823313905e-01   +1.686366180918694e-01   +8.760422702204578e-01   +2.159806607570625e-01   +2.746087334609414e-01   +2.894377945947003e-02; +5.954948895076070e-01   +7.182378951945454e-01   +1.917741188693524e-02   +2.324763473963881e-01   +4.614066390044175e-01   +1.382455477779329e-01   +4.820896816690099e-01   +1.938881169761410e-01; +7.003813824537299e-01   +7.656363195422787e-01   +5.322765777931268e-01   +5.175598864497561e-01   +6.820324715294016e-01   +1.809618832418328e-01   +5.764611734772727e-02   +3.125322015080977e-01; +9.041051837271922e-01   +7.919708621516593e-01   +1.237388494736000e-01   +1.276650490560158e-01   +8.881446638145400e-01   +4.994092204585090e-01   +7.722285603097876e-01   +4.362834847283898e-01; +9.242903049334387e-01   +6.744446093022169e-01   +6.720392002506085e-01   +8.457130740895686e-01   +5.498289366887648e-01   +4.535156735794155e-01   +8.189907288314191e-01   +2.512155566530109e-01; +3.347285039052864e-01   +4.742086996663815e-01   +7.538811467390083e-01   +8.863910865574679e-01   +4.437048082898257e-01   -2.908165236783175e-03   +3.797711707730517e-01   +4.758192424885765e-01; +4.045617661082950e-01   +5.962981974246044e-01   +1.751282132473662e-01   +2.260982343367877e-01   +6.085004989885606e-03   +5.223648384850197e-01   +3.406374667061921e-01   +6.667630305904266e-01; +4.415623939580265e-01   +3.335120487870874e-01   +1.000000000000000e+00   +6.040338450789298e-01   +4.436047422040253e-01   +8.614987261899242e-01   +4.063109587263795e-01   +7.749664704947300e-01; +8.628471056119290e-01   +1.849222887843982e-01   +2.774641443653751e-01   +1.409094198076732e-03   +7.637232052165048e-01   +1.372772384045191e-01   +2.229048389895991e-01   +7.965203847089174e-01; +3.526900235435555e-01   +5.072602831785916e-01   +5.138861932364558e-01   +9.457806132668743e-01   +9.177566559457447e-02   +7.664032895326275e-01   +8.903102103460754e-01   +9.071380791346294e-01; +7.095809168582662e-01   +9.196266887942605e-01   -2.948836890641672e-02   +2.053186401372151e-01   +2.203439926007089e-01   +7.916114725891915e-01   +8.381527197803134e-01   +3.483204239281821e-01; +9.971540253354720e-01   +3.169227719996504e-01   +7.398976824838350e-01   +1.045746072603990e-01   +4.992415588911343e-01   +8.357028610049742e-02   +7.252601897314874e-01   -8.713264741905832e-03; +6.826509893887430e-01   -3.148526400696989e-03   +6.286329249944207e-01   -5.882498910320243e-02   +4.079674330389539e-01   +7.690038311420054e-01   +1.380150934024806e-01   +3.532919243115218e-01; +9.150380230841296e-02   +9.617371111817347e-01   +8.246618609254702e-01   +3.090248007879897e-01   +4.418477745653285e-01   +8.491388306563425e-01   +3.690179000415296e-01   +3.449370033268243e-01; +2.181885909768851e-01   +8.878347254916120e-01   +3.774810149412725e-01   +4.532784901084864e-01   +1.604917788513332e-01   +5.699267507609549e-01   +5.819994649675700e-01   +1.278692002412095e-01];
L1I_L2I_iGABA_netcon = [+3.265366021250089e-02   +4.406035261700951e-01   +2.486031903318148e-01   +3.261057990188976e-01   +5.779650180372107e-01   +2.268479650681149e-01   +9.137939081755431e-01   +1.983060462137900e-01   +1.674503419678853e-01   +6.486641593068629e-01   +5.351234374794324e-01   +8.031762612603220e-01   +3.126559067605756e-01   +2.970112697770887e-01   +2.755914644858450e-01   +5.530878979333784e-01; +9.012072814493354e-01   +3.850504308979359e-01   +4.953778837084833e-01   +3.180866147979249e-01   +9.181022874594191e-01   +9.501194328085358e-01   +5.887739432429013e-01   +3.318818041196467e-01   +4.752903199782375e-01   +6.611118475794221e-02   +2.878441783459534e-01   +7.795639413218929e-01   +5.492990365650148e-01   +7.999465674187364e-01   +3.196009816512626e-01   +8.150986767705490e-01; +4.227075211759478e-01   +7.277170657911666e-02   +2.309221266805373e-01   +3.761797914682856e-01   +1.703503448644521e-01   +7.684102490935338e-01   +4.474191004063547e-01   +5.145619710419638e-01   +3.095845436783500e-01   +3.295954409205815e-01   +2.190684466919589e-01   +4.949894244972907e-01   +4.375517137753080e-01   +9.089843806166610e-01   +4.746557638762910e-01   +2.238926499656784e-01; -6.222292986025330e-02   +8.806957891628638e-01   +3.318340226127456e-01   -3.872694393273556e-02   +7.069888325408520e-01   +7.301245005357818e-01   +9.348806413423723e-01   +2.989423523181102e-01   +1.000000000000000e+00   +5.384327140378633e-02   +2.249061601113539e-01   +9.336816697636824e-01   -2.578957240046341e-02   +3.045419146431798e-01   +6.590322044666969e-01   +7.944713228592448e-01; +8.226487405088091e-01   +9.465893623583745e-01   +8.690991826350589e-01   +4.270645850579912e-01   +2.754330208949765e-01   +4.990461555387742e-01   +9.031630784290338e-01   +2.144885524571129e-01   +8.081815029416194e-02   +4.635394177343105e-01   +4.280431696180412e-01   +9.176005657950622e-01   +3.580363797150942e-01   +6.401194623536741e-02   +4.197519156784291e-01   +4.671812970765145e-01; +8.782120648980162e-01   +7.155738416266584e-01   +1.134824817136938e-01   +8.224935134798343e-02   +2.088199011867706e-01   +2.819131390275704e-01   +7.066961923716062e-01   +4.204385768179805e-01   +9.679283848968868e-02   +8.466137768279703e-01   +8.656059423209160e-01   +3.429664391661325e-02   +3.359834276481203e-01   +4.498853879990121e-01   +4.686079393615042e-01   +3.902750082609212e-01; +9.851606513945119e-02   +7.023732696260760e-01   +5.114221662960532e-01   +5.303404999516134e-01   +4.688298593840632e-01   +6.598830896007665e-01   +6.709260650252994e-01   +6.813142758982411e-02   +2.367191147885113e-01   +1.144488578280910e-01   +4.371465938440200e-01   +2.937402571558221e-01   +7.196937909639237e-01   +9.629999551602968e-01   +2.520221709948847e-01   +7.411120276747272e-01; +2.958199670124612e-01   +6.203795975148390e-01   +5.516109405863600e-01   +6.167819260413148e-01   +9.418197233488209e-01   +6.321291937615211e-01   +4.733321366167306e-01   +2.336816873866201e-01   +1.600910528131476e-02   +7.007662018650694e-02   +1.279911435529177e-01   +6.089686623103114e-01   +3.634443088768540e-01   +7.655487115205823e-01   +4.218070920856461e-01   +4.383195082929973e-01];
L2E_L1E_iAMPA_netcon = [+1.628865650255626e-01   +6.014625358209476e-01   +8.643742737425490e-01   +8.701053930443260e-01   +6.128227642027047e-01   +2.803373798071532e-01   +6.427626639843840e-01   +7.948844036053769e-01; +9.898850012659630e-01   +4.473873801903547e-02   +5.507567582862651e-01   +6.299034467389475e-01   +4.891918690354455e-01   +5.694278829920074e-01   +2.863328341188666e-01   +8.149621105250285e-01; +5.659955074403334e-01   +5.632484552628839e-02   +4.738164662840291e-01   +7.744988205869967e-01   +2.145337172442913e-01   +6.565651211187273e-01   +8.314500724982354e-03   +9.304368444077934e-01; +7.350296669408021e-01   +4.516455679074246e-01   +3.649819221742066e-01   +9.583967343431848e-01   +5.688982330039308e-01   +6.216851806368571e-01   +7.878536077894952e-01   +4.845372300737290e-01; +8.681344939281050e-01   +9.240357427624220e-01   +3.410607829322692e-01   +7.301046981298592e-02   +3.444428061119890e-01   +3.559223027161534e-01   +2.125868875192059e-01   +6.797708347865572e-01; +9.366056668731603e-01   +2.249905983562193e-01   +7.708380766305033e-01   +7.235951219915133e-01   +8.717624933685891e-01   +6.639873869087605e-01   +6.660784488052480e-01   +8.416374323685243e-01; +4.842302701497724e-01   +4.273211942667105e-01   +3.597725869341971e-01   +3.245015214773079e-01   +8.931415578489248e-01   +6.354090613270584e-01   -8.448059473932863e-03   +7.689221619046304e-01; +9.366047560663489e-01   +3.554850686777858e-01   +8.283084356936659e-01   +6.920045699476952e-01   +1.657239201469703e-01   +2.264688196469402e-02   +5.434645719663134e-01   +5.398518999592402e-01; +1.692419563662117e-01   +2.545669630295943e-01   +5.672197986672125e-01   +2.013175427575814e-01   +6.827449183709788e-01   +7.932021337389485e-01   +2.754215095328662e-01   +1.528587566305947e-01; +5.916798544940346e-01   +5.189862402067253e-01   +1.483591902941566e-01   +8.016748497958451e-01   +8.197305475259818e-01   +2.522903252253602e-01   +9.358068295206791e-01   +1.184438490228370e-01; +1.248414266188406e-01   +5.191131335970312e-02   +4.782506156782746e-01   +6.808712118077195e-01   +2.522578270639530e-01   +5.749745344402311e-01   +7.269592566882226e-01   +7.097342838546218e-02; +8.288824549463261e-01   +3.070842546844812e-01   +4.660820115128305e-02   +8.334547312564632e-01   +9.187251294618851e-01   +7.530132603803841e-02   +3.719633020079306e-01   +4.455901434689530e-01; +3.936014265826797e-01   +6.121685610829012e-01   +5.430722195259894e-01   +4.447931839397645e-01   +7.562130626028857e-01   +5.342871811659254e-01   +1.408892094265021e-01   +4.523013048291299e-01; +1.128687496384795e-01   +8.524121591369376e-01   +8.784701786196428e-01   +5.403908327987120e-01   +6.641690944991416e-01   +4.162299473443606e-01   +5.673294193195236e-01   +7.419670310404615e-01; +8.718934367412576e-01   +2.517207798231516e-01   +2.211017264154665e-01   +5.871686813607494e-01   +9.584365222103068e-01   +4.488231141073650e-01   +6.617546544130322e-01   +6.071614344279177e-01; +4.546110285567663e-01   +4.591614491125571e-01   +2.381592816209192e-01   +1.698752270647050e-01   +1.000000000000000e+00   +9.264489567513172e-02   +2.594531015318992e-01   +1.467764633192392e-01];
L1E_L2E_iAMPA_netcon = [+3.282348192630455e-01   +4.336174058589396e-01   -4.691744809030332e-02   +3.691795654436509e-01   -1.275685945673550e-02   +6.705925550804928e-01   +2.906577661997212e-01   +8.674465870314217e-01   +7.496288879835082e-01   +6.107943699553692e-01   +2.633872743443959e-01   +9.360289411328034e-01   +6.442972705385119e-01   +1.882639137252979e-01   +1.559340870330014e-01   +4.941746537048519e-01; +2.851427782466079e-01   +3.787577352588201e-01   +1.000000000000000e+00   +5.597904450598542e-01   +5.389785681788259e-01   +7.652353547883771e-01   +5.387564158609929e-01   -3.308099137597194e-03   +6.182891858107626e-01   +2.150608344946094e-01   +3.626666088634896e-01   -2.414840746811830e-02   +5.834349086262087e-01   +4.923117276850522e-01   +1.582587429518511e-01   +2.354940908283463e-01; +2.121709200664567e-01   +4.081247659370656e-01   +5.039358121238646e-01   +7.323596960799994e-01   +1.365747445179516e-01   +3.940402334628874e-01   +1.501573466805448e-01   +1.315972348637441e-01   +4.885485505063240e-01   +4.113550633672564e-01   +9.130026675742761e-01   +2.774658948133717e-01   +2.339535089065007e-01   +8.323878387576801e-01   +3.958580309660484e-01   +4.625356294793400e-01; +1.261508911271284e-01   +8.099331477687076e-01   +4.004868988577488e-01   +5.820880989761053e-01   -3.066833728325271e-03   +6.338366250632353e-01   +6.322757759914014e-01   +2.717550406643899e-01   +6.221494933350391e-01   +4.729997951976441e-01   +7.135596326364013e-01   +3.223867533168852e-01   +3.874965541942966e-01   +9.385970864451972e-02   +3.141733207080182e-01   +3.348214758708351e-01; +3.300508717941797e-01   +7.693497381264308e-01   +8.996467134330787e-01   +2.452134631770531e-01   +2.094757404401760e-01   +8.483029442719784e-01   +4.756093700839190e-01   +5.645313948908858e-01   +9.121370993398471e-01   +8.726229393249232e-01   +8.906055011458540e-01   +8.629293280914191e-02   +7.445999329053908e-01   +7.994631717444209e-01   +4.915358967493710e-01   +3.757120250358302e-01; +6.120709148411319e-01   +8.594938581110168e-02   +3.213107771929231e-01   +2.540424450358439e-01   +6.180379906151746e-01   +5.675991150391271e-01   +6.137309663291257e-01   +7.093113484310096e-02   +5.515631162652227e-01   +5.832298715752687e-01   +2.381937136850157e-01   +6.522250258517109e-01   +3.527149332637558e-01   +6.974769932095961e-01   +6.707309382979226e-01   +5.319502519670489e-01; +7.418091820265358e-01   +4.342845447683442e-01   +4.648059246106870e-01   +5.507849392097842e-01   +1.871194716773243e-01   +9.956109761687071e-03   +8.923452014551558e-01   +6.582929426038892e-01   +3.209014951581912e-01   +7.855417754421523e-01   +3.658369470056632e-01   +8.550596836286858e-01   +1.400106605733653e-01   +3.542604704729719e-01   +1.646134351670047e-01   +2.686252276540359e-01; +7.247530761323073e-01   +7.089667774838408e-01   +4.990147687481080e-01   -4.651495169838573e-02   +7.274606633112243e-01   +6.768062233618644e-01   +6.482374498242340e-01   +3.929690297021814e-01   +4.388011778474648e-01   +2.835431308794570e-01   +6.818812031560036e-01   +2.881852657718160e-01   +1.626982560957843e-01   -7.563954802959776e-02   +7.331499532974917e-01   +7.920382156355122e-01];
L2I_L2E_iAMPA_netcon = [+2.238379916397208e-01   +7.035762389559653e-01   +7.778098659423394e-01   +7.445336685932005e-01   +4.451266589097971e-01   +1.709883056424215e-01   +9.797396097828950e-01   +7.608175218860372e-01; +5.287065065919002e-01   +1.000000000000000e+00   +5.202038009755011e-01   +6.023815138472429e-02   +9.019307012664780e-01   +1.288611303305432e-01   +3.610701330390432e-01   +1.556196019397325e-01; +5.253661509584494e-01   +4.286497398889985e-01   +6.912973044460572e-01   +1.889653532088001e-01   +3.287759697513613e-01   +5.917054601349734e-01   +2.056019206825564e-01   +1.350163311815346e-01; +5.526570823015237e-01   +8.387668838466510e-01   +3.069386140887209e-01   +2.379367293706693e-01   +7.865638064231694e-01   +7.249997372251713e-01   +8.643187474624056e-01   +7.593971191832145e-01; +8.975743432054475e-01   +5.192423420457712e-01   +7.950226272226293e-01   +2.435415054427592e-01   +1.672118587457537e-01   +6.161418125496467e-01   +4.368951454829886e-01   +2.744494317650668e-01; +9.202054200666400e-02   +1.316600128630924e-01   +1.440310136443120e-01   +4.871706759409875e-01   +1.234991076663296e-01   +7.570196438497003e-01   +6.662823419466921e-01   +3.335590448702344e-01; +8.465096270225950e-01   +4.112823969224838e-01   +7.284231487122537e-01   +1.945043694240902e-01   +2.834161381951567e-01   +1.711394269381924e-01   +7.146657727419296e-01   +4.137139312692034e-01; +4.386499281790406e-02   +4.617794737057633e-01   +1.950663151620394e-01   +5.262458698316461e-02   +7.204672831344706e-01   +7.027136391687594e-01   +1.697035069116417e-01   +9.904291250224376e-02];
L2E_L2I_iGABA_netcon = [+8.597310672401107e-01   +7.639741304712548e-01   +8.518746063973470e-01   +5.165906329588311e-01   +4.531625154475630e-01   +1.026499611212570e-01   +3.874300657386694e-01   +2.635795783629062e-01; +5.396626893420889e-01   +8.856089704338276e-01   +8.967860265439230e-01   +8.137734222804137e-01   +2.993074396906888e-01   +2.928236745988679e-01   +2.866692019228737e-01   +9.134050410703246e-01; +2.568833011154525e-01   +8.817101678330657e-01   +1.000000000000000e+00   +7.924674309275825e-01   +3.130236818311978e-01   +2.078290514205115e-01   +4.562065055115729e-01   +7.838460426777921e-02; +2.441645437452820e-01   +3.465781154021332e-01   +8.760224085443631e-01   +1.062549796658047e-01   +7.549798267293039e-01   +4.605572506014576e-01   +6.842323241547860e-01   +3.723706244992636e-02; +5.783104944089230e-01   +9.868549592744641e-01   +4.335729712248335e-01   +3.646822194119600e-01   +5.774136193581599e-01   +5.724395578490015e-01   +8.951149884784190e-01   +1.008721702946623e-01; +1.087933389608398e-01   +1.287992623672115e-01   -1.277202273507845e-02   +2.052757718816282e-01   +6.115603877152528e-01   +6.315431796188783e-01   +6.046614936162531e-01   +2.834474007089122e-01; +3.161890395320900e-01   +8.358461981557329e-01   -1.531313426505350e-02   +5.718615600186213e-01   +5.827260937003637e-01   +7.838635820166663e-01   +7.928024645454510e-01   +5.400472719746856e-01; +4.148853162006405e-01   +2.572174276899131e-01   +4.742840230467069e-01   +8.892292479126606e-01   +5.005719048807689e-01   +6.252887132740541e-01   +3.241267146654330e-01   +3.086466631060102e-01];
L3E_L2E_iAMPA_netcon = [+4.709953282770706e-01   +5.777476900425468e-01   +6.143307147768281e-01   +3.941234735753477e-01   +6.444982510870418e-01   +7.876077589204485e-01   +5.212507328273972e-01   +7.371278949398949e-01   +8.421375731772018e-03   +7.904400858762528e-01   +8.775657088169238e-01   +7.102421017596807e-01; +3.151126076419765e-01   +6.681977192200675e-01   +7.722558288491089e-01   +4.135263677226665e-01   +5.334372346143622e-01   +2.615267871354529e-01   +4.749141977369493e-01   +9.105252945337636e-01   +2.467518905334926e-01   +8.682776497982063e-01   +5.374845368414410e-01   +3.589609314050644e-01; +2.091851958381035e-01   +5.556057474478605e-02   +1.906135418083890e-01   +3.631888078098798e-01   +2.784254841471920e-01   +4.562690708658275e-01   +1.703144597810740e-01   +2.338795161164903e-01   +7.675714876164315e-02   +6.429827277675860e-01   +3.861653680495402e-01   +4.535183353802472e-01; +6.427389382226119e-01   +8.140510079374341e-01   +1.729423510787230e-01   +5.960634439486686e-01   +6.186253278156679e-01   +2.818499662640260e-01   +4.295233613556292e-01   +5.356489162773033e-01   +8.733909545535176e-01   +3.014928832670746e-01   +3.729204478473152e-01   +5.310734180508875e-01; +7.391178985470389e-01   +1.541157126149022e-02   +9.099181752106655e-01   +4.851786390244929e-01   +8.613599302797639e-01   +9.800760417353207e-01   +4.258048948842403e-01   +8.176826817545745e-01   +1.638225077000715e-01   +9.318436944555524e-01   +5.758695645683559e-01   +1.978540819872385e-01; +7.386922992386481e-01   +7.902787198238338e-01   +3.151667273765933e-02   +3.125115119025664e-01   +4.230955512113529e-01   +7.593880525740531e-01   +7.931408701032799e-01   +4.379710581570850e-02   +2.633065952850882e-01   +8.694353921422946e-01   +4.907836532161112e-01   +7.107759340469776e-01; +9.576658153386547e-02   +3.287492938605447e-01   +5.063106745896747e-01   +2.522168323079818e-03   +1.000000000000000e+00   +1.268141134052271e-01   +7.573283649100584e-01   +8.114907207756828e-01   +1.082217170402548e-01   +3.606664418089634e-01   +1.213143460912432e-01   +6.586998027180456e-01; +6.326568677958013e-01   +3.668350803093266e-02   -1.640149026298350e-02   +6.144382946231323e-01   +7.928183238793057e-01   +3.704627174697211e-01   +7.475773315966870e-01   +1.475280978885374e-01   +5.047861316354101e-02   +5.318355794254493e-01   +5.473472512193595e-01   +1.643274388108844e-01];
L3I_L2I_iGABA_netcon = [+8.976869838599045e-01   +6.567054435754389e-01   +6.154542199883177e-01   +2.403335907650023e-01   +3.464715243891773e-01   +7.647425533931379e-01   +6.617334641214836e-01   +5.135658251812372e-01   +5.573804115379953e-01   +7.169068807805130e-01   +4.418848872662378e-01   +7.804650966129263e-01; +4.463760483441684e-01   -5.886192175386348e-02   +1.416861960509787e-01   +8.608766477563463e-01   +1.239731936863745e-01   +3.496832604098767e-01   +3.746990300119855e-01   +3.547217096675526e-01   +9.092151940831980e-01   -7.590158151375745e-02   +9.052902993072243e-01   +2.305370484418129e-01; +4.411098417885897e-01   +5.369142377919948e-01   +8.764249801943765e-01   +8.475455312577085e-01   -2.168174383321519e-02   +5.306949581394412e-01   +9.481530687159257e-03   +7.715099531127991e-01   +4.823309337042710e-01   +4.665480769062140e-01   +9.778499082707773e-01   +8.940178404070864e-01; +7.958961357423081e-02   +2.291181332386091e-01   +9.522307186780755e-01   +3.842429234670707e-01   +6.518206958454633e-01   +8.264762408949927e-01   +4.509245198638891e-01   +7.036454983621635e-01   +4.212666955633756e-01   +3.933388703761945e-01   +1.092760284274477e-01   +1.572287328052098e-01; +2.475336826776975e-01   +4.916559240779703e-01   +1.440438189982539e-01   +3.402431770433510e-02   +6.004598393949536e-01   +1.146587492598773e-01   +6.346086447006640e-01   +3.236422163330526e-01   +3.329543439158984e-01   +8.562728778543583e-01   +8.352664601731369e-01   +7.437521821177235e-01; -4.619840301037477e-02   +7.552050013418463e-01   +5.497264549310845e-01   +2.404326622473527e-01   +7.376069269859128e-02   +5.008295955640869e-03   -5.471232296178973e-02   +3.952140063777111e-01   +2.798618126123463e-01   +6.463107357956986e-01   +7.089243413026148e-01   +6.791775029254701e-01; +6.395125288062828e-01   +5.456327339341239e-01   +7.725718956044451e-01   +5.087515506839317e-01   +5.001212106999937e-01   +3.877965563299356e-01   +2.468782621574044e-01   +5.506164207763760e-01   +4.332692110024545e-01   +7.028860242700860e-01   +5.352570084077825e-01   +7.729358264178504e-01; +6.570979500270435e-01   +1.000000000000000e+00   +6.577123023471616e-01   +2.299056363306221e-01   +1.934897114381670e-01   -1.846772740408583e-02   +9.113914032553169e-01   +6.449457053190886e-01   +8.930073425653402e-01   +6.189819703372996e-01   +3.946557525538129e-01   +7.243056431806972e-01];
L2E_L3E_iAMPA_netcon = [+2.130892877137831e-01   +1.204484754245209e-01   +2.210443169057397e-01   +6.623513670482079e-01   +7.033989069367731e-01   +2.994177674593687e-01   +2.161432053616859e-01   +6.278333291301662e-01; +4.333031740719582e-01   +7.470351665484808e-01   +2.048899102653440e-02   +6.971866210121758e-01   +3.050763672920476e-01   +4.341776066035304e-01   +9.797655216106702e-02   +7.129795170045643e-01; +8.831288370770436e-01   +2.989756788992077e-01   +6.129175494719186e-01   +1.027649215876794e-01   +9.735468293979220e-01   +8.738535316811105e-02   +4.308640312040506e-01   +3.771884802115307e-01; +4.002314128369796e-01   +7.318106462713447e-01   +7.639628728548516e-01   +5.695866846114134e-01   +6.759777476484385e-01   +5.770438010867327e-01   +6.297217543383254e-01   +8.092525403264325e-01; +3.995284546417093e-01   +3.335262129975766e-01   +8.937240455367165e-01   +6.638612659177726e-01   +5.644162791650721e-01   +3.555435094447210e-01   +9.941863933344840e-01   +3.449506645295778e-01; +3.445798989164247e-01   +6.245669030979920e-01   +1.669810546419938e-01   +9.425543194938225e-01   +7.486629021119719e-02   +6.353963547056765e-01   +2.535540648251103e-01   +8.633192779515825e-01; -4.236886035692441e-02   +6.649954081971419e-01   +5.802000493069298e-01   +2.613238194743516e-01   +2.996420824253190e-01   +1.996679556453796e-01   +8.206018441855298e-01   +6.239243505873331e-01; +3.906063185789539e-01   +7.642980073373167e-01   +2.766708079197513e-01   +1.067030482249373e-02   +4.608251698114520e-01   +4.210644668180334e-01   +7.016548059388260e-01   +3.582181071457089e-02; +3.721618663467369e-01   +9.646149718122052e-01   +8.040797072638671e-01   +8.471473887358456e-01   +3.441443764335475e-01   +7.714096897599660e-01   +4.375736501252681e-01   +7.577965483214181e-01; +7.490838241735646e-01   +1.366734587420482e-01   +3.866818076981589e-01   +8.582862226108653e-01   +3.857623462863248e-01   +1.759880253339729e-01   +9.467565753486092e-01   +2.114796613457259e-01; +2.228462503773172e-01   +3.993297687912984e-01   +2.019722727816037e-01   -7.088266271809035e-02   +3.417495471242141e-01   +3.994674547613761e-02   +8.072677379552511e-01   +7.599756244589424e-01; +3.814485845209614e-01   +2.596178728011253e-01   +3.772166835165087e-01   +8.889424668456432e-01   +1.000000000000000e+00   +6.050038640491101e-02   +1.465922465034604e-01   +3.731029713526264e-01];
L2I_L3I_iGABA_netcon = [+5.286002200369383e-01   +1.573728519908568e-01   +2.390134031419321e-01   +9.767600813556025e-01   +7.887708322650220e-01   +1.836133568394289e-01   +8.082501094784986e-01   +1.873374247318909e-01; +4.129000374734967e-01   +3.181409398790970e-01   +1.256321180188995e-01   +5.315342009929298e-02   +6.703831286402308e-01   +8.886507588231792e-01   +9.342972654943728e-01   +4.978643341523534e-01; +3.464752761826336e-01   +7.140053266797211e-01   +2.116420434586997e-01   +1.000000000000000e+00   +4.316577905072606e-01   +6.544201189148185e-02   +4.917385926982896e-01   +6.037825932017722e-01; +9.888415255760918e-02   -3.708381506231744e-02   +6.513313464468099e-01   +5.598655832908529e-01   +6.920672539751247e-01   +2.659366722093823e-01   +7.792446188848922e-01   +4.203519330178855e-01; +3.375921322492442e-01   +8.332663807432896e-01   +4.820040608878811e-01   +2.273049968521289e-01   +2.291926942098745e-01   +3.611287798969543e-01   +8.432443163912179e-01   +8.413793851574737e-01; +2.133649401437405e-01   +6.233010725294492e-01   +3.938199511483463e-01   +4.597094002211101e-01   +3.604729404462490e-01   +7.521726638487368e-01   +8.160170889478366e-02   +4.540556246084309e-01; +8.357238551012502e-01   +2.345608534436905e-01   +2.875743030823372e-01   +8.764850410769915e-01   +4.307163397502553e-01   +1.132718298453311e-01   +6.620987293740589e-02   +5.726327066836873e-01; +8.378910002671272e-01   +6.564947039831061e-01   +6.809942167982134e-01   +2.855514857106474e-01   +3.757656834158560e-01   +8.540797585258754e-01   +3.670477018883140e-01   +1.031866581202588e-01; +8.412589234665720e-02   +1.238937346677003e-01   +3.145765203476648e-01   +3.183082194638743e-01   +8.941151707507169e-01   +7.917769931827082e-01   +6.808355090033972e-01   +3.743083609697818e-01; +7.130060805663772e-01   +5.844202938222384e-01   +9.704320571897845e-01   +1.910931888543987e-01   +1.950085573746491e-01   +1.969293984145481e-01   +7.535926784452165e-02   +1.963430949570669e-01; +6.851518592831641e-01   +8.334659909039517e-01   +2.853428524725184e-01   +8.048903346834526e-01   +1.053545593498615e-01   +3.531585719370606e-01   +2.917128862114863e-01   +2.705510166899175e-02; +8.021728559787490e-02   +2.994500807063555e-01   +2.594542219840243e-01   +6.042437448682594e-01   +8.871088976834708e-01   +8.395301986262025e-01   +9.616327963492146e-01   +2.005989673880078e-01];
L3I_L3E_iAMPA_netcon = [+5.528495892621068e-01   +7.681214436256808e-01   +1.235646061892713e-01   +5.580994294675746e-01   +8.470842579516266e-01   +1.476770109331738e-01   +5.797770554851723e-01   +3.977707348864319e-01   +2.681578009455199e-01   +2.176543660133125e-01   +5.357973799256338e-01   +6.821066826414908e-01; +5.150143647292313e-01   +8.493236350933488e-01   +7.375737432801162e-01   +1.764082256470474e-01   +8.790222722916485e-02   +6.595825720305063e-01   +7.997376699865011e-01   +9.635139079995985e-01   +4.968115465442324e-02   +7.385119315550233e-01   +3.788172588590564e-01   +8.490728066887697e-01; +4.438433366556000e-01   +6.750052519821633e-01   +6.332305784651963e-01   -2.233739193839867e-02   +7.743751410741504e-01   +7.492964940733223e-01   +4.077883741628917e-01   +9.699396133063236e-01   +3.231884180647659e-02   +6.374988468315460e-01   +9.861428659377337e-01   +6.666266806939528e-01; +6.364740095712630e-01   +6.270809455018390e-01   +4.603110646543612e-01   +8.463612683707654e-01   +8.440907678456577e-01   +7.945514306522112e-01   +8.303378761224348e-01   +7.550518418170298e-01   +1.789918854336769e-02   +7.137510776133413e-01   +5.136052240187153e-01   +6.733765189069975e-01; +1.339649355423732e-01   -4.114817087473180e-02   +4.504443329770345e-01   +1.166896011904671e-01   +5.760905110468175e-01   +9.902360490626086e-01   +5.522515426343482e-02   +5.918228528062031e-01   +6.019180881886994e-01   +4.492603277897638e-01   +7.727627898702112e-01   -1.479521395249223e-02; +4.034726461624565e-01   +6.983852283572043e-01   +2.581320914825351e-01   +8.453361193689571e-01   +5.593171808265156e-01   +2.964997848527164e-01   +6.198394525737061e-01   +1.008266295003382e-01   +3.938328133373598e-01   +1.397088855404072e-01   +5.320878518975816e-01   +4.364439403774357e-01; +8.364237150306705e-02   +4.832742321962564e-01   +4.276065321304371e-01   +3.316067407673190e-01   +9.417372852644036e-01   +7.678393746553304e-02   +7.251183020044052e-01   +9.377007133908738e-01   +5.184997532520420e-01   +3.464973304633927e-01   +5.865832935550688e-01   +3.515941312511696e-01; +1.561960426528826e-01   +7.344924678738469e-02   +1.880039777570046e-01   -4.039978090135197e-02   +8.900356510540407e-02   +2.152797537692815e-01   +4.911228968274673e-01   +5.608227334256694e-01   +2.987238924390250e-01   +9.479793491581057e-01   +1.980553525116683e-01   +2.159760062385728e-01; +1.586094573728088e-01   +4.380880850045725e-01   +5.667711266414529e-01   +7.593609404755537e-01   +3.589083790898132e-01   +1.296829432775298e-01   +2.692259505966146e-01   +3.180747187354513e-01   +6.484156982666291e-01   -7.850301115613322e-02   +2.965370090846358e-01   +4.322683417064574e-01; +5.783494092603185e-01   +8.177674520583812e-01   +6.867608033048079e-01   +6.382435041418792e-01   +3.486165928029229e-02   +2.450615690365289e-01   +8.283289891626656e-01   +5.512379610332953e-01   +6.674136410642721e-01   +1.102000951606931e-01   +6.392683775181439e-01   +1.692779975620787e-01; +8.757006686750907e-02   +1.864166203476360e-02   +6.528436464561841e-01   +1.293664541910017e-01   +3.757535609274161e-01   +7.330033263978506e-01   +3.956915135571449e-01   +3.251661464229483e-01   +9.425798889488953e-01   +1.000000000000000e+00   +1.215732111751489e-01   +8.552915190460354e-01; -2.426091593907375e-02   +4.483390757952368e-01   +5.094880205550291e-01   +7.924390194965433e-01   +9.647709518918993e-01   +8.695916663449718e-02   +3.227971015416723e-01   +7.058417232731233e-01   +7.482511469210372e-01   +5.971072607664065e-01   +5.164464615675691e-01   +5.895963433653907e-01];
L3E_L3I_iGABA_netcon = [+7.870066195733751e-01   +1.239170265925647e-01   +2.236759629824481e-01   +8.634890440837241e-01   +4.492878753664551e-01   +9.039054543603530e-01   +8.165601240725101e-01   +7.663979255556748e-01   +6.747329561879293e-01   +1.544708328436493e-01   +2.342347283530612e-01   +5.936395202117184e-01; +5.251143357242305e-01   +3.322412221950051e-01   +8.234422320277848e-01   +5.840627546988052e-01   +8.319312696621293e-01   +5.885783131425650e-01   +9.166206037309242e-01   +2.043369727046212e-01   +7.868328130889810e-01   +1.990674361071950e-01   +1.580909156105418e-01   +3.871397981141764e-01; -2.299156533565734e-02   +1.779426670996793e-01   +1.350774218996715e-01   +4.707745037147540e-01   +4.046500498787451e-01   +6.597174871511503e-01   +8.192994588522863e-01   +8.165754599570952e-01   +5.392665014731749e-01   +6.788780078972356e-01   +7.159182879278554e-01   +4.100535468845600e-01; +5.782288478690085e-01   +1.000000000000000e+00   +8.193593723071484e-01   +1.574312686832229e-01   +8.308631339498532e-01   +3.144737844177740e-01   +5.157124134843973e-01   +4.498913794945857e-01   +6.954338943751183e-01   -1.828632050522858e-02   +8.910825832212882e-01   +7.402235064219891e-01; +8.807061480431569e-02   -1.410675632051936e-02   +2.624686688795831e-01   +3.653084561334763e-01   +5.351292103316380e-01   +2.062904820254807e-01   +6.085362112078009e-01   +3.765740490845305e-01   +5.286519247174911e-01   +2.576363932678611e-01   +3.849115158882432e-01   +8.452130070929594e-02; +3.228848271609516e-01   +2.150297375971478e-01   +8.694788917098387e-01   +8.861509444359202e-01   +4.511013802415598e-01   +2.773345480024587e-01   +1.616385395059572e-02   +3.828464878778938e-01   +3.709110338529899e-01   +9.775192155220742e-01   +8.505793989868722e-01   +5.929219199158747e-02; +3.561019227475645e-01   +6.442380952434227e-01   +8.515561376009884e-01   +2.420091116915442e-01   +5.323862992535018e-01   +8.535338214057963e-01   -6.995269723795466e-02   +7.088595544006699e-01   +6.292824106459476e-01   +3.595893339121891e-01   +4.761372360605124e-01   +6.017595477514882e-01; +8.218991644550362e-02   +3.920497872508016e-01   +1.074673484026361e-01   +9.401203810084494e-01   +9.003070454593237e-01   +2.822535333640934e-01   +3.898522376171689e-01   +2.773778321186579e-01   +2.448365219352398e-01   +2.365458746911479e-01   +5.729596817380731e-01   +9.562340287099007e-01; +5.472111457057068e-01   +1.396615773310111e-01   +7.355400103539173e-01   +7.122594230668615e-01   +7.668175513575084e-01   +7.739670539784850e-02   +5.023673854817597e-01   +7.862454546004976e-01   +4.553014825331699e-01   +1.844430040051271e-01   +3.803689045800191e-01   +6.905585507113509e-01; +2.551264749204901e-01   +7.465584099531615e-01   +9.787494179606002e-01   +8.780902604090419e-01   +4.005544553666032e-01   +4.252786160424252e-01   +6.062633117504701e-01   +7.723337360118537e-02   +9.661118390112594e-01   +5.994723942811354e-01   +5.965440810646552e-01   +5.373814526361013e-02; +1.185256013187982e-02   +7.014334397569519e-01   +3.348321750246623e-01   +6.601467826226717e-01   +8.175830835458932e-01   +4.345610320757121e-01   +8.640534012944255e-01   +7.834730296601649e-01   +6.488880040553592e-01   +4.923288701523269e-01   +2.138861417164940e-01   +9.163979619948149e-01; +6.319071121436842e-01   +1.811052379694277e-01   +6.233221710590977e-01   +8.402769022593649e-01   +8.187280658689330e-01   +9.016776139277891e-01   +5.609020437722781e-01   +3.581319283706063e-01   +7.471446004728258e-01   +3.967347005417236e-01   +8.124661637520703e-02   +3.152335591340507e-01];
L2E_Input1_iAMPA_netcon = [+8.649058020646214e-01   +9.601808967943453e-01   +8.814767539605539e-01   +9.501372895974208e-01   +1.000000000000000e+00   +8.654790571608026e-01   +9.242848006268137e-01   +9.234588994678902e-01];
L2I_Input2_iAMPA_netcon = [+9.678860614081175e-01   +9.713121237826645e-01   +9.465266758676137e-01   +9.547756360980184e-01   +1.000000000000000e+00   +9.193654758910587e-01   +9.360944786834803e-01   +9.940821345993103e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
