function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.705109804188986e-01   +3.800361752820599e-01   +5.321137108676995e-01   +2.125946791818589e-02   +2.502019394459841e-01   +7.165416573218868e-01   +4.852732610027977e-01   -9.814004390531976e-02   -2.451071714172958e-02   +1.001211837719920e-01   +4.638740721981710e-01   +2.546806390015396e-01   +5.451733243997808e-01   +2.772552055465355e-01   +5.018584117713868e-01   +4.090211853110233e-01; +4.151256061457648e-01   +9.062382516842267e-02   +3.124016165054995e-01   +4.806010919840080e-01   +5.766811934238852e-01   +1.500539338800230e-01   +3.434509639348675e-01   +2.363963951905454e-01   -1.637738890829468e-01   +4.823823615792232e-01   +3.817525418314673e-01   +4.424340219072924e-01   +7.097912626853422e-01   +2.869374360126659e-01   +6.082226067549443e-01   +3.916593416328649e-01; +1.749864099865532e-01   +2.708637421626150e-01   +4.912148243927710e-01   +7.803145180602139e-01   +5.405293673352276e-01   +2.582231876970669e-01   +2.491867731523013e-01   +2.801318040547569e-01   +5.944390100445322e-02   -5.107046822959841e-02   +4.013312656257667e-01   +7.290374662854526e-01   -2.622248563337632e-01   +1.697163805036276e-01   +4.816286081601387e-01   +2.785344861826648e-01; +2.461136555184875e-01   +6.314538110378997e-01   +6.182352111732972e-01   +7.638974357233737e-01   +9.894907810019622e-02   +5.922360132161316e-01   +7.158383119161984e-01   +4.183473768814667e-01   +5.810242797109942e-01   +4.797668502910042e-01   -1.431107441756525e-01   +3.957404598512426e-01   +4.816553708996608e-01   +3.952415324012321e-01   -8.193024295209972e-02   +1.412965196988947e-01; +1.199542841325326e-01   +4.215594605606418e-01   +4.799720260087312e-02   +4.395600586197399e-01   +1.925312260944294e-01   +1.919640996723934e-01   +3.279945512021664e-01   +5.495147683943009e-01   +6.833697188203743e-01   +1.224598158611011e-01   +6.653744078320980e-01   +3.777019373854234e-01   -1.393851236956652e-01   +5.954654474358474e-01   +2.962297559268994e-01   +1.049245481941768e-01; +6.620424075747419e-01   +7.954212383285325e-01   +5.576337883293319e-01   +2.434812197600843e-01   +1.280752172364714e-01   +5.767199983292454e-01   +4.652141450262987e-01   +3.246671200867973e-01   +7.512436920098362e-02   +5.970371441881895e-01   +3.379312431086895e-01   +5.613194377545567e-01   +5.152768376577246e-01   +5.439637965850780e-01   +7.446204034798298e-01   +1.327363787992271e-01; +5.904551830009603e-01   +4.840186405212538e-01   +5.028632835644197e-01   +3.409965121862286e-01   +4.298687755214546e-01   +3.977207365427800e-01   +3.459099623174294e-01   +1.212346733932644e-01   +2.080707342196184e-01   +4.086028376492066e-02   +1.439735025824265e-01   +5.497397859836807e-01   +4.123257130410371e-01   +3.125577951079760e-01   +5.347845799586650e-01   +1.113668650353178e-01; +3.581806677496909e-01   +3.805952757667093e-01   -7.381638712105533e-03   +1.081738449224113e-01   +4.867488983669124e-01   +1.420960711915665e-01   +3.967910209163490e-01   +4.142006226990145e-01   +2.019579073779477e-01   +3.119836423074066e-01   +2.557107382341490e-01   +2.045691457721977e-01   +1.343630611022360e-03   +5.110863921833317e-01   +3.857314849951178e-02   +5.980223332174917e-02; +5.648506131051536e-01   +2.912881695275505e-01   +5.971277028453615e-01   +2.211282088263982e-01   +6.446837915491126e-01   +5.118323807201930e-01   -4.071347952409059e-02   +1.450275571345726e-01   +3.365207435172711e-01   +2.399914953549067e-01   +5.324518930685227e-01   +5.244365226566675e-01   +3.917598560387688e-01   +6.232978665650122e-01   +2.650530199273206e-01   +4.190316037846135e-01; -3.555078786335478e-02   +5.456009699188964e-01   +3.571090957945802e-01   +2.350933585184704e-01   +3.507087550902041e-01   +7.261666650249785e-01   +6.080912171930982e-01   +3.083378499976118e-01   +4.409697847509274e-01   -2.486862460982066e-02   +3.092560365910522e-01   +5.072840336592594e-01   +2.764904976763586e-01   +1.373663442644008e-01   +2.804075475943797e-01   +1.291306528015272e-01; +1.140685478464702e-01   -1.002303650063101e-01   +5.207249302770530e-01   +5.305988513445924e-01   +3.633783732457202e-01   +4.557170997639907e-01   +6.856977918328069e-01   +1.753859642259266e-01   +8.831540786689447e-01   +1.324765130807100e-01   +4.077780156216036e-01   +2.819597392011762e-01   +1.183927172902463e-01   -1.476683912783620e-01   +6.097553843072629e-01   +1.277749176518380e-01; +1.511371579420696e-01   -1.401132665544160e-01   +2.200933757618204e-01   +4.410989662032337e-01   +1.929039353359555e-01   +4.973250654616456e-01   +2.414592077922648e-01   +6.852477997686091e-01   +4.937622722269261e-01   +4.174831671891490e-01   +1.975086334032167e-01   +5.398334956139290e-01   +4.360160352129572e-01   +1.350747081290534e-01   +5.809617782466628e-01   +7.611702932029675e-01; +3.816418335749258e-02   +1.398030970976737e-02   +4.863712790288239e-01   +1.422517460134812e-01   -8.456957933346415e-02   +5.162029243245658e-01   +4.140353299520729e-01   +3.006790713499179e-01   +7.293835531404653e-01   +6.864137191691249e-01   +2.901156156906968e-01   +6.962451907528381e-01   +4.800992682858742e-01   +6.220944761839602e-01   +1.000000000000000e+00   +3.574663628212342e-01; +2.837851798290617e-02   +6.677754603146246e-01   +5.305793478871779e-01   -1.754828117775160e-02   +1.355126247462453e-01   +5.069877484743555e-01   +5.595172987896518e-01   +4.579765151052174e-01   +3.890336643239488e-01   +5.744355456512578e-01   +4.813201086136618e-01   +4.318870046228784e-01   +6.437367386379227e-01   +4.657870111477754e-01   -1.391558727780730e-02   +4.229864894316216e-01; +8.284542780399659e-04   +2.558047708817318e-01   +6.503872453436144e-01   +1.531495692517832e-01   +2.227533812234760e-01   +3.735133684183425e-02   +5.716551387858436e-01   +5.029374009803919e-01   +1.736907803175228e-01   +4.705036732942134e-01   +8.060038935212001e-02   +9.539142931142200e-02   +1.813984477661345e-01   -2.632110204072837e-02   +4.853184562431572e-01   +1.863491589485986e-01; +2.733603403833931e-01   +3.807804877270615e-01   +5.008343626422715e-01   +6.296444410045708e-01   +5.373921765078324e-01   +3.687530323031231e-01   +1.471158272751067e-01   +5.113659810370897e-01   +2.714946776098284e-01   +5.435731299355632e-01   -6.022242862203063e-02   +3.489981438415736e-01   +4.258556862811976e-01   +4.973075132936208e-01   +7.100416393194580e-01   +6.448436020054172e-01];
L1E_L1I_iGABA_netcon = [+5.683250167413140e-01   +9.118025755490196e-02   +1.986533470859391e-01   +4.702614711991980e-01   +4.884402634803391e-01   +2.322065232701752e-01   +4.928673853845801e-02   +4.637637138928759e-01   +4.792257831446036e-01   +7.581652463712138e-02   +7.660861875582663e-01   +5.171852404155082e-01   +1.824048309326690e-01   +6.387007977842880e-01   +4.482343644967471e-01   +3.040705839239587e-01; +4.401288024788855e-01   +2.035866327919413e-01   +7.424662056122452e-01   +5.858703505743329e-01   +2.159942221069782e-01   +8.454081833462068e-02   +5.870977719659506e-01   +2.076046097177473e-01   +2.425326022201507e-01   +3.171830267989333e-01   +3.324658621271526e-02   +4.582101859405269e-01   +6.096823537219123e-02   -3.561013528561845e-02   +5.216027059911819e-01   +2.349170696746190e-01; +4.802907314175847e-01   +1.132156752394665e-01   +3.047733575666083e-01   +5.351745544256186e-01   +3.048337218555694e-01   +4.095692204614574e-01   +3.222297059889088e-01   +5.899578233318140e-01   +3.217170828638362e-01   +2.190100357609590e-01   +2.644505975453708e-01   +4.836797677551676e-01   +7.076505432266789e-01   +3.908108532359060e-01   -1.220913434697994e-01   +5.933953372028549e-01; -5.952783681554748e-02   +5.105480167860739e-01   +6.551130686880084e-01   +1.544490281495902e-01   +4.044602160604583e-01   +5.902060584350747e-01   +1.443223825022002e-01   +3.557834553746879e-01   +3.454076518109785e-02   +4.673472752586789e-02   +8.031324562775238e-02   +1.703276782995223e-01   -1.094396402291187e-01   +4.491419877688990e-01   +2.204496950852923e-01   +3.685998685823381e-01; +1.288081188468154e-01   -2.421839948850224e-02   +2.362824241516374e-01   +3.705295584986106e-01   +2.262719749297311e-01   +5.552615532613550e-01   -1.176332443974989e-01   -1.366648134681899e-01   +6.614483541194099e-02   +2.722957057617775e-01   +2.452151562291457e-01   +7.878519448784823e-01   +2.696728591110498e-01   -2.755693512928129e-02   +6.546479799398646e-01   +1.000000000000000e+00; +4.732953299433870e-01   -2.669223359596141e-02   +2.222707716624043e-01   +4.467362556243156e-01   -5.517606762067236e-02   +3.890224531641827e-01   +2.722594266544027e-01   +8.251784771424706e-01   +2.887352607077636e-01   +7.946123936578782e-01   +6.665511638439523e-01   +6.530296121825412e-01   +3.467403285424255e-01   +2.453596507632354e-01   +8.999782916939247e-02   +3.698443264506954e-01; +5.374070541747512e-01   +1.680094011652332e-01   -8.192181714517979e-02   +5.005473467350781e-02   +5.377341951151923e-01   +4.423945669065633e-01   +6.447221397077774e-01   +1.835687175001031e-01   +5.010200218001375e-01   +7.115638639741108e-01   -1.440540022822744e-01   +7.589599767527124e-01   +1.275110477991973e-01   +5.170503163016881e-01   +9.421790298788077e-02   +3.803228508262268e-02; +5.333079020397972e-01   +7.849706317035899e-03   +7.382677649028854e-01   +8.633925784458915e-01   +5.299132118518591e-03   +4.973038104560660e-01   +2.160319445634045e-01   +6.610376723971366e-01   +3.628555325049209e-01   +1.188659969588999e-01   +5.630921194932420e-02   +6.996814684994951e-01   +5.316978898364302e-01   +5.161041801177815e-02   -3.242537352367191e-01   +3.792089406601713e-01; +4.004859602770352e-02   +6.215344428322742e-01   +3.261531818342330e-01   +6.021996741009770e-02   +6.956209433303346e-01   +3.713706825132126e-01   +3.479228256380623e-01   +3.811705116078705e-01   +2.474307120031754e-02   +5.992702905170861e-01   -4.934535122468805e-02   +4.405463262209167e-01   +9.957994052031680e-02   +2.978033055489868e-01   -1.552367261285521e-01   +2.090292539859476e-01; +3.380147368970299e-01   +3.604940886815771e-01   -1.952592509565477e-01   +4.913695729944000e-02   +6.450513389207054e-01   -1.877550325309005e-01   +3.487692630492386e-01   +8.757325173253215e-01   +1.836045815567907e-01   +5.480241725071758e-01   +1.068692081850019e-01   +5.042597359144018e-01   +3.022150135545388e-01   +1.473935851474137e-01   +3.935584099834222e-01   +5.796589868701056e-01; +6.911304591277170e-01   +3.330196092801940e-01   +5.981878171555517e-01   +5.142147228622561e-01   +4.068593306840098e-01   +1.352727950468820e-01   -1.954325479207331e-02   +5.417005589302156e-02   +5.798811154202296e-01   -7.307964388167504e-02   +4.045343702327958e-01   +6.142720886240661e-01   -5.422130117946544e-02   +6.787280187029026e-01   +1.073502070673651e-01   +3.813415785409450e-01; +7.059233827848245e-02   +3.381178182386989e-01   +1.675509238464770e-01   +8.251962477878528e-01   -1.918797466234737e-01   +2.874039095925071e-01   +3.406974930010422e-02   +3.075012129228148e-01   +7.544732052255179e-01   +3.127283926975876e-01   +6.773567139654644e-01   +7.622127090452754e-01   +2.000097457395578e-01   +5.024328729967382e-01   +3.148836110540567e-01   +1.605775791443831e-01; -4.589519259258896e-02   +5.379940266356402e-01   -6.951341495603615e-02   +6.897769984058245e-01   +1.643920364946312e-01   +4.757153983462186e-01   +4.245779749942185e-01   +4.431925595927766e-01   +3.902228976496314e-01   +7.494603928927677e-01   +2.192486274618849e-01   +1.202671229168029e-01   +1.580474694620181e-01   +1.516048689535252e-01   +2.713037717863359e-02   +5.555079195375716e-01; +6.385686060389286e-01   +1.405544953103354e-02   +6.580118927428391e-01   +5.696149019293868e-01   +4.018939254415874e-01   +6.109654289295042e-02   +4.777756876977791e-01   +8.593184009472380e-03   +5.986788968721323e-01   +8.310783979970918e-04   +4.691467454280848e-01   +6.612014377705264e-01   +4.621662259200609e-01   +4.349963890924927e-01   -1.426612756808649e-02   +3.303733867564633e-01; +1.219144282044067e-01   +2.856167300438588e-01   +1.185659683557322e-01   +1.213092354738389e-01   +4.471731643814102e-01   +2.487464209647370e-01   +6.253193299666061e-01   +5.850791636489615e-01   +7.850898141852539e-01   +5.015527430900706e-01   +4.479632867055356e-01   +3.988963933221316e-01   +2.221490194060074e-01   -5.344221562962030e-03   +2.749802474433551e-01   +1.266675347227957e-01; +5.759650857341613e-01   -5.655973573361823e-02   +7.082407933869816e-01   -4.675516466816542e-02   +3.421964337207802e-01   +6.513870534489036e-01   +4.371961524145941e-01   +1.798531636385581e-01   +5.440206728268320e-01   +7.343125945781418e-01   +5.952095443248042e-01   +1.776601082241407e-01   +4.997086453846279e-01   +5.927459546297983e-02   -3.949224151090902e-02   +1.453842998110782e-02];
L2I_L1I_iGABA_netcon = [+7.818037005003967e-02   +5.632000560409021e-01   +8.479386015487784e-01   +1.637055773727599e-02   +5.313632149152908e-01   +1.770681292894693e-01   +3.401578021963821e-01   +5.042863116067471e-01; +2.165108648924529e-01   +4.401325621365574e-01   +4.384894564574528e-01   +2.341014020793603e-01   +5.984811179592915e-01   +1.569353292879622e-01   +5.574469671998191e-01   +8.283660244169895e-01; +3.114023737188759e-01   +3.932077448915566e-01   +5.721313030158647e-01   +7.221300695789011e-01   +3.938404592828960e-01   +3.345682651333254e-01   +2.336838715246282e-01   +4.286206187170603e-02; +4.258491443200514e-01   +2.852549967827035e-01   +5.721836283131866e-01   +8.565628132527259e-01   +1.469441204404198e-01   +2.590249068128546e-02   +3.840271687900016e-01   -6.218529584063780e-02; +9.252149533606293e-01   +7.394877513149380e-02   +2.835422514619760e-01   -1.532644156783232e-01   +5.938267253238944e-01   +9.761856569566306e-02   +8.906598882875373e-01   -1.029172256635933e-01; +5.828231444281707e-01   +5.735148891692087e-01   +7.680167646575853e-01   +8.073681749167726e-01   +8.103305955727819e-01   +6.796922484845948e-01   +6.289328902729798e-01   +6.397355177225387e-01; +7.252297598746298e-01   +4.858292821135350e-01   +4.442571128223782e-01   +1.257929135585165e-01   +8.714904431967889e-01   +3.799036247140552e-01   -2.405684268927803e-01   +5.348886734784132e-01; +6.643429078850626e-01   +3.443331577566369e-01   -1.283646248144628e-01   +6.204300112678448e-01   +5.380697348118326e-01   +7.521176004377540e-01   +6.835210761089202e-01   +3.169898166399593e-02; +4.862995076297497e-02   +4.673487645702799e-01   +1.350838086855251e-01   +2.709485317422066e-01   +4.653062977089861e-01   +7.437372700919331e-01   +4.309125349948625e-01   +2.470174737532100e-01; +7.383827374348094e-01   +8.092947775243582e-01   +5.208419616635938e-01   +4.128518034045776e-01   +3.353047058810677e-01   +2.890111962066483e-01   +4.745954081421498e-01   +1.966315011299449e-01; +3.894627677679819e-01   -9.593182443374230e-02   +6.385716668672231e-01   +5.719334089840808e-01   -4.125672934722820e-02   +2.878408897159888e-01   +3.791038895483982e-01   +7.799865904052110e-02; +4.216062286968605e-01   +3.052209421004329e-02   +1.911702276607107e-01   +6.519995647269905e-01   +1.057750416783563e-01   +5.305242886739360e-01   +1.487172635168362e-01   -3.256854757592505e-02; +7.173286693946370e-01   +9.351825897318778e-01   +3.106336267034497e-01   +3.638351376725774e-01   +3.318079218135079e-01   +9.996489396318212e-02   +9.255988123179884e-02   +6.679561434706910e-01; +3.000367251600417e-01   +8.148899621359105e-01   +1.697254385178901e-01   -4.776783746460149e-02   +5.296343724073230e-01   +7.359454217297550e-01   +6.238187512281114e-01   +5.411100329015945e-01; +2.584554574376001e-01   +4.793163753889101e-01   +4.107448161102770e-01   +2.945221044469554e-01   +6.516820013082421e-01   +2.832545251949622e-01   -2.041555518571841e-01   +5.992330510772435e-01; -4.340628891677843e-02   +2.342825105151309e-01   -6.233716250506259e-02   +1.095243950214959e-01   +3.695060916832875e-01   +7.246815230555659e-01   +1.292400772009155e-01   +3.957370564608550e-01];
L1I_L2I_iGABA_netcon = [+8.368202595110645e-03   +7.587264236736151e-01   +2.981143360470309e-01   +1.613953341826933e-01   +9.194026117912237e-01   +8.498913706343245e-01   -2.099609579167034e-01   +6.018115805492090e-02   +3.390704926498175e-01   +5.358438588761051e-01   +5.553759774927964e-01   +5.347387782151857e-01   -2.122387628738636e-01   +5.351596775820948e-01   +2.917824347816351e-01   +7.306429336523966e-01; +5.245248287790460e-01   +6.319913763207353e-01   +4.813415636569174e-01   -7.421085907790613e-02   +8.494860590622472e-02   +1.240731186745185e-01   +3.337392225837006e-01   -9.127078802553362e-02   +1.024791515982639e-01   -5.771399716844607e-02   +2.311777828864313e-01   +2.043672196356736e-01   +7.389086385749588e-01   +4.677104169120259e-01   +1.000000000000000e+00   +6.483525868034396e-03; +4.040876158355980e-01   +4.626057361580017e-01   +8.671606040246858e-01   +1.614820766932446e-01   +1.167926726851418e-01   +2.412201586830120e-02   +7.261591818493398e-01   +2.743117208886445e-01   -1.974634507828239e-01   +9.226037157539442e-01   +8.918874497437908e-02   +3.672007834581235e-01   +4.649344008098549e-01   +4.884528250809889e-01   +2.112217361875649e-01   +1.877163310084756e-01; +5.498272619618955e-01   +4.591096363664715e-01   +3.285906743484741e-01   +2.606253342796851e-01   +8.022101079411743e-01   +4.099963547962654e-01   +2.963838869314362e-01   +2.075594403634311e-01   +4.832885124477133e-01   +4.565514542752311e-01   +1.728980890223156e-01   +2.495018566684237e-01   +2.242529869235880e-01   -1.040232126301254e-01   -1.381926620709594e-01   +3.033701363128096e-01; +5.682031301839082e-01   +5.364009919715254e-01   -2.495523470815516e-01   +8.335243398186084e-01   +4.605370091615583e-01   +3.553553623545136e-01   +3.682882857077813e-01   -6.066769869102587e-02   +7.277123163474868e-01   +5.514986568647532e-01   +7.721570537483191e-01   +8.260554456248403e-01   +6.444850969119659e-01   -1.609102446782396e-01   +5.023335296541499e-01   +5.387116125017276e-01; +3.606669063590761e-01   +1.209684057653526e-01   +4.770307252334614e-01   +5.719821826724557e-02   +5.606262459725186e-02   +3.551387335926758e-01   +5.040201768113588e-01   +6.088588005607375e-01   +4.733548074287740e-01   +5.571281892985297e-01   +6.356544605367298e-01   +5.060062635560459e-01   +6.096208641717031e-01   +1.187499760516628e-01   +4.109948350466365e-01   +5.055350078409807e-01; +3.380962922217542e-01   +8.308116380349054e-02   +2.891116225153770e-01   +4.643539641699506e-01   +5.314931855374434e-01   +4.397896742994192e-01   +1.677230879107323e-01   +1.466474851749568e-01   +1.286797303189294e-01   +2.896207149606489e-01   +2.742019869323443e-01   +5.306413855657860e-02   +3.133861001570084e-01   +3.745352777463533e-01   +5.803981276207373e-01   +8.233399083471222e-03; +3.668958942730953e-01   +8.579749011602714e-01   +3.593330684211550e-01   +6.036494695782024e-02   +5.488771335379703e-01   +2.367023551038894e-01   +2.012105640193265e-02   +3.600149334395668e-01   +3.405919954010097e-01   +3.320356994600482e-01   +2.294373918890828e-01   +8.521043303803664e-01   +6.306377648740970e-01   +4.849926676398448e-01   +1.774562442542631e-01   +4.948809482524796e-01];
L2E_L1E_iAMPA_netcon = [+2.556280570709963e-01   +4.252937015146366e-01   +6.023830482814846e-01   +2.409723710302416e-01   +3.894855119292562e-01   +6.998319009564585e-01   +2.793311997330529e-01   -1.245093342129921e-01; +1.240069548313442e-01   +1.981800965552109e-01   +1.277468112158033e-01   -3.862073943347524e-02   +3.472675844804619e-01   +1.882092223466064e-01   +5.250717465029971e-01   +1.943676619155786e-01; -1.306367920508394e-02   +9.323751747907838e-02   +8.000807455839821e-01   +5.884224218377400e-01   +2.262480359819983e-01   +5.570716663433515e-01   +1.744046520099551e-02   +6.286474669522589e-01; -2.212493913835502e-01   +4.506763232728548e-01   +7.715946002545787e-01   +2.410627657358331e-01   +2.951313988570246e-01   +4.608870333534335e-01   +1.028382338891985e-03   +4.895767469779266e-02; +6.508407712049314e-01   +2.147241191096802e-01   +2.460264486935231e-01   +7.794294717114073e-01   +1.333022525677620e-01   +6.794221066332277e-01   +6.249905921649714e-01   +7.246185831085380e-01; +7.705775741667301e-01   +1.045047111028480e-01   +4.947102768834729e-01   +5.474086086152299e-01   +4.610945613702346e-01   +7.083537185018391e-01   +8.059163639049998e-01   +7.071070302333506e-01; +5.589756137831701e-01   +4.978359845829416e-01   +7.019606758221907e-01   +2.045096655097278e-01   +1.368090358690712e-01   -2.621341876535631e-01   +3.166756071302627e-01   +8.126145700234992e-01; +5.066543385807918e-01   +8.498035266539979e-01   +5.839992678332782e-01   +4.145759804842356e-01   +3.792925791552399e-01   +8.471730952289153e-01   +6.020705827690376e-01   +5.754838973875840e-01; +9.415381143997804e-02   +3.387024894892278e-01   +4.911302662133886e-01   +3.609663991135185e-01   -1.747894740090105e-01   +4.122701620855919e-01   +4.967133751962401e-01   +6.615071384784168e-01; +2.130398509155513e-01   +1.646437278244310e-01   +3.675245397321718e-01   +2.999084427242186e-01   +3.423401277255856e-01   +3.861229407854583e-01   +3.490962372015580e-01   +5.053395711251972e-01; +4.269303611394090e-01   +8.975800130014889e-01   +4.894624124241775e-01   -2.154863001123440e-02   +3.687800422085172e-01   +7.452874119139830e-01   -2.082031849025161e-01   -1.440206281333800e-01; -6.854743010484481e-02   +3.307227542857017e-01   +6.595148766765508e-01   +3.462333430981984e-03   +1.794777465726010e-01   -1.172703863606402e-01   +6.349572326043489e-01   +3.359937477336549e-01; +9.852703415797923e-02   +4.254247215678658e-01   +9.880202041275473e-01   -1.328814953943674e-01   +3.918860818650751e-01   +2.920097878891946e-01   -1.801113261006445e-01   +6.211108860436121e-01; +9.750946248970221e-02   -2.788045077554054e-01   +2.064513091497128e-01   +3.809899266842633e-01   +5.874958423872362e-01   +6.953271202921296e-01   +1.929800077944526e-02   +1.171678572337057e-01; +3.989108365263886e-01   +5.266009951769035e-01   +1.115649243649714e-01   +3.045066692606531e-01   +3.952827050818420e-01   +2.912630903004569e-01   +3.866894075924945e-01   +4.672772989405267e-01; +4.066332691778841e-01   +6.152761200100936e-01   +2.430390740429239e-01   +1.763308269012075e-01   +4.640941488774521e-02   +3.130488423832750e-01   +2.701249019772809e-01   +2.654563185387133e-01];
L1E_L2E_iAMPA_netcon = [+6.187604159978465e-01   +4.537873252517479e-01   +2.737268194458143e-01   +7.322910342566750e-01   +8.177902423612653e-01   -1.374565644692837e-01   +3.601205341104249e-01   +7.641208672213489e-01   +2.825057667500628e-01   +4.010981563569581e-01   +4.648375951903752e-01   +9.359414899169823e-01   -1.098444215018917e-01   -2.484977386741174e-02   +8.930556056701772e-01   +1.335346419788292e-01; +1.928817837694622e-01   +1.329805574257705e-01   +5.268123016331708e-01   +5.301505263418587e-01   +2.776901758705725e-01   +3.809331990929322e-02   +3.149713434339073e-01   +5.976857949477683e-02   +4.699674041712605e-01   +9.382553802114140e-01   +5.753105570717485e-01   +2.286256738787005e-01   +8.306975313218049e-01   +8.836599529452019e-01   +4.031447417355743e-01   +5.220991598527620e-01; +2.487640576451895e-01   +9.151073321448399e-01   +1.920595418996012e-01   +6.729679111847815e-02   +5.160851541667938e-01   -1.240189937270061e-01   +7.287390035535436e-01   +5.735041642212350e-01   +5.376049731712046e-01   +2.025272962751057e-01   +7.420115137138401e-01   +2.633451432000509e-01   +4.904165313321519e-01   +3.308317219560475e-01   +1.161429331442752e-01   +3.807961558585128e-01; +8.256429223432400e-01   +2.433242958828354e-01   +3.020487012810787e-01   +2.677236990160574e-01   +2.715207135897629e-01   +2.203745813390859e-01   -1.720445031346626e-02   -5.275254944991477e-02   +8.613434859011811e-01   +3.801294670570979e-01   +3.894781370276053e-01   +3.104717114901252e-01   +3.198605492403656e-01   +6.847734488009229e-01   +7.336054448556160e-01   +4.067864811151316e-01; +5.113128731372900e-01   +1.615367676918615e-01   +2.671859444372315e-01   +4.436577176911779e-01   +3.518241102821899e-01   +7.187800158978011e-01   +1.487551222127037e-01   +3.901408511626208e-01   +2.799235923956342e-01   +2.442610941291586e-01   +3.013528205329978e-01   -2.667778835112553e-02   -2.467315138325790e-02   +7.860977758213130e-01   -2.983729458041049e-01   +6.146512680964544e-01; +8.746906339814613e-01   +8.093986305949594e-02   +3.228848719442969e-01   +5.315782725886830e-01   +3.893675840683329e-02   +2.163346974817850e-01   +4.552684554845313e-01   +1.797168673872627e-01   +5.293693488275300e-01   +2.282982008696062e-01   +3.252194671561244e-01   +6.516945410496227e-01   -8.199521930309248e-03   +6.278193727236729e-02   +1.849748560598375e-01   +5.912546973429620e-01; +3.828745770126233e-01   +1.392211511302148e-01   +4.037059067759525e-01   +1.933590363292189e-01   +9.171474051501538e-01   +5.039720642602976e-01   -3.043066362771736e-02   +6.241131559964068e-01   +3.697934500054769e-01   +8.004532588485478e-01   +5.195566711032770e-01   +1.937377977770452e-01   +6.228420883973221e-02   +2.173287147916190e-01   +5.183572289204423e-01   +1.181640856649241e-01; +3.985213116353620e-01   +4.164472331032955e-01   +9.411703638457060e-01   +8.011654520389551e-02   +8.282339916731699e-01   +1.659463329312033e-01   +3.259386781970788e-01   +2.029050255361887e-01   +2.080626008235083e-01   +6.365310179970063e-01   +4.594927932796730e-01   +2.195787446668302e-01   +8.531853843248408e-01   +6.076036375096739e-01   +3.857086798857975e-01   +3.408730571328608e-01];
L2I_L2E_iAMPA_netcon = [+3.891302219684637e-01   +9.657171355221589e-01   +3.655320399583132e-01   +5.575324102731097e-01   +7.710690770798264e-01   +6.734730974921331e-01   +7.039922967358587e-01   +2.760396644854107e-01; +8.623484712562711e-01   +2.372936404219191e-02   +2.883131867952429e-01   +1.561256198506454e-01   +6.641064775605769e-01   +2.684386017633167e-01   +3.462507962185058e-01   +7.221618371889365e-01; +7.855589314611177e-01   +3.318097419457524e-01   +7.302084334727460e-01   +4.984469252741716e-01   +4.650293928452762e-01   +4.551965282088944e-01   +4.943626859318398e-02   +7.375487700022517e-01; +3.095549911476900e-01   +7.665499836130614e-01   +2.856461228804076e-01   +2.824628963368057e-01   +4.059844204215394e-01   +1.656853522587652e-01   +1.093294371609288e-01   +4.739034467893367e-01; +4.925212969001315e-01   +4.399477243824624e-01   +7.420133680505754e-01   -2.975215420067694e-02   +6.697638848853845e-01   -1.630279152913969e-01   +1.969307397898446e-02   +3.711449423098897e-01; +1.890948699865692e-01   +1.311853908324935e-01   +5.504349327234120e-01   -3.094243790323054e-02   +5.966652356879705e-01   +4.880976617693159e-01   -6.656583594831332e-02   +3.870038926679514e-01; +3.608053384888578e-01   +8.524730671173637e-02   +5.846493886016647e-01   +5.789543689918416e-01   +1.263814076940710e-01   -4.987623922159712e-02   +3.135676879765357e-01   +7.205480266902390e-01; +5.512419609134500e-01   +5.525376540254613e-01   +3.995028997997857e-02   +6.431577640866313e-01   +1.406655614356907e-01   +7.069233807517468e-01   +2.500443752853256e-01   +6.024649093812496e-01];
L2E_L2I_iGABA_netcon = [+1.522691342920335e-01   +3.318901909505846e-01   -3.345412899455809e-01   +9.271187543082862e-01   +4.292282347156624e-01   +7.269511650608976e-01   +6.219505045067169e-01   +2.621858637922796e-01; +5.137727789470957e-01   +7.881497436160335e-01   +2.106940467071275e-01   +2.934858646253169e-01   +5.489606798533477e-01   +4.327957048597155e-01   +3.924618584767489e-02   +5.925053136530907e-01; +4.254654374897345e-01   -8.477992657946670e-02   +4.223283665860193e-01   +4.469890868682851e-01   +2.796033786825262e-01   +2.179283504561898e-01   +1.358636419353203e-01   +3.696345881218874e-01; -8.424565008403842e-02   +5.680259763698180e-01   -1.003313002994527e-01   +8.441814187551492e-01   +3.599657514026597e-01   +4.972827376063095e-01   +8.815315950114445e-01   +8.327423312788239e-01; +2.681375155405126e-01   +3.682500775508442e-01   +3.132539370339856e-01   +3.695708057980420e-01   -8.374119284875943e-02   +4.090018168075387e-01   +1.573691454702510e-01   -2.287534545190811e-01; +5.644000638157233e-01   +8.328173383170979e-01   +1.000000000000000e+00   +9.985677384451414e-01   +5.909605088725868e-01   +3.741664186129147e-01   +1.268055301859410e-01   +5.329618345692297e-01; +2.205233837722574e-01   +2.258701250307650e-01   +1.349389500366215e-01   -1.734566166354205e-01   +3.930041432338013e-01   -6.245221415958051e-02   +2.185356346888536e-01   +4.782187813660954e-01; -7.119266098706505e-02   +6.429819430783145e-01   +3.789570840577934e-01   +2.365874338198211e-01   +5.249009423737798e-01   +2.985776369999593e-01   +5.461896045751643e-01   +7.800440855296696e-01];
L3E_L2E_iAMPA_netcon = [+3.441290161196270e-01   +3.066227605586032e-01   +6.056803273070888e-01   +1.226737164095054e-01   +4.319727358781069e-02   +6.994171867247478e-01   +5.910375118394390e-01   +5.510382887800254e-01   +4.491066734132557e-01   -7.814389969536667e-02   +1.936961095791601e-01   +4.538418015668444e-02; -1.622180415289747e-01   +5.309430005545626e-01   -9.904051067884657e-02   +8.069237777217976e-03   +2.640041656758274e-01   -1.110085419553616e-01   +3.529395648383902e-01   +1.892871073448776e-01   +2.854517351480466e-01   +2.360673531986323e-01   -1.318465618117582e-01   +2.903217751811651e-01; +1.769927956476056e-01   +6.587475355452406e-02   +1.073191369608823e-01   +4.310670420643853e-01   +4.071294534977305e-01   +5.711999959685388e-01   +4.260449641396427e-01   +5.808821542457236e-01   -2.708820658359331e-02   +5.426310821276400e-01   +3.122849784654743e-01   +6.483092918558969e-01; +7.052795683922786e-01   +5.590572482787781e-01   +5.278642989028161e-01   +3.082769499477251e-01   +3.829239217160458e-01   +8.808711034112071e-01   +3.368041882131905e-01   +2.369747736299295e-01   +4.556676564696046e-01   -2.978245517369905e-01   +3.275480881197362e-01   +7.666752799124021e-01; +3.520527013742931e-01   +4.077583373110127e-01   +2.112526547865960e-01   +2.068292508787746e-01   +3.835255778515313e-02   +4.032102985720541e-01   +2.142151921603170e-01   +6.767400924040466e-01   +8.023419499758649e-01   +4.406394152184784e-01   +5.046000072458853e-01   +1.888651125260602e-01; +1.985439891222053e-01   +1.737763302192061e-01   +5.022868408703801e-01   -1.067769396039567e-01   +4.224501269064066e-02   +4.493684726440885e-01   +2.822900178239888e-01   +4.408732588446066e-01   +3.792781797685900e-01   +5.154189654991768e-01   +2.072902517894649e-01   -4.006252223696884e-02; +4.836959315806454e-02   +2.746138099624477e-01   +1.893924766340064e-01   +3.854009892717565e-01   +1.000000000000000e+00   +6.864990562754497e-01   +6.563898317170974e-01   +5.607698383312358e-01   +5.552714261891329e-01   +2.712001408817638e-01   +1.429380044151522e-01   +5.436731169108628e-01; +3.653849386423994e-01   -1.773040295998595e-02   +4.005287105734913e-01   +5.551683711412793e-01   +2.903918412078804e-01   +3.888338766238668e-01   +6.049241347448587e-01   +1.442010815447491e-01   +5.670348092207022e-01   +2.632396525214238e-01   +1.284123812082989e-01   +1.155521334097548e-01];
L3I_L2I_iGABA_netcon = [+5.106928052983835e-01   +2.170023171154573e-02   +2.075956649967438e-01   +5.594137151393199e-01   +3.681550751007930e-01   -7.619910821821188e-03   +2.908515280509089e-01   +4.788437285484119e-01   +2.038933793314911e-01   -8.260288908251705e-02   +5.587116147895355e-02   +6.962012398161435e-01; +7.035748820211896e-01   -1.343344713987623e-01   +1.777918124592583e-01   +4.854761940178144e-01   +7.250068959890766e-01   +3.094185482612604e-01   +3.898921032344361e-01   +6.046733816083608e-01   +1.769331870842015e-01   +4.196987214315487e-01   +2.610658817800693e-01   +4.373332764297670e-01; +5.709197946795848e-01   +4.273910298486092e-02   +5.680198868718674e-01   -1.041046710174956e-01   +5.214744290640331e-01   +8.742955176058859e-02   +4.462631751214524e-01   +2.605299359173055e-02   +2.367634167750803e-01   +4.271213972807982e-01   +3.106656369741105e-01   +8.597502441936881e-01; +3.344901113954310e-01   +3.266256506892780e-01   +6.236140915990017e-01   +8.141013756696573e-01   +3.443046715717265e-01   -1.055251511301480e-01   +6.788808517430781e-01   +2.550032219541583e-01   +7.203234025146177e-01   +1.366239389315603e-01   +6.198480501094182e-02   +4.567943266377316e-01; +4.039304153098431e-01   +3.762180090493025e-01   +4.233262571737996e-01   +1.892213785318244e-01   +4.707372132056796e-01   +5.470827280505179e-01   +4.478936333055990e-01   +2.161499849151770e-01   +3.486719049778889e-01   +3.329890215196296e-01   +7.762301684787449e-01   +7.402346420853304e-02; +5.566818135798384e-01   +1.825074087531617e-01   +6.088504881230354e-01   +7.872890814147985e-01   +7.785652528141618e-01   -2.665656563253100e-02   +7.298894998650148e-02   -1.363082782413308e-01   +2.846014444479629e-01   +1.403439252415911e-01   +1.783449258833677e-01   +2.347996184662906e-01; +3.848655079187025e-01   +5.522052109901598e-01   +7.628414022720443e-01   +4.575378020683719e-02   +2.728027899136657e-01   +3.930891816131438e-01   +2.338882425005301e-01   +6.041653070523885e-01   +1.725929674797320e-01   +8.887117111862470e-01   +3.326593907117210e-01   +7.639646474775725e-01; +2.187812313152482e-01   +1.029160849095305e-02   +4.417748797083162e-01   +3.975034875126611e-01   -2.021371662374130e-01   -3.535349317405791e-02   +2.544782889795952e-01   -1.310846015170025e-01   +5.574003765139248e-01   +4.661618076785385e-01   +3.138853918895491e-01   +3.221823268844483e-01];
L2E_L3E_iAMPA_netcon = [+2.371251513981661e-01   +8.839012623676772e-01   +4.900961423060442e-01   +7.384829470551380e-01   +3.813149029381999e-01   +1.004454705787635e-01   +9.339760281682511e-03   +3.556326801095440e-01; +3.583356087858798e-01   +5.046016051787063e-01   +4.713384995250724e-01   +3.052667943593177e-01   -1.409870992133495e-02   -5.780833300451694e-02   +3.980834332061930e-01   +3.516223068288132e-01; +1.081062428699747e-01   +3.074468592958539e-03   +7.507294776172323e-01   +8.162896864794571e-01   +5.793488785596755e-01   +3.577593607893962e-01   +3.189647210917039e-01   +4.178613940572196e-01; +1.764064636088670e-01   +3.903631846807908e-01   +1.204127606072821e-01   +6.543367166547933e-01   +4.291973306733702e-01   +6.584047788028752e-01   +3.787606607690676e-01   +2.722146668969520e-01; +4.764599405841392e-01   +7.333469771340801e-01   +6.195046894507917e-01   +1.000000000000000e+00   +5.444171588509813e-01   +2.073178673618041e-01   +8.770855808896920e-02   +9.968285701769808e-01; +8.543232938897730e-01   +6.240819342029363e-01   +2.173670941241170e-01   +1.147201385185287e-01   +4.116631091389875e-01   +5.713315554321218e-01   +5.549048699064417e-01   +6.329860839988740e-01; -1.820993486157760e-01   +3.590320528686908e-01   +5.409818319491094e-02   -1.223438102227828e-01   +6.925246978549737e-02   +2.312658314555220e-01   +3.022225496154150e-01   +2.603181873611674e-01; +6.374280047649070e-01   +1.305105093065493e-01   +7.118375374730956e-01   +8.761093632325298e-02   +5.844009736425012e-03   +2.408515128275374e-01   +5.002439162027396e-01   -1.984600274208286e-01; +2.396118947470532e-01   +5.971844348977436e-01   +3.895579470974546e-01   +4.609159769052270e-03   +3.368134525097315e-01   +8.700238526236442e-02   +3.388470278379676e-01   +6.204798570167237e-01; +2.657678101018651e-01   +5.286519757218040e-01   +2.461406903705783e-01   +3.877061803439152e-01   +5.021296687903637e-01   +4.378414384164986e-01   +8.280318191552143e-01   +4.179441866714033e-01; +3.967973304336898e-01   +4.913864651893146e-01   +6.507661146289380e-01   +2.218099073689772e-01   -2.059718956004605e-02   +2.147486844839120e-02   +6.899531415846694e-01   +2.590056154918798e-01; +5.312442448794196e-01   +2.946384141774763e-01   +5.804158366676500e-01   +5.441222027010392e-01   +3.500630238945745e-01   +4.663129632728559e-01   +3.569061781644094e-01   +4.996817791340404e-01];
L2I_L3I_iGABA_netcon = [+5.045170865087045e-01   +2.523035633043042e-01   +6.759510465902879e-01   +3.977772619611259e-01   +4.123307915264932e-01   +5.285026775406848e-01   +6.947536707757734e-02   +5.285317745848728e-01; +4.622768954039638e-02   +2.355555299317528e-02   +7.140521275256939e-01   +4.814866434999948e-01   +5.018709395506955e-01   +4.837734348693548e-01   +9.565176996762426e-01   +5.145432444199959e-01; +1.917026644857704e-01   +6.120535893606878e-01   +4.066835332278362e-03   +2.231561850973083e-01   -4.990101398834303e-02   +7.372259488393986e-01   +2.812312666151680e-01   +5.378856228666262e-01; +4.244731220469359e-01   +4.037493562127614e-01   -9.327776466320453e-02   +2.668790586041996e-01   +5.554688603633235e-01   +5.328572026993413e-02   +1.669611908852064e-01   +1.948726453395269e-01; +5.862865091976508e-01   +2.714127145018514e-01   +4.795072764827671e-01   +7.558910500444971e-01   +3.735054654285077e-01   +4.936990045863877e-01   -1.087941114725061e-01   +1.114675839108227e-01; -4.610102534804281e-01   +3.793033337250386e-02   +4.253775474419053e-01   +4.665077453209306e-01   +7.467050030394323e-01   +5.851533364867590e-01   +4.804117458072807e-01   +2.298019511442699e-01; +9.117605789166262e-02   +3.777284972378628e-01   +2.438933201324733e-01   +4.392648590808643e-01   +1.857637454773406e-01   +7.449022558301692e-01   +6.441888543172323e-01   +9.222156159886286e-01; +3.439348944423862e-01   +4.268778801126350e-01   +2.777751751798777e-01   +2.052887237006820e-01   -2.834557137488591e-01   +3.367379305810435e-01   +3.201753793991530e-01   -5.467874580217386e-03; +5.070201073328962e-01   +1.404322192228467e-01   -9.683867886075864e-03   -9.139544886955604e-02   +3.617745518714427e-01   +2.532122536995871e-01   +1.398811492741103e-01   +2.463744050211190e-01; +6.714995432870666e-02   -2.671541309189855e-01   +5.536353392477454e-01   +3.905713580214081e-01   +7.393127515089283e-01   +6.937224376391994e-01   +6.064299449594210e-01   +2.644120077291557e-01; +2.686539235689453e-01   +4.313263428097177e-01   +7.297695950789416e-01   -1.218242020471846e-01   +6.729978494865015e-01   +3.946513269641320e-01   +4.449840862890488e-01   +1.200266597133569e-01; +6.424985176182160e-01   +1.372017324365200e-01   +1.362289465807865e-01   +4.746178300145149e-03   +4.431659598504343e-01   +9.355261546664603e-01   +9.540340598988133e-02   +3.861318195476841e-02];
L3I_L3E_iAMPA_netcon = [+1.626586817969387e-01   +1.610833457080399e-01   +2.888856408586221e-01   +7.596861466249557e-01   +6.013571023189603e-01   +2.739006608778872e-01   +2.145244344326272e-01   +9.819556295722183e-02   -1.957623198899598e-01   -5.638063160669483e-02   +4.366311057643178e-01   -2.964745575710102e-01; +2.438223582962672e-01   +5.080648089280346e-01   +3.660008276105683e-01   +3.365248715216467e-01   +2.432871705127652e-01   +1.016066386473866e-01   +3.537302886593571e-01   +1.049835210208158e-01   +2.458804340982500e-01   +2.289961125066589e-01   +3.837546808747841e-01   +7.998004043368182e-01; -3.615474490706923e-02   +6.686539609997693e-01   +5.863503320022366e-01   +1.886005757506525e-01   +2.941085847016105e-01   +3.630656344917639e-01   +1.812432330345504e-01   +2.800673017593766e-01   +3.300572190973132e-01   -3.253845619072230e-01   +6.942009751562876e-01   +3.543156946758647e-01; +2.949763864302382e-01   -9.975899387760770e-02   +3.474420595539604e-01   +1.306243011395522e-01   +5.758191298862930e-01   +9.294040286720298e-02   -7.028336465539831e-02   +1.979860696987771e-01   +4.780792151779550e-01   +4.313812818674456e-01   +3.473320167323936e-01   +1.839307470778993e-01; -7.845676217632745e-02   +7.489654300046321e-01   -3.423351924158188e-02   +1.446676284845258e-01   +4.725005233980387e-01   +2.290141676980096e-01   +2.197837689478572e-01   +1.455320580286067e-01   +6.827754732771742e-01   +1.638412228235848e-01   +3.041991664024250e-01   +6.997290389695235e-02; +1.644011023620975e-01   +1.918863643577952e-01   +7.604658831131068e-01   -4.873492031215042e-02   +1.906041917278605e-01   +3.266038683058013e-01   +3.204792324003501e-01   -6.226346880222122e-02   +6.679893324566323e-01   -1.088978936885089e-01   +2.576373336500238e-01   +9.421724471700120e-01; -6.127069359086455e-02   +8.523898285346053e-01   -4.961165369760316e-02   +4.689818946870717e-01   +3.964971920530713e-01   +3.842399440421965e-01   +2.892436539662848e-01   +1.204047345109806e-01   +6.287002083008830e-01   +8.094281775725889e-01   +1.654345422320476e-01   +6.619324980814475e-01; +1.804144709732566e-02   +5.567016903378613e-01   +5.252119555076331e-01   +4.604515482974995e-01   +9.765202585481227e-01   -9.134725353887062e-02   +1.000000000000000e+00   +4.905917689977322e-02   +8.474599106353291e-01   +5.903843604553466e-01   +6.515563288250715e-01   +5.050035442262324e-01; +5.046983058604833e-01   -1.970880615695054e-01   +1.335617182667614e-01   +6.374877957469448e-01   +7.769270501944977e-01   -1.859204382502341e-01   -5.897916415514094e-02   +4.728156520230248e-01   +5.951279876004695e-01   +8.770432816521335e-01   +4.480115044344117e-01   +1.742023590453436e-01; +4.903141735408130e-01   +4.269140490579492e-01   +3.901940955953098e-01   +4.011115670886951e-01   +8.719856063148282e-02   +1.735224579970691e-01   +6.978395838152669e-01   +6.357755351943738e-01   +3.531828105361937e-01   +6.827515335628537e-02   +4.550358338911217e-02   +4.768269349303835e-01; +2.954257630102124e-01   +6.713926451607874e-01   +6.338111875802585e-02   +5.226004729890642e-01   +7.145772881340593e-01   +8.976993127456409e-02   +4.297721552902968e-01   +7.694390221704398e-01   +1.705304886897205e-01   +4.336117609968454e-01   -1.354501890276567e-01   +8.667099716030431e-01; +4.079946639326164e-01   -1.339018396932136e-01   +4.822290700548420e-01   +7.894309877489533e-01   +6.892855374391682e-01   +3.810813575115141e-01   +1.867707385595957e-01   +1.751868760057717e-01   +6.567235166736017e-01   +4.107398396737924e-01   +3.317131502674018e-01   +3.981867316187656e-01];
L3E_L3I_iGABA_netcon = [-1.513484592487197e-02   +5.459821977076259e-01   +4.722477065966195e-01   +5.626798666239682e-01   +7.119114469202598e-01   +4.615709984286486e-01   +4.944517808743324e-01   +6.979884991755231e-01   +8.003465740489283e-01   +1.771279640338292e-01   +3.858800277558480e-02   +3.053290518463375e-01; +8.009807718646350e-01   +6.607951146269887e-01   +5.851360571865917e-01   +5.831398660367902e-01   +1.753503643950299e-01   +1.936942889908558e-01   +5.894576800621306e-01   +4.210523504138320e-01   +4.662126607098165e-01   +4.491188838776967e-01   +2.644146881369361e-01   +5.392692129226729e-01; +2.980671537262293e-01   +9.523710175145127e-01   +2.669231727000125e-01   +5.680047819200911e-01   +1.618012658375094e-01   +4.025369892350451e-01   -1.268293643794191e-01   +2.091877041548943e-01   +1.995442280125686e-01   +1.148832233767087e-01   +2.271611157096936e-02   -2.958973077717797e-02; +2.247441320598406e-01   +9.893099754245675e-02   +6.371044693537907e-01   +1.119630499282704e-01   -1.579605708565968e-02   +7.672694129395326e-02   +6.573463112169446e-01   +2.703183018739895e-01   +3.798150125673870e-01   +3.352078244187230e-01   +1.597674776756998e-01   +4.357193338850178e-02; +7.375326335562378e-01   +4.197737683806088e-01   +8.230824835900834e-01   +3.280511916364189e-01   +5.836868137683345e-01   +5.971456655072055e-01   +4.975433036322064e-01   +8.976950165194783e-01   +1.656593634480441e-01   +7.287462601079876e-01   +5.587011015953057e-01   +2.979089038097513e-01; +8.264117095619880e-01   +6.268513587938450e-01   +1.975873622640757e-01   +4.572479956931026e-01   +3.280567537781030e-01   +6.597079395633956e-01   +2.853202185182602e-01   +9.564868779679266e-01   +2.749830855597049e-01   +6.371109467761610e-01   +3.122786301682805e-02   +1.003082039583322e-01; +6.303829373819533e-01   +5.918960002124293e-01   +2.018136320082957e-01   +7.877006334817160e-01   +8.138197750513433e-02   +4.141576944355981e-01   +3.891938848816248e-01   +1.428972920740007e-01   +4.432170378804905e-02   +2.640968115067007e-01   +7.876794013390865e-01   +4.428503568302218e-01; +7.191702659105725e-01   +4.765490738950680e-02   +3.847587797048002e-01   +3.660955910029245e-01   +7.456844358691834e-01   +1.736410068635196e-01   +4.910631916093348e-02   +3.862529906181060e-01   +4.054239432307828e-01   +6.702212185405665e-01   -6.510469534787187e-02   +3.108501042897090e-01; +5.510242275253265e-01   +2.128881999971976e-01   +5.601033287262313e-01   +4.065730789496009e-01   +2.331766108904981e-01   +3.363901423722724e-01   -1.717856252633733e-01   +5.378560804876933e-01   +6.639569463686565e-02   +6.948322586121179e-03   +1.000000000000000e+00   -1.728340578804415e-01; +4.143674728449368e-02   +3.876453358637673e-01   +3.139651288990862e-01   +4.035768458825821e-01   -5.417467114318975e-02   +5.564309408419839e-01   -1.775534327484098e-01   +4.924109905786130e-01   +1.378277226193102e-01   +3.101763744839968e-01   -1.034907552483470e-01   +1.775485272727455e-01; +6.850052265220450e-01   +1.840152683638075e-01   +6.634187228927598e-01   +2.245587359658695e-01   +2.802181952624564e-02   +4.132856691244577e-01   +3.893377133403734e-01   +2.289146177463231e-01   +2.774875228927551e-01   +1.714061621551064e-01   +3.021036861270823e-01   +4.892605019648261e-01; -1.338444008591188e-01   +1.834905178966467e-01   +5.122164634216300e-01   -5.117725628163478e-02   +1.651577891625003e-01   +4.889185202643073e-01   +6.634635785011400e-01   +6.715602780532282e-01   +3.276922170180890e-02   +1.116059309159648e-01   +2.721571457023298e-01   +2.526570979606704e-01];
L2E_Input1_iAMPA_netcon = [+9.187236906589310e-01   +4.503702919679922e-01   +7.265122511848717e-01   +8.766498311727235e-01   +8.824183489083091e-01   +7.748697258232162e-01   +8.068538873432505e-01   +7.573125042728632e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +7.391168970683524e-01   +8.158628392358603e-01   +7.955599956112721e-01   +6.598569084097310e-01   +5.859760497284376e-01   +9.828842348414957e-01   +9.469148812001842e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
