function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.634973624926296e-01   +2.520540163625214e-01   +3.872018151711441e-01   +9.591066157423886e-02   +3.714134764356082e-01   +4.547984794197786e-01   +3.675248188625596e-01   +2.850316309845466e-02   -7.741262459383103e-02   +4.822185791894867e-02   +5.432673804444844e-01   +2.916256597834436e-01   +5.508678206542011e-01   +2.584196193207738e-01   +5.077669794324534e-01   +2.821171478991174e-01; +2.726346612700349e-01   +3.931441529719240e-01   +2.879669892574119e-01   +5.784695503182153e-01   +3.306123151214557e-01   +2.283546235837760e-01   +3.403447738983724e-01   +1.855467749426845e-01   -4.089296155155040e-01   +2.227550116024193e-01   +5.669295429230826e-01   +5.346192849382715e-01   +6.217441128867154e-01   +5.685705180839787e-01   +4.702247268065210e-01   +4.319782297493897e-01; +2.284455813826154e-01   +6.073102651634874e-02   +4.570996486321228e-01   +6.581750522116990e-01   +5.720095652670132e-01   +3.540910270494740e-01   +2.910959753619206e-01   +1.827547572504550e-01   -3.752163458493931e-03   +2.355455467327548e-02   +3.234830657529224e-01   +9.262621664746299e-01   -1.452199000626475e-01   +1.826913907220354e-01   +2.880402136181243e-01   +5.291395727484431e-01; -3.790894533258245e-02   +5.234857864452924e-01   +6.196763423096644e-01   +4.728469997712575e-01   -6.611437109663548e-02   +6.430288352663411e-01   +1.000000000000000e+00   +3.946716006313338e-01   +6.195107016793029e-01   +6.084711523774384e-01   -1.278606587560764e-01   +3.546440574594276e-01   +4.885763691511659e-01   +5.123481299052999e-01   -7.337401039358825e-03   +8.988303481140190e-02; -1.187013347839249e-01   +1.252996567940902e-01   +4.734006735290701e-03   +2.580306884251976e-01   +5.405833245108903e-02   +1.871713367946688e-01   +3.601567770880588e-01   +3.894756344957793e-01   +5.156498956092171e-01   +2.253040524520620e-01   +4.910924301416454e-01   +1.528210675094720e-01   +2.208966407947680e-02   +4.763294820203983e-01   +3.085697650785632e-01   +1.440546670482631e-03; +6.475286255360480e-01   +6.716528690899795e-01   +4.071816433271050e-01   +2.697828344878486e-01   -1.693318274850419e-01   +5.358142917939762e-01   +3.675221298471413e-01   +4.616977059785908e-01   -1.054301367622319e-01   +7.365298387484035e-01   +3.080817216979612e-01   +1.120447371494967e-01   +3.648176974292183e-01   +5.705118571611332e-01   +3.634725490884842e-01   +1.994769031074552e-01; +7.396467340296506e-01   +3.217051617741282e-01   +2.648767533315244e-01   +5.296766656234142e-01   +4.559924756658984e-01   +7.621751889711370e-02   +2.328602600808423e-01   +3.752064009440123e-02   +4.973742131832804e-01   -9.058362775055573e-02   +1.949991628531469e-01   +3.481248327055577e-01   +3.006697544822179e-01   +4.672643252205538e-01   +3.584203116366240e-01   +2.281743268874168e-01; +3.694626113733748e-01   +2.501000345304454e-01   -9.648552344576473e-02   +3.447417187882152e-01   +6.387737464332376e-01   -3.128974530619321e-02   +1.117566605759818e-01   +2.630861399408682e-01   +1.150950758869844e-01   +1.664397292833781e-01   +1.355200808248584e-01   +3.616324658644204e-01   -1.797833768534192e-01   +4.418454287092683e-01   -1.044330180675143e-01   +4.569483664362008e-02; +4.324412492146685e-01   +3.606107407107464e-01   +3.664418220402403e-01   +3.453505524573976e-01   +3.001307622048008e-01   +5.340195399884471e-01   -3.009462157433598e-02   +5.413026640951078e-02   +2.645849607052368e-01   +4.298251597898841e-01   +6.112392415875058e-01   +3.191299363905811e-01   +3.038773011409968e-01   +7.136165148427359e-01   +2.503457736691471e-01   -6.144576679431067e-02; +7.912851611050263e-02   +4.961693040902819e-01   +2.282222478024522e-01   +3.095730161593092e-01   +1.942385620712998e-01   +5.283725116706849e-01   +4.539734661037893e-01   +5.904101009408246e-02   +2.657510630342244e-01   -5.669885703362412e-02   +2.941216375233148e-01   +5.202976716841163e-01   +2.245073751993763e-01   -5.427376372945666e-02   +1.797701290067087e-01   +9.682570552403115e-02; +1.397408055230727e-02   -1.139313637217342e-01   +3.719606373199698e-01   +4.068612692408541e-01   +1.172059875502109e-01   +3.547859248906353e-01   +6.509853919037502e-01   +1.304725680713459e-01   +6.513909940785440e-01   -1.835066707062696e-01   +1.810391122249491e-01   +5.418401287953617e-01   +1.730883874920317e-01   +6.641626248314596e-02   +6.531012615584376e-01   -8.786367981744453e-02; -1.593312339680433e-01   +1.010782234543925e-01   +5.075621409055990e-02   +3.337729732204920e-01   +1.848614629187057e-02   +5.830110151090946e-01   +7.628777771139357e-02   +3.722670039644219e-01   +2.187174922808395e-01   +1.368315133990470e-01   +1.418086650815117e-01   +5.045858912967418e-01   +2.857844998833473e-01   -4.063654657724720e-02   +6.467903313493130e-01   +4.469657699141034e-01; -4.970479649334399e-02   -1.478571554691871e-02   +3.136120207069225e-01   +3.908052862095251e-01   +9.434053171941677e-04   +6.047748596693516e-01   +2.707467446289135e-01   +1.157800888250903e-01   +8.019975952558164e-01   +3.604114499453401e-01   +1.578758252585409e-01   +7.459997872478328e-01   +4.606949738221134e-01   +4.260110866050449e-01   +7.633551817689296e-01   +6.664424313548043e-01; -1.494945910133507e-01   +6.436565664590314e-01   +4.618894934864763e-01   +1.768856493696115e-01   -6.713726450613557e-02   +3.128606415649964e-01   +3.948984894574120e-01   +1.972396604170614e-02   +3.055410495496979e-01   +4.960875343256381e-01   +3.989411428564549e-01   +2.358504109098275e-01   +4.673413444448740e-01   +3.954467231042429e-01   +2.161885743356906e-01   +1.725741411999517e-01; +6.675987637960465e-02   +4.481524513326736e-01   +3.759396941965765e-01   +3.052418287536301e-01   +1.239842143587081e-01   +2.374150223453901e-01   +7.350261158880940e-01   +7.076964425594402e-01   -1.797563464220044e-02   +2.578806633637800e-01   -9.997653688732655e-02   -4.052141113378939e-03   +5.753762502631237e-02   +1.209170907161391e-01   +2.747232528449927e-01   +2.370613534356715e-02; +2.624698392334929e-01   +1.734789131816749e-01   +4.237531289802294e-01   +3.938232904529820e-01   +3.620837667167822e-01   +4.807461835675319e-01   +3.004590607269455e-01   +4.482275379612133e-01   +3.096311106739793e-01   +3.903587697086996e-01   -1.015219005183431e-01   +2.327069889753264e-01   +4.897114111842095e-01   +6.161247294589585e-01   +3.135086660097879e-01   +5.199911278273154e-01];
L1E_L1I_iGABA_netcon = [+4.040134170565449e-01   +9.995224816908664e-02   +1.415700969249654e-01   +1.798982553450702e-01   +5.084255810690327e-01   +6.114290388773085e-02   -2.502132761369965e-02   +4.089436273246129e-01   +4.701227070295669e-01   +1.136370794536502e-01   +6.972139812901051e-01   +5.018900850296573e-01   +5.715772641904488e-02   +5.290753972800097e-01   +2.546381916484352e-01   +2.810206483711154e-01; +4.230185594707795e-01   +3.962407085829257e-01   +5.971296487946900e-01   +6.020438738769714e-01   +1.513944885697363e-01   +1.906701643736806e-01   +3.319612662803260e-01   +7.984063003294986e-02   +2.749521899277368e-01   +3.190588153882704e-01   -1.051819758382606e-01   +2.867801574846036e-01   -3.714767805888677e-02   -1.688453623603411e-01   +3.946274319296195e-01   +2.314688365904978e-02; +1.316654734040518e-01   +9.841743846114155e-02   +1.244482314104830e-01   +5.391020636673177e-01   -2.458521588078241e-02   +1.860160850824482e-01   +3.570721810923863e-01   +3.252767304905589e-01   +3.029997514098532e-01   +1.227155006792562e-01   +1.712045320249677e-01   +4.367107198374777e-01   +9.253607565734655e-01   +3.834127903184224e-01   +3.612732728101699e-02   +3.546931282751837e-01; -2.227069295508485e-02   +7.121605446571547e-01   +3.385578354142524e-01   +1.301107810739573e-01   +5.164992105792124e-01   +5.514059644089921e-01   +4.264342209945817e-01   +5.960803572896363e-03   -6.096551955002694e-03   -6.491177408015812e-02   +2.267424907881063e-01   +5.008889805885659e-01   -2.876532848800415e-01   +3.416840785845518e-01   +2.971852567356719e-01   +1.413613820520535e-01; +6.153446977418005e-02   +1.087752235682784e-01   -2.142369197867008e-01   +8.555989585174942e-02   -3.872480574296025e-03   +5.879334880927869e-01   -2.597549570840340e-01   -1.785566925723684e-01   +6.749467298523604e-02   +2.404738190690727e-01   +3.205474160072158e-01   +6.138706404039155e-01   +1.697616608692403e-01   -2.992862677650977e-01   +4.179540447461076e-01   +9.803100500884312e-01; +3.081339883202899e-01   -6.722772386997930e-02   -9.747135239899174e-02   +1.559349698174173e-01   +1.056859278352804e-01   +4.349777829375606e-01   -4.252793445015197e-02   +8.196300999530295e-01   +2.389991937426936e-01   +8.699744344395463e-01   +4.212875845573607e-01   +3.905743807003358e-01   +4.086503242772384e-01   +3.482684075197393e-01   +4.686396827953542e-03   +3.251433137794552e-01; +1.648929672305092e-01   +1.120577425980387e-01   +5.461699649258035e-02   -4.624046257777709e-02   +3.282418939614342e-01   +2.949546744083553e-01   +6.656396446657110e-01   +7.350473550881106e-02   +3.838274005537061e-01   +6.201194081927563e-01   +1.377780331288576e-01   +6.720860368289751e-01   -7.927348467710840e-02   +3.926097645444722e-01   +4.157047647866481e-02   +4.615127961426808e-02; +4.906317484334402e-01   -1.464994648210129e-01   +3.382309777327529e-01   +6.454222659137659e-01   +2.658781818428040e-03   +6.961193329627039e-01   +1.539833163074327e-01   +4.409304124186593e-01   +2.337576715833408e-01   +3.062766757310153e-01   -2.060950706430194e-02   +5.644788512611869e-01   +3.579952272964134e-01   -5.873511547934605e-02   -3.791615345106102e-01   -7.531450137818865e-02; +1.597265687198316e-01   +3.311696213394675e-01   +3.342467757649474e-01   +9.472709342264424e-02   +5.638576071143176e-01   +8.204401158197860e-02   +4.715533684613734e-01   +3.284135090292520e-01   -2.094622204303666e-02   +8.019734120477474e-01   -1.078601238477658e-01   +1.623239663282374e-01   +9.028648124028074e-02   +2.643583078901985e-01   -1.063813437862478e-01   +1.919666347327498e-01; +7.919441979213507e-02   +1.346931256227961e-01   -1.545907727348488e-03   -1.070371227107910e-01   +5.169203197362353e-01   -1.758475165513197e-01   +2.564464816416591e-01   +8.948331019865564e-01   +8.822367894530148e-02   +4.513329522640162e-01   +1.951932289702728e-01   +4.989790474024403e-01   +1.546349010178582e-01   -4.631538989128478e-02   +2.060396904634275e-01   +7.656027287853330e-01; +5.828556821052733e-01   +1.586269204892800e-01   +5.023383070282981e-01   +7.087585390340662e-01   +4.758156581429677e-01   +1.858291424197722e-01   +8.013938972015432e-02   -7.891569704233239e-03   +5.519325267447013e-01   -5.642859715229417e-02   +2.302417794312505e-01   +3.842280084787760e-01   -2.116393175413788e-01   +6.112725235541839e-01   +7.735704136881243e-02   +2.019665844733838e-01; +6.530752759434667e-02   +3.725099098563581e-01   +1.047253911659169e-01   +6.681561538877517e-01   -3.738545870787001e-01   +2.701884396679962e-01   +1.420362245586549e-02   +5.428855160519989e-01   +6.326724836705151e-01   +1.354573674505242e-01   +4.683649829805636e-01   +6.986268275821379e-01   +2.887295701915313e-01   +2.570966722508640e-01   +1.771572479496676e-01   +5.309993504702150e-02; +7.867071952494048e-02   +4.887876329870737e-01   -1.315414376982307e-01   +4.394367766352857e-01   +2.178631568098253e-01   +4.274379079439545e-01   +3.194726758173578e-01   +5.237609063926001e-01   +5.933314727223749e-01   +4.725229141388531e-01   +1.973338865178623e-01   +2.119625803488115e-01   +2.386086138028162e-01   +2.863759843743383e-01   -1.338999409632197e-02   +4.604525849380554e-01; +4.642687250230217e-01   +1.473153056386995e-01   +3.903820140666275e-01   +5.611790312253215e-01   +3.853584126949022e-01   +1.853254681126411e-01   +3.480807125832388e-01   -2.571025836778265e-01   +4.660462978928588e-01   -1.958363633414589e-03   +7.547793470467529e-01   +7.990454818886856e-01   +5.126875395108674e-01   +4.633163322431004e-01   -2.077446752612968e-01   +3.857914983099617e-01; +9.443977788274088e-02   -4.987114487577552e-02   +1.007975532712358e-01   +1.212844150358164e-02   +4.008459654025368e-01   +2.489823839829776e-01   +5.292889251377366e-01   +4.101937473346483e-01   +6.852773155502495e-01   +3.695952213094655e-01   +2.757312088395955e-01   +2.191022009649074e-01   +3.301206955383452e-01   +1.197627008544114e-01   +2.872706700811075e-01   +2.217776914441592e-01; +6.761556126061014e-01   +3.419826083755605e-02   +5.016830853880778e-01   +1.740492901831648e-01   +4.936157340324712e-02   +2.977666172062962e-01   +6.162678586274069e-01   +1.402997042648415e-01   +1.859740305059607e-01   +4.158103180460822e-01   +5.304256565662673e-01   +1.839098384651542e-02   +6.743143946195294e-01   +6.025157246528592e-02   -2.815173956273498e-01   -5.696108413751270e-02];
L2I_L1I_iGABA_netcon = [-1.321337286111356e-01   +5.369391990035899e-01   +5.389229283871066e-01   -6.448943837006062e-02   +3.946705950223692e-01   +2.929898211263615e-02   +2.281035115134474e-01   +3.354943690967504e-01; -2.130470341595701e-02   +2.995111383348186e-01   +4.699755979165630e-01   +5.629825916510942e-02   +4.651969277486847e-01   -5.668894391844306e-02   +3.152669021955641e-01   +7.837065345295958e-01; +6.218064501899043e-02   +1.274674714806794e-01   +6.760960335747457e-01   +6.020573377403780e-01   +3.629814063616920e-01   +4.860516085741171e-01   +1.083336063462021e-01   -4.287394543482907e-02; +4.704888172247887e-01   +3.565597683352492e-01   +4.677532392952313e-01   +7.485992386548052e-01   +1.898366284468308e-01   +2.524125359170079e-01   +4.579712278613218e-01   -1.523370497486111e-02; +9.564034424758253e-01   +7.845591455948696e-02   +3.074971447776152e-01   +1.554796635719581e-01   +4.324625507261843e-01   +2.713123803921577e-01   +7.341447076164079e-01   +9.001597407356775e-02; +2.700585245876662e-01   +5.507451929237042e-01   +4.626534713554398e-01   +4.910992016848944e-01   +6.530527046380443e-01   +6.900895157226300e-01   +3.811779067027166e-01   +6.444227130096237e-01; +5.784399892146510e-01   +6.030865189608827e-01   +2.432117772448448e-01   +8.649526112398026e-02   +7.375017668372023e-01   +4.217656072024944e-01   -1.556505479858108e-01   +4.966521210555307e-01; +6.479164334083286e-01   +1.660959311619372e-01   -5.201305830623211e-02   +3.863505101862195e-01   +6.700478157962658e-01   +6.000829909564457e-01   +5.996282246812094e-01   +2.617382754085170e-01; +5.528536099055410e-03   +2.595451641049308e-01   -9.611510605279096e-02   +1.948779427794101e-01   +5.672207750352133e-01   +6.301681920476283e-01   +3.136755071532341e-01   +7.992067710953321e-02; +4.392363101984738e-01   +4.754544918921931e-01   +4.046749642778331e-01   +2.933455792208017e-01   +5.476171926104723e-01   +1.317222712040265e-01   +5.808700257507514e-01   +3.282322405801403e-01; +4.719525411857768e-01   +1.048637422715305e-01   +7.283684053057112e-01   +5.710522230719950e-01   -1.146026425591894e-01   +3.011589036470192e-01   +4.089201052164132e-01   +2.772524033487287e-01; +5.076788847255763e-01   +1.205862302479404e-01   +3.747850813789704e-01   +3.605640218025815e-01   +3.964271334133649e-01   +3.723064961026697e-01   -5.746297905609745e-02   +1.374235371618718e-01; +7.127004962849506e-01   +6.919526043386889e-01   +2.416196568973857e-01   +2.633596122167990e-01   +3.360745169356311e-01   +1.802844493968979e-01   +4.424957743233846e-01   +6.061869637199202e-01; +1.674980224829357e-01   +7.843898175175277e-01   +2.168047841345298e-01   -1.849351530893803e-01   +7.183500854607829e-01   +6.958639401243860e-01   +6.717030811808493e-01   +4.743917002570703e-01; +3.703854932297791e-01   +5.325444560812251e-01   +4.785558335794147e-01   +3.026060188837109e-01   +3.293325899577615e-01   +3.860619669205453e-01   -3.673945438468220e-01   +5.057689105335927e-01; -1.857038595869208e-02   +5.016147719551685e-01   -5.422159451860031e-02   +7.433571190706545e-02   +5.334645303272775e-01   +2.361914275575180e-01   +9.148120415595962e-02   +4.259578115107886e-01];
L1I_L2I_iGABA_netcon = [-5.270231954641657e-02   +8.333878590075426e-01   +4.428563595569088e-02   +1.195247793566019e-01   +8.811830117832653e-01   +7.508839309765242e-01   -1.353219271313690e-01   +1.895712765222446e-01   +3.570698347372065e-01   +4.513772213645403e-01   +4.429168425234770e-01   +5.322486360832668e-01   -2.751946912992175e-01   +4.881193465921992e-01   +2.821123999877331e-01   +7.295576947878433e-01; +7.722868329190865e-01   +8.342900075807567e-01   +5.008816311657557e-01   -9.875946588866596e-02   +6.444785487287544e-02   -2.453939369924922e-01   +1.233792326351743e-01   +6.463043499310427e-02   +2.738679695984509e-01   +7.824197549859940e-03   +3.282517409179944e-01   +2.158758489399595e-01   +7.304751033100116e-01   +4.284536776839167e-01   +8.716784595174041e-01   -4.142005487690816e-01; +5.518361277323974e-01   +3.829666097489622e-01   +6.366397683981265e-01   -1.161944558392778e-01   +6.735651422077282e-02   -7.813213750644317e-02   +6.396026399307877e-01   +1.946447470585986e-01   -1.665761602455086e-01   +8.850878123039753e-01   +3.274831271947853e-01   +6.364398158713876e-02   +4.510009178250997e-01   +5.049972416638705e-01   +1.238986983191680e-02   +3.451987415352292e-01; +4.855679411292896e-01   +2.263299477332845e-01   +6.715158264955494e-02   +2.801329488179289e-01   +7.680495852322461e-01   +8.972044256097644e-02   +1.383542159241476e-02   +2.038472127589600e-01   +6.695851306437497e-01   +2.947930172610843e-01   +2.928658513430593e-02   -1.273268534598568e-01   +2.949774787198985e-01   +4.772966290177137e-02   +4.489599988895962e-02   +6.111753825355223e-01; +7.496221337726325e-01   +7.325595768415609e-01   -3.556798776053822e-02   +9.093332943863633e-01   +3.311292896339902e-01   +7.899108125041038e-02   +3.226840697324900e-01   -2.964454148064657e-01   +4.912053023159941e-01   +3.655425671454406e-01   +5.864998841247359e-01   +9.892474256878502e-01   +5.585022115856082e-01   -7.847504644234952e-02   +3.273151248195527e-01   +3.953172786805199e-01; +1.319985423995554e-01   +8.236329781352812e-02   +2.964224601387999e-01   +1.563489398918770e-01   +2.830874733245802e-01   +4.587109946564952e-01   +5.560581422448224e-01   +4.156826181008052e-01   +5.468999390473495e-01   +4.710566733400043e-01   +6.515604778958825e-01   +6.931656069650342e-01   +3.167223995883141e-01   -9.344540414049725e-02   +3.848397402332158e-01   +5.806785071370650e-01; -1.354936740595768e-02   -1.322436176756480e-01   +4.327157761035921e-01   +3.855846048558538e-01   +2.667646130570039e-01   +4.494459214980553e-01   +1.703963478831481e-01   +2.180519384738648e-01   +1.067156276884874e-01   +3.047942336792339e-01   +2.277584613515338e-01   +1.750931790262078e-01   +2.656507151529153e-01   +3.543543209681329e-01   +4.519819183428757e-01   -4.171836716769672e-02; +4.299540787083873e-01   +7.637977822162312e-01   +3.597246543301778e-01   +6.135746189197074e-02   +5.993460357274544e-01   +6.105976977933416e-01   -9.695079506573293e-02   +1.798783883507668e-01   +3.305379932350385e-01   +5.607141354374220e-01   +2.299902867036992e-01   +8.257968196016917e-01   +5.128371257678170e-01   +8.954570336533170e-01   +2.828928524088015e-01   +3.944986757183167e-01];
L2E_L1E_iAMPA_netcon = [+2.909163470312366e-01   +5.386867198650160e-01   +5.224058186629229e-01   +3.761376450504518e-01   +3.328978013948988e-01   +6.926110014159759e-01   +3.288235298705016e-01   +1.931789760117519e-01; +8.272336480202326e-02   +2.574938857339548e-01   +2.786939635948322e-01   +9.726250889890810e-02   +4.008201542949478e-01   +2.757377724537209e-01   +4.515457609195292e-01   -3.211988414562237e-02; +1.952977823298092e-01   +2.516875350279573e-01   +6.924394696689072e-01   +3.463477014491080e-01   +1.474654452602743e-01   +6.789821064382856e-01   -3.548475778575431e-02   +5.901620914710600e-01; -3.569832879282658e-01   +2.691073763971334e-01   +6.241004085437842e-01   +1.822913400146420e-01   +1.688493991525957e-01   +5.276758483668587e-01   +3.180672945409639e-02   +1.282473014552896e-01; +8.120225417852429e-01   +8.185467004923738e-02   +2.936759637000220e-01   +5.502563145699709e-01   +3.397041208332174e-02   +4.782093970959382e-01   +4.011353361683741e-01   +7.128449301491332e-01; +3.609969215882675e-01   +1.750901572168255e-01   +5.531222344637954e-01   +5.447142246326769e-01   +3.050674187086026e-01   +7.130893457719890e-01   +5.404335812567900e-01   +4.746030101602186e-01; +4.182858743663723e-01   +4.770433620900758e-01   +7.911539584470604e-01   +3.533973424870710e-01   +2.638461516329448e-01   -1.560509142644804e-01   +1.816766218428408e-01   +7.161400294613411e-01; +3.999488288951948e-01   +4.877834921090506e-01   +5.038476814569994e-01   +3.482497089416737e-01   +1.967018896031253e-01   +1.000000000000000e+00   +1.684672698086856e-01   +5.560325328349413e-01; +5.368679600990663e-02   +1.246745164854863e-01   +3.777237673664138e-01   +3.534995832654190e-01   -2.630705147248242e-01   +4.055854678867472e-01   +1.033627211414079e-01   +5.718027456683655e-01; +4.070193684000620e-01   +1.884207260295062e-01   +4.782741362120861e-01   +2.256768427763872e-01   +2.480416797722308e-01   +4.197713397996679e-01   +7.403756665500592e-02   +5.814132369485671e-01; +8.794399000153287e-02   +5.461015542529821e-01   +5.421404720490406e-01   -4.576065620095860e-01   +2.454641764405200e-01   +4.172686987123763e-01   -3.668686442135000e-01   -1.284945193241802e-01; +2.753307619479895e-02   +3.969516960804041e-01   +4.309999705577032e-01   -1.585320688304041e-01   +2.460703535076356e-01   +5.514050490593552e-02   +6.716873803009196e-01   +3.381622729614082e-01; +3.143698216584660e-01   +6.907129848505474e-01   +7.255483719506536e-01   -2.912665019196080e-01   +3.910455913177006e-01   +4.834757380582299e-01   -2.055668725792155e-01   +7.140823017909439e-01; +1.838298246497836e-01   -4.485430469697029e-01   -8.434217897162545e-03   +3.138460409646964e-01   +3.762397398815497e-01   +6.214336891544886e-01   +4.583301134819569e-02   +2.537148777265125e-01; +2.468217236427257e-01   +3.194667655492593e-01   +2.704399751773007e-01   +1.454832342359498e-01   +1.041327522022001e-01   +1.414564672242425e-01   +2.652515249553489e-01   +2.436518377614323e-01; +2.543240690571421e-01   +7.012848827866963e-01   +2.050300171519255e-02   +8.503170462884195e-03   +4.417337948383451e-02   +2.007767117701820e-01   +2.734155763426098e-01   +3.588761076180553e-01];
L1E_L2E_iAMPA_netcon = [+4.646917399329042e-01   +2.145122947071966e-02   +2.754078343190912e-01   +5.371937671755977e-01   +4.560121064190580e-01   -3.713688917625372e-01   +4.232109542278884e-01   +6.644065891244081e-01   +3.738200432801864e-01   +4.709934325314494e-01   +3.528814731377741e-01   +1.000000000000000e+00   -1.399039771552769e-01   +1.546602339793535e-01   +5.529331664451231e-01   +1.560119781283262e-01; +4.429509555360771e-01   -9.541676306882898e-03   +4.115395484085151e-01   +4.293065181831848e-01   +1.909451598588314e-01   -2.007223786114649e-03   +2.518183100372068e-01   +5.006602498651091e-03   +6.728402449080476e-01   +9.871988217157194e-01   +4.720265619418010e-01   +1.167414968330769e-01   +6.031890237880307e-01   +6.910083367368214e-01   +5.131088498810359e-01   +3.873796601450881e-01; +4.427409876081701e-01   +5.789188682631914e-01   +1.105329245808945e-01   -5.957140212514581e-02   +4.314428842685084e-01   +5.788408716016766e-02   +5.859672431706036e-01   +5.768339626138120e-01   +6.205299064437576e-01   -9.352807676515648e-02   +6.669981462204606e-01   +1.118078549796017e-01   +4.050964602177511e-01   +1.303861225320628e-01   +2.390537552670482e-01   +1.922550856931477e-01; +4.861965598618062e-01   -2.974581303225389e-02   +2.349633097519489e-01   +4.600722339875881e-01   +2.636039619993631e-01   +1.280078607025176e-01   +1.387608110964934e-01   +4.335453656367916e-02   +7.763894402418597e-01   +5.008829352662344e-01   +2.190443472567094e-01   +1.979521478176514e-02   +2.172262553440280e-01   +5.340425883941297e-01   +4.664459962123340e-01   +1.540780985387978e-01; +5.318061696365270e-01   +1.871655687699297e-01   +5.244904414752092e-02   +4.444407191140102e-01   +4.086826406452443e-01   +5.595250075014518e-01   +4.187086488866393e-02   +1.743221304526914e-01   +3.017290065446928e-01   +1.111083654282430e-01   +4.072095126786464e-01   -4.073197479152893e-03   +4.009612489768462e-01   +4.865287342301816e-01   -1.715067435022277e-01   +4.218849105029174e-01; +3.239864971834832e-01   -1.827864278541493e-01   +4.810186136966404e-01   +1.585319354357150e-01   +1.965631657359425e-01   +1.772802858947597e-01   +3.474742818301191e-01   +8.242674710304078e-03   +3.556474584035915e-01   +1.595923771644204e-01   +2.548610515741764e-01   +6.395504635358850e-01   -1.844909222580483e-01   -1.962378500934775e-01   +1.516927044127580e-01   +5.323299967307479e-01; +3.208425159828047e-01   +3.944781589761432e-01   +3.457507023395328e-01   +7.638057662899821e-02   +9.374427917962512e-01   +5.234031744248367e-01   +1.033808273352155e-01   +6.450326428344264e-01   +4.195561468511582e-01   +5.403297282298846e-01   +4.268161160570634e-01   +3.496763016798575e-01   +3.606126939240482e-02   +3.340247017972126e-01   +6.300186732506848e-01   -1.302934095642253e-01; +4.091556661915557e-01   +3.686770213643255e-01   +6.568361129198721e-01   +9.292595232496895e-02   +7.740738031821529e-01   +3.682628679542569e-01   +4.980539104330258e-01   +3.043396241900627e-02   +3.853276966612826e-01   +3.777301355291487e-01   +3.673859002920918e-01   +1.940173184269563e-01   +5.926017096203282e-01   +7.015185845459455e-01   +5.095287996070949e-01   +2.963600928399711e-01];
L2I_L2E_iAMPA_netcon = [+5.211596594878933e-01   +1.000000000000000e+00   +2.608901242439737e-01   +4.434481545798215e-01   +7.689157650550891e-01   +5.081148214661276e-01   +8.539846142414289e-01   +1.869972802416765e-01; +7.332681731803388e-01   +1.517782926299274e-01   +2.716272993085972e-01   +1.194146241456324e-01   +3.908526037481982e-01   +1.562658920051829e-01   +1.868247636727041e-01   +8.784031195585547e-01; +5.904524293079707e-01   +2.595028702930715e-01   +4.941486621066450e-01   +2.335601055548654e-01   +3.553450022141392e-01   -1.197849587064478e-02   -7.653856844930085e-02   +7.236000372962166e-01; +9.499079157107970e-02   +6.525550000587430e-01   +3.325400358616429e-01   +3.911893638977112e-01   +6.687212716371229e-01   +2.079243398837143e-01   +2.383772217369955e-03   +4.842059552842321e-01; +3.979102466471739e-01   +5.499093342975431e-01   +5.571190305223915e-01   +9.001347916828720e-02   +5.288939658509433e-01   +1.024830206403312e-02   +2.183224537117322e-01   +5.208272124152887e-01; +1.291851572196545e-01   +1.685852148067193e-01   +5.110070779109347e-01   +2.008504402016495e-01   +7.353103555824958e-01   +5.186995573965278e-01   -5.983199886073383e-04   +4.909353649908285e-01; +3.019779471487124e-01   +3.838666245892336e-01   +7.223800014205742e-01   +3.819972263967178e-01   +4.018774255153680e-02   +1.254414629103007e-01   +3.596724345490910e-01   +6.823535884064030e-01; +3.797285951742198e-01   +3.717229033507779e-01   +2.618455927701645e-02   +5.869162367690927e-01   -6.715010048892030e-02   +5.158253503330306e-01   +2.943573103684787e-02   +4.024661102645478e-01];
L2E_L2I_iGABA_netcon = [+3.987957336454173e-01   +4.311671667974981e-01   -2.424676239353678e-01   +7.312871871968111e-01   +3.104237559331478e-01   +5.222323778572302e-01   +4.144798632616790e-01   +2.954682208174932e-01; +4.043677471670424e-01   +5.680799237005580e-01   -3.037120439358319e-02   +1.711919305008898e-01   +3.123364013844613e-01   +3.363462129933834e-01   +1.848713592597629e-02   +5.456735589069774e-01; +3.509162814210560e-01   -1.138583068489286e-01   +2.290706806134329e-01   +4.021161365919468e-01   -5.194225929045547e-02   +2.276489328644286e-01   +2.258117475185995e-02   +2.600407645444808e-01; +1.392317978270585e-01   +2.122319163631639e-01   -2.852909138284550e-02   +4.690133783812668e-01   +4.615657980801361e-01   +3.723846681121637e-01   +3.650534264138732e-01   +4.856627289814384e-01; +5.721168626284629e-02   +3.658425690379841e-01   +2.788965027830719e-01   +1.973691121762371e-01   -3.190228435487340e-02   +3.897759792460141e-01   +1.938466506247936e-01   -1.565432980575514e-01; +2.521044538192472e-01   +6.650526138136091e-01   +1.000000000000000e+00   +9.107182496917839e-01   +4.314308273781781e-01   +1.300907349239578e-01   -4.063868735686296e-02   +6.039517551037301e-01; +5.168144426537543e-01   +1.023832144831710e-01   +7.377674016423878e-02   -3.742682239943511e-02   +2.365715808025112e-01   -3.348493937136177e-01   +2.393484748754811e-01   +3.126723051860885e-01; -2.642336870652690e-01   +3.604808012958688e-01   +4.532745077449285e-01   +3.206752123008316e-01   +7.461837674024460e-01   +3.647570669461448e-01   +5.713963964923768e-01   +5.790657013134638e-01];
L3E_L2E_iAMPA_netcon = [+1.790089875588470e-01   +4.683518132909121e-01   +5.354032313477727e-01   -3.398459572411381e-02   +4.371555849226223e-02   +5.746813151491432e-01   +7.745247566664828e-01   +2.628006347413526e-01   +5.156327305883616e-01   +4.450968257758123e-02   +3.015743809877848e-01   -1.438471769081822e-01; -2.650723865023681e-01   +7.292159186834715e-01   -2.987437071049309e-01   +7.618910064412311e-02   +2.260543505334266e-01   -5.765873857879050e-02   +2.493042168064500e-01   +2.089028865166014e-01   +5.663056146902052e-01   -9.287923480951002e-02   -1.418361630556462e-03   +2.170131689864426e-01; +2.836840503105640e-01   +1.153634820808469e-01   +1.691863494390047e-01   +1.747548823026816e-01   +2.463439817459360e-01   +7.226211001408762e-01   +2.891747103586942e-01   +5.181797219938622e-01   -2.440332820364915e-02   +1.710471525377142e-01   +3.053992325070989e-01   +7.162016232775323e-01; +4.351528357103386e-01   +5.254251511158724e-01   +5.129562646105541e-01   +4.632510519376921e-01   +2.679735069143903e-01   +7.355057821166575e-01   +2.642237153261309e-01   +1.816603881783287e-01   +4.717890851140049e-01   -6.056015787387060e-01   +4.578126705777811e-01   +1.000000000000000e+00; +2.314763504254637e-01   +4.082846184461810e-01   +4.614272006097834e-01   +2.718380277367984e-01   +2.490640077413794e-01   +2.741406658540806e-01   +3.348450602118664e-01   +9.300787342198781e-01   +5.395028050073321e-01   +2.982362017295539e-01   +5.902913078421246e-01   +1.848206110136640e-01; +1.184560163234521e-01   -1.522929539399083e-01   +7.778006516891997e-01   -2.221457183297738e-01   +3.727487966168470e-01   +5.502140924372966e-01   +2.620856423091504e-01   +2.471733643157867e-01   +5.257368912708231e-01   +3.843589722935106e-01   +4.161328279854651e-01   +3.860679624443878e-02; +1.066617565861653e-01   +1.980585363521952e-01   +1.403772733414279e-01   +4.578141638107094e-01   +9.415255509156887e-01   +6.634865553142358e-01   +8.155015201291470e-01   +5.041250159620057e-01   +5.049125110451502e-01   +3.886172385682268e-01   +3.479841931353481e-01   +7.832255946382699e-01; +3.470629395967812e-01   +1.357644481502257e-01   +3.165238304558882e-01   +6.526292030733857e-01   +3.535363530884140e-01   +6.844190605899508e-01   +6.888001576223334e-01   +4.445783146857962e-01   +4.535002317928489e-01   +3.401096165816094e-01   -9.528746295624733e-02   -9.303869723826640e-04];
L3I_L2I_iGABA_netcon = [+6.287029268872382e-01   -8.174950703706790e-02   +1.660845817586992e-01   +7.239066115044311e-01   +4.184242317415490e-01   -1.221427951582173e-01   +2.753056862596033e-01   +2.503917414802798e-01   -2.689060008218644e-02   +1.243237100373996e-01   +2.370290526036435e-01   +2.829607632051557e-01; +7.665623182035665e-01   -2.190824647118908e-01   +1.650222299433709e-01   +2.634622801851046e-01   +6.394539764208070e-01   +5.522766840621386e-01   +2.744306138690253e-01   +5.063588853363844e-01   +9.230436569321200e-02   +2.486775388467463e-01   +3.588869099479463e-01   +4.597944183379049e-01; +5.808099947566522e-01   -4.270301286976973e-02   +3.798503079483086e-01   -3.833552607207204e-01   +3.023383936117467e-01   +4.751878326835280e-01   +5.828648262365842e-01   +2.177210495152521e-01   +1.974639114752251e-01   +5.114350182993372e-01   +4.632935170953125e-01   +1.000000000000000e+00; +5.654060150585981e-01   +1.935141936729785e-01   +4.758269912970449e-01   +7.692280567768295e-01   +4.947814793376952e-01   -3.963787164988470e-01   +5.462852545277633e-01   +2.427481134179066e-01   +6.338398913948473e-01   -6.342961063234416e-02   -1.617779183188510e-01   +3.668116088387158e-01; +5.420190215737573e-01   +3.866293426450716e-01   +6.950735922805260e-01   -2.112746878857772e-02   +6.186699603827945e-01   +6.647559807858566e-01   +5.268153642922311e-01   -8.186962480695947e-02   +1.587210418477039e-01   +3.998600187795625e-01   +5.074825270657003e-01   +6.210457478024435e-02; +4.283936097491512e-01   +1.051705122912018e-01   +5.380031378197037e-01   +9.050166120640225e-01   +7.548971962589884e-01   -8.677572305134178e-02   +3.254156790450135e-01   +5.743144876387671e-02   +3.573109479740916e-01   +3.538880286181289e-01   +7.975128570010179e-02   +2.784303818697821e-02; +6.558746630527417e-01   +1.747440502203333e-01   +6.246690353073384e-01   +1.196421859789588e-01   +1.825641650299473e-01   +4.400730690963119e-01   -8.248949493929307e-02   +2.983837020305417e-01   +5.604749953088475e-02   +8.492862566366129e-01   +3.298510958989653e-01   +3.189933309563397e-01; +2.871456486154096e-01   -1.185964593344370e-01   +3.264976165803522e-01   +4.558063558474434e-01   -6.573351735448678e-02   -6.278795242839814e-02   +2.739521913835781e-01   -1.320202236752290e-01   +1.823486493200452e-01   +6.676131072662426e-01   +3.536242224948215e-01   +4.488882162548935e-01];
L2E_L3E_iAMPA_netcon = [+1.045392257196694e-01   +1.000000000000000e+00   +3.947656420841987e-01   +5.810930531363057e-01   +1.616847939461394e-01   -1.450248821984106e-01   -1.540201901999297e-01   +2.271679103204058e-01; +3.518268135609270e-01   +2.298090879065390e-01   +5.384742149328684e-01   +2.399124378185071e-01   -1.530693024006908e-02   +2.678765638002739e-01   +4.034825849154959e-01   +5.263076006364625e-01; -9.610968679746833e-02   -2.371324214726356e-01   +6.208777516177092e-01   +5.639956193009134e-01   +5.216741598831790e-01   +3.659346448635271e-01   -4.054948297798726e-02   +1.807697027388782e-01; +1.544973157376262e-01   +4.052012177764548e-01   +4.833440328372368e-02   +7.329547560678723e-01   +6.925542052864512e-01   +3.161536284455963e-01   +4.582485631647439e-01   +7.511846627201531e-02; +4.246308256940158e-01   +6.041145762856679e-01   +1.974911956152437e-01   +6.919600920861997e-01   +5.626709644014780e-01   +4.011367494574881e-01   -3.359199124358972e-02   +6.931373581089030e-01; +8.973300714848735e-01   +4.636017263122022e-01   +3.572525488382538e-01   +1.018056990940663e-01   +4.780401675691906e-01   +4.590498828813466e-01   +5.582453219143064e-01   +4.827090459264491e-01; -5.036107547809019e-02   +3.328532773135467e-01   +2.713008031687921e-01   -1.859199534063855e-01   +6.098504527088852e-03   +1.785516589071444e-01   -1.059600166344117e-01   +3.516939444619445e-01; +5.041197041063883e-01   +2.150114145789799e-01   +8.077610372330023e-01   +9.064098970365667e-02   +2.768321918921864e-01   +2.476642820595659e-01   +4.416768050813847e-01   -1.793971506228848e-01; +1.161408121114278e-01   +3.726946839904847e-01   +2.809265733193185e-01   -7.166763262285597e-02   +1.848036583569445e-01   +6.900386228272522e-02   +2.564721005395673e-01   +2.249655915780809e-01; +1.603977728434197e-01   +4.956415831764154e-01   +5.507553938372725e-01   +3.382569819599108e-01   +3.247570406470002e-01   +3.298104217697073e-01   +6.876363339966696e-01   +3.490133177396898e-01; +3.736133805529050e-01   +6.981696650047218e-01   +8.066656814574933e-01   +1.073607214395040e-01   +1.557878942881752e-01   -2.495482318660758e-01   +6.800975372033393e-01   +9.674688377335765e-02; +7.135452701943773e-01   +2.803177570731086e-01   +1.053455012564485e-01   +7.069733501779569e-01   +2.546761647683870e-01   +3.332359285622675e-01   +3.508943722778680e-01   +4.659575902100650e-01];
L2I_L3I_iGABA_netcon = [+2.206060136516341e-01   +2.450308759515778e-01   +5.446063670225317e-01   +3.382916335611714e-01   +2.305467610036036e-01   +4.073299211834243e-01   +6.896380917250462e-02   +2.925851087869874e-01; +1.263601283728858e-01   +6.021842633192442e-02   +6.684510612775868e-01   +1.664434609633109e-01   +1.870586105813182e-01   +4.349933194874264e-01   +7.178076798312402e-01   +5.753248576764330e-01; -1.196707793834464e-01   +2.567831340544435e-01   -2.287540670866622e-01   +4.282948289971475e-01   +2.722686669289507e-01   +8.467784989102183e-01   +3.119147880406248e-01   +1.979825177049846e-01; +2.631550141021620e-01   +2.070680286501943e-01   -1.775594467068076e-01   +2.655892102409514e-01   +5.728350150660235e-01   +7.855651684885030e-02   +1.344790810727230e-02   +3.141612833063416e-01; +5.537325609801536e-01   +2.264685952985173e-01   +4.074754827036424e-01   +6.097257527833060e-01   +2.116972810962615e-01   +5.126109204309776e-01   +1.411799733441881e-01   +1.544912314749099e-01; -3.416999560527275e-01   -2.819516555386852e-01   +4.400601584961631e-01   +4.231219280545607e-01   +6.528634572003756e-01   +2.251540267842505e-01   +3.425996448867473e-01   +2.568297387614432e-01; +1.853858896648319e-01   +3.205836786667350e-01   +2.283643267064490e-01   +4.653207017378997e-01   +2.765382394626512e-01   +5.187270937926836e-01   +4.804775615839051e-01   +1.000000000000000e+00; +6.022621770762719e-01   +6.494200251433933e-01   +2.452388770398895e-01   -1.201370787024480e-02   -2.140414210264024e-01   +8.325336786940918e-02   +3.457290007567261e-01   -1.743452181044991e-01; +5.559190016798706e-01   +2.661967828535610e-01   -1.778518070426914e-01   +1.675735809660337e-01   +3.991420543983523e-01   +9.924716752499334e-02   +3.867793421728959e-01   +1.970040204411531e-01; +1.865624137812178e-01   -5.319120348563998e-01   +5.367376703624182e-01   +3.304834144385308e-01   +7.234109493633458e-01   +4.336003845382019e-01   +4.354697929471095e-01   -2.203590314880524e-02; +4.281212195930003e-01   +2.816700238557781e-01   +5.787281046636019e-01   -2.070505655642992e-01   +3.196478594437728e-01   +2.567705159886640e-01   +4.260063453362503e-01   +1.964072524211864e-02; +6.729997259080430e-01   +1.869020718877023e-01   +1.144326309173108e-01   -1.943237284717345e-01   +4.785402913065650e-01   +6.853777253210008e-01   +1.864656799986905e-01   +1.089999585932768e-02];
L3I_L3E_iAMPA_netcon = [-5.464116817919566e-02   +1.335833053442752e-01   +1.079848157477375e-01   +7.616251436521019e-01   +5.282616108344775e-01   +3.662012874033647e-01   +9.781681385425930e-02   +3.035421204702104e-02   -9.556963771124902e-02   +1.168992212400757e-01   +5.837044372765952e-02   -1.987010436860593e-01; -1.568943260545955e-02   +4.365517001058476e-01   +8.155285889793844e-02   +2.691630674102998e-01   +3.049654201170844e-01   +3.471074906441807e-02   +6.060563686493132e-01   +4.448551418971894e-03   +2.078099143635353e-01   +4.615465891790018e-01   +2.342926918968116e-01   +7.005446491319537e-01; -9.358566465105833e-02   +7.002508348781911e-01   +4.365328322632309e-01   +4.688522084954003e-02   +1.462147737428593e-01   +4.511208329681510e-01   +4.822706937418739e-02   +2.777702780289213e-01   +2.452252866054101e-01   -4.326684211568911e-01   +3.619160908188554e-01   +1.757207106083920e-01; +1.618560038647269e-01   +3.790906393814122e-02   +3.244221933692621e-01   +6.411191455122699e-02   +3.474884555933030e-01   +7.227518182709919e-03   +1.593905336488631e-01   +2.727959253897094e-02   +4.339719683173720e-01   +4.016158724396436e-01   +1.732512143905988e-01   +1.194896578760207e-01; +1.340370241146369e-01   +8.454304124890816e-01   +2.729862281095686e-01   +1.571596625673642e-01   +4.006832406765651e-01   +3.786853486878062e-01   +1.634299215747971e-01   +2.528531437503326e-01   +5.264410242721717e-01   +1.425011643041519e-01   +3.790884725204610e-01   +1.751840509158718e-01; -1.632617319169674e-01   +2.210993434842869e-01   +8.263271533788429e-01   -7.347385398984890e-02   +3.163658102125658e-01   +5.225536222296603e-02   +1.396638127624916e-03   -1.006443399910327e-01   +5.493707097571470e-01   -2.946439370141035e-01   +2.386761419371338e-01   +6.822661827709493e-01; +1.310924823668911e-01   +5.985816479675041e-01   -1.196137010272032e-01   +3.129137841220090e-01   +3.254454446369652e-01   +3.287139753803432e-01   +9.534854863460862e-02   +3.707511915735949e-01   +5.658414623490815e-01   +5.263221949149666e-01   +1.373409342253371e-01   +7.155848817247029e-01; +1.086463503162996e-01   +3.297366983470551e-01   +5.749845310781028e-01   +5.983976613183453e-01   +8.250690014716285e-01   +1.463289357997744e-01   +8.189247332736755e-01   +2.760163738342664e-01   +9.068139644792227e-01   +3.660143465058801e-01   +3.416669957804961e-01   +2.663222571862885e-01; +4.689350882682283e-01   -2.179392182173134e-01   -2.380725536420761e-02   +4.914126085293814e-01   +5.937112826051524e-01   -1.469732616425826e-01   +8.658184356366160e-02   +4.719650511714048e-01   +3.968191559545049e-01   +6.927286361879441e-01   +2.090319476683020e-01   +1.733478450534625e-01; +3.053316664722641e-01   +1.794289516138630e-01   +4.827148601373407e-01   +5.957678485077352e-01   +1.324754878488208e-01   +1.634445839198013e-01   +4.343051724363325e-01   +5.751494235988460e-01   +2.488775014650611e-01   +1.890798568241223e-01   -7.160187504050574e-03   +5.837055244891985e-01; +2.611956547340177e-02   +5.297213495258266e-01   +2.726797569613157e-01   +4.369763009511711e-01   +6.142567303865929e-01   +2.828410654399900e-01   +4.439316715355783e-01   +4.894477945372467e-01   +8.497819343653779e-02   +4.148941407771530e-01   -1.464134212238739e-01   +5.856297658084412e-01; +1.457251820904230e-01   +1.060636322038427e-01   +3.836009831202470e-01   +6.232140069069814e-01   +7.074035818968591e-01   +1.274753864694121e-01   +5.146748288040320e-03   +3.073308061687104e-01   +6.268043702089368e-01   +2.168788334857580e-01   +1.944591214132146e-01   +4.401976346738763e-01];
L3E_L3I_iGABA_netcon = [+1.936322051481796e-01   +2.807466372862630e-01   +3.887714611857289e-01   +5.938037880217226e-01   +7.557935049690727e-01   +3.099295491110086e-01   +3.763399127667123e-01   +5.253331903264687e-01   +5.511855426035204e-01   +8.744711988295291e-02   -1.625472486946713e-02   +2.819601040155526e-01; +8.758398146958435e-01   +6.208458226076059e-01   +4.146152935053197e-01   +7.285958771499211e-01   +2.995787041559269e-01   +3.356549542793612e-02   +3.959980330014363e-01   +1.489104889914395e-01   +3.816973767952444e-01   +4.429994942538236e-01   +2.635465834248639e-01   +2.698760247245420e-01; +2.526475852462258e-02   +1.000000000000000e+00   +2.264176849339889e-01   +5.762261677846028e-01   +2.476063302654868e-01   +1.852059544975443e-01   -1.587377130668484e-01   +2.273072535821938e-01   +2.817999231753550e-01   +8.540158680831071e-03   +1.323984832268703e-01   -4.254325629906526e-02; +2.289143037023479e-01   +8.050813190404361e-02   +3.768577323827875e-01   +2.080374269342427e-01   +2.772915972393741e-01   +5.751035183274356e-02   +6.051708928941145e-01   +6.707289941580626e-02   +3.329163526690093e-01   +3.760363823493834e-01   +3.474099191998594e-01   -2.345343258935030e-01; +6.630352195775220e-01   +2.325515669532272e-01   +7.560565784908344e-01   +2.494987350551640e-01   +6.898958096156724e-01   +6.959980119758866e-01   +6.544993153999826e-01   +6.885988250396929e-01   +2.542542824145180e-01   +5.768366089067056e-01   +6.616998876352983e-01   +3.871617101392877e-01; +3.674956936177881e-01   +5.616016900064352e-01   +1.071731087427088e-01   +6.604755083952693e-01   +1.026324913754963e-01   +5.743070598859916e-01   +1.109878679938193e-01   +6.732777056005471e-01   +1.826334823446398e-01   +5.179830578374582e-01   +1.003431736288393e-01   -3.400700404065615e-02; +6.905765798986016e-01   +6.843454730523709e-01   +1.492639157231458e-01   +6.052962798950711e-01   +1.738378983291245e-01   +4.302650303639163e-01   +4.806628289201493e-01   +2.560624762141317e-01   +9.002407227278789e-02   +1.807459031967941e-01   +6.021313546868661e-01   +3.023995508615485e-01; +2.310655575079950e-01   +2.693820680071610e-02   +3.958240356960864e-01   +2.515541642351735e-01   +5.781273095991339e-01   -2.629772766038129e-02   -7.178589897728063e-03   +2.592543112173136e-01   +3.081238314030073e-01   +4.444889337198730e-01   -1.201632160727982e-01   +1.192316378148087e-01; +7.681741961031531e-01   +1.259469699453526e-01   +4.298829025087910e-01   +4.866748442950301e-01   +4.734035022558922e-01   +2.614233515559648e-01   -1.934624388702787e-01   +7.161674999348179e-01   -2.800478082120781e-01   +3.882013077755624e-02   +8.985701346932931e-01   -2.305992269359537e-01; +1.786436185719552e-01   +4.211693216341275e-01   +4.189338165314667e-02   +3.336979143852876e-01   -4.865430716254654e-02   +7.502688004528615e-01   -2.978119465915761e-01   +3.397286700366473e-01   +1.356170778798372e-01   +3.420316944378267e-01   -2.078236571497573e-01   -1.999488405380212e-01; +3.877306716054867e-01   +2.214115448898985e-01   +6.582607803403441e-01   +1.810969946386064e-01   +2.297250190630923e-01   +4.123513755495708e-01   +5.382500128632682e-01   +3.651210258391363e-01   +2.493100195046195e-01   +3.124209584035484e-02   +4.056223362366885e-01   +3.275887689958970e-01; -1.466300831861708e-01   +8.823311553796374e-02   +2.378202150175878e-01   +6.741969709643493e-02   +2.059757448500748e-01   +2.574016600351700e-01   +7.371196952475668e-01   +6.631486046751177e-01   -1.084324217425830e-01   +2.508986097679708e-01   +1.050428458101053e-02   +1.317542147170536e-01];
L2E_Input1_iAMPA_netcon = [+8.340082408976157e-01   +7.732615038049763e-01   +5.827579480177590e-01   +1.000000000000000e+00   +6.568378533910718e-01   +8.207171147136407e-01   +8.993151642418272e-01   +7.022418421705025e-01];
L2I_Input2_iAMPA_netcon = [+7.073725839609737e-01   +9.247501281482094e-01   +4.869019896226475e-01   +7.698769716658539e-01   +7.123723417618700e-01   +7.853448121657254e-01   +8.834071124238249e-01   +7.352373920221698e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
