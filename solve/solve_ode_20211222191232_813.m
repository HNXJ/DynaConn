function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.824786057309824e-02   +7.388250541872014e-02   +5.067488568905482e-01   -7.941872449606956e-01   +2.964324281171029e-01   -3.691343893027552e-01   +1.183351516516622e-01   -7.326001785796515e-01   -3.797887620156837e-01   -1.296735944225874e-01   +2.592626215775212e-01   +4.006875893037588e-02   -8.076564747392192e-01   -3.244983973987031e-02   +9.838260642801307e-02   -9.918392664264841e-01; +8.665039736332966e-01   -4.568991322044316e-01   +1.535043576993996e-01   +7.863933190765478e-02   +6.796410935578214e-01   -2.843649871333517e-01   -3.842270050347786e-01   -1.315487142032606e-01   +3.739271582207428e-02   +1.644821552662764e-01   +3.797270414353977e-02   -3.664061756494853e-01   -3.839345274954092e-01   +5.096971977722705e-01   +1.094773832116629e-01   +2.550248514649024e-01; +1.746058073983479e-01   +3.622145904785320e-01   +1.138492526088144e-01   +5.061226937298442e-01   -1.731384512835739e-01   +5.255993417469290e-01   -6.237238392367864e-01   +6.800919497000457e-01   -2.807541837768993e-01   -6.288446709509271e-02   +4.504358401191792e-01   -2.238304005782472e-01   +1.672933027346875e-01   -3.538349835932167e-01   -3.747377127980929e-01   -3.149710911756747e-01; -4.421401389789707e-01   +3.592961617301548e-01   +8.138050030372243e-01   +4.018689665197972e-01   +4.350467561593309e-02   +1.545061356560864e-01   -6.008954902504480e-01   +4.034511062709207e-01   +4.503733103921335e-01   +5.203704327379972e-01   -5.388378458504555e-01   -6.920199889334047e-01   +1.300166661291746e-01   +5.118252060177307e-02   -4.108747551446663e-01   +4.568459523325435e-01; +7.132680885876853e-01   +4.488615315832357e-01   -9.209217805061719e-02   +3.773022714930739e-01   -6.289719631779618e-01   +1.028308750865123e-01   -7.744537649563988e-01   +5.966594093059030e-01   -5.842226540816992e-01   +6.056573724884711e-02   -1.553503362019176e-01   +2.261930348368303e-01   +2.326721445997371e-01   +8.780238343665363e-02   -5.493250325713989e-01   -1.620618898598115e-01; -5.070590929342405e-01   +3.222394724943614e-01   +3.198429448045548e-02   -6.644099809105355e-01   -2.267725528340122e-01   -4.617594841300175e-01   +9.272944075174306e-01   -1.776567841169492e-01   +4.489197697301773e-01   -2.138314873251645e-01   -3.691302779896859e-01   -9.673743852679223e-02   +1.597490675245939e-02   +5.092260130330106e-02   +7.896618591402031e-01   -1.085821591082744e-01; +5.806187408648990e-01   +8.745451184914722e-01   +5.225331218124768e-01   +4.765907218655222e-01   +8.374629734755430e-02   -2.187788628275267e-02   +2.756582331392247e-01   -7.827264202789255e-01   +2.905510183626825e-01   +1.701165355496298e-01   -9.305848463280395e-02   -1.924887845407632e-01   +1.209880312579220e-01   -8.212373104493215e-01   -5.349574266229805e-01   -4.152490958507570e-01; -4.507086264234373e-01   +6.240187465747306e-01   -3.779770216177650e-01   -1.120537578483916e-01   +3.454113787093436e-01   +7.336369264365945e-01   +8.828166013773658e-01   -3.798486064154914e-01   -1.766033653888352e-01   +3.021783519137362e-01   +9.484229211216547e-01   +1.470670574566018e-01   -6.022924520154532e-01   +5.391478034644930e-01   -2.396953201953328e-01   -9.107725137363090e-02; +7.547119564571652e-01   -1.419923889346363e-01   +5.923241174582462e-01   +5.763613701657074e-01   -2.313359228099538e-01   -4.488190342751853e-01   +1.035163599024722e-01   +5.082816634878122e-01   +1.165214227109714e-01   +2.520165237475784e-02   +4.933542790989202e-01   -2.250919515562227e-01   -4.900532044598648e-01   -5.733979408207841e-01   -1.256583501354279e-01   +1.458543635864266e-01; +4.595309730094147e-01   -1.703658134576457e-02   +2.659779602999944e-02   +6.356944397758948e-01   -6.983653089255910e-01   -5.178111546058577e-02   -5.831413593600172e-01   +2.083748560763788e-01   -1.647666749396139e-01   -4.495520837236543e-01   +7.412605617596399e-01   -2.139298903496049e-01   +2.100749035146413e-01   -2.421340798928641e-01   -5.158222246589130e-01   -4.422713659574640e-01; +4.542110643398173e-01   -4.749288508704985e-01   -4.837043620614325e-01   -1.916056397946839e-01   +2.101682497457074e-01   +2.186182730735382e-01   -1.156787385323570e-01   -1.532873380723963e-01   +1.559262723455753e-01   +6.801625023674300e-01   +2.833803737669816e-01   +2.035756021615948e-01   +5.163523723973393e-01   -3.398675161549107e-02   +4.242857047309928e-01   +1.802490952000033e-01; +3.764214747198881e-01   +1.667913517004828e-01   +9.042750970799406e-01   +7.160172668886128e-01   +9.277785598113734e-02   -3.312272857803992e-01   -1.612618388131113e-01   -4.847102332378643e-01   +2.277949839842252e-01   -2.366597130618014e-01   -3.734250569590714e-01   +1.979643485125324e-01   +8.929884072275119e-01   +2.786946505576768e-01   -3.626190960478793e-01   +4.699539409424401e-01; +5.272942986729144e-02   -1.072617272143816e-01   +6.136650565588294e-01   +3.993989085779807e-01   +5.133182922231069e-01   +1.699283730719279e-01   +1.107069662647134e-01   +2.051503412378357e-01   +3.218973231819687e-01   +8.496017096498160e-01   +7.070141887028227e-01   +1.511444597617016e-01   +6.501452076734878e-01   +6.280168087226328e-01   -2.837405602780082e-01   -2.844038974882719e-01; +3.267958045959858e-01   +1.798486313148013e-01   -5.813568257578874e-01   +7.124655131817616e-02   +3.126113729970780e-01   +4.753376535444885e-01   -2.680395143117802e-01   -1.107894637382691e-01   +2.930592470014714e-01   +7.239836426392937e-01   -1.380213266922633e-02   -2.627781120445896e-01   +1.347662954233216e-01   -1.000000000000000e+00   +2.763374538946872e-01   -3.363612195114435e-01; -8.425232736087467e-01   +4.533984273871050e-01   -1.813091383039246e-05   +4.147135054868827e-01   -1.624973507760927e-01   +3.208692964992944e-01   -1.204147740454480e-01   +9.096330827152210e-02   +5.598324522139330e-02   -6.786518559242970e-01   +3.908152330469391e-01   +5.082790455067057e-01   -2.671837115927276e-01   +5.935650851877091e-01   -1.263310110790359e-01   -5.061156736410314e-01; -8.432459524104101e-02   -7.144306469869960e-01   +9.201281648174769e-03   -5.922940788814823e-01   -2.777771042659795e-01   +4.369516304152185e-01   -1.325267423109181e-01   -2.402053559332160e-01   -4.792265699337698e-01   +5.436159510259084e-01   +8.458184116031136e-01   +2.750096276301018e-01   +3.409419587681058e-01   -6.329230660422794e-01   +4.936105574848980e-01   -2.198939877647017e-01];
L1E_L1I_iGABA_netcon = [+3.678570332932986e-01   +2.781451405893169e-01   +4.943959203208829e-01   -3.527768944562950e-01   +7.044695908273636e-01   +5.391632604183532e-01   +7.065754950590881e-01   -9.239390648217434e-01   +4.666771853907153e-01   -5.303991809615360e-01   -6.972816765380832e-02   +2.506457482202365e-02   -3.254233336609416e-01   +9.004260604750270e-01   +2.579818864924486e-01   +1.582399141945963e-01; -5.357268646416922e-01   -2.505275284982807e-01   +9.521845371871378e-02   +5.758680359317145e-01   +3.481727712984151e-01   -5.293752204268553e-01   -4.429330402999747e-01   -5.747117374130336e-01   -2.513053248245475e-02   +3.800150791266715e-01   +7.300043438610614e-02   -4.425064415873183e-01   +5.360755448566383e-01   +1.878961243611508e-01   -1.873528674156995e-02   -1.175595057004806e-01; -6.709467161407904e-01   +3.889697715064961e-01   -1.083669355785569e-01   -4.705257490202043e-01   -6.333326734957935e-02   +1.694611323500390e-01   -1.526481832555480e-01   +1.121027054161073e-01   +7.415863121832268e-01   +7.356709707741211e-03   +6.861440923739979e-01   -2.767274447291368e-01   -1.826814464632788e-02   +2.588016386980925e-01   +2.784520946220082e-01   +6.181344087137185e-01; -6.048075644408056e-02   -2.958928206225112e-01   +2.419674918061532e-01   -2.463899510363654e-01   -3.584561104789633e-01   -1.137029887460973e-01   +2.741060038085685e-01   +6.005001960759375e-01   -1.882550517670606e-01   -2.526518154038726e-01   +5.098362767590637e-01   -4.346721497726126e-01   -7.484920116925087e-01   +4.468472572351863e-01   -4.886942425550506e-01   +1.535901176785480e-01; +5.864995992340895e-02   -2.220186552125573e-01   -1.449055570578963e-01   -1.035231585018157e-01   -5.467195601632875e-02   -3.675166023726579e-01   +3.522610180249668e-01   +5.123224326032615e-02   +4.689498744896456e-01   -3.630346043875931e-01   -2.295021622002250e-01   +8.831882364705228e-02   +2.150962740362501e-02   +2.551430688000121e-01   +3.351154531370723e-01   +7.975585868703010e-02; +8.273543033199043e-01   -7.178329229501688e-01   +1.323244321746620e-01   +3.351301225879543e-01   +3.680324834062583e-01   -3.215677857823543e-01   +3.019393279314935e-01   +1.000000000000000e+00   +4.826773111263173e-01   +1.618265005020343e-01   +1.458893594836219e-01   +3.191708379257673e-02   +1.114759515704202e-01   +1.933211023277457e-02   +6.640077394004860e-01   +3.367133708910320e-01; -6.791905227201008e-03   -3.167232247751460e-01   +5.274223131881546e-01   +1.198640579391962e-01   -6.451306886691735e-02   -4.219913630608684e-01   +4.421136353790714e-03   +3.689117551177707e-01   +4.679305447530197e-02   +1.451099705493872e-01   -3.757836318753088e-01   +5.949329329608291e-01   +7.654514107041117e-02   -4.682067170025164e-02   +5.638790042673250e-02   -3.515690385165992e-01; +1.664467438355978e-01   +2.802689927634735e-01   +3.485463517993679e-02   +3.568995399486943e-01   -4.223711617254874e-01   +5.133250039528341e-04   +3.928425397183064e-02   -7.610869364490649e-02   +3.498812775094451e-01   -5.687960838692788e-01   +1.361528910058171e-01   +1.730389611879421e-01   -5.234588514752847e-03   -3.988297210867940e-01   -1.942843757550761e-01   +5.302239937972900e-01; +8.090986682903756e-01   -3.851198853547815e-01   +6.003754673438830e-02   +3.034048086633335e-01   +1.688377906373613e-01   +1.443839335751317e-01   +1.191007048069693e-01   +2.709960331604823e-01   -7.024757056609496e-02   +1.241750665046202e-01   +6.668878517500502e-02   -7.173205709166325e-02   -1.236737659439997e-02   +1.366621016432863e-01   +3.573045302982195e-01   -6.250039040371043e-01; +3.029734993347543e-01   -1.582390815435537e-02   -1.406834356826504e-01   +3.482028544329513e-01   -8.218524450479252e-02   -1.849900698292665e-01   +2.255062005513494e-02   -5.036996404640294e-01   +1.488917943390130e-01   -5.357099669045273e-02   +5.565818861190922e-01   +3.332584384193278e-01   -5.861142121942119e-02   -3.756329951877561e-01   +7.261484156133138e-02   +4.295446495160243e-01; -1.723107511604017e-01   -6.169305245243546e-02   +6.646004916881585e-01   -8.432522907007325e-01   +1.072816002285129e-01   -4.393666625040609e-02   -2.187318537902261e-01   +5.647418673482955e-02   +2.867349419273021e-01   -4.102444048232746e-01   -5.736676278596520e-01   +9.165806279211237e-01   +6.629085737197196e-01   -2.817925662854886e-01   -2.010749454429285e-03   +4.635863089186499e-02; -4.297124563881633e-01   -8.359999499826837e-01   +3.366976966430511e-01   +4.443556593035923e-01   +3.770767084637762e-01   -5.409079387429923e-02   +2.559612897256384e-01   -2.474074310229850e-01   -9.403624072956269e-01   +2.862412032292386e-02   +3.932514675025008e-01   +8.138193620185266e-01   -5.264978965786609e-01   -1.064474800649242e-01   +2.583482519402258e-01   -4.918442606795815e-01; -5.632126019415959e-01   +4.980813391779199e-01   +2.507348080939397e-01   -2.250166698021907e-01   -1.531884191569574e-01   +8.449347369063995e-01   -4.570462885417173e-01   +1.973631204346637e-01   -1.676097728757528e-01   +5.250433526439723e-01   -2.278324507771566e-01   +2.245550309883483e-01   +2.339907355831864e-01   +1.857409142371670e-01   +3.630366944170980e-01   -1.247781589677685e-01; +5.055844199014996e-02   +5.438322434800943e-02   -8.900498229674295e-01   +1.968973148597721e-01   +4.338523787284086e-01   -9.370938589033918e-01   -1.166611735412204e-01   -2.018543289000241e-01   +7.826758156223176e-01   -1.202945531577016e-01   -3.373469211838775e-01   -5.786157934525883e-02   +2.246063287740005e-02   +6.162545891858747e-01   -6.293497163096491e-01   -3.100984403518446e-01; +5.769146932151790e-01   +6.101247877769754e-04   +2.059098831440621e-01   -3.956967412904596e-01   +1.960622851215252e-01   -9.930875126098257e-02   +6.006303457725707e-01   +1.584741586487516e-01   -3.426156986730285e-01   -1.789568262010660e-01   -5.705801603160082e-01   -6.848206631860091e-01   -5.337568783223899e-02   -5.735508871041778e-01   +8.969251918084178e-01   -1.507982455982748e-01; +5.484317514624435e-01   +2.816714217798825e-01   -1.336367682421892e-01   +8.855242573100695e-02   +1.604630942081402e-01   -7.781464598387929e-01   +4.871510760697611e-02   -1.796977515095194e-01   -6.593333372217457e-01   +1.926405872372026e-01   +4.658274569149604e-01   +1.640957905708868e-01   -3.717124524980720e-01   +4.540070078015690e-03   -2.211970944295738e-01   +1.557641176139975e-01];
L2I_L1I_iGABA_netcon = [+1.064069450080774e-01   -5.126087792058430e-01   +9.992277958025771e-02   -4.305812457884767e-01   -3.108714482052553e-01   +2.066927491607717e-01   -6.403386720219690e-03   +1.751457378013065e-01; +1.444717516410672e-01   -1.880678921972576e-01   +4.904551192751708e-01   +3.995817094405393e-02   -4.257092371091065e-01   +1.705208860172673e-01   +2.726860181024853e-01   +5.786208498529459e-01; -2.845991988449564e-01   -4.713412970701935e-01   -5.023713720403724e-01   -1.918176258395046e-01   +3.736453176324829e-01   +2.663441215354761e-01   +6.069839435898517e-01   +1.022637759814635e-01; +6.980081954617882e-02   +3.550471264651143e-01   +4.620132878439224e-01   -2.305541824415597e-01   -3.152453232457732e-01   -7.038181608393308e-01   +8.694692647097422e-01   -2.973751538212650e-02; +6.039488508103331e-02   -1.558418154580246e-01   -2.300160697001673e-01   +3.558897183518938e-01   +2.162319469550291e-02   +4.789085799079022e-01   +3.637448311737714e-01   +4.629095169623367e-01; +4.109434193309285e-01   -2.395863757589833e-01   +8.279927018216546e-01   -4.686515872748714e-02   -4.695317681006807e-02   -6.108321677306922e-01   +8.885005573738900e-01   +3.757537928039095e-02; -5.811415051529955e-01   -1.043789483522266e-01   +7.028859462884616e-01   -9.957471702377965e-01   -5.889179764267281e-01   +7.607205883975242e-02   -8.414501094844296e-01   +3.417157779968081e-01; +5.654417257735024e-01   -7.226332915704760e-01   +4.544830809332844e-01   -8.277927431926171e-01   +5.160987838297234e-01   -6.110773262934451e-01   +9.098470388272980e-01   +4.566591971487446e-01; -4.881664716834053e-01   -3.652486107910452e-01   +8.994733541528671e-01   +1.210196599418136e-01   +1.441853299812812e-01   +7.977392706689561e-02   -4.986856047575935e-01   +2.889621102762073e-01; -3.762935368031599e-01   -2.116120756132446e-01   -1.507110222005674e-01   +1.659447518982655e-01   +1.564250488605142e-01   +2.284523638649954e-01   -4.800800100150948e-01   -4.924696065853225e-01; -5.696476820753447e-02   +2.584745119520457e-01   -7.263046204078000e-02   -3.680937905909986e-02   +6.940769552778148e-01   +7.285995343382783e-01   -9.059150837494376e-02   +6.076583000549834e-01; -3.786132391272390e-01   +6.721311979993384e-01   -3.778379618836751e-01   -3.774279610886486e-01   -2.221569381615061e-01   +3.675114413800062e-01   +1.162150983037707e-01   +1.000000000000000e+00; +3.730668685545548e-01   +8.538451922326096e-01   -5.781674122238309e-02   -5.466139906610655e-01   +4.295493555451935e-01   -3.589495396419064e-01   +2.523626357115407e-01   +3.848625249935891e-01; -1.894224466300274e-01   +6.039407895628257e-01   +1.840620520695412e-02   -3.467966004797964e-02   +7.709395624503625e-01   +3.847467000752688e-01   +3.105119440313806e-01   +2.522160387939238e-01; -3.917633093019487e-01   -4.217967057292463e-01   +9.002195735967100e-01   +1.063521262964592e-01   -5.990004452986520e-01   +7.209746538925371e-02   +3.057799314875457e-01   +6.060924531205545e-01; +7.673788248495808e-01   -1.613050986493220e-01   -6.634568542317913e-01   -7.682062359576280e-01   +2.998280777076562e-01   +9.321261251165321e-02   -5.117969201771558e-01   +4.572031662037160e-01];
L1I_L2I_iGABA_netcon = [-5.249842960587837e-01   -3.518900927788522e-01   +5.359353129716699e-01   -4.896527074261798e-01   +5.858179173268494e-01   -8.598304940511727e-01   -9.057031604996444e-01   -4.641703681541007e-01   +3.099307686514877e-01   -7.463801096666713e-01   -1.014101600323110e-01   +3.512045998162661e-02   +4.969387922729696e-01   -2.805010179182778e-01   +6.703064884527640e-01   -8.502448897868088e-02; +1.165205506562703e-01   +3.824497066653220e-01   -1.163148754726444e-01   +1.000000000000000e+00   +3.078129736905616e-01   +1.490047224008502e-01   +7.913501857621101e-03   -2.758717296612838e-01   -7.107186334420265e-02   +1.920282436970937e-01   -5.262533850800815e-01   -1.959941236393673e-01   -9.218462108430910e-02   -2.764755193993063e-01   +2.617077178541137e-01   +2.987805382841933e-01; +5.751926709786873e-01   +2.677289652086547e-02   -8.406441129703454e-01   -7.715351111161487e-01   -3.399770506972082e-01   -4.091485153695716e-01   -4.496637060777496e-01   +2.364296746911223e-01   +2.506695283785603e-01   -2.322732005918857e-02   +3.970888757041072e-01   -6.514511106494234e-01   +6.826067816146657e-02   -5.505410776414891e-01   -5.541335983773352e-01   -1.017079407463856e-02; -7.356070673345608e-01   -4.907716587043347e-03   -3.147712268754320e-01   -1.572553528055086e-01   -2.655427104331351e-01   -8.031355050459365e-04   +4.772839721090422e-02   -4.732201758075832e-01   +1.555257374617053e-01   -2.590743067871278e-01   -3.080170468834892e-01   +1.175153119012218e-02   -7.231967479775906e-01   +3.552138119836096e-01   +1.146699803453704e-01   +2.480006787265275e-01; -2.086973574158909e-01   +5.522227974902368e-02   -3.312932123859815e-01   +1.384267539761397e-01   +2.525159069910438e-01   -2.913259372057573e-01   +4.917542191176620e-01   +7.986939902284530e-02   +7.225782390845560e-02   -5.867219286497272e-01   -2.183023581191790e-01   -7.899431834441388e-02   +8.596459401712832e-02   +2.370694337455175e-01   +8.953424190279000e-02   +2.770250129513900e-01; -2.979306579157538e-01   -1.106317214325495e-01   -2.192695834675973e-01   +5.862678378979754e-02   -5.004001396303415e-02   +4.664681645853098e-01   -7.309979310834429e-01   -7.568000698099338e-02   +4.146804027750371e-01   -6.394903809696761e-02   -2.638182436735750e-01   -2.443414152289354e-01   +1.744585992451398e-01   -7.616794975738360e-01   -2.565054464430604e-01   -4.994686299256532e-01; -5.289562072397976e-01   +3.780929422154677e-01   +2.190553083778220e-01   +4.977045611854266e-01   +6.020576933798054e-01   +5.200907631526824e-01   -6.222550975538205e-01   -8.679909447067324e-01   +8.621545990164615e-01   -3.877261295445144e-01   +6.239072592621696e-01   -2.987727294250956e-01   -5.268432371084609e-01   +6.352028321565659e-01   +1.418020795898384e-01   +3.748514288117853e-01; -5.276484121198298e-01   +2.914593509566559e-01   -7.360257863306611e-01   -7.699053498820996e-01   -5.752050873484605e-02   -1.985052387921987e-01   -4.927409820929822e-01   -8.659016289660160e-02   -4.191241926535098e-01   +1.901512484367208e-01   +2.094079167914681e-01   +1.786966153281480e-02   +1.491863420831644e-02   +1.011434545001978e-01   +2.110533556846542e-01   -8.246324200354605e-03];
L2E_L1E_iAMPA_netcon = [+5.753920844554495e-01   -3.247571224948859e-01   +5.666708691874902e-01   -5.139015877242251e-02   -3.608952627797844e-01   +3.595824714622714e-01   +2.072306549399784e-01   +6.268550707743745e-01; +7.168124484792291e-01   +2.072092948797103e-01   -1.247380968996768e-01   +6.504277015646520e-01   -7.561797664917259e-01   -2.849759614126620e-01   -2.805365144952041e-01   +5.956122554454114e-01; +2.248791164256679e-01   -7.747108639471831e-01   +3.125620393629284e-01   -6.605323700540593e-01   -2.270795010668031e-02   -2.952806838226902e-01   +1.733561611209089e-02   -6.564890192494849e-02; +9.650403636920020e-01   -1.243479776647806e-01   +3.778768417610198e-01   +3.172721891738238e-01   -8.843218743626985e-02   -4.971208496202094e-01   -9.257478605305075e-01   -3.196014326038498e-01; +2.733513103405909e-01   -2.164553947803613e-01   -3.513527620290088e-01   +6.743810373206299e-02   +2.701066265922017e-02   -6.517968078399561e-01   +9.234889560583814e-01   +9.274140052556235e-02; +2.059844521167605e-01   +6.417126950078163e-02   -8.097304340964631e-01   -9.622726704470322e-01   -2.080978338554761e-01   -3.625182746771483e-03   -6.918002507120586e-01   +1.349953703256216e-01; +5.728044815544227e-01   +1.321535143388612e-01   -2.759946319866450e-01   -3.139370273178153e-01   +1.768824921742182e-01   -2.974926902574229e-01   -5.146387829443710e-01   +8.479243111926034e-01; +7.101548863475641e-01   -5.766218639616127e-03   +2.505619269617541e-01   +6.175921897452279e-01   +1.851955451215749e-01   -2.390082771531531e-01   +1.693643388481271e-01   -2.760752391224588e-01; -9.317914958678980e-02   +2.973147904842796e-01   +8.060378008368924e-02   +7.318347371811300e-01   -9.002973101462447e-01   -7.517183092470633e-01   -3.704630386314103e-01   +4.103953101683006e-01; +1.129570980564454e-01   +2.924775709686380e-01   +4.437574328274177e-01   -5.181915899966940e-01   +8.370495453235799e-02   +2.162276824194483e-01   -9.833092096133601e-02   +5.637870124086004e-01; -3.851211394577801e-01   -3.024478274226422e-02   +2.442123646597209e-01   +2.900500443931796e-01   +1.279568407765641e-01   -4.810002469463169e-01   +3.468916451327607e-01   -7.128354578635400e-01; -7.388667519924378e-01   -2.763555690029341e-01   +3.121217253884996e-01   -1.599891576003102e-01   +7.443505230223555e-01   +3.164376253653731e-01   +2.463489033138253e-01   -2.072830221078491e-01; +2.404452120478147e-01   +5.023875398579306e-01   +1.469587290957998e-01   -5.506717605733510e-01   -5.572233075477656e-01   -4.146499481110044e-01   +8.806702305477716e-01   -3.037074977385910e-01; -1.096322565479191e-01   +8.976110187077173e-01   -8.096490573721027e-03   +3.451259819700651e-01   -1.637328991785671e-01   -8.524224251525175e-01   +4.651548612272330e-01   -1.301744602472420e-01; -6.890572522802973e-01   +7.117340945358148e-01   +2.461063604162506e-01   -2.126852225370387e-01   +2.942749685550277e-01   +4.146345315668966e-01   +1.007270326320437e-01   -2.139883195736386e-02; -1.666077971283800e-01   +5.758177888565037e-01   -4.941863325238298e-01   +9.075703817940546e-01   +3.578370847949526e-01   -3.827381011639301e-01   +7.876825230539877e-02   +2.253625925434504e-01];
L1E_L2E_iAMPA_netcon = [+2.836456568427501e-01   -4.293976403903025e-01   -5.711348144150104e-01   -5.032625625939299e-01   -3.282423148439701e-01   +6.461401827058122e-01   -8.093936165057651e-01   -4.475725366915505e-02   +2.250205703017827e-01   -2.362140425014855e-01   +3.412292603810938e-01   -3.968470567950411e-01   -2.653585926185394e-01   +6.665146879493170e-02   +2.298663716871626e-01   +7.691345996013774e-01; -9.552716816520489e-02   +2.894231687312707e-01   -1.304202442537947e-01   +1.230988292096653e-02   -2.339844541250901e-02   -8.834234745834342e-01   -1.842707399406110e-03   -5.909878516714081e-01   +1.410696647093799e-01   -1.796238698849570e-01   -3.769319297053026e-01   -1.464371570357722e-01   +1.893908105121521e-01   -1.430292892766356e-01   +4.166706192726609e-01   +6.624653158715189e-02; -2.119175066237235e-01   -2.348898314869942e-01   +1.801844445665512e-01   -7.773883942681845e-02   -6.193056271031326e-01   +3.281575755557155e-01   +1.000000000000000e+00   -1.671288531103094e-02   -3.982584143327854e-01   -4.660159257213895e-01   -1.884341463726895e-01   -2.582194540141973e-01   +2.532362637488350e-01   -3.144139478060149e-01   -3.141949791600405e-01   -2.012690365193985e-01; -1.104612207583134e-01   -2.588342445714926e-02   -1.640511478951755e-01   -1.316305279267470e-01   -6.224493007759309e-01   -3.062737676179427e-01   +3.139593963801554e-01   +6.006872884253900e-01   +3.320607893446485e-02   -3.124771464136799e-01   -8.237350849155249e-01   -1.912059960501468e-01   -1.453195128676591e-01   -3.163498392124540e-02   +4.576284990268507e-01   -1.946325691173086e-01; -1.027277940115393e-01   +2.738638719801498e-01   +5.683245557841681e-01   -5.820768097481773e-01   +1.439794856634413e-01   +2.390542132906890e-01   -2.981387184368176e-01   +1.018625938077433e-01   +8.513649956583654e-01   -8.889370688010153e-01   +7.343594638958470e-02   +8.137037873571851e-02   +3.942750822901975e-01   -6.285158389138863e-02   +3.061514929642533e-01   -1.387129914000226e-01; +5.560509273317616e-01   -2.970379993203323e-01   +3.165002617757577e-01   +2.564954116945740e-01   -6.826858940026849e-01   -9.591823044281059e-01   -2.150788103455928e-01   -3.352267130739312e-01   +6.584166647675185e-01   -5.604611460806168e-03   -6.543480564638791e-02   -3.115130553334307e-02   +3.371075597587490e-01   -7.311525294561657e-01   +1.736998834446193e-01   -4.983540872496055e-01; +7.886020200038955e-01   +9.088963932273113e-01   +4.293500686663910e-01   +4.185552602506968e-01   -3.788466283891276e-01   -1.376396727722610e-01   -3.409799988881101e-01   -1.046863874787439e-01   +9.103223168582738e-01   +8.173901988820494e-02   -1.573115994853800e-01   -1.250031247299708e-02   +5.355903920825236e-01   -4.274048704729623e-02   +2.451886851631389e-01   +4.271250227054654e-01; +6.637076204246523e-01   -7.799341495008059e-02   -7.769226435206235e-01   +6.936485023181093e-01   +1.110614313878916e-01   -4.345579117295592e-01   -6.496044208328037e-01   -6.896469365916780e-02   +4.958503996785570e-01   -1.291935567739695e-01   -4.740083420426668e-01   -2.309829254034854e-01   +5.533342323143575e-02   +7.320132648838836e-01   +7.515181272459387e-02   +4.702523286959683e-03];
L2I_L2E_iAMPA_netcon = [-9.367184947405180e-02   -2.273768870069063e-01   -4.628342262453066e-01   -6.451895129012120e-01   -6.475472589545147e-01   -7.409445112029260e-02   -2.707830786696282e-01   -8.186928300309544e-02; -2.306071307177155e-01   +1.055883441820672e-01   +2.838462654877723e-03   -2.777775050725663e-01   -4.908926684790920e-01   +8.371979559533090e-01   +7.328437677842923e-01   +1.472050596383936e-02; +2.902806012816020e-01   +8.066552091606425e-01   -2.783018709070591e-01   +1.124418957645954e-01   +1.122476834821353e-01   -6.676685171213077e-01   +5.948354459920391e-02   +6.749498571619476e-01; -4.914496218384294e-01   +2.488306743315746e-01   +3.435008343805785e-01   +1.211559551977466e-01   +3.947970582007455e-01   +3.413740377634436e-02   -1.180106550064800e-01   -3.222456994832876e-01; +3.631559619294530e-01   +2.362939607472999e-01   -3.621730947107984e-01   -6.977751454844980e-01   +1.480592762637614e-01   -2.425857356790448e-01   +2.692642326171942e-01   -3.089530973321664e-02; +1.760178704892104e-01   +8.224872207423040e-02   -1.470051393573744e-01   +1.325337084941245e-01   +2.461202461088202e-01   -1.002580280903264e-01   +1.487235622070587e-01   +1.133038690617466e-01; +3.321904210976330e-01   +7.963785383217559e-02   +5.180684201897572e-01   -7.106356229152928e-01   +2.272955342148962e-01   -2.669933326574916e-01   +2.194001535270989e-01   +7.809563000848316e-01; +2.460710749408319e-01   +3.215391935787841e-01   -3.531079955120329e-01   -3.999638588564268e-01   +3.258710901649038e-01   +3.069061162863757e-01   +6.975017124736539e-01   +5.834426597512918e-01];
L2E_L2I_iGABA_netcon = [+1.251281135245385e-01   +4.721248377173225e-01   -7.104559886863427e-01   -5.937963773170262e-01   -3.155016893874490e-01   +7.118407583865594e-02   +5.744160400350271e-01   -1.811214273554723e-01; +4.733889457063857e-01   -3.136375472896991e-02   +6.090541338583350e-02   +2.842863580871216e-02   -1.052047450558740e-01   -1.586348857167652e-02   +3.850190502583555e-01   -3.220814701535611e-01; -2.373486991560645e-01   +2.462445754297470e-01   -1.899573974833432e-01   -2.858393608767479e-01   +2.343589948613052e-01   -2.599842727773248e-01   +8.144647366585055e-01   -7.145178821281937e-01; +3.509373434710426e-01   +4.438299492462072e-01   +2.405391972176713e-01   -5.494436385111967e-01   -1.992895407097450e-01   -4.606108121054465e-01   +3.772056233692503e-01   -2.278443642013494e-01; +5.196375818334432e-01   +3.387316060247282e-01   +3.362248332764702e-01   -5.121354008458775e-01   -5.745883455809401e-01   -5.817939802680563e-01   +3.132743621692462e-02   +1.334555790155978e-02; -2.424514675627341e-01   +4.262067052018957e-01   +4.798967124840051e-01   +2.413281363868310e-01   -5.970916436386764e-01   -8.714806092503585e-02   +2.812247870352238e-01   -4.261483895555662e-02; +1.348315500910061e-01   +6.135401163118483e-01   -7.129603007891699e-01   -2.873503595034699e-01   +3.829414553794841e-02   -2.897962746198376e-01   -1.562294025925095e-01   -3.687092958395510e-01; -1.644344600919867e-01   +5.859319927647102e-01   -6.705850875839496e-01   +3.025583332110360e-01   +4.345697606283058e-02   +4.000734673026611e-01   +4.938083331142379e-02   -1.114825320548407e-01];
L3E_L2E_iAMPA_netcon = [+1.688463365296335e-01   +3.859563894725043e-01   +1.773249615167312e-01   -7.434351990672577e-01   +1.000000000000000e+00   +1.775777173288734e-02   +4.435863757564377e-01   -7.231854176249148e-01   -5.688611964112280e-01   +8.218445896089646e-02   +1.110187286139361e-02   +8.534234055577040e-02; -2.203083080359238e-02   +3.070234504268493e-01   +5.676798799396463e-01   -1.125895238341390e-01   -3.180686690153853e-01   +7.490513275560196e-01   -1.500841321745387e-01   +6.981624362905173e-02   -1.248695185118153e-01   -6.707730362497070e-01   -1.864429258967401e-01   +7.377310253139693e-01; -3.492114986149949e-01   -6.103259686235485e-01   +1.945634844503774e-01   -7.709328454114352e-02   +7.175219545038745e-01   -5.367769830012781e-01   -7.054354681405388e-01   +9.247686343141071e-02   -2.448112079934936e-01   -8.484629400179832e-01   +7.082274575002450e-01   -7.236579149092029e-01; +2.189120594977906e-01   -3.052414298321701e-01   -1.993717795119276e-01   +1.163264826733737e-01   -2.215578494834922e-01   +2.505763083860991e-01   +2.116912537684084e-01   +2.940613858387563e-01   +8.004131130255053e-02   -5.158886047724557e-01   +1.896868156331341e-02   -3.277403635567949e-01; +2.422967821115170e-02   +2.403147099281394e-01   +2.293505208357908e-01   -3.089579834504377e-01   +2.435713912191369e-01   -3.087739641128793e-01   -1.919859983915908e-01   +1.714387607115668e-03   -6.273479519801451e-01   -1.783561212601295e-01   -7.829255619977264e-02   +9.013967712535920e-02; +8.401618091478676e-01   +2.023433912385666e-01   -1.440515022403751e-01   -6.609056717155768e-01   +7.358276942691646e-01   +1.888734939038951e-01   +1.210942510240978e-01   +6.372043203772587e-02   +6.532982896532218e-02   -2.942519434757572e-01   +1.510230043539234e-01   -6.398450644102012e-01; +3.395002765330823e-02   -1.650206889820714e-01   +4.276333316464880e-02   -4.163631930627341e-01   -8.309283388957082e-02   -1.037900918958062e-01   -3.751418786532683e-01   -2.544296732511139e-01   -5.077942157649770e-01   +1.712447034028946e-01   +5.583606562530059e-01   -3.520721414310309e-01; +3.594228849146154e-01   +9.158508727665986e-01   -6.307928442579426e-02   -1.492170059311817e-01   -3.626423944688624e-01   -5.572623880669774e-02   -3.374241861131340e-01   -1.555711983744297e-02   +3.961141491575139e-01   +8.085001642812074e-02   +6.877348963594447e-01   +2.003853916029891e-01];
L3I_L2I_iGABA_netcon = [+3.155127736303469e-01   +4.781409605339937e-02   -7.583859983296012e-02   -3.695267113821109e-02   -1.456874390195403e-01   +2.072428772614128e-01   +5.556988086040320e-02   -3.929004851239462e-01   +2.931805746393011e-01   +5.303132607787977e-03   -1.969435944999907e-01   +3.457256655590189e-01; +1.038122827552477e-01   -1.203139148160613e-01   -4.318907936478240e-01   -8.781420563370211e-02   +2.896715865271657e-02   -6.950606459230515e-01   -1.358586769142989e-01   +7.465998204952304e-01   -2.788823335657385e-01   +2.890763795059656e-02   +9.973377962028109e-02   +8.878366353990798e-02; +1.143080594178240e-01   -9.342615667970495e-03   -2.862737560979277e-01   -1.207025207897042e-01   +1.500964123083052e-02   -3.223403407583506e-01   -1.538436294163131e-01   -1.112091704525647e-01   +3.916661805239700e-01   +3.861449570178425e-01   -7.295100295947518e-01   -6.277246383302640e-01; -3.319568542778432e-01   -2.654133601575476e-01   -1.296707825453373e-01   +4.966900907161446e-01   +1.103049879953042e-01   -4.041557855352426e-01   +1.106658605019693e-01   -8.246953886842966e-02   -6.607259932534317e-01   +5.047324269137671e-01   +3.942120357601501e-01   +7.376178651400832e-02; -9.983343651603353e-02   +3.440650835770242e-01   +6.787571389606608e-01   +3.708977313376969e-01   -4.550597753155844e-01   -2.987195448383292e-01   -5.217281925913909e-01   -2.746406498252387e-02   +4.190046862416579e-01   -7.362046275059595e-01   -2.572739603792620e-02   -6.487048402987580e-02; -4.283333349095931e-01   -7.746263004813725e-01   +2.392492724534123e-01   -4.441477263780187e-03   -3.124824877701341e-01   -1.631257968438777e-01   -8.000491803673498e-01   +5.298153415516621e-01   -4.551441340073253e-03   -1.711482082741190e-01   +1.678665844766989e-01   +4.051254689870404e-01; +1.489593491716154e-01   -3.621344418604354e-01   -3.739996759870497e-02   +1.106163175117856e-01   +9.360294813486839e-02   +1.445657653619616e-01   -3.290156999162170e-03   +6.189330077326463e-03   +1.000000000000000e+00   -2.483593826863774e-01   +3.505574450940626e-03   -2.192407731297499e-01; +4.700281344753088e-01   +4.757369514005142e-01   +3.228493846991510e-01   -2.706855008789845e-01   +1.692054914210444e-01   -2.946245434028036e-03   -3.305758297488111e-01   +5.896947213575146e-01   -1.428135934345973e-01   +1.538096269158357e-01   -1.832812078953088e-01   -6.423845742340746e-01];
L2E_L3E_iAMPA_netcon = [+5.398724234713341e-01   -1.134315171482209e-01   -3.923016891413037e-01   +2.779600996579288e-01   +2.190302832506283e-01   +1.411072238287479e-01   +4.987889735847437e-01   +4.240238555574662e-01; -6.110517540856926e-01   +7.110104079811314e-01   -8.109870244411320e-02   +4.619815034993183e-01   +8.236478588723936e-01   -1.424726349995265e-01   -9.811723765307362e-02   +4.443360214390413e-01; -2.399520289447591e-01   -1.249880969836210e-01   -2.908087050144891e-01   -4.167760838955447e-01   -5.453970903499166e-01   +3.851939023944745e-02   -4.933493094049968e-01   -6.903761295466365e-02; -1.007096285286244e-01   -2.891286480947118e-01   -8.921567716353060e-01   -4.828228696088811e-01   -2.175549549899586e-02   +8.585115613495881e-02   +8.990121870443951e-02   -8.329788841591967e-02; +6.162902392883810e-01   +2.001777847934891e-01   -6.384178159602674e-01   +8.469932425075595e-02   +1.810831286450840e-01   -7.147104611050886e-02   +6.090546029225574e-01   +3.938317608956295e-01; -8.372805420595121e-01   +8.724172280881879e-01   +8.365016588767653e-01   -3.727432623648996e-03   -8.830064831077250e-02   -1.006016769034262e-01   -1.862924790939279e-01   +2.178493774284662e-01; +2.881077580295420e-01   +3.736519128206336e-01   +5.858298462755699e-01   -6.935553443862275e-02   -1.744365821826091e-02   -4.988289735277932e-01   -3.492907565783265e-02   +8.411846640729548e-02; -8.093023381902453e-01   -1.413893891882140e-02   -4.599485544001483e-01   +4.244446660932492e-01   -3.115367814277770e-02   +6.486398965172933e-01   -7.500794005535955e-01   +1.956785342202954e-01; -3.111769772222936e-01   -3.773551781277685e-01   -7.514792603499737e-02   +6.081880264236339e-02   +3.643226472603240e-01   -8.696362457683038e-01   -5.447956750403506e-01   +2.611044443485471e-01; +2.332732893904858e-01   -7.474588725136969e-01   +2.554288666233244e-01   -3.271427551705131e-01   +4.306162874707603e-01   +2.732224385761004e-01   -5.887460426462916e-01   +1.885575925247605e-01; -3.803016980058416e-01   -7.574013543854126e-02   +4.502213631985699e-02   +4.584002622709947e-01   -4.772812032836554e-02   +7.408927639443441e-01   +3.701318246639662e-01   +4.448800423002853e-01; +5.936712087575791e-03   +2.646398826516731e-01   -5.199521346950436e-01   -2.672389244142820e-01   +1.225485910878359e-01   +7.539707344231420e-01   -7.617548354097184e-02   +3.758211645458182e-01];
L2I_L3I_iGABA_netcon = [+7.253312053646492e-02   -1.687478685666566e-01   -5.900462679931369e-02   +3.163232545033917e-02   -6.809995699706941e-01   +4.361790395268297e-02   -6.120613717756247e-01   +3.484168220932473e-01; -4.041095141188318e-01   -6.975960450929528e-02   -4.803793598607444e-02   +3.026793107299799e-01   -4.936002798875225e-01   -5.793243562891751e-01   +2.263849104646792e-01   +3.503093445425072e-01; +2.775739604014746e-01   -1.718745276693050e-02   -6.307665478045695e-01   +2.085774516583916e-02   +9.975579931399925e-02   -7.741668472657383e-03   -6.901773302797406e-01   -1.403325278793971e-01; +5.078562723561205e-01   +1.606465060810860e-01   +3.052518357815963e-01   +7.792233087585299e-02   +1.358066199749672e-01   +2.739490936751429e-01   -3.056121246171669e-01   -1.947208045425287e-01; +3.425828717855594e-01   -3.078332137396643e-02   +9.061380214605740e-02   -2.169787756553021e-01   -7.963405907367971e-02   -1.089602872956249e-01   -4.438943544373062e-01   +1.000000000000000e+00; -1.785886328298369e-01   -1.480648130154943e-01   -3.658805158378060e-01   +4.238288333374766e-01   -2.835203066177647e-01   -3.730540311542806e-01   +3.527159245028815e-01   -1.566141665711304e-02; -8.993038552211526e-02   -5.904830823828283e-03   +2.472076995389795e-01   -7.813652766080499e-01   +4.925508324992587e-01   -3.392174867494133e-01   +4.669576921792302e-01   -3.903765328645176e-01; -2.962654353724167e-02   +2.867853415455759e-01   +4.681629487502854e-01   -2.106485410350155e-01   -5.607661054739945e-01   -3.662762630410866e-03   -2.436648104455897e-01   -1.555562773030684e-01; +7.996413991071066e-02   +1.263483794865379e-01   -3.835450312554855e-01   +8.050376480383774e-02   -3.245695236831872e-01   -4.936191073211057e-01   -3.094855539503631e-01   +2.632866997675483e-01; +6.740086671643643e-02   +3.632146973356714e-01   +1.737041524812617e-01   -2.699097619313283e-01   +6.376882240249629e-02   -6.066949253305562e-01   +9.606702553911659e-02   +1.501796371965532e-01; -3.476068666097833e-01   +3.020435397842093e-01   +1.555899563871029e-01   +1.455162027073512e-01   -5.567633410735193e-01   +1.013533257435871e-01   +3.055490184459228e-01   -3.163936711666995e-01; +1.236271356485777e-01   -4.087364736509782e-01   -5.645300613480749e-01   -3.240885644545909e-01   -3.720024073284646e-02   -1.155336212078528e-01   +1.646820184923795e-01   -3.857098645895974e-01];
L3I_L3E_iAMPA_netcon = [+9.700824031677242e-02   +1.218008533684143e-01   +4.724857589227415e-01   -3.108757841954623e-01   -5.605798109034810e-01   -6.406481007342890e-01   +6.162551013679090e-01   +6.482939432751020e-01   -5.755404946460858e-01   -3.142870923360250e-01   +7.467390936990456e-01   +7.271192120930169e-01; +2.674439706024050e-01   -5.534542283015981e-01   +6.147244745269204e-01   -4.802541334157586e-02   +7.171383715490758e-01   -2.893779191439936e-01   -3.014143274936980e-01   +2.392708895752418e-01   +1.652475136995026e-01   -2.665985599429567e-01   +1.269270856239146e-01   -2.439450312055824e-01; -6.359476305125288e-01   +2.809067355334812e-01   +7.153646917778552e-01   +6.859539693663453e-01   -7.381869308931682e-03   -2.338173063400881e-01   -3.319235067829262e-01   +5.117900089639807e-01   +4.430175933881741e-02   +3.466874826727981e-01   +4.377561318945345e-01   -4.301946227522305e-01; -1.421936868131448e-01   -4.333598371790745e-02   +4.855268462993629e-01   +2.078389414334667e-01   -6.248301275498838e-01   -7.646455120436121e-01   -1.995949083810259e-01   +4.211931855381663e-01   -4.799361573415111e-01   +9.178168374361553e-02   -7.156294236682945e-01   +6.923885163400483e-01; +2.185598788414523e-01   +2.652961570104740e-01   +1.466816665394003e-01   +3.377453004405771e-01   +5.996523078635061e-01   -5.415864384886160e-02   +1.539446427053947e-01   +1.509259222085694e-01   +4.075435706236769e-01   -1.738863594143972e-01   -3.785118333160937e-01   -5.559601748623815e-01; -3.294175256913696e-01   -4.925762305690146e-01   -5.854465247360644e-01   +8.589616783461043e-01   -1.528378700719515e-01   -6.120484744247810e-02   +3.752306020207469e-01   +1.143685469603704e-01   +1.409041516352069e-01   +4.631622825081654e-01   -1.305884819604976e-03   -1.911028736089649e-01; -2.173978369046002e-01   -3.816872038472482e-02   +5.478095586564971e-01   +2.709120955525647e-01   +5.551519332462068e-01   +1.859117519867973e-01   -3.083464488256861e-01   +4.197676085695798e-01   +4.613049864961823e-01   -4.165474757711666e-01   -6.558042587928826e-01   -5.212279558782409e-01; +1.805310608731698e-02   +8.418502302401723e-02   +4.895505986130171e-01   -4.839272364282167e-01   +3.416272020749120e-01   -7.774380831976618e-03   +6.595021684136915e-01   +7.371979652142269e-01   -4.446410738597115e-02   -1.766424439797408e-01   +4.285402077477718e-01   +2.299189712857005e-01; -4.990212896592680e-01   -4.313243567795428e-01   +2.621147078215595e-01   +3.947898040889889e-01   +5.182284876791856e-01   +4.941944418445016e-01   -2.211069539605582e-02   -2.847841801457352e-02   +1.366680671625676e-01   +6.763069310466192e-01   +7.203225353298247e-01   +3.854564330098662e-01; +1.118645263024814e-01   +2.265706527267258e-01   -4.306551381540124e-01   +7.595714465427410e-01   -1.000000000000000e+00   +1.355714657116527e-03   +1.791406055228390e-01   +5.495887963620585e-01   +6.721191014693223e-01   +2.955034575377214e-01   -2.095658320655359e-01   -9.010103379644924e-02; -5.823118488004420e-02   -5.855240103146821e-02   -7.790123957674853e-01   -5.254684394009559e-01   -1.710294817119824e-01   +8.946720221636052e-01   +4.619368869162924e-01   +1.279341359705221e-01   -2.755586970552443e-01   +2.350400816368765e-01   +4.736702690632530e-01   -5.848275365641590e-01; +4.580540765298098e-01   -5.014625408846504e-02   -3.834312945364118e-01   +6.764380796029407e-01   -4.499593416173010e-01   +7.656235346634213e-01   -4.351629805865954e-02   -5.292322705282765e-01   -4.784918171844114e-02   -3.261408074901216e-01   -6.410992071200071e-01   -1.869978721824425e-01];
L3E_L3I_iGABA_netcon = [+1.178331859201770e-01   +2.570120057127236e-01   +2.296846656397848e-01   -2.707322710570981e-01   +2.046824829308138e-01   -1.859678613426680e-02   +4.435914237561824e-01   +2.375136903432333e-01   +3.319239307994820e-01   -9.949862585129970e-02   +5.392515395626335e-01   +2.605966050680997e-01; +2.162593791001011e-01   +5.225656214943739e-01   -3.911703333658647e-01   -1.827229133749695e-01   +4.469344535308979e-01   +3.081971540488126e-01   +3.772079453302701e-01   -3.182297546351334e-01   +1.567592761666428e-01   +1.849330414317210e-01   -2.774854136107349e-01   -3.170484988308786e-01; +4.798555227721873e-01   -1.645880769948441e-01   -3.838653529432711e-01   -4.515589042667817e-01   +4.769466934289524e-02   +1.000000000000000e+00   +2.237186741248889e-01   +6.608309388310800e-02   +1.101330237638819e-01   -9.846199303242288e-02   -2.089259920039364e-01   -1.386333192652149e-02; -1.355499965775715e-02   -5.704659344323013e-01   +1.483340553190342e-01   +5.324180366771313e-02   -8.245044608747508e-02   -8.198162554549676e-02   -3.028049028207854e-01   -8.031650503079947e-02   -7.331153273128022e-02   +5.350334654601526e-01   +7.060141108411521e-03   +9.689774661670676e-01; -2.656593696416201e-01   +5.502514856573503e-01   +2.029543701138397e-02   +1.864447308451336e-01   -1.792554409071339e-01   +1.128406069213804e-01   +2.510663366547851e-01   -2.040712135395171e-01   -3.444160087540695e-01   +3.453149571495318e-01   +1.232131016365311e-01   +1.852432113802451e-01; +3.372478126553844e-01   +4.493103658440881e-02   +2.531349366101122e-01   -1.443331547168225e-01   +4.297726981510869e-01   -8.973303369805431e-02   -1.653702983970380e-01   -4.140240677775017e-01   -3.698177736968613e-01   +1.945773509997508e-01   -1.625446512153579e-03   +8.633862360731452e-02; -1.598512629974622e-01   -2.172808249304166e-01   +1.456406917915646e-01   -4.994231379761525e-01   +7.761604910746690e-01   +3.477777494082975e-01   -3.481581095834188e-01   -2.797129511983959e-01   -3.791263230462383e-01   +4.341690147473029e-01   +8.719903966046984e-02   +1.875534355299364e-01; -6.257076199070926e-01   +2.036619260665884e-01   -9.274981546954988e-02   +4.106869700951087e-01   -4.229179224946670e-01   +1.912130828268459e-01   -7.273707044883082e-01   -5.148880006426052e-01   +2.082649946827713e-01   -1.186288378338075e-01   +6.176354947801871e-02   -5.218628003875410e-01; +5.016688474165737e-01   +4.488085502702359e-01   +1.765294274235334e-01   +2.670391135563264e-01   +1.461234636235703e-01   -8.126681476177708e-01   +5.690092695537937e-01   -1.739805675258293e-01   -6.059981706917358e-01   -8.098130680272403e-02   +5.532078828523541e-01   -3.320800794076116e-01; -6.335837273282099e-02   +6.563419960027013e-01   -2.550361863026307e-01   -3.388309413055444e-01   -2.550408472209805e-01   +4.706478434791529e-01   -3.330879979860477e-01   +1.895261863791784e-01   +2.531898037139840e-01   +6.914835486413057e-01   -5.769187659177589e-01   +1.632653474265648e-01; +1.765345114046803e-01   -3.141774738195178e-01   +5.476707273562752e-02   -2.399910836403922e-01   -2.892480045729798e-01   -2.781786593687448e-01   -2.511166807988952e-01   +1.502617418452932e-01   -7.981620110134591e-01   -7.843554271924587e-02   +1.100155227325251e-01   -8.669687777357868e-02; -1.586438056954783e-01   +9.561649799449054e-02   +2.516018636932243e-01   +1.788842047329830e-02   +3.037610414827414e-01   +1.089495399977491e-01   -3.485855340203727e-01   +7.753090049076378e-01   +4.617991227446217e-01   -5.523789925198768e-02   -1.847507502179529e-02   +7.476292637003895e-02];
L2E_Input1_iAMPA_netcon = [-3.851293978883027e-01   -1.190914518816899e-01   -2.826106368837487e-01   +3.498503644138293e-01   -9.314744602972436e-01   +7.244623569380436e-01   +1.000000000000000e+00   -2.410504533424662e-01];
L2I_Input2_iAMPA_netcon = [-5.370152663260660e-01   -3.371775170146323e-01   +5.654838592381265e-01   +9.040111971964987e-02   -8.349493037722393e-01   +6.234823155774967e-01   -1.312066259343130e-01   +6.529226634503125e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
