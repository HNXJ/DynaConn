function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.521141772106286e-03   +6.845873389730038e-03   +9.634155680093905e-03   +1.548641541921925e-02   -4.278171180138400e-04   +1.221720132533891e-02   +4.524551850549245e-03   -4.092886532448327e-03   -1.891166764757189e-03   +1.063052165378370e-02   +7.623059295550657e-03   +4.748819372869586e-03   +8.466022477695196e-03   +6.554804874738794e-03   +4.124157792198608e-03   -6.922954884818246e-03; +5.214383170999443e-03   -3.375517537464822e-03   +9.422711461356693e-03   +1.090126687748583e-02   +2.211212678053478e-03   -2.613884842371207e-03   +8.531266535136917e-03   +5.736912738235450e-03   +7.112609098566628e-03   +1.036294118365181e-02   +7.423288578438784e-03   +3.238664174768038e-03   -3.589610251682360e-03   -3.122418541589236e-03   +3.224322221515336e-03   -2.979712510819377e-04; +5.255750807254502e-03   +6.714862824996721e-03   +8.628336622040983e-03   +9.982098625128244e-03   -7.445689283942444e-03   +6.415574331073831e-03   +1.147029106915209e-02   +3.565614568562821e-03   +3.467135917439491e-03   +4.906576524395747e-03   +8.961290616087136e-03   +4.071623516006400e-04   +4.041938958297489e-03   +5.842887683675625e-03   +8.683112378695207e-03   +6.293272884424237e-03; +5.263152949110009e-04   -2.154028641061839e-04   -2.589506037069183e-04   +1.616184745175492e-03   -1.799968988614630e-03   +4.384892682183898e-03   +5.572399546737667e-03   +3.880936086577259e-03   +6.874736546175104e-03   +4.329375060115092e-04   +1.258684119698425e-02   +9.035030221656659e-03   +6.363615992708647e-03   +1.156540563759999e-02   +5.127923227034830e-03   +2.714697093608910e-03; +2.282666957724759e-03   +5.718805216277389e-03   +1.401449353784234e-03   +7.222944413628132e-03   +9.697633720649136e-03   +8.963225008062093e-03   +1.594432250067387e-03   +2.612540883386590e-03   +5.041149927147289e-03   +1.235491353769367e-02   +3.569798189325089e-04   +5.823105722431689e-03   -5.432461761713614e-04   +1.084660457803842e-02   +7.836770108258341e-03   -4.658451201951768e-03; +1.002275123429053e-02   +3.898565563009839e-03   +6.754553585564792e-03   +1.612930602524703e-03   +7.734141667304739e-03   +5.610638637495145e-03   +7.660881794171849e-03   -4.079419051030904e-03   +3.768568560085693e-03   +6.518607765556668e-03   +9.641895735380131e-03   +1.900653176302293e-03   +4.442900555031124e-03   +2.343148366146479e-03   +7.760881995175540e-04   +7.453827754713843e-03; +3.351752365856095e-03   +4.609663332784839e-03   +7.837271675859138e-03   +7.003737137843306e-03   +1.327142289091822e-02   +2.082955355594591e-03   +5.617952159288008e-03   +1.483645768517717e-02   +1.645704515581721e-02   +1.738536293137834e-03   +5.972031288132594e-03   +3.227563815378060e-03   +3.497519388968771e-03   +8.035444768135081e-03   -7.490578164904579e-04   -5.047424368839005e-03; +6.736702266631807e-03   -3.943781132005410e-03   +9.459594815298922e-03   +8.621147872616518e-03   +6.148822542044892e-03   -1.816862197496826e-03   -3.109502195946204e-03   -2.794526839643300e-03   +1.024223471162513e-02   +1.025900352079355e-02   +4.924714323859186e-03   +9.015652556202045e-03   -1.530344774753379e-03   +1.824251281443787e-04   +5.056432313886994e-03   +8.543268919716159e-03; +4.828255654757007e-04   +3.956243398782076e-03   +4.035167940485632e-03   +8.719239833151430e-03   +9.343854539495595e-04   +9.210786291150252e-03   +1.865058012370545e-03   +7.032060260329008e-03   +6.300834550907229e-03   +9.025722944288637e-03   +4.006860342077898e-03   +5.699509871620364e-03   +6.590121816040896e-03   +7.874662001081063e-03   -4.545987052215659e-03   +3.860640998758857e-03; +1.583697949861820e-05   +5.419427844145253e-03   +1.674096666828744e-02   +8.962619468996879e-03   +3.811325981318897e-03   +2.644651763694478e-03   +2.781844839950106e-04   -3.089962007933316e-03   +5.297247437955698e-03   +4.324325282710302e-04   +3.971784160895506e-03   +2.564047004507745e-03   +5.573699854582302e-03   +4.977739053272987e-03   +1.429794781581774e-02   +6.465066827701145e-03; +7.850774435049371e-03   +6.112102319544437e-03   +9.447155467846890e-03   +7.145456372289962e-03   +3.041165613780577e-03   +3.006432028611278e-03   +5.227676611091024e-03   +1.079945182364977e-02   +3.763805549336532e-04   +5.992129751503357e-03   +8.815490521957237e-03   +7.308001848321488e-03   +7.054609753867560e-03   +1.823019579943979e-03   +9.749495888958903e-03   +7.116325055681159e-03; +5.072911285140039e-03   -7.844891029672065e-04   +4.119137563004107e-03   +2.033713520425724e-03   +5.594008729121781e-03   +1.110657802556058e-02   -8.901079929695219e-04   +7.277181629595925e-03   +5.888746277069962e-03   +1.330415733096084e-03   -3.152771925841602e-03   +2.606590954486124e-03   +6.748316950503417e-03   +3.171086426095895e-03   +5.442760522569687e-03   +8.327859748610989e-03; +5.644021999523341e-03   +5.984429479151585e-03   +1.174442497625938e-02   +1.094209049498895e-03   +1.329692919241106e-02   +5.189879555254844e-03   +1.186919091928523e-02   +1.468399564958252e-02   +4.670213029875614e-03   -7.293793436355436e-04   -6.978420335886725e-04   +5.549548685616665e-03   +9.241526988309672e-03   +1.067997903795694e-02   +8.203005979557166e-03   +7.321543110534549e-03; +7.135589860161962e-03   +9.909709009501338e-03   +6.371008455175655e-03   +8.917621358036015e-03   -2.990614325002622e-03   +2.285758189464813e-03   +4.101696733910982e-04   +4.680497479920808e-03   +1.529609150131653e-04   +4.078127310157796e-03   +1.929093675761923e-04   +9.277029640923308e-03   +5.420300857512956e-03   +8.569759888771282e-03   -4.083264945531234e-04   +3.121836331809198e-03; -5.845687393470497e-03   +1.234922693838332e-02   +1.070764410928862e-02   +2.487524893820205e-03   +2.149580161844484e-03   +1.828015190030070e-03   -5.629288990024256e-04   +1.394357442289645e-03   +3.349693564236845e-03   +1.095880499429944e-02   +3.570787628238350e-03   -5.519219229161304e-04   -2.196303626964558e-03   +1.322853935844476e-02   -2.236158506541723e-03   +4.039523840865617e-03; +5.614484761549599e-03   +6.725347932219855e-03   -4.900272857064670e-03   +1.261625204341227e-02   +2.458778448736993e-03   -2.844930263365639e-03   +5.688750196703183e-03   -1.731384333103339e-03   -2.114174755150819e-03   +1.450940671976085e-02   +8.248947021048919e-03   -2.830691493776463e-03   +7.877650416193861e-03   +7.458265663143560e-03   +8.893033565217083e-03   +1.207874161419455e-02];
L1E_L1I_iGABA_netcon = [+5.533665040510882e-03   +1.087763061058187e-02   -1.126736476905812e-04   +7.192556794784975e-03   +8.127635517569063e-03   +5.281876235748009e-03   +7.067243839047795e-03   -3.513069058087330e-03   -7.208385695197175e-05   -2.790198484080633e-03   -1.354503344661545e-04   +3.627082404833309e-03   +6.098626603764280e-03   +1.477702942569010e-02   -1.648348405926612e-03   +5.810394749786257e-03; +3.168958410323278e-03   +4.081147800554457e-03   +6.553471608269391e-03   +7.066154104843260e-03   +4.852018376034108e-04   +5.362688135099173e-03   -1.859902576213403e-03   +9.769930209905357e-03   +7.002940959590241e-03   -3.719077866828618e-03   -2.383069700958865e-03   +8.499112456827867e-03   -1.652625181685490e-03   +4.349990190689452e-03   +1.957826252109979e-03   +8.293657414825763e-03; +6.356149281654100e-03   +1.211649161786997e-02   +5.126457974640091e-03   +5.805952798039442e-03   +1.281102234490719e-03   +8.377657811513659e-03   +5.529159555071195e-03   +5.999133923661790e-03   +8.867753375835764e-03   +1.111983197877115e-02   +5.363146614809251e-03   +3.039539693635601e-03   +9.355455264243357e-03   +7.563113831730254e-03   +2.032251170630190e-03   +9.335820805654337e-03; +5.428097306911729e-04   +4.216460467354988e-03   +9.827006997087693e-03   +5.208281771187768e-03   -4.126910934869411e-03   +8.686809141558076e-03   +5.847983703487707e-03   +9.750045003738649e-03   +8.926595212167954e-03   +6.062701910826552e-03   +9.174536580534605e-03   +4.036109683634802e-03   +1.717721579429129e-03   +4.984180842409673e-03   +5.105781094315306e-03   +5.424617110586136e-03; +4.420426149206402e-03   +1.000764931595320e-02   +6.596827138966281e-03   +3.551856084743806e-03   +3.016686621729844e-03   +1.041078823545180e-02   +8.731214055547517e-03   +8.097377073054012e-03   -2.092979188585658e-03   +2.840645211213858e-03   +6.262219636814715e-03   +6.903228333656125e-03   +2.451911228717867e-03   -5.315780437353738e-04   +2.139327337440612e-03   +2.076701469024421e-03; +1.186069672978739e-02   +6.451732934373712e-03   +5.135365086408392e-04   +1.088047915222651e-02   +1.273828032330943e-04   -3.532869079497870e-03   +1.283647424772640e-02   +3.823704738930686e-03   +9.067470069334442e-03   +2.107627358673151e-03   +8.110779761085369e-03   +2.528311951066639e-03   +6.619735335305378e-03   -3.254228273988729e-03   +3.222273952227204e-03   -4.816525634999502e-03; +1.025503474433801e-02   +2.938339641987480e-03   -1.015442832534145e-03   +5.745904905353911e-03   +5.051401059620709e-03   +6.584067137909120e-03   +8.821286229619597e-03   +5.887069663573932e-03   +5.615622291430033e-03   +9.586498187143825e-04   +1.466360259335663e-02   +1.537595467659742e-02   +1.159605262005139e-02   +5.524733312957122e-03   +3.164646026492413e-03   +5.414248166054838e-03; +5.804189961397071e-03   +1.791824467719390e-03   +3.661032795178115e-04   +1.799187342193240e-03   +6.580375166326361e-03   +5.294761520311574e-03   +1.340684638713481e-02   +4.866404079602428e-03   -2.775549932972612e-03   +5.081539544189241e-03   +4.152603246992651e-03   +1.096487579486289e-02   +1.464097593591953e-03   +5.031202181390954e-03   +1.098576645427837e-03   +2.991100167015042e-03; +8.636122917767580e-04   -7.644474750546908e-04   +5.647049479102514e-03   -5.518317827262566e-03   +6.455867902248394e-03   +9.427650843468593e-03   +1.420185982738324e-02   +1.162751694725521e-02   +1.807574840464487e-03   +4.109722248226410e-03   +1.220726414579675e-02   +4.251454176814813e-03   +1.101388801696495e-02   +1.109534919068958e-02   +4.276588502112864e-03   +8.391404693333247e-03; -9.318992478851226e-04   +2.613757925277392e-03   -5.153946522856096e-03   +8.134909924767106e-03   +3.081265886139532e-03   +1.432806733297482e-02   +1.284287139696864e-03   +2.121662521690580e-03   +1.316670399856091e-02   +1.035305665818847e-02   -3.847006854710684e-03   +1.400998301754981e-02   +8.959298011907139e-03   +6.376444961388263e-03   +1.067527192622384e-02   +3.594292992302554e-03; +1.262419277362440e-02   -1.058943746042646e-03   +2.100886797016775e-03   +3.153782680459204e-03   +1.170296560111177e-02   +3.160044615920008e-03   +7.357834309814099e-03   +1.208133629406330e-02   +5.945043560731273e-03   +5.466555946750859e-04   +6.006239165938227e-03   +6.715485496167579e-03   +6.573069052243504e-03   +1.736674423764279e-02   +8.113626632700790e-03   +2.602988451759049e-03; +3.770130190404862e-03   +6.572538747900661e-03   +9.300211267324249e-03   +5.966167245710788e-03   +8.582882936391293e-03   +5.226406895430429e-03   +4.608794789676201e-03   +2.815043001376667e-03   +5.885873785601792e-03   +3.967618281334382e-03   -2.987418101159629e-03   +8.264537745707316e-03   +1.042617034265561e-03   +5.609352547268141e-03   +3.898901509711616e-03   +3.036093498583086e-03; +1.288075900091182e-02   +3.799381464159102e-03   +1.291868879682270e-02   -4.087330881500156e-03   +1.757779108336407e-03   +5.154952466466532e-03   +3.450062707476729e-03   -9.352110234645708e-04   +1.066843038424640e-02   +6.140234152020366e-03   +6.136071140460849e-03   +8.942028955684014e-03   +1.179296969651544e-02   +2.711286962384840e-03   +1.196832714618598e-03   +3.757242405953812e-03; +9.170107702673830e-04   +2.961533898038876e-03   -2.933478353730565e-03   -4.211256933415050e-03   +1.737559857290235e-03   +7.174314474715623e-03   +1.433860605015344e-02   +9.275083594471798e-03   +2.729286507420450e-03   +6.311436573493836e-03   +7.383695475793942e-03   +8.482686139984064e-03   +7.896740743334109e-03   +1.266014642763119e-02   +7.520534609252763e-03   +3.817298229114233e-03; +2.863583860510297e-03   +1.881310126481539e-04   +3.056216290793757e-03   +1.330204019989062e-02   +4.371159288707200e-03   +4.109254755176433e-03   +4.034124307558863e-03   +9.809632457864024e-04   +3.478306149632992e-03   +5.002094493915640e-03   +3.692770988270514e-03   +8.886165754399216e-03   +1.911976363987241e-03   -8.343476823456631e-05   -3.722062295699647e-04   +5.389798763768213e-03; +7.167245205846439e-03   +2.814889262753617e-03   +1.619499643368677e-03   +7.199541105064160e-03   +9.831250052873691e-03   +7.267767177982901e-03   +5.660870194964469e-03   +8.427220466469005e-03   +9.826519125918004e-03   -9.030133586024068e-04   +1.476747902566718e-03   +7.395712716724023e-03   +6.892627320822396e-03   +4.481103026853618e-03   +7.141979272551884e-03   +1.000498940706836e-02];
L2I_L1I_iGABA_netcon = [+1.091510054072216e-02   -2.125335399303090e-04   -4.250294640540405e-04   +1.491124453875336e-02   +8.956790522343928e-03   +8.092969120404355e-03   +4.331586088880610e-03   +1.092557646030277e-02; +9.762777273346963e-03   +4.254946380608285e-03   +1.317396167654268e-03   +5.683805678465747e-03   +4.851213342408419e-03   +4.107609454402905e-03   +7.710916060521592e-03   -3.730809558914141e-03; +3.931742693284055e-03   +2.223197436853683e-03   -2.699447497764810e-03   +8.991261760316501e-03   +1.608526168556969e-02   +1.328308218233656e-02   +4.921772213935256e-03   +9.008382495166578e-03; +6.055021912364435e-03   +8.337116775852849e-03   +8.586897889777706e-03   +1.025911362559602e-02   +9.777230791739188e-03   +4.847215378654594e-03   +6.083469362265145e-03   +1.100514337167276e-02; +6.086503057786624e-03   +1.961859309296732e-03   +7.225353463041326e-03   +8.177821619905412e-03   +6.000034717899328e-03   +1.059894989773154e-02   +3.602188347927151e-03   +6.169143720777729e-03; +1.419658124066944e-02   +3.049961737434585e-03   +2.128195239941949e-03   +9.928905665374110e-03   +8.735990849649357e-03   +7.948932196884032e-03   -1.958244575281822e-03   +4.744278026351075e-03; -4.465266142716785e-03   +1.232637780679665e-03   +1.371274927966791e-03   +4.806335986355720e-03   +8.138336753718198e-03   -5.964604255215360e-04   +4.611046962638261e-03   +1.324124295044386e-02; +8.766440823888383e-03   +4.629583954787670e-03   +7.403156805989518e-03   +8.122883659172858e-03   -2.148067583299068e-03   +1.141221100228937e-02   +6.539310329757379e-03   +2.762036094441280e-03; +2.999657310473639e-03   +1.222454704272253e-03   +4.772844735693929e-03   +4.813172307989188e-03   +1.220483370125544e-03   +5.143538106389867e-04   +4.280218241711473e-03   +8.838802448901130e-03; -9.246528085090585e-04   +3.464641732761398e-03   -4.099432165328894e-03   +3.361082737010727e-03   +2.234275962278476e-03   -1.875711064094845e-03   +1.073803216524815e-02   +4.899237604569837e-03; +2.176208477155348e-03   +1.193953422016777e-02   +1.184165697187729e-02   +4.924622128885035e-03   +1.342359770582795e-02   +6.108775661463843e-03   +4.995562248797897e-03   +3.566330758005062e-03; +1.061707347813598e-02   +6.380998206167191e-03   +3.990020606937436e-03   +3.559170166050509e-03   +1.327444986908741e-02   +6.633437115111771e-03   +9.428021129090875e-03   +4.426583959559987e-03; -4.561026067198471e-03   +9.220805009945189e-03   +3.154645754064124e-03   +1.382228210876781e-03   +4.293063472914235e-03   +1.991320181502270e-03   +1.171466724629349e-02   +7.896826999743513e-03; +8.762809309782326e-03   +8.778091815507068e-04   +1.289535456231419e-02   +2.736449247638674e-03   +5.147559856138328e-03   -1.532325716085449e-03   +9.480309091427656e-03   +4.456591801877632e-03; +6.091993210862981e-03   +3.585818251635980e-03   -8.336163246347771e-04   +1.348815904032866e-02   +1.147172094598557e-02   -3.456526813636464e-03   +8.891227590208660e-03   +9.583405182094750e-03; +2.034139811560035e-04   +4.280298459550944e-03   +4.936670060676174e-03   +3.926582947340652e-03   +1.194328069036964e-02   -2.903540091583637e-03   +5.946458470919363e-03   +8.528466051988780e-03];
L1I_L2I_iGABA_netcon = [+1.180591214278880e-02   +1.221199741666726e-02   +3.344356202228041e-04   +2.263302268276783e-03   -2.124224294213816e-04   +8.218008813457051e-03   +1.306335887602018e-02   +6.784387307125109e-03   +1.224822892377241e-02   +1.014292828829314e-02   -5.785729832866899e-03   -2.104651073393803e-03   +6.707606502674802e-03   +4.764376893034647e-03   -2.114775220934513e-03   +1.288442347369477e-02; +8.703419565039732e-03   +3.627305122149483e-03   -6.088362567368702e-04   +5.892707530259527e-03   +9.041206818855313e-03   +4.697558223279026e-03   +4.707244336365512e-03   +8.693443857322219e-03   +4.978953537190302e-03   +1.644923500557049e-02   +7.738219427570166e-03   -2.510635421905686e-06   +1.048965806273866e-03   +6.772242079610812e-03   -5.048932255830320e-04   +9.585712928082170e-03; +5.931046925396835e-03   +7.113210697230788e-03   +2.237904162409549e-03   +8.758769243051018e-03   -2.867967141447169e-03   +8.508221030897075e-03   +3.080448691747601e-03   +5.083968381708264e-03   +4.916208492147253e-03   +1.080955394416325e-02   +8.140573219476522e-03   -2.884852984052517e-04   +3.398917578563564e-03   +4.954864689380212e-03   +5.279591599986954e-03   +5.570839568892686e-03; +1.310633009438800e-03   +4.159479805144233e-03   +4.593556402404766e-03   +5.849153928077569e-03   -2.126703429139017e-03   -3.089544252323336e-03   +7.315802486409114e-03   +8.420938280865846e-03   +2.024033016668535e-03   +5.976868515280013e-03   +4.878563274970587e-03   +3.913695152797834e-03   +3.465233317740897e-03   -2.858634579296268e-03   +8.928269046352693e-03   +1.868393506296709e-03; +3.280964018732499e-03   +1.005027176864134e-02   +1.025010616859393e-02   +5.671615730040315e-03   +8.213129458004429e-03   +1.079935248190437e-02   +1.328929255297374e-02   +1.676760398245480e-02   +3.558158371632898e-03   +3.431019851784759e-03   +6.598357264626539e-03   +5.371131999593726e-03   +8.510041034630376e-03   +6.873778586445107e-03   +2.613001869801865e-03   +7.805973646237890e-03; +6.293218259459210e-03   +6.365882693727976e-03   -8.180359752600956e-04   +1.137929519689779e-02   +8.384376869576384e-03   +9.224987546953235e-03   +1.443727861427945e-02   +7.095055938568877e-03   +1.217217301056063e-02   +6.066557297301647e-03   +7.779629159600427e-03   +9.340532764809357e-03   +5.831259105405972e-04   +1.102342181964518e-02   +9.657123683275634e-03   +8.219716101827198e-03; +1.087415704338658e-02   -1.820889132170696e-04   +7.857551951597538e-03   +7.754956668069468e-03   +6.273744886894322e-03   +1.286074954901542e-02   +8.422248992619600e-03   +2.421659881439622e-03   +8.759599005331196e-04   +8.849714340311832e-03   +1.538205399289979e-03   +3.128452130481901e-03   +1.012644753381918e-02   +5.744011292104186e-04   +1.063385486893201e-02   +4.146524684984828e-03; +8.737143061335524e-03   +4.995278408903852e-03   +3.553924269422809e-03   +5.136610235202939e-03   +4.854155182024927e-04   +6.983216410769528e-03   +7.386886969681579e-03   +1.080297973616306e-02   +1.986986362983005e-03   +8.355100855422615e-03   +3.134004831991429e-03   +2.053935838928365e-03   +3.500783457245889e-03   +1.907442599052218e-03   +7.051018492797694e-03   +5.411940785898009e-03];
L2E_L1E_iAMPA_netcon = [+9.664906067332385e-03   +6.076030428368857e-04   -1.936752023299091e-03   +4.477606953297656e-03   -3.813539727740109e-03   -5.769107484383839e-04   +9.093932397841781e-03   +1.794496987577822e-03; +9.064706221572580e-03   +8.585714801541121e-03   +7.927787093622114e-03   +6.715967535422127e-03   +1.316570998978931e-02   +1.584577609402951e-03   +1.127586027935774e-02   +6.837421657201830e-03; -6.453355825968381e-04   +7.199901833928898e-04   +5.402006774490000e-03   +8.206237212271211e-03   +2.781194301789072e-03   +1.246177780052983e-02   +1.762309352742100e-03   +3.345474848721960e-03; -3.223294881040926e-03   +6.211760631830692e-03   +2.098257893833643e-03   +1.318537447509627e-02   +1.283579409582273e-02   +5.805622273320265e-03   +8.822286398227009e-03   +9.450000004849619e-03; -2.106757246647047e-04   +1.252929372407035e-02   -3.048912936861121e-03   -2.354539233065418e-03   +6.471587906913891e-03   +9.218336001870929e-03   +1.350605233451292e-02   +4.918801333537468e-03; +3.633544008991381e-03   +4.044493028744021e-03   +1.420939673956571e-02   +1.123182412915849e-02   +8.922026968347860e-03   -3.482012406336832e-03   +4.645894588244567e-03   +7.589750825701301e-03; +4.117817707608376e-03   +5.835350346382952e-03   -2.963617873120390e-03   +1.775120533730502e-04   +4.409525765312185e-03   +3.279821397249395e-03   +1.130587549466247e-03   +5.233982281332959e-03; +5.580093092313709e-04   -4.724066455064071e-03   +1.983550925948713e-03   +1.337384067376267e-02   +3.110051446276374e-03   +8.899519088334628e-03   +1.252061279768529e-02   +9.031529536437060e-03; +6.282791363697879e-03   +1.211465636279699e-02   -2.192920536028143e-03   +2.485005553740320e-03   +1.889118279438246e-03   +1.138091159134850e-02   +1.048586475187372e-02   +6.550001255849250e-03; +7.854725136350472e-03   +7.674794883911996e-07   +9.810796477467548e-03   +9.081222627887740e-03   +1.677324715015469e-02   +1.064605879655889e-03   -2.021807759789447e-03   +4.894580047682570e-03; +1.095397776117710e-02   +5.849708871979556e-03   -4.603372994888406e-03   +4.931784311819222e-03   +5.818808648107653e-03   -1.467573407240305e-03   +7.780634461704229e-03   +1.131482195565779e-02; -2.949938190604921e-03   +7.562463791622345e-03   +9.450923883704596e-03   +3.191064742417436e-03   +8.941240218250069e-03   -4.757709842360792e-03   +1.419232157358409e-02   +3.470233029711947e-03; +3.780222060954383e-03   +2.578751685657113e-03   -2.028054727458990e-03   +3.806234167997397e-03   +1.560106909959186e-02   -1.850458975085169e-03   +7.779546960916839e-03   +9.034973303086247e-03; +2.179595575532029e-03   +2.135797071235969e-03   +3.883361568998554e-03   +7.555651163177670e-03   +2.328377507555626e-03   +3.717079332105263e-03   +4.567207983812469e-03   +1.482040183503622e-02; +4.170828976590336e-03   +3.053939136153493e-03   +4.538054086938613e-03   +9.652877804037875e-03   +1.408075772914032e-03   +8.636972672134645e-04   +6.827157650620253e-03   +1.739175685757375e-03; +7.024627089264996e-03   +7.960505041931205e-03   -7.302052735871098e-04   +5.396989410782412e-03   -5.397322002772860e-03   +3.534503102522732e-03   +5.358677661096604e-03   +1.126316602577481e-02];
L1E_L2E_iAMPA_netcon = [+3.287567667870496e-03   -2.452809971104734e-04   +7.055391440223870e-03   +1.238673402236936e-02   +1.363328137923347e-02   +1.347144957777432e-02   +4.653647225177208e-03   +1.177428373127705e-02   +5.449726208237966e-03   +3.409922035997848e-03   +4.084279579961601e-03   -1.943965665200303e-03   +6.492019792541056e-03   +9.697267023639355e-03   +5.958377447527803e-03   +6.397670315179078e-03; +3.103898687415869e-03   +1.114420340854318e-02   +6.823261267609372e-03   +9.515301831955541e-04   +4.534415641085544e-04   +1.261107793353132e-02   +2.082374216867769e-03   +3.341152779058878e-03   -2.138403222780001e-04   +5.754846187882258e-03   +5.371182457251202e-03   +5.940033259787062e-03   -3.077976651649561e-04   +3.313251028775245e-03   +3.389072055831595e-03   +1.357160981057119e-03; +4.787010633198457e-03   +8.378220160302782e-03   +1.105345331847988e-02   +1.394332307228304e-02   +1.403871638598029e-02   +5.028251171895111e-03   +9.036514722362490e-03   -2.402445490837736e-03   +6.500700258312135e-03   +3.148690590343704e-03   -6.666344973712592e-04   -6.792363815327212e-04   +5.248040917665511e-03   +5.868759701774313e-03   +1.085381460092359e-02   -1.787682807717187e-03; +7.918310796326601e-03   -2.510428025895589e-03   -1.596254002755772e-03   +1.990480004884680e-03   +6.558317222748863e-03   +5.071165312479320e-03   +1.018817293584494e-02   +4.661230834534706e-03   +7.481091075748211e-03   +1.127250106213841e-02   +1.080811059417303e-03   +7.126002892237903e-03   +1.212436799551164e-02   +1.472237962443717e-03   +1.195924244259612e-02   +6.551831459680673e-03; +6.640243354917391e-03   +7.265170088383475e-03   +7.535096089433455e-03   +3.028591239056510e-03   +5.281686511061318e-04   +5.183536166879864e-03   +6.534034683822050e-03   +4.963017299837217e-03   +2.715129057702968e-03   +5.855779855103525e-03   +1.074018183445354e-04   +1.221881265918571e-02   +7.649581815849275e-03   +3.845392978643160e-03   +1.607887207971651e-02   -4.634645569858838e-04; +4.077551438980209e-03   +7.761352352700163e-03   -1.237550151767013e-03   +9.589028684152217e-03   +1.606009859116938e-02   +1.199630020113865e-02   +3.387537848250426e-03   +7.411989384367225e-03   +4.065527194706564e-03   +5.517897948145115e-03   +5.524504571086656e-03   +1.543735821935389e-02   +1.029327636425320e-02   +1.569087351280662e-03   +1.199263161203519e-03   +1.290316071654189e-02; +4.100254266623684e-03   +6.644066601749398e-04   +1.315722986795726e-02   -8.508461961376766e-04   +4.645459848625473e-03   +4.983629801652323e-03   +9.498863385110624e-03   +1.449219349857849e-02   +5.325618261601424e-03   +1.000384733592132e-02   +2.097184129400420e-03   -6.027430985793267e-03   +6.418338586643422e-03   +3.504366527735666e-03   -3.794584053310163e-03   +4.588880711126692e-03; -2.349935923760505e-03   +6.094605550228565e-03   +7.550986581338549e-03   -5.911825880265698e-04   -2.744106124843153e-04   +1.406647228885190e-02   +4.165196838545194e-03   +1.315659877120716e-02   +1.154479587746904e-02   +4.219910430792898e-03   -1.106689359316831e-03   +9.473101315536910e-03   +7.635556651215295e-03   +7.081445099624444e-03   +2.889153540782590e-03   +1.747031942954118e-03];
L2I_L2E_iAMPA_netcon = [+7.456536172770934e-03   +5.386558469505230e-03   +9.856571046203973e-03   +7.769370950841134e-03   +9.171673569147540e-03   +6.413684198174151e-03   +6.330678204713095e-03   +6.985837416477442e-03; +1.927153817724048e-04   +2.192870303350865e-03   +2.709143871552696e-03   +9.759853950393929e-03   +4.531525360554909e-03   +3.428742490658326e-03   +4.671564751686218e-03   +5.680775240195046e-03; +9.405031810655882e-03   +1.035839371471504e-02   +5.860973453545208e-03   +5.936212731152885e-03   +5.759310784141438e-03   +6.768937339363349e-03   +7.277828241298714e-03   +9.319871741246998e-03; -3.093784169607827e-03   +3.048417414799247e-03   +8.286332834173245e-03   +3.098918464735196e-03   +1.035023147439140e-02   +3.730407995873219e-03   +2.890823867512089e-04   +8.727401331945767e-03; +6.689944505626546e-03   +7.634835036359174e-03   -4.724856769474222e-04   -3.693374574170446e-03   +1.029044682959774e-02   +8.743298717204143e-03   +2.153924407516105e-03   +5.117101095738832e-03; +4.949577534727361e-03   +4.527861460063868e-04   +6.481182645275358e-03   +5.183411003830560e-03   +7.808004488411272e-03   +7.782510509787403e-03   -7.259342179343781e-03   +1.208243490535319e-02; +1.368737783188323e-02   +1.366897138216448e-03   -3.379772056880330e-03   +3.479605550806937e-04   -7.017291517722204e-03   +4.883427772660104e-03   -2.996033377435470e-03   +7.228254059687328e-03; +9.415834473457695e-03   -3.060073678352990e-03   -1.804170724103990e-03   +4.930913054606695e-03   +1.092817308149244e-02   +4.944671537855076e-03   +5.170211051806236e-03   +6.307432629908077e-04];
L2E_L2I_iGABA_netcon = [+8.345939069477479e-03   +3.407662436191650e-03   +7.254459984161694e-03   +1.204854600492269e-03   +1.533158414547891e-02   +3.519197331789416e-03   +5.613240598713562e-03   +8.083146298783699e-03; +1.478634211589505e-03   +5.303054919848314e-03   +7.533366227624363e-03   +2.694979556020596e-03   +8.914625441992152e-03   +8.459449935755401e-03   +9.662131872743715e-03   -1.828285681186088e-03; +4.111136397265049e-03   +2.370267212939293e-04   +3.993154853064136e-03   +1.024271397451511e-02   +5.341798487154339e-03   -2.358954098446691e-03   +9.711638733452802e-03   +1.001245343394786e-02; +9.416936272099047e-03   +2.968059732123168e-03   +3.442102445821170e-03   +1.192858999118944e-02   +5.354209103651030e-03   +9.020158749445593e-03   +6.073040159852538e-03   +4.985636759440996e-03; +4.205187301866891e-03   +5.285448222646188e-03   +9.692207744480059e-03   +1.024641003005422e-02   +3.533185718765292e-03   +2.652265952723229e-03   +7.688970580190820e-03   -1.767985081970013e-03; +1.193665109697464e-02   -5.707964355250201e-03   +6.896917041393824e-03   +1.076912670225734e-02   +1.377122134032576e-02   +4.060766568962861e-03   +8.536977097201123e-03   +6.663794528967576e-03; +3.156204706771344e-03   +1.429315111765187e-02   -2.787154999002529e-03   -8.992244374146044e-03   +5.911922284296943e-03   +9.631763560321175e-04   +7.093656157184072e-03   +5.734401693219542e-04; +1.109831052266938e-02   +1.156864481539071e-03   +4.568368316732649e-03   -5.739500720231433e-03   +5.370855847384947e-03   +1.057683255653610e-02   +1.203907397977659e-02   +9.544399266283990e-03];
L3E_L2E_iAMPA_netcon = [+5.599554017886382e-03   +1.125231180818389e-02   +4.063628852584343e-04   -1.353439530131298e-03   -7.144032904452985e-03   +1.089427418320806e-02   +3.288047739007544e-03   +1.036595882738709e-02   -2.835420227398300e-04   +3.506424589226787e-03   +4.865965983845808e-04   -3.044143542474630e-03; +8.990141688625178e-03   +1.168046490623657e-02   +6.203522059995328e-03   +8.530373609458851e-03   +5.435418458584153e-03   +1.070724622549361e-03   +9.141234536293933e-03   +1.202706279603167e-02   +1.127512146720618e-02   +8.326839838215666e-03   +4.421136846793068e-03   +1.924656495434875e-03; -3.726387499567191e-04   +9.109972814890300e-03   -1.533073547996702e-03   +6.973424166010694e-03   -3.111803143734966e-03   -4.707022365064884e-03   +4.097691230349251e-03   +1.127651001529055e-02   +7.915358437417714e-03   +7.637342062059757e-03   +8.542396214246090e-03   +1.259660368703621e-02; +4.766130811739667e-03   +8.729804935214411e-04   +4.570134258457744e-03   +1.354315456343368e-02   +3.597519388594445e-03   -1.190848705696173e-03   +7.398909572932204e-03   +1.588351444652956e-03   +6.600336882129936e-03   +7.394557758299966e-03   +5.965536582292329e-03   +5.819646283342626e-03; +7.207194013409328e-03   +3.506171000770255e-03   +7.270495025900452e-03   +1.564366160456791e-02   +7.102722961340591e-03   +3.349557865753525e-03   +9.790825430576636e-03   -2.439361669873013e-03   +1.651789401628722e-03   +1.001116772989902e-02   +1.073616728951790e-02   +2.762185967774406e-03; +7.881255849414142e-03   +3.597130897400476e-03   +4.036504590870688e-03   +4.731828245410419e-03   +3.363174944199002e-03   +1.553897401580056e-02   +1.300993574762551e-02   +8.889296057855879e-03   +7.973896364382720e-03   -6.069505453469338e-04   +1.212763257917415e-02   +1.596108806882136e-03; +6.962061919871183e-03   +6.967847838251307e-05   +1.004355542906600e-02   -1.493905901773948e-04   -4.725567488543130e-03   +4.624818126262028e-03   +9.772314353155924e-04   +6.325068221624425e-03   +4.673104985590777e-03   +3.331663492609603e-03   +1.028805691399889e-03   +8.720932610065096e-03; +8.295446796639150e-03   -1.218953109663330e-04   +1.309594293363134e-03   +3.548465367006903e-03   +1.068758758170985e-02   +2.992582147167226e-03   +8.496254909540609e-04   -3.944416275629535e-04   +1.639430206494222e-03   +1.281458737527328e-02   -3.989575238741977e-04   +1.243416821159829e-03];
L3I_L2I_iGABA_netcon = [+6.360335435016366e-03   +7.036735112447091e-03   +9.334827554595925e-03   +9.580030045129138e-03   +9.383705069750965e-03   +7.706619201516461e-03   +1.350578826089487e-03   -5.395771380368979e-03   +1.061816963116652e-02   +1.209346906622221e-02   -5.714831522115155e-03   +1.401350095496047e-02; +9.276081849385574e-03   +1.219465559585446e-02   +1.093847802702387e-02   -2.825654516998837e-04   +7.505552990434968e-03   +1.155377608202284e-02   +4.943664477689692e-03   +2.560742496918645e-03   +9.005755356242855e-03   +7.313902817951768e-03   +3.584493617603900e-04   -7.933882662093780e-04; -3.059031203557460e-03   +2.182720336429556e-03   +7.186881884562114e-03   -5.737086971349668e-04   +6.058082519194328e-03   -2.130783926689359e-03   +9.184643560155999e-03   +4.521448029070296e-03   +9.649198022591220e-03   -3.303928186870510e-03   +6.019322410474478e-03   +4.723175563737164e-03; +1.496209426975309e-02   +4.476287248405411e-04   -1.526430131663705e-03   +7.694256427217373e-03   +7.154067277556767e-03   +1.152644303656244e-02   -5.038063732560686e-03   +5.741143869457449e-03   +9.242487056582736e-03   +3.764358276592385e-03   +7.753841253820987e-03   +9.889900935867902e-03; +3.697513062232391e-03   +1.220001074749752e-02   +8.588342013063009e-04   -3.096787706602448e-03   +3.827188072123557e-03   +1.274719108003644e-02   -1.701335339911046e-03   -4.452792590007527e-04   +1.097930435257185e-02   +1.200847147507452e-02   -3.903132280188343e-03   +4.672577975519354e-03; +1.063074636930484e-03   +4.741954244202370e-03   +4.266347876987552e-03   +4.684721804447625e-04   +3.780342026612251e-03   +8.111223308826349e-03   +7.458187063963862e-03   +3.772039903078937e-03   +2.837902069201621e-03   +4.146625573248691e-03   +4.916723648845181e-03   +1.627837087088887e-03; +9.126381739065154e-03   +7.777759409785463e-03   +5.534036690407310e-03   +9.834574608023949e-03   +3.011145394940357e-03   +2.898258616661882e-03   +4.002703058137681e-03   +6.162207557218059e-03   +1.019439951660001e-02   +8.192260460605307e-03   +1.240606690618630e-03   +9.613478444391760e-04; +2.840987210981192e-03   +3.099089966899467e-03   +2.712711886970118e-03   +8.214225540681287e-03   +6.571597801241037e-03   +2.828310853962711e-03   -1.233033277015318e-03   +2.557727704599164e-04   +1.370767623026960e-02   +4.913004454414604e-03   +3.527727162554425e-03   +7.978137317074399e-03];
L2E_L3E_iAMPA_netcon = [+1.072699924771918e-02   +1.224394869834249e-02   +7.159136821385635e-03   +9.812994261686948e-03   -2.061158791615157e-03   +5.371040792814655e-03   +1.147274171616094e-02   +1.111178065831724e-02; +8.910198090320717e-03   +1.191318489469343e-02   +9.054684859472384e-03   +7.532603272540807e-03   +3.995275126055240e-03   +4.822420675259220e-03   +1.085393644682855e-02   +7.853299964096547e-03; +7.638633803643054e-03   +7.042849747224873e-03   +1.566162680660226e-02   +1.117120061935537e-02   +9.321150414889652e-03   +7.626687432819578e-03   +7.215350362199550e-03   +4.006358124737768e-03; +2.181389754613162e-03   +7.293176176079373e-03   +9.846507451475282e-03   -2.068481113365908e-03   +2.288282612308652e-03   +6.479301805848174e-03   -4.194172355066060e-03   +5.214058302423967e-03; +7.322963200294824e-03   +2.851067246066152e-03   -1.613496227940240e-03   -2.485803943936908e-03   +1.793961288801651e-03   -2.333781515997947e-03   +9.113455566615716e-03   +7.350377898764234e-03; +7.168430134849453e-03   +9.733968749642793e-03   +4.602142597831684e-03   +3.072712254387833e-03   +1.250983714700778e-02   +1.515560936269734e-02   +4.444690839150299e-03   +1.187761459865630e-02; +4.152886881948951e-03   +1.152599340712253e-03   +9.039455475981053e-03   +1.029011974672186e-03   +3.286914171114880e-03   +1.067136107404436e-02   +4.729415706215405e-03   +5.896264187217016e-03; +1.553851569332003e-02   +6.005715988927881e-03   +9.622505925041170e-03   +9.318337054158667e-03   +9.328397765890057e-03   +1.158324650625999e-02   +7.636688390601375e-03   -3.737410626677331e-04; +2.904929018777807e-03   +1.870472810859557e-03   +6.441809321206020e-03   +9.804287593649002e-03   +6.106034513628445e-03   +3.088156846595592e-03   +1.115067345878184e-02   +1.753413312801673e-03; -3.170428007730705e-03   +4.944638849167180e-03   +2.663260927475634e-03   +1.042458559779614e-02   +9.459145453016977e-03   +3.304860500568696e-03   +1.386962242238069e-03   +8.387681544762972e-03; +5.698723037416152e-03   +3.147894969809164e-03   +6.447995895464719e-03   +7.912687921881951e-03   +1.572633696660697e-02   +1.174811406031002e-02   +5.082929621527824e-03   +3.278706632699011e-03; +1.805891138720519e-03   +9.104803412564718e-03   +6.461395126928126e-03   +1.094963526848576e-02   +9.548095690399995e-03   -3.144392176169223e-04   +1.333748345215118e-02   +1.087807716676228e-02];
L2I_L3I_iGABA_netcon = [+1.425985512006715e-02   +9.420077478419879e-03   +1.036573745190448e-03   +6.298029270175180e-03   +1.024707799769784e-02   +1.133697339195884e-02   -2.416671320780961e-03   +6.029383792367983e-03; +3.670842594527692e-03   +7.065733289093735e-03   +1.439600892744318e-02   +1.024622184794119e-03   +7.392660318154323e-03   +6.823029433386585e-03   +1.481541906573484e-03   +8.007810682363397e-03; +7.133105729003732e-03   +1.100606816844787e-02   +6.397583177253240e-03   +5.005950677451031e-03   -6.486189179763674e-04   +3.417332798740187e-03   +6.404394008465338e-03   -6.126108165628004e-04; -1.662825132113084e-03   +1.169473259585992e-02   +2.100936335504208e-03   +3.293134319104393e-03   -3.822962656366302e-03   -3.221763812435823e-03   +5.718295571249921e-03   +8.445752741506760e-03; +2.937527821780849e-03   +3.740925438026114e-03   +3.391892867784931e-03   +3.761372733875745e-03   +1.028193686857285e-02   +3.355635585632828e-03   +1.324659072830380e-03   +7.832090668189210e-05; -4.321798366046096e-03   -2.742254580816745e-04   +1.087723581435215e-02   +7.327473504952504e-03   +4.467486720009576e-03   +2.756422642796756e-03   +5.607590781207006e-03   +1.148972813663348e-02; +2.507959806279531e-03   +4.876810151150898e-03   +1.028867995602600e-02   +1.054366475466705e-02   +4.189296467934610e-03   -2.047504266631327e-04   +9.397434900014879e-04   +1.245462244549115e-02; +3.417205760435105e-04   +1.599859199864370e-02   +2.460259419470860e-03   +5.473065379028986e-03   +5.753519956369815e-03   +9.361680330273318e-03   +6.519476076575616e-03   +3.796109102817265e-03; +1.088427146702592e-02   +8.172371291221637e-03   +1.475777229823973e-02   +6.359681650430044e-03   +4.736668752083609e-03   -2.506579626792634e-03   +2.458173795734640e-03   +5.863171003340335e-03; +8.753962815799838e-03   +9.666159967640591e-03   -1.437703173683055e-03   +1.305433628872713e-03   -1.608690990567526e-03   -5.795250862006118e-03   +4.585363905538379e-03   +2.235824105584200e-03; +8.790801147836327e-03   +1.300713914921671e-02   +2.583179137609931e-03   +3.721105814952717e-03   +4.547358737355622e-03   +5.338357261154564e-03   +6.219410638044754e-03   +5.559136116151818e-04; +5.594480225430186e-03   -2.070740507871578e-03   -3.022462457094039e-04   +3.483475917809231e-03   +9.507634326040457e-04   +1.207925467421003e-02   +7.705603660570680e-03   +4.844197525260121e-03];
L3I_L3E_iAMPA_netcon = [+8.234400525202466e-03   +8.215893181195226e-03   +6.891287211227470e-03   +1.135036987645138e-02   +1.255466070367950e-02   +6.992097851831356e-03   +5.702832649646874e-03   -1.450152775770613e-03   +6.021228792549555e-03   +6.454523099956684e-04   +1.352251178934769e-03   +2.593660488197529e-03; +5.949421527239454e-03   +7.677701597724019e-03   +1.784039505070757e-03   +4.649229066927429e-03   -3.847034185614951e-03   +5.975456615762802e-03   +9.023751697970091e-03   +3.785239416731456e-03   +1.415845460869148e-03   +5.497466571345187e-03   +9.348547270021521e-03   +9.401123641774393e-03; +2.305458185127983e-03   +1.026072675048080e-02   -1.011705569678315e-03   +1.309087137239350e-02   +2.600138031698760e-03   +8.734330973493154e-03   +7.309129499199145e-03   +5.499032525377944e-03   +6.847141610029175e-03   +8.695480864844174e-03   +3.054144183466942e-03   +8.197973330416396e-03; +1.070140575023694e-02   +1.156198584176843e-02   +8.844919064019085e-03   +7.131964110803545e-03   +3.073988097717285e-03   +6.886680085260576e-03   +1.512817228892108e-02   +4.988506655187927e-03   +1.042955680174991e-02   +1.597018864256316e-02   +9.907162488941483e-03   +9.106703239274328e-03; +7.433931438075787e-04   +2.399986664322573e-03   +2.917732856804029e-03   +1.105586300510388e-02   +4.805367918739338e-03   +4.085833366934600e-03   +1.010393981107038e-02   -8.977306632014520e-04   +7.203338288371578e-03   +3.706186536785746e-03   +2.839441499390173e-04   +6.195571843379878e-03; +7.468632207996778e-04   +7.623304653066743e-03   +9.507945128179665e-03   +9.072066746166370e-03   +1.113483831046825e-02   +2.315455386487515e-03   +1.049259274869111e-02   -6.468071127302725e-04   +7.094320617818861e-03   +1.784563048884940e-03   -3.035884466256163e-03   +5.210977528100675e-03; +5.809824194980698e-03   +4.389897298341368e-04   +5.159924232553079e-03   -9.587655300223948e-04   +6.234174701783917e-03   -3.168957858131162e-03   +1.852996300435175e-03   +6.505174104579496e-03   +5.426517803827210e-03   +1.326366247100278e-02   -1.608563538587352e-04   +1.021410259678029e-02; +5.912248731939742e-03   +4.513163383232091e-03   +1.163434083551515e-02   +6.819616510455775e-03   +7.495655615071598e-03   +1.299541965474732e-03   -1.072874754018737e-03   +2.154071100428486e-03   +2.548071778064756e-03   +1.435112456627694e-03   +2.327284367272447e-03   +1.046909015506770e-02; +2.922598014755131e-03   +7.194677237401710e-03   +5.836950925979640e-03   +7.993748670298608e-03   +3.833960040509296e-03   +1.088146112763122e-02   +1.349734083043682e-03   +1.316933269033196e-02   +1.312174471784763e-02   +1.031715487711056e-02   +7.594669743017677e-03   -7.282863709430502e-04; +7.613691907518659e-03   +1.145970128673629e-02   +1.239054492150908e-02   +4.569271117776316e-03   +1.204282850342778e-02   +8.661154420997186e-03   +2.011206874714789e-03   +1.573768702409222e-02   +4.412086472542650e-03   -1.768546274489996e-04   +7.207870612061342e-03   +1.124627615987856e-03; +6.441865743933724e-03   +2.256286627509840e-03   +1.331438210169407e-02   +8.872866230400062e-03   -4.472531064986395e-03   +7.944300264399804e-03   +5.864430318393307e-03   +5.469318633949286e-03   -3.480161383907706e-04   +8.973700261630196e-03   +2.230704641526715e-03   +9.454759983533673e-04; -1.605239799377906e-03   +7.803996354232565e-03   +1.384611653865661e-03   +9.848696464473838e-03   +1.642532731730004e-03   +1.893145212719741e-03   +1.659266088896491e-02   -4.783071644720482e-03   +2.276487414015647e-03   -1.552307564860676e-03   +1.176878697530139e-02   +5.202912200089393e-03];
L3E_L3I_iGABA_netcon = [+1.491082519019687e-04   +2.864294288638511e-03   +3.145007187904692e-03   +1.295280223021817e-02   +9.639827428218449e-03   +1.272173202060505e-02   +2.838073878064410e-03   +6.029695565148310e-03   +8.783317901270505e-03   +8.456343137184970e-03   +5.460760249248682e-03   -3.090193779634109e-03; +1.077286045677307e-02   +8.089572473847888e-03   +4.734545967300613e-03   +2.198641510625085e-03   +7.356169538042981e-03   +1.041840899505700e-02   +1.905205044047993e-03   +5.713778713755209e-03   +7.001044632255118e-03   +9.910969601116790e-03   +2.261899162944985e-03   +1.253441736153858e-03; +8.901636997513949e-04   +6.360527713246179e-03   +8.812334782338678e-03   +3.515986638208117e-03   -1.000326720461442e-03   +9.040661797556426e-03   +7.362985082994039e-03   +1.006538711078049e-02   +4.316684990486899e-03   +1.102116482274662e-03   +5.440907456890545e-03   +4.107386321658611e-04; +2.382092620728941e-03   +3.279430220444574e-03   +1.514863965521556e-03   +1.125964447427328e-02   +9.384181827894906e-03   -1.136730116737627e-04   +1.585832776523780e-03   +3.808904460283947e-03   +9.454850027799113e-03   +2.928615118958173e-03   -4.458457836257325e-03   +6.714738676543847e-03; -1.509928424190990e-03   +1.256510952271312e-02   +1.397115807733614e-02   +7.067323636112199e-03   +4.991099535018874e-03   +6.733396863085640e-03   +1.065824466384681e-02   +1.359670973444996e-02   +7.882283880622979e-03   +1.333088291167280e-02   +1.374810516130171e-02   -2.599457252293018e-04; +6.134653630974387e-03   +2.878868924214617e-03   +1.694748854588637e-02   +7.491879987324200e-03   -8.869638908313286e-04   +1.305147812145073e-02   -1.054613290682254e-05   -5.227256193212082e-03   +1.176469057704838e-02   +6.228080198323683e-03   +2.675229860672329e-03   -2.436449213112244e-03; +2.011418845287448e-03   +5.378003232817819e-03   +9.237382082065008e-04   +7.929287107083039e-03   +6.219516755719381e-03   +9.844513933608001e-03   +2.875632778034223e-03   -6.490638126755934e-04   +7.689992384081652e-03   +6.124468214747101e-05   +1.006930939317073e-03   +7.338323131210323e-03; +2.824935652322314e-03   +4.886574846041438e-03   +7.134413916884118e-03   +9.885145192759903e-03   +2.404479571007040e-03   +1.196297008765578e-02   +6.302478885723856e-03   +2.210466014590778e-03   +1.223483263886612e-02   +1.098819640101232e-02   -6.552237687245344e-04   +9.018074192400189e-03; +2.661647701859883e-03   -6.868890874416082e-04   +9.381289267888025e-03   +1.598020916441859e-03   +1.273517369495882e-02   +5.862524655262693e-03   +3.658472189978542e-03   +1.883868437198604e-02   +7.331514848996899e-04   +3.134389773215332e-03   +4.035689130143912e-03   +5.911418186459022e-03; +9.276396208399046e-03   +1.151020667849134e-03   +8.949073765218073e-03   -1.942229627254396e-03   -1.346843135389761e-03   +1.364389878266112e-02   +7.504276907208683e-03   +9.084602418092733e-04   +9.840396161442061e-03   +9.603739795497279e-03   +3.743296582595197e-03   -4.821030413629719e-03; +3.124460081618976e-03   +6.083632180375777e-04   -2.821121738785726e-03   +2.968526119039957e-03   +8.230724821246843e-03   +3.509522932195706e-03   +1.486930331556278e-02   +7.959804527772622e-03   +1.055894198193817e-02   +5.679197038046451e-03   -4.298743278563678e-03   +8.969113401240460e-03; +8.246015304245390e-03   +5.252755847363645e-03   +5.328109389757826e-03   +2.481575759536962e-03   -1.298386245568052e-03   +4.575365732873640e-03   +1.462973880504127e-02   -4.198879082908798e-03   +1.288624627371053e-02   +8.853513344796043e-03   +3.688990454401271e-03   +4.541418530518833e-03];
L2E_Input1_iAMPA_netcon = [+6.817497552095098e-03   +1.023761664564781e-02   +8.400641998879920e-03   +1.176787946990001e-02   +1.794357424196356e-02   +1.410723112359796e-02   +8.947395617796786e-03   +5.472815003508708e-03];
L2I_Input2_iAMPA_netcon = [+6.548264439443570e-03   +1.120880893654478e-02   +1.104133405582521e-02   +8.931666450275216e-03   +4.297782518173026e-03   +9.817535784549705e-03   +1.157468694333468e-02   +1.223925865268993e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
