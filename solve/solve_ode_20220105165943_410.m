function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.243869692721391e-01   +4.224790528074012e-01   +5.308569723179882e-01   +6.360904060433028e-01   +5.995983434345324e-01   +3.412044487969011e-01   +6.482389678624424e-01   +8.394380611301091e-01   +5.442142545548897e-01   +1.928856257597544e-01   +4.481603990541227e-02   +8.224079089618174e-01   +7.681465407828044e-01   +1.101358038233378e-01   -6.565970397649420e-04   +8.395833528771068e-02; +9.828116888512045e-01   +9.610434872862564e-02   +3.238655480716263e-01   +9.570797924618288e-01   +3.872212340608047e-01   +6.066297487677822e-01   +6.785319921188868e-01   +8.318360284599811e-01   +7.224086980630364e-01   +1.378197086876310e-01   +7.530945145634461e-01   +4.304338222136063e-01   +1.678911342401805e-01   +1.361714991757166e-01   +8.653706876954481e-01   +6.269866318064836e-01; +7.306789156494503e-01   +5.969520028026047e-01   +1.055472108750254e-01   +2.414899533353288e-01   +9.157200379294038e-01   +1.918878408964688e-01   +6.346130504299436e-01   +2.556325127953656e-01   +5.214020284992550e-01   +6.958605510453189e-01   +2.409182965953500e-01   +8.878678662653290e-01   +8.633567689139603e-01   +6.793756138287744e-01   +6.131045207435437e-01   +6.615814143769171e-01; +3.450906581927684e-01   +4.724133180246746e-01   +6.112852943259065e-01   +6.762728760726603e-01   +7.075646122728459e-04   +7.397720614218218e-01   +9.460138514159062e-01   +6.139708957642905e-01   +9.928047554279371e-01   +9.266481994637026e-02   +4.422637604614841e-01   +3.916177532346717e-01   +9.901645574223724e-01   +4.947983059517635e-01   +9.886850533927231e-01   +7.301662200697877e-01; +5.863882144435922e-01   +6.958962698934201e-01   +7.804425282627523e-01   +2.882703906280076e-01   +4.624756764516637e-01   +2.419061212065808e-01   +2.093049495096409e-01   +5.826398016162085e-01   +2.213479055633968e-01   +5.236712448117027e-01   +6.873583635527671e-01   +7.694813302675612e-01   +5.156771645149326e-01   +1.883780021762373e-01   +5.262370400102743e-01   +8.928325265156287e-01; +1.084081145637982e-01   +7.005951464217048e-01   +4.235031498590546e-01   +6.704852947260745e-01   +4.253415371673120e-01   +9.196800152295356e-01   +7.088527165207997e-01   +5.414831612230356e-01   +1.048440254568271e-01   +5.318136896812692e-01   +3.583286414404150e-01   +3.968647202294571e-01   +8.845566337774775e-01   +4.940580985813861e-01   +4.809641673110884e-01   +9.822291154328924e-01; +9.053255655808282e-01   +6.395988613035306e-01   +9.091737014872969e-02   +6.938391457577473e-01   +4.603971683957724e-01   +2.707097868334091e-01   +2.368998252753509e-01   +8.708198575638041e-01   +1.111951272356851e-01   +8.611644728709436e-01   +7.364200156684996e-01   +8.095486386530434e-01   +5.876538044969237e-01   +1.487917104045176e-01   +8.024839908247724e-01   +7.692424062870243e-01; +8.815010037588777e-01   +3.290978909330144e-02   +2.649501055580409e-01   +6.692846194211254e-02   +7.709866460378657e-01   +7.655022524798858e-01   +1.193574648540715e-01   +2.645907105076448e-01   +6.572935948854038e-02   +4.846897982322284e-01   +3.941305531205527e-01   +7.549680935615625e-01   +1.551807495895470e-01   +5.422103160205659e-02   +2.282263803218884e-01   +5.833419093125857e-01; +8.178395262176674e-01   +6.822752549996421e-02   +1.536910997197250e-01   +2.525831123802440e-01   +3.239096708370777e-01   +1.898116996042557e-01   +6.077297135699605e-01   +3.159820009804991e-01   +4.045635849337832e-01   +3.926520098300586e-01   +6.840008908101134e-01   +3.778792096591783e-01   +2.001649247357215e-01   +8.511710120639522e-01   +4.969479207021502e-01   +9.267205353943390e-01; +2.598857775733504e-01   +3.193000983458741e-01   +2.818056851249544e-01   +2.215014984431739e-01   +7.835888015291236e-01   +2.857766510145852e-01   +4.523893126712688e-01   +1.187787819851698e-01   +4.473103809711981e-01   +6.716409884854482e-01   +7.040805595483345e-01   +2.170112556903095e-01   +4.077508104753916e-01   +5.610190832242239e-01   +8.992291084170585e-01   +5.811017144635955e-01; +5.940397305220529e-01   +5.297621516588988e-01   +4.416642037318325e-01   +6.688408275872378e-01   +4.701006020464292e-01   +9.083977402696503e-02   +4.589140614092853e-01   +9.401262368024585e-01   +3.657065338316489e-01   +7.417786868686321e-01   +4.424889836349166e-01   +7.905279588356607e-01   +7.477817750549419e-01   +9.297832895287718e-01   +5.758893783870956e-01   +1.670855969528708e-02; +2.245015754518530e-02   +6.542566287065150e-01   +5.260659970320025e-01   +8.447336891936308e-01   +3.646652386605672e-02   +5.777491378460280e-01   +6.619481606883165e-01   +6.457743341589971e-01   +7.622540421962221e-01   +5.189575072779882e-01   +1.865694173687589e-02   +9.498095144682972e-01   +8.235871936242700e-01   +6.979952320153163e-01   +8.439740816385956e-01   +1.212435620933651e-01; +4.259489427487703e-01   +4.070514019969755e-01   +4.586850491797249e-01   +3.450234850617426e-01   +1.762241885502835e-01   +6.834127571077644e-01   +7.697307583215468e-01   +4.804707825727159e-01   +6.264677173596342e-01   +3.449263565659201e-01   +3.291687923862430e-01   +3.286783793819904e-01   +7.913542588274018e-01   +5.841401474199910e-01   +7.384224442130839e-01   +8.621373661390983e-01; +3.118383575803713e-01   +8.197995917115963e-01   +8.751962570294537e-01   +7.818795271809499e-01   +7.199715166842005e-01   +5.466117565670834e-01   +3.499828153323822e-01   +6.394587993559461e-01   +7.723569700520108e-01   +1.495510285512335e-01   +4.237161644874479e-01   +6.733415670279531e-01   +3.198645373150263e-01   +8.148153476929346e-01   +5.865168694752092e-01   +4.826992016157969e-01; +1.607607496895311e-01   +7.200781889756522e-01   +5.190494753120323e-01   +6.770845152820315e-01   +4.740125652054786e-01   +4.244494098171695e-01   +6.615605112402858e-01   +5.445759355117774e-01   +9.325343538290511e-01   +5.869941548027462e-01   +2.686999319295647e-01   +4.399302578181321e-01   +5.338543646787869e-01   +8.805811659749058e-01   +2.445935424414208e-01   +8.449858003848053e-01; +1.773898245073028e-01   +9.681090846183752e-01   +9.450961140466698e-01   +6.855301422253829e-03   +1.529603497855965e-01   +6.438103212685364e-01   +4.157268195431708e-01   +6.471420881189158e-01   +9.734978022795285e-01   +2.610085939302714e-01   +1.967259833421202e-01   +8.330367372620566e-01   +9.018978293212015e-02   +9.896314537640508e-01   +6.653592562884987e-01   +2.092593373668707e-01];
L1E_L1I_iGABA_netcon = [+5.507546034757405e-01   +6.945465547167654e-01   +1.052332198724746e-01   +1.767211852868738e-01   +5.403167031131387e-02   +1.786960677777926e-01   +5.961106843868351e-01   +9.970241165829248e-01   +3.392278793390703e-01   +7.786034259827395e-01   +6.838197126583009e-01   +3.655381223096421e-01   +7.828966033657233e-01   +4.318327858664719e-01   +5.940821617658943e-02   +9.655148747532349e-02; +6.312082637876508e-01   +4.985716905343748e-01   +1.427286636822201e-01   +3.988936172744088e-01   +1.777442681796787e-01   +3.611037780927577e-01   +3.001222414836862e-01   +3.311861101287050e-01   +2.942884631984558e-01   +3.377570658741087e-01   +1.322119795570755e-01   +3.695739665921989e-01   +1.013591225601622e-01   +6.554423139431486e-01   +3.138972484141122e-01   +1.415061884553039e-01; +3.204685911035644e-02   +5.355420386963562e-01   +1.681007972749951e-01   +1.337682226044825e-01   +6.607723924728016e-01   +5.632237863528693e-02   +1.344172046474520e-01   +2.968741621045987e-01   +7.461164135496107e-01   +6.079776028891666e-01   +7.233921160784806e-01   +6.849883809780910e-01   +2.929732704291315e-01   +1.114089428351106e-01   +7.719201704143059e-01   +1.680977318861229e-01; +6.144223662746708e-01   +4.436908513386168e-01   +6.227480550738087e-01   +2.900435791830444e-02   +3.325918905025936e-01   +5.225685852012338e-01   +2.109061110538543e-01   +6.232027408464659e-02   +1.061699868408200e-02   +7.414961621533751e-01   +1.095190037918600e-01   +5.978813137226093e-01   +2.358945976647124e-01   +9.316830541639626e-01   +6.958496063013898e-01   +1.960081275244910e-01; +3.633265045000393e-01   +1.241116788835472e-01   +5.739737207630788e-01   +9.381538800051292e-01   +8.983447159511651e-01   +3.345365579857938e-01   +8.964116796298437e-01   +2.982038952896562e-01   +4.734557154864178e-02   +1.054466286462932e-01   +1.170024886573807e-01   +7.892164214784628e-01   +5.300681303054546e-01   +1.853561416902450e-01   +1.253043487521474e-01   +3.178824632131395e-01; +4.973349910359524e-02   +4.915780378914287e-01   +5.380977432478913e-02   +3.027027155912845e-01   +1.168532840950559e-01   +1.734940872963861e-01   +7.131519525327942e-02   +4.456028868398575e-02   +6.676568026314208e-01   +1.269885443568916e-01   +6.405142916084484e-01   +3.682056590592927e-01   +9.285158655252410e-02   +2.659945465724143e-01   +1.276273557523690e-01   +3.176759084219052e-01; +4.872992396003186e-01   +8.534235362152788e-01   +9.321896038522368e-01   +2.956688889649816e-01   +9.887384144481068e-01   +2.109800717915284e-01   +2.427832841182408e-01   +5.056290831195186e-01   +6.045210638357470e-01   +5.488065846764216e-01   +3.291046751406359e-01   +2.055700150265445e-01   +4.051375740649201e-01   +7.982127804488006e-01   +9.142936975980914e-02   +2.169129344413835e-01; +1.917549658423389e-01   +8.744286174324298e-01   +7.286610192440561e-01   +3.353472158890236e-01   +5.413867458741425e-01   +9.053629481926877e-01   +5.433933941424140e-02   +7.609192480400498e-01   +5.266827101773911e-01   +4.850991568556356e-01   +6.538493648735284e-01   +8.723546822141567e-02   +1.045275255436733e-01   +4.879585599386769e-01   +8.556577767486511e-03   +2.517855804138120e-01; +1.219619876418970e-01   +2.709393790467545e-01   +7.376952603064133e-01   +4.688789284387547e-01   +7.058418092725510e-01   +6.752137970857000e-01   +4.414261882058935e-01   +6.312727907810743e-01   +7.300155259604139e-01   +8.895262503361601e-01   +7.503465257206711e-01   +7.717295430088469e-01   +1.102072532807458e-01   +7.690133538875051e-01   +4.243580124603683e-01   +8.933706377661250e-01; +2.066362200124801e-01   +2.101992181095076e-01   +6.310667120852698e-02   +6.477693191081711e-01   +9.995633746286314e-01   +4.682197885214053e-01   +1.460339249377436e-02   +9.124874961112436e-02   +7.078665637371797e-01   +7.999191791394082e-01   +5.847186617463269e-01   +2.073280280518640e-01   +7.858728007220497e-01   +3.975221546525010e-01   +6.556960475147200e-01   +7.026672871434360e-01; +1.463570476917819e-01   +5.637458409253470e-01   +8.598178795730715e-01   +2.438409127201729e-02   +2.878149628533200e-01   +9.119691229424799e-01   +8.970379044849930e-01   +8.076325130921563e-02   +7.804212320517938e-01   +7.350763666136492e-01   +7.408315394893662e-01   +3.894904962640108e-01   +2.911266613180027e-01   +2.726168273004572e-01   +7.226220745242715e-01   +5.554990802204405e-01; +1.890530532067688e-01   +6.387288341617527e-01   +9.327515865070869e-01   +8.429338439045866e-01   +4.133404064515986e-01   +1.043434395178379e-01   +1.951624243657092e-01   +7.751322897142416e-01   +2.882307950086231e-01   +5.313485324344433e-02   +2.343720225579694e-01   +5.511181805812541e-01   +6.039693745836071e-01   +3.732236267429919e-02   +5.303835832103122e-01   +1.843661842808652e-01; +4.310033643777817e-02   +4.158316601109512e-01   +9.836534342562899e-01   +5.583796914239333e-01   +4.661631031183580e-01   +7.446540603162858e-01   +9.287771988005991e-02   +9.051723345068367e-01   +6.908988338510514e-01   +7.301145700816050e-02   +7.343278336529410e-01   +2.290502275898864e-01   +9.643365680842674e-01   +6.731609999702550e-01   +1.083180396422514e-01   +2.124850569849180e-01; +6.356354922889352e-01   +2.063064642740317e-01   +8.578231845605029e-01   +8.535062424829888e-01   +7.644125245433199e-01   +7.375121785430009e-01   +3.073154431654405e-01   +5.335456476544276e-01   +5.554775703071152e-01   +8.692369019730888e-02   +9.710840145577773e-01   +6.417133766874249e-01   +4.315279706380225e-01   +4.310064354404158e-01   +6.324886856108064e-01   +7.694629646526306e-02; +2.816833355452460e-01   +9.485447872740932e-01   +7.857422252471049e-01   +3.492489795404019e-01   +8.177295824607312e-01   +5.621708169126356e-01   +4.556657464497327e-01   +1.076418580949114e-01   +3.951807587157416e-01   +7.962580574048838e-01   +8.677640998201918e-01   +4.828580294424967e-01   +6.948237547368428e-01   +4.507884053495069e-01   +1.291251865114064e-01   +9.140128682005653e-01; +5.383092174652927e-01   +8.050532391350430e-02   +5.144659839180979e-01   +4.464637564097486e-01   +9.908035854824207e-02   +1.851204981948890e-01   +1.019773911135072e-01   +8.269007972498251e-01   +6.150574370339230e-02   +9.415704934854892e-01   +8.746020812289003e-02   +1.514098584144923e-01   +7.581566099781953e-01   +6.093813358982447e-01   +1.339229724195541e-01   +7.070129421032988e-01];
L2I_L1I_iGABA_netcon = [+5.582080270709150e-01   +1.594746006875681e-01   +4.227375890658884e-01   +6.836767262093575e-01   +8.085229629878651e-01   +7.954357931816236e-01   +7.886555299839815e-01   +2.692098255182543e-02; +3.132436974746711e-01   +7.585418815537587e-01   +4.296532212664948e-01   +4.638888911154549e-01   +7.467992148057537e-01   +5.775391700755141e-01   +8.517881566614565e-01   +4.204554880655585e-01; +1.666097695505550e-01   +8.701658826571618e-01   +1.251502457815360e-01   +2.128994892324775e-01   +1.183497160398816e-01   +4.412775665557104e-01   +5.068254640985548e-01   +1.829146447070814e-01; +6.219966976975358e-01   +3.508852549508478e-01   +2.393499341391036e-02   +9.811728544632314e-02   +5.259921584456684e-01   +2.574791238228250e-01   +6.355137781196837e-01   +7.266024390162995e-01; +9.875019889015780e-01   +6.862545370903547e-01   +2.903470355076793e-01   +8.234752572472662e-01   +3.248842103292741e-01   +7.525304681259513e-01   +9.520912202568866e-01   +3.703145265592904e-01; +1.716831387021254e-01   +2.936796830869624e-01   +3.185189305010261e-01   +1.753303287460222e-01   +5.457530479002399e-01   +2.292838357728893e-01   +4.446274331430556e-01   +8.414501265388380e-01; +2.577729237635912e-01   +5.298910621921989e-01   +6.538913067160177e-01   +1.642972230081643e-01   +3.998539878897129e-01   +6.515243818015756e-02   +5.875222419697346e-02   +7.334828458654175e-01; +3.973494699886529e-01   +8.330586620724051e-01   +9.573521517200444e-01   +6.676422713772826e-01   +4.159808417237522e-01   +7.662225333498489e-01   +8.679174691029585e-01   +5.695619591133009e-01; +7.477145373044018e-02   +5.990877819449831e-01   +9.366781099483358e-01   +8.934611679868061e-01   +1.789285494807306e-01   +6.710374634616236e-01   +6.313338303161141e-01   +1.783946406963968e-01; +6.845162279516037e-01   +3.348087580504167e-01   +4.581263618191055e-01   +5.158736369336605e-01   +2.558671886488094e-01   +7.145466204803482e-01   +3.534229613884807e-01   +9.590856345454810e-01; +4.035487937962914e-01   +2.993114452871986e-01   +2.395039197624810e-01   +7.031197704134272e-01   +1.960877949574845e-02   +6.424547347047812e-01   +9.967110871187469e-01   +2.651297083774373e-01; +9.825451444270210e-01   +4.530480770447827e-01   +7.648503340975765e-01   +1.517985413163057e-01   +9.226370415606708e-01   +4.192559058222124e-01   +2.246399472816709e-01   +9.245779454922187e-01; +4.004038026922083e-01   +4.238212444059583e-01   +7.592197364705962e-01   +9.526396265221638e-01   +6.548515822319090e-01   +3.895284893312474e-01   +6.528065364363724e-01   +2.213770634223590e-01; +6.212267810428924e-01   +3.599055466418071e-01   +7.401039184485281e-01   +5.401572358992177e-01   +9.336856263657707e-01   +8.173065725737682e-01   +6.046943994068530e-01   +3.728198698280442e-01; +1.547655932382010e-01   +5.603753449521394e-01   +7.445823772326893e-01   +6.809357332130777e-01   +1.635558279942361e-01   +3.164787346563867e-01   +3.883619698965864e-01   +8.843959007775695e-02; +3.815336636551750e-01   +7.429415473792755e-01   +1.087191220478336e-01   +3.734259937335615e-02   +9.215763287037327e-01   +8.162693895195955e-01   +1.399320642732054e-01   +6.418645785629313e-01];
L1I_L2I_iGABA_netcon = [+1.808726411906590e-01   +9.115930013261433e-01   +2.761230823132672e-01   +8.727568318556186e-02   +5.332080646486387e-01   +1.065369450892902e-01   +9.879980129224121e-01   +4.121744632991111e-01   +7.192209738230501e-01   +2.176740891200603e-01   +9.217730726435612e-01   +6.735800881273211e-01   +1.071682962285124e-01   +5.565129316121216e-01   +6.309726917604741e-01   +4.837149931816961e-01; +4.584399079026139e-02   +7.995518453983974e-01   +2.472904445923812e-01   +8.032849885209895e-01   +8.873515874534544e-01   +6.151906801597594e-01   +7.668611116240608e-01   +6.004252605820292e-01   +9.965930336217125e-01   +1.262449584957132e-01   +7.704649132040745e-01   +4.770916914187416e-01   +1.811957849971635e-01   +7.714369247733319e-01   +9.997489248535409e-02   +8.947200964609167e-01; +7.234985902780726e-01   +7.443412347403199e-01   +4.515770131524239e-01   +9.894632152841510e-01   +8.982196360085943e-01   +9.405480992047286e-01   +3.363628985587291e-01   +7.496680475655241e-01   +3.543261591791103e-01   +3.093457133580720e-01   +4.218323297356268e-02   +6.239045100387489e-01   +9.976180226387041e-02   +3.124147389653817e-01   +3.919828963157352e-01   +1.387614523240569e-01; +3.484965392536232e-01   +8.128504809218705e-01   +2.264836344533401e-01   +6.645158225444489e-02   +6.251253836891962e-01   +3.534872305134811e-01   +6.633347379313839e-01   +5.837489766507549e-01   +9.703597043214698e-01   +7.248354200206224e-01   +3.794575155080525e-01   +2.379125088320814e-01   +4.903489919122269e-01   +1.778987475513591e-01   +5.581995161132802e-02   +3.887810182112472e-01; +6.602876759843548e-01   +3.840997283923264e-01   +8.042107494464534e-01   +9.399768981278659e-01   +1.376089390629575e-01   +4.110942951171038e-01   +2.460764204328718e-01   +5.512024256228395e-01   +3.479128325901466e-01   +7.831812305355962e-01   +7.038533965934208e-01   +1.775038185850466e-01   +1.927871132630628e-01   +3.382768960854907e-01   +5.004880420178676e-01   +9.275477420904870e-01; +3.851187047606063e-01   +6.176515970312084e-01   +9.856318787663020e-01   +1.789650119048922e-02   +2.184981436280809e-01   +9.830764450047663e-01   +2.944293447107306e-01   +5.808370269606145e-01   +8.861802499947895e-01   +6.921686907578799e-01   +7.276818760937381e-01   +8.290151251651433e-01   +8.938092332431791e-01   +2.101109081457023e-01   +4.314038734795876e-01   +9.188001002943401e-01; +6.280967180600980e-01   +5.771806716096429e-01   +2.999585478551299e-02   +6.852244719132183e-01   +1.819641842557555e-01   +9.455513651510374e-01   +6.781766196130966e-01   +5.112164505629966e-01   +4.551325624442202e-01   +9.510220413433456e-03   +2.250675983787110e-01   +7.662984624838179e-01   +9.886690926162979e-02   +5.104994351255688e-01   +9.979198317881817e-01   +7.158249744087608e-01; +2.282330574557445e-02   +5.278731579109480e-01   +5.356720198461564e-01   +7.829839792607962e-01   +4.203495824773502e-02   +6.768107158302050e-01   +5.269069172170086e-01   +8.081741939748147e-02   +4.147849832377888e-01   +8.453200533679560e-01   +2.688409970689610e-01   +9.346032803914835e-01   +4.537386187930294e-02   +9.049030379089722e-01   +8.105491778504721e-01   +6.179710677326973e-01];
L2E_L1E_iAMPA_netcon = [+3.421276199995509e-01   +7.585215778964715e-01   +5.900606265324221e-01   +5.014122506244013e-01   +8.505326223697923e-02   +4.755315904168761e-02   +9.238382674183776e-01   +4.754978811876560e-01; +9.364703348091619e-01   +4.146733200581386e-01   +6.611384655259297e-01   +4.886485627578135e-01   +9.740132133186827e-01   +3.435993471198732e-01   +8.006659398073074e-01   +3.634108752422730e-01; +1.234246249395709e-01   +4.940047225613530e-01   +4.781332974361317e-02   +8.778884541057995e-01   +6.511275041902339e-01   +7.381554808471178e-01   +2.860585769071231e-01   +7.879517017494307e-01; +7.319934456832862e-01   +6.960827826587871e-01   +3.489091703453306e-01   +3.512646493006261e-01   +2.307562298973511e-01   +7.950267252082034e-01   +5.443696226933971e-01   +7.802255102621323e-01; +6.470466045426400e-01   +9.742524533516621e-01   +4.491881805499835e-01   +4.484073713717390e-01   +4.026734217258540e-01   +5.445868165805717e-01   +9.845460230708745e-01   +6.686517340425723e-01; +8.334846857668384e-01   +3.274884310489654e-01   +2.390796602448554e-01   +9.643426584100040e-01   +1.212181165434182e-01   +6.873698273234865e-01   +7.151488115193441e-01   +1.337145393003560e-01; +3.969381216989982e-01   +8.369302857314985e-01   +7.148087478068339e-01   +4.279210818122501e-02   +2.680706556346802e-01   +8.953761666293447e-01   +8.381622451446379e-01   +2.022184823038477e-02; +7.498547603419331e-01   +7.399296213310603e-01   +8.576012052420129e-01   +9.741514795591046e-01   +2.555326366784900e-01   +5.429528163941008e-02   +4.336518199301367e-01   +5.598753049524529e-01; +8.352628484476561e-01   +9.536721359504150e-01   +2.829253890338788e-01   +1.878053921966740e-01   +3.326600051199526e-01   +3.037032247075012e-01   +4.713416465885191e-01   +3.011172096301195e-01; +3.241108743576221e-01   +3.292167251706664e-02   +7.316909818549188e-01   +6.652820191157188e-01   +1.495245659128185e-01   +4.557412230371494e-02   +5.611643757125502e-01   +9.394109167259957e-01; +5.516942282439553e-01   +3.552169368825711e-01   +1.398709936881349e-01   +5.876125456634473e-01   +3.465908695128985e-01   +1.954386665539383e-01   +2.697298310632940e-01   +9.816872400291277e-01; +9.815274401837512e-01   +6.621144165837952e-01   +8.390005122301508e-01   +6.756693606007464e-01   +1.204012451112734e-01   +7.187189385744979e-01   +7.484433808250190e-01   +2.859233001572763e-01; +5.490806801271261e-01   +2.818155684868837e-01   +1.390562636927234e-01   +3.594113849939485e-01   +8.833831948796559e-01   +7.223205081007846e-01   +5.047336123379152e-01   +8.000555991944406e-01; +3.311849219039130e-01   +2.312541230460387e-01   +5.870355035980853e-01   +6.196793530990446e-01   +9.504536545083064e-02   +8.771767566100366e-01   +6.468464519058992e-01   +8.949383547556556e-01; +6.194006128057676e-01   +7.101820879541347e-01   +3.666368050590784e-01   +8.112474598104130e-01   +9.314817880721286e-01   +5.808666640425570e-01   +3.072930209170800e-01   +5.983984236246874e-01; +3.617188249539355e-01   +6.234774016607482e-01   +8.057171689614918e-01   +1.985059712983091e-02   +3.999118383662764e-01   +7.205146946049255e-02   +1.387778224726226e-01   +8.840554764629607e-01];
L1E_L2E_iAMPA_netcon = [+9.430710939740791e-01   +3.730688897034390e-01   +6.685473001459984e-01   +4.854942902457245e-01   +2.473147586086798e-01   +4.521129959232857e-01   +1.236020119683785e-01   +4.967599854268147e-01   +8.826449229720909e-01   +3.251194633944938e-01   +5.148041938576930e-01   +8.623225959196126e-02   +6.319117927095546e-01   +4.287228293935865e-01   +6.129000544898909e-01   +5.035394001175967e-01; +5.483798182136137e-01   +9.358329445380965e-01   +2.079144097579062e-01   +7.572013857103508e-01   +7.846549657012434e-01   +2.060728274121288e-01   +4.066521251570814e-01   +6.931534480956079e-01   +7.202043066433679e-01   +2.464354341259128e-01   +6.574990234545793e-01   +1.631572657441591e-01   +8.586146991848225e-01   +4.918465355494058e-01   +8.205975533855753e-01   +6.119391164633728e-01; +7.283053110548199e-01   +8.284815192229251e-01   +6.535846168189640e-01   +4.164239679659275e-01   +8.824027994740083e-01   +8.987584785197610e-01   +2.752312016608103e-01   +8.339359821382336e-01   +1.854159154494050e-02   +3.426048301318260e-01   +9.511415062897867e-01   +3.245465985267942e-01   +9.758155521133512e-01   +7.140516386048600e-02   +8.866908715710021e-01   +8.194915178893523e-01; +5.771544988678250e-01   +8.508341158493141e-01   +7.187117365821244e-02   +9.719573030777184e-01   +9.127593338513003e-01   +7.629232886199767e-01   +7.171343747588139e-01   +6.119802103873760e-01   +6.745282345987584e-01   +3.756429169415425e-01   +7.228493840684549e-01   +3.009586512602216e-01   +5.697799010392828e-01   +8.876634883187502e-01   +9.303841651824939e-01   +5.330448885075854e-01; +2.567004649957581e-02   +3.720112117854404e-01   +4.066843159133405e-01   +9.899141465976103e-01   +5.587715179006807e-01   +8.837433246064755e-01   +2.821781226386671e-01   +5.750077299676459e-01   +4.389966810824670e-01   +5.457947582554546e-01   +3.996304152553443e-01   +1.126788798440021e-02   +9.966948649301426e-01   +6.494360912033784e-02   +1.921432551763705e-01   +2.025037480082842e-01; +4.474816241166862e-01   +5.931390855471236e-01   +6.663762997768641e-01   +8.640473620201040e-01   +5.984470785208191e-01   +2.865988994252677e-01   +8.954344440663634e-01   +3.244889065545280e-01   +4.360974504304753e-01   +5.630896973922163e-01   +8.343173447909231e-01   +5.411268953396756e-01   +5.539343524871250e-01   +4.359253491739787e-01   +2.577503484564798e-01   +4.540408150071399e-01; +6.478276461961409e-01   +8.745032614260960e-01   +9.363161320527064e-01   +3.878602806697889e-01   +1.483652514766709e-01   +6.705471429727958e-01   +8.265378281791748e-01   +4.560394931997040e-01   +1.157289100729573e-01   +3.952936617346882e-01   +1.352661537216301e-01   +9.643907647610105e-02   +5.154428788269083e-01   +8.248781299994180e-01   +8.973244147614217e-01   +4.289433612729537e-01; +5.221727481308004e-01   +9.334810386631136e-01   +8.096088231200768e-01   +4.528910061281184e-01   +9.018297982708731e-01   +6.638600046386913e-01   +3.899620395127441e-01   +7.140446619579375e-01   +8.146967661849284e-01   +3.968016806531051e-01   +6.038544375254902e-02   +1.464827053716020e-01   +3.314359766639777e-01   +3.922537939267920e-01   +5.936837095250733e-01   +9.655500127635799e-01];
L2I_L2E_iAMPA_netcon = [+6.188179909093310e-01   +6.961150256435922e-01   +7.342592464350343e-01   +5.902104623496027e-01   +6.694747212285640e-01   +5.524769588056566e-02   +9.910686329479372e-02   +8.479421497201787e-01; +6.973819121514550e-01   +4.264217128925918e-01   +4.300053253182984e-01   +4.590930566886319e-01   +5.001560457263967e-01   +1.534945658060076e-01   +9.080128653169544e-01   +9.176601474029092e-01; +7.211715462722248e-01   +8.366694051572366e-01   +6.932096552271509e-01   +5.189400295958947e-02   +2.201525696213011e-01   +1.996623580484959e-02   +1.105782985454077e-01   +9.863255145985812e-01; +3.471486174122065e-01   +7.303034744058048e-01   +9.451158242214628e-01   +2.284309869512371e-01   +5.718833341021606e-01   +4.352911288235509e-01   +5.181479453819415e-01   +5.041189275243256e-01; +5.170009353639788e-01   +3.600690612658048e-01   +7.845594814782207e-01   +8.337954916587302e-01   +1.222200011957790e-01   +8.314890421734235e-01   +1.425039637043485e-01   +2.713761713437870e-01; +5.570945134629595e-01   +4.542212087933964e-01   +7.051822378488775e-01   +1.565672025027821e-02   +6.707730109120165e-01   +6.176359263188963e-01   +5.596717576861611e-01   +1.018286870727531e-01; +1.582510202677343e-01   +3.881847930903950e-01   +1.098079344462579e-01   +8.642578819015461e-01   +5.994400551934077e-01   +5.198194891015335e-01   +4.385293843252041e-03   +5.079097816657846e-01; +5.634601192743943e-01   +7.748438160923263e-01   +3.899490309648619e-01   +7.902624508561226e-02   +5.602338682607078e-02   +8.637366801774990e-01   +7.682292349015659e-01   +5.846838513934736e-01];
L2E_L2I_iGABA_netcon = [+7.642939674418365e-01   +9.411855138536447e-01   +2.386227370587684e-01   +8.337482653414808e-01   +2.572669717948278e-01   +7.574088136770178e-02   +1.738213573566305e-01   +5.235817817268090e-01; +8.256136608550965e-02   +6.565568048979969e-01   +5.785818222547288e-01   +4.018816247661013e-01   +2.987483319118029e-01   +3.941855098215213e-01   +1.403703992303726e-01   +2.638919192231350e-01; +6.598587324366662e-01   +4.523644436357112e-01   +8.660587782288314e-01   +3.910616272560483e-01   +4.249637077533489e-01   +4.234254642328788e-03   +5.977284516490269e-01   +6.849036125228296e-02; +5.174869918114184e-01   +8.399072663515218e-01   +4.049897905560467e-01   +3.625832017327476e-01   +1.176174403777746e-01   +2.198351006736480e-01   +8.993818032976839e-01   +4.359823180527927e-01; +1.719085397323280e-01   +5.332140523163723e-01   +1.115915519864811e-01   +1.375260863768465e-01   +4.974902787662195e-01   +1.296782120102616e-03   +9.386203009610427e-01   +1.732730258104331e-01; +9.405494130297013e-01   +5.536200992703068e-01   +4.436591509717888e-01   +2.575787303243396e-01   +7.070807835191989e-01   +1.898509470722983e-01   +2.204464567085795e-01   +2.672891320788110e-02; +5.911211370055781e-01   +6.806518188589692e-01   +2.979993895426555e-01   +8.591626517508538e-02   +2.442803255549859e-01   +1.421625969199714e-01   +4.806961989009883e-01   +9.536390320037187e-01; +4.402755690417800e-01   +3.677533967441084e-01   +4.014756666982697e-01   +4.297659821959062e-01   +7.849260133023007e-01   +2.682749571610268e-01   +3.776889973110922e-01   +4.308503073597914e-01];
L3E_L2E_iAMPA_netcon = [+9.620028561321414e-01   +7.727776124095231e-01   +9.116827776964636e-01   +5.312570384405408e-01   +4.850048650748639e-02   +8.194532951466994e-01   +6.251114912481236e-01   +7.479434382486849e-01   +6.734301137601686e-01   +9.052548635188471e-01   +5.816809620360802e-01   +5.910857424458227e-02; +7.624354368390590e-01   +2.272842359376750e-01   +9.074985567476354e-01   +7.161129974841429e-01   +5.522635121927396e-01   +7.275371049393911e-01   +5.424934144898692e-01   +6.457279304040668e-01   +4.315090037128777e-01   +3.934178117045876e-01   +6.862572789885438e-01   +9.805290197249988e-01; +8.056777571768066e-03   +3.700094264017154e-01   +5.914192006848806e-01   +1.802309237090843e-01   +2.745732374260481e-01   +1.773184917224607e-01   +4.373978963709033e-01   +1.218072726985845e-01   +6.923654129243799e-01   +2.460221781290590e-02   +7.210272308130015e-01   +2.841706245599834e-01; +6.799647453273786e-01   +8.924688870453480e-01   +3.312926199059899e-01   +3.352603258072810e-01   +2.434465022658896e-01   +3.600058157934548e-01   +2.869214674917097e-01   +5.056101329490884e-01   +2.570509357836541e-01   +6.702774202883011e-01   +6.491733748530083e-01   +5.929294600226658e-01; +7.051629580956991e-01   +8.567702250866355e-01   +8.536358819084373e-01   +1.873133705595074e-01   +2.431813479300070e-01   +1.862889342157070e-01   +5.005773402348536e-01   +3.479878415386971e-01   +1.238897038166006e-02   +8.376459493853425e-01   +7.250609455192700e-01   +9.608760027572729e-01; +6.450491878887347e-01   +4.004405405637729e-01   +4.431352783844267e-01   +3.209914007806736e-01   +1.542216849213445e-01   +6.543367303123378e-04   +7.622973182519481e-01   +9.069430355742923e-02   +5.314767334293560e-01   +9.714310796010478e-01   +3.746755177509863e-01   +1.866721683190936e-01; +5.539485726190091e-01   +3.183785033301194e-01   +9.016466175827841e-01   +4.046950893147647e-01   +9.576305551693686e-01   +3.140985207418068e-01   +7.617336611207841e-01   +1.479366138901499e-01   +2.799130863731298e-01   +5.648773967685232e-02   +5.797294943538949e-01   +1.929029284883527e-01; +2.178976862935335e-01   +6.089455387478618e-01   +3.441820601204131e-02   +5.482985008221931e-01   +9.357788727379001e-01   +6.986747660902970e-01   +5.772473472018121e-01   +1.997081033132014e-01   +9.461424279978693e-01   +4.506002670024595e-01   +1.144393850340320e-01   +3.406095266607108e-01];
L3I_L2I_iGABA_netcon = [+9.335109184742347e-01   +9.274542760889939e-02   +6.266915056387341e-02   +2.790114469168424e-01   +2.539696941663720e-01   +4.042088309180435e-01   +5.292380949037364e-01   +1.083827044683581e-01   +9.121103205927653e-01   +5.837907471192062e-01   +2.085095462834207e-01   +9.078411139602839e-01; +3.911735520584237e-01   +6.167593814396873e-01   +4.950689345448597e-01   +7.458112522235805e-01   +8.575160429065404e-01   +9.873199836849479e-01   +8.294246293076567e-01   +2.708306321369285e-01   +6.393479968569930e-01   +2.834425831689847e-01   +3.176060713739069e-01   +5.515928092759891e-01; +2.718132828135956e-01   +1.108731981722976e-02   +6.432228974574310e-01   +2.381038626356850e-01   +9.115004876298869e-01   +8.985929561058258e-02   +8.576595005416986e-01   +5.234123734322563e-01   +2.552371560413607e-01   +8.281854958534810e-01   +1.335093722191124e-01   +3.457541737781433e-02; +1.521544226331415e-01   +5.736160484044132e-01   +2.227680120433456e-01   +9.579438273771559e-01   +6.992929506923682e-01   +3.230105287084982e-01   +7.882429179363903e-01   +9.728659013150180e-01   +9.053458529430250e-02   +1.923644916792799e-01   +6.733253523198635e-01   +5.386786743715965e-02; +3.972303746811092e-01   +7.875468838178682e-01   +8.381674322573424e-01   +6.214428558740951e-01   +7.253249474638760e-01   +5.133206840575283e-01   +3.188504905183723e-01   +7.086402156399894e-01   +8.384915755755037e-01   +4.415763461041692e-01   +5.698647506685015e-01   +8.063160244126778e-01; +3.750957422172383e-01   +2.351149777930858e-01   +9.710529823932886e-01   +6.010945719268886e-01   +2.303044492537258e-01   +5.892165525611340e-02   +4.527641045080002e-01   +3.110423110672342e-01   +5.843171408854023e-01   +3.930473599181605e-01   +1.703332541860680e-01   +4.512290534578347e-01; +1.299520694524610e-01   +4.479324395459818e-01   +8.463857377018149e-01   +1.724400506755305e-01   +5.750811375944931e-01   +7.261610965091682e-01   +7.533949802697743e-01   +2.942059961176123e-01   +9.485105422657180e-01   +8.269658670804521e-01   +1.480551428965380e-01   +3.808982712967729e-01; +4.338852803603566e-01   +5.695638698784506e-01   +5.068936799456945e-01   +9.015619112506700e-02   +8.112670586326861e-01   +5.571208556193180e-01   +1.107454474291153e-01   +8.498717563065293e-01   +6.138681683454669e-02   +6.793925365253621e-01   +4.767577860159323e-01   +7.910461763693118e-01];
L2E_L3E_iAMPA_netcon = [+3.648155206284221e-01   +7.554546062288922e-01   +7.350393589450196e-02   +5.171794225541215e-01   +7.583732368879257e-01   +4.323371916791259e-01   +1.999263494925171e-01   +8.758394363157399e-01; +5.314163251957129e-01   +9.968013887472473e-01   +5.916040354258248e-01   +9.940768455468544e-01   +9.951211152071042e-01   +5.429008666852372e-01   +1.936415572443393e-01   +7.865473191682608e-01; +7.132620760139734e-01   +1.874683151370979e-01   +9.105504855755392e-01   +8.568888954292724e-01   +9.623754707331961e-01   +7.119950008755824e-01   +3.266916521636379e-01   +4.673513872821649e-01; +8.704283103072070e-01   +7.808889118521460e-01   +1.918280339199651e-01   +9.608453225794852e-01   +5.362124115772909e-01   +1.530722397781575e-02   +8.802986423653824e-01   +8.136364845906903e-01; +3.291297760574332e-01   +1.960373051376035e-01   +4.315732710586046e-01   +6.784863935670011e-01   +9.659854236369237e-01   +8.019189204112869e-01   +4.719505423680178e-01   +8.964710272325518e-01; +6.493827803033267e-01   +9.917302404005078e-01   +7.492342168070470e-01   +4.026651265679055e-01   +1.165206559535218e-01   +1.423225194635873e-01   +4.039174563610562e-01   +4.282276683945193e-01; +9.761614290073976e-01   +8.014748149740198e-01   +4.051904831723589e-02   +9.343437812871175e-01   +5.007439427447492e-02   +4.789694390985320e-01   +1.804960621369229e-01   +3.342393842601047e-01; +7.645688289507732e-02   +4.240434870640904e-01   +9.455396102269031e-01   +4.796449076719347e-01   +3.035184466730214e-01   +2.558170039344704e-01   +9.695054761306242e-01   +5.958218020660965e-01; +5.885586397143435e-01   +7.286864577543732e-01   +7.634544759441841e-01   +2.298447177276036e-01   +5.817156449813631e-01   +3.685543300662481e-01   +4.092791378857594e-01   +9.017080039551689e-01; +4.125487607474162e-01   +4.982872428010154e-01   +5.568867947522091e-01   +3.965339653326974e-01   +5.326880476110433e-01   +6.609448032384885e-01   +8.445048509419804e-01   +7.021428660834157e-01; +3.084972725181703e-01   +8.085964775247034e-01   +1.831178634823880e-01   +7.039778071945217e-01   +8.999534167656313e-01   +1.682193965486717e-01   +6.166574124077995e-01   +3.789045588227001e-01; +2.631999204381636e-01   +3.564947405895922e-01   +5.001057819051131e-01   +5.590314780207961e-01   +5.407630008316043e-01   +2.801561426461837e-01   +3.740196796108046e-01   +7.349512935222344e-01];
L2I_L3I_iGABA_netcon = [+9.548997809112961e-01   +3.086814709373033e-02   +9.113671141243919e-02   +4.596035093720555e-01   +3.269713282097289e-01   +3.676339286315217e-01   +6.850257175753673e-01   +8.049437227469250e-01; +5.423334838940655e-01   +2.082910053865458e-01   +5.937528806639343e-01   +6.386115045232853e-01   +8.047213320057837e-01   +2.094432810020326e-01   +9.093083723580224e-01   +6.621403715595510e-02; +5.385721649305004e-01   +4.546819357283961e-01   +2.408602902179970e-01   +9.165758131947985e-01   +9.993480486177814e-01   +4.406433152096601e-01   +6.111545798958806e-01   +9.488278340820276e-01; +3.093260613926840e-01   +1.268865722758728e-01   +8.387266899649506e-01   +1.607464656045822e-01   +9.793585413668191e-01   +9.552025743420015e-01   +8.999898799091882e-01   +4.952268756211399e-01; +7.000618826538231e-02   +9.048557211015504e-03   +8.569812338546410e-01   +7.134277270028548e-01   +1.255490987391939e-01   +1.236224375264897e-01   +1.947130457884430e-01   +7.543419830868898e-01; +1.819165019953554e-01   +7.267786222871815e-01   +9.612628508852290e-01   +5.767838012215792e-01   +2.303101305400530e-01   +4.695220421592174e-01   +7.532992693909782e-01   +7.400371192429520e-01; +9.241142866494045e-02   +3.533317661165949e-01   +4.885258006186751e-01   +4.322331417669990e-01   +2.342044910039218e-02   +8.549451313707254e-01   +3.477631515148238e-01   +8.304300773435573e-01; +4.642319783450785e-01   +7.786944343868448e-01   +2.186134930477872e-01   +8.831157403601497e-01   +6.077659335392620e-01   +4.189308040014625e-02   +4.194391000937395e-01   +1.558248966338980e-01; +9.339627144730085e-03   +4.364979773169613e-01   +2.267850644782798e-01   +3.905093462183887e-01   +1.097166665336341e-01   +6.898626116200735e-01   +1.533939102069780e-01   +4.562795803147957e-01; +9.144295844120144e-01   +4.363718775173572e-01   +5.362437612263369e-01   +1.775516162579392e-01   +4.061693499733283e-01   +9.773794091761392e-01   +8.190775749756145e-01   +6.184855097074056e-01; +6.423483080805483e-01   +5.037804790408935e-02   +7.615087071138390e-01   +6.314497621768441e-01   +8.833495921862431e-01   +2.837062625116872e-01   +6.230000152085723e-01   +9.297269962874480e-01; -1.981099795525386e-04   +4.796338532715765e-02   +3.466350782141573e-01   +6.234724002813881e-01   +5.476997201382044e-01   +1.342835941130090e-01   +7.402118177008497e-01   +8.339380390283189e-01];
L3I_L3E_iAMPA_netcon = [+8.943214535792521e-01   +2.553074362096643e-01   +7.399874218102764e-01   +6.821963363334622e-01   +6.014438725321961e-01   +7.485620982084055e-01   +7.458898002845865e-01   +2.231396694318510e-01   +4.559019610323380e-02   +8.003416658482609e-01   +2.910112782022395e-01   +8.025836569566317e-01; +5.819408995732699e-01   +3.231023805091119e-01   +6.932720822337591e-01   +2.362545132672460e-01   +8.557551861353871e-01   +5.431068809222094e-01   +1.272053688146779e-01   +3.515109424113211e-01   +2.138319734323713e-01   +2.330510630879511e-01   +4.035809939206433e-01   +1.035498584878933e-01; +5.834874256902003e-01   +4.017404093285096e-01   +8.226451534027329e-01   +4.553360687768713e-01   +9.898874709153662e-01   +3.399865505072436e-01   +8.222194839401786e-01   +2.862412195424255e-01   +3.968211351040021e-01   +9.306342532763690e-01   +8.635103023495405e-01   +8.203400449951748e-01; +8.550515303691811e-01   +4.049349907034613e-01   +8.292233216709716e-01   +3.838427437572217e-01   +9.297745554388041e-01   +8.323142282888046e-01   +2.581713735278343e-02   +9.262143542806541e-01   +3.343493671493664e-01   +7.632069603103574e-01   +6.146796612632618e-01   +8.410056237411307e-01; +3.329230854557039e-02   +3.868136278532673e-01   +2.950960732121164e-01   +5.386582243740416e-01   +4.106201505309579e-01   +5.511775801806604e-01   +4.161709607551378e-01   +5.045486474281943e-02   +2.285769329164331e-01   +8.281432263595824e-01   +9.901446740112364e-01   +3.555632936055630e-01; +8.842637000377340e-01   +6.092091125902284e-01   +3.090660936232892e-01   +9.912833256428450e-01   +9.309145449333467e-04   +9.574493066947273e-01   +7.308277952300268e-01   +5.923548199017521e-01   +9.351392507244206e-01   +5.730562210925294e-01   +2.035975369300124e-01   +4.289602857293066e-01; +4.064763201477610e-01   +1.650309180645075e-01   +5.240570522473750e-01   +7.550343161518104e-01   +5.418696086218068e-01   +8.930080159029554e-01   +7.814930849695186e-01   +1.617296510946651e-01   +6.810013017396441e-01   +7.927337258008750e-01   +8.283692595700151e-01   +5.699439103038817e-01; +3.637305290850802e-02   +1.894612010696044e-01   +3.270946386981829e-01   +9.809138913654801e-01   +2.084373771934918e-01   +3.580084094082098e-01   +3.678382749524011e-01   +8.368711564667762e-01   +9.631754691601848e-01   +3.295002448953873e-01   +6.767167957740119e-01   +6.996433996198891e-01; +7.466415608726664e-01   +9.619080930618872e-02   +8.337686568066254e-01   +2.350728461539859e-01   +2.193663613900724e-01   +5.480465975114721e-01   +7.459966084447507e-01   +1.671449544752778e-01   +4.386944346782344e-01   +2.236207785742187e-01   +2.484949186146238e-01   +7.430727178044798e-01; +1.557957312506461e-01   +3.221106003022820e-01   +8.084116926669752e-01   +5.290351298345636e-01   +3.278560170613454e-01   +3.461430028021296e-01   +8.928876104378023e-01   +5.012602322133650e-01   +9.391391913274132e-01   +3.114465398574509e-01   +4.775193888754562e-01   +7.575428648201779e-01; +1.448285347816545e-01   +7.701587208291122e-01   +5.590974300900946e-01   +5.370130123800564e-02   +9.565598072744494e-02   +6.231056371000809e-01   +2.445283695699073e-01   +9.989496900169438e-01   +5.983759866765357e-03   +5.846272160740935e-01   +3.996241925201949e-01   +3.895671094965038e-01; +6.062039667436576e-01   +2.350869383396000e-01   +2.633935718330089e-01   +7.577879327102360e-01   +7.494741648059545e-01   +7.982163437979684e-01   +1.298156191785922e-01   +3.547860062507154e-01   +6.103288090636195e-01   +8.295133179423801e-01   +5.991293338214498e-01   +4.270157803046675e-01];
L3E_L3I_iGABA_netcon = [+9.559811949996230e-01   +8.844958037899752e-01   +8.003287159642354e-01   +9.851678943573359e-01   +9.022711486383219e-01   +9.619815972792366e-01   +6.531849906768998e-01   +4.971183975225488e-02   +1.085495139249343e-01   +4.522807988746415e-01   +8.291961490230509e-01   +5.809170800180733e-01; +5.726052520300288e-01   +4.374547623713897e-01   +9.861705994356966e-01   +5.606894506219304e-01   +9.949382558596892e-01   +5.425086144747852e-01   +6.550527035727884e-02   +4.666239510242390e-01   +4.614906533956516e-01   +3.345835443013941e-01   +6.268333771352758e-01   +6.364720100992429e-01; +8.504102495755295e-01   +7.822317263726859e-01   +1.587940755840177e-01   +9.323944063966744e-01   +6.521860414529191e-01   +3.124541443553223e-02   +2.750398147921668e-01   +3.242024341678474e-01   +4.508819491424605e-01   +5.926613430902681e-02   +5.399614488676099e-01   +6.505878954360621e-01; +2.764523044553171e-01   +1.491810893485956e-01   +2.373241139380034e-01   +7.206083412404060e-01   +1.075230039340857e-01   +6.957873419704060e-01   +2.814411268288896e-01   +6.309278807686340e-01   +5.509721495287241e-01   +7.401789917360259e-01   +6.500124343982501e-01   +8.631197132596157e-01; +6.224865401578336e-01   +6.199541062070004e-01   +7.018930017047389e-01   +4.847484739176665e-01   +3.746709044667645e-02   +5.200087171970550e-01   +8.791104603381945e-01   +2.295907477964142e-01   +8.065164678730343e-01   +5.060347415041900e-01   +7.260861857162278e-01   +5.660570044477523e-02; +5.895812281172592e-01   +2.602355569936955e-01   +3.775426301979488e-01   +6.393683537772785e-01   +6.186107820077544e-01   +6.030315317042360e-02   +4.449228815205457e-01   +5.806013753519111e-01   +7.015415218720435e-01   +2.013681667420992e-01   +9.406558058348052e-02   +8.186631393158331e-01; +9.641916338003482e-01   +4.451603782702898e-01   +9.749863202546549e-01   +8.875327561796692e-01   +5.655844204129468e-01   +8.892088385369198e-01   +7.579820388218040e-01   +6.040585955718937e-01   +8.726678734684570e-01   +4.264753518380291e-01   +8.786464514181114e-01   +5.289389791535285e-01; +8.698392269256135e-02   +8.448575684084594e-01   +9.703245436142769e-01   +1.975148573165469e-01   +9.617914473815385e-01   +3.303297929780633e-01   +6.012901681063828e-01   +5.996306037609246e-01   +5.239493062223233e-02   +1.674669052720055e-01   +1.273973898447932e-02   +6.950491325572279e-01; +5.015620629070847e-01   +1.979260077052016e-01   +6.422609689339349e-01   +3.961854078928516e-01   +7.472995254956369e-01   +2.285149339315295e-01   +7.829229182254269e-01   +4.482564441133087e-01   +2.191618372736900e-01   +7.516769339387682e-01   +2.921666131817611e-01   +2.120886447707210e-01; +5.217266494328144e-01   +3.034869861753351e-01   +8.601431782378213e-01   +9.916786138940856e-01   +6.626753878481545e-01   +1.141429647175855e-01   +1.140448279317974e-01   +3.410266558177373e-02   +4.586567823897097e-01   +3.671299997773714e-01   +1.798010804825728e-01   +5.440432333693522e-01; +9.069080545865024e-02   +4.804834678292931e-01   +4.017418510071940e-01   +4.013483779988044e-01   +5.240434651385405e-01   +3.120405347270163e-01   +9.774909360949593e-01   +5.127804069291103e-01   +9.587800907405605e-01   +9.421168901301938e-01   +9.267238381047950e-01   +7.038777101310081e-01; +9.066401908841133e-01   +3.374115686663491e-01   +6.317637033188288e-01   +6.589178570105897e-01   +2.592774599838656e-01   +2.270089047669967e-01   +8.489085168816423e-01   +4.067356642502102e-01   +7.921796499983164e-01   +1.550796963405967e-02   +6.907901779676193e-02   +9.555846535352465e-01];
L2E_Input1_iAMPA_netcon = [+9.967301008897814e-01   +9.999868507809028e-01   +9.979406672956734e-01   +9.992568924343694e-01   +9.966957709090476e-01   +9.971130527159540e-01   +9.977894906148185e-01   +9.967324913729688e-01];
L2I_Input2_iAMPA_netcon = [+9.987008972207785e-01   +9.984917426915139e-01   +9.987028518341023e-01   +9.992828868774949e-01   +9.983539730723945e-01   +9.974131803115130e-01   +1.000000000000000e+00   +9.982589131673266e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
