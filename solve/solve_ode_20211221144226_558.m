function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.371161135977909e-01   +3.225395478187725e-01   -6.730959409271819e-02   +3.854689593345419e-01   -1.248488645574639e-02   +7.519070279269366e-01   -3.723112763571728e-01   -1.309858531546273e-01   +6.721942005872696e-01   -1.457625188635090e-01   +4.177884449412636e-02   -1.344338939879421e-01   +3.219521601668194e-01   -1.194443923306769e-01   -6.128991215508174e-01   +5.714090679188029e-01; -5.797424776510725e-01   +6.844608937921244e-02   +1.151425646923219e-01   +3.776536937676096e-01   +1.759060654632099e-01   +2.561481310882128e-01   -4.336565408372583e-01   -3.430773641808077e-01   -4.035755075899892e-01   +5.473723769282491e-01   +4.997819052263405e-01   -9.038300248556036e-02   +4.941180527056958e-01   -2.359525006241017e-01   +2.053820935976414e-02   +2.474762258445602e-01; -5.948831067457831e-02   -1.886140925248783e-01   -6.357925359004353e-01   -3.751787257115204e-01   -1.593246909903951e-01   -4.986804028069711e-02   -3.638100270378227e-01   -7.987111440392904e-02   +2.934757829181439e-01   -9.243459705158867e-01   -4.861853217932618e-01   -6.647394805932079e-01   +3.138641724928298e-01   +5.320167935122509e-02   +5.701283436770332e-02   +4.604142736338547e-01; -2.279155084716999e-01   +4.762177705699434e-01   +6.126263700907798e-01   +1.994404945221383e-02   -6.523223331718577e-01   -3.619368570988309e-01   -7.183766022411291e-01   +4.282415155490691e-01   +7.006602230208130e-02   -1.195157188094076e-01   -6.174877113461635e-01   -6.017900212184224e-01   -7.289823717325825e-01   -1.971047000151133e-01   +4.617080501122778e-01   -7.266657495476230e-01; +4.634953199724944e-01   +2.721120895268186e-01   -4.421083774025131e-01   +9.152632923720197e-02   +1.117507724579997e-01   -1.876611387491547e-01   -1.553184969836823e-01   +4.742568275528487e-01   +2.106680597353137e-01   +1.565089142077800e-01   -1.481494186196373e-01   +5.912795522425537e-01   +5.566317524556796e-01   +3.112582196406659e-01   +1.015536204936890e-01   -2.215744396170934e-01; +3.905017488114261e-01   +7.267331436994860e-02   +1.887451310537724e-01   +2.940111650090094e-01   -5.539478683232215e-01   -3.166545271667308e-01   -5.803373049573198e-01   +4.206417174670167e-01   -7.657205761935126e-02   +4.250132835430160e-01   -1.618640146017450e-01   -4.772073332745735e-01   -5.861726603053090e-01   +5.762874997723189e-01   -6.143161268731786e-02   +3.470670061360460e-01; -1.157505724434363e-01   -5.206228562852094e-01   -2.057121413308084e-02   +4.792851241040009e-01   -1.286639935517521e-01   -1.067092311272898e-01   +1.147999827882343e-01   -5.597987291310693e-01   +4.021215321131483e-01   +4.487497837024548e-01   -1.000000000000000e+00   +3.438508155913522e-01   -1.510512967752443e-02   -1.253677920178292e-01   -6.342010288345769e-01   +2.914792093394556e-01; -5.022679340313794e-01   -1.361413049062318e-01   +1.955717268811613e-01   -4.350690749790101e-02   -3.836072602244638e-01   +3.179029291691037e-01   -1.095988061687186e-01   -1.127239823385422e-01   +4.032054296225271e-01   +7.112298208206236e-01   -2.743996074111720e-01   -3.005837800419254e-01   +2.692189868079238e-01   -4.983719721569648e-01   +2.249434420805509e-01   +5.995414785505669e-01; +2.072567454948176e-01   +6.941578904924550e-01   -1.508731932319962e-01   -4.118398477487563e-02   +2.619277876064654e-01   +3.543568773227081e-01   -2.913996188128495e-01   -1.074747362340244e-01   +1.318706871308527e-01   +2.897593772072497e-01   -4.684677306597699e-02   -4.346318442645177e-01   +2.872778746274170e-01   +8.857590724694817e-02   +1.828788503279770e-01   -1.819439185711424e-01; -4.057770440097687e-01   -2.753923512968575e-01   -4.783903719536475e-01   +1.190836533633923e-01   -1.183944950840210e-01   +3.292633205252888e-01   -5.714034646613192e-02   -6.545852430035343e-01   -5.311586181457349e-02   -1.771393504091996e-01   -5.158236808526066e-02   -1.806215630717923e-01   -2.042769447172655e-01   -4.707911022498880e-01   +3.912670164574803e-01   -4.319030147020179e-02; +1.190036561086831e-01   +6.408734158585613e-01   +3.558574550073468e-01   -4.667135509237601e-01   +2.762931929577814e-01   +3.784553334116011e-01   -3.580244159021444e-02   -3.488093108619001e-01   -8.200529818409751e-02   +6.039997704734287e-01   -1.175216684916380e-01   -7.147370064064988e-02   -4.353222088533347e-02   -1.570347199823054e-01   +9.938036027267601e-02   +2.384335393963792e-01; -4.424276652494832e-01   +1.096983669975984e-01   +2.200818520938263e-01   +7.082518032267034e-02   -7.258865334202376e-01   +3.855308959580129e-01   +5.933153238471156e-01   +6.021187922741269e-01   -6.388899901710040e-01   +6.506800414139652e-01   -2.129025453065708e-01   -5.921990496384075e-01   +2.109607867015908e-01   -1.473094035192793e-02   +3.461758520884239e-01   -2.283534125052059e-01; +3.725903620774610e-01   +4.040489682652722e-01   -1.764285487392073e-01   +1.175700370247094e-01   -8.192068913262260e-01   -1.480980391587921e-01   -3.488743711203170e-02   -3.002620607669364e-01   +2.560645250472758e-01   +8.754008539852882e-02   -5.525557540572380e-01   +5.762034766305738e-01   -3.195961485372770e-01   +4.268730385693717e-01   +6.511362140100831e-01   +4.163889166995658e-02; -2.471442302554003e-02   -2.304498482240416e-01   -4.483591076273357e-01   +4.188171634857826e-01   +2.268665207183100e-01   +1.476395364127246e-01   +3.322709061036756e-01   +5.805304077532981e-01   +2.394715205518355e-01   -1.692506721835745e-01   -4.401765706005638e-02   +7.358239929870215e-02   +3.659210847116926e-01   -3.247586958059741e-01   +3.687238756530901e-03   +1.471066663016014e-01; -3.087052633114964e-01   +3.992320445358830e-01   +2.170156448713551e-01   -4.030009262809244e-01   +3.269139348682506e-01   +3.129750838460154e-01   -2.541334278916519e-01   +6.958383766721953e-01   +3.973217549825767e-01   -2.420230382434252e-01   -3.201897483308536e-01   +1.134376879506294e-01   +5.180888070487157e-01   -1.776320023284449e-01   -1.818200358058091e-01   +1.197564809231524e-01; -1.817872674271256e-01   -4.893399254074812e-01   +6.121703091991064e-01   -9.771178813017999e-02   +1.559256055508887e-01   -3.593830179587579e-01   +3.440883210002619e-01   -4.959841437758386e-01   +4.315297744457731e-02   -4.087274604310419e-01   +9.009213859637389e-03   +3.681848585561843e-01   -3.022392118733517e-01   -5.406614301181173e-01   +3.930153370586175e-01   +1.368679374906081e-01];
L1E_L1I_iGABA_netcon = [+4.705181188181825e-01   -2.778245781486670e-01   -2.647264510108934e-01   +1.550768230161330e-02   -8.181721142539551e-02   -2.911760215183877e-01   -3.587474876508025e-02   +2.781365446723256e-01   +5.534587413032639e-01   +1.071982938416619e-01   -1.397475103813433e-01   -2.792944611777054e-02   +4.412496755758137e-01   -9.294778808267987e-02   -1.116400166300498e-02   +5.199116735026775e-01; +3.310220818361082e-01   -1.391045257971587e-01   +1.904041889806362e-01   +4.176320835368272e-01   +1.137129581974884e-02   -2.051706645772728e-01   -7.827559112368015e-01   -1.293249745091815e-01   +2.005457758184261e-01   -5.297025499028304e-03   -1.973798829606841e-01   -4.581004990179113e-01   +3.682903581596522e-01   +3.168299888353338e-01   -6.507299636172128e-01   +4.760525761999427e-01; -6.142001621580623e-01   -6.836199746848151e-01   +4.238205064573732e-02   -5.090716150747293e-01   +5.531863393800899e-01   -6.640724817996342e-02   +5.595852696479389e-01   +3.260622428837002e-01   -9.322581119779796e-02   -5.198409847820337e-01   +5.887298081812691e-01   +2.764696088835991e-01   -3.588548106614242e-01   -3.467268483857029e-01   +2.202417811442391e-01   +2.609661947064430e-01; +5.101594346124054e-01   +2.195981456388369e-01   -3.976435326936535e-01   +1.733441091284585e-01   -6.225057238089622e-01   +2.045164808449113e-01   +7.884545007848139e-02   +3.994575244551770e-01   -7.648567879838956e-03   +6.941655678477053e-01   -1.197781374749785e-01   -1.559101125599486e-01   -8.201320645437540e-02   +6.370039757701129e-01   -6.348986636272321e-01   -4.132222433196230e-01; +2.267884301998363e-01   +1.321600857422045e-01   -5.605662805830220e-01   +7.421747737847910e-01   -7.069029279760825e-02   -5.359162712388923e-01   -4.159141460331470e-01   +1.240341442524275e-01   -5.074719092311374e-01   -1.300014997793024e-01   +3.503139750801925e-01   -4.604839036176341e-01   +3.396395620930021e-01   +2.041525247118415e-01   +7.248772039250649e-02   +3.149753491688297e-02; +3.365225327172748e-01   -2.871083225123802e-02   -4.510187555300386e-01   -2.380853506819260e-01   +1.147532726120929e-01   -9.109153198393653e-02   -4.581385073129329e-01   +1.283430435969039e-01   -4.900164493139835e-02   -2.789706392130329e-01   +1.716608309224363e-01   -4.878161073940605e-01   +3.501591650667400e-01   +7.281074678345334e-01   -2.745620022434661e-01   +2.638146104307653e-01; -9.052205813959303e-02   -6.232277943611984e-01   +2.067733221063778e-01   -1.518725694634839e-01   -4.325151405955245e-01   +1.441826919453077e-01   +4.796342292139644e-01   -4.965802095603443e-01   -9.648939435813240e-02   +3.090730010812961e-01   -3.456172949501555e-01   -6.429959189593112e-01   +3.898443246493158e-01   +3.506589147096831e-01   +2.742984796488245e-01   +4.998671436994853e-01; -4.515658957995129e-02   -2.892868866022115e-01   -3.397602878415629e-02   +1.679686116638625e-01   -4.779401657856707e-01   -1.375688811520818e-01   -4.260871632906175e-01   +8.974205284328698e-01   -2.920060283984079e-01   +1.229479968484993e-01   -6.895883729715128e-01   +3.750840669580831e-01   +2.485513963691808e-01   -5.587113134020513e-01   -4.838732824943769e-01   +1.316004449069968e-01; +1.000000000000000e+00   +2.541306454596530e-01   -6.293396506442609e-01   -5.196951877910326e-01   +4.606939436511400e-01   -3.439768644330070e-01   +7.686224639716615e-01   -1.447118614467947e-01   +1.925148950732442e-02   -3.274034562562377e-01   -1.514573134583789e-01   +4.070888448493815e-01   +3.867551277400300e-01   +7.150619666550008e-01   +4.374162776415944e-01   -1.555641025606267e-01; -3.440717451100624e-01   -4.580429366421364e-01   +7.247539490393304e-01   +3.888326385604451e-01   -1.373876809447254e-01   +8.150154970616195e-01   +1.135727380475058e-02   -4.010929488327112e-01   +2.357713825298020e-01   +6.284819713197550e-01   +1.300034720399429e-01   -1.178191930959516e-01   +3.692961210760857e-01   -4.542114172696163e-02   -4.177188494755781e-02   +3.202888301108007e-01; -3.997103935935158e-01   +3.610890095279545e-01   -1.342542883485650e-01   +3.247222796173526e-01   -7.228220739097169e-01   +6.217876402739392e-01   +7.037066196095619e-01   +3.148119282985871e-01   -8.464445760610438e-02   +8.301487536884967e-01   +6.320474794514369e-02   +2.636164343043975e-01   +3.944060228791763e-01   -1.650568041432777e-01   +2.709708714825935e-01   -6.201549851532874e-01; +6.580975179200724e-01   +1.809601742745625e-01   -7.289894456769925e-01   +4.023078290984332e-01   +8.133769289385911e-02   -2.496984445322615e-01   -2.864010176560755e-01   +4.113959474995316e-02   +5.317452131255344e-01   +1.164842855181782e-02   +6.603855666008450e-03   +9.740955624780281e-02   -9.314809701626174e-02   +3.649940582112257e-01   +1.616028437231510e-01   -6.026768577555078e-01; +1.584232781226104e-01   +3.481048645831959e-01   -1.124262784770980e-02   +1.149357444357186e-01   -2.725491806997218e-01   -2.547994518444919e-01   +3.020833131724441e-01   +1.663951399077987e-01   -8.415879649971193e-02   +1.580489606148281e-01   -4.467124381737520e-02   +1.626246692009546e-02   -2.166532509926280e-01   +3.725396469691172e-02   -5.885858469984840e-01   +2.792165163920491e-01; -2.314319272707576e-01   +2.331791971290870e-01   +2.629713062067935e-01   +1.297229025380753e-01   -1.924558323198369e-01   -3.332387163952433e-02   -6.835937298203045e-01   +2.573350700329064e-01   +3.223816744849475e-01   -6.190794372773263e-02   +3.003133082035851e-01   -2.252074052541513e-01   +2.625237379303236e-01   -5.420647567571507e-01   -2.223391866493250e-01   +5.047295797643011e-01; +2.777608520396625e-01   -5.921280070964957e-01   +1.707587869493894e-02   -5.671737686719287e-02   -2.318629161568007e-01   -9.021291175337387e-01   +2.189259925195814e-01   +3.134074896633641e-01   +4.427026353950991e-01   -2.451792975754771e-01   -4.912796735848378e-01   -2.747031613507241e-02   -2.665042001356841e-01   -5.966958803471328e-02   -5.492497068101489e-02   +8.000746024995978e-02; +2.592065712790546e-01   +3.466719041359899e-01   +7.997309876060070e-02   +1.345209979741741e-02   +1.673263780531430e-01   +5.632317751753550e-02   +4.942624883766527e-01   -1.572986883417095e-01   +5.510317002875652e-01   +1.837399589307485e-01   -1.028555305447898e-01   +3.263993603821955e-01   +1.872577384110025e-01   -1.162839992571192e-01   -3.244503028031936e-01   +2.524961965082003e-01];
L2I_L1I_iGABA_netcon = [+1.043195317512587e-01   -3.280523862421167e-02   -6.734079100072850e-02   -6.662587997796539e-01   -7.932562145134910e-01   -1.483904617460197e-01   +2.889194724343795e-01   +3.610500671415336e-01; +6.061748996283214e-01   -2.788995989489741e-01   +5.655103142655584e-01   -5.627123739124049e-01   -4.614128352806786e-01   +5.742019254664613e-02   -4.469262945689069e-01   +3.306248910900098e-01; -5.322621360116313e-02   -6.959360104357640e-01   -4.484954317281232e-01   +6.764980688181178e-01   +3.309697831746152e-02   -5.835104364505881e-01   -7.020920656599552e-01   +2.472642444132497e-03; -5.262493808536498e-01   +2.721217639424005e-01   +1.984142443537748e-01   -2.185223924895318e-01   -5.789321523716369e-01   +5.368243163803890e-01   -4.226053931106430e-01   -8.504464134377684e-02; +5.683791577776057e-01   +8.016614018835849e-02   -6.774880336014302e-01   -2.281584498575199e-01   +2.116279831166175e-02   +3.742965007210727e-01   -3.809374060342640e-01   -5.032137041270300e-03; -7.300403835082451e-01   +4.715937868425618e-01   -3.521396862309274e-01   +2.818683690389381e-01   -2.342792722912084e-01   +4.468629939853226e-01   -1.000000000000000e+00   +4.688770603797663e-01; +2.429476492808117e-01   +3.847844194348221e-01   +3.757337361346977e-01   +2.477438660339178e-01   +2.485337554632348e-01   -4.316278367613159e-01   -2.245526465696210e-01   -3.857364170340502e-01; +9.086754110940199e-01   +7.638686309946707e-01   +3.279690655337989e-01   -1.003406444355622e-01   +1.765034941320756e-01   +2.469695008709205e-01   +6.518954372097229e-01   +7.328794082769000e-01; -1.499560836484639e-02   -6.109557007903026e-01   -4.717341240601808e-01   -3.501599916811787e-01   +5.032791349635104e-01   -2.073839445491762e-01   -3.800029377771181e-01   -2.717055217685944e-01; -2.667339584255642e-02   +8.054918589977956e-01   +8.322688685555268e-01   -9.654252359943321e-01   +5.349882064484489e-01   +5.578525150929438e-01   -8.164549739400541e-01   +2.783113693796609e-01; -4.468678929159978e-01   -3.127933434848558e-01   -5.404892496423024e-01   +6.580097468779027e-01   +2.057219645783050e-01   -2.267190400121365e-01   -9.812778150710512e-01   -2.214429057929840e-01; -2.244749398109973e-02   +4.909071661766662e-01   +9.531307682893589e-02   -6.876639519325045e-02   +8.266225884505117e-01   +5.470275901735880e-01   -2.754117695480152e-01   -1.625675084706396e-01; -3.856116532467095e-02   -3.806273041552198e-01   -2.941705815079604e-01   -3.590343245501747e-01   -3.196190877083778e-01   -2.365650959706222e-01   -7.493636730145563e-01   -8.350766259203328e-01; +5.108606750829542e-01   -5.004492514129433e-02   +1.452438647474390e-01   -4.168511369669073e-01   +6.703236643091318e-02   -2.703521592388560e-01   +7.255095650737984e-01   +6.563958541042821e-01; -5.067099634122900e-01   +3.320933104860215e-01   -4.898320542777861e-01   -7.384113985101905e-02   +5.145187107621224e-01   -8.421190119650818e-01   -2.047705239704043e-01   -6.542788614823446e-01; +2.873187691812408e-01   +1.980956713226373e-02   +2.185267061278847e-01   -2.662473201231544e-01   -4.349936132324467e-01   +6.031352355145009e-01   +2.395110962262461e-01   +5.881032727990079e-01];
L1I_L2I_iGABA_netcon = [+4.149643348875793e-01   -1.993441117441035e-01   +9.365310993640450e-01   -1.792798901317903e-01   -3.251550201606360e-01   +2.780293362315864e-01   +6.200392137510504e-01   -1.174958738083913e-01   +1.000000000000000e+00   -8.239282522545320e-01   +4.634700587077444e-01   -7.583721609052401e-01   +2.189891621439207e-02   -4.299654583739019e-01   -4.024375031566377e-02   -7.202792980163344e-02; +2.911763595068602e-01   -3.398794560628855e-02   -1.313450055285968e-02   +1.333442167599262e-01   +8.889848483995488e-01   -3.380923177123219e-01   +1.962855885153809e-01   +4.995697896001400e-01   -3.899415801309197e-01   +2.319257814025632e-01   -7.692102849579070e-01   -3.538772361984199e-01   -6.225430446188688e-01   +2.252550155896453e-01   +1.622656189352620e-02   +1.017452514946356e-01; -4.436562746065875e-01   +7.511673836096679e-01   -6.155541234890100e-01   +3.656689557298417e-01   -8.576280238149438e-02   -6.900399421936234e-01   +9.300101286767265e-01   +2.010029680075459e-01   -2.789490865475103e-01   +9.181451143971807e-01   +7.908589350922139e-03   +4.638993779770875e-01   +2.264314520941323e-01   -3.584780584246496e-01   +3.774734039087149e-01   -5.745230996457362e-03; +2.851511915550289e-01   -8.498261539000446e-01   -1.239793885371812e-01   -6.861883776994471e-01   -1.802731596636285e-01   +9.449900420965303e-02   -6.872842578253672e-01   -3.417733906515279e-01   +4.831085134529680e-01   -5.068390982300196e-01   -1.476076650866743e-01   +2.918207532801287e-01   -2.083114137795732e-01   -6.682194128483248e-01   +4.359960446818892e-02   -5.502427848555956e-01; +4.043124895910147e-01   -9.805913928173846e-02   -1.861687737077198e-01   +5.401130324940718e-01   -5.603733468397871e-01   -6.363910932574979e-01   +3.473966483158137e-01   -5.663589593029471e-02   -1.954545858338116e-01   -1.107054345565237e-01   +1.517286948490279e-01   +4.907447345740613e-01   -3.657847687982617e-02   -6.282028576975865e-01   +3.843989444031907e-01   -3.015873231326092e-01; +6.289296719135758e-01   -4.605761783934881e-01   -2.018779249274197e-01   -3.759759970966778e-02   -4.471667054816641e-01   +7.572291158598772e-01   +3.082582749462293e-01   -7.475147379022511e-02   +3.340568289389918e-01   +7.513012146918431e-01   -8.463117561445627e-01   +3.173456758925101e-02   -4.825377920605242e-01   -4.110900595228532e-01   -4.461623133455342e-01   +2.876721487772114e-01; +1.084400582273152e-01   -3.071413103684000e-02   +7.091295506497353e-01   +5.140871997693951e-01   -4.644771295136922e-01   +3.864204879532588e-01   -1.161979012754486e-01   -3.329548006372446e-01   -9.348239234275358e-01   +4.311857216379469e-01   -7.572503799484396e-03   -3.606804075210508e-02   -2.432378903606861e-03   +4.177913599168940e-01   +6.673429709857194e-01   +6.527141826841155e-01; +2.189312654956957e-01   +3.314768352254414e-01   -6.265712442798046e-01   -1.543406189839042e-02   +1.340369994950420e-01   -2.118796315583129e-01   +2.893187002917269e-01   -6.531528863950060e-01   -4.016774929395864e-01   +5.651973159173163e-01   -4.345042189624657e-01   -2.261539596644195e-01   -3.834382594820035e-01   +3.753068854199811e-01   +1.903849122556677e-01   -3.417697115909845e-01];
L2E_L1E_iAMPA_netcon = [-3.218155095269568e-01   +1.422547206269007e-01   -6.094930600406600e-01   +1.707154053114316e-01   -4.029582900593251e-01   -5.829138648007083e-01   -7.257505387018642e-01   +2.629942827889344e-01; +8.536173994915287e-02   +4.949863117404409e-01   +8.397667185063910e-01   -9.812323538630777e-01   -7.292737551737781e-01   -5.485776179038880e-01   -7.418633292415234e-01   -3.027749644237017e-01; -4.872325583726792e-01   +4.588698941374954e-01   -5.782424865306680e-01   +3.059333267737079e-01   -2.486271389058871e-01   -4.747525736415552e-01   +6.724454310594126e-01   +4.060225415275320e-01; -9.542282278507561e-02   +2.183717279992408e-01   -1.768841714248919e-01   -4.841273326570746e-01   -3.777363260480380e-01   -2.329439524199970e-01   -5.805302278115281e-01   -2.950388138898850e-01; +1.101245240072389e-01   +5.428097989213477e-01   +5.728110889491037e-01   +4.166358225344975e-02   -6.279166347166922e-01   +1.954151048511964e-02   +1.000000000000000e+00   -5.267358427895167e-01; +6.976976143651623e-02   -8.586726311961912e-01   +4.456773929081236e-01   -9.374676964334044e-02   -1.095582164704224e-01   -2.395069778363881e-01   +7.540517857854986e-01   -2.087711767085443e-02; +5.346334377545288e-02   +5.961870428786176e-01   +4.127085871245750e-01   +7.799986726964687e-01   +5.194351434431641e-03   +9.442507219812393e-02   -6.085667060405060e-01   +5.296081854217035e-01; +8.105109273264699e-01   +3.492122186638285e-01   +1.876970298416939e-01   +1.673932317385809e-01   -4.075548300533044e-01   -2.783546393550477e-01   +4.087750699770065e-01   -1.494294286877750e-01; +2.245424384170212e-01   +3.190285867188786e-01   -3.888252844929630e-01   +1.652469621542430e-01   +6.231579932942617e-01   +6.728551142089660e-01   -2.172726900932712e-01   -7.122756893156366e-01; +8.151315446944551e-02   +3.468757459906226e-01   -5.567484345018936e-01   -1.596837133781606e-01   -1.456586603195694e-02   +3.818928096346910e-02   -4.172386635722936e-01   +5.687293964433450e-01; -2.907149961249930e-01   +2.158903264157102e-01   -1.589128698948715e-01   -9.391002983393740e-01   +9.808539335832369e-03   +2.883363176289597e-01   -3.400834742478150e-01   -4.804307360689311e-01; +6.181032041654859e-01   +1.142188147477230e-01   +1.923891632202686e-01   -1.471408144806850e-02   +2.690994711110701e-01   -7.536879449878219e-01   -6.051817102648466e-01   +2.921571781842620e-01; -2.162469219968517e-01   -1.996744966289282e-01   -5.187886414168970e-01   -2.296373079240443e-01   +7.607725636275527e-02   -2.644596725850213e-01   +8.765417728134313e-02   -2.062105052797155e-01; +1.936980466388897e-01   -2.774222719613664e-01   -3.574101957261115e-01   -4.842289826246998e-01   -3.797896380892152e-01   +6.260440684004099e-01   +5.667857356986121e-01   +2.797141554545505e-01; -1.009699496518498e-01   -2.534479414728998e-01   +7.818353210652765e-02   -9.672850740837928e-02   -4.012376261656513e-01   -8.590383350933406e-02   -7.529441493309854e-01   +2.953580728582791e-03; +6.966170444249456e-02   +6.103045892290470e-01   +7.267986584829574e-01   -5.270071760287789e-02   -1.958850381286897e-01   +5.593341935129310e-01   -1.415750449374414e-01   -6.451002264936336e-01];
L1E_L2E_iAMPA_netcon = [-4.083719809137422e-01   -2.499919593811381e-02   -2.420417643758787e-01   +2.268713777693604e-01   -1.000000000000000e+00   -3.930700587436691e-01   +8.783244690837563e-03   +3.397110200531088e-01   +4.446439894246079e-02   +6.780158759001335e-01   -3.734466862005002e-02   +2.895268442627615e-01   +4.216626377660215e-02   -3.182039604720417e-01   +2.021370716463305e-01   -1.210931934857878e-01; +2.159558180627038e-01   +3.574639109833889e-02   +9.605738922575273e-02   +4.793886099738128e-01   -5.449348607292807e-01   +6.188174768255995e-01   +3.204776326669321e-01   +2.640752132708928e-01   +4.705124841013938e-01   -7.178394154534328e-01   +5.997428749281768e-02   -3.182889481596780e-01   -1.899575221357461e-02   -7.198738961951722e-01   +1.489931782793921e-01   -3.180545342604181e-01; -7.705491369293968e-02   +3.777698445877037e-01   -7.195386033532872e-01   +2.367846863444414e-01   -4.984759164012576e-01   -2.851950304597332e-01   -5.493044532759548e-02   -1.822368980182572e-01   +1.587011082793341e-01   -3.444797764568131e-01   +1.858187265578982e-01   +5.298996660161405e-01   +3.826612803065826e-01   +2.323020128456895e-01   +5.049013805966911e-01   -5.226537993450551e-02; +2.062932631779551e-02   +8.015320376250371e-02   +5.361446436294429e-01   +4.104941723753163e-03   +4.643109412039270e-01   -5.846058483776887e-01   -1.722124068493990e-01   +3.789487910553190e-01   +8.067091315817285e-02   -1.791093734994356e-01   +5.011734528540038e-01   +4.738049674225369e-01   +6.392722572461763e-01   +2.289348998545853e-01   -5.502949361729501e-01   -1.062348521241845e-01; -2.146596718941189e-01   -2.717185582621610e-01   +3.882805513709288e-01   -4.562224288669084e-01   +1.760266212142980e-01   -2.247826368324320e-01   +2.543810708814118e-01   -1.556507263618171e-01   -4.164268475563240e-03   -5.648434689461061e-02   -2.076704914991986e-01   +3.426824799906206e-03   -4.473591393725295e-01   +7.552101960977169e-01   +4.887687356068348e-01   +7.274057836656678e-01; +3.532852051230331e-01   -2.610049689994177e-01   +7.568521304152881e-01   +7.888620953558603e-01   +5.267910654765589e-01   +9.559885977755102e-02   -2.368994846159145e-02   -2.863717024364885e-01   -2.484727349877428e-01   +9.374425281556891e-01   +7.920170653849298e-03   -3.226698511253069e-01   -3.127130024300704e-01   -2.323147920474294e-01   +2.711409177535622e-01   -4.383626024062725e-01; +5.746251863782381e-01   +2.171832435036678e-01   -3.349322712646966e-01   -4.062477377858052e-01   +6.887806463860160e-02   -2.800028559351594e-01   -5.768260619530488e-01   -4.889699063497853e-01   +8.600217895049259e-02   -4.357998299983922e-01   -9.839558235714788e-02   -2.612845618628792e-01   -5.943719019667949e-01   -3.743280212879034e-01   -8.693654800704514e-01   +1.175034736131618e-01; +5.245414153127703e-02   -7.385833736852420e-01   +1.244482503452517e-02   +8.438344070957008e-01   -8.424425518763193e-01   +5.215802440539981e-01   -2.229346886222312e-01   -3.917660689109584e-01   -1.694980101543410e-01   +3.333677329259555e-01   -2.815635817386939e-01   -2.096147690580982e-01   -2.708817925519677e-02   +1.030276019430521e-01   -7.021386483259310e-01   -8.373909757260294e-01];
L2I_L2E_iAMPA_netcon = [+1.103410334199181e-01   -2.181773135379063e-02   -5.664526138132746e-02   +1.127856368991721e-01   -1.557437339344964e-01   -1.815345541696151e-02   +3.368832131722076e-01   +4.965495368599211e-01; -4.476842957919483e-01   +5.975316896682947e-01   -3.677973600310126e-01   +2.414984184363415e-01   +1.795651235902636e-01   +2.028281117341973e-01   -6.412048934619188e-01   -2.022491062293955e-01; -4.353819581749658e-01   +7.021824928859162e-02   +2.133250431489075e-01   +1.994139594907416e-01   +4.868768355788862e-01   -7.955303275404992e-01   -4.799162428745488e-01   -1.452368577807896e-01; -3.813125515078351e-01   +2.358172175663763e-01   -1.000000000000000e+00   +5.125188299469977e-01   -4.058730026566733e-01   -3.168181820637891e-01   -6.011169397336954e-01   +7.104146233485833e-01; +7.387578449794593e-01   +2.696531595732829e-01   +3.017949472670586e-01   +4.021972635247522e-01   +6.836837906638391e-01   +1.259495407251621e-01   +1.179538442476017e-01   +3.647010249974620e-01; -3.792742194193798e-01   -6.954100400710940e-02   -3.244586009274644e-01   +3.762682918472690e-01   -1.264150078415959e-01   +4.739425136705711e-01   -2.511884457910849e-01   -5.117918870600124e-01; +1.340876532418952e-01   +1.777223913996182e-01   -3.427307018768103e-02   +5.024956013277729e-01   -3.137650746725592e-01   +5.239385615788097e-01   -1.705128190557023e-01   -2.975948060104512e-01; -6.581030151559496e-02   -5.223953333573840e-01   -3.832814025404627e-01   -5.065017898732384e-01   -5.285003230314534e-01   -2.591552162650336e-01   -2.516652066510707e-01   +1.738301199829587e-01];
L2E_L2I_iGABA_netcon = [-7.832218257901851e-01   -4.659355345395037e-02   +2.512597637979682e-01   -2.465761129182216e-01   +5.097002916410492e-01   +9.918044755836727e-02   +5.064514118088190e-01   -5.031977513435008e-02; +5.908035465812823e-01   +2.546944917739579e-01   -4.975900215296010e-01   -6.257899409407668e-01   -3.242200664469473e-01   +2.008448683861764e-01   -5.051182945822201e-01   +3.173780597600135e-01; +3.132574012945633e-01   +1.065407340255093e-01   +9.560597476545504e-01   +7.038635793764203e-02   -5.514951727882172e-02   +6.783001427279279e-01   +2.123802388204977e-04   -4.058043506897516e-01; +7.225024951311253e-01   -5.690357030967848e-01   +3.530862481638622e-01   -5.982280557301029e-02   +9.764832565873204e-01   +1.199948359932980e-01   +6.981323311296365e-01   -3.121140721147611e-01; +4.336642297041395e-01   +7.147400455394233e-01   -1.041325551684095e-01   -1.488094438490855e-01   -2.853563023748498e-02   -2.703030810367323e-01   +8.021218473721472e-03   +7.068567082123116e-01; +7.304184739003569e-02   -3.886099934819289e-01   -6.423446919038689e-01   +1.000000000000000e+00   +3.447433512426467e-01   +2.809803802829977e-01   -2.604709965371972e-02   +1.241205391378093e-01; +2.885409339580118e-01   -1.657781835127146e-02   -6.767493363795897e-02   -4.529099432184588e-02   -7.727885663025605e-01   -4.174449628544226e-02   +1.587257557753028e-01   +2.724227156889484e-01; -2.737244642499832e-01   +5.787098302385061e-01   -4.500962398468429e-01   +4.206262108627782e-01   -6.101385117575777e-01   +6.920046811661028e-01   -6.567808225606427e-02   -3.039576959452926e-01];
L3E_L2E_iAMPA_netcon = [+3.921042855990101e-01   +3.239847269280800e-01   -9.713812540554613e-01   +3.559907947456913e-01   -2.657084002644267e-02   -2.352180100024700e-01   +1.221859322617661e-01   +8.113106877081973e-02   -1.702147576261130e-01   +3.070062009094238e-01   -4.183681087556563e-01   +4.066558783043513e-01; -6.025754868343622e-01   +1.782252550775113e-01   -1.991889731307448e-02   +6.219043974325252e-01   -3.735928053538697e-02   -1.643538777977519e-01   -1.468162139205139e-01   +8.466457972690913e-01   -3.201197478770955e-01   +1.628814283437491e-01   +3.633583609696398e-01   -5.585019592464737e-01; +3.238626302601387e-01   -4.170480622966860e-01   -5.308243073835154e-01   +5.994090070344218e-02   -4.840768809925057e-01   +7.184578611313158e-01   +1.747363353412068e-02   +6.978418406495958e-01   -4.205129317774235e-01   +5.917343681895681e-01   -2.195567817956155e-01   -6.049800360608928e-01; +1.970265013643788e-01   -1.992438292470094e-01   -3.497253922754994e-01   -2.126867746749169e-02   -1.154495322315584e-01   +2.987878146996206e-01   +1.702715630028086e-01   -4.975184616800772e-02   -6.913449757623346e-01   +5.119201638940979e-01   -3.501615686491055e-01   -4.430315165483349e-01; +9.162178926345153e-02   -1.711463312341790e-01   -4.554232768165042e-01   -6.719916036893853e-01   -6.996072729417134e-01   -7.113841740874159e-01   +5.462153379539730e-01   -2.052519082072064e-01   -4.766841071970090e-01   -6.825046264297695e-01   -7.145046536265337e-01   -1.080394776749578e-01; +3.628948645675208e-01   +7.028557990260548e-01   -4.285022081872303e-01   -5.369850215060363e-01   -9.263331295415769e-02   +2.002355629004367e-02   -1.237331190284463e-01   +2.497931167517093e-01   +3.502343950321001e-01   -8.000053291174321e-02   -6.304222113531972e-01   -4.179302812943667e-01; -3.692856073542279e-01   -7.087540599888802e-01   +6.068867216549131e-01   -8.485185118927774e-01   -1.378447147448771e-01   +5.443833103778556e-01   +1.371961923426028e-01   -9.342852257528002e-02   +7.272533567542611e-01   +1.619114538016092e-01   -3.924352042118944e-01   +1.000000000000000e+00; +3.569864338583671e-01   +5.556208405679010e-01   -3.784858638836823e-01   +2.844460313735933e-01   -3.148097541764556e-01   +7.804285199930941e-02   +7.330703595603441e-01   +1.590553661675706e-01   -1.828293218038184e-01   -2.389142410785292e-01   -6.026166159945228e-01   +3.078047037014132e-01];
L3I_L2I_iGABA_netcon = [-6.613325024636317e-01   -6.825229350460866e-01   +1.841782891523622e-01   -5.973844103219008e-01   -1.133222384135993e-01   +6.701255902179638e-01   -2.213153138845690e-01   -1.245204945939425e-01   +7.332297737531774e-01   -3.043517590237964e-01   -1.207874179569961e-01   +1.672117204629983e-01; +1.679251832873533e-01   +3.679235681335711e-01   -6.902421145246425e-01   +2.689972897563068e-01   +7.654418986714319e-02   +4.103535364466750e-02   -1.278335063229104e-01   +7.188707859339265e-01   -8.922000121173340e-02   +6.810302672587268e-01   -5.230739172144918e-01   +2.247003981679531e-01; -2.395301560430564e-01   +2.736040698120993e-01   -5.896467548308710e-01   -3.094063329871949e-01   -3.542277393277314e-01   +1.171753350385359e-01   -3.487376796889713e-01   -5.686305605898067e-01   -8.408026960973936e-01   -1.168065974553907e-02   +2.294624631142037e-01   +2.479074593019120e-01; +1.633478692784760e-01   -2.885127323386865e-01   +6.360507985133940e-01   -3.881857296254090e-01   -2.180741836387395e-01   -5.386385955965580e-01   -2.626724344481000e-01   -1.900619181795024e-02   -2.234925802563837e-01   -2.412004573216466e-01   -2.033021143921475e-01   +1.839338746791862e-01; +3.604660880765620e-01   +4.259032816307469e-01   -1.692230804539700e-01   +2.109190389959351e-02   +1.122043285719522e-01   -6.278329829813437e-01   +9.659789051513054e-02   +4.121020174129254e-01   +5.989708339208283e-02   -7.380055439728425e-01   -8.127053544962617e-02   +3.088033165211728e-01; -2.546924353665805e-01   +2.270332352403894e-01   -1.316329898187142e-01   +9.422973620748236e-02   +8.164390567431292e-01   +5.481936538512736e-01   +2.495804592113541e-01   +4.184927222728547e-01   -4.760093276838073e-01   -2.251146757128668e-01   -2.951700561740861e-01   +3.158244745425892e-01; +3.880732340454942e-01   +2.342105295098643e-01   -5.612302438473478e-01   +1.412063979379460e-01   +7.999786687962188e-01   -1.269293170848404e-01   +6.207649453100365e-01   +5.590882711226579e-02   +1.916865566305888e-01   +2.034813189775677e-01   -5.444037984530162e-02   -3.567624839309063e-01; -4.063752215147895e-01   +1.000000000000000e+00   +1.590199414682158e-01   -1.911363860289211e-01   -1.237921164980901e-01   +4.059495975867430e-01   +1.663311576254513e-01   -3.906801486255899e-01   +5.243103312037859e-01   +3.483362329861071e-02   +3.420133930366334e-01   +4.372960753806037e-01];
L2E_L3E_iAMPA_netcon = [-1.474010771766067e-02   +5.962399530211347e-01   -8.328805757933319e-02   +4.359014168760548e-01   +6.363335675482849e-01   +6.596866612159701e-01   -3.361212635238966e-01   -2.417879181868256e-01; +4.228622520428867e-01   +9.192773506162819e-01   +7.367986069944759e-01   -3.104698551722693e-01   +2.304231467195513e-01   +4.420767112283210e-01   +6.100096313771041e-01   -5.019477993432937e-01; +7.807708706597628e-01   -6.309988530376033e-01   -8.933932638843414e-01   +6.636642762281207e-01   -2.947316510489165e-01   +7.993776810091072e-01   +3.341687138306060e-01   -5.145082263272372e-02; -3.471333246830705e-01   +7.096925878678434e-01   -3.371894511902051e-01   +4.422007039889361e-01   +4.740933650348776e-01   -1.183650007638368e-01   -3.548635501989450e-01   +1.272321496066598e-01; +5.536268579706111e-01   -3.688055570644784e-01   -6.689030205054515e-01   -3.152420298679380e-01   -1.309872799397518e-01   +2.164091712030206e-01   -1.528570463950738e-01   -7.307773565484071e-01; +3.349586702130580e-01   -3.659470019418209e-01   -3.722930578149334e-01   +1.654911815591452e-01   -3.414454688342352e-01   +4.381422212950908e-01   +2.498795106606848e-01   -4.606445751585738e-02; +7.196712848404073e-01   -1.590790200329851e-01   -2.243217842099721e-01   +4.713459952401441e-02   -3.823772511189855e-01   +7.583232388380956e-01   -4.522326552105299e-01   -3.876279275229518e-01; -1.263144318382130e-01   +6.611614663676709e-01   +5.863739281321375e-01   +2.736106572458729e-01   +7.248139361649332e-01   +3.539050764078727e-01   -7.137392017544254e-01   +6.223620726256933e-01; +8.429254933653821e-01   -2.184063566764618e-01   -5.028175188935846e-01   -8.469025176343637e-01   -5.137817563706076e-01   -1.000000000000000e+00   -3.421383542998390e-01   +4.717654045191851e-01; +2.792537404392694e-01   -5.941243926844980e-02   +5.133725731380060e-01   +4.135369070525697e-01   +4.452697006382534e-01   -3.870280690137877e-01   -2.627504398222870e-01   +5.012485988162573e-01; +5.037831720054247e-01   +5.322417275852023e-01   -6.237619424321255e-01   -5.737577713030937e-01   -2.176782721667575e-02   -6.931951480612194e-01   +7.479003764657284e-02   -9.026203318421635e-01; +5.287624049771599e-01   +5.314853497551680e-01   -1.247095595605648e-01   +9.620097949702196e-02   +2.448457262275049e-01   -5.679256147422966e-02   -4.645107942958117e-01   -3.334056178568069e-01];
L2I_L3I_iGABA_netcon = [+2.526491705919904e-01   +4.543714260992548e-01   +1.465561120566880e-01   +4.426378398576544e-01   +4.243464043169878e-02   +8.080821315224654e-03   -1.939062205117459e-01   +5.701891061466494e-01; +5.389199137340175e-01   +8.522433483849564e-01   -3.295497539632470e-01   -6.230991760258315e-01   -3.531695865017850e-01   +2.734921133806110e-01   -4.344888640029773e-01   +3.713626206869728e-01; -1.295366259699746e-01   +5.626924957096421e-01   +7.991326068449900e-01   -6.586637585913012e-02   +3.171383622769987e-01   +1.080250738282612e-01   -3.001938076977512e-01   +3.912353559104191e-01; +1.682745084954203e-01   -3.364157659781214e-01   -1.000000000000000e+00   +4.047740033599946e-01   +5.524776000317373e-01   +1.175022991340618e-02   +7.404998699677362e-01   -4.809115000781480e-01; +9.603251118399335e-02   +3.982213746612554e-02   -5.460178509675717e-01   -5.645783565828016e-01   -6.313291663555944e-02   +3.497625441706756e-02   +4.144401291372822e-01   +3.761262785203326e-01; +5.158418221772341e-02   -5.391657729183726e-02   +4.715889564028698e-01   +3.890342887338624e-01   -5.694817146149916e-01   -3.149112465613869e-01   +1.344773497614258e-01   +1.937692141775707e-01; +8.997654157434485e-01   +1.362373678661023e-01   -6.585156852692712e-01   -3.565021291889087e-01   +6.991283762047029e-01   -6.413255830169075e-02   -5.058899756069231e-01   -8.227338390089374e-02; +6.898681829512479e-01   -1.395454656108674e-01   -2.581522792450261e-01   +6.932928849833137e-01   +3.882712544374307e-01   +5.366499461833566e-01   -3.510920640752156e-02   -2.627469654078537e-01; +3.785227347614115e-01   +2.157002365861825e-01   +1.331438670687931e-01   +6.180385958004533e-02   -2.414908184786204e-01   +3.945196800201469e-01   +4.748462057743930e-01   +3.459455346490368e-01; +6.477871498367549e-02   -2.514167723207689e-02   -2.125732447329816e-01   -2.034507945843123e-01   +2.672565121845760e-01   +5.312904494907674e-01   +7.006239560553634e-01   +3.940737761717766e-02; +1.142683030407776e-01   -6.749630785546291e-02   -4.973674285304307e-02   -5.108874473337705e-01   +1.677566461016780e-02   +5.237259764135626e-01   -4.248645802696800e-01   -6.195908674525031e-01; -7.584239128599827e-01   +6.233003391993678e-01   +3.401977217687447e-01   -2.634996481840589e-01   -3.174026655855061e-01   -7.318042956108264e-01   +2.291212240950598e-01   +2.656179906610450e-01];
L3I_L3E_iAMPA_netcon = [-7.898753960678147e-02   +3.496692323147793e-01   -5.359292664530541e-01   -1.026549959386103e-01   -3.195734234207355e-01   +1.428646567276564e-01   -5.433972934983885e-01   +6.528743771849752e-01   +2.594379443110131e-01   +2.319556429487549e-02   +2.699906874509168e-01   +6.942502390992523e-01; +3.769977184004072e-01   -1.951044788081361e-01   -6.441705453377827e-01   -2.210273792957874e-01   +8.208846341184651e-01   -1.547949265054146e-01   -7.772639959732068e-02   +6.411907609199330e-02   -8.554534154490674e-01   +5.048160709308509e-01   +1.715837708001006e-01   +5.327141523560715e-02; +8.530288708415032e-02   -4.720445495795803e-01   +8.210800960128596e-01   -4.830432874971318e-01   +1.443927771341575e-01   +1.154214730103860e-02   -1.338923283640088e-01   +3.024911664753145e-01   -1.431960424361289e-01   -3.082368293054190e-01   -2.831524801861281e-01   +4.858005450540730e-01; +2.513129970565057e-01   -6.045708237193821e-01   +2.124388032983596e-01   -7.203913826259453e-02   -3.132753453855396e-01   -7.108801785450284e-01   +4.607540607253061e-01   -1.637155303179347e-02   -1.027265102410566e-01   +1.109113837632219e-01   +2.463527148271975e-01   -3.399122065870078e-02; +1.612992741414743e-02   +4.437220390070330e-01   +1.428998573388619e-01   -1.305088041657470e-01   -4.251948115230200e-01   +1.336441256295984e-01   -2.983613206205487e-01   +5.148667440318676e-01   -3.432532564662954e-01   -6.067551025687563e-02   +3.417164855592846e-02   -2.635504287790422e-01; +3.917772764798619e-01   -2.790181056165933e-01   -4.973856813446009e-01   -1.295517615029868e-03   -8.279646156146490e-01   -5.795343330646149e-01   -7.522379237428913e-01   -4.853509124399065e-01   -7.068780041857645e-01   +2.846177212715201e-01   -3.265129434441491e-01   +1.868093794629207e-02; -7.074847345448977e-01   -3.112886684653807e-01   +7.229178575834727e-01   +1.798322486968315e-01   -2.021855283732892e-01   -8.488452902247468e-03   +3.680655304091364e-01   -2.425898938592662e-02   +3.150571701151796e-01   -4.813560035557142e-01   +5.585699759096254e-01   -1.000000000000000e+00; -5.102292520579007e-01   -1.933217276239391e-01   -8.823627097662304e-01   +1.541041596891601e-01   -6.095412902333562e-01   -3.215215680791748e-01   +8.673372695503207e-03   +2.338316554058006e-01   -6.775224173762150e-01   -2.714805797526371e-01   +3.005080403375061e-01   +2.125135139373520e-03; +7.301849340098845e-01   -7.098345601140234e-02   -6.146345847965510e-01   +2.080244746828563e-01   -1.129842748896048e-01   -5.827504578220555e-02   +3.441818888777060e-01   +4.321325221630216e-01   -3.912020862203198e-01   -4.835611817422382e-01   -1.089047499704392e-01   -4.476983474672843e-01; -3.610057046161538e-01   -7.645665891702350e-01   -2.203906743040770e-01   +2.210445299615066e-01   -5.810038784203710e-01   +3.366790518503575e-01   +1.990835217377649e-01   +1.682048438342270e-01   +6.920230014481634e-01   -1.171296771734932e-01   -6.273954506726951e-01   +2.970929518753937e-01; -1.380321057738611e-01   +5.403323908018952e-01   +1.093533370622708e-01   +4.048385477067417e-01   +4.787588983703834e-01   +4.489443697660013e-01   -3.464810748345226e-01   -5.782177929616479e-01   +2.638132511291315e-01   +5.439277332349565e-02   +5.728873715668268e-01   -6.543812083459435e-01; -1.171783118012101e-01   -9.588842713500724e-02   +1.489124579834772e-01   +3.278939676785302e-01   +6.590288955051179e-01   +3.786203124544467e-01   -4.420179268743288e-01   -3.614285298096050e-01   -1.582152458687414e-01   -1.291170582300139e-01   -7.359908528139080e-01   -1.846235625356472e-02];
L3E_L3I_iGABA_netcon = [-5.569730632188835e-01   -3.329524447261420e-02   -4.792011057476001e-03   -3.747598652900185e-01   +4.560841483185467e-01   -1.549808257440197e-01   -3.129764063674361e-01   +2.836627518586533e-01   +5.900418835487089e-01   +2.860254941290764e-01   +6.455687147592667e-01   -5.948161391243370e-01; +6.996554674396190e-02   +3.282990495353518e-01   +8.470836369983303e-02   +2.551281675530255e-01   +2.084841694459688e-01   +5.219765784433130e-01   -3.027400479010025e-01   +4.146160154809585e-01   -7.138959086460058e-01   -2.070391910632156e-01   -2.649032096027883e-01   +1.900883458480779e-02; -6.683830219159614e-01   +2.690288195898418e-01   +3.645691912803118e-01   +1.221732101811984e-01   -6.541170939045581e-01   +2.629253760070635e-01   -7.352736370916686e-01   +2.781388159178985e-01   -2.205143326854379e-02   -1.437819539687845e-01   -2.165889027372711e-01   +4.637395337968453e-01; -3.052202441348147e-01   -5.917450733760830e-01   +7.891873204558260e-03   -4.951509386947461e-01   +5.799967110164707e-01   -4.381953095629941e-01   -2.730568446486361e-01   +1.605926084988185e-01   -4.283899068693960e-01   +3.041815145353838e-01   +4.650573989825889e-01   +3.190374701308859e-01; +1.610445185603210e-01   -1.960808170455859e-01   -6.817818248502564e-01   +7.239395994004587e-01   -3.810670785184274e-01   +7.494024055026973e-01   -1.528460035632397e-01   -4.543073998101868e-01   -4.090334224454182e-01   -4.045868830203631e-01   -2.278070980873318e-01   -9.919965664085248e-01; -3.012420969147303e-02   +5.825904574885937e-01   +4.850266518135307e-01   +5.013319895858702e-01   +2.020751664757780e-01   -3.336129850363953e-01   -3.966908173689100e-01   +1.589060434854500e-01   +7.087788840335828e-01   -1.660528365755592e-01   -5.877482881344371e-01   +1.975135384618093e-02; +3.275576251856165e-01   +3.530504254776145e-01   +3.308863487184293e-01   -7.356829504864217e-01   -7.256930933809520e-01   +3.223241290795514e-01   -2.362678518098187e-01   +8.533282981641321e-02   -2.310641602427066e-01   +3.203828208131219e-01   -7.383491493457205e-01   -3.008516239266455e-01; -2.106778119111481e-01   -6.189854272416170e-01   +2.719987932609128e-01   +5.232167858957865e-01   -2.770534504039988e-01   +2.829129555240047e-01   +8.616478058400227e-02   -2.360812318597570e-01   -4.163304958196923e-01   +8.154821652807249e-01   +7.489967263991162e-02   -1.224476626614516e-01; +6.052671915616469e-01   +4.613571266894748e-02   +9.841003352393605e-03   +3.315973837869506e-02   +5.002512783867333e-01   -2.320254634426704e-01   -6.814643570622578e-01   +1.372562079931898e-02   +8.134110693617966e-01   +6.120410816016594e-01   -5.951030620859364e-01   +4.726368916188838e-01; -3.484464081674796e-01   -3.124184067663643e-02   +1.530706626124972e-01   +3.712095089466315e-01   -4.053563748580746e-01   +2.922563980996695e-01   +4.475892911578793e-01   +6.019172367579571e-01   -3.634898869836522e-01   +4.242869654686861e-01   -7.617021602974140e-01   -1.039915894789250e-01; -9.100182404654274e-02   -3.241681269248154e-02   +5.538795434320095e-01   +1.371120043408121e-01   -4.074400099365887e-01   +2.863698992059150e-01   -4.921186037322486e-01   +1.000000000000000e+00   +8.637841597417645e-01   -6.349406951348296e-02   +1.662722253719405e-02   +5.563521842393935e-01; -1.210592314677353e-03   +3.522594089651009e-01   -6.458263242458629e-01   +6.780475146418949e-01   +4.780205519819894e-01   -4.255347874998405e-01   +1.847843866937497e-01   +3.697241568553908e-01   +3.925835027381153e-02   +4.575692517531229e-01   +8.067112658373968e-01   +2.035700698843143e-01];
L2E_Input1_iAMPA_netcon = [-5.407667832941973e-01   -5.088834336667433e-01   +8.551628208061765e-02   +1.000000000000000e+00   -4.218642465999874e-01   +7.989457421632370e-01   +4.160214076137515e-01   +8.405379074668937e-02];
L2I_Input2_iAMPA_netcon = [+5.521533853035201e-01   +8.203276547039398e-01   -1.561536226388338e-01   +4.955498364389751e-01   +7.705703739744982e-01   +8.927052402929458e-01   -8.949993697509677e-01   +6.687312064609923e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
