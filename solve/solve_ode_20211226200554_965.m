function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.971258716236208e-01   +7.285248132006113e-02   +1.018394047515086e-01   +4.253681091668399e-02   +8.864547046438929e-03   +7.809894436099450e-02   -1.386059334538016e-01   -2.033433498414522e-01   -2.570252508835330e-01   +2.387656063049706e-03   +3.719821965459400e-02   -2.338448779009574e-01   +7.763964746080301e-02   -3.437191382705630e-01   +1.854427167088540e-02   +8.629925035042529e-02; -1.248649964332231e-01   +2.530323167175162e-02   -1.689267187229008e-01   +1.225092578473019e-01   -7.980532045549299e-02   -5.935083705613009e-01   -2.442745838474092e-01   -4.328597206964686e-02   -1.594516892611540e-01   +2.111065482726031e-01   +2.756440490900497e-01   +1.393000167575681e-01   +1.394210218019944e-01   +5.149035216439050e-02   +3.114378387928479e-01   +2.967848238621261e-01; -7.701552862271349e-02   +3.793670702197313e-01   +1.480011179525602e-01   +9.642155757497346e-02   +1.292559560940582e-01   +1.099618785035233e-01   -2.110640949655579e-02   +5.947694989057497e-01   +8.030135869629260e-02   -4.457908909455982e-02   +3.973205318895390e-05   -1.540085987995412e-01   -6.910262671777168e-02   -4.331520249929534e-03   +2.362564606540468e-04   +1.047054088667430e-01; -6.874267651770308e-03   -3.573187875383638e-01   -1.133960494260709e-01   -1.917925145208994e-01   +6.542797752359472e-02   +1.915138278342239e-02   -3.074849169584754e-01   -2.348734735710130e-01   +8.263325957230751e-02   +1.386616683774594e-02   +2.289679419678181e-02   +1.152770890043214e-01   -1.340002799102618e-01   -2.092568455297104e-01   +1.220355211973992e-02   +5.103214644672477e-02; -9.513626299984881e-04   +2.961979494869394e-01   +1.813799822049415e-01   -1.598883779167649e-01   +1.981458518137982e-02   +2.836207571669299e-01   -3.219209495325985e-01   -2.728520739570268e-02   +4.461830656059015e-02   +5.635954637967844e-03   +1.976782303742307e-01   -7.036230826531155e-02   +2.260802163825401e-01   +1.267673900754717e-01   +2.579830896194577e-01   +3.533661043735377e-02; -1.563431158047099e-01   -3.206893001661225e-01   +1.596851349051034e-01   -1.624915750853071e-01   +2.738839295827585e-01   +3.201591771147808e-01   -5.121559065553413e-02   +5.105120321020795e-02   -4.329778451226836e-01   -4.527656662451802e-01   -2.042379100614934e-01   -3.106475741742315e-01   -3.820677487774288e-01   -2.452484238526456e-02   +2.480142317251803e-01   -3.570608670967903e-01; +2.626210518733990e-01   -5.186966353389740e-02   -1.676206330088704e-01   -3.461525925956855e-01   -1.512713433181105e-01   +1.415163910955447e-01   -2.110828757124504e-01   -8.192226717967899e-02   +3.518292904601875e-02   +2.419288558817261e-02   -2.977371171585212e-02   -1.317000378776939e-01   +2.329573546009302e-01   +8.708284563887711e-02   +6.534043622503340e-02   -6.266343498153645e-03; +1.739279978652642e-02   +6.912211985725003e-02   +7.033629584904486e-02   +1.633525001807099e-01   +2.248305132629965e-01   -1.586029415366400e-01   +9.137058462966123e-02   +8.285138176075130e-02   -9.152287223055562e-02   -1.025333483899065e-01   +2.447321438594473e-02   +1.419806918800979e-01   -4.159381642038398e-02   -1.097592002084896e-01   +2.031745660230663e-01   +6.077746465478534e-02; +3.465209971609196e-02   +1.641717626213539e-01   -1.245232147410276e-01   +1.318933516801286e-01   -8.098641178465907e-02   +1.617064322914160e-01   +1.925883376125494e-01   -1.077176414397962e-01   +2.361284661194518e-02   -8.720116472372934e-02   +2.546068913672729e-01   -1.391766845099713e-01   -1.231269475643540e-01   +1.834667238904032e-01   -2.582912088161249e-03   -2.257289750608739e-01; +1.538771425290998e-01   +7.008054761190401e-02   -9.327514208784385e-02   +1.646278569892130e-01   -2.526853676759167e-02   -1.561298133008674e-01   +1.660112282777482e-01   +2.719843445217355e-01   +1.906580390515725e-01   +2.998902770434823e-01   +3.344263636443545e-01   -3.568441940194217e-01   +3.880802100351180e-02   +1.667911485433982e-02   -3.319674389589855e-01   -1.016874553593166e-01; -7.320377466831127e-02   -1.786721015491148e-01   -2.753161467255023e-01   +1.069630344772973e-01   -1.325225150002912e-01   -2.691523492250880e-04   -1.272035718427652e-01   +2.231216738556173e-01   +2.926939163586412e-01   -6.875764066701502e-02   -1.660268276361394e-01   -1.018642896443932e-01   +6.152617506152781e-02   -1.533851981306001e-01   +3.439011109386788e-01   +3.334142456929637e-01; -2.351542241971679e-01   +2.577926226920542e-01   +1.372496429126029e-01   +1.266038652227161e-02   -1.722596528418390e-01   +3.411897048918502e-02   +2.387188033008110e-01   -1.553748983861740e-01   -1.744961243695485e-01   -8.318537815087240e-02   +2.552133139245728e-02   +2.960562474683233e-01   -1.513288228221285e-01   +1.351131450279696e-01   +3.989055142970754e-01   +4.375395075121937e-01; -1.998462485501465e-01   +1.564105583165980e-01   +3.428601509934611e-01   +1.195617792196558e-01   -2.809380940127985e-01   +2.378510158332983e-01   -3.542116838205427e-01   +3.195573746591928e-01   -3.106096402513815e-01   +1.451980774518815e-01   +7.704348352422226e-02   +1.814353694539334e-02   -5.743185516256312e-02   -3.819694081630657e-01   -1.441615564903487e-01   +2.175988300344367e-01; +4.947388154763353e-01   +1.066494831156823e-01   +3.631669488103392e-02   -1.331978017706084e-01   +1.685692790008356e-01   +3.862782455045675e-02   +2.272603228219883e-01   -2.031798597867843e-01   +4.985752595954721e-02   -2.264425014770895e-01   -2.039152473745167e-01   +8.713872381477655e-02   +1.345866317203624e-01   -2.492309324001395e-02   -1.076318161239814e-01   -9.827265336025129e-02; +4.750231853524370e-02   -1.520451181814116e-01   -5.280343250033308e-01   -1.097235223426705e-01   +2.449065064224390e-01   +5.954586072781580e-01   -2.022090781844268e-01   +1.041475981948195e-01   -8.612943463283396e-02   +6.371411613683425e-02   -2.092505807541042e-01   -8.432572711987273e-02   +1.115112864103715e-01   +2.942271777777117e-01   +2.308951393283432e-01   +1.178000619595493e-01; -1.420748148139511e-01   -1.809254984314952e-01   +2.343359164070048e-01   -1.105783989136624e-01   -3.498096940080557e-01   -2.293410701723964e-01   +8.121322616538272e-02   -2.843799309996760e-01   +6.488443882491810e-01   -2.426342261512674e-01   -1.006334663299385e-01   +5.385928013891347e-01   +1.014418365971320e-01   -1.908962569639591e-01   +3.069126606287671e-01   -9.569672442537418e-02];
L1E_L1I_iGABA_netcon = [+3.999663465827637e-02   -1.369119384142778e-01   -1.313472712980438e-01   +9.254066964091080e-02   -8.748864441904243e-02   -2.133836286682433e-01   -1.103469122680288e-01   +2.365446556478194e-01   +8.355523999158318e-02   -4.235638672764933e-02   +8.609310149887847e-02   +2.528897448389080e-01   -1.782838430130477e-01   +1.260487278424418e-01   +2.380641455546784e-01   +1.899890836948787e-01; +2.257717934223570e-01   -7.773500833970234e-02   -1.550231361874404e-01   +3.220843547518934e-02   -1.597122183490963e-01   +1.210873986457680e-01   -7.519446336651767e-02   -1.435886374955968e-03   +1.204400145670346e-01   -1.622438156334196e-01   +1.426526015472133e-01   +3.619097236082671e-01   -9.584820894020973e-02   -5.019964457980051e-02   -5.958792271519367e-02   +2.127246028497081e-01; +3.241799118086183e-01   +5.558901711337089e-01   +2.723146892342500e-01   -1.821913133287410e-01   -1.674127296261178e-01   +1.680799401815773e-01   -2.547610644229396e-01   -4.387918056258418e-02   -1.717090986665612e-01   +2.673130193046597e-01   -9.310120169042295e-02   -1.419309756981104e-01   +4.202748324012310e-01   -4.000186872229156e-01   -4.106705365606264e-01   +2.757861900406451e-01; +3.991554690136272e-02   -1.174403429997004e-01   +5.554151184834323e-02   +1.267002358774225e-01   -1.705079117967924e-01   +6.696577287951908e-02   +3.091502947329102e-02   +3.033164404237347e-01   +6.733556861570622e-04   -2.365341277746470e-01   -2.003715272095968e-01   +2.732680722069368e-01   -3.792313321891555e-02   -1.990613012033612e-01   -2.330836997395598e-01   +4.946259437670929e-02; +4.340167827233816e-01   -4.606642095496827e-03   +2.073914826220275e-01   +5.740466085213219e-02   -1.173836188428491e-01   +3.710257816281393e-01   +3.986997224510014e-03   +1.643518113296784e-01   +3.324440026795515e-01   +1.178378017516237e-01   +2.091196036867636e-01   +4.896813960237615e-02   +3.461600250977923e-02   +3.075383335020888e-01   -1.844495798897425e-01   -1.716287088645187e-02; +5.755280678075306e-03   +3.456033379425877e-02   -7.433366632566589e-02   +5.749380100092982e-02   -1.405535151413902e-01   +3.154108702836056e-03   +2.977189778424324e-01   +2.727846761222813e-01   +6.474256991619351e-02   +6.607935100084115e-02   +3.439741999273633e-01   +3.596261628844371e-01   -2.359743133152034e-01   +1.039901879403101e-01   -3.187266436020360e-01   -2.114928292966853e-02; +1.430382044352600e-01   -4.023981131779547e-02   +6.282045230306540e-01   +2.115241865236085e-01   -1.147900156277250e-01   +3.219048828788812e-02   +9.573235341053668e-02   +7.809320102978588e-02   +7.391090177446323e-02   -3.749353648032795e-01   +1.704975220691090e-01   -2.308430785318757e-01   -1.748705936743197e-01   -1.523309407357078e-01   -4.806171759455811e-02   -1.385931655705197e-01; -1.992527609217279e-01   +3.195304919162228e-01   +1.760077907020501e-01   +2.075018494284257e-02   +3.323824170920373e-01   -2.027915618907086e-01   +1.373007159235579e-01   -1.923268549036177e-01   -4.309596637669238e-02   +3.197203673497225e-01   +1.250188908753304e-01   -6.263627939477089e-02   -9.644074309889576e-02   +3.482847804175045e-01   -2.110754236668382e-02   +1.553484793599098e-01; -1.934746931707770e-02   -2.906117367481887e-02   +1.547469627853163e-01   -1.699189631102290e-01   +1.977109014862080e-01   +3.434645730320192e-01   +6.280188677430448e-03   +9.127793816883958e-03   -7.862520174527279e-02   +1.154175397668467e-01   -8.421699157570772e-02   +1.717140522301298e-01   +2.779760070601266e-02   +2.875610535314991e-01   +3.290093752798219e-01   +4.690747781003213e-01; +9.412011199813974e-02   -8.040358967921560e-02   -2.248071030571666e-01   -1.769961558110111e-01   +2.758493230381732e-01   -1.434546008770781e-01   +6.406566828939672e-02   -1.846370313053319e-01   +2.566918411509569e-01   +1.096937836707410e-01   -1.975479407727246e-02   +1.949333998851175e-01   -1.160958601504342e-01   -2.423951672864083e-01   +2.423311376641472e-01   -1.602282295458209e-01; -7.615855817057852e-02   +2.986994863429675e-02   +3.419919254985684e-02   +6.726438164518421e-02   +2.782594000669615e-01   -1.179916575953051e-01   +5.631962444250645e-02   -1.734524385802183e-02   +1.636148474619836e-01   +6.354025793941664e-02   +4.211253461622058e-01   +3.133128172047929e-01   +2.841992073453543e-01   +6.942162294119479e-02   +2.186744759618365e-01   +8.475123052727064e-02; -1.042460458978162e-01   +2.016685562242148e-01   -1.443905791914359e-01   -1.492344314363875e-01   -2.355634264060981e-01   +1.061540264417362e-01   +2.403045678631646e-01   +1.563119745732473e-01   +4.159650903613704e-01   +1.179760337819837e-01   -2.015140547231897e-02   -5.162473407848434e-02   -1.831645645700671e-01   -2.854838485234716e-01   -1.601041233986995e-01   +5.331202160075933e-01; +2.452325400322344e-01   -3.231663451287748e-01   +3.694304174165270e-02   -5.087647067994086e-02   +2.298810647017526e-01   -1.303609188502601e-01   -4.099770953480317e-02   -3.949666777922451e-01   -1.428118357985764e-01   -3.452316536775958e-01   +2.749928040748604e-01   -3.883168968582262e-04   +1.516473162586732e-01   +4.657721861957537e-03   -2.085732982991624e-01   +1.666919682732027e-01; +1.102850172981941e-01   -1.445189444305508e-01   -2.072189738817513e-01   +2.630273259496859e-01   +1.493133019796564e-02   +8.591369381431879e-02   -8.320113476914223e-02   +2.438185383702980e-01   +1.665043977776227e-01   +4.584802297531018e-02   +5.331341230120185e-02   -1.709143702880405e-01   -4.523202689052030e-02   -3.062708798632459e-01   +8.225981400206336e-02   +7.886617115653566e-02; -5.090233830524650e-02   +1.800856595363322e-01   +2.128948622308642e-01   +2.244717482781063e-01   +2.491230641720915e-01   -1.321822983694428e-02   +2.413723752056197e-01   -3.015648362786220e-01   +4.776758415743285e-02   -4.033521976248971e-01   +5.762547011340838e-02   +9.868840903878504e-02   +1.605898714512976e-01   -1.315735278488426e-01   +8.222382634151712e-02   -3.656546469797614e-03; +1.768698233914992e-01   +2.220938593825649e-01   -1.604714317114670e-01   -1.765838539045251e-02   -2.653319039516111e-01   +3.893977674821747e-04   -1.655206715531786e-01   +2.936551681943699e-01   +2.478366925910827e-01   -1.547579421798618e-02   +3.330923147520167e-01   -1.177966064664411e-01   -5.760661120771383e-02   -4.293447365734492e-01   -4.622436994024183e-02   +8.267675977423790e-02];
L2I_L1I_iGABA_netcon = [-2.873077497701432e-02   +4.945711494070847e-02   -1.627904888046343e-02   -7.581884853493512e-02   +2.410332703585946e-01   +1.062721196107609e-01   -3.226790615920170e-01   -1.410082279040873e-01; -5.444416165155690e-02   +1.665264903649410e-01   -9.315777924580494e-02   +2.581360069712387e-01   +3.267336110663739e-01   +1.305298732554948e-01   +2.377669839960382e-01   +1.611034544521021e-01; +1.572767420381904e-01   +3.853688373059823e-01   +4.462826189694106e-01   -1.029985763785173e-01   +4.911289512557343e-03   +4.898506662345347e-01   -1.743980262097778e-01   +3.438177897057930e-02; +2.199448585200592e-01   -2.775068363484890e-03   +2.934920934783714e-01   +2.580915026571929e-01   -2.625749176710934e-03   -1.047898135147284e-01   +3.924895747254452e-01   -6.265800472427031e-02; -5.638775425061800e-02   -2.681271310542147e-02   -4.148859790561433e-02   -7.481499217508084e-02   +4.540551670172754e-02   -1.492128681434297e-01   -3.986594827945540e-01   +2.479361817295479e-01; +5.524853646633376e-02   -8.545737362840525e-02   +2.007199462404579e-01   -2.928721666323332e-02   +2.607455788012510e-01   -2.294842695536339e-01   +1.759768066138518e-01   -3.023769288872682e-01; +2.831770629649824e-02   +7.347599404491686e-03   +6.828293402499408e-02   -2.321854684023752e-01   +9.848393328603308e-02   -7.411279771111980e-02   +2.862803279345440e-01   -1.405897308361915e-01; -1.485499814530252e-01   +2.454322555332264e-01   -2.010442552126442e-01   +2.832158768706942e-01   +7.195597425767405e-02   -1.568472382022170e-01   -3.552278223969854e-01   +1.387678768553651e-01; +6.933667976786015e-02   +1.138717140028467e-01   +2.044247273385572e-01   +6.563062416656580e-02   +1.374547743785052e-01   -1.508155013783934e-01   +5.442358975838299e-02   +6.796131504145449e-02; +9.367883008882083e-02   -1.282176815254345e-01   +2.209096248501347e-02   -2.649636765388866e-01   +2.047921462699531e-02   +2.328589944090543e-01   -2.055466205048310e-01   -2.338964964675423e-01; +6.793779694240304e-02   -2.466979730766186e-01   +1.601147631177473e-01   +1.984034780830412e-01   +3.568036613731356e-01   -2.883019044388254e-01   -3.788520277098802e-01   -7.555717119201920e-02; +1.700327545507775e-01   +3.918107916323438e-03   -1.784062165076281e-01   -2.383397699168315e-01   +3.347989119432363e-01   -7.143838757777281e-02   -4.727800164591204e-01   -5.104909537022340e-01; -8.416270870690182e-02   -1.343803160658278e-01   +1.024549235237769e-01   +3.102918922581527e-01   +5.525727719273454e-03   +1.288941491343137e-01   -1.811993926009158e-01   +1.381049381815075e-01; +2.734475685837421e-01   +1.996764571244563e-01   -1.150499762609430e-01   -9.692299597146362e-03   -1.364770897278189e-01   -1.922495984867382e-01   +9.764863005994642e-02   +7.800329418057188e-02; -8.252237687694586e-02   -1.689601490198112e-01   +2.852863990732395e-01   -3.402957163047104e-02   +2.500437756738099e-01   +2.928420981966462e-01   +1.373247593099097e-01   -1.968747996023242e-01; -5.424949496144588e-01   +1.349045472500827e-01   -1.742198703371025e-01   -3.629138576248932e-01   -1.989103608340703e-01   -8.101541483638683e-02   +4.079698392174782e-01   -3.028983971105516e-01];
L1I_L2I_iGABA_netcon = [+8.066702651768456e-02   +1.289553924747865e-02   -8.699118472473641e-02   -2.481142392222282e-01   +3.027453801279316e-01   +8.161436929635980e-02   +3.833129761527971e-01   -3.868473314033358e-01   +6.025324951420044e-02   +2.280765500091941e-01   +2.799273996999430e-01   -1.623223909531222e-01   +3.509191386223495e-01   +5.566358675119250e-01   -2.077781852476292e-01   +1.842777497059714e-01; +2.491405263091261e-01   -9.094245974874943e-02   -4.769593437206764e-01   +2.022292441398127e-01   +5.810668473236216e-02   -2.101633129909969e-01   -3.404964614812489e-03   +2.730363312205922e-01   +8.655856240788173e-02   -2.722662049488859e-01   -2.725239937853064e-02   +6.155500908473439e-02   -1.850470315619968e-01   +3.269606876909998e-01   -6.028477520839425e-02   -1.951609715391800e-02; -5.932879187476266e-03   +2.464056663788444e-01   +2.254488201435174e-01   -1.374047507366363e-02   +3.040009264442679e-02   +1.850438086717094e-01   +7.958476125844374e-02   +3.426371677303508e-02   +7.668140385223965e-02   -5.132840383564649e-01   +9.333262630257377e-02   +2.534554837197589e-01   -4.280244759833222e-01   +4.120743856964400e-02   -2.616976481398248e-03   -8.274635784366952e-02; -4.463563819106314e-03   +3.018845201105841e-01   -1.505753024304679e-01   -2.146949567206030e-01   -2.498076383892588e-02   +2.805452561220255e-01   +2.578624344940394e-02   -2.550208722620615e-01   -2.387349060480481e-01   +3.340274753439613e-01   -2.105469488238042e-01   +1.437715958753298e-01   -2.761194871857204e-01   +9.274499238383130e-02   -1.455517615120666e-01   -4.528159960487696e-02; +1.178224783222735e-01   -7.597342358912391e-02   -2.371779003725263e-02   +1.540236010443964e-01   -2.029625378453566e-02   -2.265235540271661e-01   -3.674747259506160e-01   +1.764811061568984e-01   +1.149427110279685e-01   -4.040563801624822e-01   +3.989527847067528e-01   -1.578480549976629e-01   -1.999403713778372e-02   +4.640624577945976e-02   +2.026025492303127e-01   -8.006608678138424e-02; -8.624813171348036e-02   -3.284236168876479e-01   -4.332326038144627e-01   +5.922017595337428e-02   +1.779839502349763e-01   -1.107983849821952e-01   +3.234855392820972e-01   -5.605588388916551e-02   -1.323930492998265e-01   +1.509016524658339e-01   +2.058545913818872e-01   +9.644294606599990e-03   +2.097216622166612e-01   -6.001701272065339e-02   -1.725474760469008e-01   -2.042915687783153e-01; +1.145231644140204e-01   -3.392267859803218e-02   -5.221220333796651e-02   +8.951877359315072e-02   +2.590094749073612e-01   +2.681430558991083e-01   +2.034622844964773e-01   +1.168719161559826e-01   +3.029550484448620e-01   +2.601101280333585e-01   +1.117242428487882e-01   -1.062593606792811e-01   +2.860708282939059e-01   +1.593426081320570e-02   -3.877362346098986e-02   +2.738120436125248e-01; -2.605838117932869e-01   -3.800301637393280e-02   +2.396944717245918e-01   +3.045592549347355e-01   +1.297590572056642e-01   -3.734131597195798e-03   +1.721509438998368e-01   -2.474277887614629e-01   -9.711615038011882e-02   +1.600961463444547e-01   +1.562805202556136e-01   -2.798216192986935e-02   -3.549748695962855e-01   +1.021391581510565e-01   +6.437028478812402e-02   -1.705196211656478e-01];
L2E_L1E_iAMPA_netcon = [+2.105713718583885e-01   -7.909139063611673e-02   -2.628947891819335e-01   -1.353089803514637e-01   +4.490893440824892e-01   +1.560628684087201e-01   -3.243106141445168e-01   +1.956174007790868e-01; -6.950202724998315e-02   -7.297096951480697e-02   -1.655021508936576e-01   +1.857473346171725e-01   -2.640589475078040e-02   -3.406841487369042e-01   -1.173395496158071e-01   -7.440341416444769e-02; +3.778646777371946e-01   -1.063293053517966e-01   -1.661410144837393e-01   +6.249236715593880e-02   -5.208718600524048e-02   +2.135737274680003e-01   +3.143207025057767e-01   -1.582112919022904e-02; +9.147002353473278e-02   -1.955974906287455e-01   +5.703800561390041e-03   -1.083162455441048e-01   -1.046593164698382e-01   +1.651554345979908e-01   -2.661201244538494e-01   -1.107992057081033e-01; +1.696176300893307e-01   -8.374479817853134e-02   -3.237845765218060e-01   +4.052250662233788e-01   +3.066055991846742e-01   -3.158238550973453e-01   +3.690428578519329e-01   -6.223549961172528e-02; +2.061671055341163e-02   +1.400645353748215e-01   +1.332264993424912e-01   +3.359097092601198e-01   -1.045704231789993e-01   -2.113266121788660e-01   -2.877445959415610e-01   -8.399688689743483e-02; +1.383391008996733e-01   +6.791952710709148e-02   -1.505437344936007e-02   +1.750739227974820e-01   -3.438711227787622e-02   -1.866526619284068e-01   +2.581853303685628e-01   +1.676628964237314e-01; -4.167074875651552e-02   +2.790146207306301e-01   +9.641316852280465e-02   +1.236217519222502e-01   -7.876226760677787e-02   -1.699573755646928e-01   -2.776272923365282e-01   -4.128797185243584e-02; +1.120056220690539e-01   +1.308340892538713e-01   +4.430532714143957e-01   -3.639944003686413e-01   -5.250083095545668e-02   -3.303164941901112e-01   +9.659902661436937e-02   -2.278256366235276e-01; -1.048484611641950e-01   -5.363474653386449e-03   +1.850147127966311e-01   -1.676391733085393e-01   -2.830981206162239e-01   +4.964973442817729e-02   -1.502223308711161e-01   -1.467666033910567e-01; +4.023640475721041e-02   +1.592170334851170e-01   +1.563276464002618e-01   -4.442711382171982e-01   -5.927284042037516e-02   +2.069164492366696e-02   +2.198621871585611e-01   +9.757625360502468e-02; -1.411239213521737e-02   +1.986736987092181e-01   +1.649330255489553e-02   +2.201579610361893e-01   -5.269620832678807e-01   +2.663537682975264e-02   +2.050550788021255e-01   +6.863759597724357e-02; +2.479691323149142e-01   +2.667837546731915e-01   +2.761294996896513e-01   -7.866509328966417e-02   +2.882765070789843e-02   +2.511220557306018e-01   +1.080580915008422e-02   -2.589054344113360e-01; +3.195434755956373e-01   +8.958409285248642e-02   -4.658092694991112e-02   +1.146218140279022e-01   -2.783431101914077e-01   +4.691437395678806e-01   -3.517009380274486e-01   -3.730429463204782e-02; +4.811835547951299e-02   +1.462190477328575e-01   -2.589060460527103e-02   -2.197772904236355e-01   +5.152768253863320e-01   +3.205730096258937e-01   +4.029350503148001e-02   +1.357950671053715e-01; -8.726284378572730e-03   -3.402742124271861e-01   +2.707089947842996e-01   +8.052924003822653e-02   -4.149416198244604e-01   +2.475826742773466e-01   +3.059685023291380e-01   +6.530781751567873e-02];
L1E_L2E_iAMPA_netcon = [-1.363827579125440e-01   +2.045343804866019e-01   -1.651354949664158e-01   -2.298498348825681e-01   -4.933549714769822e-02   -9.444607037043071e-03   -1.368358978600843e-01   -2.181778037768582e-02   -1.532407770220917e-01   -1.171628462015714e-01   +3.859731802089701e-01   +3.782873664457915e-02   +3.877390476960105e-03   -2.567995725543026e-01   +2.110764884409035e-01   -2.139540013338663e-01; -1.360366709475954e-01   +1.518982487686731e-01   +2.541401931922073e-01   -4.084071508500717e-01   -2.120463256746075e-01   +4.679018659492801e-01   +2.396639996587334e-01   -1.286973549682981e-01   +9.826247397913952e-02   +4.429229820784433e-01   -8.325524982826600e-02   +1.944725010751033e-01   +1.170466564727443e-01   -1.963597468670323e-01   +1.104135234505937e-01   -4.384570520057011e-01; -2.934630570331938e-01   -1.687750552482614e-01   -9.442221358468589e-02   +2.770953579537450e-01   +2.680244438147653e-01   -1.051622531387018e-02   +8.377544583876045e-03   -4.444871781532144e-01   +3.545925100618628e-01   -3.530814256838764e-02   -1.787741489627709e-01   +1.080846830927769e-01   -2.018847987540619e-01   -1.631214164235620e-01   +1.986223506081709e-01   +3.061834207221295e-01; +1.827724991576198e-01   +2.026109998821443e-01   +5.796353137412542e-01   +3.428155810785966e-02   +1.238529980973086e-01   +1.014725230897635e-01   +6.863820747577370e-02   -2.993329601512374e-01   -6.193980252678890e-02   -1.285035779280451e-01   -1.585905749212718e-03   +1.103523544250539e-01   +4.495065990224377e-02   -3.348990051001143e-01   +2.103874420267418e-01   -4.816513152629820e-03; -6.921416174622598e-02   +1.251829649968700e-01   +1.679591328453564e-01   -3.940565773623297e-01   +5.536866679904107e-03   -2.555195094302808e-01   +3.305876420685729e-01   -2.157487923566975e-02   -1.100710849319536e-01   +2.059181964385716e-01   -7.953346996494247e-02   +1.690352930062186e-01   -2.037221813120213e-01   +3.475398211035929e-01   +9.437785146642472e-02   +1.501761872879162e-01; +1.426599270897114e-01   +8.763477254133370e-02   -3.445608101718771e-01   -1.184603240553036e-01   +3.674739366846771e-01   -2.784292749559869e-02   -2.946899531733876e-02   -3.147769494136095e-01   -1.667801732308997e-01   +8.589633431534283e-03   +1.207663776995405e-01   -2.544233100867865e-01   +4.205876453606699e-02   +9.106281006059519e-02   -1.987995966985244e-01   -2.698375718553850e-01; -2.374659446966554e-02   -1.217864276202831e-01   +2.878678395120357e-01   +7.252771618151531e-02   -1.171492123486450e-01   +4.679109722215138e-01   +3.291294122578103e-02   +2.472543934250253e-02   +2.788449576978189e-01   -2.273850003629550e-01   +1.789403499336203e-01   +1.093432981266133e-01   -6.329604955326301e-02   +1.117034235862628e-01   -2.818969651051314e-01   -9.031222882543666e-02; +3.045261146244690e-01   +2.446702173870821e-02   +7.258046451174328e-02   +7.294426768390455e-03   +3.567089627781446e-01   -4.076993786016012e-01   -5.002604801923724e-02   +2.514405373983006e-02   +1.109618893441955e-02   -1.197318000092945e-01   +1.323459841879205e-01   -1.625203162901160e-01   +1.603901130916739e-01   +1.534130079974563e-03   +2.641311397265051e-01   +2.797880778811662e-01];
L2I_L2E_iAMPA_netcon = [+6.309798374046423e-02   +4.463674658543133e-02   +1.921086364945051e-01   +3.438819161225379e-02   -2.827681684000038e-01   +2.117574548895493e-01   +2.277303982261709e-01   +1.124094002022786e-01; +3.029805173852337e-02   -1.344438603953213e-01   -1.990860384117836e-02   +1.279614946002498e-02   -1.252620734386627e-01   +2.479455435773721e-01   +3.589986907089283e-02   -5.193086749824347e-02; -2.704294575538237e-01   +4.981836499254979e-01   -2.977923424718355e-02   +4.238220114185777e-01   +4.716701571653029e-02   +8.612766985760201e-02   +5.920574208494997e-02   -8.920145714995442e-03; +5.290945794276691e-02   -2.038514956781359e-01   +1.118534369916668e-02   +2.144442621610357e-01   -2.996080803516178e-01   +2.895723473601335e-01   +2.715593192327465e-01   -1.445200685397266e-01; -4.316751333072752e-02   +3.244625109160507e-01   -1.672567135572861e-01   +1.183730874164544e-01   -9.525965717548551e-02   -2.313121594524067e-02   +1.963720435038459e-01   -8.084257196050904e-02; -2.721775748117299e-01   +1.047910838645420e-01   +1.564039472829600e-01   -4.713338207901008e-02   -3.224180328195645e-01   +4.559337039762907e-01   -2.168570024539823e-02   -1.908952366550964e-01; +7.743141794763182e-02   +1.956788742361524e-01   -1.734091058413977e-02   -1.967280204990874e-01   +1.029248800565332e-01   -3.477536273400872e-01   +9.458400799179693e-02   +7.786403955106318e-02; +2.857294272198676e-01   -8.616117071960085e-02   +2.237349574079066e-01   +1.222357448694576e-01   -2.954906135621372e-01   +3.691976140198219e-01   +2.629345750207708e-01   -1.199452633320635e-01];
L2E_L2I_iGABA_netcon = [+2.677137914995112e-02   -1.623655292219689e-01   -7.969965413441489e-02   -1.400534425369824e-01   +1.544683422365350e-01   +1.144986445961187e-01   +5.158710044072596e-01   -2.579354402452934e-01; +5.025916290035439e-01   -2.615912233072576e-01   +2.281589065953361e-01   -1.085272032234647e-01   -8.740630878055271e-02   -7.820167734506150e-02   -2.694794864740589e-02   +1.739821409563405e-01; -3.674720303802038e-01   +5.357101899053558e-02   +8.723678470022589e-04   +3.754738163307826e-01   -1.000629938636159e-02   +2.271630117201838e-01   -5.802486981061943e-02   +1.473303102453430e-03; +4.256795707974210e-01   +1.156885571690170e-01   +4.509038634090091e-02   -4.145896242159652e-01   +1.856888011443005e-01   +5.645774592485243e-02   -1.382480802185062e-01   +1.104141714838616e-01; +2.041846344188997e-01   +8.012352466572480e-02   +1.197720117214224e-01   +3.525654050900291e-02   -3.091870047945464e-03   -9.623853980542588e-02   +6.053429616459515e-01   +2.027665267913170e-01; +1.192697358393258e-01   -3.580177640461041e-02   -7.055736611001032e-02   -2.737267747554294e-01   -2.680439550107334e-01   +3.396302330198233e-01   -5.594333769849977e-02   +8.978068561421663e-02; +3.358829978815072e-01   -1.764124679734813e-02   +4.768700293186487e-01   +8.294399124193254e-02   -9.276619050479293e-02   -9.676981128845763e-02   -1.286382754012351e-01   +4.943312031301308e-02; +3.209825364131447e-02   +7.203820974840625e-02   -1.354493950757038e-02   +7.899406276149878e-02   -1.021526963962127e-01   -1.240232702957102e-01   +2.755520894645879e-01   +2.304022228460871e-01];
L3E_L2E_iAMPA_netcon = [-2.256776566767042e-01   -8.226771564889060e-02   +1.997082943787073e-01   +4.298843316997433e-02   -1.132980040665572e-01   +3.589755155685491e-01   +1.292289145466936e-01   +3.668433004615252e-01   +2.174702572554634e-01   +3.705517689339361e-01   +1.851983854926734e-01   +3.167564892479502e-02; +7.519716435326239e-02   -1.129847848863913e-01   +3.460434963794784e-01   -4.554175739164998e-02   -8.375652717981666e-02   -1.093302704951047e-01   -1.605242166671577e-02   -1.234638492388318e-01   -2.321486408436869e-01   +1.219649814209906e-01   +4.500133693509580e-01   -1.825180697701121e-02; +2.077909801264892e-02   -8.781342475505712e-02   +1.162236540095530e-01   +3.852220080795603e-01   -6.112229359310547e-02   -4.440358253057299e-01   -2.081995819904119e-02   +5.061618231364667e-02   -6.214814040718583e-02   +2.219867482177288e-01   -1.273792030426148e-01   -1.747743068383945e-01; +3.743793954569695e-01   +2.689853987798488e-01   -1.771711224997895e-01   +1.985935941502304e-01   -1.422974936595348e-01   +5.470510539286133e-02   +3.233690542324622e-01   -2.048793684121940e-01   -2.756909253520596e-01   -3.053103730055524e-01   -2.968228360730346e-01   -1.669448453294571e-02; +2.313092877257850e-01   -1.994588767152277e-01   +1.290670799342555e-01   -1.886061780575453e-01   -2.848768928474171e-01   +2.186466399969581e-01   -3.097216301983410e-02   +1.953969865415046e-01   -1.550782205473082e-01   -8.014191414770896e-02   +3.842315844920285e-01   +4.646561669853076e-02; -1.705353666765429e-01   -9.107970610079483e-02   +5.839927437815695e-02   +2.761231114895586e-02   -3.283898561631381e-02   +4.336315185774033e-01   +3.254701393606568e-01   +3.405333017301904e-01   -2.785593911553275e-01   -2.098492729912679e-02   +4.568689702934753e-02   +1.709665638168293e-01; +2.099043879220746e-01   -4.315457808370010e-02   +1.953156472293648e-01   -7.903129790364338e-02   -3.764914627307966e-02   -2.029514203491443e-01   +2.421209793969232e-02   -1.532940346926199e-01   +4.186469868206552e-01   -4.347552741205987e-02   -1.074796687798896e-01   -4.235379145231579e-01; +1.614265346339014e-01   +5.028412817680943e-02   +3.941935987142414e-02   -9.214634553453616e-02   -1.431989258389695e-01   +2.186368145852212e-01   -1.302240587012692e-01   +2.409884247057711e-02   +2.424840522466480e-01   +2.017881389800329e-01   +8.213191651180618e-03   +7.373925414819099e-02];
L3I_L2I_iGABA_netcon = [-1.120568666478205e-01   +4.344743031684255e-01   -3.516881957205543e-02   -9.910179819802536e-02   -1.126365550642577e-01   +2.343754319752508e-01   -2.650500830996987e-01   +9.857129170270240e-02   +2.480190603143801e-02   +1.764757171817189e-01   +1.258776747921649e-01   -1.855261763560209e-02; -5.079817495344980e-01   -3.223557235988210e-01   +8.767145574948319e-02   +2.010853038302894e-01   -1.567712666631776e-01   -1.001498600537182e-01   +5.686682833000084e-02   -5.145836629241454e-02   +3.451704809668979e-01   -3.367610834704203e-01   +1.511432257270989e-01   +2.323801972354319e-01; +3.231088367283884e-01   -2.083415167083226e-01   -2.243496258140545e-01   -1.573966682757061e-01   -5.066027703578124e-01   -3.926128555231143e-02   -2.440019987219992e-01   +8.636145339936105e-03   -9.870712037152711e-02   +5.267008626659075e-02   -4.520217572047962e-01   -1.435345879977999e-01; +5.192750666482927e-01   -1.275603197070362e-01   -8.210870675356759e-02   +6.479420000779162e-02   +6.791324919935574e-02   +2.784109362987467e-01   +1.508481308397244e-02   +3.122683631808370e-01   +1.844260207243427e-01   +3.380948816626859e-02   -7.405152121179662e-02   +3.846666199741073e-01; +3.465859577743940e-01   -1.458752741475773e-01   +1.054289576419364e-02   +5.116659676822211e-02   +2.799519397386384e-01   -9.619531120058175e-02   +1.545083247762434e-01   -2.761510979883381e-01   +1.304609494226204e-01   +2.170065164698532e-01   +1.684030251809480e-01   +2.713035932297628e-01; +7.859543611122316e-03   +6.756419533936353e-03   -1.250547312999280e-01   -5.314690845050120e-02   +4.023241083244154e-01   -1.006624776349944e-01   -2.855969830825245e-01   -6.086389534959114e-01   -6.663768327667560e-02   -9.592843930014174e-02   +2.141709973697799e-01   +6.500118552339758e-02; +2.340140473222241e-01   +9.402098248621518e-02   +9.757802300539996e-02   -4.091922616805870e-01   +2.637713381033878e-01   -1.561351989303740e-01   -2.354205745341888e-01   -1.647271596988735e-01   -2.185366202849201e-02   -3.554982412929778e-01   -9.502399973444246e-02   +1.117472645449321e-01; +3.090404851290593e-01   +1.551229232936880e-01   -2.049118694617941e-01   +7.682926781465163e-02   -2.779051757972080e-01   -5.155333292838267e-02   +9.194992478476406e-02   -6.611293772818472e-02   -1.439053755910383e-01   +2.001129351481922e-01   +3.851196392662387e-02   -3.324032382525168e-02];
L2E_L3E_iAMPA_netcon = [-2.321792934017868e-01   +8.496825898700322e-04   -5.144349351494001e-02   +3.467636035043529e-01   +3.274638638126208e-01   +4.258649016896539e-01   -2.309143907139579e-01   -3.571417836998800e-01; +2.349347904923310e-01   +2.078197872418194e-01   +1.272321678512011e-01   -2.073537205224988e-01   +1.616185314284164e-01   +3.046753172085310e-01   -1.237932166370988e-02   +5.698438417990881e-02; +2.258735208146920e-01   +3.907829937976432e-01   -1.790371213661880e-01   +1.860059729156643e-01   +1.819612132708474e-01   +9.192238878408107e-02   +2.331155199731727e-01   -7.040669896217978e-02; -3.878154907255136e-01   -2.107200984537798e-01   +2.114822078608344e-02   -1.906073311888660e-01   -3.789249703222052e-02   +1.411618336108058e-01   +2.201201863670131e-01   +8.583806773741776e-02; -1.640879404897342e-01   +1.778709700375531e-01   -1.833050172561894e-01   -3.915929499738397e-01   -1.617955989774640e-01   +2.447615490968880e-01   +9.463166531442600e-02   +3.422804555308502e-03; +2.148696213584290e-01   +9.332219982008841e-02   +8.002549236344218e-02   +5.305559638355566e-02   +4.415313668623330e-01   -2.428803584951253e-01   +9.378798521807719e-02   -2.157237714904696e-01; +1.810092694728045e-01   +1.654290513854600e-01   +2.242755921208277e-02   +1.692453931482791e-01   +2.194937732986018e-01   -8.638598616415316e-02   -8.428987518239156e-02   +6.140140394026740e-02; -2.234972929992510e-01   +5.320102179581820e-01   +5.307124354249161e-02   +2.594767064746707e-01   +1.054652398771246e-01   +8.377855440448867e-02   -6.610149056094047e-02   -5.010164646275833e-02; -5.210086472270934e-02   -4.177073909201411e-02   +2.751579712386086e-02   -2.251509042605950e-01   -8.828152008772708e-02   -2.970674885918808e-01   -1.586998723652592e-01   +2.554824815179434e-01; +3.964089857377645e-01   +5.237376292117107e-02   -3.883758710875741e-02   +3.929846844752928e-01   +5.563917604002012e-02   -9.953221726718021e-02   +2.157776982753032e-02   +4.258065760697698e-01; +1.034538058930865e-01   -4.445801389937699e-02   -2.676268686164598e-01   -2.770743137878111e-01   -3.185368905516259e-02   -1.272526056732579e-01   +4.280083358013183e-02   -1.292322532667733e-01; -5.581753937134969e-01   +2.427775540910713e-01   -3.389796008651255e-01   +3.034235973995036e-01   +1.597009895606929e-01   -5.381911430041794e-01   +2.308453582809192e-01   -5.382144559454062e-01];
L2I_L3I_iGABA_netcon = [+2.602977097174805e-02   -2.887411258816032e-02   -2.415063486160150e-01   +7.272485138932881e-02   +9.432176631287031e-02   -7.442946717837981e-02   -3.272275495588397e-01   -1.171610716913569e-01; +1.456895957545475e-01   -1.900926818935443e-01   -4.373011376414681e-01   -4.044169079196401e-01   +1.062720902550418e-01   +1.887747702402650e-01   +1.235377042646908e-01   -5.797152442669386e-02; +1.023687440191377e-01   +7.180388276503108e-03   +7.839093518592997e-02   +4.870296396253193e-01   -4.854245829737439e-02   -8.358586698454043e-02   +1.960549288091824e-01   -9.129104090623755e-02; -1.399900788620769e-01   -2.117613525331759e-01   -1.665510611679066e-02   +7.966423566502520e-02   -5.327896360023079e-01   +2.142508418414919e-01   -1.060809046669169e-01   +9.545668780051646e-02; +1.272931635174105e-01   -2.249570251147975e-01   -3.886050606674698e-01   +1.570316541081052e-01   +3.535731284342409e-01   -3.279296954336288e-02   -2.457960581748211e-01   +1.220275717061920e-01; +3.969932294653837e-01   +1.603143564195136e-01   -1.083778867565626e-01   -2.726470389482938e-01   -3.984273641531721e-03   +5.581231696344857e-01   +4.421164408493317e-01   -2.545368621372714e-01; -1.262136650867298e-01   -1.927533962725397e-02   -3.533558236893423e-01   -2.406813197883552e-01   -1.085435859361722e-01   -3.399820407083520e-02   +1.111452578491731e-01   -3.788987291663191e-01; -2.426870061263617e-01   +1.537182716317610e-01   -1.003057501778531e-01   +2.292796541469992e-01   -1.541081270325677e-01   -7.110392442595019e-02   +1.267918725527893e-01   +1.100882618799175e-01; +8.429908018710101e-02   +5.189321133111360e-01   -1.119423628723148e-01   -3.903334432527730e-02   +4.371818449812644e-02   +3.690817289910266e-01   +1.769505386130283e-01   -9.206225244729185e-02; +2.755135111367746e-01   +3.734867792125515e-01   -1.386232462873300e-01   -1.964361323293002e-01   -8.345732475290235e-02   -4.887726005675389e-02   -2.619835290959516e-01   -2.846145635330388e-02; +8.649074725030156e-02   -2.337303029224261e-02   -3.132098276868786e-01   +7.308100369217798e-03   -3.330236371235233e-01   +3.163573744117326e-02   +1.634560650420689e-01   +2.142334803349767e-01; -1.377336840417709e-01   +1.548777871481435e-01   -1.829625978504156e-01   +2.380571226957134e-01   -4.682825971254444e-01   +4.129392677475174e-02   -1.416433543158062e-01   -1.877358263197602e-01];
L3I_L3E_iAMPA_netcon = [+2.029756299072024e-01   -2.216822128722440e-01   -2.845986822793731e-01   +2.495702706986060e-01   +1.593402675169144e-01   +2.851722996348215e-01   +3.273840021755580e-01   +4.182094262648033e-01   -7.651685811267041e-02   +1.171584072778949e-01   +1.429726869717396e-01   -1.556724142362700e-01; +1.105617527384883e-01   -1.735761766604515e-01   +6.200759164735939e-02   -3.109485930862822e-01   -1.086950751892877e-01   +2.070908351974471e-01   +1.803383054407936e-01   +4.652411582240507e-01   -3.444601664800480e-01   +3.300545462393575e-01   -2.680611239024596e-02   +1.436154996443970e-01; +2.093955920131667e-02   -2.898998257735746e-01   +1.446252699407616e-01   +1.882736984437648e-01   +9.322437380718898e-02   +1.178601585194086e-01   +8.422201075647225e-03   +1.446452993914394e-01   -2.261264494389310e-01   +1.954465127963550e-01   -4.402527952589383e-02   +3.115776172280317e-01; -1.876477731486216e-01   -3.227785525524136e-01   -3.925628774997043e-01   +2.590321698514075e-01   +4.825159303460390e-01   -1.036823530312581e-02   +3.702372550668095e-01   +1.215933031470012e-01   +6.143703875983898e-02   -3.300669465845989e-01   +1.664304057350557e-02   +2.736771189188653e-01; +1.181701443405850e-02   +2.645259590627062e-01   -1.321449387256803e-01   +2.183607459685266e-01   -1.527840524701507e-02   -1.769841570375568e-01   +3.751796389530560e-01   +3.090631644583577e-01   +3.581021816221409e-01   +1.102809797399202e-01   -5.515972997348737e-01   +6.289262233811835e-03; -3.230399491160892e-02   +2.744515943346909e-02   +8.607504389816278e-02   +9.376327907036913e-02   -1.868637141056542e-01   -2.320799161753125e-01   +9.650638323059441e-02   +2.499745114231905e-01   -2.732183739143025e-02   +6.605567571514959e-01   -3.169830662559708e-01   +1.587426955375962e-01; +1.063077983235058e-01   +2.320515940928947e-01   -2.891326974626235e-01   -6.139174703369204e-03   -1.812368015636214e-01   +4.651987719222361e-02   -9.841312854891227e-02   -1.352350325055369e-01   +2.567614967330658e-01   +3.767692994365942e-01   +2.166116519356859e-03   +2.809019064720546e-01; +6.844185256208252e-02   -2.819639668351052e-01   +3.164152875596800e-01   -1.185927281556020e-01   +1.579027853099388e-01   -1.972739113483682e-03   -1.036467790342743e-02   +3.593270000879274e-01   -1.687663218309990e-01   -2.211702869076438e-01   +1.927995516063263e-03   +2.427319795008452e-01; +1.653124423377526e-01   -1.742377438870408e-02   +8.879521881081337e-02   -5.152677778801568e-02   -1.202230330623906e-01   -1.790458018032441e-01   +2.878396669469143e-01   -9.430428298240534e-03   +2.059798378611412e-02   -3.391423692424420e-02   +1.171103444957332e-01   +3.767022651266475e-02; +6.683103450079089e-02   -2.969803591933651e-01   +3.239959441035516e-02   -2.801820768519969e-01   +3.792360972208775e-01   +3.281671557190216e-01   +8.758390532174651e-02   +1.586787115740728e-01   -1.787349289268515e-01   +2.140822027626674e-01   -1.967078176521298e-01   +2.018667161558231e-01; -2.019338829357453e-01   +1.778075798164926e-02   -8.289909309845563e-02   +4.284512523520893e-02   +5.104854864837208e-02   -9.701841790425440e-02   +6.113389733647567e-02   -1.597969854415562e-01   +7.173731831254838e-02   -1.172822984330409e-01   -4.189129839040176e-02   +1.450866050816444e-01; +1.910890899869567e-01   -1.393829187015542e-01   -9.536696420898964e-02   +1.955358084916438e-01   +3.160691897387465e-01   -1.718814062936159e-01   +3.303963800971083e-01   -5.191690390813647e-01   -1.484474021746473e-01   -2.448921348094684e-01   -2.807367283991873e-01   +9.048876796290563e-02];
L3E_L3I_iGABA_netcon = [+8.911033203352182e-02   -7.992163990980017e-02   +9.911837267855110e-02   -4.402753771881343e-02   +3.375954202512561e-01   -1.400890938638735e-01   +2.549044532595490e-01   -8.404489373208748e-02   +5.432822393174245e-01   +5.043612015621665e-01   +2.433803778799908e-01   -2.812588826064238e-02; +1.566076064603872e-02   -4.789070235485990e-01   +6.425906537981092e-02   +1.546990061177408e-01   -4.889940687543359e-02   -2.856892988880139e-01   +2.052405944684582e-01   +1.422022115957680e-01   +1.465905002865720e-01   +2.568000781190619e-01   -1.268143314162817e-01   -1.037142543956839e-01; +2.567211618734885e-01   +9.340127541159839e-02   -2.154907903931997e-01   -2.761138559997381e-01   +1.664076461974784e-01   +2.397887724447871e-01   -4.518522845836776e-03   -6.793397071861546e-02   -2.370840995402211e-01   +5.745286331722107e-01   +1.682001243642091e-01   -2.409438529810825e-01; +5.805259844134984e-02   -1.575770418897588e-01   +6.527414535875220e-02   -1.269368880458125e-01   -7.438543469651900e-02   -7.465132762392053e-02   +3.659923869589514e-01   +1.050586379388470e-01   -3.847409970824884e-01   +1.550961826076827e-01   +1.992015384446693e-01   +3.115746602146434e-01; +2.555103097619992e-01   -2.559501324948696e-01   -9.434907333782862e-03   -1.742937608315933e-01   +1.694521777140688e-01   -2.830872241741408e-01   +2.491768221277528e-02   +1.442472531392154e-01   -7.625181560618711e-02   -8.073189864715236e-02   -2.465062521301967e-01   -2.863551032381175e-02; -3.106459178301955e-02   -2.154684739800984e-01   -2.249433160487992e-01   -1.267297071811407e-01   -3.436652724421395e-01   +1.739024334969630e-01   -7.933641889149390e-02   -1.914604381624809e-01   +2.486797562151629e-01   +8.044886542767012e-02   +9.664609771232974e-02   -4.089495952877005e-01; +8.280251426489510e-02   +3.655084677521244e-02   -4.784279445732592e-03   +7.570200677377928e-02   +2.508581006333575e-01   +8.571877981360036e-02   -9.031391866922500e-02   -5.545656095207645e-02   +2.084301319457378e-02   +4.413110650295879e-01   +4.294971411691771e-01   +4.298824115858964e-02; +1.343937839612367e-01   -1.699165978885216e-01   +2.723375677664392e-01   -9.476546554897503e-02   +2.631204532769377e-01   -3.409016695219668e-02   +1.394893462018466e-02   +1.069203280241567e-02   +2.417749297258771e-01   -3.458802679531209e-01   -1.202181006847475e-01   -1.562838524215733e-01; -1.674883038804761e-01   -1.443414671130428e-01   -2.732921309228279e-01   -1.069018784943063e-01   -1.583102985395852e-01   +3.693785050986732e-02   +2.038869441599010e-01   -2.319204846815416e-01   -9.782932626272765e-02   -1.510370194391489e-01   +4.349746851052447e-01   +2.015785455708557e-01; -4.166928800745083e-01   -6.555408977818858e-02   +5.016915520677009e-02   +6.150562054387093e-02   +1.880949947579658e-01   -1.044936183288577e-01   -1.572231062636174e-01   -1.501261951021208e-01   -3.919293715799359e-02   +3.786640985289738e-02   +2.915768966493776e-01   +1.751739798062798e-01; +3.901674808837237e-01   -3.795296501989663e-01   +1.091267063468922e-01   +3.291407727775367e-02   +2.265784187160102e-01   +4.093045565542734e-01   +1.926364835609028e-01   -9.682842669250732e-02   -9.006105777433572e-02   -8.396447880345242e-02   -2.998581225144362e-02   +3.264782848934324e-01; +4.187074873505325e-02   +1.523914522975772e-01   -3.571633313618116e-01   -2.075956176354957e-01   -1.396373119286918e-01   +2.967388912600017e-01   +3.034187353336049e-03   -1.491748692369667e-01   +1.833205110528068e-01   -2.313088877785982e-01   +1.040747324326383e-01   -9.203568953259160e-02];
L2E_Input1_iAMPA_netcon = [-1.067608049167683e-01   -2.381109552226893e-01   +2.704111939383606e-02   +3.121490931586859e-01   -8.488144095270359e-02   -1.311871862281324e-01   +1.072192760380670e-01   -1.331160214231559e-01];
L2I_Input2_iAMPA_netcon = [+3.224463785409839e-02   +1.980433686181926e-02   -1.222835423309221e-01   -1.983118715481388e-01   +2.278929550777476e-01   +8.851108056759349e-02   -2.070590289325914e-01   +3.961163881664979e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
