function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.975909985336550e-01   +4.174666554446585e-01   +5.430679601149250e-02   +5.164450661880429e-01   +3.713245860914263e-01   +1.115803558042778e-01   +1.688268728143443e-01   +6.806415290331117e-01   +3.826290398024680e-01   +3.190837206222583e-01   +2.745311895084624e-01   +3.561000321433805e-01   +3.661817274329607e-01   -4.511966618050633e-02   -2.422613071249272e-01   +2.355363924152418e-01; +8.957751158864026e-01   +2.273917748052423e-01   +6.970495377363699e-01   +1.536953421830592e-01   +1.834467824739544e-01   -2.043906265888092e-02   +1.820221191319882e-01   +1.646150411732368e-01   +4.523596217165938e-01   +4.847408652161846e-01   +2.878379255939900e-01   +4.056703578625856e-01   +6.859964035684227e-01   +6.333049273891640e-01   +3.488751470134264e-01   +9.130677405565414e-02; +2.351442278859422e-01   +2.318251538898689e-01   +3.467404735219352e-01   +1.664054754055379e-01   +4.868854046028848e-01   +2.526462582956274e-01   +6.944223302493395e-02   +6.801435912319368e-01   +3.230934219734883e-01   +3.862898679213325e-01   +7.548275668247686e-01   +5.377565681799039e-01   +7.333399506391036e-01   +6.661647725523028e-01   +3.320964923220172e-01   +5.554119696906785e-01; +4.799861720991486e-01   +5.827421117717420e-02   +4.322503528609613e-01   +9.975880133312339e-01   +5.072172790769812e-01   +7.215732458460262e-01   +3.791302764774097e-01   +4.356601848530406e-01   +8.141757930341764e-02   +2.718220219448273e-02   +4.691331159389607e-01   +3.156213042645132e-01   +1.404249604566904e-02   +2.902408067574320e-01   +4.823645491704034e-01   +2.188358084076669e-01; +4.492207586938436e-01   +4.671500731411121e-01   +3.396195082395124e-01   +2.141822989159503e-01   +9.831299228076701e-02   +6.758410005825705e-01   +2.079896845428160e-02   +2.118271840302131e-01   +3.544737693563406e-01   +6.130814527152180e-01   +4.139332746182265e-01   +2.822003075978921e-01   +6.159785245830367e-01   +3.858413622962298e-01   +7.539555123495466e-01   -5.247106465759764e-02; +1.254918412977403e-01   +8.610524665030404e-02   +5.525446555977117e-01   +2.548062713193756e-01   +4.928974574470544e-01   +2.028311795126559e-01   +4.208312542262056e-01   +9.110011872305554e-02   +1.642498746415167e-02   +3.639508721942597e-02   +4.541631524038651e-01   +5.828288403120796e-01   +3.045778130714779e-01   +5.610502542459276e-01   +6.688606659193490e-01   +2.033029424076991e-01; +1.335165303937755e-01   +5.107634998100145e-01   +1.087695481188437e-01   +3.346901984626581e-01   -6.541473843076845e-03   +3.435937124926984e-01   +5.013950256359337e-01   +4.700534259281797e-01   +5.533100605068726e-01   +4.412281772533267e-01   +6.420358862391599e-01   +5.249736391915182e-01   +1.346246762738647e-01   +3.546415593290736e-02   +1.744353512864869e-01   +1.872405272296171e-01; +1.750874309683162e-01   +4.280371570219337e-01   -1.677323510217934e-02   +7.240237068793793e-01   +5.180787889572415e-01   +2.745018611995818e-01   +1.009273891952528e-01   +1.980865259962454e-01   +4.639671738928995e-01   +2.622457635643041e-01   +5.683006847684886e-01   +6.725014722685639e-01   +4.092806965684208e-01   +1.482552153902790e-01   +6.302184602781730e-01   -5.170560552332507e-02; +2.518407993400683e-01   +4.546748410099443e-01   +1.411747493032093e-01   -2.008165053478268e-01   -1.561747237326777e-02   +5.881615114765840e-01   +3.365605964534605e-01   -3.515807405051519e-02   +3.232390550385433e-01   +1.534021597430396e-01   +4.439567563470908e-01   +1.802176756763630e-01   +4.944807380133250e-01   +5.905792097786405e-01   -5.505816937639339e-02   +5.073368428028920e-01; +4.067040218522274e-01   +1.927055600558865e-01   +7.371496845406945e-01   +6.886185389444417e-01   +7.744852544876829e-02   +5.397307406247873e-01   +1.399709154839910e-01   +6.616096629705556e-01   +4.013506736252499e-01   +5.450456415732652e-01   +8.534461964090098e-02   +7.111833501186056e-01   +5.106540407464337e-01   +4.481831138856912e-01   +2.373481601027545e-01   +1.666346926059962e-01; +1.541515202576854e-01   +8.241566847262773e-01   +5.748312559084375e-01   +1.801073478434348e-01   +6.910126673280731e-01   +5.549524450731680e-01   +8.903674531971095e-02   +3.858601680001978e-01   -1.812656445210430e-01   +7.585320164767509e-01   -2.821978872185476e-02   +4.906716859747656e-01   +5.190432530449163e-01   +1.635030057625862e-01   +4.239297017559482e-01   -1.094158447538451e-01; +1.315651741931022e-01   +2.974871495513055e-01   +6.785781135709762e-01   +9.872509498250421e-01   +1.582090119343312e-01   +6.007196395130687e-01   +2.356822425100503e-01   +1.223373039618092e-01   +2.696405089951872e-01   +1.016464266431345e-01   +7.563554677781412e-01   +2.633181719502684e-01   +1.928463611128871e-01   +1.586468468332356e-01   +3.136117604590415e-01   +4.581664799337387e-01; +5.025797544252437e-01   +6.087492771233501e-01   +5.820574311501145e-01   +5.673965956447335e-01   +3.606026408742207e-01   +6.386527647803623e-01   +6.714667320094400e-01   +3.463795284619259e-01   +3.108344609286160e-01   +3.629478367048642e-01   +3.603357940921145e-01   +5.680493490906567e-01   +3.429133046238788e-01   +3.982310343690225e-01   +6.558807036842718e-01   +2.352441973394905e-01; +5.450632885528435e-01   +7.896393751659126e-01   +3.672964365178003e-01   +4.462994314030307e-01   +5.213488419467502e-01   -1.605262755975069e-01   +4.053505940005095e-01   -6.178942178118489e-02   +4.124288717238606e-01   +4.250475033843069e-01   +2.002762095933706e-01   +1.803160340816483e-02   +4.894754764762212e-01   +4.263154211294868e-01   +1.986721300457658e-01   +5.228683968899610e-01; +4.946075630458126e-01   +3.406339275623178e-01   +7.075016467115218e-01   -1.171628475610453e-01   +1.046953084787674e-01   +4.080221548145297e-01   +3.170099394807447e-01   +3.630313945915316e-01   +2.135557220014473e-01   +3.155909086656503e-01   +5.473831854702267e-01   -1.118997658025952e-01   +5.956309915000361e-01   +3.352604791892919e-01   +5.696267735631168e-01   +5.324026099889220e-01; +3.345762841060577e-02   +1.168686751820344e-02   +1.172564134314453e-01   +1.931807078069429e-01   +6.113601363677185e-01   +5.763881802502970e-01   +3.364261888515346e-01   +6.735953177322895e-01   +2.141865013003312e-01   +2.689431912804308e-01   +3.568716043446171e-01   +5.928554224178921e-01   +5.649851828288128e-01   +6.433717485264632e-01   +3.607191147640335e-01   +2.223087007257706e-01];
L1E_L1I_iGABA_netcon = [+4.635197976327620e-01   +6.443720564311685e-01   +3.831932748623573e-01   +2.428515285543395e-01   +4.621300879205751e-01   +7.266830915538847e-02   +2.180488405517403e-01   +3.326454710966867e-01   -4.500568214822981e-02   +2.046338927498206e-01   +5.975805029300595e-02   +4.571011405331686e-01   +3.167860697593122e-01   +3.557348991216949e-01   +8.746502850637261e-02   +6.252108015300261e-01; +1.360544662580769e-02   +1.104840217770791e-01   +4.266862304869617e-01   +1.818136399192672e-01   +4.527020414638412e-01   +5.394666742573897e-01   +8.574969499734691e-01   +4.954269471529879e-01   +2.978671288897113e-01   +1.672804642653342e-01   +4.189303682553039e-01   +5.901950389657297e-01   -6.895592872133333e-03   +6.750042044082901e-01   +4.829320582848464e-01   +5.940547783660313e-01; -1.934295578341904e-01   +1.759592471361584e-01   +1.910106650327950e-01   +4.451879534643577e-01   +3.826793515823703e-01   +4.341069774453029e-01   +3.794071708108361e-01   +2.895402777086366e-01   +4.735092585963996e-01   +1.520084273974201e-01   +5.109777688189043e-01   +3.043320626378871e-01   +8.253344818431163e-01   +5.016993051072154e-01   +6.202529846012073e-01   +7.492775172660121e-01; +5.626349140320374e-02   +5.884954793912275e-01   +7.244274249303201e-01   +3.566222141619196e-01   +2.366589874697438e-01   +2.853896992079610e-01   +5.712535273811671e-02   +1.460655126248889e-01   +4.653627078024295e-01   +1.795913812701299e-01   +6.399928820195107e-01   +3.097856837916116e-01   -1.283612873269675e-01   +4.355693249089907e-01   -1.298924778741791e-01   +1.677169409549496e-01; +4.279493521670926e-01   +2.888893846605304e-01   +5.793348061100199e-02   +4.733623287587309e-01   +6.705655046191084e-01   +5.451945206902518e-01   -1.240884922621040e-01   +9.283845572295737e-02   +2.317852017170888e-01   +4.607653613191943e-01   +5.560651564502023e-01   -1.807655489038496e-01   +3.549219234123924e-01   +5.043826735432992e-01   +3.525317672458869e-01   +4.389869141354327e-01; +1.775149719471864e-01   -4.175878067354000e-02   +6.529831830066423e-01   +2.209383316650043e-01   -7.852073296960806e-02   +1.969767372222050e-01   +4.857976004246890e-01   +2.381284821641768e-01   +3.907174722504900e-01   +3.899371618630035e-01   +3.057227459658096e-01   +4.449708680789171e-01   +3.023692175906271e-02   +1.431651075077531e-01   -2.236507614753256e-01   +6.413844830690423e-01; +2.913941614687081e-01   +2.790463874553453e-01   +2.547886024912732e-01   +4.775338098540720e-01   +4.616146890334130e-01   +2.708248059349906e-01   +1.842847437247665e-01   +1.167271540197006e-01   +6.674830964911559e-01   +3.125379855124514e-01   -1.297477285784804e-02   +1.096060254435213e-01   +5.316891447386336e-01   +3.944648851595300e-01   +4.973334360752718e-01   -2.707948028782149e-01; +5.354280433580411e-01   +2.768190183796132e-01   +3.984728635738248e-01   +2.657240420043953e-01   +1.470845582459032e-01   +2.597671711724533e-01   +2.928591366181361e-01   +6.085836968960355e-01   +1.920597052307507e-01   +7.354520517969486e-01   +7.903218625205457e-01   +5.285127912312779e-01   +4.593233506756123e-01   -3.061889993345074e-01   +5.839025794605388e-01   +5.893349232855813e-01; +4.598557524394180e-01   +5.750311175922064e-01   +5.799446716864697e-01   +3.333185578830776e-01   +1.592346878969628e-01   +6.487864862263564e-01   +1.716082969784505e-01   +3.093237525961042e-01   +9.121284060853192e-01   -1.046146334532876e-01   +3.852317882797262e-01   +3.334371543635807e-01   +5.503853907918463e-01   +4.595716969424180e-01   +1.476508775307098e-01   +4.365246653930498e-01; +5.438667949585192e-01   +1.409875929452550e-01   +6.443115917114262e-01   +4.661013679318742e-01   +3.103211271083610e-01   +4.688864196739620e-01   +3.055330961386600e-01   +4.147530564926339e-01   +5.492398437080181e-01   -1.712698320365652e-02   +4.392830383552744e-01   +1.339965405368282e-01   +5.480138568624441e-01   -4.892300917560703e-02   -4.904816642837402e-02   +1.961902582305805e-01; +8.072188561138222e-02   -2.402386374451279e-01   +5.680413214311287e-01   +8.293085621390377e-02   +2.730580174027202e-01   +3.904885142843402e-01   -7.361802863725184e-02   +9.974654409560235e-02   +7.010649411213821e-02   +3.825233960076469e-02   +2.831260963607747e-01   +1.907931059277493e-01   +7.980074182522195e-01   +5.962025679594339e-01   +2.344833927186603e-01   +6.178971816022150e-01; -1.441589550852587e-01   +8.055864871352744e-01   +5.775383572342326e-01   +8.259396080158861e-01   +6.953306693055049e-01   -1.443476193995480e-01   +6.005021222204855e-02   +2.204095744363149e-01   +4.549060258824792e-01   +6.232040654312518e-01   +4.861449104529931e-01   +6.606890990715973e-01   +6.927884621331779e-02   +7.051645977288379e-01   +4.323650887221892e-01   +1.081107847096169e-01; +4.090187492398753e-01   +6.566156228634334e-01   +5.361414469243804e-01   +6.445424631313154e-02   +5.864686878123915e-01   +2.751477101573883e-01   +5.452342919889017e-01   +6.627235063007086e-01   -1.267805983622118e-01   +1.416813797974929e-01   +8.933902888257456e-02   +4.209424447324744e-01   +3.815396522780895e-01   +2.761119341893761e-01   +2.057109946935699e-01   -3.679740278746094e-02; +2.758073957282444e-01   +2.548849923703804e-01   +4.929567948882925e-01   +1.582643399328773e-01   +1.598065716676601e-01   +5.019614064092637e-01   +4.748488960022672e-01   +3.737981439364085e-01   +2.185846961100684e-01   +9.834332202220774e-01   +6.007061805846623e-01   -5.704345178224069e-02   +5.747041817128078e-01   +2.254917645315166e-01   +1.325713623756618e-01   +5.969737991716132e-01; +4.828915085551897e-01   +5.076569192985125e-01   +9.315251023777561e-01   +7.989439693693723e-01   +2.447350618374271e-01   +2.529098041672542e-01   +2.234044689590290e-01   +3.150390297458071e-01   +3.620315279967390e-01   +3.222443896798722e-01   +6.103070474626366e-01   +1.478732164429566e-01   +5.180074615776984e-01   +6.993361676616623e-01   +3.787266115226702e-01   +7.470286145566335e-01; +5.823226589562527e-01   +3.332775406982227e-01   +6.148700546442198e-01   +1.081019185680476e-02   +3.365327999614367e-01   +4.344679000115321e-01   +1.867220088777504e-01   +2.408031640351702e-01   +3.609922720560841e-01   +5.332146588048937e-01   +6.064043129335120e-01   +3.285541767044242e-01   +3.546395754087463e-01   +2.111862352994638e-01   +6.170225648140896e-01   +7.736820464365025e-02];
L2I_L1I_iGABA_netcon = [+3.880683636897078e-01   +5.446998190618133e-01   +5.187407602690186e-01   +9.674011956845168e-01   -7.647702827784732e-02   +3.310415207841219e-01   +3.499276437824321e-02   -7.374522567928016e-02; -1.623325870012802e-01   +2.996983064125178e-01   +3.237262519723155e-01   +5.309048425612544e-01   +3.755820288265650e-01   +3.562832938270022e-02   +7.335259622723371e-02   +2.600408226571430e-01; +9.621932583281095e-02   -1.364740907788816e-01   +7.056292059646128e-01   +5.052161840666876e-01   +3.612399569358449e-01   +6.415565922367375e-02   +3.885019948268529e-01   +7.180419947154885e-01; -1.320315308708065e-01   +4.012611337045458e-01   +1.274581900972331e-01   +6.305862011355655e-01   +4.614337026885985e-01   +3.491430443733885e-01   +4.720868421652372e-02   +4.052831991639406e-01; +6.827679803346598e-01   +5.946500708286133e-01   +3.485782650601340e-01   +3.140957870088133e-01   +2.074428958525606e-01   +7.451844967637437e-01   -1.636799617463779e-01   +6.154924790615736e-01; +1.630817612666753e-01   +3.217661732810738e-01   +3.929536724798595e-01   +8.411404332980088e-01   +3.810231236054412e-01   +4.945334211201134e-01   +6.173733153335150e-01   +4.625015127106739e-01; -1.046848036121567e-02   +4.673431656862991e-01   +6.052071029198259e-01   +9.834155682259954e-01   +2.824234106538516e-01   +6.983866373896326e-01   +3.295898417580976e-01   +3.740539852314167e-01; +6.553273110898830e-01   +3.635947516122742e-02   +5.967481959482723e-01   +9.363600263993078e-02   +4.800849942324507e-01   +2.426812285000107e-02   +3.463619479351707e-01   +5.860660792070808e-01; -6.941855002113126e-02   +2.375238324090631e-01   +3.724754972333303e-01   +3.483205357609580e-01   +7.796083944408898e-01   -5.704129325469594e-02   +3.191338665360324e-01   +3.053080758506863e-01; -6.329532446277061e-02   +6.279824153055976e-01   +3.964216150708592e-01   -7.014364743533817e-02   +4.722850841329679e-01   +5.345215299031265e-01   +6.912004765178299e-01   +5.986097371293360e-01; +4.339184108002342e-01   +1.025174643978120e-01   +2.983793705370515e-01   +4.919021785624614e-01   +5.727851824564099e-01   +4.271870009908638e-01   -4.930330841447046e-02   +6.004375523573774e-01; +4.924852445103284e-01   +3.923824292438603e-01   +7.869358622081468e-01   +2.110217217569834e-01   +6.073194725985266e-01   +9.710671178625921e-02   +3.788696391125569e-01   +8.834470205516377e-01; +3.782837993797976e-01   +2.520949096596380e-01   +5.343783980698686e-01   +6.065955875627087e-01   +3.243745724662824e-01   +5.823184189503070e-01   -1.042351770580124e-01   +6.814596835644751e-01; -7.503639302423841e-02   +5.562589278172660e-01   +5.993385130675110e-01   +5.175734213592333e-01   +2.999677227320653e-01   -7.049504921514607e-02   +1.291890149691737e-01   +4.351342096458324e-01; +1.572147574996665e-01   +3.949921620333416e-01   +5.509284549021171e-01   +1.274881634026673e-01   -2.278467550203767e-02   +6.467786421478963e-01   +6.789087368059400e-01   +6.947586552115758e-01; -2.292119038021486e-01   +2.643788668185110e-01   +2.957252072440740e-01   +6.846449188115793e-01   +1.543895495028320e-01   -1.636728765056720e-03   +4.205360586583834e-02   +4.199307870984507e-01];
L1I_L2I_iGABA_netcon = [-9.744460023411333e-02   +1.071288528500966e-01   +5.581108683552408e-01   +3.685742699598831e-01   +7.516061470433718e-01   +3.727608428658539e-01   +7.023308730830307e-01   +6.661374582830438e-01   +1.718612020972882e-01   +3.427211074454470e-01   +5.592883409551593e-01   +5.872092851002086e-01   +7.489567799016713e-01   +4.004025192818587e-01   +4.992018177242374e-02   +4.825603861766884e-01; +4.413138787899627e-01   +5.612333499806451e-01   +5.923203127268406e-01   +7.246317385207970e-01   -2.032715141467515e-01   +1.589888506581023e-01   +3.343096308793438e-01   +2.874381656759664e-01   +2.232222293783921e-01   +1.960674854738238e-01   +6.475982245159867e-01   +4.038636359829049e-01   +6.968793861519911e-01   +6.896340556114429e-01   +8.661275021062131e-01   +7.447871308071596e-01; +1.544219338284942e-01   +4.867540020137276e-01   +5.867349141108993e-01   +4.694585459132815e-01   +6.000956420334823e-01   +6.041633840599846e-01   +3.717280550948610e-01   +2.616537202887845e-01   +2.311926857523340e-01   +6.005481636786043e-01   +6.216839962387565e-01   +5.518803589958790e-01   +2.831065785004322e-01   +5.613837134715015e-01   +1.708839763769386e-01   -7.778366751160157e-02; +5.102221980583681e-01   +8.552218468916944e-01   +5.146864476723843e-01   +2.462542825337379e-01   +1.638811146183169e-01   +2.889414194333261e-01   +4.867947596678890e-01   +9.716295951103238e-02   +4.375800549682950e-01   +3.903696722206209e-01   +3.653624582740006e-01   +7.386655847417342e-01   +2.122635281031730e-01   +7.567349220108514e-01   +5.310220434017422e-01   +7.262508487504215e-01; +4.878566035515334e-01   +6.246610977646199e-01   +8.354282626019551e-01   +1.932529920213638e-01   +6.541484027818527e-01   +3.960651072617931e-01   +5.109732863475159e-01   +3.772162682995659e-01   -1.824567658666350e-04   +8.223820747510756e-01   +2.649824075365680e-02   +6.714831791148129e-01   -2.497685032651956e-01   +2.013479345453234e-02   +1.525634812743521e-01   +6.167553342577400e-01; -5.826856436177284e-02   +3.902442585179224e-01   +2.479051426031145e-01   +4.752566238532438e-01   +7.862741605540428e-01   +5.399969870173576e-02   +3.030629212447040e-01   +4.257570604287363e-01   +2.675330298123861e-01   +7.914224516439513e-01   +1.637405050159055e-01   +3.245402146077229e-01   +5.860847007623435e-01   +2.536266440285326e-01   +3.959297190825570e-01   +4.435760730066751e-01; +4.736336991855691e-01   +8.792297884993892e-01   +4.176208807913028e-01   +9.005326799378202e-01   -2.919740599251808e-03   +9.943749911924828e-01   -4.628922505443063e-02   +4.721691902142482e-01   +2.792253067808473e-01   -5.858999557355408e-02   +8.320058490763229e-01   +7.842505629785295e-01   +2.954770461968583e-01   +5.242900003181306e-01   +3.793238443520111e-01   +5.243586159248256e-01; +3.302313104226222e-01   +7.363797561426397e-01   +5.375066726815766e-01   +5.573673363593750e-01   -6.455416089791127e-02   +2.263830144476333e-01   +4.943833211381999e-01   +4.186058284463547e-01   +7.590494358562330e-01   +2.297001386009083e-01   +1.766901975036979e-01   +2.499645983846358e-01   +4.185374052672775e-01   +7.093103033742740e-01   +3.881266863153890e-01   +4.437762457454593e-01];
L2E_L1E_iAMPA_netcon = [+5.671740515147181e-01   -1.058276177033916e-01   +7.185467307231529e-02   +5.498263277961131e-01   +3.130905015398646e-01   +6.060013266436214e-01   +1.627023283760125e-01   +4.353707312032424e-01; +3.691762433468105e-01   +4.529573165211502e-01   +4.380556084014972e-01   +8.802884239346289e-01   +4.135836676580367e-01   -3.921893078008747e-02   +3.527763194368242e-01   +2.170904173572669e-01; +3.999571328682309e-01   +2.576669369320627e-01   +3.263897014946204e-01   +6.298374684855605e-01   +1.160260068771416e-01   +1.722460998943757e-01   -7.659505675172864e-03   +4.104816663557331e-01; +1.219100982503813e-01   +1.958256464419111e-01   +5.143748094421327e-01   -7.989669887758616e-02   +4.430049235645426e-01   +4.679451637749337e-01   -6.562348203206255e-03   +1.614105303236592e-01; +1.776026198070172e-01   +1.612197622976812e-01   +9.979700419585924e-02   +7.676809585688722e-01   +6.320054573468351e-01   +4.712659029343331e-01   +2.309173353281800e-01   +5.095417547660692e-01; +5.033181558407491e-01   +5.442035414000224e-01   +1.547161083301017e-01   +5.135481530209222e-01   +2.131281713215784e-01   +3.160614989674787e-01   +9.066524551386233e-02   +9.188748382624333e-02; +6.962761502664743e-01   +2.731745298974184e-01   +1.194603933913504e-01   +6.619196713865880e-01   +2.463267954166653e-01   +1.433687715573777e-01   +3.143451333834046e-01   +3.404548234640529e-01; +9.664857521490938e-02   +3.875110557775462e-01   +4.015007031080571e-01   +2.397462397561892e-01   +1.050991619959044e-01   +1.266885428777751e-01   +1.427383389265890e-02   +2.613159544934747e-01; +6.262700403877579e-01   +5.343963350993395e-01   +3.946350632700020e-01   +3.570537910728075e-01   +3.570810190823611e-01   +2.678111441088197e-01   +5.297074259972050e-02   +5.051320647485180e-01; +9.655937079585782e-02   +2.058201950923473e-01   +3.468364990930003e-01   -5.148468170606137e-02   +2.553511976245039e-01   +4.569376155681341e-01   +5.214093054888458e-01   -3.590865471142428e-03; +8.232422083371047e-02   +6.177363302595119e-01   +8.076262872642124e-01   +4.567936754572427e-02   +5.217845884024784e-01   -2.652192970262323e-02   +9.801428605513030e-01   +3.822500751771128e-01; +7.943247228983196e-01   +2.839981119013743e-01   +4.431489349435195e-01   +4.685999115511941e-01   +1.123698441726325e-01   +3.046153610591136e-01   +2.388239956665162e-01   +3.916521786846345e-01; +3.757232922358753e-01   +3.308715333688227e-01   +1.837315294464169e-01   +6.657143744051005e-01   +5.446026764094530e-01   +5.496190665835043e-02   -1.237158549428325e-02   +3.525021128857831e-01; +1.549211679166310e-01   +2.789287116346726e-01   +2.902389194866256e-01   +3.970416237481496e-01   +9.413695474373159e-02   +5.157488459158158e-01   +9.294594112698411e-01   +4.799462876860614e-01; +2.475657639775593e-01   +1.276275949871149e-01   +4.076816439243003e-01   +7.190103568534333e-01   +4.441006268263941e-01   +1.935152051215043e-01   +3.154388202341192e-01   +4.510306500707806e-01; +1.255614136914567e-01   +5.762272680838956e-01   +7.229657029690786e-02   +2.882193074868222e-01   +1.070832660293313e-01   -8.801853409375984e-02   +4.947535159946951e-01   -1.361069307077784e-01];
L1E_L2E_iAMPA_netcon = [+2.602723300197421e-01   +4.558825805188237e-02   +5.914512196287451e-01   +5.851024327504196e-01   +7.709229348318138e-01   +4.411721574999623e-01   +6.362732092663389e-01   +1.738854493780695e-01   +4.509466297529585e-01   +8.186133220976288e-01   +2.153162077832722e-01   +2.957445957735522e-01   +6.358610594851269e-01   +5.777880555541236e-01   +3.310486768627934e-01   +6.100530166414723e-01; +3.008837245944942e-01   +5.374748163926387e-01   +8.758729444043144e-02   +2.841350528610624e-01   +3.352880879948252e-01   +5.370958453226280e-01   +6.303302288927634e-02   +3.750638521861912e-01   +4.121272497800767e-01   +4.930341556149095e-01   +5.155827211283333e-01   +4.105100752111907e-01   +3.697663201508573e-01   +1.097928844108266e-01   +7.450767139799865e-01   -4.559115739064774e-02; +4.219955458459573e-01   +4.296278386097200e-01   +7.740881261913317e-01   -1.252949197465773e-01   +4.788569557392209e-01   +1.594775446708271e-01   +2.528470411478218e-01   +5.626268093036856e-01   +3.715227288484618e-01   +3.715044338668152e-01   +5.148140145981911e-01   +7.485556029959634e-01   +8.050833851452244e-01   +3.181881370024160e-01   +5.127116814371114e-01   +9.279663702191349e-01; +3.881262878719172e-01   +7.659702132489732e-01   -9.000149899044499e-03   +1.302370253368217e-02   +4.441863635842702e-01   +5.059660094579851e-01   +3.286038807846127e-01   -1.988051046591015e-01   +8.968272488825036e-01   +3.945962550478816e-01   +1.827307890356417e-01   +3.609165439266539e-02   +4.377212586620048e-01   +5.542238138914883e-01   +3.656709535771760e-02   -1.964604998962529e-01; +4.765792151397016e-01   +4.502269525691176e-01   +1.694058756077644e-01   +1.652702149707963e-01   +2.233185885742068e-01   +8.914078534625954e-02   +6.798754015378524e-01   +8.213559302050838e-01   -1.181949223977964e-01   +4.602105817649459e-01   +2.357288870804492e-03   +5.705249901629872e-02   -3.441143103899844e-02   +9.594507966452683e-02   +4.671981331643589e-01   +3.092374462414848e-01; +5.085114358792050e-01   +5.450079203121686e-01   +6.062342202611600e-01   +1.000000000000000e+00   -2.140026057104154e-01   +1.765331886249135e-01   +2.176435778848521e-01   +3.206615238462461e-01   +2.966246740113417e-01   +3.407070491145756e-02   +3.367524731570615e-01   +1.659595392814083e-01   +9.205089323573507e-01   +1.449717426000022e-01   +2.198146475382243e-01   +6.423136146995077e-01; +3.769804406964885e-01   +3.573383568599963e-02   +1.387572194741079e-01   +7.098222675821843e-02   +3.158080425541097e-01   +1.906136865915631e-01   +1.954972723971096e-01   +7.882793446301121e-01   +4.614331631957240e-01   +3.878895380898743e-02   +4.173519320288271e-01   -2.291046682840821e-02   +1.347765209252354e-01   -3.143511349685119e-02   -1.597996904878604e-01   +9.214111657584732e-02; +4.620018849815883e-01   -1.284085334675859e-02   +7.736907003369994e-01   +7.740979306035348e-02   +6.130082377468522e-01   +8.472010349980339e-01   +2.849106555797762e-01   +1.888460317646544e-01   +4.129913190753663e-01   +4.489851816280548e-01   +3.812730386144655e-01   +1.842273530252938e-01   +1.233921027553468e-01   +7.728468472160386e-01   +6.653999972337759e-01   +2.822949727429639e-01];
L2I_L2E_iAMPA_netcon = [-1.160464123716147e-01   +4.901279141602181e-01   +2.728225961201691e-01   +2.176207559635723e-01   +9.484095756513958e-01   +5.337457572902760e-01   +3.010151762668278e-01   +7.345407236936450e-01; +4.899315897985975e-01   +1.064524906049827e-01   -3.462951306280725e-02   +5.287730567726964e-01   +1.883141255515044e-01   +3.924218224483976e-01   +2.208889703410235e-01   +8.952155402579671e-01; +1.759504131820841e-01   +5.038061831002295e-01   -8.170985459265918e-02   -1.234225144497722e-01   +6.926871594537870e-01   -9.658138695152128e-02   -8.042356691962266e-02   +3.031979004206492e-01; +5.514465750069159e-01   +6.844250940749483e-01   +1.308028872760706e-01   +1.000000000000000e+00   +6.054955938035176e-01   +5.609676026192684e-01   +1.039156913623155e-01   -1.816308571508523e-01; -3.477330688560527e-02   +4.433818880054979e-01   +2.331188342138203e-01   +6.269577157283472e-01   +7.156120193824035e-01   +4.646585078828754e-01   +5.704719488779179e-01   +1.949250280045262e-01; +8.776476742677679e-01   +1.570088109757530e-01   +1.895352262006590e-01   +2.074029769261095e-01   +1.438692961957204e-01   +8.502598181531186e-01   +1.138106824918144e-03   -4.932256831042035e-02; +3.916359401321330e-01   +7.708448720228077e-01   +6.042869249639706e-01   +7.598611558059143e-01   +7.401917916843168e-01   -1.479824436625057e-01   +1.482892366198504e-01   +8.554056964409469e-02; +9.919625253358035e-01   +5.813484244732576e-01   +6.060386454446154e-02   +1.371193092009197e-01   +7.066401140208297e-01   +2.262701090040822e-01   +6.164674871390635e-01   +4.038111618211924e-01];
L2E_L2I_iGABA_netcon = [+3.344913254767157e-02   +1.916784805664552e-01   +3.498353460000154e-01   -7.279501920707764e-02   +7.614378912809542e-01   +8.531925174053111e-01   +3.201935866281142e-01   +5.421696060502879e-01; +9.374591919072007e-01   +7.639414239040758e-01   +2.079516699279610e-01   +1.273327521489552e-01   -1.705875307644848e-01   +9.282064564498985e-01   +5.651491387989812e-01   +3.431254633281657e-01; +9.337789476962813e-01   -1.175808586357248e-01   +8.608934507168894e-01   +1.534093604831256e-01   +7.237636454955383e-01   +8.287602581052805e-01   +8.965208945673855e-01   +2.414722039659360e-01; +1.184541657065558e-01   +3.016511506915055e-02   +7.551944423748279e-01   +6.904436183950277e-01   +6.168759911730389e-01   +7.505176931139970e-01   +2.259436827415501e-05   +7.159817778863286e-01; +5.216711863870082e-02   +7.669795527284440e-01   +8.396214968741270e-01   +5.317129349135827e-02   +4.182570193946297e-01   +6.900528389446083e-03   +6.836262931276146e-01   +1.762352144721888e-01; +6.740170990044203e-02   +6.806985708471465e-01   +5.653639507167018e-01   +3.062812288881600e-01   +1.902495941656411e-01   +9.296592291311643e-01   -3.051213910749202e-02   +6.004669528034368e-02; +1.906593811349334e-01   +6.987292701860504e-01   +1.006476188677660e-01   +9.395635379775108e-01   +3.345636932430688e-01   +8.229062597605130e-01   +6.478742258125381e-01   +6.646032352315352e-01; +1.275158580278999e-01   -1.005855612555324e-01   +6.427512886239946e-01   +6.536538938365811e-01   +6.882287010627978e-01   +1.853863142870503e-01   +4.801349689524484e-01   +7.606552281247719e-01];
L3E_L2E_iAMPA_netcon = [+1.948367150355537e-01   +9.958248787105981e-01   +7.640406732211115e-02   -2.199259611083819e-02   +6.176524835897768e-01   +4.014264521576441e-01   +3.789188034487429e-02   +7.641072443599439e-01   +5.955707876497870e-01   +9.716111241598599e-02   +4.178340139429081e-01   +6.617938957901297e-01; +3.169245919949680e-01   +1.591453854943073e-01   +4.178595008426389e-01   +2.131949545670291e-01   +2.980773186218890e-01   +4.273196865879486e-01   +1.992709857930503e-01   +6.078443782273215e-01   +3.466727855803319e-01   +2.131372912320584e-01   +5.433648738307931e-02   +6.634445213554321e-01; +3.250615290203540e-01   +5.672491166966894e-01   +4.166353297954168e-01   +4.672389998277080e-01   +7.210528186534704e-01   +4.083083952591254e-01   +6.485467573894638e-01   +2.912367577307417e-01   +5.294873589426413e-01   +3.314389195294386e-01   +2.686611491640258e-01   -4.032516934708714e-02; +6.965752968695403e-01   +7.610015807391134e-02   +7.152217197798764e-01   +2.501911366492841e-01   +6.073986222558707e-01   +4.354147759749156e-01   +2.192228561496343e-01   +3.460700597046716e-01   +3.334579641455675e-01   +4.373828585168433e-01   +4.106784670359893e-01   +7.426436663070715e-01; +2.362811387743308e-01   +1.295280185960915e-01   +4.482712211790983e-01   +2.685895017511784e-01   +3.670955405290674e-02   +5.415317548485384e-01   +1.180807130665863e-02   +5.889546058212197e-01   +7.748422334471577e-02   +7.494454177435956e-01   +1.308459769015627e-01   +6.309426237909063e-01; +1.304505474544733e-01   +3.937955014873314e-01   +2.313372128120942e-01   +2.740154335267085e-01   -1.611952788624316e-01   +3.534211502171598e-01   +2.961927953484234e-01   +6.412007779053354e-01   +5.393955362555759e-01   +8.078978071519204e-01   -1.966020822147237e-02   +4.615861785165144e-01; +4.021092212937614e-01   +3.771192053795206e-01   +1.197328718623588e-01   +8.076643300170507e-01   +2.258788220377057e-01   +4.305668238502782e-01   +5.183520497768824e-01   -3.222625904448632e-01   +5.397639957542831e-02   +6.532037240640169e-01   -1.396897668697764e-01   +3.540747842498879e-01; +7.765053546516908e-02   +2.997756193523840e-01   +1.916149249466722e-01   +4.410584826784398e-01   +1.382048375740967e-01   +2.230467083459570e-01   +2.961826024470867e-01   +2.768552655456552e-01   +1.734934681479862e-01   +6.393677689449466e-01   +5.546962335720145e-01   -7.094985217149558e-02];
L3I_L2I_iGABA_netcon = [+6.893387184360793e-01   +6.509820213105934e-01   +4.152015158973955e-01   +1.984667793942999e-01   +5.272864473891468e-01   +9.317919256285853e-01   +5.432701679307310e-01   +3.637478762787828e-01   +6.503454941483694e-01   -2.011146463881944e-01   +4.539431509732061e-01   +6.430267106743656e-01; +7.432503092150117e-01   +3.047050394632105e-01   -3.379986718447255e-02   +8.302692650143714e-01   +5.716787599350925e-01   -1.059975155290429e-01   -7.546428679854075e-02   +2.233898906935707e-01   +4.129320106590931e-01   -2.345366405040907e-01   -1.679713862260913e-01   +5.915850574947570e-01; +3.003013279659890e-01   +6.152109976402499e-02   +9.989684251112897e-02   +7.392652580793461e-02   +4.569411401285859e-01   +2.753038868480921e-01   +5.413457177679757e-01   +6.614282353096419e-01   +1.789766249235710e-01   +4.682018839004399e-01   +5.083887588872270e-01   +5.223762770795753e-01; +8.400544152583909e-01   +2.466895173065718e-01   +4.126431325645867e-01   +5.163037064961803e-01   +1.324907817397860e-01   +7.906399090509707e-01   +5.878111455534308e-01   +9.409003776325456e-01   +5.681407241174747e-01   +6.192126390397978e-01   +6.451527707923097e-01   +6.290261519178308e-01; -1.631025905487146e-01   +3.905653208827566e-01   -7.703339822786669e-02   +6.403123111857089e-01   +2.789999360729598e-01   +4.026469038067229e-01   -1.657020183473977e-02   +2.086285645441777e-01   +3.852082440998419e-01   +5.374315042441649e-01   +4.963277061679825e-01   -2.297202369932743e-02; +3.066781971872994e-01   -2.425677858116057e-01   +4.080981853289463e-03   +6.387674994186084e-01   +7.380306400059642e-01   +9.981394229162979e-01   +6.255095234402009e-01   -1.512386516769022e-01   +1.573245112312630e-02   +7.649048614556426e-01   +2.845734918967603e-01   +3.211398739491194e-01; +4.443563559829536e-01   +2.870345666303635e-01   +2.229679929546337e-01   +1.972085934150803e-01   +5.935321159007267e-01   +6.350371795223820e-01   +2.180025833613317e-01   +9.366890298517751e-02   +7.362904688557397e-01   +3.266724356389376e-01   +5.425268182995018e-01   +7.518585078428263e-01; +3.528475017885048e-01   +6.192235264917012e-01   +3.611217174915218e-01   +3.758825919113171e-01   +4.300618022116052e-01   +4.047111830190210e-01   +7.085385996623735e-01   +6.609409066847649e-01   +4.454847474063602e-01   +1.939935690715861e-01   +3.546394166356414e-01   -3.216669596051627e-01];
L2E_L3E_iAMPA_netcon = [+8.662751280585308e-01   -2.080682307369529e-01   +1.673471907111853e-01   -1.268849646919852e-01   +5.987167250869350e-01   +5.084755204823195e-01   +4.257093469043720e-01   +3.111115965844661e-01; +3.302931007192996e-01   +7.371050411653832e-01   -7.645622509279552e-02   +6.302026184676324e-01   +3.218652785228461e-01   +2.197895020613631e-01   -2.409875471584346e-02   +4.322303120027884e-01; +4.765169732247134e-01   +6.627677125863339e-01   +4.740270277572033e-01   +8.866689019032693e-01   +6.952893273195154e-01   +6.608413559868229e-01   +4.304938860239023e-01   +2.084324229736739e-01; +3.894580810556239e-01   +3.265294768055994e-01   +7.609615847396906e-01   +6.328477905823855e-01   +8.131587014579549e-01   +1.398572508264945e-01   +4.797383573164942e-01   +4.389466274263639e-01; +8.728724189377102e-01   +8.080496641779749e-01   +4.360090372936466e-01   +2.045969371300838e-01   +1.484071482011095e-01   +7.296728664001010e-01   -1.359843170196426e-01   +6.306188175340026e-01; +6.615103752740679e-01   +3.228228146131513e-01   +7.831723983930708e-01   +3.709799472090546e-01   +9.785064819952469e-01   +7.216236219691493e-01   +1.828457366438055e-01   +9.863421732745400e-01; +8.328757861746251e-01   +3.173657965850530e-01   +8.684419495651358e-02   +5.769781313268492e-01   +6.584543077278220e-01   +2.971104730416576e-01   +3.779794255056686e-01   +4.841816775701184e-01; +2.464119056132318e-01   +2.494288417257644e-01   +2.000660434605521e-01   +2.649121106589920e-01   +4.710213805620116e-01   -9.878025701538000e-02   +3.984991250920186e-01   +8.467478193687104e-01; +5.457771698095931e-01   +5.003286216338217e-01   +6.138425545893108e-01   +4.899714910100503e-01   -4.684437117585230e-02   +8.089909931223684e-01   +3.547728102788249e-01   +4.291385527630337e-01; +9.676855229169658e-02   +1.858251836989398e-01   +4.671930600514668e-01   +4.431286351988041e-01   +3.323653038768657e-01   +8.509835788188225e-01   +7.124051355246896e-01   +5.403896976298883e-01; +4.666949872586033e-01   -2.019878497563410e-01   +8.461108328148235e-01   +1.592659414114540e-01   +3.242399321906030e-01   +2.042745437542998e-01   +2.004100110914124e-01   +5.745938760270858e-01; +3.006197037459717e-01   +2.155371666217634e-01   +2.207259869877450e-01   +1.845529811597820e-01   +7.517291317739780e-01   +1.716699308293247e-01   +8.697487950034805e-01   +6.163981390082426e-01];
L2I_L3I_iGABA_netcon = [+4.301874863310409e-01   +2.606250289150669e-01   +6.295206976823082e-01   +6.818831063344334e-01   +3.790017167235196e-01   -1.299876488471552e-02   +3.628618622330629e-01   +5.148515205949461e-01; +3.636790899590188e-01   +5.594673028254186e-01   +6.642820526561382e-01   +8.990183239043357e-01   +2.510537733472853e-01   +8.920883013290709e-01   -1.157998052593711e-01   +5.928472727608382e-01; +2.692577403593636e-01   +9.149149578672933e-01   +6.278355802261000e-01   +3.117582719106469e-01   -3.455106985641951e-02   +2.083788213877753e-01   +6.059996303151316e-01   +6.989242938500097e-02; +2.125803078416195e-01   -2.549355342694451e-01   +6.861637426848626e-01   +9.470555594797703e-02   +3.317525120392329e-01   +2.479033903236749e-01   +5.537612861660707e-01   +8.610410867525882e-01; +7.024174250379835e-01   +6.169347282246161e-01   +3.948793234453173e-01   +4.171604132281875e-01   +3.565943735796442e-01   +9.940487927710868e-01   +2.352718258540143e-01   +8.361167412394434e-02; +5.864370477265578e-02   +1.195071009307199e-01   +3.709776492070052e-01   +1.251220423617899e-01   +6.893037619575449e-01   +7.958386280078423e-01   +8.938468488301164e-01   +1.235051451132434e-01; +9.327171777891013e-01   +2.492078841885381e-01   +7.813580366886097e-01   +8.024147435404455e-01   +5.477022052086319e-01   +1.541731852535071e-01   +9.312472856653615e-01   -1.018104665638369e-01; +6.381005926115735e-01   +5.169863676632266e-01   +7.997196339915100e-01   +4.759065547878538e-01   +8.559293122433641e-01   +7.428096158678348e-01   +5.049759111935225e-01   +1.575252669014447e-01; +3.665479624421936e-01   +7.883268010015511e-01   +7.393953096330504e-01   +5.211639040764701e-01   +7.004740338896369e-01   +4.554739302652781e-01   +9.905006885593870e-01   +7.490194965043019e-01; +9.661927584399935e-01   +3.986827569494691e-01   +6.550577916907279e-01   +5.105314719030729e-01   +3.419917793858202e-01   +2.808530771795176e-01   -6.151082094530719e-02   +3.698211412174086e-01; +5.996475080700275e-01   +7.292545225084015e-01   +1.719722046754058e-01   +4.462638670733825e-01   +3.927498961361868e-01   +4.047280439219147e-01   -2.726966063678924e-01   +3.720340713258978e-01; -2.923867746835244e-02   +4.812397585485312e-01   +1.735303492568316e-01   +3.940395211247023e-01   +6.018417754794992e-01   +1.329444491529848e-01   +3.307573350809849e-01   +6.032758180576928e-01];
L3I_L3E_iAMPA_netcon = [+1.862920465716364e-01   -1.033780605252348e-01   +2.449372607432655e-02   -1.955688066406180e-01   -5.335966416146091e-02   +3.991665276541883e-01   +1.236044164151407e-01   +1.248256604428161e-01   +3.664082544452330e-01   +8.197943886342719e-01   +6.406221083862299e-01   +4.205026062664852e-01; +7.299509641362849e-01   +2.742945233759723e-01   +7.913701403186792e-01   -6.640940072365817e-02   +5.081702836740916e-01   +7.135353543648728e-01   +5.107450994725677e-01   +2.731783408665562e-01   +2.861706158373740e-03   +2.788543451717364e-01   +5.861899985620974e-01   +2.679655567015204e-01; +8.624099382793349e-01   -1.557818494518971e-01   +3.251423291423429e-01   +6.033172965832280e-01   +4.143879744435570e-02   +3.805175950951324e-01   +7.449578887101980e-01   +3.512328515585423e-01   +4.641622869018566e-01   +3.189454754885996e-01   +5.152100727712904e-01   +6.814836779047920e-02; +7.952792350894714e-01   +2.882528435838073e-01   +7.825642474575248e-01   +7.604737518439770e-01   +1.340135835980258e-01   +7.007756915575872e-01   -7.965414775240337e-02   +6.193064691224955e-01   +6.114315187040525e-01   +1.145420668725434e-02   +7.626565091658705e-01   -1.117277726196794e-01; +6.693637386596817e-02   +2.801151419311322e-01   +2.304817857633519e-01   +3.451543733334042e-01   +6.374979836844193e-01   +3.863917556561363e-02   +3.051165705522155e-01   +2.377835815116965e-01   +6.966349252505454e-01   +4.841841929581403e-01   +4.965361769055687e-01   +5.852011398661521e-01; +3.092536518582428e-01   +1.311748835075991e-01   +1.564160480889500e-01   +5.678899419589108e-01   +2.136621636444073e-01   +7.009972978704830e-02   +1.351917332306698e-01   +8.689970930841170e-01   +2.367687342372589e-01   +3.317459327196767e-01   +5.501527603233398e-01   +1.701832084584664e-01; +1.792739851941822e-01   +7.019922483617296e-01   +7.070661928182733e-01   +3.808984339853675e-01   +4.281932391408901e-01   +2.085122311540796e-01   +2.827582742324849e-01   +3.688206489472057e-01   +1.149243936895214e-01   +5.242986366929716e-01   +4.244608615180862e-01   +6.366979933060406e-01; +4.814716195594300e-01   +7.426937392246010e-01   +3.038474528542837e-01   +5.958684234995879e-01   +6.541727029621727e-01   +3.404716014939350e-01   +5.009056864890261e-02   +1.990480098389599e-01   +6.601115235193408e-01   +6.358239182525294e-01   -2.142368960411824e-02   +7.042162417430203e-01; +4.420902367486663e-01   +9.385564649985843e-01   +7.780810833616585e-01   +5.233815720680109e-01   +5.046340195734592e-01   +7.097928199183058e-01   +3.051473489010481e-01   +5.728481540757342e-01   -4.575478519046610e-02   +2.937761214613057e-01   +7.662513974193136e-01   +4.023955379335969e-01; +9.244223327238807e-02   +4.836384334546520e-01   +3.338376334438072e-01   +7.110209934238139e-01   +4.343361828321873e-01   +5.377852478286386e-01   +6.346128260078350e-01   +2.280314255131781e-01   +1.644584528136560e-01   +6.553195955492130e-01   +4.791205131161879e-01   +6.592241829588940e-01; +8.139825922823702e-01   +1.072042889422243e-01   +7.564882903214187e-01   +8.628730631816549e-01   +2.189978377407249e-01   +3.956922812277862e-01   +8.486905463716636e-02   +9.592168449407567e-01   +8.159983311515580e-01   -4.866740446558618e-02   +6.493974905135128e-01   +6.674316318314867e-01; +4.149855572877520e-01   +6.297174161720155e-01   +4.800378146263305e-02   +1.092397393670257e-01   +3.114823216000389e-01   +4.000784785078521e-01   +9.824147248390941e-01   +1.937699898748345e-01   -5.504606080280052e-02   +1.516615889910331e-01   +3.971775050650491e-01   -1.707961654744283e-01];
L3E_L3I_iGABA_netcon = [+1.649984054932103e-01   +6.305677372372837e-04   +8.132102857544818e-01   -1.764702812943217e-02   +2.360055271132341e-01   +4.560229119850258e-01   +5.552384521612903e-01   +3.636971473398540e-01   +3.453018385531278e-02   +3.740860209183269e-01   +1.686747074510484e-01   +3.416190784808080e-01; +3.260960274371600e-01   +2.288999276512912e-01   +3.718563849225190e-01   +7.739182277936011e-01   +6.775346228832237e-01   +1.085246412426922e-01   +4.180204225301419e-02   +1.765347261124307e-01   +2.359494446514115e-01   +6.439422877618346e-01   +8.363468202829196e-01   +3.518524636909138e-01; +3.889134116476066e-01   -2.491607889108904e-02   +5.278915272259874e-01   +4.017235742244500e-01   +6.146795383241640e-01   +6.169197523773805e-01   +5.000547495894458e-01   +2.811361221846320e-01   +3.444223908128624e-01   +3.244242766351307e-01   +7.087361695167124e-01   +8.929035012742642e-01; +4.209533344443157e-01   +4.926555611149563e-01   +9.603185941132358e-01   +8.972958772440037e-02   +2.952390529128543e-01   +3.894485024160755e-01   +4.979993887620409e-01   +4.419926688351307e-01   +2.433906017382240e-01   +4.635477370596823e-01   +6.642395046863470e-01   +2.957668263718278e-01; +1.328805008872054e-01   +3.376578306584405e-01   +3.915607521393890e-01   +2.706259797217571e-01   +6.236887304502543e-01   +3.309022135465583e-01   +5.038356512837291e-01   +5.564010901371343e-01   +3.578027003162875e-01   +2.731493590023699e-01   -2.538102030025423e-01   +4.792435279307135e-01; +5.414333816899026e-01   +4.015914520264404e-01   -2.018267985956830e-01   +5.750737079527766e-01   +7.480612839548644e-01   +7.284312142223126e-02   +3.539010655544181e-01   +1.227020731501941e-01   -9.807577413480374e-02   +4.165422153574571e-01   +2.398102544730523e-01   +6.544073352869354e-01; +2.612107531635098e-01   +5.041577466388778e-02   +1.212430840125310e-01   +3.778924525434390e-01   +4.284178780177789e-01   +6.782325174294139e-02   +2.072722533386337e-01   +5.354834834600701e-01   +4.976572989332562e-01   +4.805546813255456e-01   +4.976503499565385e-01   +3.151148272995782e-01; +2.906771194347973e-01   -4.073784454670067e-02   +1.710644077921517e-01   +2.627401085291600e-02   +5.560801437424652e-01   +6.636540323165010e-01   +4.075914278057760e-01   +1.567287253691254e-01   +2.812341523963824e-01   -1.350277340255670e-01   +5.437676711240004e-01   +5.703997091285137e-01; +4.077084012253512e-01   +1.002129133293028e-01   +1.464380312125517e-01   +4.161109089698092e-01   -2.248015708762613e-02   +5.364661305429445e-01   +7.385819073641159e-01   +2.459189962149635e-01   +1.829239045240402e-01   +3.769796155818864e-01   +7.651866957879510e-01   +1.236450508414965e-01; -2.164019527932768e-02   +3.217811350662336e-01   +3.583490178116282e-01   +5.339053109920069e-01   +2.259628498944930e-01   +2.222941570219507e-01   +4.348686970934715e-01   +7.081279231919418e-01   +7.280292158812285e-02   +2.616469684698678e-01   +1.414651476362733e-01   +4.742162914345107e-01; +5.946002160437700e-01   +5.444213507214065e-01   +6.793819850771893e-01   +2.111510638174643e-01   +2.142069519379795e-02   +2.572693591576969e-01   -5.531465495004914e-02   +6.915358513448799e-01   +3.764545758200235e-01   +5.171639921268386e-01   +8.306088943350232e-01   +4.217646608165761e-01; +2.865416461924146e-01   +4.888894066704930e-01   +1.410850152576060e-01   +4.871957232155285e-01   +2.316151913341087e-01   +2.047632826025809e-01   +9.901781017693028e-01   +4.693256596318262e-01   +7.519372328379286e-01   +5.365852911595334e-01   +3.208957161812690e-01   +1.039467883797443e-01];
L2E_Input1_iAMPA_netcon = [+7.703048991314776e-01   +8.306348303935351e-01   +8.373531906107807e-01   +9.900496375650086e-01   +8.487237262725174e-01   +8.563867437287804e-01   +7.523161953206235e-01   +8.116111917523922e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +5.409466216245147e-01   +8.970701830346980e-01   +5.769743882301706e-01   +3.630592467814195e-01   +9.499021841185344e-01   +4.453677112523807e-01   +6.123002698519238e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
