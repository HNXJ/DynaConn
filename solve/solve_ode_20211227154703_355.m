function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.203170283420705e-02   +9.037599950465679e-02   +7.716964215889974e-02   -2.842533786955385e-02   +6.791829229693266e-02   +1.617766580732569e-03   +2.284456104995522e-02   +6.007280833757566e-02   +4.573773846645327e-02   +5.491085343804460e-02   +1.050023525185636e-01   +1.235757810973341e-01   +3.024159623179653e-02   +8.927233146131501e-02   +1.448892689845799e-01   -1.700953822537032e-03; -3.814609693777467e-02   -5.454480722536090e-02   +6.822867144299020e-02   +1.577902558902543e-01   +7.869682283535674e-02   +1.238093552153831e-01   +6.854675585028948e-03   +8.843355418055086e-03   +7.552523093367064e-02   +4.841242638788112e-02   +3.600049478601056e-02   +2.115727797121644e-02   +1.386441502237031e-01   +7.205234950971708e-02   +5.955186978935116e-02   +1.166927296777448e-01; +1.109965867032294e-01   +6.910805603796601e-02   +2.400589154677642e-02   -1.254608047325867e-02   -2.794035640005219e-02   +1.533500715398211e-03   +3.097168788530855e-02   -1.239885035085308e-03   +3.415500697821280e-02   +1.272856275732631e-01   -3.148463222927222e-02   +7.752346005205030e-02   -1.802539614066887e-03   +5.542313796494167e-02   +4.369296393166668e-02   +6.155805555222894e-02; +3.827161764406820e-02   +1.335586416934775e-01   +1.312354351083862e-01   +8.856812858860290e-02   +7.747555459631336e-02   +1.271195310517192e-02   +2.965977408963636e-02   +7.247671269606606e-02   +5.513197356194925e-02   +7.904622235790275e-02   -1.672168822546449e-02   +6.499765534434375e-03   +9.589655295375726e-02   -5.849074693700818e-02   +1.097796601739083e-01   +6.355750134205609e-02; +7.673383088838606e-02   +4.994809237227293e-02   +1.546513079634664e-01   +7.866366863800742e-02   -1.240786640955187e-02   +4.508243002599077e-02   +8.929357349336726e-02   +1.107506085133140e-01   +2.800186940139848e-02   -1.936608650669904e-02   -8.763165177796291e-03   +3.544051939811818e-02   +6.783731490657478e-02   +1.260990993375074e-02   +7.027243660915171e-02   +1.341027728682880e-01; +9.991311630026219e-02   +4.467274431619127e-02   -1.220117809449862e-02   +1.018942909913419e-01   +4.646111340180389e-02   -2.072330360152823e-03   +6.935488246074574e-02   +9.526550836914605e-03   +8.362013334117913e-02   +3.057665716411343e-02   +1.318871528625785e-01   +1.247247254881736e-01   -4.135068574732519e-02   +1.443021079116483e-02   +2.705129775018136e-02   +4.827260384734072e-02; -1.293347222108031e-02   +3.445404720969420e-02   +3.300785637494109e-02   +1.380041582792966e-01   +3.412413062825264e-02   -1.678845374464501e-02   +6.493519992771346e-02   -1.116321861663871e-02   +1.410879270322050e-01   +7.951350020690222e-02   +6.709606668212306e-03   +7.013390921887995e-02   +3.479366437393942e-02   +7.113140521937378e-02   +3.883027190453694e-02   +6.935771073523597e-02; +6.259551751266175e-02   +3.183293278107552e-02   -4.148173063616124e-03   +4.279345994738300e-02   -6.239233829855587e-03   +1.592018179498008e-01   +5.308427938295699e-02   -5.564181161739120e-04   -3.213873031723993e-02   +2.906014178404837e-02   +1.194409945818940e-01   -1.543388076020377e-03   +5.004881379319336e-03   +4.130489323176394e-02   -1.952442628221992e-02   +2.205697802100167e-03; +7.937537702008518e-02   -8.072653879596169e-03   +8.128502461453768e-02   +7.814483926304294e-02   +7.799889955204727e-02   +2.245952860290922e-02   +4.126169138014201e-04   +3.923646924933473e-02   +2.744229381245889e-02   -3.483668464359241e-04   +1.403549324617096e-01   -4.768774203111182e-03   +6.381308149358142e-02   -8.259577240715483e-03   +4.882501950050486e-02   +5.852429647471498e-02; +2.922548263121799e-02   +3.747479609162005e-02   +2.206591720338079e-02   +7.546990443456741e-02   +1.081391076852238e-01   +1.284851567808298e-01   +1.344851772729070e-02   +8.600512649489969e-04   -1.273303380783268e-02   +1.212321783539022e-01   +6.892922889143835e-02   +2.086141841841548e-02   +1.547216196620919e-01   +1.295732995360868e-01   +7.992066108881031e-02   +2.796705694190239e-02; +4.018204555574632e-02   +3.327911574491699e-02   +5.694956094306358e-02   +1.115147431488300e-02   +7.395204018778396e-03   +1.756143836138606e-01   +2.013548521523556e-02   +2.964611799864864e-02   +4.688304354779284e-02   +4.409111379531312e-02   -5.111292303196872e-02   +7.775228219803249e-02   +7.889887860001969e-02   +4.285678589541392e-02   +6.755212265134322e-02   +9.472449759817146e-02; +5.046117561418419e-02   +5.564949463423796e-02   +1.393796834966053e-02   +1.107914873422839e-01   +3.598774211425287e-02   -1.114449723290665e-02   +7.408161295059676e-02   +8.761577387320504e-02   +1.063787253403549e-01   +3.086671382035206e-02   +1.018549749909327e-01   +5.942423494233774e-02   +5.700582250949386e-02   +6.893093966053818e-02   +9.211474496991237e-02   +1.120363963024651e-01; +1.638378030300379e-01   +9.020942705032248e-02   +7.307602002169163e-02   -3.038603257845390e-02   +5.265973992051404e-02   +4.412579212974585e-02   +3.238421955623041e-02   -6.095796248407527e-03   +7.519347585708148e-02   +9.524620791541037e-02   +1.215543850251502e-01   +8.657678729993529e-03   +2.737973781643008e-02   +1.311156751993037e-02   +8.124389952709740e-02   +3.543480844894701e-03; +1.345749554440430e-01   +9.948475105485273e-03   +7.178534357662238e-02   +1.333774500866804e-01   +1.330088087035391e-01   +1.251738093777686e-02   +7.303917604702322e-02   +2.987430597905566e-02   +6.267668663564904e-02   +1.009826818150074e-01   +9.766571226943509e-02   +1.420049144083365e-01   +1.332506855778313e-01   +1.230080030519724e-01   +1.343018394995668e-01   +9.364196571448093e-02; +6.061179090293143e-02   +4.772445505386565e-02   +1.117823831092250e-01   +9.446714553873946e-02   +9.838131185951282e-02   -3.626129548791567e-02   +8.425640139897878e-02   +5.260058891080819e-02   +1.333835941850067e-01   +9.545516736637673e-02   +7.804715773272380e-02   -5.136884243862425e-02   +7.829826752424436e-02   +3.863337809968403e-02   +3.128253169896915e-02   +1.297723823784476e-01; +1.265420691635716e-01   +5.378237747797154e-02   +9.778422152986356e-02   +1.359121089892226e-02   +1.101246368638009e-01   +1.056510793245158e-01   +6.733735058992399e-02   +3.737590127935994e-02   +6.742952697925587e-02   +4.610292787011804e-02   +6.329609424887771e-02   +2.496062455051031e-02   +9.693926693798310e-02   +2.668099797876700e-02   +7.866444058708963e-02   +1.095446617812744e-01];
L1E_L1I_iGABA_netcon = [+1.619272967027227e-02   +1.593277968844164e-01   +1.018710322018740e-01   +1.167306060556395e-01   +7.079466025979878e-02   +8.988708395113020e-02   +5.034725536068958e-02   +2.559911688674346e-02   +1.033495631498367e-01   -2.544986622941887e-02   +7.331079255609385e-02   +3.513075888443482e-02   -1.298417283937425e-02   +8.129220950858435e-02   +4.909712451230708e-02   +9.482271729832500e-02; +8.075629558015403e-02   -7.985820007352906e-03   +5.501409241788670e-02   +5.019267942299363e-02   -2.498652817211399e-02   +9.433356370691358e-02   +4.129239173132365e-02   +5.822590826626031e-02   -1.724645761616624e-02   -6.664576615788578e-02   +7.560977322816945e-02   +3.342661961368279e-02   +5.615286726938271e-02   +7.022725743075953e-02   -3.510267955084204e-04   +8.702401068244671e-02; +5.974708749686899e-04   +1.091994446155906e-01   -9.648156157788110e-03   -2.483037377944011e-02   -8.614447217459506e-03   +2.411012948673394e-04   +9.595177342560930e-02   +7.281065218085275e-02   +1.714829731760161e-02   +2.920967264701821e-03   +6.471186113359907e-02   +8.156285804386479e-02   +3.699911870273610e-02   +1.591282496280964e-02   +2.240192248408488e-02   +3.892061123915557e-02; +6.053672524184058e-02   +6.633009040168393e-02   +8.447643952509148e-02   +3.149324518059547e-02   +9.265539599342178e-02   +1.541303594104368e-01   +1.583676194989363e-02   +4.843096007916427e-02   +2.027386685675191e-02   +1.252185868308390e-01   +1.146886636947776e-01   +1.086647964559486e-01   +7.022851236942736e-02   +5.450488140673544e-02   +2.190773442029927e-02   +5.575757214886362e-02; +7.156176856736018e-02   +1.032628471328181e-01   +1.123989206893143e-01   +1.031288060637809e-01   +6.915731324511380e-02   +4.528702955329039e-02   +6.726135303714063e-02   +7.246037133115610e-02   +1.413320112726152e-01   +6.479237254788360e-02   +9.550313901001183e-02   +4.823490736269990e-02   +2.600925013944253e-02   -7.539796689130757e-03   +4.871665851718156e-02   +1.006026506066463e-01; +8.914023152402047e-02   +7.216186122603185e-02   +2.622006436820037e-02   +9.586757330714363e-02   +5.699793521574602e-02   +2.631716958201027e-02   -7.006750116370685e-03   +1.007200577314968e-02   +1.467782639291357e-01   +4.856483415682590e-02   +6.108096330170311e-02   -2.882449170776377e-02   +9.907004616958238e-02   -6.628638576923382e-03   +8.715164600016899e-02   +6.168071946231744e-02; +3.035106900105952e-02   +8.864829802808499e-02   +1.359342587187452e-01   +4.886581138022179e-02   +2.616606621812013e-02   -2.638635364584943e-02   +9.290507736184561e-02   +5.535317976210138e-02   +7.149354715575673e-03   +8.926453547128828e-02   +3.196780162603879e-03   +9.864413441923267e-02   +5.737401529982066e-02   +6.244806922894952e-03   +5.554582975981866e-02   +4.426470434173382e-02; +2.203487288064837e-02   +7.463073428745118e-02   +2.270080789744581e-02   +5.278438745459255e-02   +8.013344300526212e-02   -6.454690584186348e-03   +3.153821270636049e-02   -5.782743458670409e-02   +9.428799142817054e-02   +7.090421060461265e-02   -1.232551732829144e-03   +2.981187449830847e-02   +3.228561783582946e-02   +4.398712852421097e-02   +1.748420833716130e-02   +1.503264869478110e-01; +3.452011478659305e-02   +1.362466442943982e-01   +9.037499439480201e-02   +1.666717622826328e-02   +7.802155794135848e-03   +1.547897108059440e-02   +5.815522710286111e-03   +9.375861726910746e-03   +7.652427200700943e-02   -1.193712137462576e-02   +4.691468813134962e-02   +7.646926782935892e-02   +2.670667376072999e-02   +9.102666290361218e-02   +1.303466392947691e-01   +6.839028858325033e-02; +7.323340552658822e-02   +1.051238144630563e-01   -2.845290827230890e-02   +4.180159971357101e-02   +2.840413953873770e-02   +3.849469371647302e-02   +1.020792355168819e-01   +3.210838105220086e-02   +1.184913680451999e-01   +6.580886399101798e-03   +9.842614106633785e-02   +1.403395732122298e-02   +5.003043944798071e-02   +9.287391103818490e-02   +1.332724898290482e-01   +1.035706779327706e-01; +8.957604032904003e-02   +8.154723589324535e-02   +3.402499064732471e-02   +8.465549758465993e-02   +1.197555807430683e-01   +1.081818508170038e-01   +5.009590877684943e-02   +4.342017603402904e-02   +3.533049109625053e-02   +7.048546948078073e-02   +5.717762016188014e-02   +9.957721867832842e-02   +2.816613354599164e-02   +2.079874926228143e-02   +8.078284214634818e-03   +8.891344527984636e-02; +1.097256523454397e-01   +1.355402936506015e-02   +3.597190008168096e-02   +4.837928984947958e-02   +5.225588478050326e-02   +4.623475481956634e-02   +8.275852913153250e-02   +1.996567092484014e-02   -3.363153004624585e-02   +5.412016725314281e-02   +6.113208630622991e-02   -3.585239938022881e-03   +2.316963901986705e-04   +6.498272223183775e-02   +1.015709946738108e-01   +1.007164897893239e-01; +4.038936219445994e-02   +5.305787683766127e-02   +8.663611492043552e-02   +6.561708198846622e-02   +6.479773528985150e-02   +1.865306009178039e-03   +3.714739676463685e-02   +9.036996438124367e-02   +9.535471947998185e-02   +1.107619326764383e-01   +2.728605863664745e-02   +4.427716099573290e-02   +6.916950971309267e-02   +1.017577197825385e-01   +6.879820797506407e-02   +2.765103035502203e-02; +1.901423038935445e-02   +5.526688624245875e-02   +4.998049839591644e-02   +3.543367661127065e-02   +8.230219774273663e-02   +7.492823752080970e-03   +1.017607812608932e-01   +1.891508427227143e-02   +6.376824054638647e-02   +6.730435448571244e-02   +8.634234443574060e-03   +5.739620859433608e-02   +1.019538507961209e-01   +1.142496947152179e-01   -5.744229353690258e-03   +1.766296776355369e-02; +5.335284023791975e-02   +5.818100993761861e-03   +3.566409195974275e-03   +7.099820889007379e-02   +1.980463577489444e-02   +2.965742829374827e-02   +2.487248302794939e-02   +5.666387500300308e-02   +7.261248778940187e-02   +9.958783673745757e-02   +5.507645584672437e-02   +7.731916583502603e-02   -3.495273176151308e-02   -1.626910611281281e-02   +8.121664304224355e-02   +1.190291128319185e-01; +4.162490705442335e-02   +2.384702775471696e-02   +9.302968104905168e-03   +1.400628730864533e-02   +9.369194622623735e-02   +1.797786458024676e-01   -8.355801304164141e-02   +7.006606852310485e-02   +9.946532828734675e-02   +7.773972809476390e-02   +8.260777553386264e-02   +2.797475111667388e-02   +9.854044011769900e-03   +1.581952835903293e-01   -1.306382497353131e-03   +3.657648580465533e-02];
L2I_L1I_iGABA_netcon = [+2.314130630003678e-02   +6.562559216922975e-02   +1.970562070787015e-02   +4.955252408784044e-02   +3.064075107106017e-02   +1.286430288232044e-02   +3.026534379610503e-02   +8.150770815914979e-02; +4.960448057049420e-02   +1.040770824057528e-01   +5.860851074781267e-02   +6.631985303031807e-02   -1.753092392446567e-02   +5.704140694475004e-02   +1.116035862844991e-01   +8.981987803746037e-03; +3.796853622276788e-02   +3.129691189581581e-02   +1.272965714964374e-01   +6.631594637149663e-03   +8.987951546763118e-02   +3.055502985066883e-02   +9.957348352698010e-02   +7.980286368275553e-02; +6.933456096466148e-02   +6.469315228852114e-02   +4.746677007553781e-02   +6.920366526940903e-02   +7.712202021279753e-02   +5.223032569408738e-02   +6.468468496544244e-02   +1.063419862015650e-01; +1.112672898623795e-01   +4.587249370351845e-02   +2.039904596361062e-02   -3.741245001988875e-04   +6.963513170669861e-02   +6.257975303794078e-02   +3.903180051962563e-02   +5.210071500858649e-02; +1.389561936389328e-02   +8.176268450843543e-02   +1.039085403610823e-01   +4.662036068153982e-02   +1.150825747107225e-01   +5.382887093922199e-02   +4.793675065890924e-02   +4.109492312165245e-02; +8.775661074782350e-02   +3.367551447078483e-02   -4.870383446940754e-02   +4.029761086508972e-02   +5.543617664926009e-02   -4.788762100164092e-03   +1.841354187111325e-02   +8.368447933419745e-02; +3.192214330255137e-02   +4.963819264211351e-02   +3.441612816631896e-02   +1.777306084322878e-01   +1.787294609948462e-02   +3.392865920045803e-02   +4.783025966546298e-02   +2.642410045051442e-02; +3.129804085925129e-02   +7.418814203432848e-02   +5.139396309556808e-02   +1.292130274478229e-01   +4.990885275449421e-02   +1.167477971363465e-01   +1.448457959018304e-01   -3.576806377604313e-03; +3.960501922282644e-02   +7.020982140274316e-02   +1.522879794525674e-03   +1.144167105977955e-01   +1.431743653090027e-01   -2.292371287201908e-02   -5.896034184823616e-03   +6.633681597912238e-03; +7.500827562212943e-02   +9.201505134434240e-02   +1.499833432794243e-01   +8.821844592652352e-02   +5.347598815443314e-02   -5.975606257928690e-04   +1.011515670697525e-01   -1.064798508404213e-02; +5.456194521646744e-02   +6.289748777084536e-02   +1.725746691900407e-02   +5.173135760949119e-02   +1.147022977700685e-01   +7.460837615259212e-02   +4.027957588348131e-02   +1.630439361866602e-02; +6.138705253271649e-02   -3.714084917898134e-03   -1.251997010003270e-02   +8.587583145222251e-02   +5.065753482609978e-02   +9.722511479529460e-02   +4.100194452526535e-02   +3.752402427728650e-02; -4.641672432536231e-02   +7.991300603635633e-02   +2.417826392964198e-02   -2.226726789436525e-02   +7.444150458253461e-02   +4.896051804336756e-02   +7.772166716771753e-02   +8.912173298000345e-02; +1.362702519814894e-02   +1.974743226855302e-02   +9.205378689929394e-02   +9.639634729376019e-02   +5.174557785047137e-02   +8.981570155480820e-02   +1.081015218532314e-01   +7.430131265397841e-02; -1.054601317739772e-02   +1.222221149932887e-01   +3.335792299827708e-02   +9.389697094253667e-02   +4.485666786302531e-02   +2.414205744196568e-03   +2.656228371201838e-02   +3.273778686721157e-02];
L1I_L2I_iGABA_netcon = [-1.265425753531648e-02   +8.068272465117304e-02   -5.635531122215728e-03   -3.741716427407649e-02   +1.083958600272458e-01   +5.613288890429328e-02   +9.389476782209040e-02   +1.032453423778463e-01   +6.792698029883289e-02   +3.223622257521289e-02   +5.154199214887113e-02   +6.677270371153685e-02   +2.174289120356616e-02   +9.537503222248717e-02   -7.342984515612218e-03   +1.475686024139451e-02; +6.958367515198380e-02   +2.017387880095580e-02   +7.961573896080619e-02   +5.760844123794074e-02   +7.518439144834857e-02   +5.877250684682400e-02   +1.457483764254838e-01   +7.860390676486619e-02   +7.635451669538355e-02   +7.789602486516745e-02   +3.846165813972299e-02   -1.899249979721163e-02   +1.122788922326007e-01   +1.620930263503165e-03   +5.157520624816045e-03   +8.184048210218066e-02; +5.095617503184389e-02   +1.169223955898932e-01   +8.985606994602750e-02   -4.440623778354337e-02   +1.081906663587585e-01   +3.166541622774379e-02   +4.756081284382644e-02   -1.944622291161284e-03   +9.142784618743979e-03   +1.422863205471876e-01   +7.239327324749122e-02   +4.405334922775658e-02   +1.385553727838388e-01   +2.112873043101231e-02   +7.060879754723972e-03   +1.105720791584489e-02; +7.012102779610623e-02   +1.080423868342296e-01   +1.131582120486747e-01   -1.817461236074016e-02   +2.537074942307509e-03   +7.294860495281925e-02   +9.139202231874888e-02   +1.928660186092915e-02   +6.147089312892750e-02   +5.913192988471949e-02   +9.692533772926842e-02   +2.677832123833419e-02   +8.952280282731052e-02   +2.708240299991156e-03   +1.541406058745845e-02   +1.362751735323958e-01; +4.758844886678473e-02   +7.540415586907662e-02   +1.206206615049605e-01   +5.945957864877460e-02   +1.277869824630445e-01   +1.229891120681850e-01   +1.964128421553028e-02   +4.799650640591466e-02   +4.262652319913392e-02   +2.794990246734402e-02   +4.067205540803422e-02   +6.043618436042312e-02   +6.267873157571231e-02   +3.315595161196668e-02   +1.033270491042769e-01   +1.140206317447423e-01; +1.840365049261320e-02   +6.375200190778996e-02   -3.435918808925006e-03   +1.110577021192850e-01   +9.198663256576158e-02   +2.996492665612704e-02   +2.141905645029906e-02   +5.357672553984852e-02   +3.417862008405164e-02   +5.086487789201913e-02   +8.751818918795362e-02   +2.550055001156563e-04   +2.966764555262392e-04   +5.732132820451873e-02   +3.212895164260787e-02   +1.122377993701154e-01; +1.984960505629268e-02   +1.687217670460210e-02   +1.475634105600451e-01   +4.158915398467351e-02   -1.131776695707266e-02   +7.772265014100918e-02   +5.804572200068576e-02   +4.821293140224042e-02   +3.361221534753122e-02   +1.214986255871480e-01   +6.546780284444394e-02   +8.667592336739953e-02   +1.011931654927934e-01   +1.858638208451514e-02   +4.329173885957920e-02   +2.416990793331028e-02; +5.320665631117905e-02   +2.450824883283865e-02   +7.951780013844317e-02   +4.712215135046412e-02   +3.252085960872621e-02   +9.423637134004784e-02   +8.087072678768195e-02   -3.831934525652698e-02   +1.360508450957814e-01   +3.172127652965458e-02   +1.210676955540476e-01   +4.030536534036731e-02   +3.331119825388330e-02   +4.533388732810843e-02   +6.664465575977402e-02   -1.781467080633061e-02];
L2E_L1E_iAMPA_netcon = [+5.749153780291061e-02   +9.304009890346143e-02   +1.494721009603271e-01   +1.000752294088282e-01   +3.882349624766047e-02   +3.391162040424179e-02   +1.960599687616696e-02   +2.665686857781361e-02; +2.043467278267024e-02   +1.609631000943700e-02   +6.559373139218622e-02   +1.688270887671874e-02   +5.108996732761953e-02   -6.586755699585507e-02   +6.283286640347244e-02   -8.942983935054605e-03; -2.574299040253390e-02   +7.027307364624123e-02   +3.408329736409275e-02   +1.146365957037044e-01   +1.017010528723526e-01   +1.173022921743864e-01   +1.318688316758097e-01   -1.983412249415913e-02; +9.569292363171697e-02   +2.466098842530408e-02   +1.713545526532034e-02   +4.464119763231250e-02   +4.933857184363231e-02   +7.999497659826563e-02   +8.035283047882566e-02   -2.171568387411414e-03; +1.196308307628546e-01   +1.070105708596879e-01   +8.943578087354735e-02   +5.815827129408617e-02   +3.874379514446006e-02   +8.725047673920792e-02   +1.001378410105714e-02   -2.864417390423267e-02; +1.376975451525791e-01   +9.599222266203880e-02   -7.525162189107400e-03   +1.160253497556980e-01   -2.945567911501875e-03   +1.106870028817003e-01   +5.622693004910412e-02   +7.503101475351021e-02; -4.475529282921729e-03   +1.026256110700675e-01   +3.535853970468720e-02   +4.114356865005352e-02   +5.366651905693885e-02   +1.418489440096262e-01   +2.505631573281366e-02   +8.970025437698320e-02; +7.180408060102776e-02   +1.753140380070566e-01   +1.332500304862053e-01   +9.974912948975942e-02   +1.080125876625587e-01   +3.852379605461412e-02   +9.285732458459854e-02   +6.839502372982280e-02; +8.041642205260277e-02   +1.807697179040916e-02   +3.559898566882162e-02   +1.253098349224607e-01   +1.504685599159071e-01   +9.139198728817366e-02   +3.969264025602179e-02   +7.550998180513011e-02; +2.539110860677422e-04   +1.145870649162038e-01   +1.070293542801446e-01   +7.176373006430356e-02   +1.016059481167195e-01   +5.855876242692179e-02   +9.600488297513898e-03   +2.479458195440910e-03; +3.852297684298370e-02   +8.227070877804514e-02   -4.253349123569448e-02   +2.081317625806732e-02   +3.255066619408924e-02   +8.399299243711698e-02   +8.527662274311863e-02   -6.588782929148525e-02; +1.184299284373125e-01   +6.821624477065626e-02   +1.975859199351562e-02   +5.151393940821006e-02   +1.147745548770309e-01   +1.455857450003791e-01   +4.794458825373338e-02   +8.144711311553698e-02; +6.298233950613559e-02   +9.838667044134414e-02   +1.714250958780791e-01   +2.776075617362140e-02   +9.190763900871611e-02   -4.203362718755007e-02   +1.226133098143770e-01   +1.184658856822347e-01; +8.075722363454405e-02   +4.622459318700202e-02   +4.286441661735083e-02   +2.840471395062604e-02   +3.812908830608372e-02   +8.524493204878289e-02   +8.314986190878235e-02   +9.489926490850857e-02; +6.247529959213176e-02   +7.689562421863640e-02   -1.405725404801371e-02   +6.776635557000827e-03   +5.390539313008322e-02   +5.205941326277062e-02   +6.609998677506695e-02   +5.119763223616063e-02; +7.831894599135253e-02   +6.711535516539593e-02   +1.005156823290704e-01   +3.902770720522086e-03   +1.063084637199416e-01   +5.724017639604583e-03   +1.095714589583850e-01   +7.287704435722925e-02];
L1E_L2E_iAMPA_netcon = [+1.441565742076408e-02   +9.725061243188296e-02   +1.110033393428385e-01   +9.026112058764998e-02   +6.165760816141796e-02   +5.187363502636340e-02   +6.943884609461444e-02   +1.083546333945799e-01   +8.690021857055910e-02   +5.743512805379154e-02   +1.188443431092726e-01   -4.666568202057797e-02   +1.253650376427613e-02   +5.820791115718013e-02   +6.782419260680254e-02   +1.211242442668086e-01; +7.195855102495644e-02   +8.186205114547815e-02   +9.301823864990802e-02   +2.386223505322686e-02   -7.609339555794968e-03   +7.646360787219723e-02   +4.540214901770180e-02   -2.657083666408017e-02   +1.199023871998671e-02   -4.166560829490062e-02   -1.783630903107693e-02   +2.553641502896250e-02   +5.295914545960192e-02   -5.098869049674959e-02   +2.292658254887849e-02   +4.553140994949771e-02; +1.047809619862656e-02   +5.121568596514556e-02   +1.274777474243675e-01   +4.191817781089704e-02   +7.509855813740840e-03   +5.457125883276576e-02   -5.824507157240744e-02   +7.540829170390964e-02   +4.560071048735902e-02   -1.122374282767653e-03   -1.518271291083332e-02   +7.751916330076601e-02   -3.460771527478977e-02   +8.124047588624051e-03   +5.901791328763008e-02   +6.644487855923499e-02; +4.982649922972086e-02   +7.548084533812185e-02   +2.500068577489443e-02   +1.279949015380520e-01   +7.481171715774006e-03   +9.125853824743234e-03   +1.469322888770573e-03   +1.073192216287699e-01   +1.036178403028923e-01   +1.261700182011431e-01   +4.188359720284832e-02   +4.506248232874412e-03   +2.231567327760158e-02   +4.035382211635534e-02   +5.972554297811931e-02   +1.295145311095527e-01; +6.003577336519095e-02   -3.190244869211733e-03   -2.688433875876721e-02   +1.126721926346027e-02   +1.350485937882062e-01   +1.422852342176564e-01   +1.446385880760259e-01   +5.854844062908545e-02   +2.699053563821990e-02   -8.126349076943793e-04   +1.772334221616766e-01   +2.710439725780647e-02   +6.849392331120735e-02   +1.053315304115595e-01   +3.989691618852536e-02   +2.395119931859607e-02; +2.002076747317807e-02   +4.132753709341937e-02   +3.002802033168562e-02   -1.773247527081047e-02   +5.548404353777056e-02   -1.016438083910138e-02   +6.631206154793313e-02   +9.409560220306794e-02   +9.746503132595381e-02   +4.564376066825945e-02   +4.287851194811004e-02   +1.172054637036460e-02   +9.945528557645575e-02   +1.107898270907059e-01   +1.147410605256302e-02   +9.257544233870720e-02; +4.205024005886805e-02   +1.889490508780622e-03   +2.829939636313975e-02   +5.966292312116205e-02   +1.137470780775988e-01   -4.313304662737084e-02   +3.462234509327487e-02   +4.618442793650392e-02   +1.010069520561487e-02   +7.076243963428014e-02   +3.641329993893798e-02   +5.779182755247392e-02   +8.267210542701706e-02   +1.120952795100256e-01   +1.610180448282376e-01   +6.021082902682410e-02; +1.399477195339573e-02   +2.575846463114866e-03   +1.351363886309821e-01   +6.976139360796127e-02   +7.467156753412284e-02   +1.710946999161222e-02   +7.695121275234339e-02   +1.856213499736641e-02   +4.515734372723777e-02   +1.134698061234702e-01   +9.376969017444134e-02   -5.288666914446271e-03   +9.516662177408527e-02   +2.619085560843992e-02   +1.105851871166277e-01   +4.429327077631526e-02];
L2I_L2E_iAMPA_netcon = [+4.544668647365245e-02   +2.840228678001400e-02   +1.884827834777890e-02   +9.491406174543589e-03   +8.247372665148099e-02   +6.917963720609085e-02   +7.225210340347776e-03   +4.150513090432155e-02; -9.905747613507395e-03   +8.576292986716991e-02   +1.564249107510707e-01   -2.061568750736181e-02   +3.449792623614463e-02   +2.266424772737451e-02   -4.095545308877051e-03   +5.119528540937068e-02; +2.046144569028383e-02   +1.064701351261611e-01   -3.714631150137976e-02   +4.597866531741257e-02   +5.888846625413567e-02   +1.292276964658883e-01   +7.124604490447461e-02   +2.346372723611883e-02; +5.200289846818801e-02   +9.907154868336204e-02   +9.067030901380922e-02   +3.428629166102271e-02   +7.964611120854984e-02   +8.233138469343129e-02   +2.524644039910622e-02   +4.826532517706947e-02; +6.006846739378746e-02   +1.036275004681078e-01   +4.555498947226783e-02   -2.935242578913271e-02   +2.696927038798651e-02   +1.202292117233394e-01   +5.681112412652183e-02   +1.017930511354429e-01; +4.613283143764338e-02   +3.118801432464267e-02   +1.551429398609887e-01   +5.788994876290842e-03   +5.570252089928079e-02   +1.081469903165151e-02   +1.014967000095001e-02   +3.546103034133645e-02; +2.057642236892959e-02   +6.938911250022120e-02   +1.402037668656042e-01   +4.117536525826990e-02   -1.548548199322425e-02   +6.152302882880949e-02   -1.892467464702863e-02   +1.215494172190109e-01; -7.312326441255103e-03   +7.330664901349700e-02   +1.069397860024780e-01   +9.045972662456381e-02   +1.584314102454832e-01   +1.042862530070767e-01   +9.101363994042830e-02   +1.425359141585576e-02];
L2E_L2I_iGABA_netcon = [+4.437087823682789e-02   +7.465882926068666e-02   +6.502813180972231e-02   -3.652497100873196e-02   +1.382591385680019e-02   +1.125308571092364e-01   +6.300978344946678e-02   +3.124282547818425e-02; +1.447466872510038e-01   +7.764247402678304e-03   +3.243660389275331e-02   +1.231968547059748e-01   +2.727403322612206e-02   +3.104065272267897e-02   -4.107681284014211e-02   +7.326920125676215e-02; +7.201084384628226e-02   +5.325763269775495e-02   +1.042919701880342e-01   +7.201194814149578e-02   +4.264389375221851e-02   +1.040278405717588e-01   -6.059685297040748e-03   +1.792293082568995e-02; +7.871867975378001e-02   +5.515348436357129e-02   +2.523078747769127e-02   +3.165767388673237e-02   +3.567965012449084e-02   +1.473617874483196e-01   +5.114900558042142e-02   +6.725150530020266e-02; +8.263924091690900e-02   +6.131513749138994e-02   +8.723942243207977e-02   +2.805204364584513e-02   +3.344466727600004e-03   +5.413139778537735e-02   +9.670284675134763e-02   +2.156771840447112e-02; +7.922073044066645e-02   +3.833395936031486e-02   +3.977918425987710e-02   +3.617980336470540e-02   +7.572808334945842e-02   +1.041773230797011e-01   +7.624386630612660e-02   -2.908987452667961e-02; +1.322210454751647e-01   +3.982470678095086e-02   +6.960042066406213e-02   +3.145872913299660e-02   +9.763606933933695e-02   -7.947663829163374e-03   +5.214747048230757e-02   +1.303228394179866e-02; -6.531760678942931e-03   +3.736793777924780e-02   +3.249647189370121e-02   +1.340781568044661e-02   +7.266960018128043e-03   +6.644181768478401e-02   +2.702931128475221e-02   -1.937950073430284e-03];
L3E_L2E_iAMPA_netcon = [-8.478797904467381e-03   +3.413344165823561e-02   +2.430673551489494e-02   +4.255610389336502e-02   +6.895555778118551e-02   +7.121559514345938e-02   +1.381175624466216e-01   +5.356721000587450e-02   +8.657165211311310e-02   +8.345667322328018e-02   +4.287510812868575e-02   +8.993360997322647e-02; +2.329573980486125e-02   +1.295634354689250e-01   +1.018982910779944e-01   -1.154462223766704e-02   +5.588053734227373e-02   +1.062825688598989e-01   +3.408739596625290e-02   +3.164675024238716e-04   +9.379066792898484e-02   -1.115008337475490e-02   +1.176297825854865e-01   +9.134871009288724e-02; +8.879354150309053e-02   +8.880561207587559e-02   +1.033629611719095e-01   +8.714346977667724e-02   +2.798275598449179e-02   +5.778574597794921e-02   +1.073435756029205e-01   +1.377968655333437e-05   +2.496588295421166e-02   +1.121940365228438e-01   +6.554323784275351e-02   +3.356072100431174e-02; +7.008313901497482e-03   +8.276958154419940e-02   +4.324389987431861e-02   -2.639048758589915e-03   +1.015372025299802e-01   +6.773539124963700e-02   -6.627268897455344e-03   +6.947886217412083e-02   -4.241697710790624e-02   +9.501037506777558e-02   +9.412954359649081e-02   +1.366414873557441e-04; +5.942729625115196e-02   +1.111353701363785e-01   +1.061230390744522e-01   +1.159488203760071e-01   +7.289988322209542e-02   +1.199912186720246e-01   +4.340774990962686e-02   +5.169108891595656e-02   -3.763231886393058e-02   -1.288671907499451e-02   +1.091209248326598e-01   +4.464869152913904e-02; +5.297290382415114e-02   +3.472714704076352e-02   +6.115836059926982e-03   +5.800944263012678e-02   +1.070110150497459e-01   +7.436772238605959e-03   +1.110263794907002e-01   +1.154032432226452e-01   +9.530241671227516e-02   +6.689055691138998e-02   +3.752542702154490e-02   -1.322839749985580e-02; +7.311527243124410e-02   +4.897944326038543e-02   +6.809381995725093e-02   -2.215818812502255e-02   +1.621158955165919e-02   +2.874026928191370e-02   +2.169485976070460e-02   +2.036659309709638e-02   +5.547819646421801e-02   +1.573212759523748e-03   +1.310276756985400e-01   +1.284751060768600e-01; +6.689564806336509e-02   +9.905556737418098e-02   +7.734559292679030e-02   +6.793647812684928e-02   +7.148844153940656e-02   +6.951645295354147e-02   -7.855466136655223e-02   +3.853418796797946e-02   +1.034245364556191e-02   -2.892943704799782e-02   +1.168914417620756e-02   +4.843218812431983e-02];
L3I_L2I_iGABA_netcon = [+1.170885509683879e-01   +1.163573797366375e-01   -2.921759046796020e-02   +9.002481775794099e-02   +1.008791424642378e-02   +9.605505243378164e-02   +9.778673353030848e-02   +3.124953500651225e-02   +2.474322393236314e-02   +5.686283734404043e-02   +7.352542952759802e-02   -8.843958511807803e-03; +2.127958474216432e-02   +9.380158229371091e-02   +4.014768244205687e-02   +1.739142247316353e-02   +4.423243689646565e-02   +3.180502428631388e-02   +1.096664352310486e-01   -1.713208137564473e-02   -4.515985442619382e-02   +1.025419046981907e-01   +9.438164852323877e-02   -2.634540518602336e-02; +6.542085553555846e-02   +1.184348235134205e-01   +8.579926314111702e-02   +4.847617598798006e-02   +9.913652721880692e-02   +5.977719932459608e-02   +3.121782558092668e-02   +2.149812172510065e-02   +1.132733747579737e-01   -2.019760693531127e-02   +1.143650325370650e-01   +5.432884180400095e-02; +5.836811409247291e-02   +1.414522401297682e-01   +1.017736779574131e-01   +3.486008352658348e-02   +1.258396551239342e-01   +1.480339664879678e-02   -1.730110816470010e-02   +2.215601754880392e-02   +1.145682025975158e-01   +7.369274861871355e-02   +1.459905550359119e-03   +9.255089744800690e-02; +5.804080876729130e-02   +6.928607207606302e-02   +9.788573142413995e-02   +6.968939085901214e-02   +1.195055536184313e-01   +2.153793126349128e-02   -5.848742017315251e-03   +1.060991532927098e-01   -1.528099761464990e-02   -1.261655754667619e-02   -1.971250674730273e-02   +6.229913363451987e-02; +5.544756747160203e-02   +9.849911774960578e-02   +1.279475585964335e-01   +8.106889623434486e-02   +4.015839641780478e-02   +9.300498092692797e-02   +5.896908088574412e-02   +7.216794512218158e-02   -5.158307303748621e-03   +4.829414153777833e-02   +7.439720800693563e-02   +6.668291273621058e-02; +2.950719586961412e-02   +2.580318524094413e-02   +1.093669041974208e-01   +1.085236924854530e-01   +5.390938476964936e-02   +7.740430473205726e-02   +2.517116853255183e-02   +6.049306918834515e-02   +3.254742376736462e-02   +6.441952568238249e-02   +9.862748434569797e-02   +6.570730108680554e-02; +2.308511037529285e-02   +1.133945356425745e-02   +8.555576110481503e-02   -2.027746604086693e-02   +9.866287567698581e-02   +9.912416501282323e-02   +9.672695522234126e-02   +9.447007109589522e-02   +6.222128051024539e-02   +8.772249098241494e-02   -5.050481769468975e-03   +6.482025574758715e-02];
L2E_L3E_iAMPA_netcon = [+1.635919527464310e-01   +5.748587933064885e-02   +1.229694940662925e-01   +6.250389075292877e-02   +1.031200310963932e-02   +6.681470098967024e-02   +3.603885266494788e-02   -3.767669929155296e-02; +7.719608366958750e-02   +1.289350785635245e-01   +7.082620774784756e-02   +5.511865932900328e-02   +1.451212855596935e-01   +4.040471900298093e-02   +5.127087008037937e-02   +1.102903858165953e-01; +9.411375647660565e-03   +4.952780023537420e-02   +2.131958104939454e-02   +5.486417161022592e-02   +5.988797218755731e-02   +8.332369791411204e-02   +7.975257603328539e-02   +3.553995649796670e-02; +2.661500683114602e-02   -6.358500287210544e-03   +6.939540407377161e-02   +1.089190517867502e-01   +7.491481678335338e-02   +1.452390601768067e-01   +8.307194474182918e-02   +6.991750711231867e-02; +8.071342668109127e-02   +1.357826571254472e-01   +1.164551890077581e-01   +8.049972829228622e-03   +1.241379246809299e-01   +8.048734927363370e-03   +4.494212726917912e-02   -4.452756292943298e-02; +6.231527580144398e-03   +1.295659352464556e-01   +5.506908204389546e-02   +2.278031933591957e-02   +1.633498928241195e-01   +7.785901299147231e-03   +3.519493130301999e-02   +5.094955321818004e-02; +8.311120847525709e-02   +1.447851543252083e-02   +8.773028225158177e-03   +3.487140090112691e-03   +4.508737237435362e-02   +1.017388004791157e-02   +4.447164710685195e-02   +5.725762926527369e-02; +7.592972999571938e-02   -2.397254960613172e-02   -4.423295422330448e-03   -1.080171115479806e-02   +1.122411435086777e-01   -3.398450948141617e-02   -2.309638030781588e-02   +6.273401432295297e-02; +1.215220625554797e-01   +1.269473340047267e-01   +8.360583944829986e-03   +4.758111340724913e-02   -1.012537375881082e-02   +3.132077351791668e-02   +1.285740076057635e-01   +8.563702112387211e-02; +3.631804071770584e-02   +3.141600355184029e-02   +4.820218274396977e-02   +1.195316780361907e-02   +8.515082761728038e-03   +2.107331912681253e-02   +6.436896076836743e-02   +6.932163908849051e-02; +4.018322357600712e-02   -1.072415973858585e-02   +6.821857691152095e-02   +5.204086249184802e-02   +1.385427099723601e-02   -2.067048171570606e-03   +1.055309894913502e-02   +9.556907942617124e-02; +6.307936246017390e-02   +7.225227340499414e-03   +1.407232578038530e-01   +8.486596299380736e-02   +4.214703055286380e-02   -1.568777349488184e-03   +6.024871606502737e-02   +7.106143818273986e-02];
L2I_L3I_iGABA_netcon = [+6.750101822262043e-02   +3.325574534090144e-02   +4.267685897857047e-02   +6.763909717712302e-02   +3.710785347188987e-02   +5.562512283105214e-02   -4.273005275743496e-03   +6.640067031579927e-02; +2.181341750756552e-02   +1.181666433540961e-01   -4.005828234327961e-03   +9.630067506795895e-02   -2.236916866480319e-02   +9.635283492804458e-02   +2.047420090934483e-02   +5.222174970087771e-02; +5.586981134101439e-02   +1.202577702981665e-01   +9.401039791223370e-02   +9.030260025731322e-02   +2.025682855963618e-02   +3.309029134130925e-02   +7.230842549509939e-02   +1.171022051861220e-01; +7.162432540318904e-02   +1.031242328900761e-02   +7.525897415238332e-02   +5.700825779974413e-02   +8.537671234768373e-03   +2.832992146113857e-02   +5.859303788332663e-02   +4.038492492164790e-02; +5.379433417112386e-02   +1.338859111369328e-01   +1.034438701409013e-01   +1.141448802678085e-01   -1.524270796957409e-02   +7.478398873536207e-02   +7.623366912954224e-02   +1.742330694585252e-02; +9.175128553949082e-02   +8.813451522197975e-02   +5.813665531851360e-02   +1.440262003443389e-01   -9.666605864286387e-03   -7.192685404854184e-03   +8.702159710668740e-02   +5.335199784206909e-02; +1.755930110430956e-02   +8.341161721099147e-02   -4.558213333201059e-03   +1.029583074640736e-01   +7.372427512829027e-03   +6.874752915275549e-03   +2.898687440938445e-02   +5.017705893518063e-02; +1.846820678090636e-02   +5.045449513042695e-04   +8.682001438041673e-02   +7.541691069572264e-02   +1.065583778820909e-01   +3.132156600349533e-02   -8.753267705250145e-04   +2.024390479526472e-02; +4.408574776665969e-02   -7.024614694798051e-03   +8.400257086700416e-02   +1.508397733310930e-01   +7.945782291017650e-02   +3.015554091851214e-02   +2.525391560160409e-02   +1.158956673766817e-01; -2.123953780794487e-02   +4.954444438356495e-03   +1.857720330521404e-02   +9.493036560124828e-02   +1.049536239567558e-01   +2.581615455722306e-02   +9.116470309848410e-02   +4.267648315048586e-02; -1.733516589763939e-02   +1.550873861450265e-01   +1.741865490313035e-02   +7.658578921852519e-02   -6.607667324020484e-02   +7.668502511460715e-02   +3.101514739254943e-03   +6.030502857858801e-04; -4.935572870171179e-02   +2.176991788265718e-03   +7.864874154246472e-02   -3.971248500879570e-02   +8.003447936993484e-02   +8.434564937214081e-02   +3.496969788830831e-02   +1.603936939021057e-02];
L3I_L3E_iAMPA_netcon = [+3.819832305168890e-02   +2.318473273019889e-02   +5.839327974321101e-02   +1.021061938301148e-01   -1.116403906645000e-02   +1.096329090190330e-01   +6.943455668119290e-02   -1.988502405704420e-02   -2.003698526710485e-02   -2.017022618549633e-02   +1.185079819753723e-01   +3.316548648643257e-02; +4.277207866679889e-02   -1.213138900842635e-02   +1.625556243910914e-02   +1.379100141006759e-01   +4.906304296858240e-02   +5.830923865742014e-02   +7.949963199581553e-02   +6.874571535770947e-02   +4.248928567498915e-02   +1.358027715598673e-02   +5.421486818477010e-02   +8.390140967155908e-02; +1.453641216278667e-03   +1.079423371589527e-01   -2.348571250418745e-02   +2.663215653789777e-02   +9.550376329477003e-02   +9.976100480703515e-02   +4.109999598292143e-02   +2.864225666008952e-02   -3.547132073471160e-02   +9.546843668902934e-02   +4.103883582745767e-02   +9.652146418858362e-02; +9.080256972180002e-02   -1.758850545314319e-02   +1.765145612286240e-02   +9.471270930137939e-02   +1.071682680876701e-02   +5.916935316061030e-03   +7.384787725993999e-02   +5.690942481312558e-02   +9.624353733429450e-02   +9.821398824489390e-02   +7.269017372103127e-02   +4.829603070659771e-02; +1.356762918319405e-02   +9.467007325068157e-02   +1.575034142786054e-02   -3.899338896211926e-02   +5.411753827144320e-03   +1.034516849799282e-02   -5.620577530532350e-02   +7.425665691542153e-02   +4.990841744487102e-02   +2.648074544799717e-02   +8.242818291583341e-02   +1.049119972392327e-01; +5.250249202113699e-02   +7.424696846505971e-02   +7.527522679378630e-02   +1.177740340127299e-01   +7.264967159564982e-03   +5.921460889524242e-02   +4.056219491206824e-02   +3.980713467747324e-02   +4.918997666219831e-02   +8.091389863832467e-02   +9.258457003397981e-02   +7.207667565202928e-02; +3.381375141954189e-02   +4.986481154865208e-02   +1.043131525528599e-01   +6.898619002631849e-02   +6.783731266582543e-02   +4.458968468794017e-02   +1.010666555956942e-01   +1.513688959312408e-01   +4.189570357093847e-02   +1.447973433567822e-02   -2.546733185151769e-02   -7.139485456503692e-03; +1.219116813822545e-01   +7.143819238342504e-02   +5.856245589673452e-03   +1.016499054425507e-01   +2.078016286265862e-02   +1.783705632562931e-02   +5.464383157587294e-02   +1.420781720367817e-01   +1.176939316949742e-02   +1.028339308388808e-02   +1.600752136731850e-02   +1.338700307922529e-02; -3.815860026529239e-02   +4.344086372074344e-02   +4.162341379628075e-04   +3.975428376807495e-03   +7.406231681002648e-02   +5.106095595727604e-03   +5.575559381027847e-02   +1.430609636654854e-02   +5.501027463710555e-02   +6.933768020194092e-02   +6.228219603334325e-02   +9.455344693824073e-02; +1.019156140130072e-01   +2.035763651226533e-02   +5.474923936166627e-02   +5.133633379780383e-02   +2.994597009041730e-02   +5.566376785209732e-03   +3.806451242058580e-02   +1.087981686130928e-01   +5.051746460684575e-02   +4.743479862598770e-03   +1.323307267499326e-02   +2.883261098697008e-02; +7.606218742350164e-02   +4.041933472294375e-02   +5.473314292089481e-02   +3.460015148950971e-02   +1.926300801834656e-02   +7.449923532425810e-02   +8.952203849865215e-02   +9.376124538976807e-02   -1.597096520071262e-02   +9.467141030272698e-03   +2.173517596381434e-02   +4.006629556544747e-02; +9.008730928706499e-02   -7.895105401504076e-03   +6.078061763853392e-02   +1.375606288636709e-01   -3.205718717353482e-02   -9.279817722208355e-03   +1.270375565957681e-01   +2.031010387916354e-02   -2.043257573643580e-02   +1.777135500041021e-02   +1.352787381021459e-02   +1.396897055705726e-01];
L3E_L3I_iGABA_netcon = [-1.401804899209454e-02   +8.395024888356629e-02   +3.787651337128152e-04   +1.261467437969479e-01   +1.149906671898543e-01   +1.030545139582748e-01   -3.728259248879433e-02   +2.564894113452579e-02   +1.438025526818580e-01   +8.509059404024244e-02   +1.162509811367251e-01   +5.505903726850236e-02; +2.494796240623253e-02   -2.845427365769598e-02   +1.348010846400205e-01   +9.674285189250306e-02   +6.439780506698466e-02   +4.467786244143009e-02   +1.054700356552738e-01   +4.443044183014069e-02   -1.815641369270863e-02   +1.232146368810462e-01   +6.903101492461881e-02   +6.522363372587625e-02; +3.135896313744872e-02   +9.137219285968061e-02   +7.521784012260674e-02   +1.026343295789102e-01   +4.212836587629731e-02   +7.731169275685032e-02   +2.676220535574571e-02   +5.843452069665397e-02   -4.501766265090164e-02   +8.146150864943554e-02   +5.762843524613469e-02   -3.047615626889918e-02; +6.126711474851478e-02   +8.391350479931634e-02   -3.782503431668509e-02   +1.327603661890366e-02   +3.071317267498437e-02   +1.466363324925467e-01   +6.072641346148351e-02   +6.286228218787697e-02   +7.222364558810334e-03   -1.768188826654396e-02   +7.577614406095792e-02   +4.215346742273733e-03; +1.045612946207343e-01   +1.034159345278783e-01   +1.367436839460031e-01   -3.950430044983773e-03   +4.861421728070166e-02   +1.079694734426894e-02   +1.123930625938417e-01   +2.480907786425083e-02   +1.356707590639623e-02   +1.337740062419890e-01   +3.055859786233590e-02   +8.104902057356501e-02; +3.517135579996600e-02   +4.080666014130945e-02   +5.126244433521326e-02   +5.053497760677326e-02   +5.428964051486665e-04   +1.375433942908595e-01   +3.225507136941097e-02   +4.250601395117067e-02   +2.975721959737952e-02   +1.008917950895498e-01   +4.950862475150217e-02   -2.967587599260864e-02; +5.671063592428235e-02   +7.263721533553891e-02   -2.806778746577292e-03   -6.781524254645441e-03   +3.114268410076135e-02   +1.309555507983030e-01   +8.830644520277157e-02   +1.003606178818288e-01   +4.504889115191989e-02   +7.092490656648687e-02   +7.694041264464253e-02   +3.701532182169151e-02; +8.005947177365758e-02   +9.425575734242243e-02   +8.585469459832214e-02   +1.433264504711333e-01   +9.454941815002611e-02   +3.396234255528272e-02   +5.661252950424196e-03   +6.681348597171255e-02   +2.374239574687253e-02   +3.044660930993264e-02   +8.979732404953236e-02   +5.453483598754384e-02; +7.444622139582796e-02   +4.298651939329808e-02   +4.903316107538777e-02   +2.322318784970327e-02   +1.302676549596101e-01   +5.245474917434046e-02   +2.522081389139378e-02   +6.301253824377741e-02   +4.401403824012336e-02   +1.105387072292431e-01   +7.655255547658620e-02   +8.332592157426714e-02; +3.725018672204219e-02   +3.249819331982826e-02   +5.146869957998729e-02   +4.383674274265375e-02   +1.359924206065559e-02   +5.979417286798970e-02   +3.140627702319992e-02   +3.217113855888726e-02   +2.074914216415844e-02   +1.047612356308330e-01   +2.768767933722384e-02   +8.605167170455617e-02; +8.641030978004426e-02   +3.769744337620649e-02   +2.150027829473644e-02   +1.357617077650202e-01   +2.795279108864311e-02   -3.247461887709933e-03   -7.556253399811206e-03   +5.613568352996794e-02   +2.534176923570527e-02   -4.714389336558025e-02   +1.420596330361127e-01   +1.105721083074449e-01; +6.108064376128740e-02   +9.021855854219296e-02   +3.462666113396059e-03   +6.896065241903185e-02   +1.103627018653558e-01   +2.638359666482553e-02   +9.896012277474286e-02   +7.271353474048003e-02   -1.797698637203236e-02   +3.678442914465993e-02   -3.713324432482677e-03   +2.686627876803885e-02];
L2E_Input1_iAMPA_netcon = [+8.019805673717527e-02   +3.818463335955290e-02   +6.072121617793807e-02   +4.410358195547233e-02   +7.698295992525327e-02   +2.445966896250756e-02   +7.589472445914780e-02   +9.724416752017605e-02];
L2I_Input2_iAMPA_netcon = [+6.904783936988176e-02   +2.718057728440335e-02   +1.491889351622148e-01   +4.726169617826580e-02   +7.922922506565840e-02   +6.028323636263473e-03   +9.927880566049765e-02   +1.049639679178966e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
