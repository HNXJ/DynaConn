function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.472597679632204e-01   -1.023477119234690e-02   +2.999565403985560e-01   +1.724081828995729e-01   +1.648794484640027e-01   +1.153106445835318e-01   +2.287430077700766e-03   +5.156636818850062e-01   +7.560798392046156e-02   +7.294167796215542e-02   +2.077086104354590e-01   -1.169483914183118e-02   +2.080176586078881e-01   -4.115916241357459e-04   +1.355407153470140e-01   +2.920859793099530e-01; +2.028141033475254e-01   +2.638070908040003e-01   +2.569479086983455e-01   +9.324184504606184e-02   +3.075234550057689e-01   +3.016287407192388e-01   +5.509862399075809e-01   +6.068525689707789e-01   -4.469309416511651e-02   +2.016440155939903e-01   +2.792010436843880e-01   +3.022346882774604e-01   +1.783564682721466e-01   +1.760951802941092e-01   +3.162343696228400e-01   +2.198794522754625e-01; +3.060583359067497e-01   +2.888286370117172e-01   +3.538650117992769e-01   +2.731001117638389e-01   +1.157598066895581e-01   +4.101092191836923e-01   +4.513571454339319e-01   +3.279612457989073e-01   +2.727981563694950e-01   +7.143219648121490e-02   +4.473472596152746e-01   +5.653641661182313e-02   +4.714332876177795e-01   +4.172572864852733e-01   +3.000415551391658e-01   +3.441719129031612e-01; +1.573555475675352e-01   +4.071937505047473e-01   +2.226383733065546e-01   +4.968328466459322e-01   +6.238687097395004e-02   -1.019270165827710e-02   +2.183758684303206e-01   +2.147782103221968e-01   +3.926922995527002e-01   +2.083445393572005e-01   +9.226288706393183e-02   +6.707956632547904e-02   +2.028855454896674e-01   +3.847175627865467e-02   +3.913782942493101e-01   +2.523137310972198e-02; -1.280199820005634e-01   +5.617858927300853e-02   +5.146173655739081e-02   +2.714114535765562e-01   +5.072340461326769e-02   +2.196653719340637e-01   +2.152212230120516e-02   +2.891832508140723e-01   -1.151387154721048e-01   +3.170190674730223e-01   +4.918309339406944e-01   +8.359924865408323e-02   +2.791733745619881e-01   +4.800199780276446e-01   +5.183839968674785e-01   +4.213496673909286e-01; +4.701578441354406e-01   +1.563327672032716e-01   +2.987306140267457e-01   +3.651970050249566e-01   +3.925048512550902e-01   +4.861740733824545e-01   +3.919794159914631e-01   +1.083577233144305e-01   +2.928675478289112e-01   +2.733768057175316e-01   +3.756135021024126e-01   +2.785557382078689e-02   +8.585808056328778e-02   +4.969413396858318e-01   +5.268688443468592e-01   +3.219383065317670e-01; +3.249610838383148e-01   +1.079671989645718e-01   +3.139466856798248e-01   +3.544080716820122e-01   +2.397583445318236e-01   +2.924522738063013e-01   +4.647469649703505e-01   +4.234656186932272e-01   +1.607877292542157e-01   +2.316664239369608e-02   +4.076028392462763e-02   +4.805907811597674e-01   +1.946371380489436e-01   +6.036113428923164e-02   +4.103249332423073e-02   +3.480227157296226e-01; +2.214200325055143e-01   +3.002604209061085e-01   -5.687790087549219e-03   +3.128104943970991e-01   +1.819292993999944e-01   +1.275593010577448e-01   -1.265234024689799e-02   +2.945108298773270e-01   -4.439537414921525e-02   +4.949215093922958e-01   +3.862239445009159e-01   +2.884665926914461e-01   +2.982673681993508e-01   +3.144549904956402e-01   +5.636558087684083e-02   +3.706678244051477e-01; +1.382069798858362e-01   +5.987993777342118e-01   +2.167968928123100e-01   +2.943859396586768e-01   +5.474495489236880e-01   +2.776426783071647e-01   +4.813550802175736e-01   +2.412197589101901e-01   +1.186432783474912e-01   +4.114771825642683e-01   +2.143971099247192e-01   +6.235212403889885e-01   +3.212867315092403e-01   +8.081893553728631e-02   +4.368485603466825e-01   +3.506486324620323e-01; +3.238414255845766e-02   +8.118071184801634e-02   -4.897115518000512e-02   -2.355284676595783e-02   +9.080972659905069e-02   +3.556446141475007e-01   -2.152760993014011e-02   +7.769782187857951e-02   +3.758779399029850e-01   +4.055286242969761e-01   +1.380482306537621e-01   +2.577820665201974e-01   +4.262782720836230e-01   +1.872236334152159e-01   -5.845251910687002e-02   +4.277197865270799e-01; +5.346209739926108e-01   +2.834817866885033e-01   -4.927396405904279e-02   +5.228319607558761e-01   +1.438293276678285e-01   +1.068271757944942e-01   -2.607029975404891e-02   +3.901440214012831e-01   +2.721572322275766e-01   -1.350125826046332e-02   +2.501772587545560e-01   +3.234918274753504e-02   -1.697021766962287e-02   +8.306132539287721e-02   +9.288300907279873e-02   +1.839494631368511e-01; +1.426798050797256e-01   +1.161018288997038e-01   +1.913890280234857e-01   +1.489925198607394e-01   +1.529374279060522e-01   +6.613294908895187e-02   +6.033128034905050e-03   +4.227429274230385e-01   +4.786354943821139e-01   +6.418529842371401e-02   +2.996928979499071e-01   +2.493102128154116e-01   +4.358095863992572e-01   +4.100059944298204e-02   +1.299749451517624e-01   +9.801400965557551e-02; +2.183776053623604e-01   +6.496065202272043e-02   +1.585578162461339e-01   +5.172582039234377e-03   +1.005287398711400e-02   +1.559096155187438e-01   -9.166633625639029e-02   +4.691595209199188e-01   +4.942109164345068e-01   -2.763185089938728e-02   +2.003414802799878e-01   +1.288228599572443e-01   +3.889443475028100e-01   +1.796033678302043e-01   -1.295424677431600e-02   +3.380264063171345e-01; +2.025997885035400e-02   +6.696458609230264e-01   +3.992305072774680e-01   +2.098143110064443e-01   +1.321600296750017e-01   +3.919667711590676e-01   +2.213820193323437e-01   +4.510686105055124e-01   +2.856642033522744e-01   +4.741833848335313e-01   +4.891635616912812e-01   +3.557596174160078e-01   +5.006242625335030e-01   +1.543301495587955e-01   +3.943053602249887e-01   +1.612486028517424e-02; +3.153143064061529e-01   +4.723458288237502e-01   +1.169599246998390e-01   +4.824599042828307e-01   +5.459091783631584e-01   -2.958317626357358e-02   +6.027956684093839e-01   +3.204089605594052e-02   -6.777430268556986e-02   +2.949187050621879e-01   +8.623935946008199e-02   +1.173413110737184e-01   +1.277054188400036e-01   +2.629925456883481e-01   +2.141535527622193e-01   +3.102295672073250e-01; +1.917771980058667e-02   +4.263932965690861e-01   +2.072355740474067e-01   +1.957688415119497e-02   +1.796944491369662e-01   +5.959332869911895e-01   +1.592076170702997e-01   +2.575831884045173e-01   +3.413741358326411e-02   +2.797189816297573e-01   +2.788796134542975e-01   +3.866803436827619e-01   +3.286749962255330e-01   +4.157795336750738e-01   -1.733315673563242e-02   +3.005722838611180e-01];
L1E_L1I_iGABA_netcon = [+4.084904054099730e-01   -1.559532594948862e-02   +1.156797496022626e-01   +2.647291602749843e-01   +7.710928192404100e-02   +2.309583727276806e-01   +2.527769011525978e-01   +1.373675210601907e-01   -3.725777169616654e-02   +3.668793628121633e-01   +2.828290231687130e-01   -1.290733793179547e-01   +4.396353731964550e-01   +3.310541649808864e-01   +4.939196080629346e-01   +2.188969428391817e-01; +1.897409357667686e-01   +3.979836167524011e-01   +2.227823926938400e-01   +3.069305842468003e-01   +3.536636149540337e-03   +1.539442359484346e-01   +3.290974350677363e-01   +1.951960146236242e-01   +3.370241566874891e-01   +1.748806626844422e-01   +1.526689059246090e-01   +1.865587104883024e-01   +1.982636469720835e-01   +5.116099811334476e-01   +1.268293268351073e-01   +3.847464320335854e-01; +2.130725399422846e-01   +4.018254267044862e-01   +3.808170775948945e-01   +9.109897565095126e-02   +1.478294473903076e-01   +1.905028338096517e-01   -7.414381077411450e-02   +1.186772357497010e-01   +3.542323496991674e-01   +1.229629795828512e-01   -4.954854808595426e-02   -1.049555446393355e-01   +3.158601184263368e-01   +3.049237843906046e-02   +1.737501482779265e-01   +8.800454983930035e-02; +4.720796630482572e-01   +2.629248785724440e-01   +2.722684974923566e-01   +3.293629527080948e-01   +2.617313336133154e-01   +1.305140731829376e-01   +3.012142150784642e-01   +2.454544871890094e-01   +1.367130073144860e-01   +2.984890594649202e-01   +1.076820482081989e-01   +1.139031558954146e-01   +3.750617041700208e-01   +2.262465337721082e-01   +1.964773075401501e-01   +3.345543265680748e-01; -5.849931837447973e-02   +5.967796207480542e-01   +4.015590701946737e-01   +1.000998941478490e-01   +4.355617600448392e-02   +5.092347038205501e-01   +5.428361416904162e-01   +2.070006429592688e-01   -1.100556135071575e-02   +1.884569686132632e-01   +4.677450778488785e-01   +2.822651424901067e-01   -5.899786673382529e-02   +4.185368911344387e-01   +5.824657298453294e-02   +1.439311041323468e-01; +2.035480106430504e-01   +3.481357030292924e-01   +3.971955607077417e-01   -1.899852676948485e-01   +1.007161549417152e-02   -6.523718948789201e-02   +3.209198992313871e-01   +1.301173443763070e-01   +3.430127143012791e-01   +4.528970068620561e-01   +9.268447833227605e-02   +3.347090669220846e-01   +4.924105634245947e-01   +3.135825939248007e-01   +7.747934793925236e-02   +2.552351727432063e-01; +3.733952946213838e-01   +2.119070635332918e-01   +4.972365033111146e-01   +1.360233870880887e-01   +3.939866991180185e-01   +1.052129741599424e-01   +6.708742197454656e-02   +2.360509983159507e-01   +1.857541822568131e-01   +9.985052390577834e-02   +2.906335073572183e-02   +2.431357357149550e-01   +4.324224702680882e-01   +4.912113340196985e-01   -1.083953874505166e-01   +3.890743185460830e-01; +4.661057239321299e-01   +2.903345866638773e-01   +1.483151755817977e-01   +1.557719915454751e-01   +6.134513112180120e-01   +3.743372631412324e-01   +3.353627752785572e-01   +4.834821694487662e-01   +4.018912689163399e-01   +4.400453797668503e-01   +2.666172695359939e-01   +1.488247774246468e-01   +2.416367093823520e-01   +2.618187826947246e-02   +5.660393925857299e-02   +5.173048588186520e-01; +3.683411904818736e-01   +3.610207581565841e-01   +4.677345588485053e-01   +3.395801845448172e-01   -1.995087510754610e-02   +1.131021183359187e-01   +3.077242604978633e-01   +2.508520452076610e-01   +4.190401881207875e-01   +3.942109769537611e-01   +2.632349368827433e-01   +2.588409525039402e-01   +4.246962491542173e-01   +1.901035465874821e-02   +4.007765374069662e-01   +3.395976617884553e-01; +2.109552029982828e-01   +3.135603960931120e-01   +2.175486770324042e-01   +1.147275511857178e-01   +3.570602250164372e-01   +4.111474304079168e-01   +5.303845797058948e-01   +1.782637469970462e-01   +2.667794109230938e-01   +1.007520399109974e-01   +3.706564439447824e-01   +2.457844101125100e-01   +3.939854250362222e-01   +6.698180654069774e-02   +5.172939544810003e-02   +4.347602187606660e-01; +4.209701939374830e-01   +3.798495081793833e-01   +2.963952921305468e-01   +8.260613855728985e-02   +7.752395131988582e-02   +3.013474986879889e-01   +1.067039992979364e-01   +1.844525135538871e-01   +2.467771634884567e-01   +2.854642526793501e-01   +3.915955328082923e-01   +2.291939367963844e-01   +2.923906397198799e-01   +1.024612499883123e-01   +5.230471008869387e-01   +3.357201026761951e-01; +1.251487082495211e-01   +2.305434816283388e-01   +3.675442865276437e-01   +9.846096076648188e-02   +4.301155616926737e-01   +1.769261047448638e-01   +2.210023874087860e-01   +1.748385312092093e-01   +2.807141162709926e-01   +2.477018465886883e-01   +5.944531102043641e-01   +3.284141007563420e-01   +1.666831577091523e-01   +1.775428008207291e-01   +1.167947579342892e-01   -5.047964083902123e-04; +8.948222914094686e-02   +2.803874437113308e-01   +2.404452070183241e-01   +2.048275346859604e-01   +5.374662636479401e-02   -8.357471021765574e-03   +1.758995078418771e-01   +4.685142078307157e-01   +1.545796629670610e-01   +3.398546709448066e-01   +3.997894206632971e-01   +3.955091194209971e-01   +1.593754200542210e-01   +3.972442933727693e-01   +4.751087474477659e-01   +2.335141953615068e-02; +8.981644346033700e-02   +1.577954912167821e-01   +2.179413350230022e-01   +2.817431275760720e-01   +3.191219396845511e-01   +3.855203427072285e-01   -1.627307425414496e-02   +1.291568885970579e-01   -1.207610215156495e-03   +2.145476413075498e-01   +2.965076002915638e-01   +2.276101368583154e-01   +8.815486427275140e-02   +2.547707982283087e-01   +5.535881350221420e-01   +4.751237731260593e-01; +3.533464023582889e-02   +4.050497145379117e-01   +1.661445036881548e-01   +3.610860964765020e-01   +4.556323037017949e-01   +4.944985152117277e-01   +3.174235394128590e-01   +3.658126168947153e-02   +4.696109427335330e-01   +8.298722228087892e-02   +2.979297950968597e-01   -1.011551887081816e-02   +2.192246213188761e-01   +2.158336213614959e-01   +2.641773294778011e-01   +1.857934106665524e-01; +3.595808433317774e-01   +2.448189924628246e-01   +2.362225896913684e-01   +2.711569539649344e-01   +2.900315978266839e-01   +2.988596317663495e-01   -1.529777017278627e-01   +2.593775439259577e-01   +4.888155022213253e-01   +5.677129125744023e-02   +7.506810371466377e-02   +1.531459419727879e-01   +2.402036256277000e-01   +3.336810665405334e-01   +2.462033456572149e-01   +3.604715561269233e-01];
L2I_L1I_iGABA_netcon = [+4.412848984616318e-01   +4.309987370871657e-01   +2.332966513497148e-01   +4.468074900492340e-01   +1.442270693281741e-01   +6.399682699120965e-02   +2.333649325640247e-01   +2.284085492474327e-01; +4.283755636876195e-01   +3.159298038602998e-01   +1.622451501844030e-01   +3.063637085167070e-01   +4.273357667475496e-01   +1.925037928830967e-01   +3.944951885551939e-01   +2.923632998275609e-01; +1.208951345397902e-01   +1.903719745137751e-01   +3.199032772312346e-01   +4.150121814811108e-01   +1.459565204812392e-01   +1.165354865530173e-01   +2.844567082087885e-01   +3.628528422718498e-01; +4.829147126871627e-02   +2.235048189759951e-01   +3.978269791891243e-01   +1.999461089137884e-01   +2.043741839829417e-01   +4.738480806759805e-01   +1.865807751931990e-01   -5.706099439058906e-02; +5.422371836299962e-01   +3.620693660516088e-01   -4.905327254322719e-02   -5.439735687045232e-02   +1.916987931408489e-02   +3.503095587190888e-01   +2.722687892995183e-01   +1.442838604139655e-01; +3.064420011593690e-01   +2.311385272215534e-01   +4.252661669543679e-01   +1.252464469493866e-01   +4.045167473075867e-01   +3.402822889954520e-01   +2.833566898825928e-01   +2.529723333695478e-01; +2.057815917923188e-01   +5.306463371304564e-02   +3.649805494834357e-01   +3.667753995515968e-02   +1.140527770330973e-01   +2.324990406959279e-01   +3.366841552567115e-01   +8.410445705204406e-03; +3.710086023438507e-01   -8.525926409554452e-02   +2.692000620940308e-01   +4.106098455202942e-01   +4.603206158015627e-01   +1.098550627757229e-01   +1.452153751819149e-01   +1.334526568868541e-01; +2.242958709218495e-02   +1.780910453295804e-01   +4.417850997279235e-01   +4.434173624913777e-02   +3.050816380316150e-01   +4.250651438997304e-01   -5.894058251039983e-02   +3.685413880958333e-02; +8.732622878992188e-02   +3.273584157248256e-01   +4.111402281674588e-01   +5.557736496851212e-01   +4.652570077664939e-01   +4.405361227405575e-01   +6.567272529810209e-01   +5.832914326999983e-01; +1.657899640922829e-01   -5.322837788855006e-02   +5.053992040700857e-01   +5.999876506649364e-01   +4.668874900119281e-01   +1.093254054447391e-01   +4.644309359373141e-01   +2.950677444328585e-01; +2.443801285416721e-01   +3.143513968167756e-01   +3.189499635827098e-01   +2.053188853890612e-01   +4.108382959269620e-01   +3.539728270657351e-01   +3.063004434925581e-01   +2.181533404493890e-01; +2.129392174229545e-01   +8.292995725427670e-04   +5.549765523802346e-01   +5.387742085399696e-01   +1.433409211970235e-01   +2.066071335450805e-02   +1.361230908878470e-01   +3.650849348857635e-02; +1.016214078567382e-01   +2.546481753590580e-01   +3.639526258616615e-01   +9.597047893188823e-02   +2.430056573833855e-01   +3.039578767847883e-01   +2.533579761131262e-01   +1.909379555320693e-01; +5.558399109360647e-01   +4.733736140082195e-01   +1.166624391734810e-01   +1.184000544651676e-01   +1.389942023372959e-01   +1.465873497670599e-01   +3.296035164265469e-01   +2.760751573913011e-02; +4.612067496590749e-01   +3.577504255364253e-01   +3.715805965531312e-02   +3.666896811796307e-02   +3.196587454537245e-01   -3.640183176555866e-02   +5.588621680270361e-02   +1.585490066059385e-01];
L1I_L2I_iGABA_netcon = [+2.526612812085532e-01   +2.759670372314946e-01   +5.958761135412773e-02   +5.922181078243676e-01   +4.447715037324064e-01   +4.955193095252391e-01   +5.180315468438594e-01   +1.669949183544310e-01   +3.432134476379243e-01   -1.099082915738616e-01   +5.194784247745865e-01   +2.553285539262333e-01   +5.806508771795663e-01   +2.982715353594321e-01   +8.905025956092259e-02   +3.272165855052753e-01; +3.514039786206363e-01   +4.859867444596966e-01   +2.336492477959431e-01   +5.435375163610978e-01   +4.235872616768666e-01   +3.766198708617651e-01   +8.254020099944476e-02   +2.497456951757730e-01   +4.043930960686939e-01   +2.351570693463870e-01   +3.211267242560874e-01   +2.215424912250649e-01   +2.203823633580093e-01   +2.714537196163943e-01   +1.280568910839756e-01   +3.620000773297251e-01; +2.503951861177036e-01   +1.548142945070914e-01   +1.680972585491174e-01   +3.985976929851782e-01   +5.960656978865884e-01   +6.144932104638392e-01   +5.435572328315168e-01   +5.072692710588831e-01   +2.658641870470426e-01   +4.984621503115756e-01   +1.123623263598471e-01   +3.239186698333992e-01   +3.157439705485772e-01   +3.165944034474221e-01   +3.754331252447226e-01   +5.344623223336237e-01; +3.755246532214407e-01   +1.205326505676269e-01   +1.417652651841725e-01   +4.441307002123236e-01   +4.039547582992202e-02   +2.739854865375842e-01   +1.750752233528126e-01   +2.957208026379197e-01   -1.242727697898831e-01   +3.120852142733611e-01   +3.716897676585518e-01   +1.036630110786463e-01   +2.780685402558462e-01   +1.560896111220668e-02   +3.527875534576144e-01   +7.734733476617772e-02; +1.070307370644504e-01   +4.032384839475453e-01   +1.514953765145842e-01   +2.543677527563212e-01   +2.503653695448898e-01   +4.598768423644658e-01   +4.389844517669335e-01   +2.838826701278915e-01   +1.526296278704292e-01   -5.298791539087296e-03   +2.128668492930852e-01   +2.618001216643703e-01   -1.785691419839305e-02   +1.030377697040214e-01   +4.812922991549817e-01   +1.006447796611439e-01; +2.449338569063785e-01   +3.899305241805511e-01   +1.862655219082046e-01   +7.256057051464522e-02   +5.520937182105544e-01   +1.881927235380028e-01   +1.350755958589461e-01   +1.178283466872391e-02   +2.965509634188704e-01   +2.519537901202636e-01   +1.977143125405993e-01   +3.075246878154732e-02   +1.733449898749626e-01   +3.882019858272593e-01   +7.826852684839107e-02   +1.245190653612600e-01; +2.288261922980376e-01   +5.041551058051735e-01   +4.828930537677621e-02   +5.511629349123091e-01   +2.991556386354132e-01   +2.464030145676329e-01   +3.691573312515187e-01   +2.564448859551308e-01   -2.649133486810215e-02   +1.861257661805686e-01   +1.863635410958812e-01   +2.796816307078119e-01   -3.073964787624253e-02   +3.635000810368361e-01   +1.974312738653514e-01   -9.980671774675738e-02; +1.156585573755659e-01   +4.473883152632446e-02   +1.349879404896508e-01   +3.347593229748134e-01   +3.455308315511607e-01   +1.685901091281821e-01   -2.520586194780030e-02   +9.523230055667686e-03   +2.649946632307199e-01   +1.557241765802730e-01   +4.811171780771394e-01   +2.411717533882613e-01   +2.954063832439586e-01   +1.992429391101223e-01   +5.974913244531934e-02   +1.625142875947961e-01];
L2E_L1E_iAMPA_netcon = [+2.292561717443907e-01   +3.870645755310255e-01   +3.044583549778855e-01   +2.699560437648750e-01   +2.618220771830043e-01   +1.624562570213109e-01   +3.346994015832806e-01   +2.103603797350296e-01; +4.770739252768312e-01   +5.595376470208749e-01   +1.068136563473831e-01   +4.077332247520011e-01   +2.098436543910717e-01   +4.896412166619554e-01   +4.780018378500936e-01   +4.342606225546449e-01; +4.189932047859755e-01   +3.437625858916383e-01   +3.227395059031702e-01   +1.872348131747079e-01   +1.096584671093071e-01   +1.844505853667012e-01   +3.229303612485489e-01   +4.199307490549779e-01; +8.920596611328299e-02   +4.527047763422414e-01   +5.182673492869946e-01   +1.754949995763175e-01   +4.880281869103013e-01   +4.169098798422020e-02   +1.177908414205831e-01   +2.835296876447859e-01; +2.692447669981798e-01   +9.777598101082581e-02   +2.294468446194168e-01   +4.196051959599771e-01   +5.451089512823544e-01   +3.115683593935181e-01   +1.873320956777497e-01   +2.768165339764060e-01; +2.686104395935011e-01   -2.904804408309116e-02   +3.615990459228847e-01   +1.961665541011867e-02   +5.224623303532295e-01   +3.602224860351910e-01   +1.282604863198459e-01   -9.723241559932438e-03; +1.066469960347515e-01   +4.723496876829711e-01   -2.126437046551507e-02   -1.601649314376674e-04   +3.169459224343012e-01   +2.681279652143099e-01   +3.891980116241362e-01   +4.837079530408676e-02; +1.714541739030083e-01   +5.164138085980300e-01   +1.059489066489575e-03   +2.836892908688831e-01   +2.027269612639207e-01   +3.245726869127500e-01   +5.577214424996296e-01   +2.670410030921365e-01; +2.370574602722115e-01   +5.415058370641449e-01   +6.758631292507557e-02   +3.862921459598957e-01   +1.189944065501367e-01   +3.645728566145930e-01   +4.629365034512918e-01   +3.354338900223917e-01; +5.026039705272057e-01   +4.678656037803638e-01   +1.721299110801874e-01   +3.238002369384138e-01   +1.568749598634062e-01   +3.464804754332139e-01   +5.605129271162412e-02   +7.647253969110213e-02; +3.541567949538759e-01   +1.670848221239721e-01   +3.102093793164982e-01   +3.964473644693113e-01   +1.042997800727608e-01   +1.364777789053479e-01   +2.718381822740943e-01   +7.913075715598909e-02; +3.327456449754106e-01   +4.107511401394901e-01   +3.242797333799636e-01   +4.178235058406707e-01   +2.167941226399046e-01   +2.192151966475493e-01   +3.775118635767908e-01   +4.905332763104707e-01; +5.301458046153933e-03   +2.631667284125638e-01   +2.149507519426349e-01   -3.201305629213976e-02   +4.125553086400769e-01   +2.727709795456968e-01   +4.655621030127768e-01   +1.987775163447759e-01; +1.570351767814163e-01   +9.113300901793252e-02   +2.893825943794228e-01   +4.125426582091238e-01   +6.790263494840054e-02   +4.470552989706029e-01   +3.310983650905837e-01   +4.346929174491297e-01; +1.641504566531004e-01   +2.101319670845570e-01   +1.084271194271176e-02   +2.321281913787750e-02   -6.212483147397369e-02   +2.056875862962786e-02   +2.251733824715295e-01   +1.807950348710481e-01; +2.919496226122115e-01   -5.452576639429489e-02   +1.134946046867111e-01   +3.335502108821159e-01   +1.965123470716320e-01   +9.705142003064608e-02   +4.825156319112490e-02   +1.430737740688233e-01];
L1E_L2E_iAMPA_netcon = [+1.832027986652011e-02   +1.278017425668594e-01   +1.083362690221586e-01   +1.007360590494085e-01   +2.608555360525636e-01   +3.219202947746888e-01   -2.752769266072578e-02   +3.171829347325374e-01   +4.611208591126383e-02   +4.155194512649767e-01   +3.097696012656991e-01   +3.462865594468463e-01   +4.275839342284406e-01   +4.341776392837723e-02   +3.559027569764636e-01   +1.448243078305024e-01; +4.837305059498059e-01   +3.606165310654624e-01   +2.313341520040568e-01   +3.839377391856088e-01   +4.526846077563099e-01   +5.107402287941991e-01   +3.719923432022015e-01   +2.476050871113636e-01   +2.499183225448900e-01   +3.725506619835350e-01   +1.145114402197933e-01   +4.265849306872813e-01   +4.871021999010297e-01   +5.580969682560520e-01   +5.808808272445312e-01   +4.056233605910862e-01; +4.314963125081320e-01   +2.042275273022436e-01   +4.291211730881461e-01   +5.258515668810561e-01   +4.656881562592686e-01   +4.541827667773807e-02   +2.243686283503339e-02   +1.415291603446150e-01   +3.955010722177514e-01   +4.604085808087148e-01   +5.136912782876039e-02   +5.275240293397567e-01   +1.773091040545322e-01   +2.702948296811897e-01   +7.935305892969502e-02   +2.845076337807709e-01; +3.965013623189176e-01   +2.380423842699758e-01   +2.699204813626597e-01   +3.243619775690261e-01   +4.118853440971226e-01   +3.533645067434250e-01   +4.286103416545927e-01   +3.497818505727161e-01   +1.483414267010995e-01   -6.807325628660130e-02   +2.385771943310172e-01   +2.296209184546384e-01   +4.338272842160553e-01   +2.208879604624927e-01   +5.561121913498582e-01   +3.687516906963938e-01; +2.195711549182909e-01   +6.795117667492558e-01   +8.361003908592371e-02   +5.570022999956332e-02   +2.471427150687461e-01   +1.173458021721490e-01   +1.687441855835655e-01   +3.259777909041992e-01   +3.650092648826329e-01   +3.719180746984523e-02   +3.329104382581018e-01   +2.836855892821481e-01   +3.907868438219538e-01   +2.488537654280525e-01   +5.448882345938910e-01   +2.165563699937963e-01; +1.392283922226768e-01   +3.543628002973369e-01   +3.161521147612526e-01   +2.567075985309502e-01   +2.560464854566344e-02   +4.142784056466352e-01   +6.243826920744685e-01   +6.206313847894238e-01   +4.695824206427342e-01   +2.990701895486463e-01   +2.185130922410588e-01   +2.530567037463013e-01   +2.536633277177625e-01   +2.726353058300093e-01   +1.795882882608547e-01   +1.166528326596892e-01; +4.624512867262581e-01   +3.414125943140854e-01   +3.461585064597734e-01   +4.441836057722783e-01   +5.577613059855802e-01   +4.099491768499421e-01   +9.010821531661298e-02   +1.277047668863089e-01   -5.865164880994237e-02   +9.559625613407274e-02   +1.440107504218541e-01   +5.782183899665907e-02   +6.437206303136049e-01   +1.157007326628957e-01   +1.999759928330809e-01   +4.810579247179372e-01; +2.920907054344386e-01   +4.712097336685618e-01   +3.134700991630904e-02   +1.509313801618545e-02   +1.616048730523732e-02   +8.731172048030125e-02   +2.163365266311780e-01   +7.178965523229552e-03   +3.859142520926440e-01   +1.755389256159882e-01   +3.921079191572021e-01   +2.676624257506680e-01   -1.090054537294197e-02   +1.655243152669254e-01   +4.494692519820390e-01   +4.149849329444319e-01];
L2I_L2E_iAMPA_netcon = [+5.445782592981978e-01   +2.258794263500407e-01   +1.620117281182047e-01   +6.033422407520435e-01   +1.420183487541171e-01   +4.186409247243074e-01   +5.323426701705120e-01   +3.304827572251820e-01; +6.509718307950138e-02   +3.035403810133252e-02   +2.987461070169503e-01   +4.252207808914301e-01   +2.470288627821890e-01   +1.908957074226638e-01   +4.694482066161713e-01   +2.792747505541975e-01; +2.726433064696872e-02   +1.323610762352699e-01   +3.216189921797258e-01   +2.404621827322555e-01   +1.964549661195519e-01   +3.030817217934267e-01   +3.182668397586010e-01   +5.253716235171543e-01; +4.271694439555755e-02   +3.423782844611200e-01   +1.440805235991597e-01   +2.758921324331476e-01   +2.925730488280577e-01   +8.621939363594028e-02   +1.088441955833479e-01   +2.953044606670679e-01; +2.730014031717186e-01   +3.166225545372725e-01   +4.381630991703784e-01   +3.223917128120949e-01   +2.912971104983879e-01   +3.198140314591630e-01   +4.501233984903281e-01   +2.904772482294426e-01; +3.454071114544149e-01   +1.652062608211792e-01   +4.471585574579868e-01   -6.876465376623525e-02   +3.046886736298604e-01   +6.650676683489339e-02   +5.622116705074435e-02   +1.238016305055148e-01; +4.556800840294069e-01   +2.138256370558290e-01   +1.929640685855718e-01   +2.943930815083455e-01   +3.332004190603995e-01   +1.438493192468858e-01   +4.438242889983093e-01   +3.591647772103721e-01; +4.868213380353922e-01   +2.166601788549317e-01   +3.012351798926026e-01   +4.315467847001748e-01   +4.539875713507989e-01   +4.527142081766714e-01   +1.361038954031205e-01   -1.455881361847187e-02];
L2E_L2I_iGABA_netcon = [+2.040139531544097e-01   +1.489493223701971e-01   +3.058669707535674e-01   +4.141058844630812e-02   +2.370920221801472e-01   +1.374794331456033e-01   +4.986037648109617e-01   +1.582741617649812e-01; +8.664400737986228e-02   +2.371576950814751e-01   +4.062040407735385e-01   +5.501197054121472e-01   +1.418473899918719e-01   +1.229431830818399e-01   +2.055776711150973e-01   +4.495486266907605e-01; +5.605776783880819e-01   +3.149567336674371e-02   +4.371494327983274e-01   +4.979595774148725e-01   +2.132267775348981e-01   +2.190620202057363e-01   +3.323219059844440e-01   +4.096346885104109e-01; +2.676187501180873e-01   +5.423935882801876e-01   +3.912061425169130e-01   +4.215278468387844e-01   +4.019602838499562e-01   +1.670198206914799e-01   -5.714410351250105e-02   +9.433008023711013e-02; +2.479919605568633e-01   +3.625852543746942e-01   +5.807930945224996e-01   +4.465261171846043e-01   +5.245228035796010e-01   +1.577119730551755e-01   +5.131245795401177e-01   +3.420524318405089e-01; +4.806750635121230e-01   +2.534423063266890e-01   +3.059111857358069e-01   +3.222361202732306e-01   +6.912532159407711e-02   +4.724318629361640e-01   +7.924221749703664e-02   +4.974702994210964e-01; +4.023236335854191e-01   +3.740401632360387e-02   +3.357043407098861e-01   -6.904009307970976e-02   +3.273961273716023e-01   +2.371862894055393e-01   +6.874618495161078e-01   +5.553014186487213e-01; +1.569624284773097e-01   +2.687484429162625e-01   +3.854203555518576e-01   +3.424399307594190e-01   +2.572407932112439e-01   +1.024893124667779e-01   +1.965976722317450e-01   +5.131350631590265e-01];
L3E_L2E_iAMPA_netcon = [+4.578729070974976e-01   +3.958539756952053e-01   +9.513547480490557e-02   +2.993622242182315e-02   +3.934867651823411e-01   +1.532686927807854e-01   +4.769399635269558e-02   +1.305839865003763e-01   +4.853170154747035e-03   +1.478866315566303e-01   +4.257745701217918e-02   -5.563541376009804e-03; +3.476734458393072e-01   +1.539702658660021e-01   +4.577244463771740e-01   +3.258770376740971e-01   +1.263602104767115e-01   +4.315971541217294e-01   +2.814218709325502e-01   +8.599206247614113e-02   +2.955232845226566e-01   -1.774500349990349e-03   +7.775727278944176e-02   +4.480975048892837e-01; +2.027081797828620e-01   +2.205398732266032e-01   +1.373944443360502e-01   +3.131463705768990e-02   +1.753352497030259e-01   +3.094853482451771e-01   +4.491473875449258e-01   +4.307062797117992e-01   +3.050636391750644e-01   +3.427747146022940e-01   +6.069220423096505e-01   +3.873302663359130e-01; +1.294289722065491e-01   +1.317845109078890e-01   +5.896760155799993e-02   +2.100354694716351e-01   +8.123822299610331e-03   +4.393230637016094e-01   +1.671609386139660e-01   +2.079170290042088e-01   +1.292460965336662e-01   +4.137070674691530e-01   +1.111066603742421e-01   +3.754071054527821e-01; +1.634827210405346e-01   +3.888178261143892e-01   +4.452122426836174e-01   +2.295216224108926e-01   +1.502196555106231e-01   +1.594448875903848e-01   +2.117937058437810e-01   +2.868119655897540e-01   +2.524991616893923e-01   +2.295340259342264e-01   +1.939369521489785e-01   +1.786190036858904e-01; +3.771492540507276e-01   +5.762802696963939e-01   +1.594569882621166e-01   +2.108552459355186e-01   +9.094283238768369e-02   +4.794569699657931e-01   +1.451729848127247e-01   +3.940628490351096e-01   +4.049602734344978e-01   +3.128005524306389e-01   +1.034676612909962e-01   +1.271058290849798e-01; +4.972749137419036e-01   +2.602725780426898e-01   +9.795404512719211e-02   +1.102039875233868e-01   +4.107869159411336e-01   +2.211131481528530e-01   +2.321622292080552e-01   +3.437524388934903e-01   +4.286829094938667e-01   +2.212936929756672e-01   +4.435626319628895e-01   +1.181318986766943e-01; +4.769027156308545e-01   +4.731954387654575e-01   +6.158931875927180e-01   +9.466476606164273e-02   +1.115582251579399e-01   +2.704761324644198e-01   -1.813104134782869e-01   +2.457020921073733e-01   +2.804722435881045e-01   -2.402114291045565e-02   +4.975008661702682e-01   +4.921877475941643e-01];
L3I_L2I_iGABA_netcon = [+2.551235406161630e-01   +2.479038809945646e-01   +2.752840359849989e-01   +2.857375241563428e-01   +3.958353567191917e-01   +5.105357230541172e-01   +2.053147737979399e-01   +2.206531262249730e-01   +5.083196581614546e-01   +4.527199012464046e-02   +1.650758113894285e-01   +3.106686158134396e-01; -1.275967471512810e-01   +4.766946983636855e-01   +2.797514509092360e-01   +1.167555156408546e-01   +4.405033333481112e-01   +4.329880902640962e-01   +1.853466383625507e-01   +4.280827313693747e-01   +3.311831405191535e-01   +1.718616687579887e-01   +3.391214596640764e-01   +1.835456046258598e-01; +5.268267588455361e-03   +2.478594858005408e-01   +4.558386931405435e-01   +5.252425754804497e-01   +2.750098878840335e-01   +2.459814275939078e-01   +5.576693528656733e-01   +3.232887936642047e-01   +8.834298860482505e-02   -7.314890476670420e-02   +1.280051169675303e-01   -6.349986625535728e-02; +4.935271795830175e-01   +2.075818237108546e-01   +4.121906576050010e-01   -1.180967139861713e-02   +1.802720512916715e-01   +3.051083416427200e-01   +3.488611668153902e-01   +5.821669781918256e-01   -9.394873331700020e-02   +2.420637428210561e-02   +2.905277106997258e-01   +3.015299728524927e-01; +1.931633839399446e-01   +1.659924814877933e-01   +1.269028568056697e-01   +2.086533720338193e-01   +2.527515958914432e-02   +9.920816653355470e-02   +4.527779746710450e-01   +6.594950959937146e-02   +1.014999052854058e-01   +2.084720427724687e-02   +2.233128709194727e-01   +9.067681406176481e-02; +2.172016667823307e-01   +1.613830607615866e-01   +3.097247780300246e-01   +3.406750412669238e-01   +2.253291383139764e-01   +4.610488509057244e-01   +3.542995820097011e-02   +3.822746215088133e-01   +1.345477813030178e-01   +6.179052579461543e-01   +3.881100482851968e-01   +3.529379027032177e-01; +2.846003879228721e-01   +2.045389125027092e-01   +2.500309101719710e-01   +5.052461763235758e-01   +2.709427664095269e-01   +2.833079164697339e-01   +1.778953104118838e-01   +2.001914091560261e-01   +2.553595473017057e-01   +2.341963210073190e-01   +4.222827122796279e-02   +4.483803309322862e-01; +8.379150558445284e-02   +2.564730348381465e-01   +1.367035343407765e-01   +1.543806046938672e-01   -1.003563975249772e-01   +2.536972856724364e-01   +2.902668158011759e-01   +4.209344143551325e-01   +1.898193787505033e-01   +4.992560834049821e-01   +5.804689799246107e-01   +2.807481902413729e-01];
L2E_L3E_iAMPA_netcon = [+1.443248112852364e-01   +1.764227011133418e-02   +3.159217826325028e-01   +3.905305141881316e-01   -4.794855716431574e-02   +3.064407416625753e-01   +2.987933391852124e-01   +3.303507775655998e-01; +1.304145338568594e-02   +3.256187377792060e-01   +2.592902730594481e-01   +2.486176596070656e-01   +3.815673327407723e-01   +2.324805551187248e-01   +3.184082351929894e-01   +3.164356979281116e-01; +1.607728863874053e-01   +1.742258022476058e-01   +5.297426327328596e-01   +1.972127461497534e-01   +3.133400472344754e-01   +7.041721321460345e-03   +3.462183169765150e-01   +1.656273323235987e-01; +2.341768130288297e-01   +2.276434081980614e-01   +7.827104714873578e-03   +1.804949105676390e-02   +5.010075453440297e-01   -4.498588634311039e-03   +3.412697221331948e-01   +4.228911129821068e-01; +3.419539964803235e-01   +2.745396183628698e-01   +2.735725888086623e-03   +3.695689138132197e-01   +3.612537775350412e-01   +2.343395201426125e-01   +4.044464467974133e-01   -6.522746183440289e-02; +2.552448031271352e-01   +3.185940009795085e-01   +2.395935526949282e-01   -4.546811707506711e-02   +2.495790408142942e-01   +3.438414008185544e-01   +2.500808364684577e-01   +1.111281644394088e-01; +2.076286887098558e-01   +2.467678256509180e-01   +3.077602559211207e-01   +2.757250236696897e-01   +1.599093467448573e-01   +3.099865800540929e-01   +1.702321440783784e-01   +3.550166777914777e-01; +2.824971626924934e-01   +6.417828897439044e-02   +1.756791552480779e-02   +1.222830785629850e-01   +1.702484915122111e-01   +6.068563142585183e-02   +1.685626746834527e-01   +6.089659976648086e-03; +2.252527129128904e-01   +1.440339033779256e-01   +4.601864816747336e-01   +3.916434076325783e-01   +1.137482044597659e-01   +8.126515548241774e-02   +3.973354881427471e-01   +3.119178283803905e-01; +2.678015209361418e-01   +3.806218560977080e-01   +1.172779406852496e-01   +4.345919637775622e-01   +3.104068437343559e-01   +3.705916079431872e-01   +5.019161835079415e-01   +3.930030592615529e-01; +6.341511410505886e-02   +2.881842088964326e-02   +5.660329199356042e-02   +8.653469888676793e-02   +4.851622885812400e-02   +1.977357954436101e-02   +1.856887253494104e-01   +7.863698605773344e-02; +5.245698235292554e-01   +3.243152410420418e-01   +2.045446113517592e-01   +3.842904299817211e-02   -3.086605993058024e-02   -1.119466988111588e-01   +2.642326709401717e-01   +2.113783755266112e-01];
L2I_L3I_iGABA_netcon = [+9.157744371315887e-02   +5.677182658628789e-01   +8.974230106454482e-02   +2.703064379711118e-01   +1.692870370242727e-01   -1.114363410962803e-02   +1.858857391949259e-01   +5.486783626854461e-01; +3.300738576817646e-01   +4.633668586682013e-01   +1.679756778414392e-01   +3.972033431975173e-01   +5.097594675734098e-01   +1.134551068493344e-01   +1.581311137539121e-01   +1.302254760914939e-01; +1.200111828724687e-01   +2.223307132599642e-01   +1.489329071838460e-01   +3.740956620270001e-01   +4.854080327363892e-01   +2.199332259763745e-01   +8.540092572931246e-02   +4.330702616454889e-02; +1.940691492876108e-01   +3.438832660879378e-01   -7.820187337897827e-02   +5.153970734135807e-01   +5.305912430386200e-01   +4.574077393874784e-01   +5.450918005040530e-01   +1.341112622274348e-01; -2.779204883100371e-03   +2.892574240102319e-01   +4.497377205382861e-01   +3.331800642970510e-01   +9.945659080872739e-02   +4.446570146201074e-01   +4.469525986724205e-01   +1.909822145725910e-01; +7.926963331661827e-02   +2.869090092522832e-01   -8.727027730485376e-02   +1.369955359488903e-01   +1.728075352534981e-01   +4.549231683996467e-01   +4.227181536440460e-01   +3.746248948551681e-01; +4.603516461822817e-02   +1.869659040234561e-01   +4.522806702671777e-01   +3.003803284192842e-01   +5.668638447965049e-02   +6.399864217215952e-02   +2.294170625116395e-01   +1.711850400862155e-01; +4.245551241685093e-02   +5.664100740994413e-01   +5.861381930793859e-01   +8.928191225334686e-02   +1.199638283712395e-01   +4.326838567479688e-01   +1.090802404460612e-01   +4.978064445416885e-01; +4.152797804293474e-01   +1.835939908340106e-01   +9.908907023410614e-02   +1.480330077178698e-01   +2.100132791766268e-01   +1.727544942691866e-01   +1.676205580587375e-02   +4.184289257538796e-01; +2.453656981887078e-01   +1.136223526952814e-01   +2.341809555301496e-01   +3.831616750966387e-01   +1.993517206432025e-01   +3.373562917079539e-01   -8.841876456744627e-02   +3.742180309499339e-01; +4.349414217382572e-01   -6.607247086533422e-02   +5.236774614382171e-01   +1.227503283827625e-01   +3.526675118535613e-01   +9.783905628655613e-02   +1.371189326011134e-01   +3.974625183273780e-01; +2.678594764720965e-01   +4.039755597586733e-01   +4.027844344209917e-01   +2.634625637956663e-01   +2.946837333590725e-01   +1.573695654493715e-01   +2.315262105158324e-01   +5.413757302476411e-01];
L3I_L3E_iAMPA_netcon = [+3.703655044579537e-01   +3.281485356409173e-01   +1.368095107340331e-01   +2.626411884419523e-01   +4.302599877504372e-01   +6.048396616940090e-02   +1.482597617094960e-01   +3.483842110761464e-01   +3.010037179741314e-01   +1.110091782749633e-01   +3.300278668906806e-01   -5.328945818195506e-03; +2.068265292065725e-01   +1.313043429260517e-01   +2.753021552120983e-01   +4.866629397999070e-01   +1.465573046875314e-01   +1.222118268747086e-01   +5.333787825927446e-02   +2.696145157424901e-01   +4.709748361444822e-01   +1.088405500953113e-01   +2.359725305846445e-01   +4.947473598831102e-02; +3.965409355789184e-01   +5.550737907119071e-01   +4.048809404244083e-01   +2.033419632615805e-01   +2.842797952905985e-01   +5.019399801929403e-01   +5.252466563136660e-01   +4.547363378251389e-01   +7.485041142236147e-02   +2.572478893554829e-01   +2.257912116518100e-01   +4.921219397693521e-01; +3.770671985490267e-01   +1.761880090466846e-01   +3.184163589163680e-01   +2.936389433437818e-01   +2.822163447636877e-01   +4.481823721594227e-01   +1.071786280437112e-02   +1.131817497528467e-01   +4.599566398882740e-01   +1.565815213438941e-01   +2.892962059396803e-01   +1.978996118769213e-01; +2.421137885699992e-01   -7.602845636361563e-02   +1.774086729381030e-01   +3.645770964136290e-01   +3.601332905065699e-01   +3.886087030592338e-01   +5.589504692813494e-01   +4.084402164770830e-01   +1.080088106704871e-01   +1.445604348803930e-01   +3.602967575496576e-01   +1.911979629642139e-01; -1.239200308415095e-01   +2.981169237045695e-01   +1.041327248672203e-01   +4.402016634586682e-01   +2.849424360042138e-01   +1.182570890512330e-01   +5.443566935563857e-01   +2.097041814637855e-01   +5.913687490474628e-01   +5.092776627007305e-02   +1.909432280354932e-02   +1.175775213274766e-01; +7.429080224973676e-02   +4.589697094859437e-01   +2.348409823412189e-01   +1.328839978321280e-01   +1.879347974907228e-01   +2.252476117316108e-01   +2.244749119909802e-01   +1.609838630759147e-01   +1.860429547603666e-01   +1.905937280543007e-01   +4.385928055351345e-01   +2.248079303352504e-01; +1.296360309767305e-01   +8.762494058415596e-02   +2.273091636412074e-01   +1.052255210316276e-01   +3.191503870502036e-01   +4.965216999680926e-01   +1.978835488708155e-01   +4.217414506005539e-01   +4.064752451503666e-01   +1.749784181867922e-01   +9.483536441177186e-02   +5.074583359435668e-01; +2.322980935572831e-01   +3.173802751618414e-01   +3.561811457693119e-01   +1.780180140693040e-01   +3.520280462085491e-01   +1.147577891354901e-01   +5.166056317840615e-01   +3.791321845653270e-01   +4.621295550756652e-02   +3.367632819002858e-01   +1.817992912258816e-01   +9.145862612195871e-02; +1.056268477652289e-01   +2.709294264569867e-01   +2.956934626734133e-01   +8.656645231928137e-02   +3.871079955308160e-01   +3.486708937268695e-01   +2.921457195331029e-01   +1.692839197922400e-01   +6.339047619192800e-02   +2.621926432252905e-02   +2.828467640824448e-01   -1.202219123608178e-01; +2.104158711891661e-01   +4.372225128518795e-01   +2.352033617416360e-01   -6.288577791851874e-02   +1.288305847342987e-01   -1.052652234428509e-02   +2.046902711379564e-01   +3.784068862453682e-01   +1.403698773904250e-01   +2.752123529902591e-01   +2.799926520352568e-01   +4.918425216130390e-01; +4.784871427603765e-01   +2.257723326628500e-01   +3.096655255999685e-01   +7.982271524572203e-02   +4.826132706809919e-01   +1.693378331608359e-01   -9.410984987764322e-02   +1.220306319691267e-01   +2.951571485973057e-01   +3.739257015233445e-01   +9.148696350755180e-02   -5.647501467971341e-02];
L3E_L3I_iGABA_netcon = [+1.920391469690122e-01   +6.288245632886494e-02   +1.428389381012294e-01   +3.924910048969857e-01   -1.623266673068380e-03   +3.545515405593469e-01   +3.527424836442566e-01   +3.027898374232778e-01   +2.304164468195715e-01   +2.959545463002760e-01   +4.676459582104876e-02   -4.444094048069484e-02; +1.755150763943634e-01   +4.639261532201155e-01   +8.848187850989361e-02   +1.569599803585391e-01   +4.294035314782410e-01   +2.586449967309783e-01   +5.394975158274763e-02   +4.325581657697497e-02   +4.647249371431260e-01   +2.987292151631614e-01   +9.968507100633227e-02   +1.399073404391627e-01; +3.558941096591022e-01   +2.857854713677117e-01   +6.206536580961815e-02   +9.579717943855741e-02   +1.434909550894627e-01   +3.009996010137356e-01   +3.523175726745343e-01   +4.366686283185974e-01   +3.002542200222453e-01   +2.880586374016885e-01   +3.370084580403430e-01   -3.141660372926379e-02; +4.054264640807499e-01   +2.757387783359975e-01   +1.612675780436175e-01   +8.251325144593158e-02   +2.383604952013198e-01   +1.855432807250456e-01   +2.800518494093351e-01   +1.010979443447197e-01   +4.038388701900861e-01   +1.412174249643634e-01   +9.526935262378917e-02   +3.001449295392823e-01; +1.557483794900633e-01   +5.324153239104794e-01   +2.360511099384109e-02   +1.986646935413680e-01   +1.844869753645728e-01   +2.728515926884294e-01   +6.732066963730365e-02   +1.152448330379288e-01   +3.356699661318839e-01   +3.001994069832636e-01   +4.299921646543675e-01   +2.714615474247309e-01; +2.777703554052529e-01   +1.737536562999654e-01   +1.565927638104643e-02   +4.317073768895395e-01   -1.112830547685689e-02   +3.488133474873195e-01   +4.660199686734462e-01   +3.370715570072899e-01   +5.236918877452926e-01   +2.851039967695190e-01   +5.883984738717083e-01   +3.888297783704335e-01; +3.161944342819771e-01   -1.071090205525630e-01   +3.102437337562599e-01   +5.040681332666992e-02   +1.935409412814188e-01   +3.017106879688689e-01   +6.159547058353056e-01   +2.557976978235156e-01   +1.227316645326011e-01   +3.508851223850676e-01   +3.872105884709233e-01   +3.241134328651662e-01; +2.743124241494725e-01   +4.158441121401006e-01   +5.135558166246291e-01   +4.235006341615600e-01   +2.359811050048595e-01   +4.396261242157050e-01   +1.205458354826803e-01   +5.066263116778916e-01   +3.374248015706785e-01   -4.124626947731276e-02   +2.299886181417718e-01   +1.480476964044242e-01; +2.196620258034790e-01   +3.285837644516178e-01   +3.718250464454559e-01   +5.137117509664317e-01   +3.222086109327726e-01   +3.498135953680132e-01   +5.234279288625843e-02   +7.629987945182197e-02   +1.236050383782310e-01   +3.839586808286430e-01   -2.003342240470876e-02   -6.042414369316344e-03; +3.247281587675740e-01   -3.436912858922860e-02   +4.121823376353150e-01   +2.842811644961828e-01   +9.696516171545594e-02   +1.266347373978610e-02   -2.823978678704320e-02   +8.881509609083758e-03   -6.093781722798633e-03   +4.225612804488375e-01   +2.342955802749946e-01   -1.346954866111297e-02; +5.034874611999203e-01   +3.988868522328459e-02   +3.279629208100776e-01   +3.421452664372238e-01   +2.419508062141582e-02   +1.022111585974566e-01   +3.695603755844732e-01   +3.550918175242355e-01   -1.774787219328333e-03   +2.110275362809916e-01   +1.798379816548492e-02   +1.120237124885224e-01; +4.852167628294486e-01   +4.868628158396301e-01   +3.858870827865546e-01   +2.022019444466677e-01   +7.388733771226591e-02   -2.206431464222573e-02   +4.445424665426968e-01   +1.835844157482287e-01   +4.453309096947124e-01   +1.486005195302416e-01   +7.253922870592344e-02   +3.881945846023032e-01];
L2E_Input1_iAMPA_netcon = [+5.494046373613155e-01   +2.476038590111183e-01   +1.087573438352295e-01   +7.468854162089836e-02   +3.684381725794997e-02   +3.789269764672388e-01   +2.514646066071421e-01   +4.279725802170526e-01];
L2I_Input2_iAMPA_netcon = [+1.404432250960188e-01   +2.836092207710056e-01   +2.031207041129739e-01   +9.734004398462844e-02   +1.820655634222537e-01   +4.468179751230741e-01   +3.668122814564079e-01   +7.310223454818547e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
