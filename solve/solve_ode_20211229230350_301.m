function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.052775814265908e-02   -1.507142751959108e-02   +2.522491766547718e-01   -4.486285297075353e-02   +1.041693310968395e-01   +1.974662931413779e-02   +1.613626130809369e-01   +3.296322393050041e-01   +7.469026679632536e-02   -3.114293686937526e-02   +1.383988319447042e-01   -6.595290468635304e-02   +2.020008657502628e-01   +1.539208727070107e-01   +9.102471014601088e-02   +1.380243932565814e-01; +1.999901791619226e-02   +1.977528167155119e-01   +1.547587978772020e-01   -1.171274355555383e-01   +4.331936312655632e-03   +7.599890984196353e-02   +9.368370201508013e-02   +8.761044562227366e-02   +1.003171131877315e-01   +6.068369125583303e-02   +8.680628543770566e-03   -9.676442578629538e-02   +4.841296267526135e-02   +1.995259072115713e-01   +1.021760137232272e-02   +2.003318928566268e-01; +2.122495392958432e-01   -1.379873437715445e-02   -2.884232784046320e-02   +1.671706195762795e-01   +2.363790762326181e-01   +2.599688116380173e-01   +3.281283370855450e-01   +2.528284528842356e-01   +2.841377605433190e-02   -1.246510317949094e-02   +9.657464282499925e-02   -9.177434381589661e-04   +1.093912833331140e-01   +4.644706274462215e-03   +9.722545043029454e-02   +3.321348852151086e-01; -2.873057255089959e-02   +7.043288077598797e-02   -3.840911718479710e-02   +1.681247516465454e-01   +5.576521897023956e-03   -1.117655709065516e-01   +6.724029776405441e-02   +1.486920866715745e-01   +2.890320386406188e-01   +8.598601664493420e-02   +2.358790584784541e-01   +1.816609789066967e-01   -1.037105948801676e-01   +5.152509070132955e-02   +1.840552243614912e-01   -3.088024403292162e-02; +1.440215005033586e-01   +5.690367324214615e-02   -1.277044136685070e-01   +3.543200306779442e-01   -1.720510899322145e-02   -2.993073347525352e-02   -2.967609669619659e-02   +1.455054622704855e-01   +6.307161512404988e-02   +2.955220206696932e-01   +1.578605694214110e-01   +1.896424327613103e-01   +3.507289093966087e-01   +1.472352362120743e-01   +3.734513933706534e-01   +1.289040093702107e-01; +1.085845621274675e-01   +6.356764416176044e-02   +5.153847647728473e-02   +3.052948657133733e-01   +1.435032120003271e-01   +1.303472669789848e-01   +1.233782970795928e-01   -5.365352763722502e-02   +2.776365890347177e-01   +4.282762702903696e-02   +1.902596200215499e-01   -2.342383373212942e-01   +1.637437227896213e-01   +1.758143053717725e-01   +2.870141111234443e-01   +4.664068560154519e-02; +1.933724987526233e-01   -1.583687727237562e-01   -1.321201841918300e-02   +1.656010553130729e-01   +3.606895527132427e-02   +9.366618384482278e-02   +2.718498034234974e-01   +1.651941641741115e-01   -2.368802526659546e-02   -2.034853389559663e-02   +6.614940739035438e-02   +2.168201221122383e-01   +1.561975302470212e-01   +3.134211919193267e-02   -1.104802234010482e-01   -1.715596780820643e-02; +1.691904443998771e-01   +3.384790528411132e-01   +1.267987258225670e-02   +1.796597907172681e-01   +2.705123311334355e-01   +1.809931016561034e-02   +1.149467157488859e-01   +1.245644888101653e-02   -7.790993084693773e-02   +3.003840051441339e-01   +3.090857269147715e-01   +1.014300686972570e-01   +2.985704836707587e-01   +8.249181148005512e-02   +2.217096635642702e-01   +2.928401039124685e-01; +7.956765863534726e-02   +3.953769078918211e-01   +5.851322004883772e-02   +6.697086388746340e-02   +1.020667927023104e-01   +2.779544131289796e-01   +1.729905476329622e-01   +3.232327076769222e-01   -1.230935035624389e-02   +1.904640404936837e-01   +2.382572786005814e-01   +2.264005543251467e-01   +6.963897400649088e-02   +1.686364789699608e-02   +6.013581043606896e-02   +9.852483210407514e-02; +1.704892379930779e-02   -2.233328444185671e-03   -1.962421000046461e-01   -1.359465256199340e-01   +1.808296862783679e-01   +1.562246692759486e-01   +8.807815840790156e-03   +1.071753550552567e-01   +3.842326707499402e-01   +1.839511036471825e-01   +9.396522169530144e-02   +1.903002911258154e-01   +2.454581510879167e-01   +1.583418935355704e-01   +1.378928775029941e-01   +2.221801740552066e-01; +2.102952760111498e-01   +4.129342260097743e-03   +1.321850461208023e-01   +2.436094678890200e-01   +1.687922715027859e-01   +1.140716157790153e-01   -5.376623542744890e-02   +2.248482773802987e-01   +7.756701205232208e-02   -2.059785054099341e-02   +2.511155530057474e-01   -1.397924816283597e-01   -1.249367655083142e-03   -2.405752441406908e-01   +5.298866848637039e-02   +1.358655410998527e-01; -6.730543371282618e-02   +5.151696972269850e-02   -2.843154205665215e-02   +7.733742155807902e-02   +2.912128292089695e-01   +4.040698488799558e-02   -1.083742707019317e-01   +5.317591166069524e-02   +2.803963116406803e-02   +9.581868883510315e-02   +8.279476523920859e-02   +2.349968173088455e-01   +3.731277041930283e-01   +4.535885612198912e-02   -6.598778333447200e-02   -9.224167118338317e-03; +1.377848656917421e-01   +1.203736068610415e-01   +1.076830070108359e-01   -1.355885184507849e-02   -9.781255853802964e-02   +1.380434281359437e-01   +6.689039732619342e-02   +2.332632850569329e-01   +1.971027855427410e-01   -3.158580026293075e-02   +2.960229427504133e-02   -1.627197240073938e-01   +7.581768549722974e-02   +1.525362989370517e-01   -1.112911854153904e-01   +1.477063541618490e-01; +8.677154061219402e-03   +3.584611009526006e-01   +1.011102112690882e-01   +2.005797710082655e-01   -5.128720668352243e-02   +1.416260649027408e-01   +2.036298956730255e-01   +1.309334813391557e-01   +8.275371573789760e-02   +1.014319407027821e-01   +1.394830106907041e-01   +2.550916527922110e-01   +2.853290964422441e-01   -1.608347568936100e-01   -5.686957064877052e-02   +2.306349638699122e-02; +2.266706771705138e-01   +9.305168239165931e-02   -5.456671492588357e-02   +2.147433897066081e-01   +2.902009123137603e-01   -1.278899457707959e-02   +3.417325159350587e-02   -6.065398581561900e-02   +1.175227427936859e-01   +3.048172217105174e-01   +8.212616045246840e-03   -1.920076506157720e-02   -6.688694547502519e-02   +5.548913443948686e-02   -4.229827782810534e-02   +2.364688016284141e-01; -7.413669151154079e-02   +7.315906605257863e-02   +1.143275988434043e-01   -1.617895608333152e-01   +9.673188760017123e-02   +2.700300536315395e-01   +7.828268155187175e-02   +1.243469675441639e-01   -7.673488315597704e-02   +2.922298425544413e-01   +1.363865001612010e-01   +8.527368935841481e-02   +9.173576753722795e-04   +1.680047388076366e-01   +1.712758131201898e-02   +2.025930177447105e-01];
L1E_L1I_iGABA_netcon = [+7.873611612280502e-02   -3.731577581200735e-02   +1.494186582798807e-01   +6.943542149011078e-02   +4.476723293855372e-03   +1.753769351328362e-01   +1.678500576240821e-01   -5.649604652169055e-02   +1.010397051866672e-01   +6.935935353582937e-02   +2.980026810407736e-02   -1.233197443107707e-01   -2.012915451573519e-02   +2.608549566156386e-01   +1.027776727492074e-01   +1.141647439977922e-01; +7.442066922917064e-02   +1.369357475419422e-01   -2.228887862992966e-02   +2.134417476887419e-01   -1.019041935048166e-01   +8.550524763277184e-02   +6.665212938449423e-02   +1.407742643656836e-01   +2.488990928497598e-01   +1.979927064252897e-01   +2.737912228280627e-01   +1.906245969120376e-01   -1.119684571985773e-01   +2.316413262207332e-01   -3.337403741726505e-02   +8.112892062889020e-02; +1.162013625640640e-01   +1.743936906889356e-01   +1.641168083147435e-01   -1.840944321875944e-01   -7.718415290343165e-02   +1.353375000280785e-01   +9.802465086211175e-02   +8.031606216576856e-02   -4.951520575632752e-02   +4.378891000042842e-02   +1.608801478092215e-01   -7.817626324240538e-02   +2.145457134251806e-01   -1.075185518879921e-01   -3.512787250050545e-02   +7.011312197030896e-02; +3.651995488821917e-01   +3.133122302479701e-01   +2.324100799591871e-01   +3.123383308773747e-01   +4.720877636606257e-02   +4.458243577220572e-02   +2.160978336118214e-01   +2.235605235300928e-02   +1.301372476512505e-01   -7.917469792023207e-03   -9.541439425377261e-02   +1.544452199129995e-01   +2.579050791737519e-02   +8.973020676912333e-02   +2.368667783711140e-02   +1.870765811527719e-02; -1.940801028541864e-01   +4.238194146975534e-01   +9.038175003730883e-02   -1.368914725962582e-02   +1.010431228496899e-01   +2.545634255414890e-01   +3.159637915346638e-01   +1.843496734667155e-01   -2.111859051616116e-02   +8.062223018083148e-02   +2.456506847243229e-01   +1.597516365231199e-01   +6.431997045869443e-02   +7.097915306118432e-02   +5.492340063201204e-02   -2.617672216525925e-02; +7.652323526924815e-02   +1.854736456224559e-01   +5.641908075090955e-02   -7.242444357065794e-03   +2.742203956951669e-02   +1.400332062277170e-01   +5.386069102039161e-02   +6.302697918727290e-02   +2.349509045248111e-01   +1.455673449211010e-01   -1.623986102188704e-01   +1.801247696300534e-01   +1.158295645757102e-01   +1.612699580660011e-01   +1.460575795825647e-01   +9.778795354323487e-02; +1.034768683236330e-01   -2.851456702351252e-02   +3.215853653204124e-01   -8.970656562229085e-02   +3.424931148154080e-01   +2.492515914552837e-01   -9.367538237121786e-04   -6.975092927727983e-02   -1.253121101021713e-02   +1.100792298471084e-03   +1.187042130009492e-01   +1.624697689911646e-01   +1.752162211213286e-01   +2.798729623053955e-01   +5.684846477703961e-02   +2.317185112039433e-01; +2.709005068002280e-01   +3.498035252449880e-02   +7.307773999199832e-02   +2.930130364105807e-01   +4.315439870597610e-01   +1.771764182848775e-01   +2.333878651584053e-01   +1.953389604725250e-01   +1.376517797278062e-01   +9.666369745234210e-02   +3.128476327486868e-02   +7.608358148032739e-02   +9.898905296982655e-02   -6.238212810898253e-02   -1.602717027268905e-01   +3.836309498783886e-01; +2.766379394880856e-01   +1.167155974703998e-01   +1.767222557099820e-01   -4.325683695599335e-02   -1.170796230596361e-01   +2.179023258926547e-02   +2.883812466297244e-01   +1.465674902161805e-01   +1.092931123863436e-01   +1.605082039296755e-01   +1.621361026771366e-02   -4.720145677103638e-02   +1.395984067871797e-01   +1.164389340116311e-01   +2.123505790287047e-02   -4.623294960957208e-02; -1.209992367835171e-01   +1.039461519186349e-01   +3.162225728145639e-01   +1.080950311509508e-01   +9.961017289598498e-02   +2.918534595131810e-01   +2.131628094287316e-01   +1.160134160626941e-01   +9.782256671042194e-02   -2.957078057600877e-02   +1.842328848378759e-01   +2.413156772301966e-02   +1.786749645168707e-01   +1.712816311578856e-01   +3.350037566510165e-04   +1.992566493116636e-01; +2.898848971328088e-01   +2.666477264421948e-01   +3.436950996008564e-02   +4.451599601387313e-02   +7.923058976897518e-02   +2.287722078511040e-01   -1.693330127697845e-01   +1.387120596736603e-02   +8.935038317504417e-02   +1.120328597643841e-01   +1.253417923482709e-01   -8.401295525512481e-02   +2.279783853757428e-01   -1.959138305349551e-01   +3.412755884362968e-01   +6.769979538725682e-02; -3.774662820737214e-02   +1.643608103887459e-01   +2.449691850556580e-01   +1.775671177348822e-01   +3.399159177336147e-01   +4.136017516927782e-02   -1.582979974584048e-02   +6.973768514350097e-02   +1.236487923262464e-01   -1.121626528570751e-01   +2.047318835675372e-01   +7.067084202080368e-02   +2.224634851185417e-04   +1.998435393797224e-01   -9.306007735472305e-02   +7.385834312585031e-02; -1.612428139485757e-03   +7.853409828743106e-02   +8.920147486229039e-02   +2.505267900705219e-01   +3.084352708999039e-03   +1.388731797784903e-01   +1.044980849616987e-01   +2.230598986838891e-01   +4.449865841809238e-02   +1.938352212544934e-01   +2.673260384531771e-01   +1.939842743275906e-01   +1.102803178704680e-01   +1.901518975246805e-01   +2.972368611955002e-01   -9.101697722593237e-02; +1.421169913634830e-01   +1.907113135727235e-01   +2.718258645208120e-01   +1.089847318980768e-01   +1.222530533701644e-01   +7.035798897668870e-02   -7.883336670944033e-02   -1.164627441861863e-01   -3.286218567419364e-02   +4.659850684547542e-02   +5.209664831853389e-02   +1.335302788904894e-01   -4.498277733804690e-02   +3.828085054424940e-02   +2.986201568132012e-01   +3.331644970161397e-01; +9.857071885213488e-02   +1.132727421661809e-02   +1.400792574606835e-01   +2.209556387587845e-01   +2.236549586796127e-01   -1.271454501619153e-02   +3.360054271378682e-02   -8.799125330940839e-02   +1.415877949850077e-01   +6.370633961087735e-02   +8.108686609733300e-02   +7.297752707465308e-02   +7.709942553993140e-02   -5.268488327496934e-02   +2.839931207735805e-03   +9.867100715500438e-02; +1.472569797012449e-01   +1.479814831900229e-01   +2.880386035870951e-02   +2.722293372911068e-02   +8.467424586196780e-02   +9.495692030449228e-02   +2.976479170203389e-02   +2.152944928129331e-01   +1.109458531871258e-01   +4.432336239070418e-02   +9.041946988668767e-02   +1.817307427077069e-01   -1.278729088530638e-02   +3.270631771669287e-01   -1.096648274758352e-02   +2.591084067357063e-01];
L2I_L1I_iGABA_netcon = [+4.246506046165954e-01   +1.171173741833642e-01   -4.328057571288675e-02   +2.535700842560709e-01   +6.358864927912516e-02   +1.270264774663483e-01   +1.198551799539825e-02   +2.862782629096614e-01; +2.062168056886111e-01   +1.172209426238142e-01   +1.705540811142239e-01   +2.869937069090901e-01   -1.946446193367993e-03   +5.477836691361546e-02   -1.032385767201405e-01   +7.280490275439362e-02; -1.138836315656830e-01   +3.282438188714878e-01   -1.753281298306755e-02   +2.574496617504377e-01   -2.868694790529300e-02   -1.322300500474129e-01   +7.012845439375326e-02   +8.229510748324537e-03; +5.063749928345345e-02   +1.218222420208342e-01   +9.254365225106755e-02   +7.330052433004011e-02   +1.215983962043982e-01   +3.156515361154307e-01   +1.998712027667265e-01   -4.687919641630707e-02; +3.427592218006333e-01   +1.453257701006863e-01   -5.409595165083762e-02   +1.462818475806482e-01   +1.110752832473024e-01   +3.108849643324968e-01   +6.692774040165524e-02   +1.592098811382148e-01; +2.763028475873466e-01   +1.749738964542849e-01   +2.378172609145504e-01   -1.162458049647489e-01   -3.010600727798525e-02   +2.652975085539574e-02   +7.714399892065532e-02   +6.709189377124032e-02; -4.649858598821400e-02   -1.506542990129214e-01   +6.167781565940896e-02   -9.340101300052986e-03   +9.982236584150098e-02   +3.629074031290244e-02   +2.366442540480623e-01   +9.669959702736375e-05; -1.398076148805132e-02   +1.631689603245702e-01   +2.246389706420769e-01   +1.699560837828112e-01   +1.225529643118986e-01   -7.219374889598253e-02   +2.838605321540235e-02   +7.663082165679964e-03; +1.051916355561140e-01   +6.507282268353314e-02   +6.377549002327196e-02   +1.411940534610510e-01   +5.675552183037248e-02   +1.890811217557152e-01   -1.727124607027993e-01   +8.852226418051798e-02; +1.856127846086522e-01   +9.863069097793088e-02   +2.400707795265499e-01   +2.986127685996718e-01   -9.774443411588313e-03   +4.221327972729477e-01   +2.851753770402297e-01   +1.753599421884126e-01; -1.065051755523545e-01   +4.335361649427248e-02   +1.694361367412885e-01   +3.392555010529008e-01   +3.784316137172561e-03   +2.873242297483092e-01   +2.647498214885966e-01   +2.909977494147331e-02; +1.672515571110811e-01   +7.957458622780399e-02   +1.259500771352831e-01   +1.408593506121734e-01   +1.862551663594405e-01   +2.460937210818097e-01   -4.108879047130562e-02   +7.359541582716142e-02; +2.304664356442419e-01   +5.806126296509238e-02   +3.251652538048387e-01   +2.816868391999747e-01   +9.950618103617595e-02   +3.514577400891318e-03   +8.260856818099019e-02   -1.169776482868451e-03; -1.876294215671820e-02   -1.882770837132844e-02   +2.620084182856598e-01   -1.750121936870256e-01   -3.337879375508516e-02   +1.157659563151669e-01   +1.002480138644919e-01   +1.631268580615161e-01; +3.292235718211328e-01   +2.379666509922519e-01   +5.953464381560546e-02   +1.783850844396533e-01   -1.425325431042161e-01   +7.888071715774665e-03   +2.939213696827295e-01   +3.038119982517500e-02; +1.635300665470626e-01   +2.020079614605679e-01   +1.432194787980003e-01   -7.352882951563924e-02   +2.461041629114762e-01   +1.653426880941688e-01   -8.378892082446582e-02   +2.188734521854682e-01];
L1I_L2I_iGABA_netcon = [+4.199303530448195e-02   +3.707427538757210e-02   +1.104661668753882e-01   +2.303919918206045e-01   +9.949798130655123e-02   +1.099131639486447e-01   +8.160654557188959e-02   +6.550704304536296e-02   +1.033625028926591e-01   -2.855944850758141e-02   +2.030314190903559e-01   +2.796913656604220e-01   +3.773433427431158e-01   +1.742458982838430e-01   +8.328159783360115e-02   +2.521071536447330e-01; +2.585076616323255e-01   +8.586545594269279e-02   -1.962190323003887e-03   +2.633857217791732e-01   +1.736589268492565e-01   -1.120978752536896e-02   -1.858769232766795e-01   +1.554654166855984e-01   +1.407965349046380e-01   +1.157115999613736e-01   +1.631080197029197e-01   +6.389762084350625e-02   +4.649611806789443e-02   -5.053722262148869e-03   +1.252135249031223e-01   +3.073277069291352e-01; +1.605757968170095e-01   -1.969820485379933e-01   +7.697132058766223e-02   -4.792231344387055e-02   +2.862985131296351e-01   +2.335518388559175e-01   +4.188099447907997e-01   -7.254614037631163e-02   +1.715261453331735e-02   +7.714366969533075e-02   -2.297041728117448e-01   +3.109378495946128e-01   +1.238683891495282e-01   -2.867062412105319e-02   +1.006096081783211e-01   +1.227388046592230e-01; +1.109933502892561e-01   +1.742152183594391e-01   -6.668791879889725e-02   +8.541844554166333e-02   +8.487332050393027e-02   +2.349207812916514e-01   +2.766079209341388e-01   +1.176478238772077e-01   -1.546870438253435e-01   +2.386058265397584e-01   +1.400802425334526e-01   +1.306442062423488e-03   +2.303978685900555e-02   -2.137154691498921e-01   +1.588240128333708e-01   -8.214266090232353e-02; +1.255407748538300e-01   +2.644621318330212e-01   -1.038751669911736e-01   -2.710189443351332e-02   -4.942617542558289e-02   +2.576369772482632e-01   +2.200045871059617e-01   +1.079517667967453e-01   +1.182428452659407e-01   +8.130171580810533e-02   +1.440315488728230e-01   +5.814344455448160e-02   -1.420147370725110e-02   +1.706947371183417e-01   +1.545444713571101e-01   +1.085788772743106e-01; +2.215639350163870e-01   +6.334698884448683e-02   +2.403160064922377e-01   +4.684107731397855e-02   +2.353880388846011e-01   +3.753692130660821e-02   -6.038245897838300e-02   -8.665106972978723e-02   +3.299402774322986e-01   +2.980107334337475e-01   +1.290261310113811e-01   -7.097035339350451e-02   -6.525970456892385e-02   +9.217049499011373e-02   +1.010682092598036e-01   +1.022935851741668e-01; +8.875017059749585e-02   +1.030398163272799e-01   +2.221613228769973e-02   +2.542075471747368e-01   +1.706906752117317e-01   +3.444933219640817e-02   +2.143528649082692e-01   +2.206462141018680e-01   +1.193932180213400e-01   +1.481208252376973e-01   +2.274559541738525e-01   +8.127821877311187e-02   -1.472340078177600e-01   +1.579083533506173e-02   +2.100678576530024e-01   +6.158537230795212e-02; -2.107510478853498e-02   +4.692181550078276e-02   -9.034279148172465e-02   +1.946173973451648e-01   +2.469709713028227e-01   +1.539480718592591e-01   +7.430436622135340e-02   -9.371122826210965e-03   +2.055791915835393e-01   -5.619856216572346e-02   +7.890895402119498e-02   -7.887268712481110e-02   +7.776887460862894e-02   +1.654354988995910e-01   +1.925985066744276e-01   +1.233962933071703e-02];
L2E_L1E_iAMPA_netcon = [+4.190334051609396e-02   +1.977959885255503e-01   +1.470769748741834e-01   +1.410157854180299e-01   -1.743950194778763e-02   -3.172255443888185e-02   +1.820917336831379e-02   +9.266095284467848e-02; +1.763672347799078e-01   +2.959294132250290e-01   -4.771416572733684e-02   +2.331948447638385e-02   +1.777231556342664e-01   +3.143983349734494e-01   +1.923850450551108e-01   +1.094644958346383e-01; +2.192786541953381e-01   +3.044831115253230e-01   +9.007523117420697e-02   +2.225073008700391e-01   +1.239777688147831e-02   +7.835211399098232e-03   +1.926915739270398e-01   +2.255672524803906e-01; +1.703320053031376e-01   +2.770375829011642e-01   +2.650599779371567e-01   +4.236717494028648e-02   +2.904350790558406e-01   -3.145457877994727e-02   +1.588965394307321e-01   +9.643272557073414e-02; +1.653293448103819e-02   -8.007549934920266e-02   -2.759975648034393e-02   +2.687252095454912e-01   +1.502746205391828e-01   +1.637855856253398e-01   -1.030395533429709e-01   +3.336429654087088e-01; +1.141106913754433e-01   -8.954084981060074e-03   +2.041437092282095e-01   +5.191667968636773e-02   +1.850073612013903e-01   +3.010026071852583e-01   +3.838084883896604e-02   -1.658618192737930e-01; +5.654157355461605e-02   +4.175437413008698e-02   +1.069974506563529e-01   -9.004752565357119e-02   +1.800191432753480e-01   +1.418158135330107e-01   +2.537520523153455e-01   -1.025979249926614e-02; -9.464419691301784e-02   +1.544078951976681e-01   -2.992292097984099e-02   +2.491791922377637e-01   +2.442493716468141e-01   +3.281463027168915e-01   +8.566081188453203e-02   +3.343381558592285e-01; -1.633540543183877e-01   +1.585330784878812e-01   -1.768378049643740e-01   +3.645377926123072e-04   +1.073447252165604e-01   +1.956974004168809e-02   +3.446173338552934e-01   -7.698636615673161e-02; +8.763339787606365e-02   +2.612352926690483e-01   +2.707732636057533e-01   +2.553944245845311e-01   +1.360242778095821e-01   +2.903190927618599e-01   +1.786664305981768e-01   -1.591469074820601e-01; +1.617440528390665e-01   +1.098728322228576e-01   +1.300449943084998e-01   +8.379605608757806e-03   +2.000392288367644e-01   +1.726461199971613e-02   +2.450171086316364e-01   +5.713957693751381e-02; +2.815646184400128e-01   +2.169845890800663e-01   -1.221353268940913e-02   +2.052006690256332e-01   +1.688037679240745e-01   +1.014049842589228e-01   +7.648914646473270e-03   +2.964102508556220e-02; -7.491874134139670e-02   -7.794801684303534e-03   +1.076627783160302e-02   +1.554624397638948e-01   +2.326591168899707e-02   +1.300330775777584e-01   +2.030948682686291e-01   -5.117625119588741e-02; +1.916914789545643e-01   +1.239646681396821e-01   +4.156527077773518e-02   +1.797923323737575e-01   -8.236071419902254e-02   +2.152245437854404e-01   +2.996800788563847e-02   +1.275137030295214e-01; +1.665692731794070e-01   +9.825164457375760e-02   -1.391945316113362e-01   +1.976917176357598e-01   -1.862453110218332e-02   +6.666236411806653e-02   +1.897987233984057e-02   +1.822670965165407e-01; -6.563197423195556e-02   +8.302713448493161e-02   +4.827100355409933e-02   -1.072059004838418e-01   -1.302009659353900e-01   -6.260676101975948e-02   +6.624498155904537e-02   +1.475839963629653e-01];
L1E_L2E_iAMPA_netcon = [-2.033800533090566e-01   +1.843091683795052e-01   +4.985286096394799e-02   +1.198298228777705e-01   +1.320849210700397e-01   +3.100667289531832e-01   +8.608814226670820e-02   +1.846548213273908e-01   +6.645072329677432e-02   +1.065795838133805e-01   +3.472804440748938e-01   +3.372923985735150e-01   +2.954730661983876e-01   -1.846645778693923e-02   +3.754051822891663e-02   +1.419092978577765e-01; +3.005077831800504e-01   +9.369538559732707e-02   +1.478258762448653e-01   +1.247591144776540e-01   +1.553378166035103e-01   +1.619952186773623e-01   +3.198082824576707e-01   -9.123696412241450e-03   +1.381546871005749e-01   +1.037928279358683e-01   -6.673707013103308e-02   +1.764853060676684e-01   +3.006199198594407e-01   +3.474655264580886e-01   +3.777828464761779e-01   +1.453413877257006e-01; +1.216101440228488e-01   -1.568690285221608e-02   +3.632900531984032e-01   +2.162264135517966e-01   +1.979082161344798e-01   -1.850486973233691e-01   -1.426513419389629e-02   +3.318889981837958e-02   +9.598634640039699e-02   +1.672872745995989e-01   +7.851611326711483e-02   -3.853084714480604e-02   +1.028302403946506e-01   -6.464481875953790e-03   +9.148877231365057e-02   +1.518029950968214e-01; +9.713179650270676e-02   +1.319933440504995e-01   +1.954497392767783e-01   +1.999990799868595e-01   +2.173746455713797e-01   +2.833470538396447e-02   +1.903924401180973e-01   +2.943260304356543e-01   +3.220382544489869e-02   -1.103276135200779e-01   +1.684371679839193e-01   +1.368876359963421e-01   +1.593610386382904e-02   +4.705615744954125e-02   +1.415351684307053e-01   +3.262442092588951e-01; +1.145404328339279e-01   +4.646509004415433e-01   -1.464315743871029e-01   -9.078987626204005e-02   +7.776347521137177e-02   -1.705695831706413e-01   +1.042086810589472e-01   +3.140439580028351e-01   +7.006445128167722e-02   +2.032837729016054e-01   +8.556404553481675e-02   -7.570818096807394e-02   +2.512805615642854e-01   +8.141025721597278e-02   +1.833981241126122e-01   +3.053581217746452e-01; +1.025389952331557e-01   +2.945726223312740e-01   +1.787861987610314e-01   +1.112425068111958e-01   +4.156219993503797e-02   +2.266302985502050e-02   +4.204425185949647e-01   +3.071179499622645e-01   +5.402317729031206e-02   +5.728448384196236e-02   -3.113115830793399e-02   +8.369667599283048e-02   -1.382064503948214e-01   -1.211580319588544e-01   +3.953952077460779e-02   -8.860510286027339e-02; +2.324541495085469e-01   +1.742944110767788e-02   +1.952470210675419e-01   +1.822794986575657e-01   +2.826566011794055e-01   +2.146549406875918e-01   +1.351209095000968e-01   -7.555870697138596e-02   +5.970320918185840e-02   -5.054736099483396e-02   -9.347012789926898e-02   -9.149904226025918e-02   +3.015651345804344e-01   +5.264735762783956e-02   +1.718920632027569e-01   -6.574147406692096e-02; +2.736496443108672e-01   -9.292265699140295e-03   -2.051427771909833e-02   -6.755925103531335e-02   +2.899121061385327e-02   +6.271760613566044e-02   +4.173114560753741e-02   +5.795477003953035e-02   +1.084756253371512e-01   -4.287233670656443e-02   +7.096924721928499e-02   -4.901600665934897e-03   +1.763954827891757e-01   +1.065090930555488e-01   +1.467444061557735e-02   +2.418842004111099e-01];
L2I_L2E_iAMPA_netcon = [+2.438368892053658e-01   -1.170643851812629e-01   +7.875533319434896e-02   +1.797868994079795e-01   +1.210146909168333e-01   +2.599578949583475e-01   +3.207170583549580e-02   +1.304289236292191e-01; -1.454110328553329e-01   +1.492266366323351e-01   +2.149430863461918e-01   +9.618165905065007e-02   +2.313510503991542e-02   +7.301478175367432e-02   +2.374977409373794e-01   +4.947397119651097e-02; +1.502174651469499e-01   +3.184308359812982e-02   +1.285834058213649e-01   -7.383776806345552e-02   -2.893707938399852e-02   +1.108060892540330e-01   +1.819152814687772e-01   +3.795319201185729e-02; +1.343663848636525e-02   +1.151380531697321e-01   +1.264337195398424e-01   +1.665240706875322e-01   +1.927463712139422e-01   -3.213501445241703e-02   +1.434696914479001e-01   +8.860405285844900e-02; +1.702409535202328e-01   +1.579566872637956e-01   +1.367019892996771e-01   +3.003066264978872e-02   +6.951609628573215e-03   +2.032601449013468e-01   +2.379131235045160e-01   -2.752181630948933e-02; +3.209443262533875e-01   -7.841897502529119e-02   +2.767318299687720e-01   -5.132111835811786e-02   +9.052505909533753e-02   -7.889592452612748e-02   +1.594509191798039e-01   +1.697358176280775e-01; +1.650886566001303e-02   +4.158262551478530e-02   +3.272039098311363e-01   +1.884178995680939e-01   +9.755689121770081e-02   +7.286640117701523e-02   +2.329286603392529e-01   +1.838677576445081e-01; +2.345320164403840e-01   +2.941288949904473e-01   +3.522829958779347e-02   +1.524060327919878e-01   +3.234351708814088e-01   +1.227306665214042e-01   +5.543174519210643e-02   -2.865521940707769e-04];
L2E_L2I_iGABA_netcon = [+2.634248342176549e-01   +1.544042654079248e-01   +2.224172964141564e-01   -4.955197894644744e-02   +1.970829900970217e-01   -1.379610150519200e-01   +1.247041971002043e-01   +1.503554960801981e-01; -2.919431519875001e-02   +7.930591054471109e-02   +1.161502504355837e-01   +6.397533340219182e-02   -6.418043570623919e-02   -8.164997148937270e-02   +5.055600981106495e-02   +3.439276693355514e-01; +3.137328355769961e-01   -4.593372143087646e-02   +3.184466698079221e-02   +2.224724620692671e-01   +1.794041180603624e-01   +8.889642587277825e-02   +5.293375903366727e-02   +8.443932454981176e-02; +1.692256488526669e-02   +1.359352084833269e-01   +2.807626170912258e-01   +9.390684429170937e-02   +1.250184044606800e-01   +2.241365536731017e-01   -5.889976857636024e-02   +1.359245537998957e-01; +9.960925267415874e-02   +1.345770934906969e-01   +3.573267154516208e-01   +2.182336685536309e-01   +2.771584916925755e-01   -8.139620204565329e-02   +7.585215697969522e-03   +1.245871046602211e-01; +8.080582983836876e-02   +1.145650274172863e-02   +1.242397837735751e-01   +2.085737276757247e-01   -4.732266365234199e-02   +9.859784859947399e-02   -4.106127697607333e-02   +2.176877374616052e-01; +1.110769956930174e-01   +2.248065396576465e-01   +2.447552653966875e-01   +5.220962450389796e-02   +1.420573549974937e-01   -1.107110102996937e-01   +2.722730248826755e-01   +2.902913536749551e-01; +2.015864424950793e-01   -8.954856440851193e-02   -3.186587959833845e-02   +9.093910591066115e-02   +1.419574979775950e-01   +7.868613450431361e-02   -8.539172133637989e-02   +1.615109575856657e-01];
L3E_L2E_iAMPA_netcon = [+1.252807801876638e-01   +5.739841864267074e-02   +1.892309261225891e-01   +8.389316978000642e-02   +1.646049747905519e-01   -2.064090033460597e-02   -1.129162597697282e-01   +1.586076938795777e-01   +1.514170552902092e-01   +9.404381367730892e-02   +2.174038363819092e-02   -8.295327692598774e-02; +2.891402353583498e-02   +8.303633850757168e-02   +2.243556344284595e-01   +1.772106546238592e-02   -8.447282965157357e-03   +1.493977625405966e-01   +1.067600193248984e-01   +1.699607464505626e-01   +1.536132163955400e-01   +6.180649987698210e-02   +1.211782288238962e-01   +1.598547144897988e-01; -4.099079856022950e-02   +1.317586202390969e-01   -9.322184943341602e-02   +6.149798434254217e-02   -2.793466256672606e-02   +2.032705982809432e-02   +1.848649623294145e-01   +2.845772337263997e-01   +5.663302981287754e-02   +1.933798248109781e-01   +2.952346559750516e-01   -8.085038999875055e-02; +1.468032690340194e-01   +1.548843352690895e-01   -7.833053801881754e-02   +2.012328320259365e-02   +7.252132462338731e-02   +4.436027742810344e-01   +7.135514667982416e-02   -1.211218477138108e-02   +3.860342718109379e-02   +5.925474864544239e-02   +7.280333573985891e-02   +1.402550614083411e-01; +1.890336614345818e-01   +1.394444294429306e-01   +1.276777967147137e-01   +1.337362371113378e-01   +2.537688802220461e-01   -1.438230351497839e-01   +2.294181726205231e-01   +4.752700367710000e-02   +1.905546305226197e-01   +1.952587724196733e-01   -5.973002379992257e-02   -1.176579700129566e-01; +1.613260624662611e-01   +1.279608320354007e-01   +1.490141249349958e-01   +1.005257750994649e-01   +1.946319839155035e-02   +2.577119083211153e-01   +1.758121401038925e-01   +1.091745496543527e-01   +1.915575018599348e-01   -3.060904365334516e-03   +5.965797379137826e-02   +7.487618930937036e-02; +1.227952448244490e-01   +1.817944501602887e-01   -1.516752011572381e-01   +1.738939399948385e-01   +3.875103402581969e-01   +2.032029404553842e-01   +1.266480781524597e-01   -5.097201036486948e-03   +2.868430232685740e-01   +1.362931804078249e-01   +1.679468390680185e-01   +2.862613441104720e-02; +1.647394269162339e-01   +2.167148708450046e-01   +4.214503736858136e-01   -2.061850137120028e-02   -5.202592356961236e-02   +2.023854638440415e-01   -9.923206274632021e-02   +1.414722526328368e-01   +6.539431875325256e-02   -9.168175478315065e-02   +1.113706206350060e-01   +1.397957207129376e-01];
L3I_L2I_iGABA_netcon = [-5.398339248956807e-02   +1.814208422315585e-01   +2.992623286285618e-01   -5.280424412905646e-03   +1.113314670092651e-01   +1.449086683541997e-02   -8.549632878458223e-02   +2.796497487254517e-01   +3.000719425236370e-01   -4.753996058494936e-02   -6.206738606697876e-02   +2.158105051017589e-02; -3.200543728248433e-02   +3.245538979272527e-01   +2.811221356373846e-01   +2.048142029479483e-01   -3.635770422985907e-02   +3.222180938953052e-01   -6.499164634492208e-02   -3.745578924678611e-03   +1.188874023471280e-01   +1.480226118321043e-01   +8.894955304270422e-02   +2.532085725696427e-01; +2.765051976240278e-02   +1.305483397541551e-01   +3.066374968570148e-01   +3.171146385904016e-01   +1.505225373400722e-01   +1.773201267813554e-01   +2.861305763501706e-01   +1.640991114561473e-01   +5.386290551866295e-02   -2.810540803796822e-02   +2.698363898419160e-01   +4.187770241664418e-02; +1.453275367983265e-01   +6.414410074787105e-02   +1.946541990734981e-01   -2.093245302226772e-01   +2.052382523629901e-01   +2.666426271755735e-01   +3.244435818982502e-01   +2.949799992534995e-01   -2.007227378990337e-02   +9.084074009975966e-02   +3.046723018367630e-01   +1.018456009747878e-01; +3.102457999277454e-02   -6.615168857137588e-03   +2.271463312831542e-02   +1.092921509155118e-01   +6.415594872454472e-02   +3.990412166096821e-02   +3.424955684565686e-02   +1.460834812285960e-01   -7.916542783481208e-02   -2.300468575136560e-03   +1.728225559586964e-01   +5.773715456392163e-02; +1.031882127832109e-02   -1.128142191133996e-01   +2.181877436132794e-01   -1.361355597997778e-02   +1.669813292417709e-01   +1.672299448209675e-01   +1.195214778442042e-01   +1.802526999612342e-01   +4.085715455442951e-02   +3.551048388477152e-01   +1.599630641697790e-01   +1.896220865592509e-01; +3.563389718450785e-01   +7.246445572443708e-03   -2.211287039767051e-02   +3.713268012335953e-01   -6.641149290845293e-02   +1.640312987220799e-01   -4.900526190584390e-02   +3.904070532040199e-04   -3.504599343158708e-02   +9.794283134906304e-02   +5.295304639727683e-02   +1.706651045243973e-01; +3.812580188255177e-02   +9.235812132102950e-03   -3.532630890502261e-02   -3.168640317138196e-02   -1.824214456791225e-02   +5.552573208662658e-02   +9.556883113957364e-02   +5.908322278965148e-02   +3.937351334140761e-02   +3.587882641288099e-01   +1.104788868261189e-01   +1.930028385548684e-01];
L2E_L3E_iAMPA_netcon = [+1.373858449171564e-01   +1.740378060542450e-01   +1.062896284637059e-01   +4.007916032972931e-01   -4.559060082889693e-02   +9.075790971035033e-02   +6.815586806286549e-02   -3.684969048649678e-02; +6.101277296537144e-03   +1.130515873203161e-01   +9.648128501967562e-02   +1.767640799224841e-01   +1.475786011208324e-01   +6.350187958447470e-02   -1.541206904995190e-02   +2.292483096227849e-01; +6.788333874451991e-02   -1.098355920788430e-01   +3.094734652790838e-01   -1.833145920548174e-03   +2.585452668206178e-01   +6.770495921828087e-02   +2.815543842472311e-01   +3.650084893462544e-02; +8.215282470316497e-02   -4.458671794058215e-02   +9.455494026727421e-02   +3.972081514142359e-02   +9.228720457473445e-02   +1.411543457024350e-01   +4.015761468455440e-01   +1.961833343743369e-01; +1.456687020157436e-01   +1.583533442877606e-01   -1.060001844085297e-01   +1.282187925971917e-01   +2.065976381072083e-01   +1.597697085310277e-01   +5.976530556690007e-02   +2.676778150095800e-02; +1.177976406052805e-02   +2.203354116710161e-01   -5.500796299522581e-02   -1.540804189860998e-01   +1.133931815338738e-01   +3.118828256400775e-01   -2.149566712848272e-03   +2.117784283917500e-01; +1.339923513817587e-01   +6.358859434760192e-02   +1.633825361812471e-01   -8.760366306327155e-02   +2.480161002968991e-02   +1.193574547215260e-01   +1.712585691705678e-01   +9.563487924362526e-02; +2.470828616119856e-01   -1.120677588015887e-01   +5.530522589806644e-03   -1.695883803823009e-02   -2.014935156090965e-02   +2.163618501603047e-01   +1.940965538061817e-01   +1.151776315259237e-01; +2.673097861734720e-02   +7.136158322295000e-02   +1.581789996520656e-01   +2.292449986876142e-01   +5.059274925647247e-02   -5.822897157381409e-02   +9.891988124542639e-02   -2.243003419793764e-02; +1.241753942186413e-01   +2.657008555142456e-01   +1.400900728646889e-01   +3.382117172414904e-01   +1.595965739013131e-01   +1.281240698497415e-01   +2.576938830289013e-01   +3.123955474765956e-01; +2.255560693277049e-01   +2.426375693256281e-02   +2.713679717673899e-01   +1.607286493767731e-01   +1.183803531111052e-01   -4.591848266068062e-02   +3.559059434907322e-02   -5.191444602066185e-02; +2.813605796418287e-01   +9.405178446120536e-02   +1.309209019011630e-01   -1.042442034631172e-01   -1.097976367887644e-01   -5.842228553372881e-02   +2.748050228012874e-01   +8.526232096622580e-03];
L2I_L3I_iGABA_netcon = [+1.574958881103772e-01   +2.835431074466807e-01   +2.269544984176731e-01   +2.682840661274065e-01   +1.063733220198298e-01   -2.468289843817592e-01   +1.389794513569194e-01   +3.128683205643535e-01; +1.680097796754749e-01   +3.334166934723208e-01   -5.225555472798929e-02   +9.486927460071173e-02   +3.775704312853003e-01   +9.691344575322597e-02   +4.690567290674623e-02   +2.238975850988244e-01; +7.868773937169060e-03   +1.645123456200707e-01   +9.218151003959700e-02   +8.504481348533707e-02   +3.256336921561450e-01   +2.626049485762498e-01   -4.580021227046010e-02   +1.986216318645510e-01; -1.050982996010437e-01   +2.119267686276975e-01   -6.815517424419640e-02   +2.027597540790047e-01   +1.911402814445809e-01   +3.098094661500755e-01   +1.980322973787363e-01   +2.601371672875294e-01; -1.222883290141115e-01   +1.211951254031214e-01   +3.605615182803039e-01   +3.276776994926911e-02   -7.416959839409265e-02   +1.736467557915566e-01   +1.482744747761985e-01   +2.334611642562324e-01; -4.862637191025222e-02   -7.279847814893206e-02   -8.493680136687673e-02   +6.317255382464329e-02   +2.529948278599583e-01   +1.542984864435591e-01   +7.907670027009731e-02   +1.311329161677699e-03; -2.356031180042469e-02   -8.602351588725939e-02   +2.852906770246502e-01   +2.045897540524975e-01   -6.355661544964500e-02   +4.169441803364873e-02   +1.665806163765974e-01   +7.571917841222330e-02; +1.717247032269194e-01   +3.107043820571958e-01   +3.915944437239893e-01   +5.030787737712289e-02   +5.693350737960602e-03   +2.057835870274489e-01   -9.244936830162476e-03   +1.853771878991594e-01; +1.950388009161065e-01   +1.813660914142397e-01   +2.810215861405616e-02   -9.768137292823633e-03   +6.925943695448931e-02   -3.301490154731065e-02   +4.794896860332253e-02   +2.436397296084602e-01; -1.016907268120152e-02   +1.067726368702997e-01   +1.146227033858519e-01   +1.786358306557777e-01   -2.601593718438477e-02   -6.473194358352286e-02   -1.054147752872282e-02   +3.929704232152599e-01; +1.811777343112571e-01   +9.594702065909483e-02   +1.903351929092370e-01   -6.568135072195429e-02   +1.209580071993097e-01   +1.115503162783005e-01   -6.423946065712149e-02   +8.440780469228262e-02; +7.787852405638956e-02   -1.222388901702235e-01   +1.114813475768407e-01   +2.212559299981889e-01   +1.232663195406477e-01   +1.394742999371303e-01   +2.107213361219612e-02   +1.173543173772933e-01];
L3I_L3E_iAMPA_netcon = [+1.844111802626580e-01   +6.007692353535997e-02   +1.049286135302021e-01   +1.415010815508203e-01   +1.520102345169415e-01   +1.448410404685518e-01   +4.250679877413921e-02   +9.127375990989062e-04   +1.607180509074734e-01   -1.091575074969106e-01   -8.635885002546670e-02   +5.036676057271605e-02; +1.228600758374987e-01   -1.388081523337970e-01   +1.142018574815045e-01   +2.904922424297697e-01   -6.710246819680371e-02   -6.483781669064494e-02   +3.256183978393914e-02   +9.335615436676825e-02   +2.703017033352680e-01   +6.362264694657076e-02   +2.645630711080625e-02   -6.593109097666486e-02; +2.220903756542537e-01   +2.413510334970290e-01   +4.268415744543871e-02   -4.190940436757762e-02   +1.907672934134855e-02   +5.181478649214889e-02   +3.090581388989090e-01   -3.646506747894129e-03   +4.996989328591492e-02   +1.572104305519731e-01   +2.210317253447962e-01   +1.379981388449205e-01; +2.838157014406851e-01   -3.665154483393417e-02   +9.303168982802734e-02   +1.361918982387961e-01   +1.312005689646280e-01   +2.559827743375431e-01   +1.586699190344262e-02   +7.184143303605739e-02   +3.983914661632079e-01   -2.760853318288846e-02   +1.709020381032114e-01   +2.521366727388261e-01; +2.597410485139845e-01   -5.344336692372359e-03   -2.974187410914083e-02   +1.023877654374482e-01   +7.816693499257421e-02   +8.833778875551210e-02   +3.751237730953487e-01   +1.244069245722677e-01   +1.526851264658133e-01   +8.967362273777514e-03   +8.736546142947997e-02   +2.269864945273450e-01; -2.353939893023275e-01   +1.076673458920158e-01   +1.496542613453183e-01   +2.174511596909749e-01   +9.747164676933617e-02   -6.468671583999558e-02   +8.373461023371659e-02   +1.166796327256144e-01   +2.918148633141100e-02   +6.002842054369839e-02   +2.262052626979242e-01   +4.046179984197182e-02; +1.386954353864299e-01   +3.287165576386570e-01   +2.090398332275406e-01   +1.029108326373067e-01   +1.669197663146367e-01   +4.919497040014077e-03   -6.173362812090424e-03   -2.112465095669228e-02   +4.660743423530737e-02   +1.128990240374009e-01   +1.846353527985258e-01   -7.627405159729636e-02; +1.932416629393408e-01   +2.027699628943571e-01   +1.912723349764641e-01   -5.829439574951205e-02   +5.029236071987137e-02   +2.492908265289491e-01   +1.384834654603989e-01   +2.384867037750548e-01   +2.044003071752258e-01   -2.247477981930164e-02   +1.483430426972542e-01   +1.392008282841840e-01; +7.347781451566998e-02   +1.011416268968388e-01   +2.494475104922990e-01   +1.188870323494905e-01   +1.572768951112599e-01   -1.596162214876400e-02   +4.534404100312688e-01   +2.944556845246074e-01   -1.090920833649267e-01   +1.425458929530034e-01   +8.025663847058311e-02   +1.408907150489825e-01; +2.716035851482906e-02   -1.527850759199020e-02   +1.710111241477974e-01   -4.424014916902456e-02   +2.517847089898503e-01   -5.288306995792434e-02   +3.342690829160727e-01   +2.248438288172473e-01   -8.065493805737758e-02   -1.378062561282986e-01   -3.349571832957927e-02   -1.349936647255924e-01; +2.659215217221478e-02   +1.987452548123824e-01   -5.534118858515905e-02   +8.090380976543581e-02   +6.795936343002405e-02   -2.093635978677016e-01   +1.081912863365215e-01   +7.423033784753451e-02   -9.569432204112709e-04   -8.019126879612273e-03   +9.274994563276945e-02   +2.931816810087563e-01; +2.559632004844782e-01   -2.452596811755509e-02   +7.149245993576257e-02   -1.603383615190375e-02   +1.961137153891772e-01   +2.402291994656942e-02   -6.168387183432128e-04   +2.337448305814640e-02   -3.569269092991364e-02   +1.154713893781583e-02   -2.948070087442792e-02   +1.578546912025379e-01];
L3E_L3I_iGABA_netcon = [+2.461494792351358e-01   -1.790542754845216e-01   +2.183035696696980e-02   +3.271803094799772e-01   -7.122922356594838e-02   +2.167469027110813e-01   +2.580648222566836e-01   -1.013913235559002e-01   -1.153420277665342e-01   +6.045780024820006e-02   +1.387093455657384e-01   -1.103656737991286e-01; +1.902604395545802e-01   +1.778902563044205e-01   +1.206199752661963e-02   +2.316541666281167e-01   +1.444198209641217e-01   +1.153413834066111e-01   +1.004654324665733e-01   -1.313201044158591e-01   +1.885118870299916e-01   +1.556952196679008e-01   +2.690709142471857e-02   +1.606876481478217e-01; +2.414480808613103e-01   +1.154425083767478e-01   +1.979708908156263e-01   -1.237358174681236e-02   -9.460776769556936e-02   +6.276716103849346e-02   +1.452181933136111e-01   +2.899131916658210e-01   +1.901129070053409e-01   +1.484668391699466e-01   +6.523806062734501e-02   +1.120056756897835e-01; +2.372748373681572e-01   +2.029960140887278e-01   +5.157122894636368e-02   -1.321841899553109e-01   -1.976788629012929e-02   +1.088479445613527e-01   +9.552357217811715e-02   +1.665129245560186e-01   +1.973595959752032e-01   +1.668919453003198e-02   -7.308161937730231e-02   -1.241270560093767e-02; +2.037355921769058e-01   +3.310981671693513e-01   -2.198781951523607e-03   +7.689565101320590e-02   -4.846224046048640e-02   +1.564978361355609e-01   -4.324671544902875e-03   +4.987568280137568e-02   +1.556987546335482e-01   +1.610142661220797e-01   -3.417410197059877e-02   -6.856356756650707e-02; +5.972458120378157e-02   -8.299604845454937e-02   +4.179558110752134e-02   +1.549127572202375e-01   -1.123382036127014e-01   +2.330822742007591e-01   +3.175028996706946e-01   +2.255524731608433e-01   +3.781989637025190e-01   +2.564168310015926e-01   +3.537050448315122e-01   +3.015892446355020e-02; +1.894990519572257e-01   -4.134973451794217e-02   +8.598375182402093e-02   +4.859861950706400e-02   -6.824756030381718e-02   +1.423509375952119e-02   +1.961388099857443e-01   +3.229098232946318e-02   +1.811658774535386e-01   -1.103806740871725e-01   +2.414079531253780e-01   +2.710315677097632e-01; +1.670101556106044e-01   +1.902263857487768e-01   +1.715147930077415e-01   +1.456742182285667e-01   +7.724711856187699e-02   +1.539607709671441e-01   +8.687160228496971e-02   +2.659596731691060e-01   +2.256907448851828e-01   -7.650338288889458e-02   +2.474422602866421e-01   +1.250352148514417e-01; +1.519904226005171e-01   +1.649846898472496e-01   +6.189999271344196e-02   +2.188073991678779e-01   +1.011291652531797e-02   +2.268780321389145e-01   -1.483584785135167e-01   -9.009749581473483e-02   +1.560777464053874e-01   +2.825167772053658e-01   -1.139929873663159e-01   +7.632292174520923e-02; -3.314920811413602e-03   +4.907139336059310e-02   +2.067114736991709e-01   +3.963381726343007e-02   +5.158096956392501e-02   +3.848723667310084e-02   +5.962118619334789e-02   +3.369187017006595e-02   -1.793015269424638e-01   +1.681522430513604e-01   -3.693982779517743e-02   +8.630860631799281e-02; +1.355947359915995e-01   +1.978585803900829e-01   -2.991509547197234e-02   +3.022677531071265e-01   +2.665063366465233e-01   +5.053173407980022e-02   +3.050688018882727e-01   +2.918039442400534e-02   +9.482681547953867e-02   +1.620996921719649e-01   +3.141034811558543e-02   -3.730997167695495e-02; +1.134355378404315e-01   +2.802003452174334e-01   +2.601257438857932e-02   +1.233495825112326e-01   +1.102182144958520e-01   -1.249597725007355e-01   +3.150092850589642e-02   -5.645903660035728e-03   +2.473543463086952e-01   +1.606737463177266e-02   -6.156095043888127e-02   +1.119548580202360e-01];
L2E_Input1_iAMPA_netcon = [+2.324340003868968e-01   +6.621273282288227e-02   +1.037058556901374e-01   +8.691715156227958e-02   +4.282654119752281e-02   +3.101703621463734e-01   +7.328741040897853e-02   +9.444148001707467e-03];
L2I_Input2_iAMPA_netcon = [+3.646440219796709e-02   +2.597855746551190e-01   -5.172729692147401e-02   +4.573971805419232e-02   +1.365156933000632e-01   +3.370736559694912e-01   +4.905178649271996e-02   -6.328253249540103e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
