function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.552322463698290e-02   +2.802296469480104e-01   +4.895122280127719e-01   +3.725530581319281e-01   +3.332728355982992e-01   +5.184513642275319e-01   +2.649390894569868e-01   +9.630651898716869e-02   +1.097271371999647e-01   +2.393279366384861e-01   +3.055842194571373e-01   +9.870213151652078e-02   +2.111758837911776e-01   +3.523928113496483e-01   +2.353478413681626e-01   +4.036339837331385e-02; +1.956049233131987e-01   +7.305773483250915e-03   +2.787346296650763e-01   +3.343549899053747e-01   +1.492610146691524e-01   +1.732120407624957e-01   +4.837897683562058e-01   +5.290965581453024e-01   +3.646735261759566e-01   +1.047443253628639e-01   +5.264409048642206e-01   +1.169558160053403e-01   +1.067902559353182e-01   +1.702463217274143e-02   +2.821704130903923e-01   +1.823034618935278e-02; +3.559402641963303e-01   +3.777741326080162e-01   +4.513737645472849e-01   +2.528038097395235e-01   +6.159644751512385e-02   +4.521284536278366e-01   +4.688083351190373e-01   +2.283697254392645e-01   +2.536635069524890e-01   +2.227637218323797e-01   +2.426847987544861e-01   +7.921442204712854e-02   +3.950540055773815e-02   +7.747143660913562e-02   +4.427039211134330e-01   +3.115534611196190e-01; +4.785402638940631e-03   +1.018696884895298e-02   +2.446237946589333e-01   +3.275284662495510e-01   +1.073774545437216e-01   +4.268164066377328e-01   +2.422409625034415e-01   +5.182541017778531e-01   +2.597761160447397e-01   +1.573824807983562e-01   +4.794955429529094e-01   +4.778159976129537e-01   +6.595609873066884e-02   +4.882149144420920e-01   +1.197865882440720e-01   +1.711722352113765e-01; +2.508447894553458e-01   +3.441758329723777e-01   +3.311790897456819e-01   +3.700007048661382e-01   +2.100604506903893e-01   +4.438695932054696e-01   +2.643606742156367e-01   +1.403654891685013e-01   +2.950526821049311e-01   +4.490756566049396e-01   +1.956352697216883e-01   +3.638761116113778e-01   +1.274999844387378e-01   +1.712633970123064e-01   +4.780363904189621e-01   +8.834550545101798e-02; +2.586246251936997e-01   +7.670043429950636e-02   +4.438196518538495e-01   +8.703515043769779e-02   +3.363177361457489e-01   +1.644552157829584e-01   +2.402828604456266e-01   +1.019767177894956e-01   +2.653205908303304e-01   +2.554046515860292e-01   +4.023886633113826e-01   +1.292589181782319e-01   +2.574991194555460e-01   +2.810148499526336e-01   +2.575622097057079e-01   +3.759627814222899e-01; +1.749022162711734e-01   +3.551718182411727e-01   +4.963479401414764e-01   +3.471506452360251e-01   +2.024276750724360e-01   +3.285582420800859e-01   +1.973273168053546e-01   +4.448207656084908e-01   +5.143499200059223e-01   +2.095456760436208e-01   +8.116759810019855e-02   +9.268927832896157e-02   +2.242423382144727e-01   +4.974758576819229e-01   +2.444128440923058e-02   +1.273308995739731e-01; +3.006656269257398e-01   +1.891520889174839e-01   +4.143212714908846e-01   +3.288511831329951e-01   +3.091717212447446e-01   +8.244987191167202e-02   +4.258784902235837e-02   +2.311284789704943e-01   +4.108280892091314e-01   +3.643812825483025e-01   +1.542367404740059e-01   +3.994475548887841e-01   +1.699657720689062e-01   +5.705450935486768e-02   +3.812605032319334e-01   +3.284044904598865e-01; +8.873644115479716e-03   +3.542677830575119e-01   +3.573776370700204e-01   +3.644622939745688e-01   +4.819565404365616e-02   +4.837395997957413e-01   +2.378665726203677e-01   +2.357609993489676e-01   +2.657683981533308e-01   +2.584515510336532e-01   +9.063268476529766e-02   +4.774853966673895e-01   +7.485977117024912e-03   +4.140293075269944e-01   +1.968240791113647e-01   +2.630694075884447e-01; +3.772126955677679e-01   +5.714727073395423e-02   +4.720503998227082e-01   +4.378156610224688e-01   +3.391277895731299e-01   +1.008982169163519e-01   +4.194972318157146e-02   +7.899396741668296e-03   +3.991089805674286e-01   +2.150149014800831e-01   +5.446344138155037e-02   +2.952947591944617e-01   +4.409542581936970e-01   +1.364455825289302e-01   +4.591420333455146e-01   +3.521132168982351e-01; +2.110255396292980e-01   +2.559256902965077e-01   +2.743822089399225e-01   +4.218795320779175e-01   +4.792326845991151e-01   +1.003948266591386e-01   +3.317205841531870e-01   +3.204467061967072e-01   +1.307102463778071e-01   +1.547495328280204e-01   +3.881057505912580e-01   +5.046704414896169e-01   +6.382777337513836e-02   +3.738168624489029e-01   +4.098667924648091e-01   +1.017612606222413e-01; +2.832285034684266e-01   +1.626334901748129e-01   +5.558242567497459e-02   +1.602832626877717e-03   +5.177515820456244e-01   +4.871613482451643e-01   +2.458342715118277e-02   +3.711881551257636e-01   +3.677326473342916e-01   +1.563103756701014e-01   +5.716418971030293e-02   +1.444784376927948e-02   +4.904163967215222e-01   +4.101787206778154e-02   +2.872100530250170e-01   +2.176840578188989e-01; +3.544793558405254e-01   +3.902680776358963e-01   +4.688582345765785e-01   +8.285975270520057e-02   +3.517649127100312e-01   +3.732761903904747e-01   +3.766654937390096e-01   +3.405778601982643e-01   +4.728163560665062e-01   +2.316751812330269e-01   +2.185471798651155e-01   +4.668468599605552e-01   +4.468130691578312e-01   +3.826327626415624e-01   +2.362937215938332e-01   +4.807186686267439e-01; +4.479110606683694e-01   +3.551598931630399e-01   +1.618981598036999e-01   +3.280389304850947e-01   +6.540013487636959e-02   +1.284732730734392e-01   +3.087048971441264e-02   +1.259365041816007e-01   +1.826450926026540e-01   +3.718437455736389e-01   +1.048399326972832e-01   +4.182255545525886e-01   +2.967379864777364e-01   +3.301044359349878e-01   +2.104244616032738e-01   +1.719893963627726e-01; +2.137955051464955e-02   +2.839492988728395e-01   +4.466521639569364e-01   +2.785220172711127e-01   +1.443362631866577e-01   +9.657896191300690e-02   +1.423482666358002e-01   +2.091088184485073e-01   +1.237786516067123e-01   +5.294014635157548e-01   +1.934413168650690e-01   +2.850120038109941e-02   +1.020501166954784e-01   +3.869323043382957e-01   +1.481877668888693e-02   +3.636441333262322e-01; +4.161632825132612e-01   +1.925750031982783e-01   +1.118219010318273e-01   +5.119478573104634e-01   +6.087669187043308e-02   +7.380559051462549e-02   +4.725858033128265e-01   +7.686875056075794e-02   +3.249305125221598e-01   +4.021106360637346e-01   +3.503169775394505e-01   +8.427592601548051e-02   +3.989512287086436e-01   +4.255698449057042e-01   +5.069051017385808e-01   +4.787661867580457e-01];
L1E_L1I_iGABA_netcon = [+2.801834206789518e-01   +3.416448906665658e-01   +3.591154243537477e-02   +1.748861561179504e-01   +4.426413243596695e-01   +2.098130083614900e-01   +1.955289971265099e-01   +1.209535953972937e-01   +4.628452122748148e-02   +1.993395129722865e-01   +2.016535661472675e-01   +3.076228008356087e-01   +1.677812469195770e-01   +4.818234596199485e-01   +1.156969601167275e-01   +2.760464311405094e-01; +7.433634062202860e-02   +4.867831896895749e-01   +2.713330512295181e-01   +4.672192052252555e-01   +2.417468319234604e-01   +2.239414728077413e-01   +7.990107813884724e-02   +2.716711856098528e-01   +2.536335184217428e-01   +8.291038838007921e-02   +1.103839006469499e-01   +3.747736156987605e-01   +2.549681608013741e-01   +3.865128050735373e-01   +2.642088818606617e-01   +3.815589770761625e-01; +3.320893939144405e-01   +5.274242746889567e-01   +4.163313894136702e-01   +3.382689568267895e-01   +6.277883703782343e-02   +3.104766713296108e-01   +3.478276215719729e-01   +4.578023009680373e-01   +4.683508517474087e-01   +5.062412739302745e-01   +3.494336014372144e-01   +2.639819039282015e-01   +5.141670650639122e-01   +4.433506250480393e-01   +2.332179649287116e-01   +2.979429927949580e-01; +2.498920153178955e-02   +7.578093494379573e-02   +4.882256962432268e-01   +2.436281376984066e-02   +9.659019261004188e-02   +3.804371674499957e-01   +3.800930931511635e-01   +3.021511029072059e-01   +2.630807529321226e-01   +5.143284162472991e-01   +3.406489886633143e-01   +4.720869153329438e-02   +1.864089866317325e-01   +9.452006073610643e-02   +5.058752394785962e-02   +5.153925354470198e-01; +1.075865009780151e-02   +4.627148185652939e-01   +2.766376134729927e-01   +4.754677395836811e-02   +2.237791701309822e-01   +4.523898225344412e-01   +3.753862923616116e-01   +2.075533110275223e-01   +1.932479969916876e-03   +8.087257004937205e-02   +3.846110955006584e-01   +6.473146811939696e-02   +4.370885850538763e-01   +2.457452707894756e-01   +3.536424380335264e-01   +2.896246729463708e-01; +4.136503535031633e-01   +4.961924741842721e-01   +8.016300609341263e-02   +3.569451272319154e-01   +1.933486882874232e-01   +3.412024924687363e-03   +3.689313671935248e-01   +1.565522934796487e-01   +4.380904532889845e-01   +9.043986862319119e-02   +5.023985064970332e-01   +7.119608174942904e-02   +2.016571267698375e-01   +7.160856521188025e-02   +2.800803018704267e-01   +7.551017433051442e-02; +2.681769040860844e-01   +1.199668764470686e-01   +6.809560348467202e-02   +1.411703311634159e-01   +1.032948896920726e-01   +1.997128302073094e-01   +1.578413104821639e-01   +2.857383206291104e-01   +4.691173035217113e-01   +8.352523149748260e-02   +4.023399022363948e-01   +5.314212039849378e-01   +5.303247845287504e-01   +2.796853679677841e-01   +2.759686219718027e-01   +1.600080421368581e-01; +1.487649240622539e-01   +1.150015897870632e-01   +1.173338959447270e-02   +8.267847282525591e-02   +3.832482213005114e-01   +2.765299610702714e-01   +2.638512303318161e-01   +3.316696055702731e-01   +1.039417083352892e-01   +2.202640116937610e-01   +4.407585441890856e-01   +5.005846150449310e-01   +2.805312144122272e-01   +2.432647727728190e-01   +9.606067868398822e-02   +3.679378556038608e-01; +1.569439545744649e-01   +3.240148972151727e-01   +1.626908185440825e-01   +9.468888348184226e-03   +9.531392405999319e-02   +3.751601500492462e-01   +4.282746615521917e-01   +4.815200940104283e-01   +2.005266233094117e-01   +5.634859536672103e-02   +4.042279931688723e-01   +1.875427198236782e-01   +4.699519491180219e-01   +4.969631488948301e-01   +3.214276024936717e-01   +4.237096363295147e-02; +2.849392611115100e-02   +2.137965745465797e-01   +8.104022023369715e-02   +3.059437147662022e-01   +2.156771911615565e-01   +4.430040221590196e-01   +1.655168303367593e-01   +1.215048523004195e-01   +4.987552420804476e-01   +4.084813708106200e-01   +1.251563298457372e-01   +3.227468265143137e-01   +4.089533083852231e-01   +9.732955134782395e-02   +4.110576022118679e-01   +1.163886008121934e-01; +4.576942315425253e-01   +4.595615986987164e-02   +1.610036965366535e-01   +2.140477618635488e-01   +2.834420238157880e-01   +3.525169552678860e-01   +2.386922222117306e-01   +5.096879279468181e-01   +1.710839658826105e-01   +2.174978196547646e-01   +3.050252237058348e-01   +2.541629834089120e-01   +1.330641400562713e-01   +5.173366095936500e-01   +4.684381542772890e-01   +1.773140060256118e-01; +9.638426367434862e-02   +4.782627641257776e-01   +2.964818466583982e-01   +4.919651400375878e-01   +5.263024367556057e-01   +3.569097291040595e-01   +2.511550394005616e-01   +7.799828899501872e-02   +3.835226329960250e-01   +2.428664245114130e-01   +1.842581603583851e-01   +4.446618899287947e-01   +3.550334322678182e-01   +2.618562209884691e-01   +4.184700869235234e-01   +1.311216643133162e-01; +3.890675660244889e-01   +4.669806029056403e-02   +2.825802496317742e-01   +6.154334844172889e-02   +2.875051785576241e-01   +3.035593782929603e-01   +3.101012889060189e-01   +1.086491662413710e-01   +3.954184490833950e-01   +4.706737003998676e-01   +9.260300287106150e-02   +4.177634998664924e-01   +5.178953154837075e-01   +3.282429753319872e-01   +1.976169629558617e-01   +7.359352723978471e-02; +1.358111418027318e-01   +1.385748790543850e-01   +1.215825668053882e-01   +5.392358106973634e-02   +1.009962729052152e-01   +4.634893080897313e-01   +4.940675469440498e-01   +4.006608898713240e-01   +2.292656572154450e-01   +3.474293863328377e-01   +5.231685145034736e-01   +3.943661826086649e-01   +3.324753479193512e-01   +4.620381998168105e-01   +3.463393937107299e-01   +3.887510442249275e-01; +2.273468977494200e-01   +9.075202747105607e-02   +2.343905087046614e-01   +4.688503337312130e-01   +3.342815710774001e-01   +2.706869120890869e-01   +5.881624550081515e-02   +1.840030843592621e-01   +8.967204498065311e-02   +2.692333645530932e-01   +1.427068555605746e-01   +2.344833694153604e-01   +1.995758097486258e-01   +1.241496299589186e-01   +9.498787794094295e-02   +1.614635766671645e-01; +2.318436102335374e-01   +4.055113542291675e-02   +9.592159174971739e-02   +4.944225696346086e-01   +5.016367826411974e-01   +3.689254091170870e-02   +1.065405350017325e-01   +4.283460485492525e-01   +4.210918543011646e-01   +7.204904070292895e-02   +2.460491108761316e-02   +3.338990324739888e-01   +3.484073038154287e-01   +2.732202038381437e-01   +2.124609060418621e-01   +2.380792899781461e-01];
L2I_L1I_iGABA_netcon = [+5.227651342624270e-01   +2.569051379888265e-01   +1.544908428727488e-01   +4.700031178429858e-01   +4.916283508941728e-01   +4.939508897390110e-01   +1.902699870189812e-01   +4.172113700194112e-01; +4.179378729646306e-01   +4.630884306632090e-01   +3.809080704641566e-01   +1.509579024321011e-01   +2.266616673468920e-01   +3.530459336247853e-01   +4.755896569022671e-01   +1.180117411392094e-01; +1.116591988244038e-01   +1.274621371257748e-01   +1.412406665763604e-01   +1.436174480577037e-02   +4.203669695139039e-01   +5.113247037679387e-01   +5.918683390515390e-02   +3.249512498408484e-01; +2.044157644549451e-01   +4.176637470283101e-01   +3.565843371629693e-01   +3.288968091665480e-01   +3.172187666578692e-01   +3.224978210122156e-01   +2.642486995271953e-01   +4.221302513600094e-01; +1.666498435768375e-01   +1.017880565470630e-01   +3.191811015822983e-01   +3.053473078211913e-01   +2.350302114386828e-01   +4.115637114681959e-01   +2.684231741953030e-01   +3.143902268782652e-01; +4.172066064343907e-01   +3.839043112525429e-01   +4.801390528105201e-01   +2.203676981810737e-01   +1.542096611788921e-01   +3.711727868780272e-01   +5.187333378677828e-03   +3.582558873570292e-01; +7.601751265202429e-02   +1.962103274280208e-01   +2.030705258262127e-01   +1.265697692586036e-01   +3.669920424231581e-01   +1.486207912320393e-01   +1.176489403975199e-01   +3.519349172576031e-01; +3.077794473441813e-01   +1.832662196635799e-01   +4.180089614446493e-01   +2.052638971041252e-01   +1.448377491094036e-01   +3.691633614097029e-01   +2.387321084759475e-01   +1.592805247359232e-01; +2.130324864484323e-01   +3.749180895851881e-01   +1.076618593661364e-01   +1.260922556755027e-01   +1.668036164445717e-01   +9.283102585487693e-02   +2.216011261859035e-01   +5.076969477465598e-01; +2.849635508160756e-01   +3.627200943711406e-01   +1.083613941851386e-01   +2.873362455378694e-01   +1.028674201286388e-02   +3.705356926579390e-01   +4.771497797886846e-01   +3.692129606419631e-01; +2.757095251177039e-01   +4.198956290469478e-01   +4.426857165096499e-01   +1.970663056912292e-01   +3.754540894185979e-01   +5.161801636500581e-01   +9.697846039029216e-02   +1.454399637430252e-01; +4.194286551116011e-01   +2.773804305767167e-01   +3.250571060116541e-01   +2.237511005748358e-01   +5.144566283125670e-01   +1.410038264600029e-01   +3.321315662655476e-01   +1.694455564589517e-01; +1.619240890511328e-01   +5.062389768638982e-01   +4.872092451806779e-01   +1.071675957351997e-01   +2.935506519660359e-01   +1.560620392138407e-01   +1.642168809568715e-01   +2.696862903859553e-01; +3.650260525289537e-01   +1.337817596826024e-01   +5.248907191343549e-01   +2.742886787116119e-01   +4.395628963027737e-01   +1.001119800100773e-01   +5.086426468217886e-01   +1.171388054860569e-01; +5.067556463699917e-01   +1.127526894440912e-01   +1.439936107484383e-01   +4.785864364131670e-01   +3.495844038528726e-01   +7.044998724215516e-02   +2.087178801124006e-01   +3.712976676348870e-01; +1.025544125885680e-01   +3.695505852518564e-01   +3.794338752869278e-01   +3.269760995312918e-01   +4.363901473014541e-01   +6.377110951996387e-02   +5.191807179380146e-01   +1.620343303385332e-01];
L1I_L2I_iGABA_netcon = [+2.985341549684168e-01   +3.618136871318496e-01   +1.621617136282481e-01   +3.891906305033414e-02   +2.675200996062275e-01   +2.080383296177546e-01   +5.194966844447861e-01   +3.644130323975869e-01   +2.194717190625696e-01   +4.097355550362717e-01   +8.110006266540941e-02   +1.622259118427672e-01   +6.331030556038739e-02   +2.687428001222761e-04   +1.092548556123646e-01   +4.189995842157944e-01; +4.255231442947262e-01   +3.167847678573689e-01   +1.995541969490382e-01   +2.443039844323379e-01   +4.908976094685500e-01   +2.395848773648506e-01   +3.586947274718766e-01   +5.125621960173942e-01   +2.261270324743250e-01   +5.213955754406543e-01   +3.517847927194220e-01   +1.876582620102097e-01   +2.649822154578456e-01   +3.309329828592092e-02   +1.972628182979991e-02   +4.677833586414233e-01; +4.505991578378640e-01   +3.097291704134629e-01   +1.143035939967017e-01   +4.353605899185950e-01   +1.765123987888379e-01   +4.581054880977743e-01   +4.042566478925760e-01   +3.466421524114672e-01   +2.001447191286495e-01   +1.895940502328732e-01   +3.592791504800510e-01   +2.078335955929156e-01   +1.741347113024772e-01   +8.497653019055457e-02   +3.250362409236982e-01   +7.256237957343266e-02; +2.217289434295294e-01   +2.926536917040869e-02   +3.116421637265324e-01   +4.604480378909508e-01   +5.521653738698475e-02   +1.959252172826895e-03   +1.879196423749979e-01   +1.807149948936868e-01   +3.304640564165896e-02   +3.402264713668822e-01   +2.925380050523703e-01   +2.527064621706231e-01   +1.346305016489180e-01   +3.166517763337682e-02   +4.247992188179155e-01   +2.789823517844931e-01; +3.919783048218062e-02   +4.316789375690747e-01   +4.166288974912249e-01   +3.549305798239707e-01   +3.298631215841902e-01   +2.626003884136549e-01   +3.365179338909352e-01   +4.429109484762853e-01   +3.237407324304538e-01   +1.358579020020030e-02   +1.652738800996965e-01   +8.806374840929275e-03   +1.303624633557447e-01   +4.658515902127286e-01   +1.067824780868605e-01   +2.478617885218664e-01; +3.353796166651852e-01   +3.756389970540567e-01   +7.154828680166378e-02   +4.731955759770006e-01   +2.984253657325123e-01   +5.129605649748812e-01   +3.852707395940577e-01   +4.341349359003197e-01   +2.910790629715283e-01   +3.096039574501518e-01   +5.324268975829317e-01   +4.338960049173857e-01   +6.668077460709389e-02   +4.812415452497929e-01   +3.792790952191412e-01   +4.801434140424112e-01; +4.068450946099282e-01   +7.786280266434738e-02   +4.530264413345835e-01   +5.224505109276959e-01   +2.066624156465815e-01   +5.184808024816427e-01   +2.722672751941400e-01   +2.508640003141667e-01   +3.794900522374486e-03   +3.074194584077395e-01   +1.632153620508993e-01   +1.856743319771060e-01   +4.132250599910661e-01   +2.218897788932886e-01   +4.501759963182028e-01   +3.023022899583683e-01; +3.968014431564609e-01   +5.607758618046663e-02   +4.775134101695342e-01   +3.826582545069559e-01   +6.139556213420298e-02   +4.173270607307686e-01   +3.146066278255060e-01   +4.085197106917260e-01   +1.922183712545962e-01   +4.500715362383030e-01   +1.398765979959918e-01   +2.600056605516204e-01   +2.642168111279738e-01   +3.349330254356994e-02   +4.896353616493569e-01   +1.791445222378190e-04];
L2E_L1E_iAMPA_netcon = [+4.116672122709925e-01   +1.527030688648364e-01   +7.827654835264983e-02   +5.258255892985753e-01   +6.577011398648365e-03   +2.534365197915935e-01   +3.512466158167093e-01   +4.127251730431247e-02; +4.910964615067404e-01   +4.604440099641228e-01   +2.823093582658452e-01   +1.978852258441536e-01   +2.690097827973404e-01   +9.211262060045779e-02   +4.854539807985850e-01   +2.086865885819400e-01; +4.910896706567029e-02   +6.877432039922471e-02   +1.736238813824410e-01   +8.600329406933814e-02   +3.339608689025639e-01   +4.529524170158071e-01   +1.758378714904117e-01   +1.643490795397705e-01; +1.354129201539956e-01   +3.868255505399022e-01   +1.122675409963245e-01   +3.472657646809983e-01   +3.993946135546228e-01   +1.629995937217786e-01   +4.686464457539504e-01   +4.426269237825862e-01; +1.012129987675592e-01   +5.252376001052101e-01   +7.380716245190924e-02   +1.471757852519135e-02   +5.012023733732713e-01   +5.060473584602566e-01   +3.631300754168110e-01   +2.474924190939723e-01; +3.734665091050532e-01   +2.707861986500235e-01   +5.018699177032974e-01   +4.158607309494690e-01   +3.725396437918589e-01   +1.197074726407638e-01   +4.198531411506315e-01   +3.613480458422825e-01; +5.508409789758899e-02   +1.799447427957773e-01   +1.539206854350537e-01   +2.425141978879107e-01   +4.874231204340730e-01   +2.458702181845671e-01   +8.298706594935455e-02   +1.793024876249955e-01; +3.630828386312962e-02   +6.517853281661777e-02   +2.805365776775385e-01   +3.586830504393872e-01   +2.088987761535851e-01   +4.820006464698930e-01   +5.135805386916028e-01   +4.806931945393515e-01; +1.871877707162459e-01   +4.721627463587247e-01   +2.191505640669927e-02   +1.409111086153125e-01   +8.778841408817377e-02   +5.102376066056140e-01   +2.847566994778670e-01   +4.129297824752087e-02; +1.595931312034012e-01   +1.465793781909411e-01   +4.607195489477265e-01   +2.180495692307677e-01   +4.309345892744136e-01   +4.796598977169017e-02   +6.859719533519300e-02   +5.142738596847832e-01; +3.045500294062369e-01   +2.505790976602577e-01   +9.981580895228295e-02   +3.237792507414735e-01   +2.146594985475850e-01   +2.189064377972725e-01   +3.129650156404772e-01   +4.730031581133137e-01; +1.384706016976138e-01   +2.379304610886537e-01   +4.351363055391684e-01   +3.923107506408215e-01   +3.431670149079740e-01   +9.919825599493910e-02   +5.274363353773797e-01   +1.285834269938654e-01; +3.189067896101389e-01   +4.410746430585245e-01   +1.307878314609890e-01   +3.042002668505878e-02   +5.188244902096630e-01   +3.526060806939876e-01   +2.434113566273041e-01   +4.321182143696508e-01; +2.266516995035235e-01   +2.493310487117004e-02   +6.156712922080712e-02   +3.556740041164749e-01   +5.277440439415844e-02   +1.564241342286880e-01   +4.346040849055551e-02   +3.950843472350025e-01; +1.452472314882688e-01   +1.096646939827292e-01   +3.556426356970520e-02   +4.070960580386093e-01   +5.936662780616209e-02   +4.629382980093905e-02   +2.184139485107094e-01   +1.248998455984281e-01; +8.203070205233773e-02   +2.368834037568184e-01   +7.541311220137578e-02   +2.833188530258455e-01   +1.350810320732549e-01   +2.894595747186030e-01   +5.576575208070533e-02   +4.355710648012780e-01];
L1E_L2E_iAMPA_netcon = [+1.982880360055730e-01   +8.325349632132012e-02   +4.975453575403674e-01   +5.127727546645978e-01   +1.748907894505703e-01   +5.010410490274662e-01   +2.672571693041195e-01   +5.278539689050837e-01   +7.620857388601188e-02   +3.423297806346415e-01   +3.391243645694638e-01   +4.063144363486101e-01   +1.963813984424231e-01   +3.583364272878208e-01   +2.991003163407994e-01   +2.640922835641583e-01; +2.030279901111147e-01   +2.750342640459809e-01   +1.166194077393752e-01   +4.686045339657446e-02   +2.933666388793968e-02   +3.630853148512963e-01   +4.286097615068479e-02   +1.673813512105108e-01   +1.120607518591727e-01   +1.657409139863107e-01   +1.459589357284645e-01   +5.014509693497683e-01   +7.697868105307493e-02   +1.469118355931764e-01   +3.138876905201283e-01   +1.295072353960109e-01; +1.762434027923302e-01   +3.176185298980807e-01   +4.776138263980042e-01   +4.883132629957152e-01   +5.050211534802507e-01   +6.087859031729516e-02   +1.591298007503345e-01   +2.596001826160442e-02   +2.322512287673962e-01   +3.096895253928109e-01   +1.779159418829654e-01   +5.740799987257807e-02   +4.026420045915635e-01   +3.197974826406053e-01   +4.710001838627128e-01   +3.706662713866431e-02; +4.170341944601303e-01   +1.966295462657946e-02   +1.189798441448996e-01   +1.127221656480099e-01   +3.860874326366478e-01   +1.684262392554993e-01   +4.788503658059708e-01   +4.767957858401560e-01   +4.109815663336595e-01   +4.031405889572225e-01   +2.524099269604104e-01   +3.000854469398663e-01   +4.958409889314308e-01   +1.770127166752157e-01   +4.856981034802627e-01   +5.194803917102222e-01; +7.176549213204982e-02   +4.541524366494588e-01   +4.574937739909566e-01   +1.093189671240294e-02   +8.896044792447870e-02   +4.341443698623667e-01   +4.932338973690315e-01   +9.181541544109156e-02   +3.053295072600716e-01   +2.235996294584035e-01   +2.953591360018639e-01   +4.089967759675092e-01   +1.259945675811334e-01   +2.780329842716538e-01   +5.261845715380704e-01   +2.655196013104472e-02; +1.936130967073853e-02   +4.539011828240931e-01   +1.403995472454458e-01   +4.311675077950561e-01   +5.133125285170747e-01   +4.545965641500193e-01   +2.745222298743775e-01   +4.940203793703131e-01   +1.743751237894273e-01   +2.110148002763973e-01   +4.475872377893256e-01   +4.860987944301808e-01   +4.471605884066004e-01   +3.336311682843355e-01   +1.013529412481127e-01   +3.057946384673029e-01; +1.633345507281889e-01   +1.177534112562150e-01   +3.103313644384473e-01   +4.619992051027216e-03   +2.035441819170774e-01   +2.796262550503914e-01   +3.929852647214787e-01   +3.169354701763025e-01   +3.099358353737606e-01   +4.176634299722729e-01   +3.330244708187678e-01   +5.703542199927557e-02   +1.923804522186708e-01   +2.903779723533355e-01   +1.313727083397825e-01   +1.879358555472324e-01; +4.201128295983396e-02   +2.937064354285723e-01   +2.665589384193236e-01   +2.129883623400285e-01   +3.900985642874360e-01   +5.174693862354331e-01   +5.246350710101397e-01   +3.364147090346934e-01   +4.645736146271759e-01   +2.135195815801088e-01   +1.845536815102056e-01   +5.231811078600086e-01   +3.554454969889987e-01   +4.793003531802311e-01   +1.762814339626117e-01   +5.983640806958197e-02];
L2I_L2E_iAMPA_netcon = [+3.346311224457663e-01   +1.211208542442369e-01   +4.806507793244629e-01   +2.554137620072882e-01   +4.171569415358727e-01   +2.255385443147207e-02   +5.836919834929772e-03   +4.778579685306867e-01; +8.841696386134497e-02   +6.599292495887034e-02   +8.747917733988358e-02   +4.576189270911136e-01   +4.066303981156703e-01   +2.116906913280475e-01   +3.765050139300138e-01   +2.559012106862903e-01; +4.504724614169993e-01   +3.979288985073907e-01   +4.411336472036763e-01   +3.946566228485132e-01   +2.799500187253167e-01   +2.712398605906255e-01   +2.653866778483185e-01   +3.798681237405497e-01; +2.127133767290530e-01   +8.977633730414744e-02   +4.751113337446303e-01   +2.294819243875458e-01   +5.080892358549135e-01   +8.030092273171084e-02   +2.405597103598602e-01   +4.586572562824965e-01; +3.721035711763131e-01   +4.597124812694821e-01   +3.387771110263852e-01   +3.225171352674910e-01   +4.887484978519049e-01   +3.994078213676548e-01   +2.197982106721217e-01   +3.962896734592803e-01; +3.250320528768274e-01   +2.128287376488890e-02   +4.732894827041471e-01   +3.929072027914618e-01   +2.838057697659461e-01   +1.012571850935993e-01   +5.921479135088899e-02   +3.870620074097915e-01; +5.046026770515297e-01   +2.425220020505932e-01   +8.832564683327429e-02   +2.313341483393095e-02   +7.124749132305586e-02   +1.149399151230627e-01   +7.938704164339999e-02   +9.276007143760549e-02; +4.853610647432751e-01   +1.821413325172983e-01   +2.911240231683530e-01   +2.563764089187464e-01   +4.674618506290601e-01   +1.229642693796325e-01   +6.686920019776732e-02   +9.300276459343323e-03];
L2E_L2I_iGABA_netcon = [+4.916060659411270e-01   +1.298672040110200e-01   +1.086991053902936e-01   +1.012546996898671e-01   +3.556573330150262e-01   +1.982906364400642e-01   +4.384400062107824e-01   +5.006420455399873e-01; +1.340390860686692e-01   +2.250885952581329e-01   +6.479864216983379e-02   +8.191671527820948e-03   +5.244622032032873e-01   +3.674226300224414e-01   +4.035246115526491e-01   +3.741167067003123e-02; +3.483205235219091e-01   +1.858822528774991e-01   +2.941516378533209e-01   +2.262115640414551e-02   +2.055095469105837e-01   +4.006612828236277e-02   +5.243704707785145e-01   +4.424839361228369e-01; +4.619096600675430e-01   +3.587547366501508e-02   +1.386037385245215e-01   +3.891253932110483e-01   +4.901229900222978e-01   +3.419126326137947e-01   +2.326660369805842e-01   +3.532053844413286e-01; +8.974449485988414e-02   +4.815909687275775e-01   +3.762386692114558e-02   +4.471439334799503e-01   +1.646484579992731e-01   +1.993345936182816e-01   +2.014333533242177e-02   +1.461602413981862e-01; +4.005912811224901e-01   +8.161107597310821e-03   +2.911149433855104e-01   +4.240017192812987e-01   +4.735853587687783e-01   +1.437461475798687e-01   +5.090967000048418e-01   +4.192934562363649e-01; +8.389539762448028e-02   +5.180564039303048e-01   +1.574226526053586e-01   +1.852308063868497e-02   +3.844003001438932e-01   +2.805499130865409e-01   +3.227902305472673e-01   +3.321053163510352e-01; +4.608936767932868e-01   +1.653913855302521e-01   +2.653600554467682e-01   +1.073149849212496e-01   +2.446378240355687e-01   +4.147309193584616e-01   +5.051009186015153e-01   +3.256723318023414e-01];
L3E_L2E_iAMPA_netcon = [+1.926398471464563e-01   +3.405117654297533e-01   +8.554473266580484e-02   +4.332181351959581e-02   +5.909607186566954e-03   +5.214856150471489e-01   +2.075385069034142e-01   +4.559854228925504e-01   +6.378997170578155e-02   +1.581871116257938e-01   +1.539698257233502e-01   +2.972222387410487e-02; +1.414382726346215e-01   +4.695508432965947e-01   +1.584413412684512e-01   +2.012456464739387e-01   +2.448822175688430e-01   +2.977681950790622e-01   +4.860545652750466e-01   +5.263259280165064e-01   +2.988562992904307e-01   +5.128236355637248e-01   +1.867745493072925e-01   +1.364801433326828e-01; +5.494328685576796e-02   +3.934334822635308e-01   +5.662002616124046e-02   +3.945525972619514e-01   +4.933032648966325e-03   +3.685111485276961e-03   +2.839090753679353e-01   +5.219964262385248e-01   +3.141743211668531e-01   +3.290945343281826e-01   +1.309506474762251e-01   +3.800396255250961e-01; +1.681613869219419e-02   +1.080314063815997e-01   +4.335259035036080e-01   +1.372356384663172e-01   +1.487454941877118e-01   +4.994316659846709e-03   +1.769461806395417e-01   +3.607178874978232e-02   +1.185258808935312e-01   +1.679161394236476e-01   +1.022206408970650e-01   +1.740453263610897e-01; +4.772311377280072e-01   +1.962809502242188e-01   +1.810349691859869e-01   +5.264204908511266e-01   +3.611566241594952e-01   +1.954422616156933e-01   +5.195446121908541e-01   +8.276613078849164e-02   +4.487363362417037e-01   +2.587133177956791e-01   +3.670435231492355e-01   +2.153913361845163e-01; +4.707226718391671e-01   +3.188780197024329e-01   +6.020019269574787e-02   +2.579104610717161e-01   +3.391589650528046e-01   +4.835073880826344e-01   +4.726784996893410e-01   +2.031426400613371e-01   +2.450882025122636e-01   +7.002058804329404e-03   +3.387990930330258e-01   +1.302900904633634e-01; +3.309319494614155e-01   +2.714890595203330e-01   +3.345601885729261e-01   +1.079411864950331e-01   +2.880854695460009e-02   +1.910209851463388e-01   +2.894054493853487e-03   +1.846545627686839e-01   +1.491540328910346e-01   +5.424960515519495e-02   +5.869393866980506e-03   +2.463139292956953e-01; +4.508766133884575e-01   +5.020520814375633e-02   +2.035860458348326e-03   +1.398174026166643e-01   +2.906360810730296e-01   +4.964494922268549e-02   +1.799321962532687e-02   +2.559004072564397e-01   +2.603800946627505e-01   +4.561661687664514e-01   +4.671050912623199e-02   +3.212896604268182e-01];
L3I_L2I_iGABA_netcon = [+5.202511270736522e-01   +2.661206760499339e-01   +3.456644545363941e-01   +1.467289576518263e-01   +5.032637315007988e-01   +2.348592913102818e-01   +2.472293713045557e-02   +6.434652584536097e-03   +4.666452404278448e-01   +2.398368378021595e-01   +5.143325931360762e-02   +3.951900112449021e-01; +4.733412419196735e-01   +5.117092607798208e-01   +4.743489251498251e-01   +8.499413380764902e-02   +2.761514030899392e-01   +4.454284294054918e-01   +3.689710605313485e-02   +1.122094474495893e-01   +2.621502894006336e-01   +3.533081615564560e-01   +6.365259479477520e-02   +3.425316652950701e-01; +5.291006707476845e-02   +4.580685529042182e-01   +4.725271596902031e-01   +3.106922570044101e-03   +3.736507769928285e-01   -1.075362196097868e-03   +3.292991888840780e-01   +4.954708096008633e-01   +3.838615733892646e-01   +1.499074001953512e-02   +3.182567953283541e-01   +6.109122981361528e-02; +5.120676145409195e-01   +1.456863214681987e-02   +1.619103432423666e-02   +3.467792967875586e-01   +4.775512744001709e-01   +2.948514802365489e-01   +1.649395118561730e-02   +3.902269915453777e-03   +4.635879821950529e-01   +4.389662591222302e-01   +5.263879198837460e-01   +2.938763569076889e-01; +8.238975360013598e-02   +5.116511702688984e-01   +2.189835426131738e-01   +2.226856482146491e-01   +3.071659964972295e-01   +4.895396152317258e-01   +2.048297754053633e-01   +9.310461218181564e-02   +5.358726688061668e-01   +2.685836462680649e-01   +1.200533201930540e-01   +9.716362483929875e-02; +1.931756397917968e-02   +3.635228770628003e-01   +1.089310792411071e-01   +4.265510773032581e-03   +8.948094633384243e-02   +3.440827038741392e-01   +3.673498227580248e-01   +1.256063184294157e-01   +2.682092381530602e-02   +4.033489613347372e-01   +4.598920459905382e-01   +3.857736625054429e-02; +3.334983519541182e-01   +4.694789065490776e-01   +3.108258682893124e-01   +3.429676273965575e-01   +2.341107785233755e-01   +1.647887482639851e-01   +3.748045705810125e-01   +3.161701746564035e-03   +4.460080521727351e-01   +2.054228257947685e-01   +2.659120672051964e-01   +3.870025476959113e-01; +2.618330012104160e-01   +1.135899226982108e-01   +1.638656463603522e-01   +3.101574958338315e-01   +1.837960598778392e-01   +7.174194182652320e-02   +1.215850935114388e-01   +1.483564751801354e-01   +2.971635776187939e-01   +5.206042194718330e-01   +1.505493190198525e-01   +1.548558869682339e-01];
L2E_L3E_iAMPA_netcon = [+3.573346575625468e-01   +3.540366745089021e-01   +1.217228248122932e-01   +4.652431486830106e-01   +2.803672989622899e-02   +2.742036924674845e-01   +3.571877646504275e-01   +5.011802718458038e-01; +2.880112723525571e-01   +3.881753111199719e-01   +3.898192694349587e-01   +4.304758926016586e-01   +5.894323863975065e-02   +2.681573386379177e-01   +4.584496569803596e-01   +3.691356935077372e-01; +4.512724301832890e-01   +4.712751958616881e-01   +4.488355661765979e-01   +4.820688864157098e-01   +3.114899714568825e-01   +3.510904973377423e-01   +4.654736229455458e-01   +3.058302547521167e-01; +2.175171991801785e-01   +5.119193559852981e-01   +4.549031533916533e-01   +3.275375331409544e-01   +2.709519526197096e-01   +2.669240801029902e-01   +1.472478233902487e-01   +9.913618901593318e-02; +7.886368595770345e-02   +2.936021366236117e-01   +1.353344709793513e-01   +4.303020321881219e-02   +9.542871128298301e-02   +2.889037228555799e-01   +4.779143596744852e-01   +4.063371865933312e-01; +2.608330950804233e-01   +5.242763730921564e-01   +4.779783144687890e-01   +2.879538361347390e-01   +2.762883742659703e-01   +5.175770720712247e-01   +3.823158076260841e-01   +5.223117632061436e-01; +2.581619307995467e-01   +5.816992625500775e-02   +2.844957423601147e-01   +1.360467377961888e-02   +1.883950982360920e-01   +4.341963855377434e-01   +1.833430592591705e-01   +4.140281415257272e-01; +4.975349094879097e-01   +3.701140766458985e-01   +2.303199285227048e-01   +4.135562756632341e-01   +1.824274303511371e-01   +4.078883633870423e-01   +2.749624412175624e-01   +2.272544270991808e-01; +2.505445490367307e-01   +2.922442513594224e-01   +4.704995879104140e-01   +3.324504327750595e-01   +3.027129459835329e-01   +1.842779646723557e-01   +3.222915441197595e-01   +3.533805204117649e-01; +1.513595659235163e-01   +8.351375095580989e-02   +4.183365534438980e-01   +4.633805242653241e-01   +4.771671255793551e-01   +8.980694775918004e-03   +7.485723664148004e-02   +3.466651956360184e-01; +3.052198390063676e-01   +1.700093242486087e-01   +3.933391952905251e-01   +4.303606110516080e-01   +5.007098122428494e-01   +5.100819725612281e-01   +1.408560311700015e-01   +1.982884475519215e-01; +5.400616687610347e-02   +3.105192260590046e-01   +2.203368414526362e-01   +4.625293340306170e-01   +2.583160217163606e-01   +1.119401314924298e-01   +3.516770642490661e-01   +4.568628255475540e-01];
L2I_L3I_iGABA_netcon = [+5.007246906213719e-01   +2.148529600092145e-01   +1.461317151459579e-01   +3.795479007915182e-01   +3.919267042940262e-01   +4.480976533711217e-01   +1.902593875141246e-02   +2.763854889473690e-01; +2.936140016417447e-01   +2.516186354432663e-01   +3.735572450089050e-01   +8.840155071436787e-02   +4.680800924927405e-01   +4.346936331412928e-01   +2.475481366914297e-01   +1.323131682527331e-01; +4.167990339365501e-01   +3.887749672527349e-01   +4.979514384122354e-01   +3.325703860840173e-01   +1.902943928345442e-01   +3.244811503721283e-01   +2.111539552117044e-01   +9.328409890094348e-02; +1.151707038650480e-01   +4.434312400067191e-01   +1.161701953234741e-01   +2.598152351292795e-01   +1.721723564708682e-02   +1.916189026208332e-01   +1.985593171509309e-01   +5.198502310887259e-01; +1.625364906096746e-01   +2.080204103746350e-01   +2.838182674737958e-01   +2.504084812324363e-01   +1.911078880128250e-01   +3.413248529427397e-01   +5.137613860640198e-02   +7.106015319759590e-02; +9.550837602650179e-03   +1.360984582280149e-01   +2.316988875483489e-01   +9.350016608484923e-02   +1.903494479516489e-01   +2.108893481382782e-01   +2.798503803697623e-01   +3.712795381944250e-01; +1.879744596766162e-01   +2.528724679545569e-01   +4.976280401627103e-01   +3.391395469754799e-01   +3.886408059672001e-01   +1.578613928352745e-01   +1.704603299715268e-01   +1.621065461651573e-01; +2.043394115222525e-02   +5.257801032828302e-01   +1.669979551709087e-01   +4.713420081467085e-01   +5.725631923384749e-04   +4.048310148528469e-01   +3.014979374246622e-01   +4.069272987420304e-01; +4.734663421050503e-01   +1.532296882567992e-01   +4.482796104502660e-01   +3.412077109806368e-02   +2.637651642086809e-01   +1.404170098056491e-01   +2.196879781165078e-01   +2.409227444885358e-01; +4.065422985229489e-01   +2.626534746138175e-01   +1.337308379708551e-01   +2.671443515036857e-01   +3.305503029134690e-01   +1.833607400317993e-01   +1.125018683048656e-01   +1.638665259705888e-01; +3.821420804469206e-01   +5.157000274764300e-01   +2.826139674764470e-01   +3.659946394162462e-01   +1.560441786184000e-01   +1.907070454321650e-01   +5.058671210743455e-01   +6.497374587962144e-02; +4.049445603408668e-01   +6.069684090304809e-03   +1.763756365716626e-01   +7.674255122973130e-02   +7.570474857427517e-02   +5.118507717841281e-01   +2.572847713694209e-01   +2.948891070941227e-01];
L3I_L3E_iAMPA_netcon = [+2.349867220660268e-01   +5.270282235616918e-01   +1.460748128069938e-01   +3.270259015519114e-01   +4.153935448488823e-01   +1.694093972887012e-01   +1.507648048523085e-01   +1.196574126255009e-01   +1.750828317610159e-01   +1.508031872216167e-01   +1.395165363589573e-01   +2.375800804345212e-02; +2.170497493221627e-01   +4.524319100574345e-01   +1.230895165599364e-01   +6.921193497474126e-02   +4.180541744817744e-02   +2.833024077967159e-01   +2.934389956936173e-01   +2.945349360967802e-01   +1.192082329259033e-01   +2.601754209014335e-01   +4.012465618877303e-01   +3.049251965415863e-01; +1.421912292764764e-02   +3.294968144310717e-01   +2.447674946680170e-01   +3.114845744161039e-01   +2.593510628009031e-01   +2.412206169642503e-01   +2.680415097209298e-01   +2.438488571087660e-01   +1.820913770400760e-01   +3.028854389354678e-01   +2.446588918129105e-01   +2.961156736757154e-01; +2.077453830900204e-01   +3.907805125512007e-01   +3.333308606288687e-01   +2.275352658704232e-01   +2.407646507930686e-01   +4.742394220835809e-01   +4.043619221538165e-01   +6.286678797635623e-02   +4.889073524756667e-01   +4.818844034328063e-01   +8.499925318584577e-02   +3.929691002574724e-01; +5.858385682052530e-02   +1.766017729682205e-01   +1.824730085084112e-02   +4.582682644810781e-01   +4.021295740030282e-01   +2.923455636436049e-01   +5.093175832027642e-01   +2.708935645165458e-02   +4.713292846363785e-01   +3.035218518850163e-01   +2.037290008472203e-01   +6.183182695018802e-02; +1.817699235880601e-01   +3.564023517881613e-01   +4.449247942465820e-01   +2.258398646638639e-01   +5.237459102003891e-01   +1.328488699054271e-02   +4.764696339999525e-01   +1.320868383666756e-01   +3.597358879816273e-01   +1.239128640607094e-02   +1.820547150788427e-01   +8.345251003674849e-02; +4.337188343307565e-01   +1.961697346283899e-01   +2.088545660750902e-01   +1.518258083846557e-01   +3.583927321892024e-01   +1.041766474710833e-01   +3.013226309021029e-01   +4.899956474648690e-01   +4.446027449688094e-01   +5.195732013164219e-01   +2.773544523852545e-01   +3.775443931833048e-01; +3.874307168786595e-01   +1.139596654219090e-01   +3.851136145510816e-01   +3.145959992985339e-01   +5.254828968417253e-01   +3.149284388928163e-01   +5.051811680055372e-02   +2.619069737366472e-01   +2.315698360049736e-01   +1.567268327147471e-01   +1.308803202180938e-01   +5.042294004437455e-01; +5.165370263333474e-02   +4.523163908073340e-01   +3.913499735796794e-01   +4.282185659954126e-01   +1.952257546477153e-01   +3.832618186803390e-01   +9.543883202925416e-02   +4.163206764619582e-01   +4.450271974715365e-01   +2.434836906696769e-01   +1.112896578449102e-01   +1.262994532202380e-01; +4.906436900742717e-01   +4.114180150650096e-01   +2.133031572023126e-01   +1.269633191746038e-01   +3.020173634126961e-01   +4.094407195243220e-01   +2.678432036753874e-01   +4.636480706670259e-01   +3.545573154727545e-01   +1.837322061360950e-01   +4.699749572786050e-01   +1.155564905931468e-01; +2.352823023555958e-01   +1.843982361411978e-01   +5.252190516127926e-01   +5.022681680933767e-01   +7.300860278959873e-03   +3.297263666075448e-01   +4.371342658370721e-02   +1.302742863929055e-01   +1.963825437201367e-02   +5.079402704829905e-01   +4.073899975774309e-01   +1.891694786238549e-01; +5.825808648330149e-02   +9.331096112344023e-02   +1.696947598609078e-02   +2.416250567012588e-01   +2.303167877222210e-01   +1.275658713369320e-01   +4.162255912901375e-01   +1.064711661386394e-01   +1.742506861947202e-01   +1.282632149885825e-01   +4.108914776452796e-01   +1.468491936202412e-01];
L3E_L3I_iGABA_netcon = [+1.021212767424544e-01   +2.381788839966740e-01   +1.743376131645046e-01   +4.882787566390906e-01   +4.382400953710203e-01   +2.966952878682912e-01   +1.669162301887797e-01   +4.044110430902298e-01   +3.437809897017802e-01   +3.964497386626346e-01   +3.147591045393875e-01   +1.238094537058320e-01; +4.109120357740637e-01   +3.343789194142340e-01   +1.599131045858889e-01   +1.223455566580909e-02   +1.970977132053132e-01   +3.778867062841166e-01   +3.533484109425580e-01   +5.204814751835853e-01   +4.532907729310743e-01   +2.383655098795762e-01   +6.061694808563431e-02   +3.905917985892606e-03; +3.149863776614742e-01   +5.096690280356928e-01   +5.047874208887628e-01   +4.477996984398092e-01   +3.724977826065237e-03   +3.980197127429523e-01   +3.072694734850013e-01   +3.680392255199076e-01   +2.219730073846585e-01   +2.229558559952258e-01   +1.465526649290620e-01   +7.739066417849128e-02; +2.197743996663513e-01   +1.644915893958936e-03   +7.267679769652778e-02   +3.815772225959281e-01   +3.844086446072884e-01   +1.392121905528317e-01   +2.212002138335854e-01   +1.987508270761634e-01   +5.272577173343218e-01   +2.528171289955761e-01   +2.783394683277174e-02   +3.177198177511109e-01; +2.236215822972505e-01   +2.066278475196594e-01   +5.266885844115407e-01   +1.435841778342239e-01   +2.892507721517539e-01   +4.082013830123752e-01   +5.136533099518484e-01   +4.928557664201852e-01   +1.382705399420498e-01   +2.984043070479482e-01   +4.440494765292047e-01   +3.246625287567777e-02; +3.627675591056377e-01   +2.547751986308832e-01   +4.443876093043343e-01   +4.811845700720529e-02   +2.095972007931011e-02   +5.200206739841752e-01   +4.766850951124944e-02   +3.557369626814119e-02   +4.333892924680240e-01   +3.229017719512260e-01   +1.443931042406977e-01   +1.170453463781189e-01; +3.174803693393206e-01   +1.905762523075126e-01   +2.576456859083895e-01   +3.199699354138897e-01   +3.654313092638969e-01   +2.566413576375940e-01   +1.845865500970719e-01   +6.360444172383283e-03   +1.742627753377437e-01   +8.717184080899303e-02   +1.614518824397227e-01   +3.860016340315303e-01; +1.562364934793589e-01   +9.283011802322250e-02   +6.407250409741809e-02   +4.880074001226336e-01   +2.288814911339790e-01   +3.939296086229321e-01   +2.735126402773718e-01   +4.056777763128568e-01   +4.059727313431399e-01   +4.570935088221727e-01   +8.708067072071055e-02   +3.126304160796710e-01; +1.486932780052014e-01   +1.030264665799043e-01   +4.123215019636718e-01   +2.767097463312874e-02   +4.992634972326956e-01   +4.856407114190967e-01   +1.011994487973447e-01   +3.807427733871969e-01   +1.243841827963965e-01   +2.230588744181516e-01   +2.268661281401054e-01   +3.336631941340197e-01; +4.381640624643618e-01   +1.652496576767805e-01   +4.482809807297080e-01   +1.772916654262459e-01   +1.888732999410638e-01   +5.192905174534094e-01   +4.021015823179214e-01   +2.997537013500819e-01   +5.002337890617491e-01   +5.157887244516772e-01   +9.262229529115155e-02   +2.137298500134995e-02; +2.965778441639785e-01   +6.740461371192467e-02   +1.126465371616941e-01   +1.001542344601059e-01   +4.158226794027128e-01   +2.684955872123045e-01   +4.520903594614660e-01   +3.250652910942181e-01   +2.991271197220202e-01   +8.861707877536336e-02   +4.903823477197584e-02   +4.282870807355810e-01; +3.390089196502653e-01   +2.757684397982160e-01   +5.267550663854775e-01   +3.847297155260654e-01   +9.996025935009423e-03   +2.744244695248557e-01   +5.212322739166486e-01   +3.096284305972186e-02   +4.198824216574457e-01   +2.161561594874028e-01   +2.500704810159698e-01   +2.373230927508707e-01];
L2E_Input1_iAMPA_netcon = [+5.278433952391565e-01   +5.328895552331971e-01   +5.293309462443326e-01   +5.303799797784514e-01   +5.326315721915885e-01   +5.336891639909779e-01   +5.318387712960180e-01   +5.294200656240911e-01];
L2I_Input2_iAMPA_netcon = [+5.290229061851199e-01   +5.341372879335492e-01   +5.299358896505055e-01   +5.328062262401135e-01   +5.335700410107990e-01   +5.316499978577649e-01   +5.290108715534722e-01   +5.293075441358549e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
