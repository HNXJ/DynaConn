function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.143797567872054e-01   +9.466306771063525e-01   +6.985804962938794e-01   +1.543523382489123e-01   +9.205159910544257e-01   +2.185291079471479e-01   +7.401734612380191e-01   +3.024887612852488e-01   +5.327411564567087e-01   +8.296535254555698e-01   +9.689583566966795e-01   +9.648007923599343e-01   +6.966946129617572e-01   +3.724174812632160e-01   +2.978989908418058e-01   +3.776390369300269e-01; +3.469054555424658e-01   +1.251833405638032e-02   +1.423028579754759e-01   +1.757756805725370e-01   +7.181881449807472e-02   +8.097901142028433e-01   +7.943476398093429e-01   +7.583444639426001e-01   +7.843713716866373e-01   +1.821520470676029e-01   +4.660452131639872e-01   +6.550437237682514e-01   +3.766256050989482e-01   +2.759349715537042e-01   +6.857639339420670e-01   +9.530137219288194e-01; +2.077657853871493e-01   +4.679351583153653e-01   +8.376433286455218e-02   +7.019009564852522e-01   +3.136939370403685e-01   +3.828046974537280e-01   +6.640605598313359e-01   +9.539902345882720e-01   +4.919066158765948e-02   +9.247891720837079e-01   +8.707085885436459e-01   +2.083066828414880e-01   +5.408113756421410e-01   +7.608496192398469e-02   +7.732967780709261e-01   +8.130491445629798e-01; +2.349815988457283e-02   +4.905870543426852e-01   +4.322793178285186e-01   +8.338905392998899e-01   +6.291817553662330e-01   +8.570140761350050e-01   +4.399797090775099e-01   +8.453202893064867e-03   +4.621746676472770e-01   +4.198648840433060e-01   +9.466107322240849e-01   +8.981490229603072e-01   +5.180455949321471e-01   +1.502571914163648e-01   +7.205415569682626e-01   +8.906693972220746e-01; +7.653494632434233e-01   +5.158293017883728e-01   +8.950873608884550e-01   +8.075825572706750e-02   +9.060068016856316e-01   +3.227231242181079e-01   +5.758026148926818e-01   +4.057238452782390e-01   +9.382060465956429e-01   +3.003310491875152e-01   +2.326049523847759e-01   +4.882168478923753e-01   +7.639371916527971e-01   +3.657841801128515e-01   +2.776628379884310e-01   +6.911728182748232e-02; +5.719364665288025e-01   +2.875781866027163e-01   +7.327818693334465e-01   +8.360624547196862e-01   +7.967066721029874e-01   +3.796967174744690e-01   +5.186087894289079e-01   +1.532643180215390e-01   +4.735966505439104e-01   +3.474073789379010e-01   +9.179819411638738e-01   +6.631321754300641e-01   +8.093527127818900e-02   +7.164517364327699e-01   +1.305658494420335e-02   +9.027781758332049e-01; +5.772390628145987e-01   +5.654468749540000e-01   +6.807138615486912e-01   +5.425135981074583e-01   +6.420870464673710e-01   +6.369863169934172e-01   +7.239102353726766e-01   +8.209130672077067e-01   +7.791734044087942e-01   +9.713705032462446e-01   +6.330811966458902e-01   +5.267485267857051e-01   +5.264077122559708e-03   +5.327983427024048e-01   +1.517603379377195e-02   +6.664993923304491e-01; +3.887002085983879e-01   +5.106480999989648e-01   +2.026771221495540e-01   +9.623391965864955e-01   +4.395380746786575e-01   +3.864600951080409e-01   +2.212976036521629e-01   +2.885454116530107e-01   +1.097973989531379e-01   +5.313037235709680e-01   +2.837715087783089e-01   +7.086072018031696e-01   +4.025585583339201e-01   +2.327406426411507e-01   +9.356596626731243e-01   +3.458928117310389e-01; +5.556529124977617e-01   +6.779832326350934e-01   +5.295107574690647e-01   +6.774100796850260e-01   +7.488091776492467e-01   +6.865257123569926e-02   +9.980741410667484e-01   +9.776883901557032e-01   +5.213837203955923e-01   +7.911998619439750e-01   +8.549356149924403e-01   +7.193128140290328e-01   +6.620034107064113e-01   +4.717610586117786e-01   +9.332481155899501e-01   +8.369002543713142e-01; +1.831185923497872e-01   +6.166111172587777e-01   +8.308205481747873e-01   +3.350981710073772e-01   +8.262428941511988e-01   +1.722904825251364e-02   +6.186857682295318e-01   +6.258662550381947e-01   +6.363326517699982e-01   +7.945444392721338e-01   +1.662405700599204e-01   +2.942335887083221e-01   +3.677506528540788e-01   +7.164643598128317e-01   +3.722841539468198e-01   +1.976249397583046e-01; +1.176796738089637e-01   +5.650583440018200e-01   +1.753637171499301e-01   +2.201440086003771e-01   +3.417907219713168e-01   +8.797252392404040e-01   +9.805333366424751e-01   +7.439101893991584e-01   +5.788649257289296e-01   +1.429868427018623e-01   +8.272553314660355e-01   +1.171593455969041e-01   +3.931467625914329e-01   +5.135888163120130e-01   +1.089414027928576e-01   +8.413307256828634e-01; +5.889812913966833e-02   +5.047058194640147e-01   +5.171011865364458e-01   +5.679826129713178e-01   +1.393605106261621e-01   +1.566361830415105e-01   +4.951255330049657e-01   +8.727893886563141e-01   +8.354453062597695e-01   +4.560764139651098e-01   +2.167517221370068e-01   +3.246929003639161e-01   +1.337678034814990e-01   +5.130755634109980e-01   +7.191185478765800e-01   +4.250486038661374e-01; +9.336915384485293e-01   +6.666522973439440e-01   +3.561866303579854e-01   +1.162819288469374e-03   +5.052926937740051e-01   +9.140405215509126e-01   +5.218172669834497e-01   +3.293082658787864e-01   +1.160486156833937e-01   +4.583128435348878e-01   +2.671217168803864e-01   +4.560320254710357e-01   +3.386904441220533e-01   +3.860560934985499e-01   +4.487824197544562e-01   +5.593459084927208e-01; +7.459407699917988e-01   +6.335643029158098e-01   +6.471182208143891e-01   +5.880770830763377e-01   +4.134905051971619e-01   +5.574094587753649e-01   +8.538287046050237e-01   +9.808558173131761e-02   +5.164818982803498e-02   +9.558863918817077e-01   +8.864509818652301e-02   +7.154167060052420e-01   +1.223566282672816e-01   +4.778120719514972e-01   +1.203723662843948e-02   +4.474120669866472e-01; +2.442769459049845e-01   +1.444203063794574e-01   +2.801590102096310e-01   +8.917140164344532e-01   +1.721408971013800e-01   +9.224839253611231e-01   +2.541884314721505e-01   +4.515782742251069e-01   +5.167096397052170e-01   +5.377583672089900e-02   +9.169359755836155e-01   +4.052803289686866e-01   +3.687616229600755e-01   +7.397492188134048e-01   +1.241692600494953e-01   +7.600684050412404e-01; +2.045733489796176e-01   +1.778278406227922e-01   +4.352995294301511e-01   +2.550527178877666e-01   +4.936247987444304e-01   +5.962687723150609e-01   +5.813912616399005e-01   +2.398110851778219e-01   +6.966998329843831e-01   +3.572542837651729e-02   +7.264931410445317e-01   +2.421662536221119e-01   +2.517919985621737e-01   +7.024961696793686e-01   +6.591305603151513e-01   +9.713062249830905e-02];
L1E_L1I_iGABA_netcon = [+8.433577404757129e-01   +7.530141589295001e-01   +8.746677614244238e-01   +4.364869209685791e-01   +9.185582596956410e-01   +7.782979361921269e-01   +3.215672384398490e-01   +6.415874455720664e-01   +9.394131864163795e-02   +2.640078113933079e-02   +1.290087455192622e-01   +5.188602635510233e-01   +8.698143936894308e-01   +5.752602342778815e-01   +1.667016626788634e-01   +6.276505611061572e-01; +6.203057201492695e-01   +9.960122538001236e-01   +3.091189990826047e-01   +1.480963580059292e-01   +8.829672090325075e-01   +2.737020163097834e-01   +9.630454962486399e-01   +4.300999433647719e-01   +2.922376783816465e-01   +5.140768296682213e-01   +4.229393194906870e-01   +2.037397033790559e-01   +8.045893104335400e-01   +2.886573677588654e-01   +5.479944502164229e-02   +3.376009369723127e-01; +6.713940068922686e-01   +3.713549996020181e-01   +4.326977557220971e-01   +6.539050349846601e-01   +5.859441472226685e-01   +5.268149447402927e-01   +3.528193571558537e-01   +4.795282546117547e-01   +3.271884804276509e-01   +8.632777992818431e-01   +4.804586641084422e-01   +7.759295157341554e-01   +6.459117769963816e-01   +1.324948012659611e-01   +2.118310867938894e-01   +1.565970338915654e-01; +7.816643230073950e-01   +5.030407663800873e-01   +3.816682276461782e-01   +7.219177856104588e-01   +8.348472682727821e-01   +4.035260446012158e-01   +3.204646649399431e-01   +1.008430533776506e-01   +4.819527598270100e-01   +5.835015856976403e-01   +6.730505965416115e-01   +3.922897190650849e-01   +7.337284086692354e-01   +5.054319722859248e-02   +2.033003124352323e-01   +4.007609279795581e-01; +3.090271144116460e-01   +7.568245348345565e-01   +6.568265809487992e-01   +1.615570249390830e-01   +7.762120854221100e-01   +7.801524883839206e-01   +9.088959771994087e-01   +8.064407564513734e-01   +2.407244365611639e-01   +4.217097153868169e-01   +3.569001231680872e-01   +6.673103062081077e-02   +6.665864264491980e-01   +6.222733769949516e-01   +2.180072496448686e-01   +9.127873089351523e-01; +3.294859173218317e-01   +1.280400189860844e-01   +2.382950670335901e-01   +3.427433319906655e-01   +7.864233463606970e-01   +2.561108782116685e-02   +8.845974435681830e-01   +6.348709702135598e-02   +4.529145775240518e-01   +7.135566193043279e-01   +4.969248129589406e-02   +7.570637635178311e-01   +8.801382155398635e-01   +6.052772211691125e-01   +5.800210519270769e-01   +1.484252285751733e-01; +6.344689752426619e-01   +5.176717240877492e-01   +6.859848342991752e-01   +1.050234482268180e-01   +7.007042736671422e-01   +4.120121284679936e-01   +3.536878859063432e-01   +9.539674677692219e-01   +7.585781211048828e-01   +2.340337458261310e-01   +2.891003873093816e-01   +4.544569236525740e-01   +8.529135134389456e-01   +3.722456908388252e-01   +3.313148744702804e-02   +4.646440146766113e-01; +9.019943636700233e-01   +9.056009674536141e-01   +3.270390914661434e-01   +4.174872252304540e-02   +1.799215481017660e-02   +8.251850791819149e-01   +7.496397883118624e-01   +7.725012037218696e-01   +7.163807905893662e-01   +5.885646481212472e-02   +7.937065556295316e-01   +3.202686514707014e-01   +4.034759563381084e-01   +8.315981490083573e-01   +7.946252430218971e-01   +7.653210159298068e-02; +3.701353921205813e-01   +9.883762751436320e-02   +8.809061041557678e-01   +4.785206517005294e-01   +3.297411839167698e-01   +5.922926517280596e-01   +1.261577484198528e-01   +4.414478485471385e-01   +2.366036095876587e-01   +9.751174319149004e-01   +6.507636258279401e-01   +2.780758139798924e-01   +1.045596877259520e-01   +5.205103769651512e-01   +1.351448720794054e-01   +3.412778674978628e-01; +8.821503267215587e-01   +1.790721387094119e-01   +9.987184994342632e-01   +4.778296801478106e-01   +9.473023784582363e-01   +2.139106136005073e-01   +6.004264200649680e-01   +1.643771576069759e-01   +6.995807247991175e-01   +9.690257245649444e-01   +7.089806508605240e-01   +5.831814733421115e-01   +4.028009504589988e-01   +8.014159634207096e-01   +5.833298863401419e-01   +4.965818003524347e-01; +1.240470257168939e-01   +1.724136267701801e-01   +6.820636125146107e-01   +5.457411324640651e-01   +3.988291293104151e-01   +2.963892639407054e-01   +4.375149505919855e-01   +8.013870559855647e-02   +3.054040558233801e-01   +1.365137505954287e-01   +7.646028034901908e-01   +9.127128002171753e-01   +3.401917544161544e-01   +5.704552703633033e-01   +8.498894880880328e-02   +4.906118685195713e-01; +8.836815426411396e-02   +5.340657404807244e-01   +3.451170316898341e-01   +6.524085565384250e-01   +6.325004213819932e-01   +2.691705482745595e-01   +9.593664019026843e-01   +7.419487084139283e-01   +4.691451722250328e-01   -5.326675800387336e-04   +3.851972471338244e-01   +4.506574383049186e-01   +1.149142659485786e-01   +7.150054593299339e-01   +2.290223821371125e-01   +1.283677443986210e-01; +5.465317878479982e-01   +9.787812960056149e-01   +5.600174497827929e-01   +3.488159943758875e-01   +8.589460356639458e-01   +9.286500735075263e-01   +9.649895157215930e-01   +5.432020355339873e-01   +4.440842518770458e-01   +9.355736483691064e-01   +3.624339343187539e-01   +9.804994887902575e-01   +8.516570615229349e-01   +7.329864438770312e-01   +4.531088263546140e-01   +8.442722419746661e-02; +6.111095439588704e-01   +8.431998842252774e-01   +8.904618782212004e-01   +2.555785889710714e-01   +3.761299828363432e-01   +5.525945846929347e-01   +2.425188640426834e-01   +4.856040715297957e-01   +7.342818841874796e-01   +7.401991727665933e-01   +8.118472807632249e-01   +1.104955468485768e-01   +8.911460803250651e-01   +4.543397073178519e-01   +1.797495662833798e-01   +6.744338327129610e-01; +7.284580428172995e-01   +6.715537135249491e-01   +6.471475072264601e-01   +1.760821764477334e-01   +2.038091023879419e-01   +4.323852642367570e-01   +7.708277143906727e-01   +8.946670785841468e-01   +8.760502206386844e-01   +4.316630470048355e-01   +3.866823851125001e-01   +4.159829514824116e-01   +6.866451405443414e-01   +2.821398044917813e-01   +4.154816599840248e-01   +1.211877719308146e-01; +9.899174100422209e-01   +8.622724087709730e-03   +3.767989939944231e-01   +4.773108685721859e-01   +9.115426134058106e-01   +3.285582587897495e-01   +7.121221792524604e-01   +5.821862785953582e-01   +9.129684924342885e-01   +9.443699195180756e-01   +8.721041456509566e-01   +3.843980835111556e-01   +7.433855958250608e-01   +1.522983176873063e-01   +9.665373207039244e-01   +9.899300515469364e-01];
L2I_L1I_iGABA_netcon = [+5.747814368704651e-01   +5.635877312419285e-01   +1.096248518162979e-01   +4.588803773950599e-01   +7.970613114949164e-01   +9.790803792401646e-01   +2.231015064406158e-01   +7.582074480159184e-01; +5.573263406842565e-01   +9.524343606209458e-01   +1.191241926310122e-01   +5.670780777112232e-01   +5.422525897162728e-01   +4.223693047971377e-01   +6.601091919105682e-02   +5.049741872145621e-01; +6.120960482794855e-01   +9.040584194701362e-03   +4.333407506534902e-01   +8.178082556513944e-01   +2.578494089599391e-01   +3.941113414682706e-01   +8.354351099680665e-01   +8.267063343030210e-01; +4.664185049023618e-01   +1.278661163341061e-01   +9.335074821414746e-01   +3.552825701388766e-01   +7.815671144808543e-01   +4.611725775943819e-01   +4.255958354599890e-02   +9.272134447171207e-01; +4.343933165147941e-01   +8.525771428548877e-01   +1.400736262733790e-01   +2.481298067338026e-01   +7.776333605292084e-01   +1.227341178283455e-01   +9.092734964371127e-01   +7.109710517171821e-01; +6.472195769397072e-02   +2.187488400637937e-01   +8.264759851449721e-01   +7.703362513766040e-01   +1.446466164235476e-01   +4.555909208195446e-01   +4.495787802589935e-01   +7.967496045871739e-01; +6.466378247507431e-01   +7.087247414216759e-01   +9.318288845355860e-01   +1.802565937707983e-03   +8.236391211971612e-01   +2.657672333148958e-01   +2.850838684852899e-01   +9.583079853916951e-01; +4.246696131226539e-01   +7.740737119365371e-01   +5.721272645437717e-01   +2.748032649966370e-01   +6.226507519791117e-01   +9.312265130272891e-02   +7.547304406831093e-01   +9.523795471647687e-01; +7.560403652067580e-01   +4.214313809520635e-01   +4.981265033594851e-01   +2.382020103022743e-02   +4.578772158544326e-01   +6.610183773416983e-01   +9.268331552819753e-01   +2.964312902209708e-01; +3.074847901405697e-01   +7.248181474744109e-01   +9.306911969127034e-01   +6.703444427827816e-01   +4.833883231507661e-01   +9.457593076871247e-01   +1.409714174569887e-01   +3.509862421883077e-01; +5.990917251759683e-01   +4.572399009081864e-01   +8.624501986372917e-01   +9.673880955919391e-01   +2.187274102579273e-01   +7.644904586207327e-01   +9.566395969617935e-01   +5.416989092564970e-01; +3.343840097374853e-01   +8.051356715177785e-01   +2.528292634469729e-01   +9.459216408718240e-01   +8.571454357568659e-01   +4.278330185415467e-02   +3.044390409824010e-01   +2.140369581069198e-01; +6.438143415515761e-01   +4.281761408783535e-01   +4.597569811319175e-01   +4.732036163541152e-02   +8.799151130899941e-01   +2.613257392380753e-01   +2.089114324885097e-01   +8.141558164332499e-02; +2.638585381672648e-03   +1.492801230746190e-01   +7.406381773249020e-01   +2.861178379829822e-01   +8.450736102223810e-01   +6.349563125316704e-01   +4.636580182368945e-01   +5.052262126878007e-01; +1.436175920869906e-01   +8.040307382090018e-01   +7.528720968765366e-01   +4.882391688287177e-01   +4.420150739786837e-01   +8.978944232991870e-02   +5.964879392058707e-01   +1.938696253242207e-01; +2.472759877430609e-01   +3.799156197078717e-01   +2.302028200243559e-01   +8.872580230576275e-01   +5.430830477266024e-01   +7.503025015140044e-02   +5.532268227816648e-01   +1.446686047736889e-01];
L1I_L2I_iGABA_netcon = [+6.981097213979842e-01   +8.674219195404250e-01   +6.153779341978320e-01   +5.481731820273525e-02   +1.437952027477413e-01   +2.353688611498257e-01   +8.400193346970509e-01   +3.702622391428106e-01   +7.075472850740222e-01   +3.831926627085477e-01   +2.395161892303233e-01   +6.671458067941384e-01   +1.675048037266341e-01   +5.698458008407136e-01   +4.341986249334541e-02   +4.863855569108850e-02; +5.986108847452895e-01   +7.980786534491845e-01   +6.098399733342106e-01   +5.860744724819845e-02   +7.454550931695143e-01   +5.554545614525755e-01   +1.985986541196998e-01   +5.585411202977223e-01   +1.875666569107436e-01   +7.200078376634286e-01   +5.119939081124614e-01   +3.298349080115051e-01   +1.147853627155860e-01   +8.102537844225116e-01   +4.421317405985198e-01   +9.203972586862035e-01; +1.636152487132969e-01   +6.271043596384922e-01   +3.133470350240545e-01   +5.974457303634185e-01   +9.505603547418984e-01   +1.148474002996205e-01   +6.165744740706876e-01   +8.302925074596491e-01   +2.304353501324997e-01   +6.404741387809096e-01   +7.321610889371458e-01   +5.529340334196333e-01   +7.368668667366619e-01   +6.747380019013269e-01   +9.184486935915104e-01   +1.734570359582410e-01; +4.830779488319033e-01   +4.712268310032146e-01   +1.419342573544531e-01   +6.577988428301075e-01   +2.653143685641846e-01   +8.182411843960341e-01   +1.539879797778069e-01   +7.087476315795369e-01   +9.981515687541387e-01   +1.002065125426316e-01   +7.717438874985706e-01   +5.323027248912277e-01   +2.103331543884013e-01   +4.435544077462900e-01   +8.850991311138453e-01   +7.433851346225986e-01; +2.857062091647583e-01   +2.047069425468511e-02   +6.035555265911374e-01   +4.798033602192233e-01   +9.646313152458835e-02   +6.511013419334822e-01   +5.832528754548338e-01   +1.155978194480140e-01   +9.045473962436986e-01   +4.923715777246554e-01   +6.765452486659104e-01   +9.013919643365347e-01   +4.826026886721054e-01   +8.935858688060619e-01   +9.216999247962696e-02   +4.759754326738485e-01; +4.036676391277789e-01   +1.175399118074467e-01   +8.898221904425653e-01   +9.786258304193181e-01   +2.293904063430061e-01   +2.364279545999605e-01   +5.445249169168568e-01   +7.405193324211370e-01   +1.063459091846958e-02   +5.621264426637567e-01   +8.139331936112616e-01   +2.834911593500559e-01   +5.024631395073689e-02   +7.831505219001241e-01   +6.754808159276973e-01   +2.476042890067238e-01; +4.900924605648205e-01   +7.191001052932982e-01   +5.625664976812776e-01   +8.645778140846386e-01   +8.955225490055213e-01   +3.025657150500733e-01   +6.821945146729279e-01   +9.252924911901601e-01   +8.349014066475292e-01   +5.624933273096801e-02   +4.175844786348366e-01   +1.389559183176535e-01   +5.726024313595683e-01   +5.815737916339271e-01   +8.525152145009840e-03   +6.638080214002865e-01; +8.621406725036923e-01   +6.810460829937284e-01   +6.320037160432256e-01   +9.532667881110993e-01   +1.980182470669199e-01   +3.314365949523514e-01   +6.974069751811705e-01   +9.232001967566781e-01   +2.520503109527569e-01   +8.925193148289384e-02   +4.987232400992996e-01   +9.567824540490802e-01   +4.920536780357872e-01   +6.154442885993813e-01   +1.210426819406720e-01   +6.074689983776218e-01];
L2E_L1E_iAMPA_netcon = [+3.676373002505207e-01   +5.632730538783387e-01   +2.004769594083361e-01   +5.153640418860433e-01   +2.898598684367081e-01   +7.511588269333525e-02   +2.778260511704546e-01   +2.661562902219635e-01; +4.373135267495099e-01   +1.924399009034426e-01   +1.364277700192510e-01   +6.852674560924272e-01   +6.190081780427835e-01   +5.956085030840162e-01   +9.279037759713471e-01   +9.055761122515527e-01; +7.190727092356440e-01   +6.123258595733992e-01   +8.142213429763026e-02   +2.076914803929999e-01   +8.645862488728675e-01   +7.819726180454238e-02   +7.637997249808830e-01   +1.594403405400025e-01; +1.917227874576977e-01   +7.398420925967784e-01   +9.153088059644565e-02   +9.717388556223470e-01   +8.208320333414174e-01   +3.969096331966304e-01   +2.634909107019249e-01   +5.538575595265028e-01; +4.002038081073096e-02   +8.338514124224737e-01   +5.529874292537597e-01   +3.510978736355570e-01   +2.068752786092931e-01   +5.995367422042118e-02   +2.419459693161483e-01   +4.228313796728876e-01; +3.151317194777019e-01   +2.796359676597973e-01   +7.313736608336973e-01   +1.840917202038350e-01   +7.510157344978523e-01   +1.288606152270194e-01   +1.653142753186391e-01   +5.471848994702402e-01; +7.894465862639972e-01   +6.078510277514836e-01   +5.443033049471683e-01   +2.391127722571635e-01   +1.980926258104025e-01   +2.435871491332471e-01   +2.877256115145325e-01   +7.534919022261877e-01; +4.729274270595697e-02   +5.472894646087378e-01   +5.391234851478961e-02   +2.552894032580101e-01   +5.789703538810842e-01   +9.445839955806279e-01   +5.648139368796963e-01   +1.252854563103013e-02; +2.163750821226136e-01   +2.753369858707175e-01   +6.333470837777833e-01   +2.216728823737275e-01   +8.776768113688665e-01   +2.032412996038117e-01   +4.046899976166201e-01   -5.009057850682112e-04; +2.744367201058037e-01   +3.392884115030679e-01   +9.938937769071482e-01   +3.479324342260442e-02   +7.135969869371684e-01   +3.265621164326663e-01   +9.876880021044869e-01   +2.048841977353376e-02; +7.887205045078032e-01   +5.662155987901751e-01   +9.143021028533884e-01   +3.579777274993199e-01   +7.012503927773425e-01   +8.660342421920586e-01   +5.439128542623908e-01   +3.593219036769812e-01; +9.917911033022977e-01   +7.433947587541513e-01   +7.685816880740800e-01   +8.989938668213017e-01   +4.676499615121522e-01   +9.230160045830982e-01   +9.275105881614578e-01   +4.250802634907015e-01; +9.537261461778400e-02   +7.713627616192525e-01   +1.921085357752054e-01   +1.403113579248493e-01   +5.046234280628270e-01   +2.409175846678321e-02   +9.934145154628169e-01   +5.451627252270219e-01; +1.955134378700540e-01   +3.981022487765995e-01   +3.248762770077857e-02   +9.557142353371423e-01   +7.980765268169302e-01   +3.646427054924554e-01   +8.356641015130252e-01   +4.925858767591074e-01; +1.170010558055294e-01   +1.486211287569331e-01   +3.736340204190296e-01   +9.028490919038593e-01   +9.393846547442957e-01   +5.283122900850792e-01   +1.804982363156588e-01   +9.215108242154573e-01; +6.468383901338551e-01   +2.072273522207623e-01   +5.752812840564129e-01   +4.109176568949648e-01   +7.834544973440450e-01   +4.060339543678122e-01   +3.126870865394141e-01   +4.154597257840491e-01];
L1E_L2E_iAMPA_netcon = [+4.981826862856614e-01   +4.497041176462881e-01   +6.154752068961852e-01   +4.901083962299084e-01   +2.306600921887389e-01   +7.224218856974700e-01   +6.941103099708730e-01   +6.324486235401795e-01   +5.232533029984618e-01   +2.401376247258385e-01   +8.777829124337034e-01   +1.736577511022777e-01   +1.362647548482720e-01   +2.426835681359575e-01   +1.837859179613484e-01   +2.380954764648566e-02; +8.397882006469061e-01   +3.692087647955110e-01   +1.031782962712772e-01   +6.607149684360797e-01   +8.374852044712793e-01   +3.813345878387763e-01   +9.797221410442462e-01   +6.262768707847600e-01   +6.737717458155197e-01   +7.303877581568317e-01   +6.583287440022269e-01   +3.033558426782398e-01   +2.841461061307122e-01   +7.473580808569806e-01   +1.462341335860089e-01   +2.503882075099449e-01; +1.845413270670537e-01   +3.003827414558953e-01   +7.533429855575041e-01   +1.778553340298150e-01   +7.338821458669049e-01   +3.846844325273671e-01   +7.516574717672614e-01   +4.074049693348294e-01   +7.772540238033311e-01   +1.348649072071263e-01   +5.369801284508208e-01   +1.093581555388186e-01   +6.255442337897170e-03   +9.360209164056535e-01   +1.333231075995006e-01   +9.889872479552299e-01; +3.359771166285381e-01   +2.328342588155520e-01   +5.378643043361222e-01   +4.789116267975290e-01   +4.901570047979909e-01   +7.147480348846118e-01   +5.531412973367705e-01   +4.252786033081823e-01   +4.639141131304483e-01   +4.162146977621099e-02   +2.522189404312813e-01   +4.516271363592735e-01   +3.060511307008655e-01   +2.981070132872971e-02   +1.727270993241661e-01   +6.301247969541384e-01; +6.940641779086254e-01   +1.375492969365018e-01   +4.429102190021237e-01   +4.992665677304604e-01   +8.496937806232315e-01   +8.388605154900540e-01   +2.921461081843913e-02   +5.112347789715562e-01   +9.079669456576245e-01   +6.488125096942379e-01   +1.060688025756110e-01   +5.845833633224516e-01   +9.037135647255071e-01   +4.362856188865681e-01   +9.231185292913751e-01   +3.568403038696241e-01; +6.928015300064082e-01   +1.001149670904038e-01   +7.437773147655752e-01   +6.002150798026380e-01   +7.144714103076268e-01   +6.682831317028393e-01   +1.965132047872860e-01   +2.584037238079809e-01   +2.377550881235727e-02   +1.995268014539293e-01   +9.719314289059285e-01   +2.248341747398142e-01   +2.948724582312491e-01   +8.314545537133361e-01   +2.604322500920022e-01   +9.383713049058741e-02; +3.682891142699625e-01   +2.262103470631732e-01   +3.870430195257832e-01   +2.410951186447711e-01   +5.217383037882468e-01   +6.496083704921408e-01   +9.422093407960984e-01   +4.227146016317866e-01   +4.813207160883474e-01   +9.731909603731901e-01   +5.981285046673754e-01   +1.103307811003783e-01   +8.331725434931189e-01   +9.989130058450225e-01   +2.062705934666322e-01   +4.095688125689695e-01; +3.296875729436602e-02   +3.469481713076217e-01   +5.260288576892822e-01   +5.160896787625423e-01   +9.390727218177406e-01   +5.643044157851949e-01   +3.964957470513903e-01   +5.239221990290265e-01   +2.706958344109054e-01   +8.206904798503446e-01   +8.190577148052894e-01   +5.615030221983917e-01   +7.445444415478391e-01   +9.194854993272994e-01   +6.127063306932324e-01   +9.313471038945308e-01];
L2I_L2E_iAMPA_netcon = [+6.776884077930077e-01   +6.155822532143296e-01   +4.126912659676106e-02   +7.939586947131874e-01   +5.233659688048476e-01   +8.259645777714587e-01   +6.457180527609111e-01   +3.853359427156412e-01; +2.382790801695583e-02   +9.438581615778855e-01   +5.440451080184763e-02   +9.308140916307875e-01   +5.474073832999022e-02   +1.080896874341039e-01   +4.078476910646001e-02   +1.671356844714053e-01; +7.351771135298907e-01   +9.644384227001342e-01   +4.016872875505212e-01   +9.356694023120283e-01   +2.864882570718094e-01   +2.347065503894690e-02   +5.682428486829322e-01   +4.438573244329823e-01; +2.131763192624351e-01   +3.701548384146874e-01   +9.836654163411546e-01   +1.462048497068019e-01   +7.089052887884918e-01   +1.258831765298744e-02   +3.053383880710515e-01   +8.742664516668698e-01; +8.601898699010785e-01   +7.951380097881209e-01   +7.125328161883662e-01   +3.192858015972986e-01   +8.794712355772795e-01   +3.355819956874713e-01   +2.611771045839922e-01   +4.106589658986023e-01; +1.572854805036306e-01   +7.284289505181778e-01   +9.889191271660900e-01   +4.287145180822307e-01   +3.661072190831720e-01   +6.634887518553222e-01   +7.219244023955689e-01   +1.618650503855573e-01; +6.692083835752377e-01   +9.532247754356054e-01   +6.455692809177213e-01   +7.025477758546231e-01   +5.610965628963922e-01   +5.948959575265286e-01   +3.049228336015035e-01   +6.617963984307369e-01; +9.346764520604136e-01   +1.131157214045903e-02   +5.008194406526910e-01   +6.151157364171891e-01   +8.835844107818964e-01   +7.924253301292035e-02   +8.962193349108113e-01   +9.262504034661915e-01];
L2E_L2I_iGABA_netcon = [+6.100967186606854e-02   +5.197818423669084e-01   +3.531659814976132e-01   +2.604085549378762e-01   +4.152212644604727e-02   +8.912881081716333e-01   +3.432791712555270e-01   +4.513563300577418e-01; +3.543416003929587e-01   +6.912217313045207e-02   +5.574023880941620e-01   +9.843980875609318e-01   +3.609431886542263e-01   +5.408714890200107e-01   +9.349328107822840e-01   +6.711100475812068e-01; +9.328354448723978e-01   +1.845310739938265e-01   +6.916028810024940e-01   +3.486505760308511e-01   +3.674910532533168e-02   +7.172301837022588e-01   +9.182523113595707e-01   +7.698777596705390e-01; +2.401138615736817e-01   +3.167102434463897e-01   -6.018519803593305e-03   +4.023428210611729e-01   +4.852842386262577e-01   +7.099411251327525e-01   +7.254200608400714e-01   +9.270063643943175e-01; +1.039770297724791e-01   +2.445132155250490e-01   +4.780330042257841e-02   +7.527913776621515e-01   +7.233920736255538e-01   +1.677410073000262e-01   +4.443527042281205e-01   +6.595761731464225e-01; +7.157301045907416e-01   +3.219780526787111e-01   +3.075688326395666e-01   +1.024874495408224e-01   +1.362605718389341e-02   +3.519412413646967e-01   +1.524406108279982e-01   +5.022690972781543e-01; +6.490352195185501e-03   +8.810676657413498e-01   +8.691738654334294e-01   +5.901045973850929e-01   +5.175069407168179e-01   +3.795451775568042e-01   +8.331150774112420e-01   +3.431188727038025e-01; +1.844172106983070e-01   +3.009982366993597e-01   +6.266325005886113e-01   +1.222880449393903e-01   +2.400964884140440e-01   +7.581395839693162e-01   +2.579672046351737e-01   +9.456343911719783e-01];
L3E_L2E_iAMPA_netcon = [+7.996356171766275e-02   +1.610712328063027e-02   +3.684664339803078e-01   +4.962674112555275e-01   +1.874995334473156e-02   +9.542788354130834e-01   +3.601789723476796e-01   +1.379162771688342e-02   +2.047811714750341e-01   +6.084618639244768e-02   +2.439626553067195e-01   +9.998894136545974e-01; +9.519239181531174e-01   +9.770345544184550e-01   +1.159033806823720e-01   +6.507649747329514e-02   +8.058970491037164e-01   +3.878960170004729e-01   +2.241775384809805e-01   +1.221984425329867e-01   +3.566114102031539e-01   +7.408259284070472e-01   +5.322405664382971e-01   +3.451261337282001e-01; +6.634220957580602e-01   +7.255734759700382e-01   +5.140220383507934e-01   +8.623980656970233e-01   +7.936628042740588e-01   +6.638437505726864e-01   +7.248809704345462e-01   +6.695219513543489e-01   +8.886004986446385e-01   +9.900976189988031e-01   +3.332872703304593e-01   +8.221703217236993e-01; +1.698351775736200e-01   +8.704031295185060e-01   +6.338661602020389e-03   +9.962581608031722e-01   +4.223710404008898e-01   +5.832495475388075e-01   +7.723588930286532e-01   +5.073397050461191e-01   +8.104848359422416e-01   +7.675770068207727e-01   +6.732470745069781e-01   +1.108896941787448e-01; +1.949977846495069e-01   +8.144710078789582e-01   +8.694365459351007e-01   +1.227597993985248e-01   +6.291276439613569e-01   +5.842541421582455e-02   +3.438157782342683e-01   +7.146641834206517e-02   +3.179574501356875e-01   +8.815092009005335e-01   +8.738262472895710e-01   +7.746219621475534e-01; +9.950484560879890e-01   +3.162063285233045e-02   +9.040701792218778e-01   +9.993337463174244e-02   +5.673211214393128e-01   +7.616650549186268e-02   +5.778701503967354e-01   +5.363399505809757e-01   +5.993092689040750e-01   +3.522684009380535e-02   +9.833101825420829e-01   +1.506236653390725e-01; +9.247214261734373e-01   +9.694897681116975e-02   +1.135657451939475e-01   +1.494870994369878e-01   +8.964786209900417e-01   +2.265308696327002e-01   +6.435117272612838e-01   +6.778018886955901e-01   +6.979738000730403e-01   +7.929277203140813e-01   +1.443594594984053e-01   +7.317489850341194e-01; +9.819408949784957e-01   +8.601111807461803e-02   +4.507464623189963e-02   +1.282356700898845e-01   +7.483016460578412e-01   +4.202718759104598e-01   +3.668877970726630e-01   +5.872551457506686e-01   +1.784418111137326e-01   +7.062173800970110e-01   +8.782533642591600e-01   +1.092405134567047e-01];
L3I_L2I_iGABA_netcon = [+7.676360560224914e-01   +5.359888977859630e-01   +5.976609146386886e-01   +3.048514430358245e-01   +9.664224704416683e-01   +1.148571290305170e-01   +2.973635423249235e-01   +7.958281521144976e-01   +9.141634043547453e-01   +9.939021771688218e-01   +3.084487053734889e-01   +9.970795673477307e-01; +6.377230479921780e-01   +4.520344463089629e-01   +5.619472395008234e-01   +7.620289758583040e-01   +5.430217651332742e-01   +6.958080927981078e-02   +1.700910064503584e-01   +5.178975192463519e-02   +3.869487011298626e-01   +2.872536428210965e-01   +4.422091929528575e-01   +9.134272965234583e-01; +7.964719530450610e-01   +1.138656826438379e-01   +6.839523112773979e-02   +6.478210582512351e-01   +9.814138351574200e-01   +5.177645357222033e-02   +7.236009369453734e-01   +1.810010055761903e-01   +7.508510380573336e-01   +5.166503628855320e-01   +2.090538259636414e-01   +6.914945548828085e-01; +9.606033206565092e-01   +7.201069792289598e-01   +7.682106327475559e-01   +3.320470702064940e-01   +1.239346578780004e-01   +1.302562034662961e-01   +2.992201597829137e-01   +2.458917316083166e-01   +8.794468132383064e-01   +3.596619895784659e-01   +9.399848239267086e-01   +2.214416633198540e-01; +7.165067562983451e-01   +1.869429862602464e-01   +8.671687398624615e-01   +9.718600163805022e-01   +1.674141074398017e-01   +4.922296746111474e-01   +6.776489637505337e-01   +2.616401066044480e-01   +3.926525795621980e-01   +5.180244106270689e-01   +2.896409864474816e-01   +3.152033533701331e-01; +6.428069310898938e-01   +3.238762106613424e-01   +7.092717548498493e-01   +5.334260803072235e-01   +3.335763051646280e-01   +4.670485005426737e-01   +7.456058224459188e-01   +6.489115467744982e-01   +1.675018339901064e-01   +5.011813713144408e-01   +1.220646646751460e-01   +2.360204846792535e-01; +5.116200514786181e-01   +9.657964042984439e-01   +1.083813116897023e-01   +7.511617151353095e-01   +5.313537322815410e-01   +1.582751976020591e-01   +7.459157170553220e-01   +9.729889981629133e-02   +4.365033623837689e-01   +1.888388678642772e-01   +6.919872826857118e-02   +7.077112826607213e-01; +9.513717799889920e-01   +7.005759108906320e-01   +6.663287002835528e-01   +2.684810352518399e-01   +6.926542612962032e-01   +1.378810674869091e-01   +7.842522857607066e-01   +4.703129024928182e-01   +8.571212531069057e-01   +4.785220796037372e-01   +7.292601523050977e-01   +3.753026486533441e-01];
L2E_L3E_iAMPA_netcon = [+6.576779396182432e-01   +3.874241067625562e-01   +2.353056660987039e-01   +4.658775379066842e-01   +9.042205647741867e-01   +9.503016425212102e-01   +7.619115285170087e-01   +3.548426346558953e-01; +3.831524734066950e-01   +2.228922395087343e-02   +9.057877626420140e-01   +2.844189354942351e-01   +6.798081963797481e-01   +2.464628678816552e-02   +9.033306989833357e-01   +6.626396936785476e-01; +3.084060442022206e-01   +3.299887790699946e-01   +4.866486769838075e-01   +2.770046615933959e-01   +8.434110281708693e-01   +5.015707633804678e-01   +7.959005773945201e-01   +5.922843316030756e-01; +1.570541176226100e-01   +4.853150717795265e-01   +5.955839431944417e-01   +1.429339800409792e-01   +9.551477809092053e-02   +3.392080158008098e-01   +9.560228204580929e-01   +5.413074492251558e-02; +7.769975271231195e-01   +2.626967745484560e-01   +9.559153428584052e-01   +1.408599672241338e-01   +7.340055204775695e-01   +6.727227481271902e-01   +5.351786303131314e-01   +2.160138962896932e-01; +7.085900583483938e-01   +5.252093445644515e-01   +8.477062498526874e-02   +2.635809136616931e-01   +5.431375709699452e-01   +1.683508676407984e-01   +1.628894840333201e-01   +6.013044369942899e-01; +1.718526633068597e-01   +4.149031277628885e-01   +2.213420141498947e-01   +6.106085710602152e-01   +2.563348522012859e-01   +2.262636004384351e-01   +1.342650775675615e-01   +2.694809107845917e-01; +4.481767568459475e-01   -3.831065388127867e-03   +1.531946618977388e-01   +1.069878696532552e-01   +7.152185151773257e-01   +1.180120220653433e-01   +3.250119914616877e-02   +1.092272300846054e-01; +8.379410535802243e-01   +8.926835579560830e-01   +3.902434587520029e-01   +4.842112257311062e-01   +3.604710069063694e-01   +9.924464926045826e-01   +6.818560615648284e-01   +2.101628821726688e-01; +6.986334158092108e-01   +2.400150290098533e-01   +1.862370402494874e-01   +8.930419783348880e-01   +8.535827716870760e-01   +1.398377373180748e-01   +5.866206146156467e-01   +8.733677232208039e-01; +7.642045521821714e-01   +7.926604364522758e-01   +7.636072769213474e-01   +1.886923840759319e-01   +8.197694877730015e-01   +7.690371742521852e-01   +2.980665121189007e-01   +4.590085038495501e-01; +9.803524433582088e-01   +5.775576030591356e-01   +2.282177968578848e-01   +5.150069239656571e-02   +6.104782757940266e-01   +6.331623789129122e-01   +7.468215841181711e-02   +7.270874929297731e-01];
L2I_L3I_iGABA_netcon = [+5.890424655569736e-01   +1.466182393590077e-01   +3.446122428025518e-01   +3.697219138183691e-01   +5.986727573561942e-01   +5.071247044414934e-01   +7.733629775583747e-01   +2.649466865074842e-01; +8.454393690698289e-01   +9.895692960882457e-01   +4.725796965558561e-02   +5.366283754097771e-01   +4.780876634044013e-01   +2.380759968229958e-01   +1.785845049379085e-01   +5.861436937595220e-01; +6.039381210692952e-01   +4.805544389602743e-01   +9.420032376630747e-01   +9.743147868270923e-01   +3.764732825220903e-01   +2.733940723507070e-01   +4.542675083118770e-01   +6.803370518883961e-01; +7.442048784136889e-01   +3.596942280965262e-02   +8.669037890274663e-01   +9.966778850394243e-01   +9.784803557110080e-01   +4.051006513548796e-01   +3.056922239687382e-01   +4.159171335189076e-01; +8.487280914940125e-01   +2.707103844858557e-01   +1.331585465343704e-01   +4.146791222698814e-01   +1.383351272754567e-01   +2.613009341332409e-01   +3.877122002000368e-01   +5.119899552075040e-01; +1.451710692622303e-01   +6.746109243231726e-01   +5.900347508188586e-01   +4.494066840236626e-01   +2.704187343384933e-01   +8.542569736038684e-01   +8.028485014300438e-01   +8.132971682914392e-01; +7.425102865809091e-01   +1.449605634585660e-01   +6.303479261749530e-02   +2.540470699866203e-01   +2.264068446456632e-01   +4.793058172509528e-01   +7.776616462504782e-01   +5.453914049852699e-01; +1.711634714556322e-02   +7.726788099396635e-01   +9.472216505699227e-01   +5.991863439202230e-01   +7.928969308847124e-01   +3.423570673766102e-01   +6.462712406727952e-01   +5.891868908605387e-01; +2.282161965401403e-01   +2.672306283533810e-01   +4.966782164785294e-01   +7.766522363802440e-02   +8.184017468919655e-01   +6.390567192643634e-01   +2.424539393116241e-01   +5.341896741071741e-01; +5.368049532601151e-01   +8.809232621840898e-01   +2.610478136400528e-02   +9.117461240593430e-01   +7.936786733461261e-01   +4.158614957020403e-01   +6.073007199220208e-01   +5.401365015968829e-01; +7.194049527992252e-01   +3.701254468841111e-01   +5.774349885640592e-02   +4.729305155943495e-01   +1.124092967797727e-01   +5.444006169674113e-01   +4.187691079135817e-01   +1.513228090175144e-01; +4.349408554036329e-01   +1.086028093001746e-02   +3.001550734692260e-01   +5.079284592448340e-01   +6.323018344758436e-01   +3.409012456000816e-01   +2.949828107569472e-01   +7.032565879120645e-01];
L3I_L3E_iAMPA_netcon = [+6.316889249700691e-02   +7.726766468842462e-01   +5.538225326537860e-01   +5.722891976170894e-01   +9.195738386938304e-01   +8.363653924688832e-01   +8.510041455347908e-01   +8.629094707837404e-01   +5.324435786913442e-01   +9.884637985975102e-01   +4.820033768898009e-01   +3.505384983422734e-01; +9.213640637257943e-01   +8.391994020978160e-01   +8.442896373474746e-01   +9.362403430406340e-01   +5.931782523266929e-01   +3.926199110819851e-01   +6.284659881503074e-01   +8.563681690601886e-01   +5.678808881437301e-01   +7.002917785438224e-01   +7.390641484068876e-01   +4.002147567110782e-01; +1.800238906776861e-01   +5.944600031186225e-01   +9.693590001737936e-01   +7.797439469923279e-01   +5.757458592421301e-01   +6.977916439160778e-02   +4.449216415478132e-01   +9.480840663167726e-01   +9.792775877715922e-01   +8.439909897511313e-01   +5.935572943787424e-01   +9.877222266353137e-01; +5.428946264506974e-01   +7.665118900707095e-01   +4.647712402387669e-01   +5.961215267487475e-01   +6.573714442195344e-01   +3.745237291930166e-01   +2.348807679590453e-01   +6.952373010964036e-01   +9.686125206558979e-01   +7.387541806208237e-01   +2.625075925324282e-01   +2.964758713888103e-01; +3.990949788685562e-01   +6.586758482914666e-01   +7.760541077504598e-01   +5.693563026401079e-02   +4.356052651194957e-01   +8.499594000645979e-01   +5.035936386510918e-02   +3.634846482323975e-01   +5.607216175626768e-01   +9.949639770049570e-01   +6.063320720138000e-01   +2.249534429136742e-01; +9.052713990364603e-03   +5.886118686738248e-01   +2.215505561961032e-02   +5.438185187887441e-01   +9.349708505262808e-01   +2.646761096986359e-02   +7.117433784082307e-01   +3.730061697632812e-01   +5.312718766859276e-01   +5.060287523145827e-01   +2.309678160936110e-01   +3.296587549808659e-01; +1.030087828706408e-01   +2.504511865733534e-02   +6.781577637436698e-01   +8.646686432730858e-01   +1.033792602392223e-01   +4.221160595820737e-01   +8.484894123119079e-01   +8.416833647446709e-01   +4.799705696220801e-01   +1.890803367350408e-01   +1.944378139400639e-01   +1.646264372709809e-01; +8.561456055536688e-01   +6.928087223225265e-01   +8.354656190797234e-01   +3.371894155394968e-01   +4.097172454870266e-01   +2.541481912227956e-01   +4.050526518099102e-01   +3.843759311407132e-01   +9.010125403951236e-01   +9.605122072713600e-01   +2.498382783414437e-03   +3.825665551322810e-01; +3.383437911799652e-01   +3.274045470190839e-01   +6.847106180121364e-01   +1.782820063140098e-01   +8.922352804938226e-01   +7.322876052765258e-02   +2.859928106959639e-01   +7.697248090962671e-01   +4.818954770240682e-01   +4.506244723727194e-01   +6.465121519425681e-01   +5.258848673990452e-01; +1.498280371986341e-01   +7.713873989948493e-02   +8.952043490325908e-01   +8.808464248817671e-01   +7.392233070674089e-01   +9.192000909011177e-01   +2.613936918179079e-01   +7.742549498721060e-01   +4.859399876058567e-01   +6.057361876932054e-01   +3.998008704140839e-01   +5.959660254662181e-01; +8.083306003981762e-01   +7.445933016408725e-01   +9.483277167904616e-02   +8.427591981277430e-01   +9.590627458155055e-01   +2.684941026311923e-01   +5.054913024589122e-01   +4.324493456976681e-01   +3.130727249449576e-01   +6.448333735494540e-01   +2.713959019970816e-01   +1.694682955185375e-01; +6.548189400372617e-01   +9.654528789353333e-01   +7.027833527804087e-02   +8.350278531957792e-01   +9.709602526881967e-01   +1.008813639672002e-01   +1.162070954773765e-01   +4.868088501186954e-01   +8.593512672319625e-01   +7.651231744174086e-01   +3.669178169969443e-03   +7.395406917765017e-02];
L3E_L3I_iGABA_netcon = [+4.379786775548284e-01   +7.181863998243980e-02   +6.616164433771065e-03   +4.950621511620950e-01   +5.428895460458278e-01   +2.521608204883251e-01   +7.179651570708949e-01   +7.617507985562152e-01   +3.786372294069802e-01   +4.476782732062991e-01   +2.006699073625651e-01   +6.494120077569459e-01; +5.849627798232764e-02   +8.078082470747611e-01   +1.314283380759650e-01   +1.927727355764139e-01   +2.107075661159368e-01   +3.338042096295113e-01   +2.209570578478158e-01   +8.878760904840197e-01   +6.103056766323599e-01   +3.942033041289010e-01   +8.287642815040183e-01   +8.990724567172895e-01; +6.256982708073148e-01   +9.090512461871515e-01   +3.094543176158366e-01   +6.424335312709449e-01   +2.706516132742097e-01   +5.921124906420573e-01   +4.985928306448942e-01   +7.325410252134402e-01   +1.672001118940939e-01   +6.689315617060150e-01   +4.470442256803955e-01   +8.373576383557078e-01; +7.994525630157571e-01   +4.251302372274877e-01   +2.380920115096587e-01   +2.548937795613564e-01   +1.315822646336379e-01   +4.822406151976528e-01   +4.746136131560270e-01   +6.963232823043407e-01   +1.057506463610761e-01   +3.337839101306370e-02   +4.259192884877257e-02   +1.700725496616234e-01; +4.012951148594660e-01   +1.841066939039624e-01   +6.479791346344907e-01   +9.488671608328512e-01   +1.638602464424251e-02   +8.987428608456788e-01   +4.302271699375765e-01   +6.466113942355188e-01   +6.256779060634108e-01   +7.869360521287898e-01   +7.682959061293563e-01   +1.603213285476646e-01; +8.836615600915358e-01   +1.826644360876090e-01   +8.068105582295318e-01   +2.887484052552456e-01   +1.457091043678057e-02   +2.950763181270727e-01   +5.556493626033694e-01   +6.187849569725088e-01   +9.515065133407274e-01   +3.781892509686750e-01   +9.729056502502853e-02   +1.363727089098977e-01; +7.229381417344367e-01   +6.718350496205364e-01   +7.413460504507282e-01   +1.485700912300457e-01   +9.792521251919944e-01   +7.966822187851126e-02   +2.061920712449994e-01   +7.759988213751819e-02   +6.656403106084340e-01   +6.499974600151101e-01   +6.526577284163694e-01   +1.587468564701261e-01; +1.970869606243585e-01   +5.233729646633227e-01   +1.227618281222143e-01   +8.705913756894055e-01   +6.466305406556215e-01   +3.918469522388237e-01   +2.763395549102912e-01   +5.477142046826361e-01   +4.720637885820057e-01   +4.969501872629402e-01   +2.709552968140625e-01   +3.944808346587046e-01; +3.739644057088989e-01   +7.766973514716561e-01   +1.724899970934053e-01   +8.859769731941035e-01   +8.156881324024238e-01   +1.983145088343646e-01   +8.137325736186175e-01   +8.845066975122242e-01   +3.412538016512019e-01   +2.137506092964994e-01   +4.380783690594632e-01   +6.652492545160946e-01; +2.122665422006682e-01   +2.997530337292392e-01   +2.724975185767509e-01   +6.678951306783838e-01   +2.768527335431440e-01   +7.225297572101024e-01   +9.412295108255932e-02   +9.864007955435855e-01   +5.903420853221750e-01   +2.159431458385253e-01   +8.484536375223306e-01   +2.240403644182098e-01; +2.592803877419791e-01   +4.735210034406265e-01   +8.137247312443884e-01   +9.977213160039728e-01   +1.353402698132680e-02   +4.203336291461608e-01   +3.178043555939526e-02   +7.102712986011395e-02   +5.473444770272796e-01   +4.515075905796870e-01   +9.019154563177672e-01   +6.443797880717774e-01; +9.919495472786716e-01   +7.073051331735882e-01   +5.902983453352548e-01   +2.682298307679035e-01   +1.023381149318924e-01   +2.676941390915182e-01   +6.423918315014746e-02   +3.190463267488418e-02   +3.954820302978190e-02   +6.285270993025327e-01   +2.845945271066105e-01   +6.124496299007945e-01];
L2E_Input1_iAMPA_netcon = [+9.936463860805115e-01   +9.900722922902877e-01   +9.989222572058700e-01   +9.863514277802918e-01   +9.856686274419656e-01   +9.985143159723081e-01   +9.834251157313021e-01   +9.981811228683487e-01];
L2I_Input2_iAMPA_netcon = [+9.913079064332168e-01   +9.994741542072999e-01   +9.852667946656329e-01   +9.948034335578679e-01   +9.889307448100215e-01   +9.891696118987690e-01   +9.963198581109463e-01   +9.966956549053757e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
