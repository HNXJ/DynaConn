function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.241281718661956e-01   +4.222677164346048e-01   +5.308473426743012e-01   +6.364915996787380e-01   +5.997769515974953e-01   +3.414794130606900e-01   +6.479870704041658e-01   +8.393452593910653e-01   +5.446995675023744e-01   +1.927076122295360e-01   +4.475004642646032e-02   +8.224010063874418e-01   +7.680585531264777e-01   +1.099115522393942e-01   -5.487710874003110e-04   +8.438991359534798e-02; +9.831652933730184e-01   +9.605945239647717e-02   +3.242773561349709e-01   +9.567957659921973e-01   +3.871401314465999e-01   +6.066554408707652e-01   +6.782590403140679e-01   +8.317918680308899e-01   +7.224862299358307e-01   +1.380242531574325e-01   +7.532253669716322e-01   +4.304785125868543e-01   +1.674277711235077e-01   +1.357175228518777e-01   +8.652544067548791e-01   +6.266331384038295e-01; +7.306334768378612e-01   +5.974233621704566e-01   +1.057994195351815e-01   +2.417071878754619e-01   +9.155063868672341e-01   +1.913329917086951e-01   +6.348217932721492e-01   +2.558778290407790e-01   +5.211398545023483e-01   +6.963177347748248e-01   +2.414082426816178e-01   +8.872230848563690e-01   +8.634911628417848e-01   +6.793857209080395e-01   +6.126386679827917e-01   +6.615741539150445e-01; +3.445388627099640e-01   +4.721929682770333e-01   +6.116019248256190e-01   +6.760339280288910e-01   +9.642839063420223e-04   +7.395196660639939e-01   +9.455501909909237e-01   +6.137432378294030e-01   +9.933540157367605e-01   +9.291515724465313e-02   +4.423501469664645e-01   +3.921366140314647e-01   +9.902981918126303e-01   +4.945542900899518e-01   +9.882771867320785e-01   +7.303814275571893e-01; +5.859546585836907e-01   +6.956381922333075e-01   +7.800633937817200e-01   +2.887556803574207e-01   +4.625164472859759e-01   +2.423480745438926e-01   +2.090910485562763e-01   +5.825733990938292e-01   +2.208226064549302e-01   +5.234148975345484e-01   +6.874008029216696e-01   +7.691861017563162e-01   +5.156138552587951e-01   +1.890931394917365e-01   +5.262111408901189e-01   +8.926364016811124e-01; +1.090078015413461e-01   +7.001854039504513e-01   +4.237008635800233e-01   +6.704228312107293e-01   +4.249644358804888e-01   +9.192399250033531e-01   +7.089717313805614e-01   +5.409327688864356e-01   +1.047697973352235e-01   +5.313016993043034e-01   +3.584522178434598e-01   +3.972748086551678e-01   +8.842792579814152e-01   +4.942996979556233e-01   +4.807815420721133e-01   +9.820520537882497e-01; +9.050286869402813e-01   +6.395563075113219e-01   +9.069399539333180e-02   +6.943590550443651e-01   +4.608466204866146e-01   +2.707019225843006e-01   +2.369682230222411e-01   +8.706249416330858e-01   +1.110704792161416e-01   +8.612955306044020e-01   +7.364297528506911e-01   +8.099806174454314e-01   +5.876207257700458e-01   +1.484918590162770e-01   +8.022160960091087e-01   +7.694078696963689e-01; +8.812293094913484e-01   +3.311554246584621e-02   +2.655027261401617e-01   +6.677345864554177e-02   +7.707686065560079e-01   +7.655846792559522e-01   +1.193270936188262e-01   +2.649265288006822e-01   +6.548995241016738e-02   +4.847140721917502e-01   +3.943824887680977e-01   +7.549328997891310e-01   +1.550954441866545e-01   +5.360393839738321e-02   +2.283767644766640e-01   +5.832702913620801e-01; +8.176244266390605e-01   +6.837507253834657e-02   +1.537292534247284e-01   +2.525492841015158e-01   +3.244378597511243e-01   +1.899821667047661e-01   +6.080706200872452e-01   +3.159182476826624e-01   +4.044370929332517e-01   +3.927426910543328e-01   +6.844257593626443e-01   +3.780157378009828e-01   +1.996460451942601e-01   +8.511424541668474e-01   +4.970262909364330e-01   +9.265317441452083e-01; +2.601409491053949e-01   +3.191848504369850e-01   +2.817756085829491e-01   +2.214863393854467e-01   +7.841347069301069e-01   +2.854557644611986e-01   +4.522117990719757e-01   +1.189249608097330e-01   +4.477664942503180e-01   +6.713174824424770e-01   +7.041704355396325e-01   +2.166485852416057e-01   +4.075602044750393e-01   +5.615479138960886e-01   +8.989947166679126e-01   +5.814098138468311e-01; +5.939844860055359e-01   +5.298526093548906e-01   +4.417586328251129e-01   +6.685406148205897e-01   +4.700203728953974e-01   +9.094353791537647e-02   +4.586556414770704e-01   +9.402280987171279e-01   +3.655399290607338e-01   +7.416666449075867e-01   +4.426103007928344e-01   +7.907037939179329e-01   +7.477444278770639e-01   +9.298009096755526e-01   +5.755562837292664e-01   +1.657926339110558e-02; +2.275804600722989e-02   +6.541604515693475e-01   +5.262669658866822e-01   +8.446462395933035e-01   +3.598106070287928e-02   +5.776795836575523e-01   +6.623008370198044e-01   +6.455850189310727e-01   +7.627064213048073e-01   +5.192126655645755e-01   +1.884337257616887e-02   +9.497765719778555e-01   +8.240628118927427e-01   +6.976594490373100e-01   +8.442164048442029e-01   +1.214108360928514e-01; +4.263407346233892e-01   +4.072586189934791e-01   +4.589629586918786e-01   +3.451102362148060e-01   +1.763943147142459e-01   +6.836679250894707e-01   +7.701606314945411e-01   +4.800810139889590e-01   +6.265295101494603e-01   +3.451231928473506e-01   +3.295891327433100e-01   +3.287425981019885e-01   +7.917063881191978e-01   +5.840630395409828e-01   +7.386510398764026e-01   +8.622399024929344e-01; +3.119378768946135e-01   +8.196420127848936e-01   +8.749099053201107e-01   +7.819974489004753e-01   +7.201503362022099e-01   +5.465067648706032e-01   +3.497852360153126e-01   +6.395715367220590e-01   +7.729056447630318e-01   +1.495379268723314e-01   +4.234662179977390e-01   +6.728751111027771e-01   +3.197903356383400e-01   +8.149056242618322e-01   +5.862409630080291e-01   +4.830859909903133e-01; +1.606429488511263e-01   +7.203110385030773e-01   +5.194779442180240e-01   +6.768400631351097e-01   +4.736499178528890e-01   +4.240848269402335e-01   +6.620610778854639e-01   +5.445595395894408e-01   +9.329840370112796e-01   +5.870044516706303e-01   +2.688446466530798e-01   +4.399872668678559e-01   +5.337529721049797e-01   +8.809082302700394e-01   +2.448027035872172e-01   +8.450823706373979e-01; +1.775729858426826e-01   +9.682770874644923e-01   +9.450565969110463e-01   +6.961853478106743e-03   +1.527409053857439e-01   +6.436049260560870e-01   +4.159455385196257e-01   +6.474183127663042e-01   +9.736942271067170e-01   +2.609407242157680e-01   +1.968165654922382e-01   +8.329643817587673e-01   +8.991607326470796e-02   +9.896340715052936e-01   +6.650526991248721e-01   +2.093758812075414e-01];
L1E_L1I_iGABA_netcon = [+5.508774864580447e-01   +6.945293904601916e-01   +1.053008162467497e-01   +1.769464587225529e-01   +5.446128257179233e-02   +1.782880302881527e-01   +5.960875625002940e-01   +9.967021926892269e-01   +3.394214180162793e-01   +7.790270017707559e-01   +6.834682248515497e-01   +3.654748222359082e-01   +7.827824601709706e-01   +4.325771606574298e-01   +5.971279764144678e-02   +9.685303333237785e-02; +6.313245938995250e-01   +4.989424760961711e-01   +1.426076794994047e-01   +3.982267843350931e-01   +1.775612174254786e-01   +3.606014036902205e-01   +3.003075626801561e-01   +3.309170941412254e-01   +2.938423469543797e-01   +3.375849749991988e-01   +1.320592033457506e-01   +3.690674028341592e-01   +1.010166707248324e-01   +6.551221498999709e-01   +3.140495549987722e-01   +1.415072198016308e-01; +3.218122595943550e-02   +5.357582793082688e-01   +1.675946085145495e-01   +1.335334100105983e-01   +6.607061417354558e-01   +5.619890163329715e-02   +1.350765219408605e-01   +2.971603766673397e-01   +7.455373075254143e-01   +6.082305144038900e-01   +7.231649543758492e-01   +6.850480512228168e-01   +2.927955316904661e-01   +1.119446150680640e-01   +7.719300584368951e-01   +1.684443592926839e-01; +6.140287486533554e-01   +4.436091366072606e-01   +6.224609115827526e-01   +2.922074154723605e-02   +3.324558258434094e-01   +5.226133041420403e-01   +2.109420724731923e-01   +6.248615615534495e-02   +1.084112735920489e-02   +7.412525954302847e-01   +1.099238911248375e-01   +5.978699715300968e-01   +2.361444942597390e-01   +9.315835304539591e-01   +6.954561954685831e-01   +1.960725251684528e-01; +3.633426073676513e-01   +1.240880524476213e-01   +5.739368573532850e-01   +9.384995078419769e-01   +8.982708508819819e-01   +3.347673979380397e-01   +8.960188498947603e-01   +2.977595848402444e-01   +4.783957104070410e-02   +1.053662636075638e-01   +1.171971229102703e-01   +7.886648392263418e-01   +5.300940444538212e-01   +1.858065962187445e-01   +1.250672923231606e-01   +3.178265495301704e-01; +4.987471863034673e-02   +4.915995142139468e-01   +5.332287852857789e-02   +3.024342524574967e-01   +1.169169371252504e-01   +1.740791594984768e-01   +7.190498427768748e-02   +4.429191776469458e-02   +6.673381892372955e-01   +1.263077809322994e-01   +6.404908093334114e-01   +3.680666846846153e-01   +9.266987027048586e-02   +2.663641876276606e-01   +1.276877329426672e-01   +3.172482912808131e-01; +4.873074468469856e-01   +8.530194167905728e-01   +9.321941660010573e-01   +2.955651983405095e-01   +9.883883031836835e-01   +2.107374601529985e-01   +2.430893405864462e-01   +5.055990207168823e-01   +6.044718203599410e-01   +5.487206149451437e-01   +3.288323490760032e-01   +2.051956782698107e-01   +4.054681529744391e-01   +7.979027170134194e-01   +9.116362827441428e-02   +2.171342161275754e-01; +1.922065675586734e-01   +8.745547984589285e-01   +7.282881542253180e-01   +3.354626126683270e-01   +5.417174350418406e-01   +9.057547981335259e-01   +5.428365863931300e-02   +7.608510626590955e-01   +5.266348438574668e-01   +4.854334526088185e-01   +6.542676439425482e-01   +8.732504828692038e-02   +1.042189460346722e-01   +4.881573958165557e-01   +8.544493468610043e-03   +2.517550397186658e-01; +1.222603476561356e-01   +2.709425155983558e-01   +7.371836818278794e-01   +4.685191469453605e-01   +7.056486412705838e-01   +6.746893360780821e-01   +4.406948308737783e-01   +6.315668684721066e-01   +7.298402681511318e-01   +8.901171850757393e-01   +7.505275103430977e-01   +7.723061874573645e-01   +1.105635164226217e-01   +7.692717317420805e-01   +4.244170664470942e-01   +8.933424355567231e-01; +2.063268970074404e-01   +2.100875628989073e-01   +6.372053473735459e-02   +6.478101878415400e-01   +9.992146482050138e-01   +4.681979690198537e-01   +1.500775612648416e-02   +9.102863978931074e-02   +7.076038954923149e-01   +7.996006091611372e-01   +5.843520926411038e-01   +2.071860455354307e-01   +7.862581120770209e-01   +3.971846757148743e-01   +6.557351876096690e-01   +7.028316607596902e-01; +1.464384741645751e-01   +5.635976743756478e-01   +8.596489580481161e-01   +2.423186186146318e-02   +2.875727269636143e-01   +9.122531198748353e-01   +8.973881698246300e-01   +8.097647077887486e-02   +7.806814683536341e-01   +7.351265423327842e-01   +7.406793079420853e-01   +3.891542570698704e-01   +2.912623027958461e-01   +2.726891378446791e-01   +7.230075539423368e-01   +5.552976161083435e-01; +1.885936504856205e-01   +6.386846889892439e-01   +9.333114517799102e-01   +8.425424349017574e-01   +4.133818508037412e-01   +1.036924091485966e-01   +1.958732293901068e-01   +7.749579854210780e-01   +2.882371560962568e-01   +5.285732388585281e-02   +2.343946796685756e-01   +5.515991674019137e-01   +6.037722563081257e-01   +3.761157910677741e-02   +5.299924039450702e-01   +1.840866898987308e-01; +4.323592473480387e-02   +4.163502188060712e-01   +9.839221134265892e-01   +5.583946840470956e-01   +4.666947732218198e-01   +7.448321293754208e-01   +9.325751449329911e-02   +9.055234009662234e-01   +6.904501561631519e-01   +7.281555984612197e-02   +7.345879238781974e-01   +2.286394465928173e-01   +9.639923991641068e-01   +6.735190208224863e-01   +1.081152616287228e-01   +2.117823729594733e-01; +6.352882917232950e-01   +2.066912560846597e-01   +8.576284652823761e-01   +8.534355782136224e-01   +7.645747247767863e-01   +7.374462500453429e-01   +3.075489823450841e-01   +5.333283627435410e-01   +5.553325351738099e-01   +8.722431760523491e-02   +9.715377383831587e-01   +6.418777874415369e-01   +4.317530324533416e-01   +4.309969033594678e-01   +6.325276498122332e-01   +7.734556888640808e-02; +2.822770610716157e-01   +9.491237376498199e-01   +7.854509863167509e-01   +3.487921100425582e-01   +8.173350752864819e-01   +5.621956388717064e-01   +4.556169108928975e-01   +1.082887457889627e-01   +3.952702937556075e-01   +7.958458624819664e-01   +8.676029161331856e-01   +4.832813376245176e-01   +6.946993045586052e-01   +4.505968720416502e-01   +1.289705501669508e-01   +9.139428538141341e-01; +5.378318816275056e-01   +8.092266087459490e-02   +5.141978306054982e-01   +4.467338120184517e-01   +9.958347302575038e-02   +1.854614977488901e-01   +1.017332219247553e-01   +8.270631742089558e-01   +6.188502141725542e-02   +9.421485035345958e-01   +8.696008445346393e-02   +1.514302374713558e-01   +7.581816859903351e-01   +6.087648697405148e-01   +1.341850295591179e-01   +7.067849038331844e-01];
L2I_L1I_iGABA_netcon = [+5.584034542052647e-01   +1.595291650390414e-01   +4.233051398678319e-01   +6.834129664419220e-01   +8.085471569574116e-01   +7.953016175476176e-01   +7.884817527908057e-01   +2.628874683309366e-02; +3.130984585230806e-01   +7.587504575443181e-01   +4.294831743575231e-01   +4.634687797137813e-01   +7.474154130283280e-01   +5.777255131844949e-01   +8.514884851233417e-01   +4.205735949928528e-01; +1.661973146706701e-01   +8.704886135209282e-01   +1.250099798138240e-01   +2.131534798832309e-01   +1.185278313772333e-01   +4.412362378559976e-01   +5.067722956381493e-01   +1.827861585129921e-01; +6.213864655569218e-01   +3.510574671058599e-01   +2.355314883451777e-02   +9.827517950336252e-02   +5.253028965426029e-01   +2.568752364115887e-01   +6.359344690218197e-01   +7.267395650132815e-01; +9.875446377244769e-01   +6.859793206143640e-01   +2.901606805620250e-01   +8.232578589130263e-01   +3.249118858607165e-01   +7.523388533025637e-01   +9.520725148876960e-01   +3.703097239586192e-01; +1.710668379525199e-01   +2.934152579671323e-01   +3.185860916063917e-01   +1.754972227204466e-01   +5.460201392494886e-01   +2.287473674179108e-01   +4.443650972558243e-01   +8.419881114843234e-01; +2.578895199467999e-01   +5.298250379653793e-01   +6.537993591205855e-01   +1.642147571612795e-01   +3.999987124179781e-01   +6.531499217273365e-02   +5.833386674809674e-02   +7.331460372961914e-01; +3.978047024388055e-01   +8.329631944443046e-01   +9.570505509478436e-01   +6.677365657239562e-01   +4.152786975803908e-01   +7.665703890598868e-01   +8.678638058933500e-01   +5.694984181442541e-01; +7.473702280020082e-02   +5.993998112062590e-01   +9.365808870360873e-01   +8.932005086691709e-01   +1.791158771298669e-01   +6.715900018046336e-01   +6.309326952514605e-01   +1.779182848542465e-01; +6.840506091852120e-01   +3.349236768186521e-01   +4.581013355551572e-01   +5.162115191014167e-01   +2.561511779458661e-01   +7.145459329955725e-01   +3.531277002290824e-01   +9.590626284519419e-01; +4.041097425887645e-01   +2.990711310376477e-01   +2.396746246907250e-01   +7.030161818462299e-01   +1.945531450136116e-02   +6.426023262561552e-01   +9.967851559990353e-01   +2.651164969272879e-01; +9.828071228306198e-01   +4.525906092156676e-01   +7.646769477163123e-01   +1.520556241849711e-01   +9.231247907223046e-01   +4.191900488473149e-01   +2.251415534045349e-01   +9.243467311441582e-01; +4.005421418860843e-01   +4.236608003849126e-01   +7.590828127521860e-01   +9.529633242700482e-01   +6.545040161077567e-01   +3.900697315332978e-01   +6.523881444427907e-01   +2.218416472284929e-01; +6.212878844337432e-01   +3.599610599344749e-01   +7.401452057144189e-01   +5.403375091395888e-01   +9.334243166114639e-01   +8.175256179853434e-01   +6.041016194098434e-01   +3.729726274955489e-01; +1.551006723784534e-01   +5.604052452792124e-01   +7.441384346322754e-01   +6.809231998483651e-01   +1.638877592845324e-01   +3.165705460329789e-01   +3.877032342371354e-01   +8.833033517942800e-02; +3.816576401865275e-01   +7.429736848370356e-01   +1.085140350813181e-01   +3.708747964904670e-02   +9.218916759793463e-01   +8.161256480046524e-01   +1.400825301355489e-01   +6.416270559192647e-01];
L1I_L2I_iGABA_netcon = [+1.812956477220603e-01   +9.121575140919707e-01   +2.756822496583758e-01   +8.718786516700702e-02   +5.331241844861901e-01   +1.065376576066102e-01   +9.884278197330676e-01   +4.118309995382928e-01   +7.196727361884211e-01   +2.173504085292595e-01   +9.221432190255935e-01   +6.739371964626386e-01   +1.067581670933677e-01   +5.563088813581605e-01   +6.303821757043543e-01   +4.837065436926682e-01; +4.550293993894676e-02   +7.999507209313317e-01   +2.474923188486356e-01   +8.029257385018953e-01   +8.870593173251446e-01   +6.152728154366877e-01   +7.671560865763046e-01   +6.006196716442782e-01   +9.968324082085289e-01   +1.258732876896771e-01   +7.702759813123223e-01   +4.774732416859289e-01   +1.809190775189130e-01   +7.714770690150466e-01   +1.002096397995790e-01   +8.943136124008618e-01; +7.236294020998767e-01   +7.449201852664213e-01   +4.520639160880530e-01   +9.892865767168577e-01   +8.985175949975319e-01   +9.407849506329891e-01   +3.364081736831410e-01   +7.496925743340579e-01   +3.546480682753752e-01   +3.087537616364741e-01   +4.248390265550968e-02   +6.234326696290988e-01   +9.967006365195721e-02   +3.121768655295146e-01   +3.920280366708127e-01   +1.389109101733958e-01; +3.487343623500061e-01   +8.126028877041954e-01   +2.267982228123180e-01   +6.684573709286884e-02   +6.255628886216200e-01   +3.531936562729954e-01   +6.630389107703342e-01   +5.843235514325960e-01   +9.707564829922765e-01   +7.252936092721686e-01   +3.791514693816802e-01   +2.377824667144104e-01   +4.903607113734548e-01   +1.782065517208950e-01   +5.531935517971585e-02   +3.887769961215520e-01; +6.606860419523305e-01   +3.835231160709479e-01   +8.045221811603624e-01   +9.398349488317688e-01   +1.374274175785564e-01   +4.108611503765178e-01   +2.457108952018643e-01   +5.514932966054055e-01   +3.479694133082034e-01   +7.831137444498663e-01   +7.042337548569980e-01   +1.780325886202645e-01   +1.929872868525509e-01   +3.379379276878185e-01   +5.008935749393592e-01   +9.274922952857818e-01; +3.855492630740229e-01   +6.181158453730569e-01   +9.856663383339993e-01   +1.789469604451316e-02   +2.188556360309001e-01   +9.836019877374196e-01   +2.944454760481482e-01   +5.804542963707701e-01   +8.860256778049876e-01   +6.922370972996339e-01   +7.273718293073813e-01   +8.287469672187125e-01   +8.941993939488244e-01   +2.101068595753890e-01   +4.309554905716976e-01   +9.189360473050504e-01; +6.279231747759162e-01   +5.771200702121908e-01   +3.043386131329750e-02   +6.849192926381048e-01   +1.816063272945311e-01   +9.456152841961968e-01   +6.782985591285605e-01   +5.113554891482367e-01   +4.545929872155293e-01   +9.568844069736718e-03   +2.254855013459454e-01   +7.658464888888206e-01   +9.891250384673202e-02   +5.105716592105461e-01   +9.981447489045725e-01   +7.157021979968518e-01; +2.277623394069236e-02   +5.278460151405965e-01   +5.354224475569824e-01   +7.834661762583112e-01   +4.195361542120155e-02   +6.770844878035934e-01   +5.266573341373705e-01   +8.085833807986940e-02   +4.145731312009753e-01   +8.456809148839588e-01   +2.691106058514054e-01   +9.346442547937069e-01   +4.490353235697255e-02   +9.045898042133516e-01   +8.102674311072579e-01   +6.175910822429114e-01];
L2E_L1E_iAMPA_netcon = [+3.421289206379315e-01   +7.584658563251785e-01   +5.899728056618078e-01   +5.010119756836500e-01   +8.481361812202647e-02   +4.771736873370505e-02   +9.235201197954579e-01   +4.760113671450102e-01; +9.366055987976883e-01   +4.143208216218615e-01   +6.611366056074666e-01   +4.890824921053408e-01   +9.745873761976942e-01   +3.436141911782657e-01   +8.008105465258571e-01   +3.638396858517214e-01; +1.236718357581900e-01   +4.937124325661927e-01   +4.806872083771502e-02   +8.786145882411358e-01   +6.514383434583916e-01   +7.378543213599656e-01   +2.861565679494847e-01   +7.884646887384497e-01; +7.316454475226777e-01   +6.964495052711128e-01   +3.487781482498790e-01   +3.517040207868888e-01   +2.311943393418104e-01   +7.947797064791525e-01   +5.439916563413658e-01   +7.804813333884809e-01; +6.469293253468666e-01   +9.744486476258997e-01   +4.493598663698019e-01   +4.486565779469130e-01   +4.026315830629876e-01   +5.448224646538058e-01   +9.842118359890144e-01   +6.682873287483111e-01; +8.335064492309354e-01   +3.277834392877566e-01   +2.391231664772819e-01   +9.642697046466804e-01   +1.213945410291804e-01   +6.873801246812880e-01   +7.154287320033492e-01   +1.338255334639720e-01; +3.969048774692014e-01   +8.375007954886506e-01   +7.149012189660588e-01   +4.240379743550360e-02   +2.682393930570106e-01   +8.950315297543463e-01   +8.386404431009787e-01   +2.005766471207430e-02; +7.502590582479920e-01   +7.399678959351697e-01   +8.572935660598167e-01   +9.738156216498007e-01   +2.558341530449475e-01   +5.388460878098078e-02   +4.343460379084020e-01   +5.598480903725960e-01; +8.350580314712028e-01   +9.538111562287513e-01   +2.833482674224236e-01   +1.876994969262434e-01   +3.330494413900199e-01   +3.042080164124099e-01   +4.710466472533461e-01   +3.012406008895999e-01; +3.241300604224559e-01   +3.290271128263933e-02   +7.314441592339591e-01   +6.657443752670511e-01   +1.492049154313931e-01   +4.540485171882266e-02   +5.612998364535057e-01   +9.391038383972515e-01; +5.514680124389360e-01   +3.549502296842195e-01   +1.402397753441767e-01   +5.876691007254218e-01   +3.472693329411107e-01   +1.952700873920401e-01   +2.698183666399991e-01   +9.816454789161687e-01; +9.814005932371443e-01   +6.619951919930787e-01   +8.391880018712180e-01   +6.753784788320821e-01   +1.203057930110189e-01   +7.186910372769142e-01   +7.478940059395295e-01   +2.861686411028059e-01; +5.489739478494418e-01   +2.817162522475629e-01   +1.389355828417524e-01   +3.595881435856586e-01   +8.830966678862318e-01   +7.223970152371656e-01   +5.045498144196443e-01   +8.004224183154341e-01; +3.308480328503687e-01   +2.304471586917976e-01   +5.872483608447957e-01   +6.201736792161179e-01   +9.535365138720305e-02   +8.774782856914888e-01   +6.469980926595033e-01   +8.946864613735038e-01; +6.192789766080090e-01   +7.100545310321941e-01   +3.668687685981993e-01   +8.110301318532724e-01   +9.309016501350506e-01   +5.809710127673859e-01   +3.074201586172962e-01   +5.983608345180632e-01; +3.617021130551444e-01   +6.236754470910237e-01   +8.056926030789252e-01   +1.958610159557998e-02   +3.996926306421018e-01   +7.228623748239325e-02   +1.389368162587379e-01   +8.840666460477528e-01];
L1E_L2E_iAMPA_netcon = [+9.427188321709603e-01   +3.727909198270801e-01   +6.677680693197833e-01   +4.849215742467768e-01   +2.468712476457049e-01   +4.522973594157814e-01   +1.234412199669979e-01   +4.969145973115153e-01   +8.821924423062086e-01   +3.246655254305115e-01   +5.148567449902731e-01   +8.612642138770256e-02   +6.318006028181931e-01   +4.288291833712781e-01   +6.128325198288647e-01   +5.033676594914593e-01; +5.488442207020421e-01   +9.362146890255351e-01   +2.084661868507371e-01   +7.569612540607630e-01   +7.846805918922446e-01   +2.056714284212966e-01   +4.061954551473215e-01   +6.929371808764258e-01   +7.200120950149534e-01   +2.459305912382274e-01   +6.578831644784541e-01   +1.630482682898481e-01   +8.586555147085507e-01   +4.923517417340347e-01   +8.201923575389135e-01   +6.124208534846959e-01; +7.291312142955839e-01   +8.286242526382730e-01   +6.535255878905570e-01   +4.165166354972959e-01   +8.828191275835099e-01   +8.985270158353091e-01   +2.755162841424291e-01   +8.339888918780730e-01   +1.877803540465828e-02   +3.426732937116423e-01   +9.513636523000776e-01   +3.248415652112615e-01   +9.761264118076083e-01   +7.171977612599235e-02   +8.868147581218534e-01   +8.196658281682200e-01; +5.773356928159876e-01   +8.503841658266457e-01   +7.231575738574353e-02   +9.721945314626538e-01   +9.125222087758156e-01   +7.632563984328109e-01   +7.173411328402539e-01   +6.120714397911996e-01   +6.745658049288219e-01   +3.758220289068583e-01   +7.225153856414757e-01   +3.013978613202352e-01   +5.697796334390475e-01   +8.876096542264881e-01   +9.308217578910981e-01   +5.327991633752223e-01; +2.584665760772025e-02   +3.718505818828919e-01   +4.068616638664932e-01   +9.895798602943289e-01   +5.580929777310135e-01   +8.831566738252009e-01   +2.825790695944699e-01   +5.748691548709471e-01   +4.390267466859294e-01   +5.458557573215395e-01   +4.000402819168084e-01   +1.148566127108759e-02   +9.967528960163605e-01   +6.459711414001140e-02   +1.919704542374263e-01   +2.029928273438731e-01; +4.475344162843929e-01   +5.930895011165472e-01   +6.662388753520018e-01   +8.633817703878444e-01   +5.989148553455267e-01   +2.866985932875998e-01   +8.956759987022371e-01   +3.242960948822711e-01   +4.361312157307056e-01   +5.631518974329749e-01   +8.340373143830894e-01   +5.410614159122701e-01   +5.536852262357524e-01   +4.356643913512407e-01   +2.577064620042965e-01   +4.544621340453054e-01; +6.477645647266388e-01   +8.741395892885574e-01   +9.356512472982266e-01   +3.881249090453534e-01   +1.481107664269929e-01   +6.707433898245507e-01   +8.267215375058448e-01   +4.562242076035722e-01   +1.159909829734682e-01   +3.950770498876490e-01   +1.351459950480112e-01   +9.633297134780745e-02   +5.150645277951815e-01   +8.250145612605639e-01   +8.967827424610092e-01   +4.285827894331816e-01; +5.220071142589938e-01   +9.338012194510135e-01   +8.092168302109697e-01   +4.532425609657559e-01   +9.015863631495837e-01   +6.638007139303945e-01   +3.899001632896060e-01   +7.142862801115087e-01   +8.143022735331804e-01   +3.972482062368056e-01   +6.015739007048972e-02   +1.472434623764104e-01   +3.312910531220680e-01   +3.925137586079292e-01   +5.935915404329031e-01   +9.655460588507364e-01];
L2I_L2E_iAMPA_netcon = [+6.191935566815210e-01   +6.962544694431427e-01   +7.343712403536616e-01   +5.904104860803111e-01   +6.696754478555743e-01   +5.521806177146442e-02   +9.903342669341622e-02   +8.483352163749990e-01; +6.974269073051221e-01   +4.264435034421549e-01   +4.299353656438867e-01   +4.592595756897466e-01   +5.007466668889197e-01   +1.532557917988009e-01   +9.078744827272501e-01   +9.173263500165560e-01; +7.215544229744791e-01   +8.370169252577482e-01   +6.937438156990376e-01   +5.166466706656622e-02   +2.195772666469072e-01   +2.005167960389608e-02   +1.104429056783700e-01   +9.868732528610076e-01; +3.473606522075515e-01   +7.302951856495178e-01   +9.452158163709782e-01   +2.288429796405813e-01   +5.719583987571727e-01   +4.347549599450317e-01   +5.181086707928564e-01   +5.041886381131792e-01; +5.172205071399079e-01   +3.603164726672005e-01   +7.842851504012223e-01   +8.341025461009650e-01   +1.223109747810162e-01   +8.319105148810988e-01   +1.429960845756424e-01   +2.711676063529417e-01; +5.569518797240641e-01   +4.539007031196108e-01   +7.052726916283687e-01   +1.556399879852777e-02   +6.705619770426249e-01   +6.170697871389119e-01   +5.593233973783218e-01   +1.013154687476549e-01; +1.581111174829100e-01   +3.876201300934814e-01   +1.095477007762749e-01   +8.639136172319722e-01   +5.994498337474176e-01   +5.196444517961932e-01   +4.442274146295768e-03   +5.078918171157603e-01; +5.636803144814506e-01   +7.751020616526839e-01   +3.896284455736281e-01   +7.914724342807274e-02   +5.578806344821597e-02   +8.636231723883547e-01   +7.677456170678674e-01   +5.848622392049522e-01];
L2E_L2I_iGABA_netcon = [+7.640418989277954e-01   +9.417304435145122e-01   +2.385859048457358e-01   +8.336274880206629e-01   +2.575421351340277e-01   +7.548273545330574e-02   +1.734844333847241e-01   +5.235889962821239e-01; +8.270157395219233e-02   +6.565131545551126e-01   +5.781086737051047e-01   +4.020475697549667e-01   +2.985992446420974e-01   +3.941847741376259e-01   +1.398656832354294e-01   +2.644887427181495e-01; +6.599899103015630e-01   +4.518670639609625e-01   +8.661343041649118e-01   +3.912913311284654e-01   +4.248552522656502e-01   +4.182150323112080e-03   +5.976899243938546e-01   +6.807031443265527e-02; +5.170430156434027e-01   +8.396556358173464e-01   +4.054373348801049e-01   +3.622055596689334e-01   +1.180031513809103e-01   +2.202117229164187e-01   +8.998432772467724e-01   +4.358835939843093e-01; +1.718429016733217e-01   +5.332199888024295e-01   +1.120366766078308e-01   +1.375820547524591e-01   +4.971795908889702e-01   +8.436917340396316e-04   +9.389395030634287e-01   +1.729491623511804e-01; +9.401720122650239e-01   +5.535420476791627e-01   +4.438578563562452e-01   +2.578074317296846e-01   +7.067394083942706e-01   +1.900458938575424e-01   +2.202809100752819e-01   +2.658599181943003e-02; +5.912325684462639e-01   +6.804839400898781e-01   +2.979367510972648e-01   +8.647700836353012e-02   +2.437660968299346e-01   +1.420088209962428e-01   +4.810033060320920e-01   +9.539635300539798e-01; +4.402348140446848e-01   +3.675645081831171e-01   +4.012138894236690e-01   +4.295201447918177e-01   +7.848707272587563e-01   +2.681332136648034e-01   +3.771230067675877e-01   +4.311458051837479e-01];
L3E_L2E_iAMPA_netcon = [+9.615332725217647e-01   +7.728467170347486e-01   +9.115211955067118e-01   +5.310027308894328e-01   +4.800251354968968e-02   +8.190770394890604e-01   +6.250372849161779e-01   +7.484249612407592e-01   +6.735050680608254e-01   +9.054444659496843e-01   +5.822418652600756e-01   +5.960763851981294e-02; +7.626246193418726e-01   +2.274211118219016e-01   +9.072135326009154e-01   +7.163280774975550e-01   +5.522360688371314e-01   +7.271731728982609e-01   +5.420267974051587e-01   +6.461630020208028e-01   +4.319662765458905e-01   +3.937016445295865e-01   +6.865913441277172e-01   +9.806744398568152e-01; +7.931342768193374e-03   +3.703482207824290e-01   +5.914802780626860e-01   +1.801817093141338e-01   +2.746905587360879e-01   +1.777614826379866e-01   +4.376692981474519e-01   +1.221342598143694e-01   +6.924987482206879e-01   +2.498887115200481e-02   +7.204030774628529e-01   +2.846088745737287e-01; +6.796840770813459e-01   +8.924420119080130e-01   +3.314152889999643e-01   +3.350097067411787e-01   +2.435947102928756e-01   +3.604571555669736e-01   +2.869268404961615e-01   +5.049810624945544e-01   +2.569966462427620e-01   +6.703787518395100e-01   +6.491633448950929e-01   +5.933510604247564e-01; +7.049495260770535e-01   +8.564808534981231e-01   +8.533086056940531e-01   +1.874604667942511e-01   +2.428916960650135e-01   +1.868833351626867e-01   +5.010572147054183e-01   +3.478190106108209e-01   +1.199317666556406e-02   +8.372575424529148e-01   +7.250733446921975e-01   +9.613104825620383e-01; +6.450601913293987e-01   +4.009747590962967e-01   +4.428642758016894e-01   +3.208083161131997e-01   +1.545680730295279e-01   +1.038581646590175e-03   +7.623656748116959e-01   +9.047740904183296e-02   +5.316183792621011e-01   +9.708548242033737e-01   +3.747125116874617e-01   +1.871124119471003e-01; +5.536666370889842e-01   +3.187138722977991e-01   +9.019383954165496e-01   +4.041476057920597e-01   +9.580451420731109e-01   +3.142097468860230e-01   +7.613566942427478e-01   +1.479209801582023e-01   +2.796653384181795e-01   +5.664274062398516e-02   +5.799934832441328e-01   +1.929386507542780e-01; +2.178442274856300e-01   +6.088261741170753e-01   +3.409732781175649e-02   +5.482948736832102e-01   +9.362062757745718e-01   +6.982908330913197e-01   +5.771094330536745e-01   +1.992641541064497e-01   +9.461458540112379e-01   +4.502051490441891e-01   +1.145247891031438e-01   +3.404088886856387e-01];
L3I_L2I_iGABA_netcon = [+9.335206189107772e-01   +9.282585647176447e-02   +6.206059648119434e-02   +2.787162751237877e-01   +2.541427933894260e-01   +4.042933728180874e-01   +5.292004163352317e-01   +1.088043298823409e-01   +9.123472882266814e-01   +5.840901691124407e-01   +2.086999212356648e-01   +9.081561969078573e-01; +3.909397313829995e-01   +6.169724559906954e-01   +4.949036132142511e-01   +7.459220673255954e-01   +8.573134177025672e-01   +9.877142833839121e-01   +8.294537092337878e-01   +2.711656999054178e-01   +6.392780462024505e-01   +2.835383951981605e-01   +3.178646954960016e-01   +5.515620135835245e-01; +2.722574004977454e-01   +1.130926116007286e-02   +6.434995245229218e-01   +2.382022374976041e-01   +9.111059724357831e-01   +8.973891926070558e-02   +8.577132158496871e-01   +5.236264693336207e-01   +2.553515691521314e-01   +8.280748219420176e-01   +1.336731352585097e-01   +3.422733771693488e-02; +1.525992174816821e-01   +5.733608788602805e-01   +2.228870398105733e-01   +9.579133303004035e-01   +6.993032952985607e-01   +3.224984119444144e-01   +7.881106425174453e-01   +9.726482717712901e-01   +9.033731264490732e-02   +1.921698943724308e-01   +6.729331314802850e-01   +5.440329571955211e-02; +3.970259011806367e-01   +7.880416291271449e-01   +8.376457319614821e-01   +6.215957031401640e-01   +7.259436811916515e-01   +5.136545023366791e-01   +3.189026874369499e-01   +7.086863949966877e-01   +8.383603096039574e-01   +4.414202534720290e-01   +5.701855429105785e-01   +8.061917945292373e-01; +3.745625043330272e-01   +2.352010084692669e-01   +9.712092607931718e-01   +6.006351947435911e-01   +2.303893933437059e-01   +5.932212909276267e-02   +4.529302999324444e-01   +3.108575497065178e-01   +5.842615068736106e-01   +3.931800785191534e-01   +1.705409323793823e-01   +4.512478131988936e-01; +1.295251177294626e-01   +4.482240663692402e-01   +8.463550526384014e-01   +1.728505763848286e-01   +5.748468421404104e-01   +7.256242585080177e-01   +7.528584491389461e-01   +2.939028807113288e-01   +9.485066205258718e-01   +8.269048176422134e-01   +1.480357485739357e-01   +3.806749829169424e-01; +4.338047369354221e-01   +5.693588530064145e-01   +5.066180798689427e-01   +8.979956168020256e-02   +8.108962014982882e-01   +5.574155434829063e-01   +1.109755913228913e-01   +8.502107181032897e-01   +6.145473089821767e-02   +6.791892259624881e-01   +4.758406518130150e-01   +7.906278728164665e-01];
L2E_L3E_iAMPA_netcon = [+3.649874742931080e-01   +7.555293289666029e-01   +7.397627395083761e-02   +5.175767110788662e-01   +7.579192618477905e-01   +4.319559605929613e-01   +1.997723912020322e-01   +8.757977862134194e-01; +5.317438296898747e-01   +9.972777573306654e-01   +5.917085352431052e-01   +9.947860857211368e-01   +9.950831564124525e-01   +5.428021622449415e-01   +1.933183351024745e-01   +7.864175399822164e-01; +7.133615179435033e-01   +1.873228238630106e-01   +9.103470130910807e-01   +8.566329487856310e-01   +9.626560219298493e-01   +7.118764588725213e-01   +3.264084941081873e-01   +4.669054383688584e-01; +8.705965742957867e-01   +7.810498869726882e-01   +1.919188131201917e-01   +9.609346152417402e-01   +5.355600915622891e-01   +1.586203793279508e-02   +8.801896553488565e-01   +8.134974521221017e-01; +3.288477512353898e-01   +1.958240516166066e-01   +4.317063706709656e-01   +6.782733021117239e-01   +9.658979750960180e-01   +8.015991545449905e-01   +4.715051502177872e-01   +8.965559313569427e-01; +6.495551460490389e-01   +9.922247914890591e-01   +7.492141426516618e-01   +4.026584231327497e-01   +1.168243141139295e-01   +1.423871886280071e-01   +4.044932874737254e-01   +4.281305816048692e-01; +9.764947867365795e-01   +8.015624631284732e-01   +4.033012212179653e-02   +9.336412360161032e-01   +5.025678487938140e-02   +4.795094149654898e-01   +1.804853531936975e-01   +3.342790571359278e-01; +7.662988293492765e-02   +4.244153513251305e-01   +9.457683810660528e-01   +4.801010368582121e-01   +3.030547191050081e-01   +2.555362637232644e-01   +9.696911688769170e-01   +5.961642520073565e-01; +5.886017226640349e-01   +7.286208912708612e-01   +7.632982520323972e-01   +2.296776615850523e-01   +5.811477603054492e-01   +3.691186082342895e-01   +4.087956782767355e-01   +9.010160224043610e-01; +4.127257050281830e-01   +4.976304241585092e-01   +5.571947836130469e-01   +3.964411365391187e-01   +5.322774037779363e-01   +6.608326923552229e-01   +8.443724337369254e-01   +7.019266807142410e-01; +3.084840152623398e-01   +8.090433258329407e-01   +1.837315768529248e-01   +7.041107991319797e-01   +9.004191466194176e-01   +1.679135476621951e-01   +6.165366045286783e-01   +3.785723800741274e-01; +2.636679807237405e-01   +3.569700185105307e-01   +4.998159543476603e-01   +5.586962332488133e-01   +5.406029903186200e-01   +2.797686590323051e-01   +3.741871886444597e-01   +7.351889083081006e-01];
L2I_L3I_iGABA_netcon = [+9.548457705431086e-01   +3.110660108129792e-02   +9.106341075807943e-02   +4.593927612720866e-01   +3.273097993011819e-01   +3.677555641560097e-01   +6.850071933005990e-01   +8.050779603936330e-01; +5.424511265078193e-01   +2.084887249416403e-01   +5.938987405613004e-01   +6.386433203040889e-01   +8.045371583678069e-01   +2.095951322997445e-01   +9.097843267762805e-01   +6.639050696138295e-02; +5.389760159779804e-01   +4.546846714096908e-01   +2.408956221904204e-01   +9.164182891006113e-01   +9.998917823363614e-01   +4.406013129836058e-01   +6.107619203916382e-01   +9.484353609251532e-01; +3.093230635005903e-01   +1.268076060137296e-01   +8.393042147664189e-01   +1.612834572571896e-01   +9.799174434676940e-01   +9.545636218991498e-01   +9.000359594552140e-01   +4.952220238852815e-01; +7.005319841068018e-02   +8.922506947955322e-03   +8.572622649013590e-01   +7.138263019580930e-01   +1.255220254758230e-01   +1.232851271277150e-01   +1.938548801150874e-01   +7.540374520704666e-01; +1.822115829590193e-01   +7.273104795026879e-01   +9.613201067968787e-01   +5.768150421075763e-01   +2.300371369473863e-01   +4.695660363723418e-01   +7.538489728997944e-01   +7.399660066277262e-01; +9.234564672927892e-02   +3.531114022882096e-01   +4.884643685555259e-01   +4.320129792410622e-01   +2.357906849934667e-02   +8.549249935900033e-01   +3.475256685990509e-01   +8.305626729107084e-01; +4.638409949012036e-01   +7.786117646564573e-01   +2.182034320343343e-01   +8.829690524577753e-01   +6.075998277341972e-01   +4.251942997774032e-02   +4.189990044048595e-01   +1.560236162217881e-01; +9.662159516827414e-03   +4.362377795838226e-01   +2.267892336135883e-01   +3.911778523327237e-01   +1.093847466908608e-01   +6.894522186273261e-01   +1.538943736312259e-01   +4.566386236086183e-01; +9.140528782773155e-01   +4.367268699128343e-01   +5.367062941792637e-01   +1.773121395223499e-01   +4.065499113446757e-01   +9.772442201405357e-01   +8.194786708197005e-01   +6.184207948971234e-01; +6.421513892637127e-01   +5.005519566385051e-02   +7.614773869179969e-01   +6.317861559423459e-01   +8.831875596878280e-01   +2.835904334113475e-01   +6.225701473870243e-01   +9.296226998984993e-01; -2.232022797203972e-04   +4.827939763545191e-02   +3.462345590959294e-01   +6.238622586010780e-01   +5.482772631696476e-01   +1.338425039873611e-01   +7.398900576131631e-01   +8.337137789210778e-01];
L3I_L3E_iAMPA_netcon = [+8.944579118586468e-01   +2.553180616140791e-01   +7.403044827267067e-01   +6.818201402859200e-01   +6.013803233768623e-01   +7.483997213387785e-01   +7.458074595255477e-01   +2.233531379797736e-01   +4.545389240385890e-02   +8.008287023584477e-01   +2.908235045129881e-01   +8.021978921100885e-01; +5.816033147448514e-01   +3.231188638766903e-01   +6.931830053486923e-01   +2.360174228926379e-01   +8.558814373787653e-01   +5.434893658739814e-01   +1.273039741464064e-01   +3.515940226646751e-01   +2.137918269758668e-01   +2.334630409056721e-01   +4.031504502638149e-01   +1.034535782315992e-01; +5.828659709283406e-01   +4.016229713818341e-01   +8.230051637806425e-01   +4.555526511395107e-01   +9.897548692208658e-01   +3.396351347265626e-01   +8.217335996805349e-01   +2.864304469606473e-01   +3.969476071196952e-01   +9.307547328711135e-01   +8.632296354514959e-01   +8.207522243861375e-01; +8.551453905440294e-01   +4.049114458031469e-01   +8.292989522313842e-01   +3.834399455926144e-01   +9.293598291885899e-01   +8.320123072091824e-01   +2.643055985308062e-02   +9.268109789221149e-01   +3.340919638614833e-01   +7.633260594758858e-01   +6.149508784915818e-01   +8.406152207395927e-01; +3.380347632212669e-02   +3.865645776540315e-01   +2.946982250214813e-01   +5.382104611902644e-01   +4.107355700200915e-01   +5.510387472228798e-01   +4.160540723408688e-01   +5.091827190557871e-02   +2.285859369474706e-01   +8.277470316589184e-01   +9.904826879923452e-01   +3.557109845880747e-01; +8.845216551810162e-01   +6.090530402380868e-01   +3.091132545176902e-01   +9.911505690787494e-01   +6.882273325030750e-04   +9.576619810311333e-01   +7.305609019718087e-01   +5.927753701491009e-01   +9.350074125535166e-01   +5.730554017245417e-01   +2.034110831464349e-01   +4.292831833505385e-01; +4.068863451598204e-01   +1.651333331027156e-01   +5.236734130013194e-01   +7.552255174811781e-01   +5.420472343967078e-01   +8.931322271019694e-01   +7.814952610428250e-01   +1.618171478269028e-01   +6.816873517441521e-01   +7.927684939457307e-01   +8.283129674575342e-01   +5.699357255542494e-01; +3.647585379703100e-02   +1.892127892813749e-01   +3.271782148441756e-01   +9.814416464019032e-01   +2.084142478834205e-01   +3.579007955773083e-01   +3.679939161931972e-01   +8.373667163314921e-01   +9.635242540321327e-01   +3.293500043441689e-01   +6.764717694796221e-01   +6.998976959834921e-01; +7.460556526777544e-01   +9.624167825781225e-02   +8.340914252068157e-01   +2.350117875488298e-01   +2.195514730131065e-01   +5.477199260334152e-01   +7.463195444241330e-01   +1.679021947146668e-01   +4.385530393528698e-01   +2.235267328165358e-01   +2.487996890566435e-01   +7.432291825828573e-01; +1.558131768368537e-01   +3.218390495930357e-01   +8.090230336326910e-01   +5.287576634874310e-01   +3.278579740673368e-01   +3.465512962726476e-01   +8.929043911948702e-01   +5.009799646724082e-01   +9.387531340368762e-01   +3.114136287345030e-01   +4.770374637444375e-01   +7.575165803584462e-01; +1.445297476117881e-01   +7.702593341154543e-01   +5.590127797595537e-01   +5.387076662449908e-02   +9.582685306706325e-02   +6.230117746317970e-01   +2.442881650373696e-01   +9.991411502113209e-01   +5.914382588417937e-03   +5.849865917413893e-01   +3.995249141908430e-01   +3.895909533383495e-01; +6.064391971357344e-01   +2.347947587312111e-01   +2.634964884092211e-01   +7.576781164149211e-01   +7.499190749259574e-01   +7.979693324075278e-01   +1.294916364977064e-01   +3.545395778414212e-01   +6.106890848922345e-01   +8.298643891797842e-01   +5.988380597796128e-01   +4.268862915696130e-01];
L3E_L3I_iGABA_netcon = [+9.558638190887850e-01   +8.847649016193797e-01   +8.002955416664534e-01   +9.855560109834521e-01   +9.019040241344387e-01   +9.617065908817737e-01   +6.537083650954734e-01   +4.950499460909643e-02   +1.086342644379846e-01   +4.520717895623221e-01   +8.294947673793973e-01   +5.811246011152976e-01; +5.722403764337723e-01   +4.377631300173177e-01   +9.865159037433108e-01   +5.601322246662190e-01   +9.947104622782778e-01   +5.423374202858473e-01   +6.567713087005252e-02   +4.662976583423576e-01   +4.613315180872491e-01   +3.342253714876772e-01   +6.261820402199986e-01   +6.366915531892157e-01; +8.501594412582958e-01   +7.818440354488583e-01   +1.592044278720358e-01   +9.327582922327480e-01   +6.515269646096693e-01   +3.111528919852422e-02   +2.754043533983548e-01   +3.244855890049814e-01   +4.508135349794569e-01   +5.872384363396558e-02   +5.399940177929528e-01   +6.505243006975480e-01; +2.765897774416697e-01   +1.492318542126236e-01   +2.376564101492804e-01   +7.206907389870090e-01   +1.069933175804241e-01   +6.956430756725123e-01   +2.813207592267858e-01   +6.309861930256488e-01   +5.503616574942273e-01   +7.406933914398832e-01   +6.500838837434447e-01   +8.632739358665565e-01; +6.226461943106558e-01   +6.203261349067875e-01   +7.020489645012704e-01   +4.849796240835292e-01   +3.754855749671392e-02   +5.197803123295522e-01   +8.791464577804815e-01   +2.293000781667139e-01   +8.062122820857284e-01   +5.062970339168220e-01   +7.262838175721790e-01   +5.643668110725517e-02; +5.902181361333482e-01   +2.604834227797055e-01   +3.770395240896232e-01   +6.394071546327559e-01   +6.192273453453127e-01   +6.013904350638532e-02   +4.445548458727986e-01   +5.800165713588026e-01   +7.010721462578292e-01   +2.011629132327079e-01   +9.439065663261376e-02   +8.185157187632557e-01; +9.645289115630995e-01   +4.449599296140882e-01   +9.749180333811313e-01   +8.874287045053110e-01   +5.658906402034810e-01   +8.889394718710266e-01   +7.578080759387934e-01   +6.042285069215387e-01   +8.729504966055657e-01   +4.265750783081897e-01   +8.786895860162272e-01   +5.286843832023842e-01; +8.676169943133265e-02   +8.449513364234852e-01   +9.710201591973028e-01   +1.976441025689217e-01   +9.620627667486540e-01   +3.301603428109033e-01   +6.015425108250584e-01   +5.999013850999082e-01   +5.209803892712641e-02   +1.677728571093242e-01   +1.237399415958961e-02   +6.953762988568591e-01; +5.013205132530650e-01   +1.978846459797491e-01   +6.422633696923508e-01   +3.962894299732813e-01   +7.475827956394862e-01   +2.283193730559440e-01   +7.833619231996541e-01   +4.477106225130327e-01   +2.187242472149418e-01   +7.514012524112359e-01   +2.923652435060697e-01   +2.120706112903553e-01; +5.217703244485113e-01   +3.032416433119241e-01   +8.598879969666525e-01   +9.922123729604814e-01   +6.625315610275921e-01   +1.140704465844778e-01   +1.141696856610301e-01   +3.357653224646875e-02   +4.591297923223449e-01   +3.670971222482897e-01   +1.796058140088881e-01   +5.441216336226772e-01; +9.029780965542858e-02   +4.802511878157951e-01   +4.014424667943978e-01   +4.013601100946816e-01   +5.241764244556966e-01   +3.119623924055180e-01   +9.775498188397380e-01   +5.124310905003887e-01   +9.585990060895989e-01   +9.423520558656421e-01   +9.264466437577521e-01   +7.037470776408362e-01; +9.062126509828059e-01   +3.372400673114946e-01   +6.312162741331041e-01   +6.589186280832282e-01   +2.594654014317117e-01   +2.269370158661773e-01   +8.492015239379521e-01   +4.066325129783007e-01   +7.918815138265646e-01   +1.592126777417981e-02   +6.884536528160387e-02   +9.554428006072776e-01];
L2E_Input1_iAMPA_netcon = [+9.970787442168904e-01   +9.996721711911494e-01   +9.983158565688299e-01   +9.989225280112930e-01   +9.970121512910478e-01   +9.970752510058455e-01   +9.980251347011163e-01   +9.968020109744791e-01];
L2I_Input2_iAMPA_netcon = [+9.987173258727952e-01   +9.983619248095694e-01   +9.991490362335219e-01   +9.992358172573442e-01   +9.988790113782663e-01   +9.972533311884884e-01   +9.999975367758327e-01   +9.978739563848182e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
