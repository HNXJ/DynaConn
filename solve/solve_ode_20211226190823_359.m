function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.391759186925580e-02   +1.835203309946024e-01   +2.674310657936871e-01   +9.248384413022702e-02   -1.324674365988573e-01   +4.609874871304569e-02   +2.559052666860424e-01   -1.178816687139720e-01   -1.684137985105455e-01   -1.280283611900828e-01   +3.807984016570153e-01   -5.804458700085759e-03   +1.259146021501476e-01   -2.751474818973403e-01   +2.102675411755769e-01   -2.299603302449288e-01; +4.553349402454443e-01   -2.724836226055636e-01   +4.618017652506079e-03   +6.913880298729770e-02   -2.773476744003113e-01   -3.598316926087592e-01   +2.388501090615160e-01   -1.190627078275225e-01   -8.871030848394031e-02   -3.702458987073894e-02   +1.985592309106911e-01   -4.245411942788925e-01   -4.473748830867921e-02   +3.324572453822186e-03   -1.190410880493498e-01   +1.595331999788931e-01; -1.055431412616023e-02   -1.852793295918095e-01   -2.494761621300509e-01   -2.015678911176738e-03   +3.602113117470210e-01   -2.022299646055137e-01   -9.551958701525309e-03   -2.306833078112323e-01   +3.119106871247230e-01   +8.429763211243060e-02   -1.914040417842944e-01   +4.078261078623540e-02   +7.009555021237479e-02   +5.130692155192976e-02   +2.936702506420921e-02   +3.820291438772606e-01; -1.023964634853748e-01   +1.584633466343033e-01   -2.166679902561437e-02   +2.706036046540126e-01   -3.733513228087467e-01   +1.373325303526066e-01   +2.665459295985065e-01   -2.334940455506735e-01   +2.993180156219513e-01   +4.037148098063501e-02   +1.164613218567801e-01   -8.905527926634729e-02   +1.075629094085073e-01   -1.336533902577825e-01   +8.528646699425885e-02   -8.557165596139304e-02; -1.119571509564170e-01   +3.738463815687886e-01   +2.616878641823905e-01   -7.554100814086633e-03   -1.285174224187552e-01   -1.467111410324075e-01   -7.681683151933819e-02   -7.896151642292502e-02   +1.984729554753536e-01   -9.206526945857797e-02   +6.600673243709268e-02   +1.574377605720255e-01   +1.990214276649493e-01   +2.311820498865302e-01   +1.788029442457430e-01   +2.615338805070705e-01; +1.487868778407564e-01   -3.357959837146208e-01   +2.861229386696107e-02   +5.151102999966564e-02   +1.153055150155946e-01   +1.729350667870090e-01   -1.439114184804341e-01   +8.349849048725638e-02   +7.281510970340178e-02   -1.202527133686126e-01   +2.237610175268930e-02   +1.137317096648342e-02   -2.812049494924385e-01   -2.917764384392050e-01   +6.015632979019726e-02   +2.720088314939864e-01; -2.018830095964068e-01   +4.968465369769951e-02   +1.506034175849833e-01   -1.077355879381162e-01   -5.257857371620306e-02   -2.561673580823161e-01   +7.083492900461140e-02   +1.502103876473961e-01   +2.884933747287079e-02   -5.485803761139674e-01   -9.205031312518756e-02   -4.309247849583855e-01   -8.548394947307236e-02   -2.496001052337524e-02   +4.762866668454797e-02   -1.838905685242109e-01; +3.332775016994360e-01   +1.158724446594381e-02   +1.340221921990878e-01   +2.531827098192200e-01   -1.695602856325093e-01   -4.210247990243845e-01   +1.533815833244906e-01   -8.860739737037029e-02   +1.502042542362503e-01   -2.237977476000967e-01   -5.073709785804292e-02   +1.550553669075383e-01   -1.549213753182163e-01   -1.411406755482661e-01   +2.132703175360426e-01   +8.466772581177290e-02; -3.483127963549656e-01   -1.533975658219429e-01   +3.654952276819875e-01   +2.060613682409894e-01   -1.186556126477291e-01   -4.016385068494792e-01   +1.111211968447428e-01   -6.778164513645801e-02   +1.815793408667816e-01   +1.523045307542986e-01   -2.365378375933311e-01   +2.803965961256228e-01   -1.108382467422088e-01   -1.848982161117363e-01   +9.385342414331424e-02   -1.355432969752403e-01; -2.744897585829639e-01   +2.465399357512439e-01   +1.901268886376273e-01   +2.705131236130744e-01   -3.356265378153614e-01   +2.551085517789243e-01   -9.550661750517185e-03   -8.412583500498183e-02   -2.762698750935733e-01   +9.760774311706769e-02   +7.038291917666942e-02   -2.164776993487565e-01   +9.786780149843051e-02   +2.602666784040072e-01   -2.245065033930015e-01   -3.040773407053241e-02; +2.311747906204049e-01   +5.523611321764416e-02   +1.093509797365926e-01   +1.035296153247738e-02   -9.001910810263813e-02   +5.010621382572920e-02   -1.844027132957096e-01   +2.036121703828700e-01   -1.652485996700037e-01   +1.197921907487919e-01   +4.984796115763870e-01   +2.746087246316423e-02   -2.091142629608451e-01   -2.328336232246820e-01   +1.837420195210386e-01   -1.040660297285115e-01; +1.193351684577403e-01   +2.207456505649334e-01   -3.375648833495652e-01   +3.388041329940963e-02   +3.542628429038662e-01   +1.730151675520425e-02   +9.845115574238825e-02   +2.246116814588647e-01   +6.895886108359202e-02   +2.955783296095119e-01   +2.006167363601066e-01   +1.540263990688706e-01   -7.401568958828174e-03   +2.573430084109500e-01   +1.338729405288505e-02   -3.791849112764786e-01; -1.718812884260688e-01   -3.481252334262966e-02   +2.091916832289669e-01   -5.685445447179277e-03   -2.778552106899390e-01   -3.492337407045559e-01   +4.413801566200443e-02   +2.763163791793845e-01   -3.142953505569565e-02   -4.613160504754412e-01   -9.496920200620054e-02   -1.709333369626588e-01   +2.265725595909523e-01   -2.186347392168922e-01   +2.181184809905069e-02   +2.312240237242579e-01; +5.073245741787728e-02   -2.666829358899405e-01   +5.721590569974365e-02   +4.651109021973270e-02   +1.099627136865273e-01   +3.265239592640071e-01   +1.061077954712947e-01   -3.565677344625438e-02   -1.432021965982394e-01   -1.512770281296383e-01   -1.717794586001170e-01   +1.061184360705456e-01   +1.292582648626589e-01   -8.775965534653782e-02   +2.269649918194062e-01   +1.518381599040060e-01; +1.676967332613272e-01   +1.520924559437388e-01   +2.290545194933478e-01   -2.215027837446371e-03   -7.897290394487586e-02   -7.746993795467763e-02   +8.397066621184307e-02   -1.887724053557512e-01   -1.912820283091757e-01   -5.184993656587213e-02   +2.332693485963799e-01   -2.125366096315501e-02   -1.223137253327870e-01   +2.000903152878475e-01   +1.597954782390903e-01   +1.962096657330314e-01; +2.659982853380845e-01   -1.995190831464316e-01   +3.255962895524456e-01   +3.406621141957848e-02   -6.139340822311604e-02   -2.783101117360355e-02   -1.274847902818016e-01   -2.448354744299605e-01   -3.518488971850342e-01   -2.391029344926505e-01   -2.688847886084795e-01   +7.034026416924456e-03   -9.268874835472424e-03   +1.977555313542859e-02   -2.099988012182973e-01   +2.821285039001744e-02];
L1E_L1I_iGABA_netcon = [-2.702066117450015e-01   -7.776551399289557e-02   -3.808636470522205e-01   +3.303979255635603e-01   -6.182947687991751e-02   +1.610961210084299e-01   +1.172007432488631e-04   -7.612722675260278e-02   -2.729747126504533e-01   -1.017872383885918e-01   +7.780379706396684e-02   +3.089976971845580e-01   -2.544498265117383e-01   -2.542371385300812e-01   -2.714248520492832e-01   +1.123239723141473e-01; +8.622018674550669e-02   -1.611661072866211e-01   -5.872437215166125e-02   +3.075311895725212e-01   -1.985835516883983e-02   -2.718782280621008e-01   -2.809138424724140e-01   +1.465579085168836e-01   -2.446046761346773e-01   -2.080615177748135e-01   -1.226385041070580e-01   -5.308607546408960e-02   +2.607795499913877e-01   -1.842237764661981e-01   -8.848244846977991e-02   -9.349313590079156e-02; -7.972771775088042e-02   -4.812821198775865e-02   -1.116397378022570e-01   -3.631910767887563e-01   -1.817757635488039e-01   -2.345029726314045e-01   -6.127402734663598e-02   -4.147760233459991e-02   +9.550179953830754e-02   -1.686383984951010e-01   +2.229930120815735e-01   -1.063020417014355e-01   -1.286888433366444e-01   -3.512046762463195e-02   -1.154909010836171e-01   -4.442622713950609e-02; +1.680099888405693e-01   +2.135127887076287e-01   +1.329237411431923e-01   -5.465687632212474e-04   +3.241920913130180e-01   -3.296253995423131e-01   +3.143908317748536e-01   +1.319873562515479e-01   +7.836013030166039e-02   +3.201559934358681e-02   +3.647712290778167e-01   +3.017117840458655e-02   -1.470155766027355e-02   +1.161891145891328e-01   +1.236399728495665e-01   +2.292516554025313e-01; +9.155701136368558e-02   +5.517715237938043e-02   -1.799131769357441e-02   -2.296737751013981e-01   -9.303844971721181e-02   +1.687823381112212e-01   +4.600195512031101e-02   -5.657068323793368e-02   +8.127319042331835e-02   +2.534117818712888e-01   -3.648431750731412e-01   -5.057054103729043e-01   -3.629100257370717e-01   +2.571289701947246e-01   -1.484055202047184e-01   -2.276275580503741e-01; +1.093045472954450e-01   +2.698147217295436e-01   -5.945418922133155e-02   -6.193266936209029e-02   -1.042078142750135e-01   -2.792107440740205e-01   -1.214423006786043e-01   -1.766584586120863e-01   +3.425120125515029e-01   +2.996112811607544e-02   -1.239494186171501e-01   +2.445181123054066e-01   +4.277918736227565e-02   +1.005523958673398e-01   -3.091185919349556e-01   -3.752118261061621e-01; -2.947830513738121e-01   +2.358280826226257e-01   -3.725836060163273e-03   -6.749548018221939e-02   +7.240820126147685e-03   -2.837617152212664e-01   -3.134621439836967e-01   +1.366237956374056e-04   -3.111257550373885e-01   +2.124364834731948e-01   +2.837317508953016e-01   -3.059320488307245e-02   +6.081258008175056e-02   -2.258068089784399e-01   +1.329880929215891e-01   -5.026038305674378e-02; +3.344793078654140e-01   +1.414630670465228e-01   +1.653297006264577e-01   +1.084225911094052e-01   -8.918488272290719e-02   +4.450657855792711e-02   +3.008360928181110e-01   -2.482015705419897e-01   +2.090465481923623e-01   +4.846397603002235e-02   +1.864077563063261e-01   -2.814237460503302e-01   -1.402341694162526e-01   +4.381468406266217e-01   -2.988526587682573e-01   -1.305750144857548e-01; -3.150365483014645e-01   -1.041780039379377e-01   +1.191569161114644e-01   +2.330428070807154e-01   -1.130265964876360e-01   +2.456934856983551e-01   +2.416684245980198e-01   +7.485569575458054e-02   +2.182618024652716e-01   +2.559252971932703e-01   -3.825424072558899e-01   +3.446725597304701e-01   -8.515087231021706e-02   -1.859258659260589e-01   +1.293126173982880e-01   -9.325147831290528e-02; +3.318258155596083e-01   +1.335311803320349e-02   -3.742152306653301e-02   -3.643410360185463e-01   -3.382554910553247e-01   +2.871457511528367e-01   +6.397565738019532e-02   +1.580685093610296e-01   -7.684240118337144e-03   +1.220952823425564e-01   +1.412684389144769e-01   -3.012713571892220e-01   -3.924225201571629e-01   -1.028954676244399e-01   +1.162233480842841e-01   +9.645071063827002e-02; -7.913931136965757e-02   +3.435403763626650e-01   +2.806414584109179e-01   +1.425997103465592e-01   -3.451635893487673e-02   -3.105676001914565e-02   +1.607837334949519e-02   +2.844316941253062e-02   -1.260844680396608e-01   +6.514948086098868e-02   -4.838060884662830e-02   +2.114258169159006e-02   +4.556395660379207e-01   -5.518468483018610e-02   +1.448518326448816e-01   +1.419487716372417e-01; -3.806736599091275e-01   +5.646237455403500e-02   +1.037933079507175e-01   +3.212612353046020e-01   -1.370972582451191e-01   +6.768644751870372e-02   +2.012682128176353e-01   -1.811534376100915e-01   +2.331695973280648e-01   +1.158835211313815e-01   +2.666992688630296e-01   +1.147716976571788e-01   -1.244992081727674e-01   -1.419935452570236e-01   +1.539867292444969e-01   +5.133607251624662e-01; +1.665089006680968e-02   -2.228171015083852e-01   +1.892504254466929e-01   +1.829800598184724e-01   -1.541421347039453e-01   -1.339036244411020e-01   -1.156029140623367e-01   -4.750825156419967e-02   -3.215455910241086e-01   +2.550534990511483e-01   -3.176534117621174e-01   -1.312832315944956e-01   +1.089706201735060e-01   -1.614500330534276e-01   +1.549190975024866e-01   +2.523309853329802e-01; +5.379320783713429e-02   +4.178353458951624e-02   +2.581288245494673e-01   +1.424155390339779e-01   +6.202232589017698e-02   +2.780382102751066e-01   +7.362154774776811e-02   +3.317292469238852e-01   -1.542904473211363e-02   +1.507579340262768e-01   +1.085731866282083e-01   +3.003901390415140e-02   +4.950252146732551e-02   -3.661577008750004e-01   +2.249894365630939e-01   -1.027857567639587e-01; -1.360480439668857e-01   -6.644759328857855e-02   +1.832307841633974e-01   -3.661185533766784e-01   -2.257295043787110e-01   +1.848207901522242e-01   +2.442072184837920e-01   +8.025384149550503e-02   +9.662865984270325e-02   -2.409119110180926e-01   +2.711782694047982e-01   -5.773995711788366e-02   -2.016112252622775e-01   +1.152247102243146e-01   +4.030910783905510e-01   -1.579087219876967e-01; +7.159418181008009e-02   -2.372223691527280e-01   -3.163102619972447e-01   -1.595546732638576e-01   -3.488496668162556e-02   -2.403947466801332e-02   +3.197537091819993e-01   -1.381432386508546e-01   -2.303296196515207e-01   -1.221891353655692e-01   +6.154720001432137e-02   -1.376413906960773e-01   +2.804801237970186e-02   -2.092637913992785e-01   +1.854326595836134e-01   -2.557158476466134e-01];
L2I_L1I_iGABA_netcon = [+1.413407096439409e-01   +1.489128457148690e-01   +1.094000393447199e-02   -4.062562256431022e-01   +5.973349314087546e-02   -1.750504463960471e-01   +1.209702407867187e-02   +2.876323917459848e-01; -1.134117923824937e-02   -4.023014112178145e-01   +5.004361269096061e-02   +2.224521669618103e-02   -3.228440140276176e-01   +4.417247001970526e-02   +2.623545214249164e-01   +5.481431919616955e-02; +1.091567760135735e-01   +4.610576893159516e-01   +2.309434785863364e-01   -8.292720500005775e-02   +3.377150845128439e-01   -1.030514460159565e-01   -1.937148369193808e-01   +1.268591746762105e-01; +4.216050129570129e-02   +1.703064304926270e-02   -1.030322511536998e-01   -3.263087602711253e-01   +3.259730762985387e-01   +2.029730969158136e-01   -2.066799205078402e-01   -1.105551793657025e-01; -3.273181837706671e-01   -4.539809742430823e-02   -2.586375479099004e-01   +3.956064729163404e-02   +1.267824090874101e-01   -2.056555413388374e-01   -5.147234924887095e-02   -1.586453359049146e-01; -3.887830536776947e-01   -2.601276778964935e-01   +1.672201234643395e-01   +4.327986364791431e-01   +8.221383449936809e-03   -1.111666356633849e-01   +2.324567826570565e-01   -8.819027006956245e-02; -3.722485528063812e-01   +3.307715175800347e-02   +3.604514470539144e-01   -1.603690189225312e-01   -4.162203011222162e-01   +1.012823911916917e-01   +9.266324749974736e-02   +1.081597095759906e-01; +9.514241637566034e-02   -4.442593927490716e-01   -2.650944317982313e-01   +7.845497481148174e-02   +2.734712809480335e-01   +1.641215277361561e-01   -9.843912620437992e-02   -1.668824965006379e-01; +1.150304158906450e-01   +1.959613656677474e-01   -2.030315455740634e-01   -2.360999565808606e-01   +5.389209419939792e-02   +1.001220607391675e-01   -7.576251321763233e-03   +3.329645599019067e-01; -7.135756562642112e-02   +5.425149328671082e-02   -1.760704130331830e-01   -1.699386903332929e-01   -1.020739726212036e-01   -1.653555957806738e-01   -2.629117962894537e-02   +2.175687920252982e-01; -2.874984402822368e-02   -3.235963120887857e-01   -2.114805549693539e-01   -1.453889394673927e-01   +2.704578329321825e-01   +5.275336467586524e-03   +2.360186074700849e-01   +2.306024352648989e-02; -1.591356771798127e-01   +4.269013230644800e-01   +6.128343658149159e-02   +2.380355533739330e-01   +1.768405047200051e-01   -1.787047020218024e-01   -5.869158455690734e-03   -1.627698172457327e-01; -1.183826440218975e-01   +2.826464814386088e-01   +3.200641524211154e-02   +1.817880318341463e-01   +2.237198208214228e-01   +1.326122933655283e-01   -8.003422358388707e-02   +1.487234121847322e-02; +2.833252760169940e-01   -1.160715168304732e-01   -1.201927036146119e-01   -1.421852553946085e-01   +1.761971591128174e-01   -2.265494353757027e-01   -6.799092402521228e-02   -4.933395326695152e-02; +1.802230387950671e-01   -9.467636655488176e-02   -1.589645517815647e-01   -5.628183390955625e-02   -1.014052627271336e-02   -2.385509884837020e-01   +2.252304493841319e-02   -1.395534457101429e-01; +1.629697775930476e-01   -1.926898622929998e-01   +1.273507987225684e-01   +5.241901098133397e-03   +5.124963149508113e-02   +3.310411624632144e-01   +1.816960141710549e-01   +2.155428323009881e-01];
L1I_L2I_iGABA_netcon = [-2.135222467370930e-01   -8.995555202125627e-02   -1.284993892106142e-01   +1.591906255931152e-01   -1.646840649786285e-01   -1.443354734942144e-01   -1.581380989673008e-01   +1.891898905454223e-02   +1.202600250927298e-01   -3.374430773423542e-01   +3.702164412515501e-01   -8.729394167014216e-02   +6.913886309605463e-02   +7.962699325981973e-02   -3.237590469259449e-01   -1.416210161722684e-01; -1.166548919557601e-01   +1.075705280428070e-02   +9.249258672954543e-02   +2.614827613206603e-01   -1.484106262874074e-01   +8.503436910003950e-02   +2.405411124385780e-01   +1.522603025149995e-01   +1.729650709707932e-01   -2.046714501420163e-01   +2.460742236666032e-02   +3.640904584016309e-02   -1.567610478602738e-03   -1.110171026473809e-01   -2.286068933309902e-01   +2.510142195301480e-01; -4.163846100951250e-01   -1.057121092284708e-01   +1.260009973233956e-01   +5.278670726987039e-02   +2.358632969927792e-01   -3.853922751358093e-01   -1.119020316495618e-01   +1.424885524769842e-01   +1.184879781458904e-03   +2.726330451702417e-01   -1.719372986930214e-01   +5.513354864503134e-02   -3.140671453029232e-01   +5.979065568507394e-02   +1.364539962932939e-01   -1.003851639818239e-02; -2.001394471608130e-01   +1.285720614615204e-01   -7.042571615508697e-02   -6.800118407979314e-02   +7.917891506969466e-02   +6.016354572645158e-02   +2.525858549599251e-01   +9.266184715289738e-02   +1.130067672102672e-02   +9.656639191737294e-02   +3.566864616188167e-01   +6.871252241473866e-02   +1.463382590514872e-01   +3.476576330896572e-01   +9.969922114108622e-02   -2.403737944334354e-01; +4.270607286853374e-02   -6.565271878360732e-02   +3.070348400340080e-01   -1.618794440292234e-01   +7.253695401605378e-03   -8.827928118563733e-02   +1.775916506931587e-01   -1.078918392280465e-01   +8.494211306971439e-02   +8.379785243836649e-02   +5.306891190732535e-03   +7.807701560472285e-02   +1.790802587323724e-01   -1.186901447368841e-01   +1.762962827037737e-01   +3.120372684637893e-01; +1.769573344483769e-02   +1.033864392818416e-01   +1.946780485893483e-01   +2.514273615238735e-02   -1.094913833057318e-01   -2.727776729425051e-01   -4.937246666374476e-03   +3.160535641683059e-01   -3.544375189018580e-02   -2.716415840578883e-01   -1.303260497268111e-01   -1.137702810423059e-01   +9.649585087632070e-03   +1.521063006731938e-01   -1.791318179353004e-01   -4.049687851092393e-02; +1.830758794854003e-01   -6.537701030907625e-02   -9.374981961612977e-02   +2.097378885696407e-01   -3.180156261699401e-01   +4.451669246540489e-01   -2.871113342751986e-02   +4.679205603977825e-02   -2.163712608213314e-01   -1.527019719440478e-01   +1.866661005347542e-01   +7.813881503273573e-02   -1.925072216946214e-01   -1.287217508857640e-01   -5.972315274767853e-02   -2.683209299159238e-01; -1.650750525746356e-01   +4.163358981811924e-01   +2.830775994963632e-01   -1.871841596229682e-01   -8.104636413107637e-02   -3.411173747781789e-01   -1.928032551943603e-01   +8.051594435377828e-02   -3.051705862565477e-01   +2.009314374338820e-01   -6.066296224688433e-02   -3.225364402350146e-01   +1.687217550551479e-01   +1.802377070174255e-01   -1.761082820754252e-01   +8.045478239071580e-02];
L2E_L1E_iAMPA_netcon = [+1.214917600372295e-01   -2.769170928664920e-01   -2.198436943975499e-02   +1.097059495833757e-01   +1.222856302544435e-03   -2.554414844147701e-01   +8.556512254880257e-02   -2.840206015793089e-01; +4.825100434563044e-02   -3.313919809216722e-01   -3.047357800210136e-01   +1.016108083436650e-01   +3.996047694524434e-01   +1.275539004934637e-01   -6.559565654427102e-02   +1.038186670792390e-01; +1.295092715628451e-02   +9.448600021160998e-02   -3.083728247996478e-01   -1.047646933234501e-01   -2.965304141545561e-01   +1.507777119547982e-02   -3.277417753501921e-01   -1.885216421643887e-01; +2.596846625049605e-01   +5.518041758952699e-02   +2.832628596325233e-01   -1.407686778104417e-01   +3.291316955173970e-02   +8.793500366524183e-02   +8.358284983477593e-02   +9.694691767999015e-02; -2.476193968022442e-02   -2.932530827090510e-01   +2.509079468577884e-01   +4.734044981787758e-02   +3.624591835453105e-01   -3.582926827912673e-01   -1.523748567989490e-01   +2.946276326595518e-02; -3.083951140359172e-01   -8.346273097228912e-02   -1.611729685754880e-01   +5.266725573989017e-01   +3.316375903437898e-01   +2.444833873017239e-01   +2.033181041532687e-01   +4.251532486936451e-01; -7.426838593249091e-02   -1.767542686704094e-01   -3.536063291236509e-01   -3.471948911660311e-01   +2.523817201780987e-01   +1.999018661497272e-01   -5.302820253245673e-02   +5.429572036013161e-02; -9.492479829202011e-02   +1.769635429898321e-01   -7.413477252053102e-03   -1.421521022575372e-01   -2.151672732539031e-01   -2.058063055956418e-01   -9.344530339695206e-03   -6.589617322530589e-02; -1.754750614467017e-01   -3.570349698349802e-01   -2.346912060652051e-02   -9.305749403233309e-02   -3.730154249852735e-03   -9.863535019054491e-02   +9.780943397818903e-02   +1.344910292412075e-01; +2.947181930850704e-03   +1.454394683388941e-01   -2.096730649783095e-02   -8.154109471466629e-02   -4.785047264620553e-01   -2.176319034517493e-02   -2.587373934437447e-01   -1.941565568308798e-01; -4.717158924488027e-02   +1.835397811488968e-01   -1.455447392166292e-02   -1.927361988073105e-01   +7.411248509713608e-02   +1.642968789174564e-01   +4.283490003421009e-01   +1.917916995093563e-02; -9.749763470218382e-02   -4.074247978073903e-01   -1.182586345987019e-01   -3.498485956486689e-01   -2.156725117438588e-01   +2.755385287647422e-02   +1.880062933063931e-01   +3.149093714533210e-01; +4.201009563702478e-02   +1.949000176137220e-01   -1.896090800525187e-01   +2.083531696747513e-01   +3.373056890886530e-01   +9.114783596941549e-02   +1.909265963064272e-01   -2.381569548364885e-01; +6.414743340498517e-02   -2.846671631276707e-01   -1.725713779086896e-01   +2.331608490216540e-03   -2.193789996961632e-01   -9.710904405266933e-02   -1.346739067875171e-01   +1.868371844067860e-01; -1.049476357348031e-01   -1.314616789115531e-01   -4.632631346329846e-02   +8.221609886100295e-02   -1.131820824234753e-01   -1.138612862839555e-01   -3.805826902003598e-01   +4.378555201743546e-02; -2.005999534934348e-01   -5.438282169958081e-02   +3.407814461162644e-01   +7.197321747802031e-02   -4.159185808861557e-02   -3.763688791414437e-01   +1.575818105225265e-01   +7.689065727738037e-02];
L1E_L2E_iAMPA_netcon = [-7.104038214575886e-02   -1.722286202126999e-01   -2.679934509564494e-01   -3.376885394909566e-01   -1.297809243780662e-01   -2.520205168584284e-01   -2.175947664084695e-01   -1.202336992630861e-01   +1.840447008227440e-01   -1.354575914126703e-01   -9.602265584181796e-02   +1.068893231885808e-01   +2.702457632642988e-01   +3.666510713618052e-01   -6.356370009826202e-02   +1.307464666518748e-01; +8.039813698393183e-02   +4.112900550308253e-01   -2.390065461637313e-01   -3.930945937569147e-02   +2.594610325568428e-01   +7.014313008295067e-02   +5.504189861425363e-02   +1.098817674299229e-01   +1.880259544761169e-01   -1.429931202069925e-01   -8.961258513383009e-02   +2.695559127766324e-01   +2.877556630097033e-01   -4.030756309215106e-01   +2.572855382689642e-01   -9.363718223412754e-03; -1.856198988838803e-01   -2.122298728013028e-02   +1.108647535434575e-02   +4.888917599529768e-02   +1.700044699207837e-01   +2.704605932087655e-01   +1.342013871888818e-01   -4.955286899332703e-02   -1.783911956407015e-01   +1.091658932197504e-01   -8.630501508916519e-02   +1.176260001416001e-01   -2.842189659595368e-01   -1.278561709265203e-01   +3.591385221226908e-01   -1.992404340189815e-01; +3.052897196320031e-01   -2.782668461789373e-01   -2.090206603511116e-01   -3.771999284886315e-01   +1.528536010849025e-01   -9.844498225274730e-03   +1.414137458384538e-01   -1.231107465484443e-01   -2.541621465036411e-01   -2.953155643422504e-01   -1.533174042282962e-01   +8.951306479412363e-02   +1.071006298939265e-01   -5.949452357165763e-02   +1.494938332316560e-01   -2.502511228180928e-01; +2.037247216666263e-01   +2.227348376898548e-01   -2.533565173622017e-01   +4.376980829221236e-01   +2.500297238033272e-01   +2.931696171376293e-01   -2.537421011097091e-01   -3.021974842912105e-02   -6.743010161807098e-02   -7.000522030979088e-02   +3.043653780097562e-01   +3.881938998675494e-01   -3.835961462271725e-02   +1.204157156790497e-01   -2.544106559646782e-01   +1.044096128322034e-01; -8.076556273736676e-02   +5.619826096060945e-03   -2.733213898177539e-01   -5.597415307529350e-02   -3.107029529548443e-01   -5.312153361880768e-02   +1.313405002944907e-01   +6.180571420840328e-02   -3.462114174078880e-01   -9.495521096555706e-02   +6.383533342508790e-02   +1.074392876531480e-02   -2.678227879970844e-01   -2.645608492975320e-01   +3.513409818299346e-01   +1.018146807093266e-01; +3.227767737751794e-01   -1.189767821861761e-01   +1.244866939107776e-01   -2.877308581760197e-01   +4.362059938360047e-01   +1.599400729616944e-01   -2.711972030779437e-01   -3.052301348896671e-01   +9.320612104410106e-02   -3.841423988536283e-01   -3.261081410197985e-01   +9.194118055427421e-02   +5.792843254467922e-02   +5.180020124721274e-02   +2.063115100991860e-01   +1.590280803697830e-01; -1.858633326657647e-01   +4.969316436940674e-02   +2.117774835924191e-01   -1.071173748789619e-01   +2.694955529628574e-01   -2.020660304837214e-01   +1.364029319006539e-01   -3.051530915287668e-01   +2.461991607568863e-01   -1.904087233588987e-01   +8.286498401594483e-03   +1.852038997185033e-01   -6.864301902508860e-02   -2.671474239482136e-01   +4.508555618443349e-01   -2.320635358371158e-01];
L2I_L2E_iAMPA_netcon = [-3.163219341306293e-01   +7.868840457764537e-04   -1.164159990969554e-01   -2.006490390802416e-01   -2.449735821382517e-01   +1.554229446404351e-01   -1.747404652479392e-01   -1.904173600256261e-01; +5.810785978503692e-02   -2.214569665005967e-03   +1.438826884383427e-01   -2.185943863667758e-01   -4.100856129501147e-01   +2.478089306646303e-02   +2.195876140302839e-01   +5.857521288595588e-02; +3.003531347117873e-01   +2.802843158549023e-01   -2.384146933357089e-01   +7.930519385971598e-02   -4.401854288922587e-01   -7.942706280501827e-02   +4.019144122241685e-01   -7.243125999689624e-02; +6.512837469840685e-02   +5.885246071454940e-02   -1.849475979653502e-01   +3.068168619893470e-01   +5.969640405108825e-02   +1.863359675652289e-01   -1.538929234135788e-01   -2.720786141408886e-01; -7.170043047422515e-02   +3.213371677503474e-02   -1.453912967286793e-01   +2.769140889554064e-01   +1.207012719420950e-01   -8.984367650462764e-02   +1.563504137901688e-01   +1.171062741792097e-01; -4.618358471273848e-01   -7.095945806420897e-02   +1.460304414863074e-01   +1.961849177871267e-01   +2.996166905145645e-01   -2.302172378835412e-01   +2.131196806829837e-02   -2.895374371324079e-01; -1.244492769748467e-01   -1.315593256743541e-01   -1.373323178844618e-01   -2.089952191784175e-02   -2.700957377719886e-01   -1.193607028038908e-01   -1.623194597895787e-01   +1.084643575451055e-01; -2.465263896974065e-02   +2.368258606039363e-01   -1.208690585865487e-01   +4.200724847276562e-01   -2.506117248204663e-02   +1.442111652124936e-01   -6.619670742928799e-02   +2.092869145964439e-01];
L2E_L2I_iGABA_netcon = [-1.715584346815288e-01   +1.303347122880325e-01   +6.897380179707817e-02   +1.269926167145352e-01   +1.974395246414997e-01   +2.725256148366910e-01   -1.473599004024403e-01   +2.528673619522723e-01; -1.671470436517347e-01   +5.646629899927624e-02   +3.102027925659742e-01   +3.202784338677620e-01   +1.417663180355669e-01   +2.706332956357749e-03   +2.514635308969393e-02   +1.231130943654889e-01; -1.738201108072426e-01   +2.511556909403714e-01   -2.953600449595460e-01   +8.087581665226755e-02   -2.133128220592159e-01   +1.869496855551134e-01   +1.768170319219662e-01   +1.033412647229514e-01; -1.465307380282283e-01   -4.234443087544298e-02   -3.163746750615181e-01   +1.287014227909076e-01   +2.208108815459992e-01   +3.826762553637688e-01   -4.445604698894056e-01   +1.832949757742400e-01; +2.692946300573941e-01   +4.155248075652860e-01   +1.214712085924963e-01   -2.347876917186920e-01   -1.187600740622612e-01   +4.134525830897695e-02   +3.722800925581133e-01   -6.138938088998708e-03; +2.415936687808679e-01   +2.379031947199449e-01   -3.533591231179355e-01   -3.265937412607495e-02   +3.616625051029794e-01   -2.645722472463981e-02   +2.930846676173972e-01   +2.902608474508099e-01; -2.521238936659611e-01   -5.675614830867233e-01   +1.088001897817063e-01   +2.961107033525037e-02   +1.967192065046888e-01   -2.413488843453164e-01   +2.992510693532842e-02   -2.581266197531329e-01; +2.192037576650786e-02   +6.538132051844892e-02   -4.541690483871778e-02   +2.042498565479592e-01   -5.656521783501547e-02   +8.675206507710626e-02   +1.128941392231833e-01   -1.255610505979029e-01];
L3E_L2E_iAMPA_netcon = [+7.620020271771910e-02   +4.412366449725763e-02   +1.356430878352271e-01   -1.420877049947124e-01   -1.766254920246608e-01   -2.016219150335374e-01   +6.403588343181141e-02   +1.249504143373868e-01   -1.115030373268850e-01   -7.741720865867346e-02   -2.129062569966773e-01   -1.988119872990022e-01; +2.777747755965209e-01   -4.324881266615127e-02   +3.397963049964350e-01   -1.142299109046981e-01   -2.178339779751784e-01   +4.027313753755069e-01   +9.112225321911084e-02   +1.785694612345455e-01   +2.256419199835919e-01   +2.808575218428220e-01   -2.042491458381799e-01   +2.238416543572988e-01; -3.570870395780007e-02   -1.228775815813824e-01   +8.920311644628207e-02   +3.620019185823552e-01   +1.400529577606265e-01   -2.229113468988312e-01   +5.968446178338163e-02   -1.667496783083796e-01   -1.516541093878142e-01   +6.101839798478693e-02   -1.759300255919029e-01   +7.497296857655011e-02; +2.033261647423490e-01   -1.208570383699346e-01   -3.894071742824829e-01   +6.248851050336139e-02   +5.570872416165103e-02   -2.841785357673842e-01   +1.373885467611335e-01   -1.772740300924187e-01   +2.136976927753146e-01   -2.040513709857990e-01   -2.762464222943584e-01   +1.693740612715251e-01; -9.629801123042638e-02   +2.997542992755729e-01   -2.299802132349869e-01   -2.509297634301924e-02   -1.032255477748831e-01   -1.091072481202683e-01   +2.352752837535252e-01   -4.268115104047619e-02   +3.193342080739239e-01   +2.376910217931991e-01   +1.862915031650924e-01   +4.745964972072897e-02; -1.170508563454395e-02   +1.218934473462479e-01   +2.393645467290574e-01   +2.862359761107000e-01   +1.809908047880419e-01   +6.461183236865704e-02   -1.876673906492922e-02   +5.385173864084870e-02   +5.007649445323405e-02   -2.212827209138759e-02   -4.969179674830399e-02   -1.355107621348807e-01; -1.984070143926189e-01   +3.356562023721046e-01   -2.071403697898080e-01   +1.664196381147760e-01   -2.547959731201650e-01   -1.373266284562399e-01   +5.762830589783302e-03   -1.388150204726570e-01   -2.274460274532099e-01   -9.643324172654771e-02   +6.528785308385721e-02   +1.379993953638803e-01; +2.815080415819778e-01   +3.285856543833267e-02   -4.245907265262742e-01   -2.494625147785075e-01   +3.296713858694619e-01   -1.347809149391627e-01   +2.503808515468148e-01   -2.766777646500122e-01   -2.599484285440741e-01   +1.708572946037255e-01   +3.407975284433387e-02   +1.515989362137913e-01];
L3I_L2I_iGABA_netcon = [+3.685337818435961e-01   +9.310238301870843e-02   +3.072854102287567e-01   +1.744182472091866e-01   -3.370124030190133e-01   -1.170209686847566e-01   +3.257547109363078e-01   -1.367633885435270e-01   -4.814606473957357e-02   -2.077405995010649e-01   +2.778724515355726e-01   +3.955527994402121e-02; -2.386561953397164e-02   -2.532435500775657e-01   +1.416313682285594e-01   -1.057337962248092e-01   -2.771633238412416e-01   -1.882262716894482e-01   -2.639597659725297e-01   +1.878414826335014e-01   -6.389330673077975e-02   +7.976857550697926e-02   -2.400169352031976e-01   +1.335848246703476e-01; +3.100776006183610e-01   +1.644149009938520e-01   -2.202371405031626e-02   +3.482379210283747e-01   +3.653409236657345e-02   +2.534472114843205e-01   -1.952384278477456e-01   -2.396622439745840e-01   +1.581666048871520e-01   -1.201863983470357e-01   +2.537077370293392e-03   +1.826807039575031e-01; +3.463362197537952e-01   -2.272802302510972e-01   -1.813183260955176e-02   +2.421802737120319e-02   -1.804639622947012e-01   -1.344666551332363e-01   -2.996894568723983e-01   -6.584766173731340e-03   +1.369204570580818e-03   +2.035091237906777e-01   -7.760730026232936e-02   -4.508931069594198e-01; +2.492220856299497e-01   -1.197868294121898e-01   -1.110411111139987e-01   -2.952836945133374e-01   +4.672327646892166e-02   +7.968560179309463e-02   +2.720901970069480e-01   +1.175732868558155e-01   +4.628838193958641e-01   +8.911129714088115e-02   -2.029343285002592e-01   +1.121263841725107e-01; -2.520628655259655e-01   -2.954147088213631e-01   +1.259557530935770e-01   -4.301211735809010e-02   -8.125297119038263e-02   +3.273572541347977e-01   +8.986911822873284e-02   +1.420171156104021e-01   -3.196771615951918e-01   -1.496157030827149e-01   -2.984457426186465e-01   +8.169461525610433e-03; +1.424894429869419e-01   +1.143481925170835e-01   -1.424684048299396e-01   +6.176048251449735e-02   -9.334455391344323e-02   -3.116017544052593e-02   -3.255627483602598e-01   +1.319345593367057e-01   +1.723921152904971e-01   +2.291213040302149e-01   -3.601538831492860e-01   +6.661498847816892e-02; +1.890897620398317e-01   -1.350965005409960e-03   -7.381360614369759e-02   -2.060469769195098e-01   -2.907823216367565e-02   -8.716344476386761e-02   -2.120935188152528e-02   +1.215953078702731e-01   +2.325383059166272e-01   +3.187550621294048e-01   -3.486502184906849e-01   +4.860021129970598e-02];
L2E_L3E_iAMPA_netcon = [+8.346415567851015e-02   -2.708019540517091e-01   +2.339329104263338e-01   -8.476307009277756e-02   +1.674643485262504e-01   +3.373628918757993e-01   -1.929462762456482e-01   +2.416725198356003e-01; +1.849152660483994e-01   +2.198628402812319e-03   +1.043503204887550e-01   -3.368529769484911e-01   -2.656921084152605e-01   -1.728931835022993e-02   -1.732089652056091e-01   +8.708675471039728e-02; +1.228459309089518e-01   +2.899260073400943e-01   +5.371036519934791e-02   -1.430108661296370e-01   -2.129576755301125e-01   -3.279072424570068e-01   -1.465100289623344e-01   -1.672608691180091e-01; -1.080757757789198e-01   +1.706279904567099e-01   +8.359401590057575e-03   -2.440214295319509e-02   -1.714975158133591e-01   +7.994052569281114e-02   -2.225853345292775e-01   +2.983025790863161e-01; -7.664303797874039e-02   +1.386301854835536e-01   +1.229699606721017e-01   -2.208414218821106e-01   +1.130345175432205e-01   +5.187496421912817e-02   -2.837660321572649e-01   +1.412812273453980e-01; -2.246878226155641e-01   -5.573096457587248e-02   +1.937584350520039e-01   +4.270751336077977e-02   -1.534294695583245e-02   -1.527726283008762e-01   -1.638317762606517e-01   -1.966660124782563e-01; -5.521422786429932e-02   -1.321887061207645e-01   -6.427998211277970e-02   +2.450971218110172e-01   +3.033739912811884e-01   -1.396802993700532e-01   +3.676723204428626e-01   -4.056509490270231e-01; +4.527004242143742e-01   -6.774814632614817e-02   -3.146980520818502e-02   +1.394352237352044e-01   +3.244495183159421e-01   +5.097386641107014e-02   +1.289872358906184e-01   +2.283385395755246e-01; +4.056584232809358e-01   +1.664028973440587e-01   -1.057726111386509e-01   +1.024800343376115e-01   +4.053591983335330e-01   -1.761190151658800e-01   -2.654219460517189e-01   -3.630265354316824e-01; +2.943435641892496e-01   +6.726142850732282e-02   +1.026456160854014e-01   +2.784518822117285e-01   -3.312282889433770e-01   +1.323453593181145e-02   +1.485888369369124e-01   +2.463065391449846e-01; -2.596459668068222e-01   -1.468656940131616e-01   -2.549612211848594e-01   +1.723263003765476e-01   -1.683750843337375e-01   -1.081043759905713e-02   +9.902012250264253e-02   -2.760951685334820e-01; -9.593440328512728e-02   -2.864586702274147e-01   -2.351686963320637e-01   -2.449613628088548e-02   +3.582792369938741e-02   -3.167656549288619e-02   +4.330366321760734e-02   +3.146211060921109e-01];
L2I_L3I_iGABA_netcon = [-2.020082570125711e-01   +4.227726271522964e-02   -4.508347201136809e-02   +3.653655807451086e-01   +2.974685761676432e-01   -9.635895642295463e-02   -3.601811554533070e-01   -5.388494043570723e-02; -1.861242750918253e-01   +1.476293869906808e-01   +2.414754626372729e-01   -1.013317901980488e-01   +2.315997887014163e-01   -1.055151383258606e-01   -3.746116218324715e-02   -1.865008702136178e-01; +2.810754630324935e-01   -3.098414545305352e-01   -2.520471767341750e-01   +3.233440249976023e-02   +4.040659793107064e-02   +6.352966918090945e-02   +3.322646051902364e-01   -1.871502020639639e-01; +1.683284903031746e-01   -1.759754852149676e-01   +1.915930907518187e-01   +2.492621820132179e-01   -5.996465421872131e-02   +3.137319680615737e-01   -3.065560057860781e-01   +2.610110213344154e-01; -1.798581021821861e-01   +1.279077907755987e-01   +1.104130965041486e-01   -2.151442568103742e-02   -8.536284602346438e-02   +3.307403549208288e-02   +1.016419195604981e-02   +4.243898159828291e-02; +8.699994459044050e-02   +2.438229643346000e-02   -5.875019756580863e-02   -1.098743516379384e-01   -2.967868995096668e-01   -1.140218223167379e-01   -1.718014072375969e-01   -1.367776878704222e-01; -7.223070166726507e-02   +3.448331878623881e-01   -2.779498540918570e-01   +5.955196199455301e-02   +2.881645722222453e-01   -4.180025225667925e-02   -3.097404473014415e-02   -1.660501473887738e-01; +1.864249348907876e-02   +1.895914592844502e-01   +1.285699840987899e-02   +1.591703540076677e-01   +2.250005482829283e-01   +1.255380707397642e-01   +1.384649647403773e-02   -1.773968961911067e-02; +1.876927882932543e-02   -4.588263834800494e-01   -1.840775366418583e-01   -2.616551308054244e-03   -1.686602027319600e-01   +2.832569624110202e-01   -1.752481836440731e-01   +2.917832391355040e-01; +3.288324470958230e-01   -1.089396678295079e-01   +1.372029186282358e-01   -9.911779481576087e-03   +2.014117102884450e-01   +1.841817531969351e-01   +5.746057016141696e-02   +1.568555228985770e-01; +4.730124172860002e-02   +2.722584357619497e-01   +2.586532692547790e-01   -7.242048509146543e-02   -5.650000889452550e-02   +5.384091167458419e-02   +2.021438159738372e-01   +1.762630683203678e-02; -2.674038671450478e-01   -5.773669483249963e-02   +7.923310847485271e-02   -1.338857875974594e-01   +6.714524956149664e-02   -1.426422155145447e-01   +3.561172743619063e-01   -9.628918879397974e-02];
L3I_L3E_iAMPA_netcon = [+2.786664031645599e-01   -9.561916058425102e-02   -1.013154141477635e-01   +1.263687952910151e-01   -1.792969425772620e-01   +1.705033074382679e-02   -1.447735701091573e-01   +3.184254820161190e-01   -6.218622004540781e-02   -9.111802114730480e-02   +8.899791023451914e-02   -3.611972660047418e-01; -9.904615652618654e-02   -3.031036026291838e-01   -1.726159226903864e-01   -1.180786755087185e-01   -2.882157344373476e-01   -2.845874725061628e-01   -6.881092497471802e-02   -1.946228372047912e-01   +6.947022992016091e-02   -9.179053698238204e-02   +2.081322880241340e-01   +3.794085801112559e-02; +3.357440145169638e-01   +1.011165168820400e-01   -1.169435783187278e-01   +8.536914429912962e-02   +2.487189100147495e-01   +7.143476246996192e-02   +2.141160343607336e-01   +5.712264496683526e-01   +2.788914375186494e-01   -2.766251337796682e-01   -1.627898224963581e-02   +6.278479194193679e-03; +2.538438497446110e-01   +2.827845366970862e-01   +1.919210098458003e-01   -2.344545543659651e-01   -6.034450246200780e-02   +1.221357456633830e-01   -2.250577016055131e-01   +1.153436127896833e-01   -1.966859205657851e-01   -2.768041325824367e-01   +2.041618403803278e-01   +2.853253345134368e-01; -6.507463512941483e-02   +1.903593397231265e-01   -3.693573902862212e-01   +1.826831832100601e-02   -5.762744617418389e-02   -2.399654985624035e-01   -1.917941255624634e-01   +4.419296115459579e-02   -5.866676101628769e-02   +6.890680437572412e-02   -3.907158658873768e-01   -2.037437193271620e-01; -7.048678178951934e-02   +2.422705436094366e-01   +2.389886941023882e-02   +7.402600826153549e-02   -1.443520830911400e-01   +1.669128908774490e-01   +2.986472064885623e-02   -6.746659464251247e-03   -3.603610298308886e-01   -1.858325483929632e-01   +2.534483334149175e-01   +3.235553287428313e-01; +3.051702821571587e-01   +1.680520726253811e-01   +1.787406111786398e-01   -3.185703474293651e-01   -1.671607942779159e-01   -1.030194480472044e-01   -1.617217081762531e-01   +2.292177075254764e-01   +1.456205961071994e-01   -3.896323231791254e-01   +1.121916436586367e-01   -4.564832789950390e-01; -7.872822688256506e-02   -2.492972764736398e-01   +1.020754654736601e-01   +3.287597851485617e-01   -1.090228629697051e-01   +1.407524205944543e-02   -3.400971346699547e-01   -1.450621575820586e-01   +4.463616988983289e-01   +2.702107850002456e-01   -1.477885255799068e-01   -1.850568145501865e-01; -1.784579387966062e-02   -1.495081494391673e-01   +8.201641723742920e-02   -2.728198236842304e-01   -1.349054827311028e-01   +6.715703657429270e-02   -2.607857229524623e-01   +1.433226837399542e-01   -7.316933239672044e-03   +3.503504608995396e-02   +2.333421848162716e-01   -2.791633813158598e-02; +1.724183657618741e-01   -3.190366016000530e-01   +4.801458644558841e-02   +5.753280749421290e-02   +4.393457900597700e-01   +2.089894105481496e-01   -4.548229066867758e-01   +1.358426002667740e-02   -9.194620631960539e-02   +1.760923180142291e-01   -2.096725770285024e-01   +3.598190413038929e-01; -1.682817651407418e-01   -2.512690605427615e-01   -4.163531368886279e-01   -1.402215998293140e-01   -8.716201229058129e-02   -2.311320759202717e-02   +2.656987674944573e-01   +3.105406944725478e-01   -1.775393507443086e-01   +1.287321528548492e-01   +2.316643332312801e-01   -6.121001657219832e-02; -1.715115473952766e-01   +2.369074982462280e-01   -1.468203268586836e-01   +2.117544715243816e-01   -1.502092858152995e-01   +1.297806817872983e-01   +9.559195570452705e-02   -1.247545838285327e-01   +4.299605369080028e-01   +9.217367350217195e-02   +8.213861679152282e-02   -6.244710503364391e-02];
L3E_L3I_iGABA_netcon = [+1.261018794015755e-01   -2.509548868733691e-01   +9.892557513458992e-02   -1.590573253420551e-01   -1.865570253746803e-01   -2.767508649079066e-01   -1.223130129583206e-01   -3.088402604736668e-01   +2.674695885719010e-02   -2.981784472217756e-01   +2.228056677837327e-01   -6.410224174454783e-02; -1.854593745490530e-01   +1.411981851195355e-01   -3.269776870986364e-02   -2.345840187680293e-02   +5.799429539052015e-02   -2.558455874265583e-01   -1.334405897827711e-01   -3.332596411344172e-01   -2.700699607786944e-01   -3.364161702205789e-01   +1.898843460545799e-01   -3.459281495832436e-01; +4.939310217406140e-02   +2.453563544250389e-01   +3.448862319442994e-02   -1.966116693547010e-01   +3.116121313521567e-01   +4.308293656225571e-01   -7.469137403948563e-02   -3.508025762447277e-01   -2.826123279116090e-01   -1.291911007624443e-01   +3.128680687333605e-01   -1.551990210963406e-01; +4.851291387840037e-01   -2.167969001970199e-02   +2.896033035045222e-01   +1.822136392644075e-02   -8.889530136849430e-02   +1.162722236154508e-01   -1.215849285556630e-01   +3.598669187849983e-02   -1.601865906006296e-01   -2.408475715935854e-01   -9.262374249789046e-02   -3.929431226594396e-02; -2.431180551589658e-01   +8.670496967822751e-02   -6.582608428176387e-02   +9.342330381253187e-02   +2.240369861591739e-01   -1.975013938431321e-01   -2.535926299680834e-01   +8.413586519526148e-02   +3.503287721417527e-01   +5.518270948611662e-02   +2.359309365863406e-01   -6.354174961878604e-02; -5.310393790850463e-02   +2.826294127000964e-01   -3.847991238441887e-01   +1.989790267798263e-01   -3.693913754013556e-02   +4.260924334580445e-01   -9.129113999211372e-02   +1.948434162972106e-01   +2.123064756686753e-02   -3.731093481552355e-01   +8.557106275144249e-03   -1.922716606058575e-02; +5.749168899943147e-02   -7.943914159801106e-03   +2.638540392926906e-01   +8.813752287037760e-02   -8.033897851925745e-02   -3.504913297257225e-01   -2.097603122230905e-01   -4.853554090810841e-03   -4.373359368068952e-01   -2.309546773657820e-02   -3.035606612320554e-01   -7.932430380746358e-02; +2.812474950729799e-02   +8.851679527071395e-02   +1.124746173156992e-01   +2.250702837517725e-01   -2.684143002631870e-02   +1.451204376795777e-02   +3.872772204140712e-02   +3.776771826337671e-02   +6.705144612713097e-02   -6.978765220840860e-02   +3.821224829557468e-01   -2.155181304931658e-01; +6.221812858609950e-02   +2.768130382536606e-02   -3.350722499667439e-01   -3.267848274236168e-01   -4.673711650646992e-03   +3.518104908302370e-01   +3.026549780210364e-01   -3.191680176698005e-01   +1.290632728490898e-01   +1.168047471403323e-01   -2.640500255365817e-01   +1.939841720075707e-01; +4.147521666908649e-01   +1.252333131390527e-01   +2.087738000867906e-01   -1.600875416489443e-01   -3.107469738909674e-01   -9.005997555277892e-02   -4.770966816761807e-02   +2.039794831763849e-01   +1.453900571103701e-01   -1.438494977803624e-01   -4.481403045159313e-02   +7.670457274528572e-02; +2.115523816993694e-01   -7.569410984890422e-02   -1.576441583913722e-01   -4.672180484929123e-02   -7.884784338552159e-02   -1.991833716603283e-01   +3.516295699155644e-01   -2.592093935051982e-01   -2.969855378497144e-01   +2.470859876280464e-01   +1.760419565546148e-01   -1.938537920770886e-01; +1.534676666840761e-01   -4.302540243929206e-01   +9.471138348448478e-02   +2.560008109671837e-01   -3.753227319361027e-02   +2.207991115431503e-01   -2.960924696684252e-01   +3.323419303481563e-01   +3.869497464990592e-01   -3.498040246914058e-01   +2.653097165958093e-01   +3.461334290699012e-01];
L2E_Input1_iAMPA_netcon = [-6.922325088213191e-02   +7.784972717842166e-02   -1.046998701590412e-01   -1.802636665195138e-01   -2.417310198702901e-01   +2.807711691274273e-01   -3.291889171607759e-01   +1.053496903865872e-01];
L2I_Input2_iAMPA_netcon = [+9.356709390982845e-02   -1.642153724753882e-01   +5.017578510147676e-02   +1.239553890169965e-01   -1.155850922308829e-01   -7.373665480243305e-04   -5.449378991969094e-01   +3.723723026910567e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
