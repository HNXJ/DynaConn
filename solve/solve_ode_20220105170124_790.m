function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.247862767817262e-01   +4.215208060875693e-01   +5.307147014939489e-01   +6.369134105815580e-01   +5.988969264563218e-01   +3.416485565197162e-01   +6.475260425926309e-01   +8.395265106395444e-01   +5.444682000793625e-01   +1.924646755504437e-01   +4.564748225172732e-02   +8.224436490287357e-01   +7.678873656528634e-01   +1.108052835524010e-01   -9.441159867569112e-04   +8.410479396845932e-02; +9.819817536411490e-01   +9.635537256174109e-02   +3.243553036294534e-01   +9.561942726653201e-01   +3.871520047247699e-01   +6.069640172106670e-01   +6.787473245265231e-01   +8.316424968267372e-01   +7.225650771609545e-01   +1.386849298240325e-01   +7.531582727508969e-01   +4.299064583822622e-01   +1.666916016600200e-01   +1.359397731496093e-01   +8.651875874959502e-01   +6.283696707347135e-01; +7.313237688782847e-01   +5.983055064735423e-01   +1.045073062397800e-01   +2.406573144536590e-01   +9.150446769459941e-01   +1.918744363603661e-01   +6.347365731878720e-01   +2.542513476776573e-01   +5.209505911954699e-01   +6.974170893057202e-01   +2.412528414906369e-01   +8.870798631844840e-01   +8.622266024869339e-01   +6.787591895420764e-01   +6.125503985805243e-01   +6.615874296456614e-01; +3.444014618587277e-01   +4.735373426688384e-01   +6.111961930112721e-01   +6.764982183635568e-01   +1.929372520102638e-03   +7.403634441392596e-01   +9.456197688272621e-01   +6.137980495790312e-01   +9.935540847562943e-01   +9.095963753907173e-02   +4.430825554962388e-01   +3.913032130820320e-01   +9.897507098480152e-01   +4.945176639922001e-01   +9.895074422567279e-01   +7.297885876931103e-01; +5.855899412222628e-01   +6.953760837308385e-01   +7.804125832385763e-01   +2.869052262200075e-01   +4.628127919180753e-01   +2.421060862814804e-01   +2.089451507422711e-01   +5.827054249562841e-01   +2.205753555304112e-01   +5.245032139811582e-01   +6.864748872665121e-01   +7.702995023553391e-01   +5.158508620926947e-01   +1.882230719236304e-01   +5.259627787325957e-01   +8.916200767312915e-01; +1.087956637582037e-01   +7.004852485663501e-01   +4.223454953430104e-01   +6.708081175868988e-01   +4.255781488513335e-01   +9.184508321692076e-01   +7.085055779978283e-01   +5.406989827983781e-01   +1.045344407700119e-01   +5.316293623191028e-01   +3.586106708754817e-01   +3.965103656236049e-01   +8.834883352992310e-01   +4.946524324186851e-01   +4.818233542718937e-01   +9.828954454536901e-01; +9.062319112558612e-01   +6.400304460132977e-01   +9.165043819255075e-02   +6.941313063625620e-01   +4.613679325712527e-01   +2.696571727441739e-01   +2.370024718854282e-01   +8.705406050746735e-01   +1.107425836445319e-01   +8.625858662588755e-01   +7.369554046035705e-01   +8.097828714430565e-01   +5.876382744459604e-01   +1.480938676947264e-01   +8.033419706260213e-01   +7.692720410148171e-01; +8.817207464118122e-01   +3.164473704204908e-02   +2.638470977989554e-01   +6.597051591955072e-02   +7.711555005456674e-01   +7.651968365311450e-01   +1.190111144849641e-01   +2.651808330138480e-01   +6.633278883724397e-02   +4.841562049541583e-01   +3.946878864994565e-01   +7.556288173846568e-01   +1.552754599823188e-01   +5.359285534551055e-02   +2.291762452504849e-01   +5.819630192143344e-01; +8.171954418663319e-01   +6.835541085808583e-02   +1.523727562513926e-01   +2.523240475546171e-01   +3.243823439922964e-01   +1.901909772327984e-01   +6.074604714088466e-01   +3.149337011734796e-01   +4.035416684172155e-01   +3.932026513555086e-01   +6.854953115781847e-01   +3.766600715721771e-01   +1.993126449841990e-01   +8.515220089551767e-01   +4.970478503489721e-01   +9.255521209497917e-01; +2.593398982932839e-01   +3.191137836863497e-01   +2.815149130938442e-01   +2.212027679375179e-01   +7.840542435235436e-01   +2.868257413572349e-01   +4.521763510241613e-01   +1.189495806395770e-01   +4.473119116649494e-01   +6.719760537426654e-01   +7.030420562204519e-01   +2.174660188063033e-01   +4.067284722483333e-01   +5.614795029210101e-01   +8.983970111603656e-01   +5.808507357143057e-01; +5.935006699029329e-01   +5.301947203143351e-01   +4.414971034173005e-01   +6.688513497436015e-01   +4.702268496695154e-01   +9.111753265243040e-02   +4.594886348552604e-01   +9.393390024879928e-01   +3.652768730013524e-01   +7.420036979254845e-01   +4.410143061639745e-01   +7.902096241158159e-01   +7.482256952177181e-01   +9.308216733024037e-01   +5.761538841273238e-01   +1.678873085658417e-02; +2.170180023527866e-02   +6.539576496328849e-01   +5.253823505146586e-01   +8.446519367382114e-01   +3.753963909775913e-02   +5.769342052614815e-01   +6.620574023453840e-01   +6.465518504496167e-01   +7.626636320605819e-01   +5.192450130674853e-01   +1.744352059826179e-02   +9.501230733726839e-01   +8.239424501341003e-01   +6.985445905332894e-01   +8.431420164610446e-01   +1.212976286382795e-01; +4.252769039401215e-01   +4.067185121265196e-01   +4.588264465015012e-01   +3.447563969506531e-01   +1.767486217966238e-01   +6.831826437558163e-01   +7.693682207341388e-01   +4.806382637540375e-01   +6.259673646361502e-01   +3.445471813346388e-01   +3.298447105593684e-01   +3.285294846213562e-01   +7.916127193450276e-01   +5.842851400406243e-01   +7.397055773940215e-01   +8.622975680611321e-01; +3.120459238094253e-01   +8.195715382562059e-01   +8.749875910949237e-01   +7.819541705056657e-01   +7.202973820352834e-01   +5.468819633533453e-01   +3.506583140898401e-01   +6.397677131469411e-01   +7.714402308063751e-01   +1.485055952278637e-01   +4.236072599350397e-01   +6.725482707704782e-01   +3.207706092939924e-01   +8.150370599108913e-01   +5.859321900382174e-01   +4.839381920627346e-01; +1.596703200412299e-01   +7.190670885111796e-01   +5.178954707805453e-01   +6.771157295823139e-01   +4.726991877968038e-01   +4.252574383380782e-01   +6.621941307978800e-01   +5.446795912657469e-01   +9.326829185083562e-01   +5.856885682181650e-01   +2.696021351572824e-01   +4.386286600741258e-01   +5.333943728566278e-01   +8.804497048480897e-01   +2.445982007601238e-01   +8.449006591484773e-01; +1.773465188967117e-01   +9.690953224902712e-01   +9.450858263449720e-01   +6.978760172127290e-03   +1.534512482454691e-01   +6.431128805507345e-01   +4.165521846976339e-01   +6.474737597172923e-01   +9.730044530613999e-01   +2.608691370304708e-01   +1.960281078906891e-01   +8.328539513674180e-01   +9.128951711097233e-02   +9.893272614151248e-01   +6.647371375010621e-01   +2.083132701123676e-01];
L1E_L1I_iGABA_netcon = [+5.516733345083149e-01   +6.950637782728547e-01   +1.051119425722058e-01   +1.768277121109476e-01   +5.388894632713645e-02   +1.785292062564835e-01   +5.958964924697124e-01   +9.972724856392076e-01   +3.390092341222606e-01   +7.782965374338586e-01   +6.831025176561140e-01   +3.665200201869908e-01   +7.817859913313759e-01   +4.312507844773942e-01   +6.036427424196421e-02   +9.672341911958715e-02; +6.308594525757687e-01   +4.970237771627113e-01   +1.422137616826421e-01   +3.990854638401077e-01   +1.778365610245310e-01   +3.599481327135455e-01   +3.002397249218519e-01   +3.319420269572018e-01   +2.946361138131108e-01   +3.366821162288937e-01   +1.324238080292876e-01   +3.687179193967103e-01   +1.019201698955056e-01   +6.553423169203065e-01   +3.140310699420658e-01   +1.415233700381255e-01; +3.298805209624332e-02   +5.364364550610888e-01   +1.682330208575940e-01   +1.329300702102177e-01   +6.600633787219273e-01   +5.617280820505469e-02   +1.336647812229362e-01   +2.971566093033037e-01   +7.452083006108522e-01   +6.072827835014442e-01   +7.231150213481019e-01   +6.846600481423092e-01   +2.926558294281540e-01   +1.111575760580152e-01   +7.720617656190703e-01   +1.684656392888646e-01; +6.138471249268574e-01   +4.421335751753636e-01   +6.214707307569669e-01   +2.913255777811758e-02   +3.326662175900990e-01   +5.226361981389426e-01   +2.122623642095345e-01   +6.257068598207088e-02   +9.705802662614855e-03   +7.415444261536355e-01   +1.099403603184673e-01   +5.973337436428147e-01   +2.353837230981657e-01   +9.310334904274780e-01   +6.971299803957846e-01   +1.964636754913166e-01; +3.639874791887371e-01   +1.248746847138340e-01   +5.734801530233865e-01   +9.365975918934832e-01   +8.969237544779746e-01   +3.342939032806357e-01   +8.968617854973474e-01   +2.987742939724470e-01   +4.671072001791750e-02   +1.042927201899251e-01   +1.165228403166225e-01   +7.884027050523199e-01   +5.308362269834149e-01   +1.864627752602792e-01   +1.267842108449820e-01   +3.178556834170100e-01; +4.951654724291352e-02   +4.910155524489632e-01   +5.287733773971307e-02   +3.028251224226029e-01   +1.166359784916771e-01   +1.745386646835560e-01   +7.159882396921256e-02   +4.450539917523103e-02   +6.682597719092205e-01   +1.265010924273418e-01   +6.398452754442404e-01   +3.681936193661514e-01   +9.285463424986093e-02   +2.649763789730650e-01   +1.276259282154925e-01   +3.165874364397349e-01; +4.871436851554422e-01   +8.541885388751851e-01   +9.320759200185262e-01   +2.965631853910690e-01   +9.885274488935738e-01   +2.101176611408436e-01   +2.434621407568154e-01   +5.065030830717566e-01   +6.048526057831584e-01   +5.492217748782589e-01   +3.282075908556127e-01   +2.055692842057824e-01   +4.063865238483680e-01   +7.981209216348972e-01   +9.096185311017999e-02   +2.166092949985199e-01; +1.926438769991178e-01   +8.735239778869119e-01   +7.283354963877673e-01   +3.343336499497454e-01   +5.414706635256239e-01   +9.042012582928491e-01   +5.344871066566890e-02   +7.603334038468018e-01   +5.267299868820002e-01   +4.864126508000372e-01   +6.529340141250674e-01   +8.595179457890216e-02   +1.052958021487942e-01   +4.879131003822841e-01   +8.901653501319903e-03   +2.525543086624314e-01; +1.222527403996188e-01   +2.707940137268488e-01   +7.380162129357264e-01   +4.681303740596915e-01   +7.057272083078898e-01   +6.746910323265184e-01   +4.404258161980049e-01   +6.308315623015756e-01   +7.291362809149428e-01   +8.899320531443727e-01   +7.490408352517265e-01   +7.715240290753432e-01   +1.096614347042909e-01   +7.689446680188141e-01   +4.245674550291562e-01   +8.941167652175473e-01; +2.067858649178176e-01   +2.102535205228949e-01   +6.259933521012735e-02   +6.478193293092936e-01   +1.000000000000000e+00   +4.672821977691871e-01   +1.458704687487857e-02   +9.217153410076213e-02   +7.084788093550983e-01   +7.995154787607737e-01   +5.838965137996002e-01   +2.078826648555394e-01   +7.862002508942734e-01   +3.977342915002705e-01   +6.566704720248794e-01   +7.029345730120717e-01; +1.471173163777303e-01   +5.649888468291472e-01   +8.601527731826791e-01   +2.569008827334993e-02   +2.879744740666311e-01   +9.117144449059662e-01   +8.970619402860451e-01   +8.156010691641861e-02   +7.812045440030834e-01   +7.354556441016048e-01   +7.398811122648064e-01   +3.886647445925928e-01   +2.917982884426633e-01   +2.724923595695909e-01   +7.227738234626072e-01   +5.555295232835529e-01; +1.881630090849200e-01   +6.381288664693496e-01   +9.336243927929360e-01   +8.431489889537908e-01   +4.142562382406551e-01   +1.045867955624714e-01   +1.963830084197934e-01   +7.758454965941933e-01   +2.873356902033187e-01   +5.239200532222190e-02   +2.340812495097450e-01   +5.508538219462161e-01   +6.038859051411677e-01   +3.591128121537781e-02   +5.300645173846833e-01   +1.845613041710331e-01; +4.319337890821671e-02   +4.166479479425247e-01   +9.843883598874913e-01   +5.580781278327358e-01   +4.674511903094410e-01   +7.457007459125593e-01   +9.214573346515456e-02   +9.040630867391837e-01   +6.900878077360498e-01   +7.367595820922197e-02   +7.347795144254037e-01   +2.295940023271628e-01   +9.644890607670711e-01   +6.732765032193563e-01   +1.091394678674477e-01   +2.135790825671389e-01; +6.366589535133241e-01   +2.055518359359010e-01   +8.588859467361999e-01   +8.544784547311716e-01   +7.644396965412227e-01   +7.365269305306759e-01   +3.083145105979544e-01   +5.341122874701703e-01   +5.560961256575903e-01   +8.661041295990232e-02   +9.702302850070291e-01   +6.425117798184977e-01   +4.326756471252783e-01   +4.323806417726629e-01   +6.332962468950669e-01   +7.529213494793140e-02; +2.814427269502460e-01   +9.486601671555484e-01   +7.846835497727550e-01   +3.490302699168200e-01   +8.183129365281325e-01   +5.615254398180680e-01   +4.552476116771384e-01   +1.079498182155799e-01   +3.943114875618403e-01   +7.949794732920219e-01   +8.678971872977685e-01   +4.839434092819997e-01   +6.941166157149412e-01   +4.507836420081978e-01   +1.276928204829603e-01   +9.150782048695981e-01; +5.378817045584932e-01   +8.030687746995188e-02   +5.136479393883149e-01   +4.451978100147700e-01   +9.897682331490792e-02   +1.855013285917561e-01   +1.015961644665183e-01   +8.282355677767375e-01   +6.074509341540521e-02   +9.414219990940312e-01   +8.688606027016967e-02   +1.508256865679075e-01   +7.582617400481564e-01   +6.105190186142074e-01   +1.351731243578165e-01   +7.067689744561090e-01];
L2I_L1I_iGABA_netcon = [+5.578518484924979e-01   +1.580609921052471e-01   +4.225054447536266e-01   +6.839257577876062e-01   +8.070406909574460e-01   +7.940563169998467e-01   +7.875296360384358e-01   +2.773724141164481e-02; +3.132982972745072e-01   +7.595755681551341e-01   +4.308982987574804e-01   +4.643386670953060e-01   +7.468632431936170e-01   +5.769611405402789e-01   +8.513437502734693e-01   +4.207185041147880e-01; +1.666339232996176e-01   +8.698549054395452e-01   +1.250698801302773e-01   +2.140069584935942e-01   +1.191592921701769e-01   +4.397924725595421e-01   +5.066722598521526e-01   +1.831800755076844e-01; +6.216713891381184e-01   +3.502515257310601e-01   +2.474955082523888e-02   +9.786695573551649e-02   +5.261657156936557e-01   +2.568271593639346e-01   +6.343201825288572e-01   +7.276395642994721e-01; +9.872253476857229e-01   +6.856906163998904e-01   +2.903602768440779e-01   +8.232351438500717e-01   +3.248311577978497e-01   +7.528054771998491e-01   +9.518494527558518e-01   +3.705134518613166e-01; +1.721290921764609e-01   +2.937134823620858e-01   +3.195654923179221e-01   +1.745993122240535e-01   +5.463976755571109e-01   +2.292229687904844e-01   +4.447673273666494e-01   +8.411935234692207e-01; +2.581112551797656e-01   +5.292447856433394e-01   +6.527181755094714e-01   +1.651514307531046e-01   +3.999019577247388e-01   +6.592043625789161e-02   +5.922692760014979e-02   +7.343016237724966e-01; +3.970509431409315e-01   +8.329217182438796e-01   +9.565531451722229e-01   +6.683838758140596e-01   +4.158467851701389e-01   +7.650106226943920e-01   +8.680657253135132e-01   +5.697041550948708e-01; +7.418883703353923e-02   +5.984620636583978e-01   +9.379765026859640e-01   +8.947506822363509e-01   +1.799902719759271e-01   +6.716252755878637e-01   +6.301204142480334e-01   +1.770702834383074e-01; +6.856333967455045e-01   +3.355784423119467e-01   +4.578615712939680e-01   +5.153131751609831e-01   +2.561949309167967e-01   +7.145745760062259e-01   +3.534627197886329e-01   +9.588716551721144e-01; +4.047158258775574e-01   +2.985315793495398e-01   +2.399149044323751e-01   +7.023172727242016e-01   +2.014563495914921e-02   +6.424520371391562e-01   +9.975217067357876e-01   +2.652254457026795e-01; +9.822511533156272e-01   +4.528832969712650e-01   +7.651658649522971e-01   +1.514909804047462e-01   +9.224975686569161e-01   +4.205180128128793e-01   +2.254007261966477e-01   +9.254874485297098e-01; +4.020533166501111e-01   +4.228025492395557e-01   +7.591724034825944e-01   +9.529881893465454e-01   +6.550297924649899e-01   +3.904383941590668e-01   +6.525531590578126e-01   +2.203425342153964e-01; +6.215076312038540e-01   +3.590022556064304e-01   +7.410466758968595e-01   +5.392604208216920e-01   +9.342093257734990e-01   +8.160052387568223e-01   +6.044911835436282e-01   +3.719816849653899e-01; +1.554382487360361e-01   +5.611036113740844e-01   +7.442890720848169e-01   +6.824972159936398e-01   +1.635684291016099e-01   +3.164904288643451e-01   +3.883448936537701e-01   +8.791159767872066e-02; +3.811120178953943e-01   +7.431606091167767e-01   +1.091471736870920e-01   +3.625104832764627e-02   +9.215902936674979e-01   +8.160445441170331e-01   +1.411851374220879e-01   +6.420403640687362e-01];
L1I_L2I_iGABA_netcon = [+1.822523216585437e-01   +9.110783256671570e-01   +2.772525626933509e-01   +8.846268536637851e-02   +5.327481703441771e-01   +1.064647951945136e-01   +9.865488596914391e-01   +4.113090032749327e-01   +7.197284903541080e-01   +2.175448381608973e-01   +9.218133623851992e-01   +6.721661621428865e-01   +1.074869557286133e-01   +5.564341297875252e-01   +6.313766538885458e-01   +4.846375129810013e-01; +4.692075315898977e-02   +7.980013496361587e-01   +2.478820065552198e-01   +8.033261220986556e-01   +8.869291804915411e-01   +6.151550554002153e-01   +7.669914958817537e-01   +6.010226483565602e-01   +9.978000389655056e-01   +1.275526146414430e-01   +7.701196656780815e-01   +4.758588707171373e-01   +1.806377697621640e-01   +7.725991872374803e-01   +1.004198726929172e-01   +8.941194813142735e-01; +7.237705082867826e-01   +7.443374017848275e-01   +4.504866726227487e-01   +9.893954883437498e-01   +8.983766549909308e-01   +9.402332755311174e-01   +3.373669416364006e-01   +7.494325653553034e-01   +3.541073697825511e-01   +3.088937958798664e-01   +4.316301938308172e-02   +6.236746473789423e-01   +9.957809656201438e-02   +3.122138737245096e-01   +3.916394806208799e-01   +1.373200983799673e-01; +3.499735498079931e-01   +8.123650264072518e-01   +2.266236274591983e-01   +6.686748498854417e-02   +6.247697836401186e-01   +3.535044905662165e-01   +6.627538740668727e-01   +5.842001169710880e-01   +9.699179683503804e-01   +7.248091209620021e-01   +3.784703294267538e-01   +2.376867490005140e-01   +4.891289649866212e-01   +1.770132162672101e-01   +5.662516860091074e-02   +3.891074571508357e-01; +6.605242071377139e-01   +3.844246004942892e-01   +8.039289000379930e-01   +9.392413848423267e-01   +1.378986509486414e-01   +4.108039274560449e-01   +2.447411273079007e-01   +5.520912048023660e-01   +3.472173003891562e-01   +7.833306721270779e-01   +7.040558863561287e-01   +1.770699718624964e-01   +1.927573800536964e-01   +3.393740721026807e-01   +5.000290367305668e-01   +9.275695417573182e-01; +3.856699477853602e-01   +6.176796731316402e-01   +9.856858620123369e-01   +1.783094905396487e-02   +2.186340641192403e-01   +9.826641771147843e-01   +2.955121037659511e-01   +5.814838061101316e-01   +8.864462970353216e-01   +6.917463278156049e-01   +7.277956614808352e-01   +8.294022685990934e-01   +8.939899119028227e-01   +2.098689570877083e-01   +4.303624040514406e-01   +9.172897062008014e-01; +6.284107984934888e-01   +5.774057586076150e-01   +3.010154819734424e-02   +6.847907626588522e-01   +1.821570162102401e-01   +9.456614263118015e-01   +6.788284756419278e-01   +5.107029816877650e-01   +4.559946343321106e-01   +9.282236533382301e-03   +2.250974253865951e-01   +7.667338153773112e-01   +9.854636412468580e-02   +5.104753948766969e-01   +9.984101247990858e-01   +7.159561205852365e-01; +2.317723314906976e-02   +5.267335996023187e-01   +5.353443980667398e-01   +7.833371563532433e-01   +4.234386653667177e-02   +6.761448464542081e-01   +5.258626218720619e-01   +7.941339472627712e-02   +4.158708812489408e-01   +8.448853868551148e-01   +2.692080608266444e-01   +9.338578575165333e-01   +4.615925182005783e-02   +9.054007871951961e-01   +8.102022720845906e-01   +6.177931335320570e-01];
L2E_L1E_iAMPA_netcon = [+3.423781753565516e-01   +7.585936935694444e-01   +5.894864918397521e-01   +5.018142703499033e-01   +8.482104142417565e-02   +4.659008085909605e-02   +9.227658240456218e-01   +4.756154217154174e-01; +9.373273553974499e-01   +4.136486223369880e-01   +6.606798041752198e-01   +4.891808397992524e-01   +9.729775524168238e-01   +3.444215571239722e-01   +8.018960977040513e-01   +3.647532575662318e-01; +1.238194458520941e-01   +4.941141895153250e-01   +4.881841974866320e-02   +8.781322213881232e-01   +6.509970996712389e-01   +7.381382524310760e-01   +2.856465031697606e-01   +7.871094674220932e-01; +7.326295018052891e-01   +6.971869107006190e-01   +3.499797331490930e-01   +3.512205440641857e-01   +2.300121605196286e-01   +7.937989521603915e-01   +5.456168433184360e-01   +7.806926402931640e-01; +6.483585088007816e-01   +9.746408008432693e-01   +4.490896313836369e-01   +4.473252683820745e-01   +4.032041189686141e-01   +5.439968131341358e-01   +9.840112048762728e-01   +6.688103137855543e-01; +8.333203333753979e-01   +3.279543018785957e-01   +2.405317477792362e-01   +9.640511633010620e-01   +1.198145587292730e-01   +6.882132597072446e-01   +7.141312083980520e-01   +1.332190221218744e-01; +3.964472740856235e-01   +8.359589415961439e-01   +7.139715902435767e-01   +4.256766216405065e-02   +2.692418408726403e-01   +8.950220833134398e-01   +8.366114502404378e-01   +2.062043151786306e-02; +7.499498672458962e-01   +7.394085166340030e-01   +8.586535992058746e-01   +9.746618339986609e-01   +2.549833008209494e-01   +5.479137241535331e-02   +4.349092479100564e-01   +5.593958841911628e-01; +8.347830489837166e-01   +9.537169338448074e-01   +2.834920584015033e-01   +1.891603258627859e-01   +3.314109212577706e-01   +3.031495684121432e-01   +4.725193249704830e-01   +3.009353283246848e-01; +3.231882368663999e-01   +3.233265108867645e-02   +7.324622082635961e-01   +6.660779848960946e-01   +1.502710978513298e-01   +4.457145160730273e-02   +5.609420655149435e-01   +9.404743439321698e-01; +5.525388747843140e-01   +3.549204127865953e-01   +1.406736894080751e-01   +5.878503812003866e-01   +3.468925155308323e-01   +1.957492622976887e-01   +2.708915483999235e-01   +9.809426318380337e-01; +9.824177238559927e-01   +6.621048247860523e-01   +8.389124739369601e-01   +6.747024865997074e-01   +1.202566515892531e-01   +7.190706917274154e-01   +7.488681422722785e-01   +2.869916685995562e-01; +5.487001830134161e-01   +2.826667909608904e-01   +1.394310913946365e-01   +3.590402354936321e-01   +8.836376909393221e-01   +7.218768293775532e-01   +5.047287814115611e-01   +8.002685112964665e-01; +3.312952747215984e-01   +2.312995316553297e-01   +5.877467432474687e-01   +6.191764859761424e-01   +9.523564745014938e-02   +8.764498000258769e-01   +6.470558367246453e-01   +8.939331382281087e-01; +6.199729690596669e-01   +7.094827440764876e-01   +3.678494613421616e-01   +8.113151057539202e-01   +9.321961097082215e-01   +5.805996406569144e-01   +3.084495509395014e-01   +5.981638625449598e-01; +3.603400009268973e-01   +6.251361197244334e-01   +8.059763941021381e-01   +1.947231724722866e-02   +3.993878389729331e-01   +7.257457233941454e-02   +1.378910265545084e-01   +8.832936303981765e-01];
L1E_L2E_iAMPA_netcon = [+9.433863733332611e-01   +3.732068326433975e-01   +6.693094181532442e-01   +4.859075903136581e-01   +2.464159282052292e-01   +4.527853740479550e-01   +1.243347362941223e-01   +4.964435143727523e-01   +8.840447296456224e-01   +3.244998431687639e-01   +5.150991634176953e-01   +8.489982717232671e-02   +6.320214521461560e-01   +4.284691271900164e-01   +6.128971422766597e-01   +5.029638421507572e-01; +5.491911047733228e-01   +9.357459972031151e-01   +2.089673832826919e-01   +7.572212658263763e-01   +7.846438958611477e-01   +2.049465662205853e-01   +4.078616363740047e-01   +6.937349106133717e-01   +7.214813838306325e-01   +2.459344579899922e-01   +6.565471347703642e-01   +1.643253071757540e-01   +8.586349706679254e-01   +4.925627217777490e-01   +8.215641837320059e-01   +6.112122622144656e-01; +7.281567776762007e-01   +8.289487903609072e-01   +6.552866104236614e-01   +4.163277157169833e-01   +8.830804196991210e-01   +8.985693458460007e-01   +2.745836248474397e-01   +8.341995861533169e-01   +1.822695975486373e-02   +3.421169255177640e-01   +9.511328967091921e-01   +3.245303285426598e-01   +9.758982492004976e-01   +7.199398159305144e-02   +8.876032254071308e-01   +8.205292625229692e-01; +5.777673099065559e-01   +8.496053609327496e-01   +7.199887461277840e-02   +9.714036525366384e-01   +9.131081814594478e-01   +7.631013205520806e-01   +7.162182559878004e-01   +6.125160135981836e-01   +6.737215570443215e-01   +3.765491997722987e-01   +7.217986493326127e-01   +3.010834158731604e-01   +5.704040643622170e-01   +8.876330547470752e-01   +9.301891688541339e-01   +5.323726179182449e-01; +2.457054828316411e-02   +3.714844339829184e-01   +4.056993813988439e-01   +9.907346531474053e-01   +5.588381208266763e-01   +8.836692195404992e-01   +2.825766163818034e-01   +5.736930928049692e-01   +4.394481304945890e-01   +5.451070063037545e-01   +3.989936927308117e-01   +1.131502233759466e-02   +9.964625114333829e-01   +6.484025569548213e-02   +1.918205005979675e-01   +2.019065489605424e-01; +4.467126003001820e-01   +5.932439792601412e-01   +6.659023056528126e-01   +8.643922034059036e-01   +5.980986173006466e-01   +2.873825490625814e-01   +8.952297114501393e-01   +3.249426643356247e-01   +4.372907589562684e-01   +5.629429807396655e-01   +8.342965016646136e-01   +5.408732532706531e-01   +5.542917644398218e-01   +4.354724868804524e-01   +2.575955303061078e-01   +4.538980860707750e-01; +6.461558688091660e-01   +8.735336370443988e-01   +9.362644841704345e-01   +3.875511263240873e-01   +1.496909262914743e-01   +6.709983920026031e-01   +8.274808256749336e-01   +4.543774566545236e-01   +1.165293005801753e-01   +3.936973805580297e-01   +1.357897364310838e-01   +9.590258856454180e-02   +5.152196113019024e-01   +8.253491598285908e-01   +8.977984768069175e-01   +4.287470507523110e-01; +5.211277472600552e-01   +9.328946854064561e-01   +8.109329324384392e-01   +4.529152421601675e-01   +9.017396962390732e-01   +6.630151865240583e-01   +3.903494663327753e-01   +7.137621612599138e-01   +8.154737880437278e-01   +3.957144528705157e-01   +6.041576530526331e-02   +1.451474491622310e-01   +3.321390057935202e-01   +3.926602173916429e-01   +5.941474237993853e-01   +9.643236291270585e-01];
L2I_L2E_iAMPA_netcon = [+6.188454605846607e-01   +6.952852404216890e-01   +7.349020160491505e-01   +5.908662382451368e-01   +6.705285331805101e-01   +5.416021725610601e-02   +1.000748699262504e-01   +8.477120749839864e-01; +6.974758746083547e-01   +4.261233705747713e-01   +4.307676050873337e-01   +4.582404076861398e-01   +5.010398331268234e-01   +1.536398099436592e-01   +9.081993109559875e-01   +9.168829896839200e-01; +7.208073609345804e-01   +8.354844499459930e-01   +6.932830473679843e-01   +5.191844086286415e-02   +2.204366993270348e-01   +1.876000689895892e-02   +1.095700081521912e-01   +9.867678732020780e-01; +3.475596865665429e-01   +7.296217129291273e-01   +9.442889622586246e-01   +2.282707479583018e-01   +5.710694861149952e-01   +4.344217033918211e-01   +5.180237262313101e-01   +5.028639201446780e-01; +5.168977167203104e-01   +3.610438437880557e-01   +7.836012809707035e-01   +8.337346240591783e-01   +1.225200029291865e-01   +8.318966730291556e-01   +1.414600536091958e-01   +2.713090864321693e-01; +5.569370353629073e-01   +4.541773148696672e-01   +7.053868491546627e-01   +1.672463889239292e-02   +6.709574149689428e-01   +6.188170214067785e-01   +5.604430831351285e-01   +1.032545175824759e-01; +1.570582301708394e-01   +3.879274960893302e-01   +1.091617360454492e-01   +8.636232186563229e-01   +5.985843985559567e-01   +5.210716101790922e-01   +4.542042551499087e-03   +5.078025222360941e-01; +5.639226101528080e-01   +7.738825886074283e-01   +3.908729607173167e-01   +8.013412500326438e-02   +5.563920841615546e-02   +8.641817305354574e-01   +7.685161574613387e-01   +5.846760678692937e-01];
L2E_L2I_iGABA_netcon = [+7.627080745438924e-01   +9.402761240622226e-01   +2.387519779047134e-01   +8.338867707607195e-01   +2.581489989506986e-01   +7.687620213221702e-02   +1.735323865576121e-01   +5.239956557636386e-01; +8.288058496149545e-02   +6.559770709317174e-01   +5.799399925903865e-01   +4.019547340460121e-01   +2.980142170488876e-01   +3.933625828614916e-01   +1.409173941185522e-01   +2.641413421682414e-01; +6.590109890402113e-01   +4.512614277221031e-01   +8.669221572143939e-01   +3.906335760114399e-01   +4.248157176154367e-01   +4.278638540041616e-03   +5.963102267767916e-01   +6.926261506560713e-02; +5.176190923125019e-01   +8.398753161271906e-01   +4.060572027012658e-01   +3.623955501390313e-01   +1.169717434863738e-01   +2.202027816193343e-01   +9.006519683002455e-01   +4.348788504012675e-01; +1.722714279175785e-01   +5.333653272246259e-01   +1.124401477793245e-01   +1.379261011739430e-01   +4.968373175852787e-01   +1.435512207324433e-03   +9.387318258329462e-01   +1.736001367729647e-01; +9.402793694680516e-01   +5.533234054374533e-01   +4.439933956674547e-01   +2.584786241517917e-01   +7.079819261426508e-01   +1.900927203397410e-01   +2.211668937005139e-01   +2.546493107097351e-02; +5.920916552203824e-01   +6.804912343370190e-01   +2.972391118367783e-01   +8.715818934634967e-02   +2.443670886766748e-01   +1.430974666566788e-01   +4.811408575049422e-01   +9.551726295490762e-01; +4.402327788750283e-01   +3.684498280197082e-01   +4.011007306909053e-01   +4.291374909411293e-01   +7.840492363063122e-01   +2.675811540759459e-01   +3.782636246099468e-01   +4.299602106939289e-01];
L3E_L2E_iAMPA_netcon = [+9.627948739332803e-01   +7.734219420527224e-01   +9.116119169265361e-01   +5.303470577856094e-01   +4.905372069941762e-02   +8.192091287989892e-01   +6.261511075956558e-01   +7.470877104714243e-01   +6.722621633495083e-01   +9.058624216191656e-01   +5.809560158947245e-01   +5.944259408719864e-02; +7.625195480184919e-01   +2.275265506142276e-01   +9.083457761915055e-01   +7.156598913167710e-01   +5.520078976216383e-01   +7.274540705108702e-01   +5.430413137069868e-01   +6.466533581442675e-01   +4.317318298286976e-01   +3.934810649313833e-01   +6.858978142817083e-01   +9.814588280293683e-01; +7.373643608047115e-03   +3.702622795340463e-01   +5.909014156091322e-01   +1.798450746360371e-01   +2.735710747519636e-01   +1.773137936864236e-01   +4.373100193413167e-01   +1.218845951116754e-01   +6.925684455049093e-01   +2.452032409630902e-02   +7.206431222916266e-01   +2.846604640187931e-01; +6.799281037872912e-01   +8.921443293396224e-01   +3.313689911317084e-01   +3.339256491921817e-01   +2.447817443481241e-01   +3.594476567115775e-01   +2.862699522598691e-01   +5.069852298918879e-01   +2.584297026604201e-01   +6.692490933668792e-01   +6.488371121704198e-01   +5.920612949604552e-01; +7.048400394925426e-01   +8.565763808501693e-01   +8.539696588210856e-01   +1.861557661788840e-01   +2.439572769668595e-01   +1.874910085879275e-01   +5.011317788078493e-01   +3.480591703573828e-01   +1.352294069313517e-02   +8.387116938675844e-01   +7.255105223171383e-01   +9.610961712423821e-01; +6.458502045076907e-01   +3.999500103215186e-01   +4.439379727889034e-01   +3.208708516956128e-01   +1.540139000150653e-01   -8.542934925565623e-04   +7.609839365796033e-01   +9.107592068411906e-02   +5.312172517225139e-01   +9.721440734013679e-01   +3.756868722803019e-01   +1.861393630780364e-01; +5.534708246520422e-01   +3.177756301104129e-01   +9.024243464381858e-01   +4.040113491332377e-01   +9.577869041970792e-01   +3.151300257764806e-01   +7.606288887539910e-01   +1.485083731831742e-01   +2.794273437320260e-01   +5.605998764385264e-02   +5.802716918695983e-01   +1.928815985668021e-01; +2.179401495355724e-01   +6.095927125382636e-01   +3.363673762531689e-02   +5.488693652235842e-01   +9.367452137914273e-01   +6.989096909737768e-01   +5.769285874351112e-01   +1.988618316632128e-01   +9.459946904244889e-01   +4.515372937079868e-01   +1.151495855169130e-01   +3.407186504372366e-01];
L3I_L2I_iGABA_netcon = [+9.322376051559564e-01   +9.284370446304767e-02   +6.329201952395429e-02   +2.789789520460854e-01   +2.536555778692638e-01   +4.038551440061177e-01   +5.280411227054523e-01   +1.077260321814516e-01   +9.128337110202972e-01   +5.835770103304829e-01   +2.069366457260940e-01   +9.068118320317559e-01; +3.911983095522361e-01   +6.183550347463406e-01   +4.953943785463126e-01   +7.449203998276557e-01   +8.583047907548474e-01   +9.882326128476644e-01   +8.296250359176996e-01   +2.707986040403194e-01   +6.391406442226505e-01   +2.825205041013389e-01   +3.181580550798155e-01   +5.505256707667998e-01; +2.715172072475946e-01   +1.062362684028813e-02   +6.418095912400477e-01   +2.383922214738893e-01   +9.112198571076933e-01   +8.997405795831308e-02   +8.589156999899448e-01   +5.237854956993950e-01   +2.539156019938575e-01   +8.284091839680915e-01   +1.334113552674205e-01   +3.354029894040463e-02; +1.508399481964476e-01   +5.736324486141732e-01   +2.217764903498027e-01   +9.567489682233700e-01   +6.999249573092602e-01   +3.219313536511126e-01   +7.881157317870842e-01   +9.716433479556574e-01   +9.045473303730062e-02   +1.918573711643760e-01   +6.737988426178163e-01   +5.532574032426339e-02; +3.959641731975016e-01   +7.872599217659140e-01   +8.394281711833724e-01   +6.206292366880254e-01   +7.255618956558856e-01   +5.123298250786803e-01   +3.189111616451433e-01   +7.083851387210763e-01   +8.382202211789045e-01   +4.424159447137960e-01   +5.713142698052985e-01   +8.078741452175957e-01; +3.762976726934979e-01   +2.349761130687856e-01   +9.707235508509577e-01   +6.001590129341067e-01   +2.289017189275798e-01   +5.818624224124374e-02   +4.532243785964448e-01   +3.116456565739170e-01   +5.847534459806433e-01   +3.934809912786096e-01   +1.691929200177339e-01   +4.506282376021085e-01; +1.305565107421376e-01   +4.476894361426493e-01   +8.478130703399351e-01   +1.734838649933895e-01   +5.744305747295544e-01   +7.258876871629703e-01   +7.533618224121649e-01   +2.948453763283590e-01   +9.486278657867812e-01   +8.270925035317873e-01   +1.484184274424845e-01   +3.807897961168959e-01; +4.351859041768008e-01   +5.695535637177327e-01   +5.062698211238237e-01   +9.076422748053073e-02   +8.111907732393816e-01   +5.568683130249961e-01   +1.103301313051781e-01   +8.492446807726730e-01   +6.048466202001753e-02   +6.789953710635248e-01   +4.767044709665673e-01   +7.907524556225370e-01];
L2E_L3E_iAMPA_netcon = [+3.651296428057059e-01   +7.562456710647509e-01   +7.464604417504346e-02   +5.175516930365586e-01   +7.586514323858616e-01   +4.325506540291738e-01   +1.984730091739941e-01   +8.772263866564056e-01; +5.314033949597783e-01   +9.965636644949629e-01   +5.912311630963826e-01   +9.956255705476038e-01   +9.946042097480295e-01   +5.430179948521801e-01   +1.944137568808344e-01   +7.876593774036041e-01; +7.139781116327660e-01   +1.872043393389635e-01   +9.106595826327009e-01   +8.566744372047853e-01   +9.619629511292832e-01   +7.111320340437478e-01   +3.258076611137077e-01   +4.670308446960110e-01; +8.695085826153512e-01   +7.817233894225505e-01   +1.915481022482003e-01   +9.616255665169652e-01   +5.363535434536186e-01   +1.573442331562425e-02   +8.802052249935339e-01   +8.141930253815789e-01; +3.289198475520305e-01   +1.956903274697740e-01   +4.310111406763077e-01   +6.775838258404875e-01   +9.663582840904188e-01   +8.013774412346819e-01   +4.723389570670736e-01   +8.967721170194863e-01; +6.490989872149011e-01   +9.920313766191167e-01   +7.503238202253687e-01   +4.030027188970454e-01   +1.167088725204482e-01   +1.426061257346642e-01   +4.031023774039563e-01   +4.283010888646668e-01; +9.748981778399980e-01   +8.023440861419503e-01   +4.035889961853990e-02   +9.343542242009136e-01   +5.080631042443205e-02   +4.798501353622884e-01   +1.806281476704364e-01   +3.335877594189733e-01; +7.598709526540393e-02   +4.254019773670397e-01   +9.461532681143608e-01   +4.801650296590096e-01   +3.025420589743053e-01   +2.555289941040670e-01   +9.689322429540221e-01   +5.950482505544449e-01; +5.882299434176395e-01   +7.281376508526793e-01   +7.628633977439199e-01   +2.285793730479604e-01   +5.832656308157562e-01   +3.671798900170154e-01   +4.092320287244074e-01   +9.010120905940552e-01; +4.126021280339983e-01   +4.971711692736270e-01   +5.562044045453961e-01   +3.953332207137017e-01   +5.323255201621084e-01   +6.610259198396622e-01   +8.432523987049689e-01   +7.006585036080202e-01; +3.070636870408120e-01   +8.079734693248914e-01   +1.825641084135691e-01   +7.040735606188430e-01   +8.996459101031294e-01   +1.693057933661399e-01   +6.154633534989516e-01   +3.791905985706076e-01; +2.622178759879181e-01   +3.566520868196848e-01   +4.989296313304628e-01   +5.604001966158896e-01   +5.399003132851736e-01   +2.816468561619835e-01   +3.733788685136763e-01   +7.345129468296850e-01];
L2I_L3I_iGABA_netcon = [+9.565719003904231e-01   +2.965445730058217e-02   +9.153441146711798e-02   +4.597579358420933e-01   +3.272856804107361e-01   +3.684740090483336e-01   +6.848877385921527e-01   +8.041105110374560e-01; +5.410155209203311e-01   +2.083366216399865e-01   +5.923011745666453e-01   +6.390245544534100e-01   +8.043466280974251e-01   +2.104052557803910e-01   +9.093571361457095e-01   +6.626548508672182e-02; +5.383840536507547e-01   +4.540364072884531e-01   +2.423415778255040e-01   +9.170816025153670e-01   +9.983128961952663e-01   +4.400963241657310e-01   +6.106190694996249e-01   +9.501302215904939e-01; +3.098793019526020e-01   +1.270832567274873e-01   +8.393575509331361e-01   +1.604326385254449e-01   +9.786765501856498e-01   +9.553966873320913e-01   +9.005611144449237e-01   +4.953703053665215e-01; +7.014373700045295e-02   +9.647945923893345e-03   +8.578486422609849e-01   +7.121843604921915e-01   +1.256890438734376e-01   +1.230514671983287e-01   +1.946344421802911e-01   +7.543414306458704e-01; +1.811892603792809e-01   +7.266033046848490e-01   +9.613813188048052e-01   +5.762661964833076e-01   +2.305746572112931e-01   +4.687449944634719e-01   +7.533026721953596e-01   +7.396762211778368e-01; +9.165122352661920e-02   +3.530556830977066e-01   +4.901050614218354e-01   +4.327630734939574e-01   +2.345475496505704e-02   +8.544357197698825e-01   +3.464759045399071e-01   +8.310925212281222e-01; +4.640833936234261e-01   +7.775795166103525e-01   +2.200371801640053e-01   +8.824260808429694e-01   +6.084908937161190e-01   +4.184378740977763e-02   +4.186560453546138e-01   +1.567004808534599e-01; +8.553600695429488e-03   +4.362209105541801e-01   +2.264820625236468e-01   +3.905578127602408e-01   +1.098642434492669e-01   +6.900977765152480e-01   +1.531025597068602e-01   +4.572958648232150e-01; +9.140536550194777e-01   +4.371922445846739e-01   +5.363481090944017e-01   +1.766296852416345e-01   +4.060646462475697e-01   +9.767755978074782e-01   +8.194427410500688e-01   +6.179357820969138e-01; +6.413509601071972e-01   +5.118131535420080e-02   +7.614149585397947e-01   +6.312769390406966e-01   +8.832107873717820e-01   +2.844355646381440e-01   +6.234662673972630e-01   +9.296030745066787e-01; -7.365757937963316e-04   +4.900973220695484e-02   +3.482102961876978e-01   +6.233645733341294e-01   +5.474252409217312e-01   +1.340701198651582e-01   +7.398263576132815e-01   +8.332196860129153e-01];
L3I_L3E_iAMPA_netcon = [+8.943558377043266e-01   +2.563057423377419e-01   +7.413764513616588e-01   +6.830091755153818e-01   +6.025857299851460e-01   +7.489086934728579e-01   +7.457890595986304e-01   +2.227587335017176e-01   +4.630579413864491e-02   +8.011655469347789e-01   +2.912320298445785e-01   +8.035633256428817e-01; +5.815901690799832e-01   +3.232899140016552e-01   +6.942988421165366e-01   +2.356217310619220e-01   +8.551522668502715e-01   +5.431592772869180e-01   +1.270924948068084e-01   +3.510104343330694e-01   +2.145888480168499e-01   +2.323154835214362e-01   +4.045339252531694e-01   +1.044511182983539e-01; +5.838093859040241e-01   +4.021549919196203e-01   +8.227038144580854e-01   +4.544308287578836e-01   +9.890150010324060e-01   +3.406615374137090e-01   +8.213671197162806e-01   +2.854111477801366e-01   +3.971147419449282e-01   +9.310659684980660e-01   +8.633622027792743e-01   +8.204399077834781e-01; +8.541090553217968e-01   +4.036463977710812e-01   +8.289287219757406e-01   +3.848983783668415e-01   +9.304431299371378e-01   +8.312344180662943e-01   +2.750440246880762e-02   +9.270112944910990e-01   +3.331530298324006e-01   +7.628658059379916e-01   +6.137208844874242e-01   +8.405028680854428e-01; +3.411059534301406e-02   +3.861611106455948e-01   +2.962722652556571e-01   +5.388067188950840e-01   +4.097213107739638e-01   +5.522041185048566e-01   +4.159083016971464e-01   +4.951564026996057e-02   +2.278389693340316e-01   +8.277643445828132e-01   +9.904057263574105e-01   +3.551468234374667e-01; +8.847841334554122e-01   +6.087266310005754e-01   +3.074678570464494e-01   +9.917932083010873e-01   +1.138897405936243e-03   +9.563089020531030e-01   +7.311428556713931e-01   +5.916086817954890e-01   +9.341557582159651e-01   +5.736543692316186e-01   +2.040358602159131e-01   +4.302450938715201e-01; +4.063756250365055e-01   +1.659731714890532e-01   +5.237746742079536e-01   +7.550330713757368e-01   +5.412178348675618e-01   +8.927314882651122e-01   +7.819178945272790e-01   +1.613960646560528e-01   +6.807390158929078e-01   +7.933334635537019e-01   +8.290753442998414e-01   +5.695234737370877e-01; +3.512172901778116e-02   +1.908541807906170e-01   +3.269954665523832e-01   +9.808130756521156e-01   +2.093289655562545e-01   +3.583912814091000e-01   +3.683184545688184e-01   +8.364405798810756e-01   +9.626734429446298e-01   +3.307510377819589e-01   +6.781969075042880e-01   +6.991541380340459e-01; +7.463182281227976e-01   +9.550866591669262e-02   +8.345017580007400e-01   +2.348046017623417e-01   +2.189259328173118e-01   +5.479775022503327e-01   +7.454993004192596e-01   +1.683068294420679e-01   +4.386764344933963e-01   +2.232931508583175e-01   +2.482589778839149e-01   +7.427128880957048e-01; +1.561216356451620e-01   +3.223254598755230e-01   +8.080564649012107e-01   +5.280497418567086e-01   +3.275988548409052e-01   +3.458783829400216e-01   +8.915020996162596e-01   +5.007821348667827e-01   +9.400322478970018e-01   +3.109600046697724e-01   +4.783880287145659e-01   +7.578828077338764e-01; +1.449990409632996e-01   +7.691077433127034e-01   +5.588606611329402e-01   +5.433677277053300e-02   +9.633534972674636e-02   +6.242514882698569e-01   +2.442780230427623e-01   +9.975965112563066e-01   +5.762173037603313e-03   +5.852892502423960e-01   +4.006196277149680e-01   +3.902823660833530e-01; +6.066847040421037e-01   +2.349788674460918e-01   +2.631375340376100e-01   +7.580107145148527e-01   +7.499660901376874e-01   +7.983928334377728e-01   +1.297199991494351e-01   +3.536264293200714e-01   +6.113313849102552e-01   +8.279724621811353e-01   +5.985646939797558e-01   +4.273172807300212e-01];
L3E_L3I_iGABA_netcon = [+9.568359517290175e-01   +8.839965778499896e-01   +7.997444414707313e-01   +9.860447721489837e-01   +9.013874722404596e-01   +9.624207863662627e-01   +6.538640169727981e-01   +5.036192572685614e-02   +1.090625275705332e-01   +4.519260958331258e-01   +8.289563133293597e-01   +5.805362436801133e-01; +5.713774033418333e-01   +4.372607065426632e-01   +9.855266960571325e-01   +5.608888626048292e-01   +9.957222974426120e-01   +5.418157422421843e-01   +6.562950682485638e-02   +4.677590989483094e-01   +4.619227462530945e-01   +3.351312351592022e-01   +6.282427513747696e-01   +6.364128413076084e-01; +8.501238763522097e-01   +7.822767834197510e-01   +1.593270985806979e-01   +9.329620612063878e-01   +6.510256582947812e-01   +3.094148232170305e-02   +2.751177655843192e-01   +3.249260635222102e-01   +4.506273890192620e-01   +5.936825959362490e-02   +5.394202088146899e-01   +6.499717047468673e-01; +2.773735863502657e-01   +1.498111810842601e-01   +2.386534114783285e-01   +7.213527283544052e-01   +1.091190424333898e-01   +6.953487153103211e-01   +2.815502517867872e-01   +6.308623802120719e-01   +5.507236430834891e-01   +7.403531888489990e-01   +6.485411531285504e-01   +8.621254692854793e-01; +6.210553527859689e-01   +6.213032081322664e-01   +7.005653075687982e-01   +4.833915635069256e-01   +3.744485930174049e-02   +5.197027189738622e-01   +8.791039037499920e-01   +2.292433789978705e-01   +8.059509700306494e-01   +5.054549069577275e-01   +7.266375992270925e-01   +5.668438944013208e-02; +5.896521570791992e-01   +2.589447703372656e-01   +3.782072015521368e-01   +6.397569675266300e-01   +6.177872664810861e-01   +5.996827822906477e-02   +4.439409240125162e-01   +5.812968412298561e-01   +7.000305668115626e-01   +2.004290741886137e-01   +9.386905710034513e-02   +8.177883034791809e-01; +9.643181474320435e-01   +4.461446371039298e-01   +9.755145358673852e-01   +8.877316879884758e-01   +5.659845645944601e-01   +8.893535271751462e-01   +7.582848332086981e-01   +6.025921300158457e-01   +8.721866079683758e-01   +4.254183571914035e-01   +8.794315015305910e-01   +5.299495358344514e-01; +8.792081069167978e-02   +8.445837465570492e-01   +9.692339264985753e-01   +1.972207452518799e-01   +9.616389954250125e-01   +3.310528879889392e-01   +6.007280979732179e-01   +5.991280742708717e-01   +5.286268250288879e-02   +1.685168915593666e-01   +1.337085278190113e-02   +6.960718202862890e-01; +5.012408769369058e-01   +1.979494515509102e-01   +6.435931614221388e-01   +3.951912120438005e-01   +7.461270773917881e-01   +2.280551198155658e-01   +7.819515290407487e-01   +4.468424273801351e-01   +2.191894453678517e-01   +7.521284687119194e-01   +2.923655578982616e-01   +2.116503028387870e-01; +5.207209734805689e-01   +3.037704811301450e-01   +8.599114641357145e-01   +9.918642820794256e-01   +6.617463780295400e-01   +1.144022231110786e-01   +1.139466246712960e-01   +3.451683571044812e-02   +4.582866332986795e-01   +3.665793975068074e-01   +1.802696286548459e-01   +5.435082718537046e-01; +9.106684835379122e-02   +4.805701528416110e-01   +4.025273930068203e-01   +4.008412140898708e-01   +5.254687913679205e-01   +3.109919585693719e-01   +9.771657224048989e-01   +5.123813983397939e-01   +9.597679056755870e-01   +9.424414652878582e-01   +9.269633522285996e-01   +7.039976165860811e-01; +9.068072260536577e-01   +3.364045833777638e-01   +6.309731544012397e-01   +6.597209256538281e-01   +2.578543941031359e-01   +2.268941606596507e-01   +8.480191274585400e-01   +4.069750267242378e-01   +7.919221941999940e-01   +1.426062542934382e-02   +6.900813958137467e-02   +9.550191863144626e-01];
L2E_Input1_iAMPA_netcon = [+9.967370131545942e-01   +9.985604707417263e-01   +9.974641916895062e-01   +9.998115812654900e-01   +9.964061647122939e-01   +9.968918462325405e-01   +9.977854454445708e-01   +9.968621474039809e-01];
L2I_Input2_iAMPA_netcon = [+9.986867348033608e-01   +9.975397887377651e-01   +9.987315624216333e-01   +9.997413191290724e-01   +9.977706094969307e-01   +9.969942082767427e-01   +9.995977447895573e-01   +9.988628584775983e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
