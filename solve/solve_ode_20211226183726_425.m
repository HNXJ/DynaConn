function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.043841244811809e-01   +4.494130641973713e-01   -7.613376835468942e-02   -7.472733624562646e-01   -4.429455241036094e-01   +5.250797834250658e-01   -3.015242874985130e-01   +2.621412341142335e-01   +3.929389475491557e-01   -1.468350292079227e-01   -2.694998773149447e-01   +1.562069566483431e-02   -5.027766638706559e-01   -5.072548461897594e-01   +7.004336054757619e-01   +7.533008383255448e-01; +8.285191675026177e-01   +2.720730922145733e-01   +1.069564579212337e-01   -2.810648830267390e-01   +3.087097469510352e-03   +1.764482842425619e-01   +2.410815403478587e-01   -3.752436845658676e-01   +8.400668540482284e-02   -3.589495739960029e-01   -4.389658898551261e-02   -4.881789190841303e-02   -6.800747581431039e-01   -2.311528898213037e-01   +7.136713710559038e-01   +1.290733013360563e-01; +2.869004813693382e-01   +3.294331892432569e-01   +7.334635708436154e-01   +8.047307440141599e-02   -5.137757113384472e-01   +2.597003762824522e-01   +5.200214356108022e-02   -9.535196628563949e-02   +1.664189056919212e-01   +5.829864915682877e-01   -1.990638532567681e-01   +4.275000642356120e-01   -2.014339289769920e-01   -1.132203572115897e-01   -4.072640039131697e-01   -3.885159886228283e-01; +6.389565513630363e-01   +1.444679614326399e-01   +2.277527087243238e-01   -3.177399582598396e-01   +4.229712462333266e-01   -6.540280097819500e-01   -4.656850986261397e-01   -1.805696235255435e-01   -8.588029281966797e-01   -1.557702875167531e-01   -1.177276573426842e-01   +2.481236124117326e-01   +8.146722517939355e-02   -7.041647199661357e-01   +3.860534441183180e-01   +1.876000444928263e-01; -6.168946462623173e-01   -1.324527801913444e-01   +3.507204538969385e-01   -2.479122942789506e-01   +3.516603260893011e-01   +1.679037269797251e-01   -3.271912729101993e-01   +6.323368791267102e-01   +6.504604991848163e-01   -3.220913829170869e-01   -4.698041753611933e-01   +6.037566594775101e-01   -4.186383273411351e-01   +7.794940909449671e-01   -3.252893399946637e-01   -1.000000000000000e+00; -3.649084845823600e-01   -7.075821837639445e-02   -1.247661920552060e-01   -5.830834448514545e-01   -2.649552954072215e-01   +2.569886653838517e-01   +2.708636675390619e-01   -1.663863177439704e-01   -6.535612726850016e-01   -8.385174427885345e-02   +2.279324948884017e-02   -4.560259794608497e-01   -4.701292333245480e-01   -2.448016572121953e-01   +6.034933209489217e-01   -3.478062479553843e-01; +5.433112228333018e-01   -5.218783849469308e-01   -5.108820637871548e-01   +7.280906453746259e-01   +2.842809773102082e-01   +4.789355376215978e-01   -1.853753925858395e-01   +4.268580960577473e-01   -1.594503460531352e-01   -3.063688309127701e-03   -2.550551754407596e-01   -2.080058033641345e-02   +3.002580898265486e-01   -6.461709611109777e-01   -3.949705701678173e-01   -1.154412041219686e-01; +2.424928577026455e-01   +3.744777838336781e-01   +1.402297684434213e-01   -1.234616926799807e-01   +2.670361517258085e-01   +7.713855433848283e-01   -4.459066720067379e-01   -3.964450788116852e-01   +4.099533963058185e-01   -2.301496695896554e-01   +3.229455588171186e-01   -1.360206816053349e-01   +4.909752168364973e-02   +8.096776649219863e-01   +2.897260149624474e-01   -8.174564591793244e-01; -2.690573774333804e-01   -1.491933933740239e-01   -5.600472218837751e-01   +7.075200867104954e-01   +2.995637918296336e-01   -2.884919842917456e-01   -3.917807799039200e-01   -1.572352580337483e-01   +5.905155288142153e-01   +6.963407780198455e-01   -5.179907719253874e-01   +8.278116474998032e-01   +1.160633152584781e-01   -4.547971920151735e-01   +2.228720541785553e-01   +2.405305379726106e-02; -1.368083921319223e-01   -8.644289167671406e-01   -3.063173054791730e-02   -1.959022242147557e-01   +4.722145857136308e-01   +2.978389927387167e-01   -3.448734896040138e-01   +4.066669233658845e-01   -1.476298933739110e-02   +1.236515886117992e-01   -3.995422204375870e-02   -8.120167132414982e-01   +2.469008553956307e-02   +2.306131429754534e-01   -2.383360653930989e-01   -5.751470022882239e-01; -7.766358538865829e-02   +4.019448218278107e-01   +5.372673151437764e-02   +6.438167002686731e-01   -1.084078836078837e-01   +2.278869227684098e-01   -1.376553626947772e-01   +2.535949798867403e-01   -1.021640234829370e-01   +3.930609692947174e-01   +1.422140847969136e-01   -1.389395926354421e-02   +3.649871701904145e-02   -3.709605837694311e-01   -2.530533719412423e-01   +7.498261499580786e-01; +4.045475648670667e-01   +2.129847449769338e-01   +1.149098876718368e-01   -1.008139850886015e-01   +3.829347441787408e-02   +1.930584619109573e-01   -4.446252073225513e-01   +3.750808013015140e-01   +1.710838368323680e-01   +1.783796945029944e-01   -4.532197370157814e-01   -2.126314099002271e-01   -3.312532251047526e-01   +7.789175566216919e-01   +5.388195846421990e-02   -2.705910772786798e-01; +6.228726060752396e-01   -9.229942659961869e-02   +3.648634752956206e-01   +1.018934805890537e-01   +1.478966485205767e-01   +8.015402885017702e-01   -1.399590231910068e-01   -6.853305767067485e-01   +3.486444970133736e-01   +9.715831605698866e-02   -9.752772030712632e-02   -2.503271585652961e-01   -6.221827777953581e-02   -3.458926824651509e-01   -6.736925352581319e-01   -2.662829233697983e-01; -2.194096182324566e-01   +1.661768943923177e-01   -5.342982194520346e-01   -3.439272015576061e-01   -3.625220199062454e-01   +2.832771952598575e-01   +6.341064942715327e-02   +7.984308079375281e-01   +3.920993002478788e-01   +1.760056841977891e-01   -2.563616186009187e-01   +7.049105983789100e-01   +4.663581436351754e-01   +4.223559029039728e-01   -1.223629262195650e-01   -6.295088818516895e-01; -2.154743038494313e-01   +6.383382662949030e-01   +2.721923221664889e-02   +3.421474468284859e-01   +1.620965270339254e-01   +7.634594222179161e-02   -1.507388448714710e-01   -8.203891258686541e-02   +2.465233057232502e-01   -2.026009328988034e-01   -2.552302113100274e-01   -4.324532887575669e-01   +2.588135222687501e-01   +1.446829302246222e-01   -6.649616174796250e-01   -2.367312051774438e-01; +1.472644607559881e-01   -1.418827341141431e-01   -1.997784736521880e-01   -1.780741669859961e-01   +3.094312798885988e-02   +2.760310289199195e-01   +3.906073551878745e-01   +5.154237315987985e-01   +4.144715080227380e-01   +1.526859683983417e-01   -2.567606201691138e-01   -6.902437683025299e-02   -6.746800442982627e-01   +4.496456659279303e-01   +3.886174000810013e-01   +2.072148021241494e-01];
L1E_L1I_iGABA_netcon = [-2.484191212853837e-01   +4.632231497718597e-02   -3.860362654511795e-01   -3.767620257199910e-01   +3.134763392032041e-01   -4.842900530133480e-02   +6.207866156752411e-01   +2.881505706869229e-01   +2.736247911548669e-01   +6.444267110925385e-01   -8.482624483711523e-01   +6.219619012649410e-01   +1.451477510224527e-01   -4.132307289026653e-02   -4.721626882516610e-02   -9.452959984264445e-01; +3.011594874215886e-01   +3.200790724965569e-01   +5.792810078562434e-01   -1.715925435004442e-01   +1.422585769927837e-01   -2.601119744505285e-01   -3.016009292769429e-02   -2.490507024414864e-01   +4.153829277797202e-01   -3.637996092003908e-01   +1.510414979806283e-01   -6.581610256196244e-01   +6.510361475214571e-01   -2.396673607363841e-01   +3.392511423269473e-01   +3.699000363700095e-01; +5.336194144569646e-01   +7.032789441664559e-02   -1.580216926749141e-01   -5.296698165236040e-01   +6.823377268050435e-01   -3.920312329010483e-01   -2.757222430339587e-01   -8.013956009440301e-01   +3.463594621724320e-01   -6.103063769626104e-01   -3.648904698008374e-01   +2.544079117120316e-01   -6.250899774894079e-01   +6.919549065908552e-01   -8.200059256552542e-02   -3.247559566707021e-01; +1.116751961022645e-01   -4.772859401426356e-01   -8.895906497494269e-02   +2.509678734807356e-01   +3.095927319027228e-01   +6.430995252163836e-01   -1.533355654172249e-01   -1.227963240180844e-01   +2.276358467550613e-01   +3.409823413849097e-02   +9.478696862809854e-02   -3.605281370160642e-01   +4.056791783898042e-01   -1.378344815262559e-01   -1.568167118289983e-01   +7.077223737810327e-02; -4.823949201629967e-01   -4.785783366382364e-01   -2.522008041505110e-01   +5.062801905062730e-01   -6.884400862085401e-01   -1.307787932715825e-01   +2.534335124952373e-01   -5.980536261602188e-01   -4.696944494241051e-01   -7.250400903750942e-02   -2.606312554768055e-01   +1.592262974640075e-01   +1.425437849061565e-01   -6.373628350984111e-01   -9.609524327389636e-02   -2.468062779283663e-01; -2.231900883957295e-02   -3.105235945529394e-01   -1.352559027295650e-02   +1.303596296415435e-01   +9.774749551781843e-02   -3.594679564719218e-01   +3.815872826414758e-01   -1.968852533550606e-01   -2.043881284353386e-01   +1.855222487681857e-01   +9.944437220869372e-03   +2.444828443006852e-01   +5.140832353579049e-01   +4.081299990125452e-01   -9.744030703103223e-01   -4.186294618026017e-01; +2.726605086539460e-01   -4.215424924101573e-01   -1.107661100740266e-01   -8.648599625834025e-02   -4.048750088725183e-01   -2.761851851648398e-01   +9.444290476797559e-01   +4.094181135129611e-01   -2.144386064144399e-01   +5.551792199742758e-01   +3.306095245461366e-01   -5.887887783155972e-01   -9.090634290789239e-02   -6.897097035182576e-01   +6.997515097934309e-01   -4.477854456604721e-01; -1.672288779854033e-01   +1.218012986653532e-01   +4.436148356370130e-01   +6.437940961283910e-01   +2.123746739300554e-02   +8.891060705366234e-01   -5.543058321351821e-01   -1.198434958351215e-01   +3.063699546256414e-01   -8.509101683118929e-01   -5.405182687639644e-01   +6.801095284086071e-02   -2.224328708956544e-01   -2.149191825618012e-01   +4.916750145569731e-01   +4.568021382132541e-02; +2.747034285239396e-01   +2.214735381918373e-01   +7.391349177663273e-02   +4.662504315540142e-01   +3.813664621597014e-02   +3.465826409785502e-01   +3.698981756375823e-01   -9.650325911737186e-02   +2.508516894526213e-01   +3.984631950682657e-02   -2.896634083283208e-01   +4.218959898439034e-01   -6.127448158072249e-02   -2.707296727043776e-01   -7.386765574151481e-01   +4.281141483854935e-02; -4.094269933820547e-01   +2.956826182241780e-01   -1.245948911468827e-01   -3.528722313705187e-02   -1.000000000000000e+00   +4.589808713487189e-01   -5.179614769314256e-02   -4.166911290191258e-01   -7.131779508464039e-01   +1.385490155216215e-01   -2.954842233690739e-01   -1.392410618081045e-01   -2.276479884881369e-01   -6.172529070947724e-01   -2.021925352746275e-01   +1.329029244208194e-01; -2.519246491792418e-01   -3.867867137964243e-01   +4.194827979686124e-01   -7.885748463604712e-02   -2.486089755888467e-03   +3.285210874122434e-01   +3.855556591055667e-01   -3.376223405690054e-01   +3.102771956627752e-02   +6.129523866518354e-01   +9.725322180340479e-02   +1.533714027052481e-03   +7.399981197678067e-02   +4.973801268550173e-02   -2.505187573992130e-03   +1.759770881614355e-01; +1.385961898975244e-01   +3.264703445090206e-01   -1.140291970090666e-02   +8.614240432563895e-01   -3.305550235978728e-01   +6.305824633624564e-01   -6.537403591317423e-02   -4.496667864572612e-01   +6.779450303012593e-01   +4.377645346814473e-01   -3.021976215848938e-01   +7.639657703246855e-02   +2.098712013570039e-01   +3.152782970755187e-01   -1.166363295940733e-01   -6.554443908082989e-01; +3.794163888387700e-01   -1.931376981293460e-02   -2.963923396768222e-01   -5.586711117933374e-01   +3.286521777848473e-01   -3.625091027152177e-01   -2.978604854368001e-01   -6.387238006893079e-01   -3.925557198007327e-01   -2.297094848126623e-01   +4.312307999332944e-01   -2.287993913578183e-02   -6.664022267077827e-01   -5.348629722236863e-01   -1.313706626603064e-01   -4.319934001006655e-02; +9.931307836631623e-02   -3.008837065956329e-01   -7.142588883900297e-01   +3.881351734325154e-01   +3.351934355421680e-01   +1.594524566802494e-01   -1.491889021089106e-01   +2.011772486198974e-01   +4.524944802280964e-01   -2.311471998488461e-01   -9.119519516639373e-01   -6.589035182913467e-01   -1.409446060979257e-02   +4.006895072815378e-01   +2.355046769862428e-02   -1.641228803365506e-01; -1.972426372400768e-01   -1.958975200235448e-01   -4.874042985853758e-01   -1.720120292010725e-01   -6.927467467405439e-01   -8.357854052799357e-01   +3.879346790920478e-01   +6.563872391205641e-01   +4.407498946211794e-01   +1.936489106730928e-01   +2.455547248517656e-01   +4.632658827433605e-01   +1.213258380130989e-01   +8.942192500439359e-01   -3.573417996482216e-02   -3.582393142527693e-01; +6.392585990640716e-01   +2.169515271437869e-01   -5.370108170638999e-01   -1.066357742471502e-01   -2.809694019705920e-01   -1.509195492470787e-01   +1.079565084030931e-01   +1.764150138255996e-02   +1.683276655624606e-01   -5.069823988834940e-02   +9.799344412290713e-02   -2.010157994001835e-02   -1.572609959887496e-01   +4.376949647091585e-01   -4.636501890867855e-01   +2.861568512067616e-01];
L2I_L1I_iGABA_netcon = [+6.801482284356805e-01   -1.808308455498641e-01   +1.988486921975971e-01   -3.365755502228018e-01   -4.101032241803921e-01   +1.895042770388335e-01   +3.020464730287122e-01   +3.325914546570671e-03; -1.345337315490255e-02   -3.085787958759073e-01   +1.126516847032969e-01   -3.259409016236990e-01   +1.134847032300440e-01   +2.928814664136238e-01   +5.786652336667975e-01   +2.334526370983211e-01; -1.920776547445177e-01   +6.919367112222307e-01   +5.700237499409142e-01   -6.807775540088799e-02   -5.059798201711399e-02   -5.969514854610421e-02   +4.467625604421267e-01   -6.086620253459563e-02; -1.239019570610303e-01   +1.924708317890567e-01   +4.562069795523133e-01   -2.626137349892989e-02   -5.256563733905618e-01   +2.732610135207537e-01   -1.876087599624767e-01   -6.674129227610465e-01; -6.553152548350882e-01   +7.373195987184700e-01   -4.925673246271134e-01   -2.079064164769141e-01   -6.883777793289293e-03   +5.495615218564718e-02   -5.666541844080615e-02   +1.548553396483626e-01; +4.832093984640067e-02   +7.456385922439923e-02   -1.687925058119599e-01   +1.726587514609849e-01   +3.083164651125677e-01   +1.827612171363041e-02   +5.785143276584264e-01   -3.453832806987865e-01; -5.342014017980169e-02   +1.208606855715596e-01   +4.731886647211034e-01   +1.875862955228221e-01   -4.832481031198782e-02   -2.862679743678354e-01   +1.299311387743365e-01   +2.509972776930198e-01; -4.231364848914919e-01   -2.611239634301971e-01   -2.595141793849205e-01   -6.233901824303836e-01   +9.551671862075263e-02   +5.730953777532358e-01   -3.568040968841590e-02   +7.725511551932543e-01; +2.892823746960338e-03   -2.136233114056800e-01   -1.332111158724875e-01   +1.783055939322331e-01   -1.846442693694892e-01   +3.789740454955391e-01   -3.767387181928212e-01   -1.355405391803745e-01; -2.569020642608274e-02   -4.344844261890861e-01   -6.065600739035387e-01   -2.292681809333083e-01   +2.867256000906985e-02   +1.368332083599478e-01   -4.328102756064341e-02   +3.186033568594679e-01; -4.427291299494816e-01   -5.701352986922208e-01   -8.474441212607074e-02   -4.926827504205068e-01   -4.985065342364801e-02   -4.239225873663613e-01   +1.933485915953946e-03   +2.743828760167646e-01; -1.456202316604919e-01   +2.653464641636428e-01   +1.196162208088247e-01   -2.399488050930469e-01   +1.317580440916066e-01   -9.391077174639959e-02   -6.138577834889263e-02   +1.167836601793413e-01; -2.339951111033864e-01   +1.463565016712069e-01   +3.036175703623447e-01   -1.209271604260947e-01   -4.259405071476272e-02   +1.154159222879298e-01   -6.728081423325375e-01   +1.513628174745857e-01; -1.125025787617514e-01   +1.752169146785516e-01   -1.495306298345881e-01   -2.519605598912485e-01   -2.778979120550723e-01   -1.938150936971932e-02   -5.883231215141445e-01   -6.105421884059524e-01; -4.518055340645823e-01   +8.177901997702759e-02   -1.505857184504147e-01   +4.567104124895271e-02   -3.828454412522507e-01   +5.332282017992978e-01   +3.654932890746179e-01   -1.543017769273776e-01; -4.218249521635614e-01   +1.000000000000000e+00   -2.633800338628668e-01   +1.490224132539713e-01   -5.134118336294806e-01   +5.646372029662734e-01   -2.887380431094781e-01   -7.979349493171162e-02];
L1I_L2I_iGABA_netcon = [+8.424536182289544e-01   -5.365499450986768e-01   +7.201671408615942e-01   -2.410099665086434e-01   +4.726671381576615e-01   -6.250112264733843e-01   -2.712537308043905e-01   -5.679632181339338e-01   +2.761895607206018e-01   +1.649613546616140e-01   -2.767256748638191e-01   +2.595874345829859e-02   +8.517857348067301e-02   +1.519496385315223e-01   +2.004923134080481e-01   +5.348454291629055e-01; -6.400922809853345e-01   +2.504479013371661e-01   +6.188052968825712e-01   -5.728590392927514e-03   +5.597964804139139e-01   +4.808297942415370e-01   +5.615684432425220e-01   -4.961562749936085e-01   -8.229244464973400e-02   +3.269896897737513e-01   +3.784050685731188e-01   +6.856622300165142e-01   -6.920319346917910e-01   +1.000000000000000e+00   -4.348855200684303e-01   +3.342418006519605e-01; +6.911736360727532e-01   -2.827793952000237e-01   +7.953044054340804e-01   +7.153549342872488e-01   +4.697983258635859e-02   +9.512460541331706e-02   +5.286404093795159e-02   +1.352939463312733e-01   -1.552449203048819e-01   +4.934707028344726e-01   -3.142489804625928e-02   -3.514888999389988e-01   -5.295342157690683e-01   -3.838592300995781e-02   -6.613188483370953e-01   +2.986281603159631e-01; -2.180667469054388e-01   -1.181683566935203e-01   +5.065102098884505e-01   -4.063824046716324e-01   +5.787118916788256e-01   +2.566827089570140e-01   -2.921713753881590e-01   +1.273320390754382e-01   -5.263740864686572e-02   +3.235295801738672e-01   -1.437638323289427e-01   +7.022272029545229e-01   +1.288340178389312e-01   +1.356718437592894e-01   -2.881390008440893e-01   -6.369680262154398e-02; +4.711018902231714e-02   -2.142946909581679e-01   -2.114342175610988e-01   -3.469678433857035e-01   -1.331213492030699e-01   -7.964400537172148e-01   -1.710908555278298e-01   -5.441241195586327e-01   +4.124576425844176e-01   -2.959266100833210e-01   +6.552947693944995e-02   +1.007964510074166e-01   +4.080754913296625e-01   +8.947423425487472e-01   +3.670843433286231e-01   +4.370558345117360e-01; +5.016248032728133e-01   +2.362922059565397e-01   +5.589559171335086e-01   +3.696802746022073e-01   -5.232007901113567e-02   +3.024756610807200e-01   -2.064727825081296e-01   +5.233029212441317e-01   +2.328060975100562e-02   -2.409604068632828e-01   -9.185814920992930e-02   -3.036728673366542e-01   -5.825391877965153e-01   -4.730221140095382e-02   -1.711754351580315e-01   -4.642135968998247e-01; +2.004663802105047e-01   +6.220856878555526e-01   -1.150600429010423e-01   -1.790367160353810e-01   +2.418379057900426e-01   +1.390917770213107e-01   +2.506554298984461e-01   +3.293607463784407e-01   +2.369650742590807e-01   +1.033669925834559e-01   +6.421014691191902e-01   -3.546436599217444e-01   -2.058420134815346e-01   -5.242538719080921e-01   -7.459103016142563e-01   +3.375397680488366e-01; -2.735261429726646e-01   -6.217490246733463e-02   -2.484757766104556e-01   -1.559717145354251e-01   +2.335791242327820e-01   +5.110070627321455e-01   -1.230554395688129e-01   +2.717957388341539e-01   -1.623983087617930e-01   -2.439875830667649e-01   -1.306922307297530e-01   +2.321599928584045e-01   +4.092036430868439e-01   +3.686927088395544e-01   -4.059910634426688e-01   +1.482386815959048e-01];
L2E_L1E_iAMPA_netcon = [-7.374682128676149e-02   -3.125367588037817e-01   -2.885870750034826e-01   -4.750609485855548e-02   -3.896810727675235e-01   -1.634570627212143e-01   +2.967825238894066e-01   +5.359386332278326e-01; -1.509727524239294e-01   -1.891650787954649e-01   -4.235412117798160e-01   +9.124103939975601e-03   -3.252996093643786e-01   -2.340578934055414e-01   +1.874104933622570e-01   +4.856906602548400e-02; -8.216571690174682e-01   +7.143198852733721e-01   -6.199914714170259e-01   +7.261894116054831e-01   -5.161499046821785e-01   -1.342172783973163e-01   -1.417513042293062e-01   -4.869383012817072e-01; -5.296117099006475e-01   +7.006051050237924e-01   -3.320171261435512e-01   -3.924147430844674e-01   -1.153450049125634e-02   -8.309677302180800e-01   +1.426626686619916e-01   +5.089954453448354e-01; +1.182865365669726e-02   -3.865449415115055e-01   +4.093163437791398e-01   +2.691772695639683e-01   -8.369349864862735e-02   +5.945037626591634e-01   +4.408426426025939e-02   -4.640806479583676e-01; +8.899212988283948e-01   -2.880834008151637e-01   +4.919599493659256e-01   +6.450331578086825e-02   +1.720205318282674e-01   +9.197693039713591e-02   +3.804442681744336e-01   -3.703916435580092e-01; -4.131172809653960e-01   -4.621790355023265e-01   +2.792670199466967e-01   -4.013884651369986e-01   -2.154515195976401e-01   -3.920973840558671e-01   -8.675940584608730e-01   -4.490395385587237e-01; -3.957809060968591e-01   +2.807119811727968e-01   -4.622906021966480e-01   -4.520126797486160e-01   +5.211635086413129e-02   -4.326769692874202e-01   +5.276771875902075e-02   -1.274085238867251e-01; +8.727854675050475e-01   +3.760635127992745e-01   +2.730198726809957e-01   -1.880167947767463e-01   -2.278326697629701e-01   -2.305512773313040e-01   -1.319721309416648e-01   -8.781976982642786e-02; +3.063991505712490e-01   +6.747732111747708e-02   +2.066735197768518e-01   -4.459901163256778e-01   -2.014722320074195e-01   +1.422188890121759e-01   +2.003923543070528e-01   +8.071568908070105e-01; -1.622482284552710e-02   -2.364008962506479e-01   +2.363281236689180e-01   +5.209086882948581e-01   +5.179342084286087e-01   -8.584289815777230e-02   +3.458938087588035e-01   -4.700880190818007e-01; -9.087468106722545e-01   +1.301019575434359e-01   +6.985477451724104e-02   +3.159901072807824e-01   -7.204510534339316e-01   +6.901597655412083e-01   -5.353633073295234e-01   +3.442505462677349e-01; +7.388491747171162e-01   -2.166651803983626e-03   +2.119595578503003e-01   -8.279801319865795e-01   +2.962178688357228e-01   +6.574638342572453e-01   +1.965619087174710e-01   -5.797579459963960e-02; -4.283430124474220e-01   -1.249171619585574e-01   +6.767403782049647e-02   +3.764076435256357e-02   +1.000000000000000e+00   +3.554198110376353e-02   +5.563390959142938e-02   +2.366477925552855e-01; +4.602245696680980e-02   +1.309733651586786e-01   -1.791089821307473e-01   +1.062990912478246e-01   +2.979029685030178e-01   +5.107590790546569e-01   -4.059603749011698e-01   +3.432697228429775e-01; -2.617434812110479e-01   +7.103843681159884e-02   -7.730063823116448e-01   -4.840064911561160e-01   -6.263604319420565e-01   +1.724569987048678e-01   -2.054613231377379e-01   +4.689574408578295e-01];
L1E_L2E_iAMPA_netcon = [+2.328587565280810e-01   -4.396312222251042e-01   -4.521271188175955e-01   +6.067535531302819e-01   -3.234668359933602e-01   +8.085884295705920e-02   -3.299821050949364e-01   +2.674839481236402e-01   +6.314172995701798e-01   +1.093565576498680e-01   +1.239834370773130e-03   -2.704241456066480e-01   -9.164922109198661e-01   -8.879193534279877e-01   -2.350818854582083e-01   -9.357336257540472e-01; -1.472712972373048e-01   +5.216336247542874e-01   +4.621892751164593e-01   +2.105504332497705e-01   -7.180118299576546e-01   +5.048794115958256e-01   +2.796729449546881e-01   -1.935226083883656e-01   +2.859303167953617e-01   +2.323829793733917e-01   -2.054091505625827e-01   +7.888577723325594e-01   +7.437651206624044e-01   +5.335116028421895e-02   +3.599781689146562e-01   -7.364701387222916e-01; -3.411101515879084e-01   +1.173348968433518e-01   +5.883927695437522e-01   -1.424409088031927e-01   -1.135797305282066e-02   +4.506644921276063e-01   -4.898238169748931e-01   +3.647040298807224e-01   +5.457627744073247e-01   +6.611432263633183e-01   -1.436005255082090e-02   -2.208006227981371e-01   +3.689606646267220e-01   -8.974921103384186e-01   -1.880285639135202e-01   +5.745812114797055e-01; +5.166676813652564e-01   -5.369096798755864e-01   -2.267124508997702e-01   -1.075061215301039e-01   +2.323222604975805e-01   -2.070609979604629e-01   -9.172658969495460e-01   -3.946085899213598e-01   -6.604844698813190e-01   +3.338041533368285e-01   +1.541821580782647e-01   +2.127458229435885e-01   -8.091798593513209e-01   +1.635720085066177e-01   -3.250172081781920e-01   -8.630293895163026e-01; -4.338696777018988e-01   +4.000604413721106e-01   -2.318498122656749e-01   +5.850898821970285e-02   +7.337986762354661e-01   +8.229406722525631e-01   +1.274319229072123e-01   -2.978387117009251e-02   -5.310352366474530e-02   -2.597861615848032e-01   -3.545246145931621e-02   -1.587351633317071e-01   -5.800070943595257e-01   -8.543873099719927e-01   -1.873265018879108e-01   -1.942776709048117e-01; -6.234983045402689e-01   -7.959796210232972e-01   +5.696073268897452e-01   -1.985517994525743e-01   +1.356011350644420e-01   +6.147232696677626e-02   -2.609656956579254e-01   +1.156174847392949e-01   +6.919151244118310e-01   +4.604576495253494e-01   +1.461376337564982e-01   +2.543246074405245e-01   +8.057285714674540e-01   -2.153444043525147e-01   -4.256947834098491e-01   +5.567209390402367e-02; +3.089846366772582e-01   +2.595015490539712e-01   -7.281813183517426e-01   -1.008701283472995e-01   +2.943332535395373e-01   +5.511123646394662e-01   +4.277915656771684e-01   +2.093635402590497e-01   +5.855948036641370e-02   +4.252934791694313e-02   -1.576797462747052e-01   +1.453599588392461e-01   +2.998011788046975e-01   +3.548874285666621e-01   -6.274168973439120e-01   -1.749584075810562e-02; +2.663973297548936e-01   +3.918142982055539e-01   -1.677335502025178e-01   -1.284022007508462e-02   -3.486202802927384e-01   -4.171407948072553e-01   +1.663762250072245e-01   -2.640705157040960e-01   -2.998084838992608e-01   -1.278443390755510e-01   -1.995170573554942e-01   +5.351045086782281e-01   -6.116441589764832e-01   -3.868415450653942e-01   -4.620409611025217e-01   -1.199824206252433e-01];
L2I_L2E_iAMPA_netcon = [+3.342753806927505e-01   +2.467640289537156e-01   -1.983464251890147e-01   +8.795274405659037e-01   -1.310193495583045e-01   +5.307197095911531e-01   +3.632834026589946e-01   +4.506817944393373e-01; -2.910688568853193e-01   -1.526226739219795e-01   +4.289061327742222e-02   +1.444812149212029e-01   -2.658990195655515e-01   +7.268956364523909e-01   +1.553521140616552e-01   -6.560366354233783e-01; -3.699226669482826e-01   +7.921585057355307e-02   +5.468480764761835e-01   -7.750151584966560e-01   -7.141264885337626e-01   +3.769186991667337e-01   -8.212509674711654e-01   +3.691615876541943e-02; -1.664681680245232e-01   -4.505679405031033e-01   -3.619215958239105e-01   -6.414778327245092e-01   -1.715652423960755e-01   +1.358867320305064e-01   -4.066889402119832e-01   -1.242356114029431e-01; -8.156327857566760e-01   -4.657021735951711e-02   -3.941529939606890e-01   +1.791663765162053e-01   -1.599098767370224e-01   +2.561233921438886e-01   +3.724699474237531e-01   +5.390645989411408e-02; +5.686624536133059e-01   +5.682941125823425e-01   -3.069367842273185e-02   -6.344310475382412e-01   +2.247350846660429e-01   -1.728847417131412e-01   -2.708797320158121e-01   -2.279277753833963e-01; +2.091483803132028e-01   +4.195724981342855e-01   -8.797770242769837e-01   +5.796529116817385e-01   +2.162201184528494e-01   -4.999823153939447e-01   +2.766671983495981e-02   -2.628691227492695e-01; +4.656448011461629e-01   -1.523844312192932e-01   -3.435562188479365e-01   -2.239543674009150e-01   +7.828766832224110e-01   -2.790762796481101e-01   +2.825491203141704e-01   -9.534689342665896e-01];
L2E_L2I_iGABA_netcon = [-4.704901959506968e-01   -8.963737598006255e-01   +1.613354224379228e-01   +5.003549984252941e-01   -1.884917807452381e-02   +3.091924218312180e-01   +3.149776914338865e-01   +2.312863874900181e-01; +2.642961113106369e-02   +1.000000000000000e+00   +3.377674728585419e-01   -8.683471230454337e-02   -4.652336879652499e-01   -4.781991148645390e-02   -6.826333660706320e-01   -4.534295149803335e-01; -1.925570094568466e-01   -1.684666591269112e-01   +2.987590963230043e-01   +5.389936748686193e-01   -5.075547060854351e-01   -1.282712089710812e-02   +2.340028887054970e-01   -1.076556380050975e-01; +6.334913754039659e-01   +5.177781217787276e-01   +2.472917087868511e-01   +1.697109185293154e-01   +4.998346114622145e-01   -7.147967183086013e-01   +1.830223098476401e-01   +5.651659365400659e-01; -2.988726821432948e-01   -7.094528072303286e-01   -6.111083136740293e-01   +5.156548837938817e-01   +1.342014602725467e-01   -3.064491664254125e-01   +7.056034378440630e-01   -2.304532708924287e-02; +8.175815529102931e-01   -2.193394682294713e-01   +7.521610226652348e-01   +9.632653967022388e-02   +2.743565070665789e-01   +3.510736017125837e-02   +7.010903553940517e-01   +2.706633148382688e-01; -4.348316043475067e-01   +9.756276213833544e-02   -1.115272218708288e-01   +1.143812775552560e-01   -1.391824374612799e-01   -7.860276155314390e-02   +5.785208488651471e-01   -1.981370606244048e-01; -6.918910393639420e-01   +3.180872133013379e-01   -7.791167361878597e-01   -9.777102229293581e-02   +6.481738651705519e-01   -4.474993834303042e-01   -5.339315267841207e-01   -5.640597369930256e-01];
L3E_L2E_iAMPA_netcon = [+3.280576349260249e-01   +2.062913100238329e-01   +2.289662947139988e-01   -2.072529464912100e-01   +2.644813301998659e-01   +1.956929876305100e-01   -3.783310398307591e-01   +4.438160237481713e-01   +3.667122478278183e-01   -1.000000000000000e+00   -9.502807629843096e-03   -5.148860616642928e-01; +5.275378732628847e-01   +1.261435482938677e-01   -2.351048471935653e-02   +2.277828675977465e-01   -1.707803146671188e-01   -8.834443796923558e-01   -4.305396649393793e-01   -6.179891362534138e-01   -2.776811156840274e-01   +6.429178507532894e-01   -4.870219065570610e-01   -2.775149546035784e-01; +7.883221470570082e-01   -4.550162648420706e-01   +1.731344191351165e-01   +4.388772978868126e-01   -5.832442175802096e-01   +2.743244434149518e-01   -7.589711781064882e-01   +1.120117093212403e-01   +4.262345286800531e-01   +5.171099585685659e-01   +4.690179275214414e-02   +8.361695325055796e-01; -3.935932007424900e-01   -7.715835210750343e-01   +3.429801383121226e-01   -6.209251726494174e-01   -4.214590497068924e-02   -4.142040138068837e-01   -6.715625498797113e-01   -4.084852194821079e-01   -5.800398060656426e-01   -1.134658577425874e-02   +3.603289869205376e-01   -5.290845650758845e-01; -7.317618374563409e-01   -3.370377734951223e-01   +4.017295127224294e-02   +5.272514561025378e-01   +6.654262728793395e-01   -2.951914039845596e-01   +3.866493389127250e-01   +5.294095084808574e-01   -3.808970924530021e-01   +3.623248342836634e-02   +3.917520217842521e-01   -7.183103728976238e-01; +6.973814458514739e-01   +1.912354365107468e-02   +1.259352996029240e-01   +4.845319625315819e-01   +9.668383484133639e-02   -4.805528684566410e-01   -9.101564680187852e-03   -6.741514145578870e-01   -2.439611258403255e-01   +2.510486751103511e-02   -5.337674478130385e-01   -7.081098463205077e-01; -2.277707682890477e-01   -2.252483547098063e-01   -6.216554059851940e-03   +3.729144661506531e-01   +6.451490099623940e-02   -2.749691761924022e-01   +1.934391641452359e-01   -1.191643477243219e-01   -2.605184506009997e-01   +4.414407189604201e-01   +5.509392150723043e-02   -4.668710664793178e-01; -6.600596604871127e-01   +4.450973861831682e-02   -3.186767384321281e-01   -3.842221736482146e-01   +3.492413449846688e-01   +1.995676922544249e-02   +4.925814467411314e-01   -1.814181690273869e-01   +3.021967094864624e-02   -1.045700255148692e-01   +2.863990660928826e-01   -4.720366030047922e-01];
L3I_L2I_iGABA_netcon = [+2.316289170033024e-01   +2.053053244559441e-01   -2.149003915284965e-02   +4.050698177425472e-01   -5.058019660969178e-02   +1.298258096918358e-01   +2.789518888520725e-01   -1.589813747516541e-01   +3.921495525432086e-01   +6.306433815260091e-01   +4.744985721539985e-01   -5.477859609113815e-01; +2.334812178145637e-01   -7.147913052496537e-01   -4.455297886685859e-01   -2.485312755746343e-01   +6.039115619627293e-01   -7.792840019487136e-02   +5.671510633754572e-01   -7.080413967491490e-01   -6.516708332243921e-01   -7.243550818118751e-01   -7.391959166638591e-01   +2.456016592665574e-01; +3.868787322925650e-01   +2.377565947915400e-01   -1.492739300926641e-01   -2.035298393747415e-02   -5.019825956600599e-02   +2.213312832585885e-01   -3.109752235874435e-01   +5.675147228944587e-01   +2.349704174523700e-01   +5.173748891811992e-01   +2.261196862951262e-01   +2.660024480252553e-01; +4.435015716737305e-01   +2.175155973009138e-01   +1.370967226327180e-02   +2.933850620033328e-01   +1.000000000000000e+00   -5.391394999722638e-01   +4.334879528932885e-01   -4.246748590351728e-01   +6.311367204998855e-01   +1.680324022536054e-01   -2.607269970584228e-02   -2.160552161036326e-01; +3.733782915985038e-02   +2.666386033802528e-01   -9.127622776471126e-01   +4.417665101912740e-01   +3.675985377591622e-01   -8.823238202214987e-01   -3.548202869977878e-01   +3.393660115768972e-01   -9.344141493447192e-02   -1.423670134413196e-01   -3.362873322225511e-01   -2.288554739896723e-01; -1.049001901031299e-01   +4.022333959445946e-02   -5.173419174600241e-01   -4.054532701705254e-01   -2.208421044698168e-01   +1.902681680970117e-01   +4.811224502533449e-01   +4.235247346088781e-01   +9.010880011885091e-01   -4.403502677419346e-02   +2.364636833043577e-01   +3.410781503541225e-01; -9.331719987147760e-02   -4.090412484010900e-01   +3.257305941908737e-01   -3.742610370488172e-01   +2.770215681150558e-01   -1.603839861189461e-01   +4.163912540902155e-01   +1.717668394017542e-01   +2.002498629335460e-01   -7.549892514967746e-01   -6.301351795831222e-01   -1.231432677830932e-01; -6.206635200742832e-01   -7.199996500114317e-02   -2.383814879247379e-01   +4.783161774656090e-01   -2.238074302520942e-01   +5.386940849779560e-02   +5.383814767354483e-02   +7.889974461755550e-01   -6.644586261533130e-01   +3.697570252795767e-01   -6.425055979177782e-03   +2.387488833064748e-01];
L2E_L3E_iAMPA_netcon = [+8.907203849806661e-01   +9.306550649005486e-01   +2.294210935739085e-01   +4.424822239534036e-01   -5.871108297493587e-01   -4.266888639549604e-01   -2.628220822145103e-01   +7.473742261657260e-01; -3.270969342736351e-02   +4.316796178616876e-02   +2.478859176425254e-01   -4.211700413803522e-01   +2.641423154915069e-01   +1.374169063130313e-02   -1.028336454954408e-01   +1.054826288537221e-01; -4.369649394351079e-02   +1.846642954438943e-01   +3.016479126052993e-01   +9.605246801327286e-02   +2.413793860924245e-01   -5.355732279419977e-01   +4.766260838801281e-01   +3.070932937477108e-01; +6.880784538098297e-01   +6.051747977677804e-01   +3.211086956184735e-01   -5.309569780394267e-01   -1.639954722092605e-02   +1.188407967932751e-02   +9.259579734845357e-03   -3.277519082815501e-01; -1.225548800461027e-01   -1.468829992839092e-02   +5.140358490501609e-01   -3.730664655464658e-01   -6.017989739508207e-01   -1.585630319590588e-01   -6.640943223633645e-01   -1.611665090259502e-01; -1.000000000000000e+00   +8.360840430476256e-01   +7.608992994207605e-01   -5.750969588173842e-01   +3.379100688689912e-01   -5.471439716482416e-01   -2.240246476167978e-01   -1.195993964987046e-02; -5.863035177461133e-01   +3.453202808603994e-01   -2.790476953953374e-01   -4.093361112922588e-01   -2.584879956832605e-01   -2.949763301268841e-01   -2.011582342484629e-02   -1.340755591986687e-02; -8.805661228188273e-02   +1.809227974115438e-01   +2.544717880701453e-01   +6.547300580322346e-01   -6.250051059451864e-01   -5.503594279315248e-01   -2.672757904203952e-01   -4.278595623851282e-01; -3.040216617295155e-01   +6.515093083207363e-02   +3.433750194980519e-01   +2.714804731298036e-01   -3.734509065643705e-01   +5.687666716250610e-02   +5.238543827142615e-02   -7.509257233591391e-01; -1.016897234670502e-01   +9.018320083949908e-01   +6.916991387936871e-01   +4.062558413058497e-01   +2.529113461954073e-01   -2.391814120349395e-02   -2.351853427447450e-01   +2.594217624965106e-01; -3.413301996298482e-02   +3.749336055277541e-01   -6.241558679462690e-01   +3.944176301312580e-01   +5.653957874164187e-01   -6.643853460359102e-01   +6.204000352251692e-01   -1.850938720201372e-04; -5.628805739126733e-01   -4.039295114106532e-01   -2.459932826149722e-01   +8.086128421577317e-01   -2.950513533002067e-01   +4.300245469552994e-02   +1.860683690769558e-02   +3.332194279364080e-01];
L2I_L3I_iGABA_netcon = [-3.201963154903873e-01   -6.914340951861683e-02   +3.417480834298193e-01   +3.640107821439569e-02   +7.994041639278355e-01   -7.841970385083184e-02   -1.448149801558672e-03   +6.633632079956535e-02; -4.111473062030010e-01   +9.278577084350850e-02   -7.600467004643739e-03   -3.652161501357585e-01   +2.095504570408780e-01   +5.007075669565966e-01   -4.569511312071330e-01   +6.209104233515499e-01; -8.769613948378707e-02   -2.999242321770758e-01   +4.679128575869468e-01   -6.441083061456703e-01   -1.599697872653194e-01   +3.072215806645689e-01   -1.218133866540354e-01   +5.835831208742568e-01; -1.983239659314537e-01   +5.732592220743472e-02   +6.136246941639672e-02   -2.346042969522684e-01   +5.280506706126109e-01   -1.325252657031850e-01   +1.859370271827330e-02   -1.395804967523413e-01; +1.383574463578316e-01   -4.528504248808122e-01   +2.106259202063483e-01   -1.881608844957096e-01   +1.903348583908831e-01   +6.303215386167172e-01   -5.095189557422523e-01   +4.160434973516359e-01; -2.067242512916843e-01   +6.741648227051803e-01   -1.000000000000000e+00   +1.048673005996670e-02   +9.619883119972311e-03   +2.095906107863135e-01   +2.744504551721917e-01   -2.572447233087617e-02; -6.447014705010029e-01   -6.043486070438520e-01   +5.209518816189544e-01   -1.479001227589596e-01   +5.224851433175566e-01   +9.283246470768231e-02   +4.175938285110206e-01   +9.194300438931845e-02; -9.939066240699326e-02   -1.088866136645039e-01   +1.030712917871522e-01   +3.243489408400032e-02   -6.085056511331417e-01   +2.269870376717978e-02   +1.376476206412997e-01   -1.435474789606656e-01; -7.699047433290424e-01   -1.761669384392725e-01   -2.509909939028067e-01   +4.682791527757914e-01   -8.061568153368606e-02   -5.213190563205202e-01   -4.951808082645676e-01   +2.321186549298086e-01; +1.330120683936880e-01   +3.700669132104369e-01   +2.286117435830450e-01   +8.142725826245242e-02   +1.739412013090111e-01   -1.412348381972369e-01   -8.740814274101144e-02   +5.921237240564131e-01; +6.894976689080270e-01   +1.700297508470097e-01   +1.544410814872683e-01   +6.661405140787051e-02   +5.204660152242956e-01   +2.357740474498380e-01   -5.408313683846217e-02   +3.607887703198582e-01; -2.390740337112739e-01   -4.311713941731392e-01   +3.208974892669366e-02   -6.570626751334246e-01   +3.393263335777426e-01   +3.162419238152304e-01   +2.220492256073872e-02   -4.832515154668855e-01];
L3I_L3E_iAMPA_netcon = [+1.394868251023405e-01   -5.122248379553380e-01   +7.228840810672026e-01   +3.489834429405291e-01   -9.079855872325115e-02   +2.443328693848648e-01   +3.924389986078518e-01   -4.471904860122510e-01   +4.373920701222560e-01   -8.137246111101311e-01   -6.690401797134318e-01   +7.923544651570197e-01; +7.086735430695774e-01   +8.747704771990783e-01   -2.011228040599757e-01   +2.962845877697080e-01   +5.063642421497836e-01   +7.455117426935214e-01   +8.152919644051227e-01   +5.008174771668931e-01   -1.963196833917438e-01   +2.949201874352545e-01   -6.516060935731098e-01   +4.901596863776712e-01; -4.504510196197548e-02   -3.921216448421027e-01   +7.259527071198746e-02   -2.833307331418232e-01   +5.585076929255328e-01   +4.549293209766297e-01   -7.703991772076729e-03   +6.349119596059573e-01   +8.811945678062828e-02   -7.186840238442005e-01   +6.749310594462582e-01   +2.271655926186874e-01; +4.654874252830976e-02   -8.218260698864327e-02   -7.097118374808561e-02   -5.280897437062531e-01   -8.481319039611104e-02   +1.465888872914315e-01   -5.804650924954209e-01   +8.292837671162038e-01   -9.014085467049349e-03   -3.605762091750009e-01   +4.984968382455524e-01   -4.891024248288826e-01; +4.829460010158205e-01   -9.445873163827252e-01   +2.728235518962764e-01   +4.098093278144975e-01   +5.007312283203980e-01   +4.806222281112670e-01   +1.711043100622795e-01   +2.881294685700078e-01   -7.067422107621529e-02   -8.152546059641523e-01   +3.535841682765349e-01   +8.968306001470822e-02; -1.302946647824316e-01   -9.449569200935407e-02   -1.701703479439225e-01   +6.825235061158408e-02   -1.169918274188361e-01   +4.393431320383746e-01   -3.117067791112887e-01   -2.462035693901884e-02   +3.827205405641106e-01   -1.326096549191727e-01   +6.276119364957232e-01   -5.048893300439151e-01; +8.044355363478570e-01   -3.631138993452646e-01   +2.981219222836473e-01   +9.358498214712314e-01   -5.986554182521817e-01   -1.952409199153503e-01   -7.611581814780268e-01   -2.540460004504491e-01   +6.791125707004937e-01   -2.056670388153565e-01   -9.738351984694862e-02   +2.200784457713554e-01; +6.639034478153785e-01   +3.602345703066289e-01   +2.844898862084191e-01   -3.178011390287303e-01   +5.082481543453772e-01   +6.553166199603946e-01   -3.445164828164423e-01   -7.787973285229561e-01   -6.868859240284122e-01   -2.727024783484595e-01   +5.585636158969161e-01   -6.512781513825869e-02; -1.350904675920085e-01   +3.506245602822366e-01   -1.785267870487106e-03   -6.371722973810114e-01   -5.390106089219736e-01   -1.788419880862815e-02   -1.161870073105447e-01   -7.856338534515729e-01   +6.309642072358176e-02   +2.157027472383506e-01   -9.533368905060675e-02   +8.421416279431160e-02; +5.323358931767118e-01   -3.064014811577541e-01   +2.047563196659868e-01   -1.527906357352685e-01   +3.664859204936169e-01   +3.095032386126276e-01   +3.415828965434299e-01   +3.434776175730297e-01   -6.665986338713246e-01   +2.607784864935519e-01   +6.128482682531851e-01   +5.296718709634411e-01; -4.180359894851737e-01   -5.409307032383416e-01   -7.527061947025321e-02   -3.893883325724251e-01   +9.564637665269573e-01   +2.064602357513111e-01   +2.568156797707812e-01   +5.354866763755832e-01   -1.371881187472266e-01   -1.501777410145670e-01   -1.235050641481421e-01   -6.342261676379211e-01; +3.261605831360517e-02   +2.489716240369331e-01   +1.018609854485153e-01   -5.709266693499526e-01   +6.507254382729053e-01   -7.270703980562510e-03   -1.255183817074727e-01   -3.349453495169440e-01   -2.491530150961833e-01   +9.402653730180184e-01   +1.246785256303374e-01   -1.242963222302246e-04];
L3E_L3I_iGABA_netcon = [-6.902939137758257e-02   -1.171760368811879e-01   +3.014175702199990e-01   +2.630669474076284e-01   -1.774991770894277e-02   +1.665074501280057e-03   -4.767013095799655e-01   -4.511727647928716e-01   -4.622946470700943e-01   +3.666609258805267e-01   -4.041662125565969e-02   -4.496654252732338e-02; -3.729217891375741e-01   -6.549280435475026e-01   +4.299003346836323e-01   -1.257226061996394e-01   -7.320641789016505e-02   -8.538169305032853e-03   +5.969203936283732e-01   -5.600818612518224e-01   -1.903162528251012e-01   +3.877673616969106e-01   +3.744909673892978e-01   -8.819725044051951e-02; -3.119799674127858e-01   +4.747373047955540e-01   +8.164738032185579e-01   -2.775912461545247e-01   -7.715107377653452e-02   +2.644604067205861e-01   +3.743187945556182e-01   +4.365892585016884e-01   -4.435328876249325e-01   -1.426024678801230e-01   -4.780064599612195e-01   +6.690042026748223e-02; +3.548239777311512e-01   -9.635279230970484e-01   -5.725926128280953e-01   -5.058795879267252e-01   +3.110640147717216e-01   +4.869834206773346e-01   -2.300114352422537e-01   -4.885475631258325e-01   -1.536496541502132e-01   +2.407938665458533e-01   -6.594151066134348e-01   +7.905976029198257e-02; -1.000000000000000e+00   -2.499070979131157e-02   +1.476178927359735e-02   -6.601379547980010e-01   +6.515220962547985e-01   -2.402903526237706e-01   +2.979112288934830e-01   +2.118528588387759e-02   +4.525967648277394e-01   +2.425367499367513e-01   +3.610392250639265e-01   -6.805646369795910e-01; +4.193919459572796e-01   +4.228001674956929e-01   -1.786442236469735e-01   -2.626225067669441e-01   +1.056063964153797e-01   +1.921417821828565e-01   +1.649684342333497e-01   +5.153623597874367e-01   -4.994782796591197e-01   -3.842199262786811e-01   +3.299940663782093e-01   -1.227817562940630e-01; +4.828890894691553e-01   +3.761300612534968e-01   +1.480756548621254e-01   +3.012290309288880e-01   -4.582204824910395e-01   +8.451161516429037e-01   -6.699051891547312e-01   +2.390288882934540e-01   +4.583602932572764e-01   +5.867069981605355e-01   -7.265955962910832e-02   -2.384896954032837e-01; +1.182153261831044e-01   +7.391171298412955e-02   +4.798030546379777e-01   +4.460986730377296e-01   -3.919817333889018e-02   -2.969895163092816e-01   +6.601006218781900e-01   +6.169833428867726e-01   -5.478260582396733e-01   -2.054961392905197e-01   -4.050056300326380e-01   -3.941670031425852e-01; +3.040097443304895e-01   -4.384716285750427e-01   -6.593594716819841e-01   +3.635382986660650e-01   +1.381105212300714e-01   -4.335122503792275e-01   -5.436719431816559e-01   -2.371780265220933e-01   -7.219713952070125e-01   -5.865189839221022e-01   -1.435370463876617e-02   +3.883327754768602e-01; -3.088123522673519e-01   +3.713107596792822e-02   +1.953832120120109e-01   +3.992148861500114e-01   -3.661953346055354e-01   -3.569214750035041e-01   -4.969902438072955e-01   +3.268810951705636e-02   -1.084833474815336e-01   +3.051669868534075e-01   -4.024340124249282e-02   +3.258248714864532e-01; +2.791565200793323e-01   +4.698218333443084e-01   +7.225678059445262e-02   +4.202376239007745e-01   -3.711688291899994e-01   +3.181178201799555e-01   -7.483641947369950e-02   -1.731860669778743e-01   +1.820711496406145e-01   +3.748907941036698e-01   +4.639454755016068e-01   +9.771828283080010e-02; +4.276057264359190e-01   +1.817898665512461e-01   +5.283456505131433e-01   +3.455026460019507e-01   +7.324019401332428e-01   -2.191423358426744e-01   -9.352564370718705e-03   +3.495213734190915e-01   -1.658634556823288e-01   +4.290495402966013e-01   +9.802623394849704e-01   -3.234718716926484e-01];
L2E_Input1_iAMPA_netcon = [+1.632291068955821e-01   +3.908251256225521e-01   -4.518031779607296e-02   -8.722256047747502e-01   +2.889775163245200e-01   +5.110451770788632e-02   +6.577602166910168e-01   +2.795617571071785e-02];
L2I_Input2_iAMPA_netcon = [-8.684705990864395e-01   -1.597913849965753e-01   +6.863433083959422e-01   -3.331916597059087e-03   -4.310971054225619e-01   -6.887636907710359e-02   -3.423420384826210e-01   -4.376200677624724e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
