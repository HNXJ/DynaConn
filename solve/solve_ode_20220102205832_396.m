function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.755064297333589e-01   -3.857512585069248e-01   +2.976136976497237e-01   +1.672302222115352e-01   -9.295814202357436e-02   +9.539548629103328e-02   -5.541120915717671e-01   +2.155660152014874e-01   +5.959184810493835e-01   +4.038439612661320e-01   +2.438565193819336e-01   +1.297514721798415e-01   +2.742208270042991e-01   -9.337621693362387e-02   -1.396121807740439e-01   +1.252426945372641e-01; +6.476866095451783e-01   +2.597384475043671e-01   -1.002812626963848e-01   -1.559057810425549e-01   -1.138291337267779e-02   +5.146725317638270e-01   -4.822219400611221e-01   -1.482851270473074e-01   +4.164968191419360e-01   -1.186208000091004e-01   +5.049884835203946e-01   +4.500232095229113e-01   +4.914290535752990e-01   -3.500386417159590e-02   +1.095898898004752e-01   -1.675023226284485e-01; +4.968590114837013e-01   +1.054864831497841e-01   +3.274571096321949e-03   +4.063982801768883e-01   -1.204660811707026e-01   +2.167140213381725e-01   +3.245600652285847e-01   -1.305938734426610e-01   +3.629630058215167e-01   +3.256330456280043e-01   +5.797515492902487e-01   +2.998479569914034e-01   +1.180186929828285e-01   -4.720790528946350e-01   -2.729362016991224e-01   +1.492181468108312e-01; +1.866785224640131e-02   -1.121665160298963e-01   -1.410227831892005e-01   +7.059990949104504e-01   +8.815126732354324e-02   +6.441727107041277e-01   +7.277399273268603e-01   +8.621216517111310e-01   +3.924231815246625e-01   -2.542876214454830e-01   +5.126822699536803e-01   +2.296929215419300e-01   +2.106535394569050e-01   +5.313399347294707e-01   +2.638948773970859e-01   +8.117989166206481e-01; +1.047111501062114e-01   +2.762785141421921e-01   +5.411831417766289e-01   +5.218475230015733e-01   -1.169143832015518e-01   +2.373035687942646e-01   +1.506628229689973e-01   +3.982803267554101e-02   +3.865996818615408e-03   +5.345228434483974e-01   +7.396378785958958e-01   -1.252886902630546e-01   +4.090903317267197e-01   +8.733254638791366e-02   +1.969439233090110e-01   +3.153438922913896e-01; +5.589320260992020e-02   +7.189829905123268e-01   +3.194322293039006e-01   +4.629024110712997e-03   +4.139578821319911e-01   +3.479888128741593e-01   +3.681741056897304e-01   -2.779117116240186e-01   +4.060030706747478e-01   +9.957207975801455e-02   +6.079475939768053e-01   -3.099499608387976e-01   +9.227913505713270e-02   +1.319187296446193e-01   -1.377795523439305e-01   -6.620918567791974e-01; +2.678652120862463e-01   +5.086043274712059e-01   +4.626333693779840e-01   +4.455651073131208e-01   -1.984526478450098e-01   +3.291916373771949e-01   +2.206690383573946e-01   +5.960281887106414e-03   -8.764954419391768e-01   +3.255508603236896e-01   -3.069254591944244e-01   +1.257819053644672e-01   +6.130809854860183e-01   -3.209880893653915e-01   +4.507466515723946e-01   +7.593338288030191e-01; +4.350410648763478e-01   +4.366779065615904e-01   -8.757685334319257e-02   +4.190275585290705e-01   +2.865932477315788e-01   -1.840125941537109e-01   +3.633859989107758e-01   +4.077891750470242e-01   +4.191971890546360e-01   -1.624114340115587e-02   +5.830039886300551e-01   -4.960015020002047e-02   +1.058599028228465e-01   +2.626963526735849e-01   -1.617724834075804e-01   +2.163554648663503e-01; +1.680732079815124e-01   +6.521100476424762e-01   -2.778619291077566e-01   +2.120685572419438e-01   +3.783858316004401e-01   +7.138194382852014e-01   -3.852130551503499e-02   -4.509385680886167e-01   +3.801255228324452e-01   -1.179350265284786e-02   +5.451650743586470e-01   -6.590936106093229e-02   +2.291749271077133e-01   +3.691159054635183e-01   +4.039837416552144e-03   -2.705254960829170e-01; +3.569596230347158e-01   +8.589080594804404e-01   +3.289536447672919e-01   +1.817519137928135e-01   +7.230732180672081e-02   +1.483013333609023e-01   +5.035404842983439e-01   -1.875542300165141e-01   +2.503471375292625e-01   +2.438840673718958e-01   +9.049357091073071e-01   +1.812385893159497e-01   +4.319744829366372e-01   -1.090691436624552e-01   +2.248174724669971e-01   +4.895130314670754e-01; +2.455930641918159e-01   +9.662479876614736e-01   -9.191262069749948e-02   +2.697028085576211e-01   +6.628650585147775e-01   +1.169915594428409e-01   +1.271781883503776e-01   +3.495481698203051e-02   -8.096491193021910e-02   +5.604983796612937e-01   -3.426640192297151e-01   +5.859278657329309e-02   -6.063508996708933e-01   +1.757747439683369e-01   +3.324150898164030e-01   +1.968806073443921e-01; +2.823068445505821e-01   +4.354924972191117e-01   +5.150359648514685e-02   -4.955357934827880e-02   -6.296926881078238e-02   +1.434249115377158e-01   +4.787393303110533e-01   +2.545460463421740e-01   +5.391794807579287e-01   -2.687352543528921e-01   +4.756740976742395e-01   +8.814389917891615e-01   +7.222762201615780e-01   +1.474381537327132e-02   -2.982303601528805e-01   -1.332858044341945e-01; -1.352131121713666e-01   +1.575180925062070e-01   +5.350596549566995e-01   +1.745301912244733e-01   +9.543175569466986e-01   +5.806711393210724e-01   +1.112032317353105e-01   +1.270790418718719e-02   +5.565150572791923e-01   +4.065103132008900e-01   +4.513318019266062e-01   +4.216053369247174e-01   -4.176161621140518e-01   -7.036907712907747e-02   +3.227965014179684e-01   -9.157025469728688e-02; -7.416074213315901e-03   +3.049309467144955e-01   +1.540551931231912e-01   -3.735511353765776e-01   +2.848973748155309e-01   +5.227832334231250e-01   -1.984897294841910e-02   +2.959954677753091e-01   -2.121859474966967e-01   +8.684694514559199e-02   +6.796905145333112e-01   -1.509632951753429e-01   -7.546589123284975e-02   +7.148082254811029e-01   -1.418242803558850e-01   -1.839999001370467e-01; +4.925655732011678e-01   -3.539395677970139e-01   +4.922900053561798e-01   +2.501473359131826e-01   -2.737300839576318e-01   +1.685526663181661e-01   +3.836091613402264e-01   -2.686555839334068e-02   +2.948408304524988e-02   -3.842875624970462e-01   -6.902966600033444e-02   +9.483689439734475e-02   +5.851540885160746e-01   +1.973958237257118e-01   +3.126115534430292e-01   -3.069534269131029e-01; -5.359650625566181e-01   +2.500406828245606e-01   -1.045400301710126e-01   +2.493066539288860e-01   +9.125193428120597e-01   +5.203896560946563e-01   +3.993087462853110e-02   +7.193345228397412e-01   -1.378481838387430e-01   +5.043267163922613e-01   +6.474761333519699e-01   +4.047987289543313e-01   +2.351199644606007e-01   +4.806521608940901e-01   +4.542700212900612e-01   +7.771368570530637e-02];
L1E_L1I_iGABA_netcon = [+1.337494015631608e-01   +3.685456864851462e-01   -3.899960959968628e-01   -2.748989000506147e-02   +7.855413706855808e-01   -2.924609091375438e-02   +5.254595948254361e-01   +2.551752754656256e-01   -5.170020935596675e-02   -3.014670540757864e-01   +1.262007199074921e-01   +2.559028622568434e-01   +7.446763424008833e-01   -2.963350253737052e-01   +4.410057172707342e-01   +8.712858786861117e-01; -4.314639052885830e-01   -2.995225502279564e-01   +5.541694227625067e-01   -5.698294266727528e-01   +2.772120558096126e-01   -3.932939218180635e-01   +4.416768955092771e-01   +5.768548676270659e-01   +2.180443556220306e-01   -1.176751786890354e-01   +2.127098570256609e-01   -3.288182663895424e-02   +5.507739349422526e-01   +2.844574561094408e-01   +4.151203274494619e-01   +4.805017192672408e-02; +4.906194566090481e-02   +2.756598330083582e-01   -5.113659520561530e-01   +4.730551528412685e-01   -1.451257771316389e-01   -1.812035610209536e-01   -8.548940125253385e-02   +2.607821469150667e-02   -1.473751107726581e-01   +6.903352829508269e-03   +7.889239373666751e-02   +2.443483316335149e-01   -1.307047993541631e-02   -3.492306232451636e-01   +5.539891028293433e-01   -2.465603644959655e-02; +4.838060408132342e-01   -4.229556850544781e-01   -2.871698043769996e-01   +1.744733939384490e-01   +1.159345483605532e-01   +2.581685670664975e-01   -2.683379803985257e-01   +5.367140700229218e-02   -9.764167831412748e-04   +1.413385797317896e-01   +2.322866626117022e-01   +2.138511931499882e-01   -2.217658470101663e-01   +3.709853246502313e-01   +7.113205511016683e-02   -2.084361334463692e-01; -2.054354101673380e-01   -1.229457373387443e-02   +2.422501217378979e-01   +2.985844500445622e-01   +5.163707950245018e-01   -1.160295509712290e-01   +2.661361425964586e-01   -5.766490960371413e-01   -2.000607027013578e-01   +2.662504563324714e-01   -1.768068090462292e-01   +5.392909580707808e-01   +4.641768198422402e-01   +5.715085376318907e-01   -4.772200525551669e-03   +6.481786111429716e-02; +1.987626763907928e-01   -1.531982148087108e-02   +1.021180826568576e-01   -2.624566100590137e-01   -2.814290025753602e-01   +6.933870301714459e-01   -5.868583631332406e-02   -1.824214852289656e-01   -2.388826623806371e-01   +1.191548467332540e-01   -2.797040530407225e-01   +5.762178484080170e-01   -2.093308103821600e-02   -2.437447876126197e-01   +2.516887450121739e-01   +1.411833437262851e-01; -2.830938376388801e-01   -1.516106645933541e-01   -4.313969329362430e-01   -3.792291633077787e-01   +5.975567765997599e-01   -1.077028354014722e-01   +1.375598584586309e-01   -1.921391645649561e-01   +2.340081921673698e-01   +3.223756972490687e-01   +7.479241866228392e-01   +2.167340718188700e-01   +1.521309210147539e-01   +1.178320090955195e-01   +8.921138018931654e-01   -2.326742661630367e-01; +8.306023307391072e-02   +4.186685014487341e-01   -1.458189610568517e-01   -7.250983343658457e-02   +1.593325294776067e-01   -3.716888648649644e-01   +8.695202158752554e-01   +1.272623550422447e-01   +4.989704451998036e-01   +1.516742931171033e-02   +1.568368957948249e-01   -2.019457589146722e-01   +6.284295920156618e-01   +4.931819461084633e-01   +4.044392115846394e-01   +5.838626240070957e-01; +4.536943825232396e-01   +7.780299063140458e-01   -3.408448866732933e-02   -1.890839406468527e-01   -4.132047194367158e-01   +5.879551114462829e-01   +7.912448645795878e-03   +7.001960522315970e-03   +4.578332650468286e-02   -2.206348598974799e-01   +1.478034889090456e-01   -1.902561070578015e-01   -2.679644088707347e-01   -7.645221812714031e-02   +6.625195385820571e-01   -3.472026672840038e-01; +2.032398742788022e-01   +5.363691806272940e-01   -6.253653580050543e-02   -2.936988518292085e-01   -4.061318510804466e-01   -4.541712801344175e-02   -2.697020266026189e-01   +4.627214288581812e-03   +4.659290468321280e-01   +2.409013378803981e-01   -5.337926638423964e-01   -1.109429915417827e-01   +4.668841217569264e-01   +5.535249499315035e-01   +2.831663566648600e-01   +4.580317936061967e-01; +2.988435383585086e-01   +1.860188271992018e-01   +1.955202210403685e-01   +6.903227431722941e-01   +4.420133407806918e-01   -7.236697123039183e-02   +1.301485284309060e-01   -1.248996839011137e-01   +6.808298787551381e-01   +2.506984933185162e-01   -2.496783979756290e-02   +4.068992800063410e-01   +8.420722188533025e-01   +4.416397371477636e-01   +3.798512891482329e-01   -3.848548499996398e-01; +2.612265297157463e-01   +9.815242349749417e-02   +3.953735868670594e-04   -7.795104141123639e-01   -1.967529870007607e-01   +2.648942480164408e-02   -1.102236481163498e-01   +9.549147835727551e-02   -7.405287567980157e-02   -1.763349145220880e-01   +2.971455014989721e-01   +2.479066871927521e-01   +2.785256242296108e-02   -1.817838070456974e-02   +3.297864962827285e-01   +2.300813055304210e-01; +2.566909792305221e-01   +6.494556680694131e-01   +9.199618654475869e-02   +2.539714020386329e-01   -6.373785520385061e-02   +9.348964601182494e-02   -1.593039820982440e-01   +4.121108869577857e-01   +5.804465117869096e-01   -2.694284027334420e-02   -6.382217233640275e-02   +1.224588476546620e-01   +2.968666870825025e-01   +2.253813421013553e-01   +4.562604420550972e-01   +3.480763111780486e-01; +6.386167699752566e-01   -7.229249950235558e-02   -1.964068736976059e-01   +2.919473497720210e-01   -4.812390602070694e-02   -1.576363357657982e-01   +2.529940568620430e-01   +1.320480887661192e-01   +5.188783514036305e-01   -4.041442554362819e-01   +1.480181972625444e-01   +2.098484660122902e-01   -1.082332091985495e-02   -7.212023539147747e-02   -8.900982164016180e-02   -2.744018499311733e-01; +4.202035422131550e-01   +3.254393373898520e-01   +2.141524805869883e-01   -1.341470535348002e-02   -3.984894111923232e-02   +1.727800237575547e-01   +2.048296578796118e-01   -1.051494635264239e-01   +4.135108109890412e-01   +3.718172418764580e-02   +4.007265934727084e-01   +1.410402338357829e-01   +1.305004006798481e-01   -6.783310727220195e-01   +7.044739272031744e-01   +1.969581150945194e-01; -3.009243682584375e-01   +4.188442835543164e-01   +5.187417731206123e-04   -1.367316687665649e-02   +1.024436388718133e-02   -2.085823182728501e-02   +1.505517497121813e-01   +4.419636048333184e-02   +6.622930612472237e-02   +2.392026665711982e-01   +8.539084637553834e-02   +1.836759131182040e-01   +3.293998629416751e-01   +1.612348006443304e-01   +1.154964490914223e-01   +5.316989938305782e-01];
L2I_L1I_iGABA_netcon = [-1.662272013173659e-01   -2.089718877521056e-01   +1.296494457174710e-01   +1.142628599318859e-01   -2.707630581030968e-01   +2.804841817166053e-01   +2.326882663309933e-01   -3.534550642927697e-01; +3.470853767036717e-01   +7.198953871485066e-01   -1.526808826078002e-01   +2.585683057834706e-01   +6.853682888463287e-01   +4.364945297201602e-01   +1.451031315942195e-01   -3.576735524147565e-02; +6.135946585481021e-01   +5.410080820776385e-02   +2.509957209045968e-01   +2.561627239728448e-01   +2.983368056934108e-01   -4.067853510086998e-02   +2.650261794716988e-02   +4.560440219383879e-02; +2.929903782631784e-01   +9.675675502671720e-02   +7.588349158435721e-01   +3.929377981893036e-01   +4.584955339185819e-01   +4.425403728443079e-01   +3.975901669755769e-01   +9.602326048546027e-02; +2.459247302308429e-01   -1.354600605710225e-01   +5.627112055497437e-01   +2.891668882256476e-01   +4.778172165114357e-01   +9.720920850696757e-02   +3.852405884720643e-02   -5.333797119409130e-02; +2.593086226117833e-01   -2.774917858000598e-01   +2.037078204922112e-01   +2.580325493255636e-01   +1.418369960590292e-01   +3.188843971169251e-01   +2.316015846991398e-01   +6.362012981112574e-01; +4.684896268676038e-01   +3.735723052250359e-02   +4.052101687895593e-01   -1.017995811781068e-01   +2.432312070195813e-01   +7.452720369218339e-01   +4.716794888785340e-01   +4.688759440236210e-01; -1.003823722591526e-02   +2.827354128853399e-01   +1.871471381606344e-01   +3.955240152846192e-01   +2.859976179935156e-01   -2.009480213186694e-01   +4.244869737362982e-02   -5.002806535389032e-02; +3.769129347388021e-01   +1.000000000000000e+00   -5.296030462061238e-01   +4.532819272761434e-01   +4.811232293453523e-02   +3.585400752129365e-01   +3.542249563990745e-01   -1.712205666429971e-01; -8.208010510543462e-02   -1.382928991706857e-01   +1.966751901564590e-01   +7.905888039460242e-02   +5.538640946889587e-01   -2.509964740971390e-01   -1.570970405658047e-01   +3.837645879528725e-01; +1.991614485013144e-01   -9.362866992220302e-02   +2.268732647849626e-01   -2.333494884037087e-02   +1.466107375826244e-01   +1.039500001962569e-01   +2.774023531651834e-01   +1.826795993491786e-01; +4.036475200811297e-01   +3.537955093404671e-01   +2.300550599454684e-01   +8.373805845378617e-02   -6.066163418292396e-02   +1.348213793064732e-01   +6.483437031278434e-01   +5.139065207164868e-01; +3.694365718036447e-01   +3.095270087929969e-01   +3.295944783431618e-01   +1.752886390892839e-01   +4.053821707323039e-01   +1.466111799891296e-01   +7.587601547789100e-03   +2.051107719715314e-01; +1.312806627808210e-01   -3.093256173678444e-01   +2.605774490328808e-01   -4.683772517996661e-01   +3.691514351188431e-01   -2.231004783489492e-01   +4.241579608991543e-01   +3.245261096240512e-01; +3.335528437991806e-01   +8.936317110155048e-02   +3.084256003481679e-01   -4.998414936252361e-02   -1.150121404204088e-01   +9.742507067478359e-01   +5.036830613874855e-01   +7.810053600994480e-01; -2.543960692178209e-02   +2.081513195523928e-02   +2.478501441087752e-02   +5.074042656116934e-01   +9.047203986044157e-02   +1.738535510576764e-01   +7.752999027916056e-02   +8.674279144848719e-02];
L1I_L2I_iGABA_netcon = [+3.329661528566358e-01   -3.341765583273255e-01   -9.843971023797018e-02   +2.792432854672984e-01   +2.588794571611742e-01   +1.167147735686994e-01   -4.283747252678539e-02   +5.891603603876821e-02   -1.912489965019972e-01   +3.562887347849087e-01   -1.651945344633006e-01   +1.259669554176107e-01   +1.224662525666335e-01   -1.359341690356496e-01   -1.159427223468306e-01   +2.348340221127578e-01; +4.806313085395557e-01   -3.182310708783134e-01   +2.025602386203252e-01   -3.131168880302982e-01   +5.137262788596750e-02   +1.474214449519748e-01   +3.573274035731327e-01   +2.801792690200145e-01   +1.063422035531309e-01   +6.567498305458217e-01   +1.190867831850782e-02   -2.645069332824250e-01   -3.676333997487394e-02   -3.661975891989667e-01   +3.788287589537888e-01   +3.416339426319395e-01; +2.436483340803209e-01   -3.111370710068287e-01   +5.056229825803221e-01   -4.268417994609135e-02   +1.535963667473761e-01   -8.990009300812031e-02   +5.026891462802282e-01   +3.334530566568734e-01   -1.084830059038957e-01   -1.677731489740766e-01   -1.419762445965133e-01   +7.505131282456186e-02   +2.315990646504549e-01   +6.526690204588769e-01   +1.000000000000000e+00   +1.159132899390101e-01; +3.784223710199903e-01   +6.768707600645895e-01   +4.180608882947177e-01   +1.723088773057787e-01   +4.867393896770712e-01   +6.306152744246980e-01   +4.971633001381158e-01   +2.868632925976671e-01   +2.453779200584164e-02   +8.143011497498536e-01   +4.141737969522940e-01   +2.981750657464270e-01   +4.201494842988042e-01   +2.673664090794655e-01   +2.296484433444492e-01   +2.665520329678814e-01; -5.046654816008429e-01   +1.542463702387577e-01   +3.521723686792600e-02   +3.867901177832756e-01   +1.087858042399472e-01   +6.942112621936816e-01   +3.803802729088541e-01   +5.355373671349261e-01   +5.207546881024643e-01   +3.586509619396751e-01   -2.149550637022390e-01   -8.184474937928235e-02   -5.857098453764547e-01   -6.742273417212910e-02   +2.926592317375538e-01   +4.942259200643092e-01; +2.807722740769568e-01   +2.841461914380448e-01   -3.275941726959989e-01   +5.987393270431893e-01   -1.497110481400173e-01   +1.680906333193091e-02   +3.579016591846187e-01   -2.576921551595192e-01   +1.402610845767457e-01   +7.300399841411950e-02   +5.108574110232787e-02   -1.870896075269194e-01   +4.402155841138553e-01   +9.912852615601615e-01   +1.643655154384706e-01   +2.130549766901706e-02; +2.850911902791220e-01   +3.800835134013929e-01   -3.695698174034255e-01   +1.596810151451627e-01   +4.179549562303543e-01   -3.901793381519225e-01   +3.283007068569547e-01   -2.645910121028708e-03   -2.130156958274581e-01   -1.502730236096149e-01   +3.262110854631680e-01   +2.297669068152050e-01   -5.395278159434901e-02   -7.592686212374836e-02   -3.555253524126433e-02   +3.245385967918641e-01; +4.901448883526368e-01   -4.025592526770713e-02   -3.656362862872172e-01   +1.794900570295682e-01   +1.659759823421106e-01   +3.356866084975815e-01   -7.018865836225950e-02   +2.333116536182486e-01   +7.228916105142268e-02   +1.622208121643249e-01   +1.052307237049443e-01   +7.727165491285838e-01   +9.406268044133546e-02   -4.550566549935502e-02   +4.703000738444965e-01   +4.609977359752305e-01];
L2E_L1E_iAMPA_netcon = [+4.440649503618123e-01   -2.276930781998255e-01   +6.207883650893292e-02   +4.536272372400559e-01   +8.175007242387762e-01   +5.426611650246930e-01   +5.565454100927799e-01   +2.121080151097597e-01; -2.325014194520540e-01   +1.734236824238343e-01   -1.284330782414737e-01   +5.686060038274492e-02   +2.563653671884339e-01   +3.327005509099140e-01   +4.198916679467715e-01   +2.941074919145400e-01; +3.898362189732404e-01   +2.745782262248409e-01   -9.194955377068697e-03   +4.314756578994196e-02   -1.715350048305054e-01   -2.418054837802650e-01   +7.362919907071912e-02   +3.107046227310814e-01; +4.985937942004287e-01   +6.686866828949441e-02   -3.978998447866418e-01   +5.106419559380015e-01   -3.991328461314688e-02   +2.217868622437828e-01   -4.294771163812109e-01   +4.940127253295170e-02; -9.497642954549569e-02   -5.554029340147829e-02   +4.320181994345919e-01   -2.103280749039937e-01   -1.552210609706629e-01   -7.373855771499176e-02   +1.440851704542856e-01   +3.279474842290065e-01; +4.859395172623220e-01   -3.706464527519845e-01   +1.418184479172862e-01   +2.087214075165710e-01   +1.579828804742183e-01   +8.016668515125569e-01   +4.782563455889593e-01   +4.169604570790861e-01; -1.193683636856772e-01   +4.536112264091097e-01   +1.783407383374797e-01   -8.478452207731031e-02   -1.000242023469099e-01   +1.918717337820615e-01   +6.709237681256761e-01   -4.392043922127935e-01; +9.674981004162594e-02   +2.897062453514892e-01   +1.000000000000000e+00   +1.274398869542546e-01   -2.173742894765133e-01   +4.111598970483041e-01   +2.138815623180619e-01   +1.719040088312354e-01; +4.853184289940647e-01   -2.286437111256829e-02   +3.852546130736319e-01   +5.113173864478591e-01   -3.148158466495069e-01   +6.049710590039376e-01   +4.172019477573297e-01   -7.070334819104419e-02; -8.936936948437502e-03   +1.990149721075138e-01   +2.382041713157861e-01   +1.250366841962492e-01   +2.186400171981615e-01   -3.241509827605322e-02   -5.294894606260696e-02   +5.656297718714573e-02; -1.711836361560118e-01   +5.454888675784536e-01   +5.985866109683731e-01   -2.169285683059482e-02   -1.744184145470482e-01   +3.308649744798661e-02   +6.513228428794614e-02   +2.619075518767031e-01; +6.930329851057995e-02   -1.154433432826522e-01   +3.957331319974452e-01   -8.002645635301738e-02   -2.081427459258886e-01   +2.254910538293099e-01   -2.939586260830266e-01   -1.632159652739778e-01; -1.807459818473699e-01   +2.558461411609082e-01   +1.153643363785711e-01   -3.176065386828729e-01   +7.160743829094849e-01   -3.824039098480984e-01   +3.581265691351582e-01   -1.185381663734193e-01; +1.305633896577073e-01   +7.743523010781547e-01   -2.856790788414676e-01   +1.504576440932779e-01   +3.821805133608845e-01   +2.710287136084503e-01   -6.288604807294970e-02   +1.676624398334919e-01; +2.541699164669538e-01   +6.236711593037119e-02   -8.891809804399575e-02   +2.543602133468888e-01   +1.840835873710941e-01   -1.920586048813152e-01   -2.606162418651805e-01   -9.229975780696321e-02; +2.347574295223711e-01   -1.360309634358536e-01   -3.745853296411054e-01   +4.861478493236816e-02   +3.315871734607223e-01   +3.533665430403180e-01   +5.609340113207232e-01   +1.558994070924756e-01];
L1E_L2E_iAMPA_netcon = [+2.828356220668096e-01   +4.107261345996984e-01   +2.944524706360589e-01   -3.612795258020389e-01   +3.225071469069067e-01   +2.086171809461431e-01   +9.161877307561464e-02   -3.188373967703723e-02   -1.831294965205202e-01   -1.309514037257668e-01   +5.183135637113812e-01   -1.347423583642514e-01   +2.124513641796819e-01   -6.529399624287113e-04   -3.073816054302044e-01   -1.454820467364382e-01; +9.069902172393543e-02   -3.697173877483662e-01   +6.233968185239567e-01   -3.445556136394369e-02   +1.095871476429362e-01   +2.381952497621728e-01   +4.650719580692499e-01   +1.087107737460107e-01   -1.998162931840455e-01   +1.027409585388230e-01   +4.166978032182266e-01   +4.313319986559989e-01   +4.025740236023774e-01   +1.445335479028017e-01   -6.585209455307417e-02   -2.792783494263326e-01; +8.890211152458369e-01   +1.115110480180954e-01   +4.310454569716757e-02   -5.936144062640423e-02   +1.842384968535325e-01   +2.159076891643118e-01   -9.715456730545753e-02   +2.708425867386900e-01   +5.734596880913524e-02   -4.085761381513935e-01   +2.423653716627843e-02   +4.730600209522354e-01   -5.056429763189110e-02   +4.781403436061722e-01   -2.071094077038857e-01   -1.870327322161556e-03; -7.650895086703552e-03   +1.772186079458719e-01   +1.265587831817931e-01   +2.626247012001963e-01   +9.407039035104722e-02   +5.142710940265434e-01   +9.909055353719101e-01   -2.790682578054655e-01   -2.533870320755334e-01   +3.943900465615279e-01   +5.076552010177848e-01   -3.414266448618356e-01   -3.927724483907249e-01   +8.770197544778993e-01   +3.929707326464535e-01   -2.822077407419368e-01; -3.954393209553583e-02   -5.437405754464988e-01   +2.184918581392660e-01   -7.762085018590403e-02   +2.215043228035916e-01   +1.621152186187251e-01   +3.408808781693791e-01   +8.809994640494767e-02   +4.599643216504978e-01   +1.854746481877129e-03   +1.583504152252557e-03   -4.017443862216850e-01   +5.594022791623844e-02   +4.948754764717567e-03   +3.466675461953050e-01   -2.226846793044642e-01; +2.011926849189478e-01   +5.030626534180164e-01   +7.219569909348898e-02   +6.818742053620994e-01   +7.862207913313617e-02   +4.009615751467337e-02   +7.448382549483283e-01   -1.649100066870892e-01   +3.412100527421199e-01   -2.245051377206895e-01   +3.884352741758506e-01   +1.314869965914382e-02   -1.478245526392218e-01   -4.276522755809219e-02   -3.147793381896817e-01   +5.351487788035404e-01; +2.200323827967960e-01   +1.572473713853133e-01   +5.942074724301270e-02   +2.500812969079526e-01   +1.744507923012225e-01   +6.692349376438220e-02   +2.554368846544870e-01   -4.984942403619767e-01   -1.450445385067284e-01   +1.325591011626837e-01   -1.363141352424369e-01   -1.184021197535390e-01   -3.578918865169439e-01   +4.246199770050501e-01   +4.647767732417153e-01   +3.158775975277970e-01; +3.331474522634704e-01   +4.271413296189845e-01   +5.985467626318302e-01   +6.801609880716050e-01   +2.559481734366835e-01   +7.026323917979982e-01   +2.521884200950375e-01   +1.434959072671459e-01   +3.043360355511232e-01   -1.324246235982450e-04   -1.960024004692277e-01   -1.312253604642110e-01   -6.257356558035088e-01   +3.308164801046564e-01   +1.791297485272949e-01   +3.461125554121111e-01];
L2I_L2E_iAMPA_netcon = [+2.968098773759982e-01   +6.224036790631996e-01   +1.147892903790748e-01   +4.888794509777648e-02   +1.927375972569454e-01   +5.283739846629588e-01   +4.627197106989418e-02   +5.620050053602842e-01; +6.440245924133671e-01   +2.241021925006249e-01   +5.786223301143202e-01   +7.237622151462246e-01   +4.162441013073330e-01   -1.190519757487816e-01   +1.540988379639994e-01   +2.393342393748776e-01; +2.985096233212789e-03   +3.397138737836001e-01   -1.262245438178767e-01   +9.274341729706492e-02   -3.861105572029226e-02   -1.872431276937783e-01   +1.996647378950750e-01   +2.525184781574642e-02; +3.004838252481936e-01   +2.463188657363712e-01   -4.700770637540643e-01   +7.070022855598428e-02   +5.924911972984033e-01   -1.923453045693826e-01   +3.412733078738158e-01   +2.060256948201782e-01; +3.683619317451931e-01   +1.219170706963812e-01   +8.549622090308504e-02   +4.295800506150764e-01   +6.531948957374132e-01   -2.781308337345570e-01   +3.974430739254592e-01   -1.655102458682078e-01; +5.984264677121065e-01   +2.899075887739331e-01   -1.052949482073024e-01   +4.833093075901899e-01   -1.902879934685223e-01   +8.203225381065932e-02   +1.418985545780919e-01   -7.242295106785673e-03; +4.196089783862919e-01   -6.057704133401904e-01   +4.276853351019738e-01   +4.153701927454237e-01   +6.813433010696282e-02   -2.690108183199393e-01   +8.861082296467298e-01   -3.409875067298216e-01; +3.252052230872651e-01   -1.829394268781122e-02   -5.327079039895667e-01   +3.252097497170192e-01   +9.535345144046539e-02   -1.432589589912446e-01   -1.044466499254490e-01   +6.894446601293230e-01];
L2E_L2I_iGABA_netcon = [+1.879919398288829e-01   +2.924992794647980e-01   +2.131444574081718e-01   -4.220651452793019e-01   -1.506429066347971e-01   +7.316853876890257e-02   -1.149981714662534e-01   +7.276062810075484e-01; +1.877865582147967e-01   +6.993712197046809e-02   +1.899604670205851e-01   +9.780313081577031e-01   +7.140896819006893e-01   +1.193603626017768e-01   -4.396297874111351e-01   +2.271455367836077e-01; +2.950988548552501e-01   +7.440117212765079e-01   -3.900549133624979e-01   -4.086422874019019e-01   +3.058796900263152e-01   +7.869018209729904e-01   +1.947087318124885e-01   +1.586574811183962e-01; +1.578141338929303e-01   +6.357481111841811e-01   -5.611388691513020e-02   +5.793330124063664e-01   +9.740342122510931e-01   -5.209200714140088e-01   -1.306041303999449e-01   -1.573056449377693e-02; -1.173551282624360e-01   -3.443263560917507e-01   -2.383772806308271e-01   +3.981516234636885e-01   +8.635655779611126e-01   +4.981869934911615e-01   +1.774236564636951e-01   -1.583741464622107e-02; +9.667005203883632e-01   +5.013366369483565e-01   +4.329332925581999e-01   +5.520207262907126e-01   +5.636810422150830e-01   -4.495906293899231e-01   +5.000660182942124e-01   -5.074502205188651e-01; +2.244579561400593e-01   +1.795914725186409e-01   -4.701700044871395e-01   +4.947320236102442e-02   +1.705226705632297e-01   -4.673468058025574e-01   +1.622321258562907e-01   +9.080637761900615e-01; -4.383448061550120e-02   +5.181981655804495e-01   +5.061676286416400e-01   +1.014610069586539e-01   +3.949797173456243e-01   +5.309709402541163e-01   +3.179492410674651e-01   +6.505045406497252e-01];
L3E_L2E_iAMPA_netcon = [+4.652272107769806e-01   -1.587223548036504e-01   -1.082527687504351e-01   +2.959824479129803e-01   +6.361226310696650e-01   +4.044948167180945e-01   -3.395639897090210e-01   +7.320036997616746e-01   +2.398836813847547e-01   +1.911248822472067e-01   +2.286735707251663e-01   -5.039610799007872e-01; -1.069140663774239e-01   +2.487475517788528e-01   +1.016147449025831e-01   -2.415248781366936e-01   -2.122353818271996e-01   -1.931589041220420e-01   -4.455949172605963e-01   -1.199320442417966e-02   +2.769203735469806e-01   +3.774079486418680e-01   -2.445582495100149e-01   +6.004912988964610e-01; -3.047974547472703e-01   -2.573712244097381e-01   +4.983810929234416e-01   +2.480925294417948e-01   +1.548895976526433e-01   -1.614742460455143e-01   +1.250892816790730e-01   +1.990294444394797e-01   +6.729950225685860e-01   -4.822508340680230e-01   +9.568255106885493e-01   +5.357932313234025e-01; +3.306685366716372e-01   +3.246005763637780e-01   +8.782134553905172e-02   +1.626379697167716e-01   +3.822812913952103e-01   +3.036164060988187e-01   +6.611952949916942e-02   +5.918180305424363e-01   -1.792480376270941e-02   -1.741513494770020e-01   -2.944649883168925e-01   +3.954127862449860e-01; +1.490384771937381e-01   +3.984599247733777e-01   +4.585520546938919e-01   +4.172263111621426e-01   +4.907108698464600e-01   +3.887160793733019e-01   -9.827811159023495e-02   -1.446980512660079e-02   -8.924347213623936e-02   +5.399826792437683e-01   +3.771409206921638e-01   +4.559161136070388e-01; +3.364138509314835e-01   -1.401525789185948e-01   +1.766273328123349e-01   +1.992406292384238e-01   +4.622126688825108e-01   +6.619518992390298e-01   -4.239549127591517e-01   -2.374225458705615e-01   +1.654792173699959e-01   +2.697895986169990e-01   -5.756162523218758e-02   -2.207797194049976e-01; +3.279273741405846e-01   +3.184673145873350e-02   +1.263964866683847e-01   -1.634162063262735e-01   +1.185825522264268e-01   +3.894901808877984e-01   -3.496918527246569e-02   +3.285334031337695e-01   +7.671130419624220e-02   +2.966226861025625e-01   -1.956534564855780e-02   +3.086653081856575e-01; -9.444779030871718e-02   +6.677974048926159e-01   +1.060151212225201e-01   -5.599029336516683e-01   +5.019161543229322e-01   -3.152609597567857e-01   -4.758988245514388e-01   -2.455127713737605e-01   +3.481758432684210e-01   +8.362459742874039e-02   +2.274345961873658e-01   -5.823022364764627e-02];
L3I_L2I_iGABA_netcon = [+1.000000000000000e+00   +5.787777350898610e-01   -1.433149625928896e-01   +5.511644830122686e-01   -4.545580945627254e-01   -5.347408023184155e-02   +7.854436367557275e-01   +6.304961585587259e-01   +4.808131870580768e-01   +1.808242416080720e-01   +7.962988731369823e-02   +2.524076259213454e-02; -2.604208118128085e-02   +1.974933844807684e-01   +1.579858147875470e-01   -3.989807735929266e-01   +4.397168807871070e-01   +1.962043849555643e-01   -1.062762457018309e-01   +2.212573385422410e-02   +1.121772956524620e-01   -1.737147674287096e-01   -1.806054423936476e-02   +7.919981719938072e-04; +5.546259297674200e-02   +2.577974784178932e-01   +7.915294895839281e-02   -3.617503161868325e-01   -9.742818516804251e-02   +3.356746600690876e-01   +3.118828837644122e-01   +1.386238683610235e-01   +1.545733728720734e-01   -2.426250016229407e-02   +6.064136370676703e-02   +9.070297641404292e-01; +5.114907470111749e-01   +2.467369115965257e-01   +6.538685386384230e-01   -9.828759855942973e-02   +2.348405196158521e-01   -3.598600609062929e-02   +1.631091121266987e-01   -1.238301279264483e-01   +3.998027087107156e-01   +5.978961138903016e-01   +4.788494712093118e-01   -3.097175833930131e-01; +2.777858927626580e-01   +2.526129710098398e-01   +8.196393488012347e-03   -6.874470597276015e-02   +4.063014219878783e-01   +4.944386361589531e-01   +1.613550176972832e-01   +6.116980420745147e-01   +4.478189298117242e-01   +1.963967848450807e-01   +3.051316751730907e-01   +2.324253668696109e-01; +4.657598098888507e-02   +5.744920484858356e-01   +6.520856278539731e-01   +5.582760273450070e-02   +2.473833256898754e-01   +1.686144045720694e-01   -4.307366363428723e-02   -1.612089847812403e-01   +3.375544817289831e-01   +2.137250886696915e-01   -5.886344057168827e-01   +2.750518174400805e-02; +3.142610251686764e-01   +9.446349906612078e-02   +5.129626615797152e-01   +3.244403676725583e-01   +4.724398239212116e-01   +7.711034489872030e-01   +4.078235424358014e-01   +2.057208299665316e-01   -6.835149891455475e-01   +4.959389295509073e-01   -9.620198114545014e-03   -3.207345120121478e-01; +1.012395449185595e-01   +5.026515782458961e-02   +5.022025392556155e-01   +5.429910519494566e-02   -4.182452619375765e-03   +4.100109128852859e-01   +6.488804133028651e-01   +4.291331679774469e-01   +4.352704277386513e-01   +7.712932034892053e-02   +9.938141082294592e-02   +2.580166757137099e-01];
L2E_L3E_iAMPA_netcon = [+3.706950505407522e-01   +4.989232107341818e-02   +6.682406785700069e-01   -5.814485971784915e-01   -4.183928677213039e-03   +4.228119141001857e-01   +6.702931454574097e-01   +5.807034666210483e-01; +2.170393304538655e-01   -1.483583974844666e-01   +5.549406085844735e-02   +3.858434546963899e-01   +5.514666017758573e-01   -3.635214316543413e-01   -5.079229094032391e-01   -5.638159527857904e-01; +4.508653252488226e-03   +1.126454481499695e-01   +1.240003547745147e-01   +1.755284970316364e-01   +1.961828780288946e-01   +5.824599604918441e-02   +2.966408948949663e-01   -1.278696907852718e-01; +3.933336954550802e-01   +5.785200547617331e-01   +7.438097893503532e-01   +9.310145163934928e-01   +1.124445956945368e-01   +4.662823257083173e-01   -7.586760969517717e-02   -6.161546710002627e-01; -2.783739165259366e-02   +2.282162009426354e-01   +1.211185827086077e-01   +6.042465207190710e-01   +5.952159044855432e-02   +2.442854834494471e-01   -6.392104813570013e-03   -4.439756935131272e-01; +9.611764525515815e-02   +4.696149257698853e-01   +5.115349979948576e-01   +6.743194022218835e-01   +1.781878348819249e-01   +8.544792150982994e-02   -1.612413816653336e-01   +3.204013048616602e-01; +2.108289804161432e-01   +8.862287017555581e-01   +4.146808406018483e-01   -2.176251653920936e-01   +1.767906942856708e-01   +3.199655937782503e-02   +3.193765611270907e-01   -2.335871066809861e-01; +3.950757180481256e-01   +3.426740719160524e-01   +2.169734296218325e-01   +2.911058376637041e-01   -2.857334476336655e-01   -1.075293959797549e-01   -1.415538441462414e-01   +4.881827833550129e-01; +2.529196474358755e-01   +5.744487883534429e-01   +6.098869074096567e-01   +7.245600912432889e-01   -6.699061810634309e-03   -6.194894062028704e-02   +5.449114112644566e-01   -2.578724864277558e-01; -2.294202062884497e-01   +9.528501372046100e-02   +2.917456483184048e-01   -1.736454601837571e-02   +1.049553240447419e-01   -2.974971263171959e-01   +2.566460474115670e-01   -1.327927106861606e-01; +4.502873747973006e-01   +4.427139166539769e-01   -4.218414299384723e-02   +5.936936313875693e-01   +2.589139824126078e-01   +7.430687417704429e-01   -4.602614090779004e-01   +1.869231002033841e-01; -1.823246654108664e-01   +4.549424652208633e-01   +3.207290150824144e-01   +1.563014293683204e-01   +1.508379617777256e-01   +5.363518091219248e-02   +2.894555333999230e-02   +2.454739305536992e-01];
L2I_L3I_iGABA_netcon = [-1.316911185142170e-01   -7.544548505252736e-02   +2.519572932266815e-01   +1.792728083603354e-01   +2.757004746901378e-01   +7.159832915030732e-01   +4.415543602512893e-01   -3.663479075949454e-02; -3.412651929677488e-01   +2.572733553980132e-01   +2.762019882287131e-02   -1.213947286426180e-01   -4.420063058205260e-02   -3.397671779861428e-01   +4.064623870219012e-01   -5.510507315951284e-02; +3.121170407344916e-01   +1.000000000000000e+00   +5.389218058829612e-02   +3.263115214819479e-01   +9.925676642482219e-02   +6.608210941606447e-01   -1.110405678393062e-01   +4.915803045341765e-02; -2.324562638201130e-01   -8.374157155705425e-02   +8.860030720855809e-01   -2.055833070287688e-01   +4.334032391530462e-02   +6.202806437814169e-01   +5.474499260997919e-01   +3.047595482673318e-01; +8.016431261438026e-02   +2.919663881013000e-01   +4.187559111188456e-01   +3.156138646841462e-01   +2.369836064832983e-01   +2.781718056688716e-01   +3.324219517174534e-01   -1.771521140841096e-01; +1.640267375605615e-01   +5.297599284932158e-01   +3.096721371571149e-01   +4.008953927305602e-02   +4.031186407127281e-01   +3.882404199259737e-01   -1.450960145026024e-01   -4.815501370200793e-03; -7.765180395793149e-02   +6.635833455612200e-01   +2.132703173151412e-01   +1.276728733053632e-01   -2.714827314530413e-01   +2.664201124256676e-01   +8.180481540466136e-01   +3.738637899774319e-01; -3.993384579195214e-01   +4.182886845683234e-01   +4.518974103761490e-01   +6.324399916976199e-02   -6.602032956803103e-02   +5.261542388858946e-01   +1.863905435522074e-01   +5.058156554906788e-01; -3.148961699914567e-01   +6.816742375461937e-01   +7.177319229039159e-01   +2.860661304041204e-03   +2.124921146985336e-01   +1.474179691758660e-01   +1.708379808274848e-01   +8.985646734859985e-02; -5.876611954336816e-02   -1.108811864428075e-01   +1.867808155451533e-01   +6.449479035861656e-02   +3.896774998082704e-01   +3.210722625488023e-01   +9.871290126567007e-02   +1.386470976474287e-01; +5.996822769504093e-01   +1.647511060743306e-01   -4.684515730784838e-01   +3.743915741295172e-01   +1.371300436943597e-01   -3.336340519976503e-01   +2.581615246714293e-01   +5.427604430725504e-01; -1.874324348054856e-01   +4.798380331646702e-01   -1.280313196883835e-01   +3.605718078672694e-01   +3.877882663770025e-01   +3.250271894397986e-01   +1.299186850280827e-01   -2.670171762904826e-01];
L3I_L3E_iAMPA_netcon = [+7.388935011555914e-02   -2.635466405498458e-01   +3.057127522327358e-01   +2.761185903696494e-01   -2.983541185349738e-02   -2.018502324444743e-01   +4.969600253962058e-02   +4.980826473374212e-01   +5.347023329811899e-01   +4.937255969408222e-01   +1.133432071446948e-01   +4.728049348235558e-01; +2.884821487297439e-01   -3.031337783292364e-02   +2.014681857398115e-01   +6.672458479717028e-01   +4.852053314172192e-01   -3.894375437771424e-03   +2.541530594467406e-01   +5.637154932518778e-01   +5.270095182756247e-01   +3.696618173133330e-01   -2.406551842443700e-01   -1.265681488639728e-01; +2.688417922498006e-01   +4.600750780482042e-01   +1.226463986363696e-01   -1.049422465224771e-01   +1.000000000000000e+00   +5.368682706716115e-01   +4.049017629603064e-01   -1.467498410520746e-01   +3.080994788261783e-01   +1.302582509992031e-01   -1.316427990577091e-01   -4.311605797844378e-02; +3.087263461593042e-01   +1.354996274037540e-01   +2.407417994937686e-01   -1.767959225725251e-01   +5.389277765894688e-02   +4.196539102040965e-01   +8.657974586226970e-02   +3.105524037456842e-01   -8.459842396719451e-03   +1.856746446013978e-01   -2.374306927287542e-01   +1.021582761767781e-01; +1.090986190620934e-01   +2.383059553073633e-01   +8.152442732571112e-01   +5.313059522098306e-01   -7.407228945869122e-03   -1.503007049959538e-01   -7.206056774311702e-02   +5.084498643081775e-01   +3.980935680543633e-01   +1.918827893194291e-01   +1.508730220949839e-01   +6.295962014534755e-02; +1.486078787621488e-01   -8.265744090378423e-02   -1.360512327335265e-01   +1.442265441835944e-01   +3.919915305163425e-02   -8.971024537386886e-02   +5.116634560288956e-01   -7.351553207818849e-02   +3.273633962862705e-01   -2.259278124007349e-02   +2.304188493279569e-02   +6.882172006158448e-01; +2.472664333754461e-01   -7.051123476598693e-02   -2.663954592583806e-01   -1.904183430640870e-01   +1.053936624780168e-01   -1.274312464386671e-02   +3.556510881297785e-01   +9.140048159395812e-02   +1.792623969003986e-01   -1.390681045384622e-01   +1.514163765881160e-01   +7.242204637790323e-03; +6.885111126362681e-02   +1.988361244804633e-01   -2.614364400642277e-01   -1.168559812487705e-01   +4.282754830632843e-01   +4.630617574898150e-01   -2.310850599256031e-02   +6.320896137338780e-02   -3.313394140731331e-01   -3.331614871243042e-01   -7.077906789520243e-02   +2.719323801378559e-01; -4.601815414178955e-01   +5.791580344487763e-01   +1.242304570207386e-01   +5.365599982052505e-01   +6.739621713745426e-02   +4.108725800686514e-01   +5.606309540824748e-01   +3.954808068709136e-01   +1.264289443450606e-01   +1.569329025397525e-01   +2.165182891492822e-01   +5.794814294273921e-01; +8.259928187325298e-01   -5.219933852752875e-01   +6.751714143425558e-01   +1.440214165553961e-01   +1.624921092062098e-02   -1.681354238584959e-01   +2.882465170715716e-01   +1.816415734615431e-01   +8.880564488246463e-02   -1.674096517349229e-01   +6.929430091489007e-01   -2.892450584214927e-01; -3.531738488880297e-01   +5.260845781609025e-01   +4.716704651419752e-01   +2.134392603298495e-01   +2.076497305470655e-01   -2.087782402627514e-02   +3.705856170377740e-01   +9.414192441692865e-02   +5.942271610328985e-01   +1.040111592024402e-01   -8.475699998828792e-02   +3.501143882373162e-01; +1.947612472364375e-01   +1.436506241826639e-01   +7.076103811040590e-02   +5.551850832526882e-01   -1.281114322145236e-01   -2.702742015916285e-01   -4.417418906956259e-01   +3.043093292303442e-01   +1.234530896691748e-01   -2.263042200175999e-01   +2.576216150568925e-01   -1.332217413707185e-01];
L3E_L3I_iGABA_netcon = [-8.276345521279239e-02   +4.036581276387065e-02   +1.903532503069908e-01   +3.499423916680043e-01   +3.310975433077992e-01   -6.451761354776865e-02   -3.405909822633550e-01   +2.030264705870354e-01   -1.317156501324285e-01   +6.949184332653993e-01   +2.924996918344037e-01   +5.460987250212494e-02; +1.866941954708212e-01   +1.035128805510810e-01   +5.506793347777295e-01   +2.252001864238761e-01   +5.767545278624975e-01   +2.062418026281841e-01   +2.654231742030884e-01   -2.355582100484634e-02   -5.388568474612961e-01   +1.522266545878881e-01   -6.757750236369803e-01   -2.151078157490963e-02; -1.357711197370732e-01   -1.339789003267317e-01   -2.952433074181042e-01   +5.001091138096583e-03   +1.513139440970130e-01   +2.213804271718584e-01   +3.601058595479500e-01   -4.282356032441377e-02   -2.068544353819131e-01   +6.786891721497251e-02   -2.813602302606831e-01   +1.741190639548458e-01; +2.950110358386006e-01   +1.049721777112623e-01   -3.130821543110303e-01   +7.337827278637039e-01   +8.542023208742986e-01   -2.129101095453408e-01   -1.344205381690896e-02   +1.254114205560253e-01   +8.149010678081938e-01   +4.817942049436652e-01   +2.607640790528317e-01   -2.672540840391135e-01; +1.445319187004807e-01   +2.306787506934973e-01   -2.303822977226422e-01   +1.091145165867988e-01   -4.667716153116842e-02   -1.635261638330654e-01   +2.798735463053134e-01   +4.101016597070148e-01   -3.213199178511489e-01   +6.226670991968160e-01   +3.625428425085862e-01   -1.447957777883887e-01; +2.951478689196050e-01   -3.512081447778238e-01   -8.707943713980582e-02   +1.250130124408751e-01   +2.414764091184662e-02   +9.847493476865539e-02   +3.422014576731061e-01   +3.988784303100196e-02   +3.610154258494217e-01   +2.409250020074235e-01   -5.209522057088883e-02   +9.267046215626432e-04; -1.743244986248475e-01   +1.743151287905288e-01   +2.038965342425176e-01   +9.085081211206211e-01   +1.106421226196638e-01   +3.237146217344866e-01   +4.359010896400595e-01   +5.939934019158672e-01   +7.324958826149755e-02   +2.325318462875289e-01   +3.550940602085016e-01   +2.481017256445154e-01; -9.823483717160457e-02   +4.592408787044141e-01   +5.696167803799200e-01   +5.578096860202073e-02   +6.616477460599290e-02   -4.670980256064183e-01   -4.979104906336386e-01   +5.546470612605865e-01   -5.942596951871216e-02   -1.890020956980996e-01   +4.669734415683308e-01   +2.846166650305394e-01; +6.313359724783875e-01   -3.781418103261894e-02   +4.390879394135738e-01   -2.260981142366731e-01   +4.571158750202163e-01   -1.023494294983626e-01   -8.078097307903868e-01   -2.740195337930818e-02   +5.327513389941679e-01   +2.511699152754341e-01   +1.557236774220478e-01   +4.495567581263793e-01; +2.620204342277249e-01   -7.401679695464815e-02   +4.007840487200700e-01   -6.928733679395656e-02   -7.257095276352193e-01   -8.901543196405769e-02   -4.395427898866312e-01   +1.689963746588662e-01   -8.857485723505627e-02   +7.799105516889076e-03   +1.875443002061770e-01   +2.589775950724471e-01; +8.862011812228138e-02   -1.711123293905983e-01   +2.092944469592795e-01   -4.670768695593652e-02   +2.276004280735218e-02   -1.094072171149888e-01   +2.662983754232475e-01   -2.716368736929729e-01   -3.110244410251916e-01   -2.322117273945933e-01   -9.486301421532652e-02   +4.186130203195472e-01; -1.040005630321977e-01   -1.101984347650866e-01   -5.141556386040000e-01   -1.629764071698456e-01   +1.000000000000000e+00   +4.675200864288146e-01   +4.157930810706876e-01   +2.339159660767298e-01   +1.547783487967633e-01   -3.063346050957080e-01   +2.901769980723899e-01   -5.094329517937752e-01];
L2E_Input1_iAMPA_netcon = [+9.427522244891366e-01   +1.000000000000000e+00   +6.416277935491386e-01   +4.407222166107197e-01   +4.364733483462737e-01   +3.592649068893377e-01   +8.164970611918190e-01   +5.475117179442598e-01];
L2I_Input2_iAMPA_netcon = [+6.609294807976533e-01   +6.848269210558874e-01   +5.065635348721239e-01   +1.765828525425455e-01   -4.381132464019949e-02   +8.461378047825933e-01   -1.018397818802592e-01   +1.320701213246269e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
