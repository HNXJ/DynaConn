function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.559693022017937e-01   +1.008280056513265e-01   +1.420761750942589e-01   -1.788627318862794e-01   +2.987068252554737e-01   -8.896390093799557e-02   -1.361200718917092e-01   +3.531612038120748e-02   +1.695593876289418e-01   +7.353723865738793e-02   -1.777444532298137e-01   +1.556957018442229e-01   -1.622508622142559e-01   -8.181826590352428e-02   -2.568828881279715e-01   +1.211256580947590e-01; -1.431520175118052e-01   +5.503085530124159e-02   -1.706789988924259e-01   -2.635062962757886e-01   -9.211198757743300e-02   +3.193398435120421e-01   -7.076249661236239e-02   +9.500020438815859e-02   +1.625159291237591e-02   -2.348844046856692e-01   -2.160666621694022e-01   +6.229071863839673e-02   +1.523790193245697e-02   -3.766151117424296e-02   +7.024286412092826e-02   -1.562578266293586e-01; -2.382002441638829e-01   +1.397847830207908e-01   +8.278304070506702e-02   +2.244571227330073e-01   +1.021668919730297e-01   +1.843523466378374e-02   +6.522695093662428e-02   -3.079587648709671e-01   -1.332851928786091e-01   +4.618943716816192e-02   +1.036506411222132e-01   +7.521866902516237e-02   -2.269163544147672e-01   -6.195098501089329e-02   +1.001442331788694e-01   -1.904482770862336e-01; -1.004333694216938e-01   +4.064231018628308e-01   +1.378090969069605e-01   +1.032044838178540e-03   +7.694136426340784e-02   +1.681124269894222e-02   -8.243721668210613e-02   +2.855529896922875e-01   -2.415531348266715e-01   +1.308037094770069e-01   -1.180349964732049e-01   -1.872564336262393e-03   -2.790779151978073e-01   -3.370812094754654e-02   -3.685002268753539e-01   -1.371432636400474e-01; +1.414223769543188e-01   +1.530826503997471e-01   +6.649709775029154e-02   -3.588196256459100e-02   -2.779073224020705e-01   +2.814427191921076e-01   -3.624521099004939e-01   +9.123541383491517e-02   -2.409151894984089e-02   +2.759195504634639e-01   +2.455017822170759e-02   +1.424989653272603e-01   +1.705703051385569e-01   -9.836581539695333e-02   -1.441810443542719e-01   -2.557292173809546e-02; +2.827288995607157e-01   +1.092310014484186e-01   -1.628074895475548e-01   +2.569176771424675e-01   +3.478773405818356e-01   +5.065976441745404e-02   -6.286417073525090e-02   +2.166955087569081e-01   -1.396419312905217e-01   +2.980947859112642e-02   -3.635946076346993e-01   -9.475458307529690e-03   +4.975832423920370e-02   +2.884787820889589e-01   -3.368848903953571e-01   +1.616514285210296e-01; -1.403717608255192e-01   +1.550699813450259e-01   +4.355395869221320e-02   -2.695870807398583e-02   +3.985229763893364e-02   -6.963863382409480e-02   -4.999013149515456e-02   +2.998935477304983e-01   +1.853226898111595e-01   +2.107867287694050e-01   +2.800278602713970e-02   +1.917944472160751e-01   +2.758931583332617e-01   +1.923897815925930e-01   +2.671325268812266e-01   -5.948257982914799e-02; +8.031486048104079e-02   +9.761080596345272e-02   -6.506234527322427e-02   +5.648433163068443e-02   +1.411983866272556e-01   +6.200715230053985e-02   -2.430934341120262e-01   -4.448111901481403e-02   +1.669946054356220e-01   +4.394006585668777e-02   +4.543487534184731e-02   -9.614536471063546e-03   -9.679069160156842e-02   +3.211247595321753e-01   -7.068608210194166e-02   +2.450018257025997e-02; -1.030197378524066e-01   +2.250748968079301e-01   -1.049955522484334e-01   +1.145804740234291e-01   -3.929583322554686e-01   -2.221223449932419e-02   -1.561936843850978e-01   +1.329652858114920e-01   -4.174419363953771e-02   -2.400858970541772e-01   +1.879486002339381e-02   -3.851694470260243e-01   -4.073605435344803e-01   -8.136246174655477e-03   -8.948901885273919e-02   +1.652392059547188e-01; +7.352243451824231e-02   +5.287696846114498e-03   +1.375847653877128e-01   +1.045836901029964e-01   -1.220617989399586e-01   -1.618461624853952e-01   -4.457181618797904e-02   -3.422742799050647e-01   +2.586268097979261e-02   -3.384435371096721e-02   -1.337560249544836e-01   +3.616529115955774e-02   +5.895512663478766e-02   -1.412686509502691e-01   -7.271393120397338e-02   +1.177146651391636e-01; -3.977689557134804e-02   -3.303678241414484e-02   -1.419109030469557e-01   +2.090596493025893e-01   -3.348339513845903e-01   +1.008919435132880e-01   -5.742746720356121e-02   -8.130698619276872e-02   -3.709388575642198e-01   -1.832915220228936e-01   +2.198707421194622e-01   -3.874094804112301e-02   +1.020286458109188e-01   -1.243366276946023e-01   -1.687484522596091e-01   +2.152853485626927e-01; -4.661069332216312e-02   +4.073233319418837e-02   -1.598481032652470e-01   +1.634372383748578e-01   -4.641841881621010e-02   -1.255011639029803e-01   -1.876391650217143e-01   +4.551458487745595e-02   +7.233355375994197e-02   +2.368188179017587e-01   -4.833555507026104e-02   -2.518366391017411e-01   -2.956812219043540e-01   -5.906158590169352e-02   -2.937809460653477e-01   -2.663322828166709e-01; -1.232754992777274e-01   -5.137470344032544e-02   -8.400260560090664e-02   +5.771550350804008e-02   -5.048573850944603e-02   -1.474058862260531e-01   -1.535905553767088e-01   -8.077671504413927e-02   +9.466932697693260e-02   -2.374251036172929e-02   +1.629986102838538e-01   +1.278247091654780e-02   -5.959440255683126e-02   +3.031118543027782e-02   -7.689530924621754e-02   +2.250577684160470e-01; +1.479415856531083e-01   +2.942553198053442e-01   -1.043140582926480e-01   +1.151529294147517e-01   +1.641777865753486e-01   -2.270440773662647e-01   -1.983702797275031e-01   -5.529965357743586e-02   -8.027039057779677e-03   +1.847882656090829e-01   +6.565185079103286e-02   -5.781380529941321e-02   +1.382500436080221e-02   -2.929763020728185e-01   -1.299387360577964e-01   -6.897904738046176e-02; +1.236052515352278e-01   +2.133709025680751e-02   -1.586181114610123e-01   -1.840406790110555e-01   -3.131755085820744e-01   -2.080763400631527e-01   -3.497542982890475e-01   -9.168706375113442e-02   -1.833981069930399e-01   +1.982451541925746e-01   -1.054206014241370e-02   -2.470265908914406e-01   -2.158335054577175e-01   +2.960210212337968e-01   -8.338409949661417e-03   +5.358853347271009e-02; +1.628105012378465e-02   -6.334522964350472e-02   +5.598855050484340e-02   -2.332163149690128e-01   +2.097861925090138e-01   -5.918922475517871e-02   +1.516094418471873e-02   +1.704335633047840e-01   +1.156017167354171e-02   -3.060215475421599e-01   +1.874195430619414e-02   -1.628088599289707e-01   +6.099680063175901e-02   +1.038400551851651e-02   -4.206831825165922e-01   +4.797190410611225e-02];
L1E_L1I_iGABA_netcon = [+1.415370537879883e-01   +1.420817007135892e-01   -3.807294011430391e-01   -5.810839554154187e-02   +1.487993232248664e-01   +4.627448654346423e-02   +1.027622707986756e-01   -2.688467411914591e-01   -1.553999282431505e-02   -1.528539902862633e-01   +1.917557655088481e-01   -1.055679033023864e-01   +1.265282203138249e-01   -4.319174690142137e-01   -1.907068554143577e-01   +2.349479624127581e-01; +5.730249651834470e-02   -1.280871593218774e-02   +2.189657251044355e-01   -6.437227672856249e-02   +4.686360241751467e-03   -6.430828496766010e-03   -1.755442142223404e-02   +1.324546427599988e-01   +7.154200470459876e-02   -2.702806137414468e-01   -1.603145597273289e-01   -8.051629480578487e-02   +3.343327861402396e-01   +4.686747746032858e-02   -1.500604500826641e-01   -1.099167544019604e-01; -3.126115479555173e-01   +1.997925687888846e-01   -8.236372417372546e-02   -2.868735259754664e-01   -3.026592116637080e-01   +2.987399692267953e-02   +3.772876793098576e-01   -1.838955467308809e-01   -1.085276189044475e-01   +1.464768586653080e-01   +1.238955442579738e-02   -2.902205117264377e-02   -8.322445263699954e-02   -5.655768125865653e-02   -3.008225862277569e-01   +1.472562470439433e-01; -2.327554891676139e-01   +9.299421627212276e-02   +3.439138553535363e-02   -9.083986437536129e-02   -2.157915830866022e-02   +1.989163869798536e-01   +1.737929808795040e-01   -1.912047127828187e-01   -2.165536029113997e-01   -2.528731080321197e-02   +9.258395146160202e-02   +1.417759060892313e-01   -5.010652006537312e-02   +1.800448873872134e-01   -2.392529301535868e-01   +1.528807643698854e-01; -5.939865873444340e-02   -1.280127561964598e-01   +1.837246427828373e-02   -1.275777655336140e-01   -3.296108045149524e-02   +1.281071358978921e-01   -4.489798789061895e-02   +1.467572737484585e-01   -1.860090497052513e-01   +2.954996152105906e-01   +1.135422802293499e-01   +1.433921307503371e-02   +1.961358113153706e-01   +2.179460402454861e-01   -1.754502870619412e-01   -1.796261846214131e-01; +3.423403963237639e-02   -9.449768259679499e-02   -1.861932218304515e-01   -9.288589207759643e-03   -9.698109272417270e-02   -1.119858190196883e-01   -1.018317346009716e-01   -1.546899402415584e-01   -7.483232399810845e-02   +1.100286010542388e-01   +1.896851689147920e-01   +1.306117953614529e-01   -2.560778680820122e-03   -2.149307446651182e-01   -3.211687686246882e-01   -1.876504084176921e-01; +1.244384461508214e-01   -3.281520184698974e-01   -1.369323640976684e-01   -3.047369914404369e-01   +6.917498042980660e-02   +7.694561910095224e-02   +2.435354279498078e-01   +1.759275357046050e-01   +1.055438255278619e-01   -1.450496803011983e-02   +1.880945314692177e-01   -3.079982427232531e-01   -1.211690044502581e-01   -2.546123342993478e-01   +2.403223479635074e-01   +2.710986930342218e-02; -1.675106708299191e-01   +5.473801973706215e-02   -8.826024159521272e-02   +3.304759376029097e-01   +9.445812659590182e-02   +6.723197375892975e-02   +9.510664632383431e-02   +1.662482310824656e-01   -9.112792269446571e-02   +2.103382762022974e-01   -1.997470121646768e-01   -3.234073968371449e-02   -2.177899493220653e-01   -3.050881360092196e-02   -1.052575718087913e-01   -1.204687727190493e-01; +1.580790657035468e-01   +5.046331185700088e-03   -8.184818425075381e-02   +4.066682016359742e-02   -2.807500173005912e-02   -6.236793543691592e-02   +6.122223925404315e-02   +3.071538416385981e-02   -1.181008371367669e-01   +9.693072365865791e-03   +1.346068275493729e-01   -1.166611401530668e-02   +6.432701175410208e-02   -1.112080382289750e-01   +1.733541356877462e-01   -9.798196053497804e-02; -7.420442978588992e-02   -1.549346775329729e-01   -1.852138933263886e-01   -9.462927306628220e-02   +1.412384700430975e-03   +2.679077261599547e-01   +2.806721554871784e-01   -5.241153131188987e-02   -1.046490781795582e-01   +1.435986727008918e-01   -1.018185304274417e-01   +3.378626000802015e-01   +1.612495841260930e-01   -1.290690831475016e-01   +2.607665569615530e-02   -6.565797274616690e-02; +2.609113604296830e-01   -2.477063403606020e-01   +1.128956518226418e-01   +1.613641922783705e-01   -2.085603391043011e-01   -1.374887704430729e-01   -3.206376955410083e-01   +2.440715199874683e-02   -8.774642547147318e-02   -1.327903674649564e-01   -1.368668304614026e-01   -2.425155455700909e-01   +2.160342793736376e-01   -3.286666982314773e-01   -4.485137807115103e-02   -1.279998929675049e-01; +5.979197415876940e-02   -2.760179531172611e-01   -1.731467186846788e-01   -1.669641345896026e-01   -1.856545403823368e-01   +6.944738987642354e-02   -1.651567611000824e-02   +1.403111828367664e-01   +1.063106491424977e-01   -2.860869765986692e-02   +1.962177939490735e-01   -3.315801371019879e-02   +2.699334032522856e-02   -5.870441457239717e-02   +2.606807837084460e-01   -1.881231404990842e-02; +1.730119146435236e-01   -2.202576098160378e-01   -3.728630700504007e-02   +1.409457056643866e-01   -1.443457272124464e-01   -2.841712071290038e-01   -1.512647698900991e-01   +1.306637863312982e-01   -2.923323189366387e-01   +2.125989263991530e-01   -1.588929568720792e-01   -2.484323063238573e-01   +3.711352624704313e-02   -2.221210329151349e-02   -5.713333413458357e-02   -9.859001334590003e-02; -8.832852203276198e-02   -1.038751532812812e-01   -1.306257838919286e-02   +1.035280942965868e-01   -3.309847192090089e-01   -1.052250329017961e-01   +8.644600733550825e-02   -3.285995070383884e-02   +1.315817927542438e-01   +8.014841535699507e-03   +1.342239684951808e-01   +1.259903526517953e-01   +1.189996663873031e-01   +6.148192085017892e-02   +2.159191684586578e-02   -1.262068133568116e-01; +1.349471342854049e-01   +1.485020195013370e-01   -2.533389920238505e-01   -5.680661418807018e-02   -1.899384050410372e-01   +1.980464491099909e-01   +2.222400779910731e-01   -1.978481020094153e-01   -1.826660094466123e-01   -9.442227476669370e-03   -1.743736253489251e-01   +3.165823858166454e-02   -1.193669518264354e-01   +3.030155976233788e-01   +1.644907959810382e-01   +9.435011674254877e-02; -5.475655891922963e-02   -2.643537903089351e-01   -3.254753180616134e-01   +2.886737087750032e-01   -8.413228587282411e-02   +1.176901948763825e-01   +1.513900081559935e-01   -5.127781194926527e-02   +1.727568484590234e-01   +8.458153602301606e-02   +2.853311775398867e-01   +9.942125977111113e-02   -1.106546238026024e-01   +1.247838935998566e-01   -1.242115903600632e-01   -2.540739076562956e-01];
L2I_L1I_iGABA_netcon = [-4.899165802785627e-02   +1.713759489941058e-01   +7.603204298749713e-02   +4.917401319237788e-02   -2.879823160474498e-01   -2.752684398218053e-01   +1.099682667389128e-01   -4.182493485554951e-02; -1.781814347715688e-01   +1.151928453876258e-01   +1.455600637736437e-01   +9.476147081795797e-02   -3.026699600896436e-01   -7.042496019680657e-02   -1.127763344947378e-01   +4.225029366184202e-02; -1.984005913157557e-01   -1.166634249169810e-01   -1.046515336666911e-01   -3.662170149713290e-02   +4.064502615801134e-02   -3.735931706368605e-02   -2.791835853871985e-01   +2.214623613311741e-01; -6.283882552191394e-02   -1.589643347727227e-01   -1.667854061251490e-01   -5.527712173871924e-02   -9.352488738592861e-03   +1.338614881135938e-01   -4.083942728499593e-02   -4.216344156031986e-02; -9.269734438731281e-02   -2.742148054231521e-01   +4.217084222649567e-02   +4.889769224399697e-02   -4.151702228535500e-02   -3.011247201082245e-01   -4.455929802543075e-02   -3.143636613641667e-01; -3.610353566140730e-02   -6.067440776773209e-03   +9.290580068992478e-03   -1.031037411979202e-01   -2.522216455068780e-01   -4.511261948436324e-02   -2.286462799409999e-02   -1.035748734306975e-01; +7.242628370680979e-02   +1.369044107588638e-01   +5.005781176990225e-02   -3.612453134490037e-01   -3.053935606809128e-02   +1.013248114648848e-01   +4.649800818911011e-02   +1.095890499813040e-02; +2.266004232452419e-02   -2.358295812742908e-03   -1.169770495649704e-01   -1.950753490818903e-01   -6.688946150567761e-02   -8.394077521178368e-02   +2.097514363031878e-01   -3.222954047841249e-01; -1.643901413382156e-01   -2.979210857344557e-01   -1.068891578246677e-01   -4.276169113609542e-02   -1.967596449578577e-01   -9.361475679184703e-03   +3.312382268408239e-01   -8.292733809917165e-03; +8.318913157608661e-02   -2.997772353288409e-02   +1.188948007675054e-01   +2.712796126237293e-01   +1.657655282485093e-01   +1.709218591934338e-02   +7.248926603666694e-02   -1.178743325884186e-01; -2.401600036234766e-02   -5.442597753699493e-02   +3.059130844487730e-01   +2.171379368375132e-01   -2.119154414386044e-02   -1.973004738108058e-01   +1.005109966958485e-01   +5.633017873665579e-02; +2.462706338852187e-01   +1.168382683244501e-01   -1.004926073207579e-01   -1.372056979807182e-01   +3.658378865665017e-01   +1.900415663429809e-01   -2.168629633738246e-02   +2.231236101647383e-01; +8.478758482001676e-02   +9.228039756175233e-02   +5.057202551727671e-02   +1.213168099005160e-01   +2.233492666387324e-01   -1.530913994910549e-01   -2.109637547971673e-01   -1.206666535151268e-01; -1.633708736813464e-01   +6.898625385214084e-02   +2.728462372441633e-01   +3.543321840298470e-01   -1.695711511283286e-01   +3.023885908895973e-03   -3.553399772121530e-02   -1.554900543121596e-01; -1.933765779833713e-02   -2.019732806365993e-01   -3.527022578745214e-01   -2.266996451180278e-01   -9.754712482789266e-02   +9.377760922231346e-02   -2.420597572223096e-01   +2.497656861142669e-01; +9.909733630802348e-02   -2.286655652874623e-01   -2.004494354834175e-01   +1.909679220496459e-01   -1.013542305330809e-01   +6.002365596177583e-02   +2.138079416621908e-01   -2.151897404565508e-01];
L1I_L2I_iGABA_netcon = [+2.380782707202416e-01   +1.858393163446398e-01   -1.460715854867438e-01   -9.366194083254491e-02   +3.179642207950401e-01   -1.465492892489178e-02   +6.242054056786704e-02   -6.821282335236270e-02   -8.167153905459992e-02   +2.113127947067084e-02   -5.325239239320372e-03   -6.563193956645715e-02   +9.009174782152367e-02   +3.739834751450283e-02   -8.683852398680328e-02   -3.815805736010692e-01; +1.100202060127935e-01   -1.934246141345584e-01   +2.133524763143726e-02   +3.971237940432709e-01   +2.135154527036641e-01   +2.688074118781378e-01   -1.090671254889069e-01   -1.765625660803829e-01   -1.820972356616448e-01   +2.483557099991853e-01   +1.439312705809265e-01   +2.288608071238455e-01   +1.049861506334992e-01   +1.389780141184926e-01   +5.872691155324766e-03   -1.669536263461396e-01; +6.032697827524747e-02   +4.200566439435782e-02   +6.399029964235824e-02   +1.952675583700181e-01   +2.331530229356284e-02   +1.543344457840565e-01   +7.626864481019187e-02   -2.153063677867863e-01   +7.208360282905354e-02   -5.655855224107123e-02   -2.691984620002917e-01   +1.387099934336503e-01   +1.611899253287302e-01   +1.524790898485612e-01   +1.501581239530441e-01   -2.622716929584128e-01; -6.170453475593807e-04   -4.341155920144248e-02   +1.978651331642214e-01   +4.313323729032396e-02   +1.176922414805231e-01   -1.139419074058481e-01   -6.247786759244266e-02   +1.142535591446121e-02   +5.232467983097627e-02   -6.201366021442552e-02   -2.187033978794296e-01   +3.881066944721485e-02   +1.529089976527283e-01   -1.540632514633112e-01   -4.085636850566909e-02   +1.896206418764631e-02; +1.159118803353686e-01   +7.926861927420996e-02   -1.036684764555744e-01   -3.819433414417917e-01   +1.265251900988582e-01   +1.121072352620631e-01   +8.034048591166429e-02   +4.769221785111317e-01   +1.177828024165362e-01   +1.300442843274932e-01   +2.154054593648107e-01   -1.772903187546097e-01   +1.760011372672421e-02   -2.403915422466697e-01   +2.009354089008263e-01   +1.687735293898778e-01; -1.273139386242720e-01   +1.418577704248086e-01   +3.442903911807567e-01   +1.601338676076547e-01   -1.665115617558539e-01   +7.774301894945847e-02   -2.716849767633002e-01   +1.439678445529379e-01   -1.194043047035096e-01   -2.212898554841404e-01   -2.797138315125327e-01   +7.809922217337348e-02   +1.029336032183130e-01   +1.984608354046547e-01   +2.813981015126491e-01   +3.812741393512806e-02; +8.495104565639987e-02   -5.698626508396284e-02   +6.869364145305795e-02   +1.459964449018266e-01   -1.338019641830463e-01   -2.554995287612702e-01   +1.930855391915982e-01   -2.740788497699855e-01   -8.024435399501212e-02   -2.065260264930151e-02   -1.729635257215263e-01   -2.763825428840058e-02   -2.099613921227653e-02   +1.274562743268541e-01   +4.180879113964905e-02   -9.755538990391151e-02; +2.624337118908273e-01   +2.141329186119421e-01   +1.388718120538712e-01   -7.190355743179312e-02   -1.649577820590025e-01   -3.518498755210669e-01   -3.556180073597490e-02   -5.078017336429188e-02   +2.918331509828624e-01   -2.929641470325638e-01   -1.279442898357642e-01   +1.722819243132771e-01   +1.508232245050116e-01   -4.333090184042556e-02   -4.657772918477511e-02   +1.734493734758773e-01];
L2E_L1E_iAMPA_netcon = [-6.863378259350075e-02   -1.869075752235752e-01   -1.018521032159594e-01   +6.826006652174607e-02   -2.077079996666521e-01   +1.715535222205221e-01   +2.005974923496571e-01   -1.485080957862096e-01; -2.603651252873021e-02   +1.021067046331517e-01   -3.230012539537612e-01   -3.048976175477094e-01   +1.571524020109651e-01   -2.404492657773019e-02   +1.589475410519381e-01   -2.060692161444616e-01; -2.138080421444498e-01   -8.716021115732492e-02   +8.998274059622226e-02   -1.042096946099339e-01   +8.228584059486743e-02   -1.023372738566609e-01   -1.621977031941832e-01   +2.211357711949103e-01; -5.150404685191607e-02   +1.683147451295412e-01   -1.596990234871347e-01   -1.208338635011989e-01   -7.695417458730684e-02   +1.933318585142010e-01   -1.642137593248032e-01   +1.402692074967154e-02; -2.881760470579388e-02   +1.477418913229795e-02   +1.431565147207007e-01   +1.279816400436261e-01   -3.190819667483222e-01   +2.963938556837439e-01   +7.008846988317205e-04   +1.278772069441478e-01; +9.181651136051405e-02   -1.159073254524640e-01   +3.407902116869602e-04   +2.827879771963183e-02   +2.621006760926393e-01   +1.335882504876020e-01   -1.166935909073832e-01   +1.474824860904406e-01; +7.801156764829650e-02   -7.978393283049251e-02   -7.094936186615865e-03   +2.610141542216040e-01   -7.218406019345415e-02   +2.432798812829474e-01   -4.694264079487775e-02   -8.892597276491485e-02; +3.157978119174214e-02   -2.658126572160375e-01   -2.043540210560930e-02   -1.406033170124344e-01   +2.795760842732437e-02   -1.742213329260814e-02   +1.803111579659840e-01   +1.132628257941773e-01; -1.462206272085275e-01   -3.693921338093474e-02   -1.897035789666831e-01   -1.300376823800657e-01   +2.404077747537519e-01   +1.441509157438419e-01   -4.958307207095858e-03   +2.132011997956350e-01; -1.857204655582025e-01   -9.687738009541358e-02   +1.428338240278383e-01   +1.193415389615298e-01   +2.970309350067410e-01   -2.619348361770384e-01   +1.348685578642455e-01   -2.010614642400776e-01; -9.394570639760998e-02   +1.935491377135294e-01   -6.171909537425441e-02   -3.241187618164206e-01   +3.819581309465309e-01   +1.232185725625482e-01   -5.200543283404376e-02   +9.124506765704658e-02; +2.889620393581874e-03   -1.474932748558971e-01   -9.827869666650975e-02   +6.124645363479622e-02   -1.772945570911241e-01   +1.687611521309565e-01   -3.417344873975799e-02   -8.843100673902932e-02; +8.096406353773988e-02   -1.453376802811343e-01   -1.116331544546082e-01   -5.790614290133461e-02   -6.960140514939706e-02   +1.767434392899631e-02   +2.828850497124533e-01   +2.123382646068937e-01; +4.500642095444268e-02   -1.648313172123831e-02   -1.517377374840042e-01   +2.930451753422345e-01   +6.878124970142925e-02   -1.427811746963710e-02   +2.259663878115169e-01   +1.298452116046370e-02; +3.566728057646806e-01   +1.632898596631694e-01   +3.886362670709195e-02   +1.822547431922240e-01   +2.582898650732202e-02   +2.800269326813535e-01   -2.616287243005806e-01   +4.326247039209370e-03; -5.299630657983594e-02   -8.081346558360746e-02   -2.132126918254245e-01   +1.094944242229022e-01   -1.021683172180600e-01   -3.619593927991721e-02   +1.258052953802607e-01   +6.603393616769004e-02];
L1E_L2E_iAMPA_netcon = [-2.346058575256545e-01   -2.511872059020560e-01   -1.170267826899853e-01   -3.702526949342821e-01   -1.430962629726399e-01   -1.439960416432815e-01   +2.659920535090601e-01   +1.319604316921192e-01   -2.889593004819332e-01   +1.178287662018207e-01   -4.945844492608663e-02   +2.024412867757145e-02   -4.117098544572059e-02   -2.423897269845168e-02   +2.096895205250134e-01   +1.854137635372943e-01; -1.324599312032993e-01   +1.778129343129039e-01   -1.470713902328812e-01   +5.629464518750685e-02   +2.210319453602295e-01   -2.323793028955858e-01   +3.104033986922523e-02   +3.326643974486742e-01   -1.352252108353030e-01   +4.282503203322282e-01   -2.022643659360466e-02   -1.548298730382512e-01   -3.845493696772916e-01   -8.359955058818964e-02   +1.484508684424155e-01   -2.877592294004346e-01; +3.013043713774286e-01   -2.279053524355069e-02   -4.115751482411356e-02   +6.644911272230700e-02   -2.362160721805935e-01   +5.166071081741630e-02   +5.280851918899999e-02   -1.143329074436967e-01   +1.393274578779451e-01   -1.289231946783165e-01   +5.700614116683613e-03   +2.914557696457219e-01   -1.877809476629892e-01   -2.578153667011175e-03   -2.336264173368708e-01   +8.985322407736188e-02; -6.411089088552015e-02   -3.075609270835614e-01   +7.589099969887997e-02   +2.620345972212758e-01   -3.683613798056776e-01   +1.377330449253275e-01   +9.532286087166709e-02   -6.104480316894736e-02   -1.777453193039349e-01   -3.546836433960336e-02   +1.447667771410457e-01   +1.204780684756514e-01   +5.566429107875798e-02   +2.597957783887381e-02   +1.958569405315953e-02   -3.113103322618590e-02; +2.495535128450349e-01   -6.678045403503607e-02   -2.539699309551290e-01   -1.124252066569000e-01   +1.042624141187080e-01   +2.599046169943500e-02   -6.369652898674338e-02   +1.366072730741330e-02   -5.467866399249626e-02   -7.134349974889713e-02   +7.070809674678447e-02   +2.751247419496599e-01   +1.987366843512344e-01   +2.606973048508285e-01   -7.388334491885062e-02   -1.532883962936982e-01; -1.471939417607160e-01   +8.031990748484066e-02   +2.692468188933050e-01   +1.338245296452946e-01   +2.501735841139392e-02   +1.366449547544604e-01   +9.487763483695361e-02   -4.190228712622596e-02   +1.104240830150075e-01   -1.753298262144269e-02   -9.684665676153281e-02   +2.046483403184931e-01   -8.873815911778962e-02   -1.476345084245101e-01   +1.317159665799811e-01   +6.742097243111653e-02; -1.244536206060978e-01   +1.068180761918393e-01   +1.056283518335387e-01   -7.254845328398064e-03   -1.111313354384857e-01   -2.263594443560001e-01   -1.670285291830354e-01   -1.029166310675573e-02   +9.260277830180942e-02   +1.256704158417311e-01   +1.711048802575322e-01   +1.732528829014968e-01   +3.174671631347331e-01   +9.390248460990284e-03   -3.684445135523170e-01   -1.775318950442253e-01; +1.995690221054135e-01   +1.200173786968123e-01   +1.589676275752094e-01   -3.014042189031418e-01   -1.215443182379549e-02   -2.440836615584966e-01   +1.635049300436536e-01   -1.194745131707398e-01   +6.658483835123470e-02   +4.497342574535254e-02   +3.047638584360766e-01   -1.830954338408332e-02   +2.306511807254387e-02   +8.061752065587920e-02   +5.513057369373343e-02   +1.240732183319437e-01];
L2I_L2E_iAMPA_netcon = [+2.252635361726213e-01   +2.915828505073910e-01   +4.203833333286119e-02   -1.645559372882073e-01   +4.456353475407425e-03   +3.499186964538546e-02   -1.215934047668180e-02   +2.861534178001434e-01; +1.039856566250862e-01   +7.304147725680857e-02   -1.225646045220432e-01   -1.401934846386368e-01   +9.308646072933509e-02   -8.761215156247502e-02   -1.320290964252420e-01   -2.754561908021415e-01; -1.119968760180141e-01   -1.825040434239228e-02   -2.174652196243383e-01   -1.016093692331498e-01   +3.006094897516980e-02   +2.386305577859654e-02   +3.365301271951612e-01   +1.256484542707760e-01; +4.165107217678012e-02   -5.031377813922715e-02   +6.833619059348631e-02   -1.185554611464854e-01   +6.707157021320290e-02   +1.916880847488404e-01   -9.571247271832986e-02   +2.262397429820782e-01; -1.956378922603846e-01   -2.822474048522032e-01   +6.918133126753596e-02   -2.453500663962276e-01   -1.150722685664123e-01   +6.067023080940702e-02   +3.745051155665526e-02   -2.829294673964027e-03; -1.290254780203608e-02   -1.697419410220333e-01   +5.237060344611362e-03   +1.585059292578612e-02   -8.945488905721893e-02   +1.110057758955730e-01   -6.771780304219152e-02   +2.713353890955303e-01; +3.714514137337252e-01   -1.635067046948871e-01   -5.275917515190286e-02   -1.797469693409561e-01   +6.179018090879153e-02   +1.883945655468500e-01   -2.140298186688730e-01   -6.224887673586879e-02; -1.749054190330816e-01   +1.606385344600136e-01   +2.109546854828598e-02   -7.216962067334853e-02   -1.256448550259204e-01   +1.995027416504199e-01   -3.094621979528861e-02   -1.082024380024052e-01];
L2E_L2I_iGABA_netcon = [+2.510494397179193e-01   +7.371681012029724e-02   +1.504381923844519e-01   +3.760221138837561e-02   +2.604450245013404e-01   +1.963469980295642e-02   -4.153749484402982e-01   -7.487194948985766e-02; +4.895232982502921e-02   +1.820124487366737e-01   +1.575226395556543e-01   +2.240037091359319e-01   +1.238982004704499e-01   -1.379689356186924e-01   -1.544642469261790e-01   -1.876213616825602e-01; +2.718455860675543e-01   +2.516273917597359e-01   -2.335253422495243e-01   +1.955944335875124e-01   -2.933985889993455e-01   +3.452966622444762e-01   -3.367865444190113e-01   +5.734177152211306e-03; -1.181275856656884e-01   +7.459343256918279e-02   +1.258720379416711e-01   -1.039735682202942e-01   -1.211751975194613e-01   -3.497620317800316e-01   -9.233258645656164e-02   -1.793574736074638e-02; +2.873222283217026e-02   -1.412255399114481e-01   +2.790471742148534e-01   -1.939325756310827e-01   -2.257260439767051e-02   +1.658144883220697e-01   +4.921874488670960e-02   +8.058909230527134e-02; -1.438758511818966e-01   -1.453932446872697e-01   -9.354526599608566e-03   +2.908612677158124e-02   +7.302564731692890e-02   +1.305501487066419e-01   -5.381982140429512e-02   -1.585740288289754e-02; -7.285306126250869e-02   -8.394047104557463e-02   +3.464282644623308e-02   -9.213754794555892e-02   -1.690143027321855e-01   -2.430374969271980e-01   -4.121821230962481e-01   +1.654419386972228e-01; +1.243155788659050e-01   -2.224304360718160e-01   +1.336578918632616e-01   -3.890262782603790e-02   -8.229089910898137e-02   -1.378604301485803e-01   +9.862366632861183e-02   -1.407802503642763e-01];
L3E_L2E_iAMPA_netcon = [+9.899819585513026e-02   +1.206045320247869e-01   +1.260834051870112e-01   -1.012518677008579e-01   -2.228353989417776e-01   -4.949040172137599e-02   +3.817452177460084e-02   +6.597349045111603e-02   +7.645964754033510e-02   +4.900400708271670e-02   +1.649011659832282e-01   +2.599896557893957e-01; -1.353872705251716e-02   -1.071288988886467e-01   -7.276304797750682e-03   -1.682956319063080e-02   -5.606026075363807e-02   +1.387218310566793e-01   -7.534055795753375e-02   +2.276953711835907e-01   -1.705797648977957e-01   +6.134516788392448e-02   +2.407043246741670e-02   +1.314693657206537e-01; -1.206992209655300e-01   -1.896464144576280e-01   -3.127627470912182e-01   -2.697550657286257e-01   +6.100683526605666e-02   -3.009950477038054e-01   +1.641487188923655e-01   +1.733618042372263e-01   -2.913248331715914e-01   -2.008180276919063e-01   -2.915164123654976e-01   -1.597593813301534e-01; +2.595981179615278e-01   -1.521829031040911e-01   -1.362149799634296e-01   -1.719454840646069e-01   -8.344508742044328e-02   +1.552193629453008e-01   -2.988299624017355e-02   +5.159003323260421e-02   -7.266225477333067e-03   -1.767425217662867e-01   +2.194499769618059e-01   +3.945834810326964e-01; -9.503604119483808e-02   +1.614596016070428e-02   -2.697423924466951e-01   -1.089507245737434e-01   +2.222157336236748e-01   +2.868668270977517e-01   -1.325208754527230e-01   -1.952310274577821e-01   -1.609016583293048e-02   -1.538946360533175e-01   +2.943920788847307e-01   +2.909653803141903e-01; +4.836764352967496e-02   +5.650919127540406e-02   +1.967113608404584e-01   -2.094548771154487e-01   +1.957313677773451e-03   -1.723489284899059e-01   +1.892180814716723e-02   -1.962867434988019e-01   -1.040493514544521e-01   -2.744266478237112e-01   +1.340982241480180e-02   +1.103553028455173e-01; +2.122974125641225e-01   -2.974513605304784e-03   +9.396619285763752e-02   +4.004011603731239e-02   +1.647284145921124e-01   +7.034904498655437e-02   +1.759177928204023e-01   +2.536870841942317e-01   -1.360717495773106e-01   -6.648196984370888e-02   +2.627003479910113e-01   -1.259969519229938e-01; +6.479447482455455e-02   -4.540205113098560e-02   +4.326265705370223e-03   +1.295175923764128e-01   -3.448884836860698e-01   -3.313712606520230e-02   -3.780073534515293e-02   -1.137250834550343e-01   +2.904687143575848e-02   -7.485645447659928e-02   -1.233731274432920e-01   -1.349766127477272e-01];
L3I_L2I_iGABA_netcon = [+2.320981071939436e-02   +2.320421566430930e-02   -5.601267852872257e-02   -1.084859127181499e-01   -5.278714308680865e-02   +1.797580570451753e-01   +9.426403610422560e-02   -1.106286018857566e-02   +2.207940214892841e-01   +3.322088822551969e-01   -1.098842591548529e-01   +1.454591041820245e-01; +3.173653407050432e-01   -1.674685052037530e-01   -8.849817293178729e-02   +3.255465758459063e-01   -1.909338851185530e-01   -5.350062369736166e-02   -1.863823203128868e-01   +2.098506299243129e-01   +1.141106353197582e-01   +5.498155702368826e-02   -4.619869582657136e-02   +4.101232687212307e-01; -5.165454516373819e-02   -7.886192657753455e-02   +2.740448430163409e-02   -1.375405105641766e-02   +3.535805840424149e-01   -2.282480986011662e-01   +2.637809556890539e-01   -2.841452452269388e-01   -3.209371182453024e-02   +9.536248380016216e-02   +4.587471156459359e-02   -1.434327042428197e-01; +6.390396092619013e-02   -8.740085008252650e-03   +1.528936521377324e-01   +4.257714494052891e-01   -1.376332588229698e-01   +7.860841503659471e-02   -3.147152915641242e-02   -1.553976773610697e-01   -3.765226321230337e-03   +1.570162753647590e-01   +3.243847645693295e-03   +2.029537151626514e-01; +1.130334761317286e-01   +1.253660282244445e-01   +3.108902141665016e-02   +3.121621190143913e-01   -6.314484163255701e-02   -9.803185070380356e-02   +2.147654473884834e-02   +2.743762821838664e-01   +1.039462673833070e-01   +1.361638697946536e-01   -1.260477038470883e-01   +9.036444474564126e-02; -3.240581731486107e-02   -2.207555850926556e-01   -3.339387985916971e-02   +5.059979339900682e-02   +1.112453095695472e-01   -1.187790810378826e-02   +9.109895718157315e-02   +1.748196083898998e-01   +7.765834106260082e-02   -7.358651234465212e-02   -6.503336338853162e-02   +4.760325455905397e-02; +3.669551107747944e-02   +2.750066204141485e-01   +6.205402452769026e-02   -1.619899298064955e-01   +5.730006503055223e-02   -1.014282807416159e-01   +9.997057231173806e-02   -1.113198874094294e-01   -2.141091267000771e-01   -9.729061454796833e-02   +2.019692551976863e-01   +2.625637758134595e-01; -1.438992423010529e-01   -1.935703865050585e-01   +3.967131462113506e-03   -2.118524916643352e-01   -2.223626497932354e-01   -1.332029083972663e-01   +2.414393467101374e-01   -1.652853433056539e-01   -1.471468650326413e-01   +1.301386076204523e-01   -1.322683467307069e-01   -2.081185569798767e-01];
L2E_L3E_iAMPA_netcon = [-8.019819222835889e-02   -7.079327920618363e-02   +1.911000507907666e-01   +2.860474495510881e-01   -2.756075787195803e-01   -7.955044136219164e-02   -1.519972196874472e-02   -2.138142950730068e-01; +8.775779354562775e-02   -5.023570038467910e-02   +1.523822099762680e-02   -1.673459451404490e-01   +2.066947600204195e-01   -2.745850509689435e-01   +6.229046095159858e-03   +1.874520109517602e-01; -1.920072882589418e-01   +2.795411947918059e-02   -5.679237555632972e-02   +1.723024812271889e-01   +1.730083804815715e-02   -1.170118701477278e-01   +3.749365509672793e-01   -1.496477485694876e-01; +2.973138081417825e-02   +4.833033741471731e-02   -1.083750901328277e-01   +1.095785646715547e-01   -1.416243388634209e-01   +2.001006057898963e-01   +1.280540367295131e-01   +2.948233971979589e-01; -3.065939665671433e-01   +2.700248194487070e-01   -4.972509679185499e-02   +1.096949886177343e-01   +1.549159232592519e-01   +1.478752805462652e-01   -1.475225585805117e-01   -2.065844197461008e-01; +1.025771139397334e-01   +1.077410586150953e-01   +1.759963611516387e-01   -6.268194377189638e-02   -2.717922647706201e-01   +1.447444036202219e-01   -2.372496780928838e-01   -2.120149776359346e-02; +1.894028693561822e-01   +9.333256754825947e-02   -6.796858654755883e-02   -1.404147912922545e-01   +1.692580120988777e-01   +2.105112881321000e-01   +4.492573917805820e-02   -2.823257726775587e-01; -5.526204646041919e-02   +7.341763439525209e-02   -1.229681238131494e-01   -1.357309809908335e-01   +6.976293788988988e-02   +7.654444811244232e-02   -2.988902626280058e-02   +1.936764238692850e-01; +3.899065430729371e-01   -2.536577960646875e-01   -1.915735906251298e-01   +2.000321275866339e-01   +2.870774176380924e-01   +1.149525896726838e-01   -2.990732634338851e-01   +1.325020979897447e-01; +1.729681744341034e-01   +2.091386547769659e-01   +5.862589242217586e-02   -2.782007015540735e-01   -1.916012239290770e-01   +9.317145576395985e-02   +1.314436957111450e-01   +1.256875720087623e-01; +4.154484349496933e-01   -1.327971467363189e-01   +1.576098592974585e-01   +3.434180363079957e-02   -2.415508048702252e-01   -1.201245162680338e-01   +6.466908547863522e-03   +6.373515560282658e-02; +2.424068335415515e-01   +5.420085788986025e-02   -3.056435620015465e-01   -1.359821459684569e-01   -3.118741293172351e-01   -1.687396775829635e-02   +4.322293933730584e-02   -1.227726245723750e-01];
L2I_L3I_iGABA_netcon = [-2.775701536867000e-02   -1.021082626218899e-01   -5.422848879542052e-02   +3.013822386663318e-01   -9.214858765560142e-02   -4.181796065257329e-03   -2.908370028174725e-02   -4.246997394176825e-02; +2.394970104059053e-01   +2.843592547928722e-01   +1.330887993166484e-01   +1.362895021462736e-01   -1.034373446372776e-01   +2.140124938377292e-01   +3.777689293128725e-01   -7.391069652368525e-02; -1.422623648421393e-01   -2.056052772404003e-01   +6.221445597369447e-02   +2.475870628585430e-01   +1.663920444847548e-01   +1.379032295456336e-01   +2.915487712888076e-01   +1.259345789742153e-01; +2.429317954123379e-01   -1.785243795819295e-01   -3.452881709599670e-01   +1.305104225719234e-01   -2.409688429776948e-01   -2.619117198961474e-01   +1.064659281220489e-01   -2.189254539143821e-01; -1.230788937437961e-01   +2.224415247574455e-02   +3.714671936898467e-02   -3.779875357758389e-02   -2.813616530854119e-02   +2.852898753935360e-01   -1.346449852909457e-01   +5.980554902624367e-02; -5.458426820690462e-03   -2.927467959205469e-01   +2.505810736833856e-02   -3.790069241766632e-01   +1.278139860864374e-01   -1.274460062864191e-01   +5.838860933542794e-02   +5.279139833286337e-02; -2.865381611220292e-01   -3.113309276697963e-02   -1.700522793150263e-01   -9.586245788764439e-02   +9.030333425244128e-02   +2.170512985784892e-01   -1.985487599430374e-02   +8.521204530553340e-02; -1.690880985416048e-01   -1.707694257237780e-01   +1.064706480660741e-01   -3.126227209086396e-01   +3.458460532269608e-02   +1.628443518304099e-01   +1.924372231884027e-02   +6.629111959500487e-02; +1.249894149504273e-01   -1.163056653400993e-01   -2.822253381306036e-01   +1.840948030680108e-02   -2.202792733130365e-01   -4.270813138331040e-02   +8.588456231377127e-02   +3.788124031333981e-01; +2.398645391206982e-01   +2.529838287951905e-03   -1.137131501801213e-01   +2.241454377746344e-01   -3.358372738260818e-01   +3.207690921089951e-01   +1.664010796136260e-01   -6.801089546936082e-02; +4.095581771913678e-02   +1.068353174830240e-01   -2.920952057372767e-02   +2.552994989708976e-02   -3.143042145577977e-02   -9.208319838941290e-02   +3.545949218237484e-01   -8.891851574640400e-02; -2.058165921756936e-01   -2.378626529215058e-02   -7.913130633889104e-02   +4.713530586459179e-02   -1.429491990898643e-01   -4.628806773798187e-02   +1.363891467750807e-01   -3.027237749015227e-02];
L3I_L3E_iAMPA_netcon = [-3.649125327202612e-01   +1.186702672873327e-01   +2.061791032707583e-01   +5.758048124186879e-02   +1.331449453662970e-01   -1.929805247660062e-01   +7.809938539123519e-03   -1.120417722117961e-02   -1.194832825902969e-01   -1.176348692546721e-01   -1.680798747921680e-01   -6.101472273600314e-02; -2.120870869619815e-01   +1.520154528716164e-01   -3.229336528276271e-01   -2.091144314357043e-01   +4.806662037951711e-02   -1.732094050349016e-01   -1.738016084564608e-01   -7.770055604328052e-02   -9.283156103666255e-02   +3.208494561553102e-01   -1.619727359331042e-01   +4.737706077985759e-02; -1.050550601118563e-01   -2.321143559630366e-01   -2.618039402947888e-01   +2.741342282679966e-01   +1.616518067936486e-01   -2.773899749421154e-01   +2.898410875644392e-02   +1.650651308711933e-01   +3.807767346648720e-03   -1.530269358974687e-01   +2.679155177695751e-01   -9.959638486884140e-02; +2.663397386981217e-01   -2.094653224111749e-01   -7.370282937857627e-02   -2.649964028099988e-02   +2.376249069201032e-01   -1.195673777652344e-01   -2.523313867679863e-01   -1.487066058781250e-01   -3.258581801031768e-02   -2.987592976238964e-01   +1.192320948431783e-01   +1.812635336425065e-01; +4.323351379256744e-02   +3.919762636492907e-03   -1.334606950059534e-01   +4.043562550644725e-02   -2.389061279180122e-01   -4.328570389218266e-02   -2.879858257061508e-01   +1.010070131912381e-01   -9.075295509461667e-02   -1.585353722084788e-01   -3.285397719125431e-02   -2.357868064641165e-01; -2.485039158066228e-01   -2.506657991830326e-01   -4.294268521652994e-03   +1.756960493211886e-01   +3.919169325718992e-02   -7.627180206185516e-02   -4.253008262504233e-02   +2.609757431429828e-01   -2.097357722269947e-01   -2.109707193191495e-01   +8.871455758765620e-02   +3.119532147759420e-02; -1.938651567515837e-01   -1.117336095851551e-01   -1.196203669188241e-01   +1.989706219620777e-01   -4.056830551082691e-04   +2.724730118765367e-01   -1.486127182145361e-01   -4.777083105448174e-02   +2.623287027535360e-01   -1.355442665522861e-01   +9.420874816926648e-02   +2.138100032686038e-01; +7.622608909589448e-03   +1.301319942701329e-01   -8.583536302207367e-02   +2.190964773346607e-01   -2.389014113938097e-01   -2.944043274742543e-01   -1.604011275406880e-02   -5.720448097288523e-02   +2.299599796779223e-01   -3.448221287742902e-01   +1.868048448675086e-01   +3.795357796119694e-02; +1.941726562107334e-01   -1.067422174025320e-01   -1.917181175739839e-01   -8.812221468775058e-02   -2.789484338011266e-02   +1.627861901801516e-01   -1.482124856062603e-01   -1.669499178896463e-01   +2.420659382234467e-01   -1.556863357621736e-01   -2.059507880543963e-01   -6.603273390414484e-02; -6.959839548190216e-02   +1.966081204621148e-01   +9.565403284445860e-02   +2.148433302839679e-01   +2.976650458769006e-01   +1.720467306796537e-01   -8.191040422989281e-02   -1.325555616258500e-01   +4.511654703386263e-03   +2.121234410613118e-03   +3.079936226333382e-01   +7.742442963347584e-02; +6.144873597536192e-02   -9.672340099831947e-02   -4.025367589008841e-02   -4.409894466975453e-02   +6.808868159384943e-02   -4.970085892707216e-02   -1.417751416409175e-01   -2.346656838506736e-01   +7.702709356596155e-02   +2.749560784522901e-01   +5.443818730181464e-02   +2.248198815570592e-01; +1.544449432114278e-03   +2.252933921579383e-02   +1.869875742322450e-01   -1.433731703010872e-01   -4.172750474682681e-02   +1.026360038406812e-01   -2.276798313123099e-01   +1.295641126872943e-01   +1.200331838470271e-01   +8.341702826384025e-02   -1.787319022015940e-01   +6.983396700336363e-02];
L3E_L3I_iGABA_netcon = [+2.799548146663041e-01   -8.541930739928608e-02   -6.787101769881440e-02   +1.983633587107203e-02   +1.724647922484966e-02   +2.441984397551550e-01   -7.944180290118498e-02   +1.598275303529068e-01   -4.626815387783784e-02   -1.279578731378709e-01   -3.771021841367167e-02   +2.692900479109714e-01; -1.502419146295394e-01   -2.379277763166457e-01   -3.179081886656567e-01   +8.010994813243191e-02   +2.335245467704965e-01   -9.261143760865212e-02   -7.172590452206903e-02   +4.040997995041728e-02   +1.530794019033561e-01   +2.409429708363489e-01   +3.544596731627778e-01   -2.727535822671832e-02; -1.620420734199937e-01   +1.543891906440376e-01   -1.500856275278821e-01   +6.690035565696125e-03   -1.767776929512470e-01   +1.142300376279953e-02   -1.084398476359770e-01   +2.678498531824293e-01   +8.619853849679308e-02   +2.530537366425724e-01   +1.932359704784562e-01   +3.384444471140329e-01; -7.079547803750411e-02   -3.271637026980353e-02   +2.973677198050850e-01   +1.363582770727134e-01   -1.317459413573672e-01   +7.377579088530377e-02   -1.120592031684680e-01   +1.281630301845291e-02   -1.303990624887670e-01   -7.636975477976590e-02   +5.432478640562592e-02   -2.645257529408169e-01; +1.596324601015740e-01   +3.920563201587997e-02   +2.290930044770709e-01   -1.239048921305078e-01   +3.537870854402115e-01   -1.197643309538854e-01   +4.612757601412238e-02   -2.611261561235830e-01   +7.489939557000054e-02   +1.476542683887274e-02   -2.297932918473462e-01   +5.368242571982133e-02; +2.039827875320756e-01   -1.042407211101222e-01   -1.663738063113170e-01   +2.384017572430996e-01   -1.322194205204589e-01   +1.748176064192415e-01   +9.381982989428832e-02   -2.368705293412596e-01   +1.733722094618796e-02   -5.629938126774716e-02   -2.205507267783417e-01   +1.261593043299740e-01; +2.520355629182249e-01   -2.392274107812231e-01   +1.467911726092070e-01   -4.209390592717753e-02   -2.563284222054766e-01   +1.474353648922026e-01   +1.555330636151987e-01   +2.836611881835233e-02   -8.879257236441220e-02   +5.839790658064791e-03   +1.031378342814286e-01   -9.818295771318956e-02; -5.517237918757059e-02   -1.445096978819972e-01   +7.656670451701941e-02   +2.437340733847235e-01   +2.175599046575137e-01   +7.546258538942002e-02   -2.574898789797202e-01   +2.858378861717423e-01   -1.840524979637775e-01   +7.281561881042206e-02   -1.348021375865755e-01   -8.240085719629850e-02; +4.208618636100413e-02   -3.933811447309416e-02   +9.914828200034850e-03   -9.298758281856240e-02   +8.896895052424081e-03   +6.526679268536276e-02   +3.390422278516795e-02   +2.768532308189518e-01   +2.399564456337637e-01   -9.064079428217015e-02   +1.361039160108962e-01   +9.019447567433130e-02; +8.171855937184502e-02   -2.138933218036747e-01   +1.511585794773607e-01   +1.063037867566840e-01   +1.046203659861733e-01   +3.272000079751801e-01   -3.595130188567496e-02   -1.467383893747387e-01   -1.969857048485934e-01   -2.678910118187260e-02   +3.696669826591696e-01   +1.419010425236240e-01; -3.412792316894590e-01   -1.783440946829526e-01   -8.776517869061037e-02   +1.548760552646071e-03   +3.190725904460491e-01   +1.680861093562867e-01   +1.280302350247237e-01   +2.985115742226239e-02   +9.347687796368506e-03   -2.439991613728246e-02   +1.526313717945199e-01   +1.128940096824522e-01; +5.292069663108199e-02   +6.962699355295041e-02   +5.368780878180280e-02   -2.155136426534804e-01   +2.228494018788781e-02   -4.271646003831366e-02   -2.219180182010485e-01   -2.686359594449483e-01   +2.389082870734878e-01   -1.702171336907937e-01   -1.973259773698190e-01   -5.021834253498624e-02];
L2E_Input1_iAMPA_netcon = [-1.722603855014592e-01   +5.925680779098531e-02   +8.462448625486832e-02   -2.722121504262616e-01   +1.324312897614531e-01   -3.596912380483856e-02   -1.584952769997710e-01   +2.784349831218662e-01];
L2I_Input2_iAMPA_netcon = [+1.030013665147025e-01   -1.636747491126595e-01   +2.195683686389025e-01   -1.047911193705914e-01   -1.376619844385072e-01   +1.365207415784786e-01   -1.861067537270869e-01   +7.659592070313087e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
