function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.282289391467558e-01   +1.488592842758434e-01   +1.612808688736171e-01   +9.801680950392122e-02   +4.430665859789736e-01   +1.320402747836052e-01   +4.326631765035927e-01   +1.351323456881151e-01   +6.112899979814262e-01   +3.761406866308791e-01   +4.557137879342182e-01   +2.002767812176836e-01   -7.051296644786731e-02   +1.557842017141286e-01   +1.277400443834334e-01   +2.876514692574502e-01; +6.089261087050311e-02   +2.533868588350611e-01   +4.684846542316454e-01   +2.225831071636807e-01   -1.831953116739939e-01   +1.953602587332826e-01   +2.955986083213069e-01   +3.546803126370795e-01   +4.240479563427531e-01   +5.192630241371431e-02   +4.487337172009184e-01   +2.067972855937949e-01   +2.964451513834647e-01   -4.579799278531971e-03   -1.514499597779537e-02   +4.398135616352723e-01; +9.415533517750112e-02   +1.513517371229539e-01   +3.597577915961110e-01   +1.703618055108680e-01   +8.799606983727630e-02   +2.663328828099923e-01   -2.261222932487793e-02   +1.361879949850190e-01   +2.998220976338765e-01   +5.047704283716944e-01   -8.941259979282377e-03   +3.587376742775515e-01   +1.193500779711582e-01   -2.255719475123270e-03   -1.270693147513325e-01   +6.104744038022095e-02; +3.570847589689766e-02   +3.706276631095144e-01   +3.424250028857265e-01   +3.029270622135898e-01   +2.132980163466085e-01   +6.048491419417144e-02   +2.313483875855342e-01   +3.320229362020582e-01   +4.250144137974831e-01   +3.779939176791793e-01   +1.846061412520818e-01   +4.089436761038449e-01   +3.723424103151486e-01   +5.375493445711168e-01   +2.359696951121384e-01   +2.070735238384790e-01; -5.652988439963633e-03   +2.232394153586925e-01   +5.282243928289275e-02   +3.062471389491315e-01   +2.697197351306247e-01   +3.658322351105452e-01   +4.099615854011946e-01   +3.961709556509035e-03   +3.585052949862913e-01   +3.389216965851794e-01   +2.773202371537005e-03   +1.528353312453887e-01   +1.333201377944122e-01   +3.381692087652511e-01   -2.519681796937832e-02   +1.100578639558697e-01; +5.129812698580714e-01   +2.389578923786623e-01   +1.777280634512204e-01   +5.420553229464773e-01   +3.632683526896259e-01   +3.903323433218390e-01   +4.608660535846883e-02   +1.776844347654963e-02   +3.043203907348268e-01   +2.822255615057892e-01   +3.435400823239322e-01   +1.529852975668234e-01   +5.080948778458525e-01   +5.638325009453742e-01   +4.383553117659077e-01   +2.165549335678718e-01; -1.586131078088758e-02   +2.172909462869598e-01   +3.070994466551999e-01   +3.907771857418497e-01   +3.507559447026437e-01   +6.495936268767813e-01   +2.812705819364441e-01   +3.511215580292276e-02   +3.330143150328888e-01   +5.785901833836390e-02   -1.497649921217558e-02   +2.326071354214159e-01   +5.271437787185688e-01   +3.969298337585938e-01   +2.418918522810869e-01   +5.133260235833318e-01; -2.067951525590571e-02   +5.322089658087499e-01   +1.206442470830574e-01   +5.604436452756389e-01   +6.187255316881757e-02   +4.036584492716288e-01   +2.537397042030837e-01   -1.093748356470758e-01   +4.415393992446524e-01   +4.003032155023303e-01   +2.483044740452163e-01   +4.708435824274178e-02   +1.522360473214909e-01   -2.905363804645619e-02   -6.404458207732974e-02   +4.792730250626570e-01; +7.737241782612102e-02   +8.643081984693321e-02   +3.593657336262246e-01   +1.090401327049721e-01   +2.457956777435185e-01   +1.461367221686692e-01   +3.850659325002586e-01   +1.573173680007533e-01   +5.912108716849331e-02   +5.574565709363321e-01   +3.569252568642208e-01   +2.694092958101771e-01   +7.750374433504148e-02   +5.562879488534886e-01   -5.207343737391072e-02   +3.259548759487126e-01; +1.072085862171755e-01   -1.221857665573714e-01   +1.726032871667654e-01   +1.044764817410295e-02   +1.197617093558101e-01   +2.968590357634740e-01   +3.242537694215610e-01   +1.286515922960230e-01   +3.384512163397457e-01   +1.799866835559947e-01   -8.643166831013679e-02   +4.153861834385510e-01   +4.508014928525234e-01   +1.043200700905615e-01   +4.304825221379703e-01   +2.294121274671944e-01; +1.434565582842649e-01   +2.112424124699365e-01   +2.384815903162454e-01   +8.546624500566169e-02   +1.447240669634670e-02   +2.323928439380767e-01   +1.825331352255624e-01   +3.430088938444500e-01   +3.898810211565333e-01   +2.307666380532619e-01   +2.261535903260136e-01   +4.073864629515878e-01   -1.532686092061410e-01   -5.303116075033382e-02   +1.735384195099011e-01   +2.258262294794205e-01; +2.836922675671721e-01   +4.421755354149050e-01   -7.028565832337652e-02   +1.173898182685255e-01   +6.068157366883971e-01   +1.043282821891557e-01   +4.302741621206944e-01   +2.773284290341239e-01   +3.597473547538149e-01   +1.408170341976460e-01   +7.153277215401538e-02   -5.527860329477591e-02   +3.422136864047989e-01   +2.637181100346784e-01   +4.237331421812112e-01   +2.409928911363685e-01; +1.463858281794685e-01   +3.997972157550641e-01   +5.972646345149582e-02   +1.176787982480493e-01   +6.394795696172232e-01   +3.682095780290950e-01   +8.110867020897436e-02   +2.916868298216075e-01   +7.301760042606141e-01   +5.787365298864979e-01   +4.900869640438289e-01   +2.249948512928293e-01   +5.929380551773085e-01   +3.785923895286233e-01   +1.364942114182749e-01   +4.498198125991175e-01; +3.630475985725538e-01   +3.915500999697258e-02   +4.581775348981336e-01   +3.370471711732089e-01   +1.739645152168172e-01   -2.909703589935601e-02   +5.647225259530222e-02   +3.953505407356271e-01   +4.900982005553666e-01   -4.417276352910238e-02   +1.074775726960303e-01   +4.343810424635340e-01   +1.892708099528428e-01   +4.481021731493783e-01   +1.688007089896680e-01   +5.335905354520923e-01; +1.647279991333741e-01   +3.506283890722439e-01   +5.120470309955768e-01   +2.465750546846923e-01   +6.155310061286552e-01   +1.582425535682688e-01   +2.572744731717025e-01   +3.670528903583280e-01   +3.003175910347733e-01   +6.439508739082533e-01   +1.992069013875819e-01   +3.340697574695639e-01   -4.029705940746733e-02   +2.576341917559730e-01   +5.966883650761565e-01   +6.417130686191288e-01; +2.705353742387182e-02   +3.919790927358656e-01   +4.584241107019864e-01   +1.507719999955021e-01   -8.394992562547637e-03   +1.225933554728723e-01   +5.116394307140598e-01   +5.197360377018510e-01   +5.774660473338468e-01   +9.922539364878596e-02   +5.169358373279959e-02   -7.187963913963853e-02   +5.761496972658647e-02   +1.895909749039068e-01   +4.844676489870665e-01   +3.787629103250286e-01];
L1E_L1I_iGABA_netcon = [+4.260409356577722e-01   +4.258660369625818e-02   +4.621802310675766e-01   +1.252714976392227e-01   +3.338372161287259e-01   +2.220111254756736e-02   +3.664418890309705e-01   +3.625023442990318e-01   +2.627743132834534e-01   +3.447103023011051e-01   +3.919368127084759e-01   +4.540321838149033e-01   +4.899448377869050e-01   +1.731654008413050e-01   +1.370236422164494e-01   +3.369371564735802e-01; +2.717321302603619e-01   +1.579410108126560e-02   +1.922895110023136e-01   +2.057267757122197e-01   +2.457457758151870e-01   +3.287455532611727e-01   +1.232519251154369e-01   +5.089202413097392e-01   +4.460461481213101e-01   +3.319760737439599e-01   +9.636334751738145e-02   +1.830979520414504e-01   -2.739246788784212e-02   +4.146506122657132e-01   +1.789846483924920e-01   +2.920458787312755e-01; +3.187540490518477e-01   +1.206632682971333e-01   +2.719388732615519e-02   +2.121762866691968e-01   +2.382132586958042e-01   +1.785003860314374e-01   +5.608360038087375e-02   +2.461431943650166e-01   +7.434519566247201e-02   +2.381103873787484e-01   -1.174404299818173e-01   +2.541244409393392e-01   +8.064096889479264e-02   +1.364029582301218e-01   -1.840992329034481e-01   -2.681486102947671e-02; +1.727141127886012e-01   +1.980779627266466e-02   +5.053350400516394e-01   +9.635666685464153e-02   +4.434851959571159e-02   +3.240567928260370e-01   +3.091708773123352e-01   +2.227837950869746e-01   -2.167941575642895e-02   -1.614341593680090e-03   +5.276672356989038e-01   +4.642426409584972e-01   +5.283968338480458e-01   -9.986790402892358e-02   -3.028105280708095e-02   +4.340087583860102e-01; +5.366696600428247e-01   +5.404040244591237e-01   +5.791236527278587e-01   +1.289472246440188e-01   +3.718783280061770e-01   +2.831620496280437e-01   -1.159624890631934e-01   +4.799822149954146e-01   +1.787081590169428e-01   +2.821882871432145e-01   -1.197311890534487e-01   +1.120322626508707e-01   +4.388822751383976e-01   +2.077404104065175e-01   +2.312560577844173e-01   +1.246514810149343e-01; +3.745004553617602e-01   +4.070132613192610e-01   +1.801621984336140e-01   +5.811133834660274e-01   +4.086604019921815e-01   +4.764407299307568e-01   +4.345182762517839e-01   -1.392237514216174e-01   +5.016105919950010e-01   +5.172503684142717e-01   -1.351064159273719e-01   +4.625510875900239e-01   +1.886533612917397e-01   +3.430083217258119e-01   +4.243662102513580e-02   +4.658463290160672e-01; +4.531760695322443e-01   +4.493117662563971e-01   +3.181145095495807e-01   +1.455625087509785e-01   +3.388781988070242e-01   +2.876435102894321e-01   +2.487119619099060e-01   +2.553464982129799e-01   -3.749691768996199e-03   +1.185644495912371e-01   +3.021763993062456e-01   +1.713143191188727e-01   +4.602580268855376e-02   +2.804413675481470e-01   +2.953006791062901e-01   +2.442477658181379e-01; +5.051367004750534e-01   +2.750472950034020e-01   +6.047164801049134e-01   +2.523249169926444e-01   +2.949163637254982e-02   +1.677038692869280e-01   +3.523944681626302e-01   +7.224258298436961e-02   +3.215832715780325e-01   +1.119611159674051e-01   +4.559426740062381e-01   +3.618610273222204e-01   +3.106561087002123e-01   +6.877730314780947e-02   +5.096482791215213e-01   +4.998496382016356e-01; +3.394540785311791e-02   +6.362961424119953e-01   +4.028401470210723e-01   +1.358012118468957e-01   +3.560151019675916e-01   +2.901938386991909e-01   +1.636967541283297e-01   +1.081529016380527e-01   +2.904976667795310e-01   +2.100113934177444e-01   +1.936210956507651e-01   +1.741525327192260e-01   +1.664585684904406e-02   +3.062521993504757e-01   +1.738578460242584e-01   +2.043532586050533e-01; +1.879020849535735e-01   +5.008345089530828e-01   +4.902197840824872e-01   +2.522681547373591e-01   +3.948304464911213e-01   +5.652600701172398e-01   -1.640606134901908e-02   +1.955636224008259e-01   +1.984976646572948e-01   -7.902155734287321e-02   +2.002495417477868e-01   +3.196703052012380e-01   +1.180728812163229e-01   +6.905554624891064e-03   +1.481949267831824e-01   +3.650070683930174e-01; +1.502140225310065e-01   +1.934206877532955e-01   +1.270462880737956e-01   +2.295888074566164e-01   +3.272673918567768e-01   -1.364601820413210e-01   +3.629206820009249e-01   +2.773957020896581e-01   +1.511537456582752e-01   +2.031277893182284e-01   +2.172986140880121e-01   +1.523664879108759e-01   +3.407405818880772e-01   +3.113001635369083e-01   +3.051716951828593e-01   +4.009286502217001e-01; +3.120369719617036e-02   +1.607950288887036e-01   +1.651636794093169e-01   +5.128492630620037e-02   +2.201312575840252e-01   +2.881781069884561e-01   +1.064807465554830e-01   +4.296330763886362e-01   +6.180475874533901e-01   +3.320420616465213e-01   +6.067435014788559e-01   -9.917934008618186e-02   +2.189408154089251e-01   +2.282430627167225e-01   +3.805730755238233e-01   +4.584210591957150e-01; -9.675810264335960e-02   +5.261212222846705e-01   +8.151626384751789e-02   -1.302026091285011e-01   +4.408797645595367e-01   +7.976341989121026e-02   +3.858502236952509e-01   +4.523269229912635e-01   -1.378560518256182e-02   +3.319405982203811e-01   +2.547475042513204e-01   -3.476138530861275e-03   +4.795737231217302e-01   +4.642019100740731e-01   +6.107269375875926e-01   -4.692222992308444e-02; +9.114150616971906e-02   +3.167403479491344e-01   +5.442782074586157e-01   +4.688554356088297e-01   +3.251564946181622e-02   +2.577984873803142e-01   +8.192911971870129e-02   +3.121672000014672e-01   +3.153361849945033e-01   +2.239996093662984e-01   -4.232846328072511e-02   -8.967969262626756e-03   +1.733623832029936e-02   +4.456250582972082e-01   +4.357104290777807e-01   +2.376611276813224e-01; +1.555811368768008e-01   +3.882080281422627e-01   +1.841465039379458e-01   +4.166610780743118e-02   +1.020133365365308e-01   +5.053927113321194e-01   +4.504130565969362e-01   +3.048204178380963e-01   +3.759818145093241e-01   -1.704456385434390e-01   +2.835512607405075e-01   +6.155932004458127e-02   +2.166078557243826e-01   +1.716904564607362e-01   +3.039422770201828e-01   +3.922034334762497e-01; -1.131084331512389e-01   +5.664678751886759e-01   +2.471570858027333e-01   +6.093266466457656e-02   +1.236830897260519e-02   +1.089378511918863e-01   +5.215039430958209e-01   +7.743424766905954e-02   -1.023838767833700e-01   -1.074447548678634e-02   -6.059041481010181e-03   +3.781024410350170e-01   +6.458706559968784e-02   +1.299784510078149e-01   +3.245624731727424e-01   +4.356901404477252e-01];
L2I_L1I_iGABA_netcon = [+2.509499358683588e-01   +3.310170804778692e-01   -5.190196547126531e-02   +8.195597934742849e-02   +2.654270445493018e-01   +2.357632956292190e-01   -9.267198278457241e-03   +3.212380545263085e-02; +2.253579150323824e-01   +1.582168857649414e-01   +3.977781200946135e-01   +4.384851214133020e-01   +4.156037273398357e-01   +2.610680132403645e-01   +5.696819070336224e-01   +3.466045310764125e-01; +3.486977128214562e-01   +6.162583638621927e-01   +4.644584945535906e-01   +1.380943272827910e-01   +4.226068460063825e-01   +2.662350572508971e-01   -1.050141626539876e-01   +5.833808652196874e-01; +1.238570279404850e-01   -5.309890739595059e-02   +2.190553640347510e-01   +4.007692476206593e-01   +9.944808324693580e-02   +9.795128221456503e-02   +5.108998079305422e-01   +1.828674251684835e-02; +1.636629265513485e-01   +9.619572190294215e-02   +3.157661051847180e-01   +4.853270203843794e-01   +4.839446569681404e-01   +5.160377349321567e-01   -1.085408134314605e-01   +3.804577065051676e-01; +2.403341242565815e-01   +2.852072771227336e-01   +6.112809324094821e-01   +5.822660125785067e-01   +6.320740869828931e-01   +4.085327860784771e-01   +2.437447995883206e-01   +3.340877961151897e-02; +5.885413655197155e-02   +1.479022650921689e-01   +2.083752173849486e-01   +3.626338367925879e-01   +2.847673473379128e-01   +4.764698106014805e-01   +4.488398501544487e-01   +1.796406748152664e-01; +1.354529231856353e-01   +1.471991532047427e-01   -7.684169445752505e-04   +3.632798854725463e-01   +4.937090632655535e-01   +5.348983078477756e-01   +2.897268800145810e-01   +1.963328904352845e-01; +3.318847282515012e-01   +2.226398061228401e-01   +2.213838488282152e-01   +8.481600365172010e-02   +1.807929406342393e-01   +1.227390096581619e-01   -3.035625350707298e-02   +4.063645842146751e-01; +8.075979685316952e-02   +4.731759011894462e-01   +2.745106338444590e-01   +3.742788185133960e-01   +9.079014344188004e-02   +4.879985093031322e-01   +1.791481670412249e-01   +1.089095668725543e-01; +2.288316215196920e-02   +3.558058122550732e-01   +1.878516540548110e-01   +5.156842590243420e-01   +4.866922724775156e-02   +1.840426695944134e-01   +8.122533207488435e-02   +3.909315553720206e-01; +4.626631621982034e-01   -1.901856325648257e-01   +3.175276997198242e-01   -5.669947179102831e-02   +4.859897162760574e-01   -2.825815747636586e-02   -1.983660960688338e-02   +1.829262522976516e-01; +2.502386827552623e-01   +2.069325758446863e-01   +9.864365026898914e-02   +7.182274467445728e-02   +4.999743146369323e-01   +5.434739243149986e-01   +1.412486906153917e-01   +4.936320234342204e-02; +3.860896305288442e-02   +3.448448147402356e-01   +1.626133819682135e-01   -2.264018094670864e-02   +1.840163021975641e-01   +8.450392206896280e-02   +3.518863368284066e-02   +3.918291233407765e-01; +4.207543234188733e-02   -1.890539797550668e-02   +5.265349679833758e-01   +4.386587180859475e-01   +1.612765858130564e-01   +8.316744342809870e-02   +2.276260394448304e-01   -2.967903324944139e-02; +6.613439206052042e-03   +3.017244688391205e-01   +4.000823870068734e-01   +2.415361198334812e-03   +2.677251223518092e-01   +3.909204164538153e-01   +3.675410448018764e-01   +2.238172420373715e-01];
L1I_L2I_iGABA_netcon = [+3.195770792351580e-01   +3.925519747205837e-01   +5.260083035369153e-01   +4.693099383466187e-02   +3.168975725981697e-01   +5.158245872523242e-01   +2.825602619565059e-01   +2.331566546853431e-01   +4.256445432286394e-01   +1.499178285920882e-01   +3.992978322622018e-01   +4.334715839835783e-01   +3.365964294789238e-01   +4.565791910220159e-01   +6.041728598257652e-01   +4.305793536753019e-01; +8.870293187258055e-02   +2.887410981809430e-01   +3.454594427355730e-02   +6.240100352766578e-01   +3.320366532721076e-01   +4.339825602312220e-02   +3.791538414723749e-01   +6.552820585412432e-01   +4.668462830581314e-01   +1.034661473750668e-01   +5.523426552629148e-01   +3.515068790747401e-01   +4.902463035340270e-03   +2.160793543894857e-01   +9.112173802015212e-02   +3.894533809447911e-01; +4.158179137045826e-01   +1.059197128260916e-01   +9.422111953932215e-02   +2.172702694822103e-01   +8.506780214452786e-02   +2.863813284463039e-01   -5.208659263378163e-02   +3.072161533200693e-01   +8.829815253466949e-02   +2.720000767388029e-01   +6.163668726425364e-01   -3.060230371442423e-03   +1.025086611031669e-01   +1.505784189904636e-01   +3.564680193886398e-01   +2.576325283934990e-01; +3.357349338393426e-01   +3.107424294850307e-01   +3.531440703751620e-02   -5.866424085571229e-02   +6.026602299146736e-01   +1.653770119169466e-01   +2.777965132563933e-01   +4.458720492092200e-01   +4.118752536290125e-01   +1.102704825820740e-01   -4.579604085297114e-02   -3.186991211349882e-03   +5.941584882873248e-01   +4.037567024514549e-01   +2.998615017991176e-01   +2.636157693831240e-01; -2.795398374240474e-02   +5.223407086556511e-01   +3.663528505630759e-01   +4.507987771793434e-01   +4.568467957595143e-01   +1.401908016739512e-01   +2.311325012073475e-01   +4.038681091467560e-01   +1.310336538079123e-01   +5.478958182881716e-01   +5.289177099955042e-01   +4.545028070556760e-01   +3.517327114249825e-01   +1.422116568456812e-01   +4.157831793831992e-01   +3.230366673360741e-01; +3.335990939237016e-01   +3.469658906236828e-01   +3.712295665886349e-01   +6.204996556601665e-01   +4.650449324119099e-01   +3.418077063360956e-01   +9.670059093110238e-02   +4.184088239190799e-01   +4.625460728446723e-01   +1.157538969322635e-01   +1.238376702120990e-01   -8.198602200998875e-02   +2.745179254632525e-01   +1.986070222494662e-01   +3.096682855955165e-01   +5.839220686074120e-03; +1.955722814178134e-01   +4.339627548955719e-01   +4.508978506874825e-01   +1.020431951356814e-01   +3.978518242737992e-01   +3.660102525666568e-01   -3.262131820741035e-02   +2.586930649257477e-01   +2.967102933435180e-01   +1.603525772020999e-02   +2.591207848185582e-01   +1.370237024990509e-01   +5.013323646102770e-01   -9.456191603687328e-02   +9.328628924477325e-02   +3.557264300523976e-01; +5.436522682248184e-03   +5.615262428974051e-02   +5.644204824262296e-01   +2.449951353946692e-01   +1.693431276593394e-01   +2.522740284694864e-01   +3.847449595558972e-01   +1.436148238962372e-01   +2.036974942350500e-01   +3.708906811672565e-01   +1.984503597636058e-01   +2.508841714698727e-01   +3.134446451864588e-01   +1.512336524393011e-01   +1.620637357865249e-02   +4.958254279769889e-01];
L2E_L1E_iAMPA_netcon = [+4.211061963117531e-01   +4.479956824735169e-02   +1.931499740853104e-01   +3.952705954066651e-01   +2.334227641056266e-01   +1.875026839392896e-01   +5.589054849535627e-01   +6.303961825701125e-02; +1.507129972466114e-01   +3.257187959646517e-01   -1.337599734729629e-01   +2.120371823674086e-01   +7.495185730263484e-02   +1.548997051794352e-01   +3.178378437652069e-01   +9.100594013302332e-02; +6.892162071574522e-01   +3.116374892857851e-01   +3.561596418017935e-01   +2.450438474642639e-01   +4.991169405023111e-01   +2.671898958474596e-01   +3.257891605232665e-01   +3.690258419040223e-01; +3.376921961106047e-01   -2.637895744387164e-02   +5.514214093143540e-02   +7.756779232753094e-02   +4.057205429872447e-01   +4.954259294487335e-01   +1.236822114578518e-01   +2.409266097506796e-01; +5.727166797811137e-01   -7.166422603552779e-02   +3.418139142805415e-01   +3.226335028085601e-01   +4.345664174867972e-01   -7.276730526537527e-02   +9.451998464878367e-02   +2.015456253246621e-01; -3.926995667926168e-02   +2.104968900284513e-01   +1.088607378860880e-01   +2.470231062956327e-01   +4.413018776206180e-01   +2.538979106686060e-01   +5.467217581831902e-01   +3.090425893352639e-01; +1.036755459216712e-01   +3.147567651140948e-01   +3.708742628694693e-01   +1.570360590772932e-02   +6.780306653779619e-02   -5.280797212813614e-03   +2.388035305693338e-01   +1.637166508006341e-01; +4.588675214066468e-01   +1.602709065567225e-01   +3.748733064411204e-01   +6.208156565697686e-01   +1.641513555040355e-01   +2.621961488305304e-01   +2.164760575320882e-01   +2.412202109922166e-01; +3.906876281776814e-01   +2.201843608483356e-01   +2.113322382322176e-01   +4.107165222433255e-01   +3.469022768467638e-01   +2.640711867629767e-01   -6.918224764811962e-02   +3.272842588496255e-01; +2.423456127013474e-01   +2.653759850676146e-01   +7.217666837953922e-02   +1.888584247796098e-01   +1.546170925641505e-01   -7.068653753626351e-02   +2.147679247790840e-01   +8.110006767154516e-02; +9.477889472963130e-02   +5.508598352130437e-01   +8.926222206969937e-02   +4.788907316066558e-01   +3.644288049645883e-01   +3.054521841347984e-01   +3.196128764028783e-01   +5.428584543970716e-01; -1.637964001489420e-02   +3.308313813902141e-01   +3.419006957803022e-01   +4.736279108061017e-02   +5.303584499459870e-01   +2.620914399536494e-01   +3.192120199819125e-01   -9.603939847321107e-02; +4.499436711635477e-01   +3.493994403618043e-01   -5.755398004642323e-03   +7.730913031437073e-02   +2.086691278592337e-01   +4.231683945771941e-01   +6.395544881003054e-01   +1.050403465597201e-01; +2.746676621123891e-01   -3.735539127162042e-02   +4.413141532136025e-01   +7.793167333412496e-02   +5.286569013375564e-01   +3.637660873383090e-01   +4.678926876726482e-01   +1.798463643814578e-01; +4.420931240938770e-01   +3.594731991094189e-01   +1.287650406638811e-01   +1.483043339929529e-01   +1.049832528434727e-03   +3.400226659901358e-01   -2.926197831716400e-02   +1.092185106965307e-01; +3.322222021035760e-01   +3.118111850152950e-01   +4.863196765338221e-01   +2.526692033148326e-01   +2.009902815289771e-02   +4.208971155552700e-02   +3.620232653553328e-01   +3.581472785698407e-01];
L1E_L2E_iAMPA_netcon = [+3.012700555491120e-01   +4.486011355608243e-01   +4.253411612319881e-01   +4.676172069286887e-01   +3.613483705912922e-01   +1.188787516764012e-01   +2.758022584120713e-01   +5.842105312643980e-02   +3.235814741818666e-01   +3.930258145667900e-02   +6.282870279283528e-01   +3.622773242240249e-01   +3.177415142814235e-01   +4.050195482626133e-02   +3.787405098963124e-01   +1.009462965322958e-01; +2.898362563246591e-01   +3.700830345830901e-01   +7.317610416630246e-03   -1.605360245503567e-01   +5.265860426009977e-01   +2.640339986249469e-01   -1.842243408819638e-01   +3.594762212945875e-02   +1.466909948414286e-01   +3.003643672825962e-02   +6.616956499354262e-01   +2.302546942131505e-01   +4.275037665836001e-01   +1.164677028532561e-01   +1.557816520435688e-01   +3.615191137025056e-01; +4.036296854515030e-01   -8.840342815595413e-02   +7.703028600413912e-02   +2.283559652176387e-03   +2.165841320759010e-01   +2.401072029393092e-02   +1.602246352324319e-01   +8.995587899291417e-02   +2.686908234954811e-01   +3.437684213195055e-01   +6.137032265186116e-01   +3.448219528184898e-01   +5.101458848966155e-01   +5.195093417975700e-01   +2.944655121591548e-01   +2.626117512528696e-01; +1.161896144721512e-02   +4.964561174528728e-01   +3.170736721785105e-01   +9.568349197252522e-02   +4.202034918727143e-01   +3.985943173733054e-01   +3.208587284537330e-03   +2.305754927584017e-01   +4.206921573316471e-01   +3.340786375528866e-01   +2.600891123797034e-01   +5.050043637420929e-01   +1.660582773639883e-01   +3.074023242903863e-01   +4.517793597577194e-01   +2.536893742891992e-01; +2.776066135771261e-01   +1.082668270659346e-01   +3.930039653385465e-01   +8.327730741357463e-02   +2.785840149176270e-02   +6.667056555011197e-02   +2.777157468659861e-01   +6.228416070294364e-02   +1.528130745634485e-01   +1.973489009720482e-01   +2.800189358633617e-01   +5.595984387284413e-01   +1.783210823543324e-01   +4.217531150710357e-01   +2.185626282270309e-01   +1.106004984913073e-01; +4.349959443666592e-01   +1.208190286771150e-01   +3.538237035144276e-01   +7.914796465079428e-02   +3.625951086301971e-01   +8.465664119221189e-02   +4.699240910861235e-01   +2.268145924322066e-01   +6.212587070235511e-01   +5.213511512672775e-01   +2.965220358847557e-01   +1.203927332555997e-01   +5.025809226974212e-01   +3.428281081874790e-01   +2.469516620690826e-01   +2.062462798236628e-01; +3.642875228278614e-02   +3.665884732591295e-01   +1.310750546229872e-02   +2.700869779869929e-01   +2.933761307653135e-01   +6.850946590643471e-01   +5.203938193986429e-01   +3.760323801330034e-01   +2.411814556737058e-01   +6.698920052195150e-01   +1.351187814784234e-01   +7.629904631816198e-02   +1.079817540757387e-01   +3.507411082136710e-01   +3.189565955899786e-01   +4.900447634491545e-01; +1.862781622884153e-01   +4.330216558835110e-01   +4.651397650769074e-01   +2.816054345236463e-01   +2.380745808604163e-01   +1.667746053260405e-01   +1.235833847717793e-01   +5.550916614406257e-01   +2.202314607785453e-01   -1.449834670258648e-02   +4.955256846666760e-02   +8.938924033082625e-02   +1.172631947121640e-01   +4.996835667132056e-01   +1.928961149037186e-01   +3.617283032770398e-01];
L2I_L2E_iAMPA_netcon = [+4.359671077141719e-01   +2.235486804453935e-01   +3.610636674973681e-01   +2.222513915604961e-01   +4.442374648137388e-01   -4.980884975346821e-02   +3.269786779350565e-01   +5.604562136548545e-01; +1.748980675995266e-01   +4.352272987441952e-03   +3.253265742260195e-01   +5.524078643011787e-01   +1.994854653744762e-01   +3.482540980974098e-01   +2.194432329790535e-01   +1.711273545922035e-01; +1.364307832836123e-01   +1.689436775523188e-02   +3.015627476765969e-01   -7.971702655651600e-02   +2.379427929762875e-01   +3.459056454201920e-01   -1.191235570505120e-01   +5.383008066417653e-01; +2.877371514202176e-01   +1.470988210035441e-01   +8.027941969365265e-02   +4.469606318369871e-01   +1.834575564611730e-01   +3.911631752831399e-01   +2.142703239759505e-01   +3.826337735913103e-01; +1.371956246961457e-01   +4.968434580044085e-01   +4.262224220766776e-01   +2.732096291674692e-01   +5.512175221570775e-01   +4.968195349023638e-01   +2.925997405586728e-01   +1.435949151316125e-01; +5.275593024679625e-01   +4.534945569293361e-01   +1.127901767689672e-01   +1.011552156256350e-01   +4.589714447764565e-01   +5.869922177141189e-01   +3.043003287624980e-01   +2.959721094668145e-01; +3.987118483349781e-01   +3.360395227664108e-02   +3.331258645840006e-01   +1.661479905868375e-01   +5.393004060806625e-01   +2.228349103320053e-01   +2.704345566307546e-01   +9.334031658364138e-02; +1.635720457995272e-01   +5.239243068844517e-01   +4.982966005732433e-01   +2.438583173828865e-01   +2.996793167952455e-01   +2.942644601967445e-01   +3.654885852713062e-01   +2.685371800824784e-01];
L2E_L2I_iGABA_netcon = [+1.217034859108621e-01   +2.510468019885365e-01   +4.962812084318747e-01   +9.346906706468690e-02   +2.601190941865664e-01   +1.163843695022387e-01   +2.159406499671054e-01   +2.798688759971621e-01; +2.506779652120978e-01   +3.642241083981047e-02   +3.352977651871069e-01   +2.904004592368810e-01   +2.390390804924092e-01   +1.781963031261297e-01   +3.555289210771947e-01   +3.651066017870184e-01; +5.077116514669043e-01   +7.086558258385102e-02   +2.014164516614592e-01   +3.214452251010027e-01   +2.183795211872779e-02   +4.653046750129233e-01   +4.218778485807861e-02   +3.527875391599673e-01; +3.305555419706090e-01   +5.930550400055896e-01   +1.181020771576299e-01   +4.593801622821055e-01   +4.373517923535629e-02   +7.005077996005354e-01   +2.062466483195755e-01   +6.496891323383380e-03; +1.449705781004729e-02   +2.772838683268329e-01   +2.427156294761252e-01   +3.322060484116970e-02   +4.366591913821466e-01   +2.922510457483543e-01   -4.990469520962600e-02   +4.637823424917107e-01; +3.599867972395573e-01   +2.137064381465393e-01   +2.298412149152016e-01   +3.243750014535684e-01   +2.826254323792109e-01   +1.017191224558869e-01   -1.505708934648449e-01   +1.296587101223831e-01; +3.516074908961532e-01   +4.433820026718684e-01   +1.505265529523131e-01   +3.967405716878322e-01   +2.937412473967528e-01   +2.165710367399832e-01   +1.533852299831521e-01   +2.947120804261415e-01; +3.094320052531738e-01   +2.158119163782594e-01   +3.083799619429428e-01   +4.552024775322575e-01   +4.962701811363860e-01   +4.700869106795814e-01   +4.267333606000279e-01   +4.579631694489623e-01];
L3E_L2E_iAMPA_netcon = [+1.581905011809061e-01   +1.603592295562150e-01   +3.071859463017791e-01   +1.917018240528888e-01   +2.259623287278507e-01   +5.517524338381364e-01   +8.097440429001279e-02   +5.048903785893675e-01   +2.558907148131206e-01   +2.857164343147052e-01   -2.885676649460356e-02   +5.669982193490682e-01; +4.567149018524505e-01   +4.538449652660171e-01   -9.415337320940571e-02   +8.867039261165893e-02   +3.503596754521424e-01   -7.180039951290452e-03   +5.675109749095468e-01   +1.935069489919285e-01   +2.822627329304923e-01   +2.839877814337750e-01   +1.073830352319785e-01   +4.073043968849420e-01; +9.865660536352466e-02   +1.376248771690624e-01   +5.971088786334922e-01   +4.314251662619257e-01   +4.804603977491332e-01   +7.209638492194296e-01   +4.311255903194369e-01   +4.349165298371032e-01   +1.261337139427526e-01   +1.194563695823981e-01   +1.998483583645384e-01   +1.811992550493069e-01; +3.746278864205066e-01   +3.070956003067307e-01   +4.763996525553102e-01   +5.341077733935277e-01   +1.163815159489136e-01   +4.608900844139182e-01   +3.409579614801218e-01   +2.066887938099813e-01   +1.504232797188572e-01   +2.474121463361197e-01   +3.698256502560798e-01   +2.251600930001712e-01; +1.580132037358880e-01   +4.583579560452893e-01   +5.135027121470914e-01   -6.328904979738612e-02   +2.091133807300013e-01   +3.900641230732297e-01   +1.581488965564337e-01   +4.722003755859717e-01   +1.519419909929946e-01   -8.832498933054947e-03   +3.099051769426223e-01   +2.724400322681989e-01; +3.051759408074550e-01   +2.072475681605861e-01   +6.943157775760675e-02   +9.648795056141395e-02   +4.067050525302687e-01   +2.672592465040823e-01   +3.727131137724253e-01   +3.011761458035221e-01   +2.856872870588846e-01   +2.299908807981061e-01   -1.503535421619523e-01   +1.088456189437238e-01; +6.332579675729167e-01   +2.683434854719845e-01   +9.000232631216817e-02   -4.490069962441916e-02   +1.621597919505546e-02   -9.888222524991094e-03   +2.627904797889174e-01   +3.548260254545155e-01   +4.370458437742918e-01   +1.673728590470123e-02   +1.259639419881396e-01   +1.436002425968867e-01; +3.861640083902969e-01   +1.887346519420516e-01   +2.053508255171623e-01   +1.755868671630095e-01   +3.950283866839429e-01   +2.521392124314595e-02   +1.145866839102009e-02   +9.171365837569637e-02   +4.844075848316397e-01   +1.756467356701359e-01   -4.150464874712166e-02   +2.945840487687794e-01];
L3I_L2I_iGABA_netcon = [+3.215467751684439e-01   -2.242747695493558e-02   +3.534382011634828e-01   +4.157966420778605e-01   +3.000659231735914e-01   +6.425264045848846e-02   +1.819858520447045e-01   -1.616665415014484e-02   +1.086804516307339e-02   +3.096803163836157e-01   -2.141388976972996e-01   +2.929779597348603e-02; +3.184490628925309e-01   +3.999769689039361e-01   +5.426731474084657e-01   +3.087489695423075e-01   +3.106575006854318e-01   +1.874324887598326e-01   +8.214159106451445e-02   +4.671576225203679e-02   +3.413939331744405e-01   +3.398478037465665e-01   +5.060958926072667e-01   +3.073702227424707e-01; +3.941628863797195e-02   +3.149696145169984e-01   +8.234152714527135e-02   +1.238101215037752e-01   +2.042461056693527e-01   +1.031785058478739e-01   +5.236804733622874e-01   +2.756425624373058e-01   +8.508584895295127e-02   +5.870847312120772e-01   +5.749979980710880e-01   +2.710445091090168e-01; +1.559676107042646e-01   +4.491049401112628e-01   +6.150113810440614e-01   +7.627751719374833e-02   +5.154905786150454e-01   +1.786656272355285e-01   +5.391202700366986e-02   +2.930520544878007e-01   +1.433262993043632e-01   -4.147424525231714e-02   +2.325734674994785e-01   +3.347527327909788e-01; +4.561366674605162e-01   +1.474347513571208e-01   +3.513544681798580e-01   +3.343681195163284e-01   +4.035198296550735e-01   +2.264563135473985e-01   +3.224808309853389e-01   +3.028677434330055e-01   +1.540578069257241e-01   +6.800309682782173e-02   -2.469021704612176e-02   -1.134013894597922e-01; +3.863391494506154e-01   +3.221126565007508e-01   +2.577641289528831e-01   +1.128607509901291e-01   +5.023557969868166e-01   +1.386293477395148e-01   +1.531476221383840e-01   +3.546908732431899e-01   +5.520134873756521e-01   +4.034129968364740e-01   +2.974373262093926e-01   +2.535788837291695e-01; -9.496066163939249e-03   +2.972954281278771e-01   +4.108930862260858e-01   -6.102867329887071e-02   +3.211675843166361e-01   +3.025044651658004e-01   +2.506816464414674e-01   +3.333761260317980e-01   +9.815668023262043e-02   +1.091356926452316e-01   +1.953995963234421e-01   +5.433351948430968e-01; +2.604531870893242e-01   +1.643646008755000e-01   +2.058495596913470e-01   +3.511085208746808e-01   +2.863610139818406e-01   +1.237128887681106e-01   +3.630969067806018e-01   +1.726352931322118e-01   -3.217572482839517e-02   +1.384912734511348e-01   +7.911113714215143e-02   +2.150383125026889e-01];
L2E_L3E_iAMPA_netcon = [+1.249811701109576e-01   +3.467568342235171e-01   +3.640115714633846e-01   +2.589318522781893e-01   +4.943384261423067e-01   +3.501097719708333e-01   +4.025737462758347e-01   +1.305535511328032e-01; +2.391870355192724e-01   +4.316979876001130e-01   +2.758555136960211e-01   -4.123812208053963e-02   +3.379640634635820e-01   +3.183940784168894e-01   +2.745860445103965e-01   +2.345659072577927e-01; +9.994811395764761e-03   +2.125948183020532e-01   +2.715225412040231e-01   +6.967734721341479e-01   +2.677927897788376e-01   +6.021550312555897e-01   -5.117552241819735e-03   +1.494797073044980e-02; +4.783005071322476e-02   +2.612636463709260e-01   +2.665563822279836e-01   +2.630469021942841e-01   +3.331537189868379e-01   +5.163293201154868e-01   +3.507904545685884e-01   +2.185226534003512e-01; +4.951595249790763e-02   -2.917345016901250e-02   +1.681960774217718e-01   -5.480548439240696e-02   +2.261582432331897e-01   +4.808742963643254e-01   +1.644158888103512e-01   -9.305759459513563e-03; +1.111470597209193e-01   +3.251362376150581e-02   +1.569301055638124e-01   +5.072913467107996e-01   +2.602323418783484e-01   -1.233919418182581e-01   +3.708027363907556e-01   -1.143491406346420e-01; +5.828206761238704e-02   -7.497001716839098e-02   +2.766518367225367e-01   +1.207457322619948e-01   +2.724823124480677e-01   +3.933808920528164e-01   +8.575778145000908e-02   +4.775496075993249e-01; +2.851364002670612e-01   +5.535557320997383e-01   +4.981264605912722e-01   +1.427662810737765e-01   +2.691198810533777e-01   -6.460524774681750e-02   +3.593161441576950e-01   +3.412133404258372e-01; -6.953450580847514e-02   +2.316711881310002e-01   +1.544149695478306e-01   +4.835851559128312e-01   +2.002006871948018e-01   +3.108669170732448e-01   +1.493443679224842e-01   +3.230212607617300e-01; +3.390382883932836e-01   +1.573515856775207e-01   +1.624858017240426e-01   +4.009108501644200e-01   +5.419041564179750e-01   +8.936188446316969e-02   +4.591817821021332e-01   +7.927661968808118e-02; +5.700013501390163e-01   +4.453070558448798e-01   +2.639931451610499e-01   +2.161397509788511e-01   +3.674820233182843e-02   +4.226766930822083e-01   +5.161690696776678e-01   +1.213757621232524e-01; +5.844810610957140e-01   +4.218081123270825e-01   +1.049911873287777e-01   +5.526207877576356e-01   +2.264954115869898e-01   +4.927063398342468e-01   +4.432020000277958e-01   +1.864867226993788e-01];
L2I_L3I_iGABA_netcon = [+5.896161605336491e-01   -1.083904989394374e-01   +4.322691119086938e-01   +1.243441057910672e-01   +3.281035602917332e-01   +2.416501651622474e-01   +2.443422611701697e-01   +4.667720504510310e-01; +6.040233433287211e-01   +3.880996303798973e-01   +1.046456546007431e-02   +3.296944310604109e-01   +2.301063123850361e-01   +3.082615206724727e-02   +2.789973888469822e-01   +3.626916718347548e-01; +3.552545252227208e-01   +3.829872019490027e-01   +3.571920978267437e-01   +4.492931957046251e-01   +3.851699814752212e-01   -5.496184489638357e-02   +3.541319594225305e-01   +1.558775121056334e-01; +1.486952644483136e-01   +3.849874214647951e-01   +3.280016842380433e-01   +2.670519841787687e-01   +1.998862179821448e-01   +4.265196500127014e-01   +1.959361910030247e-01   -2.821221204149443e-02; +5.286766980682704e-01   +4.972550097429161e-01   -1.043241939742610e-01   +5.956238611949297e-01   +2.171097322993337e-02   +2.864770530640029e-01   +2.045361147751273e-01   +2.621954501254398e-01; +5.714813050538117e-01   +6.326529494441998e-01   +5.670611250018370e-01   +1.651927227615306e-01   +6.071484248945499e-01   +7.810871675876437e-02   +4.098048890110501e-02   +4.416949388442625e-01; +1.729805644404435e-01   +3.283910013719072e-01   +3.676080839669271e-01   +6.645220045782144e-01   +2.681885533003130e-01   +4.858406601485185e-01   +1.011169308207496e-01   +1.620819280227402e-01; +1.831753257602547e-01   +3.612296886234146e-01   +3.028094382936142e-01   +5.617875072754205e-02   +3.356075014372329e-01   +1.612923812968450e-01   +1.085462746392420e-01   +2.994567342336290e-02; +2.677665085116938e-01   +1.384314144883672e-01   +1.869012149499808e-01   +3.734330908491348e-01   +4.002443412841628e-01   +1.768569542046396e-01   +3.867354520074814e-01   +4.824690392218324e-02; +4.006313078949899e-01   +2.065555437127266e-01   +7.350273277097932e-03   +2.653885936986313e-01   +2.382147986986523e-02   +1.470485482977535e-01   +3.464051215618330e-01   -3.581012981071142e-02; +3.906774323665051e-02   +1.061644781138116e-01   +2.549628383067192e-01   +2.619080272365895e-01   +2.249262350454856e-01   +1.355575847711920e-01   -7.984789087536678e-03   +6.266319837021503e-02; +3.785224701297543e-01   +3.888058948405068e-01   +1.985727922142993e-01   +3.465039063621248e-01   +1.497237952760613e-01   +8.732431493979943e-02   +1.885623561028089e-01   +1.249854192468244e-03];
L3I_L3E_iAMPA_netcon = [+2.077284574662004e-01   +5.118386914659273e-01   +2.374050898861416e-01   +3.643007492442220e-01   +1.547608532717710e-01   +4.166887704530072e-01   +1.177465120027597e-02   +1.893632740618758e-01   -5.053292209308040e-02   +3.519735284528670e-01   +4.292589936688322e-01   +3.507169471321901e-01; +3.817417890431487e-01   +2.720293794666728e-01   +3.862933425446322e-01   +9.896517912275755e-03   +3.328781914363482e-01   +2.370669361045804e-01   -6.353852484400414e-02   +1.669682973938461e-01   +6.362616930174977e-01   +6.818375125498349e-02   -3.185712560583218e-02   +4.941035668392031e-01; +1.235594866761285e-01   +1.551797286448319e-01   +1.991260868240808e-01   +1.719330173313247e-01   +8.171129323685218e-02   +5.553758970970756e-01   +5.528459746327932e-02   +3.070570790182241e-01   +2.209736199155317e-01   +1.803297732059510e-01   +1.912620418059723e-01   +3.379507312208122e-01; -1.053637648556594e-01   +9.236178023479272e-02   +3.654932064980368e-01   +2.935400850767339e-01   +1.937793987106602e-01   +2.958221029713990e-01   +1.485113571571862e-01   +2.242230461374365e-01   +8.838593133522255e-03   -4.470674525896626e-03   +7.458557607222104e-02   +2.411522341906735e-01; +1.736864445722043e-01   +2.760332500035083e-01   -7.757653852580128e-03   +2.741662580871022e-01   +1.522067376835736e-01   +2.917859426164339e-01   +1.243121990699094e-01   +2.203153214601198e-01   +2.604427507678466e-01   +2.045292554932455e-01   +4.232954595152515e-02   +3.368193019162970e-01; +6.358982135470730e-01   +3.129824608993947e-01   +1.221292183613704e-01   +2.510514924026144e-01   +3.024387772638536e-01   +1.144392240224307e-01   +3.834490392772974e-01   +6.450900939679892e-01   +3.919581891948279e-01   +2.802014342780230e-01   +5.360685216182617e-01   +5.258177625295896e-01; +2.093370030478554e-01   +3.790198009705669e-01   +3.631485613544833e-02   +8.271813515219661e-02   +2.514302537055922e-01   +4.850307704256428e-02   +8.194964490344146e-03   +1.244091666636775e-01   +2.060038513692607e-01   +1.638017423321242e-01   -1.204151665762556e-01   +6.253534915202454e-01; +2.398985386794542e-01   +3.088437889557510e-01   +4.277951849984294e-01   +8.095477238728579e-02   +2.468631338785770e-01   +2.131531471770616e-01   +1.900657051829856e-01   +7.434179442879262e-02   +2.299702297627917e-01   +2.788530351727230e-01   +3.270761817656894e-01   +2.387045451423625e-01; +2.593939352844464e-01   -1.824748565822538e-01   +1.935810480158378e-01   +4.753113723105661e-01   +2.581233814327143e-01   +1.939178877934617e-01   +2.154061023764762e-01   +4.704684507501152e-01   -9.013048683122603e-03   +2.327559677269541e-01   +2.816797581793008e-01   +1.240548983374787e-01; +2.678558074315422e-01   -1.323539809172899e-01   +2.385160585172327e-01   +3.966641760051759e-01   +1.328148482895128e-01   +2.986514547002400e-01   +4.371208169986724e-01   +3.040724069737691e-01   +4.086405475144504e-01   +2.763047568622486e-01   +5.769638357661279e-01   +2.734165502156597e-01; +1.744974311510037e-01   +2.305045555198016e-01   +3.304124784330039e-01   +3.566571151653818e-01   +3.989506666891688e-01   +1.772719391719412e-01   +3.272092552693071e-01   +2.809862544559376e-01   +1.781282158871951e-01   +7.207206093581259e-02   +1.353698850010895e-01   +3.303368648607451e-01; +1.151670710438582e-01   +3.605930104939282e-01   +4.098826348229855e-01   +2.563989149443847e-01   +3.172315410621408e-01   +1.718863082302992e-01   +3.656292962925669e-01   +4.122053614918916e-01   +2.636482702409401e-01   +2.140152759551044e-01   +3.812644796108454e-03   +2.742427935238800e-01];
L3E_L3I_iGABA_netcon = [+4.874745449182425e-01   +4.172127086326243e-01   +2.057777828501649e-01   +5.527097291012993e-01   +2.387363822199193e-01   +2.061746699133044e-01   +3.236163960591109e-01   +5.475602971812388e-02   -4.724459602049148e-02   +3.584224492204552e-01   +7.645305346597120e-01   +3.936969194448529e-01; -5.111611925017770e-02   +3.055091857802035e-01   +5.874213825180447e-01   +3.001634326004743e-01   +2.965989952152395e-01   +4.624655987562885e-01   +4.529682738194173e-01   +2.873091443160958e-01   +4.271507237233401e-01   -1.746749280410666e-02   +2.027081775127275e-01   +2.996914114549640e-01; +2.769511086230853e-01   +4.530736918635908e-01   +5.153120831019940e-02   -5.138263344532045e-02   +5.086103075913377e-02   +3.095292499270454e-01   +2.615478567391398e-01   +6.714561938523321e-02   +4.157819421899360e-01   +2.243141850510328e-01   +1.490338004990917e-01   +1.509957189240825e-01; +2.695469268053938e-01   -2.907063296604520e-02   +1.731510349969240e-01   +4.073770452138424e-01   +1.670856006089562e-01   +3.597397326998597e-01   +3.234951232103626e-01   +5.629087894145464e-01   -4.424668621937695e-02   +1.646574064418972e-01   +9.080631463457547e-02   +3.045950615851005e-01; +3.870853516169689e-01   +1.070688105161732e-01   +4.535610939705179e-01   -5.924793361366673e-02   +4.532600625341193e-01   -2.539402093552602e-01   +5.795152893022738e-01   +3.018581379630922e-01   +8.970356275689480e-02   +2.717240393888341e-02   +2.238974855276921e-01   +1.057698744346508e-01; +5.962539038749795e-02   +4.258804731609246e-01   +1.371345822234932e-01   +1.973046836591944e-01   +1.803111890366494e-01   +7.134636750938472e-02   +4.284950166762157e-01   +2.992037438791296e-01   +7.728185072328302e-02   +1.140301123840597e-01   +2.735296844459159e-01   +3.506998268755573e-01; +3.910462583958810e-01   +2.717659276947220e-01   +6.142630904527888e-01   +3.677709754309125e-02   +1.488132638994037e-01   +2.499198606022369e-01   +1.621784414710439e-01   +1.724833909059890e-02   +5.026406312582200e-02   +1.780922891801092e-01   +3.413944875143444e-01   +8.778052018039159e-02; +3.081223129617098e-01   +2.634062741230387e-01   +3.584406086250027e-01   +1.390141487396182e-01   +5.451129641963277e-02   +2.144055931096799e-01   +3.309157609042163e-01   +1.226705673865468e-01   +5.118029292523746e-01   +4.494516255490861e-01   +1.342805973529276e-01   -1.190876331411277e-01; +3.689848934701135e-01   +2.682553897492901e-01   +2.898252408262219e-01   +1.276050003718234e-01   +3.677577166970271e-01   +1.049989586654583e-01   +2.263461538002280e-01   +4.151127286357208e-01   +3.940081212836972e-01   +1.564062742986354e-01   +1.055623032662347e-01   -2.659361538962897e-02; +4.398144952562319e-01   +2.954869631280329e-01   -9.466041619152743e-02   +4.495744537924038e-01   +2.558901024781488e-01   +4.153462982000154e-01   -1.398787199640004e-03   +1.753151750448289e-01   +1.490459715925515e-01   +6.675200683985908e-01   +2.626765766774493e-01   +2.721382230679392e-02; -2.538685473661217e-02   +2.572059558320083e-01   +3.835573235166646e-01   +1.002267547393224e-01   +3.388849162827004e-01   +5.018140280180348e-01   +3.898560038300563e-01   +3.376810247741147e-01   +3.668544202592203e-01   +3.672163090514698e-02   +2.728095790255568e-01   +1.927917278113131e-03; +2.214435143410224e-01   +1.546827424525199e-01   +1.153722882407280e-01   +3.633913279878262e-01   +2.326525854758657e-01   +4.818402496548130e-01   -1.070516027382068e-01   +2.144828318943173e-01   -1.282075006191356e-02   +5.000087575450951e-01   +3.483022593610049e-01   +3.044997324712918e-01];
L2E_Input1_iAMPA_netcon = [+2.476374622753222e-02   +2.552428958623248e-01   +1.403833399458253e-01   +1.511341802078942e-01   +3.244990331716743e-01   +5.779144446603399e-01   +2.312743323150756e-01   +3.072148614821135e-01];
L2I_Input2_iAMPA_netcon = [+2.881117605040301e-01   +7.563275310809563e-02   +5.509844201830787e-01   +3.090483330809426e-01   +3.259080061802479e-02   +5.615413894616782e-02   +1.767788765061213e-01   +1.870540037204450e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
