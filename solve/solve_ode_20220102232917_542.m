function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.069589252755530e-01   -7.039980288860277e-01   +3.172041616146739e-01   +2.815200608732941e-01   -4.725462404132137e-03   +3.299209070671842e-02   -3.738577402875705e-01   -5.114159110365932e-02   +4.767487296503697e-01   +7.863870062177608e-01   +3.202906292004640e-01   -8.883831129032102e-02   +5.268277764208087e-01   -1.915325092588130e-01   -4.459059221342064e-01   -4.502065295787628e-01; +5.538531043286035e-01   +4.716209281621862e-01   +1.252234255935987e-01   +3.355028956989274e-01   +2.701834432028098e-01   +6.093009624520419e-01   -4.672634772001293e-01   -1.507891769457989e-02   +8.363712777663777e-02   -3.594812633902535e-02   +2.574624428519837e-01   +1.976936004387078e-01   +5.218385878382351e-01   -2.897083263231981e-01   -2.042125900306871e-01   +9.252638288640828e-02; +2.962806213178921e-01   +1.159449317317225e-01   -5.766078241368168e-01   -9.289665878634426e-02   -1.297336930974731e-01   +6.575593965796577e-01   +7.770578272428856e-01   -2.759972702699755e-01   -2.520970467307630e-03   +1.569768721156774e-01   -7.899964114731721e-03   -1.891569309565545e-01   -3.165461094599973e-02   -5.716815998886292e-01   -3.569058486677239e-02   +8.401361104391679e-01; +3.719062782456560e-01   -1.479393717412567e-01   -2.481638118626148e-01   +4.455540547722119e-01   +4.908600005221625e-02   +7.962923869655184e-01   +8.874212753216044e-01   +1.971093307656532e-01   +3.715132195087549e-01   -5.851133743044890e-02   +1.106185053076062e-01   +3.960414537676742e-01   -5.280633586278747e-01   +5.318769685217315e-01   +1.038165864248076e-01   +6.801355972408601e-01; +7.411239550614296e-01   -1.948299537549303e-01   +8.364772321110778e-01   -6.165496049727512e-02   -7.192435668930097e-02   +3.005525524112226e-01   -1.857369413684344e-01   -3.781842183152048e-01   +3.820582254255400e-01   +4.018953391473654e-01   +9.852590321610956e-01   +4.295605735830781e-01   +8.191402087783023e-03   -1.603441180821527e-01   +1.110341576202606e-02   +3.396173981877582e-01; -3.140182503007840e-01   +5.597817701886644e-01   +9.613645677006952e-01   -1.342876579974455e-01   +6.425934972162427e-01   +1.277329079740452e-01   +3.560647372806630e-01   +6.017252502613778e-02   +4.933404325338407e-01   -3.325500565366205e-03   +4.190204455180338e-03   -7.699489299549890e-02   +1.768498805725032e-01   -4.283369916925781e-02   -2.584298318330460e-01   -1.183846268942445e-01; +8.633558465051945e-02   +4.740953667079558e-01   +1.508732265316199e-01   +2.910318221539528e-01   -4.111370237790972e-01   -1.298060247666123e-01   -1.857246585222834e-01   -4.893074557239799e-01   -7.573632814343797e-01   +4.140998951455018e-01   -2.248783762976856e-01   +1.162221825555565e-01   +3.628947246305229e-01   +2.373681223999969e-02   +5.887966051612390e-01   +3.104126884700258e-01; -4.065696353600077e-01   +8.502227414144909e-01   -1.786057327522674e-01   -7.746131835661348e-02   +2.138166648459449e-01   +5.459584413049196e-02   +5.408736693126268e-01   +2.085011264358419e-01   +2.042625374717636e-01   -1.642350996990446e-01   +1.374979937000367e-01   -2.098006575688403e-01   +1.801472449176192e-01   -7.398585970244687e-03   -3.836494265368590e-01   -5.668204036977606e-02; +2.585684929960451e-01   +7.229883243883730e-01   +8.605400067588920e-02   -3.932649747413241e-01   +4.733694545243026e-01   +6.494245888076216e-01   -3.404819637619572e-01   -3.262780054068667e-01   +6.993215183825823e-01   -2.092174359003026e-01   +3.839897774833684e-01   -9.652842275759122e-03   +5.061676028517305e-02   +2.744266649233589e-01   -2.279009056178649e-01   +1.561652632962914e-01; +4.500697178927551e-01   -1.663790242198739e-01   -2.272988522903183e-01   +4.844308687176325e-01   +1.807143451722386e-02   -1.012112195833174e-01   +3.872746856250893e-01   +1.708638579080599e-01   -3.283412914665376e-01   -5.549554890254411e-01   +5.631129016697176e-01   +7.583250225768140e-02   +6.318550440477503e-01   +2.839200792690462e-01   +5.791640351184130e-02   +8.183935472090091e-02; +3.283734207272672e-01   +7.703320743137987e-01   -3.342578159160520e-02   -5.244340467843949e-01   +3.084623065454096e-01   +1.776480426549531e-01   +5.233618921852400e-02   -4.611295165363763e-01   +1.765099943460623e-01   +2.349732803410071e-01   +3.073291944833123e-01   -7.830856366126375e-02   -5.268693701954803e-01   -6.947374257827246e-02   +2.967713492892466e-01   -1.869006669466053e-01; +3.082301597517113e-01   -1.244679066079374e-05   -5.952677119175892e-01   -1.562831200723471e-01   -2.880636151064263e-01   +2.632656176154036e-01   +9.693385857142556e-02   -2.110906236180455e-02   +2.342155571906734e-01   -8.014674188889744e-01   +3.859156153702073e-01   +1.684512790397711e-01   +4.734411959747573e-01   -7.713706842575135e-02   +1.443647858634898e-02   +1.342286011241752e-01; -5.641883356307255e-01   +3.624139949955873e-01   -1.623679560244140e-01   -5.856487092900274e-02   +6.329446644314178e-01   +5.114809330119365e-01   -2.554978444976457e-01   +1.001972895663852e-01   +1.839205264458521e-01   +1.000000000000000e+00   +5.206982975716844e-03   +4.417623082498579e-03   -2.638435313925855e-01   +8.873854432842491e-02   +8.959941854418824e-02   +5.013537270670514e-01; -5.719381001010947e-01   +5.680310503326317e-01   +1.983042430240341e-01   -8.012907075994272e-01   +3.935034958463191e-01   +3.674540517367084e-01   -5.384383560509277e-02   +5.460057944995762e-02   -7.515312916171889e-01   +4.392078121780723e-01   +6.294213744181452e-01   -2.344385375210564e-01   -1.577438245844918e-01   +3.863551453262431e-01   +9.620545656722414e-02   -4.457993696086734e-01; +4.725848980665940e-01   -2.633819407440152e-01   +3.482427726274352e-01   +4.228681790249577e-01   +2.101340414790243e-01   -2.555463620590936e-02   +6.538785246148343e-02   +4.375420940194740e-01   +1.375425194457021e-01   -3.832594819386289e-01   +4.636623994420130e-01   +1.802544730805707e-01   +5.807795114935967e-01   -2.582428399973047e-01   +8.756564291500782e-02   -8.136580724526400e-02; -6.391465383730452e-01   +3.287792336586114e-01   -4.592860562497189e-01   +8.294108636937580e-01   +5.603681791481114e-01   +5.938439503505726e-01   -2.081829527821580e-01   +6.813488792465280e-01   -4.359972325809916e-01   +1.658637573292499e-01   -3.973748715494751e-02   +5.129083761056077e-03   -4.783581275151829e-02   +4.096167325887881e-01   -1.341186683026912e-01   +3.180849289742329e-01];
L1E_L1I_iGABA_netcon = [-5.362597759339901e-02   +3.924849548780186e-01   -1.393879264938486e-01   -2.877306768346586e-01   +5.976414708684409e-01   -1.378793887609978e-02   +4.696148287583656e-01   +3.315294641533094e-01   -3.399993370345222e-01   -1.249409507079381e-01   -3.239021589850292e-01   +5.940232299508172e-01   +4.186223284008800e-01   -3.101714558324101e-01   +5.707286167867524e-01   +3.408269540357147e-01; -3.664785576797112e-02   -2.988682977466846e-02   +7.983783886566955e-01   -1.748141068471605e-01   +4.434919271648182e-01   -1.145501230812388e-01   +4.532018196885448e-01   +5.092209622406020e-01   +1.947026078044443e-01   +3.275296252673204e-01   +5.086174178781293e-02   -6.482249994837430e-02   +3.198788612278237e-01   +4.964727024732852e-01   +2.231619055651717e-01   -3.583886043833613e-02; +2.464162068795378e-01   +5.325774942019799e-01   -3.628738600071968e-01   +1.708164557314720e-01   -2.702581298304050e-01   -1.188897995696172e-01   -2.844261669763036e-01   -4.128412381065232e-01   +4.197793615677931e-01   -2.047176561164914e-02   -5.234223375288926e-01   +2.764561829333426e-01   -3.647627188300269e-01   -3.504157132746750e-01   +4.982939067970861e-01   +1.502039943202021e-01; +4.603102283448821e-01   -3.574677877181295e-01   -6.149863411804356e-01   +1.095054722951877e-01   +9.492490812282854e-02   -1.723495536603226e-01   -6.991147405373824e-02   +1.210085687718493e-02   +3.158606999089359e-01   +5.759144167607246e-01   +9.329261252250143e-02   +1.890365558013790e-01   -2.267191946511189e-01   +1.388421401169413e-01   +4.690579899376448e-01   -2.139934918174700e-01; -6.717514755617723e-02   +2.643593973803568e-01   +4.996121465235650e-01   +1.630926157941525e-01   -3.182210272694701e-03   -1.926155731435757e-01   -3.565693037788559e-01   -6.786595266681202e-01   +1.544928740520626e-01   +1.001867002862415e-01   +1.726701875382629e-01   +8.264199281604567e-01   +6.436433019191879e-01   +1.833277024692282e-02   -3.737991500791239e-01   +2.031769978005130e-01; +1.560710350487635e-01   -2.362798612869480e-01   -1.185160695944707e-01   -9.602929466483995e-02   -6.679956359121295e-02   +3.774378924718623e-01   +7.719852413203881e-02   -3.499634001498065e-01   +2.501802444067542e-04   +8.564634937259125e-02   -2.760308799280142e-04   +2.143103994918606e-01   +1.949233777835285e-01   -9.140540384445400e-03   +3.320317594571857e-01   -3.060411364160777e-01; -6.387890960385090e-01   -3.495244492024493e-01   +5.684488168777821e-02   -4.226933204810882e-01   +2.700036877286935e-01   -1.844074419444609e-01   -3.870553191766607e-01   -2.094166496659925e-01   +3.776824230293426e-01   +2.973507111078151e-01   +5.447444725273992e-01   +1.162633664635783e-01   -8.022154530180560e-02   +2.656453461602657e-01   +8.875586569984268e-01   +2.156465741084090e-01; +5.790975713336139e-01   +3.576270974506081e-01   -1.281746816896935e-01   -1.571217802826471e-01   +2.942073613900798e-02   -2.084258375143406e-01   +7.222810953294876e-01   +5.498930907705494e-02   +3.545759991834956e-01   -1.072235133103038e-01   -1.101626533966774e-01   -2.191419975413772e-01   +1.000000000000000e+00   +3.937021957805650e-01   +4.985757012153972e-01   +8.049145618603979e-01; -2.312824101204097e-02   +7.221312073812542e-01   +1.076334084871146e-01   -4.400231707803355e-01   -3.813316006115323e-01   +1.546853476350439e-01   -2.012233301212677e-01   +2.224966199524005e-01   +1.660051347032860e-01   -2.561762366078176e-01   -3.143191759866654e-01   -4.359673626001013e-01   -7.918250180955083e-02   -1.003587954631259e-01   +3.094908578357988e-01   +3.087163611592708e-01; +2.802917208551484e-01   +4.669834212964515e-01   -7.859594481403728e-02   -2.803730077039991e-01   -2.738926548994337e-02   +2.042286434446513e-01   -2.854166855426490e-01   +2.188925574009172e-01   +3.367649097991903e-01   +4.097800976202630e-03   -7.450176687499427e-01   +1.274658517146976e-01   +4.366259595384807e-01   +5.760168058471410e-02   -7.112119796765348e-02   +4.667315039126634e-02; +3.811952159836285e-01   +6.481106644670233e-02   +3.121284462741637e-02   +1.662382309137398e-01   +1.063147946379616e-01   +3.930722472579030e-02   +3.257524301826792e-01   -2.479962451379789e-01   +3.046913869712548e-01   +3.444426454424116e-01   -4.569412878123550e-01   +3.792409564810653e-01   +3.611646521320101e-01   +3.387374556172680e-01   +1.390305021242832e-01   -2.960951143699173e-01; -3.146775056248410e-01   +1.217335786606020e-01   -2.962215275530030e-02   -2.179321132134182e-01   +4.670490242804581e-01   -2.986321348544209e-01   -1.338224026183162e-01   +7.421031546233035e-02   -8.569334357559680e-02   -2.064917610661173e-01   +1.350100167897441e-01   -2.943879680376081e-01   +2.530322161494494e-01   +1.417603108527061e-01   +3.637357125753323e-01   +1.335016311256267e-01; +3.228038974458189e-01   -7.268888425137304e-02   -2.048655622105480e-01   +2.765337956851119e-01   -3.327168547007471e-01   -2.975651806290273e-03   +7.214078999756450e-02   -4.396926774234818e-02   +1.820651024467383e-01   +2.145033657629517e-01   +1.835825047759949e-03   -3.537126761767848e-01   +5.611643216650681e-01   -4.012227871059453e-02   +1.290871681855636e-01   +4.342721529645824e-01; +5.567284215873501e-01   -8.573252916120147e-03   -3.089841742446949e-01   +2.554994192538994e-02   +1.349094000661537e-01   -2.421649259220966e-01   +8.318260069135142e-02   -1.043179233395422e-01   +6.906176023568552e-01   -4.142797449074528e-02   -4.993464109130945e-02   +1.958145411031983e-01   -7.382237173996548e-02   -3.950099249404956e-02   -3.463524204348425e-01   +1.587689674043498e-01; -5.381845744524623e-02   +9.275128384153514e-02   -1.743372853265282e-01   +1.886543799305348e-01   -2.222122666653125e-01   +1.766715209291052e-01   +1.564845588172412e-01   +3.372806652701140e-01   +4.641742391220955e-01   +4.281571624564169e-02   +5.154541502090547e-01   -1.219316075945878e-03   -2.905442066994298e-01   -4.318293074925108e-01   +8.169842856743315e-01   +5.043200106990271e-02; -2.821132716233590e-01   +2.468455656125765e-01   -4.481574032282477e-01   -1.679003934471209e-01   -2.494069468496693e-01   -9.288999100311227e-02   -2.613168398658541e-01   +1.485965106286565e-02   +2.376442497082088e-01   +4.134114044683468e-02   -2.092141679826557e-01   -1.454763709420657e-01   +2.240779970481684e-01   +3.242718356977974e-01   +4.786235542605954e-03   +1.225932035249483e-01];
L2I_L1I_iGABA_netcon = [-4.095065750317192e-03   -2.144001237378938e-01   -3.194728003466072e-01   +6.796698229887533e-01   -2.357491315317348e-01   +4.689450551754181e-01   +1.200266497142858e-01   +1.241362608903350e-01; +9.128394831411872e-02   +6.816636307521334e-01   -1.582247141898181e-01   +1.232887987873896e-01   +3.066061251651244e-01   +6.263132713114844e-01   +1.548987088291450e-01   -2.269273741669414e-01; +5.345612535239186e-01   +1.369238336619542e-01   -1.064643765125408e-01   +4.746945168300412e-01   +1.335572281580687e-01   -2.159038274638131e-01   -1.477886614587603e-01   +1.531383977551861e-01; -2.678871672783273e-03   +3.101110819665017e-01   +6.542874013417537e-01   +7.368211440932315e-01   +2.894332431455148e-01   +2.404278086121593e-01   +3.585503034696907e-01   -1.151209335326626e-01; +1.523053658611187e-01   +6.583628538703515e-02   +7.363919626053675e-01   +6.859540252743188e-01   +8.252130945896533e-01   +2.133060400890498e-01   +3.096986214493048e-01   +3.360405527890540e-01; -2.884873891685583e-01   +2.760948528543222e-01   +8.287251425955708e-01   +3.420008848880306e-01   -1.284825132176763e-01   +6.878820114569030e-01   +4.178497673795327e-01   +7.971669813192782e-01; +1.142451196520912e-01   +5.233543148277486e-02   +8.463702812619642e-02   +1.508873087848998e-01   +3.124063505795222e-02   +8.513481069344031e-01   +4.515559254227947e-01   -7.233443703340900e-02; -2.683699037967425e-01   +3.776128663892352e-01   +2.562059265510372e-01   +4.245104912354828e-01   +5.846371516775903e-01   -2.869990680702046e-01   +6.616518180712774e-01   -6.984428785554102e-02; +1.928045027769884e-01   +7.882025224553879e-01   -7.293255653121996e-01   +3.498691954853670e-01   +4.960127009908564e-01   +9.553415714636203e-01   +3.547624827926507e-01   -2.689921884306641e-01; +4.348294178745080e-02   -3.930727852435820e-01   +6.514399061848263e-01   +2.866479194518123e-02   +3.499457162811035e-01   +7.267547045846691e-01   -9.279059070135588e-01   -3.320474336511336e-02; -2.117990662669581e-01   +3.133441280362096e-01   +1.083739962670298e-01   +1.811101009029020e-01   +1.983655198183948e-01   -2.613665485313675e-01   +1.042304514192562e-01   +3.983989648818174e-01; +3.002818059017376e-01   +3.371961554797997e-01   +3.908228317176158e-01   +6.636148673246259e-02   -4.058875318122911e-02   +2.816028609394148e-01   +8.306364563055477e-01   +3.631166595376481e-01; +1.690175100849330e-01   +3.345846828134249e-01   -2.750016134177290e-01   +3.110060880959425e-01   -9.150767159660345e-03   -6.464325324966428e-01   -3.726191705695485e-01   +2.661496496538442e-01; -4.200704165114476e-01   -5.050114024318582e-01   +2.089313961625454e-02   -3.923969542435904e-01   +1.407776115281097e-01   -4.570532960573402e-01   +6.244135933989150e-01   +2.899334656324404e-01; +5.810943656556117e-01   +5.411408638959609e-01   +3.974455296802072e-01   +1.619173038027319e-01   -1.888220205703575e-01   +7.236560886716931e-01   +7.482901213596752e-01   +2.048993629512250e-01; -8.379765069593770e-02   +1.460325877062078e-01   +5.371719394539621e-01   +7.310993973933972e-01   +8.510679464672535e-01   +2.010729421340623e-01   +2.858328654879534e-01   +1.828286343034621e-01];
L1I_L2I_iGABA_netcon = [+3.120843447214067e-01   +8.040293921048741e-03   +6.158349454334870e-02   +3.097112249314781e-01   +3.920508656545738e-03   +8.156054675629371e-02   -2.187022369566859e-01   -2.808865116789554e-01   -1.962455480656474e-01   +5.350415347657160e-01   -2.191766206121043e-02   -1.500150693287070e-01   -2.605643324023995e-01   +9.431457261828785e-02   -5.549786167204496e-02   +3.586200684492563e-01; +1.432429078040329e-01   -5.337207168122915e-01   +1.705599447998696e-03   +2.814401354538437e-02   -1.486329714395923e-01   +7.952236568091360e-02   +5.086092649130961e-01   +2.053550098088323e-01   +2.280895125089870e-01   +7.980337795518170e-01   +1.465921321562622e-01   -1.859743832949606e-01   +2.831629975699121e-04   -4.512278872206669e-01   +5.606157360191308e-01   +4.162880280259720e-01; +9.435189494127662e-02   +4.162682560844271e-02   -9.199660280196939e-02   +2.076921148952419e-01   +6.549937934555133e-02   -7.255611281560953e-01   -1.294135092759032e-01   -1.952626717184477e-01   -6.492596902716624e-02   +2.627158473616855e-01   -2.074810994237512e-01   -2.551933541201563e-01   -9.507973906097787e-02   +6.266198765157915e-01   +8.267135581048430e-01   +1.554454983975034e-02; +1.296356410908862e-01   +1.783975705756310e-01   +1.480632006974018e-01   -1.730349895163619e-01   +3.238891106898426e-01   +9.730781612227856e-01   +5.846847722776999e-02   -1.342619998824668e-01   +3.590407020622260e-01   +5.715528071332809e-01   +2.494737910514510e-01   +2.036245476150411e-01   +1.169618762004038e-01   +7.736500906710526e-01   +1.805866119565220e-01   +6.425021162638603e-01; -3.495823367511681e-01   -2.101285017958340e-01   +3.950790301754482e-01   +1.159450136822242e-01   -1.284973861629968e-01   +6.029002908647394e-01   +4.107337019243947e-01   +6.022323741796106e-01   +2.802321373956523e-01   +1.020538996531391e-01   -2.186543922992340e-01   +5.321499855493697e-01   -4.969464844843006e-01   +4.618285611170494e-01   +3.478683324788751e-01   +9.514300605382108e-01; -1.653085407392309e-01   +6.927249810439131e-01   -7.485852662786161e-01   +2.392840395335654e-01   +6.159900262893087e-02   +2.963317753022226e-02   +4.155350856157382e-01   +2.120459384394264e-01   +4.685142237797606e-01   +4.227426632995998e-01   +2.435217177704995e-01   -2.405027278561854e-01   +2.500488763098687e-01   +7.417156393984810e-01   +2.545289392887246e-01   +2.349376733270326e-01; +2.869990042540698e-01   +4.522734364677223e-01   -2.767394226604138e-01   +6.662688146915470e-01   +1.843451711211429e-01   -2.421261151035003e-01   +2.854062235362145e-01   -8.340598821743272e-02   -7.256672293913173e-01   -3.164001350428121e-01   +4.661804442080759e-01   +7.588082210352420e-01   +5.650169773887687e-02   +4.688196583202385e-01   -8.354732963215764e-02   +8.342394733041239e-02; +5.089037430517742e-01   +1.683955007219773e-01   +4.212175244543228e-01   +5.824443836156754e-03   +1.328669448488331e-01   +2.203127306795066e-01   -1.616278023794810e-01   -1.215753590505680e-01   +1.020285993102763e-01   -1.087714546769981e-01   +2.122384285418402e-02   +3.494430354632103e-01   -2.243758205336012e-02   +4.211032076310965e-01   -2.125140907616921e-01   +4.921142049030549e-01];
L2E_L1E_iAMPA_netcon = [+2.585185460525301e-01   -6.498244813312214e-01   +1.799513644174485e-01   +3.835946622368114e-01   +1.626064537697895e-01   +4.462063602530933e-01   +3.922509821546992e-01   -5.474239992483095e-01; -1.680630362852920e-01   +1.171111380839116e-01   -5.269692645610667e-01   +4.370674677650105e-01   +5.323082339852195e-01   +3.156198752241998e-01   +3.665973906041138e-01   +4.978059351138994e-01; +5.379733053782014e-01   +2.795563287355269e-01   +7.419298829795695e-02   +4.008188752719317e-01   +8.343066060449110e-02   -1.863606025080712e-01   +1.880550328111314e-01   +3.873362900354479e-01; -1.179400669100491e-01   -3.061166173232419e-01   -2.106301776446311e-01   +3.796862031545231e-01   +1.675557857282833e-01   -3.453733768167632e-01   -3.583124677396111e-01   -1.451044845265374e-01; +4.407118006165436e-01   +2.597814562578800e-01   +3.873640618438690e-01   -4.236604312047300e-01   +1.632582755702825e-01   -2.412711537532854e-01   +3.001299395807949e-01   +3.013484863879888e-01; +7.969005936736641e-01   -3.295514491105463e-01   -1.631106054953237e-01   +5.781589720806478e-01   +2.989647450352512e-01   +6.084909293242130e-01   +4.950622380402436e-01   +7.007439325591386e-01; -4.410181851239629e-01   +8.359108746360323e-01   -1.983853091863835e-01   -1.102308227331602e-01   -2.443478617180581e-01   +6.678264914691242e-01   +4.406409020905225e-01   -2.701417461687040e-01; -2.111384068291841e-01   +4.445630543318588e-01   +5.919264875977287e-01   -2.506381008822913e-01   +3.827027086893138e-01   +1.915461899564949e-01   +5.937376399774301e-01   -1.839211240316141e-01; -1.164225558867726e-01   +4.235945351928214e-01   +8.127086116618687e-01   +3.041402168737500e-01   -1.000000000000000e+00   +5.966617005757394e-01   +7.515631780665109e-01   -4.017257380129472e-01; -5.107082013780291e-01   +3.698959834938318e-01   +1.806700219635344e-01   +5.490976537340685e-01   -2.815294272410273e-01   -5.199478298040431e-01   -1.145146467988013e-02   -1.993665666715774e-01; -3.676083346617670e-01   +6.722202490532122e-01   +5.459870090886816e-01   +4.188524045721236e-01   +8.671394182204051e-02   +3.080133474682663e-01   -1.646160277420387e-01   +3.835779204163039e-01; +3.673268237234964e-01   -1.320665164504227e-01   +4.453159295216890e-01   +2.558907004873514e-01   -1.175452639026325e-01   +2.005490141998553e-02   -1.816645547246328e-02   -3.769940753599210e-01; -2.573201812873067e-02   +1.127582272296879e-01   +1.504489923015409e-01   +3.629136998869332e-01   +3.151937622135187e-01   -8.053648804774401e-01   +3.070850296465360e-01   -2.892520484322305e-01; +5.344426817428195e-01   +4.564636742419891e-01   -5.171959976207265e-03   -8.896811306629125e-02   +4.343945690981065e-01   +1.770833278701459e-01   -3.592841541444335e-01   +5.392632567810358e-02; -4.974749191795604e-02   +1.384168533788306e-01   -1.142353934853579e-02   -2.484817561979701e-01   +1.202195461589664e-02   -2.582197748578249e-01   -2.326965330145362e-01   -3.676532790009664e-01; -2.171550566489198e-01   +3.617700750393455e-01   -9.544100535634544e-01   -1.306246203716579e-01   -1.139455243929691e-01   +1.384865599836735e-01   +5.802202099111454e-01   -1.294684725383614e-01];
L1E_L2E_iAMPA_netcon = [+2.633385519541872e-01   +3.681495067339769e-01   +1.282288111124973e-01   +2.956182939865662e-02   +7.374280916717264e-02   +3.862814576740045e-01   +3.667336229940262e-01   +3.444752214630462e-02   +2.914836172770830e-01   -8.478147925513187e-02   +5.558758087042092e-01   -2.741736056986262e-01   -1.177273060726770e-01   -2.178616131459932e-01   -3.783586930371213e-03   -8.459718234296737e-02; +1.555529553351458e-01   -1.940143160871402e-01   +3.764296228112587e-02   -1.927428777912625e-01   +2.049748700042287e-01   -2.090021584519050e-02   +9.565880759672774e-01   +5.482120994490722e-01   +3.037614039565689e-01   +1.254880226668155e-01   +5.465237197711839e-01   +5.124948723825906e-02   +9.916070412933649e-01   +4.817180676594026e-02   -1.434726999218235e-02   -2.661574806641188e-01; +9.845083477491738e-01   -3.160675752779178e-01   +1.519195009377893e-01   +3.884694195127890e-01   +6.535702561709774e-01   +3.928806258616884e-02   +1.096235994877529e-01   -3.812471858635387e-01   +4.552726698633855e-01   -1.895858506649491e-01   -5.360790148959257e-01   +2.861757248064718e-01   +6.012471525970137e-02   +2.691261474804725e-01   -2.865244029785583e-02   +7.375377052323244e-02; +1.922918077237466e-01   -5.732244354624983e-02   -5.747960712750939e-01   +7.073516828479700e-01   -3.051220806834624e-01   +9.216251885582173e-01   +1.000000000000000e+00   -3.250857549388419e-01   +1.362143705422133e-01   +4.701351206851709e-02   +6.140008542341689e-01   +8.317466632426752e-02   -5.822903139845289e-01   +9.195104659279812e-01   +3.340756009340109e-01   -2.374297119210625e-01; -4.353051176128424e-03   -3.313830786375693e-01   +1.046796348199724e-01   +2.009846200011811e-01   +2.508986678853921e-02   +2.865154791172096e-02   +1.407490199484663e-01   +5.168913740102618e-01   +4.572629642554772e-01   +3.840338229214181e-02   +3.029706997112693e-01   -4.350725016003751e-01   -5.302522147087339e-02   -6.118940148674006e-02   +4.659479785430116e-02   -5.310981397537773e-01; -1.608048261575076e-01   +5.325086717802119e-01   +8.959692936707404e-02   +2.332404926786595e-01   -9.550089271296563e-02   -6.884209508885171e-02   +7.822470769071725e-01   +2.205697659244154e-01   +9.255975949330958e-02   +9.871204866950196e-02   +9.036236255120041e-02   +4.643085286954279e-02   -1.595975402487207e-01   +1.145023749402427e-01   +3.084595166562740e-02   +8.187813336510439e-01; -1.074012914219908e-01   +7.718181784441098e-01   +1.643188646828384e-01   -8.468509855292522e-02   +2.819517904273752e-01   -3.082253244799563e-02   +3.633996857747397e-01   -8.251007550691896e-01   -6.051671847043020e-01   +2.711696661243773e-01   -2.035872507061510e-01   -2.224788509006185e-01   -7.129964052344262e-01   +8.430432479961690e-01   +4.939073947437362e-01   +5.197359211770995e-01; +3.511623134512890e-01   +4.561976915375571e-02   +4.093516356908092e-02   +6.272127582570087e-01   +1.167835074181224e-01   +4.684646945116542e-01   -2.783717453160401e-01   +1.308281468379096e-01   -7.368959897580636e-02   +3.989196497866486e-01   +8.610928563169275e-02   +2.845079908587920e-01   -7.871127812436943e-01   -1.403160266095984e-01   +1.228944525177098e-01   +3.408934314762179e-01];
L2I_L2E_iAMPA_netcon = [+8.764518653093301e-03   +4.027662080444646e-01   +5.530505508470894e-01   -4.958221971581603e-02   +2.924596998032656e-01   +6.328436453169049e-02   +1.503756345494389e-02   +5.322631169278869e-01; +7.226946637403544e-01   +1.465421018666119e-01   +3.002457759830812e-01   +9.099778159227152e-01   -4.830393158794610e-02   +2.260304464057875e-01   +2.316879138179170e-01   +3.501921950488613e-01; +5.041593579695872e-02   +3.244824413986754e-01   -8.249110409337335e-02   +5.504405440975617e-01   -3.419852321732514e-02   +5.787889988099185e-01   +7.914401032351572e-01   -1.137260698067223e-01; +3.985699434150700e-01   +3.163617108812701e-01   -3.497368694754006e-01   -1.755948788631907e-01   +6.122627753547210e-01   +3.183872954190814e-01   +7.580230545678404e-02   +6.727696647036165e-01; +9.285086508792115e-01   +3.589419374548144e-01   -3.935782372285455e-01   +3.724909661509240e-01   +7.588449566006721e-01   -2.758360561227930e-01   +1.657300086842552e-01   -2.269693964009292e-01; +2.289705034805692e-01   +1.630430506024575e-01   -5.221499556844711e-01   +5.242555583911821e-01   -1.819762003209552e-01   +1.855770778275256e-01   +2.806858014469298e-01   -1.082634868717898e-01; +6.869423463205514e-01   -2.061642064295773e-01   +7.586982483212676e-01   +3.997673230208926e-01   +4.884246970390346e-02   -1.101723347352614e-02   +4.809945400704891e-01   -4.114659018387975e-01; +3.655817789476871e-01   +2.001469977910220e-01   -5.397299343275828e-01   +2.031894151410637e-01   -1.072370998829666e-01   -6.638526545714460e-02   -1.969069789026888e-01   +9.803963597656082e-01];
L2E_L2I_iGABA_netcon = [+2.690278930826271e-01   +5.542069274689647e-01   -1.565001432724460e-01   -5.077590668505459e-01   +2.937282673068828e-02   -3.616931652137324e-02   -7.435658329156640e-01   +6.467915801543469e-01; +1.557939061103237e-01   +3.867952105521865e-01   +2.738709833643164e-01   +7.334470874120378e-01   +2.957658389267774e-01   -2.599341740484616e-01   -5.486572072139346e-01   +2.087636141148162e-02; -1.465537172190474e-01   +7.667123811463294e-01   -4.085623982489137e-01   -5.164291230578326e-01   -1.272692531205969e-01   +6.977082346304676e-01   +2.122561622796879e-02   -1.790870066212697e-01; +8.435224318384460e-01   +1.591006118249434e-01   +3.481416622946286e-01   +7.878901210373561e-01   +7.248538560319131e-01   -3.890466683543867e-01   -5.410722302839129e-01   -1.196713794087436e-01; -6.181113177427000e-01   -6.450172127809534e-02   -2.846352908042051e-01   +3.663160569016632e-01   +6.705089256907041e-01   +2.716276005253658e-01   -9.365054007897211e-02   +2.825119659539174e-02; +7.019388468178835e-01   +2.295021689111814e-01   -1.630465163580629e-01   +2.570793400033677e-01   +1.691373933354912e-01   -7.894379234921406e-02   +3.239032891031118e-01   -3.841288870336272e-01; -5.592194753448683e-01   -6.689006738527561e-02   -1.244112547743369e-01   -1.645717868052888e-01   -6.726703365361496e-02   -2.232138365199540e-01   +9.669973761193781e-02   +6.658219252091528e-01; +1.862408240430560e-01   -1.573678549117436e-02   +4.142484323350272e-01   -2.734201493431300e-01   +7.725899866320045e-01   +1.667559049597997e-01   +7.385697885777145e-02   +8.978735100461875e-01];
L3E_L2E_iAMPA_netcon = [-2.961476479654237e-01   -9.765993536356009e-02   -2.507595322425808e-01   +2.896415808069298e-01   +7.289049884655054e-01   -2.651103681145612e-01   +1.006855859599762e-01   +6.999538602293705e-01   +1.674878103372439e-01   -1.591955523932176e-01   +4.310829723495461e-01   -5.082694212496700e-01; -3.088564349483569e-01   +7.903161964653647e-02   -3.169531126478607e-01   -5.377249475362800e-01   -3.165265234279401e-01   -1.844460423502561e-01   -1.333781240674052e-01   -1.433365491211963e-01   -1.067788418399506e-01   +5.568426703171639e-01   -4.031604569672325e-01   +3.968565832643142e-01; -5.910344013642211e-01   -4.481139060319408e-02   +4.108191178441446e-01   -1.695944396273601e-02   +8.677072024405288e-02   +1.595769535540608e-01   -1.019011534514771e-01   -1.879610318668949e-01   +6.821246621528387e-01   -4.373093785049672e-01   +6.071122455809056e-01   +6.839602751638989e-02; +7.349367234537446e-01   +4.095706843085888e-01   -4.107668171352919e-01   +8.382414088937257e-01   +1.000000000000000e+00   +5.174035152917797e-01   +5.032184860215394e-01   +5.822954286594031e-01   +6.926396963451126e-02   -2.205829124034785e-01   -2.830788506505724e-01   +9.304497594092623e-02; +7.457286878412527e-02   +6.995893190807084e-01   +8.175791342244600e-01   +8.311134516973105e-02   +5.315816676263374e-01   +7.278824266992729e-01   -6.294113909454695e-02   -2.305967947665419e-01   -6.489204786523918e-01   +2.390514548993007e-01   +3.221139521962556e-01   +2.463541441101179e-01; -1.424882413601663e-01   +3.331383540268349e-01   +3.517628766447167e-01   -3.865136295854581e-02   +7.691980173977515e-01   +3.976065448094741e-01   -2.359753991192574e-01   +2.313332893393255e-01   -3.610253576632717e-01   +2.880594387726411e-01   -1.604858821998861e-01   -2.850601666436874e-01; +5.536607212635407e-01   +1.314261301068379e-01   -7.374234292340096e-02   +2.229774526849131e-01   +1.366340217426836e-01   +4.652703968368295e-01   +8.498887886063400e-02   +2.764386128643011e-01   -1.961459023338194e-01   +1.852013807470409e-01   -2.713804162947914e-01   +7.987247581886260e-02; -2.408005987011529e-01   +3.721427950191206e-01   +1.032248751515125e-01   -4.119462934280136e-01   +3.297000574112235e-01   -4.353660906557567e-01   +4.923133091957673e-02   -3.207013591801012e-01   +1.737122190488936e-01   +2.765718447684148e-02   +6.982868123544701e-01   -4.326847813947539e-02];
L3I_L2I_iGABA_netcon = [+9.896948327014498e-01   +6.249615030033895e-01   +3.106407382109275e-02   +2.786711241035016e-01   -1.559107250000203e-01   -1.532899040350121e-02   +8.287756268242806e-01   +9.408933459559408e-01   +2.374659694049720e-01   +5.939396123204979e-01   +7.934826023519101e-02   +9.904023175360116e-02; +7.509629947706993e-02   -1.482035080407348e-01   -3.744727015538583e-01   -1.497647303813621e-01   -3.593715195757820e-02   -1.477738801514245e-01   +1.948971113415029e-01   +5.997043025106556e-03   -1.805613419652011e-01   +1.594588844319330e-01   +7.249898689335341e-02   +5.851224861841938e-01; +1.185803090292838e-01   -6.177921840854189e-02   +1.612966907015515e-01   +8.522577207114414e-02   -3.540469624711831e-01   +5.492019537567758e-01   +1.469960145847138e-02   +1.771237473985817e-01   +2.710306746116702e-02   -3.695830960718829e-01   -1.711881181623089e-01   +6.274993924286166e-01; +6.464149887994711e-02   +2.859530658281872e-01   +1.329454039720600e-01   +1.001895424748606e-02   -7.115286804333636e-02   +3.425717221913029e-01   +2.207259364865921e-01   -1.127605191386888e-01   +5.077833748456273e-01   +3.700944902221530e-01   +4.196284242513334e-01   +3.004922294474291e-01; -1.512014153326781e-01   +1.980000708134809e-01   +3.977640204554539e-02   -5.180768244002240e-01   +1.910534501473556e-01   +2.704149082979081e-01   +1.388891315610030e-01   -1.582379090921001e-01   +2.353533374431807e-01   +1.202439925762433e-02   -2.880312228638491e-02   +2.770149891780356e-01; -1.144865652881518e-01   +1.490617513623975e-01   +4.836734179804374e-01   -8.719188900085430e-02   -3.976376421351389e-02   +4.385382413480828e-01   -3.328202552010068e-02   -6.846463221074690e-02   +2.589309835120929e-01   -2.704228687392687e-01   -8.418029684171084e-01   -3.044606367396385e-01; +7.014891506923911e-02   -8.348772555952114e-02   +2.407190998730199e-01   +4.171096857852733e-01   +8.546715012739972e-02   +3.393693792165433e-01   +1.929675352003966e-01   -3.618071556149696e-01   +8.376902829233267e-02   +2.550944349786575e-01   +1.723376140941837e-01   -5.803690077689660e-01; +1.655608127245596e-01   -4.476000266998241e-02   +3.997209135455736e-01   +6.318562761262868e-02   -1.745615873997610e-01   +3.522609736940699e-01   +1.917383131253465e-01   +3.706885987085072e-01   +3.433216330343098e-01   +1.805135751631809e-01   +3.172360561311848e-01   +4.381732413198457e-01];
L2E_L3E_iAMPA_netcon = [+6.672605899358398e-01   +2.202362229388712e-01   -7.221196828401151e-02   -2.992325070585742e-01   -1.717753058392253e-01   -6.755730222924847e-03   +7.440008759218937e-01   +4.519000536177321e-01; +3.884735706932935e-01   -4.597483560936755e-01   -5.380907067779465e-01   +1.038240322494244e-01   +6.439488135097390e-01   -9.821782598705784e-01   -5.196479124095456e-01   -4.257053622758363e-01; +5.445921244622699e-02   +2.110510505568085e-01   +6.447600439147347e-01   +1.714674694156788e-01   +4.077959935047792e-01   +3.138527941078918e-01   -3.274744338498796e-01   -4.619291306222741e-01; +7.627481417541336e-01   +1.308721306362340e-01   +6.087231942423093e-01   +7.568407780664075e-01   +7.986000511664876e-02   +4.284983594402015e-01   -7.838608412702597e-02   -4.092501584449956e-01; -1.235141550812459e-01   -4.061480454054731e-01   +4.766884773678599e-01   +5.940545186674164e-01   +7.084890472079267e-02   -1.372386732442801e-01   -2.007031043824115e-01   -6.733433722822503e-01; +2.360152548720881e-01   +3.481044125746037e-01   +9.106133442898721e-02   +5.188807846502950e-01   -8.309825068046708e-02   +4.512376649015009e-01   +3.176319766843852e-01   +9.272099288069775e-02; +1.562294806346991e-01   +7.211022282943801e-01   +8.485629682970596e-01   -2.967118148815212e-01   +4.708673088853890e-01   +3.370160009521144e-01   +3.511448897963295e-01   -1.655976981598299e-01; +4.957597883775100e-01   +6.831598433433189e-01   -5.281804744249194e-01   +2.457064073564481e-02   -4.055230272381378e-01   +7.644995986193669e-02   -1.489301737094059e-01   +7.328026580247001e-01; -4.853780219909384e-01   +4.193119663921697e-01   +8.568954935561904e-01   +5.645392414821144e-01   -3.502182698383681e-01   -3.451523574539592e-01   +6.019423817278641e-01   -1.347643463338169e-01; -3.082319581890058e-01   -2.989502281523044e-02   +5.264598525956635e-01   +1.309080479581811e-01   +4.909087212083156e-01   -6.917401676230630e-01   +4.982336549240051e-01   +8.811225333450010e-02; +5.436933878060597e-01   +4.532122844260379e-01   +1.170658644374662e-01   +2.400811634044603e-01   +3.036964189957669e-01   +7.121736510482708e-01   -4.785751310322320e-01   +9.714158359498999e-02; -4.652177589738724e-02   +1.097627057233828e-01   +3.559354111400553e-01   -1.036917167776411e-01   -9.873736813873141e-02   -1.146979875504893e-01   -4.275699881942836e-02   +2.417727579392668e-01];
L2I_L3I_iGABA_netcon = [+3.169437698619594e-01   +4.155124830653902e-01   +2.588733760252426e-01   +1.224276150307606e-01   +3.978195189489774e-01   +6.791223123376391e-01   +8.854628621285118e-01   +4.170300450633206e-01; -3.424196390707204e-01   +4.348889613495186e-01   +4.083263426946580e-01   -1.987830386630059e-01   -2.901710822379805e-01   -1.476212380194528e-01   +3.486814670716787e-01   +7.910262043620147e-01; +8.981047044454013e-02   +7.236599817880156e-01   +6.170335768054347e-01   +3.217017921063831e-01   +6.004778733898004e-01   +1.429332725635351e-01   -1.386946996170462e-01   -6.740552129965577e-03; +2.699130667896892e-01   -5.363382713532233e-01   +3.056837705413012e-01   +2.563956595582519e-01   -4.698322630456292e-02   +3.218408444232870e-02   +1.630961206332306e-01   +4.273076642323541e-01; +3.634505290509181e-02   -2.236226205156013e-01   +2.058553440972675e-01   +1.459983559365705e-01   -3.501958785820411e-02   -6.458484052038060e-02   +1.558115711645662e-01   +9.307865723145284e-02; -3.046157482995009e-01   +7.328391108384690e-01   +2.097395469750378e-01   +6.856289640997922e-01   +3.083959123632964e-01   +3.201322601672196e-01   -2.114868782873920e-01   +4.408273459660141e-04; -2.763751247144953e-01   +6.290575456733098e-01   +5.509650656924675e-01   +2.337741810187994e-01   -2.010125494368841e-01   -6.592487039857976e-02   +6.389583523699789e-01   +4.235359355718109e-01; -4.545132607129321e-01   +3.555387784720344e-01   +4.665910993349099e-01   +3.639979457799246e-01   +1.829098978068333e-01   +7.621592939176821e-01   +9.738067019453954e-02   +9.080837905528798e-01; -6.204450611515486e-01   +3.635588982702258e-01   +2.328976944008672e-02   +2.393673328242569e-01   +8.433070794356544e-02   -1.307552311927561e-01   +6.487394750434682e-02   +2.540132875058850e-01; -8.112093547120447e-03   +5.865578480455441e-02   +5.740625419061393e-01   +2.579950924608507e-01   +4.465920998511395e-01   +2.365254120622999e-01   +5.185472288317676e-01   +1.418018361899007e-01; +4.960544215743801e-01   -1.440855259296329e-01   -5.398840979512718e-01   +3.840696337198953e-01   +1.726911571864056e-01   +3.472312459779540e-01   -5.925905717668138e-02   -1.725831195831678e-01; +7.200349416658627e-02   +7.795907444776310e-01   -2.893326680055092e-02   +2.329379498176583e-01   +6.359186777639031e-01   +5.229272649994795e-01   -3.905075548051861e-01   -1.797488414000887e-01];
L3I_L3E_iAMPA_netcon = [+3.180387171286228e-01   -8.873803474765377e-01   +3.002578354348361e-01   -2.470596680436330e-01   +2.771944195213329e-01   +5.215776352018466e-01   -1.076029225965742e-01   +2.998663059646556e-01   +5.920368133956455e-01   -3.596157413821158e-01   +1.711641363528852e-01   +4.955811923096419e-01; -3.733055919434047e-01   +4.104301422568234e-01   +6.303561257301861e-02   +5.692145746398306e-01   +2.975431131103778e-01   -1.216899890063805e-01   +6.533066765927993e-01   +1.000000000000000e+00   +4.858540823593166e-01   -4.247032158062300e-02   -3.735344637870670e-01   -3.623314436392672e-01; +3.809704539230122e-02   -3.189342599792942e-02   +1.426774086915223e-01   +1.640128572006635e-01   +6.667849699161208e-01   -3.619912969351342e-02   +3.218605304407302e-01   -3.415464605375146e-01   +4.924581480255736e-01   +1.088792240264467e-01   -2.152265961123315e-01   -2.890496970894154e-01; -4.559083070524075e-02   +4.733765150721561e-02   -5.330977971459920e-03   -2.521505806141092e-01   +2.386027951320205e-01   +2.694244893443796e-01   +3.674837207595220e-01   +2.392671362396270e-01   -6.565812898244814e-03   +1.419713449211052e-01   +3.807554891090503e-01   +3.958348590493642e-01; -3.392729228481186e-01   +4.053701764864543e-01   +7.983931919016991e-01   +7.582602752753582e-01   -1.265699796630354e-01   +2.614619856106574e-01   +2.090218981548130e-01   +4.571160690705841e-01   +2.886333248341771e-01   -2.165024390021623e-01   +2.962387505107053e-01   +5.027306105960231e-01; +1.768161252783966e-01   -2.955794871124305e-01   -5.053711392012200e-01   -2.723760415307096e-01   -7.052173175816562e-03   -3.209322025783344e-01   +3.895377990164682e-01   +9.452307713978544e-02   +1.100897604364638e-01   +3.501712237578797e-01   -2.294629761700922e-01   +7.415765232657028e-01; +5.657061579055988e-02   +2.848383739980313e-01   -1.166052133325618e-01   +3.437072484243414e-01   +5.611856388564522e-01   +8.854918675242440e-02   -7.124868213458774e-02   +1.088256900544896e-01   +1.455564423053331e-01   -1.499991370445819e-01   -2.938382034262788e-01   -1.172913427410187e-01; +3.206297535418130e-01   +5.596143603252725e-01   +2.570431509722784e-02   +6.313287452690866e-02   +7.249145139004337e-01   +4.038281809484946e-01   -3.602765339065994e-01   +4.690867683949448e-01   -2.382624642066912e-02   -6.280812147922823e-02   -2.581110102831750e-01   +2.522523011237429e-01; -1.504195948253821e-01   +5.179185169223616e-01   +2.358900481333415e-01   +6.897212594132437e-01   -2.111369503970458e-01   +5.182762596037795e-01   +2.106998748274097e-01   -3.491259572994966e-02   +5.560058068531484e-03   +2.366755185031160e-01   -2.058409185455226e-02   +4.947281390625190e-01; +6.989588079448866e-01   -3.050319880787765e-01   -1.147157595204278e-02   -2.653014469022418e-01   +1.125817810787605e-01   -2.090416606407318e-01   +8.507806159323154e-02   +2.577853012988402e-01   -8.186909693043518e-02   +1.463767916456557e-01   +3.917201806078220e-01   -5.964642239110611e-01; -1.863777205499813e-01   +4.586170883104492e-01   +4.534108317134903e-01   +2.744279558694656e-01   +4.749018700118415e-01   -2.581656589581697e-02   +1.723235724755902e-01   +1.463625263449179e-01   +5.953856133355099e-02   +8.575237308137301e-02   -2.648162216526286e-01   +3.896502692880933e-01; -1.493421080820973e-01   +6.208946581068012e-01   +2.201752343202230e-01   +4.250824215383906e-01   -5.006795348741303e-01   -5.071520542577211e-01   -3.054029908830437e-01   +3.176238495761737e-01   +2.044077740252264e-01   +1.094674301187301e-01   +6.392461091318094e-02   -5.902355026951781e-02];
L3E_L3I_iGABA_netcon = [-1.018807461411921e-01   +2.990781229244774e-02   +3.535325678644344e-01   +8.539329350983274e-02   +3.243713438219638e-01   +1.027256445095577e-01   -1.081174202425925e-02   +3.127052435748915e-01   -1.954126254823368e-01   +6.906682945833863e-01   +3.656738435279446e-01   +5.312224773554316e-01; +4.728479315023207e-01   -2.017898675430766e-01   +4.444683777293475e-02   +1.434539331982655e-01   +4.667469967932202e-01   -3.018272493289789e-01   +1.817570197054217e-01   -5.117201442335546e-02   -1.518945994224304e-01   +2.501794041147392e-01   -7.836585240979819e-01   +2.542878514908025e-01; +2.730298638336911e-01   -3.246776002564529e-01   -2.695575029844101e-01   -5.024258434130997e-01   -1.866427393250019e-01   +3.759075901975252e-01   +4.720814311057662e-01   -1.398370060855592e-01   +1.547762398653194e-02   -2.198779127488029e-02   -2.220476654596023e-01   +1.693828191893706e-02; +4.026297263121223e-01   -1.103382943516798e-01   +3.089747844575303e-02   +1.908662605977436e-01   +1.000000000000000e+00   -5.042724126986206e-01   -2.704847453848152e-01   +7.988017644674059e-02   +8.859033946713336e-01   +1.219360254111213e-01   +5.621093231277505e-01   -4.002755162952384e-01; +4.259034450383294e-01   +6.081514222668667e-01   -3.747235527725170e-01   +5.191110059049178e-01   -1.897013758778805e-02   -3.222423897531735e-03   +2.597219459236544e-01   +1.038178711104238e-01   +1.017037504346945e-01   +8.542485129526176e-01   +1.291048498496757e-01   -8.375927186181446e-02; -2.509796670533767e-02   +3.735126096752778e-01   +8.270346260646833e-02   -1.749375269684783e-01   +1.846184359804350e-01   -1.094734205913530e-01   +2.027329608118376e-01   +1.608230297764349e-01   +3.693241731879635e-01   -2.967090910380742e-01   +1.110293134398963e-01   -1.307853289196111e-01; -3.326305531308366e-01   +3.943845742091999e-01   +1.580211462947389e-01   +8.367350374321562e-01   +3.122496022240875e-01   +4.293959107106370e-01   +4.141643691521752e-01   +6.743494258153035e-01   -3.540705097920497e-02   +3.736117373838324e-01   +3.549900552745398e-01   +1.750995145379144e-01; -2.424793731320402e-01   +2.663901562764934e-01   +2.636253324912849e-01   -1.403557705203581e-01   +2.640228993717083e-01   -4.821001474038728e-02   -7.014105578510372e-01   +4.629764421314230e-01   -2.329150655741265e-01   -5.645212689650216e-01   +2.795887491655152e-01   +2.290991769407196e-01; -7.237929721596534e-02   -2.666191943656228e-01   +5.553467751546547e-01   -4.548068066099114e-01   +3.933482797358608e-01   -3.175568082103717e-01   -7.573600016095502e-01   +4.071539784180869e-01   +4.009989188494875e-01   +7.289619927240503e-01   -8.144121558394177e-02   +3.823003943347761e-01; +3.064272106938669e-01   -2.369922699367678e-01   +3.031931635915656e-02   -1.488072846787813e-01   -5.560640099751900e-01   -5.372043899344875e-03   -5.040086259236624e-01   +3.787368858143852e-01   -6.382314683659479e-04   +9.570685141677440e-02   +4.243963726749463e-01   +8.974819243557582e-02; -1.370674289371276e-01   -2.960579730501307e-01   +5.594896926054224e-01   -4.874667133607395e-01   -2.585009094195569e-01   -1.775896908002249e-01   +1.310544973614035e-01   -2.257065724452308e-01   +8.977774190394275e-02   -4.263897762549864e-01   -3.875044677052558e-01   +6.752147626051683e-01; +2.311346451724954e-01   +6.928976492778544e-02   -3.429582791930412e-01   -4.062644110465553e-01   +7.344918288380620e-01   -1.987786680157820e-01   +3.019124722283534e-01   +6.701726821998449e-01   -3.008508361494215e-01   -4.001540924325287e-01   +1.526857190361137e-01   -5.072692715729336e-01];
L2E_Input1_iAMPA_netcon = [+8.291308168026631e-01   +9.548869863196685e-01   +4.582273028901545e-01   -1.256895337909152e-01   +1.152092256968366e-01   -1.933022762626128e-01   +6.441944547263688e-01   +1.695269420524035e-01];
L2I_Input2_iAMPA_netcon = [+4.613416196852052e-01   +8.068195277201402e-01   -1.642110362994261e-01   +2.246125836154517e-01   +8.800704426432199e-02   +2.767361210478804e-01   -1.642311160618078e-01   -2.629733517159000e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
