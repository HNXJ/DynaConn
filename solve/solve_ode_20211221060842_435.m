function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.049743582385896e-01   +5.982766370566877e-01   -4.744600406887705e-01   -2.190803734831699e-01   -3.590047606917662e-01   +5.485701024282512e-01   -3.265084856840616e-01   -1.393547188498000e-01   +4.169769345994109e-01   +4.053167245994804e-01   +2.426057053895543e-01   -1.877335700199254e-01   +1.452344745601643e-01   +1.869248388500149e-01   +7.258490247541866e-01   -7.777721456094792e-01; +3.582172510038844e-01   +2.120277056389340e-01   +2.091107346743431e-01   +8.537543394171513e-01   -1.729279832149267e-01   -2.403346701012817e-01   -2.173100921504865e-01   +3.110907305488515e-01   -9.019616930369461e-01   -7.788369905258722e-01   -4.953650168616570e-01   -1.108157250263486e-01   -8.458493043080235e-01   +1.576557835648359e-01   +6.257952093663754e-01   +3.179037166290450e-01; +4.643343176088160e-01   -2.376296858353861e-01   -1.789742946112698e-01   +4.693575284983665e-01   +3.232551184036790e-01   +2.764565156377863e-01   +3.964998277869812e-01   +9.262820124236659e-01   +1.608223191767110e-01   +4.391175919739282e-01   +1.892044232473682e-01   -2.146520457067448e-01   +7.523926292578159e-01   +3.763015870953976e-01   +4.898348638795254e-01   +2.532239892512044e-01; -3.733288810844435e-01   -7.252012854441479e-01   -7.232371678831222e-01   +2.959940824502197e-01   +5.210484079534043e-01   -1.557384689036179e-01   -4.764610148542643e-01   +3.010163966056921e-01   -6.190648228429128e-02   +1.442128971435177e-01   +2.160782568982186e-01   +3.041601996061697e-01   +8.717207742094152e-02   -7.151657766152676e-01   -2.496664407890512e-01   +6.729761271603101e-02; -1.045589715980371e-01   +8.927628444759653e-02   +8.223501296324088e-01   -6.027402656467068e-01   +6.894165156139519e-01   +2.051461254073794e-02   +5.958593015239575e-02   -3.946476215340497e-01   +1.553466251967421e-01   -3.716232455658566e-01   +5.218119847944220e-01   +1.894566259802095e-01   -2.462821352892418e-01   +2.461493782396898e-01   +2.290790390129888e-01   +4.273029134201722e-01; +6.710042465423571e-01   +4.072487995969928e-01   -1.397409944673005e-01   +4.432831852511850e-01   +6.453382708047757e-01   -1.697835263338593e-02   -7.335147008627830e-01   +7.210491721118729e-01   -6.546018541417704e-01   -5.048561282671310e-01   +2.585502751236448e-01   -5.752765918652011e-01   +2.579055973053321e-01   +3.526241385183259e-01   +7.729523915321421e-01   -3.408235924532640e-01; +5.947465689188087e-01   -3.722932845187156e-01   +2.005839928142626e-01   -2.906255754420053e-01   +2.327122867129682e-02   +2.608385371579162e-02   +3.801497660514619e-01   -4.448700185296376e-01   -6.464943344739382e-01   -3.101080380734547e-01   +2.414932740825363e-01   -2.050496923876498e-01   +6.078897207450821e-01   +2.000134017507043e-01   -4.317078047521500e-01   -2.316988118779306e-01; +6.072738937574350e-01   -2.618302833125818e-01   +6.924906435437228e-01   -4.498769880552377e-01   +1.888092519767114e-01   -8.367951580989832e-01   -3.818421357716398e-01   -8.138849879441877e-01   -2.722786126908175e-01   +3.718228997613809e-01   +4.932611197082866e-01   -2.830968699959579e-02   -4.056596593571954e-01   +6.177931184130301e-02   -5.487617289358608e-01   +5.628630268795209e-01; -3.783077607304104e-01   -6.053476632758943e-01   +1.526822335181717e-01   +1.558381252878490e-01   -7.596383442539414e-01   -4.911003610439878e-02   -3.852243709743103e-01   +3.597604915766745e-01   +4.862043215745953e-01   -5.017786510267067e-01   +4.085482925290205e-01   +5.676588592888531e-01   -1.937034781481354e-01   -4.461305120123189e-01   -4.895654334364925e-01   +3.653977142452077e-01; -2.052899200425903e-01   +2.010281064720340e-01   +2.452861896099740e-01   -1.722830621370016e-01   +9.450467471457341e-01   +3.435146259736063e-01   +1.649856372555778e-01   -5.439341678935116e-01   +3.121307313819937e-01   -6.696093820863449e-01   +8.461436067728842e-01   -1.822165366599955e-01   +4.532473602478939e-01   +3.902063957865668e-01   -3.895470599118147e-01   +6.091966636271910e-01; -5.694876607307556e-01   -1.893608071814720e-01   -4.838839039938794e-01   +5.608428650314555e-01   -1.901115887629199e-01   +4.244587326045018e-01   +2.387318044500086e-01   +3.219313796891439e-01   -1.001930358020746e-02   -3.822083403122690e-01   +2.123002994500733e-01   -8.665339328705944e-01   +4.465862569141058e-01   -2.588929091606106e-01   +1.091509985852517e-01   -4.277861332504272e-01; -1.257324941689016e-01   -2.652358091830585e-01   -7.348982389595473e-01   +4.137705541747447e-01   -7.938006266531966e-02   +1.007958463917231e-01   -3.470875532855090e-02   +4.627053087515575e-01   +9.391502915786192e-02   +8.215252780531374e-02   -1.013032928506608e-01   +2.389901102004117e-01   +4.782956926339134e-01   +7.569347873967934e-01   +3.563148079774968e-01   +7.724318636594255e-01; +7.434131044325663e-01   +4.659076928716562e-01   -4.386183125749783e-01   -6.974889786284681e-01   +5.400912110540574e-01   +4.055205765900924e-01   -1.056393087546190e-01   -1.172919008974608e-01   -8.087495895090802e-02   +4.902611692068676e-01   -8.001081545982965e-01   -2.332623384858668e-01   -2.248227344917238e-01   -3.490967139596971e-01   -4.888113114468914e-01   +6.605815570234801e-02; -1.000000000000000e+00   +3.822846808660845e-01   -2.863267705901754e-01   -5.573063999827826e-01   +7.576610529382278e-01   +8.003228880509818e-01   +5.099180527186997e-01   +3.891573238737718e-01   +5.641934334393176e-01   +7.693102525782236e-01   -4.107238107113297e-01   -5.800047370099825e-01   -3.345975746140673e-01   +3.516160550708022e-01   -7.694365655320010e-01   +3.126758756672298e-02; +4.108620418324795e-01   +6.743494489720719e-01   +4.440060924007768e-01   +1.225302854561802e-01   +8.860318250274983e-02   -1.318533486785161e-01   -6.254423585825024e-01   +3.728274650591862e-01   +1.283439520522755e-01   -3.399315342072207e-01   +1.104945315604512e-01   +1.506519656930998e-01   -6.767342209300748e-01   -3.224124957421163e-01   -3.610633895689802e-01   -1.845093625892897e-01; +1.573988233383619e-01   -4.539873372337028e-01   +7.994330544019599e-01   +5.968878843235783e-01   -7.241783868178960e-01   +3.582146184182974e-01   +1.027019606996760e-01   +4.100018771477635e-01   +2.156334738614166e-01   -4.467905621448154e-01   -6.399790535316506e-01   -5.026176288924592e-01   +2.628098642499189e-01   -6.965140682860106e-01   -6.115264363396733e-01   -2.137495056793464e-01];
L1E_L1I_iGABA_netcon = [+4.217692775859396e-01   +6.548966887989844e-01   +2.855265480454609e-01   +1.936717960731007e-01   -2.510341101728538e-01   +1.079227278767594e-01   -4.292479120910631e-01   +5.714161650295423e-01   +4.184282093537388e-01   -7.995205115491294e-01   -2.160054902220050e-01   +3.759705386343412e-01   +1.748773388910668e-02   -3.495515301384532e-01   +3.229741073840873e-01   +6.346908084577311e-01; -7.831535500718282e-01   -5.742933924460776e-02   +5.360417728371992e-01   +2.629309820279360e-01   +1.222093528816955e-01   -7.556078393503848e-01   -2.735223154928077e-01   -8.093221878948281e-02   -2.265496734041166e-01   +3.334795023552590e-01   +1.005040574567328e-03   -3.457551890223463e-01   -3.770174314330847e-01   +2.245188365586658e-01   -5.635125279106741e-01   -3.627639518959797e-01; +5.443460851749014e-01   -4.178049320789884e-02   +4.426245251383992e-01   -7.177221855539424e-01   -4.029954810434511e-01   -3.174792055889581e-01   +5.637762207394778e-01   -3.973520231482407e-03   -2.513454272145396e-01   -4.366931854674372e-01   +4.155716968509504e-01   -5.084533490484616e-01   +8.129622997948486e-01   -3.096373635445180e-01   -9.833643658770378e-01   -1.308379304043315e-01; +2.911242166556114e-02   +5.219693346936068e-01   +4.676185351257940e-01   -2.549774820581630e-01   +7.255770042066358e-01   -4.658700725669861e-01   -7.149951727767806e-01   -6.788531607179425e-01   +7.395948943434966e-01   +8.003315258744983e-01   -4.593749132702229e-01   -6.805092715742732e-01   +1.894629411977179e-01   +1.393840513876637e-01   +6.304142062431884e-01   +3.310270004617526e-01; -7.384336687019769e-02   +1.280039645257662e-02   +1.887290711940123e-01   -3.062520417705724e-01   -1.570893655570643e-01   +7.641277508809745e-01   +7.796733122758405e-01   -3.231987936657636e-01   -5.026054781039251e-01   +2.599641977021608e-01   +6.111950503367229e-01   -1.156812057118758e-01   -3.264505033022403e-01   -4.984782614021586e-01   +1.537354694352262e-01   +7.946849978155877e-02; -1.645183932412509e-01   -8.824749681178320e-01   +5.994284598225786e-01   +8.259722800618231e-01   -6.644042614493421e-01   +3.788535181353572e-01   -5.131325368459868e-01   +2.830081842724521e-01   -1.474472702784367e-01   -7.858940263435217e-01   +4.641609588594490e-01   -5.834527125917394e-01   +6.075364709962774e-02   +2.580820999870276e-02   -4.516323964428404e-01   +2.046721096005093e-01; +4.030890426359904e-02   -5.192021269490319e-01   -4.441516413816353e-01   +1.896877791514424e-01   -5.720638781568791e-01   +2.701554964531876e-01   +3.102784699770348e-01   +9.267701296924996e-01   +7.808196287424545e-01   -4.631273221746614e-02   -2.696635102183650e-01   -9.099886330921797e-01   +3.126020490683099e-01   +2.732193866293272e-01   +2.091121691690787e-01   +2.579858235738564e-01; +2.957604563834968e-01   +2.177904909807502e-01   -6.211735499739935e-01   -4.744158454260985e-01   -5.162417304890768e-01   -1.740690437754327e-01   -5.075454464888699e-01   +1.468933116822812e-01   -5.893591938173141e-01   +3.597565430404682e-01   +4.991292456729019e-01   +7.264824623341801e-02   +4.884203929274629e-01   -4.653756449631803e-01   +3.358961670528284e-01   +3.447634624017507e-01; +2.632685774709845e-02   +4.123262363881622e-01   +3.014517246933746e-01   +7.550503450653270e-01   +3.004811630233194e-01   +6.973546180540954e-01   -6.067780673356414e-01   -4.488333338966628e-03   -4.937352186664494e-01   -8.295259773973663e-01   -2.790384239012506e-01   +5.955084284426053e-01   +4.404986833591543e-02   -3.883260789229812e-01   -6.752387340570666e-02   +3.938006751239011e-01; +3.811953406063722e-01   -7.498140086841960e-01   -8.567638763608600e-01   -3.065738078564016e-01   +4.762262661853769e-01   +2.124013997849245e-01   -7.056752245938519e-02   -3.758621223155370e-01   +6.969208040938099e-01   -9.380222484974376e-01   -6.584750044019869e-02   +2.813422254774314e-01   +3.360733404291750e-01   -4.105165817337223e-01   +2.324537148696719e-01   +7.444540908692915e-01; +5.654903773027820e-02   +3.339811843644284e-01   +7.226035204754142e-01   +1.080686078836372e-01   +3.837995550551281e-01   -2.449318265898487e-01   +2.389804639357589e-01   -7.867352172434834e-01   +3.723139895431711e-01   -3.647486774711124e-01   +6.840678255095073e-01   +2.179139346549591e-01   -4.178626026420700e-02   +4.960186423463017e-01   +7.393262241916171e-01   +1.634692812461841e-01; -7.328068904690297e-01   +6.861702548370707e-01   +4.031400663100124e-01   -1.167647338109269e-01   +4.057599798307047e-01   +2.668353671899668e-01   +1.240208726208828e-01   +6.453975078111587e-01   +7.785825036864226e-01   -7.727149468549001e-02   -2.112208215559608e-01   -2.535433661310801e-01   -3.617957100820618e-01   +4.205487200227802e-01   -3.770859725332962e-01   -7.874540033932074e-01; -3.175032751373920e-01   -7.929485970325296e-01   +5.578951071238616e-01   +8.210919655682221e-01   -6.368925043516036e-02   -4.622531955506738e-01   +3.225463743626281e-01   -6.190670652872908e-01   -4.236763884028612e-02   -1.254443077876705e-01   -8.667629100172666e-01   -7.345139613984552e-01   -1.277393462601179e-01   +8.482684346539531e-01   +1.391641820848543e-01   -6.475165562070173e-01; -4.570805086286666e-01   +3.455136346521410e-01   -9.165582559131098e-01   -8.050665983105177e-01   -3.107464929021350e-01   -4.396937127036886e-01   +1.801688540934809e-01   +8.358496491633989e-01   -2.173284959914668e-01   -8.264593182097048e-01   +5.657783255400234e-03   -2.935168584449211e-01   +8.859561756178345e-01   -1.042908802688382e-01   +4.240449046129680e-01   +6.963033797160033e-01; +4.084857526792997e-01   +7.742784469682873e-01   -3.942215838855758e-01   +3.652152493134656e-01   -2.334282713241123e-01   +2.704216145471832e-02   -2.931787447065856e-02   +2.698883012034842e-01   -8.016083191934710e-02   -6.644836467133477e-01   -1.111828949238754e-01   +1.000000000000000e+00   +7.982046098975850e-01   +7.156313446923921e-01   +2.090809738723442e-01   +2.522027019846613e-01; +1.380887518381062e-01   +6.368381075068901e-01   +6.132462014849752e-01   -5.236825182501192e-01   -7.137367574095600e-01   +3.607409901472754e-01   +7.531554834311830e-01   -8.959555702105335e-01   -1.900222606410762e-01   -4.530708511626769e-01   -1.341456984181757e-02   +3.060967949376557e-01   -4.914439181697434e-01   +9.594987977081912e-01   +3.154454492573617e-01   -1.224435316051071e-01];
L2I_L1I_iGABA_netcon = [+4.407505650739718e-01   +5.040946417522129e-01   -3.463053930943678e-01   +3.304531426312783e-01   +1.938855557229457e-01   -2.839960922689166e-01   -4.251474874864254e-01   +4.306186715647815e-01; -3.822412906373293e-01   -8.152158982387100e-01   -3.882834072441240e-01   -2.168781972096497e-01   +4.928078950409883e-01   -1.113841665367250e-01   -5.151716126942278e-01   -6.226091195550096e-01; +2.141826017329869e-01   -9.851791999336865e-02   -4.418529616411899e-01   +2.475321503111254e-02   -7.118317191603650e-02   +1.000000000000000e+00   -4.258467849553103e-01   -5.321865191239107e-01; +9.686131913906848e-01   +6.468654889819286e-01   +6.655519347487752e-02   +2.695280748521237e-01   +3.415462193250611e-01   +1.707194808261083e-01   -3.756621381814960e-01   -4.821839067589445e-01; -1.663829269817985e-01   -2.289166849076243e-01   +7.955181728890910e-01   +3.476134278889911e-02   -5.437238069546362e-02   -9.418584824497526e-02   +5.268444786225432e-02   -7.456292601065612e-01; +1.977659066306891e-01   +8.371279447618978e-02   +1.565696891380443e-01   +2.988566002657476e-01   +2.897948337466395e-01   -8.724611628072834e-01   +2.174281906906078e-01   -1.289085194141827e-01; -4.201748932638320e-01   +8.029946134002791e-01   -2.310585678243351e-01   +8.221646135666574e-02   +4.098550189931863e-01   +4.460213178649569e-01   +1.879661760220607e-01   +3.922804283110686e-01; -7.098180110271801e-01   +5.893713892689114e-01   -1.786960674885591e-01   +9.295163732831365e-01   -1.554502557881738e-01   -6.072151697924473e-01   +2.483810877297886e-01   +3.928845043625320e-01; +6.979231347187953e-02   +1.652224493571895e-01   +4.492544871458444e-01   -3.661411336304651e-02   -3.852443653024184e-01   +7.160338625650758e-01   -2.270104946367922e-01   -5.166500044826159e-01; -2.810216499014108e-01   -7.603777853323826e-01   -2.518028439555720e-01   +3.936272220788798e-01   -1.955157253594892e-02   +3.242599855633275e-01   -3.521952019210091e-02   +2.749940901458628e-01; +4.242131133180865e-01   -6.297020372971048e-01   +2.867024095417120e-01   -2.370012291132209e-01   +1.623033536447755e-01   +4.062847030201409e-01   -4.496828498600542e-01   -8.872108320833817e-01; +2.372653526518096e-01   -4.369134223156024e-01   -2.513518980381416e-01   -6.907224887159961e-01   -6.367565737531592e-01   +2.223659612066243e-01   -7.359365138001815e-01   +6.328092337504039e-01; +6.634684973320508e-03   -2.643174821281237e-01   -2.341179648286867e-02   -3.144432418704768e-01   -3.064939074821861e-01   +2.010492459728457e-01   -7.549305760136220e-01   +5.124703336557002e-01; -4.969741302953740e-01   -2.947822163718431e-02   -6.016280265192211e-01   +7.715250344112121e-01   -2.588112875843604e-01   -5.188033910194229e-01   +1.264593375623364e-01   +2.594826938998049e-01; +3.716054760934172e-01   +1.412516436085753e-01   +2.586157618339959e-01   -6.961989051454792e-01   +1.086282181226605e-01   +3.637386697217349e-02   -1.866580954931220e-01   +4.366266728277922e-01; -6.694741536728381e-01   -5.917392784646744e-01   -4.284680503329148e-01   -7.613557328668910e-01   -1.899014351809014e-03   -2.734906237626099e-01   +6.116469152811409e-01   +1.098483952643945e-01];
L1I_L2I_iGABA_netcon = [-4.649132858345583e-01   +4.972191224439532e-01   -1.435069299765316e-01   -8.408490277704461e-01   +7.468640603430672e-02   -5.565593012917016e-01   +4.911958326762200e-01   -6.124103012215721e-01   -7.785560867914101e-01   +7.818731048222183e-02   +2.274846055160367e-01   +5.261501431436145e-01   -2.335335484736309e-01   -9.471878361932833e-02   -1.902240313801368e-01   -3.129184528789585e-01; +4.141648643713755e-01   -1.008107296333610e-02   -3.976581773771127e-01   +5.885970608479737e-01   +5.641155644235836e-02   +6.494467400681891e-02   -6.107216196856621e-02   -3.340000919249410e-01   -5.217627736687209e-01   -7.233650110320302e-01   -4.889180090703953e-01   +2.555841427236412e-01   +9.936326549537770e-03   -3.616456187865367e-01   +2.618433818250786e-01   +1.533361247358559e-01; +8.034071137204369e-01   -5.794315215152552e-01   +6.127021241519706e-01   -3.580678407549823e-01   -2.506773744014347e-01   -6.930065348606443e-01   -3.296132057378669e-01   -6.371047118920730e-01   +2.098201278419429e-01   +2.894774615617055e-01   +9.299426464522187e-02   -2.875514582656186e-01   +1.065419352924117e-01   -3.159494949440072e-01   +3.217733301569984e-01   +3.269895808913865e-01; -5.128820428942842e-01   -1.449661760036706e-01   -1.134732499612014e-01   +4.912907173693878e-02   +4.169893943438514e-01   +3.080288576398060e-01   -5.136503010219491e-01   -2.881910572942750e-01   +2.983219037020358e-01   -2.272000885452584e-01   +6.500964301856742e-01   +7.374999903226682e-01   +8.174849957286899e-02   +5.185661817134098e-01   -5.627336064338526e-01   +3.219927760618425e-01; -5.276884058496024e-02   -4.135476096711913e-01   +8.150626762277962e-01   -1.414915803000363e-02   +1.000000000000000e+00   +5.066625592183297e-01   +4.534670845909203e-02   +5.907745765922062e-01   +2.718872361715807e-01   -4.604719870928586e-03   +2.986533497057316e-01   +3.694975753464831e-02   -4.657770606596953e-01   +3.074421636172183e-01   +3.618761545255764e-01   +8.976293881491958e-01; -2.178869219974649e-01   -6.898064757691172e-01   -4.963762255977864e-01   +6.481851736404823e-01   -2.285237748282050e-01   +6.809851346943716e-01   +5.330018759307519e-01   +3.301428131733468e-02   +2.377226024210478e-01   -3.936434835322520e-01   -6.287520191073847e-01   -4.652507043236034e-01   -1.564187808023707e-01   +8.493161692378136e-02   +6.648378378514449e-01   -4.454153351218014e-01; +3.931456728113185e-01   +2.456097520207667e-02   +3.270115602004130e-01   -1.669179564396307e-02   -1.519241061624361e-01   -5.608447490287832e-02   +4.985088422828286e-02   -4.745448065219719e-01   +4.822751269459390e-01   -3.928634265456373e-01   +1.547570265355231e-02   -3.129064367542435e-01   +2.468008020112947e-01   +4.141099386579558e-03   -1.554646314544538e-01   -3.910853150383611e-01; +8.484928649681257e-02   -1.030523062932375e-01   +3.448960536125422e-01   +6.362332115635425e-02   +9.708559492506816e-02   +4.624744493749647e-01   +2.613747226384407e-01   +3.909350410512873e-01   -3.161248166905926e-01   -1.522705071664685e-01   -2.453071161919828e-02   +3.099182159671682e-01   -5.413817651546396e-01   +2.065393881529717e-01   +4.509559151105739e-01   -1.698565362026760e-01];
L2E_L1E_iAMPA_netcon = [-3.905753875626052e-01   +3.380605400890788e-01   +2.399486027257299e-01   -3.656524890047441e-01   +2.906966025135737e-01   +5.787709140180215e-01   -1.092831644186139e-01   +1.053896946042616e-01; -1.970302845003536e-01   -3.591034126604958e-01   -3.839311831414709e-01   +2.408086216618529e-01   -4.543629083564875e-01   +3.328962693077142e-02   +6.754103253380274e-03   -2.682057283922430e-01; -5.373487950705267e-01   +2.209642439474292e-01   +5.821597197872236e-01   +5.898250306425840e-01   +8.017838665079625e-01   -2.308754145761354e-01   -5.186310621223592e-01   -3.327046422433433e-01; -7.552656545669993e-01   -2.374869547173237e-01   +2.328055535551048e-01   +7.607755162863004e-01   +6.637012995427979e-01   -7.678282557703037e-01   -8.744972445876935e-01   -2.836296684289060e-01; -5.278681561106657e-01   -7.038682382107687e-01   -2.477804343210160e-01   -3.691052806129090e-01   -5.154880889612167e-01   -1.134731138690173e-01   -3.281114500263634e-01   -5.789805603970110e-01; +3.624126984439168e-01   -3.794267893943261e-01   +1.824762466241591e-01   +6.888786653701998e-01   -1.155975927193972e-01   +6.378060011688169e-02   +2.410088877664589e-02   +3.546203811703887e-01; +3.627155116873886e-01   +5.813272947800191e-01   -4.315091304130674e-01   -3.249969280378923e-02   -8.946729159220281e-02   +6.909244335006287e-01   -3.055157606457456e-01   +8.797263095979704e-02; -3.516052609065269e-01   -4.608877714660056e-01   -3.869868801766993e-01   +2.225973289116715e-01   -7.721123193534166e-02   +1.971551850051963e-01   +1.832963639660119e-01   +6.752996825363918e-01; -4.930999631520147e-01   -1.715415229246007e-01   +3.162260303939074e-01   -6.638599160182586e-01   +5.426109008045265e-01   -1.000000000000000e+00   +5.518517811766920e-01   -2.227910540821764e-01; +7.750987111107310e-01   -2.945719904021527e-01   -7.651884850297899e-01   +2.696365086597242e-01   -6.603431701227966e-01   +7.197879625305525e-02   -3.498441170963620e-01   +2.957121230500694e-01; -3.794033834352608e-01   -8.673468401658947e-01   -2.182471586776658e-01   -1.001977133133244e-01   +6.039365742836145e-01   +1.952171607166729e-01   -3.041589528191496e-01   +6.669372833661632e-01; -6.489046668255287e-01   +4.647146928101827e-01   +4.274256886026259e-01   -5.963624433752840e-01   -5.248356871680110e-01   +8.746088652142204e-01   +4.934314449761308e-01   +4.665087075067913e-01; -1.078873613033824e-01   +6.629801388055180e-01   +1.606538941073597e-02   -1.811284341146250e-01   +4.130819489423556e-01   +2.465074984711851e-01   -6.192135672750561e-01   -4.310482346063300e-01; -8.414702650643610e-02   +2.500511902912783e-02   +8.308565448871882e-01   +5.136566399843311e-01   +1.897836511448352e-01   -6.775777429605954e-01   +5.644576066127675e-02   +5.167567884604504e-01; +1.590065044027815e-01   -8.313537668440462e-01   -7.310621854503596e-01   -7.073488345522004e-02   +3.852796375992093e-01   +1.667480192898652e-02   +4.409825477942468e-02   -2.766199324359914e-02; +4.171191391186356e-01   -1.727899448163741e-01   -2.944381770722298e-01   -8.613112064099498e-02   +2.792322924324443e-01   -1.037632728464604e-01   +4.207020175010963e-01   -2.443164023016497e-01];
L1E_L2E_iAMPA_netcon = [+4.551917063692359e-01   +3.387178396840829e-01   -3.182526909040195e-01   +4.731845352591191e-02   -1.566393888801211e-02   -6.021554431503144e-01   -1.644204653909698e-02   -5.436879580831823e-01   +9.709758872568858e-02   +5.075397876494638e-01   +2.379011360444300e-01   -1.762948667423435e-01   -5.178939272733282e-02   -8.281617448395073e-01   +1.346211137416602e-02   -3.166753377986254e-01; -4.041961506181889e-01   -5.455342694153559e-01   -4.506767979346010e-01   +5.884906979875274e-01   -5.565161824627169e-01   -7.408891074870146e-01   +1.145952386672652e-01   -7.033502207315084e-01   +3.981984331953720e-01   +3.609966632630736e-01   -7.463737290102455e-01   +2.928572135320551e-01   +1.335373095378069e-01   +1.246918509658035e-01   -2.352949569653480e-01   -2.517159238906224e-01; -2.304252697649393e-01   -7.102809592394491e-01   -3.160161418894549e-01   +4.516809356450152e-01   -6.251746449800138e-01   -5.098330773860059e-01   +3.226097735599371e-02   +8.608383544366638e-02   -3.142958944174050e-01   -2.636364019731456e-02   -3.921297577113580e-01   -5.719250891170057e-01   -6.862158546672492e-01   -2.603082450126443e-01   -4.426740409838135e-01   +4.241786902561048e-01; +3.483983862411928e-01   +5.995800384568688e-01   -9.131952228965577e-01   -7.727395318678748e-01   -9.131692808116990e-01   -5.334333511535945e-01   -1.795711589452457e-01   +3.184358669099008e-01   +6.702193597092744e-01   +3.818549666299018e-01   +5.764361681708201e-01   -5.226230787439416e-01   +3.558766661121651e-01   -5.133149041014804e-01   -4.814894861525632e-01   -4.011172935831148e-01; +3.450882981104027e-01   -7.706422685696639e-02   +6.777335862427879e-01   -7.452954673882171e-01   -6.847712511121408e-01   -3.264817175945909e-01   -5.302186199322634e-01   -4.493258064862009e-01   +3.649688214274637e-01   +4.890605847820247e-01   -5.543189127241233e-01   +3.438631973435305e-01   -1.856588297489912e-01   -4.764093821377851e-01   -1.613415900268123e-01   -6.060205420241146e-01; -7.705199512387519e-01   +6.074289327787030e-01   -2.331708090956882e-01   +4.595018519240592e-01   +8.567413731348185e-01   -3.490954935270474e-02   -2.019302918754168e-01   +6.141452385648483e-01   +1.678728365314759e-01   +9.856107185960311e-02   +1.000000000000000e+00   -2.346741259449141e-01   +1.747913439497050e-02   -4.533244123235287e-01   -5.182019791949527e-01   +1.664142564134392e-01; +1.902124761599911e-01   -2.458769554979433e-01   -3.537334217340098e-01   +5.878785502208373e-01   -5.175202926844591e-01   +1.109447188280848e-01   -5.220241946351563e-01   +8.002508530670820e-01   -8.360127139119859e-01   +3.632707216914668e-01   +3.959503577616073e-01   +3.024477270241717e-01   -6.275381016193855e-01   +5.299720730618334e-01   -3.833027333992641e-01   +6.117149503591451e-01; -6.287306542482453e-01   +4.417278152173455e-01   +7.730639953370831e-01   -4.317225451188952e-01   -5.851015189512665e-01   -1.016587001775808e-01   -6.784549160971497e-02   -3.453839879641572e-01   -5.709762926058389e-01   +1.940314956120726e-02   +4.749174470807079e-01   +2.062440336447156e-01   +8.521913008306564e-02   +3.145128959208740e-01   +4.023196588738731e-01   -6.453145987849462e-01];
L2I_L2E_iAMPA_netcon = [+7.025974639333066e-01   +4.006636756911544e-01   +2.035916024011589e-01   -4.763905000587340e-01   -3.309776636491654e-01   +1.739306934005936e-02   -1.347995139795526e-01   +5.312875128463344e-01; +1.670688291211544e-01   +3.891834904032538e-01   +1.480534657835475e-01   +7.118517654049129e-02   -9.395101437794890e-01   +6.855124496303948e-02   +2.480464075023537e-01   -5.063401261539525e-01; -2.955872494066268e-01   -5.514672476967487e-01   +1.696788559848087e-01   -1.591256194920481e-01   +1.039706007975455e-01   +3.216594701279087e-01   -9.713930555784759e-01   +8.371227649066633e-01; +4.756298536760222e-01   +6.112441521330001e-01   -4.961249516288881e-01   -7.626706920807945e-01   +6.066864853549393e-01   -1.937726490656210e-01   +4.615671349760342e-01   -2.876673742224400e-01; +3.594255602387994e-01   -2.304048766175826e-01   -3.681636105554814e-01   -8.891468089421547e-01   -5.621551189532989e-01   -1.000000000000000e+00   +2.828366232341647e-01   +6.599711995553552e-01; +3.233616491375652e-01   -2.687958813393499e-01   -3.717205796951418e-01   -7.898520281539155e-01   +5.265709491298808e-01   +4.500381283401692e-02   -2.171411173813662e-01   +9.941534146875387e-02; +2.931252173139012e-01   -7.308613954376049e-01   -1.191925132477080e-01   +4.690769441507988e-01   -5.349054211334310e-02   +6.737750565077564e-01   -6.015968152516238e-01   -1.835693436906516e-01; +2.390875558628077e-02   -1.943011392840835e-01   -5.801007136489748e-01   -4.891561323695567e-01   -1.175378384837666e-01   +4.353794106096291e-01   -9.979247841175426e-01   +3.867522011410590e-01];
L2E_L2I_iGABA_netcon = [+5.832748398087699e-01   -4.568489373074182e-01   -6.210966822787266e-01   -9.746998339184647e-01   -2.795412376072408e-01   +1.264663581956111e-01   -5.688174592805422e-01   +7.337657116171900e-01; +3.443677097306277e-01   -9.380005371790570e-01   -2.517092292681196e-01   -2.072948020867669e-01   -5.385813715001638e-01   -2.201865323578924e-01   +7.679561292537784e-01   +5.194244173196378e-02; +3.088123881758500e-01   -5.306589214098526e-01   +7.572404486439456e-01   +3.496464007350789e-01   -4.480967794270564e-01   -5.877103898866238e-01   -1.757287763917076e-01   -2.871415323395810e-01; -1.023976155966608e-01   -5.255631334640108e-01   -3.952609909477988e-01   +3.412863353783368e-01   -2.729092923122004e-01   +2.823830122103683e-01   +1.595640910172281e-01   -8.413109173555735e-01; +7.830971261845808e-01   +3.238617343330574e-01   +2.434383058043741e-01   +2.807481392626177e-01   +8.016859957730664e-01   -5.918166678775675e-01   +2.767824173601062e-01   +2.183018090118060e-02; -2.829053018001332e-01   +5.462916005279140e-01   +4.212369092673511e-01   +5.148844493099258e-01   +2.637850719938686e-01   +3.249971707242604e-01   +2.994031723222458e-02   +2.153524380023611e-01; -1.678443942328567e-01   +9.592460002075207e-03   -6.742667367568006e-01   -4.355376038737293e-01   -4.198800530699148e-01   +1.000000000000000e+00   +5.624806918570998e-01   -7.957450800455580e-01; +9.401661007201413e-01   +2.373249038463216e-01   +5.029259449680952e-01   -2.313359389823816e-02   +6.519041474868332e-01   -5.859516316706794e-01   +2.146437473571532e-01   +3.047267413991565e-01];
L3E_L2E_iAMPA_netcon = [+6.655983523007890e-01   -3.948155687400248e-01   +1.945019870406449e-01   +4.746360351836256e-01   +3.234412232863384e-02   +2.076041105876895e-01   +2.556167001540373e-01   +4.480730745022007e-01   -1.400975021154294e-02   +7.444810167666880e-01   -4.191749271946721e-01   +8.170752518487409e-01; -4.092878698759941e-01   -2.516540523825367e-01   -6.627006514696328e-01   +1.592953228564057e-01   +4.437086795125803e-01   -2.673010047787373e-01   +4.900645161525393e-01   +2.323202499153075e-01   -9.416437763934125e-01   +8.299779890223101e-01   -8.251130089914271e-01   +2.755752250323952e-01; +4.502975099385511e-01   +3.115142698013654e-01   -6.450426407111010e-01   -6.289790822652984e-01   -5.187354885380745e-01   -1.119699408937912e-01   +5.725295250808560e-01   -3.591723474321667e-01   -2.285475131867459e-01   +4.681744865019777e-01   +4.237848270977551e-01   +9.992977033176121e-01; -9.206371953473393e-01   -4.383780199624850e-01   -6.882153017506980e-01   -7.214158960934682e-01   +5.113144576026671e-01   +4.149638656104945e-01   +1.000000000000000e+00   +6.478110576804836e-01   +8.103992881109188e-01   -4.128135778086547e-01   +7.812827427350931e-01   -5.982680423636870e-02; +9.605242968127474e-02   -2.187737635610217e-01   -4.178518050546289e-01   -2.691712256304223e-01   -4.550427367058455e-02   +5.017846912146935e-01   -3.210842811052186e-01   +3.547541218823795e-01   -3.796834119810147e-01   -4.767344317786302e-02   -1.817913012934617e-02   -1.193142847831890e-01; +4.676780437288744e-01   -8.351411162930670e-01   -4.585652782565625e-01   -1.598601442836300e-01   +2.174060896740086e-01   +6.533126621391038e-01   +8.931909245697830e-01   +4.838674395163948e-01   +8.265465361579328e-01   +1.607346542289267e-01   +3.670500810476190e-01   -2.775233621175147e-02; -5.793336573720745e-01   -3.822779659395703e-01   -2.438982218423211e-01   +1.186799045965615e-01   -4.078732414687493e-01   +3.544046909952602e-01   +1.217297811692811e-01   -5.163123864879613e-01   -1.115538886617815e-01   -6.380018666571731e-01   +6.805185374530227e-01   +1.368838816148713e-01; -1.006172662826975e-01   +2.368970339822141e-01   +5.893991060254895e-01   -2.915405441151822e-01   +3.014765645015094e-01   -3.645472663228482e-01   +6.098086901087771e-01   +6.399048762679814e-02   +5.620453414793191e-01   +2.475415631375680e-01   +2.290019799314170e-01   +8.049625237171126e-01];
L3I_L2I_iGABA_netcon = [+5.441435040544159e-01   +1.000000000000000e+00   -3.868482288672919e-01   +2.664397590763056e-02   -4.430979061643946e-01   +3.052406274243228e-01   +2.676075139168833e-01   +1.290109895632012e-01   +2.697658239515573e-01   -3.364021141686441e-01   +4.348017475792270e-01   +7.879110830624102e-01; +5.455958627104993e-01   -2.138915511484045e-01   -4.824417537492681e-01   +4.017933568949490e-01   +4.051358166779397e-01   -4.628013377690998e-01   +1.512447240299587e-01   -1.620972962395929e-01   -2.138759806181186e-02   +6.304841610615587e-01   -5.326980030929872e-01   -9.821892876340578e-02; +2.692891499992106e-01   +6.975560364052693e-03   -8.502734144311004e-01   -4.369347810566159e-01   +2.335363312758140e-01   -8.719779171682988e-02   +5.219575576851876e-01   -6.564720291706679e-01   -6.323026005087654e-01   -2.271598255421652e-01   +6.019758975572244e-01   -7.506125934442490e-02; +7.859874198573523e-01   -3.024127077205485e-01   +4.593110820773064e-01   +5.313942693794218e-01   +3.506830463010478e-02   +5.903714320746576e-01   +4.936617797705535e-01   -5.960408507114196e-02   +3.056604806416189e-01   +8.722040175432401e-02   -2.195738447047048e-01   -2.447570119885612e-01; -4.462744704867342e-01   +6.660100664170068e-02   -4.469942830172295e-01   +2.558302451178033e-01   -2.138556122030336e-01   +4.673755957597562e-01   +1.736270038648427e-01   +1.590140316507980e-01   +2.115832432869482e-01   -9.731412601263921e-02   +1.657842991564805e-02   +5.388862281289639e-02; +6.826355550231665e-01   -9.454074650631396e-02   -2.046142966358169e-01   +2.902579876668999e-01   -6.875883509362927e-01   +2.154493821596903e-02   -3.098817079469836e-02   +2.112606882948861e-02   -7.810631924571562e-02   -1.234349023182493e-01   -1.685956887402103e-01   +5.768927374021293e-02; +6.670328703508254e-01   +1.336846147168165e-01   -2.072328018448203e-02   +3.221533640242512e-01   +5.189483813346631e-01   +1.758428818499282e-02   -1.542098649850922e-02   +1.299900721715836e-01   +3.118848277250741e-01   +6.516186512614612e-01   +8.476461120060748e-01   -3.529973515922779e-01; +4.373932714139412e-01   -7.506647057581402e-02   -5.303099416923086e-01   -1.679026946101569e-02   -4.910505230065083e-02   +7.275030372982160e-01   -6.847725487013558e-01   -4.294313387014680e-02   +3.767946947977358e-01   +3.899669791436398e-01   +2.956487851357826e-01   +5.705044692584901e-01];
L2E_L3E_iAMPA_netcon = [-5.653163048321387e-01   +2.574497385301218e-01   -5.251713788776427e-02   +6.283023703137927e-01   +8.084043452111665e-02   +4.728136279192216e-01   -4.761543678550783e-01   -1.989658182041134e-01; +6.404532425927476e-01   +1.305360662328927e-02   -5.550923734949010e-01   +1.413808820945322e-01   +1.188046861699102e-01   +1.742799838701974e-01   +2.215979703455939e-01   +2.708707982089850e-01; -6.860620639462995e-01   -1.022761323385826e-01   +1.601271836879440e-01   -4.887976843857086e-01   -2.033916607336123e-02   +6.899477920113039e-01   +5.054270516064627e-01   -8.679841794946161e-02; -3.273270276237950e-01   +5.370576751538417e-02   +4.520472827676528e-01   -4.191834524003948e-01   -5.723530312260429e-01   -4.712395186147207e-01   -3.295976449264632e-01   -1.488511397968447e-01; -2.773564441630683e-01   -1.079947284351511e-01   -4.928682652387313e-01   +5.963227759638003e-01   -6.486766359347202e-01   -3.769848041577041e-01   -6.224877883852167e-02   +1.044109070434085e-01; +7.886460670026086e-01   +2.411316856256966e-01   -3.919511550796981e-01   -7.977428388570421e-04   -5.570725644040015e-01   +2.295791829446016e-01   -7.470831129128456e-01   -1.651079064159378e-02; +1.833572147447783e-01   -2.668237332599935e-01   +9.234891860085086e-01   -1.035049649551108e-01   +2.933553390093097e-01   +5.039310025279490e-01   -6.511602918297220e-01   -5.164423058024321e-01; -8.079834573852268e-02   -4.492042296100134e-02   +5.211877654055342e-01   -5.366432624641275e-01   -2.572246386279630e-01   -2.173705460033499e-01   -3.842867783229865e-01   +2.601628861134285e-02; +3.256540925725556e-01   +6.326053446827520e-01   +1.129345372151486e-01   +4.165235283785007e-01   +8.136262701248896e-01   +1.446536667579540e-01   +7.183769138811311e-01   -5.329381370546887e-01; -4.864520392562111e-01   +2.417670198690231e-01   -4.501778123471810e-01   +8.842851662837418e-01   +1.000000000000000e+00   +6.645789863482877e-01   +3.883336709397197e-01   +6.687647020474548e-02; -4.142445987718745e-02   +6.813854771757042e-01   +4.235159104679776e-02   -2.108025695116412e-01   +4.417581164775124e-02   +4.692847658600531e-01   +6.347836084329076e-01   -3.682390114730588e-01; -2.186570175788139e-01   +7.385784013443696e-01   +5.772830357322880e-01   +6.177792803987698e-02   +9.419391555508716e-01   -5.746376493961872e-02   +1.587553254051274e-01   +5.460885774932575e-01];
L2I_L3I_iGABA_netcon = [+4.405658587623824e-01   +9.553655044815766e-02   +8.742260071463656e-01   -7.674589874921416e-03   -6.895947850889796e-01   -1.671991527559202e-01   -3.609145456885308e-01   +5.801803281048360e-01; +5.542807060302931e-01   -3.357691955198150e-01   +4.243441779187678e-01   +4.366831666666546e-01   -5.870938706854244e-01   +6.403005003017340e-03   -3.880419859219997e-01   -1.867611008795445e-01; +2.148519014418727e-01   +8.991081561159657e-01   -9.850484199386127e-01   +5.155304129274627e-02   +3.556956283829583e-02   -2.987130885541214e-01   -3.727382134660142e-01   +1.909118651469730e-01; +9.388418656766899e-01   +6.277815776609729e-01   -1.562957989517718e-01   -6.759724537343401e-01   +3.740400319643276e-01   -7.808881516339031e-01   -3.023103582500711e-02   -4.877351734093699e-01; -7.349433597908563e-01   -9.325952242576818e-01   -2.085265834784896e-01   -7.470811922882935e-02   +2.626956980810864e-01   +2.793468345125825e-01   -1.208758358868935e-01   +8.186941172083040e-01; -9.571343974758940e-01   +2.229911590623892e-02   +6.421665980751944e-01   -8.134910788795627e-01   +6.272487064557789e-01   +2.559803871833388e-01   +2.056298977095479e-01   -1.404922632705582e-01; -3.666377949990294e-01   +9.334854266774684e-01   +3.254904964124685e-01   -2.239394359651994e-01   -3.070408454290500e-01   +7.446989887189896e-02   -7.961064261983383e-01   -1.000000000000000e+00; +3.036749499828705e-01   -8.368454457562424e-01   +3.688757649360874e-02   -2.561726910244712e-01   -2.126735214642353e-01   +1.603658699427387e-01   +2.255954698589745e-01   -4.165410718968161e-01; -2.276870473452786e-01   -7.945814252436887e-01   +7.181089187102245e-01   -7.003764408423842e-01   +5.617150421883282e-01   -9.588386533174862e-01   +8.555290048705820e-01   -2.757088662907682e-01; -3.450601059137508e-01   -1.024233028853169e-01   -2.020691977301757e-01   +6.414618116469013e-01   -7.368364508922846e-01   +8.357726587535390e-01   -3.509265174237497e-01   -4.433760920675683e-01; +1.187992356663220e-02   +9.715140534365868e-01   -1.221227235435848e-01   +2.329014911481951e-01   -7.197133290712459e-01   -1.126448068562340e-01   -5.300533483363329e-02   +4.242617980589857e-01; -5.657824656536049e-01   -5.680210252601882e-01   +2.033948484917854e-01   -8.373391072187742e-01   -3.313004246096055e-01   +2.767380454937315e-01   +3.739235621939865e-01   -8.458643525227442e-01];
L3I_L3E_iAMPA_netcon = [-3.580185956579114e-01   +4.670315306367018e-01   -1.689570631881440e-02   -3.019158684566480e-01   +4.006906055219630e-01   +4.591879766969785e-01   +2.293630340909415e-01   -6.329975851705691e-01   -5.307259461468333e-01   -5.237669997943384e-01   -3.236766654111450e-01   -2.839725435941179e-01; +5.904097998446679e-01   -3.021964239758064e-01   -8.608055592719919e-01   -2.411584698687440e-01   -1.421617372520293e-01   +3.693731976201065e-01   -1.394551412106254e-01   -1.328744624501997e-01   +4.108336709070349e-01   -6.142779797543434e-01   +4.311497821513704e-01   -1.694743542598695e-02; -7.055668733056262e-01   +7.060180456055795e-01   -4.506589565189532e-01   +4.565730273240941e-01   -4.662537550858082e-01   -3.099804638668918e-02   -1.709783689567394e-01   +1.768768842980663e-01   +7.954528376717680e-02   +2.910247884700255e-02   -3.462632392530834e-01   -6.125571157288114e-01; -6.531356517515536e-01   +1.210714429403756e-01   +1.645532049605131e-01   -3.950093347616040e-02   +3.973260145064073e-01   +1.000000000000000e+00   -1.583288261651180e-01   +1.628020811088708e-01   +7.021509940258633e-01   +6.900937948411574e-01   -2.775402568618910e-01   +7.195942343209064e-02; +1.290724086101963e-01   +9.177766265447069e-01   +5.697314102720746e-01   -2.126137408290419e-01   -1.769626345780699e-01   -3.804773163908176e-01   -6.609345140485943e-01   -1.952239764998419e-01   +9.588214044373602e-01   -3.105448834526685e-01   +9.326158512636755e-03   +4.864445983610938e-01; -2.216928809330659e-01   -2.195104758801474e-01   +5.649063136308333e-01   -1.867337635677864e-01   +5.113583874970571e-01   -7.168413430861705e-01   -6.604039282690650e-02   +4.377386664964357e-01   -4.218549331659644e-01   -3.548407822664991e-01   -9.979195584290967e-02   -4.056783310564792e-01; -9.642993250139222e-02   -2.464284350048430e-01   -1.750062946291062e-01   -1.029281910413963e-01   -1.172180115199420e-01   -8.045693199846747e-02   +1.627243089479563e-01   -1.198570430161249e-01   -3.469122036618880e-02   -3.253358740410141e-01   +2.479565692173101e-01   +1.204228828484834e-01; -1.952647718620121e-01   +5.859755443395344e-01   +1.685922295791084e-01   +5.519406515777574e-02   -2.278220069091544e-01   +3.413086741845067e-01   -3.390428934127327e-01   -3.414982952206795e-01   +1.068245055150487e-01   -1.706065569241279e-01   +1.084021143808807e-01   -5.404425264824666e-04; -1.299812220799566e-01   -5.456573044575954e-01   +6.767904688814783e-01   +1.200724177767399e-01   -5.896415787793371e-02   +2.680261475101445e-01   -7.839331171889041e-01   +7.577104239716488e-01   +9.559680966428473e-01   +3.677861313301384e-01   +7.544717775208427e-01   -3.765758338116925e-01; -1.028166251780667e-01   +5.172176746027657e-01   +9.396287165623507e-01   +7.609179823879536e-02   -4.289270992438002e-01   -5.320069642165784e-01   +9.927530055486164e-02   -1.581980587854283e-01   +1.030327050233265e-01   +4.254530902723066e-02   +3.543691451222094e-01   -4.073013820079437e-02; -5.978640711086079e-02   +2.491660533125024e-01   -2.269410842969448e-01   +2.768179499227333e-01   -3.889439535082680e-01   -5.020310970768506e-02   +5.085061226023779e-01   -5.423524026586237e-01   +5.435741101049715e-01   -8.046700492496103e-01   +2.194695090056283e-01   -6.843197240980704e-01; -1.873846677335133e-01   +9.251298295514578e-01   +4.211355002762519e-01   -1.838277925634018e-01   -3.475526343155148e-01   -1.506717492196605e-01   -1.924497144194821e-01   -3.412720578073453e-01   +5.309395407377069e-01   +6.651965867088424e-01   -2.330893338945227e-01   +3.577940325629896e-01];
L3E_L3I_iGABA_netcon = [-2.450594587088100e-01   +3.351431066689330e-01   -3.336923884672274e-01   +6.882022176316689e-02   -1.107935180785549e-01   -3.729684790925608e-02   -4.098623920894084e-01   -7.310080578068293e-01   -1.738839751897867e-01   -2.424633683033723e-01   -6.257529041871094e-01   +4.482047358154632e-01; +4.010655891509508e-01   -6.250153663094950e-02   +2.834336031411810e-01   +1.153027056160494e-01   -2.908682264221970e-02   +4.545877694364921e-02   -5.840334487888021e-01   +2.283960583190606e-01   -7.906773696634458e-01   -2.773772911860276e-01   -1.199047818394915e-01   +4.271270659498890e-01; -4.664767484676619e-01   +3.778837561782418e-01   +1.427442629697412e-01   +3.950869896049415e-01   +1.532937362751115e-01   +3.551555730718538e-01   +8.263115891204627e-02   +1.836396353698759e-01   -4.735116709906146e-01   +4.149029790340438e-01   +4.490990092754646e-01   -2.822501282205537e-01; -6.331878169133966e-04   +7.873237907158408e-02   +8.145874966794696e-02   -4.487783705121371e-01   -4.633336128115842e-01   -8.050815089135105e-01   +2.677110933151940e-01   -5.669333417610763e-02   -3.130713347640403e-01   +4.414714993387472e-01   -5.233797645431649e-01   +2.624683449429459e-01; +3.696567877402320e-01   +2.747637908481363e-01   -1.202240466061595e-01   +1.618406033832168e-01   -5.146070207821923e-01   +2.904188840296854e-01   +3.511289440474571e-01   -4.815854546225030e-01   -3.779427151637887e-01   -2.850273806710321e-01   -7.602661582940549e-02   -2.169741906972945e-01; +5.859026608418616e-01   +2.833330141848527e-01   +1.900362976784854e-01   +5.987860230247243e-01   -2.009253587847447e-01   -1.802313247946949e-01   -3.701436559153912e-01   -5.235151626514124e-01   -9.839970458421259e-02   +2.599919415947954e-01   -2.546505529082125e-01   -4.879009010253771e-01; +1.717132164731222e-02   -4.341471898167458e-01   +6.253449344629670e-01   +1.000000000000000e+00   -5.082172829099297e-01   +1.347089572299677e-01   +2.065959955632085e-01   +8.205591223469411e-02   +6.191356836337583e-01   -4.376532981999990e-01   -4.415869750410592e-02   +4.836190965003009e-01; +4.490810830385904e-01   +4.916180258678121e-01   +2.816789697635293e-02   -4.171596431407991e-01   -3.823975424995833e-01   -3.955752735459840e-01   +3.677413064852783e-01   -8.263798914309992e-02   +6.737755935594560e-01   -7.890890146045274e-01   -4.107123353517435e-01   -2.220425330976255e-01; +2.259290003529709e-01   -2.980799461184602e-01   +6.090346860104741e-01   +3.368221991461234e-01   -6.637878190585701e-01   +5.709455194577466e-01   +7.293084705235213e-01   +6.927227676929435e-01   -4.568865987342465e-01   +6.851795458152313e-01   +1.995106292085889e-02   -5.258804035660634e-01; -4.564300686840617e-01   -4.262104982918734e-01   +2.099306222995905e-01   -1.568398496684790e-01   +5.801844731958054e-01   +6.184684945985862e-02   -3.491846201773453e-01   -2.899344683648621e-01   -1.643485708266232e-01   -7.479453407120024e-01   +4.281051078493308e-01   +8.602990131218041e-02; +5.745635420776856e-01   -1.494496372007134e-01   +8.220115002159868e-02   +4.946926258724014e-01   -3.753964781679269e-01   -5.901481912811233e-01   -2.623169062847316e-01   -1.686839119135200e-01   -3.090081266112893e-01   +8.397617061058394e-01   -8.143047137732419e-01   -2.124479442839528e-01; +2.602192386438984e-01   -2.090298780996777e-02   -5.385364024988002e-01   +1.665471455435136e-01   +5.593936163299692e-01   -2.345303051633314e-01   -6.755919428516635e-01   +3.053626033202119e-01   -3.457416418654774e-01   -4.911283573827333e-01   +9.580913034567436e-01   +6.431785071805453e-02];
L2E_Input1_iAMPA_netcon = [+8.851798023043558e-01   -9.824343277401626e-01   -5.731539881636645e-01   +3.687047256014129e-01   +2.608638441078635e-01   -3.968787563943362e-01   +2.104289747031128e-01   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+9.363819516965464e-01   +8.715954713502514e-01   -5.624745506199000e-01   -2.920251285307637e-01   +3.238979592127294e-01   -6.125307839592922e-01   +5.809265464125191e-03   +4.374704365927888e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
