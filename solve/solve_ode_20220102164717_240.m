function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.376256358824196e-02   +2.526863232472534e-01   +4.411314486684866e-01   +3.343502386535087e-01   +3.003642184531085e-01   +4.676972274776566e-01   +2.383879767810710e-01   +8.703036863826097e-02   +9.803136325823807e-02   +2.154999505171611e-01   +2.742329611192963e-01   +8.976323432978565e-02   +1.888530362545372e-01   +3.163830550000223e-01   +2.119975560251537e-01   +3.545744112233106e-02; +1.771260119095240e-01   +6.603209478583926e-03   +2.505834989325026e-01   +3.021407134240305e-01   +1.353538538439505e-01   +1.557751156277981e-01   +4.364659419785746e-01   +4.755660000926724e-01   +3.290816287104653e-01   +9.514827850818822e-02   +4.727102821868144e-01   +1.064528267083816e-01   +9.632248439893842e-02   +1.431340795944578e-02   +2.540815953075323e-01   +1.656044086087789e-02; +3.193504611525844e-01   +3.408264696677145e-01   +4.065823939905310e-01   +2.269736990200489e-01   +5.512355941216885e-02   +4.070338119038701e-01   +4.209647358830838e-01   +2.053863739422122e-01   +2.280467037582831e-01   +2.004591912616347e-01   +2.183594933499931e-01   +7.164576801857926e-02   +3.493533540006965e-02   +7.092359424035463e-02   +3.977737206099606e-01   +2.806615251138310e-01; +5.220343651214227e-03   +1.035329190863285e-02   +2.201641790169732e-01   +2.949500922653250e-01   +9.659421835177755e-02   +3.838096691684660e-01   +2.185614909903363e-01   +4.656958708803960e-01   +2.348482903472369e-01   +1.417441430188018e-01   +4.314816196800206e-01   +4.300608474928715e-01   +6.056208143380441e-02   +4.402321453428200e-01   +1.090531635183136e-01   +1.529385994688289e-01; +2.254570611489670e-01   +3.086870821009967e-01   +2.987137848227753e-01   +3.320174544675770e-01   +1.897314614115171e-01   +3.984954854291720e-01   +2.379951314054360e-01   +1.272426770187440e-01   +2.651380932566085e-01   +4.053359962808243e-01   +1.766716050949259e-01   +3.266030386752762e-01   +1.141931037749730e-01   +1.540264452816504e-01   +4.298953645707970e-01   +7.936046673007312e-02; +2.339084578004084e-01   +6.834725854100319e-02   +3.995930672218672e-01   +7.950635240658528e-02   +3.034993330598811e-01   +1.470266200382025e-01   +2.167676196664480e-01   +9.120031646937238e-02   +2.393368512781409e-01   +2.309640910206354e-01   +3.617777733730083e-01   +1.160506183950753e-01   +2.321884963674479e-01   +2.540248918331141e-01   +2.307103211521029e-01   +3.375700741309313e-01; +1.577837845461507e-01   +3.186469007387516e-01   +4.467791333895707e-01   +3.135712281415505e-01   +1.833927112985843e-01   +2.968850949324482e-01   +1.777418161628139e-01   +4.008268271589005e-01   +4.623694859089178e-01   +1.897262363684101e-01   +7.270017365434339e-02   +8.322942743046330e-02   +2.026056259695098e-01   +4.481319652240718e-01   +2.106199242989260e-02   +1.157794914156076e-01; +2.716720078601928e-01   +1.706757590250362e-01   +3.728959183002787e-01   +2.960545321056066e-01   +2.777675414030226e-01   +7.438787379041417e-02   +3.937718230155732e-02   +2.092259448864842e-01   +3.695455388227650e-01   +3.278908989311514e-01   +1.397766077350782e-01   +3.588283967909240e-01   +1.522752440525188e-01   +5.108731802115369e-02   +3.441171142507514e-01   +2.955757881049786e-01; +6.809638459492346e-03   +3.189304981718116e-01   +3.220561838835364e-01   +3.274876011737344e-01   +4.450229234287990e-02   +4.364104962639177e-01   +2.151172647707529e-01   +2.128280442108802e-01   +2.399040620582390e-01   +2.321757579571084e-01   +8.141429698529208e-02   +4.296648269587665e-01   +6.282497868054208e-03   +3.723642378026792e-01   +1.779615295346699e-01   +2.378309011886120e-01; +3.396530299436068e-01   +5.118378304589954e-02   +4.256098453632301e-01   +3.942144285815522e-01   +3.043670921374361e-01   +8.993256257995183e-02   +3.894464176303049e-02   +7.318964767874905e-03   +3.602682065327323e-01   +1.942550582890416e-01   +4.778572863077886e-02   +2.656091022576428e-01   +3.979798763544310e-01   +1.240068470580950e-01   +4.134019067695416e-01   +3.163258539870637e-01; +1.897549468748018e-01   +2.292622229744354e-01   +2.476092511640083e-01   +3.795929797898396e-01   +4.321846424518813e-01   +8.942291229385130e-02   +2.982017152203906e-01   +2.874702940729720e-01   +1.184755997319320e-01   +1.381473700187881e-01   +3.484639995399861e-01   +4.541707218402995e-01   +5.744378205845035e-02   +3.365218442513715e-01   +3.696262185667911e-01   +9.223815227542237e-02; +2.554682837409607e-01   +1.458196252242608e-01   +4.956561861459256e-02   +2.437537320831512e-03   +4.657749940727414e-01   +4.383390890443288e-01   +2.146721000403333e-02   +3.347951271259401e-01   +3.321885373259639e-01   +1.414713624412464e-01   +5.164625417155331e-02   +1.181212633852036e-02   +4.422147206509447e-01   +3.670142478956177e-02   +2.593544027849289e-01   +1.966660091207973e-01; +3.182392336951076e-01   +3.518621135242455e-01   +4.208963052445302e-01   +7.411796047970277e-02   +3.172337367683090e-01   +3.364764875886723e-01   +3.398532939259772e-01   +3.070360937962208e-01   +4.254123053748780e-01   +2.087164146304547e-01   +1.969825759765622e-01   +4.190042082979636e-01   +4.025066959002294e-01   +3.453643738025139e-01   +2.119686927431268e-01   +4.328862570924950e-01; +4.029331254711412e-01   +3.207381751212908e-01   +1.459663622959616e-01   +2.949708424955130e-01   +5.895728611049495e-02   +1.149568055427195e-01   +2.811936351545277e-02   +1.139937338682739e-01   +1.648402432570119e-01   +3.354278246469831e-01   +9.452469225420562e-02   +3.765932894168207e-01   +2.672805875796734e-01   +2.980397970100289e-01   +1.886317882244906e-01   +1.537726876752744e-01; +1.998269059702843e-02   +2.550053933081667e-01   +4.027092353339432e-01   +2.495769319355079e-01   +1.297487734127171e-01   +8.800785118876202e-02   +1.281978231923026e-01   +1.893524095415899e-01   +1.124745715324224e-01   +4.775372801444907e-01   +1.744834807595195e-01   +2.632173978444491e-02   +9.238367332173708e-02   +3.491935552766905e-01   +1.369521079159858e-02   +3.274583226122805e-01; +3.737733218789525e-01   +1.730275299596273e-01   +1.007548150358343e-01   +4.597691883701629e-01   +5.570809574994946e-02   +6.565442390048255e-02   +4.262659616062639e-01   +6.860624038027735e-02   +2.923839013147536e-01   +3.614182070070078e-01   +3.152791239881979e-01   +7.487025030687668e-02   +3.579905616985811e-01   +3.828952570483134e-01   +4.551144944994513e-01   +4.297931712771368e-01];
L1E_L1I_iGABA_netcon = [+2.531596125810819e-01   +3.076137208578120e-01   +3.124891329970558e-02   +1.577418873263308e-01   +3.977857173534781e-01   +1.884631918264818e-01   +1.760180751503782e-01   +1.091322380332855e-01   +4.201214960990129e-02   +1.795626224553052e-01   +1.807796238370311e-01   +2.761280064198420e-01   +1.511922540558043e-01   +4.331592510514518e-01   +1.052975602747054e-01   +2.478032101921092e-01; +6.790641252489404e-02   +4.371379428276266e-01   +2.444257057384071e-01   +4.207163019496363e-01   +2.174960951765660e-01   +2.018919765008899e-01   +7.304418809123543e-02   +2.448142996851989e-01   +2.289056476384275e-01   +7.396963207736793e-02   +1.002515743424690e-01   +3.361092154585717e-01   +2.298233793471032e-01   +3.466864763013933e-01   +2.387996681448440e-01   +3.442427453785968e-01; +3.001010576311177e-01   +4.751844926577306e-01   +3.756161030269259e-01   +3.051743355741289e-01   +5.526020842229454e-02   +2.801912231583440e-01   +3.141787433519061e-01   +4.132612013445109e-01   +4.215321176703765e-01   +4.562572605788727e-01   +3.141893784634421e-01   +2.380548168778278e-01   +4.623546112201281e-01   +3.979226883902041e-01   +2.097898380303748e-01   +2.688285444178276e-01; +2.298254674248119e-02   +6.719034946434205e-02   +4.386087387117524e-01   +2.215389623780127e-02   +8.670360864308811e-02   +3.413876489405402e-01   +3.414195880405781e-01   +2.710756545113899e-01   +2.365959117472638e-01   +4.631333451453611e-01   +3.068872155610265e-01   +4.138435623259484e-02   +1.665723732324185e-01   +8.535274361139072e-02   +4.520149239954050e-02   +4.635749129207800e-01; +1.038886839500556e-02   +4.171343367751725e-01   +2.480025681796650e-01   +4.344983979887242e-02   +2.017203704891926e-01   +4.062110468295904e-01   +3.385153130946630e-01   +1.867120033658189e-01   +2.803546127908696e-03   +7.382386130837774e-02   +3.458125039535214e-01   +5.815647274561681e-02   +3.929587525090893e-01   +2.210532226296979e-01   +3.180809434423794e-01   +2.605428570434568e-01; +3.716909029138541e-01   +4.455218426818802e-01   +7.305156045965296e-02   +3.202577406181835e-01   +1.736229751243865e-01   +1.956573471064331e-03   +3.314455338033915e-01   +1.406526733158341e-01   +3.935405136483449e-01   +8.072238798390587e-02   +4.512737983395667e-01   +6.440239602595794e-02   +1.806174876365549e-01   +6.320869591408804e-02   +2.526846169297594e-01   +6.833693973558100e-02; +2.402065543165368e-01   +1.072849734504020e-01   +6.185720507279418e-02   +1.276061647129982e-01   +9.398367745136389e-02   +1.788592132212571e-01   +1.420357319012634e-01   +2.572800418272990e-01   +4.215807254133080e-01   +7.609477565919849e-02   +3.625798883213097e-01   +4.795175589051580e-01   +4.769858588457808e-01   +2.507191578301600e-01   +2.479753012699906e-01   +1.429041920217716e-01; +1.332880325560350e-01   +1.043479567001261e-01   +1.051543259873683e-02   +7.561077652772800e-02   +3.455545249300447e-01   +2.491221471566459e-01   +2.385835632044796e-01   +2.994094517273741e-01   +9.303205923398307e-02   +1.987124566085667e-01   +3.966699655819964e-01   +4.516857473581279e-01   +2.512489571175163e-01   +2.199855184869985e-01   +8.700628924838211e-02   +3.322401160451888e-01; +1.415212185325810e-01   +2.921769276773744e-01   +1.456336725341627e-01   +7.791755604887416e-03   +8.657441359149666e-02   +3.364287824079293e-01   +3.853095510393886e-01   +4.323174159399460e-01   +1.797691869095773e-01   +5.150648863801000e-02   +3.639188779606314e-01   +1.687170233562449e-01   +4.239209069894419e-01   +4.471195705969024e-01   +2.884159656662746e-01   +3.704765372297627e-02; +2.492480462222590e-02   +1.922709875542364e-01   +7.316947540785684e-02   +2.757720053458861e-01   +1.945819661126390e-01   +3.998104402940919e-01   +1.489192107204405e-01   +1.100966987659963e-01   +4.487651677569960e-01   +3.684102397530627e-01   +1.133472095333933e-01   +2.893784761784124e-01   +3.677910166168062e-01   +8.818778741553848e-02   +3.703808652908577e-01   +1.047952690219096e-01; +4.124667905404151e-01   +4.254633536446369e-02   +1.455379531296477e-01   +1.929208821412095e-01   +2.560682458215295e-01   +3.175194869599902e-01   +2.158124060264224e-01   +4.592008206224601e-01   +1.550966471943271e-01   +1.957753765375222e-01   +2.751402802762170e-01   +2.275069232000171e-01   +1.204765457271208e-01   +4.652897891978759e-01   +4.222189988177644e-01   +1.598390024309539e-01; +8.667286681829586e-02   +4.301084677545142e-01   +2.665178775456372e-01   +4.415585312826940e-01   +4.740252185318614e-01   +3.199994481260534e-01   +2.255114609962244e-01   +6.953849150026976e-02   +3.439863540069550e-01   +2.183035734016983e-01   +1.652609412076126e-01   +3.998408562002235e-01   +3.202371587453861e-01   +2.354957523280144e-01   +3.756428562756361e-01   +1.169366809555478e-01; +3.493246803429205e-01   +4.138674885993901e-02   +2.543589882755259e-01   +5.563768304014061e-02   +2.578520270153904e-01   +2.723180302960790e-01   +2.803042316248225e-01   +9.799959312048119e-02   +3.560838276929977e-01   +4.232644787152654e-01   +8.430415969971769e-02   +3.765207756076496e-01   +4.653461518836218e-01   +2.955336119503463e-01   +1.779245946428037e-01   +6.647372552138242e-02; +1.217094880183124e-01   +1.258015473903113e-01   +1.101440431621765e-01   +4.884282825927350e-02   +8.986328988792763e-02   +4.180619145535757e-01   +4.458387129984299e-01   +3.600616404399649e-01   +2.068653116703364e-01   +3.132617323605914e-01   +4.699217148722608e-01   +3.544190082929766e-01   +2.993083649198577e-01   +4.163432073163742e-01   +3.128035314233625e-01   +3.494795782359525e-01; +2.039452396185273e-01   +8.198358363329930e-02   +2.116132660902563e-01   +4.215658762308137e-01   +3.010827459874942e-01   +2.430054959366916e-01   +5.350264520275783e-02   +1.644161319460621e-01   +8.101219204736820e-02   +2.433526048173099e-01   +1.276401035333951e-01   +2.114167613950671e-01   +1.794678319775023e-01   +1.106965661488810e-01   +8.581978966405857e-02   +1.445687719323927e-01; +2.097421936929462e-01   +3.535945339326452e-02   +8.583115849762085e-02   +4.438613394191955e-01   +4.520750741964893e-01   +3.329092904479214e-02   +9.669990741779999e-02   +3.865171982528848e-01   +3.786035928824518e-01   +6.579255319472686e-02   +2.145082612272260e-02   +2.997225444671330e-01   +3.131781999535967e-01   +2.449715972610741e-01   +1.911591802900354e-01   +2.142136788579442e-01];
L2I_L1I_iGABA_netcon = [+4.699354906888027e-01   +2.303569270924762e-01   +1.385831836970992e-01   +4.227716022052209e-01   +4.419131226677910e-01   +4.438022706133112e-01   +1.704382112089277e-01   +3.765515476115057e-01; +3.762156958539428e-01   +4.171032829018476e-01   +3.416643920427059e-01   +1.369472906296071e-01   +2.028817162416592e-01   +3.185804499584538e-01   +4.292720756770934e-01   +1.050676717773957e-01; +1.009635981210077e-01   +1.153149145822537e-01   +1.280362622829485e-01   +1.324119338800429e-02   +3.792761468118444e-01   +4.592328976941101e-01   +5.449673150024525e-02   +2.934067144715490e-01; +1.839759510883504e-01   +3.750089018621995e-01   +3.214245894286941e-01   +2.955020286396572e-01   +2.845284721135776e-01   +2.893790415863460e-01   +2.368909950956647e-01   +3.791322551123629e-01; +1.498018003206827e-01   +9.134352074436329e-02   +2.875878049575823e-01   +2.751344429269501e-01   +2.127650809030772e-01   +3.711296967076757e-01   +2.427512469447279e-01   +2.826160549487818e-01; +3.756912612889062e-01   +3.464981042569611e-01   +4.331655503879444e-01   +1.980583292774691e-01   +1.399345597394323e-01   +3.333454572147698e-01   +3.550028246265215e-03   +3.226364046965801e-01; +6.818477774927312e-02   +1.772696265471444e-01   +1.829628979792740e-01   +1.140041013971287e-01   +3.307183821662826e-01   +1.330426066495151e-01   +1.049067691627410e-01   +3.162616921104019e-01; +2.761297002022670e-01   +1.641690423541164e-01   +3.752620570767030e-01   +1.850621002976517e-01   +1.308377554017912e-01   +3.314323378725875e-01   +2.147620386607010e-01   +1.434160216029214e-01; +1.906815264328883e-01   +3.372118586823978e-01   +9.664550385735167e-02   +1.128694334600589e-01   +1.489115712605356e-01   +8.428007494527159e-02   +2.001080520655300e-01   +4.579933232796193e-01; +2.557075668130623e-01   +3.268889567659379e-01   +9.729579978298190e-02   +2.581684110864849e-01   +9.964388637754165e-03   +3.338758814898209e-01   +4.300610640475387e-01   +3.322593494859584e-01; +2.471876814233339e-01   +3.777031663977469e-01   +3.988326949908098e-01   +1.778447330033218e-01   +3.389280662695960e-01   +4.637959923973647e-01   +8.674162841758186e-02   +1.304565398337085e-01; +3.770790308024800e-01   +2.507364814885498e-01   +2.922793025233302e-01   +2.008550464451014e-01   +4.617924526084436e-01   +1.269543477591828e-01   +2.995507643318230e-01   +1.515308274107393e-01; +1.457846663028601e-01   +4.550712268722594e-01   +4.372450055311217e-01   +9.675066713391735e-02   +2.651263839190802e-01   +1.402234229190169e-01   +1.483354536080398e-01   +2.429027671430086e-01; +3.273679674714999e-01   +1.195656077032290e-01   +4.735165175218878e-01   +2.467321098657893e-01   +3.951751686930574e-01   +9.032704212070518e-02   +4.582208109636979e-01   +1.055985863711706e-01; +4.549334254288115e-01   +1.003421218533344e-01   +1.304848535636615e-01   +4.318887184711143e-01   +3.153719775198762e-01   +6.398479896729496e-02   +1.868942764120290e-01   +3.330333323945796e-01; +9.167994555208769e-02   +3.326758782948598e-01   +3.408598627655212e-01   +2.930578987276331e-01   +3.931118478137862e-01   +5.703878778276417e-02   +4.680605411422297e-01   +1.446108783915865e-01];
L1I_L2I_iGABA_netcon = [+2.678792667384419e-01   +3.244464768253799e-01   +1.451957231754311e-01   +3.506344923595194e-02   +2.419004296713210e-01   +1.867041319383786e-01   +4.684703802948197e-01   +3.279547939388907e-01   +1.974037543526854e-01   +3.691068944417896e-01   +7.246251387405293e-02   +1.465192428804481e-01   +5.679458693081035e-02   -2.081298110914114e-04   +9.860180641574051e-02   +3.764311905584745e-01; +3.825173442724868e-01   +2.847638918044264e-01   +1.804672190405066e-01   +2.190648709042595e-01   +4.409088082638442e-01   +2.156952370832790e-01   +3.231149993153944e-01   +4.621109353969587e-01   +2.038223282365680e-01   +4.693845103265153e-01   +3.159049275281766e-01   +1.677681832154028e-01   +2.395765018604296e-01   +3.019660208724423e-02   +1.735516695956191e-02   +4.202029957929364e-01; +4.049220303881946e-01   +2.780018730439286e-01   +1.037209129709282e-01   +3.912038778715937e-01   +1.600622593489369e-01   +4.125855460723089e-01   +3.648544832369304e-01   +3.132271160987430e-01   +1.808447053982354e-01   +1.709617237074750e-01   +3.239320022778399e-01   +1.860005291624578e-01   +1.570123487454627e-01   +7.761876726810597e-02   +2.926765664595185e-01   +6.647590197752676e-02; +1.992160716353474e-01   +2.570646258998571e-02   +2.814727100238809e-01   +4.136499877826847e-01   +4.867044246337933e-02   +8.862835677433455e-04   +1.689632333149339e-01   +1.623507352911004e-01   +2.961709955664419e-02   +3.060041117342434e-01   +2.635685081680918e-01   +2.277544658017446e-01   +1.215934830782454e-01   +2.971631337024023e-02   +3.815534610860691e-01   +2.510750433157251e-01; +3.487812643398810e-02   +3.887788035743500e-01   +3.751683531888167e-01   +3.192687330057890e-01   +2.969509772813061e-01   +2.355610844137123e-01   +3.021703345983518e-01   +3.981566856141550e-01   +2.912283305028291e-01   +1.330242154347430e-02   +1.496616973682749e-01   +7.497165920448038e-03   +1.173858029704320e-01   +4.196325545819091e-01   +9.574204895154645e-02   +2.242510328222131e-01; +3.011138254476625e-01   +3.384835184915375e-01   +6.424284057610626e-02   +4.270624411236225e-01   +2.682770291262664e-01   +4.626179834356414e-01   +3.463882606111012e-01   +3.909438949390820e-01   +2.629319340352912e-01   +2.787753994616813e-01   +4.788911147467373e-01   +3.903842453207448e-01   +6.051805476629983e-02   +4.333858302265051e-01   +3.425888551156014e-01   +4.309624025957876e-01; +3.664702038058802e-01   +6.883523746400665e-02   +4.064952247411491e-01   +4.702211780471480e-01   +1.859860658505516e-01   +4.671731385879422e-01   +2.438021966822264e-01   +2.254645468084109e-01   +3.069766693037204e-03   +2.756861769004252e-01   +1.461129297195471e-01   +1.679428157829975e-01   +3.707406539924815e-01   +1.993063362002196e-01   +4.043854130665470e-01   +2.713512855656160e-01; +3.568022966343323e-01   +5.002937364152115e-02   +4.293364731444814e-01   +3.449852387435914e-01   +5.510118695679758e-02   +3.750414290158435e-01   +2.820894160132322e-01   +3.679137130292690e-01   +1.719470914888447e-01   +4.061518074892920e-01   +1.265745119331621e-01   +2.341107968033697e-01   +2.379491289074951e-01   +3.059335609860162e-02   +4.416499735092677e-01   +2.920137483067417e-05];
L2E_L1E_iAMPA_netcon = [+3.696689889804446e-01   +1.368387481115846e-01   +7.119161703046764e-02   +4.735019098772745e-01   +5.443866897568436e-03   +2.284304782233834e-01   +3.172696817829483e-01   +3.639535783908689e-02; +4.421781366981984e-01   +4.151485084642103e-01   +2.540928495784239e-01   +1.782914417209314e-01   +2.425046007007341e-01   +8.342664967177527e-02   +4.380210386541005e-01   +1.872522633121413e-01; +4.365837574798170e-02   +6.207442659967133e-02   +1.551501627883906e-01   +7.644117483641198e-02   +3.001300004377050e-01   +4.077985985766570e-01   +1.574706340221612e-01   +1.471098754915786e-01; +1.217774001122892e-01   +3.490647262696697e-01   +1.014190772046535e-01   +3.125694733244867e-01   +3.600781869868074e-01   +1.469600554947975e-01   +4.222416680671676e-01   +3.982250174115105e-01; +9.131254509565802e-02   +4.721860492903147e-01   +6.715454146469615e-02   +1.205551579832035e-02   +4.506705439065353e-01   +4.556676675770185e-01   +3.261009226007993e-01   +2.217410253715721e-01; +3.363132252695366e-01   +2.440033407838172e-01   +4.527067436593652e-01   +3.739644953099356e-01   +3.360673008386858e-01   +1.066713294683305e-01   +3.784746736419270e-01   +3.258047328012292e-01; +4.911106612355901e-02   +1.616578432005739e-01   +1.375599756946255e-01   +2.185672653733810e-01   +4.393767432786924e-01   +2.211621505021979e-01   +7.506999073314048e-02   +1.620165209423158e-01; +3.281623748526518e-02   +5.977896396225140e-02   +2.532516643758752e-01   +3.215894540003023e-01   +1.884854822973751e-01   +4.340949577994365e-01   +4.621354346971814e-01   +4.334074337034498e-01; +1.687633816074650e-01   +4.240972512100824e-01   +1.986480358989585e-02   +1.263876639333167e-01   +7.956289776810262e-02   +4.601419767372688e-01   +2.572843181953188e-01   +3.641464768187841e-02; +1.441307268893977e-01   +1.311704122959989e-01   +4.138139505439224e-01   +1.969401658430033e-01   +3.884053448522837e-01   +4.338177844792351e-02   +6.078634906628378e-02   +4.619619064248375e-01; +2.747405695135780e-01   +2.249604066030819e-01   +9.031170562140088e-02   +2.919833915065412e-01   +1.934812228771591e-01   +1.965901377366603e-01   +2.823723213489129e-01   +4.265018580533362e-01; +1.240305181401123e-01   +2.139613279747714e-01   +3.909462087488994e-01   +3.526717008093637e-01   +3.080846335977583e-01   +8.831746613687876e-02   +4.758470370241747e-01   +1.157327034855638e-01; +2.878388542923281e-01   +3.978653182434758e-01   +1.170459850232444e-01   +2.701377539128728e-02   +4.673695134253875e-01   +3.185592254987577e-01   +2.201652083314815e-01   +3.898785937503393e-01; +2.050568972831640e-01   +2.210441747950102e-02   +5.439655652357887e-02   +3.201914184469415e-01   +4.681313557107410e-02   +1.403565482677361e-01   +3.978996384116915e-02   +3.550995059948251e-01; +1.312573698165328e-01   +9.842375344520099e-02   +3.271063123311830e-02   +3.668007734710392e-01   +5.279945041059905e-02   +4.285839773280768e-02   +1.972109947564944e-01   +1.116873273572180e-01; +7.416521605046750e-02   +2.134164324235772e-01   +6.751131332736129e-02   +2.559520608942291e-01   +1.220148422959585e-01   +2.610155468212703e-01   +5.120672430235693e-02   +3.913557207229207e-01];
L1E_L2E_iAMPA_netcon = [+1.789562871669941e-01   +7.579878276642195e-02   +4.489154179458942e-01   +4.606910002383220e-01   +1.567689494710198e-01   +4.513425998228505e-01   +2.404808472390988e-01   +4.753949786848680e-01   +6.746407866432418e-02   +3.086375858995525e-01   +3.046295921872199e-01   +3.653375727987332e-01   +1.761801359006640e-01   +3.215998217159122e-01   +2.688590459408675e-01   +2.381523182075592e-01; +1.814939426629864e-01   +2.472050143969308e-01   +1.053173767304914e-01   +4.162264271760132e-02   +2.565479164028778e-02   +3.270014668716213e-01   +3.750474329572907e-02   +1.514852980433794e-01   +1.007300662393756e-01   +1.485284760679078e-01   +1.319265165996954e-01   +4.513072250994796e-01   +6.980362603357786e-02   +1.320378568890452e-01   +2.814789479378099e-01   +1.164135041048573e-01; +1.583167519156072e-01   +2.858950304990766e-01   +4.305041625726860e-01   +4.397171968389952e-01   +4.557196226950203e-01   +5.415716547964570e-02   +1.435634666014632e-01   +2.333349338937049e-02   +2.082477257444386e-01   +2.795748776445419e-01   +1.589924909155178e-01   +5.192953608092334e-02   +3.611929828711233e-01   +2.868783438577733e-01   +4.250481339752007e-01   +3.354582850578047e-02; +3.742951786481956e-01   +1.884986833722690e-02   +1.067813772426314e-01   +1.008079730284611e-01   +3.467981752241009e-01   +1.524687141512010e-01   +4.317559529905863e-01   +4.295867310545314e-01   +3.707308276382003e-01   +3.638126977048314e-01   +2.262422101288817e-01   +2.710659896968157e-01   +4.455968899587166e-01   +1.601970344253308e-01   +4.377270279797967e-01   +4.676943264533688e-01; +6.484911338259775e-02   +4.096212358058393e-01   +4.111790999281416e-01   +1.076715786055062e-02   +8.004902906688476e-02   +3.897144701670221e-01   +4.431447280594800e-01   +8.264068564397736e-02   +2.758129827991918e-01   +2.021093337715430e-01   +2.669594730908139e-01   +3.678379796459134e-01   +1.137211451349529e-01   +2.504436088710012e-01   +4.747654759944787e-01   +2.509395871092015e-02; +1.730544577246244e-02   +4.085291910132365e-01   +1.273278052166077e-01   +3.885078186392705e-01   +4.632298261859626e-01   +4.101783261339891e-01   +2.458982339732874e-01   +4.439672175555258e-01   +1.570134248280977e-01   +1.894501432718898e-01   +4.038856668951601e-01   +4.372917409930970e-01   +4.035569365797774e-01   +2.994910867245856e-01   +9.163714858890899e-02   +2.754537693432725e-01; +1.461168449865512e-01   +1.061562645284532e-01   +2.796090051164175e-01   +3.077831312291613e-03   +1.820896677531801e-01   +2.525624661375309e-01   +3.533471768259192e-01   +2.840382828029338e-01   +2.791691019561623e-01   +3.769819407037535e-01   +3.004518024633024e-01   +5.193065511633583e-02   +1.743313774948205e-01   +2.621787265356327e-01   +1.172455488778212e-01   +1.692493941836707e-01; +3.847338072122512e-02   +2.649949372635016e-01   +2.388044543600219e-01   +1.924496063835797e-01   +3.509238572152961e-01   +4.666661123938484e-01   +4.733616808634564e-01   +3.028435166569520e-01   +4.172721069233016e-01   +1.909197238461426e-01   +1.662470001435042e-01   +4.719975436345559e-01   +3.196805013680320e-01   +4.310666514073677e-01   +1.585839091257294e-01   +5.460672994660758e-02];
L2I_L2E_iAMPA_netcon = [+3.022587251755453e-01   +1.084826172363420e-01   +4.335653287943934e-01   +2.306816776118442e-01   +3.745500536775361e-01   +2.050018038381884e-02   +6.192879238896396e-03   +4.304187494064169e-01; +7.909181060945492e-02   +5.880988063466601e-02   +7.839995314651076e-02   +4.120682805502418e-01   +3.656103651958517e-01   +1.916139631910829e-01   +3.385576657822014e-01   +2.300725592515313e-01; +4.058606101481249e-01   +3.585094358896652e-01   +3.965196638122809e-01   +3.563928034950757e-01   +2.517140973362715e-01   +2.437910282011768e-01   +2.390331432213008e-01   +3.418893012992792e-01; +1.919626590952822e-01   +8.010973167797902e-02   +4.282447231847145e-01   +2.062593001094999e-01   +4.571446727034753e-01   +7.300397674568490e-02   +2.157650407434425e-01   +4.120519341133100e-01; +3.338448463557591e-01   +4.128221660590041e-01   +3.056290181549253e-01   +2.901849444636824e-01   +4.393459365579929e-01   +3.593554074049679e-01   +1.971147209772230e-01   +3.564186295060805e-01; +2.931439019648321e-01   +2.032341747803108e-02   +4.263787934268093e-01   +3.544721187008890e-01   +2.564611393456465e-01   +8.999394087351727e-02   +5.299273411185559e-02   +3.474630778830840e-01; +4.536935122308473e-01   +2.185230071778934e-01   +8.009190338170062e-02   +2.042393980483647e-02   +6.309531195961703e-02   +1.046625761500323e-01   +7.134929868680490e-02   +8.233291985659465e-02; +4.375598933172311e-01   +1.644419701677348e-01   +2.628672097459231e-01   +2.311653941368600e-01   +4.214552131175039e-01   +1.101097784211944e-01   +6.025288164109641e-02   +8.571505914507263e-03];
L2E_L2I_iGABA_netcon = [+4.420883455161880e-01   +1.161141586183598e-01   +9.675926762191178e-02   +9.117434643106051e-02   +3.194225724627341e-01   +1.796908362822952e-01   +3.943851607103787e-01   +4.495780974655392e-01; +1.214627381991338e-01   +2.030753072713076e-01   +5.906279519029029e-02   +6.255343094265907e-03   +4.724913658362869e-01   +3.305848247600454e-01   +3.630371149181357e-01   +3.256150811905476e-02; +3.140693984655139e-01   +1.680724265009552e-01   +2.642549785761544e-01   +2.107821866128495e-02   +1.861322981682533e-01   +3.562991615453224e-02   +4.716030948511543e-01   +3.978165490024052e-01; +4.152004970504360e-01   +3.353069735932056e-02   +1.237301186683850e-01   +3.503379832489404e-01   +4.400250977207794e-01   +3.070245253909147e-01   +2.085321509410537e-01   +3.167736671540770e-01; +8.028494903841636e-02   +4.337953962977700e-01   +3.284402215572535e-02   +4.020732598482291e-01   +1.478056851329095e-01   +1.805914109195833e-01   +1.904355768619719e-02   +1.312188400432766e-01; +3.611466831639839e-01   +7.492486153143817e-03   +2.625095623920164e-01   +3.824221814618687e-01   +4.265912004939315e-01   +1.295288255042780e-01   +4.583136415499067e-01   +3.763542089602402e-01; +7.653763400675595e-02   +4.661572220292133e-01   +1.418879173339900e-01   +1.570817881407349e-02   +3.455026377567059e-01   +2.525997722774140e-01   +2.915408766455941e-01   +2.999144886253792e-01; +4.141936760486631e-01   +1.486669451397571e-01   +2.394096141900197e-01   +9.740591349929448e-02   +2.194207868252910e-01   +3.735402273113826e-01   +4.548004351208469e-01   +2.930477359259741e-01];
L3E_L2E_iAMPA_netcon = [+1.743443229249734e-01   +3.073113371790979e-01   +7.706578021508785e-02   +3.878671273931729e-02   +5.767048373248887e-03   +4.694103147555019e-01   +1.879183399963420e-01   +4.101659617277326e-01   +5.802179847181078e-02   +1.413378839498131e-01   +1.387333515049712e-01   +2.622136515824589e-02; +1.260671226233118e-01   +4.215612405475363e-01   +1.424992178848964e-01   +1.805832382474757e-01   +2.200361252037116e-01   +2.670424670880827e-01   +4.375956470584225e-01   +4.726198948327898e-01   +2.694098134339639e-01   +4.613554933960313e-01   +1.690627750948135e-01   +1.232804478378507e-01; +5.057514723969768e-02   +3.530276590602491e-01   +5.153081814854977e-02   +3.549761099034156e-01   +3.291138698262069e-03   +2.541436408273158e-03   +2.555016308336662e-01   +4.699768062506894e-01   +2.832631951264280e-01   +2.966814781270208e-01   +1.174983204954052e-01   +3.422516947869407e-01; +1.540118693347204e-02   +9.780717745292612e-02   +3.898936421108545e-01   +1.225276875844352e-01   +1.336009843108096e-01   +5.525850780965308e-03   +1.601742282361114e-01   +3.210966380251251e-02   +1.061655090854013e-01   +1.505779486131919e-01   +9.304353531963035e-02   +1.566537109528306e-01; +4.292922555737797e-01   +1.778320836196300e-01   +1.639794003323300e-01   +4.736209423219326e-01   +3.250889383655588e-01   +1.769030472945327e-01   +4.663716150487487e-01   +7.553299670581130e-02   +4.045338499102564e-01   +2.317697485390108e-01   +3.298004129210212e-01   +1.948034834915775e-01; +4.225937794054272e-01   +2.878207214784986e-01   +5.456705000993371e-02   +2.317179133513392e-01   +3.042504968152835e-01   +4.341663368248610e-01   +4.258171707162287e-01   +1.833168095963427e-01   +2.210944918334896e-01   +5.270612039965656e-03   +3.061200169867149e-01   +1.168739118609013e-01; +2.985269494217337e-01   +2.439876720821654e-01   +3.017397492761209e-01   +9.766932059979283e-02   +2.631435309110675e-02   +1.718307241047695e-01   +2.773574465658212e-03   +1.673917059312162e-01   +1.339679166430434e-01   +4.763560736575496e-02   +5.107690602416806e-03   +2.213677946473384e-01; +4.055197728913512e-01   +4.635686082947987e-02   +2.328404775337883e-03   +1.264114439410834e-01   +2.605958170259349e-01   +4.528529817181392e-02   +1.546731456339853e-02   +2.312789008596256e-01   +2.344158567872252e-01   +4.096360437560253e-01   +4.308068953854165e-02   +2.892418430945632e-01];
L3I_L2I_iGABA_netcon = [+4.676144230443244e-01   +2.389575673671473e-01   +3.100330540692123e-01   +1.310853075810750e-01   +4.533785229061639e-01   +2.104250586048785e-01   +2.129217717407850e-02   +6.801358813841769e-03   +4.198041791166206e-01   +2.148684406653210e-01   +4.696428614146254e-02   +3.550934195453597e-01; +4.254982387530487e-01   +4.593144972266771e-01   +4.263279171696226e-01   +7.534512611854259e-02   +2.487284565978164e-01   +3.999665839604369e-01   +3.348096982430842e-02   +1.011918154177786e-01   +2.352423368621863e-01   +3.190715305121325e-01   +5.703714907747673e-02   +3.085992523166918e-01; +4.814965142244482e-02   +4.122628116938859e-01   +4.243805329277788e-01   +2.516907601798223e-03   +3.373474973631985e-01   -2.025014831453959e-03   +2.972053734891857e-01   +4.458238345599009e-01   +3.448762866368684e-01   +1.328292018249160e-02   +2.856817566737028e-01   +5.510539977217228e-02; +4.620567101206812e-01   +1.348049449584606e-02   +1.536967382120356e-02   +3.117936330860063e-01   +4.287775726384785e-01   +2.664444758044419e-01   +1.380643713373334e-02   +3.744580229219118e-03   +4.167600645114073e-01   +3.948371204344562e-01   +4.740281504479177e-01   +2.638886363312161e-01; +7.342860038429078e-02   +4.607305342161533e-01   +1.983328233563581e-01   +2.008151303426171e-01   +2.772596850857326e-01   +4.396325884913051e-01   +1.851469133749417e-01   +8.441854425564549e-02   +4.824199563611942e-01   +2.413334241654498e-01   +1.072926125243301e-01   +8.793325407572009e-02; +1.744492776216297e-02   +3.277811532442248e-01   +9.770205945375608e-02   +3.199087235514733e-03   +8.054974087683259e-02   +3.106450420760866e-01   +3.302699960694280e-01   +1.121405217898255e-01   +2.484651026494838e-02   +3.623157731838210e-01   +4.151208391601545e-01   +3.518030018371891e-02; +2.993462362130400e-01   +4.228309303418386e-01   +2.795964175493637e-01   +3.081911215776426e-01   +2.101124583912383e-01   +1.486942480119871e-01   +3.370633128043612e-01   +2.248823136039158e-03   +4.021303102276318e-01   +1.858874390788280e-01   +2.390161627277270e-01   +3.483930699925479e-01; +2.358779578839814e-01   +1.026462834662802e-01   +1.486388628266381e-01   +2.780310735073369e-01   +1.657474986496240e-01   +6.362766599902392e-02   +1.105182931328692e-01   +1.333664217793857e-01   +2.674232238868600e-01   +4.680676752429794e-01   +1.356046556044167e-01   +1.387103144863522e-01];
L2E_L3E_iAMPA_netcon = [+3.203836415303361e-01   +3.198619556507727e-01   +1.086893870422120e-01   +4.176275855349415e-01   +2.469209921318595e-02   +2.460132806419300e-01   +3.223935555356795e-01   +4.498599432481891e-01; +2.599362350882049e-01   +3.503673841176860e-01   +3.513118632417526e-01   +3.867823359291654e-01   +5.328066838875536e-02   +2.421017776728784e-01   +4.129534255390909e-01   +3.317897771461038e-01; +4.071248501245005e-01   +4.242253801120739e-01   +4.027809906064615e-01   +4.338300491131454e-01   +2.809414359882382e-01   +3.168408206253853e-01   +4.196096465406710e-01   +2.741942682807591e-01; +1.946106354459809e-01   +4.602734124932746e-01   +4.094075426625925e-01   +2.942610908291991e-01   +2.442760299386879e-01   +2.397853483846964e-01   +1.319652961518210e-01   +8.833124410124152e-02; +7.103583757484935e-02   +2.642320778374256e-01   +1.225431643907162e-01   +3.854330255832551e-02   +8.558648431567985e-02   +2.609079636299251e-01   +4.309482549933124e-01   +3.656845844156703e-01; +2.354117863922157e-01   +4.719375063163626e-01   +4.306759607220022e-01   +2.591200800215332e-01   +2.484622622585324e-01   +4.669037250889774e-01   +3.437396248413965e-01   +4.701662833684603e-01; +2.335896957265168e-01   +5.347647424161336e-02   +2.548533731012654e-01   +1.197175778863087e-02   +1.691848875551273e-01   +3.917607758606351e-01   +1.640576297816758e-01   +3.719161829061118e-01; +4.480884449665706e-01   +3.327589201389426e-01   +2.074161846985523e-01   +3.729437232562021e-01   +1.650227678542353e-01   +3.668135545148449e-01   +2.476124161831013e-01   +2.047149032248042e-01; +2.248317766858227e-01   +2.634193175854638e-01   +4.242569153351449e-01   +3.003944729947888e-01   +2.716898415465933e-01   +1.646286793036610e-01   +2.888713880803032e-01   +3.184664085485622e-01; +1.349741186418687e-01   +7.565621834330213e-02   +3.764196310258676e-01   +4.170408552495545e-01   +4.286534027557525e-01   +7.852547515178721e-03   +6.696727372691512e-02   +3.108365206442131e-01; +2.756056125667210e-01   +1.523299410768987e-01   +3.547517533848857e-01   +3.871798685246760e-01   +4.505181712681690e-01   +4.594478392928811e-01   +1.270764418090257e-01   +1.774944580706351e-01; +4.794539989881910e-02   +2.794592765524633e-01   +1.978242525134126e-01   +4.173219568646110e-01   +2.323980735603270e-01   +9.993837981028796e-02   +3.159095173741520e-01   +4.114265947823788e-01];
L2I_L3I_iGABA_netcon = [+4.508393248831663e-01   +1.940054179271725e-01   +1.303553104845726e-01   +3.411351960419482e-01   +3.526231679765744e-01   +4.029908576266601e-01   +1.724038283364896e-02   +2.484135162938242e-01; +2.651973104056918e-01   +2.266680409494304e-01   +3.355952186236493e-01   +7.974872824903310e-02   +4.210877809820847e-01   +3.909388303681876e-01   +2.218436809592098e-01   +1.201058811677369e-01; +3.754880097496974e-01   +3.510416953701605e-01   +4.474014118740493e-01   +2.986067788924208e-01   +1.725133962621975e-01   +2.925279732525666e-01   +1.902072945014697e-01   +8.366962698226044e-02; +1.030403236800550e-01   +3.978937544412110e-01   +1.055061841425043e-01   +2.329194545787251e-01   +1.588266860934783e-02   +1.724423399133136e-01   +1.787430339707952e-01   +4.666299023939386e-01; +1.452203064148687e-01   +1.861622461030094e-01   +2.547340588996111e-01   +2.254189744960399e-01   +1.719687399704467e-01   +3.069092178832127e-01   +4.671390467437608e-02   +6.491511772388635e-02; +8.635641826542200e-03   +1.220055332841023e-01   +2.090751869674747e-01   +8.507528821275133e-02   +1.701040401351522e-01   +1.886899921697043e-01   +2.513778785499417e-01   +3.335952696815377e-01; +1.693043429840311e-01   +2.274344615126056e-01   +4.485027800827180e-01   +3.056038173675357e-01   +3.505333169081871e-01   +1.430866047755828e-01   +1.536028018477663e-01   +1.462549418340686e-01; +1.722254075141803e-02   +4.721722606645874e-01   +1.503675718086062e-01   +4.249606588821521e-01   +8.904326509596511e-04   +3.633170671295564e-01   +2.723705175373081e-01   +3.653951557636493e-01; +4.254196168022074e-01   +1.383567031428550e-01   +4.041991271075612e-01   +3.005648696479627e-02   +2.384465244667465e-01   +1.260020108582217e-01   +1.965553789893218e-01   +2.161828152616094e-01; +3.651865089117003e-01   +2.368929106810416e-01   +1.210017824976398e-01   +2.406676872819429e-01   +2.975159222089225e-01   +1.659769054793938e-01   +1.006525840789949e-01   +1.465925771495520e-01; +3.428216521245923e-01   +4.632945718281747e-01   +2.553990047284782e-01   +3.287906276228157e-01   +1.392925866302876e-01   +1.710417098669108e-01   +4.560209067807500e-01   +5.943637115707094e-02; +3.643182256275152e-01   +4.665858594594586e-03   +1.585541228017268e-01   +6.817752311602322e-02   +6.821202297662335e-02   +4.611771818945865e-01   +2.305916123641671e-01   +2.661970864914574e-01];
L3I_L3E_iAMPA_netcon = [+2.106717368643217e-01   +4.745749153255218e-01   +1.321109553277010e-01   +2.931963928662365e-01   +3.731082572453985e-01   +1.526339015141671e-01   +1.353848276178141e-01   +1.074127179888760e-01   +1.569755574389780e-01   +1.366841988584692e-01   +1.254389407312943e-01   +2.092981699021257e-02; +1.950200185328905e-01   +4.076626838703684e-01   +1.118016783171530e-01   +6.145028003963147e-02   +3.847952847189077e-02   +2.559789603642236e-01   +2.641184600330051e-01   +2.656752654096621e-01   +1.078137891934940e-01   +2.330677429920442e-01   +3.602306686578347e-01   +2.735943638499221e-01; +1.259073358965645e-02   +2.973399190910354e-01   +2.214785660672433e-01   +2.814712101687806e-01   +2.341677565784027e-01   +2.168279099135789e-01   +2.400758412117571e-01   +2.195292199548696e-01   +1.647602041309114e-01   +2.720874017597331e-01   +2.210530942037419e-01   +2.653349716658890e-01; +1.869949185454582e-01   +3.516863733378068e-01   +3.008081585866561e-01   +2.046663167150154e-01   +2.168131298015865e-01   +4.267394707369745e-01   +3.646715037469436e-01   +5.696276987478459e-02   +4.390293821417457e-01   +4.343228842368355e-01   +7.529786012443347e-02   +3.548713164895322e-01; +5.359816363367277e-02   +1.579617613415735e-01   +1.690027717878372e-02   +4.136191501365380e-01   +3.612217094709120e-01   +2.621475770768468e-01   +4.585528098418076e-01   +2.537223833202189e-02   +4.250317911704953e-01   +2.744084624919207e-01   +1.832207976663133e-01   +5.500585460828964e-02; +1.631269565482183e-01   +3.215671245187243e-01   +4.003160317881219e-01   +2.024813246699902e-01   +4.709333516717336e-01   +1.267785927165234e-02   +4.277101345940585e-01   +1.187301958175281e-01   +3.230130410903779e-01   +1.209417837539293e-02   +1.650391523730392e-01   +7.451087079747566e-02; +3.912099848927940e-01   +1.775095897187386e-01   +1.874496075344620e-01   +1.374299926333996e-01   +3.222053986711844e-01   +9.463985032642099e-02   +2.716449463506583e-01   +4.410688126260383e-01   +4.000340544350960e-01   +4.671145752152559e-01   +2.507810254814501e-01   +3.407325055532989e-01; +3.491690136598160e-01   +1.022913052791597e-01   +3.458015326051327e-01   +2.838440206628717e-01   +4.728843794492831e-01   +2.834793912626229e-01   +4.449850348070836e-02   +2.354099811970841e-01   +2.080663042723939e-01   +1.419205068131638e-01   +1.170369836212719e-01   +4.525700044366627e-01; +4.596707150448266e-02   +4.078050782012337e-01   +3.514971487385155e-01   +3.861113504651254e-01   +1.757145779083027e-01   +3.460590040069904e-01   +8.618309020211945e-02   +3.754862014944075e-01   +4.003741934467310e-01   +2.179322470930747e-01   +1.013305076560944e-01   +1.130128442228551e-01; +4.404836738959934e-01   +3.703217815352088e-01   +1.920699985925380e-01   +1.135879474081112e-01   +2.729990301822235e-01   +3.692878854940108e-01   +2.410342685369808e-01   +4.179766913640112e-01   +3.194829300758045e-01   +1.644572721220275e-01   +4.228094430276222e-01   +1.048446928034802e-01; +2.113293186872132e-01   +1.658763385278458e-01   +4.714709799293429e-01   +4.531594541422283e-01   +7.731696288568759e-03   +2.955797713401608e-01   +3.998724378807092e-02   +1.164137009923288e-01   +1.873548510395344e-02   +4.583318434731528e-01   +3.654946059186036e-01   +1.698873536761639e-01; +5.273022717155918e-02   +8.391071866774509e-02   +1.613124533176948e-02   +2.172076714143552e-01   +2.075416967332532e-01   +1.139345692191052e-01   +3.750487363104419e-01   +9.480046982392706e-02   +1.574852084553857e-01   +1.144334629868397e-01   +3.701542122637620e-01   +1.309702375116139e-01];
L3E_L3I_iGABA_netcon = [+9.182134708551963e-02   +2.150299699523173e-01   +1.559902397349191e-01   +4.401937628794017e-01   +3.931715340653998e-01   +2.657793228794892e-01   +1.496283888827774e-01   +3.651065492511040e-01   +3.102469083552413e-01   +3.565851155948223e-01   +2.838521796635610e-01   +1.122573739950902e-01; +3.691935052319819e-01   +3.017454963048521e-01   +1.449993911689322e-01   +1.148547369594952e-02   +1.777042839039473e-01   +3.397475312338782e-01   +3.170603444621943e-01   +4.678918618572428e-01   +4.091729842240416e-01   +2.135650912497240e-01   +5.354518777508292e-02   +3.134480417660671e-03; +2.839315389197740e-01   +4.592789039068813e-01   +4.536646792715915e-01   +4.039396609912126e-01   +4.152533733526513e-03   +3.570722813586030e-01   +2.774833142059314e-01   +3.316276250599915e-01   +1.996808107530305e-01   +2.004294415920792e-01   +1.317620210270428e-01   +7.060343978791246e-02; +1.981037253254296e-01   +2.118246154987384e-03   +6.643508774174900e-02   +3.424653029817091e-01   +3.458853262272546e-01   +1.248818291856806e-01   +1.991942174725495e-01   +1.792494150050804e-01   +4.751667737340261e-01   +2.265176594482836e-01   +2.488353130675261e-02   +2.855475474201301e-01; +2.019820533501367e-01   +1.861917011392307e-01   +4.733041427980201e-01   +1.290075559027238e-01   +2.605852193968329e-01   +3.668652407957818e-01   +4.615596796802505e-01   +4.434225523099488e-01   +1.244559508974089e-01   +2.696306099525819e-01   +4.003720630016327e-01   +2.845587224807479e-02; +3.271330985622612e-01   +2.294499374115088e-01   +4.004104048955957e-01   +4.296337198774795e-02   +1.888241624707170e-02   +4.684206062058712e-01   +4.217429170174040e-02   +3.325278098857394e-02   +3.889530459141571e-01   +2.915330419220288e-01   +1.296869369288301e-01   +1.056110074062120e-01; +2.852023075360371e-01   +1.709773185745626e-01   +2.309225819959127e-01   +2.876215519350033e-01   +3.279975602934538e-01   +2.308605095444338e-01   +1.656805729438732e-01   +5.784503615573900e-03   +1.577674007940086e-01   +7.955747673609227e-02   +1.451742525739845e-01   +3.479309211909106e-01; +1.412502891623680e-01   +8.246679284593288e-02   +5.779045818912286e-02   +4.393253917941639e-01   +2.050072750636946e-01   +3.557154330379295e-01   +2.465810148584546e-01   +3.655284716650508e-01   +3.650990451092307e-01   +4.105227092351007e-01   +7.713619947188671e-02   +2.814908528416959e-01; +1.342976890729544e-01   +9.313741766113634e-02   +3.706308320702009e-01   +2.552327935114632e-02   +4.502094979341387e-01   +4.378438348965014e-01   +9.159949095721083e-02   +3.422628152957050e-01   +1.127269449282047e-01   +2.002549938055753e-01   +2.043306051082805e-01   +3.006975425276170e-01; +3.950105424795423e-01   +1.495538393581068e-01   +4.032960718580377e-01   +1.602907577068090e-01   +1.690569567514521e-01   +4.684652278039225e-01   +3.624069782871016e-01   +2.687789435790486e-01   +4.496183626181821e-01   +4.649904397467097e-01   +8.355743430780255e-02   +1.998425334967765e-02; +2.664829969003882e-01   +6.006192260678996e-02   +1.003928197452829e-01   +8.991849717208049e-02   +3.743904272099666e-01   +2.425990054519228e-01   +4.071908959658067e-01   +2.928355325242752e-01   +2.703182126951899e-01   +7.987758844698158e-02   +4.388152252104469e-02   +3.867058804703983e-01; +3.051895113215111e-01   +2.473140466859423e-01   +4.741991329198169e-01   +3.468672370118495e-01   +9.735969231765344e-03   +2.471756854048856e-01   +4.685206648141072e-01   +2.794275716549541e-02   +3.786657619241073e-01   +1.944992077906843e-01   +2.248742320908062e-01   +2.126456868371314e-01];
L2E_Input1_iAMPA_netcon = [+4.738121850255604e-01   +4.800291562556525e-01   +4.751837085827640e-01   +4.767600955809601e-01   +4.781930172402053e-01   +4.803829797410143e-01   +4.777605827177941e-01   +4.757923861814939e-01];
L2I_Input2_iAMPA_netcon = [+4.773045194263504e-01   +4.796665887807876e-01   +4.768820803371018e-01   +4.792407807682015e-01   +4.801221959927423e-01   +4.794767004332201e-01   +4.755889071164177e-01   +4.772243265827544e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
