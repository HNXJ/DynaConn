function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.358621667445894e-02   +3.196629561302560e-02   +1.366457657757184e-01   +1.289055004181398e-01   -3.154780064120792e-02   -9.834079560594527e-02   +3.404772198260975e-02   +7.639190971333236e-02   -6.411137812918552e-02   +8.368212025629691e-02   +1.060142626500594e-01   +8.788575351038708e-02   +3.061699696894179e-02   -3.209504136629821e-02   -4.241404352771807e-02   +7.436899371074636e-02; +7.349001861386234e-02   +1.349839501018720e-01   +7.717634585119630e-02   +4.518887395749002e-03   -5.087773809919902e-02   +8.492179977647928e-02   +1.947589105537727e-01   -1.007801907302254e-02   +1.784380742785494e-02   +1.385694943807950e-01   -6.655830050907005e-02   +4.976095179007864e-02   -4.316143352861453e-02   -3.816775580111363e-02   +4.352108946584615e-02   +3.063942787252283e-02; +1.526422169179320e-01   -1.594001102343915e-01   -6.214907291870890e-02   +1.694617782068917e-01   +2.229568684585924e-01   +1.530452902518017e-01   +5.555200063410817e-02   +2.972723917097454e-01   +1.945427399270588e-02   +1.448745077197106e-01   +1.557457268083769e-01   +2.768335049821891e-02   +3.334618847244475e-02   -4.999681245971090e-02   -2.630687556524798e-02   +2.226781788479167e-01; +3.876347521975403e-02   +1.330002138554199e-01   +4.717547849272459e-02   -4.302088496353681e-02   +2.506253709483850e-01   +5.354014646258936e-02   +2.509619722600930e-02   -3.265733238457461e-02   +3.688425522587810e-02   +9.773797957522611e-03   +8.514199057115997e-02   -7.633203429803002e-02   -1.348373318400852e-01   -3.771349145494662e-02   -4.183538699419825e-02   +3.339517186632986e-02; +1.266212810134035e-01   +1.255693940279956e-01   -6.536954189107652e-02   +1.792186926651680e-01   -2.260051945251631e-01   -7.198837899589241e-03   -5.506037761136121e-02   +5.920718506446285e-02   -1.459946566084817e-01   +3.049709477701740e-01   -4.037542994495653e-02   +6.849066062883470e-02   +2.876901336555957e-01   +1.811598551744121e-01   +4.709730767457366e-02   +4.527317148020012e-02; +9.934820820442872e-02   +3.793121302868960e-02   +6.539563849280464e-03   +1.908350606101190e-01   -2.659263364194736e-02   -3.840785802435961e-02   -1.644998419121510e-02   +1.773989713326436e-01   +1.209549719336649e-01   +1.068263517749454e-01   +1.301487983887961e-02   -1.786807477056991e-01   -1.431467818129070e-01   -2.911244721827601e-02   +1.999798263567211e-01   +7.685711836375043e-02; +9.448752811610125e-02   -2.498843187308646e-01   -1.207346659258842e-01   +1.947138343030271e-01   -1.799634673111921e-01   +2.817494612512358e-02   +6.363695976932975e-02   +8.450421344782666e-02   -8.384468991166014e-02   +4.222990057043816e-02   -1.557188999520728e-02   +8.252512010636175e-02   -8.818761439293150e-02   +1.309337549414191e-01   -1.860393901048200e-02   -9.034075551042578e-02; +2.482172231418797e-01   +4.137933205351287e-02   +1.815088873679382e-01   +1.588823562819124e-01   +1.452834277013806e-01   +9.567877816698381e-02   +9.937343071380751e-02   -3.749246826306701e-03   -1.377872502946930e-01   +8.244207066210379e-02   +2.864412474139968e-02   -2.401123523498508e-02   +3.210990503389037e-02   +5.047319830449803e-02   +1.292915947474040e-01   +1.741445130712023e-02; +2.071763133808603e-02   +3.554615290647124e-01   +6.936135839621174e-03   -9.392346702983823e-02   -1.234408379418485e-02   +7.884655763259107e-02   +9.793566549551840e-02   +1.611104305439118e-01   -8.892648503851734e-03   +9.245101841383435e-02   +1.552212344495725e-02   +7.423935628653880e-02   -7.550922875434374e-02   +9.650227869561395e-02   +7.902985643919677e-02   -2.246462627070903e-02; -3.053956749081915e-02   +2.290998971223309e-01   -6.399646024018806e-02   -1.060137767273185e-01   +7.457965353476717e-03   -6.638490569222311e-02   +1.262547657091804e-01   +1.313735426125122e-01   +1.560050600068427e-01   +1.169449188698430e-01   +2.203866225560510e-01   +2.097485467425990e-01   -2.192549290330977e-02   +6.301808778412035e-02   -1.333180585315361e-01   +1.627558970647220e-01; +1.147718449757800e-01   +8.383847698525725e-02   +1.567834089683704e-01   +1.046458624388962e-01   +1.518721721486476e-01   +2.385675022799439e-01   +1.041175582303905e-01   +9.764941108621319e-02   +1.076662876907440e-02   +6.276684561342306e-02   -1.283591089109104e-02   -9.112997039561105e-02   +2.131786400565198e-01   +2.760050232187145e-02   +1.384081319167646e-01   +1.366281465080379e-01; -9.365097187671473e-02   +2.679736866163568e-02   +5.454846175097296e-02   +5.353650738150563e-02   +9.666105344313633e-02   +1.583744150602734e-01   -2.183243451999132e-01   +2.548776545638931e-01   -4.576990383680693e-02   -5.735347255875559e-02   -3.579461367145173e-02   -3.988156986560711e-02   +2.355156520873143e-01   -1.330901856207160e-02   +2.044603513907731e-02   -7.396017241202649e-02; -2.668807404768387e-02   +9.164312838965924e-02   -1.028264524904155e-02   -8.995717209462956e-02   -8.977639965934170e-02   +1.361611258196176e-01   -1.855843278273756e-01   +2.251741348927569e-01   +1.691472239561560e-01   +1.188372265221832e-01   -1.251744579683660e-01   -2.073714961798002e-01   -1.836881184434050e-03   +2.515445683968979e-02   -1.204497139266876e-01   +1.447234255764108e-01; +8.992031188912335e-02   +7.005449356602014e-02   -1.565470377445174e-01   +3.794388113442309e-02   +7.975390500150770e-02   -1.102822851726597e-02   -1.074954556731322e-02   -5.397722496403232e-02   -9.635489825797439e-02   -1.696027404472094e-01   -1.011729879952600e-03   +2.965044749748657e-01   +2.780214209036974e-01   +7.634325064520713e-02   +1.877437174007730e-02   -7.866133313600940e-02; +9.644657160933523e-02   +3.946586831960970e-02   +3.043496675931571e-02   +1.088449615853921e-01   +1.498657596938164e-01   +9.823274404306047e-02   +1.090530237094668e-01   +1.321411707814823e-01   -2.004325642497531e-02   +1.982443282165769e-01   +8.953191882916989e-03   +2.185166339622502e-02   +1.033760794855100e-02   +7.595344079569628e-02   +2.974674239566186e-02   +1.760324524974520e-01; -2.127443393204727e-01   +2.558105184455829e-01   +7.082581132313569e-02   -1.945549558017927e-01   +1.118615500346366e-02   +1.514910730211521e-01   +2.100156861612622e-01   +8.793911802862078e-02   -6.769091070157229e-02   +2.360592327305848e-01   +1.200046786824380e-01   +2.363953241575099e-01   -5.395220654598500e-02   +6.252862609283373e-02   +4.159263410637629e-02   +1.139122060708772e-01];
L1E_L1I_iGABA_netcon = [-6.942006963571436e-02   +8.337953595895345e-02   +1.092488085946362e-01   -1.205271206332879e-01   -1.479033320677301e-01   +1.453373588119074e-01   +1.277506398124679e-01   -2.388112949287506e-01   +8.986076497804299e-02   +6.304430428572810e-02   -7.525581330081624e-02   -2.992460022135595e-02   -6.726439277346025e-02   +2.621381150477322e-01   +9.619214908305516e-02   +8.826693436765320e-02; +8.392719163932841e-02   +1.815730822880536e-01   +6.288722683724116e-03   +4.681564328045368e-03   +4.337047848547746e-02   +1.307921185634713e-01   -4.748859018875259e-02   -1.684284887031200e-01   -8.860291465163712e-03   +3.120339604395814e-02   +1.162035313505876e-01   -7.157148649798313e-02   -8.563122532772986e-02   -7.246724779483421e-02   -9.725482442423013e-02   -8.998526590276873e-02; +1.577141266256067e-01   +2.277626696358114e-01   -1.414544287745283e-02   -1.378526300824517e-01   +7.671569010106416e-02   +7.808135138575045e-02   +1.757302717314213e-01   -9.481669790338706e-02   -5.672674546596747e-02   +1.238466462015872e-01   +1.472441631394381e-01   -8.595420297248665e-02   +2.108248689330754e-01   -7.715912817351449e-02   +1.557577419166597e-01   -4.757713771513658e-02; +2.285341517444279e-01   +2.398553777083590e-01   +2.415001610912688e-01   +3.206924161513176e-01   -7.033677301049321e-02   -3.543677039601277e-02   +1.930034937453501e-02   +6.631838756968036e-02   +8.510841906475514e-02   -6.975899924937348e-02   +8.524323355473250e-02   +2.048641197101119e-01   +1.592119638554537e-02   -1.255450004837359e-02   -5.392671271570462e-02   +1.077515369303923e-01; -2.104616336776987e-01   +8.722372845774387e-02   +7.072270622683315e-02   +7.215980324647681e-02   -3.452580536474092e-02   +1.437714626118799e-01   +2.264675688501184e-01   +7.474580763118990e-02   -1.857245065371853e-01   +1.074568385487212e-01   +1.091423095073736e-01   +8.772299782949515e-03   -3.759296119199113e-02   +4.362887349339307e-02   +7.534366892600033e-02   +4.083096321599415e-02; -3.905070555936845e-02   +3.014410350107037e-01   +4.487683393607359e-02   +3.561307114184750e-02   +2.463727915500984e-02   +1.509033339361132e-01   -6.469162623884295e-02   -2.001773826067220e-01   +2.469735728779394e-01   +1.246986749384598e-01   -1.465850571494643e-01   +8.350008530381714e-02   +3.308793255257285e-02   +1.319865017129473e-01   +4.425620862991372e-02   +7.205966387790881e-02; +1.936954034599964e-01   +3.882453300924311e-02   +6.338580233491519e-03   -5.139032239288285e-02   +6.054978347582752e-02   +1.150161861557330e-01   +3.699946361831898e-02   +1.844292529811014e-01   -8.524089339491236e-02   +2.648290538024823e-02   +1.021476109878486e-01   +2.735488397540704e-02   +6.733383689855690e-02   -8.353767807590806e-02   +9.633284928744594e-02   +2.110679228355998e-01; -7.126227123385251e-02   -3.208559119546205e-02   +1.994993439165220e-01   +1.893401097890114e-01   +2.391352492023184e-01   +9.183244110869596e-02   +9.897849382955569e-02   +1.481510067015020e-01   +6.186775189774539e-02   -1.265901623523923e-01   -1.686562468921355e-02   +4.322502324517435e-02   +1.114223870922763e-01   +7.498642109548771e-02   -2.371967925559630e-01   +2.208848960473999e-01; +2.562641468364054e-02   +6.763092542335597e-02   +3.859398634362325e-02   -6.672540879536781e-02   -1.170916224442914e-01   +1.110945984413357e-01   +1.911909489801550e-01   +2.396014646936963e-01   -3.865644363132646e-02   +1.326367730221495e-01   -2.688489716778158e-02   +2.850195102146104e-02   -1.362468470058681e-02   +9.288155306047184e-02   +2.156201358436679e-02   -5.962653731734362e-02; -2.462295284038488e-02   +1.243264344975577e-01   +5.639113404588621e-02   +1.419998961575608e-01   +7.700646375449986e-04   +1.884137046192800e-01   +1.161531546859216e-01   -9.937311984739958e-02   -2.250101471505694e-02   +9.521230569064409e-04   +9.470678025856041e-02   -1.229105695248613e-01   +7.373009716949157e-02   +4.731632159883392e-02   +6.228833264660687e-02   +5.066947235230151e-02; -4.105685819941947e-02   +7.527659907768346e-02   -3.812097015063746e-02   +1.172487729283073e-01   -4.334401529692842e-02   +1.499617441219006e-01   -1.174068610211237e-01   +5.996816235501244e-02   -6.191456412489484e-02   -3.230120910072988e-02   +2.584998886766567e-02   -7.168841912972507e-02   +2.145669575808128e-01   +4.498192592604880e-02   +3.277963451779951e-02   -1.106696972011523e-01; +6.749252233643144e-03   +2.497439233447526e-01   +4.976811550795032e-02   +1.064800329531001e-01   +9.521937481929575e-02   +7.329212825645726e-02   -3.526009180780851e-02   +1.319457876827244e-01   +1.405348493471296e-01   -1.858824505629641e-01   +7.175249078036036e-02   +8.180858257328465e-02   -1.120782543697993e-01   -1.570500162683316e-02   +1.408303224964430e-01   -3.214366737942836e-02; -1.298256527697786e-03   +1.794958993740981e-01   -2.184842388321920e-02   +5.931610108603726e-02   -1.454900637619165e-02   +1.888849204628130e-01   +6.554793320628087e-02   +1.460783205258175e-01   -1.197999820831778e-01   +4.971484534037497e-02   +1.572756385101395e-01   +1.836088713623808e-01   +5.340889918672930e-02   +1.199889732467283e-01   +9.771983409165377e-02   -1.970044777135722e-01; +1.191881852854077e-01   +2.177450406900072e-01   +1.846995542941091e-01   -1.889878087191349e-02   +1.785387942169460e-01   +1.104435728646947e-01   +1.901571966631142e-03   -7.717964799104664e-02   -7.988467968305030e-02   +6.559776550628513e-02   -8.522944195826419e-02   -4.188025807949209e-02   -7.304291047521887e-02   -1.301983921446767e-01   +1.438007271490811e-01   +8.079198666346225e-02; -1.068039739386583e-01   -5.305953095444223e-02   -4.495756200163193e-03   +3.167775550333674e-02   +4.141300842692965e-02   +1.176801696719797e-02   -1.221102312005231e-01   +8.634535197511595e-02   -1.080435763780382e-02   +3.951500386935979e-02   +1.934260783675335e-01   -1.374509536191668e-01   +1.846935560801508e-01   -3.995203093794114e-02   +1.925108931413761e-01   +1.190788448528569e-01; +5.003404807343268e-02   +3.803359530867734e-02   -4.297804647103827e-02   +6.766620630867366e-03   -2.397517807166535e-02   +2.993167319311639e-02   -1.069992171066109e-02   +7.863945106282881e-02   -6.365894819477071e-02   +1.292751509043376e-01   -1.197443051758488e-02   -1.578646312556715e-01   +4.617020975767813e-02   +1.429300958991379e-01   +4.853202097050600e-02   +1.649744841994254e-02];
L2I_L1I_iGABA_netcon = [+2.614129055404776e-01   -7.136737813127182e-02   +6.250164679070198e-02   +5.782430176900455e-02   +1.037123717653089e-01   +4.007642969685133e-02   -1.281859225116463e-01   +6.938390587796869e-02; +1.048152977235888e-01   +1.383715892326949e-01   +2.157049099309934e-02   +2.989577395989275e-01   +6.573411130793105e-02   +1.904767342456819e-01   -5.811531559013511e-02   -2.127781493577189e-02; -8.364962350738120e-02   +1.465078530929244e-01   -1.639954483243900e-01   +2.042989240894822e-01   +9.763754171533856e-03   -5.832142476178731e-02   -1.557719637968578e-01   +6.945489973645677e-02; -6.116441300321861e-02   +1.139805356244200e-01   +1.265722620711237e-01   -5.584086484110343e-02   +6.393731574163581e-03   -1.518570066741353e-02   +6.878001479343948e-03   +4.306994593714229e-02; +1.841168965587118e-01   +1.570011555456634e-01   -1.286319939933265e-01   +1.192696002648479e-01   +6.600969204780066e-03   +1.878067805057400e-01   -1.859438524242333e-01   +1.091550043038896e-01; +1.344302620166106e-01   -1.005485141986953e-01   +2.365361957134215e-01   +1.205534734262787e-01   -1.072124538226363e-01   +1.317850909235825e-01   -6.848225262440730e-02   -3.521272041647966e-02; +1.662063795878879e-01   +2.848632902818660e-02   +9.482801861776280e-03   +1.893779670250816e-02   +1.021983116571542e-01   +2.638175449510261e-01   +1.673038012590508e-01   +1.625908562631163e-01; +8.410127019027082e-02   -3.918446920556638e-02   +6.661235348783155e-02   +1.859550425879218e-02   +9.461891526684230e-02   +9.182787773791251e-03   +2.291624210529614e-02   +4.276112453641098e-02; +3.752722707131782e-02   -1.214482107437349e-01   +8.675455103984596e-02   +1.474977247561748e-01   -8.617782779361344e-02   +8.115376994685598e-03   -9.866851977405547e-02   +2.225449516585795e-02; -5.958441465273780e-02   +1.305840380202223e-01   +6.269302400857614e-02   +3.273733291388657e-02   +1.951270937418013e-03   +2.230866076621217e-01   +6.972197350994885e-02   +1.506862764717449e-01; +1.443957323623267e-01   +7.243260126064854e-03   +7.001459363899142e-02   +5.465769802945396e-02   -5.047559079760437e-02   +1.717917831291448e-01   -6.715713714490747e-02   -3.257093759826082e-02; +6.702543056602625e-02   +1.327082942856667e-01   +1.043075718013726e-01   +1.139607552994672e-01   +2.285065927806478e-01   +1.430092498984957e-01   +5.553649235202999e-02   +2.482077591878017e-02; -4.259228797594679e-02   -1.472858643179022e-01   -2.710692438821025e-02   +2.844482880686994e-01   +7.766796347737359e-02   +1.456395352375920e-01   +8.846113652297791e-02   +1.369733837605519e-02; +5.698320871023876e-02   -9.263574126003454e-03   +2.176292286869307e-01   -3.607174711024060e-02   -9.116295028297333e-04   +1.180767534006086e-01   +1.100575836902989e-01   +1.531994712752373e-01; +2.328319138452074e-01   +8.094612173646266e-02   -1.091326999602816e-01   +3.033783842329698e-02   -2.487685172820558e-01   -2.933358001837268e-03   +2.527535008584016e-01   +2.849231274297682e-02; +2.949762344770188e-02   +2.138486852988143e-01   -8.303727167717004e-04   -1.947944308848086e-02   +7.178832380471284e-02   +7.444789691229287e-02   -4.610319973298999e-02   +6.532213010435359e-02];
L1I_L2I_iGABA_netcon = [+8.104662845710664e-02   +1.993626108458169e-01   +1.942772116584124e-02   +1.210719388289348e-01   +3.016158063263986e-02   +1.828216543142001e-02   +1.241713698380599e-01   -1.983821698765830e-01   +1.443882281423685e-02   -8.836525916029517e-02   -5.077187848092808e-03   +1.003056543788348e-02   +8.359572987921238e-02   +2.827081058401582e-01   -3.605959188681244e-02   +1.215437883491541e-01; +1.297278883735452e-01   -5.274749211846495e-02   -5.198755572510079e-02   +1.662116045446438e-01   +1.595810649300686e-01   -1.280258536997868e-01   -1.088338618588183e-01   +6.462783149927626e-03   +6.386368608138365e-02   +1.670195599626308e-01   +5.882528515345278e-02   +8.021331803610865e-02   -1.372204078940919e-01   +7.693974077374224e-02   +2.888302254423481e-02   -1.251195031066953e-01; +7.740345159169906e-02   -5.656605618797661e-02   +1.229636557360678e-01   -1.619467714210082e-01   +1.443464803029548e-01   +1.165065041767043e-01   +1.717443304650413e-01   -8.510438553719349e-02   +1.365918463741938e-01   +5.327202386464723e-02   -5.167053353074308e-02   +2.443373392915673e-01   -6.840600501902927e-02   -6.715481073020038e-02   +1.211102007651173e-02   +1.995443436370512e-01; +1.000823562185440e-01   +1.658285049947803e-01   +6.355649927528081e-02   +1.113375893961023e-01   -3.159191682299092e-02   +1.788497233733730e-01   +4.982143578595070e-02   -8.257610503978816e-02   -1.712850878018356e-01   +1.443387806965234e-01   +7.396856137896281e-02   -1.074309379710418e-01   -3.672285820647594e-02   -1.021519450433671e-01   +3.313217734196205e-02   +4.846647790674792e-03; +7.021688716731186e-03   +1.527941832601451e-03   -3.037731610757879e-02   -1.289258924944875e-02   +1.086192826140893e-01   +2.714036958882960e-01   +9.991124834954981e-02   +2.841474409430663e-02   +1.072881698970685e-01   -1.272716142351905e-01   +2.056486060075093e-01   +6.236052711795394e-02   +7.751663933033093e-02   +1.757794839800858e-01   +4.970948055225654e-02   -1.917296489696614e-03; +1.973760474847475e-01   +1.220630364007117e-01   +1.479054521180003e-01   +1.034646618766605e-01   -1.259271589989303e-01   -2.721104279725280e-02   -1.260682833891597e-01   +7.198685881360270e-02   +1.220864266810115e-01   +2.317363227855040e-01   -3.710626590885306e-02   -8.826061691069913e-02   +6.384679620403955e-03   +1.965386579398537e-01   +7.535578479868747e-02   +2.769317757109118e-02; +5.882103235656476e-02   +1.002896309622956e-01   +7.348951969148378e-02   +9.771167579794768e-02   +2.414178868991874e-02   +1.084250286496445e-01   +8.486081446526911e-02   +3.819765787930451e-02   +2.094809554301601e-01   +6.983751023919024e-02   +1.687935597405429e-01   -2.156219880920293e-02   +3.102658212116177e-02   +4.899538998880298e-02   +8.515972008103002e-02   +1.198386667335336e-01; -2.406494531924700e-01   +6.219381611140724e-03   +3.648494673238428e-02   -5.496332656938933e-02   +4.829477619860709e-02   +3.827108139677058e-02   +8.299372496384334e-02   +5.511312333561020e-03   -6.605195754588938e-02   -1.005376391033295e-01   +4.176855030455279e-02   -1.229017178072435e-01   -1.723497822600434e-02   -6.170779834874489e-02   +2.286037110842261e-01   -9.228764316306197e-04];
L2E_L1E_iAMPA_netcon = [+1.106543644508419e-01   +2.617806473408992e-02   +3.573702549761000e-02   -5.592789371249603e-02   +4.665618401958294e-02   +6.968573900107358e-02   +4.197840088224089e-02   -8.658983582766715e-02; -2.710187345233669e-02   +1.412112698488583e-01   -4.711817556718560e-02   -7.387315417751936e-03   +2.155196815997582e-01   +1.146755624399576e-02   -6.528062493782570e-02   +7.686853083917575e-02; +1.052970912356651e-01   +2.694887244116155e-01   -3.028127921236098e-02   +1.143891122224884e-01   +1.173725535777072e-02   -5.247038171096277e-02   +5.537614546410469e-03   +9.067596990635381e-02; +3.929896845551162e-02   -7.983698629993109e-02   +1.476796214820417e-01   +2.123450926149661e-02   +9.589614384427875e-02   +1.440037347397576e-01   -3.748444131288071e-02   +2.111854536430742e-01; +5.053742675912581e-02   +1.280058791678770e-02   +1.080422984212936e-01   +2.205324578777999e-01   +3.616429919668596e-03   -1.521397823089370e-02   -5.994292492720188e-02   +1.220307918441526e-01; -1.627229810396633e-04   -1.282142142003116e-01   +5.126291504479635e-02   -1.332993874706580e-01   +1.841910473389411e-01   +9.600557302776086e-02   -5.892100975424776e-02   +4.224698766098625e-02; -1.384295885924133e-03   +2.498269627163389e-01   +1.556319149145140e-01   +9.281959159159389e-02   +8.580773098700342e-02   -7.357563376120571e-02   -1.492527329921221e-02   -1.002110234062002e-01; -2.902457584205429e-02   +1.830147082651015e-02   +6.968493284386595e-02   +8.387001665721211e-02   +1.303971000073368e-01   +7.632315869880296e-02   +6.385765933873365e-02   +1.787732877807427e-01; +2.372317555507616e-02   +1.777785378161950e-01   -9.052561054591561e-03   -1.517698870409435e-01   -1.338029969322857e-02   -8.874770484833547e-02   +2.516922790015012e-01   -1.080799649417704e-01; +1.180953501073070e-01   +6.593808143726998e-02   +2.498712358526188e-01   +1.297312603957969e-01   -6.478787132751229e-02   +1.650505011674153e-01   +1.228086482736409e-01   -7.517860693931060e-02; -4.438978894240550e-02   -1.590049792358545e-02   +2.388172854205691e-01   -1.356906716840798e-01   +2.769295393495621e-01   -4.812462351755468e-02   +8.189909844176042e-02   -1.253402177754667e-01; +1.130039265051408e-01   +1.065629225378546e-01   -9.955464663297618e-02   -3.082388050315945e-02   -6.902712264253522e-02   +2.053906312743912e-01   +2.573813863317467e-02   -2.769824720732059e-02; -1.741236055833054e-02   -9.034022083616038e-02   -1.113306270478194e-02   -1.570211093483015e-03   -6.957362141417807e-02   -9.648578068472974e-02   -2.276270597557289e-02   -3.631234881276819e-02; +3.220870313791019e-01   -2.817472047552019e-03   +3.226790117012435e-04   +8.429170871902976e-02   -8.032642308857071e-02   +1.699325717531315e-01   -4.970182684221434e-02   +3.073010757424027e-03; -1.311933563539694e-01   +1.984098482194952e-02   -1.581044858184367e-01   +1.584042634048087e-01   +5.472047678667363e-02   -7.825748850989298e-02   +1.577195658327021e-03   -1.856284731863553e-02; +3.941822630495812e-02   +3.881139747755673e-02   +8.139055758271017e-02   -1.728781664249647e-01   -1.248396296210284e-01   +2.780829460457461e-02   +2.338748023423947e-02   +5.369829269283531e-02];
L1E_L2E_iAMPA_netcon = [-2.461709997421052e-01   -1.418440509594020e-03   +1.856735699803631e-01   +5.489802019414682e-02   -7.573629010099683e-03   +1.159441305277762e-01   -6.187031510109603e-02   +8.394667945164418e-02   -6.896944668236221e-02   -6.576100959062785e-03   +6.545201134139185e-02   +1.547582863898898e-01   +6.868378762184527e-02   -1.691632179507101e-02   +1.000224930751232e-01   -7.462127738370941e-02; +4.327453103819356e-02   +5.772911572902340e-02   +1.627840885114934e-01   -1.349403964800432e-01   +1.219652257785282e-01   +1.038365651132473e-01   +2.027317365776031e-01   +4.243795382281153e-02   +7.532934684224019e-02   +3.767931501910333e-02   -1.733217106515652e-01   +8.800642284002164e-02   +1.653191763436254e-01   +2.473229643405854e-01   +1.466104286058174e-01   -8.927457219413584e-02; +1.649555801223711e-01   +1.223876743506526e-02   +1.594688382236493e-01   +1.041645844343124e-01   +1.942032689936757e-01   -1.263724564657315e-01   +7.925718357764389e-02   -1.558196680917602e-02   +6.124795541798621e-02   -6.432281139120620e-02   +1.369436203161813e-01   -7.330703621325582e-03   +6.757653197533471e-03   -3.896437322577574e-02   -8.171396779403595e-02   -3.180813424069800e-02; -1.305161386115313e-01   +1.056365999338647e-01   +1.679570848575407e-01   -5.393789288382602e-02   -1.023211654293554e-02   -8.910342799389077e-02   +1.665030594790279e-01   +4.745316294662151e-02   -1.964438542935947e-01   +6.224831941572302e-02   +1.191698954285400e-01   +8.505676942486567e-02   -7.448169672141125e-03   +7.382215896038512e-02   -7.832806521873582e-02   +2.218614553694070e-01; -1.489347202221540e-01   +1.857810943549559e-01   -1.487004277875463e-02   -1.905487565347700e-01   -3.063015874309155e-02   -3.319145002806032e-03   +6.637069121936151e-02   +1.620194780847888e-01   +9.074392068567280e-02   +1.794040657146584e-01   -1.799105249256123e-02   +9.908354621775611e-02   +8.460293078806165e-02   -5.063809312280920e-02   -7.996282921186645e-03   +1.628834673339699e-01; +9.553274455502993e-02   +1.020994192342555e-01   +1.376189513578487e-01   -4.448597295049490e-02   -6.970426684587416e-04   +7.944553159701323e-02   +1.114620948791220e-01   +2.099723179072778e-01   +5.932647208308330e-02   -3.749713377747056e-02   -4.988987113609206e-02   +4.087398433079566e-02   +2.113726349170300e-02   +2.808014373298848e-03   +1.544975640181278e-01   -2.273952960614586e-01; +8.517574352759689e-02   +7.604197206422830e-03   +4.065838499330111e-02   -6.025201458577016e-02   -6.272305407795802e-02   +1.040648788231724e-01   +2.271577678508273e-01   +2.000877534351900e-02   +6.027211951084380e-02   +2.072794649484813e-01   -1.069323764108341e-01   -1.307616958708010e-01   +2.657921553889949e-01   -1.687936268937781e-02   +9.825586228269473e-02   -1.050600542539669e-01; +2.077027665845355e-01   +9.442537673763486e-02   -2.095724489224299e-02   +7.819882875843402e-02   -8.733729636068825e-03   -5.393994199611962e-02   +1.335759796493995e-01   -3.045009022042878e-02   -2.565652378325141e-02   +2.832648098267072e-02   +7.171802544813526e-02   +1.232908594016179e-01   -8.250392737571509e-02   +6.804741752089252e-02   -2.016451227359963e-01   +2.751869220059306e-01];
L2I_L2E_iAMPA_netcon = [+2.216572082334941e-01   -7.824562342025281e-02   +7.221741671188872e-02   +6.763027076645220e-02   +3.748969228283005e-02   -2.858745671285929e-02   -1.417520185805375e-02   +2.546949567650898e-02; -1.090859498273076e-01   +3.716613221140255e-02   +9.431872165828081e-02   +1.767832006982200e-01   -2.693462347875084e-02   +6.956328445544852e-03   +7.866822467747475e-02   +1.359978166030436e-01; +1.843830836438598e-01   -1.879838868047239e-02   -2.687330837381226e-02   +1.327705179525601e-03   +6.206818271298500e-03   +1.464949433865405e-02   -9.493189024232275e-03   +2.505895513331130e-02; +3.184664676540541e-02   -3.082408494617438e-02   +1.251381356560962e-02   -1.959766020812430e-03   +5.090190202361095e-03   -3.226393293472482e-02   -9.098763567314844e-02   +1.137330095409502e-01; +7.703557733970717e-02   -1.853457658533453e-01   +4.115249031427057e-02   +5.217747685254615e-02   -2.498867790319882e-02   +1.513678478227785e-01   +1.256021770316159e-01   +3.783312155959737e-02; +1.388330314151697e-01   -1.633678950204239e-01   +4.749472040175318e-02   -1.763845077322165e-02   -3.685795194322061e-02   -3.225913259082794e-02   +1.827579866444849e-01   +6.745158991875062e-02; +1.338710935656263e-02   -5.655272685088138e-02   +1.061638645611424e-01   -8.706915511105633e-02   +1.221204461938289e-01   -1.885455803094866e-01   +6.282657991345793e-02   -1.237331620444318e-01; +2.269373480836015e-01   +1.877520673116721e-01   -1.001260373773557e-01   +3.277703733191445e-01   +2.366822561240339e-01   +6.350052980132195e-02   +4.807381851365385e-02   -1.389746428712620e-01];
L2E_L2I_iGABA_netcon = [-6.300522731350018e-03   +1.218189459580656e-01   -8.716414877122339e-02   -4.145141817608194e-04   +6.702929623399635e-02   -2.054120926982990e-01   +1.944964007514418e-01   +1.513917191774914e-01; -2.528034873745393e-02   +2.309705916336340e-01   +7.817273827059332e-02   +2.009677777622124e-01   +1.941718006947080e-01   -9.652810297036309e-02   -8.514375140293717e-02   +1.243444107698236e-01; +2.495265436188265e-01   +5.006150839678457e-02   -1.528892844511718e-01   +1.705386493517926e-01   +6.888880133098296e-03   +8.743288913324955e-02   -5.859978620308006e-02   +3.666347508396662e-02; -2.333603223169774e-03   +1.400903952347911e-01   +3.053606242675251e-01   +3.334583709611870e-02   -4.079371849562288e-02   +1.069256647469080e-01   -2.041718701458810e-01   +9.446130333536853e-02; -5.654448072763255e-02   -1.611062428811689e-02   +1.975832110905819e-01   -1.407858123722210e-01   +1.427872786391995e-01   -2.223662255684977e-01   +1.301175812966811e-01   -5.037780871669573e-02; +1.739406014185230e-01   +1.290533414819185e-02   +1.089565021535020e-01   +8.473315721529863e-02   -2.398151378829455e-03   -4.235078870460353e-03   -4.186519902730386e-02   +6.001387187111136e-02; +2.718999351332060e-03   +1.956236153322431e-01   +4.450063518808400e-02   -4.717982391657883e-02   +2.140779647035636e-01   +2.203696617314907e-02   -1.213895736398784e-02   +2.859826491211870e-02; +6.068312510680769e-02   +2.386070948821520e-02   -5.395327928954113e-04   -9.926483778695752e-02   +2.497852166441496e-02   -2.400767343993588e-02   +1.147125813985740e-01   +1.101603132131623e-01];
L3E_L2E_iAMPA_netcon = [+9.255496499888076e-02   -1.314769004085739e-01   +2.892169716402346e-02   +4.691652338465527e-02   +5.464642213639748e-02   +5.690501805241801e-02   -4.368295859287578e-02   +3.265699748994377e-05   +5.921519625559130e-02   +1.539368537225711e-01   -5.316971322155441e-02   +9.178838665209078e-02; +1.500967476469646e-01   +1.496474877968385e-01   +2.719343645258441e-01   -7.960438664715987e-02   -1.665681262516722e-02   +1.294199337235035e-01   +1.901770602027195e-01   -1.441539028161967e-02   +1.028364040321439e-01   +5.082618403700179e-02   +1.413307260096766e-02   +3.202078105619732e-02; -3.975811844569355e-02   +1.367777159581007e-01   -2.245022723262105e-02   +2.001447211464918e-01   +2.162969694175812e-02   -1.087550763315162e-01   +7.448167917995169e-02   +1.040907397716244e-01   +4.714143585115494e-02   +7.508238411787872e-02   -1.820428681816363e-02   -1.977164321303898e-01; +1.634805544775618e-01   +2.050530644784295e-01   +1.137657988122729e-01   -1.106789167885266e-01   +9.682877541789231e-02   +1.089120783377089e-01   -1.901708351760073e-02   +3.234221874150878e-02   -1.179592715603455e-02   +6.889728486409397e-02   +2.407864668237158e-02   +8.085787756043653e-02; +2.730744872345143e-01   +6.799631136636243e-02   +2.107896419435591e-02   +1.958243783552961e-01   +2.285573685830471e-01   -6.720934742982776e-02   +8.202886316770125e-02   -1.697333655319259e-01   +8.220841218349764e-02   +1.064849084756447e-01   +8.738958130930138e-02   +1.858921428408225e-03; +3.231466286834822e-02   -5.009092729049750e-02   +1.810590586986471e-02   -1.192496624412048e-01   -2.733083995378141e-02   -4.601193126326616e-02   +1.810947419844961e-01   +4.050157788911852e-02   +2.189712324187776e-01   +2.088039265101023e-02   +2.545889280478115e-02   -5.955166710538913e-02; +2.607410540920793e-01   -1.635009255195791e-03   -1.327041935256468e-02   +9.944271641148204e-02   +2.062936358645529e-01   +8.994138883000831e-02   +3.253477462413099e-02   +1.326009144605591e-02   +9.104543064927327e-02   +7.940198228757335e-02   +1.567351428605842e-01   -7.895544248147557e-02; -6.345254706929285e-02   -6.281345877054811e-02   +1.010289432805080e-01   +3.124084880898603e-03   -5.733315206412583e-02   +3.025606668623894e-01   -1.836027429915089e-01   +1.048756479496484e-01   +8.441702311896887e-02   +7.968891293708691e-02   +8.655994794210789e-02   -4.605098564534179e-02];
L3I_L2I_iGABA_netcon = [+5.046997480107583e-03   -7.260576229633980e-02   +9.714314991250841e-02   +1.278107697928368e-01   -3.640039029612618e-02   -9.383486548421116e-02   -4.269530375743186e-02   +1.841672884969059e-03   +2.475762758879355e-01   -1.014303477339070e-01   +2.285109986899055e-02   +2.575702679469541e-02; -1.154989113963840e-03   +1.095822256768981e-01   +1.755649554667209e-01   -5.099796921046065e-02   +9.919341902632253e-02   +4.947006304242257e-02   +2.112153681765227e-02   +4.710999273814867e-03   +8.425450148826023e-02   +1.878638024444284e-01   +7.102982515309664e-02   -4.731868891752605e-02; -8.681635147133038e-02   -2.619107637819040e-02   +4.554283713450136e-02   +2.198891701676912e-01   -1.614783879883060e-01   +4.112637863402778e-02   +5.035294090265029e-02   -9.242187822339126e-02   +1.522388042782530e-01   -6.505825537070722e-02   +1.836773397911805e-01   -6.875766049148768e-02; +1.526999645622516e-01   +8.634277840456328e-02   +1.616494305515361e-01   -1.966198495881035e-01   +4.961862932724316e-02   +1.416645434219442e-01   +1.034652903308038e-01   +1.885212858197177e-01   -4.674086425681028e-02   +1.380005544311927e-01   +8.156737422589033e-02   +2.493915098429328e-02; +1.349294546562197e-01   -5.562525007319248e-03   +8.024513404962758e-02   -8.567038417007802e-03   +6.529941342777112e-02   +5.931844406350720e-02   +1.926388883735401e-01   +1.050416650630490e-01   -7.143496631383334e-02   +8.684917192757061e-02   +2.697723688436434e-01   -2.306297896831371e-02; +2.060284120644148e-02   +3.025856233643674e-02   +1.185887244131454e-01   -9.049738696105851e-02   +1.614551866855216e-01   -8.088076536591340e-03   -8.677770484494192e-02   +2.454265207950005e-01   -9.671914310284808e-04   +1.681127183973181e-01   -6.758078761545964e-02   +1.975336997353250e-01; +1.828825069906983e-01   -7.605269944672591e-02   -1.548239434195589e-02   +7.977291828594370e-02   +2.548177528382559e-03   +2.286518599090363e-01   -1.175566824692656e-01   -4.147317135202444e-02   +1.555858499830398e-01   +1.577324684720359e-01   +1.209846362394254e-02   +9.371295297089044e-02; -5.264063405141600e-02   +2.336952683964491e-01   +1.282994438103358e-01   -1.294540213619346e-01   +1.583795324482616e-01   +7.566353636564677e-02   -1.592758586560977e-02   +1.326083118722270e-01   +9.379208000957431e-02   +1.312772713571046e-01   -1.113847943824372e-01   -8.768665844293355e-02];
L2E_L3E_iAMPA_netcon = [+3.233916733054033e-02   +2.014570032768694e-01   +3.880274204931119e-02   +5.085972206090405e-02   -3.688703762499745e-02   -1.185854734489549e-01   +1.303435084283766e-03   -3.773302514440226e-02; -1.375967514451308e-01   -2.000854707095916e-01   +1.534179176437679e-01   +2.543129355559232e-01   +6.802142215949847e-02   -2.768679645590518e-02   -4.944984342693087e-02   +1.139756956527643e-01; +6.902720975115224e-02   -1.946631056267688e-01   +1.342788676153863e-01   -7.408080661042303e-02   +5.534816602585534e-02   -8.497977697597275e-04   +1.496041414057140e-01   -2.680492452438583e-02; +2.514822843805177e-02   +5.725010586016102e-02   +1.297357827160820e-01   -5.121819186774528e-02   +1.750564739300694e-01   +1.814128366200992e-01   +5.226074969191709e-02   +2.434789626164150e-01; +1.753708187194380e-01   +9.657295122911472e-02   +7.124871437833891e-02   -6.246484366412792e-02   +2.356824768701389e-02   +1.563827813469975e-01   -8.588584751451786e-02   -8.018862145035491e-02; +2.405941823178412e-02   +2.083653737422967e-01   +3.624511500267341e-02   +7.182056275210370e-02   +1.384406178961716e-01   +3.059221983311146e-01   -3.528233848344364e-02   +4.982506930738102e-02; +7.052792157407477e-02   +2.449534279567897e-01   +2.428433382587044e-01   -4.847210956550397e-02   +7.320300650086708e-03   +2.136616548446145e-01   -2.123677859381993e-02   +9.659766791869015e-03; +5.394941878349101e-02   -1.177441273654695e-01   -1.325016161002905e-01   +1.811790719673100e-01   +3.051370599506623e-03   +1.291836169331986e-01   +1.570661773000671e-02   -8.255785075977567e-02; -6.179467275612725e-02   +1.821424461265052e-01   +1.324209459735319e-01   +1.018423905752445e-01   +1.463939196695462e-02   -7.348507900946846e-02   +3.227119735177032e-02   +5.363237796843938e-02; +5.104677884593606e-02   +6.161036301964423e-02   -1.301627855152811e-01   +7.173840649421198e-02   -9.348420750508385e-02   +1.151805010987794e-01   +2.660244969973974e-01   +1.026935100775563e-01; +1.236923882486817e-01   -8.478106393584889e-02   -2.887729317438595e-03   +3.618176912472201e-02   -3.073397606151193e-02   -1.920691927232717e-02   -7.837931658061184e-02   +1.010530592520192e-01; +5.957087820938269e-02   -1.835838593964445e-01   +1.792461999772068e-01   +8.871972539037842e-02   -3.473289259438993e-02   -1.330480276335558e-01   +2.285678565106407e-01   -3.618150709888070e-02];
L2I_L3I_iGABA_netcon = [+5.801890340163404e-02   +1.620215882023961e-01   +1.477519385445760e-01   +2.183794256433182e-01   +1.417448819605822e-01   -3.521044060214439e-02   +1.041859996736728e-01   +2.073697056908579e-01; +1.175658035730076e-01   +2.464961702594946e-01   +2.196601585983499e-02   +1.265018172016792e-01   +1.970016784769805e-01   +1.144875608195580e-01   +6.409380830831735e-02   +1.062028055539357e-01; +9.058716043394227e-02   +1.273155939782165e-01   -1.824063738345549e-02   +6.533119646396961e-02   -8.474962786943295e-02   +1.104209644385501e-01   +1.504467490521119e-01   -7.911802375156224e-02; -6.135080385561870e-02   -1.085991946467151e-01   -7.920322120684477e-02   +1.222679691090616e-01   +1.708489440190073e-01   -4.218230452878174e-02   +9.209849929605671e-02   +1.856690417980059e-01; +1.113392858665318e-01   +1.814456140084893e-01   +2.510388817107665e-01   +1.557526959920611e-01   +8.791613681021319e-02   +3.692605035147585e-02   +1.142319838708518e-01   +2.004421894847680e-01; +6.494623402827853e-03   -1.462689802678641e-02   -2.550450868182784e-02   +1.319317368993854e-01   -3.377400588463193e-02   +2.307964668392664e-01   +3.852516264802545e-02   -5.184378514652279e-02; -7.870916890367721e-02   -1.717917048329939e-01   -2.639910209077236e-02   +1.474542909757899e-01   -5.124072263016134e-02   -1.130013334499270e-01   +2.752154457973123e-01   -3.524655224880220e-03; -2.522975990583566e-02   +2.315649069707715e-01   +1.108015716584073e-01   +3.757487969076183e-02   -7.902012957255617e-03   +1.051979713974297e-01   +7.507555479016324e-02   +9.564117046367479e-02; +7.189752058661063e-02   -4.610418019989344e-02   +7.165477052583780e-02   -1.241568245802877e-03   +7.444701896589621e-02   +1.871778801542554e-02   +7.192829075588561e-02   +1.170420944833791e-01; -1.131549093910465e-01   +9.789808370358544e-02   +5.635701064594352e-03   -6.345842284110724e-02   -6.813984615715241e-02   +7.056805458901293e-02   +1.219124088932118e-01   +1.398119091007169e-01; +1.879105554740536e-01   +5.360456119797281e-02   +9.658948659496565e-02   +8.908968928412778e-02   +8.198904632157629e-02   -3.924035951052351e-02   -1.105304000310117e-01   +2.283710597022888e-01; +4.223859487669442e-02   -3.031288873810330e-04   -3.027943190996699e-02   +1.327544801226824e-01   +1.417338134367276e-01   +9.309565506065279e-02   -3.570224757960790e-02   -2.509845380707522e-02];
L3I_L3E_iAMPA_netcon = [+1.669841085905644e-01   +1.413725728075420e-02   +1.152553297578919e-01   -8.685224992396701e-02   -8.952895176863707e-02   -4.633920467748714e-03   -3.467852828162342e-02   +1.535835145641924e-01   +1.277272886471100e-02   +6.024743216811720e-02   -4.212877295122615e-02   -5.660852760780571e-04; +1.150512303082688e-01   -3.418546421814678e-02   -4.773778185658796e-02   +2.780642734505309e-01   -6.063208202787627e-02   -5.793914712017363e-02   +6.000601027951610e-02   -6.294986697883873e-02   -6.803985641853338e-02   -1.082548575994533e-01   +9.692228671002937e-02   -4.654721395760132e-02; -7.020728640850252e-03   +3.018813638270605e-02   +1.864694413569299e-01   -1.719520861691868e-01   -2.553552014892452e-02   +3.284355182716209e-02   +2.388058411495937e-01   -6.478556985286876e-03   -2.875510175127965e-03   +1.155923419491277e-01   +4.309239275833024e-02   -1.110615517858118e-02; +1.908305381798324e-01   +3.956324027841480e-02   +4.321432027300501e-02   +7.358945691604292e-02   -5.378843577204558e-02   +1.149155924254347e-01   -1.640075364919403e-01   +6.036120643432178e-02   +1.550087349664550e-01   +1.558048345404744e-01   +7.168202969555770e-02   +1.392094531521197e-01; +1.841624185633760e-01   -1.090018439677955e-01   +1.853019973607650e-01   +9.657723142881369e-02   +1.711870971434575e-01   -4.845009117308412e-02   +1.881096647212083e-02   +5.459064328879479e-03   +7.632739931176274e-02   -6.084606265047694e-02   +3.494290713750832e-02   +1.331465965985617e-01; -1.870228668551183e-01   +1.624127033157600e-01   +1.525899232924463e-01   +1.192651110269082e-01   +4.829157669753532e-02   -1.431073314232499e-01   +1.150920477263291e-01   +1.265863256320656e-01   +1.123120004958825e-02   +6.222007447557101e-02   -1.089217606400149e-01   +2.896017396429640e-03; +1.697203301816017e-01   +2.789810918748554e-01   -4.672566259017653e-02   +8.797017969009097e-02   +7.536419924175605e-02   +6.627031350874936e-02   +2.077355393918267e-01   -2.332541656430870e-02   +5.877574535936226e-02   +1.468437613892770e-02   +5.853744534204026e-02   -3.499419337368805e-02; +5.925518796651034e-02   +1.293366305489013e-01   -3.719816636236458e-02   +1.101644961658605e-01   -1.258486835133513e-01   +1.422404010610382e-01   +1.508507366281325e-01   +4.287868293254644e-02   +1.789216513986348e-01   -4.332314715240757e-02   -3.784659693298806e-02   +3.540314626616113e-02; +1.546738910828396e-02   -6.848114951021499e-02   +2.399031638866386e-02   -5.457351203600436e-02   +1.016496926724640e-02   -7.216151381375764e-02   +1.321069410446877e-01   +1.776974487330967e-01   -4.874099134450403e-02   +5.205313906976639e-02   +1.150693326559472e-01   +9.005892030077504e-02; -4.284182107194799e-02   +7.077448521107255e-02   +8.354393457676619e-02   +2.914918203321493e-02   +8.426265023394640e-02   -1.301873832787667e-01   +2.714427490187640e-01   -4.044168575267554e-02   +1.215173566912271e-01   -8.740139283126980e-02   +6.813819529245936e-02   -2.140268745685997e-02; +4.640287535975790e-02   +2.269484208771689e-01   -3.391723345145694e-02   -1.183760319897642e-03   +5.999987122764575e-04   -1.248628084493281e-01   +1.208077323921542e-01   -4.563465195549907e-02   -1.065264869865578e-01   -8.295839424082870e-02   +1.401564712781750e-01   +2.098527230016509e-01; +1.016750934701056e-01   -3.546576243619411e-02   +1.926878024533626e-02   +2.124390566690466e-02   +2.241948461380511e-02   -4.340156039163836e-02   -2.358530591184405e-04   +3.247081323348722e-02   -3.410057679203497e-02   -1.557336367937691e-01   -2.870146434294380e-02   +7.611695740870793e-02];
L3E_L3I_iGABA_netcon = [+1.815208283907814e-01   -6.883290834527306e-02   +4.240324998229487e-02   +1.359137576636479e-01   +1.330365578981725e-01   +7.004587669452550e-02   +1.074520790032742e-01   -1.844708685205922e-01   -1.440755264000551e-04   -1.338256287517489e-01   +1.485420331070539e-02   -2.101689108600997e-02; +2.517383680172749e-01   -9.989519741306699e-03   -1.083963987467039e-01   +2.077812508612333e-01   +3.053327613878332e-02   -5.258071108368258e-02   -5.600601965427352e-02   +6.560634779785579e-03   +2.283312909858623e-01   -4.880571255618814e-02   +1.814737369733883e-01   +6.328557268122860e-02; +1.650034781145356e-01   +1.850595637423301e-02   -2.849026105475126e-03   +5.545353370386800e-03   +8.523214562667260e-02   -1.322375239518093e-01   +1.611029207653187e-01   +2.605530940112081e-01   +1.083172205608037e-01   +9.143716262917773e-02   -1.285319548504172e-02   +1.565866270501941e-01; -1.369897135770098e-02   -5.433940674145502e-02   -1.311359075444633e-01   +1.227992803123490e-02   +3.544344990245504e-02   +1.610249329634168e-01   +6.182500209243551e-02   -1.796494305745215e-02   +1.062733226916045e-01   +2.244182396276138e-01   +1.147576541310075e-01   -1.344371358142340e-01; -1.183647926866621e-01   +8.437924833840868e-02   -8.171467493077882e-02   +4.123883569075311e-02   -2.243950037504530e-02   +1.165495673618197e-01   +3.098782597687364e-02   +1.229396106443422e-01   +1.304830297936233e-01   -5.679733258587107e-02   +8.114522430756214e-03   -2.049301137752140e-01; -7.842171551291108e-02   -2.020143336349892e-01   -2.177946793042879e-01   +1.999173020171519e-01   -8.871385679738004e-02   +2.321393759154367e-01   +1.394800492660681e-01   +1.143134946593068e-01   +1.499170776280152e-01   +7.898702965930784e-02   -9.222076124557582e-03   -1.057573322348994e-01; +1.459999596907514e-01   -1.412810273109685e-01   +1.021288810007357e-01   -5.315476453827553e-02   +6.552790906827811e-02   +4.272348788026158e-02   +6.643093328933994e-02   -2.499347386189385e-02   +1.555333560689734e-01   +3.532570895290722e-02   +3.000805384905163e-01   +1.714256370023800e-01; +2.428796764282803e-02   +1.445645027187664e-01   +4.387964661867792e-02   +4.218083882306707e-02   -1.617002179599341e-02   +1.215640002921185e-01   -7.697369866543109e-02   +3.616836006335166e-02   +1.678487823827114e-01   +4.250555187751573e-02   -1.195759822594352e-01   +1.908882028930655e-02; -5.382923612059188e-02   -3.829498593092417e-02   +7.556450193891284e-03   +7.290331596901631e-02   -1.026595168461676e-01   +2.911088592967456e-02   -1.811703435974086e-01   -2.838407067866460e-01   +7.710764651943817e-02   +8.771870404027338e-02   +7.910856346337417e-02   +4.932490058035512e-02; -1.756681072671581e-01   -3.404073793696335e-02   +1.771899452551366e-01   +5.610777199789983e-02   -7.528364273764440e-02   -1.367398391103047e-01   +2.101053958073880e-01   -1.051861665783650e-01   -8.840102754965032e-02   +7.084631512008276e-02   +1.398567316741506e-01   -8.975197261911197e-02; -1.003438671783254e-02   -2.942310048680735e-02   -4.950278817482529e-03   +4.248879097627736e-03   +1.325567297169060e-02   -7.250636519370447e-02   +1.174047885762379e-02   +1.190542085271751e-01   -5.113557022560558e-02   +6.777985858831874e-03   -1.028419891995128e-01   -1.381045831833994e-02; +4.115993682261809e-02   +6.798176441142223e-02   +7.711469524193419e-02   +1.517754588825399e-01   +1.399532046764695e-01   +3.870448311530338e-02   +3.137370698260071e-02   -2.184254095544060e-01   +9.924715042167495e-02   -3.955015866480017e-02   +5.559527013205334e-03   +1.180133014024755e-01];
L2E_Input1_iAMPA_netcon = [+9.692766827081688e-02   +1.857688522930459e-01   +5.551298721502400e-02   +2.829952382142302e-02   +3.623002920316696e-02   +9.717611225591617e-02   +1.511708552546835e-01   -8.108757581909348e-03];
L2I_Input2_iAMPA_netcon = [+5.095125590844628e-02   +2.725127625058742e-01   -2.230393311568665e-01   -2.507089072169867e-02   +6.985848606291552e-02   +1.359068725035492e-01   -1.184771263194988e-01   +1.989453276437401e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
