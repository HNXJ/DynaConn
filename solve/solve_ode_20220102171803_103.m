function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.869073657187751e-03   -1.095841606708765e-03   +3.075682329831463e-03   +7.350471734403806e-03   -1.175918063627353e-03   +7.276302723144227e-03   +5.190084097834700e-03   +1.030837813252816e-03   +2.055645235760437e-04   +8.116703021804773e-03   +6.841238770822433e-03   +2.784910918795320e-03   +4.334539029909002e-03   +2.418399701878415e-03   +2.505118382554426e-03   -1.583226266237023e-03; +4.777720366734788e-03   -3.279381041696376e-03   +3.756532284762632e-03   +7.262517773118191e-03   +6.253758654493133e-03   +5.362342493994184e-03   +7.607902195662099e-03   -2.444096921435922e-03   +4.103703013289543e-03   +6.900746329218134e-03   +5.541399917459463e-03   +3.529591903965442e-03   -6.388886750919431e-04   -2.830097048760070e-03   +4.821869756871535e-04   -1.874802569445265e-04; +3.303833965459965e-03   +5.785034312466296e-03   +5.387338687836671e-03   +4.800328371392115e-03   -1.438466108750052e-03   +2.117620998056377e-03   +7.009672816644564e-03   -1.104523671580341e-04   +1.722137876260511e-03   +6.086071819365570e-03   +3.041869471891762e-03   -3.194640151663119e-03   +8.054714533530061e-03   +1.205246652797217e-03   +3.249734545282190e-04   +2.350291824673729e-03; -8.196612921004716e-04   +2.238258276495318e-03   -8.812196554753562e-05   +1.032015987312626e-03   +1.365865058400578e-03   +3.556468005384671e-03   +4.218550393456591e-03   -1.449718846640859e-03   +4.495443922940247e-03   +7.071341591741455e-03   +4.480612708999958e-03   +7.295520060441854e-03   -1.289689741061348e-03   +7.242870568241400e-03   -1.842324423168907e-03   -9.554846225953983e-04; +2.510623319985867e-03   -3.353400585722701e-03   -3.090959852060689e-03   +3.024190656435924e-03   +8.340321468830869e-03   +5.533840815339910e-03   -9.951016083807095e-04   +4.095404632998230e-03   +1.337629177292068e-03   +9.378400923604315e-03   -5.497671085417110e-04   +7.188232516123096e-03   -1.634020244087892e-04   +6.109877704270497e-03   +1.243205597475905e-05   -3.276697195523257e-03; +8.507113914657678e-03   +2.319515049410149e-03   -1.291665075746422e-03   +3.622919121311163e-03   -8.748743586751582e-04   -2.047379791497609e-03   +2.037755742151304e-03   -6.096115248450227e-03   +5.676382978950826e-03   -8.213840637603333e-04   +3.592452981341870e-03   -4.734394688320895e-03   -3.528528377547594e-03   +2.552485029703611e-03   -1.118176530019582e-03   +4.497161939954442e-03; +6.572762515752496e-03   +2.669011170885801e-03   +1.806224320616739e-03   +3.184741639465854e-03   +3.061389129786036e-03   +5.810722533143065e-03   +3.368348484106273e-03   +5.600077910215065e-03   +9.654610630056860e-03   -4.714028797254662e-03   +2.376280526587616e-04   -5.591978224266387e-04   +6.471913973112356e-04   +9.704545553517966e-04   +4.376341774845485e-03   -3.896459616412853e-03; -2.567522364539648e-03   -9.282609273589490e-03   +4.402731131047093e-03   +3.620380074446290e-03   +5.896388337581215e-05   +2.350477551849302e-04   -7.400216653816981e-04   +6.295701811772837e-04   +3.010923001159925e-03   +2.492158425122626e-03   +6.972496774274137e-03   +6.390498394470845e-03   +4.946708323537658e-03   +1.855267003570253e-03   +1.213984222677704e-04   +4.048722401006303e-03; -2.569225809616272e-03   +4.137519862171025e-03   +4.697588077160316e-03   +7.445816784665040e-03   -5.149541575788855e-03   +4.542010934236049e-03   +2.972371652209007e-03   +2.941039214187753e-03   +5.766887718203949e-03   -2.247804722422968e-03   +4.582709999875125e-03   +6.770293176601759e-03   +2.397738617681139e-03   +6.233571545450414e-03   -2.913246219556490e-03   +8.993971968781881e-05; -3.554418122113288e-04   +5.986417967538203e-03   +9.701306922055321e-03   +3.304513927920378e-03   -5.630873147231588e-03   -3.309840036924520e-03   +4.214937553967842e-03   +2.160822414862848e-04   +7.264565782190111e-03   -1.685749395663369e-03   +1.904184237233585e-03   +2.462342600290006e-03   +3.839525222264369e-05   +5.296011645228229e-04   +8.750431033947244e-03   +4.639536611443786e-03; +6.735208624803010e-03   +5.455503911355226e-03   +7.896699756228094e-03   +1.398137058157898e-03   +3.276914180760743e-03   -2.115872862965810e-03   +2.975702889449114e-03   +1.032625712198107e-02   +3.459462931750690e-03   -4.710161567729686e-04   +8.972149468556557e-03   +2.071276732063234e-03   +6.423321460253141e-03   +4.215189861501164e-03   +6.538632277022284e-03   +2.278982191516998e-03; +7.365562021741625e-03   -6.460708200660081e-03   -2.256418259157651e-03   +2.149181756699411e-03   +7.146791890433466e-03   +1.618114495316506e-03   +9.695413529131548e-04   +4.935767488361839e-03   +2.578502918716192e-03   +1.956163794665080e-03   -3.796383265425754e-03   -2.391311225523871e-03   -1.362271059323056e-04   +2.490328913212685e-03   +2.582452551195516e-03   +2.725118900351965e-03; +5.315495249284073e-03   -9.828935858157714e-04   +2.665382911333752e-03   +1.807491809830201e-03   +5.579380088320352e-03   -5.971929292348187e-04   +1.897224504131891e-03   +9.913276452644650e-03   +6.226314647626159e-03   +1.762719668675591e-03   +1.747302398909273e-03   -1.992534355138319e-03   +3.507739332048649e-03   +2.564887758314052e-03   +4.649955068237578e-03   +3.302692325163145e-03; +8.131189749020291e-03   +8.222456065765590e-03   +6.917763851516118e-03   +2.044995037654779e-03   +2.553010917323749e-03   +5.974166528329584e-03   +1.878198369806116e-03   +1.059115272237826e-02   -3.304144920002837e-05   +3.188981218102971e-03   -1.718751822935626e-03   +3.736867376954830e-03   +7.273268283239076e-03   +3.503709623406326e-03   +1.563374689487193e-03   +8.086599974607674e-04; +2.953026484792467e-03   +2.196292456664978e-04   +5.852313606990757e-03   +4.869157848471477e-03   +2.316667954078511e-04   +1.569392717349758e-03   +6.268710524284982e-03   -5.381966562996813e-03   +6.275498893967696e-03   +6.151278060435129e-03   +2.783195938220195e-03   +5.586772244734870e-03   -1.664641879626517e-03   +5.069759846912400e-03   -6.022267507783475e-03   -3.594511861849259e-03; +5.581967147699735e-03   +3.510004712920501e-04   -2.530531852929377e-03   +5.408657011363410e-03   +7.582826829703139e-03   -3.070297078672880e-03   +1.694467491122734e-03   +4.309446027009594e-03   +4.081345426477045e-03   +6.561684453287251e-03   +8.217426144296254e-03   -4.622942071245750e-03   -6.619605342892601e-04   -1.004994964380900e-03   +1.017437868734572e-02   +6.194380737079537e-03];
L1E_L1I_iGABA_netcon = [+4.095444090868891e-04   +1.096441650614947e-02   -1.495987573192322e-03   +6.613817181741794e-03   +1.448350519768300e-03   +5.821632444151954e-03   +7.898827843719734e-03   -3.873591112915540e-03   +1.535759230483061e-03   -3.230266280009103e-03   +1.188006656785540e-03   -1.008082233850305e-03   +3.628575943012095e-03   +4.615366114192275e-03   -4.520574733160716e-04   +7.151199131982579e-03; +8.832903193255592e-04   +7.254343088432898e-04   +6.526843247570809e-03   +6.232153717171804e-03   -1.123716311033605e-03   +2.184692756611318e-03   -2.354424222661507e-03   +2.637927756683718e-03   +2.936335720990634e-03   -4.344348192003615e-03   -5.232155965870722e-03   +5.361345606497659e-03   -1.086504909339572e-03   -1.081599607238888e-03   -1.480277917379753e-03   +2.173076003543820e-03; +5.622422660299124e-03   +6.257002402561656e-03   +5.016392232674009e-03   -1.056200326383188e-03   -3.251715009998061e-03   +1.198540676702695e-03   -7.854023138942904e-04   +1.487001627573801e-03   +4.688132617535769e-05   +4.697939503430492e-03   +7.621134961729956e-03   +3.084848072008627e-03   +1.263062447101666e-03   +6.471065714666897e-03   +1.565581840724133e-03   +1.169844075183224e-03; +3.303567650909801e-04   +7.858300615003431e-04   +7.493055778626774e-03   -2.437395818017051e-03   -5.471745332101582e-03   +1.029260173636511e-02   +5.261609193758843e-03   +1.873340771494349e-03   +7.087863144374554e-03   +6.656353396332613e-04   +4.512296649403436e-03   +5.920343025102560e-03   +2.240648000980858e-03   -1.588914965670229e-03   -6.996725871639416e-04   +8.763353393788099e-03; +6.462838794477326e-04   +2.642393829533479e-03   +4.117418641196077e-03   +1.838144182048250e-03   -1.251358423849428e-03   +8.395539582858044e-03   +3.117253096916003e-03   +7.391865760223275e-03   -3.005464758338654e-03   +6.445201483007027e-03   +3.665551920755165e-03   +2.054223704322292e-03   +2.021597019183868e-03   +2.456794303135954e-03   +4.395570595593934e-03   +4.128871972189575e-03; +3.201659435813380e-03   +4.141783231248413e-03   +2.359109456764111e-03   +3.255336119602205e-03   -9.510210035082968e-04   -1.982806003852534e-03   +7.870631112304740e-03   +4.782714541997589e-04   +1.494172942407013e-03   -4.314230658707626e-04   +6.205499904436793e-03   +1.005071137994322e-03   +4.571652711214488e-03   -2.226948861528497e-03   +1.552184424811809e-03   -2.122406682207764e-03; +3.613689264785880e-03   +2.429704778245110e-03   +2.692062850599727e-03   +3.534541575439648e-03   +5.503401481194609e-03   +2.228378322139699e-04   +7.769877684699378e-03   +5.770734652108100e-03   +4.306297168036002e-03   -2.394332124304967e-04   +4.202010978226624e-03   +7.209404479257464e-03   +4.467371471199450e-03   +1.277304883563732e-03   +2.697053537039586e-03   +4.556157417875376e-04; +6.317180110092187e-03   +2.991910373150838e-03   +3.272824921977046e-03   -2.939263753047542e-03   +4.704898493855107e-03   +5.158367763032924e-03   +7.382506538527395e-03   +4.641088148250218e-03   -6.950340714030297e-03   +4.837099443301930e-03   +3.280889333286102e-04   +6.649584758434689e-03   +2.061854203240192e-03   +9.595167973398675e-04   +2.794951014037323e-03   +3.706833815624999e-03; +2.989756842092723e-03   +3.158943184403269e-03   +2.549820830470666e-03   +1.274903232841456e-04   +4.534578551431054e-03   +6.712599088317858e-03   +1.190739336038202e-02   +3.357196349401694e-03   +1.864824151201484e-03   +2.218949720192707e-04   +6.548993546855732e-03   +4.512559371305007e-03   +2.093709001678290e-03   +3.404616624586661e-03   +7.224192962332994e-05   +3.636550877079383e-03; -2.474864528780848e-03   +3.756235073514927e-04   -1.203164119100177e-03   +1.777912158463914e-03   +3.700609901568792e-03   +7.426841276694759e-03   +3.522579994480037e-03   +2.394007770596927e-03   +8.179604564496741e-03   +5.811844216606727e-03   -2.369468138860764e-04   +1.141772784810120e-02   +4.026644433795779e-03   +1.285927414018793e-03   +4.421249827768609e-03   +3.934572521619462e-03; +3.271290022005580e-03   -5.001596664498369e-03   +2.493617518749926e-04   -1.495419116757538e-03   +4.274160403266163e-03   +4.244249068318486e-03   +9.270392418754365e-03   +6.148419746084901e-03   +3.963201327448650e-03   -9.454627683971901e-04   +4.673927439200264e-03   +4.517167391631838e-03   +1.652264277804845e-03   +4.923533067585795e-03   +3.456487236779205e-03   +6.786288857641665e-04; -4.466616241024256e-03   +5.507626603079228e-04   +5.702760182302874e-03   -1.415118586935860e-03   -1.901023652313597e-03   +4.940218446632001e-04   -2.518096639101463e-03   +6.423301808443721e-03   +2.038892899863093e-03   -1.250395006533522e-03   -1.594652455671753e-03   +1.279190666840766e-03   -3.181326244724433e-03   +1.441669188398975e-03   +2.814339785721732e-03   -4.972762243804329e-03; +4.199234365175768e-03   +2.521575707771628e-03   +3.739702432806569e-03   -5.898031239354614e-04   +4.828927847952819e-03   +3.711108624831976e-03   +1.201672109856443e-03   -2.608559546037443e-03   +7.176059383163168e-03   +2.149321157037387e-03   +1.141423955578328e-03   -1.262070925331030e-03   +6.082380965795652e-03   -5.366872673330919e-03   +6.147653695945260e-03   +6.201194449262950e-03; -6.581938406952545e-04   +2.937487962623225e-03   +8.832390014345257e-04   -2.360623274985274e-03   +9.674416465933664e-04   +5.916936189935936e-03   +1.214236358380166e-02   +2.954998747592909e-03   +3.961936132338192e-04   +7.258471526166187e-03   +1.465264029395014e-03   +2.908890875860910e-03   +8.269923840392501e-03   +1.071039911344728e-03   +2.200095751791677e-03   -2.791726918823607e-03; +3.465713242641643e-03   -2.898016809523393e-03   -1.629430395680333e-04   +2.322616022516663e-03   +6.296815986205941e-03   +6.110672732674616e-03   -3.496995720819479e-03   +8.517075395730265e-04   -1.616509343786349e-03   +3.356548047001048e-03   -2.041592938079075e-03   +5.146766252441664e-03   +1.273578122847528e-03   +8.583208458309952e-05   -1.271083938612987e-04   +1.927272486529154e-03; +3.644810032348612e-03   +4.791949251747684e-03   -8.058715827054701e-04   -1.241316202602880e-03   +7.056230924302664e-03   +9.522746711151039e-03   -3.378807768677239e-04   +2.027821333325651e-03   +1.990485873899075e-03   +2.423764975821215e-03   +2.112361560742541e-03   +4.261157455205777e-03   +9.638739827982485e-03   +3.731467519238763e-03   +6.899164438092006e-03   +6.769677937359855e-03];
L2I_L1I_iGABA_netcon = [+8.125920285697115e-03   +3.183987291935705e-03   -2.727960864093383e-03   +8.166255152835965e-03   +4.181237308150801e-03   +1.574152993638222e-03   +1.601840049998412e-03   +4.886165164487466e-03; -7.147501521604527e-04   +6.465853478108527e-04   -8.177396018967257e-04   -1.579782560329560e-03   +2.303835162826917e-03   -1.266015516600641e-03   +4.086919900144296e-03   -1.281514585604728e-04; +1.136009761804402e-03   -8.284330639341431e-05   -1.603352563243231e-03   +5.862242305092686e-03   +9.144090657488935e-03   +1.197188322313578e-02   -1.199967236597481e-04   +3.166772055000556e-03; +1.694506737030574e-03   -2.345749366357443e-03   +5.481308379708769e-03   -2.290464900259139e-03   -3.330234047871286e-04   +4.225943450318076e-03   +3.191470520688518e-03   +8.443630579459059e-03; +1.008634081626025e-03   +4.329561720597739e-03   +2.537787361316522e-03   +2.321368116414644e-03   +5.794389966733504e-03   +2.910640002156146e-03   +3.427250832188428e-03   +9.156915158107808e-04; +5.436645766584342e-03   -7.266041501082114e-05   +5.493690734518762e-04   +7.884074655816621e-03   +4.181062902405318e-03   +2.677135488602876e-03   -1.430639221170022e-03   +4.128851360436355e-03; -3.766048853914131e-03   -3.124349560632856e-03   -3.910673996752856e-03   +5.265490116863837e-03   +1.725736902473687e-03   -4.267070765936761e-03   +1.419050546187190e-03   +1.736421369634817e-03; +3.556418422488124e-03   -1.865108124238614e-03   +3.242867901734517e-03   +4.737429831387612e-03   +2.799359862739022e-03   +1.121353392239568e-02   +3.052516946865079e-03   -3.051801816568338e-03; -1.788963789114304e-03   +4.719369487740129e-03   +2.163675034949940e-03   +2.894258404998129e-03   -2.767323332304706e-03   +1.462231141386101e-03   +1.860747758879036e-03   +1.229673173270664e-02; +3.778980668608341e-04   +2.543910623769122e-03   +1.907958723449179e-03   +4.103138178244226e-03   -1.037131151095006e-03   +1.151410545897230e-03   +7.474334593233716e-03   +5.392157560339675e-04; -3.130658976835695e-04   +6.880295493708821e-03   +1.200183598849725e-02   +3.125982121908863e-03   +2.070935506753688e-04   +7.495469841297998e-04   +6.313946145306169e-03   +1.072396470931633e-03; +9.034863951872019e-03   +1.299226886380192e-03   +4.826225572166669e-03   -1.182045794613880e-04   +9.282233717037413e-03   -7.575873555898867e-04   +2.029541425207113e-03   +2.558106064839326e-03; -7.216040785324248e-03   +6.039000831682340e-03   +5.135278669523184e-03   -3.738421151006907e-03   -2.845144608599391e-03   -1.140808701108938e-04   +3.251879977204634e-03   +5.286731712115920e-03; +4.927208700442233e-03   +1.137235260097330e-03   +1.079806287964529e-02   -2.644157941210092e-03   +1.919341019048585e-03   -2.184578276614538e-03   +4.819143940051598e-03   +1.607075936935023e-04; +2.502235376976321e-03   +1.145439091770353e-03   +3.246378290158317e-03   +7.732776101485032e-03   +1.388068219033188e-03   -3.508002277332960e-03   +6.676101338690911e-03   -3.658101474767547e-03; +3.271548613353435e-03   +6.440749945609714e-03   +6.525004793594491e-03   +6.278736158809200e-03   +3.884775081459872e-03   -1.480673840203630e-03   +2.541933044254055e-03   +1.066806281723636e-03];
L1I_L2I_iGABA_netcon = [+7.879657077664430e-03   +5.649015229285162e-03   +2.707261051198375e-03   +5.428633878278389e-04   -4.074042232698485e-03   +6.268446490014873e-03   +9.850083508428430e-03   +2.969394726735272e-04   +9.155198455635021e-03   +7.270801127531010e-03   -6.858313549610997e-03   -2.169360250157797e-03   +8.021444236603106e-03   +7.268460977893363e-03   -6.437140463764853e-03   +4.552325225261952e-03; +5.978436592610648e-03   +1.538404205192462e-03   +1.505578801765161e-03   +4.438301374000998e-03   +4.017996143909500e-03   -1.162472481770410e-03   +4.926511948657066e-03   +7.374175869134295e-03   +2.620255811667510e-03   +2.819952462693952e-03   +4.873086598615476e-03   +2.892787132416297e-03   +4.896266464991819e-03   +2.577067791743790e-03   -2.000182178611637e-03   -1.160749006247355e-03; +1.960435073836255e-03   +7.635228366024232e-04   -5.242009432783192e-03   -5.983395961217875e-04   -2.372689549670548e-04   +9.510312037859901e-03   +6.664758511794003e-03   -8.477169528027641e-04   +2.810836095755289e-03   +6.644636459510042e-03   +4.463647650606840e-03   +8.116351059361652e-04   -8.995395504235102e-04   +1.104794772219352e-03   +4.257930431427285e-03   -1.567741568025377e-03; +5.537552710494211e-04   -4.596631485165481e-04   +7.306649393707010e-03   +3.158495968932695e-03   +2.395525945423356e-04   -1.959407453529060e-03   +3.218023525449705e-03   +4.477094187678634e-04   +1.726445787132584e-03   +1.231727199890259e-03   +4.436212079755616e-03   +8.919454740789614e-03   +4.440385408300412e-03   +8.336044300144606e-05   +4.149069461943542e-03   +1.088324321178186e-03; +9.923860623757726e-05   +6.840830710149261e-03   +2.050098609627033e-03   +3.953627455136790e-03   -2.106944857055838e-03   +4.570300156794873e-03   +1.760919150735241e-03   +9.148307992125545e-03   +3.418137730471272e-04   +2.709962438066016e-03   +3.688208365175187e-03   -6.067942305709225e-04   +1.054159321592591e-02   +1.635077957095368e-03   -1.869855945642940e-03   +1.030851263295101e-03; +4.681496170591742e-03   +1.708685966843714e-03   -2.236260647286252e-03   +6.974470102161625e-03   +8.309777846339862e-03   +7.466360164233113e-03   +7.131203326124785e-03   +3.114775988456727e-03   +3.424711931572001e-03   -1.241292661124024e-03   -1.944588971768856e-03   +1.070387983706852e-02   +2.629969416461159e-03   +4.678217493541506e-03   +7.839728768282154e-03   -3.471151422994763e-04; +5.456345427851321e-03   +5.399201827064970e-03   +1.879915098416701e-03   +1.002834398145977e-03   +1.397291437446039e-03   +7.208652590088819e-03   +6.304596403873245e-03   +3.646659839508321e-03   +5.745749402101918e-03   +8.136648115685433e-03   +2.382493402621874e-03   -1.676734413626009e-05   +6.945064251355984e-03   -7.491457448529922e-03   +2.806319981851158e-03   -3.382262708500334e-03; +5.007413009806639e-03   +3.384739949181671e-03   -2.591335643079321e-04   +2.726484015847026e-03   -2.208093744158064e-03   +9.910796856308613e-04   +6.540656427991181e-04   +2.498289609879306e-03   -2.666774926104795e-03   +2.556580470314161e-03   +1.507419116639230e-03   -1.380191451961142e-03   -4.335133048160593e-03   +1.527690082000842e-03   -7.960097605503196e-04   +9.718013174570421e-04];
L2E_L1E_iAMPA_netcon = [+3.980566214802682e-03   +4.302741980396652e-03   +1.051654825474537e-03   +6.041504019057641e-03   -1.460604738683764e-03   +1.954697537476604e-04   +7.406524532416085e-03   +1.633516174953892e-03; +8.759046583223937e-03   +5.588895487020293e-03   +5.322624723158711e-03   +3.421200672712563e-03   +6.262802678690314e-03   -4.463533510440380e-03   +1.360061014804080e-03   -1.934342279962517e-03; -2.278721449059870e-07   +4.171878771074071e-03   +3.766826835662681e-03   +4.440571790735631e-03   -7.804599341381673e-04   +9.089744429622515e-03   +6.981753103922318e-04   +5.440325801240751e-04; +2.153382367057326e-03   +1.651173300206906e-03   +8.732547778870746e-04   +9.315509718689457e-03   +8.355261267278946e-03   +8.745188276142396e-06   +5.707588591326808e-03   +7.340089572415548e-03; +1.767223885332437e-03   +8.099284364147545e-03   -2.247215202631535e-03   -2.968247248744996e-03   +1.967753056628418e-03   +3.531604864554274e-03   +9.780601239886269e-03   +2.853566336133232e-03; +5.034772164862983e-03   +8.452117822092335e-03   +9.212799801922631e-03   +7.768999977876450e-03   +4.263867542231441e-03   -1.971212619009968e-03   +5.801219007240441e-03   -2.449194538602296e-03; +2.655485725084854e-03   +1.555662532586840e-03   -4.291189927408257e-03   -3.546113557325578e-04   +3.241039577670127e-03   +3.954374178320073e-03   -3.675609709584031e-03   +6.260756478267665e-03; -5.394942323746158e-03   -4.562431307526456e-03   +3.374046814734989e-03   +2.177718047988509e-03   +7.198205005948286e-03   +3.691126626918525e-03   +6.474444660906011e-03   +2.559510627458792e-04; -5.818716429273113e-05   +9.852484158843849e-05   -9.004356351673757e-04   -2.513516491499924e-03   -5.882141150715184e-03   +7.450002519583668e-03   +3.483054435274174e-03   +7.986573276365684e-03; +7.238797851126827e-03   -2.074763442410539e-03   +2.129847189923774e-03   +9.579868014712643e-03   +8.364160447943060e-03   -2.440680080340461e-03   -3.497101731557431e-03   -2.764977574092626e-03; +4.695757378801838e-03   +5.893594033839346e-03   -2.300881146134819e-03   +1.496580688094564e-04   +5.127318467240795e-03   +3.758182859348972e-03   +1.925144571289284e-03   +1.865458666075819e-03; -4.382693945329635e-03   +5.531305554248862e-03   +1.326388952493799e-03   +4.220036224876611e-03   +2.942511291020343e-03   -2.428466879391106e-03   +7.071337641429054e-03   +2.938015901258326e-03; +4.867212760696316e-03   +3.515444872061442e-03   -3.839140982857538e-03   -3.131919450065691e-04   +7.517615849734166e-03   +5.194985073705458e-04   +7.146937382624810e-03   +5.380566579181318e-03; -3.538918162918334e-04   +4.541398042364521e-03   +1.908466563441679e-03   -1.405262445438437e-03   -4.111056172350793e-03   -9.623384565635137e-04   +3.096756028189175e-03   +4.324981785845659e-03; -2.067399747002367e-03   +3.472443537859012e-03   +4.605748742106195e-04   +4.353405282335206e-03   +5.050417153390442e-03   -1.920487273986176e-03   +8.260992203841914e-03   +3.522163654105756e-03; +6.214770595493335e-03   +3.093151400315052e-03   -6.328737876874742e-03   -1.540259625692043e-03   -1.920047853689313e-03   -4.502985125803252e-03   +4.122351598544637e-03   +7.068935406795953e-03];
L1E_L2E_iAMPA_netcon = [-4.496219142088470e-03   +2.222211106475921e-03   +5.161360411577092e-03   +4.418021149377368e-03   +9.647385756880731e-03   +8.109337066084726e-03   +1.787146313838072e-03   +5.926475998123041e-03   +9.670793145399179e-04   +3.323919663958731e-03   +1.834287681610652e-04   +1.609198287503850e-03   +4.003050252487312e-03   +3.720460637549693e-03   +2.816789718147369e-03   +3.957387287160637e-03; +5.792554452913320e-03   +1.023568385320170e-02   +4.437504760166338e-03   -1.389784488359120e-03   -2.196334891001140e-04   +6.160353276787971e-03   +3.731686874761677e-04   +1.495411417008335e-03   -7.803716281963971e-04   -2.361658963368290e-04   -8.998720064799095e-04   +2.558959238009819e-03   -2.642888150192930e-03   +2.844727841656730e-03   +6.910129725691161e-03   -8.980636884125290e-05; +2.832598138168172e-03   -4.915523675833500e-04   +7.490897797527410e-03   +9.108384773455189e-03   +2.768439601240856e-03   -1.121032342339353e-05   -2.130539899174644e-03   +2.071961544174559e-03   -1.781225411535571e-03   -1.975807252244505e-03   +1.140450650384477e-03   +3.346857404456511e-04   +2.752884859461641e-03   -2.867500169502668e-04   +8.096916485753967e-03   +2.626698808878301e-04; +2.697139120711334e-03   +4.945108037402290e-04   -1.478035528247543e-03   +1.772101822603170e-03   +5.335427618394522e-03   +5.574820544693914e-03   +6.967190870792742e-03   +1.047400002497409e-03   +1.380945082965700e-03   +7.982841589388107e-03   +2.196386569303157e-03   -4.995016831140659e-03   +6.823937622452588e-03   +2.015863020742478e-03   +7.351146384621118e-03   +4.762789525848898e-03; -1.255414244318536e-03   +1.847200222974685e-03   +2.683347783116549e-03   +2.289525002423630e-03   +1.900671952513156e-04   +1.684407227512966e-03   +6.725679446676338e-03   +1.559789456429132e-03   -9.494942492909737e-04   -9.203452635792944e-04   -4.137432782529798e-03   +1.036212381398604e-02   -6.163869328542121e-04   -1.020039110669943e-03   +6.797041181163107e-03   -1.301786033107323e-03; +4.585706755865671e-03   +1.023171336060671e-02   -1.576502684430110e-03   +3.076446561704818e-04   +1.463388641598830e-02   +2.807079614525250e-03   -1.336329460108671e-04   +6.181021063284740e-03   -2.190342787495478e-03   -3.372159029867638e-03   +6.375498381078316e-03   +6.503837591577960e-03   +5.928146944782535e-03   -2.494926349508909e-03   +2.643315376050573e-03   +4.962801897194934e-03; +5.160503443591260e-03   +6.964976957028728e-03   +2.043785004178012e-04   -1.846938625663447e-03   +1.905214184858165e-03   -2.544319233807255e-05   +5.173903868500820e-03   +3.689697957631282e-03   +4.603859258414710e-05   +2.130181621079669e-03   +1.339434364733703e-04   -2.522249821078464e-03   -7.912746836450703e-05   +4.355816854872535e-03   +2.018911646430485e-03   +8.288107463037453e-04; -3.999918634592606e-03   +1.044557481016457e-03   +1.940624220608253e-03   +1.053043299665782e-03   -4.405922381597844e-03   -1.270033083227002e-03   +1.110974791065875e-03   +6.294669499280909e-03   +3.094965869583844e-03   +2.760574276803377e-03   -4.230067126020321e-03   +5.952770174094120e-04   +1.643416184449934e-03   +2.476390902214729e-03   +1.348674262292642e-03   +4.535440783151867e-03];
L2I_L2E_iAMPA_netcon = [+9.962942767974203e-04   +1.166443624218773e-02   -1.629827361609775e-04   +9.034583858664656e-03   +3.496394717516262e-03   +8.916642648191574e-04   -5.902808618437917e-04   +3.800401353220846e-03; -1.014988767672992e-03   -2.322112924313456e-05   +2.839620210212159e-03   +7.192260765160059e-03   -5.116476160649023e-04   +1.252237391809417e-03   +3.852210291775429e-03   +5.224333210481862e-03; +6.027118301075658e-03   +5.395208372012157e-03   +4.451594514273263e-03   -2.040177857720810e-03   +1.822791073858843e-03   +4.202444167148064e-03   +1.961875814327101e-03   -1.344596003010412e-03; -1.502858014828060e-03   +1.260726200555214e-03   +9.274255912448983e-03   -1.246130570426220e-03   +5.962646227781286e-03   +4.587895044178826e-03   +8.596858740219596e-06   +1.255273186258296e-02; +4.060223796608358e-03   +3.407250012915181e-03   +2.056304586072243e-03   -3.624858434845134e-03   +4.439028676437281e-03   +3.428829841788568e-03   +4.355144417540568e-03   +2.037085359574259e-03; +3.448498988051266e-03   -6.408480514239674e-04   +2.804942383794534e-03   +5.209387642213697e-04   +4.420258331179784e-03   +5.769345741563341e-03   -3.361038522086246e-03   +7.717007881862251e-03; +4.650457732890712e-03   +2.265182262989319e-03   -2.005833744374272e-03   +2.552649360319998e-03   -3.106641425866506e-03   +6.436918927243436e-03   -5.024726774076002e-03   +7.560537200367239e-03; +4.986063175694058e-03   -7.245298409110951e-04   +1.535207640271268e-03   -2.611417165918096e-03   +6.114829706598697e-03   +5.240570068252471e-03   +3.703903960644843e-03   +1.958943194963150e-04];
L2E_L2I_iGABA_netcon = [+4.406375840836935e-03   +1.547234358646548e-03   +3.954279449860086e-03   +5.086660658187648e-03   +7.163101412019222e-03   +5.582798775172431e-03   -4.775120007453853e-04   +6.148346587353195e-03; -5.529496622476558e-03   +4.515626964596721e-03   +4.661501410323026e-03   -3.996735366228077e-03   +4.872796730617003e-03   +5.915215445408586e-03   +9.482962893694253e-03   -1.084775663468271e-03; +6.642837651951638e-03   -3.434389054638303e-03   -1.562988356239983e-03   +3.402121915983093e-03   +5.896370820991089e-03   -4.367157760063089e-03   +3.676499727781014e-03   +5.246265333235601e-03; +4.903577893401828e-03   -1.295183708268394e-03   -1.687751250662485e-04   +2.760236924012726e-03   -1.547280331083295e-03   +5.473796530100408e-04   -1.922160513287089e-04   +5.124425770383651e-03; +3.118492650778919e-03   -2.904044500614536e-05   +3.898389231209398e-03   +7.321505549207680e-03   +3.695994177809832e-03   -1.326218205975577e-03   +7.033426104663239e-03   +1.574431045307471e-03; +3.185654186099392e-03   -5.859764641128035e-03   +2.949589907860909e-03   +7.615578710883536e-03   +4.603821587586919e-03   -6.631282087408846e-04   +3.455593427317233e-03   +2.247811368888380e-03; +6.402657822268415e-03   +5.709698157901070e-03   -3.671977783238039e-03   -2.350514180412601e-03   +4.789969787539821e-05   -6.017999298652084e-04   -1.524067676431670e-05   -1.339566922353843e-03; +6.584836696934125e-03   +2.967280120123867e-03   +2.353445086418240e-03   -4.771600681258783e-03   +2.035274985384778e-03   +1.800222398934715e-03   +3.233873216058169e-03   +2.025909254171611e-03];
L3E_L2E_iAMPA_netcon = [+2.930669000635185e-03   +1.182317589999946e-02   -3.344665114482532e-04   -3.795872753840563e-03   -4.567422704126101e-03   +8.304526415051653e-04   +2.180716238502446e-03   +9.828345882418786e-03   -3.712390649325224e-03   +3.209526494789560e-03   -2.412867152292882e-04   +2.489107124176469e-03; +3.938977955088275e-03   +6.117788245273299e-03   +4.897280254872434e-03   +1.519958038510594e-03   -2.591362606210171e-03   +7.483161043891926e-04   +3.623579815212437e-03   +6.879413363720591e-03   +7.476295450617608e-03   +7.623315271715267e-04   +2.550603098290158e-03   +4.127522669571965e-04; +6.460821792638727e-04   +3.618081218571419e-03   -3.518389190898309e-03   +2.812371418612760e-03   -2.517956523069711e-03   -6.226904325198494e-04   +4.539154835622197e-03   +6.325353908614704e-03   +7.563029623924133e-03   +3.560652117369792e-03   +6.567019733225572e-03   +3.862475627005257e-03; -2.074603504312125e-03   +2.396249796939798e-03   +4.363083405182397e-04   +7.527725688067387e-03   -3.795622917955340e-03   -3.190852600715932e-03   +3.947873283723333e-03   +4.686978569302967e-03   +7.553453267977545e-03   +5.793497756973741e-03   +5.371135282721219e-03   +3.728349506342524e-03; +5.432206455882458e-03   +1.150378861668047e-03   -1.053418454061423e-03   +1.136378659750303e-02   +1.208289854501275e-04   +3.827940743009429e-03   +4.402914326053636e-03   -3.166864097905347e-03   -3.895222625767245e-03   +1.097101349123593e-02   +6.059470217912773e-03   +5.383849426500274e-03; +7.099541285442186e-03   +2.726489026370087e-03   -2.899693766537168e-03   -2.731675081700635e-03   +6.310956682212569e-05   +6.770142924939221e-03   +6.984063343440007e-03   +6.939006653675745e-03   +2.886191142494997e-03   +3.807167037359863e-04   +6.656374372176417e-03   +4.246791816030083e-03; +7.107181130318829e-03   -2.613683803689151e-03   +5.760380162747862e-03   -1.664693602716396e-03   -1.281738259263647e-03   +5.121751957018943e-03   -6.668684354821994e-04   +8.693015969066189e-03   +2.725998800853532e-04   +1.119297593664249e-03   +7.280991337970614e-03   +4.025362509714085e-03; +1.043308711167454e-03   -7.402309076052634e-04   +4.031251367943648e-03   -2.654262479736019e-04   +5.936882735737550e-03   -6.739431387536484e-03   -4.792649383704781e-03   -2.749730552004784e-03   -1.005893603463775e-03   +7.494060077888914e-03   +3.479640411150631e-03   -1.186797529311801e-05];
L3I_L2I_iGABA_netcon = [+1.149282918637747e-04   +4.762804601142136e-03   +4.750866957882914e-03   +8.517894155702341e-03   +6.209861112667778e-03   -3.504948713327144e-03   -1.955525569194448e-03   -6.822249924569068e-03   +1.960502609413981e-03   +2.388129887384808e-03   -8.431663062261648e-03   +8.601985927160449e-03; +8.075008889202975e-04   +5.501085400070878e-04   +4.446916829080835e-03   -1.318532470545229e-03   +5.202350276148927e-03   +1.852595005213323e-03   +3.138054962430184e-03   -2.671239931736079e-03   +4.803292709994928e-03   +2.434152030451495e-03   -1.090018215801087e-03   -2.966754297556839e-03; -2.441000655457717e-03   +3.101394241094083e-03   +3.417274186390064e-03   +2.456862433413269e-03   +1.613884589527657e-03   +1.282818311743482e-04   +2.417692728210311e-03   +2.023043552298411e-03   +4.987771306082247e-03   -4.237228170006111e-04   -2.566238833678800e-03   +1.911541571910091e-03; +6.298092470119280e-03   +2.971267484642457e-03   -1.814233290189876e-03   +1.563983189051500e-03   -1.463284482503448e-03   +9.126675858329651e-03   -1.517534425001085e-03   +3.064399424960062e-03   +4.054025201490033e-03   -2.643711314059134e-03   +1.711822072230639e-03   +6.132644008811270e-03; +4.797841747395942e-03   +2.049698834123684e-04   +1.414209737977798e-03   -1.142339903893023e-04   -3.305950183895298e-03   +8.670934579884784e-03   -3.255990474451264e-03   +6.310801435188455e-04   +8.353758442401523e-03   +9.183007798791871e-03   -4.555530653709322e-03   +1.112159506613328e-04; -3.372605076812688e-03   -7.688177012362758e-04   +3.110525733635289e-03   -6.444966931255128e-04   -8.632324360587776e-04   -1.549290445705509e-04   +4.457475558875754e-03   +2.611199571583054e-03   +4.078874728121408e-04   +3.014012636470084e-03   +2.372453571874177e-03   -7.138563718298563e-04; +7.912890743404184e-03   +2.993418014864652e-03   +4.978435161210257e-03   +6.739574547420924e-03   -1.516262582242317e-06   +2.654126974375781e-03   +4.408471490632061e-03   +3.295428330450974e-03   -1.340036809637508e-03   +9.587391239591264e-03   -1.993293408766257e-03   -5.345351169201316e-04; +6.543506208063798e-04   -4.140159198029398e-03   +5.310322490528787e-04   +4.425574103868271e-03   +6.518834686444063e-03   +3.113567577720901e-03   -4.134312954370577e-03   +3.210573523796079e-04   +9.215837663490174e-03   +4.897404623291875e-04   -1.994172292065899e-03   +2.284418762614193e-03];
L2E_L3E_iAMPA_netcon = [+5.323991644706563e-03   +4.171451191922011e-05   -9.156472286467185e-05   +8.437713811750180e-03   -2.454045486412148e-03   +2.907315475307190e-03   +5.426928177421878e-03   +4.096237623498575e-03; +1.747624273471963e-03   +4.716464751600697e-03   +1.004766520651762e-02   +1.029183254864068e-02   -1.336978714839811e-03   +3.503517567284316e-03   +3.611747323697907e-03   +3.444363018607384e-03; +4.979241619768989e-03   +4.642826708322382e-03   +6.177329633197209e-03   +2.475178061834484e-03   +3.887520875656060e-04   +5.699538741585949e-03   +3.296009969915034e-03   +4.186207258646581e-03; +6.392844184745497e-03   -7.612044909129188e-04   +7.334893490388005e-03   +3.296365304714902e-03   +1.112217231024415e-04   +1.719218834733685e-03   -4.221507192751171e-03   +1.760726672554277e-03; +4.342003841436505e-03   -2.023033112465485e-03   -1.173437857232808e-03   +7.259346353589793e-04   +3.230830112433944e-03   +5.586499258656945e-03   +6.209235491596069e-03   +5.315480955470363e-03; +2.916790229228586e-03   +3.158655617290191e-03   +1.282273382370847e-03   -3.264381144754075e-03   +1.675478115914765e-03   +7.009899147255473e-03   -2.343121767104334e-03   +8.642825777437645e-03; +7.825462618320445e-03   +2.421052100466249e-03   +5.750695855909529e-03   -1.801960112612784e-03   +1.178270583539195e-03   +4.105795943180440e-03   -1.654671832069539e-03   +4.384473230433878e-03; +1.201185287413144e-02   -3.192428645206296e-03   +2.770186795731998e-03   +3.762311033316316e-03   +3.488397514400420e-03   +4.654406996419171e-03   +4.684766762116255e-03   +4.513697518655022e-03; +1.578796706983796e-03   +2.957131229437299e-03   -1.654552648502432e-03   +7.164696768225743e-03   +6.845551422645420e-03   -3.766666129602842e-03   +1.553005811925280e-03   -1.036911377992744e-03; -2.202818756183661e-04   +2.643130213318996e-03   +1.914761916326077e-03   +1.097147453957480e-04   +4.356675930126957e-03   +1.161530372607404e-03   -2.260899722751684e-05   +4.190210708763565e-03; +1.338765931486324e-03   -5.096368055434401e-05   +8.283575641688478e-03   +9.521129891133257e-04   +1.047583018048593e-02   +4.628799547010718e-03   +3.440670367288768e-03   -5.746080421603031e-04; +5.145246195143810e-03   +1.341225414728600e-03   +1.963312174595099e-03   +3.818626478303800e-03   +6.647471254608925e-03   +2.046383311923614e-03   +5.796440698241753e-03   +3.777125733357401e-03];
L2I_L3I_iGABA_netcon = [+4.758022663253882e-03   +4.061470599376598e-03   +5.206691200158711e-03   +5.383693201879777e-03   +9.016811561782346e-03   +1.144247168584083e-03   +7.000520183576176e-04   +6.165139572277200e-03; +3.900414191271063e-04   +1.128333524477869e-03   +2.833629021846536e-03   -2.790627677172030e-03   +2.868729252552323e-03   +5.811566784097419e-03   -1.078796621611049e-03   +2.621163441878704e-03; +3.101544631936333e-03   +1.584192771102009e-03   -2.632451336466637e-04   +4.886397084676248e-05   +1.506235639491660e-03   +6.379321740164147e-03   +7.724746194900094e-03   +5.742344554189116e-05; +4.004683196606241e-05   +1.084156376323925e-02   -6.888103136288648e-04   +3.976981676335239e-03   -6.747038566102799e-03   +2.229566822373067e-03   +4.991124191025065e-03   +4.662537115941396e-03; +5.255970434545172e-04   -2.080546942884838e-03   -3.067180006003725e-03   +3.444776868258781e-04   +7.663443019011390e-03   +4.583178246005508e-03   +5.236162373914771e-03   +3.722952684269443e-03; -1.386205775560958e-03   -3.918203948821606e-04   +4.395179586463385e-03   -2.673778456637582e-04   -1.722611860622957e-03   -4.896195313334629e-03   +1.998392944627337e-03   +9.071858327304288e-03; +2.031186887855185e-03   +1.293107608076784e-03   +7.301651583422409e-03   +3.289721125135607e-03   +4.167384270972400e-03   -2.324827098517622e-03   -1.670210207265462e-03   +3.411987192243979e-03; +2.237095010983804e-04   +1.307254757877923e-03   +7.696752568776947e-03   -8.191651247032013e-04   +1.453926574720838e-03   +1.056532414897739e-02   +3.600287031667148e-03   +1.293116597117653e-03; +5.600539838887379e-03   +6.326575427219646e-04   +6.900449231877505e-03   +4.109815413061697e-03   +4.496838325224128e-03   -2.495797169918920e-03   +5.740588134697890e-04   +5.246224966208740e-03; +6.742826038378608e-03   +2.773358273595719e-03   +4.863967087730264e-04   -1.795385266293801e-03   +2.112385002125754e-03   -1.395022120582925e-05   +1.563624188490517e-03   +3.774698414269208e-03; +5.874171034195171e-04   +6.097681686534461e-03   +2.101395454660680e-03   +1.977799337638154e-03   +6.531861494303924e-04   +6.542968762860549e-03   +6.554656607154848e-03   +4.765884967491404e-03; +3.622298421023929e-03   -7.345949776882426e-03   +2.928966046898599e-03   +8.094710334672305e-03   +2.481088940070046e-03   +4.356033438254411e-03   +8.975300307823300e-03   +7.189887984866069e-03];
L3I_L3E_iAMPA_netcon = [+4.050205292355504e-03   +3.068436249814263e-03   -8.763734737133504e-05   +3.460432480914668e-03   +9.334827860113705e-03   -1.282076201159525e-03   +3.276256442127768e-03   -5.848268450806030e-03   +2.568937711331762e-03   +2.635882631862001e-03   -2.663627707090999e-03   -7.852958795199621e-04; +2.476225263812453e-03   +2.260176983341671e-03   +1.257546609121905e-03   +1.366604529670603e-03   +3.182182417029935e-04   +1.160750469034045e-03   -1.487206976523913e-05   +5.362826980014460e-04   +7.936670608821939e-04   +3.573040264030542e-03   -2.344790688357459e-03   +4.896330792343250e-03; +2.842918443272606e-04   +1.700527806677439e-03   +4.832621316749396e-03   +4.746593025193774e-03   +2.421620794358266e-03   +3.413977170029099e-03   -1.131001711955724e-03   +8.617078926006853e-03   -9.718669500211214e-04   +5.994684919121791e-03   +6.973048012535398e-04   +4.025692742416128e-03; +6.647732601736329e-03   +8.913759644954330e-03   +6.388249212936003e-03   +2.653188098687022e-03   +9.020958684666621e-03   +4.823198079462621e-03   +5.689548818164330e-03   +4.000138115552020e-03   -1.440187339082119e-03   +4.946560085093532e-03   +2.771585789466303e-03   +9.222619446285416e-03; +3.148123974437752e-04   +4.926479748047763e-03   +3.045084652988888e-03   +3.802098122657949e-03   +2.424469040090091e-03   +3.144135402898963e-03   -9.917674628897666e-05   -2.711430000376239e-03   +3.765221639966707e-03   +1.711197559752941e-03   +6.824722522494031e-04   +3.860666550705343e-04; -7.827116186109298e-04   +1.024744639485862e-02   +3.281484913421699e-04   +1.020953136495785e-02   +2.904166722913312e-03   +2.268762466126996e-03   +6.879222160696460e-03   -1.129518296691994e-03   +1.496965232525718e-03   +5.996105879687013e-04   -3.638502818042928e-03   +6.852703843930304e-06; +1.672967203746808e-03   -1.384465371001914e-03   +5.840203575995843e-04   +7.296257757826489e-04   +6.572877157652999e-03   -1.556134538433081e-04   +6.996016150706545e-04   +6.266467090809531e-03   +1.354663022251074e-03   +6.955961152271546e-03   +3.628883743118717e-03   +4.196625293684968e-03; +8.513036796559997e-03   +2.887695585774899e-03   +1.020584786624585e-02   -9.690395677120558e-04   +7.045194062485081e-03   +1.596523451346708e-04   +4.189970199448406e-03   +7.950360215947499e-04   +1.668629789141705e-03   +1.646067511370094e-03   +6.605167921283865e-03   +2.260642568644521e-03; +1.609769800063127e-03   -5.769961132688394e-04   +1.141465520678172e-03   -1.308622611480647e-03   +9.384846302282499e-04   +2.897506446317403e-03   -4.022501424612429e-03   +8.149852667330124e-03   +8.762398956111854e-03   +2.919680764604859e-03   +4.124741388952325e-03   -1.889631609885983e-03; +8.845445219665662e-04   +6.424807585163897e-03   +6.221869985990102e-03   +2.397115705768113e-03   +5.194334466078978e-03   +1.727002828913787e-03   +5.498133047444579e-04   +8.731942078296180e-03   +2.759711257076226e-03   +1.023179917626830e-03   +1.051553045873098e-03   +8.242390953375267e-04; -2.568291954861113e-04   +1.665218048206788e-03   +1.050273370942860e-02   +2.980395712285741e-03   -2.572151139805812e-03   +1.515973617602650e-03   +4.903132796932092e-05   +3.011641742624350e-03   -4.219924311481452e-03   +2.649409042838622e-03   +6.787786251096925e-03   -9.169579560167276e-04; -5.173101725205033e-03   +2.929981705905510e-03   -1.187053576141089e-03   +7.553867557172276e-03   +7.250150791267004e-03   -1.274056184184281e-03   +7.967316353691314e-03   -5.659487369531948e-03   +2.361043775520278e-03   -3.914249941530803e-03   +5.608160155130268e-03   +3.453080015428325e-03];
L3E_L3I_iGABA_netcon = [-7.284998564294548e-04   +2.945423394807359e-04   +6.245397059840964e-04   +8.552621936482775e-03   -3.148548874961196e-04   +1.216062077559943e-02   +3.957855350814318e-03   +2.564844890798359e-03   +8.850669855566362e-04   -1.611188371610236e-03   +2.005079944350104e-03   -2.108263351602307e-03; +3.955274061497220e-03   +9.951451808343059e-04   +3.440546123418876e-03   -3.406070525527357e-04   +5.487712345428126e-03   +4.991473888974966e-03   +1.002564470000153e-03   +3.314070971239339e-03   +4.452135526494778e-03   +8.990292565077914e-03   +2.308957044122250e-03   +3.829763393869460e-03; -9.050433211654735e-04   +7.228717208124805e-04   +4.271861468130239e-03   +5.566565761813391e-03   +7.911712282420524e-04   +6.855938598270031e-03   +3.517686823334693e-03   +1.194996428598714e-03   +2.575495918436228e-03   -6.499207023831261e-04   +3.172235020608737e-03   -6.347211648234874e-03; +4.761998439089793e-04   +3.927330595495247e-03   +2.406069904795729e-03   +1.011480660242315e-02   +2.459366310770005e-03   -2.496739953709894e-03   +4.962942055587358e-03   +1.674081837509202e-03   +3.892206479654471e-03   +5.432441330902794e-04   -2.669930224931968e-03   +4.733928892858581e-03; -2.650521387043202e-03   +5.021114254250725e-04   +8.300299174969415e-03   +1.081757398444002e-03   +3.327020580209917e-03   +5.927261429125758e-03   +3.389927492452879e-03   +9.057508870822812e-03   +2.115393273669344e-03   +1.391523734377339e-03   +5.186409655369726e-03   +2.472811163588788e-03; +5.014372317776820e-03   +2.750870198399555e-03   +5.411864697294579e-03   -1.797166578245007e-03   +3.257013163002653e-03   +7.116433048656169e-03   +3.243055769368086e-03   -4.997010015447846e-03   +3.219101798470012e-03   +2.074288480415342e-03   +7.272981490496975e-03   -1.365869355764350e-03; +4.120464565000086e-03   +3.436925884938431e-03   +4.183658929709042e-03   +2.230757878150429e-03   +4.262117728415823e-03   +4.974378474829025e-03   +7.903714953694356e-04   +3.126073994501959e-03   -4.109105595766995e-04   -1.543904676483716e-03   -2.164231946906383e-03   +6.545877706592061e-03; -2.107346309641059e-03   -6.100318339775137e-04   +2.709438435926456e-03   +9.480428737504092e-03   +1.039130758337986e-03   +3.500305114284620e-04   +4.066643423933332e-03   +5.415555674460399e-03   +6.719727457479559e-03   +4.845965264669945e-03   -7.282354841630703e-04   +6.644422890157905e-03; -2.306673369925243e-03   +1.468562213550852e-03   +4.574802993341710e-03   +2.469801278172187e-03   +1.462657581895606e-03   +6.865025159083797e-03   -1.035179998202732e-03   +4.785869592955929e-03   +2.341890571086426e-03   +7.308243798872790e-03   -2.004972959612683e-03   +5.421455839017366e-03; +2.639478128092418e-03   -2.332054198639798e-03   +2.350396928033365e-03   -3.959575810139213e-03   -1.784647141684899e-03   +5.363855639995040e-03   +5.028277204998738e-03   +4.526010210319164e-03   +6.314715183991088e-03   +2.880263720775414e-03   +4.392366181806605e-03   -5.119125668949511e-03; +4.741586704395277e-03   +1.552682292086422e-03   +2.055926547045917e-03   +6.149531187129016e-04   +5.004806524350721e-03   -3.685004693665277e-03   +9.064399449913255e-03   +1.817514964379397e-03   +1.065685730158692e-02   +6.250654424672774e-03   +3.911648428188042e-03   +2.508213434528769e-03; +6.606688184432353e-03   +5.800762603286713e-03   +2.171168745236709e-03   +5.979214161965341e-03   -3.025349154184630e-03   +1.359881946706035e-03   +7.452450268594957e-03   -5.301152969943743e-03   +8.631038500269923e-03   +3.222406416757592e-03   -1.579356285210957e-03   +3.352032525789607e-03];
L2E_Input1_iAMPA_netcon = [+7.135945814092466e-04   +9.900020898365875e-03   +4.679490028972322e-03   +5.469951123157346e-03   +7.395690596858569e-03   +2.502351007661004e-03   +4.500959911881200e-03   +8.471545198151483e-04];
L2I_Input2_iAMPA_netcon = [+7.923933311072686e-03   +1.029999904206461e-02   +7.871220677198771e-03   +7.075094623454737e-03   +2.502106378071876e-03   +5.690489772646596e-03   +6.091671954585573e-03   +8.241163385621340e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
