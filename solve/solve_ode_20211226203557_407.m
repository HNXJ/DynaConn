function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.899658629704633e-02   +5.747828197445265e-03   -2.829605740301627e-01   -1.317711037214991e-01   +8.965260843511583e-03   -2.112621742128479e-03   +1.656414034989153e-01   -2.346834424881691e-01   -1.108961921067429e-01   +4.728906530545626e-01   -1.726610445695007e-01   +3.426968545647078e-01   -4.551507781743868e-02   +3.489616284414162e-01   +8.169054263193254e-03   -1.225254810478182e-01; -2.105133245894244e-01   -2.611234163786454e-01   -6.866678807795837e-02   -1.793642893818649e-01   +7.695284723681980e-02   +1.471607886893269e-01   +2.724827129841540e-01   -1.748298066776837e-02   +2.562559457408610e-02   +2.002888599811491e-01   -5.174267065836642e-02   -2.253086640155889e-01   -1.309482479578206e-01   +3.650661660707389e-02   +5.666466369823692e-02   +2.461476271087903e-01; -1.403448712607795e-01   -1.709666110063174e-01   +1.688278952550085e-01   -1.346847608948819e-01   -7.073445507992139e-02   -4.152662375379632e-03   -1.310538968141916e-01   +5.585399721410305e-02   -8.542116530781386e-02   -9.380506644546463e-02   -8.108060213735165e-02   -2.514797005359314e-02   +1.125168001961135e-02   -3.746533611801580e-03   -2.569626975677365e-01   +1.890344287850462e-01; +2.489109965943094e-01   +1.918099961762514e-02   -1.152073085092455e-01   -3.188843576515129e-01   +7.506093432258074e-02   -7.517202408992840e-02   -1.223101713406358e-01   -1.896506721450119e-01   +3.720977832832712e-01   +2.452617604051957e-01   +5.413230599472150e-02   -3.480687586036153e-03   +1.411296523019721e-01   -7.783406817545493e-02   -3.457067961529103e-01   -2.647708158612264e-01; +4.784564214595111e-02   +1.349999947496351e-01   +2.743762769507518e-01   -3.005238016691288e-02   +6.368903112211095e-02   +5.167064597761595e-02   -7.405237236474508e-03   -7.271276336802333e-02   +2.785980744420626e-03   +8.451311224131319e-02   +5.044319538587527e-03   +5.261325678544179e-02   -1.967356704722183e-01   -2.120433612225733e-01   -3.343395999190375e-01   -1.477155033472762e-01; -2.003518615487137e-01   +2.301577297884863e-01   +2.464517466686217e-02   -2.862417227310565e-01   -1.097226889580016e-01   -1.258320208077644e-01   -9.664871453727034e-02   +3.073905881903233e-01   -1.530738348423239e-01   -5.933015443460972e-02   +1.642432066332256e-01   -2.063066740680495e-01   -1.070298105066916e-01   -2.129781054732147e-01   +1.759533785268073e-01   +2.627838461158819e-02; -1.605454019425502e-01   -3.140241164702128e-01   +1.954174549815867e-01   -1.923916355050754e-03   -1.211503515618558e-01   +1.153329166953777e-01   +1.797299046242737e-01   -1.633738847576364e-01   -6.087642193045618e-02   -3.030955049300302e-01   -6.067384135759057e-02   +7.898112780581173e-02   -5.791888709799158e-02   -8.199155760488817e-02   -2.020735429015609e-01   +2.757354994068457e-02; -2.312589353358245e-01   +1.447822655777606e-01   -2.874499584365412e-02   +1.794154527968014e-02   -6.487975486224523e-02   -2.373883238591990e-01   -3.462797595942248e-02   +5.136736081879244e-02   +3.314664729786829e-01   +6.941941761418684e-02   -9.544954020862270e-02   -2.117710681666950e-01   +2.663083896768547e-01   -2.138819801416279e-01   +2.010341450797351e-01   +1.337005239825560e-01; -2.681695710921155e-01   +2.706718958349508e-02   +1.951819247331837e-01   +1.137243117472636e-01   +1.311853883819912e-02   -2.405458007377637e-01   +1.570734947056051e-01   +9.661054945495967e-02   +5.004919458413799e-02   -1.105413156146124e-02   +2.339649921774047e-01   -6.431806492765454e-02   -1.789819780076653e-01   +1.371574373302720e-02   +8.268932522594516e-02   -1.001464881975403e-01; +1.572306237679256e-01   -2.628511525103430e-01   +2.843572007652461e-03   -5.714022650394676e-02   +3.708571403735272e-02   +3.647492429094678e-02   -7.583489404478994e-02   -1.434649296269253e-01   -1.501953759025210e-02   -1.289269504413931e-02   +7.070585911567835e-02   -1.332711170482014e-01   -1.969287290137250e-01   +3.052916440133126e-02   +6.517578472549104e-02   +4.974478875520528e-02; -9.841346620340102e-02   +6.538569703261804e-02   +1.423885993001719e-01   -4.131449735355519e-02   -1.214847256607167e-01   +1.563955021491784e-01   -3.814603983156407e-02   -4.413364609366063e-02   +1.960476151808605e-01   +1.305534145222796e-01   -1.363836137848473e-01   +1.096131094232681e-01   +3.430292951180103e-02   +5.006451550207663e-03   +1.861157621016563e-01   -7.090160085737057e-02; -5.853435014825269e-02   +9.299378951268671e-02   -2.091411198547982e-01   +9.099800313743008e-02   +6.669814192732226e-02   -2.077361854519544e-02   +2.747159659239163e-01   +1.706601817327221e-01   +3.085925541831829e-01   -9.805700286969010e-02   -3.603520140857443e-01   +1.162409572800770e-01   -1.057692749461320e-01   -2.050902603098132e-02   -2.258761731585756e-01   +1.366152289784784e-01; -5.553433594452910e-02   -1.634688335344598e-01   -1.048049259034927e-01   -1.276837914325326e-01   +1.660495633387813e-01   +7.316987015203923e-02   +8.157883630090103e-03   -1.153167213336829e-01   +7.528320709764501e-02   +2.503642865087047e-01   -8.525687949339854e-02   -8.946121708419545e-02   +1.562284231970008e-01   -7.625187163663083e-02   -1.479308560950199e-01   -3.777116036935670e-02; +1.817812149009922e-01   -4.192499828645799e-02   +8.580350371257001e-03   +2.143589358678158e-01   +1.600961715239538e-01   +3.667367117479393e-01   +1.975973264216394e-01   -1.584182909341329e-02   -3.207486300123054e-01   +1.126672710531751e-01   -1.058226509800387e-01   +6.108289626739084e-03   -1.522973803051726e-01   +9.548749922771697e-02   -1.452024262833509e-01   -2.565826711179123e-01; -6.019871374846674e-02   -8.918931945328218e-02   +6.007106339538765e-02   -7.336220322722642e-02   -1.704924375206678e-01   -3.568029757857047e-01   -1.323957713969361e-01   -1.198387495579890e-01   -6.676660944018038e-03   -3.505386061245570e-02   +1.292865112512070e-01   +7.006899580299951e-02   +1.241922570685847e-01   -3.128398946419050e-01   +3.357356954740588e-02   +3.029346106563697e-02; -4.347967411056432e-02   +6.956399823197029e-02   -6.706453841727120e-02   +1.484204714331683e-01   -9.438533046482632e-02   -2.568942182865118e-01   +1.919982256557213e-01   -2.025335034694470e-01   -3.685390047700155e-02   +1.603320066381520e-01   -5.812212973476245e-02   +2.462831461991213e-01   +8.434317882667161e-02   +2.742609503407175e-02   -6.757374515589423e-02   -7.723378428583749e-02];
L1E_L1I_iGABA_netcon = [-2.499636196091594e-01   -1.531164428383379e-01   -8.793439861770138e-03   -1.018783267622960e-01   -7.757312889903295e-02   -3.103059024919503e-01   +2.568967132565246e-01   +1.742290692743593e-02   -3.000966955474894e-01   -1.459258258796357e-01   -3.768422387380417e-01   -3.631257679749812e-02   -1.646475148328701e-01   -2.187543697992162e-01   +2.348982826343781e-01   +6.549396289181156e-02; -1.815177830889441e-01   -7.536000657618166e-03   +9.956593877871561e-02   -7.305205570823413e-02   +1.556029649760992e-01   -1.287946044797276e-01   +2.689275048371049e-01   +9.770114775495933e-03   -1.629165584619881e-01   +8.537784442254873e-02   -1.586110690365657e-02   +6.484147766036963e-02   +3.042769538779938e-01   +8.477134098948709e-02   +2.299898847064502e-02   +1.279965786186482e-02; -2.195292565645027e-02   -4.142440056559694e-03   +2.220221226800023e-01   -1.854810885918968e-02   +1.343427909696280e-01   +1.350994819751641e-01   -1.276743302162726e-01   -2.117514010985682e-01   +1.521375352230567e-02   -9.437457219386093e-02   +3.998285502959685e-03   +2.270503402358602e-01   +8.339442566931021e-02   -2.104746145201144e-01   -1.492350131359334e-01   -2.776657375903888e-01; -1.544392846234722e-01   -1.397601072419150e-02   -3.238498093377075e-01   -3.177731603682180e-01   -1.448477047413569e-01   +1.664488706444574e-02   +9.631350010591493e-02   -1.766144530491844e-01   -3.981051936761632e-01   -1.272586556333497e-01   +3.304434148568540e-02   +8.134836287230170e-03   -6.852647498606210e-02   -1.044900881311519e-01   -1.534897129370578e-01   +6.390755678771901e-02; -7.833934720639237e-02   +3.859891968209737e-02   +1.968824100772281e-02   +3.834770996735695e-02   +1.161406836727322e-01   -7.343782485348407e-02   -3.516384569014204e-02   +1.077624738049766e-01   +2.427963466175591e-01   +7.571176747634098e-03   -7.147474579962898e-02   -5.285599767480621e-02   +1.497812489931247e-01   +1.455103890263421e-01   +1.538264933290913e-01   -9.631064848856456e-02; -2.743856028509828e-01   +1.716844343526058e-01   -8.169067107951043e-03   +4.591484199721121e-02   -1.055661872100197e-01   -1.667302636195661e-01   -2.254803626296392e-01   -3.054158706333632e-02   +1.720435018684719e-01   -2.891515617269313e-02   +1.424967412187420e-02   -1.018697245090681e-01   +5.935417934611878e-02   +4.388296132882019e-02   +6.644432300757810e-02   +8.715896077261395e-02; +1.251404235952907e-01   -4.641049080670399e-02   +1.643841363014872e-01   +3.086393515654003e-01   -3.869604891198524e-01   +1.206986589110458e-01   +1.839194166143133e-01   -5.124173614683952e-02   -2.500502125588740e-01   -1.449599075648275e-01   +1.497179596618494e-01   +4.077916620779157e-02   +2.794208688737012e-01   -8.884409498672868e-02   -1.250546536741123e-01   +1.618257744105854e-02; +6.983299532709601e-02   -9.204576149968646e-02   -1.338011705269954e-01   +1.236711364386571e-01   +8.356441017828425e-02   -1.093673331618650e-01   -1.905208195324939e-02   +1.018725802230689e-01   +1.292952800434792e-01   +3.869195226802838e-01   +1.601269536985554e-01   +4.175990195012573e-02   +1.626687269177269e-01   -1.318259429878669e-01   +8.380092526704801e-02   -2.918217848065506e-02; +3.572215260769324e-01   -1.032444280929934e-01   -2.144834884387635e-01   -3.355266712360404e-02   +5.402189041153181e-02   +2.054755354963566e-01   -7.279233895209948e-02   -1.167488903549405e-01   -4.773924296920345e-02   +3.149788900935634e-02   +1.766849924093674e-01   +2.918484187126757e-01   -1.446885178723940e-02   -8.562544067583192e-02   +2.407966182184528e-01   +7.716091762286120e-02; +8.239810066089756e-02   +1.215747984504105e-01   +1.338823551967200e-01   -2.598772977782287e-01   +1.174365216277441e-02   +8.449311127848434e-02   -2.129876946495519e-02   +2.193983691825783e-01   -7.703702968215533e-02   -1.012219319883163e-01   -2.220836632460714e-01   -1.677113189879745e-01   +5.713616376303694e-03   +8.996676208643171e-02   -1.308829352427379e-01   +1.659499910919822e-01; +9.771757770032023e-02   -3.178332435407025e-01   -7.481566957423907e-02   +4.504598044129086e-02   +2.958297652700513e-01   +7.815955828669209e-02   +2.534910917498915e-01   +2.388873816569854e-01   -2.433315847353076e-02   +3.628041866865525e-02   +6.350333754584336e-02   +2.078999902556103e-02   -6.598764398220980e-02   -9.085266950823687e-02   +3.634826863174225e-01   +4.655847394654943e-02; +1.088908307018560e-01   -5.163979062271092e-02   -6.505892496658665e-02   +1.053317791857429e-01   -3.879252880999903e-01   -1.442687551703875e-02   -2.372121199030552e-01   -1.880421346169900e-01   +1.700690702059139e-01   +1.500086334240493e-01   -2.258754233096281e-01   -2.435247984563375e-01   -2.141352283482761e-01   -1.055952338731829e-01   -1.110028682570882e-01   -3.048145413248854e-02; -1.256448451388890e-01   +5.349682233939369e-02   +2.239147435657703e-01   +1.125230261604502e-02   -2.583306042871576e-02   +1.652289437502838e-01   +3.202555874915757e-01   -1.257066064424930e-01   +2.028456418254391e-01   -1.157287820724981e-01   +2.072379359996318e-01   +1.210503751304846e-01   -1.224163707153362e-01   -4.562695871374983e-02   +7.365970949632118e-02   +7.236007474847350e-02; +2.027898858249554e-02   -1.335663992902358e-02   +2.243413682041558e-01   -6.930422854724808e-02   +1.808401665586694e-01   -1.038139360362886e-01   -2.608520776282813e-02   +1.544028232340683e-01   -1.672432854859909e-01   -1.474826127706949e-01   -3.589626662613492e-02   -2.090059987446386e-01   +2.240421698531780e-02   +2.082236749467086e-01   -2.078654700501807e-01   +2.190049781936926e-01; -9.011600636746069e-02   +1.473672669882782e-01   -5.240713979294608e-02   -1.275555803272833e-01   -6.711147274075155e-02   -1.045699405236850e-01   -6.806573294827413e-02   -5.726607750573302e-02   +5.052753741676633e-02   +3.290297941211320e-02   +6.289928777452949e-03   +1.281514679383173e-01   +2.214185116442172e-01   +5.826918815560521e-02   +1.403940056768642e-01   +2.598895177903962e-02; -1.539086721159701e-01   -9.828986976983990e-02   -9.536680293664915e-02   +2.002028415255420e-01   +8.420571088447286e-02   -6.930323022587477e-02   -1.777734621332074e-01   +1.713226320558542e-01   -5.264289266184327e-02   +1.487963938983141e-01   -1.547895076369352e-01   +2.057264093813191e-01   -5.736473724011902e-02   -5.017812550232434e-03   +1.439008899008597e-01   -4.062113792317466e-02];
L2I_L1I_iGABA_netcon = [-2.189897567519466e-01   -2.494823133833155e-01   +2.097723829258478e-02   +2.012033338349146e-01   +2.359053975649351e-01   -2.673283119015092e-01   +8.693559782952692e-02   +3.765774881315272e-02; -5.330290960841103e-02   +2.315979628810543e-02   -8.925498577422671e-02   -6.900798678124750e-02   -1.880306007078988e-02   -2.699916058479359e-01   +1.571139586690196e-01   -7.108239091342045e-02; -1.143229970663074e-01   +3.127189593767024e-01   -3.533057524316693e-01   -2.762337145115521e-02   -1.141677127968200e-01   -1.522150734642038e-02   +2.084803614770472e-01   -3.898319038544166e-01; -1.465867663481837e-01   -2.584093858432763e-02   +1.669751976770066e-01   -2.075410224704504e-01   -1.369217750843429e-01   +1.454682873981404e-01   +4.509857518871717e-02   +1.986506035435940e-01; +1.792503833896317e-01   -5.374006462265386e-02   -1.162280623901117e-01   +6.189405181386073e-02   +8.229952112866100e-02   +1.746632934325066e-01   +8.899178533064123e-02   +1.889881455855913e-01; +2.481636580686918e-01   -2.888118453377398e-02   +1.727140223833065e-01   -1.214450535122690e-01   -2.146803147732171e-01   -9.048454247196264e-03   -1.330514770704413e-02   -1.581859577418307e-02; +1.144219514789175e-01   -2.969316559772617e-01   +1.312217309977082e-01   -2.007614615774259e-01   +3.461017372096902e-01   +1.032767722268633e-02   -2.185260158372702e-02   -9.846139408460171e-02; +2.373296002745272e-01   +6.419235771104457e-03   +6.529566090682166e-02   -8.111022092749010e-02   -2.615138299353510e-01   +9.860819020834771e-02   +1.881732371227923e-01   +4.438733329161698e-02; +1.490286202027956e-01   -1.369120472346374e-01   +1.048968954905676e-01   -5.911722831140762e-03   +1.744189032327183e-01   -5.289384655580938e-02   +1.979217743844029e-01   -4.225649443584506e-01; +9.512357386938257e-02   -9.982690055425769e-02   -7.299867823215012e-04   -1.501626250224188e-01   -1.655668882428889e-01   -8.151271949958062e-02   -1.164764239245388e-01   +3.817637859839044e-01; +2.074439539104945e-01   -1.809092499137639e-01   +4.373258891103958e-02   +7.738255097856495e-02   +2.653840512998785e-01   +1.974783453861995e-01   -2.558895451379769e-02   +2.258881233145006e-01; -1.320754187146466e-01   +3.082471866446133e-01   -2.070037066735154e-01   -6.443591260278216e-02   -7.422892113603871e-02   -1.370013249231025e-01   +3.916940267289993e-01   -9.934801514577078e-02; +2.606577942520057e-01   -1.893713657823234e-02   -3.312145121619609e-02   -1.560853983031254e-01   +2.120846723667155e-02   -1.173544229459658e-01   +2.207191132252307e-01   -8.029426456248040e-02; +1.528855196728427e-02   -1.130631421786295e-01   -1.722608833128917e-01   +7.863745931941162e-02   -2.668983324982851e-01   -2.430477407626006e-01   -1.611055885744759e-01   -1.963588961319722e-01; -5.178295016555968e-02   -1.904617313859272e-01   -8.501253100070429e-02   +3.778582022343758e-01   +1.429546749564247e-01   -2.877355264541897e-02   -2.171040894411521e-02   -1.347737464359296e-01; +6.522904229229769e-02   +5.526107266643504e-02   +6.225337741938001e-02   +2.131706391445380e-01   -8.721248355665487e-02   +4.761022578276727e-02   +3.342994037228223e-01   +2.681195401591558e-02];
L1I_L2I_iGABA_netcon = [-1.590634198399946e-01   -1.068561056433767e-01   -3.012138155172332e-01   +9.877087151021950e-02   +7.044728979470306e-02   +6.667690647995074e-02   +3.429088738008033e-02   -6.677236052178677e-02   -3.023961012473266e-01   -6.716292190868313e-02   +2.704131097973708e-01   -8.038926446493716e-02   -5.329396593712423e-02   -7.797781030604017e-02   -2.538931982934752e-01   -1.082030182760919e-01; -2.905744372768742e-02   -2.732946994788654e-01   -1.179872623978526e-01   -1.495267066680281e-01   -1.502440951934216e-01   -1.340822082457695e-01   +1.160412207142594e-02   +5.004104070159981e-02   +1.563050391819739e-01   -4.033584687137479e-02   -1.866619324171445e-01   -1.650508051591368e-01   +7.964526673243909e-02   -1.933356062471972e-01   -1.127436000836966e-02   +2.951073843168646e-01; +2.507655349029544e-02   +4.984525895428524e-02   -9.170426662259931e-02   -9.346301540117737e-02   +6.480256156016259e-02   -4.174271654780190e-02   +3.333891019689621e-01   -1.287832066177531e-01   -9.332297512970414e-02   +8.019529362177291e-02   +2.910879580320749e-01   +6.381483727848219e-02   -1.319238585219536e-01   -3.511433588407482e-02   +2.809826554254266e-01   +2.310168905985426e-01; +2.603339695592425e-01   +7.402252429086905e-03   +2.216947299905561e-01   -8.084135472840871e-02   +2.130472612241133e-02   +3.167745820905574e-02   -2.822619152065801e-01   +6.520819820612342e-02   +1.387846419786855e-01   +1.478206095947184e-01   -3.103303570693696e-02   +7.964898388038062e-02   +7.742025842308907e-02   -1.484855824296406e-02   +1.901274940875712e-01   -1.708269365354815e-01; +3.099370660611260e-01   -1.185714470213652e-01   +1.292328032987626e-01   +2.793123775160727e-02   -4.335348746276545e-02   -2.452298531514774e-01   -7.181017188549826e-02   -1.478196693790037e-01   -1.815708993710887e-01   -1.805740947920436e-02   -1.389352800056601e-01   -1.301334519003777e-01   -1.085922489295057e-01   -2.070071782022795e-01   -9.788649728025560e-02   +6.881824164552755e-03; -1.163883063959025e-01   +2.432602703565566e-01   -7.668956117546485e-02   -4.365602415550883e-02   -1.302697566072293e-01   -7.121050335671869e-03   -1.143974705626499e-01   +3.007189813374220e-01   -1.292413931492452e-03   -1.857464448012405e-01   -4.801755733782633e-02   +1.668996368624126e-01   -2.494694924124169e-01   -2.785318524891889e-01   -5.984836742724152e-02   +3.100289081889218e-01; -1.386286948771990e-01   +9.278655576097240e-03   +4.125146352529607e-02   +5.575664720595574e-02   +2.802646638274665e-02   -8.787962175472294e-02   -3.078120179038330e-02   -7.321338555498566e-02   -7.911396135879731e-02   +2.154724791884819e-02   -2.271998058739640e-01   +4.205996244206653e-02   -9.782031397811472e-02   -1.185820840472096e-01   -6.817994011967327e-02   +5.713435088317617e-02; -3.046417684828048e-01   -3.148417612341152e-01   -2.383006876039689e-01   +1.361807613665154e-01   +1.446911538956043e-02   -1.849331958216284e-01   +9.956976501839387e-02   -5.783557391640285e-02   +2.641609485559858e-01   +8.898022806628984e-02   -1.458364210609821e-01   +2.999627215200080e-01   -5.378112306681981e-04   +3.532716670213915e-01   +1.693964644506806e-01   +3.022310048754625e-02];
L2E_L1E_iAMPA_netcon = [+9.574814592649052e-02   -1.483084106954302e-01   -1.307392066396529e-01   -1.984932776979854e-01   +2.736337859126117e-01   -6.516275717003561e-02   -2.059501421733372e-01   -5.175866655509231e-02; -8.000565699617918e-02   -1.009168678160006e-01   -7.295544621427734e-02   -1.712705333176406e-01   -2.720177772230137e-01   +1.241211989849533e-01   +2.691289202453614e-01   -2.029081289979796e-01; -8.894718956866125e-02   +3.050977510170488e-02   -6.762154607779441e-02   +5.295028971865390e-02   -3.518640327291822e-03   -1.956230561173383e-01   +6.005685354748175e-03   +1.687991881612549e-01; -1.081135163740564e-01   -8.680125004103006e-02   -3.525975772760557e-01   +2.194522182545882e-01   -1.169398857750921e-01   -1.883136647704974e-01   +2.156186630461215e-01   -1.230349036582009e-01; -7.185756311345100e-02   -7.037731648094961e-02   +2.113868499853003e-02   +8.262091217357043e-02   -1.487967518227025e-02   +7.328279642924818e-02   +3.715635778221218e-02   -6.524513324613491e-02; +9.389512098575806e-02   +3.761438108703804e-02   -9.597346603439193e-02   -2.219620764975414e-01   -2.974566112636282e-02   +1.353364290575466e-01   +1.241803935241474e-02   -1.015424876509944e-01; +2.472567227965298e-01   +1.111665205666023e-01   +4.701096349408670e-02   -1.015213023769977e-01   +2.716994750639629e-01   -2.004027134421765e-02   -9.223876297114575e-02   +1.207552964759203e-01; -1.798423592246404e-01   -9.950449377755755e-02   +1.047633208966959e-01   -1.183750596040994e-01   +1.198340186114558e-01   -1.875163061075232e-01   +2.641910447370159e-03   +8.780366836106401e-02; -1.154816626453302e-01   -7.394545034954320e-02   -6.884363425389102e-02   -2.556654757102239e-01   -9.470614752644968e-02   +3.257688712192255e-01   -4.079233082185665e-02   +7.958869718779280e-02; +1.867060998798571e-01   -4.607918421961772e-02   +8.800236841645113e-02   +1.200690895630283e-01   +1.596152647515149e-01   +4.707231181641570e-02   -1.109394114111708e-01   +1.631017627869950e-01; +1.737081311549375e-01   -2.073682455683033e-01   -4.220644182433510e-02   -1.148091498970660e-01   +1.318611433167052e-01   -2.779005576752645e-01   -9.010788195297650e-02   -9.327599511075503e-02; +3.301112009355297e-01   -4.583742446255525e-01   +1.668070346468227e-01   -1.395495832878647e-01   +3.339589463795407e-02   -3.479582821051321e-02   -1.411529348087295e-01   +2.557472447060262e-01; -1.877911014137527e-01   -7.232868890331026e-02   +3.506348545793238e-02   -2.615491914755744e-01   +2.419824268186815e-01   -1.628677991444074e-01   +1.822376543931630e-02   +1.188688583726399e-02; +5.810750532003188e-02   -1.062965512640402e-01   +1.732028172555105e-02   -7.960025019716019e-02   +2.091395467005382e-01   +7.266718803956450e-02   +5.360412292647346e-03   +2.111213315644856e-01; -5.100588811368069e-02   -1.695938401675942e-01   +6.164323518434082e-02   -1.379144567400046e-01   -6.828338020332851e-02   -2.609768850421431e-01   -2.351169627262397e-02   +3.552826302432340e-01; -2.032842437056719e-02   +2.055140858951190e-02   -8.710058930635440e-03   +4.038182305790214e-01   -3.343224026529292e-02   +1.388937774074665e-01   +8.385136671074866e-02   -1.956801668796538e-02];
L1E_L2E_iAMPA_netcon = [-1.437379592696737e-02   +2.330087964508484e-01   +4.313486312090929e-02   -2.595504100860291e-01   +1.471944906506054e-01   +8.430522039255153e-02   +3.488915617444514e-02   +1.276505108336690e-01   +2.216817699124643e-01   -1.211535924514174e-01   -1.178071588540548e-01   -1.883863783714745e-01   +2.712047681508526e-01   -1.650743842862449e-01   +1.204657033883354e-01   -1.855550570588153e-01; +1.371261630226535e-01   +3.613175106045589e-02   +7.872564549419497e-02   -1.792310226999735e-02   +2.528391939316169e-02   -4.865668820328121e-03   -1.074610088215185e-01   +7.830964486615599e-02   -7.216744738976501e-02   +7.947132615768433e-02   -1.014363556463176e-01   +1.350840909212203e-01   +1.631124314969754e-01   +6.705886311906376e-02   +1.624197542513835e-01   +8.241331394978395e-02; +1.796463289427801e-02   +1.699480178695759e-01   +3.250990967059417e-01   +1.219818100152473e-01   -2.679198728052741e-01   +3.844359061066109e-01   -1.194832436724034e-01   -7.586644179945476e-02   +1.915258768413963e-01   -7.207470675264804e-02   +1.484496018326585e-01   -5.269191983742329e-02   -3.231774219982639e-01   -3.519243817742559e-01   -1.630905585892833e-01   +1.746518334527375e-01; +2.126171379106949e-01   +1.139973965223480e-01   +1.687898944936815e-02   +1.459432127933839e-01   -1.621941887547034e-02   +1.225313145131982e-01   +9.248902806701120e-02   -1.138301121430807e-01   -3.890182269733913e-02   +1.655181506002388e-01   -2.996351390912064e-01   +7.795816183804739e-02   -2.371679402285398e-01   -2.176463271540431e-01   -2.684723958876949e-01   +1.565279996422440e-01; -2.587935255522231e-01   -8.807020215904404e-02   -6.769930146776554e-02   +3.724038832383729e-01   -1.058703307002878e-01   +1.540596359436704e-01   +1.168959280468905e-01   +1.240017275490577e-01   -1.668995924605710e-02   +2.232137634811115e-01   -2.087280279879805e-01   -2.582748965959645e-01   -4.089023848987692e-02   -7.639073974299589e-03   +1.810734396427600e-01   -4.445223478993954e-03; -1.766900394405324e-01   +1.453214691066055e-01   -2.705747809774750e-02   +2.685834848643179e-02   +1.507086040736952e-01   -2.134832864088716e-01   +2.584603233157456e-02   -4.566849185087581e-02   +2.546949430264362e-02   -2.423775234569164e-01   +2.336723807458054e-02   -5.704187788937642e-02   -1.308150663293229e-01   +1.661660478143803e-01   -1.290534476165636e-01   +2.572948410944871e-01; -2.786291400775385e-01   -1.062881256818565e-01   -2.210652331942556e-02   -8.088214029137765e-04   +1.816366624278332e-01   +1.635407734303260e-01   -2.592477046559583e-01   -2.810315388041847e-02   +2.765618466085720e-01   -2.106203096505737e-01   +9.437211328054909e-02   -1.440626692354874e-01   +2.190786625846655e-01   +3.647814457674222e-02   -2.144334347353390e-01   -2.704588921037802e-01; -3.912325687089474e-02   -3.527387734574506e-01   -3.575985758687931e-01   +2.229694762453426e-01   -3.705986546362566e-02   -3.314672157316175e-01   -1.906668873291862e-01   -7.777933484474396e-02   +2.052309771275861e-01   -6.802291384310470e-02   -1.901742795854156e-01   -1.024881182013813e-01   -1.644224153145420e-01   -1.608798953326881e-01   +1.748924521066172e-01   -1.526975588916182e-01];
L2I_L2E_iAMPA_netcon = [+2.651402970339628e-02   -1.566380152936713e-01   +5.545664279329404e-02   -4.294178127878941e-01   +1.991943548661975e-01   +2.816373375956175e-01   +1.409522087034342e-01   -1.426430817075216e-01; +1.347045572594827e-01   -2.847776807252920e-01   +1.137636300692591e-01   -8.414462695062221e-02   -1.285264251110465e-01   +2.888179040415998e-01   -3.428446275066009e-01   -2.458533497859003e-01; +1.221507056710264e-01   -9.201570689403939e-02   -2.144423767227733e-01   +3.011527242405596e-02   +2.677280161974750e-01   +1.421058999291793e-01   +3.063990152846825e-01   -2.076459123928309e-01; -7.204515926122158e-02   +1.613935984192768e-01   -1.565496958514919e-03   -1.134248885431511e-01   +1.314334913569331e-01   -6.367385599759690e-02   -1.720741546343480e-01   +1.549777535169077e-01; +4.538245093566304e-02   +1.289341688510414e-01   -5.812435600793165e-02   +3.380549540494308e-02   +2.872028299425451e-01   +1.155837052791589e-01   +3.633247404743949e-01   -1.750317560448306e-01; -4.927755749483189e-02   -2.075018808046920e-01   +1.448833193840084e-01   -9.536494315821770e-02   +9.037570286943597e-02   -4.314866308937555e-02   +2.104423282652321e-01   -2.640771173455731e-03; +1.033087455730074e-01   +2.697564428329960e-01   +2.332409159738080e-02   +1.653185532397397e-01   +6.369166341333281e-02   -1.159925843135073e-01   +1.560654996762815e-01   -4.513239645893137e-02; -2.536195386448722e-01   +1.119787784249591e-01   +1.377725192430156e-01   +1.250132360071855e-01   +1.958988352650609e-02   +4.539853175773666e-02   -9.911266572538782e-02   +3.394819553864105e-01];
L2E_L2I_iGABA_netcon = [+1.779023135738573e-01   +6.685199149699433e-02   +1.421110336094044e-01   -2.045904154931098e-01   +2.663591276965078e-01   -1.878361442292620e-01   +7.822482963183609e-02   +1.999526426698761e-01; -2.016945975917934e-01   -7.893431391360312e-02   +5.290353295740255e-02   -1.196865318526075e-01   -8.276977295685045e-02   -1.851825337767511e-01   +5.493787213709506e-02   -5.804422516062197e-03; -7.239378108082556e-02   -1.062471573863588e-01   +1.571500361141039e-01   +2.152106827995921e-01   +6.029956165709949e-02   -1.625322488651172e-01   -3.359382849964644e-01   +2.862956372578872e-02; +2.572928983930869e-01   -4.132526051203237e-01   -1.496455963402252e-01   +2.884937907448487e-01   +2.119555249731528e-01   -3.927550252371727e-02   -2.332308755471642e-02   -1.992291795652102e-01; +8.392300176198471e-02   -4.039872591761915e-01   -3.399774351368100e-02   +3.420215344691909e-01   -1.885288114857546e-02   +5.673239493234300e-02   -7.221427119398310e-02   +5.893751325801259e-02; +2.540679504186000e-02   +9.458855314563371e-02   -1.564170933515290e-01   -1.866621001794584e-01   -1.706524459679470e-01   +4.234677508342465e-02   -1.761198588055397e-01   -2.514686303088213e-02; -1.667397149331374e-01   +3.391315488983571e-01   +3.585042711508781e-01   +6.801254304896302e-02   +2.446152709682025e-01   +4.445984703024053e-02   +8.210177913328255e-02   -1.798588571535902e-01; +7.402422855227473e-03   -3.783254841293369e-01   +1.564722196250374e-01   -8.346199014611863e-02   -1.010852645178238e-01   +1.817557394753506e-01   -2.559761099321558e-01   -7.708882173041223e-02];
L3E_L2E_iAMPA_netcon = [-1.133228055411209e-01   -1.639757341980253e-01   -2.235239679207666e-01   -8.165343495438009e-03   +3.425132502455856e-01   +4.338380871899555e-05   +6.599325103861109e-02   +1.340946179392849e-01   -2.988352390547330e-03   -8.917344162757464e-02   -3.991052284536421e-01   -8.284073111730839e-02; +8.081116830050347e-02   -6.233487428416618e-03   -1.058146615943085e-01   +1.514329880171580e-01   -1.938193220728005e-01   -1.699811601630001e-01   -1.338445847279219e-01   -9.843829883338451e-02   +2.758615522558843e-01   +1.691587336859439e-01   -3.967852602040270e-02   +1.288495647448833e-02; +8.644601901324721e-02   +8.698914928756668e-02   -1.804224287429361e-01   +3.038408236831443e-02   -2.733097539805558e-02   -3.099414498384093e-02   +7.109415318628921e-02   +9.434380524044376e-02   -1.375302737562147e-01   -2.088393661771031e-01   +6.892398931851743e-02   +2.110612237218883e-01; -1.320272990801537e-01   -4.199775228052530e-02   +2.833411528690886e-01   +2.263741880190836e-01   +2.741730999917560e-01   -1.181481970696041e-01   +1.050384315864300e-01   -2.401022999110714e-02   -1.169646743118449e-01   +1.044609260445609e-01   +3.212489415130190e-02   -1.069599312612581e-01; -8.695411666626104e-02   -4.159940730501034e-01   +7.529455112184319e-02   +1.508087161428484e-01   +1.237495296415774e-01   +1.535589669354611e-01   +1.410750368047743e-01   +1.499857067569972e-03   +2.615462977342161e-03   +1.087339304152027e-01   -2.017855965439568e-01   +2.966897625752145e-01; -4.411110278662452e-02   +1.077043014917812e-01   +4.821822055573771e-02   +1.361155851305634e-01   -1.361518188614463e-01   +5.073695833454993e-02   +8.940857444262189e-02   -1.188846709403032e-01   -6.322189160534543e-02   +2.287464587096899e-01   +8.978416463711400e-02   +1.408264849315214e-02; -1.267488643313137e-01   -1.785934243480228e-01   -6.749267975741732e-02   -1.971867424209554e-02   -1.287359025655289e-01   -4.752308324731688e-02   -6.936589442828259e-02   -6.098291523536289e-02   -9.462902106504167e-02   -8.885912381805502e-02   -5.694498876067557e-02   +9.914002431642199e-02; -1.555015939404696e-01   -1.170303882125056e-01   +2.310837918538038e-01   -3.059631277247621e-03   -1.734398954876476e-01   -5.859639992251492e-02   -1.894490584467416e-01   -1.707049113266212e-02   -2.662229259080778e-01   +1.519247717842332e-01   -2.757762828458702e-01   +2.621011565153405e-01];
L3I_L2I_iGABA_netcon = [+2.161050958639379e-01   +3.872789989895186e-01   +1.888418174245508e-01   +1.378951537478746e-01   -6.377432449633798e-03   -1.345767822363326e-01   +2.230253071044039e-01   +6.474453157744244e-02   +1.693130352591240e-01   -1.299386383415195e-01   -1.412920717631282e-01   +1.382800212205352e-01; -2.193372457092187e-01   +6.789606667263660e-02   -3.642921965298189e-01   +1.453901902554937e-01   +2.396713782069435e-02   -7.930367553755269e-02   +6.024981493343404e-02   -2.512916040076130e-02   +1.041033408554696e-01   -1.076676208741716e-01   +4.402580723943014e-02   +1.442774247912245e-01; -1.813124389371916e-01   +9.354504573341679e-02   -8.278769930052454e-03   -2.392366799540612e-01   -6.606854734297771e-02   +3.926988692822792e-02   -1.868587870496379e-01   -4.385271971976166e-02   -3.690624747856326e-01   +2.075377324773419e-01   +5.518325371043332e-02   -8.678923203962023e-02; +1.861990948904241e-02   -5.754215280870585e-02   +1.888234063430554e-02   +6.892255822358259e-02   -1.399039719169476e-01   -5.502614908365924e-02   -9.136766864305008e-02   +1.761585999970936e-01   -1.130652301840334e-02   +5.076224492061043e-02   -2.791172415865982e-01   -4.295233253712563e-02; -1.186054013667102e-01   +1.371517761241030e-01   -2.135116907346292e-01   -1.224439095440210e-02   +1.700541595785526e-01   -8.616691761611919e-02   -1.518268773650481e-01   +6.435617840596772e-02   +2.118729222989887e-01   -2.243352802347422e-02   -1.073480961832413e-01   +8.943175569200587e-02; -4.595232833313349e-02   +2.046950784793732e-01   +1.619871460575912e-02   +1.038334459832887e-01   +2.829990032340409e-02   -3.128482826491585e-02   +6.923932703397549e-02   -1.497842883922213e-01   -3.092072930551515e-04   +8.907133641822992e-03   -2.691291325590325e-01   -6.005665436804047e-02; +2.957105515099648e-01   +1.960030503694631e-01   -1.628996999614448e-01   -2.157809965389852e-01   -3.494371005501277e-01   -9.749074974177083e-03   -6.516989234379153e-02   -3.091102836407065e-01   -2.225536979128918e-01   +7.794400917593212e-02   +9.458716942213455e-02   +1.740437462802755e-01; -1.483904674084110e-01   +1.788393735054444e-02   +1.886273993018997e-01   -1.109203983069655e-01   +7.153654313834518e-02   -1.867898277934730e-02   -3.221858697590422e-01   -1.734261461738020e-01   +1.622223664571364e-01   +2.278616735269492e-02   +6.703720816537023e-02   +1.394323395750303e-02];
L2E_L3E_iAMPA_netcon = [-5.819244969103357e-02   -8.464006308110057e-02   +1.655514614092737e-01   +8.820536306630658e-02   -1.794807719943064e-01   +1.884328339094997e-01   -2.942384284080864e-01   -8.402445066743777e-02; -1.403837910733553e-01   -1.628613927871836e-01   +8.063740096940697e-03   +1.593701737873505e-01   +4.857912736480850e-02   +5.654418484431824e-02   -2.258504736265635e-01   +8.611809345264272e-02; +1.838232070884366e-01   -1.069812236102212e-01   +3.824928987130215e-02   +3.595063113510264e-02   -1.034998145016963e-01   +2.227494219172781e-02   -1.714999615675475e-01   +2.919556887066074e-02; +2.761161976255508e-01   -1.651255046276685e-01   +9.682583526591086e-02   +3.898445116700873e-03   -5.008111749747902e-02   -1.883704034795143e-01   +7.381746279858348e-02   -2.532097724408529e-01; +2.215915841210707e-01   -6.929343913180362e-02   -1.189477707516199e-01   -1.390290708960138e-01   -1.891128580422554e-01   -9.381920404062208e-02   -4.715744568448768e-04   -2.430481995720831e-01; +1.619856718340636e-01   -2.848671725935700e-02   -1.597604417630902e-01   -1.142943788706113e-01   -4.097562531968120e-02   +2.879853086492950e-01   -3.013016035878383e-01   +1.211837550132953e-01; -1.458524891399750e-01   -1.701508879833398e-01   +9.435679640877342e-02   -1.667982287367478e-01   -1.097389191973053e-02   -1.959891250517384e-01   +4.428463856577129e-01   +1.618903566234211e-01; -1.620988346941148e-01   -4.085526954042139e-02   -1.868754073641781e-01   +1.768515485804026e-01   -4.282940561146399e-01   -1.509276600245520e-01   +2.022819277178447e-01   -1.381548226535448e-01; -1.328648622552236e-01   -1.361705877462471e-01   -1.281311151142823e-01   -2.801268949162670e-01   +1.371137781798033e-01   +1.137196149601937e-01   +1.662101385178039e-01   -1.287856252120556e-01; +1.762243013177514e-02   +1.581604365866451e-02   -2.299256243955357e-01   -3.347818940887486e-02   -3.797390600510848e-02   -1.059126943702982e-01   +2.109108988941825e-02   +1.175788667196074e-02; -7.404445457143113e-02   -8.637240304988128e-02   -6.707658833496456e-02   -1.969209075122036e-01   +1.948625245457863e-01   -1.225891832641230e-01   +2.373202563941049e-01   -1.694952388286595e-01; -4.807622759010759e-02   -1.165046973308428e-01   +1.340227672677117e-01   -1.050695184757582e-01   +4.465310248595222e-02   -7.111694799150149e-02   +3.170925442167388e-02   -5.279043190555376e-02];
L2I_L3I_iGABA_netcon = [+1.251857546658821e-01   +1.768726951614256e-02   +2.685692213787467e-01   +2.042332325851768e-01   -3.508939606566997e-01   +6.391087058334523e-02   +2.586037351459970e-01   -2.022955336039097e-01; -8.652545138816596e-02   -2.129465675214279e-02   +4.655228821751147e-02   -7.404958114140119e-02   -9.768384229490819e-02   -1.652914335175170e-01   +2.565026107283043e-02   -4.886667861555948e-02; +1.622587505377499e-01   +6.990655401868642e-02   +2.180648146860655e-02   -6.778413038607579e-02   +1.537089923693282e-03   +5.548471029717215e-02   +1.648958302221618e-01   +1.893046187326786e-01; -1.722662449679530e-01   -1.457737044333532e-01   -5.105979211459416e-03   +7.347601723410892e-02   -2.223342434349341e-01   +1.769167176918292e-01   +4.178379771563353e-01   -2.664229793505946e-02; +3.180027465726624e-02   +2.030029281989649e-01   +3.621613026533022e-01   +1.722362306662059e-01   +2.889244255946668e-01   +6.618593446234802e-02   +7.173481625968170e-02   +7.840907885716351e-02; +4.348712966653238e-03   -8.978684291356007e-02   +2.001076030147375e-01   +6.512032178794316e-02   -3.364491769376389e-02   -6.377742500210755e-02   +9.661137681186212e-02   +3.875144496461425e-01; +1.543319015854173e-01   +9.492616485615492e-02   +2.017269030516447e-01   +1.052431255409907e-01   +1.454685311528701e-01   +2.829662161827320e-01   +1.585430126416335e-01   -1.843596859893142e-01; +6.761228134300511e-02   +1.264773781886147e-01   +4.702077490763950e-02   -9.048826218659714e-02   +2.988968607560111e-02   +2.859118617673900e-02   -1.624531296087819e-01   +9.170994249774847e-02; -1.788623626710955e-01   +1.665886441416984e-01   +8.282954317111578e-02   +2.440116282199408e-01   +1.964576004127007e-01   +2.553355438221954e-01   -6.719074231955981e-03   +7.538503118000223e-02; +2.905140601188157e-02   +1.163887582121338e-01   +1.230708204022732e-01   -2.813150387929093e-01   -1.317508507581816e-01   -1.575574592086059e-01   -2.893250243195397e-01   +2.781593358094823e-03; +3.502323634020674e-02   +4.020751128696846e-02   +6.579506705421190e-02   +1.114805819698854e-01   +1.159580531505552e-01   -1.941827410197003e-01   +1.656082933204133e-01   +2.348602114553559e-03; +5.304814219309700e-02   -3.707313995767438e-02   +2.628898239966823e-01   +1.074516096092549e-01   -4.745789629869469e-02   -2.133936240115623e-03   +8.964489825375540e-03   +1.277983875482241e-01];
L3I_L3E_iAMPA_netcon = [-7.697942082676051e-02   -2.014873178068146e-01   -1.536607917425278e-01   +4.156604398765786e-01   -1.860059512904711e-01   -4.179468177156415e-02   +4.076734426016187e-02   -5.982634292436986e-02   +1.449645933650660e-01   -2.605820069196432e-02   -1.606973615666510e-01   +2.410721232633939e-01; -1.792246008453883e-03   +5.080127286681342e-02   -2.036968424234501e-01   -1.264790528509457e-01   +2.300753977695274e-01   -2.125373746804723e-01   +1.335396761505579e-01   -3.022132139452927e-01   +2.520375025212006e-01   -2.139094247870901e-01   -2.047429336385659e-01   +2.104197654376392e-01; -2.690622926668743e-02   +7.977139401753866e-02   +2.004909579160573e-01   +4.267782397319952e-02   +1.150242746017513e-01   +8.220045417276683e-02   +1.927244139308608e-01   +2.088598696105965e-01   +1.431538153653714e-01   -1.141661831452180e-01   -2.602658497865284e-01   +1.124153370269171e-01; +1.243779025807311e-01   -5.006539738826395e-02   -3.727574697892387e-03   +6.640113708260125e-03   +1.206166403596650e-01   -1.522289635246410e-01   +3.296859943162263e-02   +2.530710900673697e-01   -1.051704714378108e-01   +1.821159993828206e-01   +2.987615694302410e-01   -9.833490048664238e-02; +1.510376156352720e-01   -4.077195545369781e-02   -1.738912787173576e-01   -2.817853637708576e-02   +2.846635879739179e-01   -2.056384984138455e-01   +1.150798366051589e-01   -4.121159584291217e-02   -1.668248945593931e-01   +1.941853174641845e-01   +1.212714883846214e-01   +1.471488193279295e-02; -2.407854350560569e-01   +9.726789703891393e-02   -2.467317150299604e-01   +2.794693534707788e-01   +1.229622167985599e-01   -6.910928674458648e-02   -6.189981995754445e-02   +2.290544111640734e-01   +1.451540500836384e-02   +2.449169654566335e-01   -1.102348419306263e-01   -7.681961495668783e-02; -5.821214004206700e-02   +1.086405519394054e-01   -2.132593570246437e-01   +1.123615545620945e-01   -1.905559933454565e-04   -6.793611995482012e-02   +6.664938544167298e-02   -2.247655170269085e-01   +3.714610153993193e-02   -2.053323578309582e-01   +3.187030035659502e-01   +1.443249517607593e-01; +2.150955196880546e-01   -5.466566968940419e-02   -1.084587001375833e-01   +1.195584278343985e-01   +1.368014821928522e-01   +1.642267982017390e-01   -1.384753468765441e-01   +1.013043041448081e-01   +6.699193693113939e-02   -5.450212458446220e-02   +1.533593078944549e-01   +5.215568726817519e-02; +3.424007746632038e-01   -2.359750594395507e-01   +3.150672284017872e-02   +1.365403583626282e-01   -6.832907414584333e-02   -6.700531904467967e-02   -1.618648781820291e-01   +1.150186918161274e-01   -6.190056401854754e-03   -2.508143702188920e-02   -1.915165020304477e-01   -7.727971711340828e-02; -1.178109075667126e-01   +1.969875128832694e-03   -2.042308664934691e-02   +9.298118188669456e-02   -1.579600141787731e-01   -1.079239248889530e-01   -7.854506494098713e-02   +1.595085000605896e-01   -2.744586874541026e-01   -3.763575050022460e-01   +1.777633501250929e-01   +1.046170270004020e-01; +7.530584517863419e-04   -1.864334391684014e-01   +1.787422361740777e-01   -1.942568672849157e-01   +1.834163360807178e-01   -1.198333799914870e-01   -2.692278104553890e-01   +2.876767365292297e-02   -2.413998755892469e-01   +2.862055339062852e-01   -5.406700242437740e-02   -4.142699954183358e-02; +3.084281915746423e-02   -7.029742920905251e-02   +1.856211153062214e-01   +9.946783016835672e-03   -1.634005010207864e-01   +5.770616964418306e-02   -3.044971578226426e-02   +1.160922965622238e-01   -1.424977023449708e-01   +2.545327797371522e-01   +2.122932157818857e-02   +1.634409319078041e-01];
L3E_L3I_iGABA_netcon = [+2.610161683176738e-01   +1.268912392870246e-01   +1.302731870202617e-01   +1.751807510192057e-01   +7.533893119817497e-02   -1.855648866341293e-01   +3.083260965064687e-01   -1.712347657821696e-04   -1.103368764013427e-01   -1.189154064337058e-01   +2.697601769652062e-02   +2.481803716597291e-01; -1.692393983718521e-01   -1.750869747381146e-02   +1.339088999007828e-01   -7.272665429467035e-02   +7.548101195211511e-02   +2.842067854981853e-01   -1.085612196591001e-01   +2.481832326889427e-01   +3.897175165532518e-02   -2.307586379325390e-01   -3.801884057251710e-01   -4.695798645472826e-02; -1.159870052436167e-01   +1.803382058993228e-01   -5.425562520562797e-02   -2.774239959447565e-02   +9.106289686458367e-02   +1.120161314701249e-01   +1.701175707920986e-01   -4.796476560906043e-04   +3.191713524317644e-02   +2.068662134461304e-01   -3.294307189362532e-02   +1.323922290436405e-01; +1.786041103078674e-01   +5.104487368691303e-02   -1.327290720076374e-01   +9.154496202427213e-02   -2.629004469193318e-02   +2.454628808269636e-01   -2.588276517854720e-01   -2.410374602218242e-01   +2.969710112866730e-02   +8.252847588707439e-02   -1.364114172243124e-02   -2.006127510669411e-01; -2.800912455571653e-01   -7.119756535152282e-03   -1.210358798542428e-01   -2.140731329321452e-02   +7.785875712230382e-02   +1.874689302767158e-01   +2.278043928243879e-01   -2.784521832022132e-01   -2.941125228323951e-01   -5.726194145742416e-02   -1.133149362367079e-01   -3.534994199772571e-01; +4.118888055398721e-02   -7.046036309128562e-02   -2.221970235189452e-01   +8.772298327954134e-02   +2.448892414270487e-01   +1.062260057184027e-03   -1.053725684005483e-01   -2.166167962886043e-02   -3.040954392124627e-01   +6.583146827537356e-02   -8.254514424221375e-02   +1.173157397405378e-01; +3.433284789593028e-03   -3.145397430781025e-01   +8.651153364867122e-02   -4.518628934098781e-03   -1.663896710454551e-01   +1.631110704164420e-01   -7.820669309786865e-02   +9.117424216479544e-02   +3.882926768990769e-04   +1.454957132223762e-01   +2.314973660862254e-02   -1.810467987161703e-01; +2.202529932401567e-02   -2.786422499240650e-01   +1.889179434637240e-02   +1.706878416535236e-01   -2.848007823267580e-01   -1.592038078076847e-01   +4.037884201524244e-02   -1.325795816939173e-01   -1.422685754691536e-01   +1.269365178042644e-02   -2.766578150472884e-01   +1.148839593545465e-01; +1.755819296331740e-01   +1.293841531890083e-01   -1.273870504734009e-01   +2.901241178006457e-02   -1.212398215625571e-01   +5.428270449689933e-02   -5.227619979679532e-02   +3.345759313712675e-01   -3.843475221317300e-02   -1.412185905218457e-01   -1.840325395777938e-01   -1.772450297704491e-02; -1.782003917025451e-02   -2.205057254550539e-01   -1.611473255516825e-02   -2.355438744611742e-02   -7.055367472683985e-02   -7.913520606414062e-02   -2.075059878822865e-01   -1.360381338806465e-01   -3.517534869139230e-02   +1.626697947913909e-02   -2.849747671463008e-02   +4.862861669951092e-02; +4.416492582761118e-03   +1.730567760452436e-01   -5.853314134146992e-03   +9.105375958819975e-02   -6.332906353784180e-02   +2.964503996592737e-02   -1.349039027733394e-01   -3.405861335111824e-01   -3.069895644627068e-01   +5.728593532111035e-03   +2.545621460638275e-02   -5.526553895421407e-03; -2.219989381967122e-01   -3.471470876648542e-02   -2.383290878682658e-02   +1.266023667452399e-01   +7.704868168656595e-02   -5.112099274433615e-02   +5.287612377199200e-03   -7.366807221613372e-02   -2.307909927244412e-01   +9.760194546657447e-02   +4.837698224936163e-02   -2.389853328345997e-01];
L2E_Input1_iAMPA_netcon = [-1.591487795394294e-01   -2.409474546734680e-02   -6.431255642879549e-02   -1.566547142705955e-01   +6.853373198525577e-02   -7.147174154098945e-02   +6.295143719144027e-03   +1.748501588443169e-01];
L2I_Input2_iAMPA_netcon = [-2.283885811523432e-01   +7.308815111670983e-02   +9.756912388678254e-02   -1.906248944954446e-01   +2.415651605374676e-01   -9.421968450641385e-02   +1.611216207553399e-01   -2.595672193137639e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
