function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.748825220448328e-01   +3.160143238282560e-01   +4.011085250960504e-01   +2.516585953797905e-01   +6.387236292641012e-01   +2.690516659852777e-01   +5.267061635906690e-01   +3.804663104919133e-01   +5.743119964419252e-01   +4.463849099093756e-01   +2.405831073831531e-02   +5.641875785345244e-01   +8.296222481424199e-02   +2.996882667894820e-01   +5.091634262053207e-01   +4.047024510309106e-01; +5.866535398313985e-01   +8.066782445842852e-01   +1.888974678213445e-01   +1.734563769639491e-01   +2.852912886035014e-01   +2.963338751572385e-01   +1.429301260309029e-01   +5.322385626788763e-01   +2.440510683884783e-01   +2.137074708118798e-02   +5.346913759112781e-01   +4.171351895674371e-01   +4.311574280863811e-01   +5.210150495191204e-01   +6.242021527121103e-01   +2.494042851134311e-01; +6.514855018805129e-01   +2.399525573006297e-01   +5.190058472148008e-02   +3.537857249922040e-01   +7.789209873416884e-01   +4.782025423908340e-01   +3.693494944929732e-01   +7.246100657232396e-01   +1.999969118588290e-01   +6.174182904256772e-01   +6.088828471883634e-01   +4.806546155130716e-02   +1.990096183753176e-01   +5.364143100051025e-01   +7.785144046842712e-01   +7.274992647535120e-01; +1.175075902741686e-01   +1.463616030304245e-01   +7.231822019139810e-01   +3.042614060643040e-01   +1.203344693731108e-01   +1.051205139005622e-01   +9.976251150606168e-02   +6.577267546517870e-02   +3.524519398032624e-01   +2.947394445543643e-01   +4.392323837469606e-01   +3.228580738704905e-01   +2.405387032049116e-01   +7.980539512592578e-01   +8.634065117491545e-02   +4.806028004966310e-01; +2.718643600343853e-02   +2.168032942564139e-01   +7.897603028345465e-01   +3.755052627565738e-01   +4.336183227464309e-01   +1.328423244216930e-01   +7.326583165600343e-01   +3.612183979164685e-01   +2.892467202926893e-01   +7.648688220271154e-01   +2.377597955470281e-01   +5.327859208826166e-02   +1.018109254147996e-01   +7.973716791019969e-01   +5.723574124000476e-01   +2.336731401123917e-01; +6.999894686952938e-01   +9.119741403567165e-02   +3.191261899871115e-01   +7.197753628577958e-01   +1.103073598547088e-01   +3.834061066248518e-01   +3.579590877128210e-01   +4.453266493717356e-01   +5.408990302268413e-02   +5.394665722477590e-01   +4.759402805065185e-01   +4.694743460823811e-01   +4.798306088754846e-04   +2.747685716713147e-01   +1.170810984983492e-01   +6.134111301959617e-01; +5.271552443428583e-01   +7.256106113547041e-01   +1.313306321640274e-01   +4.253956879599523e-01   +2.691729592819685e-01   +2.737601996261138e-01   +4.551741589086726e-01   +4.090949938290249e-01   +1.663493055294653e-02   +3.269526618943129e-01   +4.224600962904160e-01   +3.043168059410808e-01   +2.716596132782371e-01   +8.469324669517143e-02   +2.125622063906499e-01   +3.101243314092480e-01; +2.297767391018536e-01   +2.539487847346024e-01   +8.043566683377249e-01   +2.264923456098435e-01   +4.298985485987427e-01   +6.652842592593126e-02   +4.364822006361376e-01   +6.233651239429517e-01   +3.967316569724629e-01   +4.472052792240355e-01   +7.692196288401008e-01   +4.030063556105197e-02   +3.374457392119384e-01   +3.618133244145769e-01   +1.502693202689361e-01   +4.531748779396675e-01; +7.594372767463602e-01   +5.209187980250484e-01   +3.261258021967997e-01   +3.115159834531048e-01   +3.304692923251701e-01   +9.897887801984580e-02   +7.950856122549648e-01   +7.519978153688796e-01   +7.397327183936127e-01   +1.649904682439992e-01   +3.092940144088482e-01   +4.845615580947716e-01   +4.756934864782782e-01   +6.752933217593770e-01   +4.025645285674225e-01   +9.896950537538467e-02; +3.243016392159676e-02   +6.917186279003291e-01   +7.361330670531293e-01   +3.353805210213678e-01   +2.536806079534987e-01   +3.151080251776511e-02   +4.059744608347619e-01   +7.443818711883997e-01   +2.633676300423801e-01   +2.300652190730935e-01   +4.303241822039616e-01   +4.428713177923703e-01   +4.490008421357717e-01   +2.488526456582713e-01   +7.298737818634365e-01   +2.493662794678223e-01; +7.415467325805815e-01   +1.817661604370215e-01   +5.478728472756259e-01   +1.702954281116033e-01   +3.408727358626751e-02   +2.236384285664961e-01   +3.849483016044667e-01   +3.012954004012809e-01   +7.223488251220751e-01   +9.757782809931449e-02   +2.736489433328108e-01   +5.253175015074946e-02   +6.644807011774283e-01   +8.192973112137943e-02   +1.028217258002284e-01   +3.363389465794645e-01; +7.302172443803019e-01   +7.169258301587925e-01   +7.832678949127150e-01   +4.055072346620356e-01   +6.434962117088777e-01   +5.484634476252770e-01   +4.457895189253573e-01   +1.546205452095432e-01   +7.772562042748818e-01   +2.924977026531508e-01   +9.050481486568306e-02   +3.012236493344844e-01   +2.087797034471556e-01   +2.914410063490372e-01   +7.083736260333752e-01   +3.285997420281098e-01; +5.900265399375089e-01   +5.825357402788488e-01   +1.429430976335027e-01   +6.323471062078150e-01   +2.937085188022788e-01   +5.032191550766456e-01   +2.010988400402476e-01   +3.738638150716925e-01   +2.583239672749102e-01   +8.374868087090587e-03   +7.075867203536853e-01   +2.183609374156587e-01   +4.365955480298320e-01   +8.486931842660680e-02   +2.090390326370778e-01   +1.958283041041630e-01; +7.077551928847825e-01   +5.771683015105357e-01   +6.525292964010444e-01   +3.734397678648188e-02   +1.862879622451268e-01   +4.600840420709162e-01   +6.228628701990475e-01   +2.947412136674450e-01   +7.224321724270989e-01   +7.838379761812284e-01   +5.117095902194959e-01   +2.896764469199396e-01   +2.465587551536934e-01   +2.985369874109027e-01   +4.232037322832679e-01   +1.958594333619667e-01; +7.301863390644304e-01   +9.778022507241521e-02   +7.314640877954098e-01   +5.600304417000249e-01   +3.525406051349492e-01   +6.595640144313984e-03   +6.321133424568094e-01   +3.727632913651843e-01   +5.873004102625331e-01   +5.039592331236272e-01   +4.233384294217468e-01   +6.698768876084772e-01   +7.736361862805992e-01   +4.803468408751448e-01   +5.322162897183955e-02   +5.833416473717449e-01; +2.811673276560279e-01   +2.133601970182476e-01   +6.877072219651001e-02   +1.624228667327353e-01   +5.564918068697142e-02   +3.632858897660637e-01   +5.501718693786396e-01   +3.069426956833425e-01   +8.962888278636470e-02   +6.691624380642845e-01   +3.963089699191076e-01   +4.071172094255136e-01   +7.688303801802128e-01   +4.911957735704476e-01   +6.517202847927184e-01   +3.230909704155003e-02];
L1E_L1I_iGABA_netcon = [+6.279399908103014e-01   +5.578012276888642e-01   +3.926331394074829e-02   +7.237650917893598e-01   +1.378887606792380e-01   +7.356413001455868e-01   +1.277042918358937e-01   +4.528877866819524e-01   +7.463088655038096e-01   +4.609886220033503e-01   +5.364107954578049e-01   +6.299967526156520e-01   +7.878321326704683e-01   +8.779220437423213e-03   +2.536390040218625e-02   +3.919267676634793e-01; +3.143662899474766e-01   +3.976898795085828e-01   +6.164912862728091e-01   +1.208669929824203e-01   +2.590271032568899e-01   +7.903630532146688e-01   +7.546036586730527e-01   +2.767418070803151e-01   +1.959488150135316e-01   +5.703258650609057e-01   +7.322909740176395e-01   +5.848873281937901e-01   +7.677929838052339e-01   +2.747734833932619e-01   +2.332758642827812e-01   +6.992291797676242e-01; +1.470668979977993e-01   +7.485218287366202e-01   +6.194669973092661e-01   +5.727018812943256e-01   +3.336203182683632e-01   +5.288561211525381e-01   +2.779229706890415e-01   +5.982847115970846e-01   +7.641934931251975e-01   +3.016400136392580e-01   +3.137680832180637e-01   +5.648436617773053e-01   +6.969157634741746e-01   +6.390387568050663e-01   +6.790954400648607e-01   +2.720186163435758e-01; +1.047855472263465e-01   +4.600421708564508e-01   +7.236993436468681e-01   +5.854781501627182e-01   +6.534683891142481e-01   +5.602900715049767e-01   +1.356775314953896e-01   +4.914642488702218e-02   +9.801968000044584e-02   +2.664063052582391e-01   +2.213622781855053e-02   +7.560612391734858e-01   +4.513829872925672e-01   +6.252580613895060e-01   +4.387117163211500e-01   +7.194875461728418e-01; +7.623275433411175e-01   +2.725150421709785e-01   +8.104640581863591e-01   +2.546927735159962e-01   +2.223246805970039e-01   +2.106749437293537e-01   +1.893427355730079e-01   +7.145819778016650e-01   +7.274083870123218e-01   +2.593116190961910e-02   +8.396359292652887e-02   +6.866576144023833e-01   +5.770168325553771e-01   +6.278017721020526e-01   +6.516395401328082e-01   +2.672583077797029e-01; +5.950791664342761e-01   +1.967487013761520e-01   +2.477494739257557e-01   +2.571842895248033e-01   +5.920446945719980e-01   +3.257921831002434e-01   +2.783416310609159e-01   +6.151594615268005e-01   +4.400284545303150e-01   +2.722347536322464e-01   +1.425175231235710e-01   +5.885820630787861e-01   +4.968406706603891e-01   +5.218978454395147e-01   +2.868231783400579e-01   +5.832259540465097e-01; +2.976515517391471e-01   +6.564628486201047e-01   +3.605963016727512e-01   +3.439566567034135e-01   +1.583014727701890e-02   +5.490280517355848e-01   +5.276745373711900e-01   +4.559832773953812e-01   +1.143449897758125e-01   +1.622285091306019e-01   +1.553489969065879e-01   +2.309297292208504e-01   +3.733786618391889e-01   +4.213949925793253e-01   +1.137386077960979e-01   +4.284478678502697e-01; +6.010891224183837e-01   +6.359255481855141e-01   +3.843565195037555e-01   +7.777153201839933e-01   +7.778731279748650e-01   +1.851339265110754e-01   +9.626651754409674e-02   +1.635646601255177e-01   +6.437882636789053e-01   +2.193123764243555e-01   +3.721657291415397e-02   +7.392456602640947e-01   +4.972166526600762e-02   +1.805296973678658e-01   +6.009918060056145e-01   +5.779880043848831e-01; +2.022362547155749e-02   +1.072635675349964e-01   +2.132273248690444e-01   +7.390898275633963e-01   +6.961737885559178e-01   +2.210024967047306e-01   +7.773272084678330e-01   +4.809902873158008e-01   +5.538402818054148e-02   +5.199092506332184e-01   +5.761103820369593e-01   +4.350317447805540e-01   +7.857203031876292e-01   +2.797298526395225e-01   +4.972094871612087e-01   +4.084967635440271e-01; +2.797333075015175e-01   +6.880647164041874e-01   +2.717007729793806e-01   +5.127770811825846e-01   +3.637966199842564e-01   +7.743475907807212e-01   +1.809522232660983e-02   +5.941744892366744e-01   +5.844658523355994e-01   +1.984319396009478e-01   +2.939510134346181e-01   +8.087433702194939e-01   +1.843393436318584e-01   +7.515339154279308e-01   +7.409713899085557e-01   +6.989341007824660e-01; +5.054618598626113e-01   +5.314860053184669e-01   +7.464102985016073e-02   +6.631655090691383e-01   +2.634308059135895e-01   +4.633775519132390e-01   +6.701324693236899e-01   +5.951455349819077e-01   +3.801994469525838e-01   +1.637153374273144e-01   +5.727216298334423e-01   +5.933760154681388e-01   +7.978659332459124e-01   +7.779074568842437e-02   +3.683536144719824e-01   +2.035243874212868e-01; +1.530633377796859e-01   +3.819275932933263e-01   +3.778103728337459e-01   +3.690989657550504e-02   +3.385024557354175e-01   +5.782811262830355e-02   +3.126899058737819e-01   +1.038175114816583e-01   +3.922146750637804e-01   +4.942157308312286e-01   +2.559086107905993e-02   +5.635775651960195e-01   +7.146685538132224e-01   +3.209773401049257e-01   +4.841761425450944e-01   +7.936266472865737e-01; +3.494884752833142e-01   +1.079209132572662e-01   +2.115871629762323e-01   +7.396235653845271e-01   +7.424388302766665e-01   +6.959072341320444e-01   +5.841670636461840e-02   +3.106460214724665e-01   +2.227153324171865e-01   +1.340675040461125e-02   +8.738816450725767e-02   +7.496532401075650e-01   +3.722709930901531e-01   +6.069820004271641e-01   +5.023653337233303e-01   +1.275753356180116e-01; +6.773217981428354e-01   +2.755547781920399e-01   +7.441565187642765e-02   +2.239596855094637e-02   +2.609113324260416e-01   +2.912699337016680e-01   +7.409995721790720e-01   +4.919256599299544e-01   +4.542534169140631e-01   +3.053482152679345e-01   +7.807652716488851e-01   +5.426519628249644e-01   +7.532171261527343e-01   +2.679916138066791e-01   +2.481475487186459e-01   +1.306635522170411e-01; +5.591432930920786e-01   +4.196051345923260e-01   +5.718389996014624e-01   +5.344839529659882e-01   +3.764689720165437e-01   +7.587275996012744e-01   +2.386280850860977e-01   +5.642896326593213e-01   +2.473904350580153e-01   +2.247639256615394e-01   +7.563295746840210e-01   +7.791372664809932e-01   +5.120912015403962e-01   +3.579155810756529e-01   +6.213391780846813e-01   +2.957546208644529e-01; +2.522838758747275e-01   +3.339375025746359e-01   +6.509920205410147e-01   +7.222495622848889e-01   +2.576298074895408e-01   +4.062923227608764e-01   +3.865318620351835e-01   +5.443367754001781e-01   +7.075855946557973e-01   +2.314521882970182e-01   +3.058232168419250e-01   +7.715491411904677e-01   +1.890177176310464e-01   +1.507107355662991e-01   +2.326332910570715e-01   +3.135130676014785e-01];
L2I_L1I_iGABA_netcon = [+6.124236631180505e-02   +1.838666456760117e-01   +4.910940113400219e-01   +4.858779391913022e-01   +2.393267861803809e-01   +4.063565698663629e-01   +5.847827951087280e-02   +7.712266940945207e-01; +6.458611678599785e-01   +3.731711988301810e-01   +2.314041812777275e-01   +2.718967091593686e-01   +6.903236107536924e-01   +6.717993401476965e-01   +2.615162717186020e-01   +4.047369665088130e-01; +7.008400922498618e-01   +4.622934232064531e-01   +5.271753294364392e-01   +7.757304463840082e-01   +4.872304184419163e-01   +7.744061742084897e-01   +5.441366306646203e-01   +6.932885352861623e-01; +5.944027062081123e-01   +3.045826601550089e-02   +2.885413710828351e-01   +3.199557928785254e-01   +4.721798308257448e-01   +3.340120305839284e-01   +5.202573368036716e-01   +7.717977871310823e-01; +1.621822067432252e-01   +3.970016119182903e-01   +4.863841399209707e-01   +1.373960849452684e-01   +5.156035463822157e-01   +6.202253033431685e-01   +1.994938895805049e-01   +3.368681909363876e-01; +6.310654928205829e-01   +6.697067909830009e-01   +3.028440562811764e-01   +5.737321594807622e-01   +7.934601480442581e-01   +2.275441614932090e-01   +1.803973416489426e-01   +2.459304123173789e-02; +4.272459216200196e-01   +5.864001170457951e-01   +2.899619655588367e-01   +6.417429067226207e-01   +1.505768300941281e-01   +4.697448458602799e-01   +8.075792080229903e-01   +3.173638516685823e-01; +3.593621696546914e-01   +5.163896206213268e-01   +1.793795864434073e-01   +2.613604468716342e-01   +3.008349488228155e-01   +6.430054902289437e-01   +2.961438445169120e-02   +3.047948050700889e-02; +5.322705174760145e-02   +2.455722956108746e-01   +6.522801206263199e-01   +8.025198600892357e-01   +3.129734872672869e-01   +3.284227156807032e-01   +5.100924627684034e-01   +2.941105555104582e-01; +4.421120547829384e-01   +3.834041978388672e-01   +2.040007404268776e-02   +3.917194938398798e-01   +7.041067474640638e-01   +3.042296642390321e-01   +2.239824031466284e-01   +2.073277189408680e-01; +3.108990878499292e-01   +2.145400992811319e-01   +1.465055439077263e-01   +3.815396701631419e-01   +4.240422766077540e-01   +6.926078881351208e-01   +3.432135589216307e-02   +7.517820734393326e-01; +6.323608300441637e-01   +4.365770116147000e-02   +2.664171826174988e-01   +3.966586939427680e-01   +1.033310537126604e-01   +3.583439204618943e-01   +7.830932002688162e-02   +6.399544480359098e-01; +7.914813019294326e-01   +3.005480577873286e-01   +7.509633802489202e-01   +1.265465592365718e-01   +2.878061901575558e-02   +7.180908343248502e-01   +2.545354643010256e-01   +4.192888716340644e-02; +8.379281015832940e-02   +3.000723035979537e-01   +7.018515459856346e-01   +2.927293393153350e-01   +5.238046126539839e-01   +2.634272520868133e-01   +9.438618094671884e-02   +4.590702377847989e-01; +2.291284862097969e-01   +3.908317847226396e-01   +3.119162292499418e-01   +3.086105893743631e-01   +5.773580447809710e-01   +3.726691877776009e-01   +6.356801306205923e-01   +2.131578437638464e-01; +2.763101950921085e-01   +8.095141098008665e-01   +6.127454486208146e-01   +2.491487843160939e-02   +3.134092278292825e-01   +6.012257744866383e-01   +5.276017549878150e-01   +3.591795371034679e-01];
L1I_L2I_iGABA_netcon = [+6.323284886504686e-01   +5.826915026918688e-01   +6.273522031786691e-01   +6.855563847275429e-01   +3.850732238705381e-01   +3.780096375119395e-01   +5.692262118637481e-01   +6.264195277336834e-01   +2.952606351903619e-01   +2.794051593258578e-02   +2.210322272082283e-01   +3.443716216136545e-01   +8.600392778873310e-02   +7.401872667836928e-01   +7.879444873000107e-01   +6.679590001652278e-01; +3.791465130436230e-01   +6.987514705808732e-01   +6.410845127204036e-01   +2.680181447329935e-02   +1.161396985790442e-01   +5.811411055177281e-01   +6.241249872228325e-01   +3.351375351784989e-01   +3.305086199812093e-01   +6.847900384528260e-01   +1.158625673767196e-01   +1.095502436656170e-01   +7.691883830694279e-02   +4.439833308543086e-02   +5.487053730668023e-01   +6.724720588336141e-01; +4.602882832761008e-02   +3.101069887961586e-01   +1.120203875536465e-01   +3.701715251902021e-02   +2.194564281318148e-01   +6.433404337155542e-02   +6.594673082534791e-01   +3.046173948240481e-01   +2.285186335521498e-01   +1.865656020375710e-01   +1.247550169562955e-01   +2.052931385235406e-01   +2.212635114077602e-01   +6.852692357016160e-01   +8.094661899567522e-01   +6.124956249719992e-01; +5.319673259424385e-01   +7.296243119380053e-01   +2.112345923676449e-01   +3.243378584871013e-01   +7.399402696332047e-01   +1.924327184564282e-01   +4.061561319953750e-01   +6.791235148777353e-01   +2.226917046630084e-01   +1.921104167954914e-02   +1.444056928512558e-01   +2.950133579083737e-01   +3.441909300586984e-02   +6.156232438699855e-01   +3.685988809212508e-01   +1.595905667707090e-01; +5.708199320201718e-01   +5.272674344871133e-01   +2.769709918281492e-01   +3.219314893522628e-01   +7.953570737076119e-01   +2.025937386153661e-01   +6.905006197723658e-01   +6.498426068590977e-01   +5.507827861702304e-01   +4.415118457782532e-01   +8.609288132402457e-02   +2.332557827753572e-03   +6.714754071639835e-01   +4.799603894689717e-01   +7.671443339256198e-01   +5.760745221204725e-01; +6.690834597851391e-01   +2.731677364301902e-01   +8.372496230264757e-03   +3.014918347485924e-01   +7.504881112170286e-01   +2.287421961721859e-01   +1.011988006894741e-01   +2.621151879166386e-01   +6.651826642110474e-01   +7.180152899926648e-01   +9.901547061502848e-02   +2.804043127442055e-01   +7.558324866946702e-01   +2.772710474286294e-01   +3.559990307525591e-02   +2.653807790175861e-01; +7.361658971531134e-01   +3.308049427276483e-01   +3.309943250482715e-01   +5.971061123451418e-01   +5.897293242471244e-01   +3.343330092359295e-01   +8.006086817284259e-01   +4.916391954010420e-02   +5.631988817867853e-01   +2.939989820866318e-01   +4.913879045914544e-01   +4.703284291230268e-01   +2.522690426964037e-01   +1.463040937438659e-01   +4.079183027562645e-01   +3.775565076899042e-01; +9.310659057158453e-02   +3.707223423908921e-01   +8.137207412161125e-02   +2.420795707191762e-01   +3.024901389070805e-01   +6.771987499594374e-01   +7.547393243433982e-01   +4.171331124373936e-01   +3.711547830207431e-01   +5.661148400601522e-02   +2.025158212395971e-01   +6.568968218632846e-01   +1.649349578770353e-01   +2.279493683696407e-01   +7.088330032793572e-01   +5.052319884405910e-01];
L2E_L1E_iAMPA_netcon = [+9.825129980594692e-02   +1.643842864687420e-01   +3.345447551109776e-01   +7.102380821299834e-01   +4.410453901088958e-01   +6.245186060107624e-01   +3.927898788008295e-01   +7.220928689549105e-01; +5.814970170535229e-01   +5.571282457571040e-01   +2.387094309477485e-01   +7.936588783716101e-01   +2.012004725101252e-01   +5.341357486989515e-02   +7.851228674809202e-01   +1.479979859081127e-01; +7.166755551320917e-01   +7.167411600839232e-01   +7.278562714986352e-01   +3.968393920376658e-02   +4.038677256076781e-01   +4.753502230681537e-01   +1.565039650457168e-01   +3.638547983065366e-01; +2.716444186228075e-01   +1.136028981068030e-01   +2.609069187667651e-01   +5.548405726791621e-01   +2.809055870143787e-01   +5.344969720435444e-01   +8.043815219723934e-01   +7.316940178349136e-01; +5.881883400619584e-01   +6.480276254230969e-01   +4.242598646621737e-01   +2.608393356656336e-01   +3.514319976609355e-01   +4.285554253413977e-02   +3.126242798148649e-01   +2.326711471323638e-01; +6.082645808772745e-01   +3.622568410955018e-01   +7.849718534127031e-01   +2.412850585136596e-01   +7.276468255547889e-01   +3.694407712351985e-01   +6.479381617017109e-01   +2.749135538718497e-01; +2.994474177059730e-01   +6.916454426588315e-01   +6.773998858350125e-01   +4.106185413807596e-01   +6.685039938302381e-01   +1.966346939060696e-01   +3.302791435786507e-01   +1.514964158089191e-01; +1.786596684084156e-01   +3.089181945973874e-01   +7.418608552493736e-02   +6.654102020794892e-01   +5.291572782797498e-01   +3.149057836796061e-01   +7.567860727491312e-01   +1.123275585687479e-01; +7.170827245131736e-01   +1.213783651150089e-01   +7.364609209850954e-01   +7.332671909683384e-01   +3.626429187316289e-01   +4.470985419159789e-02   +4.170123855910016e-01   +3.021136803663978e-01; +3.914335221083763e-01   +3.653366757456517e-01   +1.151032189692472e-01   +4.348752298567072e-01   +7.380133989869345e-01   +2.818284604947033e-01   +6.692263350217833e-01   +6.671174304436375e-02; +3.204773864150571e-01   +5.583656158634358e-01   +3.443291915214323e-01   +4.856416458406942e-01   +1.045605694884317e-02   +2.126197786178508e-01   +2.066228211322888e-01   +7.339215055761324e-01; +2.054729082428143e-02   +6.278519987845174e-01   +1.532142185373437e-01   +7.926236547816150e-01   +6.645354925313635e-01   +2.407483419974371e-02   +2.438359780450078e-01   +1.185855774073067e-01; +7.586864954715163e-01   +7.698782579949131e-01   +3.419709767008274e-02   +6.780724156274627e-01   +3.316644661590288e-01   +2.999634742105761e-01   +7.663536983763249e-01   +2.863555421229670e-01; +3.937438609773800e-01   +6.570669369942459e-01   +3.294810071411508e-02   +3.761520167948307e-02   +3.803955648890343e-01   +9.881739420810935e-02   +7.641621610755444e-01   +2.222914185822021e-01; +2.822803954104486e-01   +1.123395646749868e-01   +9.350583810308404e-02   +2.452382006072161e-01   +2.655263815320882e-01   +7.844608836888269e-01   +1.141591598029861e-01   +6.856243789496292e-01; +7.599252785352066e-01   +3.897944083739990e-02   +6.054254681266744e-01   +1.733843733353738e-01   +6.509318069892459e-01   +8.080028429428524e-01   +4.192884766276237e-02   +4.536097441832080e-01];
L1E_L2E_iAMPA_netcon = [+7.492027875741013e-01   +1.924677684741121e-01   +1.798276729297033e-01   +3.996621016331763e-01   +2.644209335740356e-01   +3.208131591387681e-01   +4.216652131808419e-01   +3.690803023171152e-01   +6.205652020084246e-02   +4.711607116824659e-01   +7.858745706324753e-01   +1.077449632897984e-01   +4.803958622216273e-01   +6.736835409936553e-01   +5.351819466554255e-01   +3.454534226856769e-01; +6.039562492239751e-01   +7.455847576477305e-01   +1.011558863991332e-01   +1.680243240705701e-01   +6.214861286822376e-01   +4.989471591460087e-01   +3.213483616432777e-01   +1.967526941786968e-01   +7.272624268023202e-01   +3.310440748094883e-01   +9.306753171692159e-02   +7.376432915964537e-01   +4.501318937679964e-01   +8.083944133905632e-01   +5.204653023599205e-01   +3.736285761914142e-01; +2.506794835267249e-01   +1.398629338180221e-01   +5.590640373789562e-02   +5.483198880835176e-01   +5.712600884468588e-01   +2.823102241316678e-01   +4.537921308431537e-01   +6.139575642807357e-01   +3.684458029424966e-01   +1.566930255956285e-01   +4.850847306960067e-01   +6.205930971831575e-01   +4.311099153965940e-01   +6.855508957017244e-02   +6.202741684113935e-01   +8.498646958308333e-02; +1.726000434595787e-01   +5.910195918093880e-01   +2.346376245247071e-01   +4.620717263935310e-01   +6.554868980045796e-01   +2.393001145859069e-01   +5.995549380886813e-01   +5.414432609415685e-01   +6.764039056184197e-01   +1.745706836813077e-01   +3.259886469212628e-01   +3.056427907578746e-01   +5.767610099724996e-02   +3.768089890374116e-01   +1.615525776620918e-01   +6.656566055176232e-01; +1.242057673620486e-01   +3.678496395787961e-01   +3.974284320177585e-01   +1.173192543644197e-02   +2.107100004330051e-01   +3.248944233430099e-01   +2.111538215932086e-03   +5.032115321125266e-01   +2.456441388561689e-01   +2.002085285217910e-01   +1.166708709498072e-01   +4.291525527417306e-01   +6.831747237485822e-01   +8.026618491082539e-01   +5.988498699947923e-01   +1.783140565277841e-01; +1.319806863670225e-01   +2.958417400525822e-01   +2.893878997340022e-02   +4.295043672521354e-01   +2.648139677379002e-01   +6.023492591186330e-01   +3.941756700195112e-01   +6.528361676110143e-01   +5.078112944765607e-01   +5.592799107399502e-01   +5.303682544562299e-01   +6.054921556228385e-01   +3.488465400720684e-01   +6.675068990484511e-01   +2.973884504218462e-01   +7.404156437908505e-01; +2.256547099489332e-01   +7.514453392203502e-01   +1.569724457662631e-01   +6.704841616266782e-01   +3.920690522619161e-01   +8.336247648148003e-02   +4.911657937789445e-01   +6.602648975037042e-01   +4.186686208878829e-02   +3.491214311931054e-01   +7.745592550327511e-01   +4.490890561218721e-01   +8.772660884153057e-04   +5.653792845820026e-01   +4.916169183498116e-01   +5.406836144990047e-01; +5.577476579365810e-01   +4.186588493842208e-01   +3.538259229319053e-01   +7.159149948046007e-01   +3.094723830375747e-01   +1.934571478649739e-01   +3.303130583371863e-01   +1.100768327573620e-01   +5.620199663787098e-01   +6.716503885090045e-01   +4.960055191164270e-01   +7.895897026430309e-01   +7.347578318822351e-01   +6.355217671132947e-01   +2.638415297327316e-01   +4.513854677317570e-01];
L2I_L2E_iAMPA_netcon = [+5.696641527818013e-01   +4.169675683255185e-01   +3.747498161404640e-01   +1.239011104448040e-01   +7.655169095516781e-01   +2.661041552647748e-02   +7.960106460243545e-01   +3.495446901472138e-01; +7.293732849874067e-01   +2.037019883952932e-02   +3.629504511706552e-01   +4.970156480030511e-01   +1.520794832010496e-01   +6.946724835309596e-01   +2.238697514347193e-01   +4.033538040414721e-02; +2.891765395655322e-01   +2.822346373468925e-02   +6.853627599927476e-01   +3.531681706304844e-01   +6.227106845587565e-02   +8.053013530110669e-01   +6.421928812350047e-01   +2.502268302449219e-02; +4.857711449707211e-01   +1.492788948831713e-01   +3.564297024199365e-01   +4.379509946922217e-01   +7.905514240217708e-01   +6.555392941664580e-01   +4.039733135077546e-01   +2.819119448021012e-01; +3.259728564582638e-01   +4.232686827561858e-01   +2.985717429656473e-01   +1.559367021796386e-01   +5.439878032871658e-01   +7.098645581257164e-01   +2.169206642342543e-01   +4.881893026779473e-01; +6.910619248630909e-02   +3.046280754770029e-01   +4.024688254703766e-01   +9.089217387664394e-02   +2.270097010793118e-01   +2.612429889592429e-01   +5.661286792943523e-01   +7.391918328054772e-02; +3.004913187219793e-01   +1.057346054599426e-01   +7.626042159368198e-01   +6.422069268641797e-01   +6.750799257067688e-02   +4.821685799944174e-02   +1.390377690165093e-01   +3.431657403669289e-01; +2.111607410384107e-01   +6.347320053338265e-01   +6.399478257863869e-01   +2.604574013969974e-01   +4.895521691459603e-01   +3.781929248163654e-01   +7.852810455061981e-02   +6.257305397256335e-01];
L2E_L2I_iGABA_netcon = [+1.897349259384688e-01   +3.883788356001365e-01   +8.054018738641894e-01   +4.879880440404892e-01   +3.870857282447473e-01   +3.109590876419399e-01   +6.306264829605681e-01   +4.967893827516366e-01; +7.648984990444169e-02   +5.679417411886799e-01   +5.774546606709511e-01   +3.276303849903509e-01   +6.627640412559452e-01   +3.843519312557455e-01   +5.306657325526229e-01   +5.045886137861255e-01; +7.798442933863294e-01   +2.606730560520543e-01   +7.487498700213643e-01   +6.190036314416727e-01   +7.423590072253660e-01   +1.633708146782805e-01   +7.646280859185755e-01   +4.847720541631316e-01; +5.194574126228777e-01   +5.060267404101453e-01   +2.209233683726650e-02   +1.518351035482968e-01   +4.380585316015237e-01   +6.552368228732405e-02   +7.323760895106826e-01   +3.506796520269081e-01; +6.378737468277053e-02   +3.375991770003486e-01   +4.636152245872444e-03   +7.314811594334621e-01   +2.893086178427913e-01   +4.661260580376331e-01   +8.726292377333840e-02   +7.468646414001139e-01; +3.122894217235379e-02   +3.417132825541955e-01   +1.278755876632641e-01   +6.023613901613167e-01   +6.312503495514983e-02   +6.037020279358975e-02   +5.380970399663812e-02   +2.612897031723812e-02; +6.093390540727842e-01   +7.987214669410801e-01   +4.311614416224671e-01   +3.776001277607412e-01   +3.913532591544357e-01   +7.385191830848623e-01   +1.055687459909299e-01   +2.219998339945685e-01; +6.794519305803685e-01   +8.075550329766078e-01   +1.189332599145206e-01   +6.827951183045259e-01   +6.917446955597143e-01   +3.168893555110543e-01   +3.259631776991235e-01   +2.518485932774512e-02];
L3E_L2E_iAMPA_netcon = [+2.851699243856797e-01   +6.015928651014226e-01   +2.812805837111214e-01   +3.054736985581464e-02   +7.732815107434323e-01   +1.068654724925340e-01   +4.169621248801508e-01   +6.756598694785432e-02   +3.053756207764944e-01   +3.503841534310868e-01   +5.441863983281046e-01   +6.248928289694191e-02; +2.301262258530447e-01   +4.456861962826382e-01   +4.753832563300288e-01   +3.582263454901374e-01   +1.666571788816442e-01   +9.891778577656901e-02   +6.031258583492115e-01   +6.565373377777818e-02   +5.844391406762508e-01   +6.521864749889239e-01   +4.887391601353419e-01   +4.155443915970932e-01; +5.501209713359996e-01   +6.598083867152837e-01   +7.243680116046849e-01   +7.908802909008511e-01   +5.885283082096616e-01   +2.774014136830034e-01   +4.193331969955352e-02   +5.612393640979948e-01   +3.114191038881994e-01   +7.402343275437548e-01   +1.277213686520020e-01   +5.468388763250528e-01; +3.137571051922562e-01   +7.809579984486328e-01   +7.227407068655511e-01   +5.480668769553935e-01   +1.674965877483812e-01   +9.105281291702902e-02   +5.189970613935758e-01   +3.854790097581489e-01   +1.002271307010488e-01   +7.056578245349983e-01   +5.750868148595997e-01   +4.866095430814273e-01; +2.182503304393072e-01   +2.440554470853109e-01   +2.465461030839670e-01   +4.916147257078296e-01   +6.686306821187780e-01   +5.155516055573672e-01   +7.546579195655655e-01   +1.592530556960920e-01   +3.802150924287427e-01   +6.032997643848040e-01   +6.820804761856356e-01   +1.423950943586793e-01; +8.129459097406989e-02   +6.757347769390949e-01   +4.340895877029087e-01   +5.537705200642992e-03   +5.210307620532492e-02   +3.509946570848935e-02   +4.003624843345427e-01   +1.687417435870493e-01   +2.257924860984777e-01   +6.933332817979461e-01   +4.738929479770252e-01   +7.283782927809633e-01; +2.947786274167850e-01   +6.507322399376103e-01   +8.037712801501489e-01   +4.961885119353789e-01   +7.291494482377484e-01   +4.375643378952630e-01   +3.005212956457599e-01   +7.206885021969619e-01   +7.467006799243575e-01   +6.489887780896486e-01   +3.647554012910979e-02   +1.990125236845804e-01; +6.700992746561086e-01   +4.078330833118337e-01   +7.948536845733585e-01   +8.943886272920483e-02   +7.481826813047726e-01   +9.701505511824745e-03   +6.223327603145561e-01   +3.268067715464820e-01   +8.092239160900117e-01   +1.724045128200310e-01   +4.694647640378193e-01   +2.590532936341081e-01];
L3I_L2I_iGABA_netcon = [+1.693666481532747e-01   +7.056401413445877e-01   +1.007483332248797e-01   +6.101061039989684e-02   +2.922211780288781e-01   +6.842560810426879e-01   +1.157788699184576e-01   +2.201023464566035e-01   +7.050464084691888e-02   +2.739034587547877e-02   +1.288800897086254e-01   +1.618431330462115e-02; +2.617772943994892e-01   +1.913472220422134e-01   +3.419282952636187e-01   +3.708957108655954e-01   +5.895555443679813e-01   +7.524930463147775e-01   +5.654357755421306e-01   +5.738444083597354e-03   +5.457712545934271e-01   +3.369918702685121e-01   +6.147367824443138e-01   +8.261191567602066e-02; +7.919331613041515e-01   +9.599688481483613e-02   +1.475941828884530e-01   +3.948574962786375e-01   +7.862872429098438e-01   +4.857300785902176e-02   +4.906521117085012e-01   +4.995130267697438e-01   +7.381828490632747e-01   +7.698259542709858e-02   +5.098650988928504e-01   +4.990012488847803e-01; +4.800045713624068e-01   +1.486089662530717e-01   +3.001123576232516e-01   +5.302484615116331e-01   +3.597671815032022e-01   +4.184283563915069e-01   +5.311655517484636e-01   +7.115190923603663e-01   +4.001477959450555e-01   +3.817929234785779e-01   +7.872039234357999e-01   +3.759454901727399e-01; +1.771624814998172e-01   +6.412550260273490e-01   +3.699592282809204e-01   +1.494575364871553e-01   +5.417846153352803e-01   +7.111119541845313e-01   +2.272494638610795e-01   +6.624059222423537e-01   +3.591973084443358e-01   +2.553130153348370e-01   +5.129692729228750e-01   +7.443427708605526e-01; +8.127183500427977e-02   +6.147337196245145e-01   +1.649110005635426e-01   +5.555118803175878e-01   +4.840508861506242e-01   +3.730861879013642e-02   +3.847196081641647e-01   +5.605750517241187e-01   +7.543130203169444e-01   +7.000073837346766e-01   +3.275352625869409e-01   +7.112367087222147e-01; +6.203778703263331e-01   +2.662030802086359e-01   +2.292900282501625e-01   +2.946239488729417e-01   +5.660692725775032e-01   +1.097394631441110e-01   +5.851279444050099e-01   +3.140001942583371e-01   +3.477627842284151e-01   +3.027161524061616e-01   +5.965206932088902e-01   +5.400666347459923e-01; +6.682822319022510e-01   +5.598261482600212e-01   +3.092243252851126e-01   +5.446275040219113e-01   +8.030837616075922e-01   +2.603229383113548e-01   +4.051783391983158e-01   +4.776018440849676e-01   +5.049788045615724e-01   +3.080970761413282e-01   +7.668117749023169e-01   +2.747844417164995e-02];
L2E_L3E_iAMPA_netcon = [+9.845941101065309e-02   +3.032213949287681e-01   +8.371420482486694e-02   +2.185972178411662e-01   +2.232099628220039e-01   +1.516635165198327e-01   +7.413273614380704e-01   +3.730641776963366e-01; +5.184187303841158e-01   +7.840463885826630e-01   +4.890608564707885e-01   +4.091273988777488e-01   +3.140916949061904e-01   +6.345094799669333e-01   +6.623794180667494e-01   +7.376262299791166e-02; +6.034645622691448e-01   +6.916424587278758e-01   +1.933482276561248e-01   +2.804702579715219e-01   +4.021450013418506e-01   +7.882435355589115e-01   +6.376375820328799e-01   +5.655989955767052e-02; +1.482326193547095e-01   +3.675141214560418e-01   +2.988984481059019e-01   +6.089453196478178e-01   +7.347162739613181e-01   +6.816264044622249e-01   +1.135900623595667e-01   +2.833878950015052e-01; +2.786054999004589e-01   +6.544675476577732e-01   +2.066954104237914e-01   +1.843771475527396e-01   +1.512509695742397e-01   +3.062632974254493e-01   +5.265395929140394e-01   +5.090630259662277e-01; +2.432324341357745e-01   +5.431411085570156e-01   +9.835200173254958e-02   +6.295739151590571e-01   +5.383128940237984e-01   +1.723749733613234e-01   +3.498496122118449e-01   +2.310354218320737e-01; +4.635082789232812e-01   +3.005126047460108e-01   +4.410319237641026e-01   +5.553194914114243e-01   +4.334734561904002e-01   +7.347742636798745e-01   +6.933780486052787e-01   +2.425892158066495e-01; +4.082705173752416e-02   +7.979375581015763e-01   +4.425712709339831e-01   +3.176736732726598e-01   +2.217917243959296e-01   +3.874248110849337e-01   +2.307896649706317e-01   +6.257002698996234e-01; +1.185947282214343e-01   +2.805847276326545e-01   +6.980721148854346e-01   +7.409305461286950e-02   +4.351833857520874e-01   +3.810306432947331e-01   +2.348443084823262e-01   +5.782545084405143e-01; +7.723572709975964e-01   +4.399990007240756e-01   +6.404598007307760e-01   +2.069898883475461e-01   +6.769185890798672e-02   +3.612607902906536e-01   +9.269619676193427e-02   +1.335136270108215e-01; +3.690501573055390e-01   +3.505339103118689e-01   +5.641549041074627e-01   +1.482238791734113e-01   +4.786872209735022e-01   +8.071846591585251e-01   +4.017017486982795e-01   +6.158818335238535e-02; +1.751185705424100e-01   +5.326255406480542e-01   +3.718705018477864e-01   +4.393608189896668e-01   +2.360335327403393e-01   +1.133906542172960e-01   +5.515980089652580e-01   +3.078241937905340e-01];
L2I_L3I_iGABA_netcon = [+3.174740166811823e-01   +1.457524333602747e-01   +4.194124224973095e-01   +1.885932108454706e-01   +6.148502527263524e-01   +6.010577301137187e-01   +6.477250153646383e-02   +4.218040755389205e-01; +7.845291414410953e-01   +5.960515536428052e-01   +7.412189381459787e-01   +5.209660497380205e-01   +6.709931104849388e-01   +5.913151261612941e-01   +6.355190649550282e-01   +3.892199553412137e-01; +3.109539358300993e-01   +1.794698929033719e-01   +7.393494749811850e-01   +7.399243144735271e-01   +4.627116822345794e-01   +3.165941273236698e-01   +2.122519941057658e-01   +6.885516333354629e-01; +6.695143861004540e-01   +7.487929495533034e-01   +7.028624028428213e-01   +3.730945168291747e-01   +3.854201816997021e-01   +3.778342625644755e-02   +6.484922518907652e-01   +1.657034338683091e-01; +4.755404999886478e-01   +3.771031096059179e-01   +5.466728054170890e-02   +7.400829812307547e-02   +5.136913959512522e-01   +6.555674049399886e-01   +1.182852946910850e-01   +5.232732082862318e-01; +3.746361165660264e-01   +1.776060455633524e-02   +3.049261655114531e-01   +1.678927199346996e-01   +6.395373636243341e-01   +5.363216084386724e-01   +2.695777299014270e-01   +2.230131550488157e-01; +5.764445815452783e-01   +8.446992486149633e-02   +2.785183985482161e-01   +4.372139039115348e-01   +2.477862992112330e-01   +5.024789088144426e-01   +2.969266723186534e-01   +4.527675047894573e-01; +3.471933956372709e-01   +2.688753302595541e-01   +5.662662913500145e-01   +1.016134508632928e-01   +4.594925964440520e-01   +3.960806694355525e-01   +4.074019853821489e-01   +3.405335614236306e-01; +1.780196678683483e-01   +5.226462004137420e-01   +9.951299664684266e-02   +4.702643599401443e-02   +5.087957783580738e-01   +5.703229982797259e-01   +4.983831609551527e-01   +4.774115662208724e-01; +4.359280527403345e-01   +7.751513971999031e-01   +5.471047718407582e-01   +4.599991777657909e-01   +4.353584636835567e-01   +8.981212424017386e-02   +7.640758642538665e-01   +2.644947875470254e-01; +7.850872709760336e-01   +3.765981236151178e-01   +1.352354505590399e-02   +5.640313284781828e-01   +4.036565164354283e-01   +3.917101382363330e-01   +3.831078283418962e-01   +3.644845704088021e-01; +3.678698769869245e-01   +4.150407859734065e-01   +3.056090794535859e-02   +7.262635303652527e-01   +1.759503849308098e-03   +7.382790063500722e-01   +6.982928523742279e-01   +7.249445085933689e-01];
L3I_L3E_iAMPA_netcon = [+3.765751095244434e-01   +6.327134501104014e-01   +6.076128490142887e-01   +4.537247571760638e-01   +1.991140884388086e-01   +8.384226743891917e-03   +4.355397568218983e-01   +4.791937774372696e-01   +2.340352465127786e-01   +4.417470848083198e-01   +2.396022558046409e-01   +7.143176664529772e-01; +7.569051927033662e-01   +2.837744871376833e-01   +3.131917181854750e-01   +5.183263202052999e-01   +7.156356977071879e-01   +1.926656457135105e-01   +1.314198966343382e-01   +5.836956278428403e-01   +4.140022365566811e-02   +4.400964105276272e-01   +1.786443799235293e-01   +6.079909079516639e-01; +6.816363622720817e-01   +3.901404221123401e-01   +6.657118584690966e-01   +6.932488059076101e-01   +6.672738206517328e-01   +3.687253575458075e-01   +5.325604386135775e-01   +4.778613658657901e-02   +7.756899982840523e-01   +4.367569273665463e-01   +7.908923508795327e-01   +5.266951191230362e-01; +6.471424392697024e-01   +7.243081639531772e-01   +3.499033236411495e-01   +4.070701197283023e-01   +4.652592137439634e-02   +3.029145681030456e-01   +7.260077074421160e-01   +3.642099116236754e-02   +2.966713477777366e-02   +8.096609772930315e-01   +4.121288249606087e-01   +2.038425333398595e-01; +3.150626828036507e-01   +7.522588378159009e-01   +1.482343188911209e-01   +3.445133069400437e-01   +1.617686403077821e-01   +3.092883633737865e-01   +3.612178228736999e-01   +1.341410984368681e-01   +4.681784345539064e-01   +2.207356551679043e-01   +2.026916131328446e-01   +7.356515613851767e-01; +1.707510998334525e-01   +1.465094058875292e-01   +6.917548392611482e-01   +7.679957767027880e-01   +3.180525237302712e-01   +3.717993207005875e-01   +1.658707351680754e-01   +5.365348789335139e-01   +3.991827869461864e-01   +6.502782296820169e-01   +1.435438767754483e-02   +4.540736657331878e-01; +7.841814642910251e-01   +2.837280480227087e-01   +7.405488912607507e-01   +2.921129087063447e-01   +2.647486878974807e-01   +1.279739653758020e-01   +1.730049155133814e-01   +2.727608461131671e-01   +5.243704919170334e-01   +7.169583373299628e-01   +3.308144411476291e-01   +3.748648480817018e-01; +3.926752317764426e-01   +6.580565513050834e-01   +2.000883097727455e-01   +3.389504654433341e-01   +4.628357568369310e-01   +6.017616688760997e-01   +3.215242476979026e-01   +1.442118296697568e-01   +2.390412912455362e-01   +7.815714702856961e-01   +2.556459738949095e-01   +3.519534584117948e-01; +2.468837613938363e-01   +4.221555932843378e-01   +3.636574826654620e-01   +5.034428865676641e-01   +5.024142056150591e-01   +1.699883156628771e-01   +1.765153756617758e-01   +4.360013310751208e-01   +1.245676817566109e-01   +7.502095680613252e-02   +1.529845823300564e-01   +2.980583504730832e-02; +6.749552809765225e-01   +2.061349886339675e-01   +2.563729867868588e-01   +3.767284120025839e-01   +7.559137046022752e-01   +1.547805617158182e-01   +7.626750853066127e-01   +4.555449904953400e-01   +2.572200920810964e-01   +1.028916618241017e-01   +3.376202093477654e-01   +1.626078101885698e-01; +6.869116508356814e-01   +1.228213693353119e-01   +7.227994867783450e-01   +3.467336886323553e-01   +5.623161909362336e-01   +6.054143769033865e-01   +3.674255384192176e-01   +7.758341777340795e-01   +2.587767146758128e-01   +5.261576668322530e-02   +1.518713669941188e-01   +7.501336704638258e-01; +7.241822829202027e-01   +6.782696614507294e-01   +7.527006723523616e-01   +7.958441859295433e-01   +5.456038681170496e-01   +7.081136214199750e-01   +6.667027654109001e-02   +4.713728768823525e-01   +1.425494844742510e-01   +7.603202319018167e-01   +1.705809851445491e-01   +2.310477851187891e-01];
L3E_L3I_iGABA_netcon = [+1.075071504632580e-01   +7.195481873708416e-02   +7.505442300676880e-02   +1.599991246332254e-01   +1.224318189060750e-01   +3.524541277364668e-01   +3.569720587517031e-01   +4.599797389446932e-01   +5.125627891529885e-01   +8.017490158556867e-01   +4.393847535990896e-01   +2.717190991456078e-01; +1.303821742481970e-01   +1.465988266808481e-01   +7.807992530720618e-01   +6.203159025906868e-01   +5.411871117287580e-01   +6.181200070261613e-01   +5.245651074972875e-01   +3.817368855807674e-01   +3.686066101985058e-01   +3.272931959322636e-01   +3.921474538989904e-01   +7.210518969411110e-01; +5.541104021703713e-01   +3.331083748320557e-01   +1.107548471198358e-03   +1.890782255274978e-01   +3.098563593455766e-01   +4.556008336184973e-01   +5.505308124279199e-02   +7.952752497934237e-01   +5.748312549349269e-01   +6.305097546638667e-01   +7.824834073386816e-01   +2.626493091415539e-02; +3.037309188826200e-01   +1.362997817602302e-02   +5.386580032533076e-01   +3.562487843820071e-01   +2.125586593982035e-01   +2.020334201688821e-01   +2.880321501383166e-01   +4.269387104921570e-01   +1.149874372369875e-01   +3.152161125393076e-01   +7.708616364387754e-01   +2.082417564037214e-01; +6.566000615387368e-01   +1.173707874253188e-01   +4.310284701321377e-01   +3.474058509047282e-01   +5.524499878911840e-01   +3.855871866228551e-01   +7.777317657491239e-03   +7.060746891865423e-01   +6.144623561201880e-01   +8.004657728683297e-01   +2.353786779608543e-01   +4.538790764430001e-01; +4.180128300883711e-01   +8.976118994940525e-02   +4.024560048559485e-01   +4.005818395562322e-01   +3.146850182503003e-01   +8.125289031121731e-03   +4.380955881477940e-01   +4.125338984679432e-01   +2.764713932386730e-01   +8.481847712123466e-02   +2.496370647395032e-02   +4.062642653925179e-01; +3.169229164550559e-01   +6.766445647323994e-01   +7.625075220603299e-01   +4.594218267096878e-01   +5.858479638041159e-01   +2.237497921044739e-01   +3.564155717520087e-01   +2.078379436105132e-01   +7.613619092580435e-01   +4.302035174585537e-01   +1.307270151038688e-01   +4.623722627900795e-01; +5.104797368026329e-01   +4.567918725629528e-01   +5.503543605071671e-01   +2.833782489072949e-02   +6.083885382865922e-01   +7.537577466833281e-02   +1.580828340379985e-01   +4.620578501773540e-01   +3.755141311495192e-01   +3.547982789915763e-01   +1.015597077043538e-01   +2.098183141948599e-01; +3.710833094697491e-01   +3.026421525936783e-02   +7.700577177322490e-01   +4.591719349828617e-02   +5.225383292564351e-01   +1.097697519409282e-01   +2.886673414489827e-01   +7.279315959722235e-01   +5.825747441350488e-01   +3.238421622756223e-01   +2.871079267383361e-01   +7.879420495315972e-03; +3.418933329096868e-01   +6.896613008628486e-01   +3.702279747104337e-01   +1.119544303335137e-01   +5.192235583257154e-02   +2.809654408689197e-01   +2.324355697899056e-01   +7.908791681716896e-01   +2.758409594568359e-01   +4.877731042860503e-01   +6.734793841862534e-01   +2.828594393343919e-02; +8.050266652194429e-01   +6.383381253695809e-01   +3.494869813755832e-01   +2.506766152784345e-01   +4.412012202045736e-01   +7.636967559584262e-01   +4.073078379967933e-01   +7.985245935729781e-01   +5.253831472592142e-01   +3.697258801769097e-01   +4.899784713383704e-01   +3.462353375412713e-01; +4.359195005648532e-01   +7.556028063080781e-01   +3.978157650393719e-02   +6.127680901371249e-01   +2.198496919540487e-01   +8.033088969980053e-01   +2.585502912638305e-01   +1.300429453279960e-01   +1.773471245114642e-01   +4.874945275399973e-01   +1.675642653727844e-01   +6.535912090781306e-01];
L2E_Input1_iAMPA_netcon = [+8.091456859418175e-01   +8.103644441489596e-01   +8.104382863930397e-01   +8.100245326157124e-01   +8.094718425618497e-01   +8.105526505577582e-01   +8.110171579267564e-01   +8.088919542798145e-01];
L2I_Input2_iAMPA_netcon = [+8.092248945167156e-01   +8.093707838010169e-01   +8.102682231561339e-01   +8.096078641326491e-01   +8.111993302956512e-01   +8.102765726610003e-01   +8.097032199606318e-01   +8.101008778005304e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
