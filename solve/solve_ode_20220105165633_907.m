function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.243306313215572e-01   +4.224140152419660e-01   +5.307920607179406e-01   +6.364686415396874e-01   +5.996686894450081e-01   +3.411384020478571e-01   +6.480562314862041e-01   +8.394267282153743e-01   +5.443882980177613e-01   +1.926514836046218e-01   +4.454560801008908e-02   +8.224183488909452e-01   +7.677776453752112e-01   +1.102109828100601e-01   -6.044228025110026e-04   +8.399870613073918e-02; +9.829469933208143e-01   +9.634315672156474e-02   +3.239334158785366e-01   +9.571255692775328e-01   +3.870325442577014e-01   +6.064292703355680e-01   +6.786025398744892e-01   +8.319240199820604e-01   +7.223404584516981e-01   +1.379944999906512e-01   +7.529741708328158e-01   +4.306259705095388e-01   +1.677935949723605e-01   +1.360012835810822e-01   +8.653143207830490e-01   +6.268612177351042e-01; +7.305341109331307e-01   +5.971508080911462e-01   +1.059473386045985e-01   +2.414559798228629e-01   +9.158386202271191e-01   +1.916688046582037e-01   +6.347248637503274e-01   +2.558875849620357e-01   +5.211347800370545e-01   +6.959969214958703e-01   +2.410521825580234e-01   +8.875417336692233e-01   +8.633769286250664e-01   +6.793562549452602e-01   +6.129016274919848e-01   +6.614125912205734e-01; +3.448996577206236e-01   +4.722736562318693e-01   +6.112574392670772e-01   +6.762471580492292e-01   +8.604326096613775e-04   +7.396850679761646e-01   +9.458106953196939e-01   +6.138364159324884e-01   +9.930732098437144e-01   +9.257597343543864e-02   +4.420690632728901e-01   +3.918542886614720e-01   +9.903596049290415e-01   +4.948832321675450e-01   +9.885587115704657e-01   +7.301816179764421e-01; +5.860409883790944e-01   +6.955281422284825e-01   +7.803109791408844e-01   +2.883684821284401e-01   +4.625151518409569e-01   +2.420377683646056e-01   +2.088692264826164e-01   +5.824472866441945e-01   +2.211718534424727e-01   +5.234273701305795e-01   +6.875143961891732e-01   +7.695067660079984e-01   +5.155794491995070e-01   +1.887941516993182e-01   +5.264635790821450e-01   +8.929104215739045e-01; +1.087526448105140e-01   +7.003280602512846e-01   +4.234642184273661e-01   +6.705711466161273e-01   +4.251276743157337e-01   +9.196180766064909e-01   +7.088220259108471e-01   +5.411859872985694e-01   +1.045568725299471e-01   +5.315028760026663e-01   +3.583267084259220e-01   +3.970085286610895e-01   +8.845286659855089e-01   +4.940812960945380e-01   +4.808304804876133e-01   +9.820234149161292e-01; +9.051012345612958e-01   +6.397109222653280e-01   +9.093072825453849e-02   +6.940675201636152e-01   +4.604940347775120e-01   +2.707749886668864e-01   +2.370852078313222e-01   +8.709346036116262e-01   +1.113123675383082e-01   +8.610482077800981e-01   +7.363306972896907e-01   +8.099694089195930e-01   +5.875858228163634e-01   +1.487692968002113e-01   +8.025663045843549e-01   +7.691208945462408e-01; +8.814520804465837e-01   +3.282489124232744e-02   +2.652276445899286e-01   +6.687262375461557e-02   +7.706143800846054e-01   +7.656543669255859e-01   +1.195333429974367e-01   +2.648592422983544e-01   +6.565514925346613e-02   +4.847617681889131e-01   +3.940055395145631e-01   +7.548841823881762e-01   +1.552411843295533e-01   +5.396862095877632e-02   +2.283535832869155e-01   +5.830397253369147e-01; +8.177884920795901e-01   +6.797540231767008e-02   +1.536735256795444e-01   +2.522136561483097e-01   +3.240496098656727e-01   +1.898852538909107e-01   +6.077408332409150e-01   +3.159398605607173e-01   +4.043036689268658e-01   +3.926294745092020e-01   +6.841670557967641e-01   +3.782013650187431e-01   +1.999878174728708e-01   +8.513814663023762e-01   +4.970786034255640e-01   +9.268319299474416e-01; +2.598633506252676e-01   +3.193085459376873e-01   +2.816815227529497e-01   +2.216458639253521e-01   +7.839228988471661e-01   +2.857933122620264e-01   +4.522522786925549e-01   +1.190558910310894e-01   +4.474304984780746e-01   +6.713053780405962e-01   +7.042140823887301e-01   +2.170428343944288e-01   +4.076157808156985e-01   +5.612127393736385e-01   +8.992173527804306e-01   +5.810586453925828e-01; +5.939664640356243e-01   +5.296143201650496e-01   +4.415298741129306e-01   +6.685153350519186e-01   +4.702727721647151e-01   +9.097861191042478e-02   +4.589764194952792e-01   +9.399957436497395e-01   +3.658512937852272e-01   +7.415842478004493e-01   +4.423591303726936e-01   +7.905624995666505e-01   +7.477441217079327e-01   +9.299383415305643e-01   +5.758136442170221e-01   +1.671635693613379e-02; +2.273925019139852e-02   +6.540734186916094e-01   +5.261526266368887e-01   +8.449866635746195e-01   +3.613019960375003e-02   +5.777041861140998e-01   +6.621175718556757e-01   +6.455718457354468e-01   +7.626617102162797e-01   +5.194328536663674e-01   +1.855380022780402e-02   +9.501304000213423e-01   +8.239758281947959e-01   +6.978566235184687e-01   +8.440527359418980e-01   +1.210553518964779e-01; +4.259989750418704e-01   +4.069279619907825e-01   +4.585874571768048e-01   +3.451895861967961e-01   +1.762063049357202e-01   +6.835228610002426e-01   +7.698317253100377e-01   +4.802885372408547e-01   +6.267946522712734e-01   +3.449127601803827e-01   +3.292334376366025e-01   +3.287813536863828e-01   +7.917833979836186e-01   +5.843074680540460e-01   +7.383599804017428e-01   +8.622358415906468e-01; +3.116243668816885e-01   +8.194706272865713e-01   +8.747645375598850e-01   +7.820904338101227e-01   +7.199331957973977e-01   +5.466524829197162e-01   +3.499954945949932e-01   +6.394295766566758e-01   +7.725754667647314e-01   +1.493707031616091e-01   +4.234843790409543e-01   +6.730613024160396e-01   +3.201771249667320e-01   +8.148982407636391e-01   +5.866374309172693e-01   +4.828558657368767e-01; +1.608000459010362e-01   +7.201509207966962e-01   +5.193308252168432e-01   +6.768218409520258e-01   +4.740049928496711e-01   +4.240984271240666e-01   +6.618011961707779e-01   +5.446094907201442e-01   +9.326242007442493e-01   +5.871321164404970e-01   +2.687801473966425e-01   +4.400188229866720e-01   +5.338631295141131e-01   +8.806101899596027e-01   +2.445419295132951e-01   +8.451327163389097e-01; +1.777049240516872e-01   +9.681201033737900e-01   +9.450114101045862e-01   +6.638779524757974e-03   +1.528164559980852e-01   +6.439351123747331e-01   +4.156033599471718e-01   +6.471185395873151e-01   +9.733181003414431e-01   +2.611560275110914e-01   +1.966375528266849e-01   +8.326976499530010e-01   +8.989952052718503e-02   +9.897292979474887e-01   +6.650590540965291e-01   +2.096241525266256e-01];
L1E_L1I_iGABA_netcon = [+5.509800615049643e-01   +6.947778302840857e-01   +1.054149192112766e-01   +1.770368572937898e-01   +5.423894321337033e-02   +1.785714662650379e-01   +5.963471967938037e-01   +9.970061914194227e-01   +3.393141481670652e-01   +7.787603618597509e-01   +6.837269311680304e-01   +3.653922347980796e-01   +7.827978103850259e-01   +4.322862636514529e-01   +5.963268087950421e-02   +9.660814364361330e-02; +6.311951587560620e-01   +4.987482121409829e-01   +1.428133977059493e-01   +3.986079682744896e-01   +1.777346317962545e-01   +3.606726205001186e-01   +3.001282387516612e-01   +3.308178186004500e-01   +2.941567040051051e-01   +3.376769177431840e-01   +1.323309287373688e-01   +3.693613746666091e-01   +1.012109520462565e-01   +6.550743498816431e-01   +3.138587657403263e-01   +1.413930895635303e-01; +3.230565034712241e-02   +5.357346929698216e-01   +1.679207698942771e-01   +1.338377636172266e-01   +6.607984881977169e-01   +5.600940557354999e-02   +1.347829867529301e-01   +2.971005177533592e-01   +7.458721065993389e-01   +6.079995596827910e-01   +7.234687179977374e-01   +6.848863085650708e-01   +2.930660239800098e-01   +1.116254133837265e-01   +7.719006281180423e-01   +1.681070386622054e-01; +6.141069152153309e-01   +4.434929567555460e-01   +6.225719210617890e-01   +2.888737152782235e-02   +3.327038147852716e-01   +5.224936668827765e-01   +2.109096990852294e-01   +6.225328212680172e-02   +1.078271868106174e-02   +7.413851884811712e-01   +1.096153304153575e-01   +5.979113687812593e-01   +2.359966420278987e-01   +9.316274102008325e-01   +6.957218481323082e-01   +1.957934364281061e-01; +3.634006972464329e-01   +1.240789839416154e-01   +5.738041154895241e-01   +9.382880678802050e-01   +8.980777551602330e-01   +3.345792269871704e-01   +8.963561952352292e-01   +2.980804824079585e-01   +4.748564795103796e-02   +1.052751560970920e-01   +1.170789953191086e-01   +7.890474913050264e-01   +5.300706008167660e-01   +1.855164179195329e-01   +1.253908582903003e-01   +3.181258352342419e-01; +4.986068562081379e-02   +4.914229381873280e-01   +5.342921480063027e-02   +3.027684441428771e-01   +1.166630445590449e-01   +1.739334313444277e-01   +7.156962245760382e-02   +4.429039709724768e-02   +6.674703908451082e-01   +1.266670050551685e-01   +6.406440212031267e-01   +3.681804756870227e-01   +9.304230268329523e-02   +2.661674987254580e-01   +1.275329586529303e-01   +3.176258637693160e-01; +4.870304250247351e-01   +8.531945807231449e-01   +9.322825831073920e-01   +2.955336295049613e-01   +9.887602899442773e-01   +2.111109046268848e-01   +2.427054787547334e-01   +5.057047378005550e-01   +6.043464494879753e-01   +5.486979440672110e-01   +3.291634424768956e-01   +2.052909175462400e-01   +4.055361662081277e-01   +7.981894075702388e-01   +9.144379141161417e-02   +2.171295728968404e-01; +1.920546818052832e-01   +8.744755359018317e-01   +7.283315587655218e-01   +3.354552771844106e-01   +5.415317460151882e-01   +9.054007830834760e-01   +5.451110336630192e-02   +7.609806119083978e-01   +5.263724335240647e-01   +4.853405215511215e-01   +6.539127006833205e-01   +8.728970660551280e-02   +1.043045635049910e-01   +4.880740946112681e-01   +8.281968208318504e-03   +2.519296612233580e-01; +1.219689211637657e-01   +2.712436069559104e-01   +7.374298753551031e-01   +4.687481081271396e-01   +7.058287124954923e-01   +6.750104407450214e-01   +4.410191229145847e-01   +6.312752586784840e-01   +7.301055047179746e-01   +8.898494869422700e-01   +7.502615243223351e-01   +7.720815914805891e-01   +1.103644468795575e-01   +7.689849856566577e-01   +4.245690934760253e-01   +8.932471021639463e-01; +2.064398937714159e-01   +2.103821243104646e-01   +6.359767289360183e-02   +6.475523887120048e-01   +9.994435451231040e-01   +4.684448821870745e-01   +1.479610095478537e-02   +9.138678517542141e-02   +7.078053283340522e-01   +7.997233491221429e-01   +5.842276785633478e-01   +2.074211708584773e-01   +7.860317808104638e-01   +3.975485771874497e-01   +6.559200089871591e-01   +7.028735385904492e-01; +1.465508489251675e-01   +5.635552413435669e-01   +8.597092211877355e-01   +2.428030923040205e-02   +2.878923945652180e-01   +9.122043859899243e-01   +8.971268507911216e-01   +8.082115471957235e-02   +7.807418242061647e-01   +7.353339152876158e-01   +7.407712234528667e-01   +3.895274134013198e-01   +2.911517301525113e-01   +2.726095801460037e-01   +7.229046861155017e-01   +5.551319796238458e-01; +1.887754729290610e-01   +6.388652907747179e-01   +9.330561230471285e-01   +8.426629708619864e-01   +4.132572092683925e-01   +1.039172842608757e-01   +1.955264334192840e-01   +7.748739889599486e-01   +2.884462879200580e-01   +5.317522169307864e-02   +2.342977059852770e-01   +5.513308172309155e-01   +6.039739129339988e-01   +3.730451620400546e-02   +5.303807883889629e-01   +1.841210488510783e-01; +4.302424096257585e-02   +4.161598430796043e-01   +9.840533310059452e-01   +5.580750837408478e-01   +4.665067909045525e-01   +7.446036038042032e-01   +9.308171903977711e-02   +9.056006422980435e-01   +6.907558918364853e-01   +7.317337448628440e-02   +7.346231553734487e-01   +2.289003710587863e-01   +9.641930457576114e-01   +6.733206578903327e-01   +1.081184180931456e-01   +2.120743599817631e-01; +6.354947992649976e-01   +2.063935812268853e-01   +8.577529090438847e-01   +8.534349581408794e-01   +7.643539996395936e-01   +7.376637024250302e-01   +3.075388259039599e-01   +5.333996194533871e-01   +5.551820655752830e-01   +8.688829858885491e-02   +9.712606745668928e-01   +6.419987036261448e-01   +4.313837362903585e-01   +4.310254633694934e-01   +6.323140234654741e-01   +7.697171284801758e-02; +2.819695511789457e-01   +9.487225387012268e-01   +7.856821361948696e-01   +3.489916313484020e-01   +8.174464651261425e-01   +5.623071085045396e-01   +4.557869952367840e-01   +1.079056632252151e-01   +3.950449376891215e-01   +7.960723979081441e-01   +8.678135908707412e-01   +4.829171222526158e-01   +6.947351322140387e-01   +4.509284723277838e-01   +1.292042425586787e-01   +9.137585666609942e-01; +5.381906720929466e-01   +8.083886528789724e-02   +5.143805966554742e-01   +4.465595328144919e-01   +9.925993636688737e-02   +1.851034132643017e-01   +1.021290236653650e-01   +8.270647823271067e-01   +6.162884212714641e-02   +9.418169386035415e-01   +8.714636648412656e-02   +1.514395222739494e-01   +7.580246932861394e-01   +6.090835141799066e-01   +1.342599352536973e-01   +7.067624431988634e-01];
L2I_L1I_iGABA_netcon = [+5.584886121948012e-01   +1.594704577352487e-01   +4.230012415989899e-01   +6.834724641376376e-01   +8.083940344453348e-01   +7.953815140312099e-01   +7.888207524165238e-01   +2.661861107413147e-02; +3.133991069951690e-01   +7.583669634793004e-01   +4.297098066705899e-01   +4.638055622346506e-01   +7.470623611700441e-01   +5.778364042925180e-01   +8.516881286677898e-01   +4.206928210892568e-01; +1.662722636667835e-01   +8.703344129159754e-01   +1.251562978548451e-01   +2.129819423876119e-01   +1.185072395163793e-01   +4.415808793658300e-01   +5.068977262621439e-01   +1.829385442609578e-01; +6.217785809067000e-01   +3.509242303356950e-01   +2.389544235622075e-02   +9.828963553727649e-02   +5.255581843080687e-01   +2.571435859536382e-01   +6.356428768912075e-01   +7.264321930086988e-01; +9.875631977488056e-01   +6.861110740411165e-01   +2.905486245244263e-01   +8.232218523273708e-01   +3.247233971869107e-01   +7.524465128716857e-01   +9.523591826462185e-01   +3.703125217552812e-01; +1.712506014005850e-01   +2.935720663450264e-01   +3.185004507941414e-01   +1.754665782800841e-01   +5.458548507628750e-01   +2.290297767961340e-01   +4.443569239137151e-01   +8.418068657454054e-01; +2.580420784403400e-01   +5.298320333297916e-01   +6.535658980264327e-01   +1.641774104229783e-01   +4.002118115224472e-01   +6.507614380975278e-02   +5.852281955342781e-02   +7.330212997954406e-01; +3.974177378726246e-01   +8.330855961556842e-01   +9.570465015334371e-01   +6.676522969145723e-01   +4.156052329549535e-01   +7.664658269573442e-01   +8.676810645466826e-01   +5.695892165408646e-01; +7.481511974981539e-02   +5.991419821921559e-01   +9.365879528451267e-01   +8.934981680123272e-01   +1.787958013219439e-01   +6.714087483632019e-01   +6.310151309197294e-01   +1.780963367957573e-01; +6.844085254579367e-01   +3.348084477591260e-01   +4.583090145641847e-01   +5.158478388819503e-01   +2.561566848737284e-01   +7.146072934530522e-01   +3.532448330421561e-01   +9.589830244084394e-01; +4.037256402587516e-01   +2.993347799561774e-01   +2.395279987603243e-01   +7.028026166597763e-01   +1.958910550151558e-02   +6.424631963776030e-01   +9.971061741879155e-01   +2.652442630054294e-01; +9.826332494693284e-01   +4.529749892983653e-01   +7.647461891886954e-01   +1.519609722736085e-01   +9.228009744516881e-01   +4.193055973657885e-01   +2.248132147173598e-01   +9.246014980264130e-01; +4.006836512730443e-01   +4.238881011331314e-01   +7.594613392373667e-01   +9.528142171577819e-01   +6.548188392445018e-01   +3.898765440191757e-01   +6.527611959696973e-01   +2.215900697893886e-01; +6.210503618886738e-01   +3.596012583517633e-01   +7.403396025676939e-01   +5.402208737905748e-01   +9.336176792699108e-01   +8.171944125862086e-01   +6.043772142060055e-01   +3.726846733405661e-01; +1.548748452439517e-01   +5.603006690411502e-01   +7.444811492342712e-01   +6.808232937366504e-01   +1.638863028058895e-01   +3.165360159872824e-01   +3.880703734648692e-01   +8.804241129326067e-02; +3.814734594626333e-01   +7.429319046858652e-01   +1.084867077507939e-01   +3.735829548150341e-02   +9.215159585481315e-01   +8.162794478613744e-01   +1.399204831243126e-01   +6.418084688244637e-01];
L1I_L2I_iGABA_netcon = [+1.809164243290824e-01   +9.118751385813545e-01   +2.760312768897049e-01   +8.755885680357972e-02   +5.331189129720817e-01   +1.064684135547665e-01   +9.883073426564037e-01   +4.119658260573872e-01   +7.194715441058036e-01   +2.176969036643026e-01   +9.221296546775085e-01   +6.737525339700059e-01   +1.071279273133375e-01   +5.563463372731907e-01   +6.306751881238586e-01   +4.835151187277347e-01; +4.572988965858247e-02   +7.997569803033600e-01   +2.473454192734944e-01   +8.030295815530594e-01   +8.874530188850210e-01   +6.154314019774660e-01   +7.670429484906793e-01   +6.003568743870542e-01   +9.966050167425984e-01   +1.259882134848180e-01   +7.705215820471313e-01   +4.775021309849280e-01   +1.811078828530323e-01   +7.712903834998881e-01   +9.989825696058305e-02   +8.946121143725211e-01; +7.236347836120376e-01   +7.445928128128884e-01   +4.518255964971041e-01   +9.892474935625806e-01   +8.981746539848771e-01   +9.407027999713298e-01   +3.361806765484964e-01   +7.497298325440945e-01   +3.546221152768937e-01   +3.091189137961949e-01   +4.211156678051860e-02   +6.237747250959795e-01   +9.999677191522494e-02   +3.119625134466811e-01   +3.919965630878440e-01   +1.387071250548187e-01; +3.483942458070393e-01   +8.127458542217326e-01   +2.264813205518237e-01   +6.658939172040666e-02   +6.252599580876329e-01   +3.533565084775036e-01   +6.632361784527935e-01   +5.839601100942308e-01   +9.703618352276258e-01   +7.249754989413566e-01   +3.791210890626908e-01   +2.376938920141363e-01   +4.902433809890451e-01   +1.780886370243276e-01   +5.571639697220414e-02   +3.888778398975776e-01; +6.606417909708371e-01   +3.838601132926586e-01   +8.042319701519879e-01   +9.399066751096573e-01   +1.372438075165820e-01   +4.110596402747709e-01   +2.460183650747203e-01   +5.512081684094592e-01   +3.476953887444618e-01   +7.833568454737526e-01   +7.038803352455989e-01   +1.777140761067058e-01   +1.929751482355213e-01   +3.382188137690695e-01   +5.007528369808859e-01   +9.276034099358703e-01; +3.855093832637472e-01   +6.177460051458439e-01   +9.853802935234137e-01   +1.807212172333234e-02   +2.189849236187907e-01   +9.834355065128035e-01   +2.946903551027433e-01   +5.808058662423681e-01   +8.858747751091429e-01   +6.920754543830766e-01   +7.275686700923425e-01   +8.285586114277794e-01   +8.938641993933415e-01   +2.099063859532646e-01   +4.312380087076024e-01   +9.189162934299869e-01; +6.280942578884702e-01   +5.770847074790219e-01   +3.040985901364517e-02   +6.851930052882013e-01   +1.819572561640225e-01   +9.456896262529312e-01   +6.780391180883375e-01   +5.111464886980907e-01   +4.548259655631318e-01   +9.764373574647389e-03   +2.251565890065186e-01   +7.660802954787506e-01   +9.897894756300693e-02   +5.103340782275048e-01   +9.978807791269357e-01   +7.160465706316422e-01; +2.266515820531739e-02   +5.277419572823263e-01   +5.355517558661125e-01   +7.832533456906341e-01   +4.184634335518977e-02   +6.768317365447879e-01   +5.268753081258220e-01   +8.046798765329732e-02   +4.146897100981032e-01   +8.454682406236718e-01   +2.691796626520092e-01   +9.347961260290378e-01   +4.515213900057776e-02   +9.049070891398890e-01   +8.104806782763817e-01   +6.175576938567539e-01];
L2E_L1E_iAMPA_netcon = [+3.420634285132721e-01   +7.586084443779018e-01   +5.898938767924493e-01   +5.012834169432474e-01   +8.486320648728415e-02   +4.769624393926666e-02   +9.238619760903060e-01   +4.756295357085038e-01; +9.366813664822632e-01   +4.143692080371115e-01   +6.609423064920825e-01   +4.890990054365689e-01   +9.742445408355598e-01   +3.434095325539516e-01   +8.008442034124267e-01   +3.635326396866506e-01; +1.234743005783610e-01   +4.940536399716746e-01   +4.776812615301664e-02   +8.782764198820588e-01   +6.513364700290007e-01   +7.378442279995528e-01   +2.860641417968112e-01   +7.883064572590094e-01; +7.319598048288252e-01   +6.960902354858446e-01   +3.485043621929114e-01   +3.513332201244051e-01   +2.310808197369803e-01   +7.951232770310729e-01   +5.442445118668024e-01   +7.803377093901805e-01; +6.470407723083628e-01   +9.742116722149298e-01   +4.490610243908094e-01   +4.485110665875062e-01   +4.029832217603579e-01   +5.445078129470089e-01   +9.846063889283153e-01   +6.685675032888102e-01; +8.335914996992613e-01   +3.274215171373046e-01   +2.394031308829082e-01   +9.643631432849672e-01   +1.211173659687496e-01   +6.876009592734055e-01   +7.152244506115771e-01   +1.335901861930088e-01; +3.970888017133205e-01   +8.371798531417126e-01   +7.149947330398464e-01   +4.252792997888795e-02   +2.679690452059799e-01   +8.952830814952280e-01   +8.382938235602637e-01   +2.022663135750063e-02; +7.502146588000094e-01   +7.398377739994360e-01   +8.572651831238854e-01   +9.739113630219629e-01   +2.556710807136506e-01   +5.393898022140810e-02   +4.339700312542815e-01   +5.598057879609335e-01; +8.353107243657384e-01   +9.539629572236650e-01   +2.831676965914209e-01   +1.878570180815357e-01   +3.328138126067007e-01   +3.038992441501617e-01   +4.711785578541540e-01   +3.009861447722807e-01; +3.241185893801872e-01   +3.325521789360235e-02   +7.313885483938768e-01   +6.654583459188260e-01   +1.493577942797074e-01   +4.539966449012828e-02   +5.612373154288535e-01   +9.390172050680442e-01; +5.515171083312608e-01   +3.549624828812659e-01   +1.398474974908709e-01   +5.877922746422821e-01   +3.469605032861427e-01   +1.952222252502340e-01   +2.700608674249398e-01   +9.819920981882679e-01; +9.815215656143458e-01   +6.619984543831999e-01   +8.388706708698677e-01   +6.754748314978378e-01   +1.204819178858101e-01   +7.184784085477943e-01   +7.482508832398664e-01   +2.860834311649722e-01; +5.490968266640763e-01   +2.816929987611529e-01   +1.391054940765246e-01   +3.593778531430979e-01   +8.834216514545991e-01   +7.226264754300127e-01   +5.046751844173912e-01   +8.001681350911621e-01; +3.311605034293902e-01   +2.308218347594010e-01   +5.870703705386245e-01   +6.198673867257555e-01   +9.526090130253710e-02   +8.774399630235719e-01   +6.470423710216401e-01   +8.950139232489180e-01; +6.193172477884833e-01   +7.101985567731592e-01   +3.667380067375290e-01   +8.110273150198939e-01   +9.310555819513719e-01   +5.808251539510728e-01   +3.071693015535917e-01   +5.986336208021737e-01; +3.617647791708698e-01   +6.235891592678857e-01   +8.056291499019892e-01   +1.951384380577012e-02   +4.000262413412095e-01   +7.198216350250272e-02   +1.390643469734388e-01   +8.840520803418966e-01];
L1E_L2E_iAMPA_netcon = [+9.428109921873917e-01   +3.731604739526041e-01   +6.681112932130671e-01   +4.852055718249059e-01   +2.470568082342747e-01   +4.524913986554456e-01   +1.237274261385886e-01   +4.968315635430346e-01   +8.824746620733648e-01   +3.249505560976904e-01   +5.147514102373957e-01   +8.643735835420144e-02   +6.318490534606478e-01   +4.290132184570455e-01   +6.127979471737718e-01   +5.033938903399424e-01; +5.484526387597365e-01   +9.358871529513749e-01   +2.081043365147775e-01   +7.570266807851861e-01   +7.843735480762789e-01   +2.058738322062055e-01   +4.064625060597291e-01   +6.931968993904515e-01   +7.202490748929413e-01   +2.461997823331128e-01   +6.575527460761080e-01   +1.632505300054696e-01   +8.584475640562856e-01   +4.921639071312272e-01   +8.204582650660611e-01   +6.122126230452737e-01; +7.288031791251273e-01   +8.287010448965680e-01   +6.536020288757740e-01   +4.161355705441477e-01   +8.826959205799184e-01   +8.986320471577455e-01   +2.753765551862813e-01   +8.337870302181036e-01   +1.849330315066257e-02   +3.423474179718088e-01   +9.511354579631386e-01   +3.245535097106175e-01   +9.758631223038861e-01   +7.143817385497700e-02   +8.867019518983026e-01   +8.198015000625616e-01; +5.773756605056265e-01   +8.506351008794141e-01   +7.193106428992505e-02   +9.719444102945438e-01   +9.126354205604500e-01   +7.630219171849030e-01   +7.171006171945650e-01   +6.117853934776935e-01   +6.747036578454169e-01   +3.756713639293418e-01   +7.225158453218667e-01   +3.012500325069769e-01   +5.697352648302463e-01   +8.874053067697736e-01   +9.304492073019566e-01   +5.331761589535683e-01; +2.596032203137433e-02   +3.718763941979031e-01   +4.069163523083308e-01   +9.898423684755026e-01   +5.583769813237081e-01   +8.835410303477834e-01   +2.824881324757538e-01   +5.751170376534706e-01   +4.387619459221453e-01   +5.459746795513942e-01   +3.997033784288818e-01   +1.121354822758724e-02   +9.965520378978178e-01   +6.480585013636385e-02   +1.922304769038615e-01   +2.026830722690049e-01; +4.473826551354479e-01   +5.930568849120591e-01   +6.665708712049766e-01   +8.636722005617745e-01   +5.985328515838891e-01   +2.867612439094420e-01   +8.953385891918124e-01   +3.243659239111914e-01   +4.362356209658940e-01   +5.631386094298731e-01   +8.341736654467657e-01   +5.410909804293839e-01   +5.537283983885626e-01   +4.360630114248011e-01   +2.573978591054442e-01   +4.543459203342607e-01; +6.480058657605496e-01   +8.743164881590318e-01   +9.358796945017751e-01   +3.879652949529654e-01   +1.481003512657081e-01   +6.705269498642862e-01   +8.265851175104376e-01   +4.560733246799346e-01   +1.158866506520928e-01   +3.954673621037297e-01   +1.353441399736968e-01   +9.661560283639535e-02   +5.153031256210526e-01   +8.252728188397196e-01   +8.970840924808295e-01   +4.284493929553008e-01; +5.221491429304895e-01   +9.336703018936775e-01   +8.093996652984535e-01   +4.530589016080194e-01   +9.015745029437671e-01   +6.641238242822186e-01   +3.896717228426970e-01   +7.140418697040124e-01   +8.146890609078555e-01   +3.968820150481862e-01   +6.021831688398395e-02   +1.468622460536298e-01   +3.315878018842154e-01   +3.922979045825555e-01   +5.935333948862180e-01   +9.654514477435283e-01];
L2I_L2E_iAMPA_netcon = [+6.188756366624889e-01   +6.959652819476353e-01   +7.340714574340261e-01   +5.902892413937736e-01   +6.696017925863179e-01   +5.514082706585187e-02   +9.904548997981617e-02   +8.483664982784789e-01; +6.974303549724006e-01   +4.262925983714584e-01   +4.298707209952770e-01   +4.590182737394026e-01   +5.003899259236564e-01   +1.534418969382473e-01   +9.081108409588883e-01   +9.172078347555804e-01; +7.214418240054310e-01   +8.367101164110097e-01   +6.934494329041396e-01   +5.173495275620504e-02   +2.199172710133316e-01   +1.978960525965623e-02   +1.103891722969334e-01   +9.866620623492127e-01; +3.472607200622755e-01   +7.305004167685845e-01   +9.450652749732993e-01   +2.285636025409506e-01   +5.718626212373215e-01   +4.350304902590720e-01   +5.183242501832618e-01   +5.043354280619601e-01; +5.170519222201112e-01   +3.602658383822346e-01   +7.846538244839226e-01   +8.342849426240629e-01   +1.220843677933237e-01   +8.316110444272883e-01   +1.426175855536318e-01   +2.710969281298315e-01; +5.569182154586058e-01   +4.542224496877704e-01   +7.049434373485106e-01   +1.548990616887922e-02   +6.707868700785909e-01   +6.174275163921581e-01   +5.595279094554829e-01   +1.017187284496296e-01; +1.580700468706943e-01   +3.879449786251499e-01   +1.096324359251705e-01   +8.641763432614147e-01   +5.991233130745602e-01   +5.195747515909918e-01   +4.418539613775837e-03   +5.079393055469759e-01; +5.635216763605584e-01   +7.747125004451032e-01   +3.897352474513643e-01   +7.923124304808497e-02   +5.607901724749872e-02   +8.639513155757726e-01   +7.680711447929506e-01   +5.847165782210906e-01];
L2E_L2I_iGABA_netcon = [+7.643423128914644e-01   +9.414585443910203e-01   +2.385012177524750e-01   +8.336847854302827e-01   +2.574122887682267e-01   +7.556963713968896e-02   +1.737448531614229e-01   +5.236035576251720e-01; +8.269317307357181e-02   +6.566091268746963e-01   +5.784731263614755e-01   +4.021806951358898e-01   +2.982722883991188e-01   +3.939891099681823e-01   +1.401323272046003e-01   +2.643099161093274e-01; +6.599688326054065e-01   +4.522144247154316e-01   +8.658805781095388e-01   +3.910066455048977e-01   +4.248035812840408e-01   +4.211437156477494e-03   +5.979936251689720e-01   +6.846166319123893e-02; +5.172289565651617e-01   +8.397428300730474e-01   +4.052205956455044e-01   +3.624575470977553e-01   +1.178610911506040e-01   +2.200317512575028e-01   +8.997710145798405e-01   +4.360982590481441e-01; +1.719033057994080e-01   +5.333219843880176e-01   +1.117105571850968e-01   +1.378640239871280e-01   +4.973179155181957e-01   +1.229480323906838e-03   +9.386214299911950e-01   +1.731737961454714e-01; +9.405080938770465e-01   +5.537258735447053e-01   +4.436551893541161e-01   +2.575892427495938e-01   +7.068233576522590e-01   +1.899351399639976e-01   +2.204661686675808e-01   +2.658825005749895e-02; +5.911303748150069e-01   +6.805420495335514e-01   +2.981525221172147e-01   +8.621691033905547e-02   +2.441195743640023e-01   +1.420292739327030e-01   +4.810279340607484e-01   +9.538036341569799e-01; +4.401126995795042e-01   +3.675136654698635e-01   +4.014235734147317e-01   +4.297266287702353e-01   +7.846929383942249e-01   +2.681018697662561e-01   +3.775021828311113e-01   +4.308391767925959e-01];
L3E_L2E_iAMPA_netcon = [+9.617079833536631e-01   +7.729699539749671e-01   +9.117339021290962e-01   +5.311710671038337e-01   +4.823118888880133e-02   +8.191548440457880e-01   +6.251912407690352e-01   +7.482549962360249e-01   +6.734944505527771e-01   +9.051929532263620e-01   +5.818592978492261e-01   +5.938614710853601e-02; +7.626484900391027e-01   +2.273341966070425e-01   +9.073839538461809e-01   +7.162586166169792e-01   +5.524428838218121e-01   +7.274730120959425e-01   +5.422933960233518e-01   +6.460176283617697e-01   +4.318509243477104e-01   +3.934101489253099e-01   +6.865956121119258e-01   +9.804162891833221e-01; +7.982268316999436e-03   +3.701624769639744e-01   +5.912374841155063e-01   +1.803649133809213e-01   +2.743681021507354e-01   +1.774181431108739e-01   +4.373335750739028e-01   +1.218019754876155e-01   +6.921130953747706e-01   +2.465083923904755e-02   +7.207985818156905e-01   +2.843846672183150e-01; +6.798059420033854e-01   +8.925043199566975e-01   +3.310831551871635e-01   +3.352134756401175e-01   +2.435560306833641e-01   +3.602551805567542e-01   +2.870467327227199e-01   +5.052040701722320e-01   +2.571084347427768e-01   +6.700722237532857e-01   +6.491520906752160e-01   +5.931367819268218e-01; +7.052338008193954e-01   +8.564445093569402e-01   +8.533038810200856e-01   +1.876070335982792e-01   +2.432714084619626e-01   +1.866012263629731e-01   +5.008194894366884e-01   +3.477577611594923e-01   +1.223317080316490e-02   +8.375873065608431e-01   +7.252256871164459e-01   +9.611799955459420e-01; +6.449064446561791e-01   +4.006103146302590e-01   +4.429515977089825e-01   +3.207869649744147e-01   +1.542644317751597e-01   +9.374420373268017e-04   +7.623488157075583e-01   +9.033007078167761e-02   +5.313690417868779e-01   +9.711719470278168e-01   +3.747752563595854e-01   +1.868813228829741e-01; +5.540448162551271e-01   +3.186305085400873e-01   +9.017219561716856e-01   +4.044289621357043e-01   +9.579392081364281e-01   +3.141030287313201e-01   +7.617088170418662e-01   +1.477776543531509e-01   +2.800134568662945e-01   +5.644607387267728e-02   +5.798635959605385e-01   +1.928444567034068e-01; +2.176898721010293e-01   +6.088440905600071e-01   +3.437533343751740e-02   +5.480610174541668e-01   +9.358924688601861e-01   +6.984523142307484e-01   +5.774160841830199e-01   +1.995730921746424e-01   +9.461393800219514e-01   +4.502473206361207e-01   +1.144554623057217e-01   +3.406776847879258e-01];
L3I_L2I_iGABA_netcon = [+9.332969596164068e-01   +9.306058833105489e-02   +6.244402549614412e-02   +2.789473751312825e-01   +2.539098791994977e-01   +4.042966991238809e-01   +5.290722984903297e-01   +1.084679915909345e-01   +9.120994132918497e-01   +5.837249843528872e-01   +2.084743302076377e-01   +9.080699879265852e-01; +3.911934487226706e-01   +6.167026020922803e-01   +4.950134331368681e-01   +7.456771820105831e-01   +8.574236506574315e-01   +9.874099491112280e-01   +8.293037215142072e-01   +2.710570834342849e-01   +6.395482565186426e-01   +2.834964113148916e-01   +3.180935188192593e-01   +5.514580725957821e-01; +2.722126116449320e-01   +1.094571226682807e-02   +6.432480615995384e-01   +2.378451805331473e-01   +9.113568582936959e-01   +8.990071246948735e-02   +8.575884240895940e-01   +5.234352493887651e-01   +2.553063321859068e-01   +8.282683792691837e-01   +1.339303959298779e-01   +3.454274265470693e-02; +1.522097039338620e-01   +5.737231592894335e-01   +2.227020957161188e-01   +9.580072615426174e-01   +6.991818913961622e-01   +3.227815497588203e-01   +7.879057607812995e-01   +9.727592391529921e-01   +9.052013058231839e-02   +1.920182889668263e-01   +6.730139889648141e-01   +5.402441487138564e-02; +3.969339857682652e-01   +7.877841050361948e-01   +8.375863067300838e-01   +6.217918822851797e-01   +7.255999553715777e-01   +5.134581714948588e-01   +3.189770695693359e-01   +7.089480481416329e-01   +8.384337734991830e-01   +4.416818563544342e-01   +5.699144887148592e-01   +8.062957046727617e-01; +3.748529177603285e-01   +2.350357597814440e-01   +9.709554371400438e-01   +6.008596794731886e-01   +2.302245071881566e-01   +5.910330099243290e-02   +4.530822367293357e-01   +3.109298947534682e-01   +5.844262092815335e-01   +3.929958338337711e-01   +1.702130255986926e-01   +4.511774265030317e-01; +1.299245524716388e-01   +4.479165985258101e-01   +8.462892305593926e-01   +1.725287464504123e-01   +5.749233113143507e-01   +7.259130125995805e-01   +7.531225058800394e-01   +2.942361928015358e-01   +9.487486821853348e-01   +8.269468565166155e-01   +1.479037559188495e-01   +3.809235616025338e-01; +4.339706802474506e-01   +5.696551631155850e-01   +5.067111739119747e-01   +9.000312732659639e-02   +8.111335158280014e-01   +5.571432418919821e-01   +1.107849112764225e-01   +8.502957486164142e-01   +6.111357377120889e-02   +6.793997603742695e-01   +4.762302151238182e-01   +7.909867973990967e-01];
L2E_L3E_iAMPA_netcon = [+3.649702542307786e-01   +7.554175581451728e-01   +7.369110937364484e-02   +5.174052658615498e-01   +7.581320252000295e-01   +4.322745401027901e-01   +2.001146648147073e-01   +8.758010624793359e-01; +5.315821325601172e-01   +9.971106677172105e-01   +5.918364460919746e-01   +9.943946882534163e-01   +9.952522431173842e-01   +5.428433744120206e-01   +1.935416598207118e-01   +7.867327976515071e-01; +7.129753283750849e-01   +1.871831471773936e-01   +9.105908100692988e-01   +8.566361420307107e-01   +9.624212590699481e-01   +7.118525238958922e-01   +3.266709739103646e-01   +4.672291690909900e-01; +8.703543343647832e-01   +7.808193479981844e-01   +1.918022615822124e-01   +9.609054898630227e-01   +5.358509902790362e-01   +1.566320145528306e-02   +8.803233138187793e-01   +8.135359655778336e-01; +3.287477825797515e-01   +1.960392098103865e-01   +4.318828439687155e-01   +6.783382602593484e-01   +9.657908186787433e-01   +8.016959558520766e-01   +4.717061255293183e-01   +8.962130411837358e-01; +6.495390459738105e-01   +9.918870017252656e-01   +7.492625369516909e-01   +4.028199271862886e-01   +1.164799184029547e-01   +1.421906302683992e-01   +4.041914905097477e-01   +4.279402004163707e-01; +9.761996120420694e-01   +8.011885399615846e-01   +4.066200762017864e-02   +9.340075359546760e-01   +5.023018533928610e-02   +4.791426205630671e-01   +1.806704116206457e-01   +3.340921931559567e-01; +7.663980010908690e-02   +4.241796024883491e-01   +9.457397561389660e-01   +4.797802344593662e-01   +3.034083947258647e-01   +2.554420428022376e-01   +9.696530662224410e-01   +5.959784418122762e-01; +5.885762248698350e-01   +7.287378357547799e-01   +7.636645176082074e-01   +2.297160246228323e-01   +5.814696019916308e-01   +3.689212230850031e-01   +4.090164481553504e-01   +9.013085634998765e-01; +4.125446092487636e-01   +4.979496385225312e-01   +5.569544408567532e-01   +3.963674946052410e-01   +5.325580188089151e-01   +6.611717264219656e-01   +8.441912679337961e-01   +7.022988341283108e-01; +3.083001426096372e-01   +8.087124246576460e-01   +1.834290000120536e-01   +7.041520250541864e-01   +9.000540116964849e-01   +1.680736971218650e-01   +6.168047042272479e-01   +3.785842045622417e-01; +2.636799723913350e-01   +3.566426014228893e-01   +5.001465222346577e-01   +5.590607092960508e-01   +5.407516662167281e-01   +2.800545963732632e-01   +3.740516771513349e-01   +7.352166819422304e-01];
L2I_L3I_iGABA_netcon = [+9.545883702679044e-01   +3.131470833412182e-02   +9.114807253819174e-02   +4.595446363404697e-01   +3.272519436033332e-01   +3.674604058094820e-01   +6.851793631865895e-01   +8.048863683397790e-01; +5.424187903356196e-01   +2.083458648504862e-01   +5.937006616945602e-01   +6.388024100907019e-01   +8.048010636429658e-01   +2.095776534770978e-01   +9.094183638218383e-01   +6.655021547748673e-02; +5.386821407752939e-01   +4.548925994719104e-01   +2.407799009633244e-01   +9.163106438597608e-01   +9.995327084282657e-01   +4.406722072388997e-01   +6.108549485095949e-01   +9.487863054222000e-01; +3.091877907406081e-01   +1.265044608253183e-01   +8.389845482451459e-01   +1.609569626855705e-01   +9.796959689475758e-01   +9.548570427915318e-01   +8.997743907893719e-01   +4.951077509805304e-01; +7.011461709839747e-02   +9.191297304225438e-03   +8.572384165053366e-01   +7.134981816149808e-01   +1.257584594162157e-01   +1.236121504758027e-01   +1.942136698688367e-01   +7.540797281757453e-01; +1.820787816560596e-01   +7.270430332165395e-01   +9.615634427604756e-01   +5.769692657085627e-01   +2.303398358722315e-01   +4.694816870507374e-01   +7.534587144012225e-01   +7.400201060512354e-01; +9.245120059267971e-02   +3.533642135176562e-01   +4.886154068529581e-01   +4.323073927168870e-01   +2.338888975936686e-02   +8.551567560559786e-01   +3.475656017629086e-01   +8.305124309679728e-01; +4.639855133615814e-01   +7.784751015122723e-01   +2.184979535189427e-01   +8.830198744721778e-01   +6.077869622851059e-01   +4.230838079155823e-02   +4.190525845716257e-01   +1.557875049816472e-01; +9.552252502426514e-03   +4.361344265316380e-01   +2.270737159022791e-01   +3.908752828834199e-01   +1.094060723863079e-01   +6.898335341697662e-01   +1.535621615151258e-01   +4.566095472408213e-01; +9.143010223689590e-01   +4.366710567191667e-01   +5.365426551316499e-01   +1.771901999815245e-01   +4.063616315555030e-01   +9.773985160523371e-01   +8.191312081406852e-01   +6.185648228209953e-01; +6.421530958796272e-01   +5.029892719214610e-02   +7.615600719876408e-01   +6.315570525793841e-01   +8.830792707096785e-01   +2.836662368721644e-01   +6.227547517342419e-01   +9.297315352782343e-01; -2.836939750570112e-04   +4.792367482429225e-02   +3.465697048221804e-01   +6.236549823464307e-01   +5.479522820637266e-01   +1.338773696453062e-01   +7.400422758842276e-01   +8.336690532566787e-01];
L3I_L3E_iAMPA_netcon = [+8.942620719661440e-01   +2.552951659062049e-01   +7.402813542088849e-01   +6.821120591255653e-01   +6.012375510274640e-01   +7.485512347307240e-01   +7.459871362653827e-01   +2.231280602904169e-01   +4.540672741782126e-02   +8.004750177088474e-01   +2.909550786990182e-01   +8.024922249122960e-01; +5.819145313539369e-01   +3.230225194865702e-01   +6.933767648169332e-01   +2.362240915419683e-01   +8.556167825544116e-01   +5.432116510631254e-01   +1.273294719423262e-01   +3.513987720009675e-01   +2.138437682007283e-01   +2.332424752908832e-01   +4.034966636198214e-01   +1.034601287968712e-01; +5.832338982746598e-01   +4.019597402182625e-01   +8.226803421358482e-01   +4.553306270928011e-01   +9.898068095798115e-01   +3.396916485181863e-01   +8.220158781008819e-01   +2.864352244981602e-01   +3.967097091374993e-01   +9.306121821095973e-01   +8.633862663404311e-01   +8.204942455322077e-01; +8.548748679685504e-01   +4.051693301154352e-01   +8.292003050721682e-01   +3.837415873581212e-01   +9.295452460486079e-01   +8.320650637752977e-01   +2.605315024754014e-02   +9.265790198863357e-01   +3.340837102055640e-01   +7.631197952384207e-01   +6.148857038224338e-01   +8.406421252303717e-01; +3.364397578747522e-02   +3.867438750934658e-01   +2.949138382115487e-01   +5.383764511675890e-01   +4.108970505550932e-01   +5.513441562479612e-01   +4.164048615377854e-01   +5.073663095189686e-02   +2.284308688120723e-01   +8.279015563868780e-01   +9.902421509308941e-01   +3.558557308762274e-01; +8.841590195815818e-01   +6.093132694711012e-01   +3.093240544212949e-01   +9.910018888658864e-01   +8.557549191040132e-04   +9.574113251883525e-01   +7.306754433296971e-01   +5.925100548205148e-01   +9.352228811427109e-01   +5.730160865065158e-01   +2.034162326531668e-01   +4.294755928862476e-01; +4.068174144084092e-01   +1.649628544231933e-01   +5.240502174427653e-01   +7.550274888869741e-01   +5.420995342049003e-01   +8.928020324187884e-01   +7.817476826415566e-01   +1.618125555977017e-01   +6.813719188366016e-01   +7.931465512294009e-01   +8.284074470665271e-01   +5.700919293403892e-01; +3.619189371002737e-02   +1.895994831742153e-01   +3.270376553765182e-01   +9.810616303385332e-01   +2.083354515120386e-01   +3.580757750993340e-01   +3.680005865016011e-01   +8.371657849513295e-01   +9.631733597156509e-01   +3.295592009577392e-01   +6.763857630601824e-01   +6.996044596433721e-01; +7.463125051392846e-01   +9.635788259487710e-02   +8.339741426703094e-01   +2.348865981807835e-01   +2.191699341218290e-01   +5.479544928362305e-01   +7.462543624186115e-01   +1.675361218982523e-01   +4.388018044534381e-01   +2.238073207702357e-01   +2.486409361929952e-01   +7.429324310913258e-01; +1.558338966307536e-01   +3.221396082852601e-01   +8.088046606750928e-01   +5.290560513094963e-01   +3.279463191368206e-01   +3.464861667037626e-01   +8.928885791331800e-01   +5.012895299218524e-01   +9.389351618185848e-01   +3.115886358466956e-01   +4.773942072787755e-01   +7.575938947144685e-01; +1.448510731192174e-01   +7.701682493653128e-01   +5.590355795195125e-01   +5.405541900744266e-02   +9.551915065560261e-02   +6.231971214717855e-01   +2.446242908222127e-01   +9.989565145400574e-01   +5.981739457120181e-03   +5.846235809354959e-01   +3.996096338697950e-01   +3.898262594474937e-01; +6.060731789876184e-01   +2.351438334822427e-01   +2.636423458465148e-01   +7.576054038443867e-01   +7.499584571699645e-01   +7.981130314006856e-01   +1.296405236806620e-01   +3.547386379424575e-01   +6.104377995536544e-01   +8.296751129815235e-01   +5.990737348375726e-01   +4.267667582223273e-01];
L3E_L3I_iGABA_netcon = [+9.557747970654200e-01   +8.845747378826038e-01   +8.003966366498361e-01   +9.852777871120546e-01   +9.020830236179006e-01   +9.619447469082276e-01   +6.533309888848526e-01   +4.957809036251988e-02   +1.085283753303756e-01   +4.522147146049258e-01   +8.291295606627891e-01   +5.810173612190916e-01; +5.724774166479434e-01   +4.376991135733682e-01   +9.861730153462392e-01   +5.604158084866432e-01   +9.950168563831993e-01   +5.423489173181121e-01   +6.540447728711074e-02   +4.666206413370512e-01   +4.615435512253957e-01   +3.342571649669163e-01   +6.265457005578792e-01   +6.367177645609888e-01; +8.505321199665613e-01   +7.821920838657259e-01   +1.588504683205670e-01   +9.325261418270130e-01   +6.518551208782716e-01   +3.132063783304202e-02   +2.750492288030726e-01   +3.246279392030269e-01   +4.508047122912830e-01   +5.897868008341178e-02   +5.397478250702075e-01   +6.508827443742274e-01; +2.765646767114609e-01   +1.494284143347593e-01   +2.373091653609198e-01   +7.204162735395502e-01   +1.072741887585588e-01   +6.956357391445259e-01   +2.815495343499531e-01   +6.308702586387350e-01   +5.506990250703996e-01   +7.404292845349112e-01   +6.502916436927969e-01   +8.630461710428762e-01; +6.224368022489962e-01   +6.201903337707226e-01   +7.018749998376466e-01   +4.849573156421726e-01   +3.732440231282060e-02   +5.200279413791059e-01   +8.789631713906649e-01   +2.294092725837747e-01   +8.064352038121164e-01   +5.059646923137381e-01   +7.261652640674690e-01   +5.655165042614373e-02; +5.898447421859064e-01   +2.602401941420077e-01   +3.773974706755033e-01   +6.394086389595552e-01   +6.191171512419292e-01   +6.036298965117477e-02   +4.446778290898624e-01   +5.802450815504289e-01   +7.013026656707577e-01   +2.013859719434244e-01   +9.407519054669151e-02   +8.188241261922433e-01; +9.642424086940400e-01   +4.448005633773960e-01   +9.749887413063190e-01   +8.874822589175095e-01   +5.656083630560114e-01   +8.890459727483718e-01   +7.578818347960989e-01   +6.039713920627695e-01   +8.725640875252605e-01   +4.265090329394377e-01   +8.786619038807212e-01   +5.289610379722871e-01; +8.682334705158416e-02   +8.448116305336627e-01   +9.707354345419719e-01   +1.975102229349674e-01   +9.621007587404254e-01   +3.304639728577682e-01   +6.016645004828546e-01   +5.995137373604995e-01   +5.228255469400610e-02   +1.678624827196823e-01   +1.251709981810450e-02   +6.952561979446663e-01; +5.013372193411826e-01   +1.980508140596170e-01   +6.421521437810257e-01   +3.963338590676442e-01   +7.474344886812003e-01   +2.285356250196976e-01   +7.830943383903769e-01   +4.479854731938013e-01   +2.190600783649133e-01   +7.515302539915102e-01   +2.921871562172533e-01   +2.123472215531489e-01; +5.217004414952716e-01   +3.032578049526551e-01   +8.601367419694320e-01   +9.919743012493273e-01   +6.628311677756812e-01   +1.139768234680890e-01   +1.143610870351111e-01   +3.391665252192058e-02   +4.588284296867838e-01   +3.669950164902827e-01   +1.794782628322735e-01   +5.438129787252364e-01; +9.064961710040181e-02   +4.803509219219231e-01   +4.016522418707640e-01   +4.012187165604473e-01   +5.239625627289415e-01   +3.119054909762352e-01   +9.775557440864909e-01   +5.126387459530126e-01   +9.588433142784651e-01   +9.420847646290574e-01   +9.265574486927346e-01   +7.040905067160522e-01; +9.065779083545813e-01   +3.373129679837373e-01   +6.315201173821203e-01   +6.592656484021403e-01   +2.594391397681926e-01   +2.270611898793184e-01   +8.489076806429958e-01   +4.067481815136738e-01   +7.921353144557376e-01   +1.554970306630516e-02   +6.889549559984726e-02   +9.553619110123617e-01];
L2E_Input1_iAMPA_netcon = [+9.968463865582261e-01   +9.999583383222648e-01   +9.982599415039302e-01   +9.990994149805987e-01   +9.969598664659852e-01   +9.966824614107664e-01   +9.978307271804113e-01   +9.965082839940157e-01];
L2I_Input2_iAMPA_netcon = [+9.986338815879808e-01   +9.983776280956510e-01   +9.987933510759339e-01   +9.990790639687801e-01   +9.984703132898950e-01   +9.974339990336828e-01   +1.000000000000000e+00   +9.980597338410286e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
