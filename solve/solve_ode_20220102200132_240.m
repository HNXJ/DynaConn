function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.536285618947448e-04   -3.898899036925118e-01   +4.468577771028744e-01   +6.435049251541932e-01   +2.424867292378127e-02   +4.813311907346981e-01   -2.866153053768286e-01   +2.399306800655368e-01   +3.184009372507970e-01   +7.263758098708482e-01   +1.774702636901879e-01   +4.524810980564477e-01   +9.904708684604809e-02   -2.140002396124838e-01   -4.231003234020280e-01   +3.119202755634348e-02; +1.936421872409298e-01   +6.432170167133236e-02   -1.134027272832236e-01   +5.179977516707932e-01   -9.988336055073070e-02   +4.684466428422007e-01   -4.364584613233612e-01   +3.898881948147089e-01   +6.366309709357104e-01   +1.091705024091044e-01   +6.661708879063669e-01   +5.605976670266908e-01   +3.390743350878883e-01   -8.280071472677074e-02   -1.521743586103868e-01   -5.279943308036307e-02; +6.768562456829296e-01   +3.629276517001810e-01   -2.049824549815371e-02   +1.144024083449123e-02   +2.215280550816881e-01   -4.866445136537736e-03   +3.747110412561792e-01   +1.116546716605440e-01   +3.814970758820159e-01   +1.995076900372886e-01   +3.992776860985506e-01   +2.096149683461295e-01   +1.665250883971328e-01   -3.085469870927612e-01   +1.834310273210987e-01   +7.293347368919727e-02; +3.323223330024534e-02   -3.214473757251337e-01   +1.617362473515341e-01   +5.610066206331216e-01   -1.341143939176277e-01   +5.050047968371948e-02   +4.096298434859241e-01   +8.970895020887087e-01   +5.782665816080226e-01   +1.618122716930629e-01   +2.601449328451454e-01   +6.637558957843068e-01   +3.016925381183228e-02   +5.458060357788611e-01   -8.657145685900496e-02   +7.746334901011401e-01; +5.167931571043318e-01   +6.344139019479211e-02   +4.543953269203403e-01   +7.830218495412167e-01   +1.690749242768837e-01   +5.532506470191630e-01   +6.364761755540889e-02   +3.864677201316378e-01   -1.249143023488386e-01   +1.787115661832988e-01   +5.834388354878244e-01   -2.635428736594960e-01   -3.516777043044761e-02   +2.686070911103049e-01   +5.287577360019994e-01   +1.400591199284392e-01; -1.165281809723005e-02   +4.435046825318296e-01   +7.287883357599551e-02   +1.101507952990624e-01   +8.601167668962232e-01   +2.872501848032410e-01   +7.598794041881813e-01   +2.983880899449931e-01   +1.962042130726363e-01   +3.132891690952490e-01   +2.491243892815966e-01   -1.966247006342852e-01   +3.896486625007467e-02   +1.389268697235613e-01   -1.379083584503132e-01   -1.636976830600535e-01; +3.680785393683008e-01   +5.569399909747582e-01   +2.294755485507123e-01   +1.152680507279281e-01   +5.645686366515065e-03   +3.957875391547070e-01   +3.392572899567087e-01   +3.693941443863129e-01   +2.271847057255557e-01   +3.405068656694261e-01   -1.136194364848898e-01   +4.863532870174633e-01   +4.360198208336133e-01   +2.130289462195232e-01   +4.071045169465863e-01   +3.264401497560635e-01; +2.259016351438654e-01   +3.106286762836489e-01   -1.178013612141309e-01   +4.209709415673309e-01   +3.171491230809773e-03   +2.070728589232785e-01   +1.038671021638030e-01   +5.320780881757962e-01   +5.880670262352444e-01   +5.197284578308451e-01   +1.943098738562724e-01   +3.649459369765730e-01   +1.031442049242651e-01   +1.410914757324584e-01   -7.370306165608440e-02   +3.530070482829559e-01; +4.601064979480988e-02   +4.413183470261309e-01   -2.132282051026288e-01   +3.299157193818888e-01   +2.935656486127132e-01   +4.033712933008771e-01   +6.314488194095019e-02   -1.824266286004992e-01   +3.068848550121409e-01   +5.433884590159566e-02   +6.575845210976216e-01   -9.793593439496434e-02   +5.052282243081696e-01   +3.654126723199425e-01   +1.940000211706501e-01   +1.511905611563004e-01; +1.019317815317189e-01   +3.334369918008455e-01   +2.902468116814013e-01   +3.322000570850167e-01   +2.606210829491479e-01   -7.627732199412096e-03   +5.210517406882913e-01   +1.291626176277811e-01   +1.042357525802604e-01   -7.929066529549519e-02   +1.587576032939663e-01   +2.105745997321922e-01   +7.405809787242629e-01   -2.935073772120461e-01   +2.458998786873958e-01   +4.367703007042905e-01; +3.490157778955619e-02   +5.337359839746373e-01   +2.900545307055112e-02   +1.833413625781860e-01   +5.844390523553048e-01   +3.296573250325136e-01   +6.845279146569688e-01   +1.579664458885923e-02   -1.378497403274420e-01   +4.628738774557532e-01   -3.984653834911398e-02   +4.524734740145994e-01   -4.935995909355031e-01   +4.173199109658102e-01   +5.995210554605652e-01   +2.226095142641909e-01; +5.005414627509931e-01   -2.718758300278563e-02   +1.431204809148686e-01   -2.124490940668584e-01   +4.704251557445854e-01   +4.663290735310531e-01   +1.759782303103471e-01   +4.703406596735347e-01   +6.097924204164349e-01   +8.142221698998600e-03   +5.684236927635557e-02   +3.840316179342309e-01   +5.192159214959688e-01   +3.566736279628475e-01   -1.886948308379773e-01   +2.653090536217882e-01; +4.792078097288649e-02   +3.329414966778522e-01   +7.193226358083925e-01   +2.465673238985336e-01   +4.093451936234639e-01   +3.443065090597417e-01   +2.620213524136030e-01   +8.274582338807638e-01   +6.238976258055485e-01   +9.333902512065953e-02   +2.493265075859745e-01   +2.523126784062985e-01   -2.232179242689303e-01   +1.808825070863418e-01   +2.182957898875426e-01   +3.988396501842703e-02; -1.219807165194481e-01   +3.204162600472567e-01   +3.225757425401388e-01   -6.170138896037545e-01   +6.892592809147663e-02   +7.959634191859620e-01   +4.403105992286836e-02   +2.972670889389145e-01   -1.565131179613706e-01   +5.875373532395738e-02   +6.197241519705169e-01   +4.195505719241995e-01   +4.471147142361475e-01   +5.061994320927949e-01   +1.332767505645738e-01   +2.334119312459499e-01; +2.304099776977936e-01   -2.908569273871845e-02   +3.111244054821300e-01   +5.702922111530261e-01   -3.875549788238588e-01   -7.823841543194225e-02   +7.448738057512555e-01   -2.466687010694169e-01   -1.684986892942888e-01   +3.623458289605450e-01   -3.686207578884483e-02   +9.026491081725807e-02   +2.244716752529944e-01   +1.465443304820609e-01   +1.766015987659957e-01   -3.039933529290327e-01; -2.322922711469231e-01   +4.913326758121084e-01   +6.469178208046639e-02   +5.553815374931025e-01   +8.571087176600086e-01   +7.642017049251896e-01   -7.574432553270075e-03   +7.068571111415710e-01   -1.943642804352690e-01   +5.796654108430574e-01   +5.065778334513404e-01   +4.650056284692178e-01   +2.473300831803491e-01   +3.218681883205243e-01   +6.923683772322246e-01   +2.223565456783757e-01];
L1E_L1I_iGABA_netcon = [+1.196613598983615e-01   +3.148049681425185e-01   +1.296894724715664e-01   -1.371799504864021e-01   +3.143761237209435e-01   -2.020286485074876e-01   -2.807119340144804e-02   +1.175410560419940e-01   +1.079922075731921e-01   -5.104171542930201e-02   +4.578511603311947e-01   +4.689466297693675e-01   +6.965682979308023e-01   -3.607715003003966e-01   -2.004457185482598e-01   +9.401424901106508e-01; -2.056051678741001e-01   -7.660157134677331e-02   +4.660202816461055e-01   -3.269566191965780e-01   +1.231142687266683e-01   -2.318095482461231e-01   +5.063196956282533e-01   +3.125181958702749e-01   +3.879594333795849e-01   +1.969933412093463e-01   +4.314107710606188e-01   +2.663846623226954e-01   +4.458612276390982e-01   +9.201630312148364e-02   -9.829976970051844e-02   +5.387268294695222e-02; +2.923329145604838e-01   -6.298578060294702e-02   +6.159284846393587e-02   +4.435842115189113e-01   +3.956917278735588e-01   -2.236866653959134e-01   +3.138497388677631e-01   +1.287512990376101e-01   +1.374363043152494e-01   +1.000000000000000e+00   +4.736865467693484e-02   +2.055225439871406e-01   -7.084711256436463e-02   +1.104624599304414e-02   +3.890928726582588e-01   +5.515955720315423e-01; +5.764485908621112e-01   -4.559992901357993e-02   -3.843868466555270e-02   +7.627460414441639e-02   +9.003904832769449e-02   +2.202272033544247e-01   -7.738197910236799e-02   -1.515162669052197e-01   +1.484798700396999e-01   +1.767794936620097e-01   +1.570895504345299e-01   +4.340485204254238e-01   +2.460746068528102e-01   +2.925699556669657e-01   +2.168225172787051e-01   -2.377012033109218e-02; +1.530478475598513e-01   -7.725989040516450e-02   -1.416634399243609e-01   +1.505521305862439e-01   +6.006957910461200e-01   -1.367780419665490e-01   +3.769914223649151e-01   -8.580297029894611e-02   +2.347968604602747e-01   +8.450853426857255e-02   -3.423852195769585e-01   +5.478391142355490e-01   +1.268654814221051e-01   -1.102493716974386e-02   -8.130619217627970e-03   +3.976527070064778e-01; +1.765677529448754e-02   +2.553753043057200e-01   +1.516402131878467e-01   -4.600913361962153e-02   +4.180128407220347e-02   +4.226799952366782e-01   +1.033304153216221e-01   -1.363881414945121e-01   -5.421415053656511e-02   +1.780775302547670e-01   -3.978110479543604e-03   +3.286687145340336e-01   +4.657039286567764e-02   -1.807568323692395e-01   +4.259070525812829e-01   +2.258910212800530e-01; +4.839682899589982e-02   +1.735922390550673e-01   -4.678705743393513e-02   -1.789827497308738e-01   +2.938772672476211e-01   +1.117349429616742e-01   +1.135589742159760e-01   -2.921912520787763e-01   +2.827980831994829e-01   +8.516345219209648e-02   +4.407883893686787e-01   +2.106913063051354e-01   +2.601490663772484e-01   -1.676397445396165e-02   +8.564448570559304e-01   -1.921912951556417e-01; +1.042659324415261e-01   +2.838029249174799e-01   +1.746175555190936e-01   +2.066386094815188e-01   -1.934507034476800e-02   -2.574302069128113e-01   +5.785188963270355e-01   -1.029720297945104e-01   +4.348119025727221e-01   +5.391621898811935e-02   +3.641888145036437e-01   -1.987378432769376e-01   +2.120873485727178e-01   +3.618664335643506e-01   +1.706660124042642e-01   +2.336589369314645e-01; +4.058892796761575e-01   +6.641231780436226e-01   +3.851892963128345e-01   -6.363140307241137e-02   +4.702710599271726e-03   +1.066583035350413e-01   +3.268536294412835e-01   -2.461745951020850e-01   +2.991182794809981e-01   -4.314533525092537e-02   +9.519742450885457e-02   +6.239757574782594e-02   +1.416109034689754e-01   -1.012603534088104e-01   +7.249189230689366e-01   +1.244227388834275e-01; +1.392813086926726e-01   +5.311344374595480e-01   +1.694774659842769e-02   +2.807853593597422e-01   -1.742158767205412e-01   +2.716341486011362e-01   +7.076939057071223e-02   +9.367443177324522e-02   +4.609601080050336e-01   +1.702626898350875e-01   -4.506448210460352e-01   +4.520323507530917e-02   +3.627796924002021e-01   +5.506602708154806e-01   +2.462733468742615e-01   +1.222854607121306e-01; +1.141491627150125e-01   +3.991766682201200e-01   +5.535379782841122e-01   +2.320805807013491e-01   +3.894003531442674e-01   +5.562029012284420e-02   +6.368299052956222e-02   -1.342034245527290e-01   +2.517179819696010e-01   +1.309323032718499e-01   +1.931129000887602e-01   +5.981012790410138e-01   +5.109428149766074e-01   -1.121579889582483e-01   +1.032273970112805e-01   -6.218857152828140e-02; +3.041311083744876e-01   +1.569069644788643e-01   +5.615666009090786e-02   -2.753616205137015e-01   +1.819370115763062e-01   +4.356325977564640e-01   -9.868979037325479e-02   +1.170762802546491e-01   -3.536248381640347e-01   +1.675521090524053e-01   +4.763601145670826e-01   +4.737582608979334e-01   -2.204985844985791e-02   -1.021560547988596e-01   +2.350733392014338e-01   +1.756585037186411e-01; +2.474373452653287e-01   +2.364403388572255e-01   +1.178693157972872e-01   +7.932483130372552e-01   -1.293033792491874e-01   +2.258705958931310e-01   +7.728759333894377e-03   +3.873947304673308e-01   +3.379137230093405e-01   -3.426011915436574e-01   +4.583936756154876e-01   +2.852042854120451e-01   +3.113104048332934e-01   +3.062513830592249e-01   +4.720408246028524e-01   +2.795923374587373e-01; +3.434722470787674e-01   +1.511251208812998e-01   +1.744066666118843e-01   +2.604447584449740e-01   +5.751525857713137e-02   -1.870573795229055e-01   +1.171337656995652e-01   +1.660217535196113e-01   +2.737409704294068e-01   +1.094304142364891e-01   +3.337788009702271e-01   -2.319161688060306e-01   +4.996247137575053e-02   +1.426131053708945e-02   +2.784124232723465e-01   -3.276773471516243e-01; +3.982534682672419e-01   +1.329967109234029e-01   +6.949028507814192e-02   -8.380507956025302e-02   +2.227923050007515e-01   +3.147954470423185e-01   +2.031344905259244e-01   -1.185486184939438e-01   +3.984399125115045e-01   +2.201691392664983e-01   +2.962459689284482e-01   +2.458538477857644e-01   +1.141243578002613e-01   -1.755492106517424e-01   +3.337490613332074e-01   +3.576483508798091e-01; -1.195284496776389e-01   +1.800535134223951e-01   +2.186471368256523e-01   -6.347516626779544e-02   +2.604299791818124e-01   +4.249830388685849e-01   -3.064042052759697e-02   +2.607478602300522e-01   -2.261886858138581e-01   +3.253205807895447e-01   +2.221674354640201e-01   +3.184055941735514e-01   +3.261074850323440e-01   +3.048638553465551e-01   +4.415342676558512e-02   +4.250613929069433e-01];
L2I_L1I_iGABA_netcon = [+3.285878649518233e-01   -1.965521988375621e-01   +1.429489546960534e-01   +6.425090517018207e-01   -2.121110395437689e-01   -7.947434869168783e-02   +5.244084845971822e-02   -1.712587464198615e-01; +4.329234061614466e-01   +7.890192601891048e-01   -3.157322023648887e-02   +2.865313895636781e-01   +3.065592014065849e-01   +2.648937672723488e-01   +3.999461372627531e-01   -2.060888808536002e-01; +4.989575489340540e-01   +2.752735368719320e-01   +2.449687216883209e-01   +1.541399078917775e-01   +3.055784371083310e-01   +9.935393030793573e-02   +2.062942472580125e-01   -3.126190409346492e-01; +6.466126577516292e-01   +1.468028272648002e-01   +3.230126982042933e-01   +1.762490201214898e-01   +8.388745143731258e-01   +4.943852442572877e-01   +4.743312927510100e-01   +2.798200195739107e-01; +2.147197604411766e-01   +1.108852689688814e-01   +2.674329758780729e-01   +3.305283972603272e-01   +3.805442255733765e-01   +1.313840374837167e-01   +2.925877704938639e-01   -1.006526713510355e-01; -5.664428554040259e-02   +7.139329840733055e-02   +1.829012329640079e-01   +5.272326401835866e-01   -4.142866897846488e-02   +4.975473566495657e-01   -1.429225063251674e-01   +6.972016720036156e-01; +4.637607730961935e-01   +1.891932349302149e-01   +2.951682611543004e-01   -1.348870768785067e-01   +2.962137400102612e-01   +2.047531015510457e-01   +5.881814334624010e-01   +2.440170155321903e-01; +1.496248761904487e-01   +4.319857112414490e-01   +5.104395719936052e-01   +2.307597553349101e-01   +2.239560832690207e-01   +3.273517487645662e-01   -7.672372281187755e-02   +2.630443998684622e-01; +4.196106762302009e-01   +1.000000000000000e+00   -3.459899344810676e-01   +3.848228797166340e-01   -2.630399585050745e-01   +1.351335634771772e-01   +1.256310146613725e-01   +4.376507500791526e-01; +1.410137191271864e-01   -2.200602013238125e-01   +2.783696108174775e-01   +3.675880681806674e-01   +4.444637996344685e-01   -6.333331223518142e-02   -5.482171898281331e-02   +3.373865144500611e-01; +6.432935655648267e-02   +1.862785756688461e-01   +4.603039246216331e-01   +6.324858874234013e-02   -2.156468130037602e-01   -1.663921146105866e-01   +1.775002478681390e-01   +2.146927463736975e-01; +3.655434277965396e-02   +4.610080349432368e-01   +5.333528845900939e-01   +3.056656501951098e-01   +1.874117129521319e-01   +5.065304540353976e-02   +3.924336392631629e-01   +3.860765972887927e-01; +4.148795135493458e-01   +5.069196492847143e-01   +5.675015759343058e-01   -2.564562010083836e-01   +1.724143613927253e-02   +1.978195856264813e-01   -1.888497018232228e-01   +2.359539895623042e-01; +3.756495274632699e-01   -7.062741675746037e-02   +1.024076443738156e-01   -8.938344231426620e-02   +4.645630680044875e-01   +1.695498792888547e-01   +1.746181129390288e-01   -3.385576747578582e-02; +3.121562229612352e-01   +2.694259969331527e-01   +2.253342145326092e-01   +4.502806123604643e-01   +2.039158554701728e-01   +9.631198008360338e-01   +2.466190847389598e-01   +4.799300142834318e-01; -2.997830179113576e-02   -4.875237834930917e-02   +1.962932022287209e-01   +2.381364211029567e-01   +4.812217744648047e-01   +3.104802959230406e-02   +1.231169849311406e-01   +2.610816480382067e-01];
L1I_L2I_iGABA_netcon = [+3.671309988628040e-01   +1.372601044091205e-01   +2.254754550891969e-03   +4.387908835428033e-01   -2.134087974476045e-01   +1.233159320536374e-01   -2.067034022331864e-02   +3.509703201608987e-01   -3.115620901830297e-01   +6.731212512901985e-01   -1.699536632351130e-01   +8.808196392717652e-02   +5.539145408325588e-01   +3.808417921701787e-01   +2.891739055923263e-01   +4.673075456278477e-01; +4.846541496541605e-01   +3.218079723228883e-01   -3.597060522421855e-01   +6.544265669435670e-02   -2.254310636675611e-01   +9.515517670059156e-02   +6.807143113125080e-01   +3.021156862872356e-01   +5.738590199776358e-01   +8.813046302558226e-01   +2.801239699208365e-01   -3.405076061320275e-01   -4.073744027019396e-02   -4.056673382308982e-01   +3.268601734064406e-01   +4.587250764298005e-01; -1.002552165765649e-01   -6.692135378822284e-02   +4.451511734714823e-01   +1.782186107318300e-01   +2.260582463766873e-02   -1.874476952667098e-01   +6.408956293090093e-01   +5.398131504949977e-01   -3.569788137361091e-01   +4.216533522310937e-01   -3.123116029137302e-01   +3.402270565900380e-01   +7.089176526630065e-01   +5.078876641300581e-01   +6.526275836886782e-01   -1.855018894191260e-01; +6.951206992769633e-01   +3.960764837278317e-01   +2.765455464429927e-01   +2.178296257386629e-01   +9.007424027320076e-01   +3.124173788098194e-01   +8.116271301995267e-01   +6.278011713683862e-01   -3.453167202548104e-01   +7.869439873608690e-01   +8.289766855254138e-01   +4.202229141747347e-01   +3.765797115852926e-01   +3.112214557078999e-01   +2.308593056556323e-01   +1.786915759868602e-01; +1.962235468915854e-02   -1.039463421072761e-01   -9.785613877524393e-02   +2.012797177772263e-01   -1.202613821900117e-01   +9.094161889695843e-01   +6.247904744500093e-01   +2.667965729141324e-01   +5.316766702034816e-01   +5.733446693582194e-01   -1.909516366376724e-01   +3.497625626875501e-01   -4.153751860090922e-01   +4.337663597401329e-01   +1.130352206945439e-01   +8.093325604962138e-01; +6.108672516936522e-02   +3.457894381014920e-01   -2.538081683172291e-02   +5.836597493528430e-01   -2.604026581258032e-01   +4.647616932440631e-01   +3.902723600598980e-01   +1.899644040365193e-01   +8.471707162092744e-02   -2.528022718196749e-01   +5.209032341511705e-01   -2.717183681942660e-01   +7.677729726690088e-01   +8.910704665663144e-01   +5.094879229436119e-01   +4.920286944254560e-01; +3.099587065468851e-01   +5.367418118835705e-01   +4.897516479819602e-02   +3.106728291636692e-01   +2.990401466357772e-01   -1.590665647801110e-01   +3.584159275181711e-01   -1.628597735530584e-01   -1.005208462673917e-01   +6.473705659120162e-01   +5.683754784588837e-01   +3.495135522641921e-01   +1.453192117384459e-01   -2.435650641022825e-01   +2.796898636966177e-01   +5.963827396807624e-01; +3.896510819809530e-01   +1.936468551114097e-01   +1.038078138063081e-01   +1.846726333787707e-01   +1.285340758964157e-01   +7.747239297018153e-01   +4.242866226782659e-01   +3.044385787664277e-01   -2.147778100443298e-01   +2.226719199875251e-01   +8.563723246782491e-01   +4.516399343180286e-01   +4.271723384525052e-01   -5.171831816944376e-02   +2.264035616795339e-01   +3.834406637623694e-01];
L2E_L1E_iAMPA_netcon = [+4.683323606014226e-01   -6.453996350244857e-03   +2.485383615010967e-02   +4.142950032869374e-01   +9.376070664826850e-01   +4.395850462160033e-01   +4.594701817074538e-01   +2.182147648545663e-01; -3.088605731413497e-01   +4.685718154856471e-01   -2.686840400156683e-01   -5.805103339834586e-02   +5.895758083444267e-01   +1.928419590582504e-02   +5.634298373932225e-01   +4.680128065453240e-01; -3.933678231301029e-02   +5.306704813304016e-01   +5.700423623931051e-01   +1.741725322725401e-01   +1.425679763305732e-01   -1.850461840098183e-01   +4.446245799214720e-01   +3.469907671239552e-01; +4.853514832005349e-01   +2.325366713306605e-01   -1.127503534869937e-01   +5.062615112730044e-01   +3.415184980442127e-01   +2.112445771965570e-01   +2.741057083614852e-01   -3.305906394333650e-01; -2.820872600799779e-01   +5.548422356864694e-01   +4.888074215335437e-01   -2.584661860759310e-01   +2.873966234266113e-01   +1.295071153319838e-01   +4.556900525680670e-01   +5.248234705027642e-01; +4.690998397772331e-01   -2.007852099689223e-01   +2.628794468154865e-01   -1.886147876242305e-01   +5.584237407097904e-01   +7.857365599909002e-01   +3.074781279196001e-01   +3.045341421985343e-01; +2.068718091887576e-01   +4.287441842123669e-01   +3.438326684220389e-01   +2.378349749848539e-01   -2.561627674857949e-01   +5.057403648826697e-01   +9.603330837107094e-01   -1.596191614055508e-01; +3.637072433015505e-02   +4.333852403559144e-01   +6.911707068676655e-01   +2.213789088997262e-03   +2.068863008007170e-01   +6.599731358462400e-02   +3.403555504089398e-01   +5.033554612672242e-01; +6.547175445976726e-01   +1.091175069045443e-01   +3.149374235838952e-01   +7.161427133488912e-01   -7.738887185993201e-02   +3.672963637562404e-01   +2.252114195087273e-01   -8.407571784846782e-02; +1.587377340867116e-01   +2.560258704206916e-01   +1.590799336238389e-01   +5.038218060868326e-01   +1.156230632929267e-01   -1.052675329356187e-01   -1.558269180321310e-01   +4.219684625082555e-01; -2.263211358642428e-01   +3.880351068478243e-01   +3.246517463609350e-01   -1.573082188428000e-01   +1.907184360375058e-01   +4.607092114460930e-03   +3.525914458550130e-01   +6.337473051740967e-02; +4.182475622043187e-01   +4.811985323108626e-01   +7.171002740357729e-01   +2.096592765660588e-01   +1.704867630610507e-01   +2.077272542177959e-01   -2.647945116140181e-01   +2.157130707807889e-01; -1.612985197401291e-01   +4.775420491627053e-01   +2.924608494145603e-01   -2.764719959789691e-02   +1.596019436301266e-01   +1.511680608365109e-01   +3.253108159311374e-01   -1.376809446804100e-01; +1.767121331263193e-01   +5.221422566157541e-01   -3.250556305030858e-01   +7.706563157712693e-02   +4.795306001856792e-01   +1.881747238605405e-01   +5.307821167520687e-03   +3.763730415479967e-01; +2.711806117789070e-02   +8.166602919443819e-02   +1.946969350146471e-01   +6.656358088417482e-01   +3.456094150554809e-02   +7.367931798100200e-02   -6.300179858537344e-02   -8.952589751396199e-02; +1.659662680595693e-01   +2.987386303831226e-01   +1.159039017437349e-01   +7.149729616680908e-02   +3.474786180759962e-01   +3.381019045402641e-01   +5.719057924684932e-01   +6.718866336235927e-01];
L1E_L2E_iAMPA_netcon = [+2.678259554654178e-01   +4.049476657415180e-01   +1.848272138417196e-01   +2.941508365718127e-01   +3.557968622635095e-01   +4.208749763064437e-01   +1.366041472507746e-01   +3.433528871403349e-01   +2.999812791786109e-01   +1.764519469250707e-01   +3.136256631860571e-01   +3.582331503586110e-01   +3.669353702405036e-01   -1.178665824761807e-01   -3.617154832376670e-01   +5.779180165580291e-02; +1.755939691380045e-01   -3.506185933063071e-01   +8.348593681191202e-01   +3.962151795779243e-01   +2.144621019670532e-01   +1.580341183819709e-01   +4.934961116707143e-01   +2.613950522515983e-01   +6.981747284353300e-03   +4.390475288299248e-01   +3.242502767081172e-01   +2.708174501243754e-01   +5.660786285319857e-01   +3.715925041988895e-01   +4.680829261330274e-01   +3.186750112505809e-02; +4.551005809359530e-01   +1.484496183974278e-01   +1.545342396072580e-01   +3.322455699708206e-01   +2.071609425723633e-01   +4.697091014771696e-01   +1.897209713041171e-01   +3.117490591506134e-01   +4.777546668928669e-02   +2.896522181802124e-02   +3.884441637391146e-01   +6.599291498773839e-01   -1.893094759918912e-02   +5.535232966447700e-01   -4.686227523761120e-02   -3.892928411093978e-01; +1.860365419506843e-01   +9.136582969335068e-02   +2.354140349790793e-01   -1.128489408919043e-02   +2.819424609251835e-01   +5.816628993740582e-01   +1.000000000000000e+00   -8.527668626390808e-03   +7.575291103691567e-02   +1.208274015047422e-01   +3.273962123990928e-01   -1.714726886007772e-01   +1.597441160676791e-01   +5.656724646727589e-01   +4.103150162040863e-01   +1.108238789367573e-01; -1.387186605225993e-03   -3.931214467467778e-01   +5.223451147795306e-01   +1.196056785915452e-01   +6.826370877622454e-01   -4.987674085987999e-02   +4.139847649047750e-01   +1.257575167083435e-01   +9.600178104288525e-02   +2.967028853998876e-01   -4.097710060731329e-02   -3.665973566173769e-01   +5.151679404644804e-01   -1.178835115390132e-01   +9.254673440700183e-01   +1.362133104197690e-02; -7.529308865782461e-02   +5.308288349679651e-01   +2.687958539987064e-01   +6.377528672947893e-01   +4.629529872928015e-01   +1.188497791406714e-01   +6.632335535953600e-01   +2.273395082476397e-01   +6.957986881951158e-01   -5.794094022897956e-03   +6.015516034069099e-01   -6.191823292837587e-02   -2.246224658480341e-01   -3.016521485724372e-01   -3.314143663308438e-01   +3.419244618651468e-01; +4.183614914633083e-02   -1.912457286427847e-02   -7.322068576424132e-03   +5.451710026152108e-01   +1.267607395517411e-01   +1.887442043898172e-01   +6.109646069442757e-01   -6.112946883072192e-03   +4.669681049737281e-02   +1.176736066947659e-01   -1.198602771994472e-01   -4.103519266204170e-02   -2.419661331669814e-01   -5.794980473478163e-02   +5.854310451784341e-01   +3.057595423898001e-01; +2.761822859850767e-01   +3.174488014882133e-01   +2.145134402427402e-01   +4.078802820919974e-01   +4.921452949019531e-01   +9.070809401438320e-01   +5.207294440341522e-01   +4.081256437099298e-01   +2.661578878697662e-01   +2.177465155851566e-01   +6.124813999640433e-02   +2.590792029391737e-01   -2.116383309456119e-01   -2.024971187889051e-01   +5.073363884817806e-01   -1.099290719382104e-01];
L2I_L2E_iAMPA_netcon = [+4.174573758604524e-01   +6.679622429478403e-01   +6.997443220747380e-01   +5.288311632146042e-02   -6.646376264024985e-02   +5.988415769332154e-01   +2.804047684966106e-01   +5.791507553551621e-01; +4.933141282214931e-01   +2.648843557534919e-01   +8.549995972922141e-01   +4.539063833363365e-01   +4.416631705650239e-01   -5.464548425171373e-02   -1.644867465002120e-01   -2.152257998268476e-02; +5.822636855058939e-02   +4.080572786774965e-01   +1.117934022711029e-01   -8.042274473958726e-02   -3.458060593638442e-01   -2.969632489231984e-02   +5.216433194171985e-01   +1.141893602890395e-01; +3.994295986011621e-02   +6.545332907279393e-02   -1.327407596213991e-01   +6.041865361929726e-01   +2.046143199133212e-01   -2.719040286380862e-01   +3.244218001290566e-01   +8.116390187025281e-02; +3.793371623343446e-01   -5.128668948967347e-02   +1.059995698523032e-01   +3.882840139435081e-01   +1.364271409390824e-01   +9.243525827263141e-02   +6.332002183014540e-01   +5.045004178830272e-02; +3.116225848987621e-01   +3.720632451675657e-01   +1.300662553252561e-01   +4.182385225476445e-01   -1.692962246421310e-01   +3.322920666980153e-01   -1.838978092839590e-02   -1.255024701055590e-01; +6.100053457913350e-01   +2.107473886237193e-02   +3.249694162308923e-01   +6.545646065380826e-01   +2.969258215409575e-01   -2.893753231683620e-02   +8.811020849619043e-01   +1.483439445851456e-01; +4.283681214425128e-01   +6.750579830547283e-03   -2.777685773601001e-01   +1.678683671801001e-01   -3.408450501586595e-02   +3.607538521444534e-03   -1.594367906332993e-02   +5.277151897613510e-01];
L2E_L2I_iGABA_netcon = [-1.962355617130741e-01   +2.541695498705065e-01   +5.715735846850738e-01   -2.543884914492096e-01   -2.479654461595535e-01   +8.675199945057370e-02   -2.401656173733394e-01   +5.316858783223690e-01; +1.876264218272424e-01   +3.570720619413640e-01   +9.611049163526218e-02   +4.229888840706812e-01   +5.583882901944256e-01   +1.839333252869206e-01   -5.181177528924790e-01   +3.348587581030799e-01; +4.178294899298630e-02   +6.534511175030147e-01   -1.285915173982156e-01   -3.108618798822220e-01   +3.580424524254583e-01   +5.857079540813394e-01   +2.060585776489642e-01   +7.123337537727866e-01; -7.209752698976538e-02   +4.639560020163923e-01   -2.314520194533374e-01   +7.657200570796833e-01   +5.981349128995834e-01   -2.189333471663552e-01   -4.209144651980021e-01   -1.830618697783655e-01; -3.366635577566467e-02   -3.042936448273182e-01   -5.735296818573046e-02   +2.585914865150361e-01   +8.591975050156470e-01   +3.296736229385516e-01   +7.661201077741520e-02   +8.532055346426985e-02; +5.467651443878589e-01   +1.881690596770587e-01   +2.985552048922287e-01   +4.969627170678741e-01   +1.499799997455740e-01   -3.764256768817956e-01   +2.579525313947400e-01   -3.132661778076595e-01; +1.805256738750278e-01   +3.885992966253127e-01   -3.126181065297866e-01   -3.162268890796192e-02   -6.994580670038526e-02   +6.472314527919927e-02   +7.961976371493276e-02   +6.926072020718602e-01; -6.252460960045783e-02   +4.236820335699628e-01   +4.803142916252340e-01   -2.557333897802900e-01   +3.976918431759702e-01   +3.517142567322805e-01   +3.962944819489033e-01   +6.221006758845321e-01];
L3E_L2E_iAMPA_netcon = [+4.215439695486548e-01   -3.795503453862049e-01   +1.559679070373879e-01   +1.944742026528435e-01   +5.286193282578734e-01   +1.629738949996751e-01   +1.752778914288978e-01   +5.258705903832271e-01   +6.339073617124520e-02   -1.967911582165282e-01   +2.358944743512960e-01   -3.013002050956407e-02; +3.633275869928861e-01   +7.341300544518170e-01   -1.086498718563856e-02   +3.862163510405258e-01   +2.182968951181198e-02   -5.316724026443221e-01   +5.011233631738683e-02   +1.747986341514831e-01   -1.522297045268982e-01   +1.293232125642110e-01   -7.406891096777145e-02   +3.594344610641238e-01; -4.223117249514385e-01   -2.255924101170894e-01   +2.820513603066570e-01   +3.234319284928077e-01   +1.000000000000000e+00   +3.849364793431326e-01   +3.570557026530589e-01   +3.662668937893705e-01   +7.309211909303178e-01   -2.923553287269279e-01   +4.779392721857560e-01   +5.909054206037953e-01; +1.695443287548975e-01   +2.079307414236081e-01   +3.531835274038229e-01   +1.217995782596261e-01   +5.372852936648305e-01   +1.097127524921718e-01   +1.352785765782063e-01   +2.832509935732020e-01   -8.011060181596814e-02   +3.554776889604508e-01   +1.277194245251362e-02   +3.961449978856639e-01; +2.697343811712226e-01   +1.863013509494739e-01   +1.310825201343805e-01   +3.594072603225759e-01   +6.331562190711141e-01   +6.845411984349109e-02   -4.216356250829165e-02   -1.599204740921101e-01   +2.842290022909791e-01   +6.867274480548177e-01   +7.258989466400009e-01   +7.534798008550120e-01; +6.710030086226665e-01   +5.291122462147170e-01   +1.433110829096720e-01   -3.198979265632568e-01   +2.479383095802276e-01   +3.815028049971499e-01   +1.945331898832531e-01   -2.353678112999163e-01   +2.567735780565467e-01   +3.767546124357551e-01   -1.617206940277004e-01   +2.210980888282774e-01; +3.565027516214874e-01   +7.069981574411194e-02   +6.862039199239788e-01   -2.950363434137490e-02   +3.564278847505468e-01   +4.520003113579277e-01   +9.222773614903726e-02   +1.094677615860042e-01   +3.999475536421763e-01   +4.394129510051863e-01   +2.605075335939630e-02   +1.973564930777043e-01; -1.290501765370753e-01   +8.926225953699476e-01   +5.871776489822627e-01   -3.305415874799153e-01   +7.343906043673696e-01   +1.153587434081574e-01   -7.584344980511362e-02   +2.150631468541776e-01   +4.465626789747718e-01   +5.072248271395371e-01   +5.162739009789798e-02   -1.728625377947816e-01];
L3I_L2I_iGABA_netcon = [+6.985931307393083e-01   +4.751187197083515e-01   +1.965983628493875e-01   +2.939885921962311e-01   -2.879564524573086e-01   +9.528923502150508e-02   +8.051979687256503e-01   +4.960979776083890e-01   +7.057279201119676e-01   +1.742714991572221e-01   +2.019472805336913e-01   +5.093133188599738e-01; +3.962364404820274e-01   +1.415412793788316e-01   -6.166575843970547e-02   +7.944503023301656e-02   +5.148631576336481e-01   +4.209946954729166e-01   +6.113465645861843e-01   -2.330859286813212e-02   +3.378406577894694e-01   +1.849722378956914e-02   +2.816224659369772e-01   -2.359094818225356e-01; -3.665072633268547e-02   +4.477997438564127e-01   +3.157278890285883e-01   -1.461012779305634e-01   -6.765164342555077e-02   +2.836953802198947e-01   +3.522989149052413e-01   +2.610376936218762e-01   +1.966395635948726e-01   -3.218024760181075e-02   -6.838783509713504e-02   +7.923191091440897e-01; +3.595000926509509e-01   +1.996824634340489e-01   +5.639626692867645e-01   -7.024658333667190e-02   +1.386467340940489e-01   +1.202140560468179e-01   +4.165351212509963e-01   -1.152637009063847e-01   +5.159063328798306e-01   +3.453894009399477e-01   +7.792305431070814e-01   +9.174046151992860e-02; +3.078629360655422e-01   +3.853919743443334e-01   +3.140140774530120e-03   +2.568957074260800e-01   +5.468852238678676e-01   +6.405892593239352e-01   -2.757755505798438e-02   +9.167566000764205e-01   +6.719146479701533e-01   +9.244425456203488e-02   +3.493976556540349e-01   +4.526213261734870e-01; -9.899081905789189e-02   +3.025162975568928e-01   +2.202544224724349e-01   +1.741291954186951e-01   +7.412718309849374e-01   +4.126740691934735e-01   +1.304251948330378e-01   -1.124365596898296e-01   +2.089812264157258e-01   +3.283382850539890e-01   +3.607255167074663e-02   +3.968349548791679e-01; +5.364723530486889e-01   -1.134775086094475e-01   +3.468431110624572e-01   +2.227186558206328e-01   +2.074309468573360e-01   +5.463333446333419e-01   +3.898803720927741e-01   -4.619374406991362e-02   -4.526745885175822e-01   +7.420137724705840e-01   +4.553105376861737e-01   -3.763730401520497e-03; -9.294624232823406e-02   +1.978306628854898e-01   +4.618611641607202e-01   +4.627662587673591e-01   -5.871669248736468e-02   +6.088853297848612e-01   +7.201917278100702e-01   +4.339582018211179e-01   +4.021728268294189e-01   +2.182026246379065e-01   +4.994896827627256e-01   +3.872165255198520e-01];
L2E_L3E_iAMPA_netcon = [+5.348986788721543e-01   +2.189887536705513e-01   +3.928268185936144e-01   -2.326828943431069e-01   +1.425810253143272e-01   +1.531375292322035e-01   +5.027806776160907e-01   +2.772124083008733e-01; +3.341418555517606e-02   +9.582795129625275e-02   +2.504051915602318e-01   +2.908331603722573e-01   +4.315483158541365e-01   -1.636731238661672e-01   -1.853315826729682e-01   -2.783217667512855e-01; +2.589390592441757e-01   -1.087582662717720e-02   +1.035041055016111e-01   +4.716873895696858e-01   +1.347059257549867e-01   +3.485756856338453e-02   +1.991201270726623e-01   +4.308661990137485e-02; +1.900998661733254e-01   +2.449095593160647e-01   +7.652133463247374e-01   +7.823718990435401e-01   +4.138930744807453e-01   +5.581750741731503e-01   +6.543711890384880e-02   -1.704372737597308e-01; +3.608986040184823e-01   +1.260540942414973e-01   +1.416081699724566e-01   +7.788930803942756e-01   +5.479280689464791e-01   -4.615031950425518e-02   -7.113356735523649e-02   +1.763252588442582e-01; +3.882226774654927e-01   +7.242543071183659e-01   +5.045251337134096e-01   +4.923044231239008e-01   +5.083487602540379e-01   +1.737644845593392e-01   +4.141405423778351e-01   +1.168573006001779e-01; +1.953075719393585e-01   +3.821144157938471e-01   +5.230342729202748e-01   -1.964432438877799e-01   +1.642340747730482e-02   +1.257764914848505e-01   +4.834662901076114e-02   +2.992424242806925e-01; +2.885121351357369e-01   +3.297191007396548e-01   +3.147108772275942e-01   +1.436076727120466e-01   +3.304964450072782e-01   +3.109303279364166e-01   +2.220176149861053e-01   +6.544268011899765e-01; +4.636250658477355e-01   +5.375125184561682e-01   +3.681964892022782e-01   +1.226440384779328e-01   +1.237696412005104e-01   -5.976632196313155e-02   +7.719316678493998e-01   -2.214515774891372e-01; +5.451463306476139e-03   +3.076061329597650e-01   +2.984275436477586e-01   +7.780539141235072e-02   +3.737092262942294e-02   -5.271473190992902e-02   +4.130567624996232e-01   +1.631787586079786e-02; +5.012655573848546e-01   +4.873483430245903e-02   -1.793787574199246e-01   +1.000000000000000e+00   +1.510907926809885e-01   +3.298983123992384e-01   +2.448584172179219e-01   +2.708020465640301e-01; +1.429042171079478e-01   +8.463386181077125e-01   +5.054574702149146e-01   +5.882026835384425e-01   +1.113643948810726e-01   -9.343339663224402e-04   +1.888503013453098e-01   +4.238626043277587e-01];
L2I_L3I_iGABA_netcon = [-2.244560425981904e-01   +1.179682874013582e-01   +3.072270615871800e-01   +3.088036389909133e-01   -3.654515838371328e-03   +7.018242049630272e-01   +2.383654683305576e-01   -1.878762363305935e-01; +2.198970587287340e-01   +8.537455276867095e-02   -8.488493225654277e-02   -1.254075024981055e-01   +2.072112121584113e-01   -1.121932338656960e-01   +3.845446832331876e-01   +4.070081822911018e-01; +7.309244822816467e-01   +8.970250764726386e-01   +3.423271389322134e-02   +5.019167918957319e-01   -1.335351253176072e-01   +7.759200119530498e-01   +2.975469112180071e-01   -5.466531472467097e-03; -7.524438980937881e-02   +3.134901666226152e-01   +7.996217276379347e-01   -2.755722463361349e-01   -6.373350726322419e-02   +4.521127996765682e-01   -1.451609822657239e-02   +3.354092924940288e-01; +6.123963240789895e-01   +1.469123347796609e-01   +1.137942997439173e-01   +2.588385797469119e-01   -1.757202400233729e-01   +2.109786181755923e-01   -7.383391938432085e-03   +8.996116916746982e-02; -2.604107969126681e-01   +2.422224266375537e-01   +7.899214216829062e-01   -1.545110221501065e-01   +4.812052718611785e-01   +9.486139306630227e-01   -3.307782974273376e-01   +1.164304069017865e-01; +5.763093303952671e-01   +1.641847938506058e-01   +4.149144025228800e-01   +2.144478185235220e-01   +3.641312197148959e-01   +5.079451251139102e-01   +8.616100843830041e-01   +5.723512943038133e-01; -2.103210226647118e-01   +5.773566604819599e-01   +1.866437616412224e-01   -1.206489951828295e-01   +1.323784463365014e-01   +3.783683793324145e-01   -1.299735715980740e-01   +8.307117393417680e-01; -8.906226025752377e-01   +8.409691428313103e-01   +5.359325323854011e-01   -1.213882112519941e-01   +1.835208106332111e-01   +4.800784183396463e-01   +5.927355790682390e-01   +3.063081976576262e-01; +2.878325657768598e-01   -3.300580473831886e-01   +1.584920464658420e-01   +8.681436367390864e-02   +4.327199831045772e-01   +4.625953557931391e-01   +1.291112171394996e-01   +6.792103510810528e-01; +8.613834172456095e-01   +4.441738168542039e-01   -5.180343435533268e-01   +2.232948690334219e-01   +3.636440380523531e-01   +1.615813171426611e-01   +4.741839242874384e-01   +8.498409479127972e-01; -4.491126856003015e-01   +8.845503484900987e-01   -3.597801877684967e-01   +7.610360983187523e-01   +6.564921144413930e-01   +2.524249231544485e-01   +8.557428188282290e-02   +1.103531030677780e-01];
L3I_L3E_iAMPA_netcon = [+3.554202225619475e-01   -1.902377848654802e-01   +1.418076892109248e-01   +3.587310879809651e-01   +5.848349063446696e-02   -1.894402135659935e-03   +1.824682316879887e-01   +1.556206589864874e-01   -2.679212530730855e-01   +4.323891614371950e-01   -6.388730929962373e-02   +3.815392421164097e-01; +1.465665165200316e-01   +1.735317556828161e-02   +7.029568304709537e-02   +4.184265629489952e-01   +2.992106592044132e-01   -1.234446137115498e-01   +1.895457398694241e-01   +2.891546755587751e-01   +5.754263880168271e-01   +1.262460826324414e-01   -5.248017152441849e-02   +1.517794117358879e-01; +2.756501773267970e-01   +5.796584194774592e-01   +5.423971455930068e-01   +7.503029498087958e-02   +5.756879105179652e-01   +2.828937453969916e-01   +6.315197155596176e-01   -5.782486373775658e-02   +3.252936764684310e-01   +5.450823004533040e-01   +1.904176753745612e-01   +2.152867025726829e-01; +4.404517882106213e-01   +3.695522601040809e-01   +4.895867582078653e-01   +1.003949648070974e-01   +1.124774443417709e-02   +6.652146458916033e-01   -1.110586203922465e-01   +3.321749131824737e-01   +2.058095704026783e-01   +3.104867643198999e-01   -6.455753858278128e-02   +1.402333597753059e-01; -6.955008620186180e-02   -9.637851603901570e-02   +8.546148673248144e-01   +2.328848730989247e-01   +4.536247866178120e-01   +3.292459776524745e-01   -2.802211797198021e-01   +3.290245382754524e-01   +3.906735441592429e-01   +6.358433221332558e-01   +3.387593927232511e-01   +2.820971186619803e-01; -1.249503368329189e-01   -1.879231282135361e-01   +1.446197516056203e-01   -6.532546696265602e-02   -2.235245294686631e-01   +8.721941799352066e-02   +2.819276419420751e-01   +3.015770088762286e-01   +2.964426492823986e-01   +9.874118599187172e-02   +3.291049118651889e-01   +4.056828927245560e-01; -9.054652945097769e-02   +8.800094429279706e-02   -1.794315475057636e-01   +5.190477031392158e-02   +3.112365921354730e-01   -5.363312747145895e-02   +7.047876376708658e-01   +5.451696530418209e-01   +2.703215846894388e-02   +3.595127082370980e-01   +3.851804963968784e-01   +2.447726571853779e-01; -5.853244292500094e-02   +3.746480614317071e-01   +2.358227074726036e-01   -2.189476834752536e-02   +2.527104974920159e-02   +1.643057460450123e-01   -6.218913987164548e-02   +3.568660511092291e-01   +3.369477367236656e-01   -3.616964221701944e-01   +1.036691472898528e-01   +4.290388303947590e-01; -3.388988840507232e-02   +4.867183156385479e-01   +1.135307916212923e-01   +3.085557005135012e-02   +9.183752235140780e-02   +6.547512665199779e-01   +3.093761870482994e-01   +6.166953362986383e-01   +2.056911773437562e-02   +6.268694438023208e-02   +5.341406211555798e-01   +1.000000000000000e+00; +6.394593212873622e-01   -5.909677890615928e-01   +6.386925429538564e-01   +1.565315520209368e-01   +3.199309056152851e-01   -4.338005779388177e-01   +4.917097866820437e-01   +2.373291656340447e-01   +6.973009318234821e-02   -5.828956643678922e-02   +8.816348826529868e-01   -1.244322713028617e-01; -4.808496058312720e-01   +3.036677105371486e-01   +5.964441781147981e-01   +3.989659725319576e-01   +1.353578767556390e-01   +5.342639325534622e-02   +2.925181179708205e-01   +2.014450624434740e-01   +5.904965544336611e-01   -1.066219166651503e-01   +5.188170059737640e-02   +2.466094136184939e-01; -2.352854540257621e-01   +2.064102420516871e-01   +2.047130117850718e-01   +3.611695893276503e-01   -3.274235906228609e-01   -2.526061884331536e-01   -3.513270439997464e-01   +2.708769649115841e-01   +6.579147110341500e-01   -1.277166718136144e-01   +2.524412005294008e-01   +1.688687822493579e-01];
L3E_L3I_iGABA_netcon = [+1.214647363765582e-01   +1.488733838035168e-01   -9.271175021980844e-02   +3.370591723609129e-01   +1.330279055403223e-01   -7.176917230850219e-03   +3.485567214515810e-02   +2.647399790481276e-01   +1.701245471787833e-01   +2.593499917066854e-01   +3.244633200825924e-01   -6.956141055070346e-02; +3.867058973346142e-01   +3.835469173227815e-01   +1.994846044665720e-01   -1.823432226006852e-02   +2.630133586096991e-01   +2.288247758428748e-01   +2.012401408726495e-01   +3.290419522600830e-01   -3.126891276764002e-01   +6.726218982424352e-02   -2.343065985137083e-01   +2.138531959230180e-01; +5.061902617179808e-02   -1.261204363431254e-01   -3.411567248844121e-01   +2.131118241499395e-01   +1.008720749477414e-01   +1.338885040374201e-01   +3.365724551715960e-02   +2.373614138906127e-01   -8.684014680471891e-02   +4.223318250123155e-01   -1.357772877023594e-01   -4.797107058622375e-02; +1.637384770983019e-01   +3.158105631909142e-01   -3.090548306142106e-01   +3.530882049271199e-01   +7.409434294519716e-01   -2.685668150629088e-02   -3.783077154436069e-02   -1.097410747393232e-01   +6.574095319773930e-01   +3.841370405126975e-01   +1.501858418912747e-01   +2.833708482763830e-02; +2.306737261662118e-01   +5.083632907983332e-03   +3.426317015871237e-02   +2.615753140474785e-01   +1.161006237830411e-01   +1.904821027711980e-01   -2.189682057256543e-01   +5.590271842816456e-01   -1.418602988066249e-01   +3.937022116481360e-01   +4.592987014460324e-01   +3.413764290226081e-01; +4.855125401522518e-01   +3.255953683864005e-02   -4.980527213687669e-02   -2.886500428475327e-02   +3.152527665206364e-03   +2.417332969460331e-01   +1.194122794254783e-01   +1.949234126191753e-01   +4.762380823280232e-01   +3.213137610332500e-01   +7.663641718642290e-02   -2.411486934126985e-01; -6.651113998260946e-03   +2.267605653502262e-01   +4.005195746372924e-01   +9.626506089326031e-01   +2.018315417945774e-01   +4.399572928716758e-01   +4.984514666296373e-01   +1.719427757878912e-01   -1.261981445227020e-01   +3.116995849188559e-01   +6.263133403385822e-01   +1.235719178086121e-01; +1.138950612106601e-01   +5.061053644126889e-02   +4.519651393309775e-01   -7.293036357945562e-02   +2.250401783375989e-01   -2.545596492201438e-01   +2.025350558080919e-01   +5.995738825639104e-01   -8.943929585369018e-02   -4.723261020151202e-02   +8.838921892541908e-02   +3.433622773254935e-01; +2.091600175630550e-01   -1.048677745109974e-02   +3.400317253888546e-01   -1.450074350584026e-01   +2.469781122763258e-01   +1.039384028586660e-01   -3.245262554240852e-01   -1.005732554312713e-01   +3.856543323668735e-01   +5.454698130841937e-01   +2.623720455268847e-01   +5.107378746370181e-01; +1.361565414415505e-01   -1.769548511323583e-01   +3.510211421003459e-01   +1.577939301066790e-01   -1.611308261401266e-01   +2.748091440036987e-01   +1.591729700722009e-01   -9.993111247697169e-02   +1.925388955745002e-01   +5.584704816705535e-02   +2.450455128917016e-01   +2.728586679269998e-01; +1.853144013950573e-01   +1.153527498696604e-01   +4.051146242119066e-01   -1.765187171961456e-01   +1.968190041237615e-01   -1.059658810350480e-01   +2.943954389795471e-01   +1.258056353320926e-01   -1.589650117430070e-01   +7.314082836952632e-02   +3.118104758729334e-01   +3.765547582801273e-01; -1.679301738536872e-02   +3.827166848767878e-01   -7.031156817520337e-02   -3.598232504865848e-02   +8.266431526399388e-01   +4.376836890383210e-01   +5.353588183769923e-01   +1.070450170038232e-01   +9.074970988780710e-02   -1.209179125042055e-01   +2.662817756071973e-01   -2.514361715662209e-01];
L2E_Input1_iAMPA_netcon = [+6.957580470015636e-01   +6.825377552889973e-01   +8.164725099943591e-01   +8.752024752935897e-01   +9.767504824637356e-01   +7.233785561215669e-01   +6.096334072240087e-01   +8.412278012392640e-01];
L2I_Input2_iAMPA_netcon = [+7.270937138918866e-01   +6.547219871726573e-01   +6.855857200732235e-01   +9.473704887793064e-01   +2.762386196815366e-01   +8.623037048880988e-01   +2.054340437656821e-01   +1.562337939051400e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
