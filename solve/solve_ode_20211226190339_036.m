function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.716201511745140e-01   -1.055762840745494e-01   -8.592546927138403e-02   -1.549846533680329e-01   +1.188863387828274e-01   -2.791192225336131e-01   -6.894900558523342e-02   -9.679128850220374e-02   -4.795961550912230e-02   -2.035632876721970e-01   +2.093710044387770e-01   -2.088851003539067e-01   -3.424651388711056e-02   +2.189290942497649e-01   +7.050222627995049e-02   +2.230104647303084e-02; -8.682888531741116e-02   -1.224020679456999e-01   -1.996838531442033e-01   -6.054561941780650e-02   -2.494293892837702e-01   -3.174639309593082e-01   -5.056184871861270e-02   -6.507664002946295e-02   -3.192363631253910e-01   -3.027403011546476e-01   -1.998264401662199e-01   -2.073036944488558e-01   +1.461713579129401e-01   -1.569789685052803e-01   +3.368112150269517e-01   +2.862059121578269e-01; -5.224959897686490e-02   +1.316106377144781e-01   -1.628090288297101e-01   -3.489547825538978e-01   +7.840421398016387e-02   -1.003726227384247e-01   -2.900102967305281e-01   +8.936034343176841e-02   -4.148049621963328e-02   +8.273595203755618e-02   -9.967294589298709e-02   -2.255961991252225e-01   -8.305363992227718e-02   -8.129192670649853e-02   +2.803198585858947e-01   +1.897415615787834e-01; -2.415275892229835e-02   +7.380501757218065e-02   -2.773722402088386e-02   +1.582028824031567e-01   -1.737719234121186e-01   -9.758180091266097e-02   -8.697083748042841e-02   -2.104082590306050e-01   +1.185898498990001e-02   -1.213434861699721e-01   -2.171452121526113e-03   +1.334123791233602e-02   +2.634100237285457e-02   -1.577897707481740e-01   -1.963955013792771e-01   +7.307581500368665e-02; -7.255311075780897e-02   -1.301916645637122e-01   +2.195628433645150e-01   +2.028644573248975e-02   +3.659819589404692e-02   -2.345514298299547e-02   -3.465873452152431e-02   +3.953507741846948e-02   +1.782001532462909e-01   -1.741697593537382e-01   -2.464345703513041e-01   +2.155658016965990e-01   +8.970668259059425e-02   +2.306626715068420e-01   -7.663654373633147e-02   -1.176890544759884e-01; +2.229415396984314e-01   +1.265244790597466e-01   +7.094972801170710e-02   +3.589760420751296e-01   -1.807677982207441e-01   +2.234800064724467e-02   +8.772821742763615e-03   +1.439811745708636e-01   +3.029072430744010e-01   +1.837955137821595e-01   -2.953950094629444e-01   +1.940548219960592e-01   +7.533703546576502e-02   +1.219764723993574e-01   -1.766819424258604e-01   -3.286077520784741e-02; +2.241853063138647e-01   -6.107356369477507e-02   -1.595328343495296e-01   +1.453827423444023e-01   -1.502889650287774e-01   +3.487983478384986e-01   -4.881800127366666e-02   +1.283217142714633e-01   +1.263657712089221e-01   -4.580782684291530e-02   +1.678129138757853e-02   +2.823533982213430e-02   +2.993771044825203e-01   +5.519605418971629e-02   +1.366570554719907e-01   -1.991061566137673e-01; -4.673708961775001e-02   +3.124507695802385e-01   -5.065971189502519e-03   +1.953284760915661e-01   -5.491146639842082e-02   -5.513658807644632e-02   +3.891405357633464e-02   -2.543426999357492e-01   -7.779817621848309e-02   +1.714829021273522e-01   +2.406827683393743e-01   +1.464021076541585e-01   -1.658815199990990e-01   +3.672754190414768e-02   -9.864353474517240e-02   +1.282540752242424e-01; -2.101937563106749e-01   +2.481964247614472e-01   +1.372633236931725e-01   -9.161080116772360e-02   +6.230611358438291e-02   +1.590393178644035e-01   +9.458211674861834e-03   +1.880966013286453e-02   +1.715667029914650e-01   +4.510379810417654e-02   +1.811699348711993e-01   -2.627019593295131e-02   -1.283036018299743e-01   -3.196012303617500e-01   -1.691703629627440e-01   +1.422174958786207e-01; +2.382656289486877e-01   +6.813851842179557e-02   -1.945062085435971e-01   +3.978947726562410e-02   -3.188257284444175e-01   +1.015478502223736e-01   -1.684124705664089e-01   -1.499706519386058e-01   +2.368716321495406e-01   +1.545328333602897e-01   +2.535121383331763e-01   +1.752079164822868e-01   +2.452055325984586e-02   -4.597509028304888e-02   -9.510632665997829e-02   -2.143392631617125e-01; -1.017257060709996e-01   -7.675867983908483e-02   -1.375925756887174e-01   -6.217098238609191e-02   -6.248354717749374e-02   +2.734529098129002e-01   +2.593032055497253e-01   -1.392553106816945e-01   -1.058731411223766e-01   +1.880848930308712e-01   +3.870183685245827e-01   -3.104720946987940e-01   -1.596039666996729e-01   +2.962254529648031e-02   +4.826087335060451e-03   -1.472901175813464e-01; +5.596177058103753e-02   +2.125959436640706e-01   -9.152849887107864e-03   +2.780484904427528e-01   +1.940254459343136e-01   -1.242624056986933e-01   +1.445012994916165e-01   -1.724334374154247e-01   +2.929840259070267e-02   -5.467059667014257e-02   +2.825643383019514e-01   -2.016830478506398e-02   +1.851947950790088e-01   +2.838081571114695e-02   +6.514829612355855e-02   +1.568489606630667e-01; +7.435520107607126e-02   -1.103978927789445e-02   +5.414007599068829e-02   +2.822777830390391e-01   +1.661792917720612e-01   -6.570877077380161e-02   -1.251637520112389e-01   +2.175821973850037e-01   +1.867810974231682e-01   -8.623280104107456e-02   -2.076227930536039e-01   +3.204574845402211e-02   +2.592530081063280e-01   +1.125166636705680e-01   -2.018748988710991e-01   +3.141186460605677e-01; -1.131623554262447e-01   -2.047060816606196e-01   -2.789556127105631e-01   -8.957500040700450e-02   +2.273513463332855e-01   -1.015716672783168e-01   -4.721325718699255e-02   -3.067477073571487e-01   -3.776506648997044e-01   -1.444964669182347e-01   -2.305189027583941e-01   +1.948659592354199e-01   +1.276031130811567e-03   -8.671472112437366e-02   +1.521668005145825e-01   +3.013664659173864e-01; +3.535722284914232e-02   -7.564672196367586e-02   -7.688402309429006e-02   +4.436923964470669e-01   +7.254220404463008e-02   +1.323018529643682e-01   +2.128758025971157e-01   +4.650283982823453e-02   +2.115860652790616e-02   -1.243769080688916e-01   +1.955022682353033e-01   +2.240145641905815e-01   +6.587324043607397e-02   +1.343887731548594e-02   +7.485308241379314e-02   +1.379387398666791e-01; +1.680550273880234e-01   +1.453105044455049e-01   -1.003202547470986e-01   +3.613049957671746e-02   +2.542574200011622e-01   +2.510670674609616e-01   -2.544884226788747e-02   +3.110667226063270e-01   -3.540306174466880e-01   +6.419709262372458e-02   +5.932731514654748e-02   +2.666946553499896e-02   +3.104039419214050e-01   -6.751688134715865e-02   +2.608470942232671e-02   +2.018008936048406e-01];
L1E_L1I_iGABA_netcon = [+8.234992073558783e-02   -3.223159823503663e-01   +4.785876246423615e-02   +1.464234147815847e-01   -6.259497874073500e-02   +1.129719013992723e-01   +6.288462397701439e-02   +2.373811594594871e-01   -2.113540934547273e-02   -2.754755049660019e-02   -4.979449654922963e-02   +2.896508207495537e-01   -1.630099997636401e-01   -2.680921837749309e-01   +2.178370936020068e-01   +3.021230374997642e-04; +1.206375868202088e-01   -3.896571884188396e-02   +1.073965104874240e-01   +1.916598467570252e-02   +6.560049330292425e-02   +1.617205006562989e-01   -1.507164626365653e-01   -4.035459205384354e-02   +1.652162115740604e-01   +1.614066622236972e-01   -3.863721769297696e-03   +1.715257239454887e-01   +2.146963065320372e-01   -1.155597342810567e-01   +2.476844569201532e-01   -9.415486755680216e-02; -4.749049892331518e-02   -1.041915718224144e-01   +1.428913637771179e-01   -1.214529327728996e-01   -3.027072657954338e-02   +1.670365791785952e-01   +8.248692756569334e-02   -7.623378150691638e-02   +1.790734389906750e-01   -2.172156897814345e-01   +2.214858822449098e-01   +2.270429515915667e-01   +8.863848055806273e-02   -2.388345508859757e-01   -6.856945116654505e-02   -5.483181482981582e-02; +1.790389386802884e-01   -1.453414246094781e-01   -6.956330634029179e-02   -2.043776124443830e-01   -2.772300192446161e-01   +7.460364462908274e-02   +2.775902174744911e-01   -1.116344648499022e-01   +2.339753649930949e-01   -9.543092468999793e-03   -1.470572851199578e-01   -1.081819992968631e-01   -2.810355283803658e-02   +1.119626109915331e-01   +2.832949505553368e-01   -2.199367961348439e-01; -2.762605845906933e-02   +1.898950409298332e-01   +1.554339069891189e-01   -2.220945355896614e-01   -3.029282548649438e-01   -1.565641579414520e-01   -3.782666559142019e-02   -2.703523247125753e-01   -3.621215368920405e-02   +2.428528777426484e-01   -3.250301368161709e-01   -9.438882140381322e-02   +3.083858979821006e-01   -1.809186036101656e-01   -1.508268651913737e-02   -2.490648604873615e-01; -2.393282280967718e-02   -2.864697688078131e-02   +2.896850710709792e-01   -3.152557879176283e-01   +9.515305881535775e-02   +1.536551583872524e-01   +3.472522396282194e-02   -1.257091593361133e-01   -1.185253949600605e-01   +1.945732059812083e-01   +3.582335663157157e-01   -2.195644549661438e-01   +2.065351808494072e-01   +2.713365306814914e-01   -8.773219856103873e-02   +8.282072368469598e-02; +2.661989921585540e-01   +2.997316673871617e-01   +1.310811660533568e-01   -8.918071552546579e-02   +1.594124329231082e-01   +1.546062446158530e-01   +1.166581267880869e-01   -1.888140566056926e-01   -1.689564735395300e-01   +3.435129307709880e-02   +1.080369582506122e-01   +1.649043813302221e-01   -3.020153019973558e-02   -2.672648079509090e-01   +9.888184528900330e-02   -6.994431737067333e-02; -1.164100101774696e-01   -1.284409222699152e-01   +1.581130408659245e-01   +5.109408790920923e-02   -2.313492973317944e-01   +2.587204577986865e-01   +1.906240280404734e-01   -5.698334705271837e-02   +9.401555621901815e-02   -8.627022353487844e-02   +2.093678328001665e-01   -1.887023835270760e-01   -6.271452285011760e-02   +3.855981882796579e-02   -1.388931246058669e-01   +4.365098874523141e-02; -1.638985794187097e-01   -1.642437828293102e-01   +1.823312617912837e-01   -1.140267968512539e-01   -3.332139344465037e-01   -2.027127710689758e-01   +3.109970383408154e-01   -1.839738104244518e-01   -2.175308347055357e-01   -3.676669105476847e-01   -3.620469121120687e-02   -2.186976333610865e-01   +1.192420768697030e-01   -6.638999184876218e-03   +3.470508969165261e-01   -1.789819678817766e-01; +1.980324871345089e-01   -7.620527681225585e-02   +2.376101793215398e-01   -2.087576657137152e-01   -2.216536102969485e-01   -1.671565837173625e-01   +1.763179203565243e-01   +3.940867300764329e-02   -8.659354533768474e-02   +1.671781365742697e-01   -1.112038643106152e-01   -1.751913167875456e-01   -1.082890764497899e-01   +2.774684258231990e-01   -1.087738935424907e-01   -6.468411382108578e-02; +1.987905733357109e-01   -2.853347988792271e-01   +3.543999763378027e-02   -1.145346886283538e-01   -2.117098635098883e-01   +3.353246582360657e-01   +3.272635857718437e-01   -4.124503259704369e-02   +1.444164180884621e-01   +2.755712595863838e-02   -1.442469710739703e-01   +1.290599674891665e-02   +1.272365629441964e-01   +2.148905126888109e-01   -7.441844117623006e-02   -8.345680571989958e-02; -1.952904316626367e-02   +2.503824267177995e-01   -1.208557964450394e-01   +3.015862775778121e-02   +4.595061348179668e-02   +1.424795949238917e-01   +2.587427436963962e-01   +4.691862632944750e-03   +3.018455511760277e-01   +1.387386547384800e-01   +8.212925890648957e-03   -1.500224854878758e-01   -2.246134776976448e-01   -2.195778089335461e-01   +2.401177959415665e-02   +1.600976730072060e-01; -6.448205150959926e-02   -2.979671334597774e-01   +1.740586161791742e-01   +1.263183798470660e-01   -1.047560648270392e-01   -2.399663771603329e-01   +2.993391398616699e-01   -7.052608063790518e-02   +2.898584088959696e-01   +5.764138628346530e-02   +3.107896959598923e-01   +1.740948015928689e-01   +2.992308225681867e-01   +2.022800548643035e-02   -1.621428129874012e-01   -9.580941738004736e-02; +4.213231641848489e-02   +1.381474811820831e-01   +1.458870005502171e-01   -2.424039913978842e-01   +9.253127102167397e-02   -1.542021247106486e-02   -4.859570979251099e-02   +1.424913649084092e-01   -2.362381963351850e-01   +1.810189208842009e-02   +2.108836546557019e-01   -1.199306541281964e-01   +1.441754621189661e-02   -1.851516823331756e-01   +1.055708482610100e-01   -9.880303027350087e-02; +1.725034067897304e-01   +1.372454554461783e-01   +8.210259553515986e-02   -2.560331691783503e-01   -1.226348933723723e-01   +1.001090727986989e-01   +2.677762113810297e-02   +6.348614583830403e-02   +9.049997833383971e-02   -2.302552073013536e-01   +3.235793062253470e-01   +2.076441468376401e-01   +1.213955815071154e-01   +6.209756073457350e-02   +2.832257062348596e-02   +1.450537277666945e-01; +3.321028033950564e-02   -2.761494673165993e-01   -8.088521789336643e-02   +1.547025385053008e-01   -1.805017718676100e-01   +1.164395358242616e-01   -4.049344524131322e-02   +1.584747809268040e-01   +5.846036452836761e-02   +1.591398267823675e-01   +7.936789241343087e-02   +6.138234218004920e-02   +8.430320386880855e-02   -1.737246180825360e-01   +2.257474260704304e-01   +3.317934799308009e-01];
L2I_L1I_iGABA_netcon = [-1.542743025675893e-01   +4.037569296388362e-02   +2.276420376161044e-01   +1.677060674587503e-01   +7.087761052233248e-02   -1.619671538943609e-01   +1.317309158595306e-01   +1.992132769285593e-01; -4.961812655458885e-03   +2.032784514616686e-01   +2.971766497422135e-01   +1.588879536259898e-01   -4.671922603109533e-02   +2.957750614805486e-01   +2.334863572215704e-01   +2.139497374862445e-01; +3.281210200862613e-02   +1.947413209125568e-01   +2.472374483386080e-01   +2.788686232960799e-01   +1.526385298971072e-01   -8.532293366776922e-02   +1.644178021826024e-02   -6.883851595232938e-02; +3.286174583763750e-01   -7.236990165494059e-02   -2.899105924016092e-01   -3.788956451794308e-02   +1.333773001156081e-01   +4.348948285477841e-02   +3.279044830000481e-01   +1.088166406024180e-01; -1.367145518927176e-01   -4.020331648301127e-02   +3.820223860060604e-01   +3.316414144822596e-01   -2.023330731933197e-01   +5.576894460805974e-02   -1.031838341410972e-01   -2.008508789444939e-01; -2.494687435806643e-01   +2.710577703135783e-01   -2.235480140694754e-01   +7.226673255156803e-02   -1.734316085210380e-01   +1.049129168925417e-01   -8.416275112507539e-02   +1.640409726951549e-01; -1.392582419089877e-03   +1.451372126535618e-01   -2.262994121092581e-01   +1.331234981328730e-01   -1.966102452945544e-01   +2.290443267195645e-01   +1.885714433479581e-01   +1.506585153095772e-01; +7.556291224867170e-02   +1.357232657009667e-01   +1.527228639658576e-01   +1.964457448401943e-01   +2.897157902768533e-01   +1.686119809398839e-01   -5.855444878683977e-02   +1.115661497918423e-02; +8.469324138829612e-02   +4.546296755697128e-02   -1.739481872551074e-01   -2.524117917745844e-02   -1.362866541008822e-02   -1.080589500465959e-02   -3.828195054917930e-02   +3.009833124781964e-01; +1.357835101715879e-01   -2.364401765887720e-01   -2.153432588690782e-02   -9.664662605428394e-02   -1.834415736125876e-02   -1.289706181005595e-01   +4.029561377583153e-02   +8.040725448210083e-02; -1.337271689745752e-01   -8.252035572841107e-02   +3.370438551499287e-02   +1.252496131636475e-01   +1.376333850149248e-01   +9.092309893011147e-02   -3.518179731776078e-02   -6.593752757214892e-02; +2.753939042556970e-01   -1.601549893652613e-01   +1.746481328037553e-01   +7.691283912825275e-02   +2.973214169347903e-01   +2.599806604538367e-01   -5.099686034576327e-02   +1.192250726800384e-01; +1.888157491432876e-01   -2.500833430197764e-01   +3.858211756426421e-01   +8.420411582166001e-02   -1.657184360792382e-01   +3.461802181390933e-02   +7.401614691494844e-02   -2.949428408072566e-01; -9.210611251926584e-02   +7.330406845541400e-02   +3.300551250073208e-02   +1.494666032016706e-02   -2.233070927243283e-01   -1.565672407776200e-01   +2.140226629364125e-01   +2.694694391008969e-01; -2.568824251261249e-01   -1.759631141232824e-01   -2.823517869949210e-01   +2.458322384866660e-01   -1.386793052670326e-01   +1.628422199956248e-01   -8.846801662566699e-02   +1.970256034762634e-02; +1.444119845898242e-01   -1.400456008051437e-02   -8.076587352862966e-02   -9.299178088149732e-02   +2.460319893583930e-03   +4.763390460646875e-02   +3.290600547709064e-01   +2.434241862518635e-01];
L1I_L2I_iGABA_netcon = [+3.984061732513081e-02   +3.123782126141755e-01   -8.358282569221219e-02   +1.403237868809276e-01   -9.442827269824335e-02   +1.062059105079877e-02   -1.827210254172872e-01   +3.258479337112449e-02   +4.090134739980241e-02   -2.225953044444980e-01   +1.291897345660546e-01   +2.846073921032803e-01   -2.128730676101147e-01   -5.105029325716876e-02   -2.438628086712456e-01   +1.503539437128951e-01; -1.421604396443821e-01   +4.910514469929751e-02   +1.850087448931130e-01   +3.273569928074129e-01   -2.171812846107011e-01   -2.907000538241731e-01   -1.617839337355761e-01   +1.059525117887138e-01   +2.488635342942290e-01   -1.810740454609257e-02   +3.335212685984153e-02   -8.775241727016020e-03   -4.763805896703061e-02   -1.619506069984163e-02   +1.466830180408572e-01   +2.298105143351273e-01; -2.643622067381680e-01   +2.179286068156648e-02   +7.395786923664709e-02   -1.253757115399337e-01   -1.924947768560938e-01   -9.568616888136276e-02   -8.166418812143236e-03   -9.650528740735036e-02   -4.618411093403747e-02   +8.724037107255908e-02   +6.713704337330230e-02   +1.021617252558437e-02   -1.009146782449158e-02   +2.886647364506039e-01   +3.420499330238677e-02   +2.941033865462866e-01; +2.557952360681010e-01   -2.029940222013257e-01   -2.610730970996665e-01   -2.487075417722119e-02   +9.184291352962505e-03   +2.334861716107487e-01   +5.287794678905111e-04   +3.770698798439926e-01   +4.847793946230111e-02   -4.505866281568890e-03   +2.863390538089966e-02   -9.356125902601278e-02   -1.198478024640635e-01   +5.119861846096718e-02   -1.785057831679656e-01   -4.742845080143367e-02; +2.095631353743582e-01   +3.372903774418378e-01   +2.834975582665216e-01   +1.052554975638431e-02   -6.150227818647803e-02   +1.459182044122974e-01   +1.346931300713813e-01   +3.022848166064517e-02   +2.672336357723031e-01   -1.098953542437306e-01   +6.804762795351590e-02   -3.400722704516949e-02   -1.008126800167088e-01   +1.154506902278751e-01   -8.880717720853595e-02   -3.416241758419598e-02; -9.645465752843313e-02   -1.539383226462955e-01   -1.827187987983059e-02   +7.386325365914931e-02   +9.376143489462486e-02   +1.326657150342894e-01   -1.558821687283644e-01   -6.297794106407697e-03   +3.183644336696288e-01   +9.034044491597100e-02   -5.291136661896693e-02   +9.533423774327858e-02   +4.927223464064603e-02   +2.011791992871749e-01   +1.147985268568405e-01   +6.808440425663932e-02; -1.274369905576928e-01   +1.837273357210398e-01   -4.999747346890081e-02   +2.102427245858254e-03   -2.978505602663770e-02   +1.665946502697709e-01   +3.230837266405120e-02   +2.415795324693885e-01   -2.538934520051466e-02   -6.566274434321823e-02   +1.100053470825612e-01   +2.706286415877227e-02   -8.875311253109266e-02   +3.002445999040453e-01   -1.352135401398318e-01   -1.616374920310318e-01; +1.130581341701763e-01   +2.011590126462981e-01   +1.865964614332781e-01   +1.574807791679430e-01   -2.040176907706009e-01   -2.177532271547598e-01   -6.284773788813269e-02   +6.388178826158711e-02   -2.664955616828599e-02   +2.484102928911537e-01   -2.571573455066364e-01   -1.025643410650069e-01   -1.355869604202383e-01   -1.215887402144733e-01   +1.254327881505075e-01   +2.281155016922988e-01];
L2E_L1E_iAMPA_netcon = [-2.580456829689004e-01   +3.719469666897479e-01   +2.493811321419166e-01   +9.621658435029341e-02   +1.052852651560452e-01   +1.640993905137970e-01   +3.180693900789739e-01   +2.219811856194528e-02; +2.115258173151611e-01   +1.906963322531576e-02   +1.423112725271398e-01   -1.723576421324916e-02   +1.244885873644303e-01   +6.764087817046005e-02   +9.798967786639338e-02   -1.899623974654127e-02; -3.039073268511195e-01   +2.334235027890386e-01   +5.288582908358597e-02   +2.647561883095965e-01   +2.937335444305477e-01   -2.002168734310822e-01   +2.859911721904935e-02   +1.550956711907639e-01; -4.320299215262155e-02   +2.186790375468950e-01   -1.570288853575159e-01   +2.397208686451685e-01   +1.603790844511929e-01   -2.070904825282153e-02   +1.314262346594927e-01   -1.196844719569136e-02; -1.628003895486894e-01   +2.856113944372298e-02   -2.158373476647745e-01   -4.547037044109706e-02   -5.990369270704038e-04   -1.287141868796866e-01   +4.574323875574132e-02   +1.417952363452040e-01; +2.739830475341710e-01   -1.318792596385545e-01   -6.873773602626920e-03   -7.060908091350745e-02   +1.389254422221998e-01   +4.842760975388519e-02   +3.033514762403764e-01   -7.391562483203967e-02; +2.295480795562904e-01   -1.899026469209118e-01   +8.454081231124791e-02   -9.029228169521801e-02   +1.426965473947539e-01   +3.633264940773884e-01   -2.433417511380926e-02   +8.123270946744766e-02; +3.315150768696182e-01   +2.735274679042107e-02   +1.147328491928303e-01   +1.270542768262972e-01   -1.164313085627292e-01   -1.836531627637192e-01   +1.800295925779889e-01   -3.626020482112544e-01; -1.083764837072329e-01   -2.883190974356392e-01   -1.181139746037686e-01   -1.520209951061376e-02   -1.537311644841146e-01   -1.647749588293658e-01   -3.298843491941778e-01   -4.726213708906823e-02; -1.604392261576416e-01   +4.052887850230725e-01   +1.769752158088974e-01   -4.488436296604841e-02   -7.578959869024324e-02   -1.121040699089305e-01   -2.370292786164672e-01   -1.278414259141499e-01; +4.841881897106799e-02   +1.822044131858791e-01   -1.955006109218885e-01   -2.642928091867764e-01   +1.754331053523067e-01   -1.777710337452264e-02   +2.402685723166015e-01   -2.505850812931981e-01; -7.534359651186606e-02   -9.717819618702342e-02   +1.424168866328150e-01   +6.188020264969826e-02   -2.122084132999847e-02   +1.752139783462629e-01   +3.267528188788933e-01   -1.618242283039967e-01; -1.245444490105835e-01   -1.165675246035239e-02   +9.476196997010025e-02   -5.070020453794195e-02   -2.254867465263457e-01   -2.694854483470789e-02   +1.209540296548075e-01   -1.182173102329249e-01; -1.056340600853019e-01   -1.524701207664969e-01   +1.826275088733617e-01   -7.562225142070446e-02   +1.379184293102569e-01   +2.022804103558921e-01   -2.366776339423977e-01   +1.262601049465104e-01; -9.238339297673767e-02   -8.692455534614256e-02   +1.126848785089879e-01   +8.558867542788333e-02   +1.926056871471454e-01   +6.258157287335309e-02   +6.528226795223359e-02   +1.458109960173791e-01; -1.008476737193438e-01   +2.538651779062640e-01   -8.226539353446116e-02   -1.795318313863556e-01   -1.831873949577873e-01   +8.172852241297011e-03   +6.884352150721891e-02   -2.428922407598354e-01];
L1E_L2E_iAMPA_netcon = [-1.152929286360765e-01   +1.389439904136285e-01   +1.889594843748514e-01   -3.179013380842996e-01   +1.469430056567847e-01   +9.768341728658993e-02   -1.326740722217804e-01   -3.496106800938918e-01   +3.428202244666703e-01   +3.386037639301506e-01   -1.110814387727551e-01   +2.460083065757531e-01   +3.672933587359960e-01   -1.220042438843639e-01   +4.062172788850944e-03   -4.778881567966944e-02; +6.458262462328543e-02   +2.152892301697159e-01   -2.891403689352369e-01   +6.195158489604177e-02   +1.325840540711851e-01   -9.252753113758991e-03   -1.206755951434665e-01   +6.736796850466338e-02   -2.146563830453008e-02   +1.621335446981403e-02   +9.773474065335921e-03   -6.750843867951208e-02   -1.582562306534061e-01   -1.129870602619161e-01   -2.192851252483821e-03   +2.889550418956984e-02; +1.739965714934775e-01   +2.666738022481607e-01   +1.858945997279478e-01   +1.098278950611957e-01   -3.596701480959037e-02   +1.302455607508309e-01   -1.770940346222645e-01   +1.405250659541285e-01   -2.645986799426789e-01   -6.605571009125971e-02   +1.899234987487626e-01   +9.664887758005583e-02   +1.112899631649511e-01   +2.754394745952745e-01   +2.898883365107794e-01   +1.767009637065315e-02; +7.767201811050603e-02   -3.181035329643945e-01   -1.057575578253410e-01   -5.974163712005959e-02   +2.306632156724127e-01   +9.783651923076089e-02   -2.181334187491440e-01   +1.157037471837136e-01   -3.419818617409917e-02   -3.303140615402132e-02   -2.733713335320008e-01   -8.556643239233343e-02   -5.900662653388791e-02   -8.983381238635607e-02   +2.863958663757082e-01   +3.713325610379653e-03; -2.511167409359585e-01   +1.074232167385122e-01   -4.334255281859201e-02   -1.269274971032181e-01   +1.273981479783729e-01   +1.441456586888032e-01   +7.068145995980142e-02   -8.509612599314553e-02   -2.504963505529848e-01   +2.498375760618506e-01   +8.380556458823100e-02   +2.483512660188972e-01   +9.459182982689728e-02   +1.222182411016939e-01   +1.903898384853162e-02   +2.323333161536926e-02; +1.130353819605857e-01   +2.534234063545842e-02   +1.864100300741241e-01   -1.102351310550644e-01   -1.161350103564134e-01   -1.589537442268301e-01   -1.328611739025587e-01   +2.151766273922623e-01   +2.461131595773324e-01   +5.388900049738996e-02   -1.275192202981298e-01   +1.224319382772772e-01   -1.438685601435166e-01   -2.239592112453244e-01   +6.695676897128783e-02   -8.804765877077385e-02; +1.940192557602638e-01   +1.760581087265563e-01   +1.726804770900096e-01   +7.982626286481473e-02   +2.872559803158375e-01   +9.082864131228710e-02   +2.659114072183483e-01   +2.546506323364777e-01   +1.961902541777053e-01   +4.261233638469449e-02   +7.729396103236080e-02   +3.443953479760731e-03   +1.482008476718499e-01   -3.120805648047777e-01   +3.208577665701853e-01   -3.331951657641569e-01; +1.827410230445985e-01   -4.871418687192319e-04   +7.982177497323570e-02   -1.358739398691265e-02   +1.409289229034183e-01   +1.606751897013941e-01   +2.008799324561172e-01   -3.189900609094720e-01   +1.515865854878434e-01   +2.551014023416108e-01   -1.235559792103604e-01   +2.419248787799676e-02   +2.207167225934375e-01   +1.716032224444869e-01   +1.559831354465238e-01   -3.022978076712860e-02];
L2I_L2E_iAMPA_netcon = [+1.632086058483785e-01   +2.040435539155314e-01   +2.557439775784297e-01   -1.458385889367530e-01   -1.232301964849577e-01   +2.045041164340485e-01   -2.194644860426551e-01   +1.738416524355783e-01; +2.217700344873101e-02   +1.463932831377141e-01   +2.592623778029363e-01   +1.360903661596473e-01   -2.773920181946013e-03   +1.482520534445350e-03   +3.193940186215700e-01   -2.938514265936117e-02; +1.218092936614816e-01   +1.517289051003687e-01   +9.793614554124509e-02   +3.102435737308701e-02   +6.563734923216551e-02   -1.324186605779548e-01   +2.000720890328654e-01   +3.203845607613352e-02; -2.079991404626986e-01   -1.679974334422935e-01   +9.135652501823735e-02   +2.756850799356285e-01   +3.781203433417140e-01   -7.788408801326573e-02   -8.849536858657678e-02   -1.506987770010755e-01; +1.219967259973831e-01   -2.650649891027029e-01   +2.094952411388848e-01   +6.774445832855247e-03   -1.309747951709558e-01   +5.258935426565355e-02   +1.848809105574543e-01   +1.034461279762513e-01; -1.532392297084222e-01   -1.020616810214336e-01   -1.473300026278749e-01   +1.542917825459864e-01   -8.021047949447156e-02   -1.370070236650970e-01   +6.199077462189320e-02   +6.061134238891035e-02; +1.955705791051517e-01   +1.328196314313473e-01   +8.971035353215590e-02   +2.551651372505061e-02   -2.132017088588320e-02   +7.594230838819591e-02   -4.080986555573170e-02   +3.506485649075872e-01; +3.015114439855895e-02   -3.174635556487387e-01   +1.919792045414309e-01   -3.318362512195816e-02   +3.326929436869993e-01   +1.313236660755107e-01   +3.789014472618447e-01   -1.361855775398761e-01];
L2E_L2I_iGABA_netcon = [-1.420334627086652e-01   +1.949120132846079e-02   -1.348401749728998e-01   -1.312638941930880e-01   -2.682035847620049e-02   +3.630596095090703e-01   +1.589937200088428e-01   +9.971740137559440e-02; -2.555134410568085e-01   +1.389702612699134e-01   -9.305624786535535e-02   +1.843953462073573e-01   -1.522475676860505e-02   +2.492645380806041e-01   +2.005573600009196e-01   -1.557025819288834e-01; +1.614851222104255e-01   +2.538260567343232e-01   -3.625210199944244e-02   +2.229742174361413e-01   -1.655884946402563e-01   -7.150465476239026e-02   +4.284058215779693e-02   +1.318615925751356e-01; +8.576506930959621e-02   +1.472457930618698e-02   +8.648634144489073e-02   -1.198245989659830e-02   +1.986597611296465e-01   +1.830430701021468e-01   +3.487598819820881e-02   +1.372608225192988e-01; +3.284030716354874e-01   +2.032827698578980e-01   +4.248264542150617e-02   +8.341970430886825e-02   -1.041666547714082e-01   +1.309072194407759e-01   -3.317607822454272e-03   -1.602732561559255e-01; +1.101998932644547e-02   -2.611476659483358e-01   -1.595610950655639e-01   -1.767217000635413e-02   -2.253510015874914e-01   +4.243453817481077e-02   +1.875531724812050e-01   +6.365030166766598e-02; +2.025785924383808e-01   -3.551653206018851e-01   +1.430722700190042e-01   +1.302096966574829e-01   -8.947807952891015e-02   +2.176540789001480e-01   -2.155922643520844e-01   -2.531268829522705e-01; -2.128314890718674e-01   +1.268451033124396e-01   +4.335890050264629e-02   -1.523135936192457e-01   -1.800106983414980e-01   -2.726446348595775e-01   +3.116009794082107e-01   +5.303270396762692e-02];
L3E_L2E_iAMPA_netcon = [-1.080671986423071e-02   -3.293170584707843e-02   -5.776440401483420e-02   -7.993368917564975e-02   +1.940175083778262e-01   +1.143387278466338e-01   +1.617740825517373e-01   -2.358144696121279e-01   +2.888554379673330e-01   -3.222843495304020e-01   -2.661796089178659e-01   -2.207425449220417e-01; +1.997650928279103e-01   +7.569342675955623e-02   +3.081877177795057e-01   -4.147290557660767e-02   -1.690787424229202e-02   +2.752100834735590e-01   +8.215509576056018e-02   -1.041745036613961e-01   +2.819536108846580e-01   -1.047847701633673e-01   -5.146325465644917e-02   -5.558302163659667e-02; -1.089787917922091e-01   +1.068066142621036e-01   -6.514784782434953e-03   +1.965103165404601e-02   +4.484628520474573e-02   -3.078441542487823e-01   +2.721907672573978e-03   -1.225634667852712e-01   -3.381803573602800e-01   +1.375576289938529e-01   -1.417703706222181e-01   -9.343866355395544e-02; -3.423419508066549e-01   -1.380566379380172e-01   +3.602806993617896e-02   -5.284066402462059e-02   +1.856585589362724e-01   -3.283231827730456e-01   +4.466208912723910e-02   -1.777987138083870e-01   +5.109370672075420e-02   -8.462853063022477e-02   -2.182894396022093e-01   +1.569045830431106e-01; +4.180080882787010e-02   -4.832601980674624e-02   +3.426496108289728e-01   -2.599936659482215e-02   -1.916291823050032e-01   +1.941074567979221e-01   +1.227624125390976e-01   +1.743034646079590e-01   +3.301184457708061e-01   +1.396540858318005e-01   +1.589955610131907e-02   +1.643146582381791e-01; +1.205073332868223e-01   +7.840578096615994e-03   -7.348679207796398e-02   +2.315231315854936e-01   -2.004843778211558e-01   +1.380489997259543e-01   +1.119959318671996e-01   +1.530523850684630e-02   -3.242781073278803e-01   -2.538692087318038e-01   -6.488997233946449e-02   -3.939009338831138e-02; -2.482913845061276e-02   +8.030005417117231e-02   -8.977502826687246e-02   -9.350534663059853e-02   -9.028467650332657e-02   +5.644158122907879e-02   +1.393135034321626e-01   -1.157752883195917e-01   +1.238804939354075e-01   -3.811741803234162e-02   +2.025466095502286e-01   +3.159268374243414e-02; -1.115452056914502e-02   +8.390115304612301e-02   +5.935476643683799e-02   +1.851830561582822e-01   -6.405058709048121e-02   -8.375614874288513e-02   -1.878444735139214e-01   -1.194726454242276e-02   -1.130238535605332e-02   -1.424342689571848e-01   +3.213288501024054e-01   -3.267096930967137e-02];
L3I_L2I_iGABA_netcon = [-2.068526113701173e-01   -1.524278900974951e-02   +1.466866647885293e-01   +2.697469029588923e-01   -5.255629275499463e-02   +1.023137587176159e-01   +4.622324953690149e-02   +1.491961651399766e-02   -1.125302730219112e-01   -7.320512353675748e-02   +1.774186598687045e-01   +1.034952407881986e-01; -7.651040836225650e-02   -2.066392876527592e-01   +2.802137999037765e-01   +7.015861302225161e-02   -2.782468192803030e-01   -1.684012578228358e-01   -1.019136358571182e-01   +2.302896881452772e-01   -2.737034742560442e-01   -1.592306473042202e-01   -2.079049930022167e-02   -7.976868831678269e-02; +2.261868930985215e-01   +1.942676976569032e-01   +1.196980657015694e-01   +1.893001002042997e-01   +1.912539722611406e-01   +2.489315660665740e-01   -3.611083945380941e-03   -6.917953795962710e-02   -2.301661629986478e-01   +7.989459516807410e-02   -1.426084000917830e-01   -6.685438960778092e-02; +2.427161034693242e-01   +6.727591164729667e-02   -1.652862077736536e-01   -1.602607040577271e-01   +6.587819640882575e-02   -1.037569506129922e-01   +4.466230475096331e-02   -1.029570071689884e-01   +2.595108079954794e-01   -1.547428216585974e-01   -2.952990795105509e-02   -1.919301060778396e-01; -1.990926422368394e-01   +1.040958331141826e-01   +9.686217812825763e-02   +9.755492905313198e-02   -1.877637734147906e-01   +2.219644441114619e-02   -6.388640123982270e-02   +2.960287743599661e-01   +2.123546947135723e-01   -2.325585202887332e-01   +3.094556418918483e-01   +1.447635146676681e-02; -1.856741153733207e-01   +4.683356641335738e-02   +1.376674763981445e-01   -2.808776798961803e-01   -3.013946157342151e-01   +2.742314344647661e-01   +3.154573867773833e-02   +7.983422499327693e-02   -1.044739514862821e-01   -1.627972169238848e-01   +1.473384041969583e-01   -2.055360270754884e-01; +1.215235300045750e-02   +1.003419087706533e-01   +7.019114382544950e-02   -5.170755077344460e-02   -1.198098422443579e-01   +6.018308553344348e-02   -1.066062699235500e-01   +2.063546530873078e-01   +1.663709731041871e-01   -4.922588012116716e-02   -2.783075247015411e-02   -3.996966002555589e-02; +1.532997444284355e-01   +1.802583930389900e-01   -3.668423073245363e-01   +1.969893225384094e-01   -1.783387977339436e-03   +2.492790837936419e-01   -1.499487055112662e-01   +6.769881728330551e-02   +2.238801418430028e-01   +3.121717429222708e-02   -2.497196128648825e-01   +1.667738942148118e-01];
L2E_L3E_iAMPA_netcon = [-1.133769675024046e-01   -1.242332601146683e-01   -6.977286515603331e-02   +3.016420612218111e-01   +3.974555858573660e-02   +1.837407214396874e-02   -8.245711927334501e-02   -6.946161885363036e-02; -2.511325494012234e-01   +2.704330478603203e-01   +8.257491033242703e-02   +2.779081752597461e-01   +1.786084620997634e-01   +4.895863502553138e-02   -1.534211171328616e-01   +1.864692112277992e-01; +1.684584751988625e-01   -3.998765252096517e-02   -3.424005267235166e-01   +1.212139418987914e-01   -1.227940463299541e-01   -2.743115632230547e-01   -3.264779476479339e-02   +1.475712104165337e-01; -8.650184559000203e-02   -5.040000984625296e-02   -1.238398458628545e-01   -2.556574191903921e-02   +2.966048496879575e-01   +2.493203588020967e-01   -1.689990068096361e-01   +1.236682440731196e-01; +1.172493038282569e-01   -2.008729647723467e-01   +2.494674142891942e-01   -7.141510000395279e-02   +2.706458575925496e-02   -6.212239481186616e-02   +1.996014230495155e-01   +2.663715843571525e-01; +1.846242406211979e-01   -2.002181543356141e-01   +1.566998888541493e-01   +4.692832900119179e-02   -1.119956213615958e-01   +7.722943397586006e-02   -2.680563666149256e-01   +1.970208617776904e-01; -1.773313743024525e-01   -9.652314127023415e-02   +2.066571698493408e-01   -3.465013298469131e-01   -1.461340728740840e-01   -1.123855421934546e-01   +2.535463426853167e-01   -1.685120363516120e-01; +1.250011617766988e-01   -9.220356880743011e-02   +1.505741875640490e-02   -2.602824087902725e-02   +2.467817339617468e-01   -3.120116180029352e-02   -4.854591653227621e-02   +8.056126005274958e-02; +6.590088879462286e-02   +1.066854957168709e-02   -1.606606173811099e-01   -1.159011216572888e-01   -1.708712815773589e-01   -7.844626199104362e-03   -1.004927712488285e-01   -2.184695013642074e-01; -1.097852522591424e-01   -4.492121673615863e-03   +2.324554377435482e-01   -3.058727258758839e-01   -9.265695253585324e-03   -8.971350456952987e-02   +4.340157289086873e-02   +9.271969434757063e-02; -2.154258980274791e-01   -5.093252826716594e-02   +2.221055555929610e-01   -9.916845261013640e-02   +7.522769762816368e-02   +1.917460473478481e-01   +2.645476646548555e-03   +2.357614954151336e-01; -1.456882036344299e-03   -6.343718745011051e-03   +8.719364493657508e-02   -7.365840368747606e-02   -1.068578952756006e-01   +1.415728482096988e-01   -3.038817798170095e-01   +1.545352218092260e-01];
L2I_L3I_iGABA_netcon = [+5.350054654518570e-02   +9.584877213866483e-02   +4.910355261039490e-02   +2.903233968767063e-01   +2.414635252894269e-02   -2.733992311051525e-01   +1.702669465070249e-01   +8.778445785811564e-02; +1.389284321208785e-01   -1.212436537570377e-01   +2.087851295959479e-01   -2.371367698230460e-01   +1.981742622995943e-01   +2.910995532404366e-01   -9.445762349940497e-03   -1.054906409733257e-01; -4.090330423445926e-02   -5.891338564582239e-02   -6.874548519119730e-02   -1.500063395779292e-01   +1.731506090863866e-01   +1.291633073788188e-01   +1.056256378767768e-01   +4.748702309727985e-02; -2.133917612642459e-01   -1.899862315248919e-01   +3.807412016578814e-02   +1.779303840309850e-01   -2.788058653762815e-02   +5.315555314679900e-02   +2.842485355351572e-01   +1.150904782820023e-01; -1.810589273215640e-01   -1.765997505454912e-01   -5.743575713784344e-02   +1.676880478450489e-01   +6.090906593763466e-02   +6.499627810613820e-03   +1.531735950968373e-01   +1.269362403549767e-02; +2.740316444053839e-01   +1.104660903021141e-01   -1.218036635365647e-01   -1.762780140283716e-02   -3.276071996013930e-02   -1.950919621484333e-01   +8.909704221250496e-02   -3.027172764647615e-02; -5.223955250640605e-02   -1.393599344506927e-01   +1.989970388611641e-01   +2.135738934510225e-01   -7.226199722587000e-02   -2.511418956400215e-01   +2.456515580390221e-02   -1.837328750435640e-01; +4.474978099177560e-04   -1.234527182680657e-01   -1.168989532273898e-02   -1.223393604141551e-01   -2.401075361489904e-01   +1.397069777247824e-01   -1.327363014967796e-01   +1.209064980789419e-01; +1.811181310132787e-01   -2.063979478606512e-01   +1.427215861476386e-03   +2.975175725133142e-01   +5.092997882597328e-02   -4.533574896646552e-02   +5.202774468633983e-02   +1.916342882021642e-01; -4.328809681847486e-02   +1.404076871441592e-01   +2.697265673213667e-01   +6.287328988370748e-02   +6.692604595115696e-02   +1.940353608809440e-01   +1.727673350833125e-01   -6.833431623080093e-02; -1.485745055127936e-01   -2.708587052874109e-01   -2.200226308092808e-01   +2.228374658463372e-01   +8.677029459069027e-02   +2.003825506760154e-01   -1.920258929214920e-01   +2.549144199297904e-01; -2.117809224214681e-01   -2.222252186450860e-01   +2.143554750664622e-01   +1.630902518032900e-01   +8.702673582736377e-02   +9.778598560865608e-02   +2.666506581236039e-01   -3.120057897366469e-01];
L3I_L3E_iAMPA_netcon = [+2.163173283012178e-01   -1.632641322678851e-01   -2.611774639328531e-01   +1.684752677644193e-01   -3.802906038856484e-01   +3.683153563923269e-02   +7.656298217601479e-02   -1.028677810796604e-01   -7.021396618922254e-02   +6.388963894432889e-02   -3.771898422700468e-03   -6.610043244533674e-02; +3.982005851407545e-02   -1.637203771008742e-01   +2.004676428169611e-01   +1.180154581139557e-01   +8.868546464675292e-02   -2.214707527696871e-01   -2.133503307931932e-01   -2.016061237532905e-01   -4.656941512501123e-02   +2.017846833792855e-01   +3.181840080855129e-01   -3.384331229362806e-01; -7.361101877215262e-02   +1.258863196608487e-01   -7.356387842949455e-02   +2.768542753599864e-01   -1.274150764861255e-01   +1.085586191526501e-01   +1.850920914457057e-01   +3.579090952216885e-01   +2.283774252151752e-01   +1.702687495376327e-01   -1.844306151322390e-01   -4.882193441569155e-02; +1.345150163188536e-01   +9.667683906671019e-03   +1.428009409118950e-01   -4.220532308623186e-02   +1.032760728819724e-01   +2.712785207782677e-02   +1.067946439441095e-01   -1.068101207134020e-01   +2.068091309135399e-01   +8.741195333325302e-02   +1.810195710334063e-01   +2.932666947819872e-01; -3.254063272454016e-02   +1.067377782789853e-01   +2.061679519987313e-01   +1.670010472390070e-02   +1.625950435829240e-01   +1.652475947109328e-01   +2.670281734405677e-01   +3.136460532628061e-01   +3.050712284084205e-01   +1.990849529187611e-01   +8.737724457858390e-02   -4.132417591921857e-02; +2.339463523452731e-01   -6.022343903288482e-02   +2.375494490694798e-01   -2.310572992990626e-01   +5.593521242791830e-02   -1.312011434964974e-01   +2.611829178238877e-01   +7.988093238276628e-02   +5.487002645417391e-02   +2.833858904395263e-02   +1.576644464086692e-01   +1.887656280510716e-01; +3.154592094559501e-01   -2.509896008124424e-01   +2.219723235804719e-01   +2.290752241299343e-01   +2.561859546804797e-01   -2.399921970844491e-01   +3.343185906557983e-01   +4.910376581236005e-02   +8.101365054942515e-03   -3.303743356019669e-02   -2.843704068619216e-01   -2.044793638616794e-01; -1.432304913138263e-02   +2.362567259089690e-01   +2.961150493663264e-01   +1.994625705701730e-01   -2.585267727124523e-01   -8.698209128711340e-03   +1.175313408681245e-01   -2.453193813046070e-01   +7.880336255002159e-02   -1.469160859409479e-01   +2.518533471940613e-01   -2.114945203452316e-01; +3.871066692018212e-01   -1.797200370604299e-01   -1.726272766499027e-01   -1.541572725226799e-02   +3.650624754043258e-01   +8.832757793200205e-02   -2.487623094424765e-01   -2.421393938531453e-01   -1.857237450413685e-02   +2.448360858864740e-01   +2.001327248196632e-01   -1.773215108147543e-01; +6.935479066293321e-02   +4.921823619832613e-02   +1.318827857945649e-01   +1.040638889662068e-01   +1.230541159861399e-01   +5.779793663003630e-03   -2.486147993436725e-01   +1.079427623633751e-01   -2.605533174420678e-01   -1.764405128910316e-01   -4.837940229829284e-02   -2.586805946850641e-02; -7.185203609624177e-02   +8.051750483254266e-03   +1.460655180747975e-02   -1.581258456792143e-01   +1.125406393720837e-01   -1.298447064214163e-01   -4.438612856932792e-02   -2.374732729584177e-02   -6.385119662070972e-02   +2.257676623722356e-01   -1.678708928095479e-02   -2.109697680493918e-01; -2.085835165702241e-01   +1.907809637586429e-02   +3.900084593541048e-02   +5.475552724723851e-02   -4.014680840495133e-02   +2.476047190103717e-02   -8.818069212776453e-02   -2.135243179825554e-01   +2.296915366114213e-02   +1.671090288798278e-01   +5.878550140902459e-03   +1.233898943993745e-01];
L3E_L3I_iGABA_netcon = [+1.852449017348760e-01   -3.129430302407181e-01   -8.775708699391841e-03   -4.648273903731009e-02   -2.892835382952394e-01   +4.439569880711718e-02   -1.303304615623004e-01   -6.498325902555810e-02   +3.340941939795914e-01   -1.450363472696417e-01   -2.482621537064061e-01   -6.388898142203106e-02; +2.672089689681199e-01   -2.342438071862589e-01   +2.984508912820037e-01   +9.655026470245712e-02   +1.280131993421703e-01   -1.629775816993662e-01   +2.394650597604695e-01   -4.084973635874567e-03   +8.772283491918428e-02   +1.322711778180863e-01   +1.287851880997860e-01   +8.506937829002031e-02; -2.108019897823100e-02   -3.597452286456900e-02   -4.372436733827158e-02   +6.681972411401393e-03   +1.869187000328180e-01   +1.086073963681646e-01   -8.139238549239973e-02   -1.640609942761887e-01   -1.446156875941035e-01   -3.350743662282626e-02   -4.239418420641940e-02   +5.018700533059897e-02; -2.385003849923590e-01   -2.051286570412019e-01   -1.126729248963578e-01   +1.736781717077661e-02   -8.307717819192131e-02   +3.915270201717819e-02   +1.361838826887927e-01   -2.318567595322403e-01   -1.451200632167706e-02   +2.486156114533830e-02   +2.089329395082695e-01   -1.296511607612121e-01; -2.057335087562763e-02   +9.558539761114471e-02   +2.563649936327338e-02   -6.839078880398333e-02   -2.575221831184906e-01   -4.508050155354357e-02   -7.755714568379524e-02   -2.874378198581194e-02   -2.059302677462123e-02   +1.438386836753124e-01   +1.283589716752540e-02   -3.606019457382857e-01; -1.977357776304261e-01   -2.593469092711500e-01   +1.123480379946857e-01   -6.275874671893579e-02   +2.457422972111230e-01   -6.163710909908870e-02   +6.808441344313290e-02   -1.282029578862088e-01   -1.156363704333988e-01   -1.522652900419843e-01   +5.623717569540988e-02   +1.311925058022031e-01; -1.418472706670978e-02   -1.076664389923826e-01   +2.522771023477955e-01   -3.413723510389182e-01   +2.147697864789652e-02   +7.888531565300186e-02   +2.302400773757214e-01   -5.422342524360475e-02   +8.053613266549522e-02   +2.234856805592066e-01   +4.628038645408511e-02   +1.653517082366025e-01; +8.786892195851381e-02   +6.283063902322429e-02   -1.816560995166087e-01   +2.168638467706148e-01   -8.207658027100757e-02   +3.197234599787389e-01   -9.667658866848881e-02   +1.647977746890485e-01   -2.348979482544692e-01   -1.727488529092705e-01   -1.808345936371657e-01   +1.377244719353509e-01; -2.210263109880752e-01   +1.286690918588376e-01   -4.381153197407361e-02   +4.429408840832149e-02   +1.520604419259051e-01   +3.276196424780955e-01   -1.006702098891118e-01   -1.568107824386359e-01   +2.381802154013886e-01   +1.618384329805543e-01   -4.015835949045647e-02   +5.833320747890529e-02; +1.143439071426720e-01   +1.274215915171070e-01   +9.054614167021081e-02   -6.268358942064639e-02   +9.167955451253946e-03   +6.490056245397467e-03   +3.422991311835857e-02   -2.247943013129299e-01   -5.248891202088501e-02   -6.876357670669078e-02   -1.675385118087784e-01   +2.793084847163548e-01; +3.399739583819391e-01   -6.817482923255874e-02   -3.247702339304513e-01   -1.443474802182021e-01   -6.616692009829946e-02   -2.944794568652478e-01   +4.008900435500016e-02   -3.000103115702532e-01   -1.380941774508965e-01   +2.050339985803205e-01   +1.299376440309044e-01   +1.325842584891169e-01; -1.252065384987944e-02   -7.914544696074954e-02   -4.869945711765310e-02   +5.010221130535532e-02   -7.495820615468851e-02   -3.435057032296245e-02   -4.451079513311751e-02   -1.128122637436559e-01   +2.069872511603062e-02   +2.301244724873822e-03   -9.990289622585630e-02   -2.279462741015980e-02];
L2E_Input1_iAMPA_netcon = [-1.598924408179260e-01   -2.718325290950570e-01   -1.350452993368625e-02   +2.866494834185798e-01   -4.932365940305023e-02   +1.989100811301679e-01   -8.356413105716949e-03   -3.453186977132428e-01];
L2I_Input2_iAMPA_netcon = [+8.536776185052669e-02   +9.362148719777544e-02   +7.335577104884175e-02   +1.640732519355485e-02   -1.136394689409211e-01   +9.744415899156160e-02   -3.111733640025811e-01   +1.505303430211636e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
