function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.170631268856080e-01   +1.782407431898787e-01   -2.643543360285423e-02   +2.494000415385599e-01   +4.529187474173098e-01   +3.331313536630462e-01   +3.739409642197890e-01   +4.880851480754481e-02   +3.135959934896743e-02   -3.662114715929358e-03   +3.870084429840286e-01   +1.322139223374917e-01   +3.919665206835122e-01   +4.499732124782956e-01   +1.798774571029489e-01   +2.725418885956996e-01; +3.572790493418156e-01   +2.442284577776580e-01   +2.287425981991763e-01   +3.606355110038175e-01   +1.851606099253368e-01   +2.043998547625550e-01   +3.388031637869642e-01   +1.056798612416592e-01   +3.119596020723113e-02   +3.148954714444672e-02   +8.210663711084691e-02   +1.975270849358803e-01   -1.294675239699388e-01   +4.464673535789866e-01   +1.317605512621539e-01   +3.506305629331874e-01; +2.978431363748821e-01   +6.888385960971431e-02   +4.462271545721978e-01   +2.624614156189005e-01   +2.626470680913818e-01   +1.617322818945790e-01   +4.537569894744838e-01   +1.113630242803544e-01   +1.801934787856017e-01   +2.918481272004828e-02   +1.752478277807456e-01   +5.497480927706049e-01   +2.370641102179619e-01   +1.000969628419190e-01   +3.198897772613747e-01   +9.370391404907266e-02; +2.269036758761364e-01   +2.898518900766238e-01   +4.192823661719234e-02   +2.320163186914000e-01   +6.586567082910538e-02   +3.353646709312037e-01   +3.126220727402220e-01   +3.081517285515826e-01   +4.548839472983752e-01   +8.253727453614230e-02   +2.368659878285640e-01   +2.212243309180682e-01   +4.744235122649432e-01   +2.963395907427914e-01   +1.122537577381074e-02   +1.799310604443533e-01; +1.092833328592256e-01   +3.102526674706833e-01   +9.876717864113785e-02   +5.239904347255907e-02   +2.871138217804142e-02   +2.385180453102114e-01   +7.248434882338041e-02   +3.589456264285197e-02   +2.855050933971460e-01   +1.984909898547672e-01   +1.901417979472761e-02   +3.822225310384337e-01   +2.891571778638550e-01   +4.332352046593039e-01   +2.005310454988175e-01   +4.124074314424913e-01; -5.056899094531287e-02   +8.748564021272640e-02   +2.041144155381870e-01   -5.480825485510481e-03   +4.427473207225447e-01   +4.935596461930495e-01   +2.748271390564776e-01   +2.279925934037202e-01   +1.780835965574846e-01   +1.290245086843489e-01   +1.334917295097247e-01   +1.692635794525416e-01   +1.207234456708229e-01   +2.244070763213738e-01   +1.212521454407373e-01   +5.026457792794370e-01; +3.912160223677981e-01   +1.611971228964355e-01   +4.037230247234941e-01   +3.925413869432243e-01   +2.831006204027446e-01   +3.679176709675515e-01   +1.573542199152603e-01   +1.624424164794868e-01   +2.919917210090163e-01   +3.993812776586650e-01   +1.054555527486713e-01   +5.587084483758488e-02   +1.962276631888248e-01   +1.753977362830453e-01   +3.301106896158669e-01   +6.708548699956651e-02; +4.083088686240933e-02   +4.363853516753676e-01   +2.045675807818187e-01   +1.652639307269884e-01   +2.561488925882984e-01   +4.994706364000052e-01   +3.871949352465723e-01   +2.932025072241086e-01   +4.098000646623259e-01   +1.450164023198999e-01   +6.633828770233050e-02   +1.873210404024202e-01   +3.329406104446972e-01   +2.241842670028787e-01   +1.591853899481655e-01   +6.572359359319084e-02; +5.573674238148619e-01   +4.252576508478644e-01   +2.693753699350017e-01   +5.112234530154636e-01   +1.494395559608169e-01   +7.577759501220498e-02   -8.827670871649820e-02   +2.082680232676179e-01   +3.557840696912155e-01   +6.789836920214658e-02   +1.776351165053372e-01   +3.150485885260805e-01   +6.991244315310202e-02   +4.580492126020124e-01   +1.262146407279167e-01   +1.960538556406355e-01; -4.665061391677373e-03   -1.719073674825130e-02   +4.201116969974599e-01   -6.095372177003662e-02   +4.587799752302733e-01   +3.669498291390758e-01   -2.434377149203125e-02   +9.217354581009676e-02   +6.997052442178973e-02   +3.470985947786555e-01   +2.867112130690486e-01   +1.854841298813000e-01   +1.194500068714254e-01   +2.209316742859875e-01   +8.590476503690593e-02   +3.207186255589172e-01; +1.036495922861815e-01   +7.141417498359229e-02   +9.243735440953788e-02   +2.835122895418113e-01   +2.592069184326530e-01   +4.103797498629922e-02   +2.442546623055186e-01   +2.879610076599188e-01   +2.991340110775078e-02   +3.564472207112603e-01   +1.965902036592217e-01   +3.701185391222604e-01   +1.832695525442290e-01   +7.591716194069340e-02   +1.343477243452125e-01   +8.432395238511034e-02; +2.357176365426362e-01   +2.863646421921786e-01   +3.053975058756812e-01   +2.149763322624561e-03   +2.838719493540324e-01   +2.113877401038880e-01   +2.423992272666838e-01   +1.905670444486912e-02   +4.065101858854234e-01   +1.337429522459950e-01   +3.108118382650197e-01   +3.347878745066383e-01   +6.086043243687306e-03   -3.809522886377743e-02   +2.954915143829365e-01   +2.490058837787307e-01; +4.591638983056051e-01   +4.314822548305700e-01   +2.579241519505096e-01   +2.406268034686492e-01   -4.945869264594541e-02   +2.722895138774017e-02   +1.238394107935075e-01   +3.285130446102442e-01   +2.351381128527388e-01   +5.301735515788076e-02   +1.964127435921918e-01   -3.631004430964161e-02   -1.556403856556356e-02   +2.159181869700624e-01   +3.914719974811782e-01   +2.279146463064163e-01; +3.276947297894309e-01   +1.739468958282232e-01   +3.002995752117715e-01   +3.827166919824682e-01   +1.529532319646646e-01   +7.815213095008074e-02   +4.085037999023600e-01   +4.175870138173068e-01   +1.723652605841257e-01   +3.203966891872345e-02   +3.392449315984713e-01   -9.148025677072441e-02   +2.817567095538536e-01   +4.487082892832141e-02   +2.521042571098948e-01   +4.430579098864643e-01; +1.446559224021132e-01   +2.826131467255915e-01   +2.229882880994981e-01   +3.132802551055347e-01   +1.854016771240145e-01   +7.924717528255254e-02   +2.518605714732131e-01   +3.036052811347060e-01   +1.037218784876335e-01   +2.392307736817963e-01   +7.500738849775333e-02   +1.596108515936887e-01   +2.356398336608549e-01   +3.600011501550558e-01   +2.090357921270857e-01   +1.713248991211481e-01; +3.079514182299050e-01   +9.889373032191306e-02   +1.343391837712279e-01   +4.717057908495975e-01   +4.546015468158537e-01   +2.544230983732778e-01   +1.430367582229867e-01   +1.084759135836204e-01   +1.441877493768998e-01   -8.207618340451400e-02   +9.216235302285708e-02   +2.476988488874045e-01   +4.294646733528856e-01   +2.025778685239974e-01   +2.494153114769218e-01   +2.229600460385788e-01];
L1E_L1I_iGABA_netcon = [+1.401150254944392e-01   +5.796688231191159e-02   +1.871505882924284e-01   +1.927004611718736e-01   +3.421883530875416e-01   +1.458836161521943e-01   +2.639442264541997e-01   +2.991542774031452e-01   -9.835366431077582e-03   +3.220238154360994e-01   +2.366451297358260e-02   +1.621291867458110e-01   +3.578856295703686e-01   +1.305179828418156e-01   +1.119101448230088e-01   +3.110539962714000e-01; +2.237397649590188e-01   +1.916721476736850e-02   -2.228229606668334e-02   +2.289733729057947e-01   -6.890986978440514e-03   +1.199707358826837e-01   +6.489135182486433e-02   +1.893894565592916e-01   +3.248885476743052e-01   +3.598536971195243e-01   +1.889064679696224e-01   +1.603440317176620e-01   +1.767706192912498e-01   +3.342806204263438e-01   +3.188557604627493e-01   +2.928891958595847e-01; +2.329262865071894e-01   +4.709632439339986e-01   +1.978753337877525e-01   +3.372511294654061e-01   +3.705025790768799e-01   +2.279281974415840e-01   +1.041820938062789e-01   +3.431282506437244e-02   +2.364953770378340e-01   +2.666032103093993e-01   +2.188422919248253e-01   +2.557433064348614e-01   +2.996355523551794e-01   +1.779303040119257e-01   +1.252814206539397e-02   +9.154126281006808e-02; +1.445610050090955e-01   +2.818286134178480e-01   +3.786758279237567e-02   +5.219711434021428e-02   +3.019226559047495e-01   +1.264502636543441e-01   +3.378350462933700e-01   +3.550575140610840e-01   +2.361247768392514e-01   -1.017232623166357e-02   +1.410098639060206e-03   +2.092171174081781e-03   +6.576465038355958e-02   +4.083758598692552e-01   +1.820778960667098e-01   +2.143560285123792e-01; +4.219676419738436e-01   -3.113496170189281e-02   +2.302165010528296e-01   +1.295551507229701e-01   +4.300806868532496e-01   +1.715235866949139e-01   -1.008014075633769e-01   +1.097433505857641e-01   +1.280524690884480e-01   +2.119723677912005e-01   -5.183223716253314e-02   +1.478076298371823e-01   +3.345309344371782e-01   +7.131387222917604e-02   +4.178755334628860e-02   +1.014149033561318e-01; +4.180763313455205e-02   +3.205575876090445e-01   +4.688979981891542e-02   +6.132782646123244e-02   +1.385926096778068e-01   +2.654468144108694e-01   +1.750342396734873e-01   +3.413646312005184e-01   +2.608635981760880e-01   +2.455405468452985e-01   +3.737311709710189e-01   +4.176678390929009e-01   +1.217827285559339e-01   +1.772444571631515e-01   +1.574337713600703e-01   +3.557175990499713e-01; +1.615836479852767e-01   +1.362308998844613e-01   +1.916116761305454e-01   +4.967728203356516e-01   +4.319577941315922e-01   +1.595939043263073e-01   +2.048704935351068e-01   +4.281078025007083e-01   +2.150195942875961e-01   +2.352157470636382e-01   +1.962136593673016e-01   +5.695113522630890e-02   +2.527872769237168e-01   +1.526070679562131e-01   +1.810376432623344e-01   +1.272278339466696e-01; -7.267656976233125e-02   +2.200996009497178e-01   +8.541905440104266e-03   +7.088566950284544e-02   +6.806129118160875e-02   +3.115734794856523e-01   +3.464318046466449e-01   +1.598328911745742e-01   +1.056269934842671e-01   +7.625114644995099e-02   +1.670949350790221e-02   +7.800185666587045e-02   +2.582888736746165e-01   +1.217886452527949e-02   +4.393430759573504e-02   +1.281766712659747e-01; +2.915084339342421e-01   +4.399604711582645e-01   +1.782205349693018e-01   +3.394711967559521e-01   +8.772148767389698e-02   +3.539389580399590e-01   +3.115502350044039e-01   +2.307021620649603e-01   +1.970092277692227e-01   +2.529768455015630e-01   +3.214598076080123e-01   +2.164460464771792e-01   +1.438976248326624e-01   +3.680679839927090e-02   +2.496230618609859e-01   +3.898117126905703e-01; +1.132534963504414e-01   -5.150454127031574e-02   +2.881006321182879e-01   +1.628441023742861e-01   +7.228210174623920e-02   +7.476088545374382e-02   +2.337617762051412e-01   +2.746312938719618e-01   +1.090656123765446e-01   +3.726032725424168e-01   +1.391275270207097e-01   +8.214530046405710e-02   +1.644536669958876e-01   +2.118615172036709e-01   +1.266933090751843e-01   +1.499614431836274e-01; +2.665202669872069e-01   +2.659774778628615e-01   -6.757571625903677e-02   +3.675344512320275e-01   +1.621698181423721e-01   +4.289935745125537e-01   +9.926229107604607e-02   +5.109464484391210e-01   +2.443183996454694e-01   +4.553869638615555e-01   +3.418528548186567e-01   +3.747738741791469e-01   +4.164479740959920e-01   +8.051385197552728e-02   +3.538545515750141e-01   +2.289894761727468e-01; +2.899497065634417e-02   +4.350980643901891e-01   +2.724569052003012e-01   -4.007510494499906e-02   +1.025652985396238e-02   +1.939041582790619e-01   +3.632845831830139e-01   +4.295678997145707e-01   +2.278048302841852e-01   +3.744951629565856e-02   -1.202958991333637e-01   +1.450717704128599e-01   +2.598124533682505e-01   +3.269108136981926e-01   +1.418826482428652e-01   +1.755564070181618e-01; +1.231736271258627e-01   +4.536325008629905e-01   +2.502165503305770e-01   -4.035031555500479e-02   +4.309506535460007e-03   +2.159873290654147e-01   +2.535162731670432e-01   +3.202387758011497e-01   +1.000611238706422e-01   +1.426848865240343e-01   +8.500388383319825e-02   +3.104806717849744e-01   +2.962498792000535e-01   +3.096481463993478e-01   +4.260755808915521e-02   +1.803582878928169e-01; +4.049802101134676e-01   +1.482521958509432e-01   +2.052496015764033e-01   +1.946957311252092e-01   +9.329283314950612e-02   +2.215547634285201e-01   +5.047058149941639e-01   -5.545286279845295e-02   +3.319868318932511e-01   +4.146494999219803e-01   +2.344342448410762e-01   +3.869738996089740e-01   -4.399839698081771e-02   +2.478948355017389e-01   +3.235645638141400e-01   +2.900194590271791e-01; +1.799250157479370e-01   +7.854824501660369e-02   +7.699930353068535e-02   +6.826750508456134e-02   +2.352399797941106e-01   +1.465112670189481e-01   +4.876417590183972e-04   +7.754348537857150e-02   +1.130451182904914e-01   +3.041905701844060e-01   +1.520044266430406e-01   +3.968970712452429e-02   +2.748880449684760e-01   +3.542329932887901e-01   +8.671921837226142e-03   +3.200548253959017e-01; +2.258027606550264e-01   +8.058403924365432e-02   +1.404849448884952e-01   +8.093208037179486e-02   +2.388207425293379e-01   +4.594838795685512e-01   +1.511614751370987e-01   +3.232060061587350e-02   +1.861933894726157e-01   +3.049178586201496e-01   -1.954808354198161e-02   +1.288175842582586e-01   +6.308521148985799e-02   +3.142954951749978e-01   +3.244399078097889e-01   +8.668807698761878e-02];
L2I_L1I_iGABA_netcon = [+2.694284285573915e-01   +1.254901227937453e-01   +2.078816948081271e-01   +1.991463914412635e-01   +7.415005411398698e-02   +2.740031133403344e-01   +7.816395012271560e-02   +3.683680948334196e-01; +2.895303247453491e-01   +2.161251328039533e-01   +2.291684430190686e-01   +4.459113938611779e-03   +4.139964246019372e-01   +3.403230271903107e-01   +3.125394586372117e-01   +2.780194273501045e-01; +2.288251630030918e-01   +2.982139538366911e-01   +1.381654821891746e-01   +2.209266853467519e-01   +2.205563625524717e-01   -3.666054931042322e-03   +3.394486784581419e-01   +2.191861319524365e-01; +6.586386152057860e-02   +2.361054643134763e-01   +6.327411655545220e-02   +1.060921324294007e-01   +1.437793225403021e-01   +2.580879023130414e-01   +4.470548434784643e-01   +4.412053912807996e-01; +5.874773506967232e-02   -5.323539897855792e-04   +2.928829806370708e-01   -1.676977473934677e-01   +1.195041431108431e-01   +3.071129895091456e-01   +3.657633982648197e-01   +3.685679566304821e-01; +1.037393992460341e-01   +1.694514682319832e-01   +4.924565042252317e-01   +3.023523105863123e-01   +2.167734650387936e-01   +3.753851345266355e-01   +1.390710267541862e-01   +1.878680370142094e-01; +5.329108851831271e-01   +1.363272074965999e-01   -5.185303765991786e-03   +1.941978791734491e-01   -3.362691435637177e-02   +4.831023600548129e-01   +9.844335633736498e-02   +4.219865503067675e-01; +1.356195282241022e-01   +3.862810614744723e-01   -1.515764953758727e-02   +4.242762966584677e-01   +2.193644005999504e-01   +2.239207165376783e-01   +3.137242664801966e-01   +1.617373992118617e-01; -5.564836555208512e-02   +1.167763199823147e-01   +3.585047661621054e-01   +2.956503543290606e-01   +3.092758512505948e-01   +1.958228628388814e-01   -5.256667443335898e-02   +3.190449153214512e-01; +2.636044532184357e-01   +2.356683945237587e-01   +9.180020778820748e-02   +1.187306641927721e-01   +4.159650411798155e-01   +3.647868536146733e-01   +1.187319834584957e-01   +2.854913739942509e-01; -6.232111668577559e-02   +8.233875467747245e-02   +3.544402775097395e-01   +2.787769327530380e-03   +3.220420421514044e-01   +1.679559521734371e-01   +4.198417224915983e-01   +4.848078997434867e-02; +1.464654163095347e-01   +2.641702634496283e-01   +2.747721175836861e-01   +1.472445163919604e-01   +2.661929354350556e-01   +7.578077132494049e-02   +2.753204755374517e-01   +3.899540816658374e-01; +2.571034627794744e-01   +1.238539158662009e-01   +2.240267095274366e-01   +2.829231326898964e-01   +1.462725651647015e-01   +3.680234701574606e-01   +1.894480689487953e-01   -1.128547071660398e-02; +2.098308489084781e-01   +3.536524198744447e-01   +1.767960355475588e-01   +1.478685030013609e-01   +1.008795807165775e-01   +2.809721110489047e-01   +3.394996785765692e-01   +2.419890173377040e-01; -1.084114489925155e-01   +2.690461538556781e-01   +1.999285791943480e-01   +1.526409230094482e-01   +2.745516135994028e-01   +1.347440482760651e-01   +4.248861735899351e-01   +4.354451810264524e-01; +4.061998266518829e-01   -2.471791229472328e-03   +2.380807317564830e-01   +4.329783697572572e-01   +4.036978090037099e-01   +3.431735291442562e-01   +2.444812972792688e-01   +4.481943402673382e-01];
L1I_L2I_iGABA_netcon = [+4.170913658195481e-01   +2.816991732435652e-01   +3.002355227968347e-02   +1.507630295240532e-01   +3.725117795786263e-01   +8.084444989387060e-02   +3.149966302855065e-01   +1.279483249062797e-01   -7.830328698562544e-03   +3.924908150797772e-01   +3.806727404514034e-01   +1.313037748025183e-01   -1.549575502052188e-02   +1.457270884010534e-01   +3.357959871603702e-01   -1.287319532420965e-01; +3.731823807811083e-01   +3.418405580625709e-01   +2.973174358855534e-02   +2.988599389363212e-01   +2.857435305319159e-02   +4.010411393891946e-01   +1.388433336186199e-01   +4.146118069814002e-01   +3.926856411174792e-01   +4.336042748054728e-01   +2.333879436491978e-01   +1.090595163873323e-01   +2.712106684930155e-01   +4.199289995452444e-01   +4.799894334129305e-01   -3.641768378876618e-02; +1.423173497601625e-01   +1.654583804712675e-01   +1.848813121812160e-02   -4.261818218033609e-02   +2.089524396721646e-01   +3.081097366447407e-01   +2.859385671572816e-01   +3.918569565942719e-01   +1.661378003307025e-01   +1.817981346678684e-01   -3.645248951339490e-03   +7.616058692915761e-02   +3.690374866125684e-01   +4.776860080242838e-01   +1.751078114091565e-01   +1.984979784129819e-02; +2.341820920491581e-01   +3.196784259434752e-01   +3.382939353547322e-01   +3.234188685925663e-01   +2.039469959739989e-01   +4.949389083511422e-01   +2.265865686402701e-01   +2.169870958044010e-01   +3.923694964274295e-01   +3.145035061637974e-01   +5.059516191206626e-01   +4.785295645511972e-03   +2.631934836034884e-01   +3.437969797050413e-01   +1.323186919159657e-01   +6.286181521560205e-02; +2.760956567970167e-01   +3.387574956557941e-02   +2.271501132242461e-01   +2.327948743342888e-01   +6.917741800464355e-02   +1.038315911749366e-01   +3.910052356809307e-01   +1.137345861499866e-01   +1.045393569448551e-01   +2.667249469703360e-01   +2.653114155162754e-01   +1.726113569815725e-01   +1.106377608717913e-01   +1.502735556239640e-01   +6.882831115229515e-02   +5.829391186326912e-02; +1.359644876145118e-01   +2.623258223939426e-02   -2.432533502438178e-02   +1.987457108175102e-01   +4.435838389938086e-01   +3.791551654000653e-01   +1.795917262856286e-01   -4.314277114569690e-02   +2.537307076293694e-01   +1.868305689884250e-01   +1.184971923141306e-02   +3.501471183796000e-01   +2.598347910020954e-01   +2.643438111748618e-01   +4.012159890878287e-01   +2.198708944839209e-03; +4.267488847514394e-01   +5.062072531049792e-01   +1.711285545976828e-02   -5.763033031637648e-02   +1.637707647396380e-01   +2.574220041959725e-01   +3.466652342143567e-02   +4.906058176344163e-02   +3.078834914160569e-01   +1.416517743422838e-01   +3.190296374864371e-01   +1.800715080580429e-01   -3.380163787035888e-02   +2.447735136868505e-01   -6.716585883810626e-03   +4.510078274145971e-01; +4.330247422947217e-01   +1.662246709238508e-01   +8.795088068363247e-02   +2.329947602786294e-01   +4.266947902108009e-01   +2.397757474978080e-01   +2.206535779997237e-01   +1.824550559571455e-01   +3.963007195063791e-01   +2.097162599220453e-01   +7.769448878807175e-02   +2.207418051936699e-01   +3.532728463347203e-01   +2.884645969753564e-01   +3.954227839987129e-01   +5.158141222131493e-02];
L2E_L1E_iAMPA_netcon = [-5.132497477288940e-02   +3.500769038545709e-01   +2.090071811842485e-01   +2.163369150511357e-01   -6.668880541325514e-02   +2.613229511355613e-01   +9.574664850847622e-02   -1.358039480822385e-02; -4.681661241997052e-02   +6.721997141822297e-02   +4.338393542200884e-03   +4.488823632799342e-01   +3.630009372813279e-01   +2.588109630974862e-01   +4.287995588686732e-01   +4.724736532265363e-01; +7.475098685442180e-02   +1.422995028686230e-02   +4.331508808058526e-01   +3.097455814145819e-01   +1.314949474768134e-01   +2.515252222486353e-01   +3.702295444735367e-01   +9.739486935421442e-02; +1.727087724206091e-01   +3.035654707645884e-01   +1.021569694073426e-01   +9.568877803439159e-02   +4.885714309373275e-01   +1.583314639123216e-01   +2.699249102283718e-01   -1.916887463719395e-02; +3.860963396954971e-01   +2.017679845474954e-01   +2.486666396108473e-01   +3.726571540430803e-01   -3.562312963742721e-02   +5.171345324258864e-02   +1.090475305123824e-01   +4.640598809187966e-01; +4.219277706539752e-01   +3.620666156808762e-01   +1.822617506603975e-01   +1.152234360235129e-01   +3.326315531583828e-01   +2.862123808715983e-01   +2.065016154213441e-01   +3.701668645349199e-01; +1.560476408866730e-01   +2.418993068694277e-01   +9.906301977569069e-02   +2.803919745698816e-01   +1.322343008573063e-01   +4.201431952706557e-01   +5.092360003153471e-01   -1.431865434221352e-01; +2.453622922652265e-01   +1.356931265937741e-02   +2.034950908565579e-01   +4.109164371498014e-01   +2.495478617063094e-01   +1.076917236394351e-01   +1.923864082864774e-01   +1.048283427742527e-01; +4.562538548053805e-01   +9.625109479439060e-02   +2.854202836684518e-01   +2.619919091960627e-01   +2.669364665038787e-01   +2.673490811675178e-01   +3.257166910146003e-01   +1.823460105089774e-01; +3.731972543516613e-01   +2.867664028545256e-01   +2.632248348188668e-01   -7.192286054329096e-03   +3.691322520066245e-01   +9.644122392176213e-02   +2.571559901962854e-01   +1.639303292646170e-01; +1.265920640594676e-01   +2.308702174333769e-01   +3.503292727310133e-02   +6.599435811204081e-02   +4.726597167054852e-01   +4.250346201561995e-01   +7.177219895789214e-02   +1.576461150812825e-01; +2.619426410650891e-01   +4.117455323915858e-02   +4.390421706174039e-02   +2.116464564622180e-01   +1.439825620675508e-01   +2.106918407387857e-01   +3.345177884210378e-01   +2.088659277638167e-01; +3.175273515330638e-01   +5.122871491303407e-02   +2.730705971782773e-01   +1.215861477839902e-01   +3.917128693312066e-01   +8.523898678596105e-02   +3.550360139365612e-01   +1.952708556609253e-01; +3.203408488357471e-01   +4.557594277987347e-01   +2.175539954872918e-01   +1.242919978990066e-01   +2.591073345970147e-01   +3.014417629602010e-01   +4.011889873989219e-01   +4.624281746179551e-02; -1.569726410522160e-02   +3.721895530827614e-01   +1.809094424598187e-02   +2.657574512133483e-02   +1.601606465833911e-01   +4.011226289217465e-01   +1.079034505812046e-01   +1.492060942776440e-01; +1.849535173773624e-01   +4.077154297874292e-01   +2.835741707618644e-01   +2.119826337184914e-01   +2.017499917314609e-01   +2.395406686533459e-01   +2.408831992095280e-01   +1.415085165610843e-01];
L1E_L2E_iAMPA_netcon = [+1.764339875626947e-01   +3.157120127503567e-01   +2.206578060965557e-01   +9.538670869064891e-02   +1.408947838001814e-01   +3.361246626091997e-01   +8.047753449230985e-02   +4.126054753862550e-01   +1.427418674209882e-03   +3.896002505581108e-01   +1.126389113349361e-01   +1.302131802784348e-01   +1.070813006777024e-01   +1.917408310172639e-01   +3.438262955806753e-01   +1.096267382411124e-01; +3.379122589236874e-01   +4.913077690843163e-01   +3.220792031372186e-01   +3.446266240036279e-01   +2.730773494126671e-01   +3.196429626068014e-01   +2.282868922908133e-01   +6.352584284359446e-02   +3.545495034718989e-02   +2.044112640538472e-04   +3.254974006821030e-01   +2.379824721760566e-01   -2.228903095463798e-02   +7.768343261970975e-02   +4.020052014879888e-01   +2.282490956469682e-01; +2.092988152622032e-01   +4.602089074908965e-01   +4.768842239087467e-02   +2.057258003530777e-01   +1.509331523046162e-01   +4.373971272233160e-01   -1.063975351466237e-01   +3.149865570206972e-01   +1.501375668471900e-01   +3.123596151167878e-01   +2.885930118700010e-01   +1.230579979470927e-01   +1.293720762613171e-01   +4.241134968352727e-01   +4.498182243999383e-01   +2.984032427708149e-01; +3.082929458198538e-01   +5.377691647970602e-02   +2.180077932210990e-01   +1.204699240566917e-01   +3.101896493379364e-01   +1.425335618896604e-01   +4.067752645082526e-01   +2.542397814724871e-01   +2.533226660005912e-01   +4.506608377921437e-01   +1.909578418209869e-01   +8.699558653946929e-02   +4.610062176776155e-01   +1.720033927646319e-01   +3.656487010341227e-01   +9.969723209940665e-02; +1.687148357090174e-01   +1.625490326658626e-01   +1.891326414368496e-01   +3.945273485259945e-01   +1.103316671226508e-01   +2.418910553528718e-01   +2.285715104144962e-01   +4.711455587060442e-01   +2.017285321143514e-01   +2.288856559164534e-01   +4.964050024952107e-03   +2.417500112267701e-01   +2.789381677497200e-01   +1.117181496247903e-01   +3.221287708351527e-01   +5.019185600430230e-01; +3.351535001790080e-01   +4.101977194207109e-01   +6.995155109410603e-02   +5.129922315390039e-01   -1.277356495833671e-01   +1.226321576113108e-01   +2.069444240946125e-01   +3.057746945597714e-01   +3.648346001872549e-01   +2.398028541345137e-01   -6.275688156566767e-02   +1.056643403367604e-01   +1.377901838411030e-02   +2.157224287308832e-01   +3.304129400587185e-01   +9.018321099170611e-02; +2.840289488360298e-01   +1.571596232828689e-01   +1.413696963250313e-01   -1.168755084263870e-01   +4.320115511625424e-01   +3.665660826083292e-01   +2.768865167616111e-01   +9.532872533329891e-02   -1.178463142729045e-01   -1.209457118322693e-02   +5.884849731444586e-01   +9.414183182387859e-02   -1.136026238493891e-01   +4.671236744568617e-02   +1.320102518808087e-01   +2.011465481017859e-01; +5.522655541277770e-02   +3.044939509595652e-01   +7.721001844603201e-02   +3.113053344139367e-01   +1.203121036699488e-01   +3.916728056364133e-01   +2.602590068625984e-01   -5.093648032631509e-02   +3.094426950752296e-01   +3.185645885561010e-01   +2.506703373221773e-01   +9.262064409635157e-02   +4.580009354029415e-01   +2.878243980449968e-01   +3.307051845722849e-01   +3.233365159293408e-01];
L2I_L2E_iAMPA_netcon = [+4.591960619054974e-01   +1.704149051304205e-01   +3.179881561688224e-01   +2.617061928381946e-01   +3.476682251123462e-01   +7.362678506555384e-02   +1.254769201600998e-01   -2.264298669230646e-02; +4.694951158869722e-01   +9.521971764669697e-02   +7.855520989454035e-02   +2.957633744351077e-01   +3.255825781334781e-01   +1.728814255943813e-01   +3.563936457039357e-01   +1.868240238975745e-01; +3.688141516854326e-01   +6.037871351841040e-02   +2.585676357591844e-02   +2.389164904331965e-01   +3.718383957025842e-01   +2.767526038409900e-01   +2.560059579760494e-01   +3.130814824368602e-01; +2.378070302666452e-01   +3.425206830682512e-01   -6.962780118777459e-02   +1.988084631765533e-01   +4.177936357505173e-01   +4.799876233584116e-01   -6.030822220638998e-03   +2.659362133155990e-02; +1.749217053020747e-01   +9.735025969889595e-02   +1.920245606266469e-01   +1.387570019248199e-01   +2.912967719470089e-01   +2.251559516457438e-01   +1.947304816350642e-01   +2.401763432661549e-01; +2.252144864370996e-01   +2.537134864533885e-01   +6.939178422040895e-02   +2.018360814588211e-01   +3.264965150711372e-01   +3.224242217234543e-01   +2.751246384715693e-01   +1.729849417296921e-01; +9.049295040217117e-03   +1.003983012017787e-01   +3.405913793201080e-01   +1.814209234445016e-01   +2.050634547459193e-01   +2.089154904578238e-01   +3.813647584057793e-01   +1.479604358320390e-01; +4.297904403349348e-01   +4.621550339477050e-01   +3.795334132924275e-01   +1.903513766184691e-01   +4.377881977549379e-02   +5.721905798161360e-02   +9.297536336268042e-02   +4.182940436015191e-01];
L2E_L2I_iGABA_netcon = [+4.348094523530313e-01   +2.445257299041325e-01   +3.460750617208653e-01   +4.333620808862749e-01   +7.141267932909592e-02   +4.534323903075932e-01   +2.543568688280373e-01   +6.578874748780955e-02; +3.218503148536511e-01   +4.528283940617148e-01   +3.750735075554771e-01   +1.044195499323818e-01   +3.373671151661048e-01   +2.760682089370863e-01   +1.752763270896623e-01   -1.285897916918728e-01; +4.750273176874620e-01   +1.255602267082058e-01   +2.634231005859137e-01   +2.722948959916093e-01   +2.536578689136278e-01   +2.160694818014445e-01   +3.068931063274346e-01   +2.710935354802236e-01; -9.234984515213750e-02   +3.237691488300647e-01   +2.495586605247898e-01   +1.611029425020663e-01   +3.366469761829048e-01   +1.343393228960494e-01   +2.804185135225891e-01   +2.332511701773342e-01; +2.858043582558703e-01   +1.471098484276261e-01   +3.226327105009829e-01   +3.117793373298599e-01   +1.242532544766106e-01   +3.248101293324742e-01   +2.381496370330394e-01   +2.758304667529564e-01; -1.008248454754732e-01   +2.583402894004257e-02   +2.473676105057008e-01   +2.478047808406509e-01   +3.082849696180583e-01   +4.695968037355567e-01   +4.263738177923830e-01   +2.609875312734293e-01; +4.078702449689842e-01   -3.219092323417479e-02   +2.522064733292871e-01   +1.505155619509390e-01   +2.623348599907027e-01   -1.030778004317283e-02   +3.513574279417356e-01   -6.600712341720832e-03; -6.190753727247802e-02   -5.112763665101791e-02   +2.586887658042863e-01   +2.186558241622187e-01   +1.803525888697163e-01   +2.406483625236007e-01   +8.763875914015857e-03   +3.262249068522013e-01];
L3E_L2E_iAMPA_netcon = [+2.206384320973204e-01   +2.537264836501549e-01   +3.697405621651802e-01   +1.517208427091714e-01   +4.578703133884583e-01   +2.895758286934125e-01   +4.114966051048897e-01   +1.881723076099922e-01   +1.345140723793191e-01   +3.893302025307319e-02   +2.107221205629423e-01   +3.293574792763037e-01; +4.769678084832829e-02   +2.824077332382898e-01   +1.205087495227969e-01   +1.741346161267909e-01   +2.594620019940730e-01   +1.081456708505466e-01   +3.470089549509361e-01   -7.498314094527740e-02   +8.459998307849138e-02   +2.240644310031104e-01   +1.319330727253585e-01   +3.415538341286153e-01; +3.256954469165201e-02   -1.187742271948758e-01   +1.031917012952811e-02   +8.559924686283019e-02   +1.464235032481837e-02   +1.920020927064138e-02   +4.459192474676745e-01   +2.506046523924799e-01   +1.609348029779883e-01   +2.365752359376982e-01   +4.796052598968887e-01   +1.348937018340416e-01; +2.449800838603631e-01   +2.022279481469028e-01   +2.244285366441400e-01   +2.396654487860600e-01   +2.281962656525288e-01   +1.012065251452807e-01   +3.714021922825320e-01   +4.211187678051388e-01   +2.088503530177726e-01   +3.492370464477591e-01   +2.879151405699894e-01   +2.715369504686977e-01; +2.899696761686147e-01   +2.247189152858798e-01   +3.114360412236536e-01   +2.558114373179168e-01   +1.374747707488124e-01   +2.803651634628065e-01   +1.447255536875507e-02   +3.114546992450941e-02   +1.500620603879515e-02   +1.786357303019787e-01   +2.160166652185957e-01   +4.043880038617888e-01; +8.413257277970095e-02   +1.591593272483151e-01   +9.712001683818855e-02   +4.224301221118113e-01   +1.982626507145142e-01   +1.400113022835393e-01   +9.793817777422338e-02   +3.431445232032539e-01   +3.068575251970148e-01   +1.703759582624308e-01   +3.293187066905208e-01   +9.449847636762501e-02; +2.077662087321827e-01   +3.080706043867577e-01   +2.974908912163692e-01   -1.301758664506619e-01   +3.695748534050453e-01   -3.170376395448555e-03   +6.321735655911247e-02   +2.694726567626171e-01   +2.055543063411843e-01   +1.332676981372462e-01   +3.394603091426409e-02   +9.713968608519849e-02; +2.730269445604862e-01   +2.399130375097294e-01   +2.105254137091190e-01   +3.072117072179640e-01   +2.323656838552048e-01   +3.685291489762195e-01   +3.157668398759730e-01   +1.983510120173691e-01   +3.163374409201864e-01   +4.255807892288042e-01   +1.850604246325801e-01   +2.822492546865401e-01];
L3I_L2I_iGABA_netcon = [+1.155073184439009e-01   +2.396164451109173e-01   +4.233177362852552e-01   +5.610087265747100e-02   +3.164685751675144e-01   +5.980482283300428e-02   +2.476959979551236e-01   -3.989881248938107e-03   +3.201783124848750e-02   +6.474338641989003e-02   +3.369955145786555e-02   +3.572718360459777e-01; +2.498020944277887e-01   +3.681634580826074e-02   +5.864608374077020e-03   +3.551036253234958e-02   +1.326302613684394e-01   +3.777964885365320e-01   +2.567492205811885e-01   -3.022225947477697e-02   +2.786288702962382e-01   +3.065778218358842e-01   +1.607759485837005e-01   +2.804418409257790e-01; -1.655052931681719e-02   +1.907945544841369e-01   +1.002113676133389e-01   +4.176248600803919e-02   +2.966100097203074e-01   +4.201472040114423e-04   +2.604134349196026e-01   +3.251466372642478e-01   +9.687763943632678e-02   +1.229008394520578e-01   +2.402850212445724e-01   +3.733068219880751e-01; +2.751115227170481e-01   +1.832942414254478e-01   +3.625848699141637e-01   +2.262417600333728e-01   +2.260401917132532e-01   +4.625876424663006e-01   +5.819040201386588e-02   +1.467506044879047e-02   +2.125307114292752e-01   +1.024922539356328e-02   +3.147943300225805e-01   +2.793038924733523e-02; +1.830021244516322e-01   +3.143040080714407e-01   +8.794522140303629e-02   +3.563054713298730e-01   +2.797613426592250e-01   +1.751810571625670e-01   +2.774013850480708e-01   +9.929160870966504e-02   +4.294349393935215e-01   +4.954988398659235e-02   +1.987260646442712e-01   +1.372980374493322e-01; -4.177018113972912e-03   +9.397172934914955e-02   +4.040549245012925e-01   +1.299312176897807e-01   +1.053583338384517e-01   +9.120123435696294e-02   +1.647515894823614e-01   +2.187102609863544e-01   +3.370460304502003e-01   +1.999303080520369e-01   +2.648676130818962e-01   +1.593285711982890e-01; +3.379735697439236e-01   -2.837317029572219e-02   +2.223329931592223e-01   +3.093684718393055e-01   +2.542341360151509e-01   +8.099262227885798e-02   +4.651122357311749e-01   +3.249611266368531e-01   +1.519489668657494e-01   +2.845256788846382e-01   +3.046752852159485e-01   +6.995362021857611e-02; +1.783053690028226e-01   +3.589600399149934e-01   +4.803009192966344e-02   +2.679459184258480e-01   +1.253119130009386e-01   -6.358309060841125e-02   +8.039747697071667e-02   +1.665033351465880e-01   +1.230489389926728e-01   -1.201281967573351e-01   +1.622697563655905e-01   +1.401930094588214e-01];
L2E_L3E_iAMPA_netcon = [+3.648734231022797e-01   +1.293999831187806e-01   +4.843007776678807e-01   -8.979320868680990e-02   +1.306973295985123e-01   +1.857992088218913e-01   +1.540550110469083e-01   +4.850437708346714e-02; -3.481532886293790e-03   +3.021358181760722e-01   +4.242062423061799e-01   +2.387661566825138e-01   +4.518785780244293e-01   +2.466362456787286e-01   +1.551738050320908e-01   +3.781803629405265e-01; +3.033875460096565e-01   +2.433681649328451e-01   +2.600189587075830e-01   -1.200427569757808e-02   -3.613634800436835e-02   +4.746934400085809e-01   +2.900244695885427e-01   +3.837702646313839e-01; +1.955819972476732e-01   +2.190845187929257e-01   +1.209287714596327e-01   +4.158224541368972e-01   +1.391033133172747e-01   +7.524381316227055e-02   +2.997562731209070e-01   +4.119053655766152e-01; +2.082504178016372e-01   +1.836357681359027e-01   -1.733375277966137e-02   +5.449510333629000e-02   +2.141124378143515e-01   +2.287556570321508e-01   +2.261963917743444e-01   +3.476517509983780e-01; +1.580218461348818e-01   +3.335604663251158e-01   +3.335498734830186e-01   +1.140782084502303e-01   +2.711764436031190e-01   -6.956872259914884e-02   +3.560304897969841e-01   +1.898576316535395e-01; +2.705282767037301e-01   +2.817829093377244e-01   +2.005237927398172e-01   +2.104694282039260e-01   +8.620460384202798e-02   +3.161632101759835e-01   +2.636816138240882e-01   +9.666110680229389e-02; +2.382433471270388e-01   +1.531960965838349e-01   +1.446947203778751e-01   +5.816432433040191e-02   +1.097466106241776e-01   +1.882306013919325e-01   +2.062457180233764e-01   +1.761038207807883e-01; +2.500846558573085e-01   +3.093329214411432e-01   +3.623511706387019e-01   +4.294063260939887e-01   +2.284996935519429e-01   +2.260769219195183e-01   +3.741854524803245e-01   -4.060749847414180e-02; +3.342199225514671e-01   +3.236257492477161e-01   +2.413453536253940e-01   +3.354667578905241e-01   +1.771887597928452e-01   +1.747890464703655e-01   +2.815116735245168e-02   +6.618185178112947e-02; +3.511255429196098e-01   +2.684952337959050e-01   -6.955962998132442e-02   +1.180650150603340e-01   +1.908452455691226e-03   +2.585240539192354e-01   +2.204111580993650e-01   +4.085735889456364e-01; +3.593567755266006e-01   +4.024668324458034e-01   +2.230226953380735e-01   -4.648856514829228e-02   +2.405909874252224e-01   +2.680279172486504e-01   +2.496680964922032e-01   -3.677247671574713e-02];
L2I_L3I_iGABA_netcon = [+1.262275766624741e-01   +1.211877538427712e-01   +2.098283637995260e-01   +3.203954291041843e-01   -8.469348933133350e-03   +2.037775862492180e-01   +2.317934728693893e-01   -6.381998615288595e-02; +4.110083371345764e-01   +2.452375580886606e-01   +1.797246075510490e-01   +5.315622898960449e-02   +3.566055782529574e-01   +1.023603788367358e-01   +1.324436398567467e-02   +1.793958404272656e-01; +1.473833588466229e-01   +1.410665942172741e-01   +1.236677011970512e-01   +1.128055555411123e-01   +2.150592948806795e-01   +3.862172206280512e-01   +2.457809277488756e-01   +3.006632432032391e-01; +8.656078258761150e-02   +1.859505114353712e-01   +4.144356825915833e-01   +3.631405935674710e-01   +3.588791451173884e-02   +2.285262249357043e-01   +2.983356358582879e-01   +3.676504189669618e-01; +1.197739281927772e-01   +1.003051769997533e-01   +1.509783252882095e-01   +3.024387672228141e-02   +1.148079292118216e-01   +2.822891451302801e-01   -7.523824916971951e-02   +3.732743378043331e-02; +5.215622108390725e-02   +2.944483358883317e-01   +4.240834807548583e-01   -1.699259531701006e-02   +3.551734025964834e-02   +1.762990269927545e-01   +1.086260336132504e-01   +2.594543638834313e-01; +1.356197113390450e-01   +2.690716679670676e-01   +3.754853811955003e-01   +1.995627682543300e-01   +1.567962590870825e-01   +1.818389233665375e-01   +2.890332178780881e-01   +3.517684380434441e-03; +2.920449707142845e-01   +5.192460404368274e-02   +1.128708308384786e-01   +2.689759053030580e-01   +7.607092044487333e-02   +1.675222943770470e-01   +1.585828155608430e-01   +2.066713468404137e-01; +1.736993509163288e-01   +2.901278400317705e-02   +2.160762476581196e-01   +1.838712538320957e-01   +8.984213746518162e-02   +3.419259527105985e-02   -1.565773670351835e-02   +2.668344191936594e-01; +2.443700943630551e-01   +1.063933066286531e-02   +4.062964793147225e-01   +1.827100084244402e-01   +1.717971582935567e-01   +3.969096808931279e-01   +4.031082685318754e-01   +2.338580626299687e-01; +2.351977332997088e-01   +5.464398230544106e-02   +2.698839989142978e-01   +5.781390202694914e-03   +1.440977462536063e-01   +8.189544145344357e-02   -1.359318475186520e-01   +1.512323104731731e-01; +2.623710970679325e-01   +1.520973710654870e-01   -4.038647704691856e-02   +8.034029381571414e-02   +2.471916264060766e-01   +2.276319153200502e-01   +3.962053001713470e-01   +3.518492405595156e-01];
L3I_L3E_iAMPA_netcon = [+1.829382474553477e-01   +2.248768450743171e-01   +2.514675422538344e-01   +2.701356215132514e-01   +3.546490907139314e-01   +3.952724239287908e-02   +2.951722581035294e-01   +3.377067909752074e-01   +1.186478363970001e-01   +4.149852887387996e-02   +2.466912164856365e-01   +2.293617095620414e-01; +2.018078264635695e-01   +1.666016506256142e-02   +1.911517587090755e-01   +3.363571837973160e-01   +4.397141399102775e-01   +1.093347062511370e-01   +6.831598073753975e-02   +6.771930127109992e-02   +2.292965977406314e-01   +1.442695632963920e-01   +4.345613494229622e-01   +3.557608674020597e-01; +3.227506198780191e-01   +1.970232962900441e-01   +7.164021256679434e-02   +2.573659563891162e-01   +8.543465632305913e-02   +4.211711924372111e-01   +3.477237765375925e-01   +2.152956809743365e-01   -8.498581370711605e-02   -3.370961414123078e-02   +1.578413575218265e-01   +5.822848813041693e-02; +1.272424285569383e-01   +2.093887498663539e-01   +5.168084127963862e-01   +5.842311243995170e-02   +1.589345523283556e-01   +2.066299743690314e-01   +2.646693600144740e-01   +2.007850443417778e-01   +3.203022065598636e-01   +3.167115792724929e-01   +5.834184103508572e-02   +6.906714601051224e-02; +2.753449661992603e-01   +2.795850948650633e-01   +1.434671911213962e-01   +2.142817141352807e-01   +1.885391775625647e-01   +3.469835763260565e-01   +2.965332774275445e-01   +2.470390044369856e-01   +2.619082841397093e-01   +1.826976133402989e-01   +1.688726558925177e-01   +1.279407649470663e-01; +1.054747393796087e-01   +2.803270259582882e-01   +4.098011423775706e-01   +2.771608702712517e-01   +1.599530897423932e-01   +1.332668343340681e-01   +2.092179399634355e-01   +1.765429369578252e-01   -5.237444281026254e-02   +5.496139602741521e-02   +2.316265031869552e-01   +3.163825031819474e-03; +1.624028224909166e-01   +1.976765057721553e-01   -2.269482037317633e-02   +2.356460618587781e-01   +3.834364921772437e-01   +3.078929317139736e-01   +1.106731108785816e-01   +2.038124271374523e-02   +3.698390713707101e-01   +9.375304385814567e-02   +2.953533900633336e-02   +2.664432879970833e-01; +6.714427838206702e-02   +3.484667099586262e-02   +4.057512397531692e-01   +2.291859738542744e-01   +1.852856169173162e-01   +2.455313197399846e-01   +1.023849896082732e-01   +3.418176806330959e-02   +2.659918947926748e-01   +4.030242465644041e-01   +1.498723243890454e-01   +1.593624527259890e-01; +8.402678714863079e-02   +2.756523319298845e-01   +1.138589402743763e-04   +1.384721579077650e-01   +2.947057145216375e-01   +1.605191119572640e-01   +4.266498067115992e-01   +1.755465120638056e-01   +3.732990246288081e-02   +2.139343688132005e-01   -9.644254704676106e-02   +2.354741177457386e-01; +1.310621548104705e-01   -5.034537362753096e-02   -9.846648756422605e-02   +4.369661702643305e-02   +5.132451230626886e-02   +1.124154173240365e-01   +1.097117783279967e-01   -3.903326239479820e-03   -1.816393221000264e-02   +3.898819657111367e-01   +2.735437481202461e-01   +5.697713825738693e-02; +2.374102010661867e-01   +2.494559352219223e-01   +4.272656277786060e-02   +3.313283411959807e-01   +7.304511340193885e-02   +2.062961118125090e-01   +2.109736289217324e-01   +5.134977280862342e-01   +2.206455321852329e-01   +1.145463855267623e-01   +9.726035212287980e-03   +2.670806406769251e-01; +1.332736497012916e-02   +1.711219300279813e-01   +9.367261846181008e-02   -6.141469070749286e-02   +2.324823945421253e-01   +2.144199610551602e-01   +1.063643310291706e-01   +2.783478098118438e-01   +1.636541296868517e-01   -3.455609207909575e-02   +2.852662897769638e-01   +1.143125723383584e-01];
L3E_L3I_iGABA_netcon = [+2.317038048731824e-01   +8.038131731702632e-02   +1.041516666483539e-01   +1.613290775357772e-01   +1.292289020391280e-01   +1.605168625770114e-01   +2.467608793768217e-01   +4.480911961798944e-02   +4.983568520449339e-02   +4.313858802751743e-01   +3.658086653520126e-01   +3.751130846997533e-01; +1.187077467201215e-01   +2.075056736045449e-01   +1.500894504365390e-01   -6.373521388535996e-02   +3.205746241507827e-01   +3.771783125469326e-01   +3.683557881696383e-01   +2.285622826096376e-01   +3.942416702944948e-01   +1.511989686477551e-01   +4.478133140538517e-01   +2.511947059227002e-01; +1.912700094961283e-01   +2.881090792366305e-01   +3.916610024521355e-01   +2.362911149111372e-01   +3.912055477286143e-01   +1.485228860433970e-01   -2.054869363552390e-02   +3.290358430234854e-01   +3.489339415873568e-01   +3.711821770518294e-01   +7.299414127346163e-02   +7.567773772419914e-02; +3.353092928338562e-01   +3.652287851919803e-01   +3.524421714392949e-01   +2.078235606057222e-01   +3.715250573118885e-01   +3.435644217676255e-01   +3.089851442795771e-01   +2.197162914677395e-01   +2.844063139307866e-01   +2.108625902700950e-01   +3.013211072629717e-01   +1.405339673334718e-01; +2.367195441787782e-02   +3.651302687774554e-01   +3.836405646040387e-01   +1.636954514728486e-01   +1.349365980286578e-01   +4.299154295380079e-01   +1.113660259644059e-01   +2.791434136784350e-01   +9.702026472300501e-02   +2.448857148921012e-01   +3.940058090334907e-01   +5.894961941253833e-02; +2.232524468182416e-01   +6.366693101497417e-02   +4.160724882820208e-01   +4.387527011642327e-01   +2.742053776897020e-01   +1.011076315088471e-01   +2.887947147415187e-02   +3.547491381620445e-01   +1.531606895476322e-01   +2.322232356663684e-02   +9.939726932285037e-02   +6.891334771869831e-02; +4.298215122065761e-01   +1.205898335122416e-01   +4.626482539403559e-01   +8.922958929034802e-02   +2.257987885145724e-01   +2.894677200279842e-02   +3.464669162411039e-01   +7.726831540454482e-02   +7.264868095304820e-03   +2.263364537632830e-01   +1.968896494827976e-01   +2.371814485373041e-01; +2.806819367371378e-01   +1.102365857622123e-01   +1.385531467293387e-01   -4.201514896087195e-02   +3.742778796950531e-02   +5.099178772859991e-01   +1.089330540970892e-01   +3.619468614030219e-01   +1.981123836841116e-01   +4.945444696899491e-01   +3.655643540943032e-01   +1.225757229358726e-01; +1.678539113278119e-01   +5.272651898346318e-01   +1.816202507861680e-01   +2.881045802639157e-01   +6.640126394816484e-02   +9.881346533547539e-02   +7.231535590611748e-02   +8.893754371022439e-02   +2.139709810581058e-01   +3.666549818767776e-01   +2.694784811851880e-01   +1.921865754159046e-01; +2.847529602059417e-01   +3.869392471389816e-01   +1.379481249388608e-01   +8.726147693501783e-02   +6.866028206652437e-02   +1.531436029471384e-01   +2.148153157465981e-01   +1.175833918746307e-01   +2.227857846388121e-01   +1.784409665903199e-01   +2.456016412387843e-01   +4.741968705628637e-01; +3.418562069610572e-01   +3.857347377431858e-01   +3.016838851903596e-01   +2.814071885680948e-01   +1.536295274528404e-01   -6.311471383653872e-04   +2.773704723857779e-01   +1.761173690865582e-02   +8.677413209279992e-02   +5.156521037761251e-02   +4.385148965949368e-01   +1.064733944147508e-01; +3.259352155036573e-02   +2.619029500971476e-01   +2.988392838272922e-01   +3.310954696135250e-01   +3.951988332987688e-01   +3.740717011033362e-01   +2.738577715556806e-02   +1.108182699135670e-01   +2.727795495895393e-01   +3.401741287711733e-01   +8.000017389529036e-02   +6.628924883823691e-02];
L2E_Input1_iAMPA_netcon = [+3.134329805651026e-01   +9.878569152515475e-02   +4.692919642090018e-02   +2.429932206750602e-01   +1.787666127633635e-01   +3.112645695205565e-01   +5.935160234814007e-03   -6.216483230549217e-02];
L2I_Input2_iAMPA_netcon = [+2.927091294911455e-01   +1.621554377638336e-01   +3.928271904148853e-01   -3.904169068865444e-02   +3.722783922267768e-01   +3.480553561558664e-01   +3.238310573327268e-01   +2.513901451116202e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
