function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.615244909264582e-02   +9.114717247353635e-02   +5.958613283195492e-02   -4.018882672329306e-02   +2.744363695475080e-02   +3.184652929996588e-02   +5.063591322197201e-02   +2.330224115920100e-02   +4.794767791176958e-02   +3.636301468112589e-02   +1.015367019580208e-01   +9.509737382709005e-02   -6.741457068164883e-04   +5.835187263329690e-02   +1.451352622861600e-01   -3.249479359520238e-02; -1.627930595224225e-02   -2.292266213582923e-02   +2.780930037293924e-02   +1.756371790176293e-01   +1.039230197180366e-01   +9.812354816015818e-02   +2.972749992480063e-02   -2.733617803322761e-02   +8.922669161228511e-02   +3.423461954637503e-02   +5.268535935718662e-02   +5.272774428083284e-02   +1.181098880646704e-01   +9.428929018949729e-02   +2.391866727585109e-02   +9.195339550588524e-02; +6.340904451417378e-02   +7.417976546921175e-02   +4.760882354284713e-02   -4.739543759837299e-02   -4.208326873277191e-02   +3.012250741964956e-02   -3.705614474900257e-03   +4.757486257507899e-03   +6.766159889207969e-02   +1.023944048836193e-01   -4.875294990653921e-02   +6.290370796352604e-02   +1.355247197865898e-02   +3.112429019906671e-02   +4.949490211184231e-02   +6.947707501976252e-02; +4.102581524521071e-02   +1.512205530617247e-01   +1.233691338581202e-01   +1.158954324480236e-01   +7.004596250158794e-02   +2.617700033767236e-02   +1.879343745007341e-02   +9.798583902388208e-02   +6.943550353549523e-02   +6.043706926075502e-02   -3.468064837089062e-02   -2.733424775678163e-02   +6.161376234440948e-02   -8.481504881901630e-02   +1.055031019494527e-01   +8.037332802270433e-02; +7.621002262963072e-02   +8.244547773974585e-02   +1.329380595941163e-01   +6.798897191505586e-02   +1.696980153811018e-02   +1.429583931846133e-02   +4.393443635405954e-02   +1.088293081843808e-01   +4.723648494809746e-03   +1.121007390943502e-02   -7.433780740164659e-03   +7.708618345942359e-03   +7.015328413329432e-02   -9.037055023803005e-03   +9.354736350038012e-02   +1.123276594031176e-01; +9.942700696732661e-02   +6.240164204099662e-02   -2.794243561999347e-02   +6.967913985860583e-02   +3.245177386390277e-02   +3.268339449942791e-03   +9.294436392779118e-02   +7.191225810034277e-03   +5.935244051872696e-02   +1.295110910594887e-02   +1.389853737479855e-01   +1.324614719312212e-01   -5.551256482745374e-02   -2.317266799870355e-02   +1.621388336490511e-02   +3.332591087741639e-02; -3.435752434310203e-02   +2.689441374499189e-03   +4.060508099844812e-02   +1.354568508851988e-01   +6.222695358592294e-02   -3.698771852080671e-02   +7.592404592253639e-02   -3.911405791077005e-02   +1.390991235510599e-01   +6.172314869243481e-02   -2.369315253096457e-02   +4.498054183323927e-02   +6.673036119151948e-02   +7.512920523799238e-02   +5.811846596690077e-02   +9.083537623413517e-02; +2.965250434041702e-02   +5.198648270837045e-02   +1.738185296823355e-02   +5.511305638349850e-02   +2.033203338203139e-02   +1.632128315133707e-01   +5.398366538443834e-02   +1.591604155748381e-02   -5.321924420655250e-02   +2.613841034820731e-02   +1.447427995529776e-01   +2.269718737109043e-03   +4.155132298969914e-02   +8.426526439010561e-03   +8.624762731333769e-03   -1.276694250070376e-02; +7.733792623089863e-02   -5.481082369866141e-03   +6.423996494700546e-02   +5.820008060570772e-02   +9.965755314048802e-02   +6.854539964670159e-03   +2.110395444485987e-02   +2.155542835742410e-02   +3.273308841091822e-02   -3.558851514235591e-02   +1.355069342385973e-01   +2.950677548755313e-02   +3.927557193898785e-02   +1.326740453068291e-02   +9.573607355873190e-03   +7.555310871904516e-02; +6.047645157680941e-02   +6.894295398122102e-02   +9.902347119180911e-03   +8.509673890516174e-02   +8.292625011164630e-02   +1.320905232286474e-01   -1.748791596949686e-02   +3.673074859077837e-02   -1.821317547795703e-02   +1.024529565116217e-01   +9.787471577603143e-02   +5.301978287586750e-02   +1.469383236411692e-01   +9.053138978159725e-02   +6.368869236015501e-02   +2.065374638928640e-02; +3.906759963201258e-02   +4.148906251109087e-02   +4.978796897926056e-02   +1.777485938256919e-02   +2.125871677516331e-02   +1.802791914930213e-01   +2.251359489103639e-02   +1.154113390523163e-02   +5.887221388643701e-02   +6.406334946279224e-02   -7.089715879074535e-02   +8.099171862805096e-02   +1.031318057403498e-01   +1.295131674370282e-02   +3.425038173211077e-02   +5.810518351607480e-02; +2.021423429691451e-02   +5.179742756217705e-02   +1.981703424219851e-02   +9.912411828862516e-02   -3.322905487115196e-03   -2.814612716009554e-02   +7.185572149224906e-02   +1.041141584804002e-01   +9.923717396896667e-02   -9.178064414521906e-03   +6.701235301335887e-02   +4.321346896056726e-02   +2.996728357774514e-02   +7.471563310867735e-02   +9.038789217239272e-02   +9.163777563439542e-02; +1.720746349531001e-01   +9.799878651278628e-02   +6.357053882833463e-02   +8.869217023088273e-03   +4.423678326774843e-02   +3.804871936553184e-03   +5.585169878317374e-02   -8.695726449146707e-03   +5.218114905175334e-02   +1.057388342771045e-01   +1.309011540603755e-01   -8.263447953316547e-03   +5.965731408430433e-02   +2.539953799371347e-02   +8.967070158941540e-02   -1.472218428806245e-02; +1.160384636346969e-01   +2.365445470201779e-02   +5.504683253599156e-02   +1.261212234127812e-01   +1.053214146978115e-01   +2.073268001547351e-02   +1.012697555343354e-01   -3.341788249981180e-03   +5.302034188590194e-02   +7.681221000906988e-02   +7.751407647403913e-02   +1.259686862885227e-01   +1.285408037251847e-01   +1.091456473547565e-01   +1.230487788336082e-01   +1.196224262335000e-01; +4.464358675350328e-02   +6.495802134701852e-02   +1.093511068967458e-01   +7.712044532607706e-02   +1.143148482065029e-01   -2.884399502398001e-02   +8.768105228183429e-02   +6.336287950952028e-02   +8.941820735937067e-02   +5.302520796399861e-02   +6.642233876416744e-02   -6.434023600870024e-02   +1.048298098518679e-01   +5.559870574752410e-02   -6.544257706444394e-03   +9.403054069843747e-02; +9.713491803319609e-02   +1.992525027168112e-02   +8.404946120298402e-02   +2.485151850807190e-02   +1.325292761445231e-01   +1.146460736846535e-01   +4.100236118782245e-02   +2.809402297485189e-02   +6.521486109140925e-02   +5.249931284736113e-02   +9.206024116692835e-02   -1.031110693830530e-02   +9.557856798024071e-02   +5.583356933150549e-02   +7.130699160076892e-02   +1.191185645486413e-01];
L1E_L1I_iGABA_netcon = [+4.092206792124682e-02   +1.231501040083272e-01   +9.300250503334483e-02   +1.126429798161649e-01   +4.948856185319454e-02   +1.020621421809836e-01   +3.986699204350590e-02   +3.879765214144085e-02   +1.127537547803343e-01   -3.106132391403305e-02   +5.712528078633103e-02   +5.454713078040542e-02   +1.354563394528159e-02   +7.299717970573381e-02   +5.630803756500652e-02   +9.348970263629447e-02; +4.438108462505387e-02   -2.196558193211551e-02   +7.660520975087245e-02   +2.888280463918778e-02   -3.751063256289885e-02   +6.176202062536139e-02   +4.153064891885098e-02   +5.505911261215689e-02   +7.272584572719232e-04   -4.560741191454507e-02   +9.152045161482236e-02   +6.011101623835832e-02   +6.597360593497435e-02   +5.280268470407107e-02   +1.549479918422551e-02   +1.034997565198696e-01; -3.513752326142484e-02   +1.301395853876318e-01   -3.045224973256590e-02   -3.955949898743687e-02   -2.378721781872905e-02   -1.019281607546999e-02   +9.520006899349272e-02   +5.929733632266453e-02   -2.173509659063532e-02   +3.373974612627230e-02   +4.699113524865177e-02   +6.757910478181609e-02   +2.990592257069357e-02   +5.137837601695849e-02   +4.491876583598013e-02   +5.041819491413019e-02; +3.424799829675896e-02   +9.361538587485091e-02   +8.589695540217249e-02   +3.929068989432290e-03   +5.272116985403121e-02   +1.417775060513425e-01   +1.075216452803449e-02   +3.395350268437133e-02   +4.851720406350685e-02   +1.276516672056605e-01   +1.242665321167278e-01   +7.769828898607187e-02   +6.442802550431112e-02   +6.530667867553008e-02   +4.419838284509567e-02   +4.989202751680918e-02; +6.405583113381146e-02   +1.021815194260730e-01   +1.188054516912108e-01   +1.282298250827426e-01   +8.770403947887832e-02   +5.181591365453087e-02   +6.671227708297210e-02   +5.643403601712092e-02   +1.134692882592239e-01   +6.295219179954295e-02   +8.923504277417015e-02   +2.329631575399497e-02   +3.366206466195017e-02   -2.327361250730380e-02   +7.340091974937624e-02   +5.600096539280988e-02; +1.057257874456726e-01   +4.490767622938483e-02   +3.755932488690822e-02   +9.931867642727374e-02   +4.786399906413423e-02   +2.242745268607018e-02   -2.884906641443759e-02   +1.684115756133285e-02   +1.615119525743717e-01   +5.203669131300495e-02   +5.258537388521169e-02   -1.507699966668405e-02   +1.162686378121665e-01   -4.089577586360253e-02   +4.887377914242080e-02   +2.020621753658579e-02; +3.643660661206929e-02   +5.529900611681582e-02   +1.193568625115627e-01   +6.750554863772348e-02   +5.919617555480400e-02   +3.366089713240591e-03   +1.086338044638908e-01   +1.294158359068168e-02   +2.088764885073514e-02   +1.014130560308888e-01   -1.989577992920672e-02   +1.122730762772870e-01   +5.854454562227376e-02   +1.324121331104764e-02   +5.443418006954674e-02   +4.466413157198554e-02; +3.260613879014414e-02   +9.291905159794009e-02   +5.605437071174506e-02   +8.342580654641121e-02   +5.277979760887450e-02   -1.235050891746610e-02   +2.552490373850733e-02   -6.768362149461579e-02   +1.209276163322189e-01   +7.495140753403219e-02   -1.371274295369935e-02   -6.041897184661818e-03   +4.440316073922940e-03   +6.396875296614150e-02   -3.108630785932907e-03   +1.656621346494621e-01; -4.631435315815037e-03   +1.056701069302816e-01   +8.904661792719537e-02   +2.998282338671964e-02   +4.012897471575503e-02   -2.270574153384268e-02   -2.453508383338408e-02   -3.128892523056053e-03   +5.050186966906023e-02   -6.268777509527615e-03   +6.362917286007953e-02   +4.134142543189295e-02   +1.120045769533057e-02   +9.231678510740701e-02   +1.003052454822920e-01   +8.748768034900922e-02; +7.540899827826571e-02   +9.427938104624595e-02   -3.827227844613540e-02   +3.534629057851728e-02   +5.787735912719546e-02   +4.144836486530286e-02   +9.044399936454865e-02   +7.199411540816741e-03   +8.703603953797359e-02   -1.654283374819106e-02   +1.022140728254524e-01   +4.890939081181271e-02   +4.545032253755847e-02   +1.026064949800761e-01   +1.336538064451966e-01   +5.809708936807149e-02; +6.423956782241882e-02   +6.839200262540637e-02   +3.642917031899429e-02   +6.864757146420639e-02   +8.571004423496398e-02   +1.201695084723303e-01   +1.565204236930770e-02   +5.297784098050499e-02   +6.690348303496038e-02   +5.501519709535728e-02   +5.396322098715808e-02   +1.018232741483059e-01   +1.236957672534454e-02   +3.937148768233771e-03   -2.768553797816411e-02   +7.338577823394671e-02; +6.316581949337605e-02   +3.726953330575936e-02   +2.344285491420296e-02   +5.296843761628124e-02   +1.115240745099783e-02   +2.805419506198683e-02   +6.172356348940836e-02   +4.002352097912330e-02   -4.447703869141532e-02   +8.454663729040471e-02   +8.712203294240214e-02   -3.188561136247871e-02   +3.427497734761859e-02   +4.772575731273807e-02   +6.346608075902238e-02   +8.509198573780753e-02; +1.858918006633368e-02   +5.865846905679852e-02   +1.145980271559086e-01   +2.513707762534264e-02   +2.179344928347563e-02   -2.611445349644809e-02   +7.635525798728799e-03   +8.811579674237563e-02   +1.094057857990364e-01   +6.737197610770593e-02   +3.666423990835124e-02   +1.397060130865425e-02   +3.158537573110831e-02   +6.275439572120642e-02   +8.925082622507716e-02   +1.899818029155329e-02; +3.733490957714919e-02   +5.012640154857294e-02   +9.345678983540280e-03   +1.220159158847423e-02   +5.369561013153189e-02   -5.693574706443085e-03   +7.439731803738944e-02   +2.601545015722277e-02   +3.570425920888895e-02   +9.632403902502361e-02   -1.563591625013318e-02   +8.232596643853235e-02   +1.204299454165478e-01   +1.390181079085809e-01   -3.818513430825290e-02   +1.528445499444619e-03; +7.692001925067964e-02   +1.551839134893915e-03   +1.634434459979316e-02   +6.732323161756999e-02   +4.885847534382425e-02   +2.054093104888904e-02   +5.699602002574621e-02   +3.667671730500933e-02   +8.302866756916753e-02   +1.192213232345323e-01   +5.129756233843304e-02   +1.043194097530433e-01   -4.703337793776471e-02   -1.497520078278451e-02   +5.408192511384037e-02   +1.098702044074037e-01; +5.930323713354166e-02   +2.668644480626063e-02   +2.661633435050105e-02   -1.560810505823041e-02   +5.388529719159721e-02   +1.308224838978649e-01   -4.901167095447557e-02   +4.883028877164247e-02   +1.249521069766158e-01   +5.360997580562950e-02   +8.982257589985980e-02   -5.962786583441043e-03   +3.109784130791690e-02   +1.487874763164756e-01   +1.061962033619257e-02   +5.988228209950312e-03];
L2I_L1I_iGABA_netcon = [+1.363478337239011e-02   +5.535098563294137e-02   +3.394591265183512e-02   +6.922858384705190e-02   +2.958383302444366e-02   -1.427066395861484e-02   +3.538826706247744e-02   +9.556998129831658e-02; +3.897939083277470e-02   +7.163848298607382e-02   +6.826060343222434e-02   +7.891976604158352e-02   -2.418585514424038e-02   +4.679136733096598e-02   +8.825989324369755e-02   +2.401628127480219e-02; +3.212041794639266e-03   +4.235871893146791e-03   +1.139802911613569e-01   +3.727497576009417e-02   +6.434533996267282e-02   +4.750909024317614e-02   +1.088493951448189e-01   +3.764256918999477e-02; +7.172183477405680e-02   +8.832582064987549e-02   +5.529059000776960e-02   +5.167048386157885e-02   +8.321561702012045e-02   +5.069912099284310e-02   +4.793408743272379e-02   +1.247159547540317e-01; +7.073222102554247e-02   +7.654183147084051e-02   -4.022003291944340e-03   -2.493829174340453e-02   +4.674906646362856e-02   +6.280101854150097e-02   +7.810865702010603e-04   +6.599321754178866e-02; -1.107711173871078e-02   +9.761600405896019e-02   +1.204631472222181e-01   +2.904416053864725e-02   +7.338428588327306e-02   +8.028656051832396e-02   +8.030537036018612e-02   +7.733368353256779e-03; +6.601047226236884e-02   +5.333807852321774e-02   -7.218487668140981e-02   +6.402782799218748e-02   +3.401491243665342e-02   -2.000680763780898e-02   +1.841051827827231e-02   +4.307747997400752e-02; +1.004973820779130e-02   +5.635251522129915e-02   -6.475650211887059e-03   +1.568962428756247e-01   +2.087632267357054e-02   -6.113204740602587e-03   +6.910769635950327e-02   +3.455430718581047e-02; +1.291703403700887e-02   +8.543422951010578e-02   +2.326111614323748e-02   +1.350770174235133e-01   +8.053213312244058e-02   +9.918444306173108e-02   +1.437386281897911e-01   +6.152408556023272e-03; +3.239631908624424e-02   +4.118973742237214e-02   -3.355425285242365e-02   +7.684415732397444e-02   +1.085779975023885e-01   -2.177547548138675e-02   -3.351847853019772e-02   -2.963073904125314e-03; +5.856508019048810e-02   +1.200657087404635e-01   +1.128755107870858e-01   +6.833171601318271e-02   +4.372234631001813e-02   -3.528186546901012e-02   +8.334178142263671e-02   +1.960117959034734e-02; +7.958564400704674e-02   +6.445601199675918e-02   -2.264062889699875e-03   +8.275420731842753e-02   +1.323884083047008e-01   +8.635589524809835e-02   +5.213768143819145e-02   +5.038444638389746e-02; +4.999295741209000e-02   -3.387406915670044e-02   -4.918058338205323e-03   +9.380492181698158e-02   +7.109846892159831e-02   +1.236134990488991e-01   +5.391988873234978e-03   -9.216752293862290e-04; -2.647059956309337e-02   +4.071183586172606e-02   +4.308306333074909e-02   -4.314362504928904e-02   +6.901464833800867e-02   +7.999639137512710e-02   +5.941374633284898e-02   +9.357200593208868e-02; +1.607825117446310e-04   +3.917602272835370e-02   +9.330981100722255e-02   +1.181162601799840e-01   +3.439946065342469e-02   +8.804984720638465e-02   +8.218628537170014e-02   +6.244816359769141e-02; +1.631111573778170e-02   +9.317359389561167e-02   +3.079848565078151e-03   +8.834129039624379e-02   +6.042372828579016e-02   +3.151409884895776e-02   +4.615252272254866e-02   +1.281522108806346e-02];
L1I_L2I_iGABA_netcon = [-4.163624613053371e-02   +4.164439225650870e-02   -2.745570239027066e-02   -2.173459922037423e-02   +1.269640884851512e-01   +7.897537873279589e-02   +6.405384919419944e-02   +1.034634684133237e-01   +4.982257801287902e-02   +5.288204509361576e-02   +7.891309982427512e-02   +5.786763761586357e-02   -4.179902032547082e-03   +6.284459490674645e-02   -2.024990362132625e-02   -2.251585498663460e-02; +9.253934287760639e-02   +5.071696832403373e-02   +5.264116094047488e-02   +1.708530322730847e-02   +5.165925290155342e-02   +7.459091451452783e-02   +1.443441242175059e-01   +1.010371205951331e-01   +1.033817861747730e-01   +8.358402849404963e-02   +6.236269731614535e-02   -1.555603637983330e-02   +1.077211006785960e-01   +2.003898783167651e-02   -1.065351564929690e-02   +5.075886291376059e-02; +7.091456481536239e-02   +7.704223625739148e-02   +1.149861500566593e-01   -7.011665110936427e-03   +7.245600985650359e-02   +5.485806438383065e-03   +2.960870097817239e-02   +1.815862783758691e-02   +2.239429025924861e-03   +1.625409113346448e-01   +7.215066929147490e-02   +7.201637885542927e-02   +1.537109231461753e-01   -1.273649481759473e-02   +8.552649280247338e-03   +1.550057940222723e-02; +3.371987261963227e-02   +1.058204738472075e-01   +6.846254385311118e-02   -4.304294916008107e-02   +8.331698627905289e-03   +7.747715641986551e-02   +4.592728689863600e-02   +5.462279131746264e-02   +3.167451255150350e-02   +7.738104104175411e-02   +1.083052799035137e-01   -1.285435903657227e-02   +9.550494960281328e-02   +2.445177542096574e-02   +3.081663720202908e-02   +1.291672787262264e-01; +2.874522714435605e-02   +5.379561250893174e-02   +1.023370207042170e-01   +2.088798355713900e-02   +1.206625875845327e-01   +1.308979680516450e-01   -4.226335545026549e-03   +6.439481408428993e-02   +5.115771545209686e-02   +1.285652082754777e-02   +3.919359260280669e-02   +2.214344148317791e-02   +2.670525356181011e-02   +4.036360574708010e-03   +1.062809210616604e-01   +7.668658580653254e-02; +3.070378613470057e-02   +7.337267277850057e-02   -3.153135406410219e-02   +1.370623275010778e-01   +1.159913313121325e-01   +4.563426826360831e-02   -2.148020062027262e-03   +5.297350828784929e-02   +5.898200910389669e-03   +1.847794083981272e-02   +5.471100974883829e-02   +3.387689380233499e-02   -2.426205058993888e-02   +5.298175831497081e-02   +4.960522866629469e-02   +1.381533455929514e-01; +2.185744018278363e-02   +2.307866274188978e-02   +1.623160172148210e-01   +4.358744200860595e-02   -3.633633036830036e-03   +1.027879677440497e-01   +5.237150615045456e-02   +5.199743739696161e-02   +1.011578025067227e-02   +1.165763563222062e-01   +5.649804784283448e-02   +6.306555879720536e-02   +5.724533035575866e-02   -4.190909543919038e-03   +4.605632415904505e-02   +3.381300807456118e-02; +2.714746299504758e-02   +3.073493463137802e-02   +7.874532858519438e-02   +7.628713971072931e-02   +1.290962004410158e-02   +1.180122151778082e-01   +6.913863469769456e-02   -2.232764289272822e-02   +1.407748295272846e-01   +3.035852313608893e-02   +1.285687757542236e-01   +3.341390650585352e-02   +2.392042612679014e-02   +4.581019657810838e-02   +5.061209691595880e-02   -3.156981375715362e-02];
L2E_L1E_iAMPA_netcon = [+3.326255116332408e-02   +6.998951516105770e-02   +1.153896805171226e-01   +1.130397290499753e-01   +2.452481796867884e-02   +7.595163207205186e-03   +4.255321011757506e-02   +2.109624156680388e-02; -9.271259368625231e-03   +3.579490113738372e-02   +7.290368901871733e-02   -1.562131952213811e-03   +6.979288280804974e-02   -3.213232637594353e-02   +2.612418846427485e-02   -1.794897426499915e-02; -4.065048842487288e-02   +4.169934409290413e-02   +6.531874701235964e-02   +7.848550792384733e-02   +5.492518364679316e-02   +9.783304705884829e-02   +1.476934356867872e-01   -2.105001343211532e-02; +1.208913193021320e-01   +8.919952819045998e-03   +3.060674129725081e-03   +5.468278215737239e-02   +1.740552531133725e-02   +8.633644599299489e-02   +6.891866454555198e-02   +1.075305487408068e-02; +1.314261205006927e-01   +1.042527887362807e-01   +5.196433443693205e-02   +6.026798928808315e-02   +4.358138472154148e-02   +9.578074871084276e-02   +2.161796260156656e-02   -3.142961125369668e-02; +9.520751372070038e-02   +5.374275626496992e-02   -6.888884331257926e-03   +8.956750790310056e-02   +3.361179832478639e-02   +1.268603090080172e-01   +6.645033465084585e-02   +7.574286631284077e-02; +2.048561280481062e-02   +9.705909897816048e-02   +4.150057656351732e-03   +6.624043964583907e-02   +1.657415858265535e-02   +1.430150437913777e-01   +5.401224327677875e-02   +1.124248554300991e-01; +7.638666065252842e-02   +1.393854537251559e-01   +1.141721472630769e-01   +1.090358230153524e-01   +7.327783860766993e-02   +2.351840079025161e-02   +1.015968894413575e-01   +9.354260014508259e-02; +9.513389496614119e-02   +1.816107043060924e-02   +1.053541240718437e-02   +9.058639401829885e-02   +1.536959603478218e-01   +4.962574601807948e-02   +5.692803495424821e-02   +9.009896930325044e-02; -3.690040045458332e-02   +1.127607571871170e-01   +1.134886973982858e-01   +3.349750539953258e-02   +1.100265728778645e-01   +5.136719527313353e-02   +7.892190982962835e-03   +8.150597859039139e-03; +3.462343595778583e-02   +1.020965787684972e-01   -4.619600097629109e-02   +2.771616974598165e-02   +9.794330703625679e-03   +6.942493494532637e-02   +9.252123846421643e-02   -6.127248012701090e-02; +7.871837296913609e-02   +9.382197181160579e-02   +4.021724994537026e-02   +2.960454913489968e-02   +7.609610538147833e-02   +1.571194477690152e-01   +1.672096275658119e-02   +1.003815587965431e-01; +4.833109279221207e-02   +1.026477277950678e-01   +1.498211277300602e-01   +2.029974191283021e-02   +1.011822525710744e-01   -1.303192478059473e-02   +1.440515837553791e-01   +1.204477742104439e-01; +8.977710132922757e-02   +2.885196313684956e-02   +7.048342876118933e-02   +4.978635518973749e-02   +6.530550180731766e-02   +6.483852165447609e-02   +1.036568401331181e-01   +1.067186249056770e-01; +9.147214791236027e-02   +9.810479814387522e-02   -7.850543395527281e-03   -1.167917619642122e-03   +3.624802177048118e-02   +7.440912025685538e-02   +6.961761552331559e-02   +6.189933987881442e-02; +7.081675593726262e-02   +4.440072209378933e-02   +9.167483510990121e-02   +1.011568995388120e-02   +6.131489451636612e-02   -2.648372536243022e-02   +1.150515272419499e-01   +3.012635587579247e-02];
L1E_L2E_iAMPA_netcon = [-2.173218604773870e-02   +8.099786824102845e-02   +1.093973147651836e-01   +6.367571353333350e-02   +5.461570929431672e-02   +6.677069982430046e-02   +6.343115165246578e-02   +1.123886862718821e-01   +8.758079870902238e-02   +1.908720694003455e-02   +8.757074269711383e-02   -1.163413342209617e-02   +3.060726351813850e-02   +3.102379408796242e-02   +7.985955381880452e-02   +1.317318607377723e-01; +7.337609552700552e-02   +4.546501287988342e-02   +5.128742669760369e-02   +3.814722096161684e-02   +1.677959009127626e-02   +7.857042414765024e-02   +2.836636397799661e-02   +3.835630791073009e-03   +1.779386144003170e-02   -7.288166787002254e-02   -3.584496609810926e-02   +2.543228337259980e-02   +2.979442354141951e-02   -4.627461469670139e-02   +2.060338502379331e-02   +6.561565266177331e-02; +2.955733043473779e-02   +2.450643471765509e-02   +1.134375080188733e-01   +4.637187386238950e-02   +2.292496851337979e-02   +7.342914409255835e-02   -5.439823217620705e-02   +4.996257782859012e-02   +5.113655563435556e-02   -2.272411147514614e-03   -2.229406132105093e-02   +7.636627519321512e-02   -2.959075179821672e-02   +5.457508511407335e-03   +5.151146601980450e-02   +5.859771592287352e-02; +7.574018702460367e-02   +4.717337102960417e-02   -1.118863467057967e-02   +1.391604046509045e-01   -2.442266964340095e-02   +2.979655347467428e-02   -1.415753765188138e-02   +8.137099455659384e-02   +1.229023563659988e-01   +1.462206751085893e-01   +1.741624477025738e-02   +4.151180483378159e-02   +4.552296113872672e-02   +3.327538986479451e-02   +5.764180696056911e-02   +1.504625434940609e-01; +4.781618217825811e-02   +3.453690784249531e-02   -7.841950932484191e-03   -2.352650161009569e-02   +1.085498010498810e-01   +1.540207930616268e-01   +1.632272286700580e-01   +8.218849911360085e-02   +1.414904476767462e-02   +2.538836713791109e-03   +1.871456473989428e-01   +4.776676167561557e-02   +4.984697101558527e-02   +1.068295073218677e-01   +4.473973334451286e-02   +2.853941666879362e-02; +2.263811389768061e-02   +2.394460420861134e-02   +8.366508604651358e-03   +1.846665577169488e-02   +2.268732935741459e-02   -4.176886549995270e-03   +4.951659528091808e-02   +8.182187865786829e-02   +1.012958997249186e-01   +6.728797342346363e-02   +1.541091024710159e-02   -1.281551561266288e-02   +8.697367217346763e-02   +9.543523980124040e-02   +4.605577556169174e-02   +9.059172581215438e-02; +6.489387967905513e-02   +3.207157502651463e-03   -8.461610104548385e-03   +5.052981890435813e-02   +7.765249548390815e-02   -5.858955295042409e-02   +5.765088759207522e-02   +5.472798956044042e-02   +3.097342514585423e-02   +5.082984555074430e-02   +6.711107166836702e-02   +2.092152248253539e-02   +6.345408396445557e-02   +8.070306410700909e-02   +1.274930937786395e-01   +8.504325560302461e-02; +4.406672456570251e-03   -1.701464730715890e-02   +9.621223920250574e-02   +7.068569684913188e-02   +3.867311590340348e-02   +4.440967134315377e-02   +8.299368073573990e-02   -1.259953266368170e-02   +3.891318116460568e-03   +9.524970836495043e-02   +1.130340105374850e-01   +1.230248410758756e-02   +5.396650394340766e-02   -1.232597072675159e-02   +1.004922197504886e-01   +6.119479668661758e-02];
L2I_L2E_iAMPA_netcon = [+2.510376110140229e-02   +4.267883836979361e-02   -1.043774020554079e-02   -1.647613882606391e-02   +1.047798047751415e-01   +7.612399773102721e-02   +1.520216101512502e-02   +3.983601024150758e-02; +1.064472129888191e-03   +8.136325378193145e-02   +1.418813210243701e-01   -1.033585436603252e-02   +4.248917168640028e-02   +5.309121278618505e-02   +3.024757977919187e-02   +1.410947143765830e-02; -7.273560832160623e-03   +7.343740896107573e-02   -4.870762367542034e-02   +1.218395045397661e-02   +7.316946072693525e-02   +9.394841190477290e-02   +8.321771628587436e-02   -4.131467855771207e-03; +2.833734825856866e-02   +1.013964251787813e-01   +8.948570432640847e-02   +6.337416924555643e-02   +7.778310148829777e-02   +6.402122656893031e-02   +5.479821593683634e-02   +3.292562900684741e-02; +8.816405140677400e-02   +9.553106258659576e-02   +4.884061359039431e-02   -1.962198772109992e-03   -4.643312063542352e-03   +7.458489199423216e-02   +4.034488882785793e-02   +1.268550690877272e-01; +1.657335411842942e-02   +1.870343838239669e-02   +1.396036692574964e-01   -1.117834445738563e-02   +8.500121322349036e-02   +3.955070106558413e-02   +3.233129115155949e-02   -3.593130581303748e-03; -3.900055167133456e-03   +3.434176314561715e-02   +1.100578678557225e-01   +7.003880044372042e-02   -4.507634438821068e-02   +3.846624842576786e-02   -1.770825449028515e-02   +1.387116719847603e-01; +2.349276422711031e-02   +3.425205019989001e-02   +1.283637782222033e-01   +8.299888431372487e-02   +1.148900667958767e-01   +6.722151442628690e-02   +5.182207984713715e-02   +2.671231696902081e-02];
L2E_L2I_iGABA_netcon = [+6.358462523182618e-02   +8.274707878629310e-02   +6.075193011293301e-02   +2.647288507511010e-03   +4.410800556498525e-02   +1.349894798724868e-01   +4.543325700049289e-02   +8.893758261804371e-03; +1.421633345128081e-01   +2.132779390709357e-02   -6.007642639675757e-03   +1.115612924278978e-01   +7.026369632437940e-03   +3.403619837504472e-02   -1.206191928609665e-02   +9.245211710748100e-02; +2.814923989512646e-02   +7.304656499359460e-02   +8.352587680498079e-02   +5.424831335523719e-02   +4.685020208959688e-03   +1.082694849400950e-01   -1.445450547322893e-04   +4.735068674098886e-02; +4.005507760005810e-02   +8.110214278835817e-02   +3.621195914998716e-02   +3.281106244332464e-02   +6.667953779667399e-02   +1.255970587706577e-01   +1.373752498880049e-02   +4.386720075483146e-02; +4.556939621767410e-02   +5.878893992953590e-02   +7.180073943872788e-02   +7.619027660933607e-04   +1.859278074607674e-02   +4.077351333157341e-02   +1.129704150489529e-01   -9.463363903690323e-03; +9.511190415102866e-02   +4.037657586312667e-02   +2.781495371295753e-02   +2.821023277437575e-02   +4.610767882813920e-02   +1.140753254665092e-01   +9.523166444721679e-02   -4.231444262331257e-02; +9.728748964574357e-02   +3.419305417271336e-02   +3.276790428801406e-02   +6.064815408456534e-02   +6.487021578098839e-02   +2.091903605538020e-02   +6.571487934400290e-02   -1.909420986649282e-02; +2.704803277946126e-02   +4.834249045959915e-02   +1.828630688211199e-02   +2.545765761686745e-02   +2.772330080375889e-02   +7.730243485301150e-02   +1.063004708441504e-02   +3.480477064109512e-02];
L3E_L2E_iAMPA_netcon = [-6.099944307575056e-03   +2.805961885635067e-02   -7.981044923963825e-03   +1.202498932062245e-02   +7.314239992760702e-02   +5.023665209933918e-02   +1.316392958392507e-01   +7.724065907093824e-02   +4.481658269800025e-02   +9.176245127620877e-02   +6.062611373182851e-02   +5.348334583900641e-02; +2.447490145226026e-02   +1.291009668596167e-01   +1.106834575784969e-01   -1.463814211607441e-03   +5.397391197544586e-02   +9.450621991653864e-02   +5.029200805386777e-02   -3.112808944596817e-02   +7.799955402180833e-02   -1.891963311606707e-02   +9.302574957453405e-02   +7.001726586797952e-02; +5.960186739230171e-02   +8.615197425058192e-02   +5.970888321333912e-02   +4.209477787189517e-02   +9.216867758220709e-03   +3.430448606272561e-02   +1.230687524150291e-01   +3.217818248371854e-02   +4.520486110531761e-02   +1.143193454930003e-01   +5.645646918948432e-02   +4.394946218266561e-02; -1.908254554922719e-02   +9.781688352382614e-02   +7.417994870747507e-02   +6.742490624526610e-03   +6.590313259661305e-02   +4.434542135149298e-02   +2.192493524968786e-02   +7.371113396791726e-02   -7.167220414585057e-02   +6.849019245493554e-02   +9.717496064126141e-02   -3.308299810193423e-02; +2.075306146060450e-02   +8.946101752631175e-02   +1.208874630931957e-01   +1.173751990609742e-01   +9.611390469219253e-02   +1.107973734353779e-01   +3.282922208677008e-02   +5.006803390007199e-02   +1.139235816768523e-03   +1.047362437856034e-02   +9.658279175656391e-02   +1.332727005874383e-02; +6.277426979128092e-02   +3.972446354853949e-02   -8.034707291826992e-04   +8.462714909966390e-02   +1.286114044563438e-01   +1.856717951879047e-02   +1.046857099433909e-01   +1.176236909553865e-01   +8.637009782313458e-02   +5.579297209098878e-02   +6.435565122135790e-02   -3.118915277496333e-02; +8.011826963661833e-02   +6.177371964954360e-02   +4.075032939606075e-02   -1.745969348395572e-02   -8.750745691953263e-04   +5.010127713957097e-02   +3.821284314333746e-02   +1.809963468058657e-02   +4.493134630476930e-02   +2.814638740267014e-02   +1.386855606376266e-01   +1.260189126547595e-01; +4.316619928325030e-02   +1.031811655173753e-01   +7.325531057293988e-02   +8.244576224368158e-02   +6.177449458398264e-02   +5.700368674289655e-02   -4.883378328927238e-02   -9.031228593804688e-04   +2.577008303491461e-02   -2.282156965697383e-02   +1.681924082721458e-02   +9.465029069452568e-03];
L3I_L2I_iGABA_netcon = [+1.424175808610809e-01   +8.528072134875170e-02   +9.888151737090095e-04   +6.331008104334880e-02   +4.067109765136247e-02   +6.782242607779383e-02   +1.178696413357104e-01   +5.087781477777881e-02   -9.928543106031168e-03   +4.307594222658979e-02   +1.035683617027297e-01   +5.176503193976903e-03; +4.263419822538415e-02   +7.385904210487400e-02   +5.867372455823792e-02   +4.388879477312851e-02   +2.297422227379642e-02   +5.051239987432210e-02   +7.449346460323089e-02   +1.965475301032767e-02   -4.882739507438206e-02   +9.321398313866737e-02   +1.169304663768818e-01   -5.606801354928814e-02; +9.544580507834077e-02   +1.059479767749971e-01   +1.014502680079492e-01   +4.803178113246284e-02   +1.233186164459383e-01   +6.813196070291422e-02   +4.967325233638578e-02   +2.677541469892169e-02   +1.322906247144782e-01   -6.866491729748530e-03   +9.738292925496651e-02   +7.249792530558413e-02; +2.980165036792449e-02   +1.049242194293354e-01   +8.272637858774286e-02   +2.538998344857819e-02   +1.121482843085106e-01   +1.450420708279741e-02   -3.034030989985138e-02   +4.561398756684982e-02   +9.727755542602838e-02   +7.635642668545124e-02   -2.894193679549304e-02   +9.285487608511879e-02; +3.010462974551070e-02   +4.020934183601312e-02   +1.184832153696778e-01   +8.323197320413339e-02   +1.343595061766307e-01   -9.247020786935945e-03   +2.723810190059342e-02   +1.087180525676432e-01   +1.519951470931436e-02   -1.153176146813365e-02   -1.249322466119266e-02   +6.422699890804422e-02; +8.680643760364637e-02   +1.122866899644549e-01   +1.016903404867696e-01   +3.550070101325944e-02   +2.887212824876354e-02   +7.678431789415011e-02   +4.761078292093008e-02   +8.973502696594265e-02   -3.503383154119968e-02   +3.082534066420746e-02   +9.159137551666552e-02   +2.778926983399195e-02; +5.280254742584013e-02   +1.796476564863779e-02   +8.448058221416233e-02   +8.692477812173000e-02   +6.610418784095201e-02   +7.189083780965096e-02   +9.121571289229869e-03   +3.261404236348886e-02   +2.454011295392174e-02   +2.655933460930492e-02   +1.059176381991962e-01   +9.375747475947618e-02; +1.377296961641794e-02   -1.955669037574109e-02   +8.362438500996371e-02   -5.334408656697416e-02   +1.163353202862534e-01   +1.031777965389868e-01   +1.062856959362335e-01   +7.531815504133237e-02   +3.480564867324917e-02   +1.023541358258763e-01   +9.519011461476276e-04   +7.427561285335618e-02];
L2E_L3E_iAMPA_netcon = [+1.614491806718439e-01   +7.060548631140268e-02   +1.185535057594306e-01   +1.884452721988082e-02   -4.072719645676470e-03   +9.734761086282848e-02   +2.355022478323498e-02   -2.106454139346228e-02; +5.331181134565284e-02   +1.152899458572924e-01   +6.719068667628265e-02   +2.924630829306705e-02   +1.250130284756996e-01   +7.105524677830799e-02   +5.086865878511232e-02   +8.991840371774798e-02; +4.061598927740821e-02   +6.149279045508238e-02   +3.876714750047110e-02   +5.899296479365016e-02   +8.201109670288251e-02   +1.020435045670262e-01   +9.137274702671676e-02   +3.170102465026016e-02; +1.067139919095103e-02   -9.029895319154982e-03   +3.849792131472241e-02   +1.165919334660334e-01   +8.056007564783371e-02   +1.465070381590145e-01   +8.262704870955268e-02   +5.895607880470308e-02; +9.762595676801097e-02   +1.110075260677061e-01   +8.843193448913830e-02   +1.365174430250807e-02   +1.160705393849891e-01   -1.887139476615447e-02   +7.521118412302558e-02   -4.721933695917878e-02; -1.707014108988272e-02   +1.384432059949730e-01   +2.548306511141156e-02   +9.378509589468467e-03   +1.684170840729806e-01   +2.597406628224721e-02   +6.127085189975907e-02   +7.150087443260850e-02; +3.835363797804234e-02   +1.211648382232727e-02   -2.517748651219092e-02   -2.905211950796254e-02   +4.823438053623253e-02   +2.483983136424934e-02   +2.572913792680820e-03   +8.805297665460363e-02; +4.349879417241932e-02   -3.935457636873772e-02   -1.999984411143722e-02   +2.334454715316286e-02   +1.126554788596233e-01   -5.505638697699267e-03   -4.722824034438237e-03   +6.727732896539214e-02; +1.138784559452631e-01   +8.510989231168870e-02   +1.105256432265007e-02   +5.872243260959541e-02   +2.583262362426502e-02   -5.248146170815631e-03   +8.030813098445008e-02   +1.024510076899270e-01; +1.549195201097564e-02   +4.223272033261130e-02   +7.483368167395174e-02   +4.429670476534762e-02   -2.441571607091984e-02   +4.037530234473999e-02   +2.074251664930725e-02   +5.261347737702632e-02; +4.843653139331627e-02   +2.352300449853526e-02   +9.439529766228547e-02   +8.093806601440609e-02   -2.299094346018725e-02   -1.155836065959382e-02   -1.869763972176877e-02   +7.792958507811899e-02; +6.392556632982871e-02   +3.253405065621234e-02   +1.137352643948684e-01   +5.688935197510442e-02   +3.170315536731609e-02   +2.847389265616895e-02   +6.141662462273169e-02   +8.702487490626541e-02];
L2I_L3I_iGABA_netcon = [+2.425695410773080e-02   +3.343840359101475e-02   +7.531581070253784e-02   +6.711896645424063e-02   +5.757342578322205e-02   +4.912201931509756e-02   -2.282485995997654e-02   +5.357800557569058e-02; +4.542682720658031e-02   +1.094962514915843e-01   -2.427189970208888e-02   +1.187921240473080e-01   -5.205234994146710e-02   +8.327645450090025e-02   +2.898030006260707e-02   +4.507103947011857e-02; +1.754139088649011e-02   +1.383129370970558e-01   +1.133835031302466e-01   +8.473952671417345e-02   -3.191966772956929e-03   +5.493015128312530e-02   +7.426447219108899e-02   +1.085587867461661e-01; +3.801804568898098e-02   +3.131108544277521e-02   +9.418682436818358e-02   +6.852203357262890e-02   +3.610513174572992e-02   -8.292478885100905e-03   +8.001792708703104e-02   +6.655498027756566e-02; +5.945151870012712e-02   +1.294087807217100e-01   +1.130741901135140e-01   +6.690089992836259e-02   +1.764504977955867e-02   +4.544551586624582e-02   +1.043146211343830e-01   +1.542058688657214e-02; +8.206986086286901e-02   +5.956896173722620e-02   +2.491213594649038e-02   +1.217410741838444e-01   +2.835001449047933e-02   +1.602136201633754e-02   +9.266772113998917e-02   +2.756017248777165e-02; +2.973003785981660e-02   +5.723222572231994e-02   +3.089951620955817e-03   +7.679267690386521e-02   +2.276176426590207e-02   +2.835917735499957e-02   +1.833317590112007e-02   +4.392514645402167e-02; +2.858827305618033e-02   +8.327488195617965e-03   +1.108282965764386e-01   +4.793048889828717e-02   +1.097860363989477e-01   +3.719988977560990e-02   +3.477730139355686e-02   +4.718697322951126e-02; +4.377604577998803e-02   -6.258906231594543e-03   +6.376234108003369e-02   +1.188909162986281e-01   +7.775934576064397e-02   +3.888193329539345e-02   +3.721704546854514e-02   +1.110771594670286e-01; -3.176160317406738e-02   -2.151161238505038e-03   -1.367706178741752e-02   +6.120457236773300e-02   +1.050649392331003e-01   -2.767616339170668e-03   +7.306270918279203e-02   +1.220120471196311e-02; -5.272617160610476e-02   +1.139622828902877e-01   +3.338839410759280e-02   +6.598595823906045e-02   -6.624670561981785e-02   +8.675065848397809e-02   +3.642763357040209e-02   +2.909810495094615e-02; -5.767871576121469e-02   +1.990829680842106e-02   +5.576660422955040e-02   -1.532008227932133e-03   +8.506926458306548e-02   +1.057665825014752e-01   +2.246060514427950e-02   +6.868762818737944e-03];
L3I_L3E_iAMPA_netcon = [+1.660763419001005e-02   +8.691364389193514e-03   +3.309873636005124e-02   +1.281835267877761e-01   -1.966303844892158e-02   +1.117145167333723e-01   +8.396882374765133e-02   -1.065609478954468e-02   +1.384495622284103e-02   +8.716383173355671e-03   +1.309630130210986e-01   -2.953380510442642e-03; +4.429811628728772e-02   +2.524712682651902e-04   +6.979010659566298e-04   +8.761573340588349e-02   +7.987326256434152e-02   +4.142822470189466e-02   +9.544865043717296e-02   +9.851602604094095e-02   +3.707707647444768e-02   +3.936223704896786e-03   +4.823271470708825e-02   +1.128715230075289e-01; -2.833435892197089e-02   +1.038463743142758e-01   -2.627702784143519e-02   +1.044945248306267e-02   +9.233648527639411e-02   +9.850816736678278e-02   +3.350518781407634e-02   +1.831906200573464e-02   +1.784902921329740e-04   +8.617815369102860e-02   +4.612270161059286e-02   +8.819593101875355e-02; +6.256882395522331e-02   +2.001240447604691e-02   +3.183238523087051e-03   +7.031245079402974e-02   +2.948290135862659e-02   +3.335614466923922e-02   +6.700819754489033e-02   +8.231109121432115e-02   +6.017278313783713e-02   +9.248474425317835e-02   +4.466477115457878e-02   +4.416058425821378e-02; +7.231233114788627e-04   +1.136103664757727e-01   +1.280347949944584e-02   -3.676744533409727e-02   +6.311046580200878e-03   -1.789640982951534e-02   -7.818276104549085e-02   +6.701771949566232e-02   +3.153014323183443e-02   +9.454818161510175e-03   +4.042551933797699e-02   +1.303920389439322e-01; +4.467885949058783e-02   +7.259197810276069e-02   +5.525186925425132e-02   +1.303859060033237e-01   +2.575490343950571e-02   +8.973120457592215e-02   +6.383080769193894e-02   +2.978183846400200e-02   +7.198717310050422e-02   +4.691992748376958e-02   +9.986989855753942e-02   +5.030521323047161e-02; +2.632239717689515e-02   +7.339794718726536e-02   +6.233845417073184e-02   +5.062511331254602e-02   +5.486971523464652e-02   +7.022518469567435e-02   +6.609192815699999e-02   +1.556504943937786e-01   +9.033944140188037e-03   -8.061663846331368e-03   -5.382119352520958e-03   +2.957994276782620e-02; +8.929123981227002e-02   +9.949935974653062e-02   +8.477404302808921e-03   +1.140061982314653e-01   +5.286214074301754e-02   +2.492347809901763e-04   +2.020660322050219e-02   +1.046057970872991e-01   +6.126056890191646e-03   +3.422204619376628e-02   +2.132876269883285e-02   -2.089141027632532e-02; -3.282309812944672e-02   +2.393252500364500e-02   -1.653727663182819e-03   +3.987409744028671e-02   +8.158765944228200e-02   +2.432388719843827e-02   +5.617046971073847e-02   +4.976834878088587e-02   +2.263910335281327e-02   +8.272275313489760e-02   +5.138766026892395e-02   +5.315855567303516e-02; +6.850316642327078e-02   +3.660217867353824e-02   +4.331644093802868e-02   +9.669112869770027e-03   +6.115956997924538e-02   -2.187951318793043e-02   +8.188334367151644e-03   +1.289326027710128e-01   +7.780170561685959e-02   -2.386113883478820e-02   -1.470754131073241e-02   -6.534373470704530e-03; +9.184382065749172e-02   +2.258955910030750e-02   +3.187106039651286e-02   +1.711218609967099e-02   +4.824607969757885e-02   +5.304728069922202e-02   +5.351113548329881e-02   +8.411940581406792e-02   -8.549962072288402e-04   -2.144914939484767e-02   +1.169478214978980e-02   +6.168074114727624e-02; +6.898344341789633e-02   -3.238653152060286e-02   +8.923584274326135e-02   +1.534085248581022e-01   -2.444794192013911e-02   +1.042636146376722e-02   +1.328115761646897e-01   +6.142122928431769e-03   +1.065296147003795e-02   +4.601443046229803e-02   +4.790362788038141e-02   +1.106422498990943e-01];
L3E_L3I_iGABA_netcon = [+8.713828034272435e-03   +5.830107959287610e-02   -1.204591018941619e-02   +1.327592316496286e-01   +8.203337474517054e-02   +8.813139381607527e-02   -5.210959789035699e-03   -4.636957270772377e-03   +1.056854813779550e-01   +1.129832765575300e-01   +8.414128648296418e-02   +6.901705141899990e-02; +1.116436138638131e-02   -1.388342676303081e-02   +1.584584756595321e-01   +6.058232251980984e-02   +4.367868398150887e-02   +3.519478449810014e-02   +1.257185050028824e-01   +5.810528544361877e-02   +4.280044420846976e-03   +1.219790633375746e-01   +7.141040905705498e-02   +5.009795353240792e-02; +5.486972297705795e-02   +6.364120505430304e-02   +8.294879780172493e-02   +1.291530566517351e-01   +4.720689082266687e-02   +5.295859419233582e-02   +4.278754070867896e-02   +3.561407676988775e-02   -7.608259975178272e-02   +1.062195967140595e-01   +4.767247680862067e-02   -1.469065406443162e-02; +4.988080955334222e-02   +7.342489109456020e-02   -3.241488737506915e-02   +2.228931588663918e-02   +1.953809990465973e-02   +1.106129923059176e-01   +3.046469476373779e-02   +3.881775429999687e-02   +2.604149552192486e-02   -9.232485939964424e-03   +7.989406490831227e-02   -2.561851672271212e-02; +1.040535688612284e-01   +6.253287211722244e-02   +1.162596104139179e-01   +2.528970875551787e-02   +2.759692625431526e-02   -8.273832225276929e-03   +6.437157605398811e-02   +3.762840826237522e-02   +1.043665776079170e-02   +1.468741127849796e-01   +2.587987217602856e-02   +6.242424963794050e-02; +3.569940143524636e-02   +6.003495626177394e-02   +2.297960687439420e-02   +3.133841210540953e-02   +3.526101661508511e-02   +9.658915488011068e-02   +2.410168425377393e-02   +7.369982423846566e-02   +4.725960481236689e-02   +6.180546942266398e-02   +1.813335043576129e-02   -9.566459691981666e-03; +3.933079745360814e-02   +3.519930389539916e-02   -3.525408952919892e-02   -2.991849180719089e-02   +1.858982893736641e-02   +1.348421672335098e-01   +4.742137826092004e-02   +9.689957125573360e-02   +2.933809997861769e-02   +4.125592129361445e-02   +5.323205186695516e-02   +2.386652815840513e-02; +9.467134154666955e-02   +6.298739715369485e-02   +9.624242653392498e-02   +1.451350492330713e-01   +7.405187217445777e-02   +3.137974108916208e-03   +2.474542672289697e-02   +7.013735801188414e-02   +3.884517848215140e-02   +5.847900767159273e-02   +7.510337251726168e-02   +4.016962696162789e-02; +3.471582260087079e-02   +7.600295125599496e-02   +1.437833346328392e-02   +4.996764196840926e-02   +1.386049859663506e-01   +6.724166894746046e-02   +5.484067212629652e-02   +4.333146280420815e-02   +1.026674383922438e-02   +1.129231825738213e-01   +6.421476695774808e-02   +7.583212798308320e-02; +1.960454121025115e-02   +5.998546300876016e-02   +2.928618366643845e-02   +1.983291147836130e-03   -1.788508899752767e-02   +1.706682951549696e-02   +4.441272623340636e-02   +4.323864798526723e-02   +2.988696382074966e-02   +6.149258930149302e-02   +2.158602681116257e-02   +8.081811437010671e-02; +4.321132274251573e-02   +4.112906185133840e-02   +3.611985179979228e-02   +1.017440381930075e-01   +4.228203175224265e-02   -2.667656018333936e-02   -1.609910573589908e-02   +1.904415964213987e-02   +5.025799040077827e-02   -4.188139883832104e-02   +1.369064141772186e-01   +9.364530787735303e-02; +3.333229924270530e-02   +5.193085551625775e-02   +3.020870813229141e-02   +3.067020942544316e-02   +1.066997053456780e-01   -9.253055600502571e-03   +1.075981285232681e-01   +4.675661873452643e-02   -1.002576404851717e-02   +6.578796541231643e-02   +1.738722163285378e-02   +5.601427938332951e-02];
L2E_Input1_iAMPA_netcon = [+5.771642288377404e-02   +3.571598992429238e-02   +8.662819977568319e-02   +9.413958316182580e-03   +3.482959239870419e-02   +3.512336521772055e-02   +8.475998613724860e-02   +8.125114091382288e-02];
L2I_Input2_iAMPA_netcon = [+5.767411072807180e-02   +1.578557322968365e-02   +9.845471279774218e-02   +1.416310008794541e-02   +3.720349253698335e-02   -6.724853997036317e-03   +1.211037240053712e-01   +5.992996975791415e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
