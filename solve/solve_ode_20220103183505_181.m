function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.128488658510485e-01   +9.485365154728591e-01   +7.017779613571510e-01   +1.624485261069554e-01   +9.226934293620712e-01   +2.124261365567111e-01   +7.429081897688632e-01   +3.060374537961795e-01   +5.353621665997265e-01   +8.340646988640430e-01   +9.708550622451021e-01   +9.708456546948109e-01   +6.996770406405827e-01   +3.702455384081326e-01   +2.969458390439074e-01   +3.811408314317055e-01; +3.501710234651154e-01   +1.263999034054529e-02   +1.403569971921940e-01   +1.723734677429959e-01   +7.700525572061921e-02   +8.105803244157281e-01   +7.988407643089205e-01   +7.569392936920375e-01   +7.908570798966026e-01   +1.852404374014603e-01   +4.748785150641456e-01   +6.651725631281373e-01   +3.698092404283979e-01   +2.780810807472537e-01   +6.843642592498650e-01   +9.608405338073990e-01; +2.006867685340940e-01   +4.768258835219902e-01   +8.039943947578038e-02   +7.086375127445543e-01   +3.131301304569634e-01   +3.822979731410694e-01   +6.601441053098417e-01   +9.543505195767791e-01   +4.770180819982549e-02   +9.256312337586468e-01   +8.734418664563172e-01   +2.022211491525963e-01   +5.460252274049784e-01   +7.144078953534774e-02   +7.790035965039609e-01   +8.126702599486664e-01; +2.339417566065686e-02   +4.879782495023163e-01   +4.335775055291932e-01   +8.406878965539917e-01   +6.358072078241542e-01   +8.663914369154785e-01   +4.412637136035065e-01   +7.095189904229080e-03   +4.647139654208726e-01   +4.229045174511425e-01   +9.427688340530104e-01   +8.979796485677308e-01   +5.140514029241394e-01   +1.536461532487504e-01   +7.185934560798184e-01   +8.935073797849954e-01; +7.664757029145982e-01   +5.193016602014631e-01   +9.014937731109520e-01   +7.973049617196182e-02   +9.091231531702733e-01   +3.212761134043031e-01   +5.815994512319651e-01   +4.040734347403535e-01   +9.413747226508220e-01   +2.989014330696362e-01   +2.374380938538265e-01   +4.831551340459589e-01   +7.668873422142637e-01   +3.672678303796955e-01   +2.758480493689540e-01   +7.172625862848477e-02; +5.734604668671118e-01   +2.843817349127631e-01   +7.257973133853711e-01   +8.382938543185379e-01   +7.985857196158361e-01   +3.817232765529105e-01   +5.164846268896279e-01   +1.551476225709588e-01   +4.740211993262228e-01   +3.504422281756249e-01   +9.227224983279645e-01   +6.639356685048561e-01   +7.460738823788809e-02   +7.149194241644696e-01   +1.836264991490788e-02   +9.043603828790935e-01; +5.811994839226722e-01   +5.640610572488176e-01   +6.825753211522998e-01   +5.486966586439646e-01   +6.455948148285483e-01   +6.439868923275459e-01   +7.253093411215715e-01   +8.263753355944785e-01   +7.781500121916906e-01   +9.745312784389750e-01   +6.343071982705173e-01   +5.262727985341020e-01   +4.457856009724105e-03   +5.356716880613387e-01   +1.624065638877922e-02   +6.715966693919975e-01; +3.875716517365081e-01   +5.127334760371105e-01   +2.058065200579431e-01   +9.662864753034688e-01   +4.423557348482385e-01   +3.887587256345717e-01   +2.194292675678310e-01   +2.860499740815414e-01   +1.115695611685473e-01   +5.357206436964242e-01   +2.888526190963154e-01   +7.040044615886217e-01   +4.072344795987924e-01   +2.332608334413634e-01   +9.343411652157254e-01   +3.464851898164072e-01; +5.547767062564823e-01   +6.699874882909490e-01   +5.268983200821060e-01   +6.742288164987169e-01   +7.508588000560854e-01   +7.311318366780845e-02   +9.988929038705188e-01   +9.782495561126422e-01   +5.187366276591640e-01   +7.909353237824431e-01   +8.495311757582081e-01   +7.198080223237862e-01   +6.605343118950600e-01   +4.729858496210178e-01   +9.345629657181115e-01   +8.426853393531657e-01; +1.859161336344240e-01   +6.184979360591412e-01   +8.263725136726497e-01   +3.350489731519340e-01   +8.301073128357020e-01   +1.819344239029721e-02   +6.215582950743823e-01   +6.236841613608910e-01   +6.381089775118521e-01   +7.999222704649982e-01   +1.610112205146073e-01   +2.938020983713833e-01   +3.749340269207512e-01   +7.198613655022779e-01   +3.748378368159853e-01   +1.952699666744691e-01; +1.197839170092864e-01   +5.660166476207602e-01   +1.799725916772832e-01   +2.191204707118126e-01   +3.467661903538494e-01   +8.762018994003745e-01   +9.856783654771969e-01   +7.465174424663791e-01   +5.781446343912404e-01   +1.399310140928098e-01   +8.277481561195948e-01   +1.153693473232236e-01   +3.973247956055403e-01   +5.213602185132137e-01   +1.051712204994372e-01   +8.444913108569434e-01; +5.661955785787477e-02   +5.057094093846044e-01   +5.150327696752929e-01   +5.716047874175642e-01   +1.460993648897708e-01   +1.554852375979678e-01   +4.957371995181918e-01   +8.830190179522047e-01   +8.385389394925662e-01   +4.548736692905832e-01   +2.183466860992662e-01   +3.283495717539817e-01   +1.357412433430865e-01   +5.181275644063591e-01   +7.238134176415069e-01   +4.252184116016284e-01; +9.389946646606830e-01   +6.608215653434593e-01   +3.561100595699895e-01   +3.654769528917821e-03   +5.041641450868112e-01   +9.221730352005921e-01   +5.212692433512184e-01   +3.313825640942610e-01   +1.161758265249777e-01   +4.541479998544520e-01   +2.671558244409772e-01   +4.631902606242864e-01   +3.386835580559269e-01   +3.890180669663290e-01   +4.530822482842004e-01   +5.605007183738183e-01; +7.453267630084512e-01   +6.400174409243600e-01   +6.533712599717479e-01   +5.938570262435400e-01   +4.154078109069816e-01   +5.631782260639979e-01   +8.557488038517440e-01   +9.329712909516616e-02   +5.207062183691460e-02   +9.623142805901672e-01   +8.977427141650492e-02   +7.165226276699154e-01   +1.229035447431929e-01   +4.814442345554267e-01   +1.438925990208364e-02   +4.471891389381226e-01; +2.389346565677292e-01   +1.410666067427049e-01   +2.787163580412642e-01   +8.973692255250729e-01   +1.760821086599158e-01   +9.235005361891586e-01   +2.507097999477599e-01   +4.469507262150073e-01   +5.244248536964119e-01   +5.280546416197868e-02   +9.163434268592592e-01   +4.016081005979864e-01   +3.688614305065242e-01   +7.438712606301147e-01   +1.203668210286807e-01   +7.616061404792650e-01; +2.028894395756778e-01   +1.776206240496238e-01   +4.333136843752477e-01   +2.585660228554682e-01   +4.948972560105411e-01   +5.999048096333913e-01   +5.768815650405047e-01   +2.373593424262052e-01   +7.019020065606099e-01   +3.937721027897112e-02   +7.302755031699600e-01   +2.397002395634899e-01   +2.480554830571404e-01   +7.066217437638888e-01   +6.583801596047885e-01   +9.721475083631645e-02];
L1E_L1I_iGABA_netcon = [+8.392281346045412e-01   +7.498556109317268e-01   +8.745988494645583e-01   +4.383354773262418e-01   +9.223533635536050e-01   +7.699622382575688e-01   +3.214393436936576e-01   +6.406154644606150e-01   +9.299481420523195e-02   +2.918335950008592e-02   +1.348458265014269e-01   +5.215015588513656e-01   +8.722081837315745e-01   +5.754187444680522e-01   +1.714536626068713e-01   +6.301277238440716e-01; +6.158545466870954e-01   +9.930634448857948e-01   +3.121577477340866e-01   +1.479973826962524e-01   +8.846243494276695e-01   +2.753831587434526e-01   +9.666959370680533e-01   +4.363364760951579e-01   +2.939439215021408e-01   +5.089952632705272e-01   +4.296588433904923e-01   +2.028216112075650e-01   +8.059840526702695e-01   +2.896850548112043e-01   +5.815636373308616e-02   +3.400168633793071e-01; +6.670778893932846e-01   +3.725172179670665e-01   +4.327027433498600e-01   +6.505493420874837e-01   +5.886059691943415e-01   +5.236270101072197e-01   +3.526645975863075e-01   +4.835489947531695e-01   +3.297208888884594e-01   +8.643810495671136e-01   +4.821194248408771e-01   +7.710980807049113e-01   +6.405385131808637e-01   +1.376433604100482e-01   +2.136330560809672e-01   +1.534561981182962e-01; +7.817870792338593e-01   +5.028409506249162e-01   +3.807748912031054e-01   +7.261500059710874e-01   +8.388052397883731e-01   +4.076424516400320e-01   +3.210215736417494e-01   +9.972881403045508e-02   +4.796761978990666e-01   +5.831061726690352e-01   +6.720492372351163e-01   +3.868129154026983e-01   +7.329960900330428e-01   +4.437776262093446e-02   +2.082112391094187e-01   +4.001068290059167e-01; +3.116669732755764e-01   +7.535135191871268e-01   +6.561547522016968e-01   +1.686641485146325e-01   +7.788158301223144e-01   +7.825834104287388e-01   +9.134024340999376e-01   +8.067955792954341e-01   +2.420828805369187e-01   +4.246875189055874e-01   +3.533621226604611e-01   +6.672824285687916e-02   +6.693545241134045e-01   +6.218877048080763e-01   +2.176398726480938e-01   +9.133046634416471e-01; +3.281020802132080e-01   +1.338661625972789e-01   +2.445592308080120e-01   +3.408728636900709e-01   +7.879464638115823e-01   +2.643772608411875e-02   +8.832784690772383e-01   +5.992190542137824e-02   +4.580589986980904e-01   +7.179361039136120e-01   +4.904578433809655e-02   +7.559116591569930e-01   +8.888739242555119e-01   +6.056892875452968e-01   +5.792319823399550e-01   +1.567499599858870e-01; +6.333849214038316e-01   +5.148232132743721e-01   +6.855008160151305e-01   +1.060062836545100e-01   +6.953868700152974e-01   +4.083293873796370e-01   +3.575226272291452e-01   +9.573074098885561e-01   +7.583872093421236e-01   +2.302751884908084e-01   +2.935593419053030e-01   +4.569735524468896e-01   +8.538765994451488e-01   +3.716916399177635e-01   +3.651979515209957e-02   +4.678053254785183e-01; +9.014329205398802e-01   +9.049508345349760e-01   +3.306305084922688e-01   +4.309712798894413e-02   +2.107680378137147e-02   +8.282711398246116e-01   +7.458008229976293e-01   +7.700097578369337e-01   +7.141697729686297e-01   +5.626861166691020e-02   +7.973664109119233e-01   +3.186381488038702e-01   +4.094013956754438e-01   +8.342330934542740e-01   +7.955006870930181e-01   +7.767003279747831e-02; +3.734592624244144e-01   +1.018606410160370e-01   +8.762949869971949e-01   +4.751619266536790e-01   +3.243726942693735e-01   +5.903926661924734e-01   +1.254991989729830e-01   +4.434708277053447e-01   +2.297871803677335e-01   +9.799241071101974e-01   +6.527649522723474e-01   +2.750498583691797e-01   +1.098667090240767e-01   +5.164461181230817e-01   +1.352880601244006e-01   +3.377508563712853e-01; +8.833291491113795e-01   +1.802348253403172e-01   +9.983301359538178e-01   +4.777972231983507e-01   +9.441830033052538e-01   +2.122491131770141e-01   +5.939803239960657e-01   +1.637607839387767e-01   +7.026382845117053e-01   +9.716617206710305e-01   +7.066118020614829e-01   +5.751641718495326e-01   +4.077441609002146e-01   +8.072876046564067e-01   +5.785325816614502e-01   +4.925437353112266e-01; +1.185871114452254e-01   +1.794488661215981e-01   +6.852358011799869e-01   +5.500086854774322e-01   +4.051426842712481e-01   +2.961603743764482e-01   +4.401292699861669e-01   +8.323360428655804e-02   +3.064373265172383e-01   +1.354211883818644e-01   +7.588944109963019e-01   +9.079089941952360e-01   +3.378684133884538e-01   +5.732889497933422e-01   +8.461451053391386e-02   +4.966640210286475e-01; +9.240761348475021e-02   +5.393523605473524e-01   +3.441616146315031e-01   +6.517628502178768e-01   +6.298719084028686e-01   +2.664355921763327e-01   +9.613433880646504e-01   +7.397696110147037e-01   +4.647261658270502e-01   -1.214330175043069e-03   +3.896522085678545e-01   +4.503380720511092e-01   +1.137872177581724e-01   +7.124647763979438e-01   +2.251404450226271e-01   +1.294554446312101e-01; +5.440981824621117e-01   +9.747040349931445e-01   +5.619038482924319e-01   +3.493890429641876e-01   +8.536398553497675e-01   +9.329413860746014e-01   +9.711119059451421e-01   +5.362262840661205e-01   +4.416960931257554e-01   +9.292237903660453e-01   +3.643059159128870e-01   +9.803166388393827e-01   +8.576015995944671e-01   +7.371440530695124e-01   +4.497465675205001e-01   +7.952377187098714e-02; +6.034024740096590e-01   +8.448947972630922e-01   +8.940093046749535e-01   +2.538251132695789e-01   +3.715175687673492e-01   +5.539472536194272e-01   +2.474098965491169e-01   +4.870152381754545e-01   +7.314025145848371e-01   +7.381424416606496e-01   +8.134842637302891e-01   +1.064488344370012e-01   +8.940467668314873e-01   +4.467930965650890e-01   +1.778411055873931e-01   +6.741217519163381e-01; +7.265920931316354e-01   +6.707814533747035e-01   +6.489246630662791e-01   +1.808402849415535e-01   +2.019438596170160e-01   +4.320740385310617e-01   +7.741841939052325e-01   +8.877285874583678e-01   +8.736836944636786e-01   +4.291167279049126e-01   +3.913167657299471e-01   +4.223381293579689e-01   +6.882908080344461e-01   +2.826466401172896e-01   +4.140791593079535e-01   +1.207047314355745e-01; +9.926485963464169e-01   +1.314200369711168e-02   +3.775284412140704e-01   +4.747052007327180e-01   +9.074136097875469e-01   +3.244703776833225e-01   +7.103077380643712e-01   +5.833167359035807e-01   +9.103178881951889e-01   +9.477056347193220e-01   +8.726921776787279e-01   +3.877504402879426e-01   +7.482726901145220e-01   +1.529718535612257e-01   +9.672583248447441e-01   +9.906773388302914e-01];
L2I_L1I_iGABA_netcon = [+5.754229430483884e-01   +5.633880992433462e-01   +1.042496720276456e-01   +4.535138145090682e-01   +7.948461566390914e-01   +9.772179754119663e-01   +2.239366387768953e-01   +7.600868918055941e-01; +5.635973127030627e-01   +9.526832053108294e-01   +1.249139684749889e-01   +5.690677993442143e-01   +5.457936754234739e-01   +4.255520238277306e-01   +6.504987978941355e-02   +4.990916061164164e-01; +6.101912853416416e-01   +9.812339786500949e-03   +4.323340342304786e-01   +8.177895281205290e-01   +2.598140502399972e-01   +3.939126911603214e-01   +8.305853213168201e-01   +8.283517817170925e-01; +4.678602468224970e-01   +1.279232263659034e-01   +9.285432145758403e-01   +3.589740346209591e-01   +7.807962239354893e-01   +4.598848195104488e-01   +4.169451784285429e-02   +9.188206997819380e-01; +4.368269108008466e-01   +8.544064336398667e-01   +1.356707566479571e-01   +2.458784708360282e-01   +7.748908948486616e-01   +1.252669573965110e-01   +9.107324304761075e-01   +7.087942706419170e-01; +6.756746147376333e-02   +2.177781935294673e-01   +8.237588980766049e-01   +7.640912749481152e-01   +1.459206998568776e-01   +4.575464040986231e-01   +4.548361281671869e-01   +8.001623108884591e-01; +6.391855959502490e-01   +7.052178062863722e-01   +9.299230747085309e-01   +2.007035445676654e-03   +8.258043042904341e-01   +2.640592766293239e-01   +2.821349848420793e-01   +9.580543900862225e-01; +4.263289068740160e-01   +7.745273474083515e-01   +5.714907341317078e-01   +2.743711393852626e-01   +6.242391640372413e-01   +1.028212232186453e-01   +7.583441159141032e-01   +9.512163838464233e-01; +7.509795158441581e-01   +4.222329695830175e-01   +4.973651495642480e-01   +3.277720543805145e-02   +4.579102504524686e-01   +6.575495507852679e-01   +9.269631296972729e-01   +2.994240781389866e-01; +3.067389879484245e-01   +7.303485359996335e-01   +9.300842595837230e-01   +6.708015812043072e-01   +4.838184289184065e-01   +9.413124567703377e-01   +1.411562884210588e-01   +3.546943410724033e-01; +5.981857776694072e-01   +4.560368949469564e-01   +8.609999428190002e-01   +9.714551624478563e-01   +2.214216711936812e-01   +7.643011664636460e-01   +9.480272863212065e-01   +5.436255639161129e-01; +3.338652417209158e-01   +8.060901739614541e-01   +2.547364296507647e-01   +9.450280128771770e-01   +8.573550049817242e-01   +4.171116892822587e-02   +3.100143355635334e-01   +2.122744370319326e-01; +6.473382671616797e-01   +4.326032014254521e-01   +4.580638851383238e-01   +4.711726990565126e-02   +8.779782652568165e-01   +2.623767894013183e-01   +2.089067434600746e-01   +7.926491955107484e-02; +4.733484779267653e-03   +1.485701312765315e-01   +7.357490710353527e-01   +2.895570996001200e-01   +8.422854832079458e-01   +6.423795547627010e-01   +4.614679772899458e-01   +5.124186017871555e-01; +1.467342913662193e-01   +8.031986090899554e-01   +7.524989829107049e-01   +4.837799791447271e-01   +4.399482120898885e-01   +9.234458657609525e-02   +5.949950728680281e-01   +1.991443608298075e-01; +2.477396962093315e-01   +3.769422746916919e-01   +2.373777512459374e-01   +8.871111112226007e-01   +5.462294990043630e-01   +7.538241596575194e-02   +5.512570042572024e-01   +1.434568362852661e-01];
L1I_L2I_iGABA_netcon = [+7.067821566979121e-01   +8.681099808658570e-01   +6.136539898642882e-01   +5.076181450677445e-02   +1.444270380231282e-01   +2.351430904650266e-01   +8.417835788737594e-01   +3.702838291152633e-01   +7.106154974187036e-01   +3.853584809872304e-01   +2.433145598023136e-01   +6.686262321366311e-01   +1.626986794717359e-01   +5.743695210307725e-01   +4.071585153174707e-02   +4.372452506216649e-02; +6.045254430321444e-01   +8.015359837205380e-01   +6.151553764558620e-01   +5.717805856679409e-02   +7.489386378951064e-01   +5.552024099809850e-01   +2.003772228594264e-01   +5.609474982299845e-01   +1.864462062330950e-01   +7.242815680139587e-01   +5.086613524491572e-01   +3.372013306288539e-01   +1.105352372507415e-01   +8.089424059786139e-01   +4.377425353759518e-01   +9.207430066391940e-01; +1.642956579866950e-01   +6.223061414196858e-01   +3.105055376164255e-01   +5.979504087913385e-01   +9.560399632916109e-01   +1.138877950513665e-01   +6.181052954489110e-01   +8.307390885865292e-01   +2.310556334778807e-01   +6.357767558243994e-01   +7.344237385844085e-01   +5.485302348128993e-01   +7.400290556202944e-01   +6.741362245652804e-01   +9.238533108832032e-01   +1.765533452797122e-01; +4.809415533390057e-01   +4.737189713866194e-01   +1.340728384061283e-01   +6.600199152332821e-01   +2.651468818205797e-01   +8.202672293431869e-01   +1.588218205526977e-01   +7.152333774893956e-01   +9.989124624043533e-01   +1.015152733398836e-01   +7.786302085269742e-01   +5.369765121092377e-01   +2.168204423493166e-01   +4.415023057714392e-01   +8.820303851731079e-01   +7.455099795649144e-01; +2.912813351353697e-01   +2.007116551628354e-02   +6.018072646208702e-01   +4.840295965195910e-01   +8.969380735428523e-02   +6.559130468644098e-01   +5.840190737957560e-01   +1.164309473080156e-01   +9.033472003499451e-01   +4.924899074425194e-01   +6.811869739484571e-01   +9.027727418397279e-01   +4.858250613201908e-01   +8.908551487305244e-01   +9.443914302251033e-02   +4.727671253934914e-01; +4.024862396385085e-01   +1.209334937967407e-01   +8.926451313180952e-01   +9.815539774483014e-01   +2.325962675105994e-01   +2.369103781680418e-01   +5.446398470455969e-01   +7.395916204330264e-01   +1.471088785097456e-02   +5.576092691530358e-01   +8.188648314487922e-01   +2.809764665212097e-01   +5.114468068438818e-02   +7.864885024376493e-01   +6.791172361272062e-01   +2.505158172557116e-01; +4.930934195338363e-01   +7.192839334928104e-01   +5.638492164236246e-01   +8.671695097790431e-01   +8.916957073374935e-01   +3.031176889513713e-01   +6.866971097230404e-01   +9.245320465956959e-01   +8.330470124038877e-01   +5.360254921568784e-02   +4.198117499214910e-01   +1.418870484201815e-01   +5.768521287928775e-01   +5.869847701971497e-01   +9.513211541743852e-03   +6.675943932687241e-01; +8.619349660431354e-01   +6.726911342893956e-01   +6.333687177375228e-01   +9.553914970973516e-01   +1.997414099950088e-01   +3.291765355830956e-01   +7.003575704201005e-01   +9.206191502300213e-01   +2.510232103714687e-01   +8.436824805686478e-02   +4.955858682903992e-01   +9.591462799023501e-01   +4.973526548997648e-01   +6.201999219976465e-01   +1.235979849492548e-01   +6.094525148432393e-01];
L2E_L1E_iAMPA_netcon = [+3.724870497560213e-01   +5.628538044473720e-01   +2.021005165586330e-01   +5.166339417698169e-01   +2.915192960169145e-01   +7.103389198289382e-02   +2.817189610161379e-01   +2.667004460599305e-01; +4.365041321501628e-01   +1.856557584922503e-01   +1.365199599962650e-01   +6.848565828578863e-01   +6.225049314759926e-01   +5.881052431694378e-01   +9.301378557798891e-01   +9.019619616374915e-01; +7.180009757756523e-01   +6.072927675238022e-01   +8.455581571327297e-02   +2.053403551431023e-01   +8.696766195617286e-01   +7.848027800119189e-02   +7.603410898932051e-01   +1.553194221378613e-01; +1.919885535175676e-01   +7.367530933688077e-01   +9.336395723035065e-02   +9.733012216916185e-01   +8.161928054740301e-01   +3.996441089242396e-01   +2.630598121899001e-01   +5.528154801511017e-01; +4.192715844147356e-02   +8.350517269110346e-01   +5.516017456167710e-01   +3.506434337926060e-01   +2.090682692445254e-01   +5.851414402974875e-02   +2.456768088222641e-01   +4.218034435783475e-01; +3.170295406232486e-01   +2.739763254231664e-01   +7.321707072152025e-01   +1.824700182981645e-01   +7.510045878406534e-01   +1.265377806603848e-01   +1.624885425075102e-01   +5.495212264479241e-01; +7.919768892835816e-01   +6.111057822779309e-01   +5.465401102168985e-01   +2.442637035734727e-01   +1.991237854565759e-01   +2.439189317951178e-01   +2.893328626559296e-01   +7.489090110564011e-01; +4.567207897907266e-02   +5.487554942902604e-01   +4.785370531613999e-02   +2.565825745555808e-01   +5.779243254065284e-01   +9.443182766728097e-01   +5.636242627882316e-01   +9.821315984192443e-03; +2.161792101886024e-01   +2.791237503175927e-01   +6.363665567025875e-01   +2.196315682894654e-01   +8.758834920989940e-01   +2.057452330542804e-01   +4.003430734514447e-01   -1.198187858660054e-03; +2.689293425026557e-01   +3.370607929838245e-01   +9.924843598794312e-01   +3.582297610202843e-02   +7.158117948663500e-01   +3.305238948385989e-01   +9.889491183231011e-01   +2.204016231464557e-02; +7.890515977682296e-01   +5.694268470156165e-01   +9.116505657255283e-01   +3.561338505716782e-01   +7.006442530674407e-01   +8.628214148541331e-01   +5.474861308663862e-01   +3.528255711475624e-01; +9.851780522174023e-01   +7.386941010834823e-01   +7.731057255566731e-01   +8.967541845477957e-01   +4.627498590738565e-01   +9.204826959263697e-01   +9.298397133292430e-01   +4.289037964360256e-01; +9.867064350649037e-02   +7.681036687042775e-01   +1.931380134260955e-01   +1.381502949492026e-01   +5.044806829693453e-01   +1.989622430222490e-02   +9.900805963208951e-01   +5.443527218710861e-01; +1.981204401262999e-01   +4.039352750762739e-01   +3.034303823242243e-02   +9.546622681258342e-01   +8.012958304885248e-01   +3.606557580209139e-01   +8.351727576910309e-01   +4.858982201601055e-01; +1.201510667044380e-01   +1.507347794608167e-01   +3.791403420939460e-01   +9.037592418882061e-01   +9.360125332453068e-01   +5.310800713911783e-01   +1.779868038761541e-01   +9.171806751889299e-01; +6.394328234520930e-01   +2.028280900112869e-01   +5.772637624674223e-01   +4.099681995299396e-01   +7.884456199251250e-01   +4.043694192124668e-01   +3.106048223844409e-01   +4.174236263533028e-01];
L1E_L2E_iAMPA_netcon = [+4.980756997200200e-01   +4.528545759491827e-01   +6.139169756629498e-01   +4.924589609331183e-01   +2.331201908288635e-01   +7.150242285238430e-01   +6.889775133608068e-01   +6.334346906326696e-01   +5.237878977399875e-01   +2.427718094701128e-01   +8.735508117337478e-01   +1.777890353270674e-01   +1.385298718943337e-01   +2.472432188841968e-01   +1.866337042661452e-01   +2.571660829613385e-02; +8.353825228661574e-01   +3.653363159784239e-01   +1.064418258300503e-01   +6.599753749732752e-01   +8.365483645678775e-01   +3.824489658067013e-01   +9.753238401363807e-01   +6.222954709158431e-01   +6.702594896812410e-01   +7.258616112730514e-01   +6.622781408833651e-01   +3.018160293808586e-01   +2.839390805003288e-01   +7.481917185155798e-01   +1.519344325745522e-01   +2.445998502724901e-01; +1.849524699520314e-01   +2.993091262068073e-01   +7.581899707377830e-01   +1.789493077874237e-01   +7.361300918261915e-01   +3.791772284579715e-01   +7.556944582327557e-01   +4.083694042181547e-01   +7.738426138694793e-01   +1.301538079313990e-01   +5.419629871920257e-01   +1.068198391585675e-01   +4.537531480728261e-03   +9.317878407402596e-01   +1.359172330717163e-01   +9.863518369079258e-01; +3.406586186203538e-01   +2.363457087586645e-01   +5.415927412330698e-01   +4.770732720581105e-01   +4.892918290001886e-01   +7.155096352302609e-01   +5.546945461470838e-01   +4.279093145076146e-01   +4.631014682285843e-01   +4.359737323924345e-02   +2.534807275835796e-01   +4.496014283392293e-01   +3.081110352378363e-01   +2.981080734385797e-02   +1.630514887814171e-01   +6.323703383060946e-01; +6.924575850510071e-01   +1.377756498737663e-01   +4.438254689144918e-01   +5.005330378240751e-01   +8.517331964976377e-01   +8.347498241678015e-01   +2.794410818323686e-02   +5.083623253200210e-01   +9.063029340556097e-01   +6.503236566248429e-01   +1.086679410321764e-01   +5.880095567846721e-01   +9.053144034843844e-01   +4.328901820352749e-01   +9.206089628534347e-01   +3.583755653625685e-01; +6.971905396461318e-01   +1.038307553945041e-01   +7.418262852514173e-01   +6.024459073309438e-01   +7.202439037495173e-01   +6.682598149630168e-01   +1.919687130999564e-01   +2.624747185038346e-01   +2.434798754936156e-02   +1.990994583668585e-01   +9.720851654006438e-01   +2.215393244309969e-01   +2.942284527417959e-01   +8.291070001533125e-01   +2.637745568564563e-01   +9.331719488962663e-02; +3.692534156911282e-01   +2.303014306220816e-01   +3.854719461663270e-01   +2.460056648309678e-01   +5.215468802629301e-01   +6.514471484090626e-01   +9.383841681189852e-01   +4.220706995568714e-01   +4.838357979678393e-01   +9.766300822016819e-01   +5.922370493140722e-01   +1.105167415319955e-01   +8.255911447881674e-01   +9.970363998139667e-01   +2.076050448921029e-01   +4.111896666671641e-01; +3.171862371666050e-02   +3.433497157282772e-01   +5.322462301658600e-01   +5.179908753094620e-01   +9.374690496365081e-01   +5.599711209533551e-01   +3.957607049613056e-01   +5.219717159598288e-01   +2.767040868345335e-01   +8.227241601378433e-01   +8.212369922335523e-01   +5.591366315393632e-01   +7.439865491475081e-01   +9.208613264947507e-01   +6.173853789840368e-01   +9.300005114138049e-01];
L2I_L2E_iAMPA_netcon = [+6.722182536945293e-01   +6.093960236164204e-01   +4.033431362714972e-02   +7.993122531449055e-01   +5.216516484590157e-01   +8.235085652908462e-01   +6.480571343965656e-01   +3.873176350700981e-01; +2.274847145592980e-02   +9.443401925493434e-01   +5.320972998525562e-02   +9.364515667357880e-01   +6.472833718682910e-02   +1.106330692115125e-01   +3.660845678253996e-02   +1.730499450844414e-01; +7.399053784983056e-01   +9.630469690381822e-01   +4.046615495506116e-01   +9.394100412698765e-01   +2.869454803248837e-01   +2.150120239587130e-02   +5.616449072737956e-01   +4.475508982462855e-01; +2.155997814364795e-01   +3.694129949684398e-01   +9.818286380061447e-01   +1.423870384829163e-01   +7.124355889694353e-01   +9.030325762874684e-03   +3.078815869946904e-01   +8.750599109856239e-01; +8.562455002592434e-01   +8.013826480459412e-01   +7.130375549009024e-01   +3.261573577496201e-01   +8.845697742530814e-01   +3.365002298889023e-01   +2.624275610789285e-01   +4.052417932931222e-01; +1.592713455072389e-01   +7.267674042728470e-01   +9.871405904934695e-01   +4.297970854048303e-01   +3.641627831671046e-01   +6.671063056204906e-01   +7.190321271736581e-01   +1.640822656433530e-01; +6.736578530257901e-01   +9.541899056221078e-01   +6.486193042457959e-01   +7.065244933552776e-01   +5.651541007046273e-01   +5.952733328942741e-01   +3.088724750577344e-01   +6.631330525098380e-01; +9.360640315607359e-01   +1.489072623917155e-02   +5.066400592460917e-01   +6.174962700891383e-01   +8.797030947886660e-01   +7.703847408679354e-02   +9.002987430873092e-01   +9.306485267715829e-01];
L2E_L2I_iGABA_netcon = [+6.288654245611948e-02   +5.238007597322084e-01   +3.524926032036743e-01   +2.560341132871602e-01   +4.503320727983128e-02   +8.970298327134840e-01   +3.424897557473462e-01   +4.518792350658609e-01; +3.562560723613796e-01   +6.826045399995326e-02   +5.606328703360686e-01   +9.824037720730333e-01   +3.621826364309914e-01   +5.449068899041967e-01   +9.314960650426692e-01   +6.746041286698438e-01; +9.326298122596645e-01   +1.793810363073002e-01   +6.906296499058278e-01   +3.490490734432543e-01   +3.693761291172720e-02   +7.152230265542221e-01   +9.155402314892668e-01   +7.698415254105614e-01; +2.402407137440260e-01   +3.139910441276956e-01   +3.651494016318720e-03   +3.976413889511415e-01   +4.854223560852250e-01   +7.156874832460149e-01   +7.253378880823629e-01   +9.247314678285266e-01; +1.055729607521218e-01   +2.479790940422551e-01   +4.594161722373800e-02   +7.513391732728296e-01   +7.267101148499644e-01   +1.691146504509154e-01   +4.448572210454861e-01   +6.546251584075808e-01; +7.121778684542139e-01   +3.231044816025173e-01   +3.037837756759462e-01   +1.072456582548986e-01   +1.320369605909388e-02   +3.534196097178071e-01   +1.523837169969106e-01   +5.021592001283273e-01; +5.832905375137775e-03   +8.756657298115110e-01   +8.720819768609772e-01   +5.953784031654893e-01   +5.136782203175141e-01   +3.796653013926662e-01   +8.289201051191610e-01   +3.456965270873333e-01; +1.753480157832980e-01   +3.053474643450586e-01   +6.240170897814784e-01   +1.222158843734798e-01   +2.404241866146718e-01   +7.595263903611623e-01   +2.518545721807247e-01   +9.473588537578771e-01];
L3E_L2E_iAMPA_netcon = [+7.665845758649317e-02   +1.819154733016495e-02   +3.695034388942535e-01   +4.933910249296297e-01   +2.059281851151011e-02   +9.603149511742155e-01   +3.590489309242938e-01   +2.042405446103742e-02   +2.037469894263900e-01   +6.764625496979476e-02   +2.450840839084068e-01   +9.981130483568131e-01; +9.514057322298501e-01   +9.788908879196484e-01   +1.152658288666323e-01   +6.395007517275525e-02   +8.072155982985683e-01   +3.897590497606608e-01   +2.275019075185558e-01   +1.269357704339539e-01   +3.561623349769296e-01   +7.416386116666918e-01   +5.354129231300980e-01   +3.438572408135288e-01; +6.649431366129236e-01   +7.191238984888217e-01   +5.121659019098956e-01   +8.682377938419944e-01   +7.961244485911232e-01   +6.615591143814479e-01   +7.263386801155992e-01   +6.636866094763915e-01   +8.896064514529853e-01   +9.941852553020986e-01   +3.330006382902596e-01   +8.255659546002275e-01; +1.673067505251364e-01   +8.734071422511204e-01   +8.168356703113614e-03   +9.976877797855485e-01   +4.206191352362655e-01   +5.856998691468140e-01   +7.713111215582965e-01   +5.080530428282545e-01   +8.194826867535112e-01   +7.674663987214819e-01   +6.701276649031983e-01   +1.099825945117122e-01; +1.970975846340819e-01   +8.184306369502533e-01   +8.694954382966867e-01   +1.222416548539256e-01   +6.310272559106712e-01   +5.217473039324060e-02   +3.417901200369972e-01   +7.802369074904589e-02   +3.186527250269925e-01   +8.876454065833134e-01   +8.771128179627389e-01   +7.808962806065426e-01; +9.921066382420755e-01   +3.447128355168547e-02   +9.109767973089533e-01   +1.055550673011987e-01   +5.669241976310192e-01   +7.184269881425188e-02   +5.730206413678374e-01   +5.389047866423309e-01   +5.989379083179434e-01   +4.232727644421237e-02   +9.827589371836967e-01   +1.513471186942325e-01; +9.269995228591977e-01   +9.489446061596173e-02   +1.102071883357076e-01   +1.483574912240888e-01   +9.013419165605143e-01   +2.324157594425988e-01   +6.388114576676737e-01   +6.814870375770581e-01   +6.996630957609815e-01   +7.951786823352931e-01   +1.409691303599512e-01   +7.319097149098861e-01; +9.776178717014082e-01   +9.274221943676683e-02   +4.482671623345651e-02   +1.274124967002619e-01   +7.488643794947938e-01   +4.155561542051105e-01   +3.696168181000765e-01   +5.898707594269891e-01   +1.793321672783090e-01   +7.116631880699863e-01   +8.796621122357210e-01   +1.156653100970092e-01];
L3I_L2I_iGABA_netcon = [+7.705516926139908e-01   +5.364631441293193e-01   +5.958096152521386e-01   +3.054865236875723e-01   +9.676863600415466e-01   +1.140996538307980e-01   +2.944659494881214e-01   +7.958995827414679e-01   +9.209564401848758e-01   +9.923944419566424e-01   +3.116990824688955e-01   +9.938441728694818e-01; +6.366143868365204e-01   +4.495069446954565e-01   +5.601165555430905e-01   +7.572402336029784e-01   +5.473037313773325e-01   +6.448213604742126e-02   +1.656861836057944e-01   +5.016153844887622e-02   +3.863047895397475e-01   +2.902317899811596e-01   +4.461471292638569e-01   +9.187954136893048e-01; +7.992307690701542e-01   +1.163746634795484e-01   +7.332707458628167e-02   +6.522274831234717e-01   +9.809625264110965e-01   +4.541208536064080e-02   +7.231389260156897e-01   +1.794536391772166e-01   +7.485213746973333e-01   +5.200805872865628e-01   +2.040020405767165e-01   +6.892833001403332e-01; +9.626604760080858e-01   +7.163008027096949e-01   +7.707577531642509e-01   +3.330564472064209e-01   +1.261090517434479e-01   +1.325956418699461e-01   +2.990925417186368e-01   +2.454358131676891e-01   +8.757141771216074e-01   +3.593158743268215e-01   +9.409835444611911e-01   +2.175171223203864e-01; +7.113408196214153e-01   +1.820341115523943e-01   +8.628852994318816e-01   +9.748107278556883e-01   +1.653010216927434e-01   +4.902390641853318e-01   +6.761840073508604e-01   +2.579778194242432e-01   +3.949407206242350e-01   +5.189612285791848e-01   +2.904685856430890e-01   +3.155784963348686e-01; +6.454376913154156e-01   +3.252987445090759e-01   +7.025989307119100e-01   +5.308910211169622e-01   +3.369283639077740e-01   +4.684340826210022e-01   +7.477836036592945e-01   +6.530213296153968e-01   +1.683363019673813e-01   +4.956918139392841e-01   +1.191636237470914e-01   +2.283740308408842e-01; +5.140857652807803e-01   +9.654854047554600e-01   +1.067873343587057e-01   +7.514605850956919e-01   +5.353652387260281e-01   +1.539762774431339e-01   +7.468821857719223e-01   +9.991522883854695e-02   +4.390963508350902e-01   +1.835745863654314e-01   +7.073238286787875e-02   +7.082996505062233e-01; +9.503098299485854e-01   +6.994977035551926e-01   +6.600684569117448e-01   +2.661651799394671e-01   +6.927611705136909e-01   +1.388923154561951e-01   +7.798262100339014e-01   +4.688168901329451e-01   +8.539342202941642e-01   +4.801924713139100e-01   +7.283063254953168e-01   +3.721586273072353e-01];
L2E_L3E_iAMPA_netcon = [+6.590182624147680e-01   +3.861196720510353e-01   +2.349287291339270e-01   +4.634543906828211e-01   +9.047054383406498e-01   +9.557408139834883e-01   +7.674661598059230e-01   +3.573358216052698e-01; +3.803588319919085e-01   +2.190135868860791e-02   +9.120410117905425e-01   +2.905750644987610e-01   +6.838282443124956e-01   +1.979786332247404e-02   +8.982006843599226e-01   +6.608516855666446e-01; +3.058559148881487e-01   +3.308243543015155e-01   +4.878188853726898e-01   +2.770250383318335e-01   +8.453024442204228e-01   +4.988730464888225e-01   +7.911835385668086e-01   +5.906679727756571e-01; +1.556701276668625e-01   +4.881837617071312e-01   +5.921415238443141e-01   +1.428305786882448e-01   +9.597886358638083e-02   +3.350084570594828e-01   +9.515712397627900e-01   +5.358608355016070e-02; +7.733307160261994e-01   +2.632032573031023e-01   +9.539812046383307e-01   +1.454111445986710e-01   +7.378981370830368e-01   +6.675102692416438e-01   +5.345378117758337e-01   +2.118750474371646e-01; +7.105148847025229e-01   +5.274774327613635e-01   +7.944122707022448e-02   +2.648183423641008e-01   +5.474314274882667e-01   +1.659058970116650e-01   +1.602641995032506e-01   +6.028577503453419e-01; +1.710953907921619e-01   +4.138675895523911e-01   +2.219953117826176e-01   +6.073122402399656e-01   +2.537836050428347e-01   +2.257329989552822e-01   +1.354626383275487e-01   +2.705459129800417e-01; +4.504578590248848e-01   +9.126267634677222e-04   +1.590057253818000e-01   +1.027905631474008e-01   +7.156169713274267e-01   +1.143484577172702e-01   +2.618058017314394e-02   +1.137262719452461e-01; +8.401985566816059e-01   +8.896521823888683e-01   +3.942805164407786e-01   +4.873361661010738e-01   +3.585712163003930e-01   +9.909524071928075e-01   +6.854781062743920e-01   +2.181169311581881e-01; +7.004491674158205e-01   +2.383099879334747e-01   +1.850147281802737e-01   +8.973309518407231e-01   +8.457824155289729e-01   +1.377250581101546e-01   +5.851242708492503e-01   +8.809187382051763e-01; +7.642292165010961e-01   +7.978333411768984e-01   +7.640721413976036e-01   +1.894054492446679e-01   +8.199523330858176e-01   +7.662019096374865e-01   +2.925790553244234e-01   +4.616933957276980e-01; +9.766980873731983e-01   +5.811343202201379e-01   +2.288561940135188e-01   +5.353981544866822e-02   +6.159798058901166e-01   +6.256024392289558e-01   +7.473491336084262e-02   +7.325222542238545e-01];
L2I_L3I_iGABA_netcon = [+5.926299535211706e-01   +1.421618135302214e-01   +3.456540110056553e-01   +3.713778320820135e-01   +5.973310561382569e-01   +5.088617295291202e-01   +7.697270469592509e-01   +2.681959468546949e-01; +8.397868540167808e-01   +9.926090712899123e-01   +4.224583967301827e-02   +5.361433242946368e-01   +4.752658137630566e-01   +2.427215344642853e-01   +1.792003370927086e-01   +5.944949897355848e-01; +6.071538809608624e-01   +4.840035515826120e-01   +9.478458511501510e-01   +9.723981911379328e-01   +3.794188366689455e-01   +2.742147843412409e-01   +4.543314506071350e-01   +6.810901903193233e-01; +7.479698882420555e-01   +3.902484391291253e-02   +8.633502966240157e-01   +9.974673745069772e-01   +9.809711891094445e-01   +4.113210641270340e-01   +2.999159858085838e-01   +4.182355201727276e-01; +8.504675068264910e-01   +2.680923273220531e-01   +1.356711013191108e-01   +4.126969585403445e-01   +1.395675996805951e-01   +2.627190900183638e-01   +3.851262258298599e-01   +5.120631061264689e-01; +1.455874998288885e-01   +6.694081792149910e-01   +5.894545378738537e-01   +4.477416263378352e-01   +2.726057714062852e-01   +8.516733536734580e-01   +7.984169616516161e-01   +8.147289094331355e-01; +7.408281613344508e-01   +1.461809247593492e-01   +6.862820006281974e-02   +2.469070586835280e-01   +2.247142686625702e-01   +4.801875156013265e-01   +7.810898035089032e-01   +5.382740229702103e-01; +1.742804470856804e-02   +7.718631331928217e-01   +9.510149224975804e-01   +5.971368488343036e-01   +7.950281424517449e-01   +3.394010654369817e-01   +6.470369113003052e-01   +5.882062334359862e-01; +2.266740160028927e-01   +2.668189397780980e-01   +4.968485182618830e-01   +7.364500312689221e-02   +8.222319355844387e-01   +6.351847825610013e-01   +2.450807865883925e-01   +5.389613685939187e-01; +5.337290154376745e-01   +8.836344744105714e-01   +2.758269931507136e-02   +9.070882371538566e-01   +7.982936485725780e-01   +4.145384200054725e-01   +6.047498725620312e-01   +5.391005036395939e-01; +7.174509368099269e-01   +3.654422590723707e-01   +5.291821432275587e-02   +4.778113666343519e-01   +1.149058958442428e-01   +5.473142281094227e-01   +4.178801820589929e-01   +1.522021169827932e-01; +4.329453033399524e-01   +1.226192575422012e-02   +2.981862586767924e-01   +5.029333666526812e-01   +6.364816952217980e-01   +3.403106652136837e-01   +2.980953606371329e-01   +6.977225447637345e-01];
L3I_L3E_iAMPA_netcon = [+5.940148052739050e-02   +7.743487587757587e-01   +5.530870130150505e-01   +5.703725076781885e-01   +9.143200351740066e-01   +8.325259233114213e-01   +8.447057792061259e-01   +8.619320705407795e-01   +5.295007971706387e-01   +9.908466507276456e-01   +4.819269756895394e-01   +3.494501408583146e-01; +9.227637871847164e-01   +8.371301899552723e-01   +8.496157792073210e-01   +9.347135561185130e-01   +5.909978158611682e-01   +3.994143480868861e-01   +6.302810998381686e-01   +8.558882733839912e-01   +5.631050642416304e-01   +6.996948470682824e-01   +7.401294152273923e-01   +3.948954210112467e-01; +1.839660588353790e-01   +5.916152390482321e-01   +9.683561435063036e-01   +7.813128718690353e-01   +5.767783637008185e-01   +6.917969311082027e-02   +4.398858406418341e-01   +9.517218441827625e-01   +9.828389348564570e-01   +8.425408203941664e-01   +5.913445132654750e-01   +9.902422165872072e-01; +5.418271478763422e-01   +7.647685123029996e-01   +4.616750779806220e-01   +5.950945693821652e-01   +6.527077653420400e-01   +3.790936033118759e-01   +2.312762855866791e-01   +6.970938714176311e-01   +9.603493567021553e-01   +7.329095883837662e-01   +2.573025501774572e-01   +2.916247054245675e-01; +3.988925890453519e-01   +6.666845715716347e-01   +7.717816186720509e-01   +6.070861715477008e-02   +4.301476213600222e-01   +8.558592718463731e-01   +5.038148628389022e-02   +3.601833902298007e-01   +5.593632350943396e-01   +9.960896675996743e-01   +6.105077084325081e-01   +2.278615332321444e-01; +1.120379758507763e-02   +5.852477176230573e-01   +2.553006315343586e-02   +5.413242189691816e-01   +9.367405303718777e-01   +2.229584238450991e-02   +7.050303215495755e-01   +3.744027664416174e-01   +5.272461906217016e-01   +5.056567929811739e-01   +2.310959807091842e-01   +3.264958553014567e-01; +1.058064211503181e-01   +2.203444162598425e-02   +6.746246064951533e-01   +8.600820540963341e-01   +1.002954895839515e-01   +4.230713012620873e-01   +8.490191087487858e-01   +8.460381601494785e-01   +4.741554601125886e-01   +1.912095791279799e-01   +1.960993599769421e-01   +1.657591899260024e-01; +8.531491275798215e-01   +6.842555929681874e-01   +8.410933466573143e-01   +3.406520676408526e-01   +4.076894348166293e-01   +2.527929542124136e-01   +4.062487798643667e-01   +3.847680121294494e-01   +9.030903360380289e-01   +9.534400432899296e-01   +2.906570903601063e-03   +3.804579450756753e-01; +3.369160541700359e-01   +3.243604958562570e-01   +6.890278850734952e-01   +1.777205842574217e-01   +8.931748776224914e-01   +7.383965065244892e-02   +2.902852341263837e-01   +7.735649667546668e-01   +4.822538847377978e-01   +4.505904206403415e-01   +6.550551570360637e-01   +5.283742365667780e-01; +1.481115341481311e-01   +8.056495778528550e-02   +8.999438429379818e-01   +8.773137342675630e-01   +7.348099782357483e-01   +9.172028162763582e-01   +2.576010360353070e-01   +7.771185773373733e-01   +4.889879038670680e-01   +6.081393425602734e-01   +3.991975773912130e-01   +5.960545671915750e-01; +8.011611525848465e-01   +7.445729221977851e-01   +9.525040029793880e-02   +8.404778618098524e-01   +9.579507269446731e-01   +2.662262332393824e-01   +5.116417850320683e-01   +4.306817288351034e-01   +3.098335751010202e-01   +6.432295829105822e-01   +2.705395188119751e-01   +1.702045353212854e-01; +6.537701248234303e-01   +9.672557303398164e-01   +7.781577513823616e-02   +8.296219335741422e-01   +9.750461631095825e-01   +1.073683880744552e-01   +1.172454040499299e-01   +4.843840685592196e-01   +8.526491045001253e-01   +7.631758257480338e-01   +1.999478581317405e-03   +6.795888881102720e-02];
L3E_L3I_iGABA_netcon = [+4.439084732142513e-01   +6.576238376015708e-02   +5.131528619569530e-03   +4.922045533176696e-01   +5.446513375264347e-01   +2.527750037593667e-01   +7.184999144700903e-01   +7.596083826430334e-01   +3.790445513695434e-01   +4.490275344530698e-01   +1.995696586065146e-01   +6.545394996546140e-01; +5.963642292516215e-02   +8.084620544649960e-01   +1.302348916001386e-01   +1.902806191740336e-01   +2.160091677659292e-01   +3.335423755577497e-01   +2.232624463057317e-01   +8.875866299303533e-01   +6.092153121473568e-01   +3.935384340118912e-01   +8.277242557488717e-01   +9.045263252805297e-01; +6.261156322516763e-01   +9.146930957751278e-01   +3.089981159566531e-01   +6.449941103813280e-01   +2.698016427876113e-01   +5.996831720613365e-01   +5.002418776421108e-01   +7.324420347419450e-01   +1.659879705045767e-01   +6.765944697648127e-01   +4.400240636186057e-01   +8.359853295227679e-01; +8.043750041251502e-01   +4.232564176608354e-01   +2.365677383124086e-01   +2.539616130526847e-01   +1.355138939854750e-01   +4.820991914166801e-01   +4.749230697223994e-01   +6.937407051775029e-01   +1.005169680505258e-01   +3.411845959096527e-02   +4.263748435709257e-02   +1.716697563046747e-01; +4.039110776092082e-01   +1.893403176374139e-01   +6.509893105142888e-01   +9.446674899123394e-01   +1.647077615108013e-02   +8.968669883018026e-01   +4.299660370781361e-01   +6.430186852111792e-01   +6.205883072373060e-01   +7.850718775071255e-01   +7.652842256426911e-01   +1.613862973209717e-01; +8.829646365373082e-01   +1.850495438234516e-01   +8.111563045184571e-01   +2.899413765521867e-01   +1.169776694841557e-02   +2.902031668715978e-01   +5.537805799859010e-01   +6.160671931977754e-01   +9.598411443470346e-01   +3.743280342717347e-01   +9.468844097856645e-02   +1.372200468777412e-01; +7.198136625141296e-01   +6.709174906759917e-01   +7.402725629247969e-01   +1.448266594268470e-01   +9.839199170204819e-01   +7.495840320140656e-02   +2.103991596956222e-01   +7.743195994851240e-02   +6.707716757626838e-01   +6.411752481302171e-01   +6.561997536892147e-01   +1.573345835048188e-01; +1.990573548536930e-01   +5.259594863557648e-01   +1.197882477838422e-01   +8.658205544577772e-01   +6.460058102606590e-01   +3.882773432890632e-01   +2.777641698859761e-01   +5.490567543466661e-01   +4.732301120712573e-01   +4.961631541579012e-01   +2.684105682512148e-01   +3.976913300337733e-01; +3.736845826375912e-01   +7.741017472207012e-01   +1.720625528799286e-01   +8.838982534285648e-01   +8.159390102358861e-01   +1.933519603056700e-01   +8.088410240238385e-01   +8.804570038949590e-01   +3.380770469108073e-01   +2.180392913485338e-01   +4.363554409910959e-01   +6.621587666338838e-01; +2.088590692735810e-01   +3.013839095467538e-01   +2.673243623500192e-01   +6.635878847230940e-01   +2.794281254131327e-01   +7.288711108881074e-01   +9.886875870790174e-02   +9.859851297021217e-01   +5.888082772356612e-01   +2.109252104089100e-01   +8.509610255217607e-01   +2.221441391013647e-01; +2.628652795134404e-01   +4.756449440129558e-01   +8.135271967624825e-01   +9.985089233227951e-01   +1.336931427115851e-02   +4.244823432439075e-01   +3.427345564832749e-02   +7.122026125693735e-02   +5.428717247704721e-01   +4.533002439059526e-01   +9.059385244982723e-01   +6.422521392552255e-01; +9.915089631649683e-01   +7.097545787657976e-01   +5.918786273311953e-01   +2.675517066416198e-01   +1.028258988809410e-01   +2.677196921192487e-01   +7.152762500520676e-02   +2.998944086593655e-02   +3.905207560570547e-02   +6.352504289985328e-01   +2.862417896250534e-01   +6.088377161226916e-01];
L2E_Input1_iAMPA_netcon = [+9.998764868191578e-01   +9.923645171820636e-01   +9.969019252313329e-01   +9.897437251485832e-01   +9.886597179305938e-01   +9.993147740112091e-01   +9.848668997330083e-01   +9.986331450921103e-01];
L2I_Input2_iAMPA_netcon = [+9.983708825438002e-01   +9.985061777384598e-01   +9.875672628207443e-01   +9.893230336559239e-01   +9.891452183690044e-01   +9.888869153422903e-01   +9.910546700051561e-01   +9.951424305649216e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
