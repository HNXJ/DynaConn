function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.239236733422389e-01   +4.225835880267654e-01   +5.305088276445268e-01   +6.365522690444765e-01   +5.998881939957155e-01   +3.413737680175297e-01   +6.477733815570940e-01   +8.396281976980532e-01   +5.446150653389474e-01   +1.929695558491260e-01   +4.453682209677004e-02   +8.223078324895300e-01   +7.677790625174179e-01   +1.099293790514698e-01   -6.108634766067102e-04   +8.415702420125865e-02; +9.833146877115279e-01   +9.587810322198682e-02   +3.245423344502473e-01   +9.566936001909256e-01   +3.867945183723631e-01   +6.068883502095654e-01   +6.786028487681304e-01   +8.316603845193827e-01   +7.227492102782291e-01   +1.383091604370853e-01   +7.536149236382874e-01   +4.302353228153902e-01   +1.673945456752899e-01   +1.357797433493102e-01   +8.649435786636291e-01   +6.268899118234310e-01; +7.305333920047827e-01   +5.976686908254768e-01   +1.055981531925123e-01   +2.417910641502725e-01   +9.158000383919245e-01   +1.916179133134203e-01   +6.349934221724487e-01   +2.562008951234079e-01   +5.211848592316511e-01   +6.962427788025786e-01   +2.417877892215478e-01   +8.872655250064237e-01   +8.635689314420230e-01   +6.790042974284798e-01   +6.126581081378744e-01   +6.615403556528583e-01; +3.441624876394221e-01   +4.723991766820771e-01   +6.118358627600796e-01   +6.756941168111200e-01   +1.205475708329559e-03   +7.392797805880018e-01   +9.454987450931990e-01   +6.136140791664079e-01   +9.932633443969597e-01   +9.307208611474040e-02   +4.425680109968758e-01   +3.920178282815711e-01   +9.903090474965740e-01   +4.941654884117263e-01   +9.883309824141945e-01   +7.300882096080309e-01; +5.861156894536834e-01   +6.959891047940585e-01   +7.797108560145373e-01   +2.883747588870625e-01   +4.624974684585235e-01   +2.420306179905462e-01   +2.089780769663829e-01   +5.823515090708088e-01   +2.209198705448993e-01   +5.237963074827314e-01   +6.874612020848636e-01   +7.690725756377339e-01   +5.156654224581094e-01   +1.893241918106940e-01   +5.265361505463886e-01   +8.925053467192730e-01; +1.088142823970338e-01   +7.003894801077093e-01   +4.239950717249027e-01   +6.706025769686520e-01   +4.251691335616243e-01   +9.190864841845833e-01   +7.091581103125119e-01   +5.411167421160701e-01   +1.048732631361714e-01   +5.309361653158066e-01   +3.584722202374105e-01   +3.970722733578731e-01   +8.840037058078377e-01   +4.943495860812849e-01   +4.809242227086644e-01   +9.824233993637087e-01; +9.053360129018773e-01   +6.394719296689896e-01   +9.058961385300969e-02   +6.943037962108548e-01   +4.608766168650006e-01   +2.705302432107716e-01   +2.373125811293034e-01   +8.708077018606992e-01   +1.109124596675135e-01   +8.616627500787853e-01   +7.367726850166810e-01   +8.099624622499831e-01   +5.877279422860389e-01   +1.481331184702805e-01   +8.024990210855311e-01   +7.690688230399451e-01; +8.810038434067534e-01   +3.336074818153852e-02   +2.652814226632762e-01   +6.706895617520138e-02   +7.706840951317798e-01   +7.655868917230456e-01   +1.194293059658952e-01   +2.646001762024380e-01   +6.524408749560771e-02   +4.850999759348866e-01   +3.943402878266167e-01   +7.551053490254729e-01   +1.553986291791211e-01   +5.343474114665016e-02   +2.283337984090230e-01   +5.829138280626293e-01; +8.176404420869898e-01   +6.820309657094473e-02   +1.539713646885686e-01   +2.528116400579170e-01   +3.242263054998247e-01   +1.900362839114044e-01   +6.080133832964618e-01   +3.162991505010888e-01   +4.042175492242362e-01   +3.923842306270041e-01   +6.844231516185324e-01   +3.776379148982935e-01   +1.999109755274325e-01   +8.510342475923078e-01   +4.967133886917124e-01   +9.267031845800390e-01; +2.600929268033105e-01   +3.191415207006444e-01   +2.818477969726818e-01   +2.214694483675559e-01   +7.840980784613560e-01   +2.858378051569977e-01   +4.520496206106832e-01   +1.188503619572703e-01   +4.477025786407430e-01   +6.713925967740713e-01   +7.043432005564918e-01   +2.163276023167320e-01   +4.077440371861631e-01   +5.618886474449285e-01   +8.989835665011421e-01   +5.812756375179210e-01; +5.938772203424858e-01   +5.297539537485189e-01   +4.419856123721817e-01   +6.682003165819647e-01   +4.701031335772424e-01   +9.084029057963355e-02   +4.585784235254045e-01   +9.400720225539370e-01   +3.653422249849130e-01   +7.419966970558456e-01   +4.427349553261014e-01   +7.903252902235335e-01   +7.480304746915494e-01   +9.300855237934618e-01   +5.759454103179706e-01   +1.654252769474898e-02; +2.294788642665877e-02   +6.541154937351006e-01   +5.260706065636284e-01   +8.443013559624717e-01   +3.576616684991865e-02   +5.780556047080797e-01   +6.621350609565881e-01   +6.458248625409991e-01   +7.629771847251513e-01   +5.189668615677936e-01   +1.857136109943210e-02   +9.499912394768117e-01   +8.242639711128746e-01   +6.979530552079889e-01   +8.444351083035068e-01   +1.215153009618721e-01; +4.260455319303753e-01   +4.075654964443229e-01   +4.585769573129042e-01   +3.448590257526276e-01   +1.766490536028448e-01   +6.839814762490296e-01   +7.698692797178044e-01   +4.797336117998626e-01   +6.264082514382747e-01   +3.448705237381456e-01   +3.296750175314254e-01   +3.287290765012988e-01   +7.914074839835319e-01   +5.842991152764179e-01   +7.388293365499495e-01   +8.623903365993285e-01; +3.122316196431654e-01   +8.192894717740051e-01   +8.751127469624547e-01   +7.822817930038001e-01   +7.202928547701158e-01   +5.467521370102187e-01   +3.497601483052588e-01   +6.396206501297650e-01   +7.726194243747183e-01   +1.495579535151898e-01   +4.235196071874875e-01   +6.727053170418169e-01   +3.194241251627559e-01   +8.152389802996560e-01   +5.864595898320210e-01   +4.833060473397470e-01; +1.602790156554666e-01   +7.206869899495866e-01   +5.192238624419245e-01   +6.765099085787786e-01   +4.739083408078741e-01   +4.238819479205696e-01   +6.624023335438843e-01   +5.446448102245541e-01   +9.331806033257477e-01   +5.866491127782215e-01   +2.691301229534792e-01   +4.397194370942041e-01   +5.338928549281072e-01   +8.811035381790137e-01   +2.450057334588882e-01   +8.451936243903960e-01; +1.777922412946298e-01   +9.685438514397956e-01   +9.452852885052503e-01   +7.334895452905321e-03   +1.527625812062135e-01   +6.433890703184084e-01   +4.157873303532381e-01   +6.470867822964560e-01   +9.736940460023522e-01   +2.611141875107033e-01   +1.966427642409318e-01   +8.331341951638798e-01   +9.020262492019195e-02   +9.893189379955745e-01   +6.652260109094443e-01   +2.097410600172185e-01];
L1E_L1I_iGABA_netcon = [+5.510189951690596e-01   +6.943784564575132e-01   +1.049830356738518e-01   +1.772907611041935e-01   +5.468488693778643e-02   +1.786377976264734e-01   +5.959589383676245e-01   +9.968297234001573e-01   +3.392731043988426e-01   +7.790400471048103e-01   +6.835328786780517e-01   +3.651997756068400e-01   +7.829246061254400e-01   +4.327747713196261e-01   +5.948339542574146e-02   +9.703031863784421e-02; +6.316831055571769e-01   +4.992373108323902e-01   +1.424756055622873e-01   +3.985075936249859e-01   +1.779480133518998e-01   +3.604817656726034e-01   +3.004623863440183e-01   +3.309735334816497e-01   +2.940453077550426e-01   +3.378563756536480e-01   +1.317546144814330e-01   +3.688827625647093e-01   +1.007356249417882e-01   +6.550901410654326e-01   +3.140874998948799e-01   +1.416437120752498e-01; +3.248547068234265e-02   +5.354333797757986e-01   +1.672956462394084e-01   +1.332692509864521e-01   +6.609119876572683e-01   +5.616573865557489e-02   +1.350539242442902e-01   +2.974131214025208e-01   +7.456123612612048e-01   +6.078605891805633e-01   +7.233769171990394e-01   +6.848553542451379e-01   +2.930385444994040e-01   +1.115692350573843e-01   +7.719239709146928e-01   +1.687808933983119e-01; +6.143834413341528e-01   +4.436138130627238e-01   +6.224916267482397e-01   +2.899801849623188e-02   +3.322299398302112e-01   +5.222494455824624e-01   +2.110280929207633e-01   +6.238612704556223e-02   +1.087286815690705e-02   +7.415624305132024e-01   +1.098262518348301e-01   +5.976380953729001e-01   +2.365147261625382e-01   +9.319127252712452e-01   +6.954417710409221e-01   +1.958617452089761e-01; +3.631213109364415e-01   +1.240176020319482e-01   +5.740581509172045e-01   +9.384785695334670e-01   +8.982262585364080e-01   +3.348579585314799e-01   +8.959304803704869e-01   +2.975757140010833e-01   +4.805396713399793e-02   +1.057000055885598e-01   +1.172883937316522e-01   +7.883841030235802e-01   +5.302590357564942e-01   +1.858237747204419e-01   +1.253442933789915e-01   +3.174476453253484e-01; +4.957789525959772e-02   +4.916206719065814e-01   +5.298754578975316e-02   +3.024146268245365e-01   +1.169855025734805e-01   +1.737621914316507e-01   +7.219623331269713e-02   +4.462571767047949e-02   +6.675275064121486e-01   +1.265526324578005e-01   +6.402965137051109e-01   +3.683411141264453e-01   +9.271780288229292e-02   +2.666035102958417e-01   +1.279663299711686e-01   +3.174976967708927e-01; +4.873083689530752e-01   +8.528850462741551e-01   +9.320792862654949e-01   +2.958789675506456e-01   +9.881345050516527e-01   +2.108316979012835e-01   +2.429698127001002e-01   +5.058541162832134e-01   +6.047552924876402e-01   +5.488477008301756e-01   +3.286699842769254e-01   +2.055455631926311e-01   +4.054461224370479e-01   +7.978313640229239e-01   +9.148518935523260e-02   +2.172381613815996e-01; +1.919884933965113e-01   +8.747539042423226e-01   +7.280367933832453e-01   +3.354488871672416e-01   +5.414909272831705e-01   +9.056852772655533e-01   +5.405065280886445e-02   +7.609234384235913e-01   +5.267447132238164e-01   +4.851263714254158e-01   +6.539929569827946e-01   +8.714061940276889e-02   +1.039832938842895e-01   +4.877925438517687e-01   +8.320475239220288e-03   +2.517699020951013e-01; +1.222438276528423e-01   +2.708231004039485e-01   +7.368239950350393e-01   +4.685842072558537e-01   +7.055503648535750e-01   +6.746525517506367e-01   +4.408080308764748e-01   +6.316175637223513e-01   +7.295890356592509e-01   +8.904618662037014e-01   +7.508220693355331e-01   +7.726351483745821e-01   +1.108786710925109e-01   +7.695427442645794e-01   +4.241313036620528e-01   +8.934581374839130e-01; +2.062299786640808e-01   +2.100384383561650e-01   +6.339675512236809e-02   +6.481014431005684e-01   +9.988783419538689e-01   +4.682209879627828e-01   +1.466122248740406e-02   +9.120899805224815e-02   +7.074598150282868e-01   +7.998990908672108e-01   +5.840303135529068e-01   +2.074050019403005e-01   +7.859141669493875e-01   +3.971520189188249e-01   +6.553464562722626e-01   +7.029919806837021e-01; +1.464354218269153e-01   +5.637132980931212e-01   +8.594246294266820e-01   +2.415515497300905e-02   +2.878818035000302e-01   +9.120193566026336e-01   +8.970981572564252e-01   +8.059735590235265e-02   +7.805537110457931e-01   +7.347737377487054e-01   +7.408292636510831e-01   +3.888598586742824e-01   +2.908779490503837e-01   +2.727690546411248e-01   +7.233365168680277e-01   +5.555981888513719e-01; +1.888881083994570e-01   +6.386295096027349e-01   +9.330695980370487e-01   +8.426776263750444e-01   +4.134338488182197e-01   +1.033597443647218e-01   +1.954833644554740e-01   +7.752422803951373e-01   +2.881119931444873e-01   +5.254206716059143e-02   +2.343409323592221e-01   +5.519472862620012e-01   +6.038093775534168e-01   +3.747263186503152e-02   +5.301506402649886e-01   +1.842467602428056e-01; +4.315370230529743e-02   +4.163199330748066e-01   +9.838772033365799e-01   +5.583062014642945e-01   +4.664600972323275e-01   +7.447239415030458e-01   +9.297238550402880e-02   +9.054966895949647e-01   +6.901569450914606e-01   +7.243574088353771e-02   +7.344911284758936e-01   +2.286778998867782e-01   +9.636174653871044e-01   +6.737890170641966e-01   +1.077638323091893e-01   +2.116453169546962e-01; +6.350025639927525e-01   +2.065202507814451e-01   +8.573123649362271e-01   +8.535155520892131e-01   +7.643270650364371e-01   +7.376412458340084e-01   +3.072114562058020e-01   +5.336092949732029e-01   +5.554740577662810e-01   +8.726830104848607e-02   +9.717003622176050e-01   +6.420917539303019e-01   +4.317215439554086e-01   +4.306840111256709e-01   +6.327251917201595e-01   +7.746257436058290e-02; +2.819301735913157e-01   +9.489137986044358e-01   +7.854252904175623e-01   +3.484599337949530e-01   +8.176373283423647e-01   +5.619987553643121e-01   +4.556654490916023e-01   +1.084449165238534e-01   +3.948873858429366e-01   +7.957975907393560e-01   +8.674515189249058e-01   +4.832969919164997e-01   +6.945113784519364e-01   +4.507928376267356e-01   +1.286346256150291e-01   +9.143202230345052e-01; +5.375782904605643e-01   +8.094197538580140e-02   +5.143374528674652e-01   +4.464090176785933e-01   +9.933315591976773e-02   +1.854780009590945e-01   +1.017603097770156e-01   +8.269595336214668e-01   +6.155881966529086e-02   +9.423953329342454e-01   +8.661290476962535e-02   +1.516172757406525e-01   +7.584916162811433e-01   +6.084610632327736e-01   +1.345045673492516e-01   +7.070799305582102e-01];
L2I_L1I_iGABA_netcon = [+5.585986122087868e-01   +1.593558183241185e-01   +4.231688570807557e-01   +6.830259484933696e-01   +8.085765801268839e-01   +7.951520057521833e-01   +7.884651360910295e-01   +2.619348759703296e-02; +3.127966098002991e-01   +7.586511216500356e-01   +4.293597884485410e-01   +4.633823856837102e-01   +7.477461088362932e-01   +5.778609802939175e-01   +8.512432837719125e-01   +4.208922213407051e-01; +1.658555790452283e-01   +8.705890965725027e-01   +1.253012245416233e-01   +2.131090058825509e-01   +1.185874174302403e-01   +4.415477240591184e-01   +5.065281553051615e-01   +1.828120204672215e-01; +6.214090161962688e-01   +3.510807217724224e-01   +2.376434651264743e-02   +9.844557918906359e-02   +5.250584440878442e-01   +2.572314494341725e-01   +6.355874049289788e-01   +7.266984925168657e-01; +9.875560366262078e-01   +6.856868760978198e-01   +2.902715452347960e-01   +8.229637045858582e-01   +3.250674023945777e-01   +7.522175791888572e-01   +9.519704674894236e-01   +3.700628523922928e-01; +1.712580453696341e-01   +2.934454156591211e-01   +3.182475695317558e-01   +1.755992200458101e-01   +5.459381396568429e-01   +2.287087545173924e-01   +4.439887204768643e-01   +8.416128648259423e-01; +2.582036813931749e-01   +5.298362013546172e-01   +6.538559527893939e-01   +1.644057176373295e-01   +4.001867535515856e-01   +6.521857404179432e-02   +5.815535345909736e-02   +7.328518786672632e-01; +3.975110909102949e-01   +8.329644992968120e-01   +9.572174457644594e-01   +6.674745145830238e-01   +4.153624242972963e-01   +7.666859107108092e-01   +8.676368043038343e-01   +5.692190935252698e-01; +7.499695795857067e-02   +5.992354247427601e-01   +9.368523353918190e-01   +8.935144470976373e-01   +1.795024729504561e-01   +6.719487958656427e-01   +6.307394917289139e-01   +1.775957919556753e-01; +6.840414240070589e-01   +3.348275812813750e-01   +4.581555768671718e-01   +5.165558570526788e-01   +2.557870884486269e-01   +7.142049548356793e-01   +3.529125727025108e-01   +9.592559080943907e-01; +4.039445540285964e-01   +2.987468647821724e-01   +2.400310084438558e-01   +7.027894159177168e-01   +1.940565519783005e-02   +6.428195915919557e-01   +9.969543096633185e-01   +2.651878267839482e-01; +9.824940606630573e-01   +4.528772717694050e-01   +7.644056119717593e-01   +1.521200301630828e-01   +9.229230442549192e-01   +4.191337389071693e-01   +2.249356380717761e-01   +9.247258365274276e-01; +4.008912739027302e-01   +4.235989345783594e-01   +7.593788999176068e-01   +9.530496484091622e-01   +6.544230266926315e-01   +3.901647938567334e-01   +6.524107202207332e-01   +2.221303596390332e-01; +6.215403326301162e-01   +3.596254743436948e-01   +7.398444011937063e-01   +5.402849176436286e-01   +9.336001516659300e-01   +8.174340732772275e-01   +6.039139712824081e-01   +3.726112679871671e-01; +1.550523867651953e-01   +5.604917369211639e-01   +7.445160368850372e-01   +6.809777080342735e-01   +1.642700172842771e-01   +3.163953480979900e-01   +3.874734712472221e-01   +8.797678333659591e-02; +3.818200227854027e-01   +7.428341473680704e-01   +1.085793930984486e-01   +3.708278601702501e-02   +9.221836827834579e-01   +8.159395785627152e-01   +1.402096101196493e-01   +6.413006698334377e-01];
L1I_L2I_iGABA_netcon = [+1.812353736636887e-01   +9.118559232835427e-01   +2.758938928169200e-01   +8.685497569059517e-02   +5.333972044455602e-01   +1.067547389946025e-01   +9.887234582214469e-01   +4.116092711148295e-01   +7.194510027198040e-01   +2.177285159647475e-01   +9.222798721993123e-01   +6.738534575824945e-01   +1.064775834098019e-01   +5.562017201701333e-01   +6.307427039983272e-01   +4.837845530008143e-01; +4.568344391208686e-02   +8.002698686776210e-01   +2.473872115597457e-01   +8.028524836118114e-01   +8.869472661086785e-01   +6.152574634619470e-01   +7.671815528251554e-01   +6.009565594484432e-01   +9.968178069559031e-01   +1.261899012209667e-01   +7.699786513480197e-01   +4.773117199756713e-01   +1.805637080072512e-01   +7.714482660905199e-01   +1.005146736591470e-01   +8.944515688071555e-01; +7.233785381993925e-01   +7.447542702866972e-01   +4.522724151487025e-01   +9.893255274182273e-01   +8.981900294284128e-01   +9.405106676459738e-01   +3.362862033831692e-01   +7.495876463191191e-01   +3.545858381937411e-01   +3.086996456575789e-01   +4.239548004739138e-02   +6.237186496404117e-01   +9.982296519896068e-02   +3.122561069244346e-01   +3.922777792885183e-01   +1.388613807910277e-01; +3.486164303951102e-01   +8.123801457975196e-01   +2.266708767207160e-01   +6.654088370344727e-02   +6.258721932267320e-01   +3.530552600248024e-01   +6.628925419444611e-01   +5.844974840233671e-01   +9.709092454533027e-01   +7.249403915031488e-01   +3.795030229517715e-01   +2.374979104929109e-01   +4.902530318110884e-01   +1.781863612111186e-01   +5.529153426477260e-02   +3.890068766287324e-01; +6.603431071688785e-01   +3.834210695958647e-01   +8.048495263001765e-01   +9.401325391518672e-01   +1.374135536507818e-01   +4.109791401171057e-01   +2.456631622188779e-01   +5.516321078547486e-01   +3.479147086116652e-01   +7.829020163013440e-01   +7.040239004692027e-01   +1.780472331193227e-01   +1.928051328233020e-01   +3.382248177857303e-01   +5.005556368494603e-01   +9.274399327685015e-01; +3.855341304751417e-01   +6.181546155125367e-01   +9.855253340910666e-01   +1.775959273531618e-02   +2.185786809385736e-01   +9.837098415479677e-01   +2.942701385961586e-01   +5.806796888994392e-01   +8.860632835482429e-01   +6.921031388134803e-01   +7.273032954846554e-01   +8.286031203465106e-01   +8.941179272209638e-01   +2.098179302983818e-01   +4.309884681960027e-01   +9.192885679525650e-01; +6.279988931007016e-01   +5.772943473247177e-01   +3.038633930528534e-02   +6.845810989169088e-01   +1.812177858519953e-01   +9.457022959920398e-01   +6.783842744467921e-01   +5.115069987444120e-01   +4.549140758358972e-01   +9.943868061371470e-03   +2.253965567784399e-01   +7.659234760619662e-01   +9.908813369070360e-02   +5.102641804523075e-01   +9.982664004816041e-01   +7.153401928671248e-01; +2.315217680722372e-02   +5.276264683951453e-01   +5.356956399657032e-01   +7.834517277018216e-01   +4.221609714842640e-02   +6.773091041216835e-01   +5.265397327449240e-01   +8.120458641085913e-02   +4.148277423640755e-01   +8.452960785914454e-01   +2.687226272589048e-01   +9.348415313938129e-01   +4.451595876275411e-02   +9.047044206597907e-01   +8.104068665437387e-01   +6.177709249770336e-01];
L2E_L1E_iAMPA_netcon = [+3.424755447751089e-01   +7.584457935433477e-01   +5.896961095129921e-01   +5.013186954913188e-01   +8.520168211049935e-02   +4.765154640676100e-02   +9.237917625124347e-01   +4.756667336000506e-01; +9.369449946434227e-01   +4.143304429994297e-01   +6.615214822177822e-01   +4.893504258666226e-01   +9.742113227761845e-01   +3.436893184944345e-01   +8.010975376583350e-01   +3.640576238398878e-01; +1.236433242445892e-01   +4.936691423430503e-01   +4.816940130231573e-02   +8.787915101681719e-01   +6.512182217650303e-01   +7.376183686443747e-01   +2.864738946240371e-01   +7.884540466881476e-01; +7.313339608477151e-01   +6.961213828577623e-01   +3.484716829807458e-01   +3.520752421563914e-01   +2.313364845897102e-01   +7.951326609219018e-01   +5.440014082362561e-01   +7.807564098819294e-01; +6.467413310135794e-01   +9.742037138766761e-01   +4.491200449991872e-01   +4.487829570752450e-01   +4.026853816438817e-01   +5.449491196633824e-01   +9.838795095544733e-01   +6.683643770483277e-01; +8.332762537908316e-01   +3.276147575821057e-01   +2.387770802942973e-01   +9.639191418117274e-01   +1.212025258414912e-01   +6.872347605210810e-01   +7.153823574167258e-01   +1.336485395001963e-01; +3.969477278150184e-01   +8.375057545401630e-01   +7.148678867749654e-01   +4.230714385709129e-02   +2.686139347499251e-01   +8.953269660213472e-01   +8.383247017717379e-01   +1.985313705961567e-02; +7.501551443045761e-01   +7.399916972041610e-01   +8.572630854692479e-01   +9.739597244913050e-01   +2.561633143204326e-01   +5.392130231055411e-02   +4.346533366396784e-01   +5.597621543136647e-01; +8.351150370836209e-01   +9.539318399232786e-01   +2.830139575741172e-01   +1.876521323895482e-01   +3.328440879330085e-01   +3.040011829813176e-01   +4.713390747084622e-01   +3.014796634474513e-01; +3.238410737370294e-01   +3.315718312391164e-02   +7.314313170816984e-01   +6.660929298037298e-01   +1.495099798002385e-01   +4.532454180539731e-02   +5.612653456791422e-01   +9.388463345941260e-01; +5.514224829994044e-01   +3.553076199473337e-01   +1.399087720207302e-01   +5.879039495151229e-01   +3.474249603452217e-01   +1.952919815401106e-01   +2.694805281461189e-01   +9.819089681694442e-01; +9.811229201443582e-01   +6.622630947966162e-01   +8.390151359500019e-01   +6.754157159809940e-01   +1.206026615138568e-01   +7.187923579633865e-01   +7.481226607633473e-01   +2.863223894653878e-01; +5.486496532840309e-01   +2.815200320854531e-01   +1.390810727790275e-01   +3.593126035198804e-01   +8.833355739816697e-01   +7.222425629408364e-01   +5.043343100940419e-01   +8.004355927936098e-01; +3.310720720472973e-01   +2.303659208040498e-01   +5.875686513717336e-01   +6.200781599265168e-01   +9.528681461841891e-02   +8.776586240926874e-01   +6.471101782754931e-01   +8.947625988594949e-01; +6.188906357009760e-01   +7.103298023057592e-01   +3.670234835546095e-01   +8.110639191696718e-01   +9.308955318653689e-01   +5.806953259582170e-01   +3.077341502491959e-01   +5.985718148209275e-01; +3.620680020700253e-01   +6.235043983509294e-01   +8.058142488523411e-01   +1.986859549302950e-02   +4.000180242413849e-01   +7.231738667048691e-02   +1.390447334867903e-01   +8.838308155982103e-01];
L1E_L2E_iAMPA_netcon = [+9.429201386056835e-01   +3.724435468328852e-01   +6.681184040591756e-01   +4.853012787371410e-01   +2.469275605217083e-01   +4.520752466855571e-01   +1.232803169493967e-01   +4.972562699983358e-01   +8.824901042256683e-01   +3.244324156645977e-01   +5.144720389894623e-01   +8.580716550895831e-02   +6.318089353717711e-01   +4.289938616167722e-01   +6.128319684637565e-01   +5.035838706804064e-01; +5.486571775153773e-01   +9.364567774778062e-01   +2.087883544405774e-01   +7.573387484937529e-01   +7.849124762933175e-01   +2.057894838948395e-01   +4.061493830179490e-01   +6.932546448684591e-01   +7.196364028680660e-01   +2.459992429093141e-01   +6.575801063223203e-01   +1.632167617322299e-01   +8.584198385573210e-01   +4.919741303982103e-01   +8.203677345595568e-01   +6.124373963619628e-01; +7.288335310669909e-01   +8.286927022185880e-01   +6.535876779318885e-01   +4.163994904100122e-01   +8.828751678293061e-01   +8.986642108438848e-01   +2.758907124816670e-01   +8.336267567600645e-01   +1.898466267802539e-02   +3.430423982362880e-01   +9.516637490330754e-01   +3.245833405654227e-01   +9.761344410392142e-01   +7.137894115958732e-02   +8.864891768317168e-01   +8.198922224626037e-01; +5.772618578414761e-01   +8.500690660808454e-01   +7.216179409337628e-02   +9.723485073882983e-01   +9.122405380618881e-01   +7.634503093568987e-01   +7.170530585977057e-01   +6.117495914920114e-01   +6.742745548067877e-01   +3.754459325094038e-01   +7.224223640757955e-01   +3.015254539059740e-01   +5.696909098142738e-01   +8.876882313124154e-01   +9.309798349535420e-01   +5.328029183173097e-01; +2.556565618160125e-02   +3.714971354834560e-01   +4.071814925998646e-01   +9.893568331104543e-01   +5.580090662264298e-01   +8.831950970628391e-01   +2.828262295014908e-01   +5.747695174838247e-01   +4.392197621936167e-01   +5.454685973668546e-01   +3.997977355360918e-01   +1.157076162631544e-02   +9.968704065708714e-01   +6.484450684469022e-02   +1.920989317962532e-01   +2.026110756697617e-01; +4.474927431094772e-01   +5.927209191160643e-01   +6.659543769071417e-01   +8.637296827701487e-01   +5.991531035289652e-01   +2.865817457422968e-01   +8.959069814909194e-01   +3.240874190877298e-01   +4.363414460604136e-01   +5.635196254587739e-01   +8.340756595257571e-01   +5.411148991930483e-01   +5.534747484937595e-01   +4.354577121451159e-01   +2.578107287832989e-01   +4.546843893399015e-01; +6.473930259330316e-01   +8.741975120992660e-01   +9.360279515722284e-01   +3.878262064111053e-01   +1.480091286367169e-01   +6.710652953756152e-01   +8.269671123605778e-01   +4.558621857396147e-01   +1.163039276249502e-01   +3.950362948502278e-01   +1.354860917684133e-01   +9.665965488124462e-02   +5.150518315824835e-01   +8.252893383769595e-01   +8.968943632501272e-01   +4.284634138493908e-01; +5.217727376935848e-01   +9.334238995038977e-01   +8.094993813175831e-01   +4.535823153983034e-01   +9.014327509899509e-01   +6.635210891412175e-01   +3.900587268488749e-01   +7.141812192767120e-01   +8.144705974352604e-01   +3.970109690084911e-01   +5.993553711378741e-02   +1.471524695029419e-01   +3.316350852703982e-01   +3.924918412523239e-01   +5.938903974872975e-01   +9.657149763177245e-01];
L2I_L2E_iAMPA_netcon = [+6.193979875373026e-01   +6.958730391938583e-01   +7.344336234764411e-01   +5.902933153014135e-01   +6.695964864861100e-01   +5.501619201525704e-02   +9.942241363802910e-02   +8.482817113489022e-01; +6.971793868551581e-01   +4.265245901324060e-01   +4.300645072509637e-01   +4.590878005986762e-01   +5.004808903461309e-01   +1.536199365553181e-01   +9.079297733990971e-01   +9.171215532049563e-01; +7.211754356182662e-01   +8.367168685353868e-01   +6.941035217318237e-01   +5.205071161969512e-02   +2.194443029640383e-01   +1.979445878735548e-02   +1.103083826561094e-01   +9.869320477504215e-01; +3.473258867517861e-01   +7.304033120475589e-01   +9.452899373861712e-01   +2.287665745932475e-01   +5.721174275113650e-01   +4.351259043379410e-01   +5.179361192760592e-01   +5.039069393153749e-01; +5.175555896834575e-01   +3.603912331725227e-01   +7.840220250591042e-01   +8.337989935633193e-01   +1.221190396795080e-01   +8.321281275906931e-01   +1.429782694727401e-01   +2.709749981399467e-01; +5.571050574381964e-01   +4.538546722083374e-01   +7.054669465547964e-01   +1.524149224047385e-02   +6.704461012189030e-01   +6.167875880797250e-01   +5.590699202746755e-01   +1.012688299277802e-01; +1.577707561670858e-01   +3.875336910790384e-01   +1.093537617986585e-01   +8.642544224222044e-01   +5.997333944811840e-01   +5.193093249303821e-01   +4.664924436872214e-03   +5.081756444300692e-01; +5.636837914684951e-01   +7.753016151019873e-01   +3.897791235246990e-01   +7.885290830789261e-02   +5.582686647376368e-02   +8.634721686367340e-01   +7.679537171997776e-01   +5.845138771664159e-01];
L2E_L2I_iGABA_netcon = [+7.643494316681273e-01   +9.421111044392622e-01   +2.384225067221201e-01   +8.334750536828976e-01   +2.577229185847720e-01   +7.520763825535545e-02   +1.736894419803786e-01   +5.237874117761734e-01; +8.267661929720466e-02   +6.567795110535302e-01   +5.782046455677955e-01   +4.023656546645565e-01   +2.985077870499134e-01   +3.943289208329755e-01   +1.396334781759679e-01   +2.646854733791828e-01; +6.602468112671127e-01   +4.515197898916299e-01   +8.664431546818612e-01   +3.910285129395589e-01   +4.248904822254794e-01   +4.003232292062794e-03   +5.980644011233325e-01   +6.823886658660330e-02; +5.166855227389743e-01   +8.397777091705863e-01   +4.056881686529150e-01   +3.620546549717148e-01   +1.183031283078735e-01   +2.198277218364959e-01   +8.997504476981378e-01   +4.361538389669158e-01; +1.719690698350898e-01   +5.332123047926806e-01   +1.120471826639924e-01   +1.379612838630449e-01   +4.967932146978996e-01   +4.976430522606975e-04   +9.388916000442027e-01   +1.727925354567557e-01; +9.398767769733064e-01   +5.538017647565031e-01   +4.440371989993394e-01   +2.577046659765701e-01   +7.065894350187122e-01   +1.903242665176460e-01   +2.200166507680425e-01   +2.697579433279740e-02; +5.911068287034037e-01   +6.804709405293152e-01   +2.980904065216332e-01   +8.646542066035946e-02   +2.436571130630165e-01   +1.421819054441527e-01   +4.812821402410178e-01   +9.540283433686825e-01; +4.403803822985776e-01   +3.671977561927887e-01   +4.010709701266040e-01   +4.292649715931091e-01   +7.846930634571133e-01   +2.678869497907586e-01   +3.768411520834234e-01   +4.308569411008117e-01];
L3E_L2E_iAMPA_netcon = [+9.618095058149638e-01   +7.731160336947310e-01   +9.113288999173235e-01   +5.309436268236597e-01   +4.761990550723789e-02   +8.186925315580595e-01   +6.251434802156322e-01   +7.484193789233716e-01   +6.737770030553204e-01   +9.053980502269572e-01   +5.822448774358711e-01   +5.923012821794364e-02; +7.624620970580394e-01   +2.270698449314144e-01   +9.074652674196076e-01   +7.160622377940832e-01   +5.520673735808764e-01   +7.268301978584192e-01   +5.419535617794221e-01   +6.464455312152111e-01   +4.318433018128560e-01   +3.939579008548597e-01   +6.868948851432626e-01   +9.809121509005208e-01; +8.241741745029939e-03   +3.704366045540421e-01   +5.916706213251434e-01   +1.800203857565342e-01   +2.743406073156376e-01   +1.779324567448584e-01   +4.377670584693265e-01   +1.217548238760284e-01   +6.924261143710835e-01   +2.513797710572343e-02   +7.204579076135592e-01   +2.846792196260752e-01; +6.796734483423498e-01   +8.921527999452212e-01   +3.316076563759917e-01   +3.350885889142382e-01   +2.433634869455308e-01   +3.607174645354508e-01   +2.865512925166626e-01   +5.051876127183262e-01   +2.568878658763453e-01   +6.703602826435370e-01   +6.492863485937423e-01   +5.936347161131564e-01; +7.049239518020552e-01   +8.566786907085068e-01   +8.530659784336964e-01   +1.871264508345653e-01   +2.426576287563498e-01   +1.870037225842147e-01   +5.010630817435833e-01   +3.477846377906249e-01   +1.162761936609595e-02   +8.372066249004411e-01   +7.254076773501834e-01   +9.611079767800075e-01; +6.452639504021365e-01   +4.010634349557348e-01   +4.428214275029405e-01   +3.211835666955988e-01   +1.545206738167613e-01   +1.194952563508450e-03   +7.627272911838984e-01   +9.076046572288460e-02   +5.314484516133768e-01   +9.711185434748996e-01   +3.743687085269367e-01   +1.870968493535254e-01; +5.537138195204897e-01   +3.189498458638740e-01   +9.021310536942362e-01   +4.039586168689457e-01   +9.581967916783082e-01   +3.144734483502909e-01   +7.617458733347504e-01   +1.478000498435776e-01   +2.798013760405073e-01   +5.682403088246855e-02   +5.802060534960500e-01   +1.929643238799936e-01; +2.176214438023102e-01   +6.084703173348520e-01   +3.426531456336654e-02   +5.484508516934490e-01   +9.361536218206131e-01   +6.984864244032764e-01   +5.767453500445969e-01   +1.991521961772773e-01   +9.459631429135282e-01   +4.498875854059144e-01   +1.146552712479625e-01   +3.405942566520673e-01];
L3I_L2I_iGABA_netcon = [+9.332349567475257e-01   +9.295291635324381e-02   +6.188943143716235e-02   +2.784084989974385e-01   +2.545283828818296e-01   +4.041490423862024e-01   +5.294981828759423e-01   +1.088139899233647e-01   +9.126052260533195e-01   +5.844198607967547e-01   +2.084618261219734e-01   +9.079602621668265e-01; +3.907793856513045e-01   +6.167364677946543e-01   +4.946183493371158e-01   +7.459258899971791e-01   +8.576982097812821e-01   +9.877012152752577e-01   +8.296542668006808e-01   +2.711394125608155e-01   +6.392680352521070e-01   +2.835959633402770e-01   +3.176367020587446e-01   +5.512297448413227e-01; +2.725496569973601e-01   +1.138100982948718e-02   +6.434988094658246e-01   +2.378790207944639e-01   +9.112326169945746e-01   +8.962924445953420e-02   +8.574035851551930e-01   +5.239452539043332e-01   +2.550003729890252e-01   +8.279836842005439e-01   +1.333441209070020e-01   +3.398851751686781e-02; +1.523126182094177e-01   +5.732829408364986e-01   +2.226801807202780e-01   +9.575673438101292e-01   +6.993404896863654e-01   +3.222062644673313e-01   +7.882452521872898e-01   +9.725053783343376e-01   +9.048374025803271e-02   +1.918458202749339e-01   +6.725636521251936e-01   +5.407126470765413e-02; +3.966410052988865e-01   +7.877062266276220e-01   +8.376276989347093e-01   +6.217222401041476e-01   +7.262939380252666e-01   +5.135055569388334e-01   +3.189391081590274e-01   +7.088472847889865e-01   +8.385659735000326e-01   +4.412672992337350e-01   +5.703244237632894e-01   +8.058022100707578e-01; +3.745736134479600e-01   +2.355627830134776e-01   +9.711315053189838e-01   +6.007546088083778e-01   +2.302240459137717e-01   +5.908133156917138e-02   +4.527539712618055e-01   +3.106595736243864e-01   +5.843080673597537e-01   +3.931465490608854e-01   +1.703471454872185e-01   +4.515389210697987e-01; +1.294672375523951e-01   +4.480031555782916e-01   +8.466540243071043e-01   +1.729499814532861e-01   +5.745631012895688e-01   +7.252519370175013e-01   +7.525224616784777e-01   +2.937063295245547e-01   +9.483318187099690e-01   +8.272321892986061e-01   +1.478327996158390e-01   +3.809030543911667e-01; +4.340574302108918e-01   +5.691138290650246e-01   +5.066603965857083e-01   +8.995565861764264e-02   +8.111465692075153e-01   +5.571952541411422e-01   +1.109489024829645e-01   +8.498277770442952e-01   +6.165930838345066e-02   +6.788093502255350e-01   +4.762118639891025e-01   +7.906157588450484e-01];
L2E_L3E_iAMPA_netcon = [+3.646805674243120e-01   +7.558501609832273e-01   +7.407874823275078e-02   +5.178787810490354e-01   +7.577007644244050e-01   +4.319658878039412e-01   +1.997078911556971e-01   +8.758369325899940e-01; +5.318271877713965e-01   +9.975819356012281e-01   +5.914606170744243e-01   +9.946293113030282e-01   +9.951303934653122e-01   +5.426592736089735e-01   +1.936076076396060e-01   +7.862318815109498e-01; +7.130688198272960e-01   +1.875662473847197e-01   +9.101559406501090e-01   +8.566458716864765e-01   +9.626353063682928e-01   +7.119035355547920e-01   +3.265293280860944e-01   +4.666601942169494e-01; +8.709740776440741e-01   +7.810576444503152e-01   +1.918435844902169e-01   +9.610944762370618e-01   +5.357011748036661e-01   +1.604385880928988e-02   +8.803756857758572e-01   +8.135107807910696e-01; +3.289538664146490e-01   +1.956536750297448e-01   +4.316769600896266e-01   +6.780467267624718e-01   +9.655520620697994e-01   +8.016028795122234e-01   +4.716268706901686e-01   +8.969106158119706e-01; +6.495479778332669e-01   +9.921545170239536e-01   +7.488994219817974e-01   +4.023357384312456e-01   +1.171210875252056e-01   +1.421128247135742e-01   +4.042724322108348e-01   +4.280863364739058e-01; +9.761298046378001e-01   +8.017444119284247e-01   +4.002193190813421e-02   +9.336193285206269e-01   +5.014985373254210e-02   +4.793661215192755e-01   +1.804574591494628e-01   +3.338978828387091e-01; +7.655562223912410e-02   +4.241872141086128e-01   +9.461468463035538e-01   +4.802217442919747e-01   +3.028879864401554e-01   +2.554747448505619e-01   +9.694299489790202e-01   +5.965231389940154e-01; +5.885555470498741e-01   +7.286907852898890e-01   +7.633990098449950e-01   +2.298498797419924e-01   +5.813415805614558e-01   +3.694634440269596e-01   +4.084456526426954e-01   +9.010683051304601e-01; +4.130642648507949e-01   +4.976154345527830e-01   +5.568157374906376e-01   +3.966289055804962e-01   +5.319128673435831e-01   +6.611546838435769e-01   +8.441486224670754e-01   +7.018321999152871e-01; +3.085817820239230e-01   +8.088464117725817e-01   +1.837024206670254e-01   +7.044854069926557e-01   +9.004398786143804e-01   +1.680561395718211e-01   +6.167511119613694e-01   +3.785354216273060e-01; +2.636580538644409e-01   +3.570628855175177e-01   +5.001246545774878e-01   +5.585244427190631e-01   +5.402573161722249e-01   +2.799506190585845e-01   +3.744736006060433e-01   +7.349434041372389e-01];
L2I_L3I_iGABA_netcon = [+9.547128282584866e-01   +3.139388238610508e-02   +9.091336656726468e-02   +4.595370445949475e-01   +3.271106885595676e-01   +3.676740833963693e-01   +6.851678924469231e-01   +8.048977537507971e-01; +5.425100303683309e-01   +2.084825968588373e-01   +5.936569049115779e-01   +6.383621531728086e-01   +8.043627264922150e-01   +2.098123818963972e-01   +9.100698546927970e-01   +6.652243364880130e-02; +5.387971946591515e-01   +4.544680062650464e-01   +2.406892966139955e-01   +9.165259084651420e-01   +9.999436556176141e-01   +4.405446214902271e-01   +6.109467472093152e-01   +9.484541665040865e-01; +3.094367996740585e-01   +1.265689591749545e-01   +8.391652157204660e-01   +1.612880664801796e-01   +9.795348123490599e-01   +9.543934979756898e-01   +8.997614355347536e-01   +4.954916723517941e-01; +6.987506579226450e-02   +9.268077929015470e-03   +8.575761966401555e-01   +7.140496652262022e-01   +1.255911546422687e-01   +1.236244235068447e-01   +1.937367450081366e-01   +7.539567466222135e-01; +1.822596458677891e-01   +7.276813660056103e-01   +9.611816517323831e-01   +5.771248978084506e-01   +2.302197238195339e-01   +4.695369371016097e-01   +7.536048677621067e-01   +7.402399213873648e-01; +9.218640886696648e-02   +3.530144403025943e-01   +4.885545926259157e-01   +4.318382737336704e-01   +2.390202918423811e-02   +8.548901675721070e-01   +3.472343494035344e-01   +8.308366307998851e-01; +4.637567034204174e-01   +7.789423518043616e-01   +2.185524747745975e-01   +8.829479303382574e-01   +6.077560895021094e-01   +4.226699679454868e-02   +4.188757219839356e-01   +1.556824619657149e-01; +9.946731017580255e-03   +4.363216835270269e-01   +2.267196926682926e-01   +3.914177106914293e-01   +1.095904733003819e-01   +6.897993039737221e-01   +1.542798650349560e-01   +4.570277657081168e-01; +9.140503103017852e-01   +4.370780709295110e-01   +5.366303751892183e-01   +1.775644547114491e-01   +4.069393403905562e-01   +9.768804921915601e-01   +8.190892257212317e-01   +6.184913375013139e-01; +6.424046366700423e-01   +5.037241118470302e-02   +7.618061218917331e-01   +6.314324127677758e-01   +8.835580205972753e-01   +2.837639686690003e-01   +6.227863190334717e-01   +9.297408208230287e-01; -6.101725589247495e-05   +4.806619062677493e-02   +3.460397375431755e-01   +6.237868353015852e-01   +5.483104607072917e-01   +1.335778198778401e-01   +7.397826330763905e-01   +8.337901775560530e-01];
L3I_L3E_iAMPA_netcon = [+8.948383363719916e-01   +2.551748994806327e-01   +7.402369985484422e-01   +6.815424216424084e-01   +6.016918866459106e-01   +7.484977444998420e-01   +7.455115929750989e-01   +2.233492719973771e-01   +4.526515420487039e-02   +8.008095391143011e-01   +2.905476897384547e-01   +8.023540951820384e-01; +5.819087619940342e-01   +3.227661493053354e-01   +6.934567588457758e-01   +2.360744311769052e-01   +8.560529367429931e-01   +5.435429471607054e-01   +1.270841153993928e-01   +3.513205960803662e-01   +2.139261300098385e-01   +2.338035400697243e-01   +4.030078622221497e-01   +1.037133431020199e-01; +5.825886403125360e-01   +4.018851911147990e-01   +8.229885286247298e-01   +4.555752936628098e-01   +9.897325578112975e-01   +3.393100299096078e-01   +8.215695176005480e-01   +2.863197088486087e-01   +3.970375876124504e-01   +9.310965542105853e-01   +8.628895981141439e-01   +8.210244731177960e-01; +8.553465026424116e-01   +4.052759240801661e-01   +8.289194100022478e-01   +3.837996726582609e-01   +9.290101225039218e-01   +8.321748250482104e-01   +2.663648586414294e-02   +9.270816162416025e-01   +3.337107226777705e-01   +7.631765869678673e-01   +6.149977505626329e-01   +8.409971731998963e-01; +3.352860835613557e-02   +3.864417032765569e-01   +2.948869847929045e-01   +5.379473797237864e-01   +4.103661981976564e-01   +5.511504361829667e-01   +4.161069391771911e-01   +5.093889385228265e-02   +2.287045601000594e-01   +8.276470442372865e-01   +9.904147112095172e-01   +3.559052152048491e-01; +8.844507609045726e-01   +6.087496264771223e-01   +3.089196755879534e-01   +9.909632834932993e-01   +7.859757613777069e-04   +9.578628613388451e-01   +7.302036962184779e-01   +5.928689238097302e-01   +9.348479110772611e-01   +5.729238679760877e-01   +2.037245078388437e-01   +4.296709749989948e-01; +4.066012591163187e-01   +1.654095145965905e-01   +5.238697318005801e-01   +7.553254459135239e-01   +5.423935600707648e-01   +8.933265314456120e-01   +7.816077966023250e-01   +1.618073654969333e-01   +6.819461739424577e-01   +7.926416715600476e-01   +8.280508553217236e-01   +5.702228704060024e-01; +3.678000243265206e-02   +1.888500163028124e-01   +3.269895143667271e-01   +9.816337180757626e-01   +2.084538980914012e-01   +3.575312328968452e-01   +3.677197653561183e-01   +8.376096327570974e-01   +9.634592484804120e-01   +3.290860591318064e-01   +6.766133380766453e-01   +6.999170660583327e-01; +7.461504403863276e-01   +9.599815516003611e-02   +8.342081043528315e-01   +2.351932275667000e-01   +2.196586625308051e-01   +5.479103955155712e-01   +7.464165046021344e-01   +1.680569990324683e-01   +4.388719367462898e-01   +2.235113891238502e-01   +2.486533419968376e-01   +7.431532896595096e-01; +1.556893834108845e-01   +3.220614258200079e-01   +8.088767086614344e-01   +5.286729298812110e-01   +3.278267015001399e-01   +3.468317646577668e-01   +8.925225980092975e-01   +5.012711509190271e-01   +9.385707520299260e-01   +3.111021194028083e-01   +4.772783991805370e-01   +7.571368958644101e-01; +1.442336402574349e-01   +7.699478640121254e-01   +5.586649612882177e-01   +5.353383484264922e-02   +9.601525920857021e-02   +6.230190576722121e-01   +2.444277917946362e-01   +9.989592628875776e-01   +5.863716613156066e-03   +5.847779859077951e-01   +3.991722633734920e-01   +3.892051276672941e-01; +6.068007047347467e-01   +2.351498171461832e-01   +2.638160032657065e-01   +7.577250648640999e-01   +7.495777323851172e-01   +7.980366604290582e-01   +1.291639471929040e-01   +3.547158032135524e-01   +6.110752913927877e-01   +8.300329864904811e-01   +5.988000111656192e-01   +4.267508507978317e-01];
L3E_L3I_iGABA_netcon = [+9.555832284556806e-01   +8.848653632723249e-01   +8.001293142384038e-01   +9.852133265722126e-01   +9.018766186344891e-01   +9.613854183549674e-01   +6.536833488743942e-01   +4.940710388120092e-02   +1.086631196704275e-01   +4.523227404122315e-01   +8.291902065817712e-01   +5.807644050645999e-01; +5.725634646824356e-01   +4.375695275364189e-01   +9.868033083657105e-01   +5.599616985548814e-01   +9.946548618471599e-01   +5.421036819287068e-01   +6.593384731690149e-02   +4.662433284608832e-01   +4.610694170706304e-01   +3.341892392024184e-01   +6.259069703722155e-01   +6.366660219739476e-01; +8.500664272247628e-01   +7.820319196700874e-01   +1.595042759601631e-01   +9.326866976984619e-01   +6.517284000633744e-01   +3.150132364102645e-02   +2.756712968524528e-01   +3.248469856578891e-01   +4.512021437896560e-01   +5.893047337383844e-02   +5.397950790276220e-01   +6.506268699885951e-01; +2.767080474041050e-01   +1.494285778467319e-01   +2.374440106437799e-01   +7.204464640200493e-01   +1.072024736087520e-01   +6.959596007602693e-01   +2.816393574009926e-01   +6.306954479128715e-01   +5.501908252531779e-01   +7.410712123672891e-01   +6.503073578549841e-01   +8.636156981974873e-01; +6.224367358268390e-01   +6.203954263252137e-01   +7.017622570291970e-01   +4.848978271393534e-01   +3.765867090465574e-02   +5.194342676032709e-01   +8.791977613870330e-01   +2.293992968901500e-01   +8.063620255117916e-01   +5.064134049387956e-01   +7.259607482823871e-01   +5.676824434864258e-02; +5.903015271207371e-01   +2.603588741719098e-01   +3.768575487444563e-01   +6.393628454020720e-01   +6.190680789150802e-01   +6.019460823956470e-02   +4.446983608480292e-01   +5.800060124773029e-01   +7.010876381556030e-01   +2.011060970103714e-01   +9.445796505928865e-02   +8.182326084843735e-01; +9.643967917240639e-01   +4.449465129642339e-01   +9.752139540896568e-01   +8.878083509926943e-01   +5.661605455840735e-01   +8.889384290232379e-01   +7.575835833500569e-01   +6.040736649192227e-01   +8.728852887490165e-01   +4.262118146418670e-01   +8.788153341564655e-01   +5.287745404718328e-01; +8.664215225842030e-02   +8.451539090132555e-01   +9.711620371266102e-01   +1.972623333276936e-01   +9.618758895514091e-01   +3.298452589454922e-01   +6.018050083707638e-01   +6.000590322671970e-01   +5.214597231621639e-02   +1.681113677124847e-01   +1.263185932716077e-02   +6.954933827260324e-01; +5.010950327687306e-01   +1.976367162533458e-01   +6.426416890114774e-01   +3.959986973382227e-01   +7.474804700155091e-01   +2.283140780044618e-01   +7.830868543070248e-01   +4.480238913285733e-01   +2.186628391668558e-01   +7.510636790319263e-01   +2.920138070327040e-01   +2.120663588074656e-01; +5.218877443309603e-01   +3.032422652214760e-01   +8.597047036209067e-01   +9.921791275958689e-01   +6.625268062546394e-01   +1.137667069226571e-01   +1.141639651864294e-01   +3.348909691565811e-02   +4.588990045345475e-01   +3.672996057483940e-01   +1.792398543965825e-01   +5.442210213221638e-01; +9.039131007202973e-02   +4.805233108990610e-01   +4.015487759892063e-01   +4.016362864299288e-01   +5.237970023269404e-01   +3.122347411128000e-01   +9.775442756060874e-01   +5.125727891317243e-01   +9.584672430269112e-01   +9.423305291845938e-01   +9.262014626824074e-01   +7.038368130940833e-01; +9.060151112140383e-01   +3.375527000327656e-01   +6.310784612141387e-01   +6.590296052335871e-01   +2.594361999224807e-01   +2.271152391984409e-01   +8.491330460241051e-01   +4.067511736183645e-01   +7.916803257894214e-01   +1.599883078997200e-02   +6.858033948699294e-02   +9.557410085907349e-01];
L2E_Input1_iAMPA_netcon = [+9.972001336575691e-01   +9.998354225673662e-01   +9.983845024145995e-01   +9.988745926283595e-01   +9.969777317846268e-01   +9.971934465189897e-01   +9.979149411245067e-01   +9.967671966215632e-01];
L2I_Input2_iAMPA_netcon = [+9.984404203146325e-01   +9.984274924033900e-01   +9.990499118864704e-01   +9.992998667272978e-01   +9.988290175657684e-01   +9.974399977275038e-01   +9.999963666970045e-01   +9.975614159263316e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
