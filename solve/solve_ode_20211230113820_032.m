function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.133727124032054e-01   +2.466623255142748e-01   +5.232016682498662e-01   +6.049204399707233e-02   +6.951940021469967e-01   +7.475844720583618e-01   +4.538399928371899e-01   +4.330686993617637e-01   +1.613884713623873e-01   +5.339616202300788e-01   +6.552706016551205e-01   +2.638282898482733e-01   +9.783510735655351e-02   +7.346629089239444e-01   +2.470629323669052e-01   +6.507139395731641e-01; +6.855469637491047e-01   +8.150457404011094e-01   +3.502246522779358e-01   +4.753201177326661e-01   +6.603264779679108e-01   +2.481812280643083e-01   +4.614919208220696e-01   +2.508604107896746e-01   +5.101295911446168e-01   +7.647048586889325e-01   +7.533327831489230e-01   +6.805237234612611e-01   +5.710754228351631e-01   +3.235122770911177e-01   +3.308769719186883e-01   +9.845768154721424e-02; +1.779110194883197e-01   +2.264799926081990e-01   +4.880288230214755e-01   +2.875503996527232e-01   +2.455501380759459e-01   +6.670797317199892e-01   +3.887881081705625e-01   +3.214856719047846e-02   +6.860145647608640e-01   +2.296557189760220e-01   +5.654042274702207e-01   +6.961698036995095e-01   +3.878400338800524e-01   +4.896889549267378e-01   +6.510524266439170e-01   +2.494114199589438e-01; +5.622192271936113e-01   +9.119407751403957e-02   +6.866140245944262e-01   +5.831671553595537e-01   +2.603833898297314e-01   +1.363758841138313e-01   +2.677155306223036e-01   +2.242988700023663e-01   +6.179288207987711e-01   +5.088374349897521e-01   +3.554165765682454e-01   +1.558346679950391e-01   +9.984559260724253e-02   +4.374047409091175e-01   +7.426890153608620e-01   +5.813529515912249e-01; +5.007135734371984e-01   +3.935222731325291e-01   +6.355219688478697e-01   +1.715904721628402e-01   +3.159991730412852e-01   +6.126359060968202e-02   +2.919373898358837e-01   +7.541138438434549e-01   +4.481009422203739e-01   +6.073214420614669e-01   +7.951727301160625e-01   +5.344422887296127e-01   +2.745631945376036e-01   +1.336279118193206e-01   +7.558253961509461e-01   +2.963781119763189e-01; +7.798910742509015e-03   +2.777538424737164e-01   +6.961475888427080e-01   +2.771045002712836e-01   +3.055552545157091e-01   +2.213220301863368e-01   +5.775230339571070e-01   +5.288191972061644e-01   +1.100304688608711e-01   +2.194718688496495e-01   +7.583558783617186e-02   +2.410040345558310e-01   +6.086516216923017e-01   +1.491157505761628e-01   +6.836522846948200e-01   +5.627307493459699e-01; +8.247936891236692e-01   +5.488001317020279e-01   +6.869270570996370e-01   +7.271040675551851e-01   +5.343154026905943e-01   -5.714921035508737e-02   +1.422934448713926e-02   +1.525015332197330e-01   +7.044936185742492e-01   +2.839444743684694e-01   +2.641147996000203e-01   +3.341020808943226e-01   -8.192622560634875e-03   +6.569802406100218e-01   +4.205084048274840e-01   +5.712113410127250e-01; +6.927760049148871e-01   -6.335577458431148e-02   +5.079607503698090e-01   +8.615070040830493e-01   +7.713349385825250e-01   +6.696154356030675e-01   +2.673905393080620e-01   +3.025177507707515e-01   +3.789789433041548e-01   +6.046938909170781e-01   +5.846373564033231e-02   +5.867750580805258e-01   +5.866753234460547e-01   +3.504318621616412e-01   +1.235280083316468e-01   +6.937019660166657e-02; +5.716473814586845e-01   +6.263100125395826e-01   +7.374462880138919e-01   +1.186791877800132e-01   +1.256273395375458e-01   +2.938051081315917e-01   +2.909181522300429e-01   +2.141812633030633e-01   +6.699906195106207e-01   +7.292352535823313e-02   +5.802523452724108e-01   +4.455759977396593e-01   +3.330742375694856e-01   +1.557833313674352e-02   +5.547940027284113e-01   +3.574214361998837e-01; +4.783091637112593e-01   +7.157103293516495e-01   +7.540615168321689e-01   +2.804687659586646e-01   +5.795086035969168e-01   +3.451755140406307e-01   +7.256846796968043e-01   +5.970040000052484e-01   +7.213219026540875e-01   +4.986800163716857e-01   +7.898265378921611e-01   +6.844016331727631e-01   +5.829693589550562e-01   +5.844722439304390e-01   +4.655368206344724e-01   +7.249289798471531e-01; +2.119698984927851e-01   +1.794715368229548e-01   +2.168685823668249e-01   +5.054887910058151e-01   +7.243854622972803e-01   +3.585788712313187e-01   -1.263415309037734e-02   +3.314065845941587e-01   +6.413447429914885e-01   +2.639803954643168e-01   +3.422807839780195e-01   +7.318488798917345e-01   +3.415540620255076e-01   +2.191940715212864e-01   +4.683397435761261e-01   +2.373118016952330e-01; +4.888784253498328e-01   +6.726790453097038e-01   +1.952997336638821e-01   +3.130279517501541e-01   +1.976998164946737e-01   +3.481038035104070e-01   +4.125518636149357e-01   +2.292410016751519e-01   +6.882575627281725e-01   +1.709193447163168e-01   +8.413412761358971e-02   +3.067538018843506e-01   +8.998752582587435e-02   +6.934643856380928e-01   +1.769355789354164e-01   +7.153593592759334e-01; +2.151642097257262e-01   +7.377383917342256e-02   +6.262979088200479e-01   +7.187268248721583e-01   +2.094916729404393e-02   +6.517103315133663e-01   +4.687776587495838e-01   +4.188815797691198e-01   +4.494892218641702e-01   +3.458371953543928e-01   +6.711516756516402e-01   +2.426185019033987e-01   +6.745675241346165e-01   +7.509559546211643e-02   +1.577768015259279e-01   +5.502515464053015e-01; +5.566593125727098e-01   +7.356768168433981e-01   +6.284747658503043e-02   +6.480371851776766e-01   +6.369183964969291e-01   -1.824514385474332e-02   +3.338520739613001e-01   +6.366136637797374e-01   +6.460257170070798e-01   +6.868900715197249e-01   +7.257791234242766e-01   +2.153829553484518e-01   +1.116075738562455e-01   +2.635297299925542e-02   +3.622261993656402e-01   +5.872328771636747e-01; +5.513529317583488e-01   +1.174672859714010e-01   +6.305804561890797e-01   +6.318194928327387e-01   +5.020253775189788e-01   +3.547793862101335e-01   +4.214838565214429e-01   +3.044713948117086e-01   +6.039529872969011e-01   +7.479938005965776e-01   +5.130682162114958e-03   -4.183381333707966e-02   +1.638075840804792e-01   +6.389867395979603e-01   +7.815591045703314e-01   +1.994454516414663e-02; +4.661908645117133e-01   +5.181637404515873e-01   +2.366729676893037e-01   +3.714906636952829e-01   +4.534263067583636e-01   +6.601966007720252e-01   +4.309293408204170e-01   +1.116247191427670e-01   +1.459286933808128e-01   +3.218596809705245e-01   +8.025750533610555e-02   +2.691518126988340e-02   +2.168701202640049e-01   +6.933168656714127e-01   +7.810022179041267e-01   +6.304513704458142e-01];
L1E_L1I_iGABA_netcon = [+4.408082475050293e-01   +2.616063202852577e-01   +1.489486725809511e-01   +1.139920165649028e-03   +4.064634171104445e-01   +4.479497374375497e-01   +2.916194884367417e-01   +3.228825731557615e-01   +6.482372733731906e-01   +2.462156803085082e-01   +3.550238803676179e-01   +7.620732553558843e-03   +3.107959028797246e-01   +2.284450708508051e-01   +2.931018322375392e-01   +4.024663410701430e-01; +4.350367426549704e-01   +2.953133772486720e-01   +6.758401304633341e-01   +2.822064006620574e-01   +6.468912863466535e-01   +1.177818740544458e-02   +1.658106259921367e-01   +1.345374789569902e-01   +3.955457176535413e-01   +4.362895823707745e-01   +7.699381537961620e-01   +4.525849882736608e-01   +3.106102028830296e-02   +3.913803698431538e-01   +1.828919937569941e-01   +7.530136067455374e-01; +6.336746083238897e-01   +4.965288560854372e-01   +5.269872285912982e-01   +6.076851059417216e-01   +6.987049236583498e-01   +8.423403346828128e-01   -3.709781344533039e-02   +2.685659691578382e-01   +3.368135076520661e-01   +7.853539507122476e-01   +6.405863940493036e-01   +7.030006014366251e-01   +2.166296658611440e-01   +6.938879066737753e-01   +7.753422797254418e-01   +5.300203939279536e-01; +2.450722641017972e-01   +7.851362046467961e-02   +2.819385778297648e-01   +7.038131908789202e-02   +2.465049845199931e-01   +5.688733529613533e-01   +6.794035544727356e-01   +4.593749916800645e-01   +1.373522960112362e-01   +8.526821322191547e-02   +3.852746462308823e-01   +2.539810595423014e-01   +6.482369335961051e-01   +1.989390393569233e-01   +3.442679342106094e-01   +7.048807968558107e-03; +3.426536377353951e-01   +7.705259238076623e-01   +1.080720857650093e-01   +5.462565661573783e-01   +2.864298604044763e-01   +5.154375143439335e-01   +5.726502001460411e-02   +1.077464626502668e-01   +7.538220010120238e-01   +6.972510578872340e-01   +7.130394749052457e-03   +5.188891870234700e-01   -2.887649009396257e-02   +5.213726761197959e-02   +5.967729351993489e-01   +5.090977871787528e-01; +7.558456343098976e-01   +4.129173081781594e-01   +1.323113779324851e-02   +1.837815119507329e-01   +2.911437325667969e-01   +6.640282431228440e-01   +3.082992689684456e-01   +5.740487313507193e-01   +4.517522267247428e-01   +5.350351002830505e-01   +1.934605185953089e-01   +2.166570614949147e-02   +8.137769107031925e-02   +6.643183608168935e-01   +7.206759232803964e-01   +5.637138238831669e-01; +5.249296142071514e-02   +5.362310827160385e-01   +4.039206548457538e-01   +7.305580683780510e-01   +7.611601019404188e-01   +4.604750333391078e-01   +8.598962457202806e-01   +3.998071931437712e-01   +1.521147232989769e-01   +1.849394858159435e-01   +7.735889591738714e-01   +4.052566580606383e-01   +2.707408921310434e-01   +6.100807683977712e-02   -1.577035941993269e-02   +6.788896367445383e-01; +5.101160481259615e-01   +1.726730632375484e-01   +6.022003466505145e-01   +5.048734689356602e-01   +4.263210871916212e-01   +4.808993171103795e-01   +6.510680166785316e-01   +2.455670304575507e-01   +4.893568346056386e-01   +1.653587652989038e-01   +2.861733720551826e-01   +5.212104392131919e-01   +4.148428610470881e-02   +7.907101373163274e-01   +2.360839362057030e-01   +5.950562613519015e-01; +2.353288933255585e-01   +5.687403095872002e-01   +7.017464463058928e-01   +8.164015557046199e-01   +5.996838390205449e-01   +2.803956525326892e-01   +1.266179968560613e-01   +3.457153261783382e-01   +6.317963157600731e-02   +7.538682052057928e-02   +5.516006841663856e-01   +6.408311859887560e-01   +5.647007627149330e-01   +4.520897025529684e-01   +3.063157505306557e-01   +8.018608577611157e-02; +1.076704219416317e-01   +7.799910937378097e-01   -3.368941334159459e-02   +6.123403023348766e-01   +3.462697955825677e-01   +4.091245815324384e-01   +1.291971475789557e-01   +3.702065764031840e-01   +8.612250539891442e-02   +1.458393544367344e-01   +7.593326470369607e-02   +2.118857796261119e-01   +2.461982393943815e-01   +4.180370767142276e-02   +2.461054964447449e-01   +3.029292727508830e-01; +7.860055731080355e-01   +6.025510737849514e-01   +6.754978973332564e-01   +4.281236171571466e-03   +6.375749030775547e-01   +2.494353877573625e-01   +5.772459070507270e-01   +3.233904759723814e-01   +4.078622211955753e-01   +1.851406744556970e-01   +5.546511503615833e-01   +7.309392163098274e-01   +7.640406436098875e-01   +3.058377813489140e-01   +4.289443073712496e-01   +1.382424601531671e-01; +5.671227022962390e-01   +2.029808819768741e-01   +3.291368716459410e-01   +4.045120337447640e-01   +5.690295305715821e-01   +4.152642190307334e-01   +7.111930597194112e-01   -2.011302919148497e-02   +6.005253554346099e-01   +2.632162609176553e-01   +6.900405125881379e-01   +7.742021165978545e-01   +6.222692124560320e-01   +4.085389538440325e-01   +4.282215366260620e-02   +7.684196257547212e-01; +4.082656837560478e-01   +1.420183407071002e-01   +1.747460606614987e-02   +2.057761332112973e-01   +4.096762244683749e-02   +6.415690611688969e-02   +3.666513955423406e-01   +7.807055183473036e-01   +9.110828683166308e-02   +7.772083041169121e-01   +2.897475846098404e-01   +4.033617424029590e-01   +1.263771547890531e-01   +2.878576467331330e-01   +3.985851292964838e-01   +4.723169278683249e-01; +2.072570254347016e-01   +5.488389686113708e-01   +7.450666461853973e-01   +1.480466142472570e-01   +7.733997194108658e-01   +1.061346737196212e-01   +6.441798139024333e-01   +2.627567979465951e-01   +3.808170867742186e-01   +1.704820578287414e-01   +9.447937515579530e-02   +7.684756333231210e-01   +2.113744556269860e-01   +7.338005479656998e-02   +2.176073186117917e-01   +3.225750068720065e-02; +6.876758229533532e-01   +7.183431327673113e-01   +3.264851158039594e-01   +2.521148359905534e-01   +2.378139428443718e-01   +2.721901512748137e-01   +1.435092792677493e-01   +1.993649677694715e-01   +2.078136288212435e-01   +1.032363177478126e-01   +2.805944096236743e-01   +3.420999262223071e-01   +7.262711999537185e-01   +7.307731672434961e-02   -1.369697420120520e-02   +3.041971039327384e-01; +5.885822496283982e-01   +7.547920210267127e-01   +7.734567414400633e-01   +3.125534754680876e-01   +1.033830514119722e-01   +2.684924030985243e-01   +8.473850345590696e-03   +6.923497888495245e-01   +4.594307861155627e-02   +3.974390030014484e-01   +2.759264343438139e-01   +7.372325580484251e-01   +2.876228080328346e-01   +4.833288412526136e-01   +8.283801361747736e-01   +1.073668484035581e-01];
L2I_L1I_iGABA_netcon = [+5.735958907575744e-01   +3.360861681870081e-01   +2.518315783316210e-01   +7.750190385179651e-01   +4.270539772317357e-01   +5.313095054362846e-01   +2.524506858341277e-01   +8.499953830917595e-01; +1.568403767870757e-01   +1.295422084852161e-01   +2.236568136403541e-01   +4.969543276153249e-01   +1.862613299449253e-01   +1.611810605370982e-01   +5.533645923205910e-01   +2.448281066576027e-01; +3.615342834195308e-01   +6.163199483631832e-01   +4.386239519645394e-01   +2.520945134830654e-01   +6.117381896091303e-01   +7.745537964243380e-01   +4.758115681154110e-01   +2.078299186440274e-01; +3.906795114048331e-02   +7.451345883210631e-01   +3.465092846513647e-01   +6.180086325437089e-01   +1.143989847769288e-01   +7.145917208560397e-01   +4.200106914019614e-01   +8.500620769486483e-02; -3.504229689202790e-03   +3.584392802523231e-01   +3.396259070909076e-01   +7.392199810195600e-02   +4.842926566958231e-01   +4.558973129455142e-01   +5.458334431876636e-01   +3.882364379124403e-01; +2.287140837781942e-01   +5.957746902956012e-01   +2.706495984800475e-01   -3.870077408761582e-02   +7.023070085840788e-01   +1.745686536045953e-01   +6.843399832489344e-01   +4.173186014578905e-01; +1.102396198834226e-01   +3.748900969421703e-01   +3.346531057544017e-01   -1.608960969668935e-02   +4.188054204835429e-02   +6.101246808791614e-01   +5.139920746526964e-01   -3.263596396089005e-02; +6.505777214858660e-01   +4.362202446478776e-01   +6.726127310475069e-01   +4.750247522994319e-01   +2.807598390871359e-01   +1.137190270258992e-01   +5.821721911413339e-01   +1.385762100909440e-01; +1.969011919373275e-01   +6.462577248944615e-01   +1.201288614065524e-01   +1.112272687730193e-01   +9.451863884806455e-02   +5.411053043416152e-01   +7.746641054116969e-01   +6.433443682366846e-02; +1.563482235484637e-01   +7.414642198734748e-01   +5.545280832923372e-01   +5.577943851335816e-02   +4.638825190183625e-01   +1.371342882191046e-01   +1.533290274793492e-01   +5.419838297497775e-01; +7.264634891485326e-03   +6.700397443462420e-01   +5.888857850677203e-01   -2.780810816216227e-02   +4.009802857781800e-01   +1.639470892871590e-01   +3.824499053224567e-01   +4.561665124543753e-01; +6.416888605430600e-01   +1.739597803953418e-01   +1.814867857084126e-01   +6.018938809530642e-02   +3.723721948111177e-01   +1.459046858310961e-01   +2.915540862579467e-01   +2.231776698538350e-01; +4.685828087647380e-01   +7.696546769234147e-01   +1.528238192514160e-01   +3.439485885094625e-01   +3.550889419523600e-01   +6.351998797567904e-01   +1.331923655167759e-01   +2.277568499146133e-02; +4.340244656628745e-01   +1.303873346291055e-01   +4.079702359551150e-01   +3.555910692704342e-01   +3.353437314141444e-01   +2.320095306010015e-01   +5.509672738013645e-01   +3.961074430154868e-01; +5.977091230637002e-01   +3.660635623526106e-01   +6.815927390294572e-01   +6.759238759206783e-01   +4.672584960623167e-01   +4.401581052450412e-01   +8.554553589396946e-02   +1.950551424024800e-01; +1.968170977410590e-01   +7.927420002345161e-01   +4.258333810286994e-01   +6.541124286663386e-01   +6.132225382210117e-01   +8.576370257542364e-01   +3.704341320765447e-01   +5.850595599926195e-01];
L1I_L2I_iGABA_netcon = [+6.980146493303303e-01   +7.910436726466047e-03   +7.431974696528729e-01   +1.787422305433883e-01   +4.513851809121667e-01   +9.823792411653093e-02   +1.699495592995325e-01   +4.861248596840100e-01   +1.621152455019452e-01   +3.833871652480501e-01   -5.646432667240907e-02   +3.470870542680771e-01   +4.105682705838979e-01   +1.864175533334657e-01   +4.555528512431241e-01   +8.607002762363822e-02; +3.168347299974611e-01   +6.599707618225077e-01   +3.119497921444129e-01   +1.632055394704514e-01   +4.956193669914599e-01   +1.864868822780624e-01   +8.361719702574940e-01   +5.571639368085149e-01   +8.050601812120128e-02   +1.699291640142207e-01   +3.485169179543880e-01   +2.177285267316121e-01   +3.277564920506555e-01   +4.444903852023298e-01   +1.100824292664812e-01   +2.273330876520526e-01; +1.960167016892294e-01   +1.270411032360939e-01   +3.891889327092392e-01   +8.420146724571911e-01   +7.794295679075124e-02   +4.837359313628515e-01   +2.330993172428544e-01   +4.173095683146614e-01   +6.943245864650069e-01   +1.289261656950365e-01   +3.236518756143901e-01   +6.421399997184560e-01   +5.123054128751039e-02   +5.139115377596155e-01   +3.304438860123769e-01   +7.618748637266316e-01; +1.655624196866399e-01   +9.123097626648674e-02   +6.979562829887661e-01   +4.534909375379546e-01   +1.764431193792550e-01   +6.097530132926476e-01   +3.153102447211065e-01   +5.085965679200364e-01   +3.771434189777392e-01   +3.406085485859310e-01   +6.479178546988514e-01   +2.448786166072172e-01   +6.029415541318962e-01   +5.627378932134778e-01   +3.701767163039155e-01   +3.283062135986952e-01; +3.408339748716076e-01   +6.148751750290530e-01   +3.053977047997428e-01   +4.388911657206674e-01   +6.056380289935354e-03   +5.493131359207133e-01   +5.523485608068837e-01   +9.111006691236831e-02   +3.990373896381908e-01   +1.833833281717383e-01   +2.961161682849516e-01   +3.772477644271245e-01   +7.553947087059499e-01   +2.204244378425062e-01   +3.821674739931817e-01   +3.553656339488325e-01; +3.831586066603829e-01   +4.457690093213960e-01   +6.150644924856773e-01   +5.795312878584375e-01   +1.133314204896297e-01   +3.415384337382353e-01   +8.074184376654961e-02   +1.466248209858726e-01   +7.370848345509765e-01   +7.216388823668938e-01   +7.620211378525232e-01   +1.465725308449413e-01   +4.827787399133323e-01   +4.317294464841922e-01   +6.525072158996243e-01   +7.119500426099263e-01; +4.333718079237966e-01   +5.445815467925716e-01   +3.166639738092992e-01   +5.977356091459846e-01   +5.913519145058967e-01   +6.011920440165340e-01   +3.576572532338013e-01   +4.144056574389576e-01   +3.570865000203613e-01   +6.658451295071187e-01   +5.043930015371173e-02   +3.002954492891205e-01   +1.422908568282852e-01   +3.902205800293645e-01   +4.598916354345025e-01   +1.443102174537431e-01; +6.116296250769878e-01   +2.135511219395657e-01   +6.463060064696972e-01   +1.779596881458984e-01   +2.563403907268373e-01   +7.860962184919817e-01   +1.091428464241238e-01   +5.382232122418508e-01   +2.772589915143713e-01   +7.108211368316404e-01   +5.162576807348787e-01   +1.915539546841896e-01   +3.081319574030776e-01   +1.307554913393966e-01   -4.215058157365018e-02   +1.866489783212292e-01];
L2E_L1E_iAMPA_netcon = [+3.485705757531239e-01   +3.421105715902642e-01   +7.842848385961800e-01   +2.545433405062247e-01   +1.762751746538403e-01   +4.013916856627437e-01   +2.777109259671665e-01   +6.934407461852427e-01; +3.518778912802970e-01   +8.986939488118692e-02   +7.676174540568267e-01   +6.075378573945476e-01   +5.814829866122865e-01   +4.777288156768572e-01   +1.333124265331710e-01   +4.024423697742471e-01; +5.965346171378265e-01   +7.613805126484356e-02   +1.263749793995404e-01   +4.081388960709150e-01   +6.363621288982835e-02   +5.341300766774550e-01   +2.283411014802202e-01   +1.759082165780058e-01; +6.330295541268079e-01   +2.331648649929525e-01   +1.413365117036300e-01   +2.581735928086230e-01   +2.323052283318263e-01   +2.021617828937378e-01   +3.529580581071620e-01   +6.269680528851548e-01; +3.585158989979327e-01   +2.159447524941192e-02   +1.884114636990246e-01   +6.944198763311848e-01   +1.046228018126248e-01   +6.048681862916540e-01   +9.211810573265707e-03   +2.379884648009900e-01; +2.380406814023613e-01   +5.993680268259275e-01   +3.144109348805296e-01   +7.437448539419341e-01   +7.765561907502160e-01   +3.585095274461319e-01   +4.694074678440988e-01   +6.135243172884421e-01; +5.614459940386356e-01   +3.448216348877844e-01   +3.195033530516678e-02   +6.999031756794516e-01   +7.390199918689924e-01   +3.907451425789650e-01   +5.475785521584515e-01   +2.635809983385233e-01; +2.299301799022170e-01   +2.917464573964766e-01   +9.721450351421140e-02   +6.392259649008120e-01   +2.687392428076123e-01   +6.666491629527599e-01   +4.852671404879053e-01   +6.637368840519482e-01; +1.079820502388103e-01   +4.730347629428049e-01   +2.815684587239274e-01   +7.583661809863231e-01   +3.085151029977071e-01   +5.702252616763308e-01   +5.308029810965872e-01   +6.353095937305929e-01; +4.643921219753722e-01   +7.660052371770756e-01   +1.688741954054326e-01   +2.836530558629664e-01   +9.341484235593797e-02   +2.562603086773521e-01   +1.400200840679028e-01   +3.732532449975721e-01; +2.807205668420539e-01   +1.242434228353310e-01   +7.160787578414651e-02   +6.466859545438028e-01   +2.409233911816456e-01   +3.027836422122739e-02   +5.587585560757150e-01   -1.497720395827351e-03; +4.707973250371818e-01   +5.395773243751605e-01   +6.947957444457781e-01   +5.525063220974104e-01   +3.655281792961315e-01   +6.228185495100018e-01   +1.118244957907989e-01   +1.077575152679870e-01; +1.582784507932166e-01   +5.557336908302626e-01   +8.540386352128759e-01   +5.925960110631765e-01   +7.071211666131951e-01   +6.183210968673732e-02   +3.042136245104701e-01   +7.033515195388534e-01; +7.108128859794814e-01   +5.686391586487175e-01   +7.181613287044358e-01   +2.051081363002132e-01   +3.090869022606004e-02   +2.782931601925652e-01   +6.887187600959191e-01   +4.964379501922642e-01; +4.535124039955414e-01   +1.062701248044915e-01   +2.916660314631620e-02   +6.673760353583434e-01   +7.497848333277305e-01   +6.599505801987275e-01   +7.221928906336886e-02   +2.851759786417194e-01; +3.799529644469147e-01   +6.690330688807010e-01   +1.800801084372286e-01   +5.451056840027263e-01   +5.502563619629388e-01   +6.985187695126337e-01   +1.740427561828459e-01   +4.327886191524086e-01];
L1E_L2E_iAMPA_netcon = [+2.870793318985377e-01   +2.881387578349709e-02   +1.431117703306016e-01   +1.682430487914178e-01   +7.015684992376949e-01   +5.834787715262204e-02   +4.311496557879053e-01   +4.323547315919950e-01   +8.601626906244499e-01   +4.354917438085156e-01   +5.668810558622660e-01   +7.088277209757534e-01   +2.061213657840107e-01   +3.667974817949373e-01   +6.023616128235699e-01   +3.413909688097371e-01; +6.134110462979180e-01   +5.300322943976594e-01   +4.740717935030330e-01   +2.567073240954708e-01   +1.875078908142314e-02   +1.540463467917747e-01   +7.015193599948094e-02   +7.436852392887675e-01   +6.961282449760973e-01   +6.771857187080148e-01   +2.860283318954809e-02   +1.550938915155832e-01   +3.888427998570097e-01   +4.266512111012379e-01   +1.586416358664005e-01   +3.295204630476912e-01; +8.159220531678950e-01   +6.871549220485156e-01   +4.180843146622897e-01   +5.868079417789632e-01   +3.975017156057038e-01   +1.346915077374685e-02   +3.418667971912368e-01   +1.727995418437465e-01   +3.323141310997503e-02   +1.414271553038904e-01   +3.156636460369953e-01   +5.592721729283892e-01   +1.179719147741427e-01   +7.026591001760146e-01   +4.752437667287803e-01   +8.018423060734546e-01; +4.788628438495563e-01   +5.413926087505401e-01   +1.008556215131315e-01   -6.785131160602968e-03   +3.038488341942716e-01   +6.530087388763213e-03   +3.522307487137124e-01   -3.240311967401221e-02   +4.969317556413201e-01   +7.601053960891730e-01   +4.138205983962996e-01   +5.841621869824163e-01   +3.001319585672050e-01   +5.344585228695733e-01   +5.824130697041215e-01   +5.374430034417805e-01; +1.171981266304939e-01   +3.739907717463484e-01   +7.132888241436329e-01   +7.561879119140046e-02   +2.452017073603980e-01   +7.876014969319391e-01   +1.714561315060449e-01   +7.107087900987832e-01   +6.312413638206626e-01   +6.426122972947131e-01   +3.303210808724032e-01   +1.842285305116505e-01   +6.569696190306392e-01   +4.701189579921836e-01   -5.044961689413846e-03   +2.813913061474952e-01; +2.500009037662944e-01   +6.850360204559760e-01   +3.101596485583609e-01   +6.327052196207620e-01   +2.477481109119255e-01   +1.017480526923432e-01   +6.627934484062022e-01   +1.817075650708498e-01   +6.776463057924588e-01   +3.850477719906217e-01   +4.341854610691339e-01   +4.568607142782622e-01   +5.629513625051361e-02   +6.255031496544899e-01   +6.018536376373448e-01   +3.303407036510962e-01; +5.808332079574139e-01   +6.987872800569485e-01   +3.422665427038657e-01   +3.994086272488987e-01   +7.456010084339662e-01   +7.544693800597717e-01   +5.596561330196532e-02   +6.407274215074324e-01   +2.210181700203665e-01   +6.179764660669448e-01   +3.337523873914071e-01   +7.456267598175096e-01   +3.330625769001757e-02   +3.117339756016518e-01   +4.255021159994034e-01   +4.082617739813240e-01; +1.452755717140751e-01   +1.448749186186014e-01   +4.877887936150475e-01   +6.168512984925422e-01   +2.963415213953816e-01   +1.353840172047567e-01   -5.597953876246340e-02   +2.657895616952153e-01   +4.369582056598393e-01   +7.877829111723881e-01   +2.379249581545948e-01   +5.023923443762923e-01   +3.877595390363934e-01   +4.013132168537291e-01   +1.441420884871330e-01   +2.050909420506567e-01];
L2I_L2E_iAMPA_netcon = [+1.426871301233191e-01   +6.182831107661265e-01   -4.669187084844484e-04   +7.856903735331722e-01   -3.397211154257026e-02   +6.952890190730344e-01   +4.785861516447040e-02   +4.030872414200117e-01; +2.520482673246428e-03   +4.746155924212832e-01   +2.499437455969461e-01   +3.464910815318368e-01   +1.176569138800007e-02   +5.776270172031313e-01   +4.585650266303654e-01   +6.109779411047682e-01; +5.176725755881743e-01   +1.551779434952621e-01   +5.986585272568522e-01   +1.503870944610071e-01   +1.982795722758516e-01   +5.474492996206773e-01   +3.899038683283072e-01   +5.563737304272817e-01; +5.593669627689848e-01   +2.059745881550119e-01   +5.355458828640705e-01   +5.060678891851249e-01   +2.979084278079279e-01   +4.258491807010898e-01   +2.138481177448875e-01   +4.870830984952997e-01; +6.716653450343959e-01   +6.097213458448613e-01   +1.489835942598806e-01   +3.587375195300694e-01   +3.559745351302177e-01   +6.508343770438594e-01   +6.833266999547363e-01   +5.145695346525325e-01; +7.282867321268434e-01   +2.355250956231577e-01   +6.922044824328057e-02   +2.422578617302850e-01   +1.024644076117539e-01   +2.037900244237373e-01   +1.888758231165086e-01   +7.208255372816010e-01; +4.175969203884622e-01   +5.511627965118169e-01   +9.783543528056567e-02   +3.779005473879986e-01   +7.284453565376944e-01   +3.929905075673485e-01   +6.954257081429400e-01   +8.067644941718027e-01; +4.871210266165294e-01   +7.528585873712850e-01   +2.942215637924077e-02   +2.234789953381641e-01   +7.187157027793166e-01   +3.002473784473523e-01   +7.958549759877361e-01   +1.991769894300662e-01];
L2E_L2I_iGABA_netcon = [+7.408374544592488e-01   +3.515631797375010e-01   +2.974219548742373e-01   +7.423512594426311e-01   -1.598252268809776e-02   +6.228088334659599e-01   +7.701164041013381e-01   +8.917037934104338e-02; +2.942263449601788e-02   +2.235031222402741e-01   +7.247126108607522e-01   +4.336478040346663e-01   +7.242067249190379e-02   +2.832045881918918e-01   +8.670888386625837e-01   +7.832063127874952e-01; +5.102056782405576e-01   +5.110120479478849e-02   +6.014568375318839e-01   +2.764336926862863e-01   +4.257898022881217e-01   +5.204946841878751e-01   +6.383070945075043e-01   +2.352484652293578e-01; +3.910268319284501e-01   +7.431831581365880e-01   +2.788333632389841e-01   +9.045158355342169e-02   -3.423801336143889e-02   +4.448211276748497e-01   +4.809496117470650e-01   +4.301308410287911e-01; +4.368588900920242e-01   +4.356113904454532e-01   +1.554565591550747e-01   +1.355198387686432e-01   +6.855010825367776e-01   +7.313542469540671e-01   +2.281677044790577e-01   +4.706175146650455e-01; +7.698997702754059e-01   +2.538764564707619e-01   +2.736622923550733e-01   +1.078886365860162e-01   +5.108536464378693e-01   +5.606946850466570e-01   +3.112469852161290e-01   +7.756964115148542e-01; +1.604727432532832e-01   +3.893838456418192e-01   +5.609012655860142e-01   +1.250517655972845e-01   +6.072682174428490e-01   +2.521569836097078e-01   +7.376748735216489e-03   -1.711404057422650e-02; +4.650413899899664e-01   +1.893824502728085e-01   +7.975829406538575e-01   +4.099752033134281e-01   +6.517719020334894e-01   +6.118095605537536e-01   +6.376873947118459e-01   +3.478285144624657e-02];
L3E_L2E_iAMPA_netcon = [+4.833659641586773e-01   -2.622033411380513e-02   +3.524012666648373e-01   +4.998405649714112e-01   +7.995146201188645e-01   +6.675467271653652e-01   +2.273539456234454e-01   +8.229666074659738e-01   +2.944449133425980e-01   +7.652475883465611e-02   +6.856054661642745e-01   +6.373477157504340e-01; +6.650766805538865e-01   +8.419581817183271e-01   +5.122515969208397e-01   +5.401216354666054e-01   +1.667151374984944e-01   +2.316978421634871e-01   +4.362439786589620e-01   +2.465753595879807e-01   +1.169666956054013e-01   +4.237826802462831e-01   +4.556527098723058e-02   +1.644565456056249e-01; +8.176424970393601e-01   +4.512539774252320e-01   +5.557432197184123e-01   +6.412414655048236e-01   +5.401857280410267e-01   +2.189920815182366e-01   +5.553277845062204e-01   +1.809021992255772e-01   +4.781389947308621e-01   +2.902841096034523e-01   +2.436933170562940e-01   +3.161623261097589e-01; +5.389558932934002e-01   +4.045363528026737e-01   +1.087094258058029e-01   +5.990118704687331e-02   +5.190738670812933e-01   +5.212612928927000e-01   +4.628517882850261e-01   +7.122838625048269e-01   +4.989319125092848e-01   +6.468782682776753e-02   +3.027274551165474e-01   +1.661783776514691e-01; +6.098041725587773e-01   +5.200014065272159e-01   +1.549498024230496e-01   +1.140794054704361e-01   +7.130742770842459e-01   +6.195312289523015e-01   +5.798228467504939e-01   +9.398264395952734e-02   +1.404656569192390e-01   -1.467999185989427e-02   +7.752597561908436e-01   +6.426853609148847e-01; +4.597722616493353e-01   +7.262070486776125e-01   +6.270805792032353e-01   -3.727147376694362e-02   -2.043536748392701e-02   +4.962714942981148e-01   +6.228994686057403e-01   +6.548703509348544e-01   +2.898439093188628e-01   +2.057347620103990e-01   +5.810177900452400e-01   +4.337843892231477e-01; +4.275838063237372e-01   +5.633899446054969e-01   +7.063462949027360e-01   +7.994068944849834e-01   +2.086269430768002e-01   +1.175541495235394e-01   +5.537142621637067e-01   +4.101041751202242e-01   +1.808909148404773e-01   +2.418679586948891e-01   +6.898712312561056e-02   +1.177190722993371e-01; +6.622532420305385e-02   +5.908436661980041e-01   +7.095002055384850e-01   +1.988453896609593e-01   +4.372836881297312e-01   +5.427768078377665e-01   +7.913145710382705e-01   +2.200251247006032e-01   +3.104175817204439e-01   +4.217932195139797e-01   +8.170953772674421e-01   +2.902771971608893e-01];
L3I_L2I_iGABA_netcon = [+5.170959345347763e-01   +4.621240058307225e-01   +4.717677250821740e-01   +2.803404670206172e-01   +2.623083487666145e-01   +5.861360415254984e-01   +6.296640206732470e-01   +4.180592135451926e-01   +7.431169133306008e-02   +2.907649951346197e-01   +3.662680783946523e-01   +5.694538862466958e-01; +1.803560806252273e-01   +6.636315567814144e-01   +6.987190620727587e-01   +4.684101290506187e-01   +7.537271295907717e-01   +8.245553451333409e-01   +1.513944294160971e-01   +6.671346700879249e-01   +2.862976189299125e-01   +5.517087292565847e-01   +8.915349168961688e-02   +1.655785380800245e-01; +1.518166662811344e-01   +7.215544235112841e-01   +5.982320543302021e-01   +6.344264158127946e-01   +3.244603590950761e-01   +2.570286315848139e-01   +6.077360526115241e-01   +2.231750945241276e-01   +7.254970967490376e-01   +6.212310196176308e-01   +1.299806300844120e-01   -4.180893076270205e-02; +7.147454219213343e-01   +5.087587166000646e-01   +4.725580331399777e-01   +2.305132390684634e-01   +6.495892441536872e-01   +2.559755497001986e-02   +6.151961867101151e-02   +1.828017784032419e-01   +7.073019836045734e-01   +6.528726410921469e-01   +4.767376971183802e-01   +1.984466634918722e-01; +6.021906438045157e-01   +2.527422069356242e-01   +5.653241079929662e-01   +1.299064379224830e-01   +3.190957919628941e-01   +1.422923154601281e-02   +1.922365796874929e-01   +7.668419453582216e-02   +6.045245975647576e-01   +3.090205677264639e-01   +7.091868923889202e-01   +1.650797085545858e-01; +4.835891780310463e-01   +2.623532429190817e-01   +4.869283153556655e-01   +2.911495239674079e-01   +4.658946175491587e-01   +4.778111497865203e-01   +7.575037498965587e-01   +4.973319380397501e-01   +5.195564084140784e-01   +1.651209777875472e-01   +3.416569104323089e-01   +5.786970020100465e-03; +3.352477370137387e-01   +4.888789546398492e-01   +1.657509194920924e-01   +2.571463402879370e-01   +6.403936088348968e-01   +7.355633931231972e-01   +4.833778075380580e-01   +3.233235861323243e-02   +5.345548533783894e-01   +5.401635120812831e-01   +2.135039580414732e-01   +1.345565405708908e-01; +2.621277912436671e-01   +5.706110933799795e-01   +4.659654977617990e-01   +4.493972072843639e-01   +4.183642251638476e-01   +4.006622538914701e-01   +1.954106766432244e-01   +5.631906548091099e-01   +2.053597272860997e-01   +5.290208766523037e-01   +4.727649150017989e-02   +3.104748697034933e-02];
L2E_L3E_iAMPA_netcon = [+5.050731237072026e-01   +5.176490335121932e-01   +7.195106056888557e-01   +4.833420471157865e-02   +3.426215406900972e-01   +4.328841601387416e-01   +3.105613426516447e-01   +7.738546647510497e-01; +6.351103326420288e-01   +3.378553007866605e-01   +8.521432572670846e-01   -9.098779781665012e-03   +8.796388294344222e-02   +6.049590467932536e-01   +4.104236887792403e-01   +4.784341593550553e-01; +1.684197711480161e-01   +2.126715184557517e-01   +7.597667613868202e-02   +4.093717379784046e-01   +2.552130060863335e-01   +2.770406417269948e-01   +5.749646123579031e-01   +8.023734745376317e-01; +3.679523067156198e-02   +6.635879557802238e-02   +1.619849145522193e-01   +3.960697394456407e-01   +9.614241026578982e-02   +5.211422918225185e-01   +1.888519034812876e-01   +7.241643310458455e-01; +5.924207450755105e-01   +6.034105893121259e-01   +1.557601785143508e-01   +7.070313315842408e-01   +1.574956111994461e-01   +8.003856151037136e-02   -4.065600213679867e-02   +5.213694265230299e-01; +4.152809431424517e-01   +2.064740437584587e-01   +2.339538841121493e-01   +3.280324392300655e-01   +6.151657562577025e-02   +4.124926607219038e-01   +4.439333330179125e-01   +5.866098912190992e-01; +5.774492333057245e-01   +6.448877694235140e-01   +3.956913572761049e-01   +3.201747207840986e-01   +4.642877525330899e-01   +1.425096085242497e-01   +4.032613241418392e-01   +5.780342504907187e-01; +5.079464101124803e-01   +3.469928876732850e-01   +4.992165210092300e-01   +5.659526601736521e-01   +5.280332562819789e-01   +5.902248182843682e-01   +5.028210400130748e-01   +1.520825761910711e-01; +1.000608239703083e-01   +3.616209682910617e-01   +3.544936112142031e-01   +5.719816782385072e-01   +3.848657396878881e-01   +4.355102805162292e-01   +3.286544854364579e-01   +7.472513706398269e-01; +1.889831720195660e-01   +2.201049287071539e-01   +1.592083001122723e-01   +8.570772810476318e-02   +1.561388477864054e-01   +5.276591654301130e-01   +6.397737666081970e-01   +7.189429336402032e-01; +4.519043812515942e-01   +2.723126069198307e-01   +6.134536813961505e-01   +4.393064576286017e-01   +7.853236243347261e-01   +9.623655303602702e-02   +4.844684006430658e-01   +2.519678481421284e-01; +7.241213897144297e-01   +1.961960748658104e-01   +3.670143129842473e-01   +1.812971988283147e-01   +4.835823285173348e-01   +4.900763410897805e-01   +4.760156961384715e-01   +4.081334503337201e-01];
L2I_L3I_iGABA_netcon = [+3.750234403909123e-01   +7.777850002024868e-01   +7.143424128330433e-02   +3.255674964495792e-01   +8.056935975653076e-01   +6.021373641759680e-01   +5.303030554826452e-01   +7.543539673846403e-01; +7.017476855778473e-01   +6.717601648791461e-01   +2.341458829066909e-01   +5.349948035936668e-01   +6.043683634105720e-01   +1.454741956343643e-01   +7.714152004400721e-02   +7.589982219837308e-01; +6.812167208266022e-01   +6.994448375301771e-01   +5.542941755005608e-01   +6.883855564279764e-01   +2.907250407815921e-01   +4.942878939842988e-01   +6.061004726798443e-01   +8.030373587491874e-01; +3.198820038630947e-01   -5.118813088546828e-02   +4.713565320258204e-01   +9.481649212902329e-02   +2.128191362576995e-01   +5.530804471825431e-01   +1.370193100171864e-01   +3.638452845901647e-01; +1.436541662002402e-01   +5.540435568443988e-01   +1.852767265658441e-01   +3.444081705065314e-01   +3.873937118937815e-01   +4.702569914292234e-01   +4.819229639655229e-01   +6.041980670022363e-01; +1.686459434045998e-01   -5.837005388104871e-02   +4.214767284498862e-01   +4.526434507064887e-01   +1.723380284916385e-01   +1.253792912955630e-01   +6.437904655973414e-01   +2.677446703467253e-01; +1.294832622566602e-01   +2.977284284214227e-01   +5.927092498091800e-01   +1.223091230651800e-01   +4.093919658836028e-01   +2.883193972301981e-01   +8.458972384435725e-01   +4.766189928406721e-02; +4.887571989467807e-02   +7.536187983427501e-01   +3.358089186558226e-02   +5.954696888930476e-01   +3.977041350369401e-02   +9.683856319950060e-02   +4.995093230456537e-01   +5.851538880972927e-01; +2.845306815461744e-01   +2.941201925802027e-01   +4.356697753750089e-01   +5.639045987325252e-01   +5.722123852414791e-01   +7.878614068305620e-01   +2.720865975961828e-02   +3.779694568224420e-02; +1.191710593731143e-01   +1.350010891831196e-01   +1.107158176222000e-01   +7.187146000421240e-01   +5.020369363225653e-01   +2.172399086077068e-01   +1.462144437483315e-01   +2.766903350087660e-01; +3.811538867866215e-01   +6.923463292267616e-01   +1.100052003982654e-01   +8.270377786815515e-01   +1.164753410307925e-02   +6.574190268290027e-01   +1.410077391136417e-01   +8.612782900661504e-01; +6.133123505137510e-01   +2.593308025033192e-01   +3.349668497472348e-01   +1.324953664115196e-01   +7.372924095118640e-01   +5.138307018938844e-01   +5.682622936928849e-02   +3.162189814845264e-01];
L3I_L3E_iAMPA_netcon = [+6.510000595801315e-01   +1.864202233236650e-01   +5.007723039704525e-01   +5.363740706850449e-01   +8.144367678560923e-01   +3.668811542097509e-01   +1.941737270825311e-01   +1.108500676045389e-01   +3.319132930938141e-01   +4.310987545686213e-01   +2.844926481925936e-02   +3.841108270317642e-01; +7.139439550886623e-01   +7.409360396076760e-02   +2.260107175365202e-01   +2.151385045522323e-01   +2.482118101160521e-01   +3.370775851976265e-01   +2.384432286979963e-01   +6.384864573513538e-01   +6.199566537940404e-01   +5.532183849306712e-01   +7.901618613723036e-01   +5.286427389345885e-01; +5.078034157427738e-01   +2.824050878833306e-02   +7.236242219336325e-01   +1.631116429820017e-01   +1.709372995241738e-01   +6.973538001754225e-01   +8.421787285170632e-02   +5.190697974065048e-01   +2.622085051912710e-01   +3.981957457652135e-01   +6.349828122812167e-01   +5.361305103830238e-01; +6.005957807990201e-01   +1.630036473228360e-01   +5.543264093212055e-01   +7.081486917544736e-01   +7.041581421086521e-02   +6.810249803518853e-02   +7.303698427090988e-01   +3.216315232795139e-01   +3.561042266212319e-01   +1.101681742232190e-01   +1.519231414925344e-01   +4.343611478146210e-01; +7.729392399777224e-01   +4.085542397252940e-01   +3.883160340291356e-01   +7.344716514417973e-01   +4.013152076909191e-01   +3.059463915478614e-01   +9.400545627221910e-03   +3.525497580297314e-01   +8.787816782438573e-02   +4.599189378679133e-01   +4.677802482871861e-01   +5.046364143025759e-01; +7.952919115791433e-01   +6.573967653681367e-01   +1.794450594054936e-01   +4.640819948202443e-01   +7.253523231079899e-01   +5.242992799427399e-01   +2.008741776763663e-01   +1.206844984441735e-01   +5.168162839454794e-01   +4.080297061198608e-01   +6.888215988741697e-01   +7.423886890816145e-01; +2.704524546009689e-01   +2.604585081271180e-01   +2.337171542507861e-01   +1.264111635799957e-01   +4.433826347493485e-01   +6.351863764169074e-01   +5.552762253210614e-01   +4.150581563425139e-01   +6.452339355861256e-01   +6.096191925437370e-01   +3.249998238636888e-01   +5.886436151457205e-01; +5.153526125040300e-01   +6.040033900700367e-01   +1.524548333006286e-01   +1.371104908471385e-02   +7.221077986206186e-01   +1.731144501966052e-01   +4.632680584444722e-01   +5.928638664445979e-01   +6.375968958724970e-01   +7.706393212419457e-01   +3.474789237415463e-01   +6.540599273242657e-01; +4.779343309821360e-02   +7.199342030735560e-01   +6.053746649714686e-02   +6.011418178606517e-01   +4.697783288571832e-01   +3.998683794877986e-01   +1.247420825608162e-01   +7.697171067567649e-01   +1.573393485348260e-02   +5.583395052352976e-01   +6.746533222330596e-01   +5.204153477971166e-02; +1.638170873764566e-01   +3.352717415168191e-02   +7.055697254082494e-02   +4.944542051332371e-01   +3.553494327784446e-01   +6.422421025445576e-01   +2.849765377539088e-01   +1.621984127617525e-01   +5.754850466747865e-01   +5.774562654919113e-01   +5.861377763786753e-01   +5.304952099607458e-01; +4.662349505107252e-01   +1.718111254126796e-01   +7.161161965263642e-01   +3.359994314948727e-01   +3.620810851444939e-01   +5.007212083012919e-01   +3.252478715294038e-01   +5.905615854360145e-02   +1.600399990963017e-01   +5.002369375540847e-02   +6.846134751745721e-01   +1.406282750313480e-02; +3.548132858589999e-01   -4.590383100313963e-02   +4.526729995821418e-01   +5.082146240961868e-01   +2.323410598503521e-01   +4.822497099394181e-02   -1.515545412387697e-02   +4.891587479396100e-01   +2.842297309503962e-01   +5.376302373535936e-01   +8.799422310060019e-02   +1.671823437943403e-01];
L3E_L3I_iGABA_netcon = [+5.732050058566779e-01   +1.977300900215214e-01   +5.926538801896468e-01   +7.525063040880570e-01   +5.581562187068339e-01   +7.228336675775715e-01   +3.710981149638594e-02   +5.743600818344783e-01   +6.784874048089823e-01   +5.385016854956424e-01   +7.181639529620627e-01   +5.606085680045142e-01; +4.200116883116148e-01   +5.011917705916863e-01   +9.750316963945908e-02   +5.362476709436639e-01   +1.143217289964220e-01   +6.125988505450426e-01   +6.455379299644902e-02   +4.756032589315896e-01   +3.817421171364088e-01   +1.350340101382563e-01   +4.112182285419330e-01   +6.801636277766162e-01; +4.538026730852374e-02   +7.222795079181772e-01   +2.122214515667245e-01   +4.511369623360503e-02   +3.494891485435995e-01   +2.904170114626053e-01   +5.812453725999292e-02   +9.217645840932379e-02   +6.761075738717162e-01   +3.858339868625977e-01   +3.056026106977284e-01   +1.238134450378804e-01; +5.800061124766370e-01   +1.103621479599286e-01   +6.269541701571542e-01   +3.577674537298788e-01   +7.842167987010388e-01   +4.218037719646683e-02   +2.714281200151388e-01   +1.918407718520743e-01   +5.803100162909555e-01   +7.991847060475434e-01   +2.002784590278226e-01   +4.451177310644551e-01; +7.389425141752268e-01   +4.657565586975201e-01   +7.712969072172149e-01   +7.352981063626812e-01   +6.056850101088224e-01   +3.546069433653128e-01   +3.162374094579123e-01   +5.259574889879355e-01   +4.062465450536207e-01   +4.093776321209783e-01   +2.801279081162213e-01   +6.041310327449176e-01; +2.327239596105610e-01   +7.184682832688503e-01   +5.725322448011294e-01   +4.834107617217916e-02   +7.529416193497096e-01   +2.135659039749981e-01   +5.417668120154846e-01   +7.355833057268260e-01   +4.859777171339114e-01   +4.662631680636445e-01   +3.119225391356035e-01   +8.271991523697330e-01; +6.922052828466901e-01   +2.461302825151249e-01   +7.758219659014998e-02   +8.739612406507450e-03   +2.826289527813804e-01   +4.744914643203882e-01   +6.057482670337087e-01   +5.867163846166934e-01   +7.219935395103326e-01   +6.273672207985804e-01   +7.483622579529782e-02   +1.376262190686098e-01; -6.907706972755626e-03   +3.206905254668372e-01   +3.425798586511822e-01   +6.203043692225190e-01   -1.798177072104487e-02   +5.469814239636123e-01   +3.043796188358437e-01   +5.379789654235362e-01   +9.173159011208454e-02   +4.127398807572906e-01   +4.721942828668370e-01   +2.036342488065144e-01; -7.595667197174992e-03   +2.043734537951542e-01   +6.726957873684269e-01   -1.669411221593007e-03   +4.160698151301722e-02   +7.055458725179522e-01   +8.392234109371562e-01   +6.311173985144705e-03   -5.041681452686764e-02   +3.391320313004770e-01   +5.851576971250654e-01   +1.535305020855786e-01; +7.394514305915456e-01   +8.331140435287623e-02   +1.933245652018339e-01   +4.638701133363372e-01   +4.375429987013158e-01   +3.771998452887814e-01   +6.273837397757468e-01   +4.876782832126743e-01   +1.736521376045169e-01   +3.230832668053604e-02   +3.416274852326717e-01   +3.113586843993134e-01; +6.926674354378626e-01   +2.128514810597996e-01   +5.365826125219297e-01   +1.108033899467680e-01   +7.131932558414081e-01   +1.318924559702148e-01   +7.405155448588279e-01   +8.150461692723775e-01   +3.401544756898581e-01   +1.328776489856066e-01   +1.463853653799232e-01   +1.366421301747079e-01; +1.053333714503584e-01   +7.114401909028784e-01   +8.298174159165767e-02   +7.870855390923427e-01   +5.970023640967843e-01   +1.191311484444252e-01   +6.088699376205667e-01   +7.355182739510423e-01   +5.654165637979400e-01   +3.267083777946780e-02   +6.210738564093472e-01   +2.864687101667751e-01];
L2E_Input1_iAMPA_netcon = [+2.212409568667908e-01   +1.108712418309897e-01   +2.098638519527365e-02   +6.380003201103529e-01   +3.336077229791549e-01   +4.566430642993001e-01   +1.748931184674967e-01   +2.829116305714112e-01];
L2I_Input2_iAMPA_netcon = [+2.527644274711043e-01   +1.447008831287201e-01   +1.479038016407178e-01   +3.840889744875938e-01   +1.727070992975047e-01   +3.077309328619060e-02   +1.159016873256161e-01   +3.149063851162079e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
