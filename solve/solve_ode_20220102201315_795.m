function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.753714787450139e-04   -3.302628300385914e-01   +5.453179402393359e-01   +3.994151423582173e-01   +4.407195551193675e-02   +3.356894154322863e-01   -5.646925726849001e-01   +1.157408700014182e-01   +5.041890790823200e-01   +6.537191060292316e-01   +1.066563740916264e-01   +6.203365684207629e-01   +2.834969736132364e-01   -1.415277488619314e-01   -2.568462489938977e-01   +1.317862976077923e-01; +3.564969167779375e-01   +1.694875601535625e-01   +8.240255479982993e-02   +2.153977164717487e-01   -1.824833929584503e-01   +5.722361452789559e-01   -6.705463634883091e-01   +1.112303806980295e-01   +7.608590347590928e-01   +2.091978921639345e-01   +9.278223498603262e-01   +5.232730637578740e-01   +3.539030709278055e-01   -1.805745256808988e-01   +1.047673580333277e-03   -1.036423341258630e-01; +6.677918461954933e-01   +2.773507879294314e-01   -1.419210665372139e-01   +2.401686113322992e-01   +1.767785555756598e-01   +9.880824365103416e-02   +4.468040785758579e-01   +9.283785898656505e-02   +3.337094315353271e-01   +9.132111473319440e-02   +5.326005732387377e-01   +2.279877642200337e-01   +3.263952682315589e-01   -2.245031566817838e-01   -4.732630147023621e-02   +2.107877635993691e-01; -3.021711253382636e-02   -2.508422864702398e-01   -6.959159996092402e-02   +5.251365015147170e-01   -9.924948596028006e-02   +2.381104174933034e-01   +4.586084993858919e-01   +6.486042663072156e-01   +6.143186059370492e-01   +3.061864824925739e-03   +4.900811999629925e-01   +5.099379626232103e-01   +2.677570287283608e-01   +3.516783774115935e-01   +2.929310209015420e-03   +7.299484050716419e-01; +5.272745243798854e-01   +2.829176507987801e-01   +3.635868053489963e-01   +8.080864969005818e-01   +1.751315393880822e-01   +2.545456693681525e-01   +8.873388564093876e-02   +3.956208410020859e-01   -2.220892350886661e-02   +3.404572021600095e-01   +5.347881782584339e-01   -3.082134386956903e-01   +1.548908449929695e-01   +1.463443310940523e-01   +6.202209434041320e-01   +2.148065446628624e-01; +8.795106745444764e-02   +4.768683510531509e-01   +9.366267890625116e-02   +1.921968464862674e-02   +8.840914907707013e-01   +1.571977090836045e-01   +4.869119172227558e-01   +2.475978954055907e-01   +2.951421830742917e-01   +3.287481491706986e-01   +1.545137641838895e-02   -2.393271916855967e-01   +4.944032529610103e-02   +2.763156509362782e-01   -3.593624639466796e-01   -1.125233328926227e-01; +2.940934334215368e-01   +4.322876878602341e-01   +3.233622897773826e-01   +2.346402005522891e-01   +1.790117463142075e-01   +3.714774240251121e-01   +3.606169506195160e-01   +1.838761653331356e-01   -3.271915290777457e-02   +2.897943117064527e-02   -2.320105672939247e-01   +2.793130391458375e-01   +3.135640284783262e-01   +2.631953049044989e-01   +4.325812669154032e-01   +4.738394503550559e-01; +3.204429419108410e-01   +8.858235303668527e-02   -2.260798046661409e-01   +6.663008140341483e-01   +1.423894840279750e-01   +9.217520117245075e-02   -1.204654108626219e-02   +6.454081327894233e-01   +5.369238165990988e-01   +3.217289412845791e-01   +2.334816456354813e-01   +2.617517027829752e-01   -1.475325002753868e-01   +2.574319240503533e-01   -2.496967446113244e-01   +2.282527702838377e-01; +1.778746205528092e-01   +3.283027217368327e-01   -2.335582703719576e-01   +4.560328418508029e-01   +4.262116249746293e-01   +5.690496383676531e-01   +1.688063502646761e-01   -4.491579133678974e-01   +2.976650873018409e-01   +4.809027492857967e-02   +6.532804942789862e-01   -1.445401340767358e-01   +3.650161303649309e-01   +4.439986857909308e-01   -4.254147374111000e-02   +1.474455689934180e-01; +1.148736808019027e-01   +4.572135881035249e-01   +4.484615198857341e-01   +3.248448893464154e-01   +2.125282494778456e-01   +1.098722439990780e-03   +5.487743409203658e-01   -1.047025896708907e-01   +1.121085108944250e-01   -8.748944882992447e-02   +2.387820767767935e-01   +1.217242188012083e-01   +6.771831000078006e-01   -1.309661701728381e-01   +2.078924451540101e-01   +3.895206471913152e-01; +1.668860992115305e-01   +6.490417258797027e-01   +8.749311661040085e-02   +1.028134905673266e-01   +5.325694851931816e-01   +1.337468047585663e-01   +5.342546535183548e-01   +1.547113618591663e-01   +5.519239631185755e-02   +4.745615402779428e-01   -2.762487022955855e-01   +3.202852414391290e-01   -4.222523256225437e-01   +5.752588579705622e-01   +6.456215430720486e-01   +3.095264200152580e-01; +2.805560196391066e-01   +2.874337199651065e-01   +1.611540502767661e-01   -2.096285555935519e-01   +3.728576446125950e-01   +2.065209780962144e-01   +3.491556213329040e-01   +4.417361296599061e-01   +7.475762454030306e-01   +1.002404579832629e-01   +3.475038860412722e-01   +4.428860593605380e-01   +5.762534241928069e-01   +1.750210313235867e-01   -3.595710355890444e-01   +3.797084864219369e-01; +7.075302742104593e-02   +2.443341122858021e-01   +5.249047352806194e-01   +2.625398090202837e-01   +3.542166711772148e-01   +3.947400238371155e-01   +2.678816818813329e-01   +5.570174638977109e-01   +7.003821657466361e-01   +6.999314089966839e-02   +1.883089124719100e-01   +4.068405893808670e-01   -7.029236048609805e-02   +5.781351764141170e-03   +9.805375730435269e-02   +2.958275973972222e-02; -1.011330656507547e-01   +2.986022073862808e-01   +3.995043020509044e-01   -6.901922592379914e-01   +1.073874098656429e-01   +7.277776017971097e-01   +7.035503008574125e-03   +5.002779994546785e-01   -1.801786801949042e-01   -1.274379520743000e-02   +5.226511881662994e-01   +7.980782132054004e-02   +3.526962350462221e-01   +4.312430041382726e-01   -4.544813743607155e-02   -1.979609931333163e-02; +3.780862920622562e-01   -2.831378807945404e-01   +4.117764092115008e-01   +4.806726993386306e-01   -4.785737971566784e-01   +7.816942667861278e-02   +4.903598045429183e-01   -1.854678214281667e-01   +1.065405576532869e-01   +7.586703955013127e-02   -2.003193712882477e-01   +3.442156329762731e-01   +3.369056362550319e-01   +1.542568972362744e-01   +5.307775620678923e-02   -3.892471594678665e-01; -4.974906947214585e-01   +5.343760402050397e-01   +1.722642503105399e-02   +4.480272640004496e-01   +1.000000000000000e+00   +8.833235665178679e-01   +8.619205092921516e-02   +7.687605098498932e-01   -1.398846033216069e-01   +5.040344506729699e-01   +3.726057821972492e-01   +4.043344989462861e-01   +4.205709174133730e-01   +5.861850332786485e-01   +7.795776020355880e-01   +1.432084461300561e-01];
L1E_L1I_iGABA_netcon = [-1.826585112781330e-02   +2.007666251399125e-01   +3.508342732527718e-02   -1.614624997913327e-01   +5.597214971543650e-01   +2.194843830954913e-02   +1.665716870251900e-01   +2.858311890191190e-01   -3.542386943922420e-02   -3.596205281668121e-02   +4.672867217300186e-01   +4.715187178344011e-01   +6.641714598324598e-01   -5.207220258544651e-01   -1.531665564275863e-01   +8.986475755868713e-01; -2.773573013143108e-01   -1.166787922939168e-01   +4.453302123768366e-01   -3.423051076669403e-01   +5.485748200329304e-02   -2.888711729938248e-01   +4.913825524264815e-01   +2.991625760787231e-01   +5.589075621654543e-01   +2.101319304032169e-01   +5.990498885518387e-01   +5.959309815694758e-03   +6.429365774222671e-01   +2.322438805665988e-01   +2.610311709137546e-01   +4.220340874299138e-02; +2.214318672095221e-01   +1.231217691992444e-02   -3.253083416353854e-02   +4.530662591520176e-01   +2.082175083891021e-01   -2.077802709544931e-01   +3.267798533921084e-01   -1.989116890041775e-03   -2.101170441210572e-02   +9.121957319864652e-01   +2.998594871354544e-03   +2.312526661216400e-01   +9.543144066536147e-02   -1.074662760117441e-01   +4.898921431928201e-01   +4.331525168682107e-01; +4.718056384471571e-01   -2.151764657515558e-01   +2.658064478754535e-02   +4.233281669435386e-01   +2.098520530806162e-02   +2.804592656473859e-01   +8.583209788828197e-02   -2.065946663083193e-01   +9.875534647292160e-02   +2.006678376631941e-01   +3.456027292366662e-01   +4.868639620844799e-01   +1.398841360128444e-01   +3.996081521467688e-01   -9.230147893733720e-02   -4.013889207041615e-01; +1.890674680020078e-01   -3.666514162068570e-02   -6.286801830623666e-02   +2.693273658724517e-01   +2.789824481629658e-01   -1.324259796462089e-01   +6.402435632514433e-02   -2.093357911282790e-01   +8.723486412453615e-03   +1.131362598227526e-01   -2.198227887642042e-01   +7.207707320366542e-01   +2.247333371486788e-01   +6.685552865962677e-02   +1.978392376569559e-02   +4.967305772145956e-01; +2.009554089731891e-01   +2.237458435320665e-01   +7.347207751083876e-02   +1.595390796480861e-02   +6.461857484138656e-02   +6.212073164526186e-01   +9.420457822034408e-03   -4.090971991236392e-01   -2.309759384050471e-01   +2.540599775896015e-01   -1.138832633766133e-01   +2.663603035590194e-01   +1.599396414620885e-01   -2.322827335642336e-01   +5.575654329947649e-01   +2.196516902027736e-01; -1.006607393289972e-01   +1.432614559962641e-01   -1.553832515700153e-01   -1.405564195772647e-01   +4.964856037250358e-01   +2.624524477469762e-01   +4.436538708073004e-02   -1.378223774579430e-01   +1.150689813975738e-01   +2.371802853754585e-01   +3.921360898248422e-01   +3.331596802922646e-01   +7.213734552615933e-02   -2.188951480421629e-02   +9.803495438780070e-01   -2.279864592575821e-01; +2.134580425311562e-01   +2.584623329831285e-01   -2.495232956605844e-02   +7.896941383243113e-02   +9.533326883177516e-02   -2.785375394606231e-01   +3.764916588149340e-01   -3.203697660157308e-02   +5.740223744187909e-01   +1.447359107330662e-01   +2.149612837863897e-01   -3.912889260901836e-01   +2.655247210980368e-01   +4.216193979889198e-01   +3.986181545259454e-01   +1.352847836128211e-01; +6.914370967276819e-01   +8.440853002549707e-01   +2.960619790170665e-01   -1.766988439392011e-01   -2.951929828458313e-01   +2.678981303519920e-01   +1.860288250158285e-01   -4.222134333924571e-01   +1.886926381599918e-01   +1.167804126609783e-02   +2.548980747429117e-01   +1.821998730995776e-02   +1.408873520170284e-01   -1.653762287750595e-01   +6.984189681884624e-01   -4.639317040821545e-04; +1.980552573180787e-01   +5.906235946333163e-01   +2.506886481996545e-02   +4.282902876782316e-02   -1.899355482586486e-01   +3.151357979059538e-02   +1.983329709958004e-01   +1.004240860675296e-01   +2.549942175649850e-01   +2.733944043332981e-01   -4.315693784132925e-01   -2.097931160150248e-01   +3.266276479812312e-01   +5.031966253685985e-01   +2.672011024542688e-01   +1.889714180980750e-01; +2.383577855869204e-01   +2.840298583469862e-01   +4.034993677498003e-01   +3.966891822296232e-01   +2.955777461087477e-01   -5.594447468953936e-02   +1.980045288235731e-02   -1.302000873376959e-01   +4.370506099200966e-01   +3.055828386437170e-02   -2.059610680312609e-02   +7.075696099274915e-01   +6.946567674187011e-01   +1.440458966760164e-01   -3.807825162371403e-02   -2.656990260156079e-01; +3.156904647111752e-01   +3.841964910583300e-01   +9.136347522767985e-03   -3.411034339158410e-01   -8.827799326869862e-03   +1.907158431405214e-01   -1.360440729351167e-02   +4.534478493420923e-01   -2.628540378933705e-01   -1.370979039453160e-01   +3.083119923211546e-01   +3.985237184385361e-01   -2.680978587134582e-01   +5.135004042848063e-02   +3.193977824642281e-01   +4.580547217172852e-01; +2.080080365636386e-01   +3.186954256753489e-01   +5.697836380814740e-02   +5.372938222828381e-01   -8.335401558870040e-02   +4.296901161428408e-01   +3.706594643627802e-02   +3.732775351950164e-01   +4.654489533544517e-01   -2.916638949107205e-01   +1.623219432321949e-01   +1.448586858206135e-01   +2.803691960298089e-01   +3.043700051638298e-01   +4.830607970716081e-01   +2.451947637923078e-01; +6.396510942966684e-01   +2.027470679521959e-01   -6.438424145512105e-02   +1.514393392491878e-01   +5.465839073697477e-02   -1.404447709931986e-01   +1.052144841838342e-01   +2.632769253310995e-01   +3.745604916229902e-01   -1.593619165917689e-01   +4.319660783794340e-01   -1.852528831412005e-01   +2.894644994018162e-01   -1.057466048235443e-01   +1.582792358184146e-01   -3.428225515748020e-01; +3.733122359024268e-01   +1.872390416121651e-02   +1.475895445356120e-01   -7.548233534993176e-02   +2.548863749472812e-01   +2.430337902831552e-01   +3.845101124564337e-01   -4.791104702350636e-02   +4.732883011328432e-01   -5.328951299581643e-02   +3.140398775416044e-01   +2.659006321039802e-01   +2.553278778405452e-01   -2.666258831262347e-01   +4.989373661523604e-01   +4.763692440849399e-01; -3.596008998506393e-01   +3.008576341602509e-01   +2.339997187118479e-01   +8.541556555836588e-02   +1.092914687894088e-01   +4.343312113938230e-01   +2.538997875628182e-02   +2.119655151378610e-01   -8.350917230223570e-02   +2.972338154060653e-01   -2.075316195977269e-02   +2.944870964304385e-01   +1.791626064784251e-01   +1.589004696224497e-01   -2.463464518183356e-01   +4.698628990425113e-01];
L2I_L1I_iGABA_netcon = [+1.332790502856627e-02   -3.102656012434457e-01   +2.331085374492256e-01   +5.975561969415909e-01   -8.407537539901591e-02   +6.301698381177669e-03   +2.536891338817386e-01   -2.969226233861422e-01; +4.990506740524724e-01   +7.071216539058958e-01   -2.963875817552824e-01   +1.878976114234415e-01   +2.990807788248831e-01   +5.942160471971226e-01   +3.235683212233697e-01   -2.941107480996310e-01; +5.150272603645933e-01   +2.804227078002865e-01   +1.051381092580340e-01   +2.963785360043304e-01   +4.202711632087702e-01   +2.702961998866966e-01   -9.603386713299072e-02   -7.380598197415694e-02; +5.916823083086875e-01   +1.082950994302371e-01   +3.582970983166102e-01   -2.110893344141944e-02   +5.921817742957881e-01   +3.811993017891325e-01   +6.644585586878867e-01   +2.112534758974121e-01; +1.519548533052198e-01   -4.427994299223468e-03   +4.060742934962206e-01   +3.995300558991586e-01   +3.966303232326993e-01   +2.486804420499303e-01   +3.184603315205140e-01   -4.319616528664966e-02; -1.021145909808730e-01   -1.516449606088567e-01   +2.983015031822662e-01   +4.098019261185795e-01   -2.729657936661133e-01   +2.794149544015102e-01   +1.852182984161747e-01   +5.738121251171300e-01; +7.192346971889052e-01   +2.185635107900692e-02   +2.671379405021688e-01   -2.400107359865938e-01   +4.143316569155893e-01   +5.087457253214793e-01   +5.885549973020513e-01   +3.158013338947058e-02; +7.241256919542842e-02   +4.302301956329123e-01   +2.660961695067615e-01   -1.194607905617346e-02   +4.122346430686608e-01   +2.834296860081038e-01   +3.482926348613061e-02   +2.089783156806129e-01; +2.191413675351153e-01   +9.912292296794933e-01   -5.111515545595704e-01   +2.870426928925017e-01   +5.007104718776603e-02   +2.928551756589494e-01   +1.322219899726238e-01   +2.652768273545825e-01; +1.372566536074262e-01   -2.067085510995317e-01   +1.080640570867256e-01   +3.122878644995057e-01   +4.950873898155901e-01   -1.193034329243708e-01   +4.159484590514694e-02   +2.269786325264620e-01; -4.814931706089236e-02   +5.138819207865853e-02   +4.181651518120041e-01   +6.125064100438408e-02   -1.640154265744662e-01   -1.049195761893458e-01   +7.742790406339507e-02   +2.876950322419083e-01; +1.412350036904965e-01   +4.891652951025924e-01   +7.104581184290666e-01   +4.217119537989784e-01   +7.925780158393483e-02   +2.302033253428256e-01   +2.486282289216145e-01   +2.836788738007723e-01; +3.799360408701379e-01   +6.156760766832059e-01   +4.059827539512222e-01   -2.002422221020029e-01   +2.253234208499536e-01   +3.530657343849433e-01   -2.424812870628736e-01   +3.113439383648537e-01; +2.470316567739532e-01   -2.072588260954164e-01   +2.060573877597028e-01   -8.316380910024805e-02   +6.841269559369082e-01   +6.928160615250185e-02   +4.797303773513374e-01   +2.808012503898287e-02; +3.398623634068944e-01   +1.632216533975810e-01   +3.920369468621555e-01   +2.286803190613088e-01   +9.001224993723642e-02   +1.000000000000000e+00   +2.645314634571947e-01   +4.012842681804816e-01; -1.297749328468583e-01   -2.105628440834891e-01   +3.134742154188315e-01   +8.003152669218018e-02   +4.547972680726786e-01   +2.265185367447348e-01   +1.840382866742601e-01   +2.132421009024446e-01];
L1I_L2I_iGABA_netcon = [+3.402651429126420e-01   +1.012388247931125e-01   -1.505939136618244e-01   +4.472166201713050e-01   -2.120105971647961e-01   +1.207001176480437e-01   +1.058758397073287e-01   +3.208566009041864e-01   -2.524319467192363e-01   +5.956508985036560e-01   -8.321499691006669e-02   +1.600706122230170e-01   +3.396023093796915e-01   +2.467381909887208e-01   +1.680693039942464e-01   +4.433917757579522e-01; +4.889618408334303e-01   +1.878345969191594e-01   -1.791049346800489e-01   -2.204405717597622e-01   -2.531940449448305e-01   +4.670969513504979e-03   +4.610125245132496e-01   +3.312424742393995e-01   +3.670411717429563e-01   +6.831553578020482e-01   +9.400537738900787e-02   -3.131563572002959e-01   -5.958352627136794e-02   -5.088807031370711e-01   +2.665955064870162e-01   +4.894284908644492e-01; +9.209947411864966e-02   -1.311565260041464e-01   +5.402048369937115e-01   -1.029379538994116e-01   +1.976433288648300e-01   -1.391548891783326e-01   +5.889688547352596e-01   +5.434296035573682e-01   -3.041851806382924e-01   +2.063515306776660e-01   -1.802019735600389e-01   +3.061897384718873e-01   +6.363686377722897e-01   +5.436383054564634e-01   +8.062136876694710e-01   -2.553278598804588e-01; +4.089816617542474e-01   +4.239202224857214e-01   +3.982222738996452e-01   +8.679991499736112e-02   +5.442143902271802e-01   +4.369226689658502e-01   +8.504587920918882e-01   +4.679538011494568e-01   -3.483352309463323e-01   +6.472810697855234e-01   +6.876208975088782e-01   +2.856554058075263e-01   +3.043816298591729e-01   +8.362441119047820e-02   +2.212960404641733e-01   -3.525918302038474e-02; -7.740196991630706e-02   +1.265786538454757e-01   -1.286991396637778e-01   +2.588360485326780e-01   -1.029394490176144e-01   +7.858457126733692e-01   +7.854449565232816e-01   +2.401046419140107e-01   +6.206876579853126e-01   +5.530806816620576e-01   -3.554419650890774e-01   +2.183484689991687e-01   -5.466471673901975e-01   +4.325647461904486e-01   +1.614830734603863e-01   +6.328216489887365e-01; +1.397328278310976e-02   +3.010591176499151e-01   +3.736689576867938e-02   +5.499838104929737e-01   -1.976495628304451e-01   +3.009082923255343e-01   +4.538762262994189e-01   -5.109333374296425e-02   +1.778553824525263e-02   -1.537243027484267e-01   +2.199191557607439e-01   -1.280088132416031e-01   +5.045489513215219e-01   +1.000000000000000e+00   +4.426525642865196e-01   +6.379569187298093e-01; +4.914704448270491e-01   +4.614101834676482e-01   -1.221323494386148e-01   +7.176443624020416e-02   +4.219688770830538e-01   -2.555192588750220e-01   +5.416722024688352e-01   -7.899834118368086e-02   -1.135382425253229e-01   +3.232672677676932e-01   +5.582875998414906e-01   +3.317409613402261e-01   +9.046340307893644e-02   -9.785518212968436e-02   +1.166568060573548e-01   +4.026769110106285e-01; +3.476426051004709e-01   +2.494724694271075e-01   +1.805792227736928e-01   +2.321817898512027e-01   +7.918682882597886e-02   +4.437838113506644e-01   +3.175841097269438e-01   +2.129123593847902e-02   -1.412270481338787e-01   +3.018660926596092e-01   +6.940439866161759e-01   +5.048451002428714e-01   +4.076985134186719e-01   -1.045108219030922e-01   +3.641398898852652e-01   +3.195850815583465e-01];
L2E_L1E_iAMPA_netcon = [+4.695233748445708e-01   +1.048698369122324e-01   +8.174972059221167e-02   +3.803494461226740e-01   +1.000000000000000e+00   +5.181390629180951e-01   +4.691638089309433e-01   +3.521427006161128e-02; -3.109767467289172e-01   +2.882627573598411e-01   -2.090881535860998e-01   +1.077343396426168e-01   +5.165549528404685e-01   +2.074856050379547e-02   +4.018722154700100e-01   +3.136085000234622e-01; +6.988264672877940e-02   +4.718188840700343e-01   +5.122625607845966e-01   +2.944372355800980e-01   +1.475028328511810e-01   -1.189776519781665e-02   +2.452409290018875e-01   +3.453524713038985e-01; +3.446173302906250e-01   +1.234706035540596e-01   -4.029490182347326e-02   +4.468738789478840e-01   +3.866144623162726e-01   +1.779264738963536e-01   +1.984156479904175e-01   -1.831855538169453e-01; -7.490614128441304e-02   +2.524305361662231e-01   +5.610010573953808e-01   -2.623254042671479e-01   +1.117036093994203e-01   +4.229526099797913e-02   +2.688671993607889e-01   +5.805802029762602e-01; +3.678062581368747e-01   -3.103848429447040e-01   +2.237117681523772e-01   -3.641139341276207e-02   +5.472875945777045e-01   +8.269929594186421e-01   +4.868979286218771e-01   +2.920746384800168e-01; +1.362752198807900e-01   +4.713491044394032e-01   +3.419573175628026e-01   -1.288914464863134e-02   -2.197650075213011e-01   +3.311575173628315e-01   +9.539157170042132e-01   -1.291980858139104e-01; +2.910487038539363e-01   +3.922023398712453e-01   +7.653735907015523e-01   -1.330412203712534e-01   +2.705697377728994e-01   +2.125146649650676e-02   +2.729193517406150e-01   +2.647203603777143e-01; +4.931966630433455e-01   +4.416544089553144e-02   +4.150544269370524e-01   +7.487153627718448e-01   -1.545701445216539e-01   +5.412426398552520e-01   +3.449265460046733e-01   -1.137161078996288e-01; +2.601767231162220e-01   +1.464416392454266e-01   +2.298748445590555e-01   +3.421569874158581e-01   +2.927472158548458e-01   -8.903277867369172e-02   -3.316815194939057e-02   +3.677508627521562e-01; -3.844914302755595e-01   +5.486105197543260e-01   +4.647524516899150e-01   -1.829929712556848e-01   +1.972615951276075e-01   +1.886257722066929e-02   +1.850128898640356e-01   +2.831633729961640e-01; +3.559840505607061e-01   +3.135032526293630e-01   +6.029768185926050e-01   +3.127632689909966e-01   +1.652512724053729e-01   +4.663195680390644e-01   -2.236519587550010e-01   +1.535415866432912e-01; -3.045451507088308e-01   +1.719630278941875e-01   +3.208549740073507e-01   -2.942065021141872e-02   +4.442138921286382e-01   +1.755716324196261e-01   +2.516236911579955e-01   +1.014993800151564e-01; +3.163510556108157e-01   +6.020406501370632e-01   -4.902830816369422e-01   +1.155148102028419e-01   +3.646837016284909e-01   +2.889046138474214e-01   -2.066047421190521e-01   +2.998462181209098e-01; +2.885162167014045e-02   +9.846689869181856e-02   +3.811481921731694e-02   +4.787992145034613e-01   -1.029369151151123e-01   -9.366155390471395e-02   +2.600543556550624e-02   +1.351991237496265e-01; +1.274271472661602e-01   -8.409794876425557e-02   +1.284603966254348e-01   -1.630067117369055e-01   +2.472645839338034e-01   +1.540099457907911e-01   +4.577563260244611e-01   +5.420790297043702e-01];
L1E_L2E_iAMPA_netcon = [+3.220620177055057e-01   +2.020232738064856e-01   +1.217656744929944e-01   +2.027242842127297e-02   +3.893581973287896e-01   +2.807105940032600e-01   +1.354888840895603e-01   +1.911098234598723e-01   +5.817319432375716e-02   +1.200129270671831e-03   +4.791394070454553e-01   +1.075008092486629e-01   +2.287713875806882e-01   -4.883496867755052e-02   -3.712920974159430e-01   -1.306321521272266e-02; +2.759936530979440e-01   -4.133565836381773e-01   +8.589180825796426e-01   +5.210974282263005e-01   +1.229172657622749e-01   +1.429145893765191e-01   +6.550104694089571e-01   +3.616949037043632e-01   -1.361924966713659e-01   +1.424384474378984e-01   +3.386151438820858e-01   +3.368327028545872e-01   +5.051211905296096e-01   +3.467585448720754e-01   +4.568419893869846e-01   -1.084836455428930e-01; +5.735494624810452e-01   +2.780983064669653e-01   +1.002936604147572e-01   +1.950798932327674e-01   +1.443698669777787e-01   +3.848569941438727e-01   +2.160638690339839e-01   +3.510015277819508e-01   +1.008564969851630e-01   -2.045510513980052e-01   +3.811878777123748e-01   +7.347670785269125e-01   +1.056128644734515e-01   +4.597451547281233e-01   -1.214999168054862e-01   -6.244143793274794e-02; +1.799167349343658e-01   -2.542323074730856e-02   +2.030639662795321e-01   +8.013632418315049e-02   +1.077891793933856e-01   +5.768201295510921e-01   +1.000000000000000e+00   +3.882432683210151e-02   +1.792252932481128e-02   +1.729784165515439e-01   +3.152006554278100e-01   -9.959675575664774e-02   -1.792176927229523e-01   +8.049758095787934e-01   +2.758624668414871e-01   +1.024319955029526e-01; -6.012905220016431e-02   -4.162777848183888e-01   +4.225602216810044e-01   +7.092493866320920e-02   +3.598712349109190e-01   -8.119370487588430e-03   +4.163384899382800e-01   +1.295812539982696e-01   +3.394209016044366e-01   -3.638966684656637e-02   -7.687274412655649e-02   -3.476416634086134e-01   +3.524107456756652e-01   +8.240791041116644e-02   +8.041727382734618e-01   +1.315305814337293e-02; -1.442046811531269e-02   +4.881132168953169e-01   +7.051422415743229e-02   +6.472456866137060e-01   +4.976755449411590e-01   +2.034155790810568e-01   +5.019403831313223e-01   +2.193638506566306e-01   +4.156893838735027e-01   -2.138926174067856e-02   +5.729860991778859e-01   +5.574617831684386e-02   -2.212756855111322e-01   -7.953712722472343e-02   -4.028759151581540e-01   +2.426953691305307e-01; +1.773031572745582e-01   +1.051891553209969e-01   -2.826779537352832e-02   +3.539796282236164e-01   +3.830538739773527e-01   +4.333954598857734e-01   +4.601149843760749e-01   -9.063751601462440e-02   -1.654947362382648e-01   +1.631216094718466e-01   -2.039538822032172e-01   -1.703192449111606e-01   -2.952379219740881e-01   +1.562863040599594e-01   +5.318999737303781e-01   +8.282666277432550e-02; +2.636615527552040e-01   +3.989220948551507e-01   +1.858747463229751e-01   +4.464064021030010e-01   +4.333054075234038e-01   +7.091618908126334e-01   +5.537716474196519e-01   +1.737036766568774e-01   +2.566780352737718e-01   +2.558495791095348e-01   +1.358470352822832e-01   +2.034786658550972e-01   -3.873198503472624e-01   -1.160664861855195e-01   +3.893745152523508e-01   -6.846607323600473e-02];
L2I_L2E_iAMPA_netcon = [+1.401491591782534e-01   +6.659668891645637e-01   +4.185385125513011e-01   +1.866000094154833e-01   -8.330260369805299e-02   +4.747211628932916e-01   +1.063477252496523e-01   +6.795015860643020e-01; +6.954208941743985e-01   -2.447543125124179e-02   +1.000000000000000e+00   +6.908114116998676e-01   +4.948648897525447e-01   -2.070058656400683e-01   +1.256232584606537e-02   -3.001671754441380e-01; +1.029912775976773e-01   +3.216998928791776e-01   +9.467918610187569e-02   -1.532103965851460e-01   -1.033659323881160e-01   +1.385928378379013e-01   +4.617892547685513e-01   +2.720454188241286e-01; +2.580912321061317e-01   -2.898451416012160e-02   -3.871669986094116e-01   +5.973785990901531e-01   +3.441273231969755e-01   -4.186698881913483e-01   +3.229774080939264e-01   +1.702302839385982e-01; +2.412810717085928e-01   +1.565912981467101e-01   +1.037976359865188e-01   +5.128050942729052e-01   +3.049680184665715e-01   -2.418213129475976e-02   +4.271909535791183e-01   -1.817340660880205e-01; +3.023336276008921e-01   +4.197237166012884e-01   +6.545825778646465e-02   +4.130202111749423e-01   -8.431179096415334e-02   +2.334765082751930e-01   +2.723505773271405e-01   +2.104783734537089e-01; +4.118530174267763e-01   +4.689408005428080e-02   +5.684882870553056e-01   +6.224661817127698e-01   +2.966249726892521e-01   -2.061905390478394e-01   +7.805253851467977e-01   +9.341268738199593e-02; +1.405201492558513e-01   +8.097336853628424e-02   -3.238614337791815e-01   -9.006153803871611e-02   +9.919835318177640e-02   -8.936398054117993e-02   +1.315413331082790e-02   +5.676105668958104e-01];
L2E_L2I_iGABA_netcon = [+2.470801295241129e-02   +1.444930583486464e-01   +5.573859096289374e-01   -1.985610741371501e-01   -2.952452044919928e-01   -6.984747792345312e-02   -1.808404305877048e-01   +4.807787060460910e-01; +1.811478349910439e-01   +1.686587743925919e-01   +2.444478496023512e-01   +6.796819762218702e-01   +6.123640974050827e-01   +3.234018042900141e-01   -4.534055067229147e-01   +2.696467695574340e-01; +1.127359908807245e-01   +6.473326428895680e-01   -1.976816174187482e-01   -3.184104258341819e-01   +2.732564076218067e-01   +5.778761533645118e-01   +2.580062099012930e-01   +4.872729708441839e-01; -1.008704194042074e-01   +5.707973768673014e-01   -1.916520573392786e-01   +7.133576852503833e-01   +5.833394412140179e-01   -4.488572254778657e-01   -3.229826933595760e-01   +9.126377369111363e-02; -3.762005932543590e-02   -4.148900535619535e-01   -1.640275087831068e-01   +1.848048107689353e-01   +7.618031102603871e-01   +2.254588728619954e-01   -6.038043478629098e-04   +1.478387014647806e-02; +6.596402514084830e-01   +2.952311649259374e-01   +2.187933483123664e-01   +4.927247719655520e-01   +3.643576369601416e-01   -3.246595010510420e-01   +4.862546062620592e-01   -3.931895298728795e-01; +3.650702965741591e-01   +2.884317787716632e-01   -2.687263732172701e-01   +1.244221034597047e-02   -1.247895990930316e-01   -3.071183645949502e-01   +1.942386663908172e-01   +8.187288310113090e-01; -8.081040423480244e-02   +5.187425016362118e-01   +4.368590612220488e-01   -2.155218729115594e-01   +2.655397745627449e-01   +4.327620584593520e-01   +3.695793954324320e-01   +5.549590675937042e-01];
L3E_L2E_iAMPA_netcon = [+3.279770441624266e-01   -5.064497702112729e-01   +2.576824737068036e-01   -1.872297955794667e-02   +4.911108140522373e-01   +1.996901303213391e-01   +2.261277503802420e-01   +4.725107889130313e-01   +2.981743015402571e-01   -2.848795059723789e-01   +1.046928132041489e-01   -1.241499902338093e-01; +2.711341501092320e-01   +6.661867054003091e-01   +1.829926058158770e-01   +2.753526544447414e-01   -1.355818568521524e-01   -4.168886472049856e-01   +1.259959330771888e-01   +4.431405851669992e-02   -2.305860428743826e-01   +2.614402252011778e-01   -4.295837151575561e-03   +4.855950473406522e-01; -3.853342270772052e-01   -1.227114770454109e-01   +2.595810571720470e-01   +2.680897974772707e-01   +7.747761993740238e-01   +2.087103921676240e-01   +3.325977076755353e-01   +2.421335027514814e-01   +8.343309270713303e-01   -3.621043215018120e-01   +7.344871511963185e-01   +5.043389953825819e-01; +2.871587442413364e-01   +2.595693186187527e-01   +4.364601884536032e-01   +3.033299613875927e-01   +4.910817268513458e-01   +2.175946763679976e-01   +1.567820978242689e-02   +3.986488205577099e-01   +1.230201243479271e-01   +7.875948347825296e-02   -1.087076834560098e-01   +6.542636080204808e-01; +1.087958403290062e-01   +2.126361829559479e-01   +3.714040585286945e-01   +6.004807705390802e-01   +5.074594295557502e-01   +2.110075749287302e-01   +3.386431112786036e-02   -1.010597343419523e-01   +1.708413618038404e-01   +4.403172673842503e-01   +4.724653891120703e-01   +4.406241063516539e-01; +3.804072636227597e-01   +1.769372162526101e-01   +1.349830991287675e-01   -3.139667112374476e-01   +2.800842807529454e-01   +4.492314205872024e-01   +1.813661846690859e-01   -2.024812487676745e-01   +1.767856031413791e-01   +4.009359503536775e-01   -1.071779045204323e-01   +1.978327253651333e-01; +5.549052376252692e-02   +2.793965192207780e-01   +7.456344273269159e-01   +8.781434323884328e-02   +3.611000126063958e-01   +3.245681870258766e-01   -2.184842810206373e-01   +1.257703004145801e-01   +1.298740485473957e-01   +3.589404705402917e-01   +9.711361324036927e-02   +2.889009465845558e-01; -3.475328215947772e-01   +1.000000000000000e+00   +3.830567462737960e-01   -5.149524882163640e-01   +4.316981320368566e-01   +7.770564124598119e-02   -5.516893514423443e-02   +1.888035976886034e-01   +2.990886068791764e-01   +3.684637648144622e-01   +1.160221667271725e-01   -1.010927067711619e-01];
L3I_L2I_iGABA_netcon = [+6.849901369853021e-01   +4.490740158954802e-01   +1.624523732608194e-01   +1.708853762405007e-01   -4.299374739731942e-01   -5.924039563042063e-03   +1.000000000000000e+00   +6.472787770433837e-01   +7.285457814309523e-01   +1.610868862603468e-01   +2.502296231514239e-01   +3.086542546520804e-01; +1.751154828849562e-01   +1.670941355908029e-01   +2.164092284819384e-01   -6.077915422211958e-02   +3.045276030977008e-01   +1.739202278483354e-01   +5.426636243983105e-01   +4.791535035848137e-03   +1.537569714561305e-01   -2.131444940306083e-01   +4.443223984160229e-01   -1.100003185661239e-01; -9.690314898628453e-02   +5.726519955561792e-01   +2.924348662233077e-01   -1.305439003176922e-01   -6.543391193476968e-02   +2.262998391376062e-01   +2.614903262066032e-01   +2.339948030796900e-01   +3.047788955985165e-01   -1.251377208397981e-01   -1.764015451546682e-01   +7.815228174880288e-01; +4.581383835547091e-01   +5.044670095983235e-01   +4.455801810913556e-01   -1.292777580975746e-01   +2.007254148642073e-01   +1.566771958153030e-02   +3.425057405058055e-01   -2.417922882219558e-01   +5.380736943774795e-01   +4.441430856235172e-01   +5.769876804594636e-01   -1.361430663736760e-02; +2.147066000399914e-01   +3.626307551998416e-01   -7.381060851496614e-02   +3.458543862348240e-02   +5.718127952427665e-01   +5.014041823233413e-01   -1.515456244676769e-01   +8.293009694050288e-01   +6.122796720353352e-01   -8.574864394365993e-02   +3.026253828391726e-01   +8.880785540106860e-02; -1.275290633566884e-01   +5.334243419411890e-01   +3.575953691995035e-01   +7.760946746820796e-02   +4.823626451846979e-01   +3.690948883475603e-01   +2.291953751491984e-01   -2.882580120306075e-01   +3.555904992091162e-01   +4.033484395697076e-01   -2.708677377048655e-02   +1.882439948348644e-01; +4.379026337651319e-01   +2.954460213709406e-02   +3.852356978240710e-01   +1.038259412745911e-02   +4.335545147156616e-01   +5.215827472089037e-01   +4.423720487239522e-01   +1.782698537582772e-02   -5.783615684723884e-01   +7.839540881425184e-01   +3.333117931617812e-01   -1.853661649846267e-01; -4.817221660695090e-02   +3.088361477643624e-01   +2.311829788456405e-01   +3.911284742536965e-01   -5.015897852090248e-02   +4.671469930064644e-01   +6.187758058253277e-01   +6.864611884266194e-01   +4.018899337651324e-01   +4.407229001326458e-01   +3.936106444011122e-01   +3.745550312233999e-01];
L2E_L3E_iAMPA_netcon = [+6.697096508599784e-01   +2.728125454011606e-01   +4.524394541759450e-01   -4.991775832109105e-01   +1.257427150807123e-01   +2.445001023148426e-01   +4.296753269153219e-01   +5.055149616294354e-01; -6.462297576341086e-02   +2.508330287761294e-01   -1.079725273837243e-02   +3.733281515103882e-01   +5.230946266194400e-01   -2.166292618730663e-01   -1.427444820946649e-01   -3.034777917353162e-01; +2.019595556288649e-01   -2.337473580887914e-01   +2.059273149825629e-01   +5.440215554886677e-01   +3.114396184698227e-01   +2.163065710049636e-01   +1.223250422035009e-01   +3.079196867047627e-01; +2.173338081407112e-01   +3.670101795983390e-01   +8.668113957576374e-01   +7.527523735941897e-01   +7.455721908195656e-02   +7.500483562172939e-01   +4.830373664037373e-02   -1.706908293111282e-01; +2.664606085916005e-01   +1.089516585313593e-01   +1.239942988502525e-01   +4.931120685137096e-01   +3.263352120731923e-01   +1.622967769285437e-01   -2.857712282660158e-03   -5.456803351017180e-02; +1.233632524870064e-01   +7.263373674878342e-01   +5.537594005297489e-01   +6.959207161455355e-01   +3.571946247921594e-01   +2.102055100225867e-01   +1.872184315089716e-01   +1.796996095061137e-01; +6.943240415767012e-02   +5.796725309676247e-01   +7.623024175636514e-01   -9.659496364261339e-02   +5.628015940572038e-02   +6.417024607695850e-02   -1.262512321228913e-01   +3.994423906573301e-01; +3.399167665775972e-01   +3.531721908117360e-01   +1.605208701155300e-01   +1.821330125659205e-01   +1.376194028139106e-01   +2.638133194842440e-01   +1.611182311596848e-01   +7.688608188943766e-01; +3.239783278317466e-01   +7.490037070120923e-01   +4.321630274364460e-01   +3.029121577246943e-01   +8.958305015867166e-02   +6.800960244527310e-02   +6.054090020361187e-01   -1.891410698080183e-01; +1.809031968589966e-02   +2.501541274165692e-01   +3.472637624606126e-01   -3.944375246182468e-02   -9.406271340810245e-02   -2.266716870741777e-01   +2.666490534792701e-01   -9.658410120218139e-02; +5.744147941432520e-01   +8.994517080779155e-03   -2.299200131706994e-01   +8.404744203790693e-01   +1.618513120601355e-01   +4.723034736118275e-01   +2.661827167861793e-02   +3.499207990845681e-01; +1.079486215960298e-01   +6.819311337855629e-01   +4.624179202019725e-01   +4.785700580997537e-01   +1.231140091783143e-01   -8.293237588340119e-02   +1.448766688021424e-01   +2.686707535788998e-01];
L2I_L3I_iGABA_netcon = [-1.294461965929238e-01   -1.606500511224851e-02   +1.365869159129697e-02   +3.171918190456641e-01   +3.566003974403630e-02   +7.965010924798751e-01   +4.676652929158958e-01   -2.032498767052668e-01; +6.814369075328218e-02   +3.109006306622122e-01   -3.310294521860352e-01   -3.608675694688483e-02   +1.868464603633981e-01   -1.365297401501391e-01   +5.220616836670510e-01   +3.378151559923969e-01; +7.874716244360983e-01   +1.000000000000000e+00   +1.763152707815356e-01   +5.684253805032435e-01   -5.072079430212303e-02   +7.456015869374366e-01   +3.241090818524343e-01   +2.710787674324582e-02; -1.313437111770621e-01   +2.209300692204680e-01   +6.384934559712558e-01   -4.285198806932286e-01   -4.705639627703382e-03   +6.818561219857485e-01   +1.849396265727865e-01   +2.825642955534025e-01; +5.002313167312528e-01   +1.739336274503297e-01   +2.286913274994961e-01   +2.790957367235673e-01   -2.861038349136356e-01   +2.667970230212391e-01   +1.141066429653473e-01   +2.558897878041225e-02; -9.322615913930643e-02   +2.622589647084295e-01   +8.090145548427519e-01   -2.240255400889891e-01   +4.375544977608549e-01   +9.024957656557495e-01   -3.443938916532557e-01   +1.756034992094606e-01; +4.027786579168262e-01   +3.290945641945635e-01   +9.830983547381926e-02   +3.394219296111482e-01   +2.051007383961678e-01   +4.939926570150457e-01   +8.556045403250230e-01   +4.806972930836889e-01; -2.729698241984304e-01   +4.665328818809803e-01   +3.185384283651512e-01   +2.664864285780943e-02   +8.085935350410012e-02   +2.204749000344361e-01   -5.726638704138590e-02   +7.323218471027767e-01; -9.707671308811392e-01   +9.168010653624927e-01   +6.665665191114643e-01   +6.355304835140339e-02   +3.642295116169466e-01   +2.120213386338910e-01   +5.534941238961193e-01   +2.427461734866232e-01; +2.098155771254610e-01   -3.243711023475852e-01   +2.799984755580350e-01   +2.469956204694818e-02   +3.412382158872339e-01   +6.398706482730266e-01   +3.373508858841106e-01   +3.795588729228446e-01; +7.667768922262180e-01   +3.802679059261725e-01   -4.854580912685956e-01   +2.895694940399341e-01   +3.800569694580768e-01   +4.123069541965350e-02   +6.530384803642285e-01   +6.904411195575708e-01; -6.575176696146499e-01   +8.068226229215539e-01   -1.128022398617569e-01   +8.509186721559774e-01   +6.566709326915315e-01   +3.091922252450711e-01   -6.445197163445589e-02   -1.642152394493271e-01];
L3I_L3E_iAMPA_netcon = [+1.990542739940096e-01   -3.486691664624969e-02   +2.197169808100829e-01   +2.731081186022153e-01   -1.321463682316033e-01   -6.920143894709452e-02   +1.690916396545301e-01   +2.178552301873449e-01   -7.022653940140097e-02   +5.359147729453331e-01   -7.623567913100303e-02   +2.063990328409528e-01; +6.650113970660451e-02   -9.505928887361495e-02   +3.302651461158700e-02   +6.336634768400010e-01   +3.004271194395878e-01   -1.787546094076439e-01   +4.864722270750645e-01   +4.263017541473252e-01   +3.590913029402697e-01   +3.840476062132989e-03   -1.595973743153235e-01   +7.536487425338224e-03; +8.485517581171220e-02   +4.058547645407165e-01   +5.001170093021574e-01   +1.576763373258237e-01   +6.857112998435108e-01   +3.222166256451889e-01   +5.761814028074506e-01   +2.713269730209789e-02   +4.347908333608300e-01   +3.696731503225963e-01   +1.148185316009990e-01   +4.390428424711230e-01; +5.098945947251174e-01   +3.039834902862837e-01   +5.546765877136935e-01   -1.048070252178114e-01   -8.816525165724949e-02   +7.227000734496930e-01   +9.045828479997021e-02   +2.970458704632219e-01   +2.720777006657776e-01   +2.392038961274282e-01   -1.939879467786729e-02   +1.156441337641387e-02; +4.666858115667902e-02   -1.076638915741203e-01   +8.419776770127568e-01   +2.985671945505439e-01   +2.127679802230464e-01   +3.158897981587973e-01   -7.427912907267206e-02   +3.251100797408669e-01   +2.333474746029759e-01   +4.177451084675601e-01   +4.004387584749471e-01   +1.241882123585678e-01; +8.950915266428457e-02   -1.790785748630679e-01   +9.037099906651036e-02   +1.300501565234540e-01   -2.372964042405964e-01   -6.405064291100306e-02   +2.525235621931378e-01   +2.085155140434634e-01   +2.620961798983245e-01   +4.664486790988945e-02   +1.100517175935771e-01   +6.186412663880235e-01; -3.239461434843447e-02   +1.248664045704845e-01   -2.784592825275167e-01   -3.506387338924601e-02   +8.712668002275967e-02   -5.465389629202308e-02   +4.800913237902436e-01   +2.313438639120403e-01   +1.444809290641835e-01   +1.503475944367714e-01   +4.294511638939995e-01   +1.571460242485176e-01; -3.885728961594413e-02   +2.709350092803451e-01   +1.463663696977015e-01   +1.924213783215095e-01   +7.120349612054529e-02   -1.112434026340569e-01   +2.217427226805936e-02   +1.239612454076163e-01   +4.669584889366957e-02   -3.642710844839728e-01   +1.117081894863246e-01   +1.148125043015892e-01; -1.550494725239690e-01   +5.739436940861689e-01   +1.990873025062789e-02   +1.138048266368754e-01   +8.461689248806292e-02   +6.439817955810883e-01   +1.954309184568786e-01   +4.921286940544909e-01   -6.388996097744593e-02   +1.361820234377555e-01   +6.311076061734215e-01   +7.985158349656781e-01; +6.513423897603960e-01   -5.362348964681098e-01   +7.127199560505777e-01   +1.052649403435440e-01   +1.868779985504978e-01   -4.517527060564818e-01   +3.904347779941567e-01   +2.786546762645458e-01   +6.979512646298613e-02   -2.003747557424825e-01   +9.221164570719507e-01   -1.549888168052854e-02; -5.320178686596763e-01   +3.864299158434452e-01   +7.347038563536682e-01   +4.106437934774244e-01   -1.060317934174068e-01   +8.891531645215342e-02   +2.965375571492473e-01   +8.922833867098197e-02   +5.772058988566472e-01   -1.708629521533102e-01   -4.378664399242062e-02   +3.326484217622206e-01; -2.372134698887159e-01   +2.952324512165418e-01   +2.765515737012718e-01   +3.866805512757797e-01   -1.954506749272349e-01   -1.037302593461470e-01   -2.239274901904510e-01   +1.413401904660308e-01   +5.727196247675989e-01   +3.065996808597838e-02   +2.102831965604229e-01   +7.538642654715778e-02];
L3E_L3I_iGABA_netcon = [+2.110666442200564e-01   +1.178667272568684e-01   -6.589241425217482e-02   +1.681446609719378e-01   +2.874534748082825e-01   -9.926481595078125e-02   -2.004074366162054e-01   +3.538250699630623e-01   -3.090126569645498e-02   +5.071005983028321e-01   +2.886570469949264e-01   -7.246108179573221e-02; +2.318877134686808e-01   +4.163362051062142e-01   +3.415263640633693e-01   +1.315093650510565e-01   +4.976253659072867e-01   +7.872589167925698e-02   +8.512456669828274e-02   +1.290212347042313e-01   -5.327820674097321e-01   +8.294971242534488e-02   -4.250152717002897e-01   +1.056124958662089e-01; +1.627544746910270e-01   +2.045936777245426e-03   -1.996253803157773e-01   +1.065025494925982e-01   +2.622088892584264e-01   -4.386369088410079e-02   +1.879227120972263e-01   +2.846404690580555e-01   -4.051223853474664e-02   +1.225414766866129e-01   -8.184964819317524e-02   -5.543758400524453e-02; +2.846315198487463e-02   +2.016852084896464e-01   -4.528412805901684e-01   +5.486157839931558e-01   +8.854095590610698e-01   +1.501438390886271e-01   +3.099809905159852e-02   +1.603277008900655e-01   +6.113955800155015e-01   +2.583231277030514e-01   -1.040213010662480e-01   -1.271980257138705e-02; +3.306279126605488e-01   +1.082363361083653e-01   -6.103649596557220e-02   +4.494500817864276e-01   +6.508938263402478e-02   +1.043892756662347e-01   -1.210530954243555e-01   +5.955132309656970e-01   -9.432713652961053e-02   +4.745951523483237e-01   +1.723825450317043e-01   +1.874241040261149e-01; +3.101488263286317e-01   -4.510883598860745e-02   -4.497308351964785e-02   -1.748039399624083e-01   -8.064087874070394e-02   +2.266852898935018e-01   +1.160631651427568e-01   +3.956218371914334e-03   +5.789971678752398e-01   +2.994296913901646e-01   -6.218248999598332e-02   -2.804223701278817e-02; -1.226576894180515e-01   +9.029489198592748e-02   +3.503495461850465e-01   +9.147137315617820e-01   +1.009244501403775e-01   +2.983502363276336e-01   +5.076066629940992e-01   +1.086641113875439e-01   -1.168886555044331e-01   +2.101082603186958e-01   +4.955230106375480e-01   +5.209335372673360e-02; +1.784799185205410e-01   +1.772218639495328e-01   +2.894947413513211e-01   +2.301389309372148e-02   +1.454531187484245e-01   -2.605496994452504e-01   -7.477522637472524e-02   +5.625318054237398e-01   -7.985339250355375e-02   -1.110458509394548e-02   -1.993730128297718e-02   +2.922693792276977e-01; +3.985687630208632e-01   -1.971634453477867e-01   +4.126170651728850e-01   +7.672732881655082e-02   +1.896050719482868e-01   +5.539318467396489e-02   -4.301658494997895e-01   -2.357228558584077e-01   +5.483969811302265e-01   +2.825542191065240e-01   +9.556157777337021e-02   +7.212034879930620e-01; +8.388329376619569e-02   -6.901662673040472e-02   +3.699611858608986e-01   -2.161246335849940e-02   -3.793977441822040e-01   +2.177602915394428e-01   -3.653284026911346e-02   +2.101468256739599e-01   +2.769949326331247e-02   +1.944530032472920e-01   +2.433415372396438e-01   +1.299886649489247e-01; +2.978489353148649e-01   -1.857833940261411e-02   +3.840298130468900e-01   -1.188798966680556e-01   +1.134634444247957e-01   -2.480924317328760e-01   +2.340133950520849e-01   +1.874784463615782e-01   -2.494503915396704e-01   -9.286640481355628e-02   +2.423835066330637e-01   +4.269461862686627e-01; -1.038230064746336e-01   +2.418748623498475e-01   -1.008779050340131e-01   +9.315888673724881e-02   +7.204668371675419e-01   +4.086261070631310e-01   +3.005217077956228e-01   +3.732352515964545e-01   +1.429822808785443e-01   -2.175691990329351e-01   +3.954057201152006e-01   -2.373718717655992e-01];
L2E_Input1_iAMPA_netcon = [+8.490324898393106e-01   +6.972242761945785e-01   +6.431921178121939e-01   +8.509130876817985e-01   +1.000000000000000e+00   +5.037278001334671e-01   +4.045065884808513e-01   +6.709104697314677e-01];
L2I_Input2_iAMPA_netcon = [+6.043921288460143e-01   +8.812996840785560e-01   +7.695814120338628e-01   +6.019968677722990e-01   +2.425080202367890e-01   +1.000000000000000e+00   +2.496665940276975e-01   +1.633690682385438e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
