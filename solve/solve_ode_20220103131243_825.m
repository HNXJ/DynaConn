function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.572344836942649e-01   +7.691507882746559e-01   +9.001947385296571e-01   +1.921854822440545e-01   +2.350014143091526e-01   +7.083356722053662e-01   -8.011398905898776e-02   +3.997633059569161e-01   +2.483551134441580e-01   +2.335806633667807e-01   +3.997815159346183e-01   +1.585158565638039e-01   +4.881761389901077e-01   +2.793002166672541e-01   +2.584175555635568e-01   +3.524960223478127e-02; +7.282475265730368e-02   +9.341249473009863e-01   +8.350468222969901e-01   +7.693657904300879e-01   +3.299030609293023e-01   +7.328080664153906e-01   +7.048717479591928e-01   +1.408255231544375e-01   +1.480022687775014e-01   +7.647937660329580e-01   +5.632863371739951e-01   +6.208416541042437e-01   +4.538201345798547e-01   +2.430903063404909e-01   +6.750407974447309e-01   +2.284061167829577e-01; +2.423825830392616e-01   +3.303640839314496e-01   +3.817358264954004e-01   +5.475844712299627e-01   +5.960916136445024e-01   +4.183607292491224e-01   -2.054715509908257e-02   +6.692023646694540e-01   +3.057683968507581e-01   +5.205507931307098e-01   +8.002198218137280e-01   +2.442723071269413e-01   +4.361221651208613e-01   -4.688200999899725e-04   +3.437032734872348e-01   +9.548748515316693e-01; +1.932276140948399e-01   +6.369770012968389e-01   +1.008547435966064e-01   +2.693138438035940e-01   +8.583025971023802e-01   +7.828359309870560e-01   +1.721243542023739e-01   +5.822173026248784e-01   +7.494709229675298e-01   +4.439362846573270e-02   +2.079519811157167e-01   +8.527861924665719e-01   +5.263063690372191e-01   +1.865186636710327e-01   +5.880589955735389e-01   +4.842171567751420e-01; +9.717505984056037e-02   +7.339265284021218e-01   +8.087218395035518e-01   +7.739623298448657e-01   +5.021708176151944e-01   +3.295974054784132e-01   +4.707629467855610e-01   +2.847522599089433e-01   +2.964307027589886e-01   +4.730792459345959e-01   +1.954285898638340e-01   +6.622821731363664e-01   +3.793685469169489e-01   +7.889939557939184e-01   +2.061590582701941e-01   +8.867963090966963e-01; +1.029164394343441e-01   +2.006016506161918e-01   +6.993464191947463e-01   +7.468489495258545e-01   +5.575602311695782e-01   +8.631299046953295e-01   +3.164106534515981e-01   +4.180168303390718e-01   +8.600819347815400e-01   +8.847552722179813e-01   +8.468989089420035e-01   +2.178141504746462e-01   +4.001311226593414e-01   +1.508014766544469e-01   +8.413707411823459e-01   +3.726243393886128e-01; +3.017005882764311e-01   +7.337751538781785e-01   +5.472111886879422e-02   +3.896238087066790e-01   +7.998052005491161e-01   +5.172954622140391e-01   +4.505181647397058e-01   +5.918046244059290e-01   +8.834616427108544e-01   +9.053534615934383e-01   +6.548455534480798e-01   +8.705607145471927e-02   +3.307259421393942e-01   +3.825317228615184e-01   +6.707942536373457e-01   +8.682775758095679e-01; +7.034306723375926e-01   +7.026750499548412e-01   +7.506856436030591e-01   +3.234683858494244e-01   +6.443015551014672e-01   +4.988793822446378e-01   +8.755294309023826e-02   +4.130749431290547e-01   +9.954376624414280e-01   +8.703684476374244e-01   +4.925327959974724e-03   +7.299346683840671e-01   +7.975270686627610e-01   +5.670729194354472e-01   +2.826615216557347e-01   +8.261495500980494e-01; +4.726308876512787e-01   +7.420642260820758e-02   +2.602809624369217e-01   +3.020408959780845e-02   +4.593894210557493e-01   +1.525147531546532e-01   +4.197068036626930e-02   +5.636930312861824e-01   +4.632271546977300e-01   +7.445731250044912e-01   +7.729169543435788e-01   +5.370014210767502e-01   +2.706981456742125e-01   +1.485322892100940e-01   +9.686854425738709e-01   +7.584037579447291e-01; +6.603219414914916e-01   +5.335365699346911e-01   +5.472014122871918e-01   +2.531777531908758e-01   +4.455307422514216e-01   +3.456370732564251e-01   +5.393709738130812e-02   +2.363078236479054e-01   +9.048609295626199e-02   +7.833779831556197e-01   +2.636793026624325e-02   +6.884252127903942e-02   +3.176714622251971e-01   +7.368315374707562e-01   +3.076877254787749e-01   +7.764868991568322e-01; +4.085861674550708e-01   +5.514647585846471e-02   -1.834861718993131e-02   +1.610823990954477e-01   +9.291914565301934e-01   +6.005506134323711e-01   +2.561974434418062e-01   +2.295505748469836e-01   +2.187439716958822e-01   +8.399455123236867e-01   +1.105851254691347e-01   +7.330492548573420e-01   +5.043009435931536e-01   +8.145353873884809e-01   +2.369583339336350e-02   +9.560898416136050e-02; +1.607590272607078e-01   +2.444563391543807e-02   +9.297975180791413e-01   +4.713594401616057e-01   +6.740533622234000e-01   +5.273604451431074e-01   +7.013139594331463e-01   +3.793232032184546e-01   +6.399568581204348e-01   +1.003369530791384e-01   +3.128821313790160e-01   +7.538243214886916e-01   +7.416161142554202e-02   +4.963756867301148e-01   +3.922166334337690e-01   +8.874546928895181e-02; +4.456247405558984e-01   +3.325974858333126e-01   +6.207502103916526e-01   +2.423467531605954e-01   +7.422283299030545e-02   +4.838436145608688e-01   +4.493676377149375e-01   +7.003421947131070e-01   +2.819087295413665e-01   +8.861152383650193e-01   +1.630110233970289e-01   +4.165140191220303e-01   +1.993198020217886e-01   +2.285100327387803e-01   +2.958928198689214e-01   +2.404184115756643e-01; +1.292879475415628e-01   +8.797651241352259e-01   +7.262654313909521e-01   +7.035145236866485e-01   +7.530165545081796e-01   +5.427835553787984e-01   +2.811740819041801e-01   +7.677029089591594e-01   +3.522300961145909e-01   +4.458500684252861e-01   +8.983796296298956e-01   +6.166535045964667e-01   +5.528131387493201e-01   +5.279988706337506e-01   +1.502250273402628e-01   +3.845877521688408e-01; +1.294121377708843e-01   +2.006007668127071e-01   +8.509394796936977e-02   +3.751891480087833e-01   +3.783470754806844e-01   +7.812702076764579e-02   +6.391552269431934e-01   +3.026207117270192e-01   +8.149954804922026e-01   +5.065830622867213e-01   +1.189352807812976e-01   +8.121948527900134e-01   +6.445552632927891e-01   +1.730556743453601e-01   +7.024420466645598e-01   +1.340246215549667e-01; +5.418513699062730e-01   +2.399520246539758e-01   +2.880692919499420e-01   +6.113123883406182e-01   +5.176564317974156e-01   +5.696051238973122e-01   +2.533846201732567e-01   +9.713089183446470e-02   +5.650638663795705e-01   +4.799325171588847e-01   -4.668390345269377e-02   +3.817692900583007e-01   +2.165335354721586e-01   +8.759367003316975e-01   +9.159680668833359e-01   +1.744910143492420e-03];
L1E_L1I_iGABA_netcon = [-5.754498330237874e-02   +2.654773669086484e-01   +9.084685971953484e-01   +2.192924427035264e-01   +4.372112713075982e-01   +1.177180776280466e-01   +2.865977432603031e-01   +4.540142331918947e-02   +2.249465253428463e-01   +3.923713141928139e-02   +4.072616849017487e-01   +9.596296020574163e-01   +1.784887585897930e-01   +8.018327447122183e-01   +8.444668610101659e-02   +4.041176538858973e-01; +7.818478900700018e-01   +7.694434376503421e-01   +5.173431891283281e-01   +8.423446923275697e-01   +6.995152307266284e-01   +8.347872461568407e-01   +6.012914608842901e-01   +8.355819762772957e-01   +9.145009846804938e-01   +9.372127167603105e-01   +1.382472810002427e-01   +1.259906442973215e-01   +5.870398642619061e-01   +9.371599135324428e-01   +9.997320196419444e-01   +2.663808394603593e-01; +3.094014541554269e-01   +8.191201018286396e-01   +9.843284601200854e-02   +1.283428771299441e-01   +1.097967158116842e-01   +2.477474979108048e-01   +5.875018167295931e-01   +6.550705985962704e-03   +1.253656968268617e-02   +1.137631969146477e-01   +4.938443327389797e-01   +4.122746442648100e-01   +7.989454838664560e-01   +8.289541339465991e-01   +8.271383649329261e-01   +7.648583565163675e-01; +3.633896980530841e-01   +5.273042830302850e-01   +5.789348240403579e-01   +7.654039664047639e-01   +6.528557289600303e-01   +5.961964730815356e-01   +5.457292029039965e-01   +8.912232035339647e-01   +7.421192059966458e-02   +3.025187986048003e-01   +5.335776879475569e-01   +2.688593652241847e-01   +8.110720082924296e-01   +3.884286018097708e-01   +9.155593509336926e-01   +5.237656576899364e-01; +7.040489962942359e-01   +5.899864806690528e-01   +8.680356221917560e-01   +4.040826925749210e-01   +9.511970891590692e-01   +5.185699527198453e-01   +3.489726379585998e-01   +4.361565760945034e-01   +3.204066735622768e-01   +4.730746810149453e-02   +2.096672569817498e-02   +5.925702231897815e-01   +9.219741103778666e-01   +8.066722274087416e-01   +1.623721852951058e-02   +1.542616208365159e-01; +2.325699265573775e-01   -1.886843694177389e-02   +3.215182512731530e-01   +2.085503254664759e-01   +2.487867404468693e-02   +5.014868249011859e-01   +8.768594877775570e-01   +3.088334111413326e-01   +5.162112683142764e-01   +4.269827766537441e-01   +8.956790253410557e-01   +1.887331631059181e-01   +2.451246421278718e-01   +2.064332811553351e-01   +7.179826445287647e-01   +3.981457077129980e-01; +7.199207819999294e-01   +5.356923720922701e-01   +3.353034702121870e-01   +8.034227614377085e-01   +2.964152642572207e-01   +8.479308736033265e-01   +6.274392154602302e-01   +5.181739959651341e-01   +8.270004835366765e-01   +6.299229493392045e-01   +8.614390551307651e-01   +2.705675462265344e-01   +8.163581181491696e-01   +6.025476864756980e-01   +9.415995073859366e-01   +7.481573237028889e-01; +9.266401886768924e-01   +1.376035419712828e-01   +5.968522566992869e-01   +4.857944147896822e-01   +6.610818938506081e-01   +1.886692642808042e-01   +3.694470356278797e-01   +5.718310721493247e-01   +1.995256780849850e-01   +8.360226025307218e-01   +7.435389669335544e-01   +8.910693877644471e-01   +2.661692415428001e-01   +7.342926949619417e-01   +4.932587810489705e-01   +6.122707622727620e-01; +5.483790403867227e-01   +9.187616654275692e-01   +4.049545109085405e-01   +9.720616331326307e-01   +2.796849513753685e-01   +6.827638879572541e-01   +5.559453070041487e-01   +9.577807903168779e-01   +8.559661833162430e-01   +9.223567735879487e-02   +1.783298629432481e-01   +2.246072713000051e-01   +8.318826103177565e-01   +4.962103121517877e-02   +8.370574229774139e-02   +4.632538683533965e-01; +2.470442873018113e-01   +3.666784411935388e-01   +5.525574556267702e-01   +2.742676822936236e-01   +8.390631079250647e-01   +4.324349534623486e-01   +2.661643049974926e-01   +8.905095463526568e-01   +9.163560845107773e-01   +8.718710191401563e-01   +7.966319979120297e-01   +9.646767732529334e-01   +5.174022845353596e-01   +3.898129327576998e-01   +3.086089972528860e-01   +7.845797123031036e-01; +1.586414680593136e-01   +2.368488889904957e-01   +7.671089392455649e-01   +8.711268209469254e-01   +1.928877072410553e-01   +6.133383581589329e-01   +7.780789722712753e-02   +4.920296958929968e-01   +4.187340849107848e-01   +6.315769064055391e-01   +3.377990274589620e-01   +9.058603638455015e-01   +9.723568565036245e-02   +4.929074758985022e-01   +4.121368956480546e-01   +4.757051694963497e-01; +1.652402018782172e-01   +9.227269005318871e-01   +7.427649883898256e-01   +4.684739228148607e-01   +4.793195295944869e-01   +3.444184627059431e-02   +2.073050953441308e-01   +3.732864281608566e-01   +1.446553498969168e-01   +5.259851175070538e-01   +2.293246559338193e-01   +4.290147785685168e-01   +3.745394413259008e-01   +9.198540084970982e-01   +1.857777701939597e-02   +4.753847939426625e-01; +9.236371968264341e-01   +1.540411701122980e-01   +4.634043318887586e-01   +5.492327033722393e-01   +6.398719088160522e-01   +6.104829422620994e-01   +2.335691778420121e-01   +5.085488338482144e-01   +4.469372834095143e-01   +3.450743187907949e-01   +9.530931183470636e-01   +9.744063751474373e-01   +8.391975503589368e-01   +5.701638969017492e-01   +2.613182686657141e-01   +7.864631718374155e-01; +4.265646139141226e-01   +8.550629205015434e-01   +2.997793894554334e-01   +4.075981269660583e-01   +7.351017282419932e-01   +1.961349820127263e-01   +3.437551825846942e-01   +5.913640141083090e-01   +3.425837353300836e-01   +4.390576058083014e-01   +2.055443606578601e-01   +1.866133732625233e-01   +2.734896627233779e-01   +2.514681411962152e-01   +5.938193545287528e-01   +9.155611424593753e-01; +6.124289336682666e-01   +6.029904906912660e-01   +6.959150784808428e-01   +7.127440808468822e-01   +7.542866824699385e-01   +7.705057665690736e-02   +8.365455181538045e-01   +2.846908302022406e-01   +8.478628064970927e-01   +4.856796439129654e-01   +7.040420433020107e-01   +5.266011947127465e-01   +2.695123649946549e-01   +4.756858079636757e-01   +8.642858229796913e-01   +4.899465299780242e-01; +3.620120349381321e-01   +5.816258660561365e-01   +6.496803394039815e-01   +2.396374570638681e-01   +4.625544037399791e-01   +3.181637020960414e-01   +5.462711425521559e-01   +2.339209731478362e-01   +8.225907534074249e-01   +3.132272754409307e-01   +2.586911976134093e-01   +1.374649323649088e-01   +7.677930399209838e-02   +4.655058821017324e-01   +9.275965290350183e-01   +9.280812282985464e-01];
L2I_L1I_iGABA_netcon = [+6.437580278243065e-01   +4.493994328462631e-01   +7.476944435413465e-01   +5.555293417192001e-01   +9.330902691683267e-01   +6.529547686876237e-01   +9.073424045730146e-01   +6.278662438529957e-02; +4.972358628507202e-01   +9.622515071066233e-02   +2.198570435657912e-01   +9.230735279672068e-01   +1.801078605828801e-01   +9.845116091285504e-02   +8.437375486213701e-01   +7.063759736132716e-01; +9.958574153907923e-01   +5.190066219207371e-01   +6.366029567095840e-01   +6.469033878684100e-01   +7.848918751982270e-01   +6.977504215142969e-01   +3.149351041469169e-01   +2.139189474206330e-01; +3.368364206703752e-01   +1.564484262295879e-01   +8.945412461003118e-01   +4.172362317110745e-01   +7.601582551653019e-01   +3.270448213102180e-01   +8.936884703931541e-01   +2.083741348133781e-01; +7.106009909463029e-01   +4.592591891767728e-01   +6.511650639919514e-01   +2.544049806315719e-01   +9.193498149499375e-01   +3.616829269283710e-01   +5.379426871678473e-01   +2.281702271661707e-01; +5.658658404657445e-01   +5.843853434971454e-01   +7.562727100967332e-01   +1.807314536422476e-01   +2.053393120130498e-01   +8.235594341761913e-01   +8.916956355461644e-01   +5.760574765443511e-01; +8.758014930637790e-01   +4.736845846675852e-01   +2.098587573700583e-01   +2.706965351109747e-01   +7.388060763407572e-01   +1.637227563928604e-01   +6.321963794705648e-01   +3.315289447566667e-01; +9.606482951486158e-01   +4.227174898195832e-01   +6.200185171002275e-01   +8.885397097781962e-01   +1.015744491504608e-01   +4.007314370298822e-01   +4.546590214983441e-01   +2.330429777784552e-01; +7.056339062175013e-01   +1.703026744871732e-01   +4.506839402453328e-01   +4.412035417483035e-02   +7.534891315274125e-01   +3.986949649280415e-01   +7.443520029214991e-01   +7.294179721339270e-01; +4.585960978480551e-01   +8.447241235434286e-01   +6.635694619811786e-01   +8.160406067230838e-01   +3.861880121530272e-01   +8.409836461548951e-01   +8.541186081268726e-01   +2.489746823126844e-01; +5.231061823553116e-01   +5.819390339566295e-01   +4.710930756788342e-01   +3.999363961423966e-01   +5.693106089663871e-02   +8.731450736016803e-01   +6.418703287268752e-01   +4.253219612365813e-01; +1.108648066796495e-02   +3.922443047582697e-01   +3.694168268040925e-01   +4.326880295914638e-01   +3.376768277108978e-01   +5.155335276662816e-01   +2.828813453921760e-01   +5.254036373976343e-01; +3.897272856442975e-01   +1.852635620716649e-01   +6.409164425937333e-01   +7.338686355026837e-01   +2.149641832650905e-01   +6.683129939300674e-01   +3.611710001306201e-01   +7.183057512825132e-01; +4.858708060899458e-01   +4.461873587012243e-01   +6.821283754617191e-01   +3.617413805598306e-01   +8.077999411899570e-01   +4.205728218381734e-01   +3.686557379905646e-01   +3.147280371144878e-01; +5.612218138631924e-01   +1.745951400511561e-01   +2.492201178849446e-01   +2.527789419403254e-01   +5.794064638416210e-01   +5.724268010734159e-01   +2.897386274105124e-01   +7.041526654586536e-01; +7.585832049263026e-01   +6.465301753315136e-02   +7.015457987627508e-01   +2.929818912046220e-01   +3.627221757765800e-01   +6.012230787792665e-01   +1.058143402711569e-01   +2.802436108966508e-01];
L1I_L2I_iGABA_netcon = [+4.947461070495457e-01   +1.974260576955373e-01   +7.708075174136050e-01   +3.228403056542728e-01   +5.508706501078617e-01   +2.888866041404253e-01   +8.584482673965250e-01   +2.084444015484638e-01   +5.686359141005130e-01   +8.602139016104495e-01   +3.698344519273722e-01   +4.018372996975648e-01   -3.319376835694339e-02   +7.175179991032115e-01   +6.182821441653172e-01   +4.954817266401799e-01; +3.632635423497894e-02   +5.388531939652693e-03   +3.033242559760340e-01   +2.543990531705035e-01   +8.746696092146632e-01   +3.437784188006466e-01   +3.406624657975906e-01   +1.078180311107871e-01   +4.581615856690753e-01   +2.455755298721466e-01   +2.964956709889603e-01   +2.717919105022691e-01   +9.509486087001747e-01   +1.813953023352149e-01   +8.104005678608868e-01   +2.333247789032195e-01; +3.923977400850067e-01   +6.418340211936657e-01   +3.360781327672788e-01   +7.063566499379486e-01   +2.275460795460743e-01   +5.304530674765704e-01   +7.581724199156387e-01   +9.041731813631497e-02   +7.574029386037912e-01   +4.662956208578785e-01   +5.917465326549083e-01   +8.434215095579158e-01   +9.417221365550210e-01   +6.681238187509164e-01   +3.380784999484553e-01   +1.797120474298556e-01; +8.403853058292559e-01   +9.186260277716028e-02   +6.434348214617456e-01   +9.133523407406980e-01   +4.824548873956059e-01   +9.144658320041388e-01   +6.401628527031006e-01   +3.073211182718340e-02   +4.734487556920738e-02   +3.264467928447660e-01   +4.234739963145230e-01   +4.676243560741308e-01   +3.403317916141587e-01   +5.037805323397825e-01   +1.672076433793934e-01   +6.872686117867575e-02; +9.443431254917529e-01   +7.574332081694127e-01   +7.405049590939980e-01   +6.553312206423483e-01   +2.828710029983263e-01   +6.570293278304603e-01   +6.654863487632479e-01   +6.138995151909024e-01   +8.418648475852306e-02   +6.855952178649817e-01   +1.958399529406776e-01   +4.559791547809612e-01   +5.777678890813203e-02   +1.955899841171239e-01   +6.945990599308214e-01   +9.381287694748873e-01; +5.433304333151426e-01   +4.060424307068964e-01   +1.275600906748326e-01   +3.347768790535958e-01   +9.152601986464205e-01   +1.298103488257230e-01   +7.295286323186378e-01   +6.113599616775245e-01   +5.280577679858163e-01   +7.254951825569365e-01   +3.299022359249670e-01   +5.403851461824387e-01   +9.067830351970727e-01   +6.966562077661270e-02   +1.943039930231436e-01   +6.566213008109002e-02; +8.348987757297269e-01   +1.314337597022359e-01   +3.657490974683748e-01   +3.296808033317845e-01   +5.606950410392605e-01   +8.519869840828400e-01   +6.758047141123603e-02   +2.203269069404543e-01   +6.944284132508562e-01   +8.934085170012047e-01   +8.904931367953280e-01   +8.288143628244901e-01   +1.410370929194576e-01   +2.668023498167503e-01   +6.627377263329899e-04   +5.883723636922523e-01; +8.915312890925112e-01   +3.992047042370401e-01   +3.301834300470827e-02   +8.996433054259169e-01   +1.757102229211381e-01   +9.702275268208793e-01   +7.671863041021564e-01   +6.901201685994941e-03   +7.952152182036090e-01   +5.057893183788156e-02   +8.739090113059753e-01   -4.419580399547351e-02   +8.153857258126094e-01   +7.273025937281860e-02   +9.929747464578926e-01   +6.779037209510413e-01];
L2E_L1E_iAMPA_netcon = [+3.076269859765066e-01   +9.289526655071085e-01   +6.401693235344015e-01   +5.700440478601385e-02   +3.066447627701567e-01   +3.727056219200116e-01   +1.017489700423825e-01   +6.248000289109368e-01; +2.128234026644563e-01   +1.529174236668522e-01   +7.499589920762415e-01   +8.549208112658452e-01   +3.166490880306388e-01   +5.031016865555662e-01   +2.394924667339516e-01   +1.131832820119832e-01; +4.695134387150473e-01   +8.930368329798192e-01   +7.861284290234360e-01   +3.901398173631632e-02   +6.776743715295669e-01   -1.809823076598835e-02   +4.364814521180763e-01   +8.186498044364000e-01; +4.730367817844048e-01   +6.506613485423101e-01   +6.557612030933212e-02   +5.852114508219730e-01   +2.944179090346861e-01   +5.396798610303987e-01   +1.965986241647239e-01   +4.885536144287451e-01; +8.816576923800358e-01   +6.787575272237214e-01   +7.522231461600646e-01   +5.028303998185398e-01   +7.541400412189926e-01   +3.678772377710912e-01   +4.464683956778511e-01   +4.878791738941471e-01; +4.812996073402915e-01   +6.802783879338087e-01   +4.378808189539574e-02   +6.097355277743354e-01   +6.657585403470805e-01   +8.385832214630831e-01   +3.051965219580086e-01   +6.275910331242397e-02; +4.314630176091788e-01   +3.035598572763050e-01   +2.062457613766220e-01   +4.326291952097540e-01   +4.255713232774246e-01   +2.393686582502104e-01   +6.017458431772634e-01   +2.990514570620686e-01; +6.989223656779097e-01   +1.625219685053871e-01   -6.921353157851939e-02   +9.679476852490833e-01   +5.229206131926888e-01   +3.575975663363554e-01   +5.968973297740335e-01   +6.151127348416388e-01; +7.692731776887457e-01   +5.966768161637694e-01   +6.826790753513057e-01   +1.508623511130638e-01   +4.160045751711221e-01   +2.529749512850004e-01   +5.537889012079394e-02   +1.000000000000000e+00; -2.053662920585191e-03   +1.347140168744618e-01   +1.792261316180215e-01   +1.666599523535540e-01   +1.626145944425973e-01   +5.528644001494382e-01   +8.532767859701269e-01   +8.224671759717415e-01; -6.270309029541059e-03   +2.062376417151192e-01   +5.503776389204134e-01   +4.817349983974086e-01   +1.003503434263465e-01   +4.109409865848128e-01   +1.678927096196865e-01   +7.216682773706317e-01; +3.433868596258672e-01   +5.525689482502517e-01   +6.244121325373322e-01   +5.028025284813309e-01   +6.996168972699952e-01   +2.899967495010195e-01   +6.849173571270714e-01   +4.170629808692383e-01; +7.016645912153815e-01   +7.199614247525352e-01   +6.016439217008769e-01   +2.505605720127220e-01   +2.001629957824881e-01   +9.354517075934576e-02   +3.007546517934459e-02   +5.231299679466332e-01; +7.205740928353351e-01   +8.078744319801359e-01   +3.728323848222417e-02   +9.090851122076692e-01   +4.837734652414241e-01   +7.882225996765456e-01   +2.440984499628662e-02   +1.870474807889688e-01; +9.453829025690220e-01   +2.233787423870046e-01   +4.617362444950963e-01   +5.599079618578301e-01   +3.387393810142815e-01   +2.407319823908285e-01   +6.017326886946344e-01   +3.923033260463999e-01; +8.337920098263270e-01   +6.299902983584492e-01   +7.185688088308134e-01   +3.939720044154922e-01   +5.018922200919939e-01   +8.337172983523417e-01   +7.456421312676282e-01   +1.315968232344013e-01];
L1E_L2E_iAMPA_netcon = [+8.536929378146958e-01   +4.649155217774126e-01   +6.005323166989784e-01   +1.363161872008524e-01   +9.634991859351418e-01   +2.961810951345820e-01   +5.241104766000263e-01   +5.017174405226076e-01   +8.836320379928837e-01   +5.198747275199666e-01   +6.594128300374743e-01   +4.453845939636973e-01   +5.124682279972811e-01   +3.552885652679419e-01   +5.935578250458318e-01   +2.679566334834984e-01; +7.699100499778726e-01   +1.523384771978344e-01   +9.771733519370990e-02   +5.394726020289138e-01   +8.005832835378041e-01   +5.937798365457239e-01   +8.888001168939106e-01   +2.429594913715506e-01   +3.761426739172909e-01   +3.084246535113094e-01   +6.700688350577438e-01   +6.295349614689792e-01   +6.922109481037872e-01   +8.777215711422018e-01   +3.696474607166201e-01   +5.383542942227226e-01; +7.367364489371703e-01   +1.233500344506203e-01   +1.841848289444829e-01   +9.973186093819036e-01   +1.823144628692518e-01   +3.989255259196889e-01   +8.636329754020253e-01   +3.083033575199415e-01   +1.867822826984379e-01   +6.008066529738640e-01   +7.499794268953187e-01   +4.829406912727539e-01   +8.171065741856031e-01   +9.577880024405374e-01   +8.297458113188220e-01   +6.201601653218953e-01; +6.744892034387716e-01   +5.792245750078904e-02   +5.539829626345416e-01   +3.242480956990876e-01   +4.401039640110899e-01   +8.077947438598221e-01   +1.876242351047425e-01   +1.560584097460831e-01   +5.843541381070123e-01   +4.505871589378433e-01   +3.841927573064443e-01   +9.191509858877640e-01   +7.134403637512047e-01   +2.303573330845187e-02   +7.581779538240129e-01   +7.983948486487596e-01; +2.262802887039444e-02   +1.959198855260412e-01   +1.425038496525585e-01   +7.476682694589367e-01   +1.765857076596428e-01   +4.605978001078814e-01   +9.566571278937405e-01   +3.210634279867584e-01   +8.518367531056988e-02   +7.240697948704848e-01   +8.610812393080761e-02   +5.140261158821851e-01   +6.295863038950344e-02   +6.268346913855037e-01   +4.250911282012128e-01   +1.273201324591866e-01; +6.295001798167108e-01   +4.598804110871346e-01   +4.041015011703792e-01   -1.276272578467067e-01   +8.720684860671917e-01   +1.215342283631587e-01   +4.717453574929065e-01   +1.828743581193433e-01   +7.288169302194234e-01   -1.797370487909096e-02   +7.342207331692248e-01   -2.933201995041509e-03   +7.206476344861201e-01   +5.067020638550330e-01   +7.012058253029241e-01   +3.293017844486095e-01; +2.581268427396261e-01   +6.704317611723202e-01   +3.248457077316755e-01   +4.031456586060945e-01   +3.166165807341169e-01   +8.929561118901683e-01   +8.929430054573566e-01   +4.362605763517274e-01   +6.660581888093277e-01   +7.602796048768485e-01   +7.069615756481419e-02   +1.282563417279836e-01   +1.105389238754014e-01   +3.798355041343827e-01   +3.034779111147374e-01   +7.582215887246373e-01; +1.625924437711044e-01   +4.333942990545082e-01   +2.755291366642258e-01   +4.749845014057371e-01   +9.330626538220348e-01   +4.763387611069839e-01   +9.296346037875800e-01   +8.460220290351551e-01   +3.711261554749251e-01   +3.998615946048480e-02   +4.088627344630731e-01   +4.002272928373418e-01   +3.399268071397774e-01   +6.827405750977338e-01   +7.920206893850397e-02   +5.112150658422271e-01];
L2I_L2E_iAMPA_netcon = [+3.114454162012312e-01   +2.720012650974989e-01   +3.208674861293747e-01   +5.706315812435634e-01   +1.838770370721599e-01   +8.151869479516618e-01   +6.908555776771012e-01   +2.381917502286099e-01; +4.807032929216611e-01   +1.542071153729164e-01   +6.919732101410501e-01   +2.675734087155143e-01   +6.994489962416344e-01   +7.938725286371178e-01   +8.893627007167122e-02   +4.947038084619635e-01; +6.455271194321661e-01   -7.280092689619053e-03   +6.859191305305984e-01   +5.976407808435490e-01   +1.287643982260684e-01   +6.126452022627096e-01   +7.537807826704737e-01   +7.990983136117870e-02; +5.286878649340937e-01   +2.735535132499037e-01   +6.005537270665724e-02   +9.291823633567740e-01   +3.664351137341880e-01   +6.426614225643678e-01   +9.900074074796990e-01   +1.718874965985446e-01; +1.418996499576301e-01   +4.670364179319582e-01   +4.481572103961528e-01   +8.326653980041756e-01   +8.535777096797788e-01   +5.445247676731885e-01   +7.313121372197458e-01   +2.412147794528683e-01; +9.047831008785954e-01   +5.345344932238006e-01   +8.885980296857847e-01   +9.099418114281148e-01   +6.712482602060745e-01   +8.451799119039521e-01   +8.378352575661123e-01   +5.005971775662192e-01; +1.131785360589612e-01   +5.508957541405022e-01   +8.969735312685956e-01   +8.718232266854296e-01   +1.011020818168046e-01   +7.460292094851650e-01   +2.545811616413615e-01   +1.378229391218666e-01; +5.822878822032196e-01   +3.731100045633877e-01   +1.449715837049704e-01   +2.745223192646533e-01   +7.233933967968844e-01   +3.982541046250189e-01   +9.695794342562501e-01   +6.254929189809112e-01];
L2E_L2I_iGABA_netcon = [+4.114195380503149e-01   +6.020035218849688e-01   +5.795937343308598e-01   +6.809888966015420e-02   +4.229727931782637e-01   +4.861367756757259e-01   +3.006996472898104e-01   +7.275623086988879e-01; +4.303779627821424e-01   +3.622567817385470e-01   +1.663668831301848e-02   +4.885107110994224e-01   +4.408222957494742e-01   +6.283086077857342e-01   +5.129226504733045e-01   +4.298874288646666e-01; +5.608080781608187e-01   +5.429038083234862e-01   +3.877897133171515e-01   +5.874656308113656e-01   +2.960119362553941e-01   +2.837598384481243e-01   +1.772150783315320e-01   +9.784561406319494e-01; +7.608154434085376e-01   +5.593573811849506e-01   +3.698531731278114e-01   +8.910887030314562e-01   +2.226383898765616e-01   +3.090166615428352e-02   +1.513367187994877e-01   +3.601581219870474e-01; +5.215264014104357e-01   +7.814916329990728e-01   +4.704060175238257e-01   +7.796211714520590e-01   +3.709354005193393e-01   +6.808429161588847e-01   +6.181464240780185e-01   +3.875796382143699e-01; +3.810029439738662e-01   +2.553816083279720e-01   +4.354626949356722e-01   +4.011412911335452e-01   +7.822299299205187e-01   +8.072205056338922e-01   +2.169603628947368e-02   +4.516705611509377e-01; +4.348609868336867e-02   +4.833814734337428e-01   +8.130990630939622e-01   +6.027273002765010e-01   +5.037985965653012e-01   +3.877471749124762e-01   +8.879906953053553e-01   -4.569789741455775e-02; +8.991429727004500e-01   +5.470805271190546e-01   +8.823162690525932e-01   +4.767005546517941e-01   +8.937984392913496e-01   +5.332021989239581e-01   +3.276866931474540e-01   +3.418548348404719e-01];
L3E_L2E_iAMPA_netcon = [+2.900730669299772e-01   +9.131340093608473e-01   +4.794663831720209e-01   +7.718581226532689e-01   +1.782187440715957e-01   +3.971254129546199e-01   +3.454968696392410e-01   +1.006595125655354e-01   +1.669609480687038e-01   +5.493871314059244e-01   +1.372008303685037e-01   +4.908576998993493e-01; +2.948820938482157e-01   +4.760113369246038e-01   +1.653145109044655e-01   +1.943896999150112e-01   +5.842817359410722e-01   +9.179457978056873e-01   +6.753700663938710e-01   +5.671305354953500e-01   +2.268441010540831e-01   +6.109996556728267e-02   -1.568821769263363e-03   +7.507560603327444e-02; +7.796998859106763e-01   +3.575429076719302e-01   +5.371411079251006e-01   +1.514532875751065e-01   +8.489257593504999e-01   +8.936329034412082e-01   +5.379449352557005e-01   +5.815690284111884e-01   +7.315350813747823e-01   +3.700471176276555e-01   +3.873603776735866e-01   +8.888773101827526e-01; +1.707173249516243e-01   +4.732386969368625e-01   +1.671705770471212e-01   +7.896140635079172e-01   +4.907618001296569e-01   +5.582761036974238e-01   +8.640137816577105e-01   +2.887004825392623e-01   +8.391484595624976e-01   +8.234741104805048e-01   +4.509967671679284e-01   +1.727993263425698e-01; +2.276466127584034e-01   +7.697466611623472e-01   +4.107377086189705e-01   +2.222785022241987e-02   +2.197779292670333e-01   +9.665384728464307e-01   -2.036534653062191e-02   +6.554425685081209e-01   +8.146929389958034e-02   +8.649903492923626e-01   +2.797660574376371e-01   +2.352236600122369e-01; +3.327055586795377e-01   +4.140547786508281e-01   +8.443494813594448e-01   +9.915188199662668e-01   +3.778758951871358e-01   +9.248129647336354e-01   +1.001778537694826e-01   +3.783982801874913e-01   +4.818952699196216e-01   +8.308279371020496e-01   +5.702053969930052e-01   +8.558461907816767e-01; +2.025588229408946e-01   +4.763355002599366e-01   +5.618323940056416e-01   +8.931172690698957e-02   +6.269917232458415e-01   +4.965445805555958e-01   +7.738713212368559e-01   +1.187697513681304e-01   +4.373537676401581e-01   +4.316164241564966e-01   +9.843571607153029e-01   +7.343249538384037e-01; +5.945761453181817e-01   +4.524046623564378e-03   +4.064428690319501e-01   +1.399660517521213e-01   +3.410989938237259e-02   +8.733749550809095e-01   +4.036581015274157e-01   +4.538507526677697e-01   +8.558043208913247e-01   +1.000000000000000e+00   +9.456117730538619e-01   +2.888900770987341e-01];
L3I_L2I_iGABA_netcon = [-6.493441527966473e-03   +5.283631140390271e-02   +1.448593667091988e-01   +6.738510732814305e-01   +2.705727419179463e-02   +5.047702739579041e-01   +8.434517700763922e-01   +3.982437385369246e-01   +4.391997499244102e-01   +9.431311833863066e-01   +8.535491536386370e-01   +6.283804355650328e-01; +3.891309040670002e-01   +4.168651389408638e-01   +2.911490542238512e-01   -4.827164068987445e-02   +4.515738670096227e-01   +6.198600015237281e-01   +4.610730844835301e-01   +9.172962604550228e-01   +1.555691390992427e-01   +9.077430965873998e-01   +2.603546640661273e-01   +6.521667076234051e-01; +3.737903163302461e-01   +6.680498351644791e-01   +2.858673594448523e-01   +7.718103606056319e-01   +3.255379577687982e-01   +8.691468558890129e-01   +1.000000000000000e+00   +1.257356174956891e-02   +6.644701640466372e-01   +4.491200924775908e-01   +1.210909411180096e-01   +5.840816432343416e-01; +6.399422013252699e-01   +9.976324605167047e-01   +3.157330377414342e-01   +2.622901760916004e-01   +1.607959304267176e-01   +5.747081103773657e-01   +1.619436404636406e-01   +2.243869174953616e-01   +6.996369628381183e-02   +3.406991273459605e-01   +5.012131720668415e-01   +8.092592695729225e-01; +9.685885635580578e-01   +1.247481979069326e-01   +4.586527760011155e-01   +8.558423831870238e-01   +5.019187869954582e-01   +8.915241744474321e-01   +9.047281905554848e-02   +5.143868856033240e-01   +5.882213413864967e-01   +8.029516944350007e-01   +7.394040898493371e-01   +5.457340449149679e-01; +9.589329968862575e-01   +1.998837116816700e-01   +1.701403868180547e-01   +7.738927966630375e-01   +9.373928657499726e-01   +7.828382621731221e-01   +9.488844974025725e-01   +5.703247319055822e-01   +1.048622677995055e-01   +8.352499628620631e-01   +3.011191606806425e-01   +5.833843173835178e-01; +1.082944798154809e-01   +5.364976338359999e-01   +9.331095278446108e-01   +5.636155679099486e-01   +9.917743264020359e-01   +7.757823235950487e-01   +8.572582978032838e-01   +8.023655781092919e-01   +6.034497991309199e-01   +4.130876097140648e-01   +3.319674282358733e-01   +5.662945905357990e-01; +3.607206968636459e-01   +3.361780470549463e-02   +8.008456480511459e-01   +1.715388630352414e-01   +4.570445497856213e-01   -3.497293878378767e-03   -2.510856407545680e-02   +9.466643003862164e-01   +4.997549242946112e-01   +9.165138085128706e-02   +7.209467754821648e-01   +6.779554355879387e-02];
L2E_L3E_iAMPA_netcon = [+9.281239090389672e-01   +2.368325529089512e-01   +5.573913151955597e-01   +6.978767578415848e-01   -1.996240670331966e-02   +7.041251949260663e-01   +8.025836944865548e-01   +1.249360302836406e-01; +3.129938991854702e-01   +5.501642365010877e-01   +6.650507863286166e-01   +7.166527867590642e-01   +2.759089709652435e-01   +2.153588051046968e-01   +8.096067598612223e-01   +1.035093191678061e-01; +6.233808318437386e-01   +5.149736429507151e-01   +8.520431507306333e-01   +6.120134771422320e-01   +9.175349029036112e-01   +4.596545128152515e-01   +9.928619370796301e-01   +4.289462904056033e-01; +2.162608215729900e-01   +9.192478685920400e-01   +8.624832322435781e-01   +4.056152801224691e-01   +4.178857599036576e-01   +9.669289533464165e-01   +2.483759418596704e-01   +4.833271166300759e-01; +8.465001640730321e-02   +1.852104151225428e-01   +7.344411222684077e-01   -1.086239581077943e-02   +2.018384960782837e-01   +5.143569371387680e-01   +4.499519294969884e-01   +6.222891322988184e-01; +4.232878115104809e-01   +8.105198307292310e-01   +1.654352913969610e-01   +7.632743522490215e-01   +9.112092605412969e-02   -7.012411372078692e-02   +4.938709894799332e-01   +2.680558411230669e-01; +4.669030717067332e-01   +7.709569044111498e-01   +7.820124052781097e-01   +2.745627072578153e-01   +8.289307966886530e-01   +2.036758586822111e-01   +7.380555172140981e-01   +9.212130651194350e-01; -1.328607109472663e-02   +5.210640590058522e-01   +8.965743337312839e-01   +4.681886364173152e-01   +9.432378755702200e-02   +7.500136855987571e-01   +8.512857118291155e-02   +3.158641506745593e-01; +9.760161286118825e-01   +9.127887695970874e-01   +8.878937317358682e-02   +1.658711092443005e-01   +8.317338984106713e-02   +8.812464311366411e-01   +2.584732347990079e-01   +9.133824176775237e-01; +1.322705141522186e-01   +4.038547652690134e-01   +7.966120038637255e-01   +3.110328504661416e-01   +4.321902999272377e-01   +8.785745409609896e-01   +3.183438938675075e-02   +9.362771261743681e-01; +6.767515192037439e-01   +3.696519215287662e-01   +2.807092841472900e-01   +2.466468689580208e-01   +1.876077708297218e-01   +3.068707058908232e-01   +2.027714664829161e-01   +1.213493929197150e-01; +1.317620339413413e-01   +6.275445061612808e-01   +8.369710640087343e-01   +4.342015060581071e-01   +1.713335985458433e-02   +7.364896279171603e-01   +7.729593761475088e-01   +7.997409452670721e-01];
L2I_L3I_iGABA_netcon = [+3.503670329468102e-01   +6.611432874430034e-01   +2.799364856566472e-01   +6.421939473160527e-01   +5.011254299227327e-01   +4.128403264472346e-01   +4.088342346095153e-01   +4.797891070077622e-01; +3.544225492273455e-01   +9.850718862663918e-02   +3.526584644904132e-02   +8.340266528746211e-01   +6.880696828753556e-01   +4.261931989307279e-02   +9.621259503421049e-02   +6.315206342508209e-01; +3.036636215690772e-01   +6.271463300092005e-01   +3.971298946029552e-01   +7.939207574710805e-02   +8.481453861908520e-01   +6.349060896639107e-01   +1.930847753393087e-01   +1.215711819166932e-01; +6.067977180814073e-01   +8.310929491306605e-01   +5.427556371539620e-01   +4.332185226083801e-01   +5.374310035118578e-01   +6.485054973145298e-01   +3.762241351663029e-01   +6.333922927758898e-01; +1.106682888326975e-02   -5.233220821445102e-02   +8.229541612203527e-02   +6.993010059800053e-01   +2.057266554289462e-01   +6.287063043007743e-01   +4.289856976098342e-01   +2.648482167344328e-01; +5.409833983252470e-01   +3.759860031120913e-01   +4.256723023693196e-01   +6.879951236612385e-01   +2.254128104774489e-01   +8.282066125940714e-01   +4.002024873631490e-01   +9.886553263026968e-02; +1.914839239051479e-01   +2.438749695508114e-02   +4.001573865969404e-01   +9.975810820648825e-01   +6.705990611939582e-01   +5.871008759556075e-02   +2.561010589799841e-01   +8.780006781303769e-01; +1.966772251668782e-01   +9.013829836104952e-01   +9.070567475727694e-01   +9.147225021984661e-01   +4.807333115603192e-01   +1.233462284583191e-01   +7.222765258779716e-01   +1.338338925680084e-01; +3.297707594463634e-01   +5.311715579520174e-01   +2.623892643575619e-01   +1.981984492675455e-01   +3.964790557115342e-01   +2.544182898643224e-01   +5.668511475681427e-01   +4.484047777744224e-01; +3.781546793297009e-01   +1.897521742028439e-01   +1.967562269086293e-01   +4.110317363187057e-01   +9.444513246478139e-01   +4.845114845741868e-01   +4.631604975363617e-01   +9.299734248883115e-01; +5.865886984125560e-01   +1.090192944377344e-01   +3.320122881049319e-01   +5.399022629807092e-01   +5.122376783917377e-01   +6.613801499853771e-01   +9.031715995761546e-01   +6.057856283455875e-01; +3.700040128169244e-01   +1.630119245534421e-01   +5.961701767339711e-01   +3.293007535334693e-01   +1.291033717042144e-01   +2.887931284587951e-02   +3.072212229882195e-01   +6.702418938099801e-01];
L3I_L3E_iAMPA_netcon = [+1.305607272338183e-01   +6.678192561133861e-01   +6.451851785663797e-02   +1.565469103876900e-01   +2.826062912101053e-01   +6.272518421129673e-01   +8.504934213872850e-02   +3.467623644456819e-01   +5.087035674928116e-01   +3.553570136365504e-01   +6.377185304338066e-01   +9.020044425871082e-01; +3.849519020470160e-01   +8.209497922918644e-01   +2.728172685704326e-01   +3.469176190805249e-01   +7.210051878142698e-01   +4.477834298495202e-01   +4.352824840423269e-01   +3.763215479126031e-01   +6.496211892733127e-01   +2.821813026151371e-01   +6.643302341545050e-01   +1.667211017311415e-01; +4.725239464686457e-01   +3.418031173440801e-01   +7.533779926788681e-01   +8.832979823573063e-01   +5.490875089787103e-01   +6.273368771408674e-01   +1.000000000000000e+00   +4.500610896209440e-01   +2.266976889465230e-01   +3.109088221294483e-01   +9.439298640805699e-01   +8.474382457316564e-01; +4.933451857445549e-01   +1.357363299924387e-01   +5.470206150007735e-01   +7.163228006133320e-01   +4.380508843102476e-01   +6.191603818506225e-01   +5.518444551597813e-01   +7.026876793546423e-01   +4.895523437700315e-01   +2.331710418287102e-01   +4.259417548736916e-01   +5.065213814952274e-01; +9.277945540472631e-01   +8.171548778506106e-01   +5.850386570235275e-01   +5.354712245586788e-01   +2.661427954056418e-01   +2.987862120265829e-01   +4.112840721216410e-02   +2.436827703290005e-01   -1.072585564418463e-02   +2.699606838924807e-01   -2.748612142194714e-03   +5.352034965555326e-01; +3.917796073008132e-01   +1.959025642150275e-01   +6.656224713077770e-01   +4.502161180050893e-01   +9.730315712043114e-01   +6.261168654700473e-01   +3.068883116557871e-01   +1.012581032947811e-01   +1.903413340895008e-01   +5.868114423545600e-01   +3.351194541934043e-01   +1.160879105813469e-01; +4.889339579991355e-01   +2.464019529371531e-01   +8.344272480037023e-01   +8.726831830954632e-01   +1.321321654765053e-01   +2.729954539130826e-01   +4.177776181807854e-01   +1.320978588386377e-01   +9.025093386959810e-01   +7.184153896300304e-01   +3.130707408206568e-01   +5.304242353265595e-02; +3.894722215674075e-01   +4.278853553067485e-01   +2.984930193669894e-01   +6.061519721758667e-01   +8.602754093120535e-01   +2.571332071502946e-01   +4.085941958558451e-01   +3.001679406124831e-01   +3.019123612066718e-01   +2.642249393269365e-01   +6.908149064724156e-01   +5.715813118537545e-01; +2.906907196868349e-01   +4.940686084386914e-01   +4.142556776326946e-01   +5.903687544936533e-01   +5.673645980585532e-01   -7.408485345556227e-02   +7.919101521544633e-02   +3.255560384667288e-02   +3.047166980903363e-01   +1.958346207677482e-01   +8.548565675186424e-01   +9.018141012149062e-01; +7.124329446220027e-01   +5.645927140116827e-01   +6.180782546520802e-01   +4.458348333647031e-01   +4.717770234795020e-01   +4.114609061782558e-01   -3.761555220921066e-02   +6.756665462395067e-01   +5.553323473524142e-02   +8.967135462718827e-01   +4.554276873038034e-01   +1.344391742691224e-01; +3.068364826871995e-02   +2.811337010926609e-01   +6.215027861798373e-01   +2.610999489503729e-01   +1.933258284340582e-02   +5.277708206532905e-01   +1.009902579705897e-01   +7.594283017299981e-01   +7.015284025936582e-01   +1.384606563776558e-01   +6.694051843579178e-01   +3.218916768228873e-01; +6.298191786900187e-01   +6.814358087102481e-01   +4.174746394960158e-01   +6.307240703725437e-01   +6.583052943124897e-01   +3.624082025692154e-01   +2.945306826518341e-01   +8.151274653746416e-01   +5.884974477826038e-01   +4.051419114803705e-01   +5.358231537916466e-01   +4.076389326345641e-01];
L3E_L3I_iGABA_netcon = [+3.276532798284810e-01   +7.093544927754102e-01   +6.115091150346532e-01   +8.831369286074958e-01   +4.767625775231565e-01   +8.397123235013432e-02   +2.238688564677124e-01   +6.871561180412304e-01   +7.273979861426001e-01   +2.754664571289445e-01   +4.765417768055989e-01   +3.046328707587810e-01; +8.277197619908125e-01   +3.736344570882676e-01   +6.010248949424264e-01   +1.070666760872741e-01   +8.316775337331069e-01   +4.100168670615434e-01   +7.919962002588024e-01   +6.477757017415523e-01   +5.996487118653663e-01   +7.051954520676723e-01   +2.294539906503165e-01   +4.362645674915336e-01; +7.916996680224386e-01   +3.657684730111246e-01   +4.089951689247490e-01   +4.817233306073843e-01   +5.656363279130133e-01   +5.377927123208412e-01   +2.304605643973467e-01   +8.247695043183471e-01   +5.219890321848215e-01   +1.530135613321346e-01   +7.587261596325220e-01   +8.752560338130365e-01; +1.599387264958705e-01   +6.454587121781075e-01   +3.114667896167991e-01   +2.906597059143233e-01   +1.139096487558292e-01   +6.576860995144367e-01   +2.888113427776972e-01   +2.754258720991848e-02   +3.142851441155073e-01   +4.861074726739602e-01   +7.145789965799324e-01   +5.818145766849191e-01; +2.467562234190345e-01   +6.549671260139419e-01   +5.695364667198399e-01   +2.674385250666882e-01   +1.247095487739685e-01   +6.108612766827283e-01   +8.944156124622424e-01   +2.874585205519247e-01   +2.698707248044455e-01   +8.684641989857687e-01   +6.088098999830210e-01   +2.096872002105357e-01; +4.544520860914341e-01   +8.078323019273767e-01   +7.038127638880837e-01   +5.061627356681700e-01   +7.155036982513249e-01   +9.706877315318602e-02   +3.498720644120950e-01   +2.703795301142605e-01   +8.948372859869301e-01   +8.633502523224831e-01   +8.047880512225457e-01   +2.424145765185884e-01; +5.653488618833985e-01   +7.733701723015799e-01   +2.208196717322304e-01   +2.447247033967412e-02   +4.206587939859210e-01   +5.764812817441598e-01   +5.906207186254342e-01   +1.791418249294051e-01   +9.630602353146455e-01   +5.627434860829603e-01   -4.041786472148599e-02   +3.168114535728155e-01; +4.610748937542387e-01   +4.177537408908345e-01   +8.577266384629399e-01   +3.905966926376707e-01   +8.940705542646757e-02   +9.994033950105871e-02   +6.043947285055133e-01   +4.273642848651597e-02   +6.019737681474711e-01   +7.653020100871126e-01   +2.061348287558534e-01   +9.879899089299214e-01; +3.225299915624047e-01   +5.288193432589929e-01   +2.836352290985738e-01   +7.275518400431262e-01   +8.230476982744670e-01   +7.085538540586778e-02   +3.734055281591777e-01   +5.926599669194189e-01   +6.076986939226634e-01   +8.419793077832946e-01   +6.565963373204029e-01   +6.173250606281152e-01; +7.925642124034114e-02   +3.061155517512248e-02   +2.938443197774100e-01   +5.795566998617492e-01   +7.508483769120929e-01   +1.615544656104018e-01   +4.375267853028614e-02   +3.187526855028101e-01   +6.741967739072338e-01   +2.783126880244558e-01   +5.939439598663064e-01   +1.260924437406110e-02; +8.235510222886470e-01   +1.304812951215639e-02   +7.231659514175053e-01   +4.838417651342831e-01   +3.671218033988300e-01   +8.554803609170465e-01   +1.437625420266927e-01   +7.835597589774014e-01   +3.021616600026998e-01   +9.105020885950542e-01   +4.858422732283511e-01   +7.067685229671519e-01; +6.372545919068913e-01   +8.386906086364185e-01   +4.820189155098458e-01   +8.633772053689492e-01   +7.865569807373544e-01   +5.034409732251023e-01   +9.087055865520987e-01   +8.690375981697182e-01   +4.632030626196814e-01   +8.647643083362175e-01   +4.837594784639668e-01   +8.268505100717004e-01];
L2E_Input1_iAMPA_netcon = [+9.607995191064017e-01   +9.461395849506183e-01   +8.880035119833924e-01   +9.771577941809779e-01   +9.217244949964803e-01   +1.000000000000000e+00   +9.233359749139196e-01   +9.275002191434816e-01];
L2I_Input2_iAMPA_netcon = [+9.206263178357468e-01   +9.375220566415368e-01   +9.697831827929992e-01   +8.644541049763139e-01   +8.940020292719830e-01   +9.124483391995298e-01   +9.120605713246120e-01   +9.298409222181385e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
