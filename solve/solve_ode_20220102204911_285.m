function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.247182506037506e-01   -2.657698451440688e-01   +2.775966079747552e-01   +3.315975242822796e-01   +6.719394064745698e-02   +1.864094536761857e-01   -7.124256743246673e-01   +3.054671521673764e-01   +6.541618609062240e-01   +5.096958914576991e-01   +2.254070297066884e-01   +2.218755439074850e-01   +3.270920669044610e-01   -2.021806386269218e-01   -2.923437667899567e-01   +2.674518213730240e-01; +7.462276172209208e-01   +1.854123661214971e-01   +1.028143356343168e-01   +8.657128705686813e-02   -1.914113653814863e-01   +6.889799734209603e-01   -6.557302424425093e-01   -4.577039443392407e-02   +4.298353202093461e-01   -1.106076825997475e-01   +6.422458017632248e-01   +3.862095500600278e-01   +4.649598210198062e-01   +5.427502760100567e-03   +1.551788643752871e-01   -5.557313306045499e-02; +4.650855315867977e-01   +1.888595457643199e-01   -7.758492789325842e-02   +3.069327074138151e-01   +2.097865341947918e-02   +3.437722142989855e-01   +3.437823265786790e-01   -1.270238856680481e-01   +3.250915661685981e-01   +3.801930977051345e-01   +3.781444678145345e-01   +3.705737455141714e-01   +1.754526245001181e-01   -3.508081624508499e-01   -2.791163682652368e-01   -1.255554055739917e-01; -3.380498423404626e-02   -1.201107000288023e-01   -9.532745438219203e-02   +6.973859854958250e-01   +8.099095761478876e-02   +6.050317491063855e-01   +6.207368200609249e-01   +7.388395317251001e-01   +4.919825066251993e-01   -1.197303954301120e-01   +6.192654526300710e-01   +3.710632404427286e-01   +2.818802302856676e-01   +6.627728769109539e-01   +5.857475594378433e-02   +7.619964230988188e-01; +2.011612453800848e-01   +2.625330668702608e-01   +5.981897854687944e-01   +4.907000201745013e-01   -1.535529857814492e-01   +3.169581996342167e-01   +2.147728529725637e-02   +6.186842897043392e-02   -6.227541938316943e-02   +4.140609585856193e-01   +6.552866693238183e-01   -1.357807977959485e-01   +5.753753396189830e-01   +8.721749724921078e-02   +2.877706638195466e-01   +1.777675033337377e-01; +3.712453408280192e-02   +6.978973408654406e-01   +2.971108717635856e-01   -1.474199944277608e-01   +4.613367122262265e-01   +3.032608930290545e-01   +4.746489761931369e-01   -1.635585876692033e-01   +4.456296025296428e-01   +2.811280975007475e-01   +3.907215885158880e-01   -3.810112766709203e-01   +1.943383290566734e-01   +3.618816972484243e-01   -6.923621591172906e-02   -5.450863896918648e-01; +2.631739345008782e-01   +3.665044840887708e-01   +5.959799111614255e-01   +3.170305201894832e-01   -5.880043263262704e-02   +4.134768633413405e-01   +2.811745263744077e-01   +6.711454306869606e-02   -7.545290872650120e-01   +1.643726172900873e-01   -8.972344095284202e-02   +2.477176569391886e-01   +3.274709115173965e-01   -2.431462530807207e-01   +3.534271634917067e-01   +7.327406949225111e-01; +6.157927865260691e-01   +3.181914733564917e-01   -9.496512305464094e-02   +2.515164647857009e-01   +1.969964125745710e-01   -2.314328228813777e-01   +2.422185414572329e-01   +5.687961591915085e-01   +3.393696035820786e-01   +1.508967040492818e-01   +5.491168147848925e-01   +1.176737421831534e-01   +3.062729961333677e-02   +2.099336800273729e-01   -1.235889417687873e-01   +3.475191361765695e-01; +8.182322498289454e-02   +5.463022534549895e-01   -2.542158755855027e-01   +2.112046595177882e-01   +2.392274160880417e-01   +5.855512650897549e-01   -1.361289130471909e-01   -3.199785371065355e-01   +3.137262739937980e-01   +1.367732751955719e-01   +7.091249568773312e-01   -5.464995035511962e-02   +3.427960571717619e-01   +4.356118955595865e-01   +2.051437406705341e-01   -2.169056144225129e-01; +2.855520667093747e-01   +6.078337496380942e-01   +4.277168469555304e-01   +2.822817775284852e-01   +1.476491196163124e-01   +2.771864025632829e-01   +5.429477481524132e-01   -1.515837332631928e-01   +2.133386861696089e-01   +2.576736078342078e-01   +7.712538210811891e-01   +4.489169480486610e-03   +6.085614663830526e-01   -2.531926134198703e-02   +1.654635972088432e-01   +3.640503340368501e-01; +1.083870639464070e-01   +7.102795706347337e-01   -1.563038899639722e-01   +2.447260150148164e-01   +7.818144948006595e-01   +1.272231008540531e-01   +1.984861880758192e-01   +7.243038245837408e-02   -9.868485517344767e-02   +6.017006483378093e-01   -4.158409933915830e-01   +1.350540990843936e-01   -5.709426619857904e-01   +1.499429514235651e-01   +4.639077426755588e-01   +2.640952204784301e-01; +2.936307502427416e-01   +3.164793729120110e-01   +2.713120462272098e-01   +1.246545883468274e-02   -8.718216546794938e-02   +1.544844684140821e-01   +4.744000023498444e-01   +2.889027051220791e-01   +5.945638855113144e-01   -1.264613840862728e-01   +4.943999683334184e-01   +7.387556603250438e-01   +7.141336372887280e-01   +2.701550829332407e-02   -2.349108512338438e-01   -2.105116535985195e-02; +1.343804716382318e-01   +2.830941950354030e-01   +4.081936261183496e-01   +9.516012350426080e-02   +9.361797356345641e-01   +5.433613807366396e-01   +1.189268195069129e-01   +1.632105610387172e-01   +6.479175977929594e-01   +2.369726413597598e-01   +4.126925897798894e-01   +5.542963014234723e-01   -2.888245356085983e-01   +2.772779291689888e-02   +2.788346863484041e-01   -1.906967630508768e-01; -3.704963162019262e-02   +2.934099620756073e-01   +2.801482298976823e-01   -5.763080157997759e-01   +2.892941283467529e-01   +4.678977540036208e-01   +1.127920154161596e-01   +5.325223795794086e-01   -1.127952665520051e-01   +4.796333190922659e-02   +4.958677419972239e-01   -2.308031434734006e-01   +1.408582243290050e-02   +7.030258656663310e-01   -1.848196461887406e-01   -2.089053344924191e-01; +6.742777324787324e-01   -1.819124493247024e-01   +5.844742861163372e-01   +4.253807573485931e-01   -2.854161644437151e-01   -1.454819307678019e-02   +3.550248816192926e-01   -1.385448597319108e-01   +1.023293011426938e-01   -2.165380088469058e-01   -1.922759214659759e-01   +1.753012830848621e-01   +6.173310082350882e-01   +1.328897235106578e-01   +2.485450762625214e-01   -3.755902925839896e-01; -6.808541136231770e-01   +3.846430750024160e-01   -1.482480302174546e-01   +4.306360386230675e-01   +7.304307851292221e-01   +6.188702511913425e-01   +8.182050943616240e-02   +8.812434603170394e-01   -7.734011900971431e-02   +5.362567078261000e-01   +5.444363724953283e-01   +3.465279234024134e-01   +2.585744326541819e-01   +4.221123079293757e-01   +6.638717088422809e-01   +4.084990012830164e-03];
L1E_L1I_iGABA_netcon = [-2.328569576145829e-02   +3.127992248068313e-01   -5.369607453567049e-01   -9.174692393434260e-02   +7.860509986391284e-01   -1.563922768354600e-01   +4.851408711783698e-01   +3.328174163084993e-01   +6.587068806668080e-02   -1.680193601240477e-01   +2.221060229724528e-01   +1.739659413196654e-01   +7.645141976602170e-01   -4.080109850674576e-01   +3.277095980782168e-01   +8.962550063881524e-01; -3.660458628737620e-01   -2.125517761954588e-01   +5.694581934694150e-01   -3.532087253589757e-01   +3.143216570760964e-01   -3.692546674908684e-01   +2.480628479895008e-01   +5.324215748164618e-01   +3.427477719232448e-01   -9.120254522250529e-02   +4.207630457913313e-01   -6.285092706841686e-02   +6.252778563314165e-01   +2.235942337677368e-01   +3.453458471702332e-01   -7.350910822000109e-02; -1.277186005355746e-01   +3.712912461726615e-01   -3.130478594500493e-01   +4.150542903347857e-01   -2.605702734660986e-01   -1.168507357738662e-01   -5.077398482581795e-02   +9.335478270084421e-03   -7.081064855170564e-02   +2.451500354791120e-01   +1.679413190831463e-01   +1.603132379002533e-01   +1.267543565549294e-01   -1.847073796017150e-01   +6.141245839913125e-01   +1.100321829303437e-01; +4.950686554317427e-01   -3.518278367417045e-01   -1.151767212248877e-01   +1.259827839793805e-01   +3.085760090638168e-02   +3.756094923968250e-01   -5.607406744415618e-02   -3.823489756087919e-02   +8.425831699152631e-02   +1.843934397398908e-01   +2.931567129158895e-01   +2.832791667135865e-01   -2.315981160686785e-01   +3.544507786593140e-01   +1.856405634921383e-02   -1.576789795785702e-01; -2.065808496079337e-01   -7.841360250686860e-02   +4.299167696269981e-02   +3.537027906000847e-01   +4.234161038064577e-01   -1.656601233363922e-01   +2.330481242326868e-01   -5.202366825858158e-01   +8.387690593370842e-03   +1.603077837222056e-01   -3.473441150425353e-01   +5.463577026130352e-01   +3.787821217347294e-01   +4.973256696396888e-01   -8.802795999222665e-03   +2.237179035800044e-01; +9.529229551144174e-02   +2.504342678402222e-01   +1.619801834728625e-01   -3.708111381694630e-01   -3.280111666074655e-01   +5.586350264831683e-01   +8.205007873277956e-02   -2.482757224609523e-01   -1.774310276953253e-01   +1.422564723160348e-02   -4.077303880455850e-01   +6.147577319124639e-01   -1.188158477955992e-01   -3.311912902847652e-01   +3.278222509129727e-01   +5.611448488385064e-02; -2.055081463440031e-01   -4.600711093872975e-02   -3.311981720374214e-01   -3.089926664739095e-01   +5.140041106986886e-01   +7.248680728280894e-02   +3.568093127944068e-01   -2.769127098554159e-01   +5.931603918103117e-02   +3.339602852320985e-01   +6.579121084432936e-01   +1.180064235299865e-01   +1.979965703580093e-01   +4.800321938193134e-02   +8.046645229697633e-01   -2.664742611129995e-01; +1.539166141355981e-01   +3.218451653485799e-01   -1.484660572113133e-01   +2.923196880500496e-02   +5.547693463598155e-02   -2.336094211785953e-01   +7.250712083396820e-01   +1.757810766017526e-01   +5.032175209388028e-01   +1.720724829079001e-01   +1.779555929313972e-01   -5.249124777689045e-02   +5.583856398665286e-01   +4.040715660599395e-01   +3.190436876375369e-01   +4.677978040227748e-01; +6.474741535039719e-01   +6.621690655576389e-01   +1.414078688444254e-01   -2.016315982216768e-01   -3.266578446682937e-01   +4.055401864574071e-01   -1.521742426445079e-01   +8.681205939176290e-03   +2.347643066881159e-02   -1.215316577855376e-01   +1.659214078007128e-01   -2.803731415768669e-01   -1.085598135136031e-01   -6.136816810069697e-02   +5.194663886466407e-01   -3.415879187364572e-01; +2.119714497431099e-01   +5.535942539848697e-01   -5.158658413901851e-03   -1.149571210146608e-01   -3.067253427170305e-01   +7.068674172463212e-02   -9.865953864987606e-03   -4.130053049650780e-02   +4.496690796521440e-01   +2.106787262847392e-01   -5.460077595396267e-01   -1.160266157685541e-01   +2.719113060236665e-01   +4.850616468169270e-01   +2.111882212035606e-01   +3.660025421106464e-01; +3.246138858856814e-01   +2.058549991354329e-02   +1.425675962785158e-01   +5.756501979461713e-01   +3.428339761831588e-01   -1.823446331423183e-02   +1.479985155056985e-01   -1.379319355057710e-01   +4.617755244286286e-01   +3.298423373404827e-01   +1.329350859885057e-01   +5.186862642289479e-01   +7.735395447942995e-01   +2.325814663762051e-01   +3.630862217898540e-01   -4.360918927565450e-01; +2.643747034230798e-01   +2.755084759100390e-01   +1.074257455183905e-01   -6.222303062682943e-01   -1.824549799399681e-01   +2.363098318543361e-01   -5.657989960121875e-02   +2.014709777529251e-01   -5.052785028593552e-02   -2.677158270275212e-01   +2.695936395368477e-01   +2.311143393487799e-01   -1.481785474265759e-01   -5.891672061955983e-03   +3.632047926214371e-01   +3.747785110627037e-01; +5.285209089505993e-01   +4.959613480772821e-01   +2.176863051981011e-01   +2.779213304331215e-01   -1.197014248067362e-01   +2.418060064520255e-01   -1.192772415150737e-01   +3.339841493002277e-01   +6.168443391979601e-01   -1.188201986895059e-01   +2.760103719419924e-02   +2.762044828256061e-01   +2.738481534343699e-01   +5.672135287022981e-02   +3.799607307737100e-01   +4.539254059581181e-01; +5.941810225927875e-01   -1.020728752958960e-02   -1.467953376103321e-01   +6.038860266232908e-02   -5.903903883740424e-02   -1.090763489680199e-01   +2.472804032786601e-01   +3.057560648593694e-01   +3.748002382931767e-01   -3.816951429714205e-01   +2.553590376924476e-01   +9.666447637874954e-02   +1.044785481463323e-01   -9.274975139143546e-02   -8.535044085516071e-02   -2.202209046277108e-01; +5.580696383915614e-01   +1.973977871456715e-01   +1.163340653904119e-01   -7.183874283162475e-02   -6.362497104550385e-02   +1.058252641924794e-01   +4.185662340269431e-01   +1.201372696160974e-01   +4.902218400019105e-01   -1.247271159792752e-01   +2.739888154612720e-01   -2.851992648891194e-02   +1.339053958880567e-02   -4.439015283876146e-01   +7.441252190652426e-01   +2.554493411492358e-01; -1.930244209083516e-01   +2.340616103777424e-01   -4.507822983582284e-02   +8.731783801564703e-02   -1.535611914155822e-02   +1.133049229240152e-01   +3.490372569209942e-02   +8.307534966017815e-02   -6.925901687038880e-02   +3.585205736863069e-01   +1.725516382121742e-01   +1.844084159074821e-01   +2.669423340834935e-01   +3.145487997821271e-01   +9.847291636207040e-02   +5.552308329014182e-01];
L2I_L1I_iGABA_netcon = [-1.739945815628684e-01   -2.193380919645840e-01   +1.236021739103215e-01   +2.775075256083244e-01   -1.602777132224367e-01   +2.203367923711849e-01   +3.352875181300259e-01   -3.078998988467755e-01; +3.895655823780934e-01   +6.366437200755536e-01   -1.304168532699111e-01   +2.132079542154929e-01   +6.040156489350111e-01   +5.056830072401595e-01   +2.220420471488931e-01   +1.466645163197174e-04; +7.485975023635008e-01   +2.044723330987879e-01   +2.989311168514999e-01   +2.221876555286225e-01   +4.400191253056137e-01   +4.303293002491306e-02   +6.568563248527851e-03   +3.831154500586514e-02; +4.980603716624676e-01   +1.499022843769362e-01   +8.769368271171977e-01   +2.727825535459439e-01   +3.985577191687111e-01   +3.583316917006992e-01   +3.638850741087647e-01   -1.380756250208420e-02; +1.053070906653425e-01   -1.190521874161166e-01   +5.211270799720863e-01   +3.828925471115814e-01   +3.646580731675984e-01   +6.601052205669124e-02   +6.460210222284628e-02   -1.398439872023011e-01; +6.998209051388597e-02   -3.106315426105479e-01   +1.655926848282375e-01   +2.627594117053504e-01   -3.337238962805161e-02   +3.494032002731102e-01   +3.129346343251704e-01   +6.204774468314542e-01; +4.955886718796289e-01   -7.800964558131503e-02   +4.055726077604941e-01   -4.253032029706812e-02   +2.803482369111684e-01   +7.443163582069898e-01   +5.040870987677939e-01   +3.222176640298486e-01; -1.407509510594024e-01   +4.723522615089534e-01   +1.591760747731383e-01   +1.779401541803955e-01   +2.511492990615268e-01   -1.408806142855282e-02   +8.681212364837927e-02   -3.001154392472322e-02; +2.928914106658101e-01   +9.463872591178905e-01   -7.161404392482534e-01   +3.533892652269943e-01   -1.672388797596530e-02   +3.289611493911138e-01   +2.423827719678202e-01   -1.404277543588144e-02; -2.995123842110911e-02   +1.622221834266524e-02   +8.546597422925549e-02   +2.901648051312906e-01   +7.441461944891438e-01   -9.051496117497218e-02   +9.095991000166753e-03   +4.663654567551553e-01; +1.298403156252721e-01   +6.721930274221243e-02   +3.559457011614502e-01   +1.285288891454218e-01   +1.806765853326903e-01   -1.059954725846481e-01   +1.282296492281611e-01   +1.342000255081521e-01; +4.966124607954700e-01   +3.771039609527832e-01   +2.585684992743760e-01   +1.639804717007422e-01   -1.175185728128383e-01   +2.488663823450518e-01   +4.600273080459865e-01   +6.225773140723940e-01; +4.772843818294915e-01   +3.038098437416925e-01   +4.829813091580331e-01   +6.667766820104173e-02   +3.696433735359482e-01   +1.982045703012252e-02   -7.210754947668845e-02   +2.916785207726347e-01; +2.371409860914805e-01   -1.412274936218343e-01   +1.174898233322823e-01   -3.461162834253531e-01   +3.555931187503534e-01   -1.073858843706465e-01   +4.955791272477477e-01   +1.425535572818173e-01; +3.445403760704190e-01   +2.843670036572287e-02   +3.292521936597278e-01   -1.447712710105632e-02   -1.080994407940185e-01   +9.617434639512014e-01   +4.146326822630922e-01   +6.363780344735432e-01; +5.747388139680780e-02   +1.059065342114127e-01   +2.160198189311821e-01   +4.552991800928818e-01   +2.304553464947010e-01   +1.742482466720192e-01   +1.133512912044211e-01   -1.446465778223220e-01];
L1I_L2I_iGABA_netcon = [+3.764042914373928e-01   -1.193435641633590e-01   -8.833785163402966e-02   +4.604564416036782e-01   +1.497323226331405e-01   +8.566770713133373e-03   -6.555159102135047e-02   +1.858186605373856e-01   -1.609291086260400e-01   +5.144994754707810e-01   -2.335709104278549e-01   +1.598787129713778e-01   +8.090670547208939e-02   +2.048010210817930e-02   -1.641770688780275e-01   +2.633192187839628e-01; +4.159367824391984e-01   -5.249072435424708e-02   +1.136335791800185e-01   -4.443906429120201e-01   +4.584780229819542e-03   +1.299469438701555e-01   +2.641364587184704e-01   +1.089041442868594e-01   +2.690880629727023e-01   +6.525423543964621e-01   +1.832199241988768e-01   -1.634575849383272e-01   -1.465782677339514e-01   -4.791137138350727e-01   +3.881705471489351e-01   +2.761761402310496e-01; +1.112851935052153e-01   -2.664243623359593e-01   +3.646286632213575e-01   -1.126867670302330e-01   +2.097017412280975e-01   -1.546181542304463e-01   +5.580605587215959e-01   +3.145833819644407e-01   -1.024052188393847e-01   -1.006457330237556e-01   -1.971611331197818e-01   +1.937846098738778e-01   +2.416064042851910e-01   +6.152603563432619e-01   +8.780795172982452e-01   +1.893272435620678e-01; +4.059988629654208e-01   +6.113772596739537e-01   +5.433398717140249e-01   +3.775021925087663e-01   +3.620117982625455e-01   +7.151820670759967e-01   +4.380472146608597e-01   +3.345648543823099e-01   -5.073694648060886e-02   +8.480768270535056e-01   +5.927650197552965e-01   +3.005314604657902e-01   +3.468210352253286e-01   +1.174060340120764e-01   +3.023111485214309e-01   +1.738814230838347e-01; -3.911539422137286e-01   +1.737929661810028e-01   -3.436940164376169e-02   +4.519720881225997e-01   -6.371644437102375e-02   +7.025436190936444e-01   +5.685160244471017e-01   +5.072686537091715e-01   +4.905222855043416e-01   +3.109043928264251e-01   -3.116662001224338e-01   +3.665683862808039e-02   -5.254275954861011e-01   +1.235167392663832e-01   +2.780949611001919e-01   +3.793890418658315e-01; +3.065422176215606e-01   +3.277816502563885e-01   -1.036604119883706e-01   +4.587147694048464e-01   +5.370654835124949e-02   +2.073055362882866e-01   +3.060781443618660e-01   -1.410604312554084e-01   +7.679605552501977e-02   -3.721869062220333e-02   +1.379603672336512e-01   -1.313307853722664e-01   +4.603288189058241e-01   +8.958241216582212e-01   +1.613559460267985e-01   +1.102145019818798e-01; +2.447883111230222e-01   +3.498599039209215e-01   -4.767732780781938e-01   +3.023809556835453e-01   +4.346765074054005e-01   -3.483498514370849e-01   +2.033244452021563e-01   -1.626157446366850e-01   -1.772732379805799e-01   +2.102527049730185e-04   +2.708871206522269e-01   +2.906540853437820e-01   +7.306187888917934e-02   +1.039926592190865e-02   +8.391220809096450e-02   +3.017570734864579e-01; +3.944651568752629e-01   +6.114820334732789e-02   -2.033426811603796e-01   +1.570937853475496e-01   +1.995429153015738e-01   +5.374836689551843e-01   +6.172210321921287e-02   +5.310889086061225e-02   -9.092611919675871e-02   +2.878746452608245e-01   +3.224882827138447e-01   +6.409158687738413e-01   +1.436839533013366e-01   -8.677432682891166e-02   +3.753014449223425e-01   +4.435171736355932e-01];
L2E_L1E_iAMPA_netcon = [+5.350537567621045e-01   -1.858207220163947e-01   +1.567193167511745e-01   +3.248338557855298e-01   +9.454652746227729e-01   +5.130987086311197e-01   +4.525089973643365e-01   +3.323510765079882e-01; -5.673500534900167e-02   +2.032288823397784e-01   +3.773809263388648e-03   -1.504393873924070e-01   +4.403300951349392e-01   +3.549975052159799e-01   +3.583643799073646e-01   +2.403491070857294e-01; +2.997749370309609e-01   +4.152233935318732e-01   +1.952117687363976e-01   +5.531129268795740e-02   -7.541099063830367e-02   -2.638369842043039e-01   +1.123217069428831e-02   +4.172054972491241e-01; +5.583696934237218e-01   +1.614231519584182e-02   -3.082072375647633e-01   +4.396853794206685e-01   -2.414174606269506e-02   +3.214576779059047e-01   -3.101551883215667e-01   -3.656863435867523e-02; +7.138662791297143e-02   +1.930317041318923e-02   +4.962696754776554e-01   -2.643299639870780e-01   -2.431559041253664e-01   +1.213047868259102e-02   +1.192167835674460e-02   +1.980124467994941e-01; +3.851630099000876e-01   -2.153898409830563e-01   +1.123342799028342e-01   +1.082300333354441e-01   +9.656883095790050e-02   +6.348782599706482e-01   +3.361156945654585e-01   +3.994206460579727e-01; -9.281668371785168e-03   +5.536886824918127e-01   +2.235158644985708e-01   -1.543603586903416e-01   -1.527521740481554e-01   +4.358025819427641e-01   +6.863835930195877e-01   -3.508976694387958e-01; +2.558345086250897e-01   +4.836395047985237e-01   +1.000000000000000e+00   +3.030297532049092e-01   -1.320442129008846e-01   +4.243475212629633e-01   +3.881676595669584e-01   +3.276867177063252e-01; +4.485096002086458e-01   -1.026149780808738e-01   +3.675117262914789e-01   +6.555513269128311e-01   -3.069050208950327e-01   +6.121029720434453e-01   +5.935186278812562e-01   -2.228233850620234e-01; -1.037731880715053e-01   +2.544794161929716e-01   +2.941195900255466e-01   +4.265668807880778e-02   +1.506802423593791e-01   -1.060313170508343e-01   -1.283185971546776e-01   +2.109844740129457e-01; -7.918521587139304e-02   +6.515180968425138e-01   +7.829636892452021e-01   -6.991388519369590e-02   -5.551708128497345e-02   -1.974154519322786e-01   +1.695018346699736e-01   +2.665358880834494e-01; +2.401864022267738e-02   +2.231266822921008e-02   +5.126801539089133e-01   +1.119287681710674e-01   -2.971085552656935e-01   +2.925455748060477e-01   -1.395176427867132e-01   -5.439785398284547e-02; -3.277629201137273e-03   +3.858000234511711e-01   +1.443799375846236e-01   -3.417378752595179e-01   +7.354723198310309e-01   -3.473157421406324e-01   +5.290718262887476e-01   -2.249410922234852e-01; -7.404435203072955e-04   +7.262518313753944e-01   -3.290510911360747e-01   +1.236669404215242e-01   +3.415701819322777e-01   +4.386010040120341e-01   -2.970140640471565e-01   +1.425413775139423e-01; +1.220961031506445e-01   +2.524343427036164e-02   -4.854598615976414e-02   +3.442341918625893e-01   +1.841832876710622e-01   -1.804587593361291e-01   -2.807460541576405e-01   +4.982791383171308e-03; +1.929064530970287e-01   -1.048615875574934e-01   -5.199255163892805e-01   -2.468058174176310e-02   +3.173624834003582e-01   +3.995237713119790e-01   +5.045230034800861e-01   +1.561717133772270e-01];
L1E_L2E_iAMPA_netcon = [+2.617627180826799e-01   +3.379940124342125e-01   +1.824413460926240e-01   -1.737687053992412e-01   +3.645868901362389e-01   +1.898714446492627e-01   +1.476771613890177e-01   +5.536532729722558e-02   -9.478513520507349e-02   -6.173260023469510e-02   +3.665452689271571e-01   -1.484296500718586e-02   +2.080886677694642e-01   -1.137579904786193e-01   -3.955602459815202e-01   -2.617095845075805e-02; +2.174897421457348e-01   -3.553548841186691e-01   +6.446713811475134e-01   +1.850979042891020e-03   +1.197768933206738e-01   +1.614030911181377e-01   +5.602693330571262e-01   +1.489726868628828e-01   -2.268314449423916e-01   +7.719912719426797e-02   +3.036712894654152e-01   +5.702297066329904e-01   +5.091210315850410e-01   +2.028911548928943e-01   +8.422404038865733e-02   -1.833344472580044e-01; +7.147894142202885e-01   +1.219697852384074e-01   +1.173424966396151e-01   +2.393593058687371e-02   +1.634113164412631e-01   +4.278576518668374e-01   +8.451720534098894e-02   +3.437418287843322e-01   -9.744573029531335e-03   -3.730438750056377e-01   +1.013349407021741e-01   +6.024072678190528e-01   -1.122882300418663e-01   +4.300784598472320e-01   -1.045762546532295e-01   -3.689410730062154e-02; +1.104658591557126e-01   +7.203503492409097e-02   -5.680369021404420e-03   +4.349369878740068e-02   +2.139921220702050e-02   +6.788302786479210e-01   +1.000000000000000e+00   -8.636368488544419e-02   -1.096506114126746e-01   +4.387122451270989e-01   +2.900477284701878e-01   -3.649191147757982e-01   -2.878787764518944e-01   +7.581228182158360e-01   +2.384379846022924e-01   -1.799277858568515e-01; -1.669620430247946e-01   -4.177049092764361e-01   +2.185328145609934e-01   +1.004999916070833e-01   +2.495041102718256e-01   +2.102236194395953e-01   +2.093974892086910e-01   +1.952904027591272e-01   +2.901666653413665e-01   -1.503066648734890e-02   +9.944934491946171e-02   -3.922374797282016e-01   +2.264358603094629e-01   +9.812908871467817e-02   +3.522529514727554e-01   -1.404202314556287e-01; +2.252569396075318e-01   +5.594865839887575e-01   +1.396294187994299e-01   +5.248793142539305e-01   +1.667631605480938e-02   -3.623433735814652e-02   +8.490808095695335e-01   -1.060919821602225e-01   +2.692438124566551e-01   -1.638907122905517e-01   +3.469980893345502e-01   -1.517177897121728e-01   -2.524152268367329e-01   -1.402401281222005e-01   -1.300469950990258e-01   +4.492047506740278e-01; +1.245907428573313e-01   +3.599180094742419e-01   -4.030689807278785e-02   +2.856906648519342e-01   +3.866489991242701e-01   +2.099591533678201e-01   +3.447739090776460e-01   -3.295525428675036e-01   -2.182950933157431e-01   +2.174568245878959e-01   -3.718833974402982e-02   -1.771287041895130e-04   -2.857445848235184e-01   +5.783157792787420e-01   +6.561826013595956e-01   +3.247037126879070e-01; +2.859940834430661e-01   +4.626114037689302e-01   +3.863425936473155e-01   +4.652252056225049e-01   +2.067012929975922e-01   +4.697458118158636e-01   +4.703234145794748e-01   +1.233268203238242e-01   +4.651856559452264e-01   -2.677425784731390e-02   -1.872142149299535e-01   -1.556258889142404e-01   -5.953381215208439e-01   +1.993404370644370e-01   +2.398406858741529e-01   +3.812680366074674e-01];
L2I_L2E_iAMPA_netcon = [+4.615314085094088e-02   +5.146735052352855e-01   +3.152945700200716e-01   +6.343520209351129e-02   -4.384157321842537e-02   +5.441896611894151e-01   +1.634482557895170e-01   +5.978001189479506e-01; +5.994903040530773e-01   +1.140410694788861e-01   +6.088948055063459e-01   +6.359015043701862e-01   +3.384638225471581e-01   +4.877772626999236e-02   +9.985514865719050e-02   +1.399737427586527e-01; -1.195869173939257e-01   +3.201931835802614e-01   -1.939416396576248e-01   +1.879237160285502e-01   +2.788276909637766e-02   -2.220097457753672e-02   +2.801816475285019e-01   +2.124552245134398e-01; +3.159998040240938e-01   +7.146051458869915e-02   -3.437118806897655e-01   +2.368778291410523e-01   +5.555620063580116e-01   -2.160794744355570e-01   +4.744605628979891e-01   +1.942429419141200e-01; +3.813615219991502e-01   -1.037274066688326e-01   +1.887881762141971e-01   +5.272365263943699e-01   +5.695781647720229e-01   -1.499485792817279e-01   +4.280759994138826e-01   +2.344533146258715e-02; +5.286987992615093e-01   +1.863561762868788e-01   -1.626538283879316e-01   +5.552444042577048e-01   -6.963458871489203e-02   +1.539438475539433e-01   +3.387662341511780e-01   +7.288712964337057e-03; +4.089566082180953e-01   -4.944209427443949e-01   +3.157599261922935e-01   +5.227829584748904e-01   +2.265074280061740e-01   -2.416571632501385e-01   +8.012345496439284e-01   -2.437075573044025e-01; +2.746589020256182e-01   -1.142929225903571e-01   -5.196708340774780e-01   +2.783973825267871e-01   +8.706183578170229e-02   -2.031518564879109e-01   -5.311332934896575e-02   +7.309120332406558e-01];
L2E_L2I_iGABA_netcon = [+4.354317664308545e-02   +3.601608826088170e-01   +2.808217353818375e-01   -5.621290731790921e-01   -3.211870882164352e-01   -5.229520293593332e-03   -2.969389012651799e-01   +5.643061776480401e-01; +1.568164249722236e-01   +2.492853371250943e-01   +6.164206935769879e-02   +8.411177964522396e-01   +6.535260959353262e-01   +1.593205336832251e-01   -5.065861835171795e-01   +2.353849028797111e-01; +3.128509850646670e-01   +8.192277656091900e-01   -3.993205477233257e-01   -4.150327393661419e-01   +1.762893280503786e-01   +7.727173844350588e-01   +2.778222154419902e-01   +1.417993517196747e-01; +9.356460364286520e-02   +5.931854313797303e-01   +9.239067502194269e-03   +6.684153700001849e-01   +8.267270379220205e-01   -4.392080788539341e-01   -2.354214876089569e-01   -6.678995564633741e-02; -1.413456499744874e-01   -2.993557117037825e-01   -1.696552321463451e-01   +2.736370760382124e-01   +7.667105970954406e-01   +5.167146726528151e-01   +1.459987431890486e-01   +1.772602031981570e-01; +7.654651970294608e-01   +5.454294609549899e-01   +3.193562185085467e-01   +5.707791237221538e-01   +5.462534489437141e-01   -4.670282862413080e-01   +4.201342400024760e-01   -3.168881266917548e-01; +2.798738911846413e-01   +3.505525767820231e-02   -3.810224135768234e-01   +4.373618305316844e-02   +2.129640038170358e-01   -5.210682020329102e-01   +3.950677762294724e-03   +7.466478990152656e-01; +7.448086568255266e-02   +5.357247566395817e-01   +5.179324992188463e-01   +1.576852364913333e-01   +2.287527975940389e-01   +5.373199333478862e-01   +4.278277266019014e-01   +7.194389942779923e-01];
L3E_L2E_iAMPA_netcon = [+4.947506048498596e-01   -1.468087000083308e-01   -1.958716179021931e-01   +2.601525500761426e-01   +4.562001298922109e-01   +5.208611201089387e-01   -1.708130080818955e-01   +5.728846601504632e-01   +3.622214537638127e-01   +2.161095664893046e-01   +2.036124417197896e-01   -5.594489499327800e-01; +4.293021908015671e-03   +3.081538334524669e-01   +1.975146674018113e-01   -1.601707488083352e-01   -2.347768807789021e-02   -6.559784478298436e-02   -3.510834639409944e-01   +9.964015821708810e-02   +2.541758279005399e-01   +1.689744973967040e-01   -2.741740468902057e-01   +5.640895399918361e-01; -5.456478946381375e-01   -4.774989797409951e-01   +4.412652164587241e-01   +3.879671190432951e-01   +2.851533070110361e-01   +1.546897546355537e-02   +1.251524044978520e-01   +3.111260730303865e-01   +6.271757444170580e-01   -4.983819160238295e-01   +9.864409626375001e-01   +3.488237466835018e-01; +3.422915036873851e-01   +1.628782377846340e-01   +2.648995185255307e-01   +5.867442429081973e-02   +3.883797232530093e-01   +1.623884639644540e-01   -3.549426354851393e-03   +5.992225578257743e-01   +1.617173451945946e-01   -2.239217397287751e-01   -2.116054695294667e-01   +5.865038309286125e-01; +1.062057087644842e-01   +3.776523464636620e-01   +2.376655613792545e-01   +5.156428486479393e-01   +5.374993580195895e-01   +5.856352419412960e-01   -3.238807488998044e-02   +1.448241768974941e-01   -8.221821603037613e-02   +4.195074683358779e-01   +4.248959244452519e-01   +4.644531734196423e-01; +4.762158565336785e-01   -1.826396017458524e-01   +7.433132391327611e-02   +1.540944634339250e-02   +4.259305546343839e-01   +5.860277214079100e-01   -4.262221939501458e-01   -2.366034864013835e-01   +1.089552389697181e-01   +2.582500445029012e-01   -1.660841589945473e-01   -3.640861809120262e-01; +2.433028778837835e-01   +1.633752175773478e-01   +2.520358804950640e-01   -1.158950752887145e-01   +2.284770473170372e-01   +2.504555378100977e-01   +1.498613140265242e-01   +3.900156145528269e-01   +8.330206674425568e-02   +4.304288162601688e-01   -1.335527011280002e-01   +4.018945600871409e-01; -5.516561107425037e-02   +6.277147234547225e-01   +1.404738252485052e-01   -7.051902071470056e-01   +5.544325396012542e-01   -2.426892403802550e-01   -4.660139432475683e-01   -2.467264381201172e-01   +2.296667914045517e-01   +1.969664903927024e-01   +9.019047917446876e-02   -7.837016840587994e-02];
L3I_L2I_iGABA_netcon = [+9.273763652842398e-01   +6.610474915230110e-01   -4.137965059285969e-02   +4.575363510896446e-01   -4.116999221924553e-01   -2.823306059132943e-02   +1.000000000000000e+00   +5.975844246770592e-01   +5.283301699002555e-01   +8.331495749242683e-02   +1.674875670345168e-01   +4.145853295682977e-02; +8.492017454070629e-02   +9.987863240503783e-02   +1.875672961017807e-01   -3.987793250844705e-01   +5.542714350170814e-01   +6.900245629966950e-02   +6.266967562633788e-02   +1.093992941871535e-01   +1.110725709251474e-02   -1.267771607116249e-01   +7.400115803409654e-02   +6.083404922464692e-03; -1.349499560141499e-02   +1.918125600513248e-01   +1.387904332797857e-01   -1.804243005196686e-01   -4.714849130284094e-03   +3.194172883100469e-01   +2.664259889420255e-01   +1.747453290998482e-01   +2.456378757556780e-01   -5.852698175600638e-02   -1.621147021534290e-02   +8.095678937204797e-01; +4.317080666677845e-01   +1.128978923053340e-01   +6.932316738531195e-01   +2.254875569681398e-02   +2.557282769550679e-01   -2.117093097600055e-01   +2.280628676677663e-01   -2.959154209970915e-02   +3.613401909114967e-01   +5.469080910783650e-01   +5.503617555743744e-01   -1.036603016654500e-01; +4.942022005911031e-01   +2.937814310072098e-01   +1.111943469131536e-01   -1.904560327556573e-02   +4.672646641459549e-01   +6.010483755102480e-01   +2.853128672239469e-02   +6.240238769164593e-01   +6.258693822848093e-01   +1.485314874667646e-01   +2.824901578271692e-01   +4.936548014220468e-02; +8.377835866431706e-03   +4.080645049187167e-01   +6.234710654800323e-01   -1.305207084233600e-01   +2.274736427620989e-01   +2.331765292152040e-01   +5.635449948446336e-02   -2.138242419961227e-01   +4.578632145440856e-01   +3.719555913655030e-01   -4.054047461327010e-01   +2.609373691851119e-02; +4.398186126990649e-01   -8.129376932612177e-03   +4.182257087069879e-01   +1.990002335805059e-01   +5.619137051544566e-01   +6.822202797701715e-01   +3.733251173175582e-01   +1.727514042576417e-01   -6.189727857861238e-01   +4.837138406730327e-01   +1.116386955107486e-01   -3.084060776163041e-01; -1.035559395105387e-02   +2.224050040769578e-02   +5.000526501003131e-01   +1.967709853726689e-01   -8.653361180012566e-02   +3.893876160942035e-01   +6.071724194926783e-01   +5.636208696868351e-01   +4.497076868704071e-01   +2.364351869568957e-01   +9.378067603789479e-02   +1.935200825682967e-01];
L2E_L3E_iAMPA_netcon = [+5.224619031239564e-01   +1.878614969190774e-01   +5.896825513869230e-01   -6.446558893166601e-01   +1.218429331454097e-01   +5.949327267304231e-01   +6.237251452752002e-01   +6.384200177131437e-01; +1.183295064957756e-01   -2.474311584914563e-02   +1.010615181753948e-01   +4.346796252527543e-01   +4.753165618435198e-01   -2.322664331948481e-01   -4.417184420293830e-01   -5.616146711807160e-01; -1.342823933456549e-01   +6.895275583332638e-03   +1.450776311368716e-01   +2.317528475781788e-01   +3.374002925820241e-01   +8.026536923592151e-02   +2.326298124219668e-01   -1.850499152209115e-02; +3.007135378132104e-01   +3.367614541675957e-01   +8.449650207381643e-01   +8.909178512487045e-01   +1.485850220325404e-01   +5.248931114392366e-01   -2.397877188606861e-01   -5.647267211106944e-01; +5.204242885269504e-02   +2.914329388644745e-01   +2.321478251583791e-01   +6.019067435368376e-01   +2.566821032233733e-02   +1.389109657117872e-01   -2.922073252414671e-02   -2.631048160983839e-01; +1.793626751952249e-01   +4.135130044159325e-01   +5.185850312126602e-01   +5.494838717019950e-01   +2.148071480853657e-01   +1.513859507711168e-01   -8.281748219714290e-02   +2.817685266629875e-01; +2.437699860920706e-01   +8.966133321396168e-01   +5.219359649709000e-01   -2.171905109379484e-01   +2.673183394147666e-01   +7.243604708846087e-02   +2.256543420606785e-01   -2.729615797048487e-02; +3.736767719701194e-01   +2.981244411691714e-01   +6.411893712615820e-02   +3.110654569587101e-01   -2.933082185786826e-01   +3.557771247171310e-02   +4.591113817976324e-02   +5.022870828433247e-01; +9.170967331725002e-02   +5.213382678753625e-01   +5.741152832485967e-01   +6.123151593704722e-01   +4.319964656362610e-02   +1.128926958820189e-03   +7.617950754786287e-01   -3.119403139818799e-01; -1.606158848902932e-01   +1.811348816235399e-02   +2.604475597328907e-01   +4.182203568959802e-02   +1.495654149093916e-01   -3.516441718762189e-01   +3.549267842644316e-01   -8.205719313046905e-02; +3.778529057132524e-01   +3.296184671623665e-01   -1.758203220002423e-01   +8.140960339983372e-01   +1.346788574961084e-01   +6.715145937996747e-01   -4.011920013200500e-01   +1.924137680433600e-01; -2.857087608136607e-01   +6.139625580888026e-01   +4.204769585880135e-01   +2.423954875276913e-01   +9.569433243147270e-02   +7.946753244417609e-02   +4.614771064057692e-02   +2.232406953959343e-01];
L2I_L3I_iGABA_netcon = [-1.592418019646815e-01   +1.208241124874787e-01   +2.582718545540679e-01   +1.902278252632950e-01   +3.271110068363659e-01   +6.890027496873435e-01   +4.189811640708820e-01   -4.384508494908295e-02; -3.300716216227887e-01   +1.583212171478245e-01   +2.890505248641742e-02   -3.550998768884846e-03   -9.570888428326136e-03   -4.429059345648722e-01   +5.263768501061290e-01   +7.921041795186190e-02; +3.001030821513049e-01   +1.000000000000000e+00   -5.300904245120583e-02   +3.357180238404067e-01   +1.356088761974937e-01   +6.756189944951927e-01   -9.595263580238020e-02   +6.393312686827486e-02; -1.232107879166518e-01   -5.195102768888996e-02   +9.398129003891338e-01   -2.461363134236576e-01   +1.193320104783155e-01   +5.194375440235042e-01   +4.104828923041634e-01   +1.895889972972419e-01; +2.135825803076766e-01   +3.106907707422223e-01   +3.774034303180356e-01   +3.363860650822898e-01   +1.710388994379629e-01   +2.528466077643238e-01   +3.204149105593169e-01   -3.158864514254674e-03; +1.595686660022432e-01   +4.118563930621035e-01   +3.931951943956928e-01   +6.898829290124353e-02   +3.904853170007415e-01   +6.336079465754813e-01   -2.404237848667801e-01   -1.602912834015485e-03; +1.391114531813254e-01   +5.822662255044683e-01   +2.670133476485390e-01   +2.515467865326613e-01   -6.030945226184885e-02   +1.530015264343510e-01   +9.491668157507135e-01   +5.001493346998657e-01; -2.863784495563211e-01   +4.252592507925034e-01   +3.634053370088463e-01   -2.980728688161685e-02   -1.469816037336548e-02   +4.693180656017630e-01   +2.100078740233087e-01   +4.815285170470005e-01; -2.363138835435838e-01   +6.437178949942510e-01   +6.709108827881064e-01   -1.952687030809487e-03   +1.603542418430754e-01   +2.805088146572569e-02   +3.553855887515145e-01   +3.199265681521398e-01; -8.894179000197509e-02   -1.772869284061009e-01   +1.217238998979075e-01   -1.903161761130460e-01   +2.432313303510519e-01   +5.806726809587257e-01   +2.229759017369944e-01   +2.586019329876291e-02; +5.063509620163357e-01   +2.017203514880772e-01   -3.943467144527857e-01   +2.813185864255078e-01   +8.779689767336056e-02   -2.514222519211905e-01   +2.294191017798489e-01   +4.707295160903653e-01; -4.262186621654799e-01   +4.730436816542460e-01   -1.420145016109481e-01   +5.251401674180672e-01   +2.974312339296292e-01   +3.144348671368947e-01   +6.877352492344255e-02   -3.551010524329758e-01];
L3I_L3E_iAMPA_netcon = [-9.374770167625140e-03   -2.279067197212904e-01   +5.194709163010700e-01   +2.542070242090056e-01   -1.019534492759271e-01   +9.340160646070163e-03   +1.197720249703667e-01   +5.144974350389981e-01   +4.433816130662502e-01   +6.104301902884511e-01   +3.325271725164422e-02   +4.414737051287757e-01; +3.295525317962265e-01   -8.002149735449308e-02   +4.534956931846672e-01   +7.045544017727294e-01   +4.291082765675472e-01   -1.680327784548318e-01   +3.783245786166691e-01   +6.059849426147438e-01   +4.451517038390351e-01   +4.629338738897353e-01   -2.226467782446997e-01   -2.402389996517631e-01; +1.896394137631957e-01   +7.241802545424926e-01   +1.491871346679042e-01   -1.937485450217963e-02   +9.198554063785812e-01   +4.766117683044245e-01   +4.251961097604882e-01   -1.661836607155928e-01   +2.539304600221863e-01   +2.553864264622281e-01   -6.399975568493553e-02   +1.328016508507179e-01; +1.968593197523497e-01   +2.629897009199709e-01   +3.884507346821337e-01   -1.303907516151206e-01   +2.503262360387300e-02   +2.884106196881823e-01   +8.383630025428968e-03   +2.584790630037829e-01   -6.069453832206741e-02   +1.412355561630375e-01   -5.698519995440302e-02   +1.551112634718019e-01; +1.188245746069838e-01   +3.021292724467374e-01   +8.639796623226030e-01   +4.941032031979943e-01   -1.179051171693676e-01   -9.882054468939076e-02   -5.738822098433159e-02   +4.684320932983706e-01   +3.058750665141385e-01   +2.167998495990515e-01   +3.261977851209677e-01   +8.579046955685679e-02; +1.297336662639462e-01   -1.120254637218066e-01   -4.796070742792952e-02   +1.376922159090845e-01   +6.725158154589186e-02   -1.620015836444911e-01   +3.525447630403916e-01   -2.728682568232700e-02   +4.260980810339595e-01   +1.913948585301092e-01   +5.579023677167833e-02   +7.747393893740212e-01; +2.039958215527557e-01   -8.882261681483158e-02   -3.967861932659766e-01   -1.062616453862313e-01   +1.571583603112896e-01   +8.256592515176538e-02   +5.028313920495471e-01   -5.977420623619958e-03   +2.419684236250678e-01   -1.049064031808950e-01   +3.802124161573747e-01   -2.453201397605528e-02; -1.962837254154480e-02   +1.556587312605809e-01   -2.637409107879169e-01   +5.877905463348515e-02   +4.725081982534188e-01   +4.434685720490720e-01   -2.433258590777951e-01   +6.767753069863179e-03   -4.550372058788201e-01   -3.585873503506241e-01   -2.526387620041544e-02   +3.197285394188882e-01; -4.290718498830126e-01   +6.830143941126052e-01   +1.703108921223578e-02   +4.714086227201686e-01   +2.175236896339076e-01   +4.150976837249351e-01   +3.881186466556088e-01   +4.347290398511078e-01   +1.432670053136578e-01   +8.267624945902888e-02   +3.746839312970643e-02   +6.579525629749379e-01; +8.228532979079151e-01   -4.714014976615550e-01   +7.976486161007832e-01   +1.161594525793461e-01   -1.692011895853920e-01   -1.717670852815746e-01   +1.769173499767432e-01   +2.829828473404971e-01   -1.045345046997403e-01   -2.829638820275082e-02   +7.226415350961642e-01   -2.261730336560704e-01; -3.978544651007827e-01   +4.410945889595597e-01   +6.130492778757364e-01   +2.509136688271905e-01   +1.867640024955598e-01   -2.559419308920627e-02   +3.346664913482381e-01   +1.354916210665437e-01   +5.167479088936270e-01   +5.380342906413103e-02   -1.505865946907561e-01   +5.132852008672828e-01; +1.884520251293801e-01   +1.487607826930223e-01   +1.945962906635263e-01   +5.476922262816618e-01   -2.994744788091934e-01   -2.589340897081196e-01   -3.528813968445206e-01   +3.846011505182422e-01   +1.427794516751689e-01   -2.080553644993454e-01   +3.275787506351474e-01   -5.500548559809533e-02];
L3E_L3I_iGABA_netcon = [-5.844923758200618e-02   +1.605256600041546e-01   +3.726660172339810e-02   +3.345412855702026e-01   +1.143590300384353e-01   -1.937309961892106e-01   -1.295559315521060e-01   +5.084619255047695e-02   -1.040107149482668e-01   +6.008114817146281e-01   +2.867211733288657e-01   +8.256472002442787e-02; +2.479130949825070e-01   +3.026046563330884e-01   +3.624331503586224e-01   +3.038991903036837e-01   +6.983606089727742e-01   +8.384200690107130e-02   +1.626008273456936e-01   +1.274733574051296e-01   -6.376293984338708e-01   +9.214186070876262e-02   -6.250020386525343e-01   +1.800672245116934e-02; -1.895836919716606e-01   -8.849862032462722e-03   -2.812040292018673e-01   +7.013786487469771e-02   +6.799024524675812e-02   +5.335161790207284e-02   +3.394240900793059e-01   +6.132277850292246e-02   -1.080224421430554e-01   +2.140845743032383e-01   -1.077372567746885e-01   +1.352640227514983e-01; +2.716712603417939e-01   +6.954798541835763e-02   -5.237710757395301e-01   +7.289709047661044e-01   +7.625351897534215e-01   -1.260241694283590e-01   -7.337047955102691e-03   +5.757975563222292e-02   +7.140460319601194e-01   +5.073966099482008e-01   +2.210971169601431e-01   -3.283712305350451e-01; +2.034355183662353e-01   +2.197211455368033e-01   -1.213677651410408e-01   +1.695034614007536e-01   -2.183758526457524e-04   -7.729095889262944e-02   +2.747917700662864e-01   +5.124081622568092e-01   -2.941136565248065e-01   +4.523182633243087e-01   +4.267838251981605e-01   -1.337827908672721e-02; +1.978290743381914e-01   -4.315484266726448e-01   -4.759640129651951e-02   -3.030777814257835e-02   +1.356584044448945e-01   +5.375593964983316e-02   +2.243664529075314e-01   -3.023702543284406e-02   +3.247359428223753e-01   +2.678340636197274e-01   -1.749291418658446e-01   -2.336806033465190e-02; +2.962049642654532e-02   +1.911600999081668e-01   +1.197289522228334e-01   +7.650242730371493e-01   +9.269578904289169e-02   +1.805306442869302e-01   +3.821422280265988e-01   +5.275556720336154e-01   +2.463983330994162e-02   +3.196821965245332e-01   +3.358414832515227e-01   +2.947943469685463e-01; +2.984592495975376e-02   +3.781741270530667e-01   +3.545587171574636e-01   +3.105474995123615e-01   +4.032997747508986e-02   -3.097291157685276e-01   -4.272272532119911e-01   +5.270607762728081e-01   -1.396574862789619e-01   -1.988821229965317e-01   +3.206995096893892e-01   +4.861335758189856e-01; +5.752719490675937e-01   -4.340368401935565e-03   +3.480469221977952e-01   -9.722670844338988e-02   +2.672618289882391e-01   -8.415301690723347e-02   -6.655313204546195e-01   -2.154529808224588e-01   +4.804221547797549e-01   +3.540774650936347e-01   +1.953358177281702e-01   +3.885180963146435e-01; +2.238483470081084e-01   +1.144609817044352e-01   +2.939627146750369e-01   -5.569603150035016e-02   -6.083477380167751e-01   -9.632087095958611e-02   -2.649136359493444e-01   +1.733125745367694e-01   -2.125146689752048e-01   +6.843842561788327e-02   +1.261306028306960e-01   +2.568981986753480e-01; +1.277333234367449e-01   +4.807516866323663e-03   +2.362020122162354e-01   -1.193112052315671e-01   +1.237692833493792e-01   +1.713019246120949e-02   +2.989643160141067e-01   -1.098308586870141e-01   -3.087261685278831e-01   -3.050383998582994e-02   +9.570492580422127e-03   +2.648250768902187e-01; -6.615457872006245e-02   +3.014101988865747e-02   -4.954395869228416e-01   -1.257982742147615e-01   +8.786761704786240e-01   +2.930563706340041e-01   +4.090745859051060e-01   +2.730636886094903e-01   -2.806989174797685e-02   -4.148584823693676e-01   +2.584959692779226e-01   -3.640899584247465e-01];
L2E_Input1_iAMPA_netcon = [+9.393629071747688e-01   +9.770895009005008e-01   +5.301583910985379e-01   +5.902349482843454e-01   +6.112258797320677e-01   +4.260118757820646e-01   +8.471479545915961e-01   +6.498873866995032e-01];
L2I_Input2_iAMPA_netcon = [+5.434126732682281e-01   +6.253027699519973e-01   +6.303763074289308e-01   +2.879094091528384e-01   +7.758366076854623e-02   +9.358692970856214e-01   -9.687439889174221e-02   +1.570909517522406e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
