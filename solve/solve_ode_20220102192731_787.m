function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.685046275415382e-01   -5.134095906298931e-02   +7.350925706760509e-01   +3.296252256716883e-01   +1.530616311407486e-01   +5.889489159182285e-01   -3.664970491274365e-01   +4.792663049336053e-01   +3.342567569025132e-01   +8.437771487305492e-01   +1.429149457199618e-01   +5.809862013785523e-02   +2.563954396446452e-01   +4.161456270930002e-01   -8.215994928530068e-02   +6.273006019189072e-02; +2.403527633227717e-01   +3.348490897645424e-01   +1.201475754767825e-01   +9.295444071778510e-01   +2.442191342379881e-01   +2.288979417145445e-01   -3.909535960301091e-02   +6.300735865417517e-01   +7.138234852452827e-01   +5.304165648217898e-01   +7.044240983734933e-01   +5.623609679714494e-01   +1.878855082178182e-01   +6.381736895078320e-01   +2.999120673384839e-01   +9.215099717915898e-03; +7.924606354128838e-01   +1.557990335120817e-01   +1.418522062844610e-01   +2.294583593562845e-01   +2.586094000377089e-01   +1.802058520141156e-01   +7.414819452741415e-01   +3.492990923678482e-01   +3.633310900321639e-01   +5.648061277666778e-01   +2.877394743780557e-01   -8.150951190548819e-02   +1.156047860558461e-01   -2.980046742576664e-01   +3.712817210105140e-01   +3.154749412420429e-01; +4.018672334558434e-01   -1.432604290091779e-01   +1.205015027092301e-01   +4.786159114617639e-01   +2.423660358057385e-01   +1.751150312088536e-01   +9.291314925728664e-01   +9.413354000871538e-01   +4.303944046236153e-01   +2.573176579090519e-01   +4.161943324459560e-01   +6.856119595493696e-01   +4.811535688009319e-01   +3.586719609736835e-01   +1.941566449468473e-01   +4.080279196225308e-01; +8.372968487061029e-01   +7.087551834462365e-02   +6.646429864316500e-01   +9.532235613847564e-01   +3.294738089684383e-02   +3.717790300911727e-01   +6.900781166491052e-02   +6.287625964755233e-01   +3.181105468235939e-01   +6.459550529030477e-01   +5.975877520451309e-01   +1.589527801395234e-01   +1.607341878874134e-01   +2.830079510716044e-01   +6.282228746900367e-01   +2.459452644195881e-01; +1.126447232578665e-01   +5.351416413798371e-01   +3.434692386635961e-01   +1.773151168705772e-01   +8.586696641199237e-01   +3.815363977386465e-01   +9.501768989430631e-01   +2.615595234301085e-01   +3.280858623688589e-01   +1.733244542673203e-01   +4.819570374828493e-01   +1.722571747425555e-01   +5.954003798314612e-01   +2.247347711260150e-01   +1.276605339986880e-01   -1.072293112779791e-01; +4.583279159432150e-01   +4.516919868961071e-01   +3.622164721856483e-01   +1.679394196826959e-01   +3.386422953857292e-01   +3.254740883459568e-01   +3.682167002795660e-02   +3.820051282072059e-02   +8.415347448579293e-01   +3.784924246005439e-01   +2.084966620924496e-01   +4.319920428830146e-01   +1.931210220808821e-01   +4.921565745146647e-01   +6.939829414679378e-01   +4.654097045976627e-01; +3.888945075074756e-01   +6.001290191068894e-01   -8.939808349440664e-03   +9.263842789452429e-01   -1.018757457652820e-01   -1.807912631117604e-01   +5.507554311420425e-01   +6.223242559699792e-01   +6.976078241175779e-01   +3.619837182727317e-01   +3.472115334024515e-01   +4.727096501634518e-01   +3.614596443374646e-01   +2.854339064670421e-01   +7.779143288872844e-01   +6.392450235343264e-01; -1.896079077755872e-02   +6.473106007924102e-01   -1.322494431004800e-01   +4.985521897700427e-01   +3.683311641417398e-01   +6.663336014955591e-01   +6.247701769643486e-01   -1.192780268165426e-02   +2.380745578169132e-01   +3.525368817421459e-01   +6.816200283259688e-01   -1.320371402257035e-01   +5.103553068657288e-01   +3.868643755542470e-01   -1.619158758683711e-01   -8.729392440324206e-02; +1.929731057971951e-01   +2.257929148788566e-01   +7.491160297526965e-01   +6.157722659741716e-01   +5.943977050456095e-01   +4.218488521120747e-01   +4.157810380606061e-01   +6.117741670548745e-01   +5.596027375230993e-02   +3.364748216135328e-01   +2.834188920809436e-01   +3.878154313591132e-01   +7.998810501282405e-01   -5.156040417971513e-02   +3.525782836240288e-01   +6.223161651229538e-01; +3.055558879733189e-04   +6.081930035960409e-01   +4.064071264751087e-01   +2.534969927098865e-01   +8.603013195906799e-01   +6.174742988859272e-01   +5.530027374886496e-01   +2.444891711816800e-01   +3.086333369862322e-01   +4.341822858590857e-01   +3.328265156829185e-01   +5.263751025441704e-01   +3.316041969296402e-02   +5.324667916229444e-01   +5.848735410795255e-01   +5.316446654646240e-01; +6.599725695735003e-01   +1.428012097371865e-01   +4.809067192569443e-02   +1.054195089703083e-01   +3.235174051231171e-01   +7.650190598131951e-01   +2.766781588211809e-01   +4.471587452414389e-01   +8.847309070709201e-01   -2.804418693611398e-01   +8.561818518007573e-02   +4.897990789771213e-01   +7.845047580219053e-02   +2.931797695953928e-01   -3.862859758495654e-02   +5.493371945719543e-01; -3.122771080798107e-01   +2.304313963285982e-01   +5.770697163038488e-01   +5.375858262204458e-01   +7.740178867911606e-01   +4.599334082768741e-01   +1.381234034734621e-01   +4.761456796759402e-01   +8.384587908618794e-01   +7.112696647006409e-01   +2.478743751144915e-01   +1.195909886720587e-01   -6.429332818310889e-02   +1.689453643661900e-01   +3.500273187523009e-01   +2.940786842524705e-01; +3.886428087459255e-01   +5.193096325001836e-01   +4.099349177509372e-01   +1.401893966332809e-01   +1.235242256890885e-01   +4.705558018725517e-01   +3.840648606653494e-01   +5.459052074094793e-01   -2.380353922647354e-02   +1.975035306274919e-01   +6.517075723245644e-01   +5.104130660027395e-01   +5.554394869089002e-01   +3.605163055576953e-01   +5.194160533200985e-01   +2.383316109722917e-01; +5.660795588312407e-01   +4.973720184202802e-02   +5.067952266663343e-01   +7.758938464037378e-01   +1.090461059728388e-01   +3.740304095696974e-01   +4.686083458641588e-01   +1.749605038000772e-01   +1.609605662762855e-01   +2.144005193811465e-01   +1.918705878905436e-01   +5.600321876880524e-01   +6.006591590732969e-01   +4.126447683673418e-01   +4.241168749875732e-01   -1.062675067868363e-02; -9.710401465849557e-02   +3.046055546244188e-01   +6.234638315439123e-01   +6.428846331789605e-01   +7.744763077049303e-01   +7.339700785239421e-01   -9.283485792809149e-02   +8.052604539621053e-01   -1.430208458289259e-01   +6.666697776442566e-01   +4.313337295144823e-01   +3.996112682454256e-01   +1.635548695243972e-01   +7.722564619524572e-01   +5.984777389247721e-01   +1.341606152163489e-01];
L1E_L1I_iGABA_netcon = [+6.436107932745407e-01   +6.182683770913873e-01   +3.328456021443165e-01   +4.198021791027531e-01   +2.398065572827347e-01   +5.313724879784076e-02   +3.287562515634223e-01   +3.708156936535376e-01   +1.068184524289670e-01   -7.075648106660733e-02   +2.865657592572547e-01   +1.774107440210553e-01   +5.651312976273476e-01   +1.114536877528120e-01   -2.315765023889060e-01   +1.000000000000000e+00; -9.441852147879516e-04   +6.361177399859544e-02   +4.996438298538395e-01   +1.514739219553405e-02   +3.894288352857609e-01   +6.322804741537876e-01   +4.916444094648821e-01   +3.442216244448392e-01   +4.591714578817799e-01   -2.596352218998219e-02   +2.891465265202137e-01   -4.803068217891190e-02   +9.094367213688848e-01   +4.728458938037945e-01   -6.946787032010933e-02   -1.951850130042656e-01; +1.861912230254520e-01   +3.916469249411367e-01   +3.482006657161319e-01   +2.755126491201300e-01   +3.186847907216110e-01   +1.983794497493568e-01   +2.273127775462031e-01   -1.700467557176961e-01   +2.519336268044026e-01   +7.486616696486510e-01   +3.970893835646959e-01   +3.891563227775667e-01   +1.948533057770220e-01   -1.602547184388315e-01   +2.547564663821980e-01   +5.635212099922522e-01; +6.383934004456719e-01   +1.060676538872712e-01   +1.109708354702307e-01   +4.728720493087815e-01   +1.117480290754201e-02   -1.128507064177761e-01   +2.237773788759654e-01   -7.068996219387470e-03   +2.273853562319527e-01   +1.185935200342406e-01   +7.863449050858563e-02   +8.177755435235516e-01   +1.137029242777274e-01   +4.257583293882195e-01   +1.858364965215545e-01   +2.665761527284213e-02; +2.184337609017246e-01   +3.564352151558919e-01   +8.490929090128359e-02   +1.233883395235244e-01   +5.313208746808435e-01   -3.543418290462794e-02   +2.190339755326597e-01   +5.708930949839397e-03   +3.427018044239934e-01   +2.388571963206267e-02   +2.008210347722690e-01   +2.296588937117337e-01   +3.959470817957448e-01   -1.573199792051783e-01   +1.184779031811821e-01   +4.592554875144951e-01; -1.236896656815632e-02   +3.605607365578694e-01   +6.666786081520149e-01   +2.724314863815196e-01   +4.956890102224508e-01   +3.956947073214545e-01   +9.434195492769526e-02   -5.261121884613339e-02   +2.213066052434694e-01   -8.503305257076524e-02   +2.669742797728022e-01   +4.659666891229693e-01   +1.746796228643735e-01   -2.853172046918973e-01   +3.909900958764033e-01   +4.702989903485020e-01; +3.840408398825998e-01   +8.869074048396080e-03   +1.645944527737503e-01   +2.108619439166301e-01   +4.310050403810491e-02   +3.449350932375964e-01   +1.594414737517472e-01   +1.929649423679740e-01   +1.558548438075254e-01   +2.482471507030362e-03   +4.026084154648532e-01   +3.523449258692807e-01   +5.421939612003120e-01   -3.187547558502652e-02   +1.618760799115896e-01   +1.072824775939076e-01; +2.959973489415205e-01   +5.069260147128719e-01   +8.526635223590061e-02   +5.271145663965936e-01   +2.124047796006100e-01   -1.290284676481392e-01   +1.302922024671139e-01   +4.470819760307979e-02   +7.206736981168474e-01   +7.192181394918772e-02   +3.075246258415673e-01   -5.434589786687917e-02   +3.458886731991389e-01   +2.363746578681818e-01   -3.024662211232201e-02   +4.913317243834893e-01; +4.079760574869866e-01   +1.878616763184451e-01   +3.328252570474691e-01   +1.898745762808766e-02   +7.602587335363682e-02   +7.058491151161774e-01   +2.790404861380772e-01   +9.854184568292702e-02   +4.776815506414688e-01   +4.397360492157762e-01   +2.835507019270181e-01   +3.770403963095448e-01   -5.572812682059201e-02   +3.549674376639532e-02   +5.202827812429952e-01   +4.744536117663988e-01; +1.188971754023940e-01   +5.313680893588549e-01   -1.888006120099708e-01   +4.461472977243723e-01   +5.487558608407157e-02   +4.961287982070811e-01   +3.802225176802891e-01   +2.377196503908748e-01   +4.294204239401961e-01   -1.667364768438973e-01   +1.104614634496101e-01   +4.611078157224995e-01   +3.718165761991288e-01   +6.647470434036938e-01   +1.229864342268703e-01   +5.451258838682321e-01; +2.377722779434388e-01   +1.054638793320203e-01   +1.745448952044133e-01   +2.177724507811569e-01   +2.907091470300675e-01   +3.842992220327945e-01   +3.561210457949419e-01   -2.342313489981910e-02   +4.822361920155491e-01   +2.043958214183997e-01   +4.233311102634976e-02   +4.213658862850565e-01   +3.012330597523087e-01   +1.299238808006592e-01   +2.805306612206219e-01   -6.286287465313750e-02; +5.098679507210555e-01   +2.181316569713227e-01   -7.495679227616001e-02   -3.383263984252668e-02   +3.255880676412181e-01   +2.234865211308295e-01   +3.959423357772219e-01   +5.893304238436866e-01   -5.877564285732458e-02   +1.797802674462791e-01   +4.766992301602205e-01   +7.477810485571897e-01   -1.918855117595731e-02   +1.397534671352454e-01   +2.221647219012879e-01   +3.259280411688814e-01; +6.091533823579267e-01   +4.173417289135015e-01   +1.394877589212323e-01   +5.937092627849634e-01   +6.720840682780217e-02   +1.311916091112738e-01   +2.332789750619078e-01   +2.772337875142193e-01   +1.583202455488925e-01   -8.231247295514842e-02   +4.461620842879462e-01   +1.082698816999016e-01   -2.826670632399456e-02   +2.292103978308322e-01   +5.346478031558606e-01   +1.079632828756327e-01; +5.548644797667172e-01   +4.065341882841879e-01   +3.834793167240706e-01   +2.999143274850769e-01   +1.578051606878902e-01   +4.002347999418205e-01   +5.114531800549621e-01   +1.264868753727939e-01   +5.919289452266818e-01   +1.887292471708978e-01   +4.404880694051101e-01   +3.795668892670797e-02   +1.998603328662453e-01   +7.926604993789960e-03   +2.817838887641183e-01   +1.983229996116401e-01; +6.980742405951642e-01   +1.531660311581557e-01   +3.095653614917248e-01   +1.740618773167133e-01   -3.915038779497879e-03   +2.619619009451572e-01   +5.151773117066277e-02   +3.432829334719338e-01   +2.303906326769818e-01   +3.078400281880316e-01   +6.717342742903022e-01   +1.568549638249616e-01   -1.095032028659543e-01   +1.080673319429169e-02   +3.502754530398439e-01   +4.023492392288004e-01; +3.373425011788008e-01   +4.252722223873953e-03   +5.194101664457438e-01   +8.321418929181598e-02   +5.451258360331094e-01   +4.348986013650961e-01   +3.716785746760156e-01   +3.089664800668047e-01   +3.540169077112603e-02   +2.627168838412207e-01   +5.885021349394016e-02   +3.903575272309481e-01   +4.225728361711724e-01   +3.312139098316650e-01   +2.073310501545462e-01   +4.414098415077139e-01];
L2I_L1I_iGABA_netcon = [+3.684735851902202e-01   +7.979588993705286e-02   +4.812716271739917e-01   +4.085215738230683e-01   +8.223654522550139e-02   +6.539631141620306e-02   -7.186357827509543e-02   +3.238152360577983e-01; +5.322488478582897e-01   +9.846002943923354e-01   +2.424057656582561e-01   +3.744946306039201e-01   +6.275842297627531e-01   +2.441135632288623e-01   +6.513776571790478e-01   -6.574962834607247e-02; +3.356326850251255e-01   +4.160872009406872e-01   +6.352016986691339e-01   +2.173033140320647e-01   +7.517658174507806e-01   -2.635010685909516e-02   +1.865186147119795e-01   -1.913073889303157e-01; +6.464529129002176e-01   +2.518213297516476e-01   +1.060570774784785e-01   -2.318075094009713e-02   +8.280707618225147e-01   +4.041912165340200e-01   +4.811407028905904e-01   +5.990463259421485e-01; +7.582858903857036e-02   +7.593023704718138e-01   +6.651297614902816e-01   +4.338369073661202e-01   +5.659600276211165e-01   -1.507014268397974e-01   +5.491923996763984e-01   +2.667023561261800e-01; +4.956644032476806e-01   +2.252748806501172e-01   +5.070841230143986e-01   +6.403122163490526e-01   +3.562157286556321e-01   +5.639087488989042e-01   +4.490212845161475e-01   +6.375484204108787e-01; +6.806453489573092e-01   +7.788356507996207e-01   +6.437506034113198e-01   -8.405797489832885e-02   +5.711193720692832e-01   +1.924910940643891e-01   +5.609573360501753e-01   +1.342181872132807e-01; +4.060956239203228e-01   +4.280127138219795e-01   +4.950519822518409e-01   +4.732188988277006e-02   +1.967706261453939e-01   +9.633785156358557e-02   +4.423759255990140e-01   +2.452463144234309e-01; +8.023285826916712e-01   +8.674150045927690e-01   +7.739954204677101e-02   +7.686976117537073e-01   -2.833527177871189e-01   +1.605068715539251e-01   +3.545851060355573e-01   +3.831174452938676e-01; -1.977665800046271e-01   +8.758287884376795e-02   +2.046280672117184e-01   +6.781606224008646e-01   +8.249133466643443e-01   +1.117814104422502e-01   +3.770850427175718e-01   +6.962792905024234e-01; +3.732915440929340e-01   +5.232535751002485e-01   +6.061017000569168e-01   +7.085222837554468e-01   +2.417041147750926e-01   -7.518290986197965e-02   +3.138566166608615e-01   +1.342596572370003e-01; +2.648153002761681e-01   +4.792350857679233e-01   +5.482909876733377e-01   +3.121020609254052e-01   -4.314088052514009e-02   +5.453294627031113e-01   +1.622008845082257e-01   +4.587620402062133e-01; +1.715297126853642e-01   +4.625524588630465e-01   +8.889158609607694e-01   -1.411437676153797e-01   -4.317144200406713e-02   -4.450148073433281e-02   -2.441631296245417e-01   -5.321167424956959e-02; +2.331699481946748e-01   +3.689786249295108e-01   +9.870666233610542e-02   -3.525416147081158e-01   +5.930890296888126e-01   +3.695162787420311e-01   +4.661164842706492e-01   +8.964661561164934e-02; +8.737720958430338e-01   +7.116414843374538e-01   +6.152423356741424e-01   +8.436316872081301e-01   +6.007777036710106e-01   +8.065417021809762e-01   +4.629131111265946e-01   +8.231376447450344e-01; +2.108513136925813e-02   +1.726153175286391e-01   +7.316937904432437e-01   +1.357028515581452e-01   +1.661273322242980e-01   +2.148692928173245e-01   +5.101594791362303e-01   +7.889738135315368e-01];
L1I_L2I_iGABA_netcon = [+4.806176058691449e-01   +4.917938168416781e-01   +9.806167225585694e-02   +6.242736698943174e-01   +2.592145199178042e-01   +2.987779293733444e-01   +5.249813752688288e-01   +4.270675474607056e-01   -3.052371177050948e-01   +6.738974499821423e-01   +1.608466783348652e-01   +6.832723503265352e-02   +4.320124919779463e-01   +3.250627013458633e-01   +3.144429347792446e-01   +2.480187147380128e-01; +2.498198557857865e-01   +4.143124448704932e-01   +1.583772410707805e-01   +2.344588394110582e-01   -1.509219529495109e-01   +5.076610418234062e-01   +7.314119737390636e-01   +1.871798506202042e-01   +4.756861841617699e-01   +4.702953242741074e-01   +3.311321906511231e-01   -6.037638488241659e-02   +3.163902530486835e-01   -2.280919328591884e-01   -6.504357302255631e-02   +5.387037468135235e-01; +2.650623894966195e-01   +1.658211522736355e-01   +5.172377441434688e-01   +3.902025247361504e-01   +2.686003216554471e-01   +5.872202050363767e-01   +2.543770923363309e-01   +6.896206781001845e-01   +6.945544605159337e-02   +1.142974396662500e-01   +1.226696507576082e-01   +3.987840352260055e-01   +3.017728079217162e-01   +5.341609089208297e-01   +4.050233136842470e-01   -1.285202407072036e-01; +3.325788693798495e-01   +2.773241484736781e-01   +8.218695267842195e-02   +1.127585326492410e-01   +5.575640143202860e-01   +2.112250111680804e-01   +4.024507986655825e-01   +6.439322659088548e-01   -4.351018165882734e-02   +3.822221279511884e-01   +2.454237875617237e-02   +1.069426634929146e-01   +4.962773415475499e-01   +6.662599713200450e-02   +4.281277665758285e-01   +1.374205450329252e-01; +3.484848480078622e-01   +1.019469418375851e-01   +4.524694332224095e-01   +5.004359762670118e-01   +1.676961992734143e-01   +9.614759180409691e-01   +5.944029933006110e-01   +2.077529355271605e-02   +2.221750655598738e-01   +1.740344015020355e-01   -3.167288045991726e-02   +5.308918074519698e-02   -1.915128498914792e-01   +4.646893984197293e-01   +4.427392172985424e-01   +6.183257704260923e-01; +3.241063071757010e-01   +3.835384555526307e-01   +5.089381819112317e-02   +8.045141227137036e-01   +2.082989947617645e-01   +4.443692617203686e-01   +3.562583245566522e-01   +2.349918342698905e-01   +1.512382274288102e-03   -2.670858961747306e-02   +4.278286378033073e-01   +5.532037143840540e-02   +5.330968059398576e-01   +6.624259799947843e-01   +2.237421204474538e-01   +3.485066596946911e-01; +5.946950125209030e-01   +6.219097446159773e-01   +2.858209094830034e-01   +5.381834880113947e-01   +4.618971166192246e-01   +2.235078126301945e-02   +5.569625105240786e-01   -5.315775270584994e-02   +8.140379215821553e-02   +4.687844414262075e-01   +2.513658021167816e-01   +2.265112034966245e-01   +1.084162891301898e-01   +3.364900491403872e-01   +1.699551336580299e-01   +5.236897477559230e-01; +5.565619044749943e-01   +2.537426421537694e-01   -2.623317017663166e-02   +3.814955831810606e-01   +5.452955965047083e-01   +6.038894432177728e-01   +3.448236206186760e-01   +1.846929556389031e-01   -1.121512306283467e-01   +2.538702912954499e-01   +7.964121192051230e-01   +5.165689979163494e-01   +6.815050923935649e-01   -6.953291263840161e-02   +4.938185616942478e-01   +7.701138843883824e-02];
L2E_L1E_iAMPA_netcon = [+5.434349251219758e-01   +3.066933777920451e-01   +1.053531895934658e-02   +3.222643497194461e-01   +4.017417978675480e-01   +2.544140191273365e-01   +2.136200876237166e-01   +2.929534138724561e-01; -1.022793856068749e-01   +5.174518860736339e-01   -6.256868882983711e-02   +2.350867827009763e-01   +1.060503496884816e-01   -1.244811459909171e-01   +2.220471450324504e-01   +4.310340559586279e-01; +2.631249544046760e-01   +5.655429689690135e-01   +4.677820463889181e-01   +2.418157709745827e-01   +2.209621801596251e-02   +5.535808656390819e-01   +4.990536034715359e-01   +4.275547816715235e-01; +3.666127650990933e-01   +1.234589568518157e-01   +2.983181928517323e-02   +5.824513308125300e-01   +3.831224385735629e-02   +9.412701111429850e-02   +1.797821195168819e-01   +2.074281119847154e-01; -1.153116611813608e-02   +3.446461670494090e-01   +2.189825284621836e-01   +1.505689994557093e-01   +7.054974161005112e-01   +5.701403855512330e-01   +1.000000000000000e+00   +6.306766249371796e-01; +4.009450898221326e-01   -9.195288457208850e-02   +5.757872350550459e-01   -1.641409358589645e-01   +4.807043173515566e-01   +4.143727449731663e-01   +7.298736915297033e-01   +3.240644117315663e-01; +2.149098621856436e-01   +3.992339540334512e-01   +5.079280852026320e-02   +7.497715790322519e-02   -1.491923999909141e-01   +1.415093533452371e-01   +7.616589070880174e-01   +3.988631873536980e-02; +1.226964572962004e-01   +4.449958886660744e-01   +5.991519249134754e-01   +9.604861747700703e-02   +4.212214275454305e-01   +2.942612521170003e-01   +4.446053162556319e-01   -1.636920674185225e-01; +5.915987548247748e-01   +1.606945519304691e-01   +2.658418324888732e-01   +7.452162923541834e-01   +5.387229550530345e-02   +5.718410475536591e-01   -2.138921550649726e-02   +4.924014085700122e-01; +4.084713424739820e-01   +5.866433611001275e-01   +4.193450834665275e-01   +4.257251505158791e-01   +3.428640133450966e-01   -4.050992461071439e-02   +3.206427171241665e-01   +4.491452025207570e-01; -5.448316860195917e-03   +5.913762370585943e-01   +2.261622656625925e-01   +3.043779055472107e-01   +4.374511272768029e-01   +3.623416631258338e-01   -2.201836081442334e-01   +4.115713357738229e-01; +1.941208081177063e-01   +2.394809781522375e-01   +5.413083517586936e-01   +5.562602644010590e-02   +3.057356802686572e-01   +1.860912584468970e-01   -4.825165262025387e-01   +3.301373052030873e-01; +1.543238482778119e-01   +3.900247798505984e-01   +1.427366733742229e-01   +5.347769929286335e-01   +2.955449115300077e-01   -8.406577284933769e-02   +5.339282883867220e-01   -1.200828679611821e-01; +1.894307780056002e-01   +2.555426996394120e-01   +8.344860239038736e-02   +4.514320751268768e-01   +1.390911633259112e-01   -1.353878357569634e-01   +4.433836871565009e-01   +3.128745274254958e-01; +1.386285008759543e-01   +3.380512134301609e-02   +7.372634690955858e-01   +4.003313385507510e-01   -1.030862659169009e-01   +5.873981490326143e-01   +1.881314953071899e-01   +8.961546314233552e-02; +4.069326223351870e-01   -7.626724726277337e-02   +2.299740972361299e-01   -6.779550204607483e-02   +5.915627709462724e-01   +2.271271240026248e-01   +2.923266109578130e-01   +5.481457463859741e-01];
L1E_L2E_iAMPA_netcon = [+1.607353801379709e-01   +2.577597918684799e-01   +4.930860834952121e-02   +4.468758331130488e-01   +1.214867917629489e-01   +2.234708253080410e-01   +3.610762472321291e-01   +2.664873462033499e-01   +5.502978126172444e-01   +4.282403256412482e-01   +5.823717001420022e-01   +7.518403043594969e-01   +6.902150174696126e-01   +2.980913280219125e-01   -1.287226599401508e-01   +1.777724004262739e-01; +4.567966838625294e-01   -1.263144222200838e-01   +2.097808062001149e-01   +3.242621200106683e-01   +3.373769482370934e-01   -4.276595879032504e-02   +1.407478663654001e-01   +3.237436471687481e-01   +1.676993717226770e-01   +3.276392186421656e-01   +3.452850271402743e-01   +6.880719002035878e-01   +3.383015716060942e-01   +2.306653680986111e-01   +3.099657633760166e-01   +2.598682260104086e-01; +6.926201687553549e-01   +3.213252991366852e-01   +4.674876110887434e-02   +1.148310650579268e-01   +4.783044101212664e-01   +4.353087686660029e-01   +1.018117059595850e-01   +7.713782208837923e-01   +4.619244599995634e-01   +2.374921533804016e-01   +3.516955145793474e-01   +4.000238590740555e-01   +7.734275303599822e-02   +5.185997331339590e-01   +2.921010747459995e-01   -1.654443132488286e-04; +3.007295716412812e-01   +5.447558407381922e-02   +8.269387605122476e-01   +6.455350978224125e-02   +1.288412108020428e-01   +1.345562831294011e-01   +1.000000000000000e+00   -1.721935451277812e-01   +3.713456429251054e-01   +4.104633186878210e-01   +6.646508011072511e-01   +1.737068655955491e-01   +1.041652034458174e-01   +3.002720527026795e-01   +4.973686037724585e-01   -3.005690243051846e-02; +2.249934448460391e-01   +1.371673512980209e-01   +8.837907121684481e-01   +4.360115462646821e-01   +4.381845161449897e-01   +6.971190717095364e-01   +4.745959284664387e-01   +3.287176284032958e-01   +8.043153671988829e-01   +3.450461452467470e-01   +7.013889829871707e-02   -1.388480054276224e-03   +4.962309943973582e-01   +5.292130603908675e-01   +8.347129718680507e-01   +1.194566379701342e-01; +3.473808782365795e-01   +6.862130247704490e-01   +2.297122824712290e-01   +4.268629246981532e-01   +1.679269716724749e-01   +1.118531873659445e-01   +6.056350482746329e-01   +3.399779595546093e-01   +5.619583735402334e-01   +2.999218402693524e-01   +6.325147493809256e-01   +2.118591359225952e-01   +1.034134596888576e-01   -1.024681303927396e-01   +7.029581114672659e-02   +3.327537602811622e-01; -3.001625225292064e-02   +2.206027437648935e-01   +4.968846295614155e-01   +6.617625550559350e-01   +3.587794810580316e-01   +2.221415350244416e-01   +8.026119109290689e-01   +3.230233567072373e-01   -1.298210029272488e-01   +1.527549765192754e-01   -7.436611447324977e-02   +5.970588990875351e-03   -3.023476592825009e-01   +2.872236620542328e-01   +3.894625907459965e-01   +1.049040280827318e-01; +5.317966597170829e-01   +3.204683535234340e-01   +5.968309189511941e-01   +6.732135754790137e-01   +7.863864624747663e-01   +8.512293481509409e-01   +6.590799990857611e-01   -1.892828226102117e-02   -4.212100762712568e-01   +3.597900667457895e-01   +6.566262112695967e-01   +3.776899598245004e-01   +1.679767946778035e-01   +4.548840144686084e-03   +2.953649409663992e-01   +2.918541557163490e-01];
L2I_L2E_iAMPA_netcon = [+5.587986552972369e-01   +7.554400252378415e-01   +4.926401222410721e-01   +4.527308587496810e-01   +7.903151389084170e-02   +8.583886114703263e-01   +3.852287985566324e-01   +4.351358673375501e-01; +7.695678523889711e-01   +2.340636887171162e-01   +7.568195808370372e-01   +7.299550990211302e-01   +6.624022447544310e-01   +2.904753930281636e-01   +3.273401476796783e-01   +3.641384452136671e-01; +4.923340775084503e-01   +4.443176762585687e-01   +5.141963878817084e-01   -5.352569595377742e-02   +5.251656353736343e-02   +4.559296407280790e-01   +4.254615360054468e-01   +3.054333086432228e-01; +4.086700253393133e-01   +4.725197860534961e-01   +2.524415298148395e-01   +8.249015426174386e-01   +2.555019234481997e-01   +2.264713545634394e-01   +4.439492403291430e-01   +3.787476090652135e-01; +7.561788174481713e-01   +3.499957319829526e-01   +3.491243223895568e-01   +5.945414191062801e-01   +6.036293860347222e-01   +6.015237583662884e-01   +8.929170549874265e-01   +2.925732773067773e-01; +3.034958860744388e-01   +4.446450000506234e-01   +1.950448688572809e-01   +6.459865291533392e-01   +2.146684581312312e-01   +4.298632446854451e-01   +4.182841997175390e-01   +4.292159459290046e-01; +6.984248763510564e-01   +4.380986924732104e-02   -1.122343489387985e-01   +6.984577501428018e-01   +6.010107437884984e-01   +3.913051843889581e-01   +1.000000000000000e+00   +1.666501079735770e-01; +9.518258405917430e-01   +1.933280918190124e-01   -8.304094975627480e-02   +5.888458024800011e-01   +1.970012486210491e-01   +5.796848989507016e-01   -3.564826198185906e-01   +6.135042666199950e-01];
L2E_L2I_iGABA_netcon = [+1.051664364043476e-01   +2.330471152171198e-01   +4.566664169414530e-01   +2.696838049000009e-01   -8.066038999130899e-02   +5.733215872120810e-01   +1.883385506958208e-01   +5.440547505632961e-01; +3.988827520390307e-01   +6.006748883440353e-01   +5.580529079475828e-01   +5.647149658644193e-01   +7.137886152769469e-01   +5.384038203410273e-01   -3.729885481226441e-02   +2.823299046740750e-01; +6.080631937641916e-02   +8.122956015210093e-01   -2.360917987221158e-01   +1.478067366229225e-01   +6.819028075897452e-01   +7.518603195622985e-01   +8.642146566837521e-02   +8.010672193725563e-01; +4.959779772118707e-02   +6.911988278215174e-01   +5.465092995502259e-01   +4.656612981690742e-01   +1.000000000000000e+00   +4.502919470309193e-01   -1.318324280072971e-01   -1.500056383454814e-02; +2.307684792126204e-01   -2.130919497287233e-01   +1.567565404050844e-01   +5.605226883499063e-01   +3.833210685292419e-01   +1.417883433620564e-01   +3.364491317607411e-01   +1.216154587475299e-01; +6.056421465848089e-02   +2.450581199192091e-01   +2.087575935674109e-01   +3.101017838294524e-01   +4.244575299533549e-01   -2.192188258630482e-01   +4.645130608829097e-01   +1.034309427807756e-01; +5.508436444168190e-01   +2.904779050437318e-01   -6.516801323353634e-02   +1.327036823319420e-01   -3.200990060833706e-02   -5.464475240192936e-03   +3.481067738322199e-01   +7.206901602648270e-01; +4.818877298234996e-01   +5.656388308652247e-01   +3.745616021938736e-01   -3.607450719951533e-01   +5.963095532081383e-01   +3.108007153289825e-01   +6.420887320827207e-01   +5.041063588680328e-01];
L3E_L2E_iAMPA_netcon = [+3.456901293050482e-01   -7.840469094467097e-03   +9.446095967840309e-02   +5.223892117192556e-01   +4.821136759723204e-01   +1.284030605064722e-01   +3.123566979923445e-01   +6.194483538980642e-01   +3.893464273920674e-01   +8.601931440923737e-02   -2.040992666486120e-02   +6.316383901685138e-01; +4.518950945585053e-01   +7.607443371502941e-01   +2.435695988862116e-01   +7.731741549146130e-02   +1.981356809269572e-01   -7.513450402470179e-02   +1.237390408962959e-01   -2.147021134731799e-02   +2.894262377232014e-01   +9.553014521763491e-02   +1.559826566432577e-01   +3.320338857429406e-01; +1.073377654623126e-01   +1.757227843229760e-01   +5.775830654795153e-01   +2.840285814176969e-01   +8.302870156962435e-01   +5.289327848083568e-01   +6.054372272005856e-01   +4.071332393846844e-01   +4.654464120193725e-01   -4.376333743015842e-02   +2.022240075597640e-01   +5.855132833792489e-01; +9.410669882505532e-02   +3.032767442030569e-01   +3.564413917754845e-01   +5.745468265728551e-02   +4.448625011446353e-01   +2.887957152417834e-01   +1.695154909708823e-01   +3.909424451330208e-01   +3.947903344614300e-01   +4.316089434457703e-01   +8.456220760758447e-02   +2.061565112399651e-01; +5.347732477745782e-01   +3.350973995678297e-01   +1.929409392263696e-01   +8.355217653024348e-02   +5.374213653810671e-01   +4.680152160567823e-01   -2.479885157262799e-01   +5.116162778405949e-03   +5.163440752588667e-01   +4.549658029682917e-01   +7.060262845682425e-01   +6.036876295508495e-01; +4.654696766374044e-01   +6.642066394420685e-01   +7.763024943614250e-01   +8.630405346944295e-03   +4.191230081102783e-01   +1.000000000000000e+00   +4.585227600454050e-01   +5.728582311457172e-02   +1.801586848764999e-01   +5.356968363181177e-01   -1.170813479956079e-01   +4.220326764475601e-01; +2.317357800438834e-01   +1.703418051635588e-01   +6.577121966561627e-01   +8.348439534643222e-02   +6.045717178663557e-02   +5.973010926237992e-01   +2.729000426665877e-01   +5.306147516304028e-01   +5.038370206800036e-01   +3.055066093773487e-01   +5.350062416196064e-02   +7.724777077506970e-02; -1.827862022754533e-01   +4.439168002256084e-01   +1.265194541261064e-01   -2.827152154271066e-01   +2.308683191500370e-01   +5.239894800892839e-02   +1.866204460075330e-01   -1.563226993004288e-02   +7.937208078693607e-01   +6.134539014831653e-01   -2.143333487425474e-01   +2.057768418459464e-01];
L3I_L2I_iGABA_netcon = [+5.975665068962560e-01   +5.153981859058426e-01   +2.410338434444850e-01   +8.082204112433626e-01   -5.735888406234780e-02   +2.774217634281513e-01   +6.441222348706626e-01   +5.590148274884958e-01   +6.716419918556029e-01   -3.220932849695161e-02   +3.329665192654336e-01   +7.389448081774275e-01; +3.173632754946618e-01   +3.244131532749306e-01   +1.577321815780855e-01   +3.580820887678850e-01   +7.065837958890380e-01   +3.873815601448392e-01   +3.824341428003212e-01   -1.397300766943858e-01   +3.433867708762040e-01   +3.774524312746270e-01   +3.970658499930279e-01   -3.247700843258705e-01; +1.726557035336972e-01   +4.937693430296692e-01   +6.452174833775449e-01   +1.719161792427880e-01   -8.751434523754903e-02   -1.313227246291691e-01   +4.540122931018192e-01   +6.453143793623536e-01   +1.279091263639181e-01   +2.871470546027495e-01   +4.348256086173843e-02   +5.616790833717638e-01; +4.575515466296327e-01   +6.622536521569768e-01   +1.954133843226798e-01   -1.529031830079250e-01   +2.578653770880896e-01   +6.483041107724586e-01   -1.165766659248851e-01   +7.038310573757885e-02   +4.388846763553541e-01   +9.769217299398589e-02   +4.682241353619863e-01   +4.670869354669426e-01; +6.955324023973966e-02   +1.546641746337883e-01   +3.105928911408689e-01   +5.893315437935632e-01   +6.534399687587660e-01   +7.756357515825398e-01   +2.069404463069053e-03   +1.000000000000000e+00   +6.182309242228591e-01   +2.140216144159184e-01   +2.073556248786907e-01   +8.129781739472643e-01; -3.264616170566963e-01   +7.938323723581913e-01   +3.026732909149641e-01   +3.385210022300970e-01   +9.567745887027959e-01   -3.164493167596755e-02   +3.740892222272874e-01   +4.600872334081021e-01   +1.495311805407916e-01   +3.440600873403133e-01   +3.345000257348129e-01   +6.779313127766859e-01; +5.636921133238798e-01   +3.601513125707000e-01   +8.597348346821051e-01   +2.694053032807930e-01   -6.592293665199086e-03   +5.607548799907179e-01   +8.626687535458707e-01   +1.167443524426465e-01   -1.013890756933139e-01   +3.929937580743166e-01   +3.069761316022923e-01   +3.334310059591867e-01; -3.327853581715792e-02   +1.589634156583262e-01   +8.403719370583961e-01   +7.259525626940517e-01   -2.143464925260579e-01   +6.750889043485775e-01   +4.923384094966218e-01   +9.040206949596380e-02   +6.610672045119537e-01   +3.515308792810463e-01   +4.795662168038088e-01   +2.764902845318196e-01];
L2E_L3E_iAMPA_netcon = [+4.520761486120191e-01   -4.873471879797727e-02   +7.780300809059433e-02   +1.602391331451920e-01   -2.264904538737124e-02   +1.177386460752569e-01   +1.731993624178584e-01   -2.699217622983517e-01; +1.714444876224357e-01   +4.030524656334760e-01   +3.453781187185626e-01   +2.338948674762903e-01   +5.849930026022946e-01   +2.846452070168823e-01   -1.637046406111451e-01   -1.227281323779152e-01; +5.927411894376832e-01   -1.384959448940614e-01   +4.389450918695382e-01   +7.663856854452050e-01   +2.532665679321254e-01   +3.152975748390622e-01   +5.522656236031356e-02   +5.929977266885234e-01; +8.850624033259004e-02   +4.571553173367409e-01   +4.657556009463431e-01   +7.994090213647341e-01   +6.911257262243514e-01   +4.063754962187565e-01   +2.566141044425959e-01   -1.108606283424995e-01; +9.716195036681383e-02   +3.688990278404599e-01   +4.296716236152861e-01   +9.819603991150381e-01   +8.317130319117275e-01   +2.483089026894718e-01   -2.306629376578588e-02   +4.674802001265823e-01; +3.208731054375824e-01   +7.234538585168997e-01   +1.000000000000000e+00   +6.267410619604112e-01   +4.345822768830483e-01   +4.847628117705778e-01   +7.566050905900522e-01   +3.337046934296854e-01; -1.806346107179355e-01   +3.064533786713371e-01   +6.909875505895936e-01   +6.135184363509106e-01   +7.374921888686302e-02   +1.249668761824796e-01   +1.692885842816227e-01   +2.535525027172185e-01; +4.808071019150253e-01   +4.245871603007778e-01   +2.627268178192873e-01   +2.001276990510824e-01   +5.371322710139095e-01   +4.065788122877196e-01   +5.226513890707735e-01   +7.463146306453959e-01; +6.434511939460085e-01   +2.920839782421730e-01   +2.541918179789050e-01   +1.004070602159507e-01   +1.652722165858872e-01   +1.366730718192443e-01   +5.552606951301595e-01   +1.979328871699191e-01; -8.710283333929533e-02   +3.190682177272508e-01   +3.667781955585687e-01   +5.578937364122152e-01   +9.085383546332416e-02   -1.421424363117070e-01   +6.478693231097804e-01   +2.609862805629911e-01; +2.861325194774625e-01   -1.029997079958957e-01   -1.252149010219013e-01   +4.802996364442242e-01   +5.808502688181366e-01   +4.446176119209380e-01   +1.578401055481925e-01   +4.508469122036539e-01; -1.707676141502686e-01   +7.079698489745261e-01   +8.516989653803809e-01   +5.926657433412171e-01   -2.386056038402489e-01   -9.097661330632896e-02   +8.556596403330578e-02   +4.613334736185031e-01];
L2I_L3I_iGABA_netcon = [-2.461314711750449e-02   +2.136427068777752e-01   +7.256922627004931e-01   +6.398992259288419e-01   -1.893051342620064e-01   +5.893678138068834e-01   +4.239060812462127e-01   -1.092276700730225e-01; +8.309248000772944e-02   +3.767589842816758e-01   +4.606784902459611e-02   -8.159842736153416e-02   +4.156268802161173e-01   +2.352884148533668e-01   +2.770819380022411e-01   +2.199503464906889e-02; +7.464337667685246e-01   +4.016415315676155e-01   +2.318865715244477e-01   +3.969687442668418e-01   +3.584986685112410e-01   +9.214678571547913e-01   +2.356228742306917e-01   +1.982705175686566e-01; +3.955541482076613e-01   +3.391224005489282e-01   +6.100113988095760e-01   -1.005524496888724e-01   +3.647443103118266e-01   +3.047796922443807e-01   +5.619186051569824e-02   +4.993419849913798e-01; +7.452022002553809e-01   +7.594635046707097e-01   +1.250648605584303e-01   +2.478663256411569e-01   +3.189577426365189e-01   +5.255347307202672e-01   +2.159324585028764e-01   -8.376508842285005e-02; +2.654731016946249e-01   +3.720410761775005e-01   +7.126677320573761e-01   -3.918556538339921e-01   -6.010408748901502e-02   +5.676759743457480e-01   +2.414599363807069e-01   -1.634862715827686e-01; +8.378335951085364e-01   +5.713899309575022e-01   +1.226271428750960e-01   +5.843566795175943e-01   +3.137738663809271e-01   +5.060166821473820e-01   +6.719053722022612e-01   +3.812670498520454e-01; -3.268153329312808e-02   +5.153143688656014e-01   -2.387661824134868e-01   -1.004341599728266e-01   +4.148751031140501e-01   +3.822384790522421e-02   +2.738758570520314e-01   +4.579234633265858e-01; -2.926027828777669e-01   +4.481219918971040e-01   +4.404764798652026e-01   +1.319503534411313e-01   +5.168362352576317e-02   +6.266908531625732e-01   +5.414716305446173e-01   +4.609759828657241e-01; +6.309920725058964e-01   -2.126046558779811e-01   +3.796250673923101e-01   +8.829778816618494e-02   +4.840092478529886e-01   +5.093199855350197e-01   +6.781643908490906e-02   +5.608328665690094e-01; +5.774105654515336e-01   +2.783933202173409e-01   +1.602929795207061e-01   -1.226399226670286e-01   +5.215096359049589e-01   -8.969926953653448e-02   +2.620594456661064e-01   +7.434147677545506e-01; -7.872874721833983e-02   +6.592394532928063e-01   -1.154063821834476e-01   +3.261523162874177e-01   +8.428695073869265e-01   +2.000192596406113e-01   +1.933342588912784e-01   +2.318360118379793e-01];
L3I_L3E_iAMPA_netcon = [+6.928292892820634e-01   +5.623572254864003e-01   -4.416557232336474e-02   +5.330489047028909e-01   +1.924256679825876e-01   -1.296587918680977e-01   +1.281821983018227e-01   +1.772600000917370e-01   +9.197138230438527e-02   +2.727173777098645e-01   +1.267398050718845e-01   +4.857129663314012e-01; +3.167059465124997e-01   +3.004126458975826e-01   +4.748973412511804e-01   +5.349657019411931e-01   +1.000000000000000e+00   +3.485437045055064e-01   -3.977536511861088e-02   +5.758845155786722e-01   +7.599244180283949e-01   +2.617372462767095e-01   +8.624472740455399e-02   +3.573498546427741e-01; +3.946208165845914e-01   +6.310872426939413e-01   +9.857464787763495e-01   +4.355430728950266e-01   +5.835537947704499e-01   +4.599212670805325e-01   +5.470494243648781e-01   +2.872094702757813e-02   +6.043907642622277e-01   +8.164432656369780e-01   +6.089889456599653e-02   +7.000714029254890e-01; +4.800647714395780e-01   +4.383749240660998e-01   +3.224866711938805e-01   -2.291999050944909e-02   +3.131544098559612e-01   +5.522732032233429e-01   -2.606999895488847e-01   +1.786686903508327e-01   +2.736122844724465e-01   +4.120703633030519e-01   +3.241072412239392e-01   +3.424189689707933e-01; +3.204452090446549e-01   +6.309851800327498e-02   +8.018053449331036e-01   +4.984872168769425e-02   +2.999820401643176e-01   +2.168899714932369e-01   -1.277916266712303e-01   +3.240205370850686e-01   +5.845644109942233e-01   +5.861521330799432e-01   +6.264763638871179e-01   +6.713054286462020e-02; +8.915030341046115e-02   +3.924303947365999e-01   +3.447420960629801e-01   +1.175072498294780e-01   +1.563506980893422e-01   -3.621905024135462e-02   +5.803017324112689e-01   +2.084958366604783e-01   +4.445517688040408e-01   -8.748748346289992e-02   +4.183923806940978e-01   +3.709248186354719e-01; +2.018869285327555e-01   +5.695929569551807e-02   -1.516482330482729e-01   +1.789858651099120e-01   +5.086263322649747e-01   -2.639889086331476e-02   +3.190391885143400e-01   +2.908245304687235e-01   -2.144810913175114e-01   +1.860254070948751e-01   +5.443428898713286e-01   +4.306297626969128e-01; +5.872902831287022e-01   +4.090979743611408e-01   +2.436064187144074e-01   +5.008485007706096e-01   -2.300163902508121e-01   +5.216703606583992e-01   +8.961042010925743e-02   +4.919005085282098e-01   +1.654831182885274e-02   -3.124170324907835e-01   +1.037092841254183e-01   +4.241237495925807e-01; +8.523915682877733e-02   +7.000356972740491e-01   +1.743070208561723e-01   +6.816672163021105e-01   +3.643883702890570e-01   +5.125605766908933e-01   -1.916830539800469e-01   +6.325915585334907e-01   +5.926713103502498e-01   +6.476364513396885e-01   +4.821079978158939e-01   +8.112644791196136e-01; +9.058992389229541e-01   -2.964324605556389e-02   +7.627397067008964e-01   +1.505087803811856e-01   +5.442949058858312e-01   -5.106194350812402e-02   +5.459499201349127e-01   +1.971488360324488e-01   +4.483744798161651e-01   -1.203685549755809e-01   +6.570944442823815e-01   +5.773540987416390e-02; +1.453612227306492e-02   +4.330500806655981e-01   +4.692090843937192e-01   +3.673660047947596e-01   +8.668356954569996e-01   +5.179416736417512e-02   +2.912641408549315e-01   +6.148550050633218e-01   +8.300070462915460e-01   +3.441586584901735e-01   +5.873985554699896e-01   +7.161264445914765e-01; +3.793946472023488e-01   +2.988524446091866e-03   +3.925777742871555e-01   +4.298586259231157e-01   +6.649931159986848e-02   -1.076385598893754e-01   +5.447170915037865e-02   +3.812586862521770e-01   +6.457583795278314e-01   -1.087309028082964e-01   +6.250539749417194e-01   +3.294149646488744e-01];
L3E_L3I_iGABA_netcon = [+8.449079182531043e-02   +7.873954823443887e-01   +3.522060380988918e-01   +2.940151303727245e-01   +4.716770819614980e-01   -1.044773735425871e-01   -1.956535470317107e-01   +3.985860791977252e-01   -5.815400902070036e-02   +5.117882428624035e-01   +2.720643890249115e-01   -1.855990067067423e-02; +4.269095648696773e-01   +2.926636020092037e-01   +1.529247718920384e-01   +1.970251166123478e-02   +2.810303146503405e-01   +5.499388546555922e-02   -4.350298655976381e-02   +4.297607149176233e-01   -5.719315033046867e-03   +1.251242475995382e-01   -8.591003722475603e-02   +1.806944760896295e-01; +4.838895562435782e-01   +7.648820913543097e-02   -6.157635236644814e-02   +2.768982233213645e-01   +6.198742339085276e-01   +4.018743634514291e-01   +4.993925116114200e-01   +3.386397563640374e-01   -1.253819333567258e-01   +3.811516198605840e-01   -3.368418365444482e-01   -1.170304865964963e-01; +2.906897096390106e-01   +4.820419949585797e-01   +1.098659144588839e-01   +2.915223849347349e-01   +6.924831525513097e-01   +4.807719131779935e-01   -1.729554394347000e-01   +1.775346540682600e-01   +6.784109149191959e-01   +6.511527117493490e-01   +2.528501998356971e-01   +3.642588124076370e-01; +4.208325562686058e-01   +1.702917005148152e-01   +2.819645733103778e-01   +6.291504740973193e-01   +7.691824543863258e-02   +3.774487495118027e-01   -3.081056211962159e-01   +4.540791935768605e-01   +3.773766907218517e-01   +6.145287540244255e-01   +2.538298938801701e-01   +1.223304286766888e-01; +3.971176500231633e-01   +2.712642005910555e-01   -1.573893899746206e-01   -1.974794514395193e-01   +6.966725624729350e-01   +7.104528160569957e-01   +1.330070020880399e-01   +3.301249048702417e-01   +5.393247582239586e-01   +4.979886659955251e-01   +2.856727900368948e-01   +8.704697527579176e-02; +6.133620435160240e-02   +2.806506961948735e-01   +4.842399265707068e-01   +1.000000000000000e+00   +2.436053550580764e-01   +1.161897762789921e-01   +7.242949583166852e-01   +6.109851568581748e-01   +1.163363158728001e-01   +5.227213265736567e-01   +5.866994065172254e-01   +1.499059356833947e-02; +1.758106843048911e-01   +1.527268129271111e-01   +3.979250255861222e-01   +4.907066478484716e-01   +4.608784975214636e-01   +2.590337151962034e-01   +3.803032836836276e-01   +8.869644235386641e-02   +2.567007244310732e-01   +4.807562425901118e-01   +5.105277320053943e-01   +2.683224146899458e-01; +2.553047333393032e-01   +4.827310534723374e-01   +2.560669793872117e-01   +8.046739536268648e-02   +4.199612154438040e-01   +2.194842756894133e-01   +1.880238660004412e-01   +1.641123713166712e-01   +5.377382277764183e-01   +7.638094409429907e-01   +5.669844092067995e-01   +3.599650149331846e-01; -1.512165953688137e-01   +7.875037873211085e-02   +6.506994166211004e-01   +1.891856105253237e-01   -1.274787239557207e-01   +1.962147370713796e-01   +4.900656424976984e-01   +3.942486534460247e-01   +3.145719781794352e-01   +8.713788376427566e-02   +3.428208667758075e-01   +6.609415487982239e-01; +2.667754721667102e-01   +2.766461586180076e-01   +1.950379184481133e-01   +4.406158167559143e-02   +4.555585466248060e-01   +8.773361422714157e-02   +3.051058900818474e-01   +4.239254824945838e-01   +2.128016132854050e-01   +6.705178039094081e-01   +1.746577391160129e-01   +1.682715675777290e-01; +2.534165385970794e-01   +4.859942791014080e-01   -1.386239707544264e-01   +5.120225816393321e-01   +6.837528489077481e-01   +5.338491448426758e-01   +4.958717768105859e-01   +1.791185298464846e-01   +7.829240129983434e-02   +1.294398812746352e-01   +1.145601921910162e-01   -5.426614791547030e-02];
L2E_Input1_iAMPA_netcon = [+4.995098048045733e-01   +6.469468406209449e-01   +7.671819340981065e-01   +7.209399437262352e-01   +9.175877140612004e-01   +1.000000000000000e+00   +5.909843440597120e-01   +9.391718728826304e-01];
L2I_Input2_iAMPA_netcon = [+7.255065677889651e-01   +7.849758463831239e-01   +7.145049841279094e-01   +6.055748874473836e-01   +4.486016606001784e-01   +1.000000000000000e+00   +5.691802747539094e-01   +6.912875699609148e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
