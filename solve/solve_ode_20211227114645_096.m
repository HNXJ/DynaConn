function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.264776077499648e-01   +2.229511672389664e-01   +1.153793990635313e-01   -1.968552752908413e-01   +1.690096949542177e-01   +1.413895392388489e-01   -6.986055426624921e-02   -1.490676271173245e-01   +1.616971716729755e-01   +2.636869560592104e-01   -3.039498570608052e-02   +2.279461521053170e-01   +5.947609203407216e-02   +1.440389630210023e-01   +1.905977693786144e-01   +7.084842776999256e-02; -3.788957803363048e-02   +1.878666244243301e-02   +4.364668314331383e-02   -4.697287469733759e-02   -1.291890183662752e-01   -1.049141629206287e-01   -2.686700937905190e-01   +2.186118261710790e-01   -1.516539630958918e-01   +5.695039127913339e-02   +1.396239846725724e-01   -2.258555418784562e-01   -4.599700881175053e-02   +1.859439126159378e-01   +3.781451480763807e-02   +5.115157758162940e-02; +1.201340780596946e-01   +2.186228520619926e-02   -1.605211461860240e-01   +4.396348385060249e-01   -7.765110580307190e-03   +1.790515917170359e-01   +9.326587878326933e-03   -1.765515610970562e-01   +1.767486880136082e-01   -3.693103673078746e-01   +2.477300419245875e-01   -7.707435368704688e-02   -3.931223444282791e-01   -2.052561215830741e-02   -2.525691747710531e-01   +1.611197074280112e-01; +3.159635806933475e-02   -1.906510500239852e-01   +1.216243549044236e-01   +9.594913711545568e-02   -8.201805287386164e-02   -2.183414610898071e-01   -3.810785079161702e-02   -3.794072140523108e-02   -2.187978525122792e-02   +5.572345223917626e-02   +1.367530153507843e-01   +1.876390887707116e-01   +1.951511324158937e-01   +1.701570085292190e-01   -1.698488255079373e-01   +2.288547122335068e-01; -6.727515789711305e-02   -2.279107176711549e-01   +4.329219286491830e-02   -6.722924978168156e-03   +1.321592168965262e-01   +1.232074740681658e-01   +1.338810631659896e-01   +9.706743215514464e-02   +1.292648633859664e-01   +3.868131670137350e-01   +9.029183193591375e-02   +4.242702220095484e-02   +2.306457481160059e-01   +2.560002057887550e-01   +9.354516623899095e-02   +1.830436741332696e-01; -4.972704106273314e-02   +2.284566860408134e-01   -1.037568470246736e-01   -7.206601006012479e-03   +2.669055682545224e-01   +1.785878335132683e-03   -1.779816371018409e-01   -9.990401290962425e-02   +9.319548572264381e-02   -2.142985351729878e-01   +2.136832606582303e-01   -4.233864461239123e-02   +2.477145167760431e-01   +3.810491314327938e-03   -1.680816210457786e-01   +3.549623570860132e-03; -9.720467428786884e-02   -8.802221561390586e-02   +4.150670889945479e-02   -3.084129914460626e-01   -2.771145596474398e-02   -1.510895777744793e-01   -1.812248677929186e-01   +3.203938415087572e-03   -1.262513306143388e-01   +1.932256366134193e-01   +8.216390641290382e-02   -9.269224160828804e-02   +1.811773044901299e-02   +1.329034496605705e-01   +1.359349497521823e-01   +1.890019656049755e-01; -8.117659124254920e-02   -6.531281561718998e-03   +5.816460332686157e-02   +1.209038931262683e-01   +1.183187108149982e-01   -1.131958253574387e-01   +9.154989923267805e-03   -9.130268504197508e-02   -2.345729781138101e-01   -2.520687943748360e-02   +1.037778692308733e-01   -6.904893279449388e-02   -1.746398945265774e-01   -1.497138229476583e-01   -2.790756889419061e-01   -2.876754313200403e-01; -1.741770727485076e-01   -5.551643602953250e-02   +3.549275034323660e-01   -4.776532527566033e-02   +9.617342207499847e-02   -2.309372932688622e-01   +4.565457882172988e-02   +1.876888371449745e-01   +2.027658576709445e-02   +1.985633637969712e-01   +2.680813508881199e-01   -2.116008554177068e-01   +1.279646613959448e-02   -1.077362517640166e-01   +2.752079575163878e-01   -2.201168456651018e-01; -1.595618221342177e-01   +5.141374694888902e-02   +6.972267440359907e-02   +1.088807384008742e-01   -3.508608780250191e-02   -1.945182667095664e-01   -1.087399565886289e-01   -1.657827125966193e-01   -2.975977202484205e-02   -1.293751006869401e-01   +4.393466448863728e-02   -3.112547397843674e-01   -1.212815752816092e-01   +1.928700031118054e-01   -3.256032373577074e-01   +2.018596530602918e-01; -5.062169806996557e-01   +1.248379830459714e-01   -1.305495561860248e-01   -2.680482701013687e-01   -2.229974183479832e-02   +2.144908187135442e-01   -5.132235367088138e-02   -1.681340642511563e-01   +1.055307106787123e-01   -1.980314866057060e-02   +1.087178203023331e-01   +4.895812121510505e-02   +1.538320358417948e-01   +2.421682602300927e-02   -3.493871036688850e-02   +1.752839591178290e-01; -4.910447774750603e-02   -1.240872438081681e-01   +2.199709553515592e-01   +2.516565758042503e-01   -3.084652879715271e-02   +2.244788672422441e-01   +7.363241422038493e-02   +3.098719097148496e-01   -1.723272980035113e-01   -7.845467054510576e-02   +2.460602368832430e-02   +2.185443516318893e-02   +1.226207061131035e-01   +1.382360680445899e-01   +7.967298145338048e-02   +2.144524056901601e-01; -3.478915407373152e-02   -1.899399358341684e-01   -6.039116288934825e-02   -2.716226757826207e-01   -1.513391649999915e-02   +1.557040537755468e-02   -6.964375911924035e-02   -7.195079354207247e-02   -5.639029548276557e-02   +2.744884752987208e-02   +3.480601179498797e-02   +2.466670938029611e-01   -7.622697238815002e-02   -5.212070367924298e-03   +3.981958115188481e-02   -6.860705216856641e-02; -2.801560543543106e-01   -5.769906925356465e-02   +1.075011063916045e-01   +2.974407107697612e-01   +2.494575163430857e-01   -2.065506394845733e-01   -4.562713219065718e-01   +3.719680984512282e-01   -7.327795827663056e-02   +5.974194457541773e-02   -1.830216787246537e-01   +1.482274977084922e-01   +1.032750072956466e-01   -2.260859973738080e-03   +1.087404945241030e-01   +4.645394111632065e-02; +1.242551557778422e-04   -1.690614385695591e-01   -2.868064471552988e-01   -1.458163115575944e-01   -1.239552555788895e-01   -2.136715651105018e-02   +2.433395666184754e-01   +1.535459653631469e-02   -2.766031685415865e-01   -1.761416503416026e-01   -8.447932291092145e-03   -1.788031410575032e-01   +1.762156460884666e-01   -9.404340847248792e-02   +1.676612273707933e-01   -1.393840475643619e-01; -3.871943536814415e-03   -5.940021002267769e-02   +9.179616126807744e-02   -1.788922094826349e-01   +1.249830020465084e-01   +1.673642131455419e-01   -7.434632386097319e-02   -8.791830989199176e-02   +6.018898757108783e-02   -8.204485714900425e-02   +2.391107322269815e-01   -1.807654497609684e-01   +3.471949383047165e-03   -6.716519018553038e-02   +1.860749905049301e-01   -1.099718189414907e-01];
L1E_L1I_iGABA_netcon = [+3.187113162228546e-02   +1.130014530859184e-01   -2.373677781611020e-01   +1.295201664283096e-01   +5.690069846899560e-02   +4.228529964496157e-01   -5.763558448685523e-02   -7.760797473767680e-02   +1.513195034887961e-01   +3.725965281931499e-01   +1.130471170515324e-01   -1.726185203290416e-02   -1.158239246443152e-01   -4.048001783866992e-01   -8.625974664556518e-02   -1.971716439214081e-01; -2.832166963879937e-02   -3.233004983211465e-02   -2.081095044611539e-01   +6.011850831569489e-03   -1.011093157802595e-02   +5.844677435260207e-02   -5.317681883282445e-02   +2.118460179745357e-01   +2.545074516196076e-01   -2.208714067568717e-01   +1.116549873969366e-01   -4.366661855953638e-02   +7.231789055208349e-02   +2.803017033915443e-01   -8.225158016885328e-02   -7.129269600450416e-02; -1.172378128713750e-01   +2.385348774546393e-01   +7.350123613223973e-02   -2.865274908080792e-01   +3.424334484740558e-01   -6.922423892689983e-02   -9.675931549053333e-02   +1.424260884072788e-01   +4.633127237465944e-02   +1.049136902169608e-01   +1.266469072986003e-01   +1.133853022660523e-01   +3.555953139156600e-01   -3.022708860045266e-01   +2.309353934709291e-01   -1.743964808700368e-01; -2.628926157673291e-01   -1.233626538607349e-01   +4.059639038337570e-03   +6.976554829619244e-03   -4.382218674495288e-01   -5.046044680603966e-02   +3.360747775709610e-01   +2.540240204710286e-01   -6.382142645159392e-02   -3.379793722231670e-01   -7.406465698095846e-03   +3.026998361054420e-01   +1.974889263592015e-01   +2.109510795901701e-01   -1.403537913006393e-01   -1.940224211076893e-01; -8.510191498904107e-02   -1.822089530969497e-01   -1.838242915535858e-01   -3.160905522631209e-01   +8.090454770025456e-02   -1.081482972444451e-01   -1.125909471273637e-02   -6.687261987521134e-04   +5.908226698176238e-03   +1.792314569966278e-01   +1.844048143382092e-01   -7.485572103984632e-02   -9.751198992677060e-02   -1.472964367014860e-02   +1.723137716441298e-01   +1.099712123166705e-01; +5.644260816475249e-02   +6.026374809445684e-02   -3.275420952046341e-02   -1.465077900695067e-01   +2.835279441132300e-02   +3.629133609261331e-01   -2.224776982468873e-01   +4.696147831650109e-02   -3.163355843835470e-01   -1.124446273286466e-02   +7.789188417886257e-02   -1.960133519829047e-01   +9.599887740621989e-03   -1.814488397807102e-01   -1.525886769900801e-02   -7.205350187649215e-03; -2.355131744605360e-01   -7.082231771303030e-02   -9.272079979209909e-02   +9.555175558386281e-02   -1.212127504013580e-01   +1.130285019963024e-01   +1.251657586683959e-01   -1.900543386676493e-01   +3.762511027984867e-01   +1.298374170170189e-01   -9.720637824556332e-02   +2.089731608702119e-01   -1.569701099709356e-01   -1.936340358304081e-01   +2.998105924180759e-01   +4.259353749391212e-02; -3.027030714846561e-01   +1.205613271437828e-02   +2.087642137161295e-01   -2.883036663777889e-01   -7.063580642705664e-02   -9.540524015155329e-02   -1.453202433134116e-01   +5.038347165650674e-01   +4.960539877004161e-02   -3.022225268098299e-01   +1.057243306285089e-01   +2.170147415584371e-01   -2.143628671004896e-01   +7.586924450090689e-02   +1.903000646660830e-02   -6.759146127988874e-02; -2.005283666848433e-01   -1.569208575802074e-02   -1.470340471293968e-01   +3.890350317649749e-02   +1.141917728546558e-01   +3.271243420232328e-01   +1.429604382145265e-01   +7.408932410550660e-02   -1.778682927882096e-01   +1.989349096652542e-01   -2.543047437109517e-01   -2.165708415561524e-01   +1.324091080285977e-01   +1.610625104792916e-01   -2.364078523433719e-01   +1.970984444652610e-01; +1.736032563523148e-02   -1.586890344581070e-01   -1.781603794059343e-01   -1.020305443391661e-01   +1.791293801034122e-01   +3.571106297399234e-01   -2.317015900732115e-01   -5.079619693116277e-02   +1.198412351071986e-02   -7.827185827710786e-02   -1.755655129160414e-01   +2.411625808501090e-01   +1.981222946504978e-01   -9.585927036159098e-02   -1.345202392823961e-01   +7.728296669636307e-02; -6.254530583635412e-02   -2.354557653442348e-01   +1.600242670243179e-01   +4.540992452903645e-01   +1.893281352151354e-01   -2.007056661681226e-01   -3.338716027437187e-02   -2.584590918690636e-01   -2.834252302360974e-01   -2.632054681483051e-01   +3.845361442355753e-02   -7.666243799540240e-03   +1.520676169885031e-01   +1.821254350894341e-01   -9.375046534667431e-02   +3.030896041535310e-01; +2.454689370614032e-01   +2.374154537224379e-01   -2.217257706411292e-01   +2.303935105610386e-01   +4.367728863651880e-03   +2.793613293917958e-01   -9.072883995910874e-02   +1.002086794630146e-01   +6.315809173932287e-02   +1.042284144038124e-01   +2.674140053783847e-01   -8.285079971797281e-02   +8.735056612044576e-03   -2.704767037411400e-01   +1.127676518395675e-01   -1.453187424168988e-01; +8.897276804409172e-02   +7.295986918695563e-03   +4.280585276583349e-01   -1.041195258807679e-01   -7.976948683675419e-02   +1.065039461485805e-01   -8.491022220727253e-02   +3.615974064299648e-01   -1.201727473080523e-01   -1.837355135267984e-02   +1.023806566726494e-01   +3.402707073268004e-01   +5.087857676015488e-02   -2.460530681052423e-01   -2.824234800782808e-01   -6.321991936911592e-02; +2.817884875661845e-01   +9.942822949494705e-02   -1.907805524864076e-01   -9.208286254855383e-02   +2.504552979992753e-02   -2.135682511633904e-01   -1.953236983704052e-01   -1.501448046135735e-01   +3.487189258351884e-01   +2.117157825717799e-01   -1.434510416051621e-01   -2.976488345812008e-01   +6.679012691862482e-04   +1.709694293019243e-01   +3.427457707155187e-02   -3.851517543799584e-01; +2.425076513093250e-01   -8.751053155341659e-02   -2.366669862057087e-01   +8.499353455281716e-02   -3.247505758572945e-01   +1.247901203052143e-01   -1.028144487297306e-02   -5.229635183318693e-02   +4.605237192203197e-02   -2.031746854217155e-01   -1.439424379043622e-01   -5.752869543496700e-01   -1.481343747626458e-01   +9.050971655077231e-02   -3.345427968378895e-02   -3.593980169915089e-01; -1.672785122979432e-01   -2.045727666301143e-01   -6.446633270694101e-02   +3.177145246081153e-01   -1.842033357554369e-01   -5.085168660150888e-02   +9.182895670492480e-02   +7.450765374957308e-02   +8.856099008551230e-02   +1.788195664036815e-01   -7.199388977299731e-02   +3.292734921382705e-01   -1.733259656092561e-01   -3.125124592288781e-02   +1.201719364371076e-01   -3.565590388333976e-01];
L2I_L1I_iGABA_netcon = [+2.496641165410474e-01   -1.186230549788695e-01   +8.292283669120812e-02   -2.133896506497511e-01   -7.058280437304850e-03   +3.439149504518851e-02   -1.686253818214642e-01   -1.261587538493140e-01; -2.214608464480469e-01   -1.975666762209078e-01   -1.513817903254415e-02   -5.103513675461988e-02   -1.744401935115344e-01   +2.450122719061382e-01   +1.587410456211775e-01   +2.262772871816865e-01; +1.394425245961108e-01   -1.633867928948627e-01   +1.054202545822512e-01   +1.138652209272845e-01   +4.326126391477512e-01   -3.653882365762692e-01   +3.648665314725103e-02   -9.154495408102466e-02; -7.542173420793380e-02   +2.479728962580506e-01   -7.342699595126356e-02   -2.838749886199147e-03   -1.067038698789823e-01   -2.413494841627482e-01   +1.450394508711764e-01   -6.845150864824456e-02; -2.325423809146815e-01   +4.664275977395247e-03   +2.858431386322368e-01   +1.136796876618085e-02   +1.934910075429510e-01   +1.981786041128157e-01   -3.747807814080840e-01   -2.369497300613112e-02; -5.170671772556859e-02   -2.769670264358542e-03   +1.654921552634956e-01   -1.566121547987806e-01   +1.185423873687562e-01   -5.495307718490942e-02   -6.144958744485765e-02   +1.056516548641440e-02; +1.932079368630537e-02   -1.315417677496456e-01   +5.464610269712409e-02   +2.793292953445867e-01   -2.208152718786330e-01   +9.937896140789772e-02   -1.078769383172178e-02   +7.325868942360435e-02; +9.265823306545962e-02   +9.472033834052088e-02   -9.073750128718727e-02   +9.964101094991559e-02   -1.306805182328623e-01   +1.786162710633826e-01   -5.571937793857092e-02   +2.362813146724679e-01; +7.427434624195947e-02   +1.066207070073001e-01   +2.931755678148331e-01   -5.172372760321727e-02   -3.841469043964259e-02   -2.034354667153597e-01   +2.302842977090304e-01   +7.999073348600766e-02; +1.868743334909601e-01   -1.244405324204522e-01   +1.044553205446004e-02   -1.253250413763338e-02   +1.878694739141966e-01   +8.131066848188245e-02   -3.140131667891429e-01   -3.134379434957389e-01; -1.069005081218390e-01   +8.895284884800830e-02   -9.766737919867299e-02   +1.855756971737668e-01   -9.272383152429718e-02   -4.974426395017308e-01   +3.398261751423429e-02   -1.671893178250668e-01; -4.706173871170594e-01   -2.408759025104596e-01   +2.913631830630226e-02   -3.805408205352491e-02   +1.190760890523877e-01   -1.109478019490679e-01   -1.299078193234005e-02   +4.929043368213941e-02; +3.844869553640066e-02   +7.919898737872541e-02   -1.545787726500651e-03   +2.270587017204271e-01   +4.968072562651007e-02   -4.105945267976335e-02   +6.688532481542640e-02   +1.312985544399766e-01; +1.258733168229521e-01   +1.341841669461676e-01   -8.224652546302194e-02   -1.155282035108466e-01   -2.766900250350393e-02   -4.512516344789989e-02   +7.292568525774377e-02   +2.965587308216446e-02; +1.391921549482357e-01   -1.497122983840487e-02   +9.291373799774325e-02   +8.220056790144850e-02   +2.239471802330677e-01   +4.616644725358107e-03   -1.633731894987007e-02   +7.847392574172628e-03; +9.658364001869098e-02   +1.391426706164483e-01   +3.226011708582098e-01   -1.681813244135306e-01   -2.841243406380385e-01   +3.115599232389310e-01   -1.537377145220723e-01   +1.059201457271104e-01];
L1I_L2I_iGABA_netcon = [+7.368206781881120e-02   -1.706032293140587e-01   -5.870114767432676e-02   +1.717488977248988e-01   +9.260924390788636e-02   -2.880300989880381e-01   -1.651432096963348e-01   +3.455509916274285e-02   -6.587293293239885e-02   -1.846121482389839e-01   -7.979499619765802e-02   -2.882033811348521e-01   -9.266864185435900e-02   +1.696598771562022e-02   +9.829953782479786e-02   -2.904795441158319e-02; -3.159144977867874e-01   -3.196422100899380e-02   +3.091573580906181e-01   +4.310259596481318e-02   +1.044607247791857e-01   +3.995100920441782e-02   -2.088760022377356e-01   -6.043016113957946e-02   -2.777207181989241e-01   -6.994591683773961e-02   +2.816088569226932e-01   +2.049948016995566e-01   +1.265737409091552e-01   +5.263968252476020e-02   -9.959253803792538e-02   +1.690842444209362e-02; -1.222939424258771e-01   -1.101723596027468e-01   +6.226362524712052e-02   +1.293178370260908e-01   +1.626131539639165e-01   +4.433967071109487e-02   +3.291737144084971e-01   +2.283780052963802e-02   +4.000987460541551e-02   -2.475725054502844e-01   -4.465661568401439e-01   +1.674703473037231e-01   +2.600540731017454e-02   -1.158938508953588e-01   +3.208692060179550e-01   +3.500312715654889e-02; +1.180416432140487e-02   +4.770966129262219e-02   -8.434404532416592e-02   +6.156507337898245e-02   -4.897887871392344e-03   -2.997847643770910e-01   +2.328135715554968e-01   +2.009042934244366e-02   -1.031660504170682e-01   +5.370839953548252e-02   -3.105680238990507e-03   +1.473421472361496e-01   -1.092331210187741e-01   -7.854856542629310e-02   +9.589923927647989e-02   +1.957100421857638e-01; +4.043951712741023e-02   +2.311771577630656e-01   +6.799565229342883e-02   -2.473756283347220e-01   -2.434433658359926e-01   -3.046631957308901e-01   -2.974305787607414e-01   -4.982367221650490e-02   -7.574628766238625e-02   +5.840659358873512e-02   +3.764147254751470e-01   +2.114516552935838e-01   +4.067431001880550e-02   -3.587698216811658e-02   +1.036646410643626e-01   -1.826793521121283e-01; -1.540436677908693e-01   +2.808400851202001e-01   -6.934000362667486e-02   +3.601443461943191e-03   +2.195815340062215e-01   +2.357213866484534e-01   +1.993460908314937e-01   +9.968717798441866e-02   -8.706443935032468e-02   +1.333312699609976e-02   +3.758806395860371e-02   -7.056736398676174e-02   -3.550854909565919e-02   +7.470118131940975e-02   +1.964678118663679e-01   -1.623593915063490e-01; +3.761186443867746e-01   -5.342907542708378e-02   -1.760247824927175e-01   +1.904898365412284e-01   -1.742486714014435e-01   +1.411566546634160e-01   -1.166980794068834e-01   -8.780755561508265e-03   +3.384480873472018e-01   +2.070594671412739e-01   -5.660682700640912e-02   +7.422159266530652e-02   -3.485935375629288e-01   +4.645897312067995e-02   +1.458897246161565e-01   +1.860019753129217e-01; +1.187135304627181e-02   -4.311192738386664e-02   -2.602884747057341e-01   +5.607669756636083e-02   +3.144551041539271e-01   +6.270281564237579e-02   +5.467201887987740e-02   -1.342920534959084e-02   +1.362936869623639e-01   -1.108136275463114e-01   +8.868079766520537e-02   -2.031058162423740e-01   -3.804258221664047e-01   -1.545640287351434e-01   +2.630574279954866e-02   +2.129764384829716e-02];
L2E_L1E_iAMPA_netcon = [-1.492790841924002e-01   +4.741649153176457e-02   -7.557378972768095e-02   -2.787856535495342e-01   +6.846770466472825e-02   -6.411305206738978e-02   +1.946558563506177e-01   -2.432441886108108e-01; -1.439937499448014e-01   -9.632013229280742e-02   -6.723432495284491e-02   +3.185036901527608e-01   +1.623285173000920e-01   -1.580590694053660e-01   +1.833059062344266e-02   -1.259254467420018e-01; +4.032518877514593e-02   +1.831238106003372e-02   -2.988541388870570e-01   -2.163985509792939e-02   +2.866221965257991e-01   -2.788064042419016e-01   -1.574102460956531e-02   +3.678138858282230e-02; +1.346009671008755e-01   -7.079295196804683e-02   -1.364234615653755e-01   -2.726819136176116e-01   -4.727109652900052e-02   -1.115730270268429e-01   +7.840997119152013e-02   -2.065447076969874e-01; -1.559827947104062e-01   +1.883372284042735e-02   +1.115951034469909e-01   -6.879064068662213e-02   +6.530403856844066e-02   +1.182894560205223e-01   -1.089450990703156e-01   +1.125487115928580e-01; +2.249990287917857e-01   -1.667456589501686e-02   +1.137675545157097e-01   -4.518915102654077e-02   -5.502931871357383e-02   +8.641283570456934e-02   +1.465461140165075e-01   -3.590882105330696e-01; -3.147758840339870e-01   -8.461619278794974e-02   +1.419652463793490e-01   -2.892289771485924e-01   -1.997785179366497e-01   +1.871147679782362e-01   -2.830429231846474e-01   -2.059640354585708e-01; -1.830766027371147e-01   +1.630513838202809e-01   +2.454116642662576e-02   +8.221751440880429e-02   +1.041779577908439e-01   -1.775827537479975e-02   -1.115540607303204e-01   +2.313354647511051e-01; +2.248084541265321e-01   +1.504725758508842e-01   -7.727669738794957e-02   +4.945593357558885e-02   -5.701161509065080e-02   +1.103698361345953e-02   -2.158934299396468e-01   -2.455250535042855e-01; -2.692961930598636e-02   -2.417645929978647e-01   -2.677641205726141e-01   +6.614164106189743e-03   -1.756379354527172e-01   -2.333919292563748e-01   +9.485534847651139e-02   -5.680116286507303e-02; +1.467750398628602e-01   +2.332173232382554e-01   -1.005131974539855e-01   +2.239832066909664e-01   +4.098252820570100e-02   -1.875124634238753e-01   -1.112399088040018e-01   -1.468893614770920e-01; -2.470636139472919e-02   -1.606819046405116e-01   +1.477197253600889e-01   +2.253322362587677e-02   -1.791257357655135e-01   -2.545829215077969e-02   -7.097021384620260e-02   -3.819913833226526e-01; -1.516389847720247e-01   +2.760568643467299e-01   -3.487956320784822e-01   -3.902001925887958e-02   -1.786394312971804e-01   -7.446659298086467e-02   +1.679577674504021e-01   -4.484507292034675e-02; -5.278680972773377e-02   -1.969519328021603e-01   +2.920400645619856e-02   -8.391868978135346e-02   +3.515257241641818e-02   +1.438805434995964e-01   -1.482733615593490e-01   +7.305391599418375e-02; -1.421478465921747e-01   -2.388917819029750e-02   -2.047998751084421e-01   -9.688083048724119e-02   -1.249544092780417e-01   -1.032594098365362e-01   +1.145771450417989e-01   +2.494165118997602e-01; -3.337721472947500e-02   +1.304526198056950e-01   +2.682039937462983e-01   -1.765673736134064e-02   +1.371236865643035e-01   -1.234031317393611e-01   -5.406589095930666e-03   -1.895400937403059e-01];
L1E_L2E_iAMPA_netcon = [-1.819448695906037e-01   +1.813730205300204e-01   +4.285754448292063e-01   -3.103006078629497e-01   +1.273623937817762e-01   -1.863571279093080e-02   +3.360982942256138e-01   -2.657764777067273e-01   -2.397152024851001e-02   -6.421595965504695e-02   -3.351547031233648e-02   +7.980243623985256e-02   +2.521511051854574e-01   +6.857682807044452e-02   -3.218028934340060e-01   +2.785300194272093e-01; -1.167199924615939e-02   +8.057946886211309e-05   +3.403378278236828e-01   -4.577441815078881e-01   -1.551857644028229e-01   +2.060930052624769e-01   -1.094743308263019e-01   +5.627289047441104e-02   +6.078118105566412e-02   -3.785102158991090e-02   -2.605896565520094e-01   +2.116123742514210e-02   -3.636024144482961e-02   -4.692620412638200e-02   +1.079373782239196e-01   -7.212795867312317e-02; +1.288226120804647e-01   +1.974549910917554e-01   +5.109697658772669e-02   +2.175686803597214e-01   -2.826883305847526e-01   -2.649379384847385e-02   +1.365665739977103e-01   -5.072278105459196e-03   +8.226455493088809e-02   -4.515173715206016e-02   +4.012142557669691e-01   +6.361728903670796e-02   -6.638414064279999e-02   +2.860405614592325e-02   -1.180651897210373e-01   -1.375815383437822e-01; -3.254509530788335e-02   +1.937645634958130e-01   +1.841836741582485e-02   +7.468894285315981e-02   +1.537684077291260e-01   -1.145855891095814e-01   -7.573466584421214e-02   +3.213754660929816e-01   +7.184023972359915e-02   -8.203204061830284e-02   -1.213374917598848e-01   -2.520282463254314e-01   +2.790292951684328e-01   -7.395853488312674e-02   -1.914635251517774e-01   -1.101765815324559e-02; -1.517168394198407e-01   -1.355935775967829e-01   -3.035961630825079e-01   +6.036299872550213e-02   +2.386022659411886e-01   +1.666474953724052e-01   -2.156662439493756e-01   -1.024736502440680e-01   +5.645191921430649e-02   -1.141200260464910e-01   -2.957609842391458e-01   -3.167048501429943e-01   +1.955720969594280e-01   +3.198062635210931e-02   +4.496866368829926e-02   +1.213117044347719e-01; +2.591949826243004e-02   -9.258237466942651e-02   +5.336440215710830e-02   +2.251611566634174e-01   -2.056663585420515e-01   +8.616475333133303e-02   -1.173274049041069e-01   +6.579390173139096e-02   +1.740482688992705e-01   -2.558983299989956e-01   -5.311464932396742e-02   -2.182530223343626e-02   -3.145769327292344e-02   +1.023847182833637e-02   +9.506643882103932e-02   +3.086195898506868e-02; -8.394061348740905e-02   +1.056037295609078e-01   +1.319837492038838e-01   -1.592040393905372e-02   -2.921035325071214e-02   -1.763793318191624e-02   +8.772651811140678e-02   -6.226587282218754e-02   -6.091587696402068e-02   -1.826216225405661e-01   -1.301136856965919e-01   -1.965876651422282e-01   -3.631520196875683e-02   -1.418767863915725e-01   -1.400417106847168e-01   -3.451031018299714e-02; +1.152266246353544e-01   -1.532964032309940e-01   -3.908809074483047e-02   +1.682242526310310e-01   -1.548328397653389e-02   +6.245610927548843e-02   +1.650460325528413e-01   +1.528846209164321e-01   +3.301923427325835e-01   +2.271271723518493e-01   -3.815761532912385e-01   -2.233036699278198e-01   +5.427896294843578e-03   -3.788178811525705e-01   -1.878367502237272e-01   -9.036536138778296e-02];
L2I_L2E_iAMPA_netcon = [-2.908142543501803e-02   -1.159929779789384e-01   +1.918339487939504e-01   -1.736042137520348e-01   +1.609647422926304e-03   +2.995174159813244e-01   +1.588031546886176e-01   -1.717878465785361e-02; -9.953043711366551e-02   -7.948223629620613e-02   +2.659539951050649e-01   +1.543125410149021e-01   -2.020986506688068e-02   +2.160641115449020e-01   -2.464580590569539e-02   +1.460933290912580e-01; -4.782614233002500e-02   +1.085140447385630e-01   +1.397980525896245e-01   +3.909390105367439e-02   +4.158914130036948e-02   +9.898514961034241e-02   +4.823175786250539e-02   -1.171009345383901e-01; +3.284073010769946e-01   -6.751918152256982e-02   +4.454954986371483e-02   -1.147686327005933e-01   -2.769154387930117e-02   -9.002749897477112e-02   +1.224004096671370e-01   +8.126028702436518e-02; -1.159823969626012e-01   -1.350567117258155e-01   -2.364114578689702e-01   +7.877813022265991e-02   +5.677670811704805e-02   -1.920900821875377e-01   +1.432910291786607e-01   -8.766890243161564e-02; +7.145449749189346e-02   +5.680557163117152e-02   +2.046449708692918e-01   -6.065696135241292e-02   +1.417638017634993e-01   -3.515659211527995e-02   +2.117151046167636e-01   +2.436355219298426e-02; +3.159243850379944e-01   -3.369128231167862e-02   -9.100154713378851e-02   +1.319062253782188e-01   -6.593901045719040e-02   -3.155844711144247e-01   -6.383505202269703e-02   +1.338798393773949e-01; -4.532227018856819e-02   +1.808816712071316e-02   -1.191465922355423e-01   -3.293828613996058e-01   +1.003815041199640e-01   +5.115016904345344e-02   -1.878805243347149e-01   +1.300500872347712e-01];
L2E_L2I_iGABA_netcon = [-3.133823212212457e-02   +2.369080001095975e-01   +3.156470623455414e-02   +1.482302034663708e-01   -1.792861396153546e-01   +1.333630385661899e-02   -2.284498421653146e-02   -1.748922253044433e-02; +2.131142202071827e-01   -1.446960678094901e-01   +1.089719007776533e-01   -3.725003733790402e-02   +6.567419226200508e-02   +6.445945155751939e-02   +5.132575569707891e-03   +1.523505105166652e-01; -1.119649065292639e-01   +1.551060930041567e-02   -2.836228776635615e-01   -7.242670304205134e-02   -2.052255876160929e-01   -1.869073792566354e-01   -3.577954927683053e-01   -1.020145138726311e-01; -7.613544438876460e-02   +1.593417927474358e-01   +7.057803644752501e-02   +2.981055116249751e-01   -1.525920815585653e-01   +1.350052026409864e-01   +4.105341976451603e-02   +3.382178110688033e-01; +8.571186462711747e-02   +2.372821965456222e-02   +1.203962126478380e-01   -2.867627508320363e-02   -4.027531509423508e-02   +4.851820886428188e-03   +1.150094773052437e-01   -2.875240346486117e-01; +2.995107602092001e-02   -5.917958145791382e-02   +2.237325798127313e-01   -7.269916775019475e-02   -5.217182122506721e-02   +2.417931016086834e-01   +3.662666377541174e-03   -4.250413967789587e-02; +8.715574555643057e-02   +1.843974978595751e-01   +8.779479949471662e-02   +9.619341722090798e-02   -1.055093397083372e-01   -1.207504978910091e-01   -7.063209002010332e-02   -2.946915067097792e-02; -4.536758546722855e-02   -2.980254547211766e-01   +2.979790213609274e-02   -5.878538162047479e-02   -1.657563758214776e-01   -1.938281507903880e-01   -5.124600599611142e-02   +1.389946641798110e-02];
L3E_L2E_iAMPA_netcon = [-1.557001804205137e-01   +1.517679296280332e-01   +1.051089634405008e-02   -1.071129910541211e-01   -1.716165565765992e-01   +2.683847653172551e-01   +3.692293861450866e-02   +5.782456183381200e-02   -2.093618913634377e-01   -8.261577472477334e-02   -3.518909107860786e-01   -3.459055800774394e-01; +1.089201408716341e-01   -3.212967704386339e-02   -7.336456947528983e-02   +2.540170748360706e-01   +1.907389155723816e-02   -6.418759389284330e-03   -7.221524107521747e-02   +8.039212239692016e-02   -1.964867356435250e-01   +8.403481115325176e-02   -5.050223781526234e-02   -2.054388726294763e-01; +2.416467952927908e-01   +5.642586397853144e-03   -7.994795396194994e-02   +1.830962175170511e-01   -1.228054664140333e-01   -2.791499982730902e-01   -2.075380899628920e-01   +3.772995741242004e-01   +2.677970717199682e-01   -2.064006023991925e-01   -1.570632681495097e-01   +5.430934556834052e-02; +1.558748356281661e-01   -3.528958281393729e-02   -3.582270851063614e-02   -2.196559278194108e-01   +2.294167928786215e-02   +3.390725617693217e-01   +1.857283979514832e-01   +2.159843225797326e-01   -1.985738810811634e-03   -1.763252742503457e-01   +2.176911761227151e-01   -1.784247050696948e-02; +2.296717342330432e-01   +1.125212754421349e-01   -3.021431282390085e-02   -1.637358206731582e-01   -2.287778732065927e-01   -9.021217776935367e-02   -1.058671469117566e-01   -1.008954161818874e-01   +8.422181281644808e-02   +2.922778310416164e-02   -1.604875084691217e-01   +9.748618530187020e-02; +5.619675265693367e-02   +4.117818665340942e-02   +4.381276638625544e-02   -3.057248410494573e-02   +2.773102190999714e-01   -1.075486044673628e-01   -1.806359991946598e-01   -1.479759460434290e-01   -1.444747365757355e-01   +9.815439441163942e-02   -1.424719232825175e-01   +1.770386775909774e-02; +1.106779253726266e-01   -8.865574308568225e-02   +1.090241377504639e-01   -1.539941721380472e-01   -1.031819166158530e-01   +1.233141879773739e-01   +1.989056020162750e-01   -2.097052541656277e-03   +3.736611741579835e-02   -1.126868374475656e-01   -2.601301312745765e-02   -5.871300086498120e-02; -3.384685553778701e-02   -1.115303974736760e-01   -5.263506746021858e-02   -8.762645354417573e-02   +7.709793835164905e-02   -2.709756614163311e-02   -1.424503109112486e-01   -1.726083662584751e-01   +1.469503544253260e-02   -1.784920884868292e-01   +6.806967068473545e-02   +1.365186360154529e-01];
L3I_L2I_iGABA_netcon = [+1.555528272570431e-01   +1.162712051159750e-01   -1.016975206380073e-02   +3.369112576524069e-01   +1.786898461934705e-01   -1.730824832518896e-01   -1.580214124637132e-01   +2.263068251695445e-01   +1.728226894552466e-01   -6.563073407559306e-02   -5.048133715938768e-02   +2.005333917430781e-02; -7.944892129106695e-02   -3.057549903692401e-01   -4.916683593836972e-02   -2.078103288440527e-01   +4.601435920908334e-01   -6.324927358956867e-02   +3.150395896255301e-01   +4.052988955277201e-01   -7.616561226977120e-02   -2.254599443446720e-01   -1.418963069450182e-02   -3.496444939698456e-01; +1.244918559496751e-01   -2.159674887887328e-01   -3.618553835362943e-01   +2.676368547894064e-02   +7.951464111687753e-02   -1.144668819352146e-01   -7.091911532849293e-02   +4.855257164147396e-02   +2.786985578952317e-02   +5.512653670548726e-02   +1.914536254293836e-01   +1.574396005170223e-01; -6.251507333520334e-02   +9.625452476401042e-02   +1.115349572905634e-01   +1.834377427848781e-01   -4.942038155640077e-02   -1.590235556978062e-01   +8.375450637708605e-02   +1.358205369391995e-01   -5.729016674458152e-02   +1.277712614485763e-01   -7.429709252616419e-02   +1.240295739205491e-01; -1.188474636273576e-01   -1.501092343522081e-01   -5.847457622814475e-02   -7.062929031004780e-02   +2.376233961639736e-02   +3.015785864537717e-01   -2.393484550606642e-01   -4.624803131250849e-01   +1.555377119107584e-01   -2.302568963302304e-01   -1.216502590913968e-01   -3.160191976112801e-03; -5.465828130801793e-02   +5.558848016497894e-02   +1.400153067590878e-01   +3.863138536236849e-03   -1.151388857874117e-01   -2.435068690712262e-01   +1.446546721360626e-01   +2.553296408321367e-01   +3.024167308071867e-02   -5.705656477674474e-02   -9.473239900026263e-03   +1.023073260979024e-01; -1.848474251902029e-01   -8.495101627704206e-02   +2.150094135984778e-01   -7.715962571759427e-02   +2.380513181283400e-01   +2.375867903784722e-01   +2.200930344424382e-01   +1.522372566567347e-01   -6.076472168468136e-02   -2.076736203738934e-01   -1.349064012212116e-01   +5.903347931170101e-02; -2.542821857771946e-02   +6.092999696073979e-02   -2.540635846161300e-01   -1.815596102673626e-01   +4.180418265815186e-02   -9.098667477265600e-03   +1.231157996849753e-01   +6.524784585107801e-03   -6.396521119291748e-02   +3.254073533601670e-01   -9.938693784294392e-03   +1.137978579579293e-01];
L2E_L3E_iAMPA_netcon = [-1.717493120960246e-01   -6.779319690476404e-02   -4.440824508724999e-02   -9.355815824114000e-02   +1.049787050517988e-01   -3.203186179807551e-01   -8.393291781206873e-02   +2.462702760273351e-01; -7.897822283299590e-02   -1.864873438032424e-02   +1.929784229207616e-01   -1.210072393119018e-01   -1.849903115046792e-01   +2.188137531305252e-01   -1.823697760430217e-01   +1.711379876613703e-01; -1.086093162075626e-02   +1.064054276421717e-01   -5.189317408463121e-02   -1.840899332033088e-01   +3.289798196322957e-02   -2.219470914760429e-02   +8.291400691216771e-02   -8.501465060170543e-02; -3.187850921928642e-01   +4.990665052525974e-01   -1.850487447844625e-01   -1.577724011867915e-01   +2.007719791748651e-01   -1.206051498427095e-01   -1.812693632389791e-01   -1.091771854831640e-01; +1.750575962794591e-01   +2.936485499707269e-02   +1.252155457334897e-01   -1.263867153139953e-01   -1.733499444886550e-01   -1.102333882660302e-01   +6.413598067773607e-02   +2.168678915773215e-01; +8.914540707274454e-02   -1.833391093227688e-01   +8.496772828991021e-03   -2.330360715513983e-01   -2.863658918823966e-02   +1.547196807755722e-01   +2.087859251217239e-01   +1.713422747841757e-01; -1.920057297673633e-01   +3.011611805691048e-01   +5.956163026096069e-02   +2.670615463064115e-01   +1.886047571769317e-01   +1.967144221765269e-01   -1.540551897749584e-01   -1.392348773085338e-01; -8.290097458910090e-03   +3.893693722427988e-01   -2.654156574650975e-01   +5.129023179965096e-02   -1.476873375393117e-02   -2.013467797212900e-01   -1.015105105450252e-01   +1.193583907679961e-01; -2.934645796835951e-01   +1.013655403046021e-01   +2.579719108884193e-01   +1.776533327282457e-01   +3.180443131089924e-02   +6.243675367550113e-02   -9.414333720366534e-02   +7.349173396308607e-02; -2.007418961467259e-01   +7.105584646150921e-04   -2.463951081563726e-01   -3.087887825837916e-01   +1.148064947074546e-01   +2.075593439408481e-01   +3.442221073591432e-01   -9.968858696054891e-03; +2.323737344663867e-01   +1.585173063650148e-01   +8.688794655205020e-02   -2.869823150566252e-01   +1.156514285298143e-01   +9.151569876561989e-02   -7.382063306906833e-02   -1.957244404357103e-01; +1.091407733748585e-01   +5.436914381355378e-02   +1.003718224221480e-01   -3.434655784283111e-01   +8.850634063399095e-02   -8.788185772194460e-02   +1.347344098758040e-01   +7.035083919681234e-02];
L2I_L3I_iGABA_netcon = [+2.266997993539606e-01   -1.442235874163647e-01   +1.678214879065932e-01   +3.428948377294301e-01   -9.202313883342209e-02   -3.707023274206074e-02   +2.182484457897977e-01   +3.588755915986397e-03; +1.939127129339900e-01   -2.412959441869172e-02   +2.501590451012780e-01   +1.246119134244147e-02   +2.488805776166997e-01   -2.125776733916631e-02   -3.149835938716563e-01   -1.887535766909449e-01; +1.085530441982946e-01   +1.257228999615290e-01   +5.532678097420743e-02   +1.231838282231922e-01   +2.489131971993443e-01   +7.297844920438429e-02   -1.292039103600547e-01   -1.545298514673272e-01; +9.762489035147000e-02   +2.022935088496575e-01   -1.672555094232343e-01   +3.736236001798811e-01   -1.955198980792664e-01   +1.618350144946936e-01   +8.565128681210794e-02   +8.178705252833612e-02; -1.329531946600438e-01   -3.186923265628290e-01   +9.190644500458874e-02   -9.951307385622936e-03   +2.568641348347244e-02   +1.426867725134382e-01   -3.515910686785012e-01   +2.051337735874053e-02; -2.442505871430512e-02   +2.335378813816976e-01   -1.377683449856980e-01   +5.102649931590088e-02   +2.052107876217721e-01   -4.974751266199164e-02   -2.692429214423544e-02   +9.908316146979727e-02; +2.294534188820372e-01   +8.436755126876820e-02   -1.191201660547541e-01   -5.622584553983360e-02   -4.587057785440873e-02   +9.524821099715700e-02   -2.089847422970249e-01   +1.113946403607169e-02; -8.444388161958527e-02   -2.081676368410343e-01   +1.150710622046738e-01   +4.245036654040658e-02   -1.413441655092567e-01   -5.676563170729458e-02   +2.604959313217324e-01   +9.915217233618372e-02; -1.663643206863930e-01   +1.705824056742785e-01   +1.024265157077099e-01   +1.471067052747744e-01   +1.689922405953656e-01   -1.654896349140460e-01   +3.531805146297307e-02   +2.467360416386783e-01; -5.598305459642889e-02   +1.408380728789710e-01   +2.884969020407440e-01   +2.927382965337084e-02   -1.169311018973440e-01   +1.082040798850161e-01   -1.454091418881691e-01   +1.177990711047492e-01; -1.669581751796643e-01   -8.481645869349939e-04   +2.460726428612665e-01   -1.681357202374137e-01   -1.495823267331907e-01   +1.606574825518368e-01   -2.188674691183869e-01   -6.451658643523345e-03; +4.934144616867463e-02   -2.417030921917902e-01   -2.827598304079438e-01   +1.483690518066585e-01   +6.828635169095365e-02   -9.360543090752485e-02   -3.220194453777692e-02   -1.261840658145399e-01];
L3I_L3E_iAMPA_netcon = [-2.968905236335648e-01   -1.096036294025837e-01   -2.749781500089462e-02   +2.054539229308752e-01   -1.647213367052096e-02   -1.448346487543026e-01   +6.335389396986030e-02   -2.178600805786081e-01   -1.425662191141776e-01   +2.621909365749235e-03   -1.767513523105736e-02   +5.031734908776628e-02; -1.586800344278755e-01   -2.508687968997711e-01   -9.610838770111263e-02   -3.040567308287029e-02   -1.223264883813094e-01   +5.427164014436439e-02   -2.353169799633644e-01   -1.262219553380855e-02   +7.148222708483351e-02   +7.927408622921646e-02   +6.235017041720831e-02   +9.593670774126997e-03; -1.835092923317011e-01   -1.582017347867419e-01   -2.813557848283747e-02   -3.184445228199691e-02   +8.139719125645647e-02   -2.483666533521690e-01   +8.054469759522839e-02   -7.298461631385370e-02   +1.904402179467258e-01   -1.762100200869175e-01   +3.256234851815564e-02   -1.902162821087944e-01; -2.287725251220808e-01   +2.246131029689801e-01   -5.909992136830153e-02   -1.612012212223292e-01   -9.365773856211887e-03   +1.610846397019422e-01   -1.954875437692752e-01   -6.852993104621773e-02   -4.027416677815315e-01   +7.080609609491027e-02   +1.800563063512929e-01   +5.488977640961032e-02; -1.454840755714326e-01   -1.553993530081705e-01   +1.998989653675113e-02   +3.611382355063890e-01   -1.101630085398567e-01   +1.147503820160514e-01   +1.098702903564149e-01   -5.939577913186017e-02   +2.915929067584964e-02   -1.159027758106043e-01   +5.189332662020506e-02   -1.346934126575370e-01; -2.699747622394552e-01   +7.000878254973429e-02   -3.218789841630807e-02   +1.480957297355354e-01   +4.980908587535394e-01   -1.009921469946190e-01   +1.121913614614235e-01   +5.599079513138326e-02   -7.256207401706098e-02   -1.904746458818156e-01   -4.484664031136247e-01   -7.147409112867446e-02; +4.368781298672039e-02   +2.707831194096987e-02   +1.835172503061930e-01   -5.915235545168015e-02   +5.064740974652949e-02   +1.445236272005367e-01   -1.619586811871844e-01   +6.396984695190976e-03   -4.731845180203901e-02   -3.445213555907941e-02   +3.027413558079743e-01   +2.810377745474184e-02; +4.413442519894251e-01   -2.108177372428833e-02   +1.349206270858537e-01   +1.280661699886482e-01   +4.508500105113554e-02   +7.188663682757694e-02   -3.348809291140025e-01   +7.194942126973725e-02   -2.984202826399832e-01   +1.744215124423008e-01   +4.735986644753228e-02   +1.764772835808154e-01; -4.775998150511086e-03   +3.161795906453084e-01   -6.944402230283021e-03   +3.016607066354064e-02   +6.774941318491547e-02   +8.664378588115820e-03   -1.171970351547623e-01   +1.108280005987985e-01   +2.402090656535584e-01   +1.709787954781735e-01   -2.492437409610010e-01   -2.755653672973086e-01; +2.181727429853525e-01   +1.938259368714890e-03   +2.161585710332264e-01   -6.566158412744028e-02   -4.642445226689909e-02   -1.232456032540258e-01   +7.665420001703580e-02   -3.304946804268137e-01   -9.082556794877152e-02   -1.112454097607239e-01   -3.793316967171531e-02   -2.347474784351720e-01; +2.443358612412094e-02   +1.554872187124737e-01   -8.082604135877022e-02   +2.468742497540475e-01   -8.741335045755325e-02   -8.806568547912860e-02   +1.692305340220565e-01   +1.815611076937823e-02   -2.905960177821000e-01   +1.661019907531303e-01   -1.635710621168480e-01   +5.786446453144898e-02; -3.831421328227609e-02   -1.009493318302306e-01   +1.604990830152777e-01   -5.448265736947837e-02   -3.414822134969362e-02   +1.244490323761726e-01   +1.444189035049643e-01   -1.816692701394713e-01   +8.146451338328305e-02   +2.006001422038039e-01   -6.136330850816767e-02   -1.141712706919062e-01];
L3E_L3I_iGABA_netcon = [+3.226586500883302e-01   -2.397727297960126e-01   +2.883376899253947e-01   -6.815452230556029e-02   +2.194928406994374e-01   +7.683237710920685e-02   -6.256454695401359e-02   +2.565208612959658e-01   -2.768497408701584e-02   -1.464471997400572e-01   -5.656894282429124e-02   -1.386763254063082e-01; -2.240808707382059e-01   -2.010194609691540e-01   -8.837588841366173e-02   +1.287949965395056e-01   -1.698945352494837e-01   -8.660672423552349e-02   +1.660620125528821e-01   -1.005556737818322e-01   +4.003684605980839e-01   -7.411936347483453e-02   +5.739877305306292e-02   -1.006272004701182e-01; -2.729202015599166e-01   -1.412496200660728e-01   -2.155197762930207e-01   -1.095146274243827e-01   +6.077710859734954e-02   +1.770675835420953e-01   -4.432534357267984e-02   +1.072378328458806e-01   -2.130553265146344e-01   +3.392479275494313e-03   -4.084157971895022e-02   +2.556160647834703e-01; -1.445742227000606e-01   -1.732183923106789e-01   -1.421063060808997e-01   -5.613177026449618e-02   +2.489464344888818e-01   -1.081524386877148e-01   -1.428456210656926e-01   -1.047478604125559e-01   -1.711941738392611e-01   -1.834491134487196e-01   +9.812319261992150e-02   -2.863977808304590e-01; +1.644557537823993e-01   +5.190214520144767e-01   +2.900982909616430e-01   +1.599972624810971e-01   -1.822246464959281e-01   -6.043227523553513e-02   -1.462306046141094e-01   -3.226141056000965e-01   +1.789747098913835e-01   -1.202310387196870e-01   +6.179775047135486e-02   +2.228724606635384e-02; -2.533576359353547e-01   +1.298450487303275e-01   +1.333930744981601e-01   +1.009560576936993e-01   -1.088798819990327e-01   +2.046467874244357e-01   -3.312756461321592e-02   +4.227660833873927e-02   +9.293482207983152e-02   +3.602608882547933e-01   +3.670509446636317e-01   +3.502797283150306e-01; -9.859991552736551e-02   +1.104304474512305e-01   -9.578358211223489e-02   -1.021243403328281e-02   +2.866106109178647e-01   -1.091698536516407e-01   -9.382245677622372e-02   +1.196181633411532e-01   -3.071213894831884e-01   -1.892589258681543e-01   +5.820567463004850e-02   +9.491154185556552e-02; -1.706860604332303e-01   -9.934175609152056e-02   -8.525695979010899e-02   -1.067790210579191e-01   -1.511186721576840e-01   +2.968722930444173e-01   +9.342890432985376e-02   +2.019233732600318e-01   -2.570879086255476e-01   +1.716881548718562e-01   -1.845420930561222e-01   -3.146669805935373e-01; +2.394624577494931e-01   +2.644517906908951e-01   -5.721612241506387e-02   -9.841954706141415e-02   -4.032950890532930e-01   +7.096354778136843e-02   +1.134145268483194e-01   -5.085605477748500e-02   +1.173679050756933e-01   -3.502293503685679e-01   -2.339725099537945e-01   +1.466360606897540e-02; +2.932027254619108e-01   -1.784745809771534e-01   -1.575942461531499e-02   +2.855785444459000e-01   -5.777236888959951e-02   -4.666192618176672e-02   -1.808079011626184e-01   -2.279365148472685e-02   -2.632582805870191e-01   +1.289282413547229e-01   +7.987126399112782e-02   +2.752297849384456e-01; -1.622248502781238e-01   +2.322416229293801e-01   +1.283695447247410e-01   -3.224030420466324e-01   -9.610412375061651e-02   +1.388397848444986e-01   -2.929571976452300e-01   +4.217557628176911e-02   -1.943579228438696e-02   +7.958360701994513e-02   -1.265679349615326e-01   +3.402913181545748e-02; +3.915102632340629e-01   +3.342173781947445e-02   -5.676237970386590e-02   +3.602764513041575e-01   +3.589275043164939e-02   -8.928772232959609e-02   -2.570520788123531e-01   +4.144614968529240e-01   -1.384354348867795e-02   +9.135798203470404e-02   +2.949566295073687e-01   -1.248457390873977e-01];
L2E_Input1_iAMPA_netcon = [-2.696364424593436e-01   +1.878391072259724e-01   -7.537625595830495e-02   +6.073971475411494e-02   -2.466834020093537e-02   +1.343311630028129e-01   -1.239854877065791e-01   +2.695644605435412e-01];
L2I_Input2_iAMPA_netcon = [-1.170815209614261e-01   -9.533394878372969e-02   -1.148516712830061e-01   +9.288491063668897e-02   -1.929737714450534e-01   -2.918671604247753e-02   +1.057506848892262e-01   +1.440118973928025e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
