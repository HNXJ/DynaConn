function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.442291718789042e-01   -6.423069681490453e-01   +1.664407848756392e-01   +2.213628848828222e-01   +1.666786760886198e-01   +1.417365556965250e-01   -3.116059739183559e-01   -1.630617448463451e-01   +3.811497522183402e-01   +6.548770186601741e-01   +3.689785728458919e-01   -2.775318221762933e-01   +5.719115941913846e-01   -1.710383483553977e-01   -4.617600050680878e-01   -3.023036460030610e-01; +3.267237830536360e-01   +4.765766673050269e-01   +2.619608242539237e-02   +3.735294472836002e-01   +3.140754029390787e-01   +6.808940399227411e-01   -5.573172676377531e-01   +8.263559954224887e-02   +9.590431636410560e-02   +1.272966529481797e-01   +2.867276464948876e-01   +3.342754706801673e-01   +4.653302878758367e-01   -2.177270015070029e-01   -1.135365805748971e-01   +6.635974002736984e-02; +3.317275540688419e-01   +8.935807748358507e-02   -4.365011010334754e-01   -1.066333506840626e-01   -1.834195088539746e-01   +5.353883149082337e-01   +6.891017111536725e-01   -3.233490462484256e-01   +2.462510150181221e-01   +2.459901056847263e-01   +7.554992248880420e-02   -2.100880528580141e-01   -2.164781125458245e-01   -3.889872272368874e-01   +2.856834554476501e-02   +6.682347892196143e-01; +4.938651080548683e-01   -2.399826198575239e-01   -1.009718805872068e-01   +3.765465475377414e-01   +3.408415409021662e-01   +6.746585692061942e-01   +6.609319965025567e-01   +1.267507326860575e-01   +2.697338178381566e-01   -1.044962132851465e-01   +2.161800305755232e-01   +2.104484798715687e-01   -3.703804435821589e-01   +4.174721764744372e-01   +3.827704638776595e-01   +8.389954295699980e-01; +5.585208658449501e-01   +2.569037962496822e-02   +7.423625681795776e-01   +2.350358903565722e-01   +3.437754150956714e-02   +2.387435974473265e-01   -8.036913503114651e-02   -2.415692328995075e-01   +3.156592462282807e-01   +2.913011626067255e-01   +7.758137221446131e-01   +1.313756137636763e-01   +8.736126731483446e-02   -1.158740058893783e-01   +6.978474183296575e-02   +2.246609725164525e-01; -3.947009765427077e-01   +5.400720668578483e-01   +7.686075844013960e-01   -4.450808239235868e-02   +5.469409197102654e-01   +1.311351858937671e-01   +3.493318466663781e-01   +6.125719587042430e-02   +2.773444999344068e-01   +8.448978278764571e-02   +6.639067444361234e-03   -1.018969646272229e-01   +5.910078687814143e-02   +1.107075396189800e-01   -3.164246996976146e-01   -1.469823462558825e-01; +1.544544219839613e-01   +3.190797023115677e-01   +3.861625294647765e-01   +3.189395013213600e-01   -4.996131089076823e-01   +1.052542328865569e-01   -1.340403973348955e-01   -2.643584703793252e-01   -7.758303680599198e-01   +2.567725611464046e-01   -6.153479030746212e-02   +3.409210381656193e-02   +3.513489319866960e-01   -2.350465381055863e-03   +6.215424903287747e-01   +2.927940543593258e-01; -2.121453208858660e-01   +7.281498754317371e-01   -3.760335892078200e-02   -3.824514496406243e-02   +2.170016960308737e-01   +1.951866980111738e-02   +6.093553391774458e-01   +1.734330280438316e-01   +1.720446119611911e-01   -1.782318480178626e-01   +5.916267371378538e-03   -1.043683803408110e-01   +9.171827363692743e-02   +4.798374809579691e-03   -2.036343612750519e-01   -7.208576143030193e-02; +2.310572222614170e-01   +5.627726923186954e-01   +6.953589866043718e-02   -2.839917509266164e-01   +4.213142690073339e-01   +5.260245922690509e-01   -2.506439945331221e-01   -4.281542054112330e-01   +6.062602846266985e-01   -1.852247991906890e-01   +2.740018237893007e-01   +1.727574622159643e-01   +1.791292350422352e-01   +3.392619639418652e-01   -2.249853027533993e-01   +1.766524968070301e-01; +4.575582698635012e-01   +2.926030053874205e-02   -2.072747108947042e-02   +5.477718176502711e-01   -9.027309792196764e-02   +4.590722052786116e-02   +3.760749762358964e-01   -9.727100001018787e-02   -1.757425110480511e-01   -4.445068435033461e-01   +7.223129377827805e-01   +1.438299983720332e-01   +3.702735598252272e-01   +3.538902593213936e-01   -1.221394354489874e-01   +2.299422436614740e-03; +4.435458800658388e-01   +8.152539600483627e-01   +8.179077437897760e-04   -3.249826308848099e-01   +3.471224267893329e-01   -8.186053291495608e-02   -1.201589450814236e-01   -3.536805286165711e-01   +3.973709097024914e-01   +4.743763745927214e-01   +1.103419238994607e-01   -2.323542229741440e-02   -4.797871724530898e-01   -7.572629245088967e-03   +1.856563581035312e-01   -2.158475889583998e-01; +2.969249703355089e-01   +1.117179417860217e-01   -3.454719926889701e-01   -6.464660192198352e-02   -2.072230763452963e-01   +2.734886891045420e-01   +1.861947168147715e-01   -9.478146738688027e-02   +1.547686176506745e-01   -6.133459855248568e-01   +2.439573370598639e-01   +3.674977258643957e-01   +5.712187817013605e-01   -4.181326875715636e-02   -1.694750014854654e-01   -4.526873053366459e-02; -3.778584600053970e-01   +2.654879842370323e-01   +8.094232006318359e-03   -1.953213822937495e-02   +5.440973915294919e-01   +5.947469049196720e-01   -1.902248147252249e-01   +2.710013286802028e-01   +3.592849632335776e-01   +6.806129347404478e-01   +1.282119426995237e-01   +2.854960283824070e-01   -1.350212934827726e-01   +1.570399988126983e-01   -4.756637908925577e-02   +2.858080125311709e-01; -6.059391663599268e-01   +3.246785598439973e-01   +2.467254208907110e-01   -6.739029905951726e-01   +3.155465566114694e-01   +1.333894179768551e-01   +6.906983684326033e-02   +3.606645792880789e-02   -5.756147588036195e-01   +3.772272464777655e-01   +5.747552782270586e-01   +2.986135037888931e-02   -2.286125442483264e-01   +4.907403375519358e-01   +3.902118577978880e-02   -4.910605087391521e-01; +2.843702983564496e-01   -1.311221581589400e-01   +2.798632530243243e-01   +1.954408166583523e-01   +2.336083948782320e-01   -6.977937496268244e-02   -8.699241748561611e-02   +3.233686317733757e-01   -2.095233110641353e-02   -1.786003626427630e-01   +2.838592908588440e-01   +1.282309450177515e-01   +5.924767982002895e-01   -9.921365783000299e-02   +2.435609937252518e-01   -8.887042909056506e-02; -7.883675440016550e-01   +3.762073773039373e-01   -4.357136908781890e-01   +5.919892737978294e-01   +7.608130104572021e-01   +5.807832152630360e-01   -2.901528359752052e-01   +7.349986817581252e-01   -6.791713171099020e-01   +1.980338925449812e-01   +1.986570668688140e-01   -4.416601283868127e-02   -3.382372551345829e-02   +3.178680783664297e-01   -1.770199790646442e-01   +3.401616278165494e-01];
L1E_L1I_iGABA_netcon = [-2.873993963058614e-02   +5.859196455437238e-01   -3.818774239446476e-01   -1.893517110215690e-01   +6.760271215509659e-01   -1.472443665486500e-01   +7.505188351838546e-01   +4.190354138841977e-01   -4.327339541108150e-01   -1.079109719749377e-01   -3.086516095832999e-01   +6.218942326966899e-01   +6.411983547607234e-01   -4.656704218314023e-01   +7.495276683101663e-01   +5.753250895376039e-01; -1.811820338853231e-02   +3.584762101964727e-02   +8.139310443634684e-01   -3.074102681988120e-01   +5.414138954837899e-01   -9.521546320441326e-02   +6.172209447778075e-01   +4.969618878862357e-01   +1.477485847647659e-01   +5.637710046948641e-01   +2.426162730093360e-01   -2.667747814702731e-01   +4.257332581570148e-01   +6.008918495985885e-01   +5.237522671841209e-01   +1.027333551518043e-01; +3.891783744457875e-01   +3.774023240417085e-01   -3.015930367359285e-01   +3.509461638969802e-01   -3.576661212262650e-01   -3.118999068683125e-01   -1.345110017673381e-01   -2.982855743526381e-01   +4.317274013756940e-01   +8.117419206496188e-02   -5.565155913934170e-01   +5.238040684801051e-01   -3.182631536092819e-01   -3.003840071387033e-01   +5.298764080727532e-01   +6.450521037799217e-02; +4.217442217512944e-01   -1.923864174319663e-01   -5.337074775951878e-01   +1.710883442630323e-01   +7.958181952524723e-02   -9.273143823876261e-02   -1.424080757399172e-01   +3.161151485780593e-02   +1.535097657209109e-01   +4.027738913274752e-01   +2.140667761847929e-01   +1.719558742556260e-01   -2.248503754695050e-01   +2.762126177934807e-01   +5.902260345605203e-01   -3.927314775170581e-01; -8.234737623976730e-02   +2.283380212386415e-01   +5.331566984744388e-01   -3.618729288130795e-02   +2.677524655163867e-01   -2.384266286541561e-01   -4.498534443423902e-01   -6.987157511888618e-01   +1.381044084920514e-01   +7.778926420623530e-02   +7.137206128534715e-02   +7.878132367020044e-01   +5.015091047533973e-01   +1.550428827957286e-01   -3.574122473908052e-01   +3.708468954217478e-01; +2.069429104537493e-01   -9.720809332207719e-02   -1.200354623592455e-01   -2.212571837719947e-01   -2.062877553275224e-01   +3.453979995788834e-01   -1.911875028868309e-01   -3.734529635314323e-01   +1.042838895698258e-01   +9.622281754670407e-02   -2.104255040149366e-01   +2.876154298168364e-01   +3.166618887922300e-01   -1.975511880914466e-02   +3.413597957011631e-01   -1.556480510212010e-01; -9.692115871191972e-01   -3.830928974875296e-01   -2.404670173684960e-02   -7.248932197697917e-01   +2.971524019541084e-01   -2.765492971607025e-01   -3.707766432242238e-01   -2.135308594896698e-01   +5.608347174632674e-01   +3.156320415076532e-01   +5.366873429252788e-01   +2.871961943955687e-01   -1.489620996727879e-01   +3.136268026750759e-01   +7.410772417955456e-01   +3.643826505888799e-01; +5.651463183123911e-01   +2.811371610120239e-01   -2.490826537135849e-01   -2.097803095112512e-01   -5.957136200674652e-03   -1.808951694664456e-01   +7.375790704174865e-01   +8.810851700678742e-02   +4.032998080437533e-01   -1.181107178431212e-02   -8.162927846986107e-02   -3.056223050110729e-01   +9.432121140451736e-01   +1.764629912738756e-01   +5.567812881833439e-01   +9.302739618541066e-01; +5.949809343287896e-02   +6.192853390958334e-01   +2.717298699575827e-01   -3.725228966856020e-01   -3.492419638751024e-01   +2.671247645547605e-01   -3.181997158295440e-01   +7.251085619862283e-02   +4.167014401667702e-02   -3.475837709418217e-01   -1.819051358973836e-01   -4.713792737710332e-01   -2.119075003575085e-01   -1.737510911174577e-02   +3.959018478310123e-01   +3.174579180541169e-01; +3.232662545971371e-01   +4.480943014049177e-01   -1.135755509963820e-01   -2.575297556749617e-01   -1.303408103054947e-01   +4.527524919704449e-01   -1.340878735310064e-01   +2.121701726786066e-01   +5.797716468142051e-01   +7.556678723029897e-02   -6.419996369128003e-01   +2.688659125262719e-01   +7.528295726569545e-01   +1.960907307110908e-01   -8.666463322434190e-02   +1.796869505177289e-02; +4.591988563486993e-01   -1.246919707416489e-01   +1.065603547446856e-02   +3.756152311407646e-01   +8.256782053415899e-02   -1.633155194771074e-01   +2.914058738352758e-01   -3.011672309712272e-01   +5.880904774143966e-01   +3.635165154860467e-01   -5.239924925734194e-01   +5.464982977496650e-01   +5.051623061853776e-01   +3.345914203495262e-01   +2.355393452694526e-01   -4.988935225688630e-01; -1.215107343153003e-01   +1.544569229212773e-01   +3.158292199135482e-02   -4.406592569369420e-01   +3.831732498582974e-01   -8.053802922681841e-02   -1.435125494326392e-01   +3.552517380991133e-02   +7.699160606127819e-02   -2.994856593963059e-02   +1.775320836037413e-01   -1.876634085110336e-01   +4.309651303410469e-01   +2.211932866155440e-01   +5.619798116908878e-01   -5.068916935496198e-02; +4.065908443749943e-01   +2.058542830668162e-01   -5.652789978533995e-02   +3.189265079867399e-01   -1.210578313704101e-01   -1.765125667965977e-01   +4.656486888179691e-02   +4.827853035893074e-02   +2.929965682451336e-01   +2.127629930945596e-01   -2.174169004410727e-01   -3.879461421513936e-01   +4.225517004053541e-01   +1.086366903543484e-01   -1.350437636294314e-02   +2.081774663968038e-01; +4.970977792168290e-01   -2.063917902792742e-02   -1.471315161283837e-01   +8.819057144690419e-02   -5.240208853415365e-02   -1.770013214295754e-01   +3.146399274591061e-01   -2.316420143115441e-02   +6.117740275641027e-01   +8.626722392357873e-02   -5.717684954801881e-02   +1.476068638003905e-01   -2.714083398933970e-01   +9.288791746972969e-02   -2.710258084260934e-01   +3.551631642484433e-02; +8.245046112111010e-03   +1.389648145456357e-01   -9.229140354206590e-02   +1.758278406894656e-01   -7.983048679053398e-02   +3.134511548241088e-01   +3.151250195187194e-04   +3.906283078643640e-01   +4.717797432760906e-01   +1.275260216083912e-01   +7.832587682449138e-01   +1.705803487702254e-01   -2.873997125430034e-01   -6.077029515829665e-01   +9.514107033379302e-01   +1.287294292619960e-01; -3.274165326434052e-01   +2.601611762148371e-01   -3.465499609625933e-01   -1.517266132863234e-01   -3.296477350405384e-03   -2.855650472303860e-01   -2.059837526268445e-01   +1.146622198613675e-01   +2.734671507194801e-01   +1.747871318182676e-01   -4.462936934669385e-01   -1.505467028194576e-01   +3.010797124367827e-01   +4.271094522814110e-01   -6.819633529407199e-02   +5.994796821869811e-02];
L2I_L1I_iGABA_netcon = [+5.162692942155601e-02   -1.939011389237127e-01   -7.864810191357721e-02   +8.779826649173185e-01   -2.192404526397631e-01   +4.715776742181552e-01   -1.903665128778610e-02   +9.488936759057416e-02; -1.416295097986196e-02   +7.144097770389312e-01   -1.356093665864794e-01   +2.028544610153380e-02   +3.734082814620885e-01   +7.537692474944276e-01   +2.048904720824457e-01   -3.596550148372955e-01; +3.251973188241916e-01   -3.595724036704748e-02   -4.008170482132833e-02   +3.082514614244914e-01   -1.313763892524832e-01   -2.045838791798553e-01   +5.011764809757994e-02   +2.155744963406772e-01; +7.846458041036934e-02   +7.149110816117275e-02   +6.437379901161706e-01   +5.083855187373292e-01   +5.094056171699411e-02   +4.331280212602960e-01   +2.429391209086474e-01   -2.436238364329762e-01; -3.238684364329357e-02   -8.290723152489832e-02   +7.408983113944444e-01   +8.297590214698584e-01   +9.334306019893523e-01   +2.172854920021745e-01   +4.714084965783152e-01   +3.135272376884995e-01; -3.181205946638678e-01   +1.194025212892450e-01   +7.536588387743023e-01   +4.612849827764129e-01   -1.872602745366263e-01   +6.685107049742131e-01   +5.871292281758475e-01   +7.997943867145068e-01; +7.323496945060609e-02   -1.687498689353320e-01   +1.997184246599347e-01   -1.073403809403690e-01   -6.746599278125714e-02   +8.702691840929797e-01   +4.149826914517930e-01   -2.300099830150022e-01; -3.039595626831547e-01   +4.313548280367545e-01   +4.203560658741513e-01   +2.955286165865046e-01   +5.415282018724087e-01   -3.193507139929696e-01   +5.395599820434802e-01   +2.906255661804124e-02; +1.983264755677444e-01   +7.568838146095305e-01   -6.875857426593960e-01   +5.252665050816953e-01   +3.414209753008213e-01   +8.152092192755752e-01   +1.613606860470457e-01   -1.058409893691975e-01; +1.606816739949488e-01   -2.982375390906656e-01   +6.044838562730923e-01   +1.221639481866745e-01   +3.332857207386586e-01   +5.787823032945736e-01   -7.333192195977164e-01   +8.745290338868207e-02; -1.761744032065374e-01   +2.871057573497789e-01   -4.744114461134611e-02   +1.431058947996963e-01   +7.402430914962596e-02   -1.040839210161103e-01   +1.929996998831402e-01   +4.194268646959639e-01; +3.806963161704028e-01   +4.209824688274356e-01   +3.198481720749202e-01   -1.487460946521080e-02   +8.087459172303733e-02   +2.111478547344485e-01   +7.414653510464005e-01   +4.279317462746184e-01; +1.964959224372495e-01   +2.340629664323541e-01   -2.710584309144169e-01   +1.529268930420619e-01   +1.102300575531499e-01   -5.796133835564252e-01   -2.595354211156463e-01   +1.030439782199769e-02; -3.482315143726449e-01   -2.790495540790282e-01   +7.720224376489085e-02   -4.239881925612299e-01   +4.046947477308984e-01   -4.468766269699178e-01   +5.677293777882313e-01   +5.761955392141862e-01; +5.547853039034399e-01   +5.113681690670203e-01   +5.244552141069693e-01   +3.437403969690221e-01   -4.739710909597881e-01   +7.856195505079669e-01   +7.294460963104711e-01   +2.556391876555423e-01; -2.721428484009753e-02   +1.951918184713096e-01   +4.753449853883950e-01   +5.010611690073450e-01   +5.949230094789649e-01   +3.042780168787763e-01   +2.633243874005502e-01   +1.749566127327381e-01];
L1I_L2I_iGABA_netcon = [+4.092258327163451e-01   -1.347098067063166e-01   +5.211203065072505e-02   +2.502162267840847e-01   +8.889480577208360e-02   +4.827986906970729e-02   -3.350647538785934e-01   -3.531850661116112e-01   -6.629925732509354e-03   +4.224082372046364e-01   +8.150951901861037e-02   -8.207418833885202e-02   -3.842775544355923e-01   +1.113899471744299e-01   -5.396605038551696e-02   +1.580504486414247e-01; +1.624738922636265e-01   -4.666166295595423e-01   +1.746758270983302e-02   +2.837339050409565e-01   -2.581092768137986e-01   -2.539733478729311e-02   +4.064060463691248e-01   +1.396496609506894e-02   +2.529485383212836e-01   +5.113988856948893e-01   +1.081463871509069e-01   -3.319377145120107e-02   +8.085212335747676e-03   -3.483815826339460e-01   +4.646368126374950e-01   +3.284930545865601e-01; +1.277985527428186e-01   -9.420001712488509e-02   +4.142456042604432e-02   +1.894022074716971e-01   -1.123643631571866e-01   -6.047681059399935e-01   +9.585906812539836e-02   -2.367074030026142e-01   -8.402468895460841e-02   +2.455710636990082e-01   -4.201588407022533e-01   -7.318081963275193e-02   +1.562892202830126e-02   +5.822545739018370e-01   +6.141144615519954e-01   +2.294764943483021e-02; +1.337929099868331e-01   +4.632096620979024e-01   +3.052456591238866e-01   -3.196211550798239e-01   +5.468291335094582e-01   +8.078414999229773e-01   +1.278572994382955e-01   -1.308873541735260e-01   +2.204167063144942e-01   +6.017417884456601e-01   +2.937725295558429e-01   +2.380919122878626e-01   +2.466291752095492e-02   +8.072066888980942e-01   +1.464091942862948e-01   +5.826248547120703e-01; -2.187610549226258e-01   +4.346039045467674e-02   +2.468231066196513e-01   +2.705121142370081e-01   +4.666300194286423e-02   +6.091002201103062e-01   +3.662552077494198e-01   +3.330404545806688e-01   +3.236588923311442e-01   +1.945373979188690e-01   -8.839841048088637e-02   +2.715574094242833e-01   -7.659779468768302e-01   +4.780249017414011e-01   +5.542854292143381e-01   +1.000000000000000e+00; +1.881088804433427e-02   +5.339344018845433e-01   -6.831378840400255e-01   +1.220353368581203e-01   +7.187383916368084e-02   -2.682002383672640e-02   +3.680340168788220e-01   +4.965811623352936e-01   +2.110975678685395e-01   +3.444530086961670e-01   +2.492913028772132e-01   -2.008720204464411e-01   +1.952841091245028e-01   +7.777374694520897e-01   +2.453860911784718e-01   +1.653419605345339e-01; -1.338865221199089e-02   +4.701334939192469e-01   -3.821503612851994e-01   +5.614671645342343e-01   +3.392485674561635e-01   -4.663022941297507e-01   +1.708735685192654e-01   -1.839796556419536e-01   -4.567227452770925e-01   -1.738781422078330e-01   +4.257732657540678e-01   +5.830669559019378e-01   -1.361768046636782e-01   +3.241561239882218e-01   +1.931177001546633e-02   +2.372964120901604e-01; +4.119659056583311e-01   +2.248145828387522e-01   +2.987422517719899e-01   -2.252956619166069e-01   +6.956669211261787e-02   +3.397422052633998e-01   -1.770140867910249e-01   -3.646021400682332e-01   +1.232439019992333e-01   +1.635173626253337e-01   +2.055420614421223e-01   +5.310430759549630e-01   -1.998312364424823e-01   +2.462455462649440e-01   +7.714677895121029e-02   +4.555842920377355e-01];
L2E_L1E_iAMPA_netcon = [+8.945966166407249e-02   -7.149761687125773e-01   -2.268838577093445e-02   +4.851384554394929e-01   +3.457817607879691e-01   +4.821632542255752e-01   +4.007653642428137e-01   -3.733472940984088e-01; -1.209639840212502e-01   +1.382638677137529e-01   -5.109310037916770e-01   +3.854354722600128e-01   +3.324897893551718e-01   +3.417879306008602e-01   +2.072350260245028e-01   +3.631848832884725e-01; +5.851441699402270e-01   +2.123514462338825e-01   +8.627498590501862e-03   +4.142370819515083e-01   -7.120140212153905e-02   -2.164444153719987e-01   +1.135271380193242e-01   +3.206681696484061e-01; +1.350722258248608e-01   -2.023554126683601e-01   -4.120652946450231e-01   +2.457603930207640e-01   +1.822600616770383e-01   -2.798254269255703e-01   -4.141356476152374e-01   -3.204047252818145e-01; +1.965233611363544e-01   -1.054172554903261e-02   +4.190498404687480e-01   -5.099809320708483e-01   +2.704399715930018e-01   -4.738461038663977e-01   +2.569035487143891e-01   +3.461867941453015e-01; +8.579672518371880e-01   -1.719574156917246e-01   -5.043870599305246e-02   +6.107889182129738e-01   +2.981602820749346e-01   +7.872283909619975e-01   +5.379950560215877e-01   +5.406063775591161e-01; -5.296122238718726e-01   +8.055505975621341e-01   +1.421667728455821e-02   -2.369191358571767e-01   -1.807520966720907e-01   +5.053929096236015e-01   +7.577491669485307e-01   -5.026004811179459e-01; +9.086413032735870e-02   +4.329328229871875e-01   +9.253040627460585e-01   -3.388931103197770e-01   +3.779076755736256e-01   +1.342936508326502e-01   +6.514253931293180e-01   +1.583719792779322e-02; +1.002298276913592e-01   +3.051077317145096e-01   +9.556298879346632e-01   +5.300695241362537e-01   -9.224550019067722e-01   +6.627063878118664e-01   +8.400692055097593e-01   -3.607549351515258e-01; -4.340576569431204e-01   +4.665265406087887e-01   +1.658541693502710e-01   +5.248840093608519e-01   -1.785820555563085e-01   -4.844450576308464e-01   -1.777650325030811e-01   -1.943185456840458e-01; -1.886684881813908e-01   +6.548776454735481e-01   +6.512354415009489e-01   +3.849843932265681e-01   +1.024763964047082e-01   +1.235472071635641e-01   -1.181562226822366e-01   +1.789183191811481e-01; +2.598026137350577e-01   -1.203712492768095e-01   +4.215839786357035e-01   +2.174392669205236e-01   -4.153001214640920e-01   +5.745533388916484e-02   +3.916174828112910e-03   -3.095212493580533e-01; -1.903002118495727e-01   +2.345047478194730e-01   +8.449570931220186e-02   +1.506871897414684e-01   +5.337288595181477e-01   -8.276363433693528e-01   +2.835483990797997e-01   -2.034778634439427e-01; +4.239354644186177e-01   +7.505907832614664e-01   +1.424070735361914e-01   -7.311454195617073e-02   +4.843817308114371e-01   +2.800136217208313e-01   -3.629053400831906e-01   +1.520003256179051e-01; +1.087759221701342e-01   +2.057235164456854e-01   -2.109340925102725e-02   -1.788350736337452e-01   +1.136354976229998e-01   -3.055662261438764e-01   -2.025689406592999e-01   -4.396912820010846e-01; -1.032414321618408e-01   +3.421507809981687e-01   -8.967857206757418e-01   -9.567645074958805e-02   -4.138575652032959e-02   +2.122073417103369e-01   +7.218024185587424e-01   -3.530597434672985e-01];
L1E_L2E_iAMPA_netcon = [+4.764586591208522e-01   +3.749773755463513e-01   +2.528397965540149e-02   +5.418222010437642e-02   +1.593223413058013e-01   +2.379009124835791e-01   +4.198316374079551e-01   +7.775101381505431e-02   +1.944545142661304e-02   -5.060584662362897e-03   +5.894614398265836e-01   -1.534290017206420e-01   -3.318750292543904e-01   -2.216109051561766e-01   -7.766557858663789e-02   +4.705591491270213e-02; +2.268331214429194e-01   -5.204740958807294e-02   +3.184306355966219e-01   -1.684622759514025e-01   +1.442799882618761e-01   +1.883361249854064e-01   +6.957776746002051e-01   +3.758980756175174e-01   +1.845733548687363e-01   +9.248792068240132e-02   +5.966999826277475e-01   +3.198707736741170e-02   +8.808270217252517e-01   +2.584586318673199e-01   +3.384959497563234e-04   -3.060013754711520e-01; +9.985603531602568e-01   -3.281304298674008e-01   +1.337330893087037e-01   +3.951247607947109e-01   +5.700899111528452e-01   +3.772705115261452e-02   +1.457403546004016e-01   -2.956764364850871e-01   +3.965599287929940e-01   -1.485463677574553e-01   -6.038370749302652e-01   +2.664623620233666e-01   -8.522574781961879e-02   +3.267433444690785e-01   +1.710584039707920e-01   +1.244582012227157e-01; +1.200541573000568e-01   -2.808627631744843e-01   -4.944654793844221e-01   +5.629726029537218e-01   -3.008053155148804e-01   +7.985109271885774e-01   +8.477392708859827e-01   -2.834913020129890e-01   +1.749500938564579e-01   +1.475238606245751e-01   +5.411858090502000e-01   -3.995420303815894e-02   -4.795248989119388e-01   +8.514010183559682e-01   +5.931117271361034e-01   -1.984197196911755e-01; -1.567632600542253e-01   -4.625671331303343e-01   -5.526192657270034e-02   +1.148401543948607e-01   -5.170271060907931e-02   -4.821566340360291e-02   +3.355000689554897e-01   +7.641631691003302e-01   +1.913982971888944e-01   -1.406561594836540e-02   +3.137885024120714e-01   -3.384983030551759e-01   -1.709209106502673e-01   -1.827428119351595e-01   +7.920742346165383e-02   -4.387969658701733e-01; -1.725169482823978e-01   +7.249445050804155e-01   +1.262864882253463e-01   +4.846978888851129e-01   -2.095032054427735e-01   -6.910769318204288e-02   +7.613853400283730e-01   +1.732692030380312e-01   +2.659185890164175e-01   +3.946120998376352e-01   +3.219824269311108e-01   +2.017846116854621e-01   -2.559860149143360e-01   +2.629870273483843e-01   -3.536329248858162e-02   +9.079625585770313e-01; +8.665013613318087e-02   +5.010226569281880e-01   +9.808713241665106e-03   +9.246573644529672e-02   +3.441902346570783e-01   +5.767852238251202e-02   +3.193244021127610e-01   -8.574645997904951e-01   -4.167233416381453e-01   +1.778963098322014e-01   -2.332768605328997e-01   -2.326527052054408e-01   -7.305883027108088e-01   +6.279090061523633e-01   +3.655978729714487e-01   +6.870134391811452e-01; +5.502380909623843e-01   +1.333045292089728e-01   +9.048803636669100e-03   +5.151438740410905e-01   +2.886266742537699e-01   +4.057225436801933e-01   -2.986769131045794e-01   +1.469117979358680e-01   +1.103256927532841e-01   +3.963159254373343e-01   +4.768614517589613e-02   +1.977561201435058e-01   -8.481226975950900e-01   -1.730207312829278e-01   +3.296297267143978e-01   +3.892304125545214e-01];
L2I_L2E_iAMPA_netcon = [+1.061496532164079e-03   +6.706506927938506e-01   +6.060391427115358e-01   -7.283913037876397e-02   +2.135053964861928e-01   +1.745171824385478e-01   +1.107579158229595e-01   +5.663077447459032e-01; +6.083645842547408e-01   +3.027025890804782e-01   +3.665903477637035e-01   +6.907644746288941e-01   +1.234410019619496e-01   +4.054146769579110e-01   +1.264989280511249e-01   +4.226367902354062e-01; +1.163551939357835e-01   +4.789297273215025e-01   -3.024232794708893e-01   +4.092861124601787e-01   -5.528045092240963e-02   +4.422570835389111e-01   +7.587652435459097e-01   +5.332401141640392e-02; +2.758664635811550e-01   +5.144711603436052e-01   -5.522457184037248e-01   +6.532317010659702e-02   +6.463347903353561e-01   +2.368551176088973e-01   +2.735355427864022e-01   +6.753010070844181e-01; +8.493217128565714e-01   +2.304197545799968e-01   -3.889128315033548e-01   +4.171233526477833e-01   +7.634271570251675e-01   -9.033222977088727e-02   +1.153039887180177e-01   -1.875160468751361e-01; +3.828819015656639e-01   +2.671487316759837e-01   -5.597244914994232e-01   +3.130972836310784e-01   -2.962897067367568e-01   +9.617181154260565e-02   +3.216120183384435e-01   -2.884486970582791e-01; +7.357912915986203e-01   -2.030429126552157e-01   +5.956145768317314e-01   +2.985058367890227e-01   -9.315235529362559e-03   +1.457216576165614e-02   +6.217600603709138e-01   -4.959145597392549e-01; +3.799266925034721e-01   -7.139027112880256e-02   -6.715041620845751e-01   +9.063553601938402e-02   -1.633961642869456e-01   -2.510025843195411e-01   -9.270652265550451e-02   +7.969008282459341e-01];
L2E_L2I_iGABA_netcon = [+2.585744047478383e-01   +7.001968033302570e-01   -1.666003173337048e-01   -2.780494951447838e-01   +1.293645617973135e-01   +7.166657522234922e-02   -5.165372463142049e-01   +6.321435115914108e-01; +1.054229866465818e-01   +5.975379236349555e-01   +3.985003265060940e-01   +8.518390102046267e-01   +3.477920756001555e-01   -2.152593478418342e-01   -6.063000712520463e-01   +4.436740883820732e-02; -2.447057695379560e-02   +6.165614361714979e-01   -4.005541423220748e-01   -4.891282309210742e-01   +5.069617167185662e-02   +8.555737849837282e-01   -2.674825068363488e-02   +8.636764034824550e-02; +6.557697753745944e-01   +9.916543470990469e-02   +9.774483384131753e-02   +7.202560209994814e-01   +6.973959855387741e-01   -1.607319052799200e-01   -4.009798762251324e-01   +3.623188820365030e-02; -3.550120933584894e-01   -7.539826005144159e-03   -2.280440565008895e-01   +2.430361996364101e-01   +7.490773497412478e-01   +2.859877100627826e-01   +7.273904163288124e-02   +1.284909364398582e-01; +7.640036744678986e-01   +2.593959958311131e-01   +2.875287490383526e-02   +3.479944369316823e-01   +4.593160940261978e-02   +8.162361443410365e-02   +5.270150076771941e-01   -6.140775234934089e-01; -5.106337843658461e-01   -5.548085703271888e-02   -6.129412946171493e-02   +6.620087405291364e-02   -1.403644581661919e-01   -1.035841486961484e-01   +2.162341669345243e-01   +7.975165807819550e-01; +2.904390380302266e-01   -1.190339150620221e-02   +6.424407798961010e-01   -3.502654999600724e-03   +5.677446756118592e-01   +1.821593099049293e-01   -9.242998613302467e-02   +6.446017662271428e-01];
L3E_L2E_iAMPA_netcon = [-1.007441080199471e-01   -1.944634263350120e-01   -4.362147984146184e-01   +1.561842140300238e-01   +8.593025988123444e-01   -2.309720924357541e-01   +3.521717761412518e-02   +9.587763090227043e-01   +4.389981454365117e-01   +8.013331870835491e-02   +4.544950877326397e-01   -7.031431711876079e-01; -3.785417158202151e-01   +1.394874775233210e-01   -3.436794172534187e-01   -5.032816882555874e-01   -5.319794633647292e-01   -1.587689860048317e-01   -1.057039627151038e-01   -4.415645109135417e-02   -1.132706376965789e-01   +5.671041808774653e-01   -2.479151245468673e-01   +6.197692760629799e-01; -4.544866251442450e-01   -7.021753097916503e-02   +7.464295577679847e-01   -2.411840745422508e-02   +2.075601057639823e-01   +9.251660496076115e-02   -2.116886266194124e-01   -1.604269403005668e-01   +5.226642298341150e-01   -4.537662331557413e-01   +7.946479331176332e-01   +1.972392655167136e-01; +5.915446187436366e-01   +5.333625719495668e-01   -2.484663319075691e-01   +8.616490594783520e-01   +9.381139336924728e-01   +4.764085896954165e-01   +5.253116410658512e-01   +7.278464903036561e-01   +1.936468722076713e-02   -9.932061554624702e-02   -1.014465185723996e-01   +3.641217761639666e-01; +1.009091175027427e-01   +6.605225345660645e-01   +9.887286099002731e-01   -1.119734096791974e-01   +6.534574771879744e-01   +7.941317327953956e-01   -1.366137469685841e-01   -2.467408358215016e-01   -5.094977591437519e-01   +2.297319386930706e-01   +1.379906361809108e-01   +6.152428489200098e-02; -5.875838200011760e-02   +3.915647392108976e-01   +4.771158230561341e-01   +6.986232468605691e-02   +9.103286141043689e-01   +4.143571812791769e-01   -1.817985080570134e-01   +1.566375155585910e-01   -2.686899864238524e-01   +4.848292277822276e-01   -1.774291572214007e-01   -3.674176143010790e-01; +5.970701684747723e-01   +1.960384029482394e-01   -4.153605566993293e-02   -7.151422332641516e-03   -8.532056479824937e-02   +4.046460800659672e-01   -4.686595458389187e-02   +1.781228992248400e-01   -9.504889543864481e-02   -2.562378770296824e-02   -1.471487783175891e-01   +1.054292524019726e-01; -1.685820815152412e-01   +4.348851524381908e-01   -1.511021234191709e-03   -3.621162598404634e-01   +4.609985158959232e-01   -4.037155231981286e-01   +7.389457409315361e-02   -3.320715577954369e-01   +3.094394964777675e-01   -5.820868844559976e-02   +5.311012923716583e-01   +3.344211455725630e-02];
L3I_L2I_iGABA_netcon = [+7.832856805589478e-01   +6.669172287680700e-01   +7.455135133656829e-02   +1.485539126493824e-01   -2.101169093679870e-01   +1.680813423383823e-02   +8.500787432681390e-01   +7.393637297921071e-01   +1.063760091821339e-01   +4.791525153893955e-01   +3.475570309226412e-02   +2.975831651562991e-01; -7.084498939488904e-02   -9.786318019219292e-02   -2.493471481635046e-01   -4.961101571288841e-02   +6.428438344859316e-02   +9.330413141637922e-02   +7.449252468558010e-02   +1.125420070645719e-01   +2.708291305071160e-02   -4.306698166881771e-02   -7.881272076850340e-02   +4.670194267699824e-01; +1.801866576889806e-01   -1.356872363522005e-01   +5.898547539645117e-02   +1.021614839800892e-01   -4.829632678375660e-01   +3.486695385517075e-01   +4.413108036264671e-02   +5.855898096959308e-02   +8.784176149039677e-02   -2.571651526605957e-01   -9.761595775907705e-02   +7.102278785919871e-01; +3.489817619946970e-01   +2.282562526949188e-01   +2.097000350968762e-01   -9.902279292658878e-02   +1.480953555441438e-01   +4.827962268871343e-01   +3.440098594681131e-01   -2.973925833093249e-02   +4.323958393398671e-01   +3.748587351119987e-01   +3.235771030457183e-01   +3.160239994340022e-01; +6.344277497883972e-02   +3.973430044065075e-01   +1.133257287546508e-01   -4.482474102515420e-01   +6.033327629195310e-02   +3.343423718720296e-01   +1.342584279598243e-01   -1.211394804390696e-01   +1.813472072232859e-01   +8.354237619915940e-02   +9.090938334034085e-04   +1.311992830303822e-01; -1.034187806518311e-01   +1.629030974658138e-01   +2.451180855279839e-01   +2.858660091716446e-03   +1.062811678896870e-01   +2.058781478526892e-01   -7.038058125034989e-02   -6.291092494233613e-02   +9.406305162550167e-02   -2.028187121942913e-01   -7.249405977827138e-01   -3.105071281111789e-01; +1.403868800741023e-01   -3.330643151476942e-02   +4.464881227105421e-01   +3.020520794567123e-01   +1.531256431447277e-01   +5.241131988105641e-01   +3.203823578743574e-01   -2.472992897480914e-01   -9.880773875698759e-02   +2.361651661296545e-01   +3.978252159304267e-01   -4.285623105769761e-01; +2.300685153100582e-01   +1.377534903595779e-01   +2.254204284946965e-01   -1.166708402083354e-02   -1.298890982064413e-01   +5.101699535663242e-01   +1.786881831173245e-01   +4.646120965445292e-01   +3.387517274689497e-01   +1.044783164814395e-01   +2.779500216874871e-01   +5.330888331390035e-01];
L2E_L3E_iAMPA_netcon = [+7.448467829624121e-01   +1.747135467144178e-01   +1.506983657620353e-01   -1.906362195558924e-01   -3.681115786897445e-02   +3.762348852893236e-02   +5.592884710574931e-01   +5.510598419466674e-01; +5.514509405946558e-01   -3.636983674890180e-01   -3.303279950039644e-01   -1.118707950184539e-01   +6.702369806360642e-01   -7.025084135950790e-01   -7.512778564376404e-01   -4.717640178873193e-01; +1.346687405568864e-01   +2.644459061542421e-02   +3.712556631362582e-01   +1.656911803944427e-01   +1.072428749735299e-01   +2.985551007843266e-01   -2.541755094595367e-01   -2.262703574213415e-01; +6.317141891605687e-01   +3.297428584628863e-01   +6.370299515801945e-01   +6.830207441784544e-01   +9.132833838098781e-02   +2.685736393859804e-01   -2.714923932564121e-01   -5.764974930644878e-01; -4.454251715340564e-03   -2.872500958406428e-01   +3.929796781341507e-01   +4.087551132117138e-01   +1.055185275769348e-02   -2.237048209586734e-01   -1.141467954069435e-01   -4.567407482341033e-01; +3.665174293044757e-01   +2.984179113269900e-01   -4.022684415093326e-03   +5.799431817335182e-01   -9.293991448376465e-02   +1.564750206310165e-01   +3.033157133456847e-01   +1.890988931904210e-01; +6.975426219935316e-02   +7.251131875477039e-01   +9.173874160901297e-01   -2.932503534826471e-01   +4.081473469656332e-01   +3.782081844328433e-01   +4.866873249350865e-01   -2.554805523794902e-01; +2.592968033771552e-01   +5.697053983757023e-01   -3.891338311435976e-01   +1.656008651540238e-01   -1.664220347426880e-01   +1.697526232991591e-01   +1.492477138558016e-01   +5.948847880936621e-01; -3.758068407326686e-01   +4.237966888125642e-01   +6.879270699812233e-01   +5.022058298797850e-01   -3.244435798918012e-01   -1.647154205761786e-01   +5.830831509904271e-01   -2.063520366389170e-01; -3.901174408666594e-01   +3.032283336149968e-02   +3.857403781580416e-01   +1.011679394893465e-02   +2.571220205286343e-01   -5.501186789781353e-01   +6.464413639438227e-01   +9.364478129296953e-02; +5.332509385404131e-01   +6.150468386102427e-01   +1.230058340015841e-01   +2.719901756596905e-01   +3.684875489120957e-01   +7.497255602760057e-01   -4.303486868338094e-01   +1.635533512657233e-01; -4.925808442566010e-02   +2.133425801503459e-01   +6.268653478136564e-01   -1.992527329297243e-01   -2.452614433415946e-01   -8.380796005666541e-02   +1.025641243846409e-01   +2.135620462482761e-01];
L2I_L3I_iGABA_netcon = [+4.350374716800501e-01   +1.426183080461219e-01   +3.877350215858681e-01   -5.652693418719343e-02   +1.585752983922742e-01   +7.897925410776373e-01   +7.336387590929989e-01   +3.018402099053365e-01; -2.378422987495694e-01   +4.065390935523957e-01   +4.285412766465579e-01   -1.629085705669100e-01   -3.794835467919895e-01   -2.190245348180311e-01   +5.578287007717456e-01   +7.138323043064636e-01; +2.211929860311688e-01   +8.351976821637697e-01   +5.526154074319994e-01   +1.919213588752172e-01   +4.278765840865930e-01   +2.569060041282132e-01   -8.045950206364835e-02   +3.627145575772639e-02; +7.694998264403725e-02   -4.915075236921090e-01   +2.775158056999531e-01   +2.278264783091977e-01   -1.757004553661578e-01   +1.205501073388203e-01   +2.159370462042401e-01   +2.202546271901430e-01; -2.449304377018506e-01   -4.015428609873488e-02   +2.102740003369209e-01   +1.288515497519109e-01   -1.817998799141065e-01   +2.175480311196444e-01   +2.590849395966032e-01   -1.217613776670753e-01; -3.111336371954512e-01   +8.996462686603320e-01   +2.632172592928473e-01   +3.792403557491910e-01   +3.614120467612536e-01   +2.579484391464591e-01   -3.970258489062564e-01   +2.444250057180428e-02; -1.236662785693178e-01   +7.019574597298364e-01   +3.016390454478103e-01   +3.958983888966913e-01   -9.366276561507343e-02   -1.115761810177819e-01   +5.244646258990848e-01   +4.194726722300938e-01; -3.573155997886294e-01   +4.924395359487083e-01   +4.123680696488614e-01   +3.615265918856624e-01   +1.760707912929128e-01   +7.434035511269257e-01   +1.730326936564000e-01   +7.826915509593778e-01; -6.280123457097331e-01   +4.449711923932557e-01   +1.417872368527032e-01   +3.281341448557564e-01   +5.724570747893596e-02   +4.697663263462682e-02   -2.327983882204188e-02   +1.553590934256405e-01; +5.801705967442121e-02   +2.237484522425547e-02   +6.348005346394272e-01   +1.630634134541633e-01   +3.938330966989166e-01   +3.271073248630695e-01   +2.531843525265482e-01   +1.022495465008457e-01; +3.271143325132668e-01   -3.166357183008834e-01   -5.907889210067252e-01   +5.085185400997063e-01   +1.759508955539613e-01   +1.168134284548354e-01   +1.100176977703594e-01   -2.349995372599376e-02; +2.109837885348048e-03   +7.244679320504449e-01   -4.805011935922895e-02   +2.212201455342480e-01   +6.857164641953805e-01   +5.953691041493807e-01   -3.750466381646456e-01   -3.246510528506033e-01];
L3I_L3E_iAMPA_netcon = [+1.831214357290435e-01   -7.256552931180975e-01   +3.069800392793923e-01   -2.475875861600085e-01   +2.019560477743531e-01   +4.818245675411082e-01   +1.729511313378038e-01   +3.358292357198879e-01   +6.128492646782006e-01   -1.479504895102197e-01   +1.619854566612176e-01   +5.975111642285348e-01; -1.709656805168522e-01   +4.692018554834437e-01   +8.271876291736814e-03   +3.342377856664379e-01   +3.156543856543843e-01   +2.272302003650292e-02   +5.843531089624331e-01   +1.000000000000000e+00   +4.594668437147114e-01   -7.616545174622498e-02   -1.422284540526252e-01   -3.039794383104873e-01; -5.520081411028535e-02   -4.787830835283773e-02   +2.927275654355301e-01   -1.034082171799642e-02   +7.045347349234427e-01   +6.773129983199069e-02   +2.650385446517828e-01   -3.396202205358489e-01   +3.602956109793229e-01   +3.163820701778413e-01   -2.702237705465243e-01   -2.672987801121968e-01; -6.465662078145713e-02   -1.529844582017103e-01   +1.650303931354408e-01   -2.106891863867957e-01   +2.495720576812500e-01   +1.990334169007875e-01   +1.946950821739845e-01   +3.485506167673763e-01   -6.686336524587945e-02   +7.044147156916128e-02   +2.793142408778425e-01   +2.514988643113567e-01; -3.391751197564861e-01   +3.644522505861102e-01   +7.420942934068113e-01   +5.634951746347474e-01   -3.251878125593768e-02   +2.966248152926930e-01   +2.320569598859155e-01   +2.131072074249399e-01   +1.370320041098584e-01   -2.732176686023434e-01   +1.087436661492776e-01   +5.064308392318918e-01; +1.138849814591736e-01   -1.975125479710587e-01   -3.244663066480030e-01   -8.788526811181691e-02   +2.938879256878395e-02   -1.383529930994233e-01   +5.746180839470680e-01   -8.532254523965024e-03   +4.727171498306594e-02   +4.157416851795352e-01   -3.507624835520877e-01   +6.723649217846981e-01; +1.900569705341476e-01   +1.923076874445439e-01   -4.198968069751390e-02   +3.465856401299976e-01   +5.833354094952363e-01   -1.234545085811991e-03   +7.829342782785702e-02   -1.558891611009896e-02   +1.830439848778498e-01   -5.399822953786247e-02   -1.178012049614561e-01   -1.926675582530505e-01; +5.314512694746775e-01   +2.744807916276499e-01   -9.949143002038076e-02   +5.480135239117263e-04   +4.310014620818982e-01   +4.360035518334741e-01   -3.391184771589918e-01   +2.571072527904024e-01   -9.900689537285605e-02   -1.831035308036564e-01   -4.360795468058024e-01   +3.399174531213896e-01; -3.396937408331147e-01   +5.233219334520837e-01   +2.892757888583380e-01   +7.150114576708453e-01   -1.802802944569076e-01   +5.061172514050719e-01   +2.989831760669215e-01   +2.660376195133684e-02   +2.146034112379398e-02   +3.779198345400853e-01   +1.295979292947473e-01   +3.075842441499564e-01; +8.454079105427927e-01   -3.646701696403418e-01   +2.978630149538068e-01   -3.122610675527133e-01   +1.522954203362085e-01   -1.554238909794627e-01   -7.082246979110209e-02   +3.346310099838203e-01   +4.967877931713884e-02   +3.517458985989126e-02   +4.981612735971117e-01   -4.032347133260777e-01; -1.236610358130890e-01   +5.253461630854407e-01   +5.828627964233690e-01   +2.451589851302725e-01   +3.918577666431424e-01   +2.776937164779953e-01   +2.563263839618093e-01   +4.002128796508318e-02   +1.676470880037068e-01   +2.194367348113180e-01   -3.757482623263413e-01   +5.583106000423855e-01; -2.353590656455262e-01   +3.838398081652991e-01   -5.447811375341025e-02   +5.670141809493242e-01   -6.300991238002898e-01   -3.038447413290603e-01   -2.127072441167841e-01   +4.499199540867403e-01   -2.810596521895976e-02   -3.839030378992073e-02   +1.062082374321536e-01   +8.844101327122292e-02];
L3E_L3I_iGABA_netcon = [+6.925017622531512e-02   +3.539007484147642e-02   +2.157789374345976e-01   +2.623438275464907e-01   +2.670025369601078e-01   -7.455792293495370e-02   -1.692112315592553e-01   +2.902176098524638e-01   -1.745576340957872e-01   +7.933133575467376e-01   +3.727639395810383e-01   +5.407536656904638e-01; +4.142912209181080e-01   -3.006006616718647e-01   -4.061351947023595e-02   +4.287686266889938e-01   +3.178004508477766e-01   -3.381168289447180e-01   +1.570690902419623e-01   -1.599041705747905e-02   -1.996069581446048e-01   +1.152818811490308e-01   -7.954439662576726e-01   -4.372193611729479e-02; +4.494033622502913e-01   -3.326613592286424e-01   -3.666147309399456e-01   -3.836292631070321e-01   -2.771711622321131e-01   +3.109178567655084e-01   +4.156559193475122e-01   -2.210043852942907e-01   -8.420248494086731e-02   -1.168505677514846e-01   -1.369650688553727e-01   +2.921463499908898e-01; +2.504640357794787e-01   +3.264169162907164e-02   -4.870963498115551e-02   +4.546042021699661e-01   +7.924678934168625e-01   -2.985670987759244e-01   -1.283107016086122e-01   +2.291071816592644e-01   +9.588860430432985e-01   +1.706303759823506e-01   +5.436079021040831e-01   -1.296821193165176e-01; +2.559282684654175e-01   +3.668496232003787e-01   -1.729284326480990e-01   +5.604574863307483e-01   -6.943764253638501e-02   +8.827588867681704e-02   +3.716121312966948e-01   +2.064683711296592e-01   -1.545378488366339e-02   +7.902614652741170e-01   +2.333551365243386e-01   +2.032411432250385e-02; +2.291093995489361e-01   +3.292907880894704e-01   -2.240214499212372e-02   -3.612612060038763e-03   +1.708989948357109e-01   +3.257078501160524e-02   +8.661797860583691e-02   +1.779576103871536e-01   +1.317791840264645e-01   -2.029445673973425e-01   -5.763586280124187e-02   +2.976249294790165e-02; -3.649313396081184e-01   +2.328717050538686e-01   +2.536706795679443e-01   +7.664474726365109e-01   +2.347528879436032e-01   +2.891306282234338e-01   +4.495570240403163e-01   +6.066365204244691e-01   -2.152907194785493e-01   +5.476033583405370e-01   +4.591664842543529e-01   +2.265383476450649e-01; -4.620674510326535e-02   +2.338191623687444e-01   +3.392994353190485e-01   -9.891001114279592e-02   +1.484254313644170e-01   -2.917617321648320e-01   -6.990445578579264e-01   +4.175503519157451e-01   -1.186088898500998e-01   -4.979190542167644e-01   +4.153527385841684e-01   +3.730880356694181e-01; +5.441020160835993e-02   -2.969482260145747e-01   +5.361730153388861e-01   -3.514656203411400e-01   +2.581482453892691e-01   -2.718223322204046e-01   -7.619776834544473e-01   +1.441475103479773e-01   +3.248193125116574e-01   +6.278516932951250e-01   +6.796606967437252e-03   +4.846516944944560e-01; +2.428586548074184e-01   -1.123460186314190e-01   +2.640112803272064e-01   -1.507101072357205e-01   -4.011797243834018e-01   +2.394410972693189e-01   -4.993836794786100e-01   +3.595489414602032e-01   +5.843362598028892e-02   -2.043252264709310e-01   +4.566843299884016e-01   +1.688511204807608e-01; -2.527782616456420e-02   -3.581971007609461e-02   +3.544885223974006e-01   -4.642494940578792e-01   -4.522189192559604e-01   -1.707599558221771e-01   +3.925511799650425e-01   -4.887527381794014e-03   +3.246256729425506e-01   -4.921209912785282e-01   -1.703786710767983e-01   +6.029208036694701e-01; +1.648615805715565e-01   -4.191902570889255e-02   -2.483374079459536e-01   -1.595131500484036e-01   +8.603141260372440e-01   -1.244665289398488e-01   +4.549528853606595e-01   +4.903387772102648e-01   -5.626482364053610e-02   -4.723100801398196e-01   -7.828919599044550e-02   -4.839770971116333e-01];
L2E_Input1_iAMPA_netcon = [+8.695858328627746e-01   +9.327501527002694e-01   +6.487868028795880e-01   +4.128175820656416e-03   +3.400091777990188e-01   +6.986398990167740e-02   +6.387670177730068e-01   +3.593783231742430e-01];
L2I_Input2_iAMPA_netcon = [+5.453034390728065e-01   +8.904583839253648e-01   +2.336796781661148e-02   +1.894470978177992e-01   +1.629360720216461e-01   +3.539154640458677e-01   -2.037941598839923e-01   -1.769198812435696e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
