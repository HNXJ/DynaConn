function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.553509369931713e-02   +4.176709925651990e-02   +1.780002868959457e-01   +2.534610037943712e-02   -4.359662106523386e-02   -2.987138256282457e-01   +9.952203964727052e-02   -1.412872783759203e-01   +9.814829822468105e-02   -1.039520414082469e-01   +2.319714519116056e-01   +2.764702138211898e-01   +1.153887892738455e-01   -7.301696040873716e-02   -2.140545345419146e-02   +3.258133685644816e-02; -1.368347729290518e-01   +8.911714905163123e-02   -7.767211793897717e-02   +1.873593409202290e-01   -1.150759675847150e-01   +8.957771284173223e-02   +6.741790459312735e-02   -6.289910676421284e-02   -2.083756874250475e-01   -1.139308849527277e-01   -7.433366279686879e-02   +8.547173078633701e-02   +7.080827361152463e-02   +5.727652552235438e-03   -7.535370058391469e-02   +1.586741620270767e-01; +2.460424991261568e-02   -1.707056215851411e-01   +1.217926082451396e-01   +1.794845724310475e-01   -1.115881106677231e-01   -8.067717139204056e-02   -2.415658844521530e-01   -2.680473117659163e-01   -2.656658800468518e-01   -2.815975222567298e-03   +1.921580367276964e-01   -5.546476767430284e-02   +2.364443019721117e-01   -2.254000201223560e-01   +2.807564139378285e-01   +1.698373829557827e-01; +6.777781221401379e-02   -5.922744567033960e-02   -1.059444647327473e-02   -3.993013494741468e-03   +6.746462087623487e-03   +2.148117226411113e-02   +5.455159892434079e-02   +1.177418712736161e-01   -2.817112858289482e-01   -9.831735553487869e-02   +5.759594185606457e-02   +1.910743663990626e-01   +2.313914467883229e-01   +1.447811063813548e-01   +2.101312705717731e-01   +2.805096631134923e-02; +4.039901516475144e-02   +1.166153530225085e-02   -2.135606527183553e-01   +5.588516357845284e-02   -1.939425348051975e-01   +5.001298178469048e-02   +2.044621722750763e-01   +2.204586238893664e-01   +1.889069714845924e-01   -2.319737075489552e-01   +9.328999868541465e-02   +1.374281881891347e-01   -3.709096339612002e-02   +1.187737634705893e-01   -8.045940802718961e-02   -3.581584767197018e-02; -3.031977980169773e-01   +2.386466137374342e-01   +2.155590941755797e-01   -1.641153723313293e-01   +1.674666106484293e-01   +1.501884710933688e-01   -3.305554150462142e-02   -1.270038712673932e-01   +1.110117013706339e-02   -1.472202490918678e-01   -9.304764118409406e-02   -7.559079319917805e-02   +1.898411822371084e-01   -1.931184616729649e-01   -2.460439744020107e-01   +1.770613148611331e-01; +3.480181482183694e-02   +2.366122278390987e-01   -3.175701250245337e-01   -1.808305227355839e-01   -2.779843657750588e-01   -9.925579799836411e-02   +9.085214039362868e-02   -8.085689155391901e-02   +1.014370153983039e-01   +4.994220803911748e-02   +5.693863262092491e-02   +1.470037368756298e-01   +7.321274984456143e-02   -1.280855276752015e-01   +2.146354132671453e-01   +9.119470184150505e-02; +3.641244945576819e-02   +2.581856619392668e-01   +2.712755428844054e-01   -1.418509365858793e-01   -4.035651444088844e-02   -6.405332113506713e-02   +1.964625879341743e-01   +1.492212782434789e-01   -9.612329798547516e-02   +8.576890843184612e-02   +1.141059023797102e-01   -1.502665471118509e-01   +1.345299782532680e-01   +1.270432731706455e-01   +6.529395037718398e-02   +1.874505850063457e-01; -1.267307256280402e-01   -1.885493153784653e-01   +3.033273199424564e-01   +2.009018247288681e-01   -8.359128663716466e-02   -1.065951619406630e-01   +2.608665829843184e-01   -1.914716729317225e-01   -2.837452265223351e-01   +5.461726916256873e-02   -1.481584247107786e-02   -7.364537231259560e-02   +3.402481122919852e-01   +2.722720740233101e-01   +1.938085428346343e-02   +5.576437724265099e-02; +3.364007213830816e-02   -1.466528559635021e-01   -1.418003074280547e-01   +2.756172847020896e-01   +3.249087267548034e-01   -1.304958954466015e-01   -1.005445791147665e-01   -1.479072076267452e-01   +1.047462280132940e-01   -2.438667746156229e-02   -1.604172895058684e-01   +7.792150316505714e-02   +2.324319428056394e-01   +3.459218416781966e-01   -1.812457539480919e-01   -3.248136419903384e-01; +3.225465183347754e-01   +3.544326123857897e-03   -2.898441985421365e-02   +1.983642322948085e-01   +2.645874751771909e-02   +3.084850315741431e-01   -8.494886046262785e-02   -2.970700747554073e-01   +1.427003726242512e-01   -1.131177311541229e-01   +4.036438805778010e-02   -1.012422554518571e-01   -2.598619286235548e-01   -1.835614778315315e-01   -2.652240660286480e-01   +4.111763571493890e-02; -7.223934189242923e-02   -3.403697479307913e-01   -8.904640690904617e-03   -1.382038075010149e-01   -1.383448187852574e-01   -1.278246828592594e-01   +1.404215331087579e-01   +1.322331357982294e-01   -1.732801911262473e-01   +1.568466828466633e-01   +6.795890622511630e-02   +9.759826088261403e-02   -2.144645152179368e-01   -1.160799630435692e-01   +1.815235358293714e-01   +1.250358975573103e-01; +3.263702075329069e-02   -6.011693105122298e-02   +1.050969089390707e-02   +7.024745597808869e-02   -1.774595026155548e-02   -2.069887583372948e-01   +1.281462624618446e-01   -2.562983818331876e-01   +1.969438332933124e-02   -2.844176165828519e-01   +1.070834434581008e-01   -2.511469633512086e-02   +1.237209164420000e-01   +1.793974255904186e-01   -1.005628664522858e-01   -4.950374426198129e-02; -1.230775125818178e-01   -1.082452721470247e-01   +1.210523148438254e-02   +4.800913786581862e-02   +3.001083590559970e-01   -1.969620260622860e-01   +2.581325623707519e-01   +8.855294752268492e-02   +1.197608151493446e-01   -5.228577160189614e-02   -5.712390386248703e-02   -1.678686321684750e-01   -7.581149431156617e-02   -1.946144203467781e-01   +2.956351062857480e-01   -1.121880419440974e-01; +1.342349791827707e-01   -5.189334964593995e-02   +7.136063197276550e-02   +6.067308092712710e-02   +3.277008860386793e-01   -1.847483316694569e-01   +1.908324083082769e-01   +2.321270275864588e-01   +2.319502915316559e-02   +6.017517137951921e-02   +6.841117218109541e-02   +1.245209580300680e-01   +1.168229768088923e-01   -3.331337334461626e-01   -4.349918515886114e-01   -3.678316891623696e-01; -2.271320889274948e-01   +6.081492617366012e-02   -1.740435464726218e-02   -2.782677543450451e-01   -2.336344120151298e-01   -3.078453312158105e-02   -1.732657350618549e-01   -2.939890012072049e-01   -1.557940415084565e-01   -3.623860989787297e-02   -2.344600929235770e-01   +1.654794302711408e-01   -1.474453613182435e-01   -1.095037226037560e-01   -1.301091616455935e-01   +1.680923317797984e-01];
L1E_L1I_iGABA_netcon = [-1.132434194730276e-01   +2.323693454180304e-02   -4.716489710929966e-02   +3.227839175825225e-01   -6.131576222771544e-02   -1.707895011913877e-01   -2.283061208994429e-01   -1.202092875398401e-02   +1.003174131074439e-01   -9.832946367597092e-02   -1.585650789916787e-01   -1.950246446234873e-01   +3.638284727813681e-02   -1.877142316219093e-01   -2.731378124034043e-02   -1.549481940170812e-01; -3.548989015922010e-02   +4.116193660479749e-02   -4.209062203630103e-02   +9.883370397619194e-02   +4.109457633594489e-01   -2.258441047023428e-01   -7.679073573437201e-02   -6.877834302430869e-02   +1.245605353426572e-01   -8.252738290138402e-02   -1.231733963770768e-01   +8.834407830543628e-02   +1.378062810079652e-01   +7.255530410072102e-02   -6.236374521779423e-02   -1.066252815978986e-01; -3.496024313755820e-02   +3.869761017831519e-01   -8.106155650304853e-02   +1.136008420457013e-01   -1.530217658251565e-01   +2.030849926318526e-01   -9.018348743009975e-02   +1.814291239980151e-01   -2.992734647640367e-01   -1.457067316613754e-01   +1.961186352464924e-01   -4.322124505308691e-01   +8.448370741681015e-02   -5.103042770380568e-02   +1.271502153678932e-01   +2.050765801347926e-02; -5.246763064507609e-03   -5.370781179068870e-02   +1.304725172287844e-02   -5.406253667419519e-02   -4.989353452067605e-02   -8.353877789006016e-02   +3.522768994990907e-02   +1.906702625046335e-01   -1.221754361423421e-01   -1.429613428773091e-01   +3.147363031528907e-01   -2.945657288372193e-02   -3.041402337861299e-01   -6.973596305489714e-02   +8.980581076662265e-03   -1.475287474530801e-01; -3.419111588159943e-01   -1.120790987873632e-01   -2.788486340080703e-01   -1.428510685940535e-01   +8.149653525196469e-02   +1.192306297745946e-01   +2.462580109041114e-01   +3.339107092869623e-01   +2.341286652332647e-01   +1.126683791236971e-01   -1.913270752011306e-01   -2.863714347655066e-02   +1.462022673261845e-01   +1.693150319515453e-01   -2.440328271817922e-02   +4.209362160339524e-03; +2.427491468454073e-01   +2.310932109026239e-01   +2.143704363390308e-01   +9.727110673981063e-02   +5.180418658833492e-02   -9.126564687422067e-03   +3.458378572272296e-02   -8.731827754410808e-02   -9.861396126412829e-02   -2.887219091605430e-01   -3.304647550923417e-02   -1.409776916031060e-01   +1.492267000333508e-02   +1.651821005066638e-02   +1.356254706616987e-01   +7.279113104196792e-02; +9.011459165428613e-02   +5.724353906434461e-02   -1.578455244017795e-01   +1.787716158638801e-01   -2.724015979457952e-01   +3.200615441401584e-01   -1.855689689891998e-01   +1.075976172422031e-01   -1.200400348516829e-01   +1.443340321395475e-01   -9.496172354350366e-02   +6.958108025660129e-02   -1.710820425613967e-01   -9.216194707101372e-02   -7.190926594546050e-02   +1.795203073395811e-01; +1.776996864325324e-01   -1.324350994751562e-01   -2.134322901616139e-01   -1.718370580521282e-01   -1.660148353561762e-01   -7.883260208658316e-02   +1.080766274956552e-01   +7.051994916700284e-03   +3.770312529522604e-03   +2.567843943855195e-02   -7.446334902467899e-02   +4.184084037557684e-02   -7.581538927544132e-02   +1.095822826739515e-01   +6.441871237143941e-02   +2.632164068408424e-01; -1.856837968185632e-01   +6.175791530300068e-03   +2.566586463272438e-01   +8.580090279435398e-02   +1.158085412521821e-01   -9.308401665494966e-02   +1.642142971413835e-01   +1.845719334474995e-01   -1.945363172496956e-01   -3.049438882650464e-01   -2.118604214999100e-01   +9.401511046446777e-02   +1.595117685890005e-01   +2.013711601268655e-01   +2.751318282595908e-01   +2.926181647502817e-02; -1.299575775213042e-01   -1.931656391490471e-01   -1.934982474206707e-01   +4.019411599913944e-01   -1.593227707664024e-01   +2.943169624896178e-01   -1.395447653384254e-01   -6.764861323250726e-02   -1.492454114562832e-01   -2.085999882043182e-01   -2.402057173668334e-01   -8.001037714833693e-02   -5.735788803621379e-02   +1.980356466436311e-01   -1.270160862216322e-01   -1.837870198601848e-01; -3.165684192426299e-01   -2.609156312817179e-01   -4.245456058061673e-02   -1.820567300495882e-01   -1.630039643112504e-01   -4.047493621217788e-01   -2.252858256622721e-02   -1.130080135316032e-01   -1.527590939351786e-02   -1.345658866544741e-01   -8.906809632623514e-02   -1.883550283890775e-01   -3.853870208620519e-02   +7.414354220589299e-02   -2.309024290240952e-02   -2.032332814648342e-02; -1.809211574180269e-01   +3.352648735325552e-01   -1.406182438516983e-01   -1.983719886203337e-01   +2.184880037057119e-01   -4.225107615631508e-02   -1.436851993570420e-01   -1.751468614902814e-01   +2.448919811761622e-01   +2.013194839603917e-03   -2.320993068234678e-01   -1.484761346765631e-01   +1.152609067911078e-01   -1.165531234843770e-01   +2.262522086151150e-02   +1.369443019798970e-01; -1.077098558408217e-01   +2.190642684856960e-02   +4.477693689151033e-02   +1.879454039585425e-01   +1.115509207351827e-01   +2.164376941648101e-01   -3.211024972160478e-01   -1.204049458025502e-01   -2.082146477897255e-01   +2.444245892268840e-03   +9.249390468950701e-02   -3.096985865739071e-02   -2.524981970157973e-01   -2.256758312148746e-01   -1.941565350429315e-01   -9.266468854127985e-02; -2.960804685297726e-02   -2.249846568716575e-01   +1.029750987030907e-01   +1.052041829287055e-01   -2.636818756485794e-01   -1.958432590503215e-01   -3.041301097187973e-03   -1.329630974380558e-01   +1.783251700489410e-01   -1.297310812744677e-01   -1.733651977701306e-01   +8.086205967036617e-02   +1.451038191884090e-01   -3.134051931310489e-02   -2.508476368223436e-02   +1.218933088956111e-01; -1.153177325195943e-01   -2.034208084058369e-01   +8.994350838300477e-02   +1.784679388935398e-01   +7.798631249261072e-02   +1.275942957896643e-01   +1.624234693317190e-01   -1.537540673223507e-01   +1.637283388182305e-01   +1.086122318109363e-01   -9.837827127426978e-02   +9.135205408506475e-02   +2.983756697391591e-01   -3.595396119679649e-01   -2.458988010549832e-02   -2.717619939326183e-01; +1.262766320366113e-01   +2.348044416261684e-01   +3.181436237369167e-01   -2.610608902848206e-01   +1.526365543393751e-01   -2.394493628246682e-01   -1.833655785147666e-03   -6.986938198776316e-02   -7.459709217483643e-02   -1.346918912289534e-01   -8.026977684029803e-03   -1.237051458006177e-01   -2.851709172265222e-03   -1.843341443372915e-01   +3.858196932420891e-02   -1.154026089258001e-01];
L2I_L1I_iGABA_netcon = [-2.495875983138666e-02   -9.509157389816890e-02   -2.489926901804082e-01   -1.569860018477910e-01   -1.274941587104991e-01   -5.108699582700797e-02   +1.527816973273171e-01   -1.619563341851814e-01; -1.155987057092207e-01   -1.219145456956907e-01   -1.515236753925008e-01   -8.919181562839443e-02   -8.429268936122676e-03   -4.444766011734289e-02   +2.351573100472805e-02   -1.116549739669751e-01; -2.079135986739052e-01   +4.698623633167655e-02   -1.344514403381930e-01   -1.839944991719136e-01   +3.226063721567087e-01   -7.685788044765120e-02   -2.047936448687804e-01   -2.336671648857015e-01; -3.620066217198648e-01   +1.298955114260524e-01   -3.853114796966511e-01   -2.347527642842952e-02   -9.965250904499931e-02   +5.914138705270272e-02   -1.721869544749239e-02   -1.865065168467321e-01; -1.672743311405507e-01   -8.908651825671940e-02   -1.658492002656370e-01   +2.446296685148388e-01   +6.058396092520411e-02   +2.041177892303628e-01   -4.786827566800926e-02   +2.024295425850378e-01; +1.849998201683954e-01   +1.928071203291179e-04   +1.689331986161542e-01   -4.099902264016689e-02   +2.344267510338731e-01   +1.564018833307300e-01   -2.433052037338273e-01   -1.947500493261560e-02; -2.537883823263015e-01   +1.626315757135180e-01   -2.713442372003236e-01   -2.264212977586749e-02   -1.198874941727569e-01   +1.647477507867798e-02   +1.898436122537602e-01   +3.998005790657422e-02; +1.213050888580219e-01   -1.217772969549261e-01   -2.041200867332673e-01   -3.736609361111207e-02   +6.553008303860866e-02   +8.846240324668499e-02   -1.886483628953829e-01   +1.402419014653547e-01; -3.130745243899804e-01   -1.615755372006351e-01   +1.343758388149307e-01   +1.827006337308812e-01   +2.873415842146322e-03   +9.263426383924252e-03   +2.293067420428239e-01   +2.238084467658120e-01; -2.036679964191756e-01   -4.059619249215248e-02   +4.458032216150920e-02   -9.309540003389019e-02   -1.338659457729002e-01   +3.839736023952636e-01   +1.716698486306369e-01   -1.701269638314610e-01; -2.696351259367555e-01   +8.370873689053945e-02   +6.819571111055549e-02   +4.884576031369718e-01   -2.098388935705391e-01   -1.918933439564498e-01   +2.811897010816174e-02   +1.558107852647518e-01; +1.091566662853635e-01   +1.021890055398406e-01   +1.981193891528248e-02   -1.273266295070667e-01   -1.711174597120572e-01   +2.672087334111136e-01   -8.584620091204966e-02   +9.071296196404385e-02; -6.135400575079662e-02   +4.369809301211865e-02   -1.308530236111143e-01   +4.123045773166112e-02   +3.505830886127383e-02   +3.407635201771499e-01   -6.733313304200526e-02   -1.110365652449230e-01; +3.253045060267235e-01   -1.494251504157185e-01   +5.347688316509012e-02   +1.710603206965567e-01   -2.613807981463206e-01   +9.598778529462233e-02   -2.314439024152833e-01   +2.156907553113661e-01; -2.383151330794725e-02   -2.814474953825227e-01   +1.551045859500581e-01   -1.694170681878562e-01   +4.845721796842709e-02   +2.802204944345785e-01   -1.541437603673245e-01   +4.565153070199161e-02; -2.941738224244751e-01   +4.667319576405710e-02   -5.930809016066628e-02   -1.059674749147851e-01   -6.279613390109046e-02   +4.936755770901483e-02   +3.555636466551959e-02   -2.651287970428883e-02];
L1I_L2I_iGABA_netcon = [-1.053162215184743e-01   -1.262385157765919e-01   +3.707905643965157e-02   -1.404251759802818e-01   -2.535168374804335e-01   -3.791694654038789e-02   -8.323109994678558e-02   +3.915954011555318e-01   +2.050745685654798e-01   +2.154390525781448e-02   +4.235713176326018e-02   +1.987236216416096e-01   -8.812583787440867e-02   +1.074689539877204e-01   -1.727350276452743e-01   -1.886112896432268e-02; -2.705969694592761e-01   +1.550744103452690e-01   -1.802066411824045e-01   -6.659488711435181e-02   -2.207497067853787e-01   -3.008326723870758e-01   -7.884877461497543e-02   +2.983468577554456e-01   -1.170451455680893e-01   +1.112383501628538e-01   -2.635225640531105e-01   -2.998141617159084e-01   +5.846637632225326e-02   +5.496487575477657e-02   -1.412507566222439e-02   +1.110819485473071e-01; -7.018039128996664e-02   +1.248112840584507e-01   +5.729663887273133e-03   -1.957352395920533e-01   +2.855891625934230e-01   +7.250276503303030e-02   -7.286918716715136e-02   +5.734513291734689e-02   +5.508009294240963e-02   -1.210185030111735e-01   -4.706094435557148e-02   +1.381983533201612e-01   -3.418123961513078e-02   +2.023483867371694e-01   -3.853511205378460e-02   -7.931083414363947e-02; -9.676768924445878e-02   -2.343849814601949e-01   -2.221410460773838e-02   +1.336348061755797e-01   -3.701583688423611e-01   +5.185083920524227e-02   -1.855794908019427e-01   -3.476659428898845e-02   +1.587224782591208e-01   -2.606530145255078e-01   -8.583387033080696e-03   +1.859216557646013e-01   -1.586085008422030e-01   +1.791557046577390e-02   +1.887393081072896e-01   -4.106419927531221e-01; +1.382928198036569e-01   -1.327073277768651e-01   +1.181715165706842e-01   +3.044352870710104e-02   +2.588021001956551e-02   +1.329557598746667e-01   -2.092480446154505e-02   -2.327875963053114e-01   -1.242731416509409e-01   +4.149727203832176e-02   -5.316221969428461e-02   -6.102188524906101e-03   +1.066702068144818e-01   +1.061645197759482e-01   -8.047293534229977e-02   -5.448419740287534e-02; -3.066476931734060e-01   -1.370850573086375e-01   -5.952826912063796e-02   +9.123639023332593e-02   -6.197780444879834e-02   +1.966893179425702e-01   +1.420141726538487e-01   +2.862519425095297e-01   -1.441431676351440e-01   +7.319760168026346e-02   +8.491316801832961e-02   -6.718707748878960e-02   +8.142012502923031e-02   +2.033571150066355e-01   -1.113588778925961e-01   -3.468212718510016e-01; -2.516478149956168e-01   +5.596305308548711e-02   -9.037025641313294e-02   -1.324891018227294e-01   +3.418245108227247e-01   +2.063181673011287e-01   +5.722842971108725e-02   +3.832482814971742e-01   -1.910654643252644e-01   -2.763106423512320e-01   -1.421368412014219e-01   +2.175710089735708e-01   +1.026012560858996e-01   +8.582684228832058e-03   +1.838704752305486e-01   -3.565048087077201e-03; +9.054307153403060e-02   -1.991532519713854e-01   -7.831147909702654e-03   +8.218721074313279e-02   -1.288466994562175e-01   +1.576227645591886e-02   +1.610428011600698e-01   -7.423758225637424e-02   +3.146234823789276e-02   +2.021565425384281e-01   -3.642736020043150e-02   -1.004976505160405e-04   -1.194406126565330e-01   -8.600133508228186e-02   +1.453194564980695e-02   -2.429530183010903e-01];
L2E_L1E_iAMPA_netcon = [-3.063554764350084e-01   +1.807460469508611e-01   -6.415559463043716e-02   +2.800257845977329e-01   +6.000573985740303e-02   -3.532024032740396e-01   +4.375138125607998e-02   +9.714164614837520e-02; +8.559677102547195e-03   -9.123698708362471e-02   -1.108258212476910e-01   +4.267547617397117e-02   -7.129810956333341e-02   -1.323861552289845e-01   +1.361125369212041e-01   +2.053187299128516e-02; +3.426838588785978e-01   -2.395890557440323e-01   -2.203176522009810e-01   +4.730790958696611e-02   -1.559313306667113e-01   -1.577546774515663e-01   +2.059651903030351e-01   -2.067264891333772e-03; +9.830048395196772e-02   +2.523930733695439e-01   +7.906567972116904e-02   -2.681858349813235e-02   -7.863508277134533e-02   +2.544930632906266e-01   -1.067741146392274e-02   +8.924173005078107e-02; +1.255409211631839e-01   +9.833350272827948e-02   +5.168414320070799e-02   -9.259866544789769e-02   -1.861104423701634e-01   -1.018247155379724e-01   +2.825055928484251e-01   -7.499027875678496e-02; +1.613133035326229e-01   -2.590277996716353e-01   +6.937962646460880e-02   -1.725776562730209e-01   -1.169407658250380e-01   -2.902478942455993e-02   -7.784306388757326e-02   +2.776391338678240e-01; +1.753230435059635e-02   -1.014264473324197e-01   -7.811938523441017e-02   -8.132691214020812e-02   -2.213123308002233e-02   -2.121181339927803e-01   -1.238412290699680e-01   +3.166541695185044e-01; +3.041471794454021e-01   -2.048630794365343e-02   +1.325118825459648e-01   +5.069223450606623e-02   +2.807712490219598e-01   -1.658672041678052e-01   +2.125465589389481e-01   +2.215178737510825e-02; +6.144315754694622e-03   -4.906751120174620e-01   -7.656876305562048e-02   +9.663554653372439e-02   +1.555458727606586e-01   -1.454371036087912e-02   +2.022181268804414e-01   -3.014712970613973e-01; +1.827264806738567e-01   -2.399411430648418e-01   +1.926763765940932e-02   +9.223128008718891e-03   +1.769269449286628e-01   -1.686424613014235e-01   +3.157678576583397e-02   -1.164625959268791e-01; +1.832457050548448e-01   +5.602503515958813e-02   -9.637103318328241e-02   -7.741073616855204e-02   +2.842038370393053e-01   -2.076629456059626e-01   -7.658164949292983e-03   +3.653541026369005e-02; -7.836078606708072e-02   +1.856985241667152e-02   +4.238583697248369e-02   -1.605077839240827e-01   -3.696856223408704e-01   +6.923641154753904e-02   -2.616037961504985e-02   -2.075645852165451e-01; +1.699180482225999e-01   +6.478560468479558e-03   -1.351127359470285e-02   -2.908643230107614e-01   -1.112199010894137e-01   -9.112843905091453e-02   -8.545402746434989e-02   +2.904797974396005e-01; -2.416046232311465e-01   +1.730667031138735e-01   -1.810260869387371e-01   -2.116614678529881e-01   +1.655569175260519e-01   -1.875563596509453e-01   -7.574101585146102e-02   -1.166351435840175e-01; -2.811395043525752e-02   +1.458596371204789e-01   +1.675101396607862e-01   +1.968886924016062e-01   +5.658681087776633e-02   -2.087078533146048e-01   -2.885699715895606e-02   -7.724473534755158e-02; -2.004279659883987e-01   -8.638279939500101e-04   -7.141841011554446e-02   +4.320454427931355e-02   +3.061592973504508e-02   +3.394198452601732e-01   +4.098917344756624e-02   -1.504344959106121e-01];
L1E_L2E_iAMPA_netcon = [-9.972365195432049e-02   +1.463190468731495e-01   -1.972203023667114e-01   -7.883244130198609e-02   +8.816183188815410e-02   +2.234513997624410e-01   -1.982361992166563e-01   -6.945490513841944e-02   -1.283419246526643e-01   +4.622924532818549e-02   +3.669152964236465e-01   -1.359196555785057e-01   +1.724019177049892e-02   -8.881631778688728e-02   +1.478638059042726e-01   -2.841635191634275e-01; -1.135657843225362e-02   +2.628416765791440e-02   -1.538766179301528e-01   +1.180771833730249e-01   +2.482735033518064e-01   +4.133561580593385e-02   -1.070806562162578e-02   +2.549674591445159e-01   +2.226858659776861e-01   -1.647224011536229e-01   +4.388803583311671e-02   +5.289317724005723e-02   +2.979894368343843e-02   -1.799338630232106e-01   -1.370591711967231e-01   -2.354073448539759e-01; -1.368649124805013e-01   +6.252283927250762e-02   +1.225095183036948e-01   +1.178413685058744e-01   -1.291173528355397e-01   +4.857475541138720e-02   -1.248889500866760e-01   -8.880257168215026e-02   -2.232369571295893e-01   -1.389672791739879e-01   +1.420727398751859e-01   -8.207532971341892e-02   -2.419970224696959e-02   +3.426130755898267e-01   +3.685344025320458e-02   -2.623111101297125e-01; +1.705451652500524e-01   -7.803802949109651e-02   -1.293475974158269e-01   +1.999639636182446e-01   -9.283068883227270e-02   -4.428393812673641e-02   +7.138899845106088e-02   -4.330643056925956e-01   +4.252765695398493e-02   -2.117141160155960e-01   -1.127493213272902e-01   +1.251472170667641e-01   +2.255653880389349e-02   +9.537134867515540e-02   -2.890897057277446e-01   +6.348685782153293e-02; +3.445276811462075e-01   -2.666611021040141e-01   -3.456068000047434e-02   -7.550700459046612e-02   -2.390333539782096e-02   -7.513757972857413e-02   -1.585253161287332e-01   +2.368777185911772e-02   -4.571664045300635e-02   -3.263618637840726e-02   +1.359147527460201e-01   -1.539764522536668e-01   -4.483140071806030e-03   +8.156929299305574e-02   +2.015593719251129e-01   -1.855432564247732e-01; +2.291181159586168e-01   -7.634812342187945e-03   +8.087231836729605e-02   +2.141000315744986e-01   -6.019355199226117e-02   +2.885047214765645e-01   +8.616311481841965e-02   -1.178872083542551e-01   -3.930752282679362e-01   -1.329038990968102e-01   -3.655196741259074e-01   +1.684829772491921e-01   +1.614720873140470e-01   -5.758352292907572e-02   +1.738096699555502e-01   +3.681837576237350e-02; -2.636458012156714e-01   +1.180439205141065e-01   +1.866430170039992e-01   -5.714731853249699e-02   -1.310533571760925e-01   +1.105468722136033e-01   -1.719495175470625e-01   -1.980398005060133e-01   -1.085291739995299e-01   -1.371789752614129e-01   +1.756873555799611e-01   -2.046162823388083e-02   +3.950612755575375e-02   +2.173785351802390e-01   -4.996499833545574e-02   -4.633955830730664e-02; -1.188641929616012e-01   -1.419952788869934e-01   +5.768807715234237e-02   -6.883012436705760e-02   +7.805681395254956e-03   -9.629748122931758e-02   +2.065752138064543e-02   -1.328144348465788e-02   -6.498513428497409e-02   +1.245504168574261e-01   +2.324695825360235e-01   +1.862624621255788e-01   +1.331977413818910e-01   -2.488886172616232e-01   -3.497025217559569e-02   +2.673676054749937e-01];
L2I_L2E_iAMPA_netcon = [+4.027018273068825e-01   -2.597570578515647e-01   -3.738126661803148e-03   -2.085213724717295e-01   +1.407476961301377e-01   +8.300962631916081e-02   +6.104319548589560e-02   -1.332973641312755e-01; -6.784133453285103e-03   -8.572935182112017e-03   -9.945490597064824e-02   +2.018068642007541e-01   -2.060904566896853e-01   -1.416187224539691e-02   -2.142339701369532e-03   -4.318723739740550e-03; -3.255768007289141e-02   +1.149596561124391e-01   -6.648343332543320e-02   -8.296096750560907e-02   -2.786503747089173e-01   +1.730419893266949e-01   +9.497974539555912e-02   -1.198267341029559e-02; +1.204023149786104e-01   -1.314976370585063e-01   +5.443663069210146e-02   +9.609593027563193e-02   -7.535141128335260e-02   +1.620196853503861e-01   -9.547152528071839e-03   -1.456978391772145e-01; -1.706019121935285e-01   +2.085410285098979e-01   +4.420022880290975e-02   -3.758307870026215e-02   +6.833109100053910e-03   +1.666252650693470e-01   +4.462611359630860e-01   +3.247634505773265e-01; +9.811645634651617e-02   -1.876164567394634e-01   -1.197867899317299e-01   +3.267414943652484e-01   +9.963504727441019e-02   -2.814075676067571e-01   -1.259710051551278e-01   -3.296199747987956e-02; -2.016952095715623e-01   +7.810152535873364e-02   +1.105837256579579e-01   -7.979177109549609e-03   -1.520189186891496e-01   +8.519711914283495e-02   -1.115587539802793e-01   +6.621577805957340e-02; -1.590497830095899e-01   -8.990615193193888e-02   +2.049824256475361e-01   +2.106859996732424e-02   +1.717856382071828e-01   -5.109709440413313e-02   -1.249017335997209e-01   -3.078522280328821e-02];
L2E_L2I_iGABA_netcon = [-4.866939686405830e-02   -1.197956554789219e-01   -1.191078424187096e-02   +2.208464226466021e-01   -5.529197256560942e-02   -6.709025376807498e-02   +2.006998791324610e-01   -2.155292187197519e-02; +2.213236196897810e-01   -3.276540734183905e-01   +1.749742662314276e-01   -2.755754565466557e-02   +1.352284474765767e-01   -1.263575427903101e-01   -2.247228560071583e-02   +3.206678647322401e-01; -3.700136323700262e-01   +4.121253050707616e-01   -6.778832204156221e-02   +5.515668208332244e-02   +2.034675817956738e-01   -1.378933518545331e-01   +1.617208846031237e-01   -6.421888580780807e-02; +1.857745535155329e-01   +4.810201792868545e-02   +1.239705356656289e-01   -3.193657135204667e-01   +1.578651824359587e-02   -2.005290470807806e-01   +4.862119034337749e-02   -1.108401128004219e-01; -1.347683972856008e-01   -2.930151977279986e-01   -2.306960186368543e-01   +4.431560870412159e-02   +2.283928499914755e-02   +7.833517051054548e-04   -1.499422290799422e-02   +1.129058573948888e-01; -3.523013093214912e-02   -2.982283514763200e-01   +1.418954005742687e-01   +5.832624150070208e-02   -5.721855793055457e-02   +5.822256078315605e-02   -6.017391991721323e-02   -3.021465030769752e-02; +6.638589726880116e-02   -1.295167683381052e-02   +2.616435788303053e-01   +1.539937058314950e-01   +1.855850992866940e-01   +2.459527102470227e-01   +1.495595678891513e-01   +1.061139064807878e-01; -1.575559753597045e-01   +2.989944520264667e-01   +1.883400858146234e-02   +1.078581306430154e-01   -1.560824805712093e-01   -1.161971620961243e-01   -1.250566924942566e-01   -7.589334411971635e-02];
L3E_L2E_iAMPA_netcon = [-1.832571052452575e-01   -4.222257968061244e-02   +9.511004181637218e-02   -1.486131281318510e-01   +2.754009882221717e-01   +3.986745488932855e-02   -4.267044306354620e-02   -1.434730581723791e-01   -2.802570767619337e-01   -2.560751764295995e-03   +2.127869221467149e-01   +1.035239858891715e-01; +1.386690060550835e-01   -1.081632791539908e-01   +1.664745527143144e-01   -2.843118099389054e-02   +2.270631061995336e-01   -2.071626263739291e-01   +1.837591998473199e-02   +4.861377285827584e-03   +2.087277859443746e-01   -1.219383189583716e-02   -2.063390644184226e-01   -1.476248311812384e-01; +1.949486713211808e-01   +5.474722508996314e-02   -1.233418456494917e-01   -9.144177477648258e-02   +1.962813549084621e-01   +1.109497684576654e-01   -1.393410076650342e-01   -9.995492324023326e-02   -1.652775446033726e-01   -1.646514225749912e-01   -2.308587945326772e-01   -1.162903332538524e-01; +1.556126309670268e-01   -4.459501483832456e-02   +1.524900047426798e-01   -1.357935227795711e-01   +4.222369363113708e-02   +2.713720253626695e-01   +2.293815197989816e-02   +2.303458254848478e-01   +4.852320608409372e-02   +2.699749198040013e-01   -2.736261386440055e-02   +1.134679989270562e-02; +2.259258729763897e-01   +1.618357227772257e-02   -2.879983139492236e-01   -2.351252539994834e-01   -3.354332811207460e-02   +2.659547195274868e-02   -7.232322992698346e-02   -2.859608451598950e-01   +1.511609428434116e-01   -5.990035748532012e-02   +5.121843759485425e-02   +4.325983721519966e-03; -3.204558986758171e-01   +2.881795087730529e-01   -1.187762188548507e-01   +9.404378863103634e-02   +1.565971531519232e-01   +1.318516684423503e-01   -2.450248237975569e-02   -6.913967090931718e-02   +2.946089851540852e-02   +1.038479542621372e-01   +2.310411310073800e-01   -1.432565965754955e-01; -1.322721931653936e-01   -1.614998979787116e-01   +6.281454653489137e-02   -2.502056460566668e-01   +3.558816963217009e-01   -1.877475141878117e-01   +1.735534170053938e-01   -9.010580082042516e-02   -6.224206858275621e-02   +1.470787776822725e-01   +1.690505951698316e-02   -1.162900778382342e-02; -2.900084437030128e-01   -1.990651046690104e-01   +8.832669285243003e-02   -2.231174539298538e-02   +5.636933151810475e-02   -4.948518373186645e-02   +1.702066968977324e-01   +2.461363093146077e-01   -5.177701538209213e-02   +1.638648325179320e-03   +1.427796584213866e-02   -3.397086315328238e-01];
L3I_L2I_iGABA_netcon = [+1.479453950369686e-01   -1.242223716688376e-01   -9.872457285938702e-02   +3.722518623562063e-02   -2.109361819370773e-01   +1.382391822665438e-01   +6.407342761476276e-02   -1.352043283649810e-02   +1.009717674635095e-01   -1.497892949031972e-01   +1.272821283236705e-01   +1.077919867483532e-01; +2.863062728594485e-01   +1.939893814907971e-01   +2.261574380138213e-02   -1.345325185991284e-01   -3.611063363279431e-02   -1.089998472234066e-01   +7.998207170498202e-02   +2.642206283136177e-01   +1.149487183620901e-01   +4.454577819071188e-02   +1.871341907800881e-01   +1.238947166277941e-02; -2.120072121477467e-01   -2.416091262254016e-01   +8.443525545505087e-02   +2.237800699902469e-01   +1.174414758672282e-01   -5.794090705020730e-03   +2.701105901120039e-01   -1.457596724330653e-01   +8.502617423870147e-02   -2.352325223422854e-01   +1.597497894102039e-01   +1.487665538775989e-01; -7.739879062636203e-02   +1.964474404886380e-01   +5.078088090473321e-02   -1.119776813992937e-02   +1.312909669995159e-01   -8.485145230027161e-02   +2.587709162117055e-01   +1.164227178838981e-01   +1.222377442386804e-01   -1.766786304555648e-01   -3.019446125698355e-02   +8.517130120478850e-02; +1.092477782825525e-01   +4.417871228026963e-02   +2.316262299548955e-01   -4.105144793808546e-02   -4.174065215479827e-02   +3.438969215791922e-01   -2.311261187769291e-01   -1.630821428332893e-02   -1.993352005339808e-01   +2.208847307392469e-01   +6.088627394770239e-02   +1.070086940862128e-01; +1.311955717487112e-01   -2.778002268743784e-01   -3.446089845384382e-01   +8.572820886122576e-02   -2.064367676862405e-01   -1.714083521634522e-01   -1.153194409666533e-01   +6.089122278230789e-02   -2.601881059117538e-01   -1.933306870217279e-01   +5.743430526930987e-02   +2.181615727569029e-01; -1.856788309050409e-02   +1.983406264943316e-01   -1.689473245088673e-01   +2.614402808953759e-02   -2.026840688927496e-01   -6.779775633498630e-03   -2.427008413694803e-01   -1.378084685799200e-01   +2.300717163000251e-02   -1.941468621950707e-01   -2.963067414031236e-01   +7.926094481257474e-02; -6.002501237612375e-02   +7.699044375761413e-02   -1.575490492663957e-02   -1.354676309865085e-01   +1.410289118979134e-02   +1.288916755940341e-01   +8.668065191213395e-03   +2.376660283912406e-01   -2.224814447962702e-01   -1.741476914702506e-01   +2.899554134616656e-01   -4.481707941089021e-02];
L2E_L3E_iAMPA_netcon = [+1.552707976293256e-01   -9.883338717040355e-02   -3.102417094769624e-01   +1.702870187711485e-01   +7.833253753340465e-03   -7.635821981622112e-02   -2.462268420393553e-01   +7.519829770956828e-02; +1.095268518836659e-01   -2.804491801946586e-01   -1.778751150123021e-01   -2.503934439288903e-01   -1.025472803663714e-02   -4.773376755179736e-02   -1.208309171982789e-01   +3.303682113675243e-01; -1.850689449547248e-01   +2.887637628667472e-01   +1.842368995825072e-02   -1.303136728082106e-01   +1.044630642137184e-01   +3.720278024300683e-03   +8.442261984068167e-02   +7.083274037016916e-02; +4.155179902050793e-01   +3.540858396915129e-01   -6.096884634656433e-02   -7.718233503904633e-02   +1.068184958795036e-01   -4.993667962472512e-02   +8.838800371481931e-02   +2.389430693618664e-01; -7.189995913447667e-02   +1.678756199143722e-01   -5.290022636534550e-02   +1.512274346234605e-01   +3.875261482352851e-02   -6.372152104700624e-02   -1.904950522440957e-01   +9.932153150169230e-02; -4.951691883544340e-02   -1.898909099009336e-01   +2.435832298721510e-01   +1.399088976832528e-01   +8.937094299714959e-02   +2.979560707636786e-02   -1.006282262771685e-02   +1.925481950432273e-01; -1.309394925098298e-01   -1.724097729467834e-01   +2.844592971737215e-01   +8.657272574197539e-02   -1.539613947098779e-02   -1.332584015298555e-02   -2.049046265524324e-01   +9.578768205843284e-02; -1.211944499921030e-01   +1.617698803551542e-01   -1.361887266449904e-01   -9.994142512932866e-02   +7.286658883963247e-02   -1.449494846794434e-01   +7.844705187213172e-02   +1.912637705616646e-01; +8.628537752583605e-02   -1.162487417513920e-01   +2.345587359348649e-01   +1.627190381486041e-01   +1.357995628097703e-01   +4.354660468493679e-02   +2.179328570134998e-01   -1.055417776437447e-01; -2.739679383193285e-01   -1.446306651876555e-01   +8.998608446793545e-03   -2.050459941857883e-02   +1.451316978446691e-02   -8.899471473282117e-02   +7.135945063894478e-03   +3.248126011467008e-02; +4.963919586924399e-03   -3.779287343117811e-02   -1.578424960061793e-01   -4.862247079810361e-02   -8.751931936077871e-02   +1.085065289903970e-01   -1.245587944150997e-01   -8.207640837490210e-02; -1.251720033353979e-01   -7.977498962763493e-02   +6.339861781394271e-02   +1.625574192426210e-01   -8.502514356249075e-02   -2.227082324715005e-01   -9.506247064232340e-02   -2.070074472284787e-01];
L2I_L3I_iGABA_netcon = [-1.276676163015259e-01   +1.330157337918052e-02   +1.630379727481684e-01   -1.415363662809113e-01   -4.144190922635925e-02   -8.390938566952874e-03   +8.715000361209918e-02   -5.157311864205815e-02; -1.274543294037833e-01   +5.990306068632426e-02   -9.413327459499932e-02   +4.827667028353083e-02   -1.228006243989827e-01   +2.677861074075275e-02   +3.820139834571884e-01   +4.412300087373548e-02; +2.130775839484680e-01   +3.158608257146679e-03   +2.372084180613352e-03   -2.274637646791746e-01   -3.679921810075237e-02   -9.400638441151483e-03   +3.700359333134377e-02   +1.690823295212862e-01; +7.669138916376604e-02   +2.617980036837277e-01   +8.789131812450821e-02   -7.656203783301038e-02   +1.437155946845359e-01   -1.307077688583872e-01   +2.415797017383648e-01   -2.180320543396742e-01; -8.913082139214780e-02   -2.322696965125558e-03   -1.932738695454383e-01   -9.993322531866622e-02   +1.491783942867399e-01   +1.518509178621223e-01   -6.195521582976520e-02   +8.326425041970981e-02; -2.390969891871534e-02   +1.914523659548006e-02   +2.757541997125676e-02   +3.760935923141803e-02   +7.957280466481836e-02   +1.846245818663556e-01   +1.030265534409850e-01   +1.627244073815852e-01; +8.300951960482227e-02   +2.552183058675546e-02   +1.181558151723998e-01   -1.120005848891621e-01   -6.304419440292161e-02   -8.478076676251439e-02   +2.982396760235734e-02   -8.199609155713238e-03; -3.928167402472808e-02   +2.198830731801837e-01   +1.575640122048299e-01   -4.336861421996940e-02   -1.629481433807138e-01   -2.558276741617600e-02   -2.678847674668771e-01   -1.530854479516560e-01; +3.789805772769822e-01   +1.831214220542985e-01   +5.730573672387382e-02   +2.380642947105950e-01   +4.169580900853293e-02   -5.921450122548703e-02   +3.480760799203200e-01   -2.602150545585770e-01; -1.224104616202884e-02   -1.395505144465716e-01   -1.514534786012437e-01   +1.798200668676393e-01   -1.290458355006844e-01   -3.144277243467419e-01   -1.758646906625722e-02   +5.356252538793097e-02; -2.046261207128617e-01   -1.676085195585639e-02   +7.261179281815203e-03   -2.381971457281312e-02   +1.819040480150902e-01   +1.473185879446598e-01   -1.159048040484618e-01   -4.324361858737875e-02; -8.832909718745134e-02   +1.947220219056300e-01   +1.741871476268665e-02   +1.411862543072575e-01   -4.296477123458262e-02   -3.023553664604304e-03   +1.087704709106154e-01   -1.748037939720040e-01];
L3I_L3E_iAMPA_netcon = [+1.377678626159707e-01   -5.208373329130294e-02   +4.109205304458577e-01   +5.735735252170909e-02   +2.714548054403711e-02   +1.875369059385046e-01   -3.255295964320080e-01   -2.267448772085521e-01   -4.914541393603067e-02   -1.449295864510088e-02   -1.307930026882849e-01   +3.991304078886755e-02; -2.453914812027937e-02   -3.559002958148177e-02   +3.442892758038121e-01   +8.943504567642496e-02   -4.551758730114591e-04   -4.323602947197366e-01   +3.313009896619337e-02   +3.015341541945198e-01   +2.617720832125632e-01   -1.100751068060491e-01   -8.086452750346455e-02   +1.028861131446711e-01; -5.543612471466583e-02   -2.227598596250089e-01   -2.365588301176951e-01   +5.018937277134046e-02   +1.634235843103623e-01   +4.059543830151412e-03   -5.596885417849083e-03   +1.424133279109116e-01   +9.994542066737838e-02   -7.274355003006164e-02   -5.223122453621829e-02   +1.514140945887228e-01; +4.905508700853906e-02   -5.035643082100098e-02   +3.501477511066067e-01   -5.226411411271233e-03   -2.881149307331918e-01   +1.232566192516417e-01   -2.778620457056892e-01   +1.717179383093028e-01   +3.921960818864477e-02   -4.254726509936242e-02   -3.868932553328565e-02   +3.079495030684875e-01; -1.054992721594669e-01   -3.176046553770152e-01   -1.774003778021513e-01   -2.504250173292343e-01   -2.719282494355805e-02   -2.259432308686393e-01   +2.138985096938727e-01   -4.921372480088670e-02   -1.199260118927112e-01   -3.324623224384626e-01   -2.053039449330084e-01   -1.963657232156944e-01; +2.076712822813246e-01   +1.528447588713168e-01   +1.423840807829843e-01   -3.221371307711305e-01   -3.096288913485861e-01   +1.292914817307038e-01   +1.350705797771502e-03   -3.785687613942427e-02   -2.457914705410821e-02   +1.594716151327380e-01   +9.071803937021977e-02   -7.533949100701912e-03; +4.535850389209434e-02   -2.253987421851603e-01   -9.957734342238542e-02   +1.495721965005546e-01   +1.467805907040076e-01   -1.721262032548473e-01   +1.621126865228780e-01   +2.686546484817427e-03   -1.828401737872908e-02   +2.313081567180254e-02   +1.079441546694279e-01   +1.323526088906808e-01; +5.699013511236227e-02   -6.070868649144830e-02   +1.181512031321201e-01   +4.978186533728807e-02   +3.365330196438795e-01   +1.554618905295279e-01   +1.250472953613413e-01   -8.413433929265603e-03   -1.867580466582682e-02   -2.717654254000095e-02   +1.459425290531940e-02   +1.900301803556307e-01; +2.982983909035982e-01   -1.924769834355979e-01   +1.979807033850021e-01   -2.237585944080538e-01   +1.335199638895674e-01   +3.334482109329324e-01   +1.989458502180717e-01   +1.457963345423068e-01   -1.872627134061034e-01   +1.316696646118420e-01   +6.500012622287106e-02   -3.777485343887656e-01; +1.858115277774520e-01   +5.959153778232473e-03   -2.425334025076555e-01   +4.354598099069731e-02   +3.154287787473255e-02   -8.774699769443542e-02   -1.379365311727000e-01   -1.095598484384165e-01   -4.992542937231100e-03   -4.711526630103909e-02   +2.054950217520052e-01   -9.648772211318807e-02; +6.320760182073989e-02   +2.398452147865757e-02   -2.969843223227925e-01   -1.777583481478014e-01   +2.439599596484282e-01   -2.461877595722250e-01   -2.719237361157513e-02   +2.422059028750431e-01   +1.760708113673859e-01   -7.144548741237183e-02   +2.098876343143160e-01   +1.216269332545274e-01; -1.626396938542378e-01   +2.122785738444928e-01   -5.842861102149215e-02   +5.628192432359783e-02   +2.279887705828102e-01   -2.159341917287838e-01   +1.238830963804528e-01   -2.116578771421579e-01   -1.276960691161275e-01   +2.066341615490931e-01   +2.486012210872400e-01   +2.040311723707364e-01];
L3E_L3I_iGABA_netcon = [-3.468705026369602e-02   +3.554353234836970e-02   +9.361728813517220e-02   -1.037541520174073e-01   -1.845307585671322e-01   -2.076279185379649e-01   +1.321796477065967e-01   -1.871020920895942e-01   -3.050730563975097e-02   +3.520055596437794e-02   -4.296237330819443e-02   +1.535554601941077e-01; -8.092443749683609e-02   -4.458640386861195e-02   -1.335484663419590e-01   -2.436711108846645e-01   +3.096539595249067e-01   -1.277137808631607e-01   -4.119074354220643e-02   +8.307108405462857e-02   -1.001762049054218e-01   -1.812172487520911e-01   +4.174418169570093e-01   +1.330020638737340e-01; -9.887592355163394e-02   +3.617213764834081e-02   +1.089743896673973e-01   +1.417947204772110e-01   +8.248647063538406e-02   +1.437674938091869e-01   +1.891461274236577e-03   +1.672329954934594e-02   -8.666003656405030e-02   -1.847015882228802e-01   -7.691156224306979e-02   -3.872983587484097e-02; -7.130008503297008e-02   -1.051951228458950e-01   -7.394362997287905e-02   -4.476628293961526e-02   -1.487059392649342e-01   +3.714710892241371e-01   +8.547308255737913e-02   -1.245569955106715e-01   +3.730594059401993e-02   -5.054420733670583e-02   -2.598941741711083e-01   +4.942518877569728e-02; +2.716433636247275e-02   +9.999067176462081e-04   -3.496836830298694e-02   +1.636770614421777e-01   +6.331137297037787e-02   -2.155224539933308e-02   -8.315931768397329e-02   -3.553640474362993e-01   -6.957236618339115e-02   +9.038173448385847e-02   -2.832575168951724e-01   +2.940145642938793e-01; -8.275133903054942e-02   -1.686679620643789e-01   +2.277954392973180e-01   +3.609297185045089e-02   -4.482596769433104e-02   +7.223762884613796e-02   +2.208243612836154e-02   -1.270483367984655e-01   -2.290881119135050e-01   -9.536661601816535e-02   -1.224511346029177e-01   -4.677352098507857e-02; -2.284707349474882e-01   +3.036151209331087e-02   +1.171787640376728e-01   -1.986740861691271e-01   -2.273175338488215e-01   -2.504065095209062e-01   -9.759397142261111e-02   +2.123315243107819e-02   +7.781761292300328e-02   +3.459672950185516e-01   -9.576094348751337e-03   -7.584567965866583e-02; +8.858287984133439e-02   +1.564060888294393e-01   -1.585881761792606e-01   -1.146741528911062e-01   +5.350335322255117e-02   +2.728644790154633e-02   -3.204290857396761e-02   +1.173009479498980e-01   +1.248985251194202e-01   +1.637930039860262e-01   -7.125645621644421e-02   -1.234886248062994e-01; -1.716681673274421e-01   +2.811532290975207e-01   +1.163517559559652e-01   -2.512301990357315e-01   -3.266308980331586e-01   -3.078428057131847e-01   -2.042066733777661e-01   +1.346009277863698e-01   +1.294329107567126e-01   +2.293783634656240e-01   -5.833776489091256e-02   +1.743988127490820e-02; -8.089069078290670e-02   -1.952027388949811e-02   -3.786729264345957e-02   +1.040856904891492e-01   +1.977968006353325e-01   -1.570548401604873e-01   -6.510840142695186e-03   -1.156490645251158e-01   +4.130634275328067e-02   -1.401909138351235e-01   -6.490654399928758e-02   -1.114811711385715e-01; +1.512424551165802e-01   -6.205501629702369e-03   +1.218458396482032e-02   +5.417687885967162e-02   -8.076173274152183e-02   +3.030501900943592e-01   +2.968246027862265e-02   -2.913257567572896e-02   +7.879897262217526e-02   +1.643209674610267e-01   -2.438893485692076e-01   -3.760791928706292e-03; +2.290745479105918e-03   +1.720538709402781e-01   +2.587117638107620e-01   +7.833662714152270e-02   +3.123605013053447e-01   +3.727631052599556e-02   -4.154463289612802e-02   +1.243117438774601e-01   +6.311399423346649e-02   +3.164209940024758e-01   +2.679580868502143e-01   -6.880362026591316e-02];
L2E_Input1_iAMPA_netcon = [-1.641841881116562e-02   -1.677044933120054e-01   +2.835450182509674e-01   -7.553168317099172e-02   +1.648662525694310e-01   -3.976151823333102e-02   +4.813828259992207e-02   +1.697491721811649e-01];
L2I_Input2_iAMPA_netcon = [-1.372006996026633e-01   -2.124637060068385e-02   -1.996265155705304e-01   -4.161491854835573e-01   +1.345916666978817e-01   -1.218146540861235e-01   +3.458731210938653e-01   -2.728444344657595e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
