function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.845562280017877e-01   +5.061458146321413e-01   +1.845583769148309e-02   -7.650700050961540e-01   -5.006753296528898e-02   -2.089750534395846e-02   -1.125461670136422e-01   -1.847781252522029e-01   +3.164981170812587e-02   +2.786777369526022e-01   -4.468189858608406e-01   -5.484485230748858e-01   +3.753120256115545e-01   +1.446736731278664e-01   +4.502601634140209e-01   -1.962015981539413e-01; -1.597234991813428e-02   +1.215964989621297e-01   -2.104802338376372e-01   +4.076875434074764e-01   -2.070711338416515e-01   -4.829932107862391e-01   +6.611893686393161e-01   -1.378172363207653e-01   +1.424407940441904e-01   -5.854506835328920e-03   +3.956481599706709e-01   -2.096738719345638e-01   -4.349835976444715e-01   +5.533392877918285e-01   -1.955898256774024e-01   +6.475519916197106e-01; +6.018256865694137e-01   -2.837506382083506e-01   +1.187483429277877e-01   +4.401959797995681e-01   -8.658842695847890e-01   +2.977398457310529e-01   +9.503184388902350e-02   -8.440634817320771e-01   +4.171979492749526e-01   -4.441485125726279e-01   +1.079749079731231e-01   -4.026067298402377e-02   -3.798477863097449e-01   -1.254668176079892e-01   +6.350611267975353e-02   -3.721918806044618e-01; +2.974299708141531e-01   +1.263860495743309e-01   +1.889333288963523e-01   +2.025123028844436e-01   +7.385736037422130e-02   +4.879722084597204e-02   -1.452927018535142e-01   +1.376534793921925e-01   +1.665026881823277e-01   +8.720130712987220e-01   +2.539051185982472e-01   +1.771931943978839e-02   -4.665339070877691e-01   +5.916983364875835e-02   +1.729436105878936e-01   -2.741267685109548e-01; -2.652964524414865e-03   -4.839536911057499e-01   -7.070226557017217e-02   +1.898456575527932e-01   -4.224818646513023e-01   -6.980662551044883e-01   +3.954286524885150e-01   +1.356230585923255e-01   -6.510358406213949e-01   -1.869053343929986e-01   -6.208466423515228e-01   -2.931869416316649e-01   -4.175692546568203e-02   +8.748996909682411e-01   -1.558312653638837e-01   -2.042525472951423e-01; -3.866391750269046e-01   +1.922195171761104e-01   -4.825941777034310e-02   -3.506160306377181e-01   +6.331237959689862e-02   -9.075057477709206e-02   +4.796044913996603e-01   -7.610509105627489e-02   -8.187537429526867e-01   +3.630868836799082e-01   -6.290050965584777e-01   -2.439786521486929e-01   -2.283167989899366e-01   +7.214881669246231e-01   +4.138866847401382e-01   +4.843826847767224e-02; -5.131881884877331e-01   +1.517265020729176e-02   +1.150723742465757e-01   -1.800447491087507e-01   -4.205177120942024e-01   -7.318730266019107e-01   +7.071779052657597e-01   -2.288873415949534e-01   -2.891876232320431e-01   -5.452041599064165e-01   -8.352176558785783e-01   +2.513416723423196e-01   +2.685904926312001e-01   -1.258862125088970e-01   +2.944451209496871e-01   +3.619364590139136e-01; -7.173110650921171e-01   -1.251343605181180e-01   -3.172185091051026e-02   +3.990981045940260e-01   -8.694009856452934e-01   +4.045409775310471e-01   -1.361811968247999e-02   +2.569794750994251e-01   -8.455740822161970e-03   +4.274773979508519e-01   -2.023412677175725e-01   -2.379221846256081e-01   -1.747646796050138e-02   -2.823537333732130e-01   -2.683626393110780e-02   +4.858215092340608e-02; -1.707084771575092e-01   -5.352785800983453e-01   -7.622909118011578e-02   -2.842725043492939e-01   -2.602620203007518e-02   -2.185147610937588e-01   +4.339643847846772e-01   +9.124472468513932e-02   +2.603288963391833e-02   +1.000000000000000e+00   +1.092864161513591e-01   -2.481623726838263e-01   -4.277770003416777e-02   +5.614811125886142e-01   +6.548329755847874e-01   -1.810383266785546e-01; +6.486297494105023e-01   +1.001519763379315e-01   -2.822360402480121e-01   -7.108822752843251e-02   -1.195934230097017e-01   +5.955347653679210e-01   +2.492430748279900e-01   +3.655759776117234e-01   -2.882471871171330e-01   +5.261653933690705e-02   +1.421239845232421e-01   -5.217961296894960e-01   +1.184995665794863e-01   +1.258202878843437e-01   -4.394896084929509e-01   -2.295952191143245e-01; +3.631385013028759e-01   -3.352610401044085e-01   -6.280575211019945e-01   -7.294436750824772e-01   +2.868262027600543e-01   -2.417382709210875e-01   +2.394570293802216e-01   -4.493724852772517e-01   -3.607738923408568e-01   -1.905332991318113e-01   +5.284185784596163e-01   +4.155077903163356e-01   -3.103864447678463e-01   -3.306325583152301e-01   +1.859699955549768e-01   -3.189327660015815e-01; -4.568892546633978e-01   -4.180078742824976e-01   +5.816228838923306e-01   +3.821839431120913e-01   -8.338319445930707e-02   +6.434524757825398e-02   -2.048454843463124e-01   -1.792313408926448e-01   -1.027079885808243e-01   +3.741387255089385e-01   +1.603273815063372e-01   -3.526268685151261e-01   -2.593820727753645e-01   -2.820680052831337e-01   +3.064889236106210e-01   -7.874125897786943e-01; +5.799432043818343e-01   +7.581099185486340e-01   -3.359969804991783e-01   -2.260108774543284e-01   -7.480556067864645e-01   -3.660161085933363e-01   +6.189563344792059e-01   -8.607367223715926e-01   +3.591569101009128e-02   +5.478308032835107e-01   -4.111822302306615e-01   +2.000736409947749e-01   -7.736351682924320e-02   +1.289548885137245e-01   +4.219177899468764e-01   +2.220022957443382e-01; +6.131763890384517e-01   +8.554616931208164e-02   +1.278197269858043e-01   -9.290453185423582e-02   +2.040325816588198e-01   -6.607081285342367e-01   -2.150971789153003e-01   +3.596446393079518e-01   +8.748888030164893e-02   -2.633207884361224e-02   -6.717371888147626e-01   -5.398647395182651e-01   -7.725265368205484e-01   +3.703615164551746e-01   +2.775865373660161e-01   +7.029697645041876e-01; -2.625217206177844e-02   +8.613306966886849e-01   +8.002868357840506e-01   +5.730662530291528e-01   +1.621041214299268e-01   -2.733662506971763e-01   -6.798009239425207e-01   -5.632642100089990e-01   -6.365396813059158e-01   +5.366106543449173e-01   +3.144107682148470e-01   +1.063036864228481e-01   +6.432767532574796e-01   +2.793707983308568e-01   -7.854134537270530e-02   -2.338617058777168e-01; -8.516497903958921e-01   +3.872194829280132e-01   +6.949612964787995e-01   +5.870206401938604e-01   +6.100038125339083e-01   +1.908844919362497e-01   +3.850075504034479e-02   +8.678146831267970e-02   +1.210243757315705e-01   +2.517788753788684e-01   +6.664406579212439e-01   -7.989025460080473e-02   +4.987844505433041e-01   +3.321064003759092e-01   -2.432132313379103e-01   -3.626306585389748e-01];
L1E_L1I_iGABA_netcon = [-5.399523884121034e-01   -4.522260934733513e-01   +2.484104172576644e-01   +3.539064079945839e-01   +3.185588732678195e-01   -1.455829759040556e-01   +3.025309227025840e-01   +2.652227557904933e-01   -6.462752594983324e-01   -4.002622094882702e-01   +3.652758672881922e-01   +5.172194671933489e-01   +6.814255690310164e-02   -3.036154638076161e-01   -2.075047237922871e-01   +5.371349007607914e-01; +7.556454065326261e-01   +6.105723764742533e-01   -1.108084437840962e-01   +5.434163321669054e-01   -1.485957180909051e-01   -3.663306356665176e-01   -3.892813798583329e-02   +3.053797365118072e-01   -6.966937265342270e-02   +2.036001117351306e-01   +4.503427540112523e-01   +2.931425288870574e-01   +4.111507959943698e-01   -7.472411382535073e-02   -1.653014721664486e-03   +1.594394915309006e-01; -7.709085995998314e-01   -8.874667730397946e-02   +2.143698549719460e-02   -4.518974601162768e-01   +8.345802758193368e-01   -9.830638856633675e-02   +7.478091079561612e-01   +2.984211819176721e-01   +1.407960569945306e-01   -5.055447522300107e-01   -6.336605778592446e-01   +5.415871704741477e-02   -2.960298468807344e-01   -1.711486781499764e-01   +2.087557389679106e-01   -2.417548212468237e-02; +4.637966076094996e-01   -6.182932870795702e-01   -5.726101344506905e-01   -8.314405580304873e-01   -5.000293501420792e-01   -2.109888458312309e-01   -3.245765982795478e-01   +9.245278793129640e-01   +1.930398113467086e-02   -2.302725214619848e-01   -2.128811688041002e-01   +4.244772171770971e-01   -3.861511874589341e-01   -1.966913557400082e-01   -3.881757985413279e-01   -6.016480524114391e-01; -1.248398876763361e-01   -3.896403103942428e-01   -3.973613596332345e-01   +3.528908994020411e-01   -6.521882134905704e-01   +2.191851937370435e-01   +6.283112089841135e-01   -1.874884298329364e-01   -4.881284912699799e-01   -1.451501798219744e-01   +8.001222311402428e-02   -1.266007643810337e-01   +3.543544565209815e-01   -1.843160721591059e-01   -3.465102563746074e-01   -1.885737224842113e-01; -3.660762739318712e-01   -5.926439354690249e-02   +6.575169096553374e-02   -8.780836028769497e-03   -4.824381758448607e-01   +6.196560285079610e-01   +8.087953079343994e-02   +3.784872104656429e-01   -6.752796410338327e-02   +3.234214830350195e-02   +1.558998177340296e-01   +1.118144162427925e-01   +4.649221134395544e-01   +5.484790554218573e-01   -1.275949523995245e-01   +9.893047076582781e-02; +5.440821007607744e-02   +1.060512772720539e-01   -4.461639090947293e-02   -9.024490964315388e-01   -3.169113616413454e-01   -2.173205155160087e-03   -3.922450020031193e-02   -2.118071183091463e-02   -7.240455049652807e-02   -7.868838340528199e-02   -6.206594529645448e-02   +2.008685977918938e-01   +7.122122536248691e-01   +5.809243168938620e-01   +6.299512275660504e-01   -2.042587075598163e-02; +2.942116735725300e-01   +7.414447364174339e-01   +3.920077571867115e-01   -3.814675437136563e-01   -4.601269540658259e-01   +2.061311148986040e-01   -1.812336268987941e-01   +1.015784761797452e-01   +7.361306238540590e-01   +9.071846224568388e-01   -4.830740543992627e-01   +4.712086471294613e-01   +4.934666870921051e-01   -2.357346881005892e-01   +5.917986989875700e-02   -8.557933030465517e-02; +5.240028134019697e-01   -6.333732087610180e-02   -2.039361742467186e-01   -8.950702113485172e-01   -3.886167164486170e-01   +6.535885283818467e-01   -2.353021384363431e-02   +2.373827035168184e-01   +3.542217953188676e-01   +3.213216501948452e-02   -3.295342172421604e-01   +7.777297912586466e-01   -4.130209102108150e-03   -2.779516900398857e-01   +5.014613529530514e-01   -2.763346743773229e-01; +6.074333581930019e-01   -2.231717990744765e-01   +1.000000000000000e+00   +3.332306930063468e-01   +6.955153323067949e-02   +5.381167631547683e-01   +7.237929447493160e-04   +5.937728607120046e-02   +2.796062991203396e-01   -5.844262738393284e-01   -6.309079488673081e-01   +2.357036972694904e-02   -1.551782004644049e-01   +2.192185608441397e-01   -3.305384874971720e-01   +2.899679059722006e-01; -2.859794279198534e-01   +3.581907531691897e-01   -1.973192940803826e-01   +4.306506166556746e-01   -9.445454017412377e-02   +1.821435133796354e-01   +5.738643780080243e-01   +8.054182038132849e-01   +1.162323777309292e-01   +7.662364417522055e-01   +2.922931917821407e-01   -2.179201445902754e-01   +2.663395545010469e-01   +4.660887884906128e-01   +3.965680543427194e-01   -4.213714580583939e-01; -1.006829873224551e-01   -4.008312224037191e-01   -8.000350258748780e-01   +2.677101046962740e-01   -3.261164831307951e-01   +4.630536523389827e-01   +1.167513887795388e-01   +4.876684223813348e-01   -6.300850893229973e-01   -6.244262879824181e-01   -3.014713760681792e-01   +6.919052267557159e-01   +9.461040163803862e-02   +5.710677233939078e-01   -2.419242292093460e-01   -5.124879878377394e-01; -5.422811877306689e-01   +7.778735927833134e-01   +4.757289273486328e-01   +1.098950527321172e-01   -4.701997977394112e-01   -1.124445713469601e-01   +3.749094569270937e-01   -6.283527291961154e-01   -6.643642678752687e-02   +5.613196745721492e-02   +1.544246903396328e-02   -2.005998441568060e-01   +3.952915026948545e-01   +5.404828694659312e-01   +5.905493335917570e-01   +1.254072180184863e-01; -5.346004795338382e-01   -2.616670185080105e-01   -5.369622809848068e-01   -4.342531885161608e-01   -6.785804898389697e-02   +4.451117393916781e-01   -4.124409710037214e-01   +5.326287355485569e-01   +3.103120557579294e-01   -2.996313536101040e-01   +6.615338127306551e-01   -7.247597981453438e-03   -2.145686725993979e-02   +6.149933423810977e-01   +1.370243140355863e-01   +5.039479630086647e-01; +3.841884816686191e-01   +1.710386053020282e-01   +3.537161623191900e-01   +1.555194819467004e-01   -2.696849453557061e-01   -4.531459203645389e-01   +4.935806309824248e-02   -1.303652673414190e-01   +4.703984604044894e-01   +4.927186441223876e-01   -4.894725430717484e-01   -1.748076343988262e-01   -3.301436940431376e-01   -1.869104941324248e-01   +6.414001674445803e-01   -4.414005397452602e-01; +2.958127171164941e-01   +1.398400281447729e-01   -2.982865822394749e-01   -6.276024132571225e-01   -1.436260602406574e-01   +3.481561905997479e-01   -8.187509050726467e-02   -5.796743664171448e-01   +4.983607103194031e-01   -6.027515542185145e-01   +3.257599690198575e-01   +1.207092260395985e-01   +1.707677636817582e-02   -2.036383035472842e-02   -1.334733254306303e-01   +6.212493796634162e-02];
L2I_L1I_iGABA_netcon = [-1.461640050176462e-01   -5.488904358791910e-01   -1.389450198802536e-01   -7.206596506339226e-01   +2.742226355559679e-01   -3.152153658355948e-01   +9.825549974150051e-02   +1.678504192364566e-02; +5.544068572808599e-01   +1.654658810833750e-01   -3.383312674391205e-01   +4.069639841839344e-01   +2.975924186686684e-01   +5.187220461126805e-01   -4.957286191568248e-01   +5.796681142260602e-01; +1.086844167335954e-01   -6.367353040601127e-01   -6.938399903443825e-01   +1.005758270631583e-01   -3.292244691992038e-01   -3.624153131856293e-01   -6.667858899704284e-01   +7.072524889629979e-01; -6.737410516184926e-01   +5.212831499346201e-01   -8.497560635838391e-02   +4.507749411106653e-02   -5.224060450827651e-01   +1.101283307189284e-01   -4.479061216818354e-01   -1.998390531304310e-02; -3.027737717054009e-01   -5.722834523811322e-02   +1.455088589603064e-01   -3.092018420257129e-01   -2.607775248579531e-01   +4.140205695521130e-01   -6.831704668100734e-01   -1.807345609175486e-01; -7.395196800672149e-02   +1.953866526559488e-01   -3.158671494213101e-01   -7.819597796532080e-01   -6.251808284134304e-02   -1.026315923543148e-01   -7.752385214999857e-01   +6.376292305042341e-01; +4.473951099480976e-01   +5.308938684832187e-01   -3.036874427980579e-01   -5.993676247869596e-01   +3.408361254049735e-01   +4.802082732218516e-01   +2.096025674073996e-01   -6.538281675256612e-01; +2.434733615037865e-01   -4.157379109509731e-01   +3.637570607878226e-01   +6.705132143870562e-01   -3.320623971367815e-01   +3.989416139247642e-01   +4.950732301502195e-01   +5.109849713365757e-02; -1.718300174131425e-01   -2.927113404323156e-01   +5.701742510701866e-01   -2.148360083978346e-01   +6.640039968030416e-01   +1.477266144711836e-02   -3.316278448079429e-02   -3.370817866755493e-01; -4.494964419848654e-01   -1.156184451151176e-01   +1.101700903944076e-01   -2.825880169457030e-01   -4.645152598392552e-01   +8.468052929519362e-01   -1.070025546259097e-01   +6.008168426305477e-01; +1.410056422948519e-01   -4.616104566458301e-01   +1.584823250203216e-01   +2.637731121530105e-02   -2.649507867990659e-01   +4.445900966197508e-03   -7.986396437301668e-02   +1.866046786258770e-01; +6.807293854735302e-01   +3.234115761648154e-01   +1.844093259555302e-01   +1.046897763499428e-01   +3.790175963878326e-01   -3.298434062926052e-01   +1.104952570441764e-01   +3.368437337216491e-02; -6.198091418992956e-01   +3.175935851439475e-01   -2.829245874299186e-01   +1.270504427920922e-01   -9.647068373822576e-02   +6.205745141819526e-01   -1.000000000000000e+00   -3.768168868160603e-01; +4.165536707974927e-02   -2.708045127726096e-01   -1.487265322586985e-01   +4.436978142086964e-01   -9.147981654814409e-02   +9.638058645358907e-02   +5.068836804960920e-02   -6.105852062700155e-02; -4.459332029525872e-01   -7.340207303871747e-02   -3.090192363538919e-01   -4.374280032762039e-01   +6.846003269979374e-01   +1.227007158945515e-03   -2.758464083014874e-01   -7.731698365164077e-01; +3.098795767544104e-01   +5.190444447418546e-01   -7.662901962528701e-02   +5.237459477705558e-01   +3.905241200139791e-01   +3.041363695368700e-01   +1.309144886871370e-01   +1.225607245118669e-01];
L1I_L2I_iGABA_netcon = [+3.087742423016811e-01   -2.142985701825799e-01   -8.740684097820126e-02   -2.456739075128544e-01   +5.142683385661295e-01   -2.831544365528754e-01   +3.621392845042127e-01   +3.667786584685500e-01   +5.773342264000533e-01   +1.010106242110414e-01   -5.148049802182766e-01   -7.527478319503672e-01   +2.530437676594094e-01   -8.911202296418629e-01   +3.929351512830033e-01   +7.307394285395608e-02; -3.515451905389601e-01   +2.242381237986467e-01   +2.764392800236853e-03   -1.762881757531132e-01   +3.926114853674454e-01   +2.790936348138001e-01   +4.329488312274901e-01   -6.316614012875252e-02   -3.417204919722826e-01   -2.461743585906789e-02   -2.356867772319058e-01   +3.312399214429845e-01   +2.301259432441942e-01   -1.916450803763171e-02   -5.657813787661325e-01   +3.150903654845620e-02; -2.663182435586368e-01   +6.429698773776905e-01   -5.534006838418781e-01   -1.550639916525149e-01   +4.297800203645188e-01   +9.775143065909292e-02   +8.834725496167076e-03   -3.777515222162254e-01   +3.495261396260954e-01   +4.345332197591943e-01   +2.056075520480221e-01   +1.606019823546343e-01   +4.599414909672995e-01   +8.174001454860225e-02   +1.445961130269021e-02   -4.222907053485108e-01; -1.492215436940857e-02   -3.140141043701049e-01   +4.671405117972364e-01   -1.880654059994597e-01   +2.324825023603519e-01   +1.147651077946135e-01   +1.278756786613772e-01   -6.370911511358378e-01   -8.689456634476193e-02   -7.216764941702275e-02   +3.528772806964836e-01   +1.549713738545488e-01   +5.789635544338696e-01   -5.679310040912832e-01   -8.205368023453209e-02   -6.008693002269213e-01; +6.777284549946858e-01   -1.811429272815832e-02   +1.823432720603238e-01   +3.680774943146834e-01   +2.396746245895069e-01   +3.820162284975591e-01   +1.011021869318582e-01   -6.016162548817066e-01   -8.334672814913995e-01   -8.592241819551365e-01   -5.658305424630096e-01   +5.760990274837676e-01   -1.250265638252476e-01   -5.555746704466976e-01   +1.015604620473348e-01   +2.426662597408629e-01; +1.954816323877788e-01   -1.303673249337414e-01   +3.550726844396277e-01   +4.988231601177470e-01   -6.244571780656344e-02   +2.415156149369226e-01   +7.893102614514279e-01   -4.070309634247459e-01   +1.051389534478534e-01   +1.000000000000000e+00   -7.850317986351628e-02   +2.040548755630783e-01   -6.543149940512926e-01   +1.982230952843315e-01   -2.303475899323456e-01   -2.317027336785528e-01; -1.526336578640018e-01   +5.176772158438390e-02   +5.471730152030065e-01   -4.972186098769921e-01   -5.868764620396396e-02   +2.034097463595604e-01   +1.845514583798122e-02   +4.156238222787091e-01   -5.176814037453256e-01   +8.457412424009824e-01   -7.281801353122190e-02   +2.286582991598630e-01   -1.202950483905039e-01   +3.389218444571376e-01   +8.979812319699067e-02   +3.936148873675383e-01; -5.104619734405338e-01   -3.069325954493445e-01   -1.176629295669755e-01   +1.168015429783509e-01   +4.007025734423411e-01   -4.016796551372126e-01   -4.163269893010652e-01   +2.881286401463061e-01   -6.559865243525601e-02   -3.436580845790112e-04   -2.816272392392871e-01   +2.518543303643646e-01   +4.298545817511373e-02   +1.841823131274813e-01   +1.738689262882032e-01   -3.920711835568304e-01];
L2E_L1E_iAMPA_netcon = [-6.896777537980262e-01   -1.768632580727019e-01   +1.540249211782750e-01   +3.107637445074455e-01   -9.672843319317545e-02   -4.932413600861382e-01   +2.769035428951970e-02   +5.733154359806572e-01; +9.931097987724781e-02   +8.513723580750087e-01   -2.395505056514842e-01   -4.943690050214018e-01   -1.646482827076672e-01   -3.320123994964487e-01   -6.903878891594439e-01   +5.447380007937505e-01; -5.738809087475859e-01   +7.732242973997070e-01   +3.703444036843722e-01   -3.724509083898012e-02   +1.434737206912508e-01   +1.002060161392240e-01   +6.800497120320051e-01   +5.617489687476385e-01; +3.133721278599935e-01   +3.120103047720496e-01   +1.018624566144458e-01   +3.363673694819369e-01   +4.563671789104702e-01   +2.057787995845033e-02   -7.179257547657525e-02   -1.409544297894307e-01; +3.984071182567135e-02   +5.069639863603024e-01   +4.961670084807080e-01   +2.690413884458903e-01   +2.338320060062900e-01   -3.948534889645022e-01   +8.628877486642021e-02   -3.890387701542586e-01; +4.330575180023427e-01   -8.536641978101208e-01   +2.551849291416691e-01   +5.152574485422989e-01   -6.932189008339930e-03   -7.187754554655033e-02   +7.699163674094680e-01   -3.829440759338137e-02; -1.481962615692083e-01   +3.676401339636252e-01   -3.359662331887233e-01   -4.713493096593623e-01   -3.792908137164411e-01   +3.668589342125720e-01   -6.731958211287769e-01   +3.411326857901354e-01; -2.619032837040622e-01   -1.875137043709917e-01   +5.321031518127149e-02   +5.987460837918827e-01   +9.006326314964493e-02   -3.011688840510438e-01   +2.922898934361032e-01   +6.083385429311454e-02; -4.726608014627575e-01   +2.618539632441018e-01   +7.756996537042583e-01   -8.056904946255726e-01   -2.364965538105543e-01   +1.749902664073489e-01   +5.681774861059523e-01   +9.839841052554249e-02; -3.590523815207143e-01   +9.769435584329663e-03   -1.000000000000000e+00   +4.342391797787398e-01   +3.865210339894054e-01   -1.059581490499971e-01   +4.557729196641633e-01   +1.070019813173474e-01; +4.278191330053155e-01   +3.694240743221764e-01   -5.841129387764889e-02   -5.250016099443408e-03   +1.899398441138549e-01   +3.984611709560228e-01   -3.258754484024756e-02   -1.718153319792346e-01; +7.373670539461066e-01   +4.283409718867160e-01   -1.509737339099130e-01   +4.366927304603842e-01   -8.695390499470924e-02   -2.510412358627296e-01   -1.476955313368896e-01   -1.135740372161928e-01; -7.712448866291384e-01   +1.159278163335172e-01   +4.278485027724563e-01   -2.830581947270249e-01   -4.551115807954680e-01   +7.226408697863309e-01   +1.543509800642615e-01   +1.324112869497134e-01; +2.332130122635208e-01   +5.298308629906969e-04   +3.532002952034725e-01   -6.902276982342669e-01   -3.640438257950508e-01   -1.480244327672900e-01   -5.752085583959674e-01   +6.575655344755398e-01; +1.996486948083315e-01   -1.428665166747041e-01   -5.017803888116626e-01   +2.307430743224089e-01   +7.335757311830348e-01   +5.873959851691197e-01   +4.310180401262635e-01   -3.618160371727832e-01; +3.528855903508341e-01   -1.007974936489458e-01   +9.824133797805872e-01   -5.005827434770900e-01   -1.901770267596709e-03   -2.625649876674064e-02   -2.150704977195517e-01   -3.256852919241760e-01];
L1E_L2E_iAMPA_netcon = [+3.350289630144455e-02   +5.947166958976254e-01   -1.867918383151383e-01   +5.204962828490341e-02   -6.457303251536257e-01   -5.256424191589913e-01   -5.716594940174944e-01   +2.782832131202781e-01   -4.899849873109612e-01   -3.166568077349412e-01   -3.636788856261632e-01   -7.425167448206856e-02   +3.867603434157968e-03   -3.734652469909162e-01   +7.784211775750444e-01   +2.704245735215483e-01; +7.688837097680513e-02   +5.276344292533821e-01   +4.868015366852485e-01   -1.726250005106097e-01   +1.537962102071600e-02   +2.991576692117582e-01   -7.658508291640996e-01   -1.562771921235108e-01   -6.462920252167107e-01   -1.834555899607615e-01   +2.170909183246615e-01   +1.611937293099523e-01   -4.223276384623085e-01   -6.182003139471379e-01   -2.662028397893528e-01   +2.127883283184101e-02; +3.299039569459828e-01   +1.000000000000000e+00   -5.716819959908197e-01   -4.860145696767919e-01   -3.599123126772421e-01   -2.951109083245447e-01   -3.448967322020744e-01   -2.951538767715329e-01   -3.290692589508485e-01   -3.628894651109945e-01   +3.503161554218399e-01   +5.016279644758476e-02   +1.125191902311756e-01   +5.700477481653540e-02   +3.200480757504690e-01   -3.179913433458517e-01; -5.236184596314460e-01   +4.579166194282210e-01   +2.173849923274297e-01   +4.745065804182670e-01   +4.587160949511441e-01   -5.122114366665816e-02   -1.105673951133728e-01   -3.699330655713655e-01   +4.287000856361825e-02   -1.996433505485241e-02   +4.428362206031993e-01   +6.253395500679606e-01   +6.016643148810107e-01   +9.694696325676933e-02   +2.932303895707347e-01   -4.916372131568234e-01; +5.670451636428726e-01   -3.893984756274253e-01   -4.875847970478591e-02   -5.853055304536553e-01   -1.404415427381467e-01   -4.377738259311746e-01   -2.291878470354701e-01   +5.239088880889057e-01   +4.742849223163632e-01   +2.892310706659764e-01   +3.190133393840319e-01   -9.034126940598604e-02   -6.837230494614995e-01   -1.170479486326957e-01   -5.080036282729908e-02   -1.779709486379616e-01; +5.939553366025803e-02   +5.231411066181035e-02   +3.283936127600870e-02   +6.037820027593626e-01   -1.383994712309671e-01   +4.014208838094842e-01   +3.136562800266843e-01   -3.016086079076026e-01   -2.510840954949635e-01   +2.568581035077804e-01   +5.516609857356253e-01   -1.254661941555279e-01   +3.771107687514484e-01   +4.407215625214604e-01   +2.897519069715926e-01   +5.112318594451808e-01; +3.651883426597093e-01   +2.442683187591889e-01   -2.200350226086691e-01   -9.147931953549088e-02   -2.832127631480365e-01   +9.172330924649454e-02   -3.141388337537198e-01   -7.061662585396675e-01   -5.792415457405125e-01   -3.917782385624251e-01   -2.011814451659913e-02   +1.445659001653407e-02   -3.367279581342728e-01   -2.493900295207609e-01   +7.913736120042060e-02   +1.205353993446870e-01; -2.551404473526575e-01   +5.257897322183736e-01   +4.081429193884126e-01   -7.394302723955344e-02   -5.564322343891994e-01   +7.577075883688308e-01   +6.254448312672999e-01   -1.076748498396986e-01   -5.169591531447467e-01   +4.952536716006603e-01   +1.999150629284921e-01   -9.592777325946354e-02   +4.435932687168200e-01   -8.466468598576030e-02   +3.463440422500708e-01   -2.092671192836258e-01];
L2I_L2E_iAMPA_netcon = [+2.500290679039631e-01   -4.674749115709900e-01   -4.127325332463851e-01   +5.301826673878957e-01   -5.202175927584169e-01   -3.725644115359160e-01   -3.961352825200229e-01   -2.951211274978143e-01; +4.270834110185884e-01   +9.616360646075792e-02   -5.065306562044509e-01   +5.364184352504370e-01   -3.326443241842094e-01   +1.793248433303627e-01   -7.323661538578162e-02   +2.992539362362175e-01; +6.194616681205083e-01   -3.329954854463663e-03   -2.186311131440672e-01   -6.183613616809750e-01   +3.093167111837643e-01   +6.253715138064608e-02   +2.259037399335913e-01   -6.246145749988041e-02; +1.967480611028610e-02   +7.018628660615760e-01   -5.825027001769389e-01   -3.873244426781821e-01   -3.787965776574997e-01   -5.947678448500673e-01   +2.220985618587852e-01   +5.084926990869589e-01; +6.671312167271217e-01   -1.302826965638581e-01   -6.313980897142104e-01   +8.507895057572802e-01   +4.594937939305638e-01   +1.057204019822630e-02   +4.821694463639287e-02   -2.049938968397827e-01; -3.697754012560586e-01   +1.712271610941054e-01   +9.032147637819288e-02   -1.048545074654665e-01   -3.829590684289854e-01   +6.922913158430561e-01   -1.087206199984117e-01   -7.265320298821158e-01; +2.315943342483919e-01   -1.133040609759398e-01   +2.694704440784346e-01   +6.346283872086369e-01   -6.635577610573012e-01   +1.786228903128979e-01   +1.755525090741410e-01   +1.407898504722074e-01; +6.605819322933253e-01   -5.494461519885946e-01   +9.714278852884306e-02   +7.878711167119531e-02   +1.690332467798453e-01   +3.677113709827001e-02   -7.521345956746296e-01   -4.267641641995766e-01];
L2E_L2I_iGABA_netcon = [-1.750439401881367e-01   -6.336312575899542e-01   +6.362749142281197e-01   +1.314320832616993e-02   +2.410260583603324e-01   +3.782768832796441e-01   +2.207257615571993e-01   -8.330831352781255e-02; -8.252017359746300e-02   +7.712948498495280e-01   -2.019689351499816e-02   -4.726585677434313e-01   -3.719229324546252e-01   +1.492968402121651e-01   +7.449768608798789e-02   +3.616282396235240e-02; +4.633083359765912e-01   -1.603742117052251e-01   +8.607129426613421e-01   -4.027889703491529e-01   -3.409785195747992e-01   -3.808058405031499e-01   +9.707030254742145e-02   +1.614809146981104e-03; -1.525044427955378e-01   -2.199151530233319e-01   +1.714211635327376e-01   -4.455435669197330e-01   +3.507124411047193e-01   -8.733736714632960e-01   -2.973215131266502e-01   +2.600163638907704e-01; +3.264110090141564e-01   +3.792807795238716e-01   -8.478389522847132e-02   +3.262322715224588e-01   -7.201368739341387e-01   -5.120519480997255e-01   -2.746639235849085e-01   -1.323696679777850e-01; -9.929612026030096e-04   +1.044606387333433e-01   +4.744011216727464e-01   +1.000000000000000e+00   +9.149865696906868e-01   +1.063065075695155e-01   -2.207529658892533e-01   -6.359127056334113e-01; -3.167758121999887e-01   +5.597475814408607e-01   -3.611055118759318e-01   +2.217789828746475e-01   -2.615189935433647e-01   -7.185962745813206e-01   +5.136594890756639e-01   +2.059572656472171e-01; -2.808780808883983e-01   -1.216400459518677e-01   -1.277721544769412e-01   -1.509415912275875e-01   +4.403510627146640e-01   -8.436714802424383e-02   -2.022315652300176e-01   -1.800910201495782e-01];
L3E_L2E_iAMPA_netcon = [+6.904044297698324e-02   -3.641756839250596e-02   +1.637468773907296e-01   +5.268981303567007e-01   +6.530573563747340e-02   -6.555949775904885e-01   -5.572138749822751e-01   +2.440412301745122e-01   -7.061236126362266e-02   +4.474690530790206e-01   -7.168194453505212e-01   -6.511362064799787e-02; +4.384367091398756e-01   -2.973687741596748e-01   +3.322312572825381e-01   +1.112238050178845e-02   +2.571188261627384e-01   -2.354543553538118e-01   -3.071611916784232e-01   -2.222678553751031e-01   +3.638005250372897e-01   -5.540641103945074e-01   -2.753868439620243e-01   +1.978153083201979e-01; +1.781699958844416e-01   -2.612033302578583e-01   -9.446926484333285e-02   -2.462593322038706e-01   +6.832887595290682e-01   +6.726306759669588e-02   -7.123675315363250e-02   +6.654233602325477e-01   +2.102153096546830e-01   +3.836938490462635e-01   -1.424319001615170e-01   -7.067349724088656e-01; +5.117635637746720e-02   -6.708782551860473e-01   -3.038904499760242e-01   +4.874728484714365e-02   +8.117946477088869e-02   -5.241654008177989e-02   -2.623823505226930e-02   +5.027513154267654e-01   -1.271946505148157e-01   +1.409285389737915e-01   -2.863723931236696e-02   -3.821405678217556e-01; -9.733918033189293e-02   +3.946268083913660e-01   +5.218959635864912e-01   +1.599295523269035e-01   -2.398570485130860e-01   +3.057033801067966e-01   +4.380512113781574e-01   +3.347823044863430e-02   -5.057584911113494e-01   -2.755464660390384e-01   +2.731093807986214e-02   -1.150538462759855e-01; +1.899805544633031e-01   +3.482184714660164e-01   +3.482246897730662e-02   +8.708943174390169e-02   +2.200081259519636e-01   +5.275685085293732e-01   -3.433540281110188e-01   -1.451674387474037e-02   -4.530678596420614e-02   -4.608608714477644e-01   +5.058847818344847e-01   -4.399301651340464e-01; -1.260838741949067e-01   +3.347119476756676e-02   -8.581348640651032e-04   -6.625722067223241e-01   -1.583676717252456e-01   -4.321205392141912e-01   -9.190276190872697e-02   -4.380166216687794e-01   +1.670237413459310e-01   -4.648056143177985e-02   -2.078445920611590e-02   +1.000000000000000e+00; +3.760732172463058e-01   +3.196966335518661e-01   +1.911676390107571e-01   -4.711559874629726e-01   +1.648906559626072e-01   +1.196950505306333e-01   +2.273956889383160e-01   +6.086084900936178e-02   -1.904983324995053e-01   -1.407262681096702e-01   -1.374132072350094e-01   +5.302659153967365e-01];
L3I_L2I_iGABA_netcon = [-6.636343686112101e-01   +9.219649480843849e-02   -1.671056032692738e-01   +3.652613552897213e-02   +2.822231872389533e-01   +9.623210775272585e-01   -4.621584171645298e-01   +1.398063482587111e-02   +3.149981795621826e-01   -1.006026987344067e-01   -1.022448692550132e-01   +3.304788155173952e-01; -1.572915240449872e-01   -6.356735426549556e-02   -2.987501962379728e-01   -2.739522720684909e-01   +2.119767114433906e-01   +4.326740363034939e-01   +2.018131834526757e-01   +5.500957596673250e-01   -3.350480388756986e-01   -6.726348500204342e-03   +7.204742767332482e-02   -1.716096344871894e-01; +3.857046511730496e-01   -2.158339937979935e-01   +1.038885977745651e-01   +2.926900779768695e-01   -3.788016406705618e-01   -1.596404475914263e-02   +4.094886778650908e-02   -1.891257520704208e-01   -1.395503142010076e-01   -9.647499365577230e-03   -8.401364647063030e-02   +4.299300082311789e-01; +5.615031568351567e-01   -5.760407200151649e-02   -1.298281522387322e-01   +3.870482387554375e-02   -4.858772267004609e-01   -8.176924536933863e-01   -1.911877640857048e-01   -1.374300840103446e-01   -2.563371443117626e-01   -3.980714358004127e-01   -3.911110481599610e-01   +7.895727921604874e-02; +3.770879992547105e-01   +5.335827354446417e-03   +3.034098307023669e-01   -2.838945770719243e-03   +8.467337830772598e-02   +4.624693248333204e-01   +2.042767359217741e-01   +2.777586836010759e-02   -5.180321570772053e-01   -4.058347510920959e-01   +6.075948805058994e-01   +1.000000000000000e+00; -9.051304454911052e-02   +8.994280406807095e-01   -2.468325204136596e-01   +4.219079351462600e-01   +8.300253023142742e-02   +4.649487196651307e-01   +4.684536020923855e-01   +2.872332219077690e-01   -3.040294758864562e-01   -3.749886542454028e-02   -7.729685011405639e-03   +6.228398788725412e-01; -5.987441469965979e-02   +5.596645499114269e-02   -4.028392367251993e-01   +2.439612835944442e-01   +2.935154642047280e-01   -4.396238345418211e-01   +1.059434309189973e-01   +4.469275700470109e-01   -6.102466083550482e-04   +4.191560633791321e-01   +4.015095848535227e-03   -1.140425420848175e-01; -4.212054782873670e-01   +2.244018731918923e-01   +1.013828045635426e-01   +1.555166903760181e-01   -4.530876434478732e-01   -4.288104528725924e-01   -4.968793947264340e-02   +1.411346377478123e-01   -3.147332720722998e-01   +8.507563746743768e-01   +4.511689658170091e-01   -5.611286730186228e-03];
L2E_L3E_iAMPA_netcon = [+4.333093284245663e-01   -8.822852781631157e-02   -6.627190122122902e-01   +3.185388878784133e-01   +2.030398930149005e-01   +2.355272937675791e-01   +1.626851141929848e-01   +3.107825727476234e-01; +3.741755926518905e-01   +3.462195123702699e-02   +4.705152346589857e-01   -3.360604844625403e-01   -8.386539908313685e-01   +2.181587285995948e-01   +1.451271836467139e-01   -2.305009946871950e-01; -5.589500488455208e-02   +4.264176372230649e-02   -7.154568400607557e-01   +3.988916341132824e-01   +1.324155044284108e-01   -3.249118344460175e-01   +3.334064492590522e-01   -3.696470065499065e-01; +3.969166560515166e-01   +8.280175486809223e-01   +3.405354085710067e-01   +1.162093796528025e-01   -3.906989972357118e-01   +5.467865746258818e-01   +2.054182243954885e-01   +3.373190450490556e-01; +6.398835630062201e-01   +7.209828570663692e-01   -3.559196254577107e-01   -2.147334544162750e-01   +2.792807393223191e-01   -1.002372147132247e-01   -3.874007652408839e-02   -4.735673180480789e-01; -1.942581100429353e-01   +2.548422863771097e-01   +1.976168313902552e-01   +6.176638734631602e-01   +3.026789649200697e-01   +3.470820147513689e-01   +1.965965312563304e-01   +3.222503208758919e-01; +5.751670598516411e-01   +5.410252078333673e-01   +6.089519255579827e-01   -3.908095283344030e-01   +8.447634858664488e-01   +5.651347089162504e-01   +1.978737411955346e-01   -5.386425692756460e-01; +9.888331286216190e-03   +5.342736264182586e-01   -1.241725228176471e-01   -9.081615408665211e-02   +1.323355392328917e-01   +1.100549116499883e-01   +2.706781418711400e-01   +2.320071339955166e-01; +4.928852934862096e-01   +2.423330971851673e-01   +5.495330209420365e-02   -7.968835477856677e-01   +1.997235139665731e-01   -4.319756135630339e-01   +8.267697644576341e-02   +2.572515202166814e-02; +4.869026953910834e-01   -4.382110540321327e-01   -4.042858098038836e-01   -2.586923126893360e-01   -1.699377041778049e-01   +3.607446830372793e-02   +2.063886846920787e-02   +5.629871156417119e-01; +3.142084107096538e-01   -1.156372885016882e-02   +5.396686089920916e-03   +1.582558526372164e-01   +2.286939700517813e-01   -4.993445473603610e-01   -2.551448981914107e-01   -5.986352765080352e-01; +2.422284996775354e-01   +6.453067158992373e-01   +1.669121328739155e-01   -4.462002443351806e-02   -1.704707478636205e-01   +4.407249490025149e-01   -1.847903678569291e-01   -5.638007261468284e-01];
L2I_L3I_iGABA_netcon = [-3.832575933048604e-02   +9.019383916546966e-01   -5.458557089501592e-01   -2.348576443071872e-01   +6.174937523886512e-01   +1.496290111466358e-02   +4.834324384372488e-01   +6.032204594037016e-02; -2.240667764868972e-01   +4.316764155695015e-01   +1.577046039448458e-01   +9.644214075181168e-02   +8.410296112015943e-01   +2.141742297388914e-01   +3.871461685040986e-01   -1.472923200227526e-01; -1.385971400875425e-01   -3.218679442259615e-01   -3.039566354938554e-01   -2.501375165477637e-01   +2.914916816821931e-01   +1.695459246993929e-01   -7.813220358394760e-01   +2.525797602044277e-01; +1.003133256245322e-01   +7.023933997910508e-01   -1.720721009016014e-01   +3.119157426316789e-01   +3.022886601904320e-03   +6.103344982315830e-01   -6.571329677749782e-01   -1.686969627142147e-01; +3.578271238355521e-02   -2.503493557998014e-01   -1.608722670042538e-01   -5.628820563467640e-02   -6.330650077710694e-01   +3.543324326479217e-01   +9.826002691996422e-02   +3.101851086951017e-01; -8.417170052518993e-01   +4.836231501033153e-02   +4.656981196576365e-01   +4.696054889147171e-01   -4.688807616299294e-01   -3.299505129338431e-01   +1.513193183749506e-01   +4.391752370908490e-01; +1.050802243796261e-01   -1.422848114213107e-01   -6.449710112540130e-01   +2.114298981120764e-01   +5.427276559929510e-01   -3.516053751820393e-01   +6.817545523080049e-02   +2.137186802516590e-01; -9.077343969669274e-02   -5.270913853640877e-01   -6.379627488364649e-01   +4.497799332025386e-01   +1.720105515085083e-01   +7.408276630278079e-01   +5.581371478009793e-01   -1.953228686244345e-01; -5.705500867055741e-02   +5.918633919445582e-03   +2.831587057046700e-01   -3.799043415162923e-01   -6.405543415517914e-01   +2.609334152859678e-01   +5.120691671912403e-01   +6.932537801707450e-02; -3.977795060943775e-01   +1.919368644968860e-01   +3.118129202165505e-01   +1.856147730396940e-03   -6.089269044142347e-01   +3.292008044336164e-01   -3.822469598160472e-01   +3.414047920765240e-01; -4.872370577392094e-01   -5.955916308416682e-01   +3.059219281007231e-01   -5.549796211822421e-01   +1.911925649369021e-01   +6.247775436000712e-01   +6.576144025868735e-02   -1.507578710841746e-01; -4.943063867517877e-01   +1.920493880787961e-01   -1.150041875054197e-01   -6.593065465511356e-01   +1.145168259720469e-01   -5.794544669200955e-01   +1.618096601028107e-01   -4.828081709853259e-01];
L3I_L3E_iAMPA_netcon = [+5.040687537271382e-02   +1.677907900521325e-01   +2.349231070902273e-01   -3.767890804540425e-01   +1.595184465404967e-01   +2.787313797555468e-01   -3.356263249173839e-01   +1.171606560713272e-01   -5.202006912323223e-01   +1.077788607041689e-01   -4.814466947563335e-01   -2.688377177063946e-02; -6.646276712142672e-01   +6.422927173507514e-02   -3.258532188081928e-01   +5.704758250922509e-02   -2.037420157985088e-01   -4.824719295831919e-01   +5.251579933973882e-01   +8.580492486633029e-01   -6.586016893486263e-02   -2.983800159843811e-01   -7.388805325773686e-01   +5.994641740259947e-01; +8.739699192360240e-02   +6.541168202721988e-02   +5.794800931642331e-01   +4.981451638033744e-01   -1.842026460944916e-01   -5.713126771649566e-01   -4.196782683825658e-01   +7.817632559874892e-01   +4.185783217753080e-01   -7.714867308661930e-02   -3.853886153742452e-01   -1.379457117637318e-01; +6.585865005667049e-01   -3.373374624170282e-01   +5.743436156972885e-01   -4.576848420413528e-01   +1.515451782376905e-02   +3.627547947183399e-01   -2.025590540851941e-01   +4.397967425541948e-01   -2.459260980697682e-01   -3.729057994291204e-01   -5.063661032003855e-02   +4.434887120706626e-02; +8.329439355570527e-02   -2.709363928453185e-01   -1.010175215103247e-01   +3.143084060507259e-01   -1.085519962146017e-01   -2.724414657319972e-01   -6.584738450389556e-01   -4.457188646572529e-01   +3.736526404235878e-01   +4.045844999651689e-01   +1.041861128060182e-01   -6.095081022317497e-02; +2.375306845345730e-01   -7.758342170347264e-01   -3.500462120388259e-01   -2.429367247828672e-01   -3.181020955731447e-01   -1.945757592667169e-01   +6.841067930274831e-01   -4.915391315618703e-02   -1.369390615986243e-02   +4.738265468896996e-01   -2.160106498692311e-01   +1.907622062155327e-01; +7.988684506158009e-02   +7.459268868693462e-01   +7.212452104387259e-01   -3.383530195084278e-03   +5.009651258098797e-01   -7.204208155834777e-01   -4.352718652284417e-01   -7.629473838466620e-02   +3.040184409221065e-01   +1.820560823139388e-01   +8.413511792111485e-01   +1.153284785101860e-01; -2.791141639145666e-01   +7.174258237918050e-01   +5.381307997591875e-02   -3.684432119629559e-01   -1.363940309313373e-02   -4.995457408770795e-01   -8.390827173317519e-02   +2.925328556661444e-03   +2.448038451915514e-01   +2.343250255357680e-01   -5.649686330430133e-01   +2.956303855989865e-01; +3.691608049921090e-01   -3.094075032590674e-01   -2.812997585465484e-01   -1.271011831557805e-01   +9.949100457268351e-02   -3.636539653385018e-01   +8.037015722363767e-01   +9.919067239900803e-01   +8.436448449802977e-02   -7.783261189415553e-01   -2.210641438206364e-01   +1.394821307106758e-01; -3.821953290808502e-01   +2.589935224901707e-01   +1.431878677796264e-01   +6.609147132900713e-01   -2.085894039476627e-01   -2.502070120171029e-01   -1.126395910769984e-01   -7.295547141411310e-02   +6.343745954894561e-01   +6.106429787506636e-02   +6.090681330142684e-01   -7.503402157449255e-01; -3.493338329481825e-01   -1.798976175327631e-02   +3.048382448895910e-01   -3.182787038003047e-01   -2.320692764468136e-01   +3.250499985167660e-01   -9.342186501298833e-01   -9.649469899512411e-02   +4.800602887199460e-01   -2.110245123379345e-02   -1.454184794015940e-01   +6.330714716526484e-01; -2.004341306659373e-01   -4.086634234429652e-01   -3.292901874118933e-02   +2.868183463649938e-01   -1.327851066092467e-01   +1.341306970057147e-01   +3.795510975808623e-01   -1.802035182073687e-01   -7.632997216527055e-01   +7.172173273391022e-01   -1.927033834968696e-01   +2.320458324748926e-01];
L3E_L3I_iGABA_netcon = [-7.496006574033783e-01   -5.309736532824564e-01   +1.842359019254334e-01   +4.486607409677041e-01   +9.998873404260528e-01   -2.396154626241173e-01   -9.453965651769954e-02   -5.873092398952634e-01   +9.518021827700605e-01   -1.428305899622239e-02   -4.289132563940111e-01   -4.038659173020399e-01; -2.634908347939366e-03   -5.713016464914311e-01   +1.597151774426237e-01   +1.864217065827480e-01   -1.015215045505738e-01   -5.396793184507451e-02   -1.094920189149318e-01   +3.607178392014727e-01   -4.202312876025111e-01   -6.017194756826486e-01   -1.241926586554889e-01   +3.575264166998621e-01; -1.954799237668089e-02   +3.159944945435467e-02   +4.636206051000955e-01   -2.302744994511851e-01   -1.641791872144462e-01   +1.496555141427963e-01   -3.660678092078868e-01   +5.195514695576148e-03   -1.161243147730433e-01   -6.517609008952790e-01   -1.628173219616402e-01   -4.459016816902612e-01; -5.147204847047883e-01   +3.660378420500507e-01   +3.393312817794080e-01   -5.288204725219233e-01   -2.263565820984106e-01   -5.461073486350706e-01   -2.788027365218574e-01   +5.925753813419119e-01   +1.285215421540078e-01   -6.307973916608406e-01   -1.570027903814229e-02   -3.549101036636997e-01; -1.446022757616610e-01   -3.071045995066948e-01   +2.025425291967103e-01   +5.350289582813992e-01   +2.389004403412752e-01   +2.578651660905057e-01   -4.614732580988444e-01   -7.656851930234844e-01   +4.810090769191826e-02   +2.534427616338373e-01   -2.429626096221327e-01   -1.695922858543643e-01; -1.574576381904954e-01   -5.946859915075253e-02   +4.469231667816929e-01   +1.343739433736999e-01   -4.621349681894121e-01   -4.762874175573752e-01   -2.303256223603838e-01   -4.433160194707729e-01   -2.489029120832082e-01   +4.732428659237067e-01   +5.599921651926929e-01   +3.253492655308203e-01; +3.158436294590215e-02   +1.501452910754754e-01   -3.879358717615620e-01   -5.060222616332708e-01   +2.458333129534475e-01   -4.370758408561419e-01   +3.028106446572949e-01   +8.153519073799049e-01   -4.084184308908783e-01   -5.176982879072431e-01   +2.700954136710184e-02   +2.885261552676128e-01; +9.929527657293769e-02   -3.832506323372405e-01   +3.056634606723397e-01   -5.565006317124676e-01   -1.714344619519900e-01   -7.499118820202251e-04   +4.386051812056616e-02   +1.251362631733854e-01   -4.367412481579467e-01   +2.239516300523349e-01   +3.245482596912917e-01   +9.573712373631645e-02; +4.772129632997661e-01   -1.620151505932549e-01   -1.781380313831491e-01   +5.655561604774850e-01   +2.983970492565938e-01   +3.605158375171374e-01   +2.555090648794522e-01   +6.032346490968924e-01   -9.045349150546030e-02   -2.299545079943019e-01   -1.318260039947815e-01   +1.717708149980499e-01; -4.597109711257697e-01   +3.806243718964029e-02   +3.380361168010940e-02   +4.205536928611612e-01   -2.463931641643422e-01   +3.137749099363420e-01   +4.672924720322644e-02   -1.613402225919948e-01   -4.179443288612624e-02   -1.827246744726542e-01   +5.463422620369421e-02   -1.000000000000000e+00; -2.268684492655461e-01   +1.103103847339955e-01   -1.379834858964482e-01   -1.683349497060062e-01   -3.029735512362212e-01   -4.173528039434846e-01   +2.499172084249550e-01   +8.779876576145159e-01   +4.256831763169867e-01   +3.451843135480749e-01   -2.068209343086474e-01   +5.523615131579163e-01; +2.305738432658673e-01   +2.723678425842587e-01   -1.269374763065011e-01   +2.922936475274030e-01   +1.477083294400852e-01   -9.343784987008705e-03   -6.218974549064212e-01   +2.158560593242733e-01   +5.779614160763604e-01   +8.562641414599292e-01   -2.923201989115733e-01   +2.676407487623176e-01];
L2E_Input1_iAMPA_netcon = [+4.583765752829924e-01   -7.551163345600680e-01   -7.433325356397884e-01   +9.429565263352624e-01   -8.196042822993302e-01   +6.220741874700398e-01   +7.998071645098346e-01   -6.514778711323782e-01];
L2I_Input2_iAMPA_netcon = [-6.121442535586177e-01   +3.207294748513021e-01   +3.382455663239013e-01   -3.634752397013724e-01   +8.186290565018711e-02   +1.000000000000000e+00   +2.685440191621213e-01   +2.874714473747361e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
