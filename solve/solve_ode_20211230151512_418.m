function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.552708295695817e-01   +1.667391950638153e-01   +2.019369016669303e-01   +5.904140004409963e-01   +6.459112130960826e-02   +1.918730798124509e-01   +4.117919655182422e-01   +6.055003544215374e-01   +2.563845740308699e-01   +3.197580361301883e-01   +2.639047121303867e-01   +9.068539185687416e-02   +5.422669832998923e-01   +1.173698247836987e-01   +3.040313860038560e-01   +2.949538385987254e-01; +2.183134537712744e-01   +3.911387027732398e-01   +4.469501303647506e-01   +6.231530837409237e-01   +3.498070735662308e-01   +5.681085093026188e-02   +3.355695621016515e-01   +2.834838965211654e-01   +1.745071635711976e-01   +3.780487063590184e-02   +5.526016974053809e-01   +5.024003094304810e-01   +1.671684233025645e-02   +1.766750958017099e-01   +4.294776764181020e-01   +2.378846119747468e-01; +3.898467683332622e-01   +9.371288188784581e-02   +1.466593498038583e-01   +3.164942930367579e-01   +3.417302121413175e-01   +1.253619798357676e-01   +4.348920984360651e-01   +6.272497673305226e-01   +1.842589138824192e-01   +5.956264147773054e-01   +1.664028977165224e-01   -6.336138797303839e-02   +2.904677231679208e-01   +5.848379856499337e-01   +5.551851059087925e-02   -1.485422870027231e-03; +1.977449206805232e-01   +6.134433198424781e-01   +1.531134975733390e-01   -6.463775272007613e-02   +1.031684501653479e-01   +5.333438804086533e-01   +3.945154137689880e-01   +3.664113152833781e-01   +4.264019808669405e-01   +5.502211048628347e-01   +1.156029821586169e-01   +1.204027102183962e-01   +9.608808553007252e-02   +5.375835643230188e-02   +4.702684976273714e-01   +1.507692181225748e-03; -1.896386073047263e-04   +1.407724016915570e-02   +3.779470853527315e-01   +4.635107162496417e-01   +3.089900598305713e-01   +1.569485355448796e-01   +3.287978260219440e-01   +1.810328896721363e-01   +3.613969211265268e-01   +4.298157980144188e-01   +3.326025015639966e-01   +1.174968373124158e-01   +2.588587494593572e-01   +3.598773384908947e-01   +3.043375088281290e-01   +8.019787046235938e-02; +1.560060924996749e-01   +5.352238099862527e-01   +5.152029501689508e-01   +9.311436009228428e-02   +6.118698138117464e-01   +2.297537749393896e-01   +2.389921140556028e-01   +3.553693180708657e-01   +5.591890739340490e-01   +5.021337529193476e-01   +4.163401403940842e-01   +3.440526631449380e-01   +6.136575717323672e-01   +2.886414929812313e-01   +6.011276181645858e-01   +6.134940369604733e-01; +5.450579049410053e-01   +2.968766554449760e-01   +9.375365279310677e-02   +1.227311531701360e-01   +5.878569256808598e-01   +4.912942950470714e-02   +2.659690526781542e-01   +3.721986062052300e-01   +1.060674224260561e-01   +2.327851738003420e-01   +2.393413081066445e-01   +3.928239742183989e-01   +1.036240620622093e-01   +5.825306587281387e-01   +3.480779941567339e-01   +5.688811336473785e-01; +4.055584433096246e-01   +2.288179208340608e-01   +4.250309875599187e-01   +3.709450788158484e-01   +4.982503137791706e-01   +3.151205668264363e-01   +5.747892735590718e-01   +1.744160846808828e-01   +2.120146712120965e-01   +2.958055797635474e-01   -2.045119896198658e-02   +1.580602809764293e-01   +3.132428082791607e-01   +3.002985008555970e-01   +1.042822819456841e-01   +2.978988991244274e-01; +4.490949175272740e-01   +4.498880617028200e-01   +1.689571429565432e-01   +4.900146482815153e-01   +1.602473888854545e-01   +1.854420250034755e-01   +6.477839087256866e-01   +4.038957263883654e-01   +5.911149558403676e-01   +4.566998779087668e-01   +4.496362202187331e-01   +3.489876854656890e-01   +6.422799885788556e-01   +4.744368024029467e-01   +5.330940945526520e-01   +6.203825480548775e-01; +4.157993186719069e-01   +1.208014682195868e-02   -1.375551324251697e-02   +3.591135633398409e-01   +2.617299586333870e-01   +2.507812148991078e-01   +5.780500842316391e-03   +2.567757574390362e-01   +4.159135193604550e-01   +5.742666132018235e-01   +9.914549786752866e-02   +3.269574288853278e-01   +5.235711867309654e-01   +1.313508139417706e-01   +5.821571282623800e-02   +4.410909164118420e-01; +1.989305195988495e-01   +1.261186808417351e-01   +1.398100012972432e-01   +2.502931591595624e-01   +4.457541302764395e-01   +3.494943348965442e-01   -3.393674755875048e-02   +2.717449661138976e-01   +1.584540699759132e-01   +6.247187787306616e-01   +4.936589684079501e-01   +1.649151118189320e-01   +3.504126143831361e-01   +3.974680034787768e-01   +5.107756959181231e-01   +1.335913966541883e-01; +3.514550434256291e-01   +3.174870395910601e-01   +1.405704941806000e-01   +6.000418500522293e-01   +2.681760846482044e-01   +5.411897290023922e-01   +4.611800618024516e-01   +6.599521044911185e-01   +7.092117501415271e-02   +9.251899693730779e-02   -2.057528608297517e-02   +3.233503852348579e-01   +5.794638939417579e-01   +4.883962388003098e-01   +5.432232700901383e-02   +1.817230264813555e-01; +3.129695466729135e-02   +3.911318459513102e-01   +3.456363487307662e-01   +1.840238001998936e-01   +3.869330664350605e-01   +4.231786289481390e-01   +5.083888694969269e-01   +2.205189351729598e-01   +3.150993225514683e-01   +3.959175614562015e-01   +5.702432243813462e-01   +3.157144925631469e-01   +2.152604681960338e-01   +5.842734559219585e-01   +4.310496335725458e-01   +2.317735898404130e-01; +2.408397600226105e-01   +4.232672448136306e-02   +2.250705647862463e-01   +2.532775402063880e-01   +3.660015107782698e-01   +5.459259394719007e-01   +6.478231136023389e-01   +3.216531447354632e-01   +1.476917643270995e-01   +4.380097515801832e-01   +6.130668382942333e-02   +6.244364198861487e-01   +2.989497259431784e-01   +5.827498801231849e-02   +2.967818930143469e-01   +7.305697329398392e-02; +6.427749753484155e-01   +3.106466928535250e-01   +4.952384302725791e-01   +3.342597576055674e-01   +6.083448151341957e-01   +2.857286881105803e-01   +2.301761247035523e-01   +2.736385497867911e-01   +6.582327866885201e-01   +4.718170186709807e-01   +4.083783686755439e-01   +4.207150309411494e-01   +1.243999390885852e-01   +4.668065935468982e-01   +6.668439436394960e-01   +2.981923879676766e-01; +4.764911365876560e-01   +1.341698971209929e-01   +5.182530868973444e-01   +2.510130223440423e-01   +3.953893344131946e-01   +1.257731770293331e-01   +5.079181226310340e-01   +2.570239301680284e-01   +8.274589071551527e-02   -3.338064314898490e-02   -1.241374631379176e-02   +4.738656134160814e-02   +6.623939061344022e-01   +1.544122452153401e-01   +3.992313213748320e-01   +4.431736276344109e-01];
L1E_L1I_iGABA_netcon = [+2.699352475764668e-01   +3.792437621071417e-01   +5.943874704095076e-01   +2.004537512991307e-01   +8.195857990147448e-03   +2.099602202588106e-01   +4.579907414679845e-01   +6.958259118363358e-01   +3.648136881604777e-01   +2.673511804922026e-01   +5.491709315563100e-01   +2.976457739981874e-01   +2.632441801940615e-01   +2.438851572922961e-01   +3.519790787809893e-02   +3.005129095342987e-01; +2.769638433978660e-01   +6.626829776868717e-01   +3.051834333381004e-01   +1.737119428929746e-01   +5.143646799737672e-01   +3.225966826861624e-01   +6.115668637062025e-01   +5.388939271431230e-01   +5.292799640085561e-01   -3.148831321108726e-02   +7.427000134912930e-02   +2.181106039936097e-01   +4.284584902487660e-01   +4.054818976404286e-01   +1.771558375588103e-01   +1.136965709140169e-01; +3.706284235046775e-01   +1.027654426401248e-02   +2.748951615597984e-01   +6.260292807224428e-01   +8.685307441011358e-02   +1.086601631340430e-01   +2.189315010023276e-01   +1.582677607257399e-01   +2.627241375472188e-01   +3.460532494000120e-01   +3.090315165642029e-01   +2.400519878226544e-01   +1.099349288832337e-01   +3.694391190168603e-01   +8.964962441462840e-02   +2.208478764077051e-01; +1.699723095161219e-01   +2.017744163024044e-01   +5.613085312358560e-01   +4.061135182311769e-01   +1.288077035761842e-01   +4.811376936353585e-01   +6.291904076113378e-01   +7.082918884897657e-01   +1.419636484056248e-01   +2.846194781799640e-01   +4.592677653650652e-01   +6.319792696626717e-01   +2.300988143460402e-02   +4.176288968387021e-01   +5.484746113583427e-01   +4.727082838684429e-01; +2.300376046125497e-01   +1.001048205475084e-01   +5.626436292250305e-01   +3.778276969521489e-01   +4.304388871275466e-02   +3.687858971792920e-01   +6.539181525023036e-01   +5.584661597014079e-02   +3.042535251276215e-01   +3.475947024913026e-01   +1.174079029812442e-01   +2.056301455660072e-01   +3.673304754656693e-01   +2.001227682950952e-01   +2.668006913657610e-01   +6.143875830277873e-01; +5.219225822921096e-01   +4.251373550741514e-01   +4.718455544263829e-01   +4.604616630154307e-01   +1.531558153029038e-01   +6.532049293994053e-01   +4.744205800031757e-01   -9.226514476436430e-03   +3.670036371423503e-01   +3.981593442841276e-01   +8.717692853370881e-02   +4.560357439828997e-02   +4.946176416807562e-01   +3.551025447628466e-01   +4.433051680210245e-01   +4.565021994795034e-02; +1.469337706210491e-01   +1.866061839084257e-01   +7.985355538117067e-02   +3.162932925637886e-01   +2.617101693254566e-01   +3.874309917240986e-01   +4.135008794462895e-01   +4.335507196490399e-01   +2.413355656245678e-01   +3.793792021896305e-01   +3.724180569661473e-01   +5.103817606176954e-01   +3.573282657475350e-01   +4.693921033425962e-01   +2.349977627328722e-01   +2.640976497361034e-01; +5.040527793139077e-01   +1.628590156009564e-01   +6.047400073300212e-02   +2.964537241349621e-01   +5.763931568270209e-02   +1.288086752736060e-01   +3.682005544774236e-01   +1.741659868969791e-01   +4.475784691513610e-01   +5.879611012561478e-01   +3.129346015227732e-01   +1.968322562579304e-01   +2.258009092231733e-01   +4.624740348192815e-01   +3.021912701430969e-01   +1.811891338125925e-01; +1.644881662682565e-01   +4.542900805742769e-02   +5.124788349101517e-01   +4.079000993368169e-01   +2.538948429730401e-01   +1.521396703134296e-01   +3.972472253300988e-01   +5.316303153901368e-01   +5.221216776278026e-01   +1.819209293495948e-01   +3.504884843617641e-01   +2.914900362402525e-01   +1.380506531660583e-01   +6.892792053867390e-02   +3.029206870431539e-01   +2.673823927862172e-01; +5.712164452461648e-01   +4.905694896006275e-01   +4.398197332500685e-01   +6.405023184699435e-01   +1.793617106805750e-01   +5.024690047166862e-01   +1.941444758163074e-01   +4.323811527689784e-01   +6.445927310611450e-01   +2.268076954245584e-01   +2.963658238437845e-01   +1.907091244283854e-01   +2.515209877737070e-01   +6.295440379705752e-01   +5.981272946849698e-01   +1.752955527157005e-01; +5.983658668370730e-01   +5.333470422998527e-01   +5.789696462582542e-01   +2.334844270389250e-01   +6.067510343221802e-01   +1.790476778774796e-01   +1.497355869978430e-01   +5.310505966538668e-01   +5.449430376795007e-02   +1.893899951203513e-01   +2.147585993773032e-01   -4.818901175855166e-03   +2.255549194691198e-01   +4.098296186861066e-01   +2.688921601990986e-01   +7.015743960903745e-02; +4.796118441843971e-01   +1.203851010687539e-01   +4.432219045609106e-01   +5.607270694853911e-01   +1.822539108733883e-01   +1.254967706034724e-01   +1.038362024950598e-02   +6.072703936363906e-01   +3.391298880187096e-01   +5.428762853000421e-01   +5.266575435651364e-01   +4.870744685012879e-01   +1.328940222446296e-01   +6.416503877310451e-01   +5.504308599886811e-01   +1.375040560549259e-01; +4.296443472491898e-01   +2.224459132752075e-01   +2.860056418817193e-01   +6.037653109103124e-01   +4.273170564746704e-01   +3.480391913205172e-01   +4.414940933076926e-01   +1.507876134659431e-01   +6.772431822741254e-01   +3.265450958528010e-01   +4.729598037274310e-01   +4.990904595989482e-01   -2.074212298367604e-02   +1.021563162364748e-01   +1.264362999667172e-01   +5.801061335695364e-01; +2.974571654749802e-01   +4.933726889147519e-02   +1.192395552920872e-01   +9.809855194561215e-02   +2.183018043791261e-01   -2.602297644170627e-03   +3.337218264108361e-01   +6.089417860086584e-01   +5.667850266973944e-01   +6.165272404325309e-02   +3.419549341337219e-01   +1.610789648091274e-01   +5.632306279203710e-01   +5.526186793913737e-01   +4.070659598707071e-01   +3.823762450757542e-02; +6.429158452906983e-01   +4.570632981676942e-01   +6.939936414300878e-01   +1.955158505962671e-01   +4.006705403765891e-01   +3.269876912944548e-01   +6.510332471950061e-01   +3.024053076831407e-01   +3.793944973550262e-01   +3.885119156314900e-01   +8.956066035214358e-02   +6.084341939243607e-04   +2.453029887683214e-02   +9.490156774038677e-02   +5.125202335748741e-01   +3.329507333978004e-01; -7.515220835702385e-03   +2.761906783961917e-01   +4.083076943396471e-01   +3.775762677372176e-01   +4.145852226129287e-01   +5.682164432665713e-01   +5.112880260572911e-01   +1.161324621446494e-01   +6.617463885433323e-01   +2.345951173533526e-02   +6.051174758433573e-01   +5.584182089298353e-01   +2.989937669456574e-01   +6.444637215304789e-01   +1.089062797109608e-01   +2.744979675364301e-01];
L2I_L1I_iGABA_netcon = [+1.229716051326376e-01   +5.386589801389433e-01   +2.064692093259734e-01   +2.291243440581717e-02   +3.222016123573471e-01   +2.423046710197884e-01   -5.889048988375328e-03   +4.467783143682399e-01; +2.832049463132246e-01   +2.022178695926466e-01   +5.581637167524806e-01   +2.223687793151199e-01   +1.167618197737505e-01   +4.455451556297829e-01   +5.965988394548065e-01   +2.411192511471656e-01; +3.209297557829514e-02   +1.486343066881245e-01   +3.719478953693584e-01   +6.214165385260523e-01   +3.429811796907273e-02   +4.917921902931152e-02   +2.389088354204907e-01   -3.933653280241258e-02; +3.663876261772415e-01   +3.978103126246347e-02   +7.954965944372205e-02   +6.517124984571950e-01   +1.909939942081081e-01   +2.383743534144630e-01   +1.112281951664911e-01   +3.457007038176987e-01; +5.324488026286955e-01   +1.978615283983056e-01   +2.086349587526515e-01   +3.734087560268355e-01   +6.059109199604557e-01   +4.202223549790063e-01   +5.104287511712665e-01   +5.888127769184954e-01; +5.726547221529702e-01   +5.671797639974641e-02   +3.645485772323403e-02   +6.074732463972762e-02   +5.459896411620522e-01   +2.294345030182554e-01   +2.049737424906485e-01   +3.705232595182901e-01; +3.163892738390793e-01   -5.035646239756691e-03   +5.095037133241830e-01   +2.190536639668274e-01   +1.898339123503849e-01   +8.429463046636303e-02   +4.710098215760277e-01   +4.030076215595774e-01; +1.607488445135277e-01   +1.622430543925364e-01   +6.787835933684325e-01   +1.385619477662912e-01   +1.720219942313745e-01   +6.971958199859053e-02   +2.230687148417377e-01   +2.560381340157444e-01; +6.023388359246749e-01   +3.769130459586597e-01   +4.182707272065126e-01   +1.620483297674129e-02   +4.263467139381829e-01   +5.947164514357052e-01   +4.131786620882963e-01   +1.013045891941248e-01; +1.602959574862756e-01   +2.341726167005289e-01   +4.838478760611967e-01   +1.914070916620248e-01   +3.895952834518232e-01   +3.572179561492977e-01   +2.421334838890214e-01   -3.568441144749453e-02; +4.235662325867822e-01   +5.984441476017365e-01   +1.632008231585411e-01   +5.422647257080452e-01   +1.438266760124403e-01   +3.713959155278283e-01   +5.548878090695241e-01   +6.300095710933312e-01; +5.459968292971783e-01   +6.444659099723928e-01   +1.110942050221028e-01   +4.673202565936638e-01   +5.487691593679593e-01   +3.007333100999979e-01   +1.458370147923549e-01   +5.106689387350820e-01; +4.009315258578985e-01   +6.398889070100683e-01   +5.818453979162433e-01   +5.522108583747314e-01   +4.463169284707182e-01   +1.883526849431257e-01   -5.408344956647684e-02   +3.604888882071712e-01; +5.760173371158440e-01   +5.235532419643840e-01   +5.902615131181590e-01   +4.935884737691097e-01   +5.187916806462798e-01   +5.522732194675576e-01   +1.264475437280198e-01   +2.576794715887232e-01; +3.037235240453045e-01   +2.788878652616392e-01   +3.994430804490045e-01   +2.925672429954818e-01   +3.378555855904351e-02   +1.739449131063089e-01   +3.384074587909034e-01   +3.844412475365225e-01; +4.240789804252231e-02   +5.221593722711491e-01   +2.459454046959765e-01   +5.840639216228538e-01   +5.118890347813879e-01   +4.713142099287104e-02   +5.193710814954533e-01   +1.111483349497604e-01];
L1I_L2I_iGABA_netcon = [+1.173950392263107e-01   +5.780980756835906e-01   +1.644751315067361e-01   +4.048101626034595e-01   +5.392608587302448e-01   +4.610004984810408e-02   +3.030479992470137e-01   +1.921630578428641e-01   +2.085362646203231e-01   +7.421819597622104e-02   +2.799006724301101e-01   +3.364102863299696e-01   +3.296450059150833e-01   +2.938460860478257e-01   +5.157290041155668e-01   +3.243278117663991e-01; +2.456068159654639e-01   +5.407858414488729e-01   +2.147391213725527e-01   +1.183507583760061e-01   +6.210638553933636e-01   +4.478941646960347e-01   +4.800264279086265e-01   +6.212735943578225e-01   +2.492766074758868e-01   +1.521179390814797e-01   +5.475309345757613e-01   +3.586082661883560e-01   +2.510992380760238e-01   +2.315096740826655e-01   +3.921658077220430e-01   +5.214476862711829e-01; +2.106741741087625e-01   +1.679288811949851e-01   +4.511782822711514e-01   +5.131787354931070e-01   +2.960993648778464e-01   -1.399568202854403e-02   +3.177946394091688e-02   +7.913014277420084e-02   +3.077410624107755e-01   +2.205947710324314e-01   +3.787499297840508e-01   +4.140640358715854e-01   +3.523390604672810e-01   +2.237035281068916e-02   +2.149062521162534e-01   +5.382215589868729e-01; +3.427813212443800e-01   +4.949378209165011e-01   +4.105946607937241e-01   +2.467218091665282e-01   +1.570567767800988e-02   +3.649620603574806e-01   +2.598435662002080e-01   +6.930980027034533e-01   +1.970009708004657e-01   +4.653516784378294e-01   +2.576147870569178e-01   +3.020212616315067e-01   +9.030257583393000e-02   +5.394526972126771e-01   +4.034603359034111e-01   +2.908707317351815e-01; +1.177841198206951e-01   +3.411167571775110e-02   +6.104906694839279e-01   -1.206747650897163e-02   +5.510370813553380e-01   +6.112090096615630e-01   +1.375434752352466e-01   +2.895862476509813e-01   +3.602526210319963e-01   +1.609182116529824e-01   +4.502072508440192e-01   +2.942305423281787e-02   +5.756581205009894e-01   +3.586288180974710e-01   +3.441128279713996e-01   +3.630436920101341e-01; +1.727229978140120e-01   +3.703363294303594e-01   +1.140952777413313e-01   +6.071703464220116e-01   +2.161208350938242e-02   +6.459978991804333e-01   +5.016068874594715e-01   +1.081195283035915e-01   +2.232748957592573e-01   +4.541147367560504e-02   +6.223596485933591e-01   +2.722798970761808e-01   +2.843679546568808e-01   +3.415645493182010e-01   +1.664964687386430e-01   +4.659918746894237e-01; +1.275528600517984e-01   +5.718561895700089e-02   +3.529806046064523e-01   -1.579034510181503e-02   +2.554662579031312e-01   +6.354918533758452e-02   +5.956953692355315e-01   +4.208007997043279e-01   +5.381853866307306e-01   +4.071089190146777e-01   +1.683311454306146e-01   +3.558818097391497e-01   +2.551563102097029e-01   +2.372929049865745e-01   +6.257841177036638e-01   +5.824195917446180e-01; +2.599001207692722e-01   +1.719555706317210e-01   +6.336248705021771e-01   +1.019612256058292e-01   +3.335412406711593e-01   +3.352314580573785e-01   +1.155166796023464e-01   +5.268091288600364e-01   +6.479312454674402e-01   +2.118995127462557e-01   +3.836240364795120e-01   +1.553125934068606e-01   +3.353708262816383e-01   +3.241083750491443e-01   +4.023365826842176e-01   +3.202987669589017e-01];
L2E_L1E_iAMPA_netcon = [+4.961935131361444e-01   +2.974909804344198e-01   +8.857725294310995e-02   +4.686166334631057e-01   +5.151806784885566e-02   +6.198433946697751e-03   +3.232204338548275e-01   +2.778727558968576e-01; +5.250070701359312e-01   +6.102581184131085e-03   +5.089205634049331e-01   +2.202776719004620e-01   +2.147669772094481e-02   +2.018994562498516e-01   +4.051015789882058e-02   +6.749994451057095e-02; +1.657180350385178e-01   +5.511272130125811e-01   +5.372590619644517e-01   +4.057311892095510e-01   +6.371888804634972e-01   +1.763928740123986e-01   +2.713533534020511e-01   +2.618283054946008e-01; +2.022346054993342e-01   +5.946607005849606e-01   +5.060412723645334e-01   +1.165046607343082e-01   +1.648375750067846e-01   +6.046997892855656e-01   +4.587848180618414e-02   +2.092903504460492e-01; +1.959712001155307e-01   +3.225360089393908e-01   +3.143762159143091e-01   +5.695072422032759e-01   +5.559932028130624e-01   +6.003078881918423e-01   +8.297811391560948e-02   +8.240943581805077e-02; +2.557772604077210e-01   +1.455142570404708e-01   +6.652994114997374e-01   +1.754610744490578e-01   +4.377241470636122e-01   +4.162089197649898e-01   +1.715085826957272e-02   +9.944732184850316e-02; +1.065405263257538e-02   +5.410731090242605e-01   +3.851068401659034e-01   +5.930696944807535e-01   +1.236854340788186e-01   +1.609842037320337e-01   +3.297169289408072e-02   +2.812656604127017e-01; +1.003604946077122e-01   +2.348990064624930e-01   +4.243125518053906e-01   +2.675018587885292e-02   +2.331537758085431e-01   +4.628603280845573e-01   +7.630936255054049e-02   +1.378071998928409e-01; +5.221038144029360e-01   +3.406069328183448e-01   +3.714247493501598e-01   +5.158747392504650e-01   +5.667634572496300e-01   +1.816601763286198e-01   +1.316788937945092e-01   +6.417105201297529e-01; +2.864198452952527e-01   +1.337103958552709e-01   +7.378304998217927e-02   +4.073139209203149e-01   +1.171167585852482e-02   +6.048231532878587e-01   +5.424639116359077e-01   +4.799825897950464e-01; +2.322869798428359e-01   +9.627007640116356e-04   +1.123783810808897e-01   +5.139991213521467e-02   +4.606613517577158e-01   +1.484097020219373e-01   +2.283149017161046e-01   +1.599690510212873e-01; +2.252245339811507e-01   +1.254064840698197e-01   +2.742484652069586e-01   +6.306871550945323e-02   +1.713970470340274e-01   +6.599329016474604e-01   +3.867650097844741e-01   +8.380040093492380e-02; +5.607535574042841e-01   +5.914027432626751e-01   +1.483550324165631e-01   +2.087257555209072e-01   +1.729045013145391e-01   +4.114548548647339e-01   +2.457735006089539e-01   +6.971025631446965e-01; +2.215166508020152e-01   +3.999804740845240e-01   +4.080769559148445e-01   -3.178910864375550e-03   +1.721519569867629e-01   +1.881808222660035e-01   +3.237674979503297e-01   +4.521629795099017e-03; +5.570440869251975e-01   +5.675649813135680e-01   +2.328497887779022e-01   +1.963417562538287e-01   +1.863837800100251e-01   +1.949065994059777e-01   -8.375050868163886e-02   +5.613462671691091e-01; +5.989297713062035e-01   -8.079380907855017e-02   +3.305163865077585e-01   +2.999682500152959e-01   +5.474643564138941e-01   +4.240602028586138e-01   +2.728032865438628e-01   +6.369013482375150e-01];
L1E_L2E_iAMPA_netcon = [+3.437981944577709e-01   +2.283188939243191e-01   +3.350297984080881e-01   +2.640785164402840e-01   -1.463790506792521e-02   +3.022653892795969e-01   +2.769467727220398e-01   +5.525785483242284e-02   +1.397697201201485e-01   +5.974830997868587e-01   +6.034438235719849e-01   +5.148972546555507e-01   +4.338979940959599e-01   +5.380255684395220e-01   +1.755184034354644e-01   +3.285066408128672e-02; +5.923000103491872e-01   +9.757774711399267e-02   +3.962067825933897e-02   +4.294470204365604e-01   +3.685885715792110e-01   +7.047884578926591e-02   +3.121804648780112e-01   +2.546694811815997e-01   +5.071588623142166e-01   +4.503472776755836e-01   +4.026983984503056e-01   +4.874817169614887e-01   +8.717200434948592e-02   +5.574216807292174e-01   +1.405411167116995e-01   +4.648993751918603e-01; +2.661071610239577e-01   +3.760233969900280e-01   +1.540302926058135e-01   +4.851993168965595e-02   +4.849830487563346e-01   +2.240752580167747e-01   +5.088715499214778e-01   +1.879625988943905e-01   +8.618067096255963e-02   +6.124250872462229e-01   +5.858135572947493e-01   +1.633629178052448e-01   +4.380397903792585e-02   +4.138331272007697e-01   +2.943606311317296e-01   +3.988519571603550e-01; +5.504723157099042e-01   +6.786739735619625e-01   +1.370694694617836e-01   +3.126984278557647e-01   +1.965949643262749e-01   +2.613612411457652e-01   +3.574280361918903e-01   +7.754145761842793e-02   +3.570261978798793e-01   +5.624975395770909e-01   +3.656571862468519e-01   +4.975147610141353e-01   +5.428906867937817e-01   +3.554604864225670e-01   -3.086379894899478e-02   +2.322368218017933e-01; +5.239047935810634e-03   +2.302413943075703e-01   +7.658569204148458e-02   +4.103202984171352e-01   +5.610637316018315e-01   +6.705647727793183e-01   +5.019500735754819e-01   +3.395598827958369e-01   +1.987823770086718e-01   +5.782432747462809e-01   +4.370224942837208e-01   +3.462667624046754e-01   +4.455770837705979e-01   +3.962323361517401e-01   +2.545012522394782e-02   +5.436624676526750e-01; +3.397699606791923e-01   +4.316842589114484e-01   +6.296856910004976e-01   +5.083359655005986e-01   +4.548331608190945e-01   +4.876869563041663e-02   +4.220028670332290e-01   +1.245982692059884e-01   +3.576986749907223e-01   +5.106642942364114e-01   +3.979990169129526e-01   +4.015108278666672e-01   +5.702624490553589e-01   +1.121066648386310e-01   +2.287824659077688e-01   +4.209592150899927e-01; +4.350505215282416e-01   +4.004365227720514e-01   +5.680756815140419e-01   +4.393040803964322e-01   +2.818683650563318e-01   +2.004650481404881e-01   +2.908803605599170e-01   +2.098941634066763e-01   +5.523893078552820e-02   +2.962212073555506e-01   +7.311757304345066e-02   +4.646141002883225e-01   +4.084433554101791e-01   +6.934069207808836e-01   +2.142321411542014e-01   +1.384975552269847e-01; +3.946072993648262e-01   +6.009384679854632e-01   +4.535311552306168e-01   +2.246221026679366e-01   +1.762066498136321e-02   -1.287357602513990e-02   +5.105814206253007e-01   +1.870751168388818e-01   +4.283569009038286e-01   +5.382453082100133e-01   +3.442062895203832e-01   +3.197503217154544e-01   +6.008938165159976e-01   +8.680427495281356e-02   +2.797705044468938e-01   +3.940192718836482e-01];
L2I_L2E_iAMPA_netcon = [+2.264702141175635e-01   +5.102162871855578e-01   +1.022934813274943e-01   +2.361925031453969e-01   +1.436705443049579e-01   +2.094529708333896e-01   +4.297755080484265e-02   +3.547870171001063e-01; +4.399491191797482e-01   +7.112264250931098e-01   +2.452219859345803e-02   +6.704387032106197e-01   +4.542848248811809e-01   +3.507259391166929e-01   +5.961049384467781e-01   +3.767328927559349e-01; +2.541156828058619e-01   +4.061790894811423e-01   +1.026798852577446e-01   +3.126313778391215e-01   +1.628136459615880e-01   +5.446841032656630e-02   +3.641954755890900e-02   +3.857084091972057e-01; +6.765257158292206e-01   +2.648981424017107e-02   +3.052651073696152e-01   +3.652039919355680e-01   +5.706628058071392e-01   +2.070000668222688e-01   +1.002210148419927e-01   +5.955229666617193e-01; +1.257707324874869e-01   +6.663914385894456e-01   +1.225664310347594e-01   +4.964024430281505e-01   +9.456359068929691e-02   +4.024103933098349e-01   +3.724422425327057e-01   +5.244465881006148e-01; +3.856437346568451e-01   +2.757919034178989e-01   +4.215184591862795e-01   +3.474324746393888e-01   +5.013276970635000e-01   +6.028079007206545e-01   +3.726362756716722e-01   +2.587826365230221e-01; +5.535024219788577e-01   +4.949822534526758e-01   +4.365594546365437e-01   -2.941133161324280e-02   +3.683939977723490e-01   +3.697817086186007e-01   +1.744640548531220e-01   +5.476303570962041e-01; +1.708348970488887e-01   +1.421728100380318e-01   +6.003161927306270e-01   +3.971347370971978e-01   +1.862414067042876e-01   +4.552928360758667e-01   +1.046126077550024e-01   +2.248331974450713e-02];
L2E_L2I_iGABA_netcon = [+7.510376419960192e-02   +5.710857369199923e-01   +4.634085223681821e-01   +3.610845431159393e-01   +2.971918366643727e-01   +4.259376806430520e-01   +1.437383894205225e-01   +3.893650677643171e-01; +2.100468843141596e-02   +1.619177114713569e-01   +5.736937391247741e-01   -1.893966242494405e-02   +1.456673525284271e-01   +4.469121565391817e-01   +5.065155560824462e-01   +3.293473700795751e-01; +3.801096636882669e-01   +3.327053888612820e-01   +5.360525546885074e-01   +3.299115018968050e-01   +6.516862891049215e-02   +1.457660785708366e-01   +3.439182990033207e-01   +2.784832129880436e-01; +5.422245989532630e-01   +4.376373057788007e-01   +2.894512518347642e-01   +5.823804554763164e-01   +1.046657813346224e-01   +3.098293436813643e-01   +1.129996559316271e-01   +3.311261742057486e-01; +2.632024060895180e-01   +4.867956430286335e-01   +5.541634646728943e-01   +8.484719633899182e-02   +4.079807837839108e-02   +3.246561750202409e-01   +5.338208640863625e-01   +5.030263399982147e-01; +1.902054387129028e-01   +4.066980920250095e-01   +5.558025466550413e-01   +8.388067273658516e-02   +7.023267597656999e-02   +4.154504263933721e-01   +4.082382875002437e-01   +1.397258341260407e-01; +2.811586353013064e-02   +2.227879553817548e-01   +4.987306857566449e-01   +4.649676704254901e-01   +1.485891891035251e-01   +5.455641035403401e-01   +3.492457619288046e-01   +6.919556151464524e-01; +5.118676522581239e-01   +6.012439590866278e-01   +2.848461211835936e-01   +4.790583963969001e-01   +1.411396022962714e-01   +1.664555792112409e-01   +9.291093658966423e-02   -8.891217030772287e-02];
L3E_L2E_iAMPA_netcon = [+3.025414982374589e-01   +2.098709884871266e-01   +1.227179078124069e-01   +2.145017445952602e-01   +2.125317379197048e-01   +2.257839837054623e-02   +1.009800221437378e-01   +1.339638672580158e-01   +2.411120132130760e-01   +1.794400614408079e-01   +6.287114789793754e-01   +4.525442435300079e-01; +1.995289748136908e-01   +2.243305989284667e-02   +4.965366734274252e-01   +3.362102268487152e-01   +7.560388514585041e-02   +5.226350534103227e-01   +2.978097932446672e-01   +1.327172037737892e-01   +3.663734758387316e-01   +4.656978787176037e-01   +1.057825992048528e-01   +4.084179624759825e-02; +6.361103616316346e-01   +1.177078827259313e-01   +2.116019780356203e-01   +4.652429027369024e-01   +6.807090477588172e-01   +1.057518239355519e-01   +3.602481629830308e-01   +3.610803050604474e-01   +4.439819879426518e-01   +2.286127973572097e-01   +4.599733359001972e-01   +2.560555644966030e-01; +4.370326284663761e-01   +1.663780151598364e-01   +2.550876035738364e-01   +5.037597937849276e-01   +1.882292642914037e-01   +4.291100707098098e-02   +5.221438131742859e-01   +1.389315330508307e-01   +2.136669696595118e-01   +1.147667481059116e-01   +2.593102102098505e-01   +5.159915854611483e-01; +4.674510929174168e-01   +7.612526439719695e-02   +4.129693106371730e-01   +9.922021441981967e-02   +1.213920619440975e-01   +1.713362364719125e-01   +3.920649122017992e-01   +4.558265904715509e-01   +4.510479342901855e-01   +1.545497356300352e-01   +4.537059013717071e-01   +5.935258910425912e-01; +2.950211584350609e-01   +8.385511385520279e-02   +1.490220582541117e-01   -5.518256611391874e-02   +1.079805491117733e-01   +2.999664046319797e-01   +3.977654729848815e-01   +1.246956807561184e-01   +4.328838644051324e-01   +5.061570883204719e-01   +4.712592598740903e-01   +8.165732076495057e-02; +6.947693318291367e-01   +4.925882526619005e-01   +1.904267251157548e-01   +1.145880880216200e-01   +5.900701666932686e-01   +1.918020724695471e-01   +3.722078959394487e-01   +1.303856666343257e-01   +7.036854331656231e-02   +1.184791900276919e-01   +1.927355989030974e-01   +4.543104272290491e-01; +1.263047078431250e-01   +5.140205655612657e-01   +5.059516159872565e-01   +1.038030421920846e-01   +5.035218898894077e-01   +1.012634237803311e-01   +4.453871743339140e-01   +3.179622509918782e-01   +2.227964391835414e-01   +2.592196004573860e-01   +1.892071923944670e-01   +4.377245509100861e-01];
L3I_L2I_iGABA_netcon = [+1.965894960878449e-01   +1.996289737402047e-01   +5.875302791520058e-01   +2.039737992243713e-01   +5.073752658840586e-01   +5.269476870611990e-01   +3.753300960695599e-01   +4.553160161016227e-01   +1.778404914234448e-01   +1.754557357676190e-01   +2.710482311219714e-01   +4.876993517216576e-01; +5.751390936680583e-01   +1.447878871006061e-01   +3.585091603254467e-01   +2.649607899919437e-01   +6.125661275308667e-01   +3.148283994069733e-01   +2.495174193941453e-01   +5.106646132237278e-01   +6.442745795630668e-01   +2.807547059796593e-01   +5.298625482194472e-01   +5.668464167748084e-01; +1.391602936556598e-01   +3.608995788619798e-01   +3.066945957545515e-01   +5.223202167011758e-01   +4.513445872416327e-01   +3.914275220922592e-01   +5.453979927592404e-01   +4.172359822331359e-01   +6.425609450433373e-01   +4.684981575661959e-01   +1.658320583272342e-01   +6.436315029464975e-01; +4.296341757712491e-01   +2.429882779577107e-01   +3.031283219865504e-01   +4.056170519366828e-01   +5.561815181602396e-01   +5.314268352945087e-04   +9.377591703024471e-02   +7.733339293982608e-02   +1.447993509044824e-01   +1.059787707652325e-02   +2.119468311024532e-01   +3.199938685831354e-01; +4.209494969342523e-01   +6.545387978985941e-01   +1.532737351845746e-01   +5.325587643294352e-01   +4.655216377723007e-01   +3.336621940136286e-01   +1.306181769438498e-01   +3.606478309868454e-01   +2.439946449937639e-01   +4.412566838137831e-01   +3.569841006414959e-01   +4.942442841811567e-01; +3.522160558001176e-01   +5.748643769459538e-01   +2.787812632162482e-01   +4.520700558777970e-01   -1.056982343318772e-02   +1.758651278444621e-01   +3.396197926255998e-01   +3.256401865721681e-01   +4.363832734357862e-01   +1.141503508003148e-01   +2.138783075235316e-02   +6.119601566480452e-01; +9.048311371906587e-02   +1.819069286768137e-01   +3.874272231774645e-01   +5.562979503376826e-01   +4.993383654393805e-01   +1.753732636085045e-01   +5.028945242875638e-01   +4.539868329343678e-01   +4.597013946474298e-01   +3.067802990471489e-01   +1.742540842424952e-01   +2.328058148521963e-01; +2.796518548380709e-01   +2.980588570162773e-01   +1.137675382370111e-01   +2.314647156207986e-01   +5.475318525521632e-01   +6.044587010787340e-01   +2.441097352771442e-01   +1.159406364617923e-02   +1.236340029148051e-01   +1.856488189450003e-01   +1.789280806164468e-01   +5.154987877171873e-01];
L2E_L3E_iAMPA_netcon = [+5.248517408136606e-01   +3.287042150576306e-01   +5.729677257341771e-02   +6.235314154800972e-01   +3.177844846603418e-01   +2.974047561110015e-02   +2.767481448945808e-01   +3.383733535655248e-01; +5.916363721633211e-01   +3.432148523855747e-01   +2.554967541458497e-01   -5.645945956079791e-03   +4.947190231328724e-01   +4.213970791376911e-01   +2.621588070467109e-01   +2.111909577854544e-01; +2.659495818280863e-01   +1.199818550198579e-01   +1.003218902200591e-01   +3.824229794695788e-01   +5.366029043909408e-01   +4.004505523015746e-01   -2.205378096170420e-02   +4.352539389265213e-01; +3.443473666606564e-01   +4.178159220278878e-01   +1.024153546828453e-01   +6.009612400435366e-03   +1.627366803368395e-01   +2.105054896117438e-01   +9.228562709732162e-02   +3.746114928788086e-01; +4.122282447113679e-01   +5.785414883643539e-01   +8.690306751239107e-02   +5.162929483096184e-01   +1.974095507073920e-01   +3.195081403193066e-02   +5.845047449042837e-01   +6.027087592172704e-01; +4.834026731295654e-01   +3.891552924854811e-01   +3.498805449302311e-01   +1.496596877969604e-01   +5.114718183767898e-01   +1.482616619255272e-01   +5.289582523480676e-01   +5.812270714441988e-01; +3.152915618262961e-01   +5.747957399916164e-01   +4.583863779565995e-01   +1.280323088488650e-01   +4.423166404857712e-02   +3.591250282030527e-01   +5.226801277605950e-02   +5.453926625664359e-01; +2.695452544631524e-01   +2.486805023240953e-01   +4.913691497364334e-01   +3.022188993508836e-01   +2.351502244096044e-01   +1.458712214490436e-01   +2.270592219005856e-01   +4.456964459015015e-01; +4.741402565039148e-01   +8.578604679928092e-02   +2.648613978465275e-01   +2.609071959067782e-01   +6.180002273549698e-02   +4.349043260891318e-01   +5.252461292795289e-03   +3.347345092727018e-01; +3.656849134478632e-01   +4.550478390234037e-01   +5.329691384217230e-01   +1.265358980043004e-01   -1.195480662461804e-02   +2.756849843548266e-01   +4.761937677139844e-01   +1.670138702220406e-01; +2.191700896371747e-01   +4.321765767744734e-01   +2.905430078998193e-02   +2.906566850695756e-01   +4.320988655125281e-02   +3.756069922408893e-01   +6.237573890385537e-01   +4.471286856865240e-01; +2.345667942076391e-01   +1.544527262483157e-01   +4.649642907468540e-01   +3.091988034790019e-01   +5.504262270490434e-01   +5.572002213065020e-01   +4.861663521343415e-02   +2.235725629637952e-01];
L2I_L3I_iGABA_netcon = [+2.477204165729080e-01   +5.652782293795309e-01   +3.830560598287283e-01   +4.163255821272270e-01   +4.671102271267905e-01   +3.440102516363905e-01   +5.072225211891678e-01   +4.084524671622013e-01; +3.957292380781199e-01   +1.293820884965082e-01   +2.611287000999757e-01   +1.314772804588572e-01   +1.666669052800214e-01   +3.249514423688745e-01   +4.598014159368672e-01   +6.247750025931639e-01; +5.410503789812192e-02   +6.505817838955473e-01   +5.651171619622840e-01   +1.451735608231000e-01   +3.407392387575274e-01   +1.687479575580190e-01   +5.753398644203342e-01   +6.279684558926336e-01; +5.085193016893140e-01   +1.481888768336061e-01   +2.498134519846721e-01   +1.278363155188220e-01   +2.418564947495810e-01   +2.996071046446638e-01   +1.075049002889640e-01   +2.583088012178044e-01; +6.553951386494854e-01   +1.604774891067554e-01   +1.358795084087094e-01   +2.400144388979011e-01   +3.060915117130165e-01   +5.548892571647098e-01   +3.346253911316290e-01   +6.410360940282859e-01; +3.387047523857153e-01   +5.069649006497337e-01   -7.591381781915482e-02   +4.804958030533405e-01   +5.175570996338221e-01   +2.817725421021702e-01   +3.331638262191331e-01   +1.268316415835172e-02; +4.572692755650452e-01   -1.866610367646934e-02   +5.481095974829502e-01   +6.377310637955581e-01   +8.707679600194343e-02   -5.919595532357259e-02   +1.447737457186461e-01   +9.785899241826299e-02; +5.934326161929363e-01   +4.065401735805129e-01   +4.653607268965430e-01   +1.211266535824142e-01   +6.055820977653956e-02   +2.626408510666565e-01   +5.754952962633343e-01   +3.883282255910290e-01; +5.939970747895852e-01   +4.207394024340355e-01   +3.835682872664392e-02   +6.131024031896328e-01   +4.952283060681049e-01   +3.747033625252687e-01   +4.163158602837297e-01   +2.611983570619145e-01; +2.535769867730426e-01   +4.809071006192033e-01   +2.692468999637356e-01   +6.242004739739454e-01   +5.605070345242660e-01   +3.704603083939107e-01   +5.552864177491706e-02   +5.177392929512521e-01; +6.441254404195452e-01   +3.518715527707478e-01   +3.526022927954788e-01   +5.183083054408005e-01   +4.299542873749522e-01   +1.740255714097803e-01   +4.102140919470694e-01   -1.299107139979153e-02; +5.905912998467295e-01   +4.875126706228197e-01   +5.514923142250212e-01   +6.505453607629412e-01   +5.371542016129127e-01   +5.733379406101514e-01   +2.967721663706433e-01   +5.211595676639030e-01];
L3I_L3E_iAMPA_netcon = [+4.872705575545347e-01   +3.853928007598985e-01   +1.035811619102048e-01   +4.325293819581551e-02   +3.294690692000147e-01   +3.365019846490633e-01   +5.747089796524463e-01   +5.517868358551815e-01   +9.423701278130601e-02   +4.490752573791204e-01   +5.748196466736097e-01   +4.333269897704298e-01; +3.128980576938518e-01   +2.286731123642776e-01   +5.917847045426333e-01   +2.432234679933890e-01   +1.104618834253975e-01   +3.574016694575957e-01   +8.008944699670366e-02   -4.960168732366353e-02   +2.218233355294640e-01   +4.072434523884242e-01   +1.917025345994724e-01   +3.523975216793798e-01; +2.637489870122491e-01   +3.364950208850614e-01   +5.779815894384160e-01   +3.010813899183805e-01   +2.710370522364761e-01   +6.370374107118720e-01   +4.899123154426528e-01   +2.033176552461993e-01   +2.897549438028357e-01   +4.121239079716644e-01   +5.110567432618943e-01   +9.585339320954823e-02; +2.992299926407727e-01   +4.461425692578771e-01   +2.681770694957166e-01   +2.516703980521232e-02   +3.306020159560571e-01   +2.075409461553237e-01   +5.784133880818501e-01   +6.726076407626131e-01   +5.056448371428035e-01   +3.295288151940945e-01   +3.667042135211259e-01   +5.927099060626702e-01; +4.459272472261164e-01   +2.625170309744183e-01   +2.726961111917208e-01   +5.135189591356867e-01   +5.558555093909572e-01   +2.131401148859229e-01   +4.202024072574546e-01   +6.132939225852470e-01   +1.089507871825508e-01   -6.501846557776229e-02   +4.351563815696164e-02   +3.098743633144396e-01; +5.641359225919061e-01   +3.646025467950064e-01   +1.555715703010087e-01   +5.980550787008664e-01   +1.797088436941778e-01   +3.639131474911075e-02   +5.601716754345831e-01   +3.261570748018809e-01   +2.899160805288767e-01   +7.646511278210602e-02   +5.390550474639669e-02   +2.777536848243767e-01; +2.285916342129073e-01   +2.430568600259304e-01   +9.010603350229882e-02   +4.525668692470969e-01   +3.593622314403112e-01   +1.371360779865587e-01   +1.891028486528065e-01   +5.108071829584223e-01   +2.284483750693776e-01   +6.595757014123550e-01   +4.728947172263832e-01   +2.070228318272905e-01; +5.414833572605856e-01   +1.200044266756320e-01   +4.953344755466954e-01   +1.372192286599134e-01   +3.112956739162643e-01   +2.820125667140863e-01   +5.624600454224247e-01   +3.893706311510057e-01   +6.895371400894340e-01   +9.078109868798680e-03   +1.343834513620007e-01   +1.996448630293117e-01; +4.923174622148989e-01   +3.927900953651557e-01   +2.129114846046678e-01   +5.799774310617088e-01   +6.947118024712402e-01   +2.739170038467657e-01   +4.161451073683250e-02   +4.972998248376924e-01   +3.241278740612654e-01   +6.057478570584554e-01   +1.482282203272376e-01   +1.557344344786771e-01; +3.033097751720174e-01   +4.323817268756291e-01   +5.178842283376438e-01   +4.404711753260300e-01   +2.314892207663554e-01   +8.250929587906775e-02   +3.286672882157363e-01   +4.637689564654575e-01   +2.888519300142632e-01   +4.786106251060115e-01   +5.544923389845798e-01   +4.960194294738680e-01; +4.859380842815175e-01   +3.740246215620671e-01   +2.890731522037867e-01   +3.185006500925347e-03   +5.626979836380944e-01   +2.567674279242710e-01   +2.190314973885562e-01   +2.464814437291359e-01   +5.796831341051174e-01   +2.902504745401341e-01   +4.458934883839506e-01   +5.083768228850399e-01; +4.110744666525817e-01   +4.185841126210986e-01   +1.366077872464635e-01   +3.562682227930770e-01   +5.234994466574810e-01   +5.916395338810287e-01   +5.398617564849116e-01   +4.932156096226999e-01   +1.964571562392330e-01   +5.462848951738535e-01   +6.049363351064190e-01   +2.725631008661074e-02];
L3E_L3I_iGABA_netcon = [+5.583851521381975e-01   +5.112451315965592e-01   +5.330905846165781e-01   +2.110737040975438e-01   +6.483366124282968e-01   +4.696106058658591e-01   +2.793524981868857e-01   +4.229498698982157e-01   +3.681949389580461e-01   +2.592829035949956e-01   +3.832651598858864e-01   +4.172130374344210e-01; +3.414849011151130e-01   +2.404266021716525e-01   +1.930723107572018e-01   +6.430461647368397e-01   +2.571477233905759e-01   +2.603056757221613e-01   +4.725994560554329e-01   +2.173214598703537e-01   +1.590629250062631e-01   +5.616711683707775e-01   +9.013635897701910e-02   +2.322829571961940e-01; +3.620455047006630e-01   +5.602120689486018e-01   +5.704695321921167e-01   +1.499549306484399e-01   +3.482831689958343e-01   +4.672145503013404e-01   +2.915003329804616e-01   +3.366013276503849e-01   +4.883350065271883e-01   +3.939454292034492e-01   +1.861271647146096e-01   +2.691988653626792e-01; +3.668460122642898e-02   +8.129135672081422e-02   +4.676250153984953e-02   +2.838925022915822e-01   +5.314783545111225e-01   +2.033309845633812e-01   +2.573532307146583e-01   +4.876961326128489e-01   +2.247869552742462e-01   +4.135923101168754e-01   +2.374965247174267e-01   +9.367969113048767e-02; +2.219528223902053e-01   +2.837360526755860e-01   +1.158224948043258e-01   -4.191659908599640e-02   +9.111691598792926e-02   +1.553319780096921e-01   +2.132529081372141e-01   +5.543156728112562e-01   +1.579657058152067e-01   +2.096607339806321e-01   +7.436103523876884e-02   +5.583660514104067e-01; +1.269238412111899e-01   +6.233776047121061e-01   +5.076197724967082e-01   +9.194438823499083e-02   +1.537461666083325e-01   +4.722442887706456e-01   +2.757206049841363e-01   +1.084187534441139e-01   +3.100987700632647e-01   +6.154442331874131e-01   +4.981521014495964e-01   +5.288404278628288e-01; +5.768418082362414e-02   +2.599164881234995e-02   +1.377067843879269e-01   +4.357087292566704e-01   +1.490689578031754e-01   +2.387844366690997e-01   +3.843703784288615e-01   +4.386354203057233e-01   +4.590976838144740e-01   +4.970756837367465e-01   +3.771970688341542e-01   -2.500503394225737e-02; +2.697640678848673e-01   +4.187539170450143e-01   +1.877204826749518e-01   +5.132726939088740e-01   +4.261275943914072e-01   +3.803621657910583e-01   +5.848834596073088e-01   +2.428568833823391e-01   +2.683473046081670e-01   +3.117440918476170e-01   +4.455624386256832e-01   +1.211566044618544e-02; +3.334155671661503e-01   +2.183079762522809e-01   +1.019319961663423e-01   +4.301298727626091e-01   +2.372354091723530e-01   +3.033732515238068e-02   +5.011777957273578e-01   +1.966728523394512e-01   +4.756853579040987e-01   +5.300589449565329e-01   +1.226542325436985e-01   +3.581599677091034e-01; +1.459152341900879e-01   +2.233232953460527e-01   +4.470379311833632e-01   +1.118066325589577e-01   +3.625592389796489e-01   +1.816745658210810e-01   +1.035511204410190e-01   +3.714615065657545e-01   +2.477508185477145e-01   +4.140454094542774e-01   +4.214583382697246e-01   +4.755096592339271e-01; +1.908710462996014e-01   +4.191634349799244e-01   +4.006931047224955e-01   +5.202153628482334e-01   +4.430962327357310e-01   +3.272625478052351e-01   +4.794798814231307e-01   +9.429619275845660e-02   +2.689454854389210e-01   +2.964737767979147e-02   +6.241050050652146e-01   +4.582453195261403e-01; +3.248643365461753e-01   +4.753432747122649e-01   +2.566849420329046e-01   +7.670873901045880e-02   +5.808984452022207e-01   +4.654572965620810e-01   +5.297526166593532e-01   +4.761195035181744e-01   +4.325362547478263e-01   +5.764342605909317e-01   +2.893250120743369e-01   +3.210176518428426e-01];
L2E_Input1_iAMPA_netcon = [+1.784518718805229e-01   +2.841809128783055e-01   +4.267056043944089e-01   +5.158394962365430e-01   +4.588625500235186e-01   +1.132097983372441e-01   +5.408921565329664e-01   +9.423732161610805e-02];
L2I_Input2_iAMPA_netcon = [+5.200798751906088e-01   +4.378689612445424e-01   +4.759350993706629e-02   +7.006717750925131e-01   +2.077659038237600e-01   +6.486181063442045e-01   +3.902136662398670e-01   +6.422072601843900e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
