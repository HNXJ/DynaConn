function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.890874147427764e-01   -5.038787703963040e-02   +4.202504570211239e-01   +2.987387888782433e-01   +2.452657196330064e-01   +6.542301112214094e-02   +4.011834971126242e-01   +2.689146382991653e-01   +1.709379998091328e-01   +3.019658131223596e-01   +3.596086973787844e-01   +1.112983308324212e-01   +2.990646192413386e-01   +2.001798854707467e-01   +1.030485482457415e-01   +4.463306601296994e-01; +3.151730162250194e-01   +1.817585015139303e-01   +3.986618679830171e-01   +2.381461052281081e-01   +3.263419638122642e-01   +1.174096327717564e-01   +1.269408131543073e-01   +1.762998200622974e-01   +3.519125355885758e-01   +5.669321092410828e-02   +1.950287742302798e-01   +5.376991394938937e-01   +2.605626312359808e-01   +2.175391505099579e-01   +5.495940273171631e-01   +3.955162237523878e-01; +5.478435722946922e-01   +2.045401092447059e-02   +3.467555764725699e-01   +9.453488685100268e-02   +2.467535791550981e-01   +7.352839998831123e-02   +6.132433184350838e-02   +3.925022387842451e-01   +8.580631247152427e-02   +1.582226832168559e-01   +3.176989619669208e-01   +9.398300130942146e-02   +2.607502341983773e-01   +3.127844699483487e-01   +2.430721417098464e-01   +1.195736639932643e-01; +3.607105081871119e-01   +4.639730853186995e-01   +3.990804971473373e-01   +2.430879052144610e-01   +4.149578025566140e-02   +4.451048878093522e-01   +4.986127831413780e-01   +8.251142962816596e-02   +1.792952050838019e-01   +1.536137282231246e-01   +1.764210296569254e-01   +8.990894022301139e-02   +2.417050270816989e-01   +8.602608390857515e-02   +3.864842380758764e-01   +2.643449814457288e-01; +3.620744974697455e-01   +3.949417576549377e-02   +4.491138246743311e-01   +6.992243671888981e-02   +1.287188069067816e-01   +3.884915568415234e-01   +2.256083819755812e-01   +4.229349080650228e-01   +4.199450042033126e-01   +4.730506419153273e-01   +4.517884301506854e-01   +1.688072165867500e-01   +3.620890987927119e-01   +3.946805425375025e-01   +8.236528123348213e-02   +3.864876912589256e-01; +3.577787077191243e-01   +1.829746018049310e-01   +3.507281787095882e-01   +1.225120613686402e-01   +2.122132294700266e-01   +3.366182796609141e-01   +4.626876474794967e-01   +4.999603373687272e-02   +4.074358687278906e-01   +5.295995545084591e-01   +4.110903081326819e-01   +3.724417309297914e-03   +3.156218638228867e-01   +1.918145398738929e-01   +2.450166875001347e-01   +3.283292035893229e-02; +3.352963346829903e-01   +1.824493980544561e-01   +9.352268917321564e-02   +4.853369613485790e-02   +2.223955317349103e-01   +5.155605321307088e-02   +5.024556091582221e-01   +4.596881327033642e-01   +2.037155013038867e-01   +4.081122980592933e-02   +3.302531019732349e-01   +5.286518921491754e-02   +3.923310138876461e-01   +4.096772636789409e-01   +1.714673344112331e-01   +1.514248170998317e-01; +2.981917431256004e-01   +1.621070976104655e-01   +3.624926544257889e-01   +4.164996121048975e-01   +4.144801547810867e-01   +2.290224924307722e-01   +3.053553916209969e-01   +1.853974462604034e-01   +1.251178281434173e-01   +1.703322686041095e-01   +3.208787533800583e-01   +3.074643767880403e-01   +2.439950482997546e-01   +2.357639093906915e-01   +2.547792436729657e-01   +5.407125855189392e-02; +1.114907878026540e-02   +3.138743919141467e-01   +9.902745250707481e-02   +9.485086095602518e-02   +3.296156538986084e-01   +9.060189000797904e-02   +1.955972564388652e-01   +4.562510725860280e-01   +2.482394945794703e-01   +1.224292097607500e-01   +7.938564337010669e-02   +2.557691717408364e-01   +1.017958372568678e-01   +6.560806203660709e-02   +5.242149777961173e-02   +3.082318936290943e-01; +1.956713092011233e-01   +3.256302470628371e-01   +7.203645720171233e-02   +3.706787470984728e-01   +1.835740500243084e-01   +3.593080736667286e-01   +4.094893883973947e-01   +1.455097700665815e-01   +8.712734153010174e-02   +1.842194983244213e-01   +4.627673626558680e-01   +3.547932860714170e-02   +2.307069856115736e-01   +2.183341112902775e-01   +5.936194365284205e-02   +4.135095317951804e-01; -9.689047181717115e-03   +1.717702071628494e-01   +4.850668037016730e-01   +1.328758811087758e-01   +1.815618257179190e-01   +7.398662102390120e-02   +4.464040917809386e-01   +6.872504791003163e-02   +1.365022078683782e-02   -1.457986740875794e-02   +6.428434444143151e-02   +3.106186987350357e-01   +2.508906927538521e-01   +4.983698833546753e-01   +3.270999711770847e-01   +4.479273571890115e-02; +3.378099957480136e-01   +4.355543252454819e-01   +4.828551119680509e-01   +5.020085576115508e-01   +3.095929036660758e-01   -1.396565181840844e-02   +1.185673786790899e-01   +4.863954238020631e-01   +4.359069586404611e-01   +5.033092885922653e-02   +6.029367028560741e-02   +4.347997978826244e-01   +3.615644330333131e-01   +3.540898926197345e-01   +1.684720553808820e-01   +4.197497252199865e-01; +3.137142758688024e-01   +1.720010810278889e-01   +4.364075064247731e-01   +3.307609817157418e-01   +1.438307783309766e-01   +2.182908533291218e-01   +2.271920029693892e-01   +1.090203129863070e-01   +7.655114255432047e-02   +3.709916791783588e-01   +4.397576579800868e-01   +3.239414832827311e-01   +1.038255173302699e-01   +1.552937126066631e-01   +4.873984869450075e-01   +2.521920602566014e-01; +1.061194147043067e-01   -3.218951869929079e-02   +3.022629034352152e-01   +1.388344675461039e-01   +2.301775276438278e-01   +1.489389197123021e-01   +1.319939822372473e-01   +4.125826374444577e-01   +3.718473196301084e-01   +4.492217848298909e-01   +4.542827734260479e-01   +2.856659702968333e-01   +2.948660012074981e-01   +1.147761339648287e-01   +4.069944733181244e-01   +1.257410532191936e-01; +5.244087992488119e-01   +3.875463059526116e-01   +3.522385254392467e-01   +1.821919517677291e-02   +2.185847814256097e-01   +3.714465219747436e-01   +2.285860068725044e-02   +4.500079295337459e-01   +3.844830884536615e-01   +2.727713916126743e-01   +1.622909168093681e-01   +5.371816442657802e-01   +1.024324188267428e-01   +3.353411440374668e-01   +8.237986334726417e-02   +4.771002364636756e-01; +6.645354009790770e-02   +3.231323671825720e-01   +5.070554516984797e-01   +3.349312759735556e-01   +3.831917872282959e-01   +1.701673150408591e-01   +3.025586382296938e-01   +1.813827717707052e-01   -1.945434237790797e-02   +8.344800707174171e-02   -3.792648462297846e-02   +3.990463730674200e-01   +3.639592782242763e-01   +5.209289337886793e-02   +3.887689579447075e-01   +4.604641285592199e-02];
L1E_L1I_iGABA_netcon = [+8.324131482467639e-02   +4.174082267735766e-01   +3.386787144986172e-01   +1.855324369615740e-01   +2.208358382987388e-01   +3.330001240717183e-01   +9.640149049706379e-02   +2.770642999738122e-01   +4.613677507574474e-01   +4.870381857397131e-01   +3.443868237442786e-01   +2.169297877734594e-01   +3.536805043084092e-01   +1.432822936389122e-02   +1.122401727063563e-01   +4.931917661470329e-02; -3.810851577288915e-02   +2.178828249787259e-01   +1.908056179020163e-01   +4.883102704555246e-01   +4.869238568236669e-02   +4.384928303430117e-01   +1.824141390371649e-01   +2.858753997578445e-01   +1.056997913541805e-01   +3.063145230139848e-01   +5.283603741498198e-01   +6.874877284143627e-03   +4.857720957743545e-01   +2.812051003712067e-01   +9.675740530098735e-02   +3.407163889571863e-01; +2.908166249444616e-01   +3.016334806786534e-01   +1.106360565742490e-01   +3.936156697853765e-01   +3.305456365424511e-01   +4.536983513745994e-01   +2.247512237452733e-01   +4.624026841488729e-01   +1.630967997477225e-01   +2.115625609847708e-01   +4.961696918056771e-01   +3.159294462621383e-01   +1.294862241741628e-01   +3.251128916982101e-01   +3.227155150595011e-01   +4.300123995308493e-01; +4.593339827003228e-01   +8.039152956118691e-02   +3.648286019220612e-01   +5.180204871290134e-01   +3.176618097969259e-01   +4.647240056468278e-01   +3.867404527814227e-01   +5.307198945952278e-01   +5.148658632629822e-03   +5.316120320427604e-01   +4.391710186621944e-01   +8.232813766345604e-02   +1.471134689747682e-01   +1.919568418164272e-01   +2.639956378615333e-01   +2.597557099908018e-01; +4.722589353441579e-01   +3.115291011207740e-01   +9.376910343616396e-02   +1.232724952032631e-01   +6.306614353010279e-02   +3.334352901045511e-01   +4.140658299021662e-01   +1.727422213802803e-01   +4.110604572653000e-01   +1.847192460706083e-01   +1.603221897067609e-01   +3.041856743442109e-04   +3.687860491316297e-01   +5.613964380140374e-01   +2.077194550119235e-01   +7.495011344870525e-03; +2.272908502893950e-01   +1.695465700607384e-01   +5.713228071731220e-02   +4.699672907315435e-01   +1.949078862376778e-01   +2.609195725481539e-01   +4.584311381657620e-01   +4.398422578820023e-01   +2.274386147146430e-01   +3.360999523812774e-01   +4.316253957869650e-01   +5.234864931528531e-02   +3.304761365948408e-01   +1.117145752566059e-01   +3.116503669580563e-01   +1.497097070921755e-01; -4.215452578837189e-04   +2.897223755268132e-01   +2.193198097965574e-01   +1.293878256355646e-01   +2.983559210736588e-01   +4.580366394477215e-01   +4.645056621821776e-02   +4.371118560990913e-01   +2.538286163673663e-01   +4.732226193724397e-01   +4.326182872122641e-02   +5.135492324671209e-01   +5.047189208473656e-02   +1.594852650287308e-01   +1.662134166469940e-01   +2.958161149396549e-01; +3.734826209052031e-01   +3.045074543192513e-01   +4.916803514421236e-02   +5.467149413735553e-02   +8.517233149936479e-02   +1.551951975990536e-01   +3.382099300514387e-01   +2.211569950015417e-01   +1.858803008728274e-01   +8.402537283152270e-02   +5.640565112319142e-01   +3.745144550682891e-01   +3.268527987618358e-01   +2.550252712760991e-01   +1.094727556988064e-01   +1.441147992603223e-01; +3.673039582379634e-02   +4.344762160571364e-01   +7.821947066540738e-02   +4.524175401366101e-01   +2.670229164379627e-01   +4.042919180883723e-01   +1.868395364162576e-01   +4.329457638332939e-01   +1.588911356377715e-01   +4.493677242722845e-01   +3.877802411678041e-01   +3.043995429727538e-01   +1.069321170490152e-01   +3.523369418820551e-01   +3.241393730156454e-01   +4.511231963377650e-01; +1.437265183025945e-01   +5.058919218097718e-01   +2.972957369714105e-01   +1.391333858861811e-01   +4.381434184600818e-01   +2.768758211018510e-01   +2.997064825113386e-01   +1.520734948252902e-01   +3.228631154389784e-01   +4.929533827351934e-01   +3.045245385296035e-01   +1.768231623630806e-02   +2.581428803256436e-03   +2.288102641719749e-01   +1.601430777737423e-01   +3.396574681869921e-01; +5.110928154727759e-01   +1.694176083132513e-01   +4.323302758925988e-01   +4.809902085193480e-01   +3.701898372075111e-01   +1.064337699344055e-01   +4.521675748606919e-01   +2.846021225692066e-01   +4.206532646695932e-01   +4.634718592539550e-01   +2.612411968326424e-01   +2.236743424772391e-01   +2.284427023622711e-01   +3.446593577484239e-01   +4.069266107499058e-01   +2.456226206349617e-01; +1.184091643679344e-01   +1.093485734843518e-01   +6.121210653387986e-02   +2.547880389796364e-01   +1.344621650665941e-01   +9.348710254040751e-02   +2.705650135977736e-01   +3.204631353875262e-01   +3.159076747752186e-01   +2.984366079442916e-01   +3.810150990403421e-01   +4.541801276771993e-01   +2.288646578590033e-01   +4.041286573657843e-01   +3.636907024337838e-01   +5.719570235790516e-02; +2.865295968098099e-02   +6.727860352221265e-02   +1.754507878698842e-01   +4.238533738999594e-01   +7.279373124668320e-02   +1.970492444960957e-01   +3.355759698870177e-01   +9.520596762845564e-03   +2.885952568675405e-01   +2.089942505392844e-01   +2.330730211190443e-02   +2.886234594762283e-01   +5.579416427164698e-02   +1.913397037018994e-01   +2.601112985196748e-01   +4.643855567060938e-01; +2.738531912105515e-01   +3.468984076160280e-01   +2.489863016665130e-01   +3.907748719561920e-01   +3.075040336842457e-01   +1.196798652682241e-01   +1.581736030877631e-01   +3.041403341288447e-01   +1.866959019052155e-01   +4.903561996670323e-01   +7.766247807714339e-03   +3.869509470884369e-01   +2.475956368694150e-01   +4.672141236063945e-01   +4.428104915543326e-01   +3.025485387395376e-01; +3.234565034982970e-01   +4.567321840837381e-01   +1.919697187831760e-01   +1.686903723263571e-01   +3.432744532262867e-01   +3.296271454398245e-01   +3.583730147443390e-01   +3.152605209407942e-01   +3.686257262816716e-01   +4.329837970395025e-01   +4.529496388915485e-01   +1.583238326797075e-01   +2.709517825440636e-01   +1.017247301872919e-01   +1.823929011198620e-01   +4.151330390694705e-01; +5.153675532135770e-01   +7.291282301447058e-02   -8.903144567160015e-05   +1.314172529781137e-01   +4.471978314995044e-02   +5.116161649943677e-01   +2.963535351673361e-01   +4.148018737936869e-01   +3.938489620832079e-01   +1.206583110502242e-01   +3.997282273451638e-01   +7.297193118337431e-02   +1.768149956562013e-01   +2.293393375803494e-01   +2.816590835959698e-01   +1.990196613350148e-01];
L2I_L1I_iGABA_netcon = [+2.418721248674126e-01   +4.597586424340782e-01   +2.326949480795713e-01   +3.784470911913995e-01   +2.480700806713725e-01   +4.076000055048249e-01   +3.668094225114125e-01   +8.971657741199199e-02; +2.870630636293530e-02   +3.401839669754018e-01   +3.950699863328935e-01   +4.107364597314132e-01   +2.494905166791041e-01   +1.946735672544612e-01   +2.287015143227515e-01   +3.138186664515172e-02; +2.409729606145690e-01   +4.083497439718969e-01   +3.570545461777369e-01   +2.428123046463551e-01   +4.723503134849398e-01   +5.438801193443957e-01   +2.800441647244319e-01   +3.064541677956167e-01; +1.559850916347888e-01   +9.892176683266773e-02   +5.014343281765030e-01   +4.418108492655718e-01   +2.386136627371900e-01   +3.441260507716407e-02   +2.145555794524140e-01   +1.970457647570713e-01; +1.372334072391606e-01   +8.863590442099349e-02   +3.594869251624290e-01   +5.425140977209645e-01   +4.838286342225043e-01   +2.792620181915419e-01   +4.090020862112191e-01   +7.528573718411645e-02; +3.147463562603592e-01   +4.348950914052990e-01   +8.476445826448460e-02   +7.990314354826039e-02   +4.809215404780209e-01   +2.799524241570449e-01   +2.942730211898822e-01   +2.252664607412835e-02; +2.211316832308406e-01   +3.994264897176543e-02   +3.941726064851030e-01   +2.973286124301759e-01   +1.966461194256563e-01   +3.838276308715378e-01   +3.612778963795818e-01   +3.842007428551763e-02; +4.909193894789499e-02   +3.631787260239962e-01   +2.838963776490853e-01   +3.021462316379969e-01   +2.977470436629475e-01   +4.778708769478257e-01   +4.949885560970913e-02   +1.926887368056084e-01; +2.187332613887941e-01   +1.401066900698949e-01   +4.822661054600549e-01   +8.668622380379234e-02   +2.107932861502617e-01   +1.304524642277460e-01   +4.885297626079096e-01   +1.244465138269025e-01; +1.615067206510940e-01   +3.085682292428758e-02   +2.038196989889430e-01   +3.835776873603627e-01   +2.110717005931137e-02   -6.047494043844114e-02   +1.913458710849400e-01   +1.316816698963456e-01; +2.519249751335915e-02   +1.796827990926009e-02   +2.960890649679395e-01   +1.608425572095772e-01   +1.912963113072160e-01   +5.362832677312630e-01   +7.552699265928503e-02   +2.921032581932044e-01; +2.418167466356306e-01   +3.656438700197059e-01   +4.411500173807340e-01   +1.141554259502119e-01   -3.014626611453117e-02   +5.568170174112799e-01   +1.076512599757704e-01   +2.575197196222446e-01; +3.103121215968398e-01   +9.266566958555120e-02   +1.953348637570522e-01   +2.139591421848117e-01   +7.553762263757224e-02   +3.355915593582978e-01   +5.707418008271451e-03   +1.811356065103892e-01; +1.176261614285201e-01   +1.538173399044342e-01   +3.726831245657823e-01   +4.584366567503123e-01   +4.358746591541002e-01   +3.325671592058879e-01   +2.798824286738236e-01   +2.437483929022634e-03; +2.521482032482316e-01   +4.413922952962123e-01   +5.602526681564546e-01   +3.138098173177773e-01   +4.079128604116501e-01   +1.036805723639552e-01   +1.834054073168218e-02   +4.708587830937170e-01; +4.634970961971301e-01   +3.053059639673781e-01   +5.061604068022554e-01   +4.343793038002186e-01   +1.370278413864361e-01   +5.157229154350156e-01   +3.043534863419037e-01   +2.784978250528969e-01];
L1I_L2I_iGABA_netcon = [+3.726921787708578e-01   +4.064855427479733e-01   +1.101382342792183e-02   +5.200859391738568e-02   +5.348949721348202e-02   +3.251070953508560e-02   -4.227721285573836e-03   +1.874832686320888e-01   +2.026286688350841e-01   +2.598152544857563e-01   +4.723643924509617e-01   +4.222221323527252e-02   +2.923559066314404e-01   +2.605465298909064e-01   +3.524663535706266e-01   +5.105673329980671e-01; +2.376243773241765e-01   +1.984465990892094e-02   +5.366055930061963e-01   +2.706753930980540e-01   +3.892044698908343e-01   +1.536643345399733e-01   +4.974405268582143e-01   +4.355469876412420e-01   +2.696845520838419e-01   +1.874650522752722e-01   +5.125986168791247e-01   +4.043235802516472e-01   +3.027797284336747e-02   +1.901803971691765e-01   +4.160773689848885e-01   +2.951850460569317e-01; +4.990045250544553e-01   +3.129991215849942e-01   +2.099164825452302e-01   +4.786829500894392e-01   +1.178193971271617e-01   +2.464499906062939e-01   +3.508128434325370e-01   +2.744960806466831e-01   +2.838327837398723e-01   +4.212001179707197e-01   +3.270590421806538e-02   +3.588308552273266e-01   +3.479037381792328e-01   +4.222026788842052e-01   +7.573031322288373e-02   +2.102491826091795e-01; +8.279070150545353e-02   +1.491011209034932e-01   +7.493922182470972e-02   +2.434336876476647e-01   +8.489071566919676e-02   +1.548207930692743e-01   +4.176019832578483e-01   +4.135967644009445e-01   +1.177790469269955e-01   +2.689114646532807e-01   +5.052426714462700e-01   +3.400499503375302e-01   +2.202659051301833e-04   +4.504844097103373e-01   +3.428002371104906e-01   +4.915083343601908e-01; +4.628184417736785e-01   +5.472896429361739e-02   +2.738030734285847e-01   +2.365212047123394e-03   +3.940165414409048e-01   -3.870375449960418e-02   +3.306585637605142e-01   +2.211766465206113e-01   +3.848028487316028e-01   +1.854185787912881e-02   +3.987603219330094e-01   +4.640545600837669e-01   +1.114250876760763e-01   +1.621927129792416e-01   +1.409258507109344e-01   +1.940350106108966e-01; +3.113807627102848e-01   +1.413791429975561e-01   +1.104195020630979e-02   +3.394079717868301e-01   +3.265544699083004e-01   +2.752232583336949e-01   +2.919919040806931e-01   +5.077204579600717e-02   +1.084497938007081e-01   +1.975927116831579e-02   +2.169014852623539e-01   +3.817678767797148e-01   +1.155241716281742e-01   +4.040825210950782e-01   +2.747173108909031e-01   +1.663339621432147e-01; +6.843091063073888e-02   +5.112361187554709e-01   +7.065976381837050e-02   +3.525719842128999e-01   +2.443688744725691e-01   +5.435104638063067e-01   +4.269268422297965e-01   +1.598825453413220e-01   +3.113589761511840e-01   +4.362993472700093e-01   +2.710299082964512e-01   +8.643704368000506e-02   +1.507190088862347e-01   +5.071283837900122e-01   +1.549995896101039e-01   +5.125904414671741e-01; +4.898729567508590e-01   +1.930677749385323e-02   +1.913594302206698e-01   +1.564183456623656e-01   +7.761099150454417e-02   +4.505999392674452e-01   +1.287983010648475e-01   +2.703576528807525e-01   +1.808285789221905e-01   +7.545983884966978e-02   +1.608301772489387e-01   +2.945949493431889e-01   +3.231421296536111e-01   +7.382039665139312e-02   +7.943374573090869e-02   +1.215234079002625e-01];
L2E_L1E_iAMPA_netcon = [+1.095256925809340e-01   +3.088572790732313e-01   +1.633130889703604e-01   +2.828847581294798e-01   +4.369838137779850e-01   +2.224070972073397e-01   +1.446361485138260e-01   +3.660547762547783e-01; +5.005847514163573e-01   +3.786837139622757e-01   +1.830452025079310e-01   +4.527909893277889e-01   +4.601592670021107e-01   +2.443292887178838e-01   +9.215455491048945e-02   +2.141415673692574e-01; +3.516513818918434e-01   +4.377292465201966e-01   +4.197232087583531e-01   +4.600822639416025e-01   +4.332179829172557e-01   +1.302925239473441e-01   +3.378283644542621e-01   +1.168779075183255e-01; +9.002336825371642e-02   +1.035457781714673e-01   +3.795094606959279e-01   +3.346913268571788e-01   +1.135175233307047e-01   +8.557294314936834e-02   +1.913381305045492e-01   +2.142675828051966e-01; +2.038466910365598e-01   +7.756634316978249e-02   +4.308814917056291e-01   +4.160547875534450e-01   +4.736803387649018e-01   +3.264460369518034e-01   +4.435811008929243e-01   +2.832593447547807e-01; +3.817840980849387e-02   +5.288705468647095e-01   +6.728482957265944e-02   +1.991211941511083e-01   +4.780006852266364e-01   +3.535934620442364e-01   +8.920748742322800e-03   +3.838831466158681e-01; +4.788525388654807e-01   +4.025735075462065e-01   +3.346837016444201e-01   +2.276906546692012e-01   +4.451348527479488e-01   +1.971946855794342e-01   +2.847045014912307e-01   +4.828517759209607e-01; +3.871931869872910e-01   +4.190187705254828e-02   +2.156872597406050e-01   +3.034630151428735e-01   +2.959906578297317e-01   +1.219585233632502e-01   +4.053141465698934e-01   +3.776355568876975e-01; +4.674461775619256e-02   +1.322707813054071e-01   +3.176835586668896e-01   +1.131812444613402e-01   +3.465308482294033e-01   +3.846785064597118e-02   +2.093454337848038e-02   +3.218211135613933e-01; +1.616609109892137e-01   +1.714145281086411e-01   +2.629778954564398e-01   +5.288345171210574e-01   +1.066603957208430e-01   +3.776719011990018e-01   +2.777765980688313e-01   +2.081088143632999e-01; +4.067108059338860e-01   +3.786086723027292e-02   +2.984756112841064e-01   +5.596571522027735e-01   +3.771025851982311e-01   +2.708670745042847e-01   +7.338812056491456e-02   +4.444907636726883e-01; +7.274112614399954e-02   +1.901841328041494e-01   +5.608419926950040e-02   +2.227537012078134e-01   +4.095845912894083e-01   +4.859997853833556e-01   +1.955717095470003e-01   +3.091258930996150e-02; +3.331032498100643e-01   +2.018573491381618e-01   +1.635369562751045e-01   +4.631075214520148e-01   +2.674911655753049e-01   +2.811282530436518e-01   +1.513517544134189e-01   +2.093163048035708e-01; +4.860846711318136e-01   +1.714129888156481e-01   +2.095967629444954e-01   +3.345381865075525e-01   +2.644029546945764e-01   +8.894185260587001e-02   +2.387320227753834e-01   +8.332835271832939e-02; +2.187707613734913e-01   +2.023272594698624e-01   +1.913794714221636e-01   +1.892045119008572e-02   +2.867356153271239e-02   +1.554988245805159e-02   +5.330491567813070e-01   +2.181766559200592e-01; +4.388453195063057e-01   +4.887589593202957e-01   +4.522898897861430e-01   +3.817707080157319e-01   +4.900534418470198e-02   +7.111105641964501e-02   +1.312882907026210e-01   +4.815218348366855e-01];
L1E_L2E_iAMPA_netcon = [+4.674081831702310e-01   +3.004600566598212e-01   +1.983895289458006e-01   +1.451213561409572e-01   +2.383587288606725e-01   +2.427011720599545e-01   +1.539251246425079e-01   +3.305091469480070e-01   +1.890594831549472e-01   +4.290169857304077e-01   +5.233778725568198e-01   +3.499474922293663e-01   +8.411369781799434e-02   +5.999781830787782e-02   +1.489537057950630e-01   +4.213734055024385e-01; +5.317399154710518e-01   +4.639063869095700e-01   +4.118597710615084e-01   +1.715333952110490e-01   +3.071884182603992e-01   -3.673473366645245e-02   +1.362756945552272e-01   +3.471859799260809e-01   +1.087974824132900e-01   +3.376701580445391e-01   +4.421553546940685e-01   +2.906073917033564e-01   +3.710172812918761e-01   +4.581240201961460e-01   +4.486394125517471e-01   +1.377241511199815e-01; +4.745166749571327e-01   +4.316987114707038e-01   +1.279290878188671e-01   +2.314172123105109e-01   +4.498168991883546e-01   +3.063487951210688e-01   +4.173179173716665e-02   +2.859808798924182e-01   -1.170854443504961e-02   +4.206755529803994e-02   +4.560367590696847e-02   +4.182249957897214e-01   +4.210880820789178e-01   +1.791507612863188e-01   +4.278645624497402e-01   +7.191041711229580e-02; +1.511200439298370e-01   +2.747144541186838e-01   +1.111865507094579e-02   +4.575121593422909e-01   +2.071597270155108e-01   +4.858130311439933e-01   +2.699879327140060e-01   +4.400765697589886e-01   +4.792134162791175e-01   +7.933566061358045e-02   +2.353989334942783e-01   +8.040114929184373e-02   +2.467773621387392e-02   +8.544649609444788e-02   +4.759883079058753e-01   +3.770425599374747e-01; +4.688006883668775e-01   +4.376611105864139e-01   +4.872881861534715e-01   +4.314127191315218e-01   +2.367829559994277e-01   +1.710625837757506e-01   +1.399362963921040e-01   +1.957499085281430e-01   +2.542335139782431e-01   +3.025024886199515e-01   +3.020350006208752e-01   +2.772496850717539e-01   +1.819776994199436e-01   +2.478382233283493e-01   +4.500215127856759e-01   +1.640412826288378e-02; +1.939509572050396e-01   +3.259243168754374e-01   +4.946899125255187e-01   +2.845170573632624e-01   +5.735784911921483e-02   +6.042910203961188e-02   +3.436827645913131e-02   +7.616256363135905e-02   +2.743136998957098e-02   +3.673076088057594e-02   +8.103867171717359e-02   +7.687943496020547e-02   +4.563926893987851e-01   +4.852373203479747e-01   +3.915807082104769e-01   +1.779752919653796e-01; +2.672498405777226e-01   +9.698610426432575e-02   +2.080027229542539e-01   +6.776184685927039e-02   +4.828614269796738e-01   +4.828528253201498e-01   +3.753474228020067e-01   +4.191892902926000e-01   +2.584442833570650e-01   +2.470201191669887e-01   +2.459253464091591e-01   +9.869335287023367e-02   +9.720514367161071e-02   +1.526372140947471e-01   +1.678616142858948e-01   +1.726967541194921e-01; +4.264468206498392e-01   +1.918060165298751e-01   +2.410343840531634e-01   +3.336127364470001e-01   +4.360818823516958e-01   +4.741528753250588e-01   +1.767249932006523e-01   +2.070851178982524e-01   +4.016644030141527e-01   +6.088039692688023e-02   +1.511212788238441e-01   +3.594051157804147e-01   +8.336716770093025e-02   +3.266559751295657e-01   +2.987341979675672e-01   +2.994437973507872e-01];
L2I_L2E_iAMPA_netcon = [+4.375821343266506e-01   +2.661719748594508e-01   +4.003596836314275e-01   +2.403295382068383e-01   +1.232536103875270e-01   +3.058535812704423e-02   +5.851188837696919e-02   +2.812840563565176e-01; +4.191608151979920e-01   +2.764274746301727e-01   +4.487881783239514e-01   +1.410850067321251e-01   +3.016699686343522e-01   +5.389745245568937e-01   +3.375224538131173e-01   +1.781512484123541e-01; +4.091646790280995e-01   +2.438976147924276e-01   +3.185199551586679e-01   +4.734642701442288e-02   +3.314598556174673e-01   +1.894894148075751e-01   -2.797411643395826e-02   -6.791889686212231e-02; -2.914637392489527e-02   +2.092191352442650e-01   +4.425958235459390e-02   +4.790595449176800e-01   +3.265123618227373e-01   +3.243837452451356e-01   +1.813518094015263e-01   +7.320478290012243e-02; +2.374327275452611e-01   +2.533637027949308e-01   +3.691203504267541e-01   +5.175108490735512e-01   +1.562672487644845e-01   +1.702877606536908e-01   +3.882443550159569e-01   +2.821656613044695e-01; +1.128513773154192e-01   +3.161461889224724e-01   +2.065526724118432e-01   +2.174309330000597e-01   +1.155986430451845e-01   +2.667049537212274e-01   +2.214637138424752e-01   +3.325216037547652e-01; +5.083364137677686e-01   +1.396223340634400e-01   +4.595347216578559e-02   +3.631788392864478e-01   +1.228965046245943e-01   +9.826441858501757e-02   +2.780194477506515e-01   +1.032009703902512e-01; +1.979984828609860e-01   +2.603800150346612e-01   +4.128496765483409e-01   +4.311970713607707e-01   +3.884309651831797e-02   +4.312118081756507e-02   +2.143069891252461e-01   +4.847053198058957e-01];
L2E_L2I_iGABA_netcon = [+5.063336672874649e-01   +2.594199826542156e-01   +3.692760927974059e-01   +3.105699814711916e-02   +2.038601814491226e-01   +5.054178969763243e-01   +3.394962625989548e-01   +2.589071781874699e-02; +1.882005751502268e-01   +4.630965933336265e-01   -2.238104839836767e-02   +1.815920312583341e-01   +3.464331144941480e-01   +2.194587056324970e-02   +3.248081935029176e-01   +8.645275241647395e-02; +3.875242748683979e-01   +1.585123941355261e-01   +4.558901339654676e-02   +5.323028889955782e-01   +1.798183151035476e-01   +2.455879208933490e-01   +4.330929661796762e-01   +6.483753150849020e-02; +3.771654465714385e-01   +3.627700473785694e-01   +4.070898833705305e-01   +6.881663858837467e-02   +9.033639665813475e-02   +1.869651078025648e-01   +4.207356187241120e-01   +3.834415841317415e-01; +2.538575820039721e-01   +2.013641584511860e-02   +4.021107065427804e-01   +2.564187073647630e-01   +2.003390744825392e-01   +4.952345128490602e-01   +1.650095115847331e-01   +2.113538842381247e-01; +3.183683836234006e-01   +2.299472841644800e-01   +1.222854021198371e-01   +3.346123055527594e-01   +2.859624221598988e-02   +5.108976059801488e-01   +2.404813498755555e-01   +2.250810936116793e-01; +3.307079781113155e-01   +3.707708097766573e-01   +4.359091331060676e-02   +1.507762776407533e-01   +2.771718060948166e-01   +4.271313063962153e-01   +1.169700390578941e-01   +3.480592876465800e-01; +1.179545327450499e-01   +3.278654863327514e-01   +1.319742987500248e-01   +7.311598851008486e-02   +8.496489366756925e-02   +4.242530955640137e-01   +2.626032274988138e-01   +2.974275102425874e-01];
L3E_L2E_iAMPA_netcon = [+2.634125554573726e-01   +7.551233169485357e-02   +3.429105754585150e-02   +5.296950757777141e-01   +4.110990091576412e-01   +5.077485281884959e-01   +2.953803095419678e-01   +1.096051687855568e-01   +4.567258324332614e-01   +1.533566239111953e-01   +4.859772407165477e-01   +1.380608793646045e-01; +2.083522952064226e-01   +4.788730460746020e-01   +4.634792950751580e-01   +3.465665629422751e-01   +2.525581397506846e-01   +1.259595766028601e-01   +3.607720789479402e-01   +1.982690895037715e-02   +9.892826309354929e-03   +3.677775849620393e-01   +2.707851984845981e-01   +4.124955535921682e-02; +1.583137913747105e-01   +3.546184466969362e-01   +2.794290095084269e-01   +7.506915039205296e-03   +2.233456839008066e-01   +4.659462121148296e-01   +1.730989501643669e-01   +2.629957707067702e-01   +3.490274165561139e-01   +4.465489761718275e-01   +3.973955236259019e-01   +6.033018273649800e-02; +2.622667376035246e-01   +1.470881857148278e-01   +4.493590630017437e-01   +6.726132933592091e-02   +1.701294733282091e-01   +2.477857044399417e-01   +5.055789514257630e-01   +4.987818509084602e-02   +1.547608864430699e-01   +3.955661163054310e-01   +2.552920572125131e-01   +2.333308733486435e-01; +1.464256108259842e-01   +3.776057955664101e-01   +5.117473179845739e-02   +4.715531697213769e-01   +3.305920257656645e-01   +3.342202598484447e-01   +4.854856223448202e-01   +6.053506532385272e-01   +1.296463644661142e-01   -5.609579312571260e-03   +3.464412717896523e-01   +1.845644532885380e-01; +2.185323756770478e-01   +3.839338916710561e-01   +7.794536893380222e-02   +4.557434526760321e-01   +1.334854840082320e-02   +3.642578629515261e-01   +3.307886072498600e-01   +4.786171963472257e-01   +5.003667807566466e-01   +2.749673707862927e-01   +8.849102955051236e-02   +2.615954249254953e-01; +4.633072675320581e-01   +3.713434827246401e-01   +4.082110741568835e-01   +1.777311283309468e-01   +4.019232334356939e-01   +2.479270913671042e-01   +4.791441293981802e-01   +4.234073946995203e-01   +8.362653896847223e-02   +3.271416603394420e-01   +3.828912953007313e-01   +2.715903091045492e-01; +2.111449276021912e-01   +7.587776557265956e-02   +2.607122113425994e-01   +1.530204339627238e-01   +2.720996790815171e-01   +1.620799002307262e-01   +2.435906199406579e-01   +2.472949918187252e-01   +3.877852958223555e-01   +4.026457762186270e-03   +3.044708362148184e-01   +2.895758138272248e-01];
L3I_L2I_iGABA_netcon = [+1.375599949959237e-01   +2.334721926788970e-01   +2.122051210758924e-03   +5.358583511936115e-01   +2.788497813841070e-01   +1.249108961883741e-01   +3.956102497626394e-01   +2.702767813529689e-01   +2.550964222413729e-01   +6.297884469833884e-02   +2.475686232041664e-01   +3.287372942634150e-01; +9.889211663706023e-02   +3.903827022400403e-01   +5.482370493570765e-01   +5.189422566983142e-01   +2.150918236708216e-01   +2.490965596426482e-01   +3.469937875141125e-01   +4.171693826394846e-01   -6.268480085813398e-02   +4.061351175584101e-01   +5.367127638035427e-01   +1.576640857506906e-01; +1.879741414603967e-01   +2.919117975910099e-01   +3.482768860356910e-01   -1.212490624938958e-02   +1.252456100818106e-01   +4.216588134593774e-01   +3.246482423684430e-01   +4.688116506495164e-01   +3.202876432479626e-01   +6.929375900587567e-02   +1.338555932138454e-01   +3.326548407501326e-01; +2.315415248750871e-01   +2.382504120706478e-01   +1.151363086461160e-01   +3.357955320711701e-01   +2.810130914203302e-02   +1.415851133964871e-01   +3.252873484931899e-01   +5.058279734992976e-01   +3.267667332332724e-01   +5.484228464661813e-01   +3.326920319653447e-01   +1.011007787435077e-01; +2.080538392321685e-01   +3.277198691562176e-01   +3.184175004558218e-01   +3.794637219474263e-01   +9.122080098726454e-02   +4.731052368385060e-01   +3.304019689955964e-02   +3.453641642975308e-01   +2.207645563502219e-01   +2.360551434412898e-01   +4.173596984771261e-01   +4.379309970178391e-01; +3.989442049337226e-01   +4.762468695178184e-01   +1.693830052050398e-02   +2.896497191515595e-01   +5.247541173196894e-01   +1.092638838407811e-01   +4.079942332633174e-01   +4.729416895877085e-02   +2.543472189115781e-01   +1.992929223263445e-01   +1.238317292358893e-01   +1.923267351525394e-01; +2.702743401132180e-01   +1.439053836764649e-01   +3.341449877198161e-01   +4.787006933513536e-01   +7.119776269279410e-02   +2.861932811906253e-01   +2.408341709760576e-01   +5.366611087308049e-02   +4.612208279255879e-01   +2.564544894734722e-01   +1.117621152132728e-01   +3.705506691172106e-02; +2.965574353885614e-01   +1.987474509645539e-01   +1.230470033812249e-01   +2.452662666687067e-01   +3.783440119984711e-01   +3.694200270038420e-01   +4.398274325284043e-01   +2.190977797223256e-02   +3.630160974039535e-02   +4.421038027389047e-01   +1.770035292729723e-01   -1.370755478474418e-03];
L2E_L3E_iAMPA_netcon = [+2.701582183967856e-01   +2.251789821909509e-01   +1.993508365168480e-01   +3.304860792855539e-02   +1.747216275662876e-01   +5.384654270721014e-01   +9.438704943158616e-03   +9.689204362610809e-02; +5.152878730075171e-01   +1.543175585568536e-01   +6.057274860822796e-02   +1.433251268215796e-01   +3.784809057083092e-01   +1.975040580607677e-01   +8.606313484687458e-02   +3.299692860503382e-01; +1.695517518438089e-01   +4.399557849537993e-01   +2.553920716358942e-01   +2.036852159719041e-01   +5.341082033184891e-01   +4.362864075897339e-01   +3.390724316463679e-01   +3.875822466677195e-01; +3.359125322585716e-01   +2.869274015672616e-01   +2.749001184970791e-01   +4.173788450758316e-01   +4.391681286595754e-01   +4.072614613043911e-01   +4.054358395191194e-01   +3.772352723692662e-01; +1.700982994023866e-01   +3.569316959397222e-01   +2.395898876002884e-01   +3.387396836821355e-01   +1.547413890582510e-01   +3.926571942736164e-01   +1.672816982429531e-01   +1.416784105399886e-01; +4.301519074493859e-01   +1.309487284169472e-01   +4.625046802271799e-01   +4.927925987076425e-01   +1.248071352013605e-01   +2.844371277753230e-01   -1.134906227701803e-02   +9.826019426491762e-02; +3.342666676439013e-01   +4.343661952213494e-02   +2.294812423953131e-01   +1.431736227111104e-01   +2.296075531868430e-01   +2.389069948869794e-01   +1.521979856345951e-01   +2.160592884959442e-01; +1.830892132699068e-01   +3.685045933201991e-01   -1.867619593604152e-03   +2.471067169264844e-01   +6.832826157535769e-02   +2.780443099355614e-01   +2.542198933910999e-01   +2.823899189710063e-01; +1.022113818909826e-01   +2.547545776529402e-01   +3.939813518800450e-01   +2.179857502851252e-01   +2.329541184584358e-01   +3.827707444877012e-01   +5.019738330287177e-02   +2.528722466628762e-01; +2.879410201312410e-01   +3.792487691622084e-01   +4.244437828081288e-02   +3.373818865294343e-01   +2.586522881936704e-02   +1.781647119652675e-01   +1.475346851649183e-01   +1.472803323908474e-02; +2.003318364429544e-01   +4.842425448819291e-02   +3.774742822485219e-01   +9.074659428650052e-03   +1.468470523086183e-01   +7.671792993304952e-02   +2.464982430655126e-01   +2.962498026704111e-01; +4.460406450905709e-01   +4.156304612239213e-01   +2.677078789968271e-01   +4.300271044241028e-01   +4.032222772882817e-01   +4.536682988912822e-01   +2.551965351736413e-01   +4.104376046378920e-01];
L2I_L3I_iGABA_netcon = [+4.363817244189691e-01   +2.828927530945023e-01   +3.261700772672547e-01   -1.982226273795745e-02   +1.019445010620212e-01   +5.278284590119393e-01   +4.556851610294183e-01   +2.890178421436729e-02; +1.317321284381086e-01   +5.947112240756729e-02   +2.674207863602611e-01   +4.790155832293336e-01   +3.563809189534270e-01   +4.284180946855560e-01   +3.117005755625415e-01   +3.760188508163237e-03; +3.682377240317209e-01   +1.164583234826799e-01   +1.829307235426650e-01   +2.016531457484850e-01   +4.650284323727374e-01   +3.438722652826517e-01   +1.016801324085715e-01   +6.442988266369808e-02; +1.665048689999255e-01   +3.017395631249376e-01   +5.002127532882470e-02   +9.318683640287408e-02   +3.512418680594286e-01   +5.199986445602506e-01   +2.696032340928584e-01   +1.595037690631886e-01; +2.495531335087878e-01   +2.564572255701058e-01   +1.000278765039726e-01   +3.203698636274816e-01   +7.807311931205135e-02   +2.205587679514733e-01   +1.157945544370123e-01   +2.457413025111904e-01; +3.133200969045730e-01   +3.383087334752052e-01   +4.264547262867159e-01   +3.684811996280898e-01   +1.995114968958250e-01   +2.796354441656493e-01   +4.859709931370598e-01   +1.673887773445402e-01; +1.612183630281494e-01   +1.398832373847320e-01   +2.431073916369826e-01   +3.712984452187459e-01   +2.974772556080046e-01   +1.889978696549693e-01   +2.143029890897311e-01   +3.303531464442681e-01; +3.265569623683512e-01   +4.222339772077767e-01   +4.524214657404967e-01   +5.213469051652705e-01   +3.774352202303105e-01   +7.696238297589686e-02   +2.773760537911067e-01   +3.679413735494545e-01; +4.177915298958209e-01   +3.082718681376756e-01   +1.503434476771169e-01   +4.714534551690054e-01   -3.179858394347386e-03   +1.291508957237376e-01   +1.623913910163578e-01   +4.193436992968450e-02; +4.946489824748272e-02   +1.870658472244170e-01   +3.499815828014022e-01   -8.988753281088849e-03   +2.612024653117310e-01   +4.164847952926786e-01   +5.123221423823818e-01   +5.209585846442566e-01; +4.157581620645436e-01   +1.454073539736790e-01   +3.963168631437511e-01   +2.587625958461947e-01   +4.620773368642964e-01   +2.966675946449563e-02   +2.473119621608542e-01   +1.742753133913772e-01; +6.398795011389212e-02   +3.035844549371698e-01   +4.529858921508960e-01   +3.691598381079695e-01   +5.141604404225681e-01   +2.285363180069578e-01   +4.270650735046738e-01   +4.899343154789200e-01];
L3I_L3E_iAMPA_netcon = [+1.730522103394198e-01   +8.377607068084858e-02   +3.354886480213598e-01   +3.025357764322766e-01   +2.535236308960022e-01   +1.723052272558707e-01   +2.661377475360186e-01   +1.676903851183285e-01   +4.119295722126716e-01   +4.442673210012189e-01   +1.965536652475007e-01   +4.035348125455693e-01; +2.494859001365434e-01   +5.311507804710471e-01   +1.714807101897748e-01   +3.500394788737297e-01   +4.219970410295610e-01   +7.628086518185812e-02   +2.494350485605593e-01   +1.043444474338719e-01   +2.891754515118969e-02   -6.027074932436638e-03   +3.329039985218901e-01   +2.428347124834691e-01; +1.083189685742011e-01   +2.051418100380492e-01   +5.538204293851996e-02   +2.427670264585932e-01   +3.116429869128361e-02   +3.793867993736013e-01   +4.260651647787836e-01   +4.423702235837157e-01   +2.248312134597327e-01   +3.615850614350702e-01   +2.474708247556494e-01   +2.409278587562404e-01; +4.509767790214065e-01   +3.738961927434612e-01   +4.747265439378692e-01   +3.066351756228182e-01   +3.855883261577193e-01   +3.245966829512044e-01   +9.644902286675766e-02   +5.004898625254452e-02   +4.133163399382601e-01   +3.779859828141647e-01   +3.437202390886012e-01   +5.020818241710036e-01; +4.845388451868554e-01   +3.930287121869122e-01   +6.036628304696787e-02   +3.991486272248270e-01   +4.453187521404453e-01   +1.612345460174871e-01   +2.423574285451177e-01   +2.298399998805588e-01   +4.455857039591086e-01   +5.634169002173909e-01   +4.298289476019926e-01   +3.354823966483041e-01; +5.830086694408744e-02   +4.324873454827585e-01   +1.088412782762364e-02   +1.909837197970652e-01   +4.167986670347022e-01   +1.532651550950085e-01   +2.358532335904098e-01   +6.624817576662669e-04   +4.774827703119132e-01   +2.519853433840399e-01   +8.112481561554644e-02   +3.721172331320508e-01; +2.337752854389397e-01   +1.185547573073658e-01   +6.074416294527187e-02   +4.346629485822186e-01   +6.497459784751415e-02   +1.845656601408603e-01   +4.477707539623327e-01   +4.719340367037844e-01   +4.111451877939741e-01   +1.243292836770664e-01   +4.053634509146410e-01   +3.635984779598329e-01; +2.261452715385886e-01   +4.041544909820817e-01   +1.305780417605081e-01   +3.257992251512848e-01   +5.518295281901191e-01   +5.264384984478359e-01   +1.973676705721393e-01   +5.082679861837009e-01   +3.229689750143910e-01   +2.394491784457199e-01   +2.662319977096851e-01   +1.581730297176718e-01; +1.174012490776908e-01   +4.627120864169896e-01   +1.666161240961934e-01   +4.940140616394931e-01   +4.323499892299179e-01   +3.725582726704710e-01   +9.084826241347695e-02   +1.040175728869487e-01   +4.277311185676321e-01   +2.573787382441111e-01   +3.474063714622690e-01   +1.932546511726138e-01; +4.296159701764905e-01   +3.016334108897117e-01   +3.156695146515984e-01   +3.089070264497442e-01   +3.565151810663344e-01   +1.621071321837704e-01   +2.666704276519241e-01   +4.235106528138028e-01   +2.583806974328555e-01   +4.885191024443424e-01   +1.449834598988702e-01   +2.238768580261884e-01; +3.330840904432893e-01   +1.815058777977391e-02   +1.966967213044832e-01   +1.693790888117291e-01   +2.872022344219537e-01   +6.353646239946345e-02   +2.559174318457554e-01   +4.799243042585215e-01   -5.389287404153172e-02   +9.442143924823150e-02   +9.149044323191051e-02   +2.280373073395646e-01; +3.209744737774212e-01   +2.105474494104922e-01   +4.884420729031316e-01   +1.199296532422244e-01   +2.644999505241308e-01   +3.420597087711100e-01   +1.153113378620019e-01   +3.136513265351237e-01   +8.309836270229042e-02   +3.522668677563505e-01   +2.325198948213441e-01   +1.208570646481687e-01];
L3E_L3I_iGABA_netcon = [+2.393395987407388e-01   +4.325363828870337e-01   +4.036957901388429e-01   +1.255687645887634e-01   +1.461071716499644e-01   +5.012503335367515e-01   +4.647508477177575e-01   +3.839941326990738e-01   +2.419199134980394e-01   +2.723592960838779e-01   +8.134234217996966e-02   +2.571268468929144e-01; +2.387302195217196e-02   +3.013529890090195e-01   +9.903488892358768e-02   +6.522734144746867e-02   +1.650480944742015e-01   +4.428973347668261e-01   +3.966260403318378e-01   +2.235366048091328e-01   +4.286091780617113e-01   +2.853742254335355e-01   +2.824631941269246e-01   +4.018573829879206e-01; +2.785802075303738e-01   +4.754406267578171e-01   +4.474402402169915e-01   +4.320669707793601e-01   +3.785826401242955e-01   +8.992774900800887e-02   +2.217078172178523e-01   +2.676516181592732e-01   +3.241815121673151e-01   +4.211064924083690e-01   +3.369790920262676e-01   +4.750715354763831e-01; +4.333692454479331e-01   +3.873874681767804e-01   +2.476510395328271e-01   +2.180199292984947e-01   +2.473120201500256e-01   +1.652497285049331e-01   +2.205880693248444e-01   +4.440292898917856e-01   +1.503680067630035e-02   +2.453776881273191e-01   +3.330378823350470e-01   +7.235120312564344e-02; +6.503418695079696e-02   +2.735013917981073e-01   +5.674513680392544e-01   +5.312019262189160e-04   +3.441642511230038e-01   +1.260559965771905e-01   +1.076908931763431e-01   +4.102378399370599e-01   +5.368417452708333e-01   +4.609161038028486e-01   +9.731328588520355e-02   +3.842024586017527e-01; +4.297659394115527e-01   -1.836064272272761e-02   +4.572887092292377e-01   +2.151506760478365e-01   +7.536909115779634e-02   +1.106633546015236e-01   +2.487540919296732e-01   +2.606294430787085e-01   +4.934961416063718e-01   +2.334323231285472e-01   +2.859764530234721e-01   +4.912454948699774e-01; +3.475513956163829e-01   +3.398523333570784e-02   +3.050291698537089e-01   +2.541577009368858e-01   +5.608932173779930e-01   +1.761234377914139e-01   +6.776783749884584e-02   +2.799205495560463e-01   +3.942681951292576e-02   +1.075866559274893e-01   +3.431367270944688e-01   -5.833354914608260e-04; +4.572020555496975e-01   +8.988971308430738e-03   +3.648279790342026e-01   +8.620304515091042e-02   +3.960954903929607e-01   +4.024628567574182e-01   +2.488573802925740e-01   +3.756777154318476e-01   +2.141114156425998e-01   -4.063626431919176e-02   +3.486567833257364e-01   +2.169070897067684e-01; +2.917769738585965e-01   -3.833156956518924e-02   -5.427549933586001e-02   +1.781630888359562e-01   +1.772180029289283e-01   +4.261465995923082e-01   +4.330164816740251e-01   +2.383503153335748e-01   +2.583859130642225e-01   +4.704976615783188e-01   +1.677566866158842e-01   +5.015361375746252e-01; +1.070312200176964e-01   -2.087028802222916e-02   +2.783706856956446e-01   +3.695350835123616e-02   +2.346730030271420e-01   +2.251898840648804e-01   +3.912684175601465e-01   +9.965733797795968e-02   +2.758472923260177e-01   +1.448107546737891e-01   +1.771574123368336e-01   +4.640826097844168e-01; +2.044633232655188e-01   +4.087645245206235e-01   +2.114576829170163e-01   +3.001026921685059e-02   +5.308896050216633e-01   +1.859238256593043e-01   +1.461841130652868e-01   +2.044078259239029e-01   +2.894309805190611e-01   +3.798886087192146e-02   +2.449888711140499e-01   +2.221061473344819e-01; +5.658683951176859e-02   +1.287035539167706e-03   +2.165183891023475e-01   +9.450548499740061e-02   +4.081746895869168e-01   +2.311369351436117e-01   +2.131354254449129e-01   +5.500920068857463e-01   +3.226727527314237e-01   +2.727487641673374e-01   +6.380199590002678e-02   +6.012295819985402e-02];
L2E_Input1_iAMPA_netcon = [+1.657083319284617e-01   +2.138071904286885e-01   +2.124103432556059e-01   +5.084232405295727e-01   +4.869378969819370e-01   +2.670767593492773e-01   +2.436153859363364e-01   +3.574353871020537e-01];
L2I_Input2_iAMPA_netcon = [+1.963539846343785e-01   +7.473813568579750e-02   -1.129091425996585e-02   +1.891492095600694e-01   +3.674806240000340e-01   +1.685576800635308e-01   +1.773200914703358e-01   +6.448906541408805e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
