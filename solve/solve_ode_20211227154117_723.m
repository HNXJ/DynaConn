function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.744701429078858e-02   +6.573936929298578e-02   +7.971950504252978e-02   -7.103268365065855e-03   +1.112888589039746e-01   +4.493206228022711e-03   +6.358865440418243e-02   +8.116403323613229e-02   +1.727135745897666e-02   +8.963934573150062e-02   +1.986297966461517e-01   +1.451084788913745e-01   +3.665502587981730e-02   +7.635188579663182e-02   +1.337912323057475e-01   -1.237967039074183e-02; +2.314897815906249e-02   -2.289644866835269e-02   +4.592436749544242e-02   +1.546969153206794e-01   +1.031069885933356e-01   +1.485706574264644e-01   +4.272186099494075e-02   +1.092297264256398e-02   +4.465116474513749e-02   +4.719556169994396e-02   +6.371229442070415e-02   -2.171739435085872e-03   +1.453277410458558e-01   +1.017916999147589e-01   +1.160699609959533e-01   +9.595917060535443e-02; +1.396054944955180e-01   +9.752272751779406e-02   +9.251636232470535e-02   +4.131584046504549e-02   +2.219284935789715e-02   -3.253878438721704e-02   +7.647510709197829e-02   +6.250966427681029e-02   +1.569463059791970e-02   +1.699398596839823e-01   -9.047640153440334e-03   +7.686731548292065e-02   +1.902381500287805e-02   +8.372759086223321e-02   +5.330330421146687e-02   +8.909341496277010e-02; +7.379521706759146e-02   +1.326382249552845e-01   +1.217857079745543e-01   +1.202118467414098e-01   +1.003737467164729e-01   +3.932765283707397e-02   +9.405391696136248e-02   +1.379628627312865e-01   +5.133861195803692e-02   +8.479664785770150e-02   +1.492715452910895e-03   -4.876283331946521e-03   +1.391394219444969e-01   -3.996855421931305e-02   +1.259439577250782e-01   +2.603646663968099e-02; +6.684985349655738e-02   +1.463349319613566e-01   +1.852977445021362e-01   +6.542971835666607e-02   +1.426296207943481e-03   +3.319597742627547e-02   +1.502312645966762e-01   +8.711861285812608e-02   +5.793283213143836e-02   -7.065969160926500e-04   +2.416386034706923e-02   +5.598412839728435e-02   +7.440551418429039e-02   +4.598191779400072e-02   +1.072537241632965e-01   +1.611064185866445e-01; +9.193991648070203e-02   +5.181496202562089e-02   +1.521627113108642e-02   +1.487465834669331e-01   +5.238820801146243e-02   +1.233093251115706e-02   +1.022323265421729e-01   +1.863337297526606e-02   +1.257047686302722e-01   +3.934208376226361e-02   +1.161271083017893e-01   +1.828290656961955e-01   +1.167723660359360e-02   +7.336576224574134e-02   +8.119111356764742e-02   +2.626109615486414e-02; -9.351028834917417e-05   +5.442328353635086e-02   +3.586196160106081e-02   +1.341497244540935e-01   +3.975011981645238e-02   -2.134559615327938e-02   +1.111037559582033e-01   +4.618811711255693e-03   +1.348485039129670e-01   +8.112399728818259e-02   +4.930714911776005e-02   +9.094979926799647e-02   +2.535955508306724e-02   +8.550522760993455e-02   +7.756697002073287e-02   +9.071198358862788e-02; +1.062781322398898e-01   +3.587784611592353e-02   +2.226111479359360e-02   +1.754939971159798e-02   +2.461152392419457e-02   +1.721585424048349e-01   +5.371148015043778e-02   +7.609612933707943e-02   -3.981025898753697e-02   +3.670760012834363e-02   +1.183916379998050e-01   +3.498081797703637e-02   +3.878236237338498e-02   +9.717045296032686e-02   -2.747903997754753e-02   +2.392510996306102e-02; +1.252205159194487e-01   +1.928706615510658e-02   +8.141858689127410e-02   +1.088276463719037e-01   +8.396254545132911e-02   +4.014735649021534e-02   +3.165236758625980e-02   +1.678787907404652e-02   +7.653287343426081e-02   -1.272516617786484e-02   +1.443528123943326e-01   -3.606368332558852e-02   +9.121001852888365e-02   +3.956662987873968e-02   +9.042150192088037e-02   +4.297874190640316e-02; +6.130040487554522e-02   +8.800453970806121e-02   +1.020129961449716e-01   +1.212795025496282e-01   +1.487400450063386e-01   +1.692421181771777e-01   +5.901133243390038e-02   +9.340473697511436e-03   +9.336702920352888e-03   +1.312537760739869e-01   +7.041256192068349e-02   +7.622254187692711e-02   +1.648918938885974e-01   +1.000521096102348e-01   +9.271144630323129e-02   +1.829436656885136e-02; +3.553188131337202e-02   +1.091523853749116e-02   +1.010834757497089e-01   +4.005151908560424e-02   +1.931140403664210e-02   +2.152233655796098e-01   +5.241193258649244e-02   +1.313194224160924e-02   +1.347505835908249e-02   +4.040277472600647e-02   -5.134469907498235e-02   +9.468276285988386e-02   +3.703265093336837e-02   +5.123295941962283e-02   +1.034388881901884e-01   +9.290020706641222e-02; +3.742237786541187e-02   +2.947387227628206e-02   +1.891731929819195e-02   +1.324954342409612e-01   +8.595457346288128e-02   -1.065014882067944e-02   +1.296088077039215e-01   +1.335042482215493e-01   +9.345612903415210e-02   +7.004916250835042e-02   +1.263771843802264e-01   +1.155413729400361e-01   +8.550067880488299e-02   +1.181425296923486e-01   +9.591663555540425e-02   +1.261489066104095e-01; +1.974050381862670e-01   +9.925824354336080e-02   +5.816021565120321e-02   -9.491137785798310e-03   +7.436868978574278e-02   +6.729409347048920e-02   +8.080862092757239e-02   +2.109176706650753e-02   +7.510160926392677e-02   +1.475339780884995e-01   +1.336067464594949e-01   +1.504094328867443e-02   +7.943596108811714e-02   +5.948345743848744e-02   +1.140250406752092e-01   +4.232581255614271e-02; +1.162458633508865e-01   +5.878869264131074e-02   +3.657592172960401e-02   +1.327493872436045e-01   +1.655732933861042e-01   +6.163872837806691e-02   +7.772955300521527e-02   +4.917631959033346e-02   +8.171373783454848e-02   +8.551021150310018e-02   +1.329974073809606e-01   +1.592966790968510e-01   +1.361682057580009e-01   +1.585790134295550e-01   +1.705839488457271e-01   +7.403067665487179e-02; +1.065183344552988e-01   +2.242476863718056e-02   +1.331988524801630e-01   +1.494397992379238e-01   +1.115437662622989e-01   +7.826072646011050e-03   +1.052727713762908e-01   +7.081119110290508e-02   +1.100827142635846e-01   +1.103425770114744e-01   +5.708305706249954e-02   -4.450316745430839e-02   +1.227660909994322e-01   +5.171679938756506e-02   +4.237875943989313e-02   +1.228661832260946e-01; +1.741017683328238e-01   +1.221812744640645e-01   +1.143599132949672e-01   +4.269045228518707e-03   +1.177298655899692e-01   +1.176983485838736e-01   +6.185495485079082e-02   +6.823998241070053e-02   +7.757292373317870e-02   +3.805406636312575e-02   +6.832201692423528e-02   +3.834181302995698e-02   +9.160650179061341e-02   +5.156204156250864e-02   +7.714174636612167e-02   +1.443144242905518e-01];
L1E_L1I_iGABA_netcon = [+1.839908046513040e-02   +2.051239826838506e-01   +1.839903269546203e-01   +1.351143334719971e-01   +8.898285803306408e-02   +1.260834009083698e-01   +1.253758007923624e-01   +7.642757960041544e-02   +1.361713629773249e-01   +7.841555228898112e-04   +9.378093101415946e-02   +3.963942449739950e-02   +3.760815975047026e-02   +1.100677725210178e-01   +8.602647591658269e-02   +1.651644905690213e-01; +1.366939279424885e-01   +2.618400181628403e-02   +6.765190354126505e-02   +3.186655311933702e-02   -1.114529621928863e-02   +9.560053178374792e-02   +5.937996263824072e-02   +9.826725372120201e-02   -5.098526461668892e-02   -4.417948412586296e-02   +1.259159284612192e-01   +3.595496765763534e-02   +6.907629772810778e-02   +8.516002905691521e-02   +2.633392899292963e-03   +7.603766218290441e-02; +1.338791336101931e-02   +1.401700690923228e-01   +4.944691934472476e-03   +1.201064699992779e-02   -1.226863242132603e-02   +4.392862993457245e-02   +9.602003647764537e-02   +8.836493767807647e-02   +1.897853802740720e-02   +1.292048442096121e-02   +8.820544525083565e-02   +8.987906917645933e-02   +3.019298648534972e-02   +7.823291115663988e-03   +8.765297912558390e-02   +8.731221618460584e-02; +7.444189988554356e-02   +6.051939741068628e-02   +1.284689657416415e-01   +5.102123070967933e-02   +7.025202207906661e-02   +1.666819954299060e-01   +6.905818887858017e-02   +2.307320776491275e-02   +7.175280877190933e-02   +1.422847968495794e-01   +9.632897853023727e-02   +1.244299528439275e-01   +3.609129779342772e-02   +1.172516998773531e-01   +3.301048423583337e-02   +4.484109105169314e-02; +9.202455239595765e-02   +1.312945435882509e-01   +1.754594519602072e-01   +1.337218235680624e-01   +6.117358923753839e-02   +6.483781594952454e-02   +8.195116595739053e-02   +8.543933668343054e-02   +1.829829088055901e-01   +7.686399588173934e-02   +1.131099869656228e-01   +7.146972728642674e-02   +3.271766810369496e-02   -4.425858312464311e-02   +4.625435561460578e-02   +1.345216597449952e-01; +1.153320281055512e-01   +1.023551175826441e-01   +6.591105411948227e-02   +8.856971523107891e-02   +7.266104945764428e-02   -2.363576845833092e-03   +4.377948125968814e-02   +5.262703119982729e-02   +1.516382514811761e-01   +7.762095548181558e-02   +9.651310955514208e-02   -4.210522088439156e-02   +9.770560763033238e-02   -2.807846169285774e-02   +5.313209185358155e-02   +6.306484995239434e-02; +1.426457989910120e-02   +9.254762169060811e-02   +1.921818444231843e-01   +4.869492877247480e-02   +2.510157292282500e-02   +2.106881557532410e-02   +1.284500891641423e-01   +9.758666939511662e-02   -2.647798890671025e-02   +1.290747116738938e-01   -1.205216655132457e-02   +1.044188689679508e-01   +1.038037949864106e-01   +6.523917597524095e-02   +2.936915649862634e-02   +5.658444008310418e-02; -1.990160530013790e-03   +6.455863937138720e-02   +6.177001567810581e-02   +7.200575430909072e-02   +1.063667960237466e-01   +3.565363770036048e-02   +4.790713211880437e-02   -2.286474996033344e-02   +1.189939252878275e-01   +8.784717137284617e-02   +7.822224000049796e-03   +6.380070690132006e-02   +1.510012355795897e-02   +3.853560664080985e-02   +4.112699084912122e-02   +1.987466781612673e-01; +9.054962225333724e-02   +1.689201457403731e-01   +1.171399181307453e-01   +4.746543074925071e-02   +1.168321936312199e-02   +1.294626163514692e-02   +1.924315660644159e-02   -3.435047926464303e-02   +1.031567453478895e-01   -3.288703872333135e-02   -2.839432329307206e-03   +1.247698551503863e-01   +9.348129886175473e-02   +1.417997500900306e-01   +1.520571860051840e-01   +8.982760539842467e-02; +9.893534126118148e-02   +1.540220859323646e-01   -7.877174507733335e-03   +9.284322196147747e-03   +1.744674491212828e-02   +7.479903591733802e-02   +1.304846569273241e-01   +2.848980974838089e-02   +1.458943115629787e-01   +2.567934361429171e-02   +7.873420341997098e-02   +2.664371898052274e-02   +1.055759435987461e-01   +1.612655101685880e-01   +1.152971910219233e-01   +1.255826987422312e-01; +8.423964208242628e-02   +4.819937378531033e-02   +4.645721482391760e-02   +5.698601117293200e-02   +1.654174003551693e-01   +1.657267911572561e-01   +1.291810084464034e-01   +5.876662060331950e-02   +6.026758890525603e-02   +5.201762425307722e-02   +4.701344266019394e-02   +1.282730352492231e-01   +4.583069591092023e-02   +3.744662972337379e-02   +3.320883499093514e-02   +8.162897162876764e-02; +1.393257531342642e-01   +2.584523237432811e-02   +3.771953255771651e-02   +8.644487883754440e-02   +1.016179628629806e-01   +1.201682962302586e-02   +1.195058267278919e-01   +6.419019271103257e-02   -7.528712672240667e-03   +5.407852857884527e-02   +1.036402320934220e-01   +1.275198622535395e-02   +1.619336255408595e-02   +1.164759772570625e-01   +1.480064876241110e-01   +1.284050623117780e-01; +2.799637584204635e-02   +4.482194801942935e-02   +1.437197317042465e-01   +8.053132826173044e-02   +9.795933149002384e-02   +3.037794412935953e-02   +7.707988676698346e-02   +1.051054320034111e-01   +9.030086508830205e-02   +1.280766646558005e-01   +7.728126969417412e-02   +8.957131327426263e-02   +4.099581493228173e-02   +7.841207675789576e-02   +6.601794260531452e-02   +4.052046321756066e-02; -1.155761927523049e-02   +4.455766725783515e-02   +4.542211770615587e-02   +1.004058545863867e-01   +1.113458544476671e-01   +6.493546677374973e-02   +1.449192501384857e-01   +3.691965703614239e-02   +8.111600828306909e-02   +7.200375592084908e-02   +3.693705462129603e-02   +6.350119247037658e-02   +1.118491661352427e-01   +1.466177323901696e-01   +1.853706998234482e-02   +1.437548127153123e-02; +5.228302103178159e-02   +2.588674996934839e-03   +8.399808554382909e-03   +1.328777549988861e-01   +4.234403999881402e-02   +4.770092426049458e-02   +5.157351510267889e-02   +6.651674706979148e-02   +5.940820496848512e-02   +8.476819668684704e-02   +6.632526486843299e-02   +9.556194367837208e-02   +8.070107806678224e-03   +4.571129080057199e-02   +4.950573462532688e-02   +1.570392350093540e-01; +8.079358849140665e-02   +2.502273436265833e-02   +1.803364858504605e-02   +8.572933014127921e-03   +7.821313623997289e-02   +1.818847350023632e-01   -7.439450665774086e-02   +1.157891478186910e-01   +9.792674331033023e-02   +1.568906838762079e-01   +1.333089659417603e-01   +7.561534503521540e-02   +5.320421036771350e-02   +2.011582507799438e-01   +2.113665831265751e-02   +7.403616196591611e-02];
L2I_L1I_iGABA_netcon = [+7.451426730404166e-02   +1.305107754618467e-01   +4.695487512773171e-02   +7.898902749772341e-02   +6.913111764974988e-02   +5.326458717311486e-02   +3.293107285573792e-02   +8.135687080304985e-02; +3.299499028813983e-02   +1.499412005425973e-01   +4.613473158128387e-02   +1.084978183350778e-01   +4.159830144991634e-02   +1.086107551174178e-01   +1.166579377324917e-01   +7.451909769015579e-02; +4.740448759969141e-02   +4.750659563488424e-02   +1.742902472947087e-01   -1.286004653572946e-02   +7.697849744292266e-02   +9.596797318997596e-03   +1.183294516951636e-01   +1.022579940339261e-01; +8.987506833863711e-02   +1.069096199368111e-01   +4.594971379733902e-02   +1.005393855456626e-01   +5.129360529294905e-02   +1.243532513479152e-01   +6.290943749775127e-02   +1.181012013361846e-01; +1.649239143747382e-01   +5.939281600779051e-02   +8.544882255291081e-02   +2.907784103986152e-02   +1.268804650569109e-01   +1.158035352969551e-01   +6.088405405736788e-02   +1.153993280534602e-01; +4.331881855053502e-02   +1.120106172637079e-01   +1.029762859223518e-01   +6.599063170417512e-02   +1.016177330409605e-01   +9.813100549083351e-02   +6.842759989427782e-02   +8.151954565822973e-02; +9.954406309739133e-02   +3.994269296430426e-02   +2.273333912767994e-03   +8.874029840799605e-02   +6.212286935722439e-02   +5.947205885689630e-03   +9.718982353315825e-02   +8.478107297047789e-02; +5.943671452873287e-02   +7.257453109506455e-02   +4.477855320279692e-02   +1.852520846541393e-01   +5.585037481907170e-03   +1.037862313272366e-01   +4.539473464000966e-02   +2.199456935805433e-02; +9.568544215532283e-02   +8.837903322728087e-02   +1.085482205462928e-02   +1.405315234010912e-01   +1.007948171952690e-01   +1.574224676597825e-01   +1.700095406485569e-01   -1.071332023515297e-02; +6.291512016334544e-02   +1.500469189049577e-01   +3.590259621025819e-02   +1.747420753266374e-01   +1.264804529798544e-01   +6.533534728202214e-03   +1.306796559682174e-02   -1.547252059748659e-02; +1.268960877814488e-01   +6.371061529308353e-02   +1.799885980745166e-01   +7.174988388366182e-02   +7.130226793927343e-02   +4.583702101135104e-02   +1.751126157099828e-01   -3.553953593646250e-02; +1.979091094939207e-02   +1.010611915406604e-01   +3.527194803427649e-02   +6.969891204707156e-02   +1.664270983163562e-01   +1.036685373647176e-01   +5.256375969421815e-02   +1.324422683180049e-02; +8.133199798837783e-02   -1.630531677795679e-02   +1.155089184453040e-02   +1.257500403727408e-01   +4.086948086083400e-02   +9.542863256346676e-02   +1.066854042648536e-01   +5.469928187619703e-02; -6.108983064907339e-02   +1.016758998987201e-01   +5.060752799407346e-03   -4.703369568722053e-03   +9.327389123904528e-02   +7.516335731414008e-02   +8.695413104032489e-02   +9.468562778268162e-02; +1.343914205911748e-02   +5.100075200038949e-03   +6.976422035957826e-02   +1.195179896178239e-01   +6.411315871282050e-02   +1.114428929309625e-01   +1.215711734224456e-01   +1.092114729042511e-01; +1.568539839004177e-02   +1.230013052442188e-01   +4.380734994212508e-02   +1.208935073390474e-01   +2.017274862296834e-02   +6.498076022050289e-02   +4.746049495308285e-02   +3.197499715544563e-02];
L1I_L2I_iGABA_netcon = [+3.811545628849793e-02   +9.494801147308098e-02   +3.933240129668256e-02   +2.336982509134766e-02   +1.232819017233007e-01   +4.328149025908887e-02   +6.039921176365769e-02   +1.075348793953568e-01   +6.353369350800504e-02   +3.264115102960091e-02   +5.868750034949075e-02   +1.445721460634396e-01   +4.312900302626426e-02   +1.442028207132488e-01   +6.010724533572786e-03   +9.092435234765441e-02; +1.286366722349126e-01   +4.609060630727138e-02   +7.629472277005180e-02   +9.533737032635702e-02   +5.540515441733989e-02   +7.978115598516547e-02   +1.688056712750188e-01   +8.258267687979245e-02   +1.163066121552044e-01   +1.226162512466567e-01   +2.029773894500523e-02   -4.627440269462523e-03   +1.263586460900812e-01   +4.466014795596082e-02   +1.088898869271597e-02   +6.329014720104126e-02; +7.528102180880508e-02   +1.423570957848448e-01   +9.824376672539520e-02   -3.421998426795216e-02   +1.325567197271272e-01   +2.812623133353743e-02   +5.257743900183266e-02   +1.533692412399433e-02   +1.488811873695384e-02   +1.859153925556419e-01   +1.160445191592709e-01   +9.978866146882390e-02   +1.218336572266931e-01   +4.973833401359767e-02   +6.953188636987856e-02   +3.119048806560232e-02; +6.627792924238253e-02   +6.872507001588200e-02   +1.250885981899330e-01   -1.505678557740751e-03   +6.904485287577697e-02   +1.048698705257518e-01   +9.359168500712087e-02   +7.894856602899876e-02   +9.503801544700129e-02   +1.158744954005199e-01   +1.024854258850018e-01   +7.466191315207096e-02   +1.430939934727768e-01   +2.542973324768424e-02   +4.530205648960060e-02   +1.591494249259248e-01; +8.594978516870015e-02   +8.667513690714236e-02   +1.470332143953299e-01   +7.016748436065955e-02   +1.251637547425264e-01   +1.885442761644699e-01   +6.342942623471755e-02   +6.924324936178944e-02   +4.693742807039818e-02   +6.511265147337791e-02   +4.713918097820997e-02   +8.722102885531549e-02   +1.217595109412132e-01   +3.821076950025399e-02   +1.021912166023242e-01   +1.727022795683714e-01; +6.157999824739170e-02   +6.680660921463920e-02   +2.779530254891820e-02   +1.277500092783773e-01   +1.474042839149813e-01   -1.016285159507561e-02   -2.494221921689731e-03   +6.671141024193358e-02   +6.363467340982838e-02   +1.072566815790967e-01   +1.285595066262422e-01   +5.818113076016315e-02   +3.596391989122532e-02   +6.901290643892063e-02   +1.199740492978719e-01   +1.717340399693588e-01; +1.011123744740409e-01   +5.511549989096233e-02   +1.709217764870423e-01   +7.145969668298435e-02   -2.116196566876022e-02   +1.013920561745321e-01   +7.303982870667802e-02   +3.488443681674506e-02   +3.175261595937593e-02   +1.616155161197997e-01   +6.937939159714430e-02   +1.343207164725364e-01   +8.819257288483016e-02   +2.867270746243225e-02   +3.367262049311430e-02   +5.586237739407901e-02; +7.028980986367349e-02   +1.995106114003622e-02   +7.800425045280346e-02   +2.720001545381058e-02   -1.492203729303493e-03   +1.413558412535819e-01   +1.246828945681242e-01   -1.968429137257468e-02   +1.537053028463465e-01   +5.016364863836228e-02   +1.234387515665028e-01   +1.062168282167989e-01   +8.415798133066468e-02   +9.949637344405451e-02   +7.166144030307967e-02   +9.676419401060680e-03];
L2E_L1E_iAMPA_netcon = [+7.231491639976267e-02   +1.588287001944731e-01   +1.954761002772105e-01   +9.190280595664527e-02   +1.220080499872004e-02   +5.431700384859380e-02   +5.145075446702976e-02   +6.482332042742628e-02; +5.488885259525429e-02   +2.878097873537293e-02   +1.126465585951191e-01   +7.752636984222744e-02   +8.927571329437600e-02   -4.118164963566216e-02   +8.691132517762618e-02   -5.059397866075767e-03; +2.147861843664363e-02   +6.647017436253755e-02   +7.239850267107792e-02   +1.211901677565287e-01   +1.295373801281444e-01   +1.315089111281244e-01   +1.476602608587670e-01   -2.071704576034141e-02; +8.229382653115291e-02   +2.793321783977130e-02   +1.528636612632554e-02   +9.255225748978184e-03   +5.518189510987805e-02   +1.215494922606862e-01   +7.370543922221398e-02   -1.651212423215223e-02; +1.259521486380435e-01   +1.447922497466503e-01   +1.125336925077586e-01   +9.804883310506318e-02   +6.866093087213207e-02   +8.817622386343699e-02   +1.253559801577407e-02   -1.922192420063047e-02; +1.827236956092292e-01   +1.487934867131052e-01   +7.304670054152916e-03   +1.333177051413224e-01   -4.229563158305473e-02   +1.284437088256443e-01   +7.172237980160938e-02   +9.921912388048007e-02; -7.894719540905686e-04   +1.419991384903913e-01   +5.088111621460981e-02   +3.305322026794098e-02   +3.110819483865197e-02   +1.819585400212787e-01   +4.037360561302772e-02   +1.294983880827454e-01; +7.521903645751926e-02   +1.780644446668104e-01   +1.413025252932551e-01   +1.205867920873534e-01   +1.362942678788182e-01   +3.707522092963493e-02   +1.195110737689721e-01   +7.805508657528717e-02; +4.803515874305372e-02   +5.024074448254247e-02   +6.523099403301333e-02   +1.126790454995525e-01   +1.633760087537445e-01   +1.109862448248910e-01   +5.715368456973700e-02   +1.324720213764708e-01; +1.064272037652517e-02   +1.624928622023791e-01   +1.241992925891915e-01   +1.192044570194369e-01   +1.892408961470854e-01   +8.591620691892059e-02   +5.372193787897334e-02   +5.625606628358816e-02; +9.658893380523853e-02   +7.694769846245049e-02   -8.963051602253984e-03   +2.891721012400653e-02   +2.967033862391765e-02   +1.515546082084120e-01   +1.115329247610572e-01   -5.625660877921379e-02; +1.845484833182311e-01   +8.224786803871022e-02   +1.832549091561093e-02   +1.281918508849728e-01   +1.266360279951638e-01   +1.977837877810005e-01   +7.981619086362476e-02   +1.289214644320054e-01; +8.287645863213990e-02   +1.634293432922462e-01   +2.077301389240524e-01   +6.214863137713825e-02   +1.166881762755337e-01   -4.619140024248417e-02   +1.058815350620829e-01   +1.360587719219071e-01; +7.150702942883834e-02   +4.744673332774883e-02   +6.550008940469632e-02   +5.724727481718919e-02   +9.278217758283126e-03   +8.321182765876994e-02   +8.940545857875026e-02   +8.139267951334911e-02; +1.039699652546131e-01   +1.292474304278395e-01   +2.482678858527567e-03   +2.743271708675979e-02   +8.480103236775290e-02   +1.123441748671030e-01   +7.013439972194505e-02   +3.553406315324274e-02; +1.184974534713864e-01   +9.005156451270539e-02   +1.365944185340782e-01   +2.153190988992476e-03   +8.036110892349724e-02   +1.210061516591978e-02   +1.082565452803288e-01   +3.157585541668063e-02];
L1E_L2E_iAMPA_netcon = [+8.853530476062818e-02   +9.422925839863519e-02   +1.312590646932147e-01   +1.098463179901716e-01   +1.074687760652039e-01   +4.243003050861281e-02   +1.199266147406988e-01   +1.559037004683889e-01   +9.436906126264571e-02   +5.834353271136238e-02   +1.700254532130686e-01   -2.196242787082671e-02   +4.084736784945050e-02   +9.522335828546653e-02   +1.091316188155920e-01   +1.445275999187804e-01; +1.237485601384619e-01   +1.115745773323162e-01   +1.142533669658268e-01   +4.263065445260792e-02   +2.025121714054431e-02   +7.920833512729260e-02   +7.698229571491741e-02   +2.085146344812463e-03   -1.072986749410627e-02   -4.108290595460492e-02   +3.983598116068848e-02   +5.913065256315586e-02   +4.379013202917391e-02   -6.112095830827130e-02   +1.171335570918973e-02   +4.156433158340470e-02; +5.273391703851885e-02   +6.959873429491820e-02   +1.676114025197992e-01   +1.222712894161328e-01   -1.504973648736436e-03   +1.247207315996300e-01   -7.864355578804865e-03   +1.101385438142709e-01   +8.389235456030841e-02   +6.754098924782864e-02   +4.865209220130262e-03   +9.719874757235349e-02   -2.891331844344812e-03   +3.991332805759605e-02   +5.000209680583663e-02   +6.151802919111978e-02; +6.812014939169661e-02   +5.214624596356082e-02   +9.631970474703423e-03   +1.648999115992033e-01   +1.123759211937693e-02   +2.272788987586776e-02   +1.227084123341663e-02   +1.484826227453915e-01   +1.479360698460623e-01   +1.455957315765369e-01   +5.692121418660266e-02   -3.441840052334946e-02   +4.463745817911941e-02   +7.520379160327427e-02   +1.672026431363116e-02   +1.349355928345108e-01; +1.016418683456332e-01   +3.452660476221685e-02   +5.928720760528881e-03   +3.843063148289803e-02   +1.462507599985437e-01   +1.405469077156550e-01   +1.629338891027678e-01   +5.630739072668151e-02   +2.842456342788383e-02   +7.413124108657064e-02   +1.910822637490241e-01   +3.386489705188763e-02   +1.020004122959849e-01   +1.462447295074013e-01   +6.351730837662316e-02   +1.494246002277981e-02; +2.234493709084219e-02   +5.235883772767003e-02   +7.191785304392323e-02   -2.419742312857157e-02   +8.278512451989443e-02   +1.774863791324828e-02   +1.050684855908780e-01   +1.298767758296316e-01   +1.433304274615542e-01   +1.302800355913044e-01   +4.185339153715738e-02   +3.805491293885731e-02   +1.110437695394234e-01   +8.755325376622390e-02   -5.745506868500678e-03   +1.320230355979076e-01; +5.438435719350187e-02   +5.023416561262132e-02   +6.302835667382484e-02   +8.511165485596708e-02   +9.444150665885583e-02   -2.458283053518838e-02   +3.646585152355242e-03   +5.089186547490860e-02   +6.928700003318548e-02   +5.265013188459428e-02   +4.707133116541388e-02   +5.985839910031995e-02   +1.789834999131544e-01   +1.197902375036258e-01   +1.746299500312166e-01   +8.363751538368616e-02; +7.041779363247831e-02   +2.419255276707815e-02   +1.594222520849744e-01   +1.326430908794639e-01   +9.275028876805194e-02   +5.883112945035771e-02   +1.090047419560073e-01   +2.841916246434999e-02   +5.835792316441141e-02   +1.511999850587588e-01   +1.534543007265013e-01   +2.156823406863392e-02   +1.325358351469373e-01   +2.220958970145828e-02   +1.439550972064365e-01   +8.742572578316311e-02];
L2I_L2E_iAMPA_netcon = [+1.901207341011562e-02   +8.805230197037160e-03   +1.492764161663044e-02   +2.673397754678225e-02   +1.404104126167484e-01   +6.678045684600821e-02   +1.269414196683825e-02   +4.461189300208764e-02; -6.370134584799358e-03   +7.509711517840006e-02   +1.959265953778753e-01   +1.567267851027715e-02   +8.263827696293927e-02   +2.608120521930107e-02   +7.181395010024856e-03   +7.762578812621714e-02; +1.208512802411888e-02   +1.476849738517521e-01   +4.002588970767543e-03   +4.666838397922225e-02   +1.397825920638807e-01   +1.394380247645580e-01   +6.216916782258804e-02   +3.086586124545559e-02; +1.146081049849926e-01   +1.515607132187047e-01   +1.447586735781780e-01   +5.193461906756207e-02   +6.267848064650140e-02   +9.417534134540702e-02   -4.118419562825605e-03   +7.809911393763481e-02; +1.463333927151175e-01   +1.225643362312293e-01   +7.512747603843552e-02   -6.099626168244070e-02   +4.023573390466714e-02   +1.203833833612230e-01   +6.388823312005493e-02   +1.595869613458799e-01; +4.305690001730224e-02   +8.198863987011971e-02   +1.959402460002687e-01   +4.208687564032033e-02   +2.606467366930185e-02   +3.776194488497169e-02   +2.321473634571281e-02   +6.376385088585051e-02; +5.537075784117348e-02   +9.532265734708344e-02   +1.721988764344634e-01   +3.531705885360457e-02   -6.483924488344113e-02   +5.799328270159262e-02   +2.866156892868326e-02   +1.725037975871466e-01; +1.790564703027767e-02   +1.054919018678846e-01   +1.371286598804567e-01   +1.681138182518881e-01   +1.793157619664381e-01   +1.299789327089778e-01   +1.375102971817797e-01   +1.971207253261286e-02];
L2E_L2I_iGABA_netcon = [+1.306761221596470e-01   +7.754103591236622e-02   +7.405212742018777e-02   +9.116418043368662e-03   -1.094706392721522e-02   +1.541764212659925e-01   +1.292896855246833e-01   +7.763442230240084e-02; +2.061902678287731e-01   +1.585159647628804e-02   +6.009809542514896e-02   +1.789537638555701e-01   +5.509847587629887e-02   +2.703572505135084e-02   +6.519272026929797e-03   +1.026453222986984e-01; +6.512858211725658e-02   +6.805573347073318e-02   +8.583996115717780e-02   +7.093690936795168e-02   +8.554479236455713e-02   +1.485196635780915e-01   -2.999092233017765e-05   +4.340164907826315e-02; +1.115440940062349e-01   +6.320836354715859e-02   +3.427236984788201e-02   +5.185204785177921e-02   +8.778594891408649e-02   +1.494300637398000e-01   +1.068699637559177e-01   +8.210430086813608e-02; +8.062539670630030e-02   +1.276967404060263e-01   +1.266913570660202e-01   +1.458176906253281e-02   +1.770404726167064e-02   +6.177906228049192e-02   +1.160155037433571e-01   +8.625510536519526e-03; +9.791123503542312e-02   +4.589640413920663e-02   +3.716853270695826e-02   +8.042505266214113e-02   +5.445204673048821e-02   +1.289903984074203e-01   +7.151316080079495e-02   -2.105603730324540e-02; +1.371619392717279e-01   +3.895758686743715e-02   +1.264442657164982e-01   -1.244021311055548e-02   +7.894709469293217e-02   -4.137599109454779e-02   +8.568480626431581e-02   +3.862620022195834e-02; -2.121448587461167e-02   +1.066510420278395e-01   +4.287909740269769e-02   +1.472886286433115e-02   +7.793153634668885e-02   +1.055975232142372e-01   +4.073058173013223e-02   +1.054351292462992e-02];
L3E_L2E_iAMPA_netcon = [+1.582454188214371e-02   +5.312630822508722e-02   +2.627726565794589e-02   +2.359159644289020e-02   +9.543863357026933e-02   +4.033541702603193e-02   +1.561904216300922e-01   +1.099896370459973e-01   +1.231664726367728e-01   +8.762913629444256e-02   +5.216236209556922e-02   +9.331158063410555e-02; +6.263602450572962e-02   +1.541155112698134e-01   +1.292735797925872e-01   -1.014208753878554e-02   +1.161552722434139e-01   +1.042000275354024e-01   +8.117681395123770e-02   +1.394031525702727e-02   +1.127655497092976e-01   -2.819000405123420e-02   +1.059916830805855e-01   +1.169151590993556e-01; +1.391364820193215e-01   +1.105433980701592e-01   +1.425005621337548e-01   +9.398658645747801e-02   +1.687784670376319e-02   +8.045801630367976e-02   +1.344093467766793e-01   -9.845526636803249e-03   +6.358037033825525e-02   +1.500314724796062e-01   +7.676919610478189e-02   +1.363303821354495e-02; +5.333411314719264e-02   +1.324273780031308e-01   +4.892969736318364e-02   +2.513810906314088e-04   +1.536922252815179e-01   +8.453976348735077e-02   -5.978749503856338e-03   +8.531839429758523e-02   +1.058160225483820e-02   +6.710480525039297e-02   +1.183265485835387e-01   +1.107365020410813e-02; +9.091059901997858e-02   +1.792559058012650e-01   +1.218279928164747e-01   +1.533777207826172e-01   +9.933578754547222e-02   +1.967785527178431e-01   +8.400134744499974e-02   +6.277079710719904e-02   -2.708895484011031e-02   +1.205928616936554e-02   +1.252777789743495e-01   +6.939700375919014e-02; +5.363786778364818e-02   +5.806416416304020e-02   -4.523857362173163e-03   +7.040760746196033e-02   +1.160507696594631e-01   +3.761586332741663e-02   +2.036560515865674e-01   +1.219332472983907e-01   +1.193464240150050e-01   +6.945422075933902e-02   +1.008620330797759e-01   -4.594143603976615e-02; +1.387339771259961e-01   +7.607598965165788e-02   +6.512860401593200e-02   +1.986939707474621e-02   +1.493956362344980e-02   +3.569826735939927e-02   +3.113381227454377e-02   +1.941075486848386e-02   +4.243180818648042e-02   +1.323368500762327e-02   +1.342274671736226e-01   +1.075304354732955e-01; +1.360536080853964e-01   +9.488229089411712e-02   +9.447737874626985e-02   +1.111178408237994e-01   +1.461656845875975e-01   +8.888893959218086e-02   -6.056273295238584e-02   +2.922373619008663e-02   +1.532310359739826e-02   -3.396856046601093e-02   +2.914349101887228e-02   +4.517949343419651e-02];
L3I_L2I_iGABA_netcon = [+1.144298216301098e-01   +1.557390513278421e-01   +4.302937466399784e-03   +1.120056545537410e-01   +1.567078427100026e-02   +8.308823476185402e-02   +1.198291943549287e-01   +5.128337565778714e-02   +5.804163404103674e-03   +3.213623088357535e-02   +6.789146482760049e-02   -1.368750903408312e-02; +8.423898652100399e-02   +9.352241783212938e-02   +4.509072569896773e-02   +6.060928443390085e-02   +8.336190383347110e-02   +1.807954011799312e-03   +1.220679585199100e-01   +1.526792286395625e-02   -3.313996452609733e-02   +9.479620126148595e-02   +9.468723105252483e-02   +1.665529178225936e-02; +8.308324910387405e-02   +1.501951781755540e-01   +1.079536671721611e-01   +8.917403624672467e-02   +1.309963764057358e-01   +6.739762739824494e-02   +2.371562587810539e-02   +6.017086258929658e-02   +1.105039418442638e-01   +6.022518272896910e-03   +1.433733949545577e-01   +5.589162312224668e-02; +7.722465715410146e-02   +1.853521497814180e-01   +1.410341658637877e-01   +6.910799929224257e-02   +1.130370546760383e-01   +9.445054604492378e-02   -4.630521734271906e-03   +2.440184319815251e-02   +1.277057120560057e-01   +1.308878015887522e-01   +3.641407914897905e-02   +1.237956285780775e-01; +3.691829201787209e-02   +1.338275228918015e-01   +1.708003962159244e-01   +8.171619390481898e-02   +1.640592948831764e-01   +3.309424781206752e-02   +3.938378070330033e-02   +1.258336263997898e-01   +1.397254857555730e-02   +1.085688542262064e-02   +1.210836458283751e-02   +1.008064962194362e-01; +9.498834284296373e-02   +6.656166168360472e-02   +1.460998322855954e-01   +6.486115573809306e-02   +8.596127784179787e-02   +1.599890575662819e-01   +4.680336502712074e-02   +7.881227024232364e-02   +1.415976932858439e-02   +3.983827860425469e-02   +8.229967663103671e-02   +1.022646363518642e-01; +3.792339087519385e-02   +6.000634062584702e-02   +1.745930562740435e-01   +1.646474932716087e-01   +9.338625977119545e-02   +1.299625546025436e-01   +5.888203018134423e-02   +3.961818579523888e-02   +2.476221874048591e-02   +8.900122050746714e-02   +1.256729462590830e-01   +5.211108428752899e-02; +3.537270145561479e-02   +2.877752276644430e-02   +1.256142884446482e-01   +1.390783977253665e-02   +1.340140111096997e-01   +1.477450404348667e-01   +1.452255701140053e-01   +8.480160170010027e-02   +5.181219616147169e-02   +8.405545424893214e-02   -2.427019951591372e-03   +1.118150396781470e-01];
L2E_L3E_iAMPA_netcon = [+1.654284518564479e-01   +1.070673953101644e-01   +1.355180335561086e-01   +5.817071954245870e-02   +5.174736658724383e-02   +1.185460940721257e-01   +8.020161352187498e-02   -1.358100801739566e-02; +1.154354355263535e-01   +1.255597794633719e-01   +1.214865085308168e-01   +9.853439104958348e-02   +2.090574828947243e-01   +1.775134545700188e-02   +6.083806634592685e-02   +1.299415015732189e-01; +3.254493929837707e-02   +4.624612412145303e-02   +6.792049892176047e-02   +1.271871099072265e-01   +6.279332085415568e-02   +1.231901932733972e-01   +1.069321452856107e-01   +5.022998606486337e-02; +6.425952859595148e-02   +6.873093969537530e-03   +5.068891453938341e-02   +1.220052592717133e-01   +8.618809175359851e-02   +1.446369156054144e-01   +1.045038547689034e-01   +5.914686124097931e-02; +1.108975068682616e-01   +1.140457104513258e-01   +1.491686124116514e-01   +1.357381678172346e-02   +1.492961934380215e-01   +4.852861190462434e-02   +5.518360853823141e-02   +1.282764550396983e-02; +5.077818752896646e-02   +1.696911736836852e-01   +6.314211838446143e-02   +4.381808803741854e-02   +1.590683768453265e-01   +3.399042544105731e-02   +7.889236162551032e-02   +8.891651820896841e-02; +8.582899337366931e-02   +1.446164149028935e-02   +6.461579141136986e-02   +2.961730459505705e-02   +1.159102106517103e-01   +6.671341119753225e-02   +9.495381144239853e-02   +7.963751187410013e-02; +9.683752877965514e-02   -9.018898121940630e-03   -6.396880254968321e-03   -4.633703342417542e-02   +1.405998971498788e-01   +1.077182977466031e-02   +2.180186439983411e-02   +1.015679588628225e-01; +1.851051018904967e-01   +1.848696008071138e-01   -1.522085353401790e-02   +9.420719688961510e-02   -1.841925292772877e-02   +5.954729348850524e-02   +1.865562072784702e-01   +7.602206097501758e-02; +5.365641300307619e-02   +3.194640244265005e-02   +9.987640637785224e-02   +2.809674217012655e-02   +1.943131290352501e-02   +8.595082546739799e-02   +1.275365366901987e-01   +1.052476156321288e-01; +7.476229354297501e-02   +4.210475697733034e-02   +3.551688067616333e-02   +7.161864041591479e-02   +4.349445669089214e-02   +1.284858778615327e-03   +1.847446753176675e-02   +1.507884663371062e-01; +1.176005448230817e-01   +2.929600178326653e-02   +1.312871283439485e-01   +1.238658122797837e-01   +6.920889868235558e-02   +4.770061908484172e-02   +7.784759504315579e-02   +5.591865261763926e-02];
L2I_L3I_iGABA_netcon = [+5.702274227420193e-02   +8.300417398411924e-02   +6.646989148700538e-02   +1.013527874907058e-01   +7.329645267329495e-02   +5.855640935612813e-02   +2.858844364710907e-02   +1.000103714313523e-01; +2.915119786407282e-02   +1.405557611027239e-01   +1.915377758892470e-02   +1.613139047547897e-01   +5.632831677448060e-03   +1.076830567036446e-01   +5.037388493869555e-02   +5.204489329740881e-02; +1.409951306869853e-02   +1.414226768178293e-01   +1.033164874835643e-01   +1.437182627111812e-01   +3.314103755203052e-02   +4.034476301084712e-02   +1.278541654191593e-01   +1.732336570021975e-01; +1.421150586622306e-01   -4.212037626742692e-03   +1.005902329476620e-01   +6.340559216971001e-02   +5.795734686515677e-02   +1.023133050763457e-01   +1.389386832962812e-01   +2.259097258309289e-02; +4.973647457488155e-02   +1.557891471513211e-01   +9.923880308229692e-02   +1.253832701790429e-01   +3.217110263578421e-02   +8.887914703196403e-02   +9.548192874739587e-02   +7.211113754311525e-03; +9.121176728180790e-02   +8.343837345715677e-02   +5.135295143454339e-02   +1.701819476833648e-01   +4.736401819824063e-02   +2.109371966783997e-02   +9.247128427861145e-02   +7.643471768362808e-02; -4.925744636541861e-03   +1.426740658330738e-01   +9.537972225253868e-03   +1.606401568301165e-01   +5.951355470590667e-03   -2.688522470919055e-02   +8.484002774569858e-02   +8.625163869293810e-02; +5.391709463175351e-02   +1.875614549299495e-03   +9.991877376865493e-02   +8.255698232480223e-02   +1.447017396920299e-01   +7.144044980160352e-02   +3.907014128233031e-02   +3.889588005107966e-02; +7.609159673079308e-02   -5.259450296642882e-02   +1.754612927730452e-01   +1.984752368757189e-01   +1.224943180969359e-01   -1.958957589891154e-03   +5.130678034994683e-02   +1.174350598090232e-01; -2.664654987162992e-02   +2.661020600670587e-02   +1.943675504079985e-02   +1.053793721817729e-01   +1.054511580376577e-01   +3.816337173810540e-02   +7.261935414738610e-02   +7.183880892118483e-02; +3.001557325877259e-03   +1.417006041547904e-01   -2.366692937742837e-02   +9.862871285071947e-02   -2.477014816420592e-02   +1.050618005649000e-01   +5.212245480972814e-03   +3.593792569424371e-02; -3.000432759506518e-02   +4.345106107400812e-02   +5.614709478511232e-02   -2.320881178826593e-03   +1.229548662767679e-01   +9.579192991716012e-02   +4.458479074922767e-02   +2.952494130112080e-02];
L3I_L3E_iAMPA_netcon = [+5.195777246073409e-02   +6.202287112611830e-02   +1.145373646390906e-01   +1.212637770215943e-01   +2.361682150842778e-02   +1.506503387365072e-01   +4.335609984060080e-02   +2.280451867054084e-02   +9.929073433560654e-03   +1.728811980122083e-02   +9.467540208544967e-02   +5.828832180331330e-02; +1.094843258732640e-01   +1.944132692947948e-02   +5.926285834265006e-02   +1.871595650557790e-01   +7.773970293985993e-02   +8.247804518071571e-02   +1.240626601233834e-01   +1.737277138338190e-01   +4.818615294247895e-02   +4.803130672760999e-02   +6.845731960119415e-02   +1.256741846089108e-01; +4.076099129826658e-02   +1.295498299467643e-01   -8.463543340318892e-03   +6.290528820797450e-02   +1.375789282447159e-01   +1.379861126399803e-01   +8.757142187558543e-02   +5.973841554793613e-02   -2.202349156791216e-02   +1.413929695677956e-01   +8.249723463242985e-02   +1.284128046159728e-01; +1.555710926828850e-01   +2.249475209410862e-02   +8.592584873365762e-02   +1.375531703259089e-01   +7.136699750705901e-02   +3.291148722541402e-02   +8.476301972549917e-02   +1.425883822800936e-01   +9.644817314981241e-02   +1.144495717210027e-01   +6.608667012325174e-02   +1.008938099991578e-01; +5.707114143879248e-02   +1.291704537464585e-01   +4.023294297817449e-02   +2.133190661877606e-02   +2.424675136594305e-03   +3.393447645380383e-02   -3.591184453361197e-02   +8.674134930454719e-02   +7.205158765264608e-02   +2.615667208219195e-02   +1.280879784043331e-01   +1.095058213638969e-01; +6.852212495973127e-02   +8.953103430350370e-02   +8.763482253176359e-02   +1.977910447678858e-01   +3.145084323799462e-02   +2.976092354945078e-02   +6.546993312938375e-02   +4.573795208486221e-02   +1.626554521439486e-02   +1.193356655346230e-01   +9.346357433232162e-02   +6.351971866345452e-02; +1.116712110038542e-01   +7.246263142825156e-02   +1.364259298672872e-01   +1.373547947799754e-01   +1.057553435560066e-01   +5.810740848780958e-02   +6.009749410772312e-02   +1.744859721315296e-01   +6.669034459160553e-02   -2.976083267294830e-03   -6.348704031327593e-02   -4.678093618114126e-02; +1.486085510252236e-01   +9.038381043110244e-02   +3.534185441923029e-02   +8.886367963252863e-02   +3.307055262712112e-02   +2.945588921808879e-02   +6.461200346387379e-02   +1.501085453715342e-01   +5.018093474781512e-02   +7.566207703962517e-02   +5.852592619514492e-03   +1.390302325059279e-02; -1.722435880278344e-02   +6.725476939780450e-02   +4.157287820516369e-02   +1.310657846754889e-02   +3.496451208124981e-02   +1.833177018443613e-03   +8.855561913431791e-02   +5.329379262973111e-02   +8.396487006670102e-02   +1.566714395282807e-01   +9.576420157253905e-02   +1.316405496164231e-01; +1.259220757334788e-01   +2.352594681791854e-02   +8.351284141909282e-02   +4.197030903140803e-02   +5.079282721119464e-02   +5.462735960598861e-02   +7.066024769231581e-02   +1.371668296375951e-01   +1.016661847708538e-01   +5.597817103790440e-02   +2.322626371603673e-02   +1.098136412413014e-02; +1.371225619596752e-01   +8.127441646450276e-02   +4.055732903073363e-02   +3.525364189789502e-02   -7.873876655469231e-04   +1.138186436477391e-01   +5.800452313112867e-02   +1.387732925330805e-01   -1.412099117832106e-03   +4.209577849320011e-02   +7.982209499652325e-02   +1.199301860711135e-01; +8.674368778221000e-02   +1.619622371019242e-02   +5.731014264011816e-02   +1.701170295431011e-01   -9.708046656661610e-03   +3.530785463296790e-02   +1.226144184353360e-01   +4.387060356870499e-02   +2.316088001866890e-02   -3.756660913848336e-03   +6.816985187571183e-02   +1.851814654999718e-01];
L3E_L3I_iGABA_netcon = [-1.465553857031976e-03   +1.486692434177521e-01   +4.604724027929910e-02   +1.532287184936194e-01   +1.287411280252681e-01   +1.318101530751744e-01   -2.536119587166068e-02   +3.917606587066890e-02   +1.323230448516019e-01   +1.222612844452304e-01   +1.972640556509088e-01   +5.842942720237284e-02; +6.195916882944111e-03   -2.956906717491752e-03   +1.820266099826273e-01   +9.338553222011189e-02   +6.874502322764139e-02   +6.074071549047225e-02   +1.232045515708993e-01   +5.200999363590963e-02   +7.958891322916963e-03   +1.962229749822653e-01   +6.679354025413833e-02   +1.024666278387734e-01; +5.860444805706385e-02   +1.445772877618564e-01   +1.376931045412455e-01   +1.458330864716152e-01   +3.644549654769074e-02   +1.069559536828848e-01   +6.150014735343662e-02   +4.018028602225108e-02   -8.668206267604806e-03   +1.028919579263684e-01   +4.672230750105568e-02   -9.902427859492914e-03; +7.143638224532736e-02   +1.275684461119837e-01   -1.679937983040957e-02   -3.581554597190378e-02   +3.263400345830906e-02   +1.507954979834614e-01   +8.790093060567145e-02   +9.563476002619387e-02   -1.640211888711038e-02   -2.469727786656425e-02   +1.021407448681870e-01   +1.153515888358952e-02; +1.050189418210099e-01   +9.638036870495768e-02   +1.987425981124274e-01   -7.686547131673799e-05   +1.175083389520878e-01   +3.280697492224224e-02   +1.332886234455360e-01   +6.736695102743297e-02   +1.254977719215897e-02   +1.575194524680128e-01   +4.326219162429243e-02   +4.924970729980950e-02; +6.064014104507724e-02   +1.734013668283925e-02   +1.818443947501909e-02   +3.959175603496069e-02   +1.944096432156407e-02   +1.608983950967330e-01   +5.049421978060954e-02   +3.471340829125719e-02   +7.680669892404214e-02   +1.516987306088598e-01   +8.906481896675283e-02   +1.783993034365310e-02; +1.072261930167871e-01   +8.723990209651161e-02   +3.169975179077872e-02   +2.499354262169973e-02   +8.034618370149238e-02   +1.364424663857886e-01   +1.368891491770597e-01   +1.095372323000435e-01   +8.924201193068246e-02   +1.084698519513644e-01   +1.004729417649575e-01   +5.507710708292014e-02; +9.625256420207461e-02   +1.034561718110715e-01   +9.747888641924354e-02   +1.745413125153365e-01   +9.920131449409469e-02   +4.228230735594503e-02   +3.082086389484232e-02   +8.451111246728360e-02   +5.730276762873725e-02   +4.670844729889265e-02   +7.520108881490228e-02   +8.853100516335614e-02; +1.588022856393622e-01   +3.268075419670628e-02   +1.086193518571279e-01   +3.582255286100020e-02   +1.472311901450540e-01   +5.864187829322860e-02   +3.070725200454072e-02   +1.033337433461741e-01   +6.341287431817577e-02   +1.534063518116850e-01   +1.173107481830354e-01   +1.186138530444746e-01; +1.086270377169263e-01   +6.848498755231983e-02   +8.488115477603160e-02   +7.580101294120813e-03   -2.439315248872414e-02   +7.687949791624932e-02   +5.059858466663819e-02   +2.337638078365461e-02   +6.653368737129660e-02   +1.025929587037041e-01   +5.898136042085463e-02   +8.818228079989729e-02; +9.071744216549073e-02   +1.303530192039787e-01   +2.345442762992862e-02   +1.608251652578257e-01   +1.716189305795642e-02   -7.092862528907128e-03   -9.735689819632184e-05   +3.972080120492990e-02   -3.943823553068012e-03   -2.990088927610346e-02   +1.648644776203884e-01   +1.487292269634105e-01; +1.099745618587431e-01   +9.098136278206158e-02   -1.504833863125585e-02   +6.802321900494572e-02   +1.068919145362913e-01   +4.224799433464643e-02   +1.072372526539795e-01   +1.067311556051069e-01   +1.572289259583427e-02   +1.026397424923569e-02   -3.909005933987140e-03   +4.654887132022857e-02];
L2E_Input1_iAMPA_netcon = [+5.629602257695372e-02   +5.353468705856077e-02   +4.030870794448325e-02   +5.302251408878359e-02   +1.203890672126033e-01   +7.489938837056115e-02   +5.611111165003291e-02   +1.075333142119418e-01];
L2I_Input2_iAMPA_netcon = [+7.565489288867266e-02   +4.351197071648485e-02   +1.849465694535358e-01   +1.117803032608208e-01   +1.071530281025526e-01   +2.289012852003547e-02   +1.263184367648535e-01   +1.467618203484241e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
