function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.220652511140280e-01   +7.417576420398043e-01   +9.278955582951410e-01   +1.712033789833234e-01   +2.049565852772851e-01   +7.299894297090924e-01   -2.804634826575124e-02   +4.105092548391224e-01   +3.112253263084870e-01   +2.201077255178487e-01   +3.954192347616646e-01   +1.856391197186923e-01   +5.074210231637667e-01   +2.763939631402281e-01   +2.415824601786242e-01   +1.415713079768662e-02; +1.045105892576183e-01   +9.783571729175882e-01   +8.584553392578411e-01   +7.706915387224490e-01   +3.316637773938821e-01   +7.198335946221530e-01   +7.228603639123000e-01   +1.116419516827178e-01   +8.686684798208612e-02   +7.319691686842411e-01   +5.386674595431050e-01   +6.684029107549849e-01   +4.902685646009345e-01   +2.599635639596606e-01   +6.679786588020308e-01   +2.422624745609777e-01; +2.604021388810046e-01   +3.370831495925877e-01   +4.181225468164328e-01   +5.535522063395450e-01   +5.418899117198539e-01   +4.268513669220590e-01   +1.564809249834741e-02   +6.505911556042928e-01   +3.290573154692675e-01   +5.401445974646574e-01   +8.745254086123121e-01   +2.194609786769598e-01   +4.671374549718514e-01   +2.919600249448884e-03   +3.714777017249574e-01   +9.488833072378804e-01; +2.107016478345979e-01   +6.193745453138217e-01   +9.798286073139750e-02   +2.552509268425891e-01   +8.867621740820900e-01   +7.999159300058875e-01   +2.124405071449989e-01   +5.668445281676080e-01   +7.566788768070225e-01   +5.605561348095361e-02   +2.047280957354595e-01   +8.388005770310610e-01   +5.366463660532022e-01   +1.522688292645780e-01   +6.222942721150869e-01   +4.406742158254137e-01; +7.694585742422302e-02   +7.515118093977835e-01   +8.213432129178014e-01   +7.609255205840816e-01   +5.188824786774838e-01   +3.217900734160179e-01   +4.682556354379253e-01   +2.584588977129146e-01   +2.747050377643810e-01   +5.009283014260946e-01   +2.274043967266182e-01   +6.426556957515910e-01   +3.870319627522134e-01   +7.787429173324042e-01   +2.363642156755003e-01   +8.936136582860912e-01; +1.281529604104165e-01   +2.029983344045538e-01   +7.717497727271377e-01   +7.791973971251805e-01   +6.025327705959022e-01   +8.983408053431887e-01   +3.165070844056359e-01   +4.083807515226970e-01   +8.344490430232420e-01   +8.563499930012590e-01   +8.761261282059443e-01   +2.278377392438301e-01   +3.782219441976925e-01   +1.546657758106475e-01   +8.682697632128622e-01   +3.785232350901780e-01; +2.986018861013710e-01   +7.596940870316066e-01   +7.393753035855943e-02   +3.550997513326848e-01   +8.429859359652955e-01   +5.340181372562610e-01   +4.703900270104918e-01   +6.013584386286672e-01   +8.779502454470570e-01   +9.521638395786765e-01   +6.700703592852428e-01   +7.817751374208963e-02   +3.557752347185241e-01   +3.654788079074347e-01   +6.821233483150233e-01   +8.761385345159199e-01; +6.900721558351114e-01   +7.327316927465160e-01   +7.549235165734304e-01   +3.674680767383689e-01   +6.328293758408183e-01   +4.687984205643140e-01   +7.699175566555361e-02   +3.989112404529249e-01   +1.000000000000000e+00   +8.915209264654685e-01   +2.098859029206566e-02   +7.175882445603191e-01   +8.165671943952446e-01   +5.725868957168857e-01   +2.900351317519040e-01   +8.484371919396744e-01; +4.947231333532304e-01   +5.022905744651679e-02   +2.636902078487081e-01   +1.641303066156927e-02   +4.929272393229395e-01   +1.166993796026807e-01   +2.325288609778278e-02   +5.582548411484481e-01   +4.489708973774243e-01   +7.741596763757279e-01   +7.558321178535570e-01   +5.369198614330902e-01   +3.153500260342431e-01   +1.923365673976877e-01   +9.560935459209621e-01   +7.401016053221490e-01; +6.874017618665447e-01   +4.910324155402852e-01   +5.673232714424384e-01   +2.558340477568853e-01   +4.347763969103796e-01   +3.442026465174589e-01   +7.521937128256460e-02   +2.731492696878264e-01   +7.862418676658840e-02   +8.054147389229342e-01   +5.868587223397836e-02   +6.956380859533322e-02   +3.246790582032740e-01   +7.172893219949052e-01   +2.768522032778409e-01   +8.345380236942762e-01; +4.398041932049976e-01   +3.800907259325915e-02   +2.235004023215527e-02   +1.268247067805458e-01   +9.290505509171447e-01   +5.663352819845863e-01   +2.718088295472456e-01   +1.833527999258446e-01   +1.852314541444113e-01   +8.646081227064142e-01   +1.181597302555225e-01   +7.462895928283457e-01   +5.206465929079479e-01   +8.424567478436719e-01   +1.272725397705154e-02   +1.115873303599340e-01; +1.428893763060558e-01   -1.958070522676480e-03   +9.250463373745661e-01   +5.158765397509976e-01   +6.476370126090295e-01   +5.250074204818543e-01   +6.822736898381691e-01   +4.080030984427555e-01   +6.041718974487140e-01   +1.180431297677001e-01   +3.550973846591368e-01   +8.021537248497090e-01   +8.697016394332585e-02   +4.772176990120141e-01   +3.694472247159231e-01   +8.213453520385376e-02; +4.473034714664738e-01   +3.287537715147189e-01   +6.448535902577039e-01   +2.625939306813315e-01   +4.673057085624589e-02   +4.528541388297002e-01   +4.677507449068534e-01   +7.315244733607320e-01   +2.521498685969701e-01   +8.919543431047259e-01   +1.363727389463244e-01   +4.300457808561324e-01   +2.231918415913078e-01   +2.098506713014607e-01   +3.229140714837994e-01   +2.143773359780199e-01; +1.095368091448282e-01   +8.701062199691364e-01   +7.806047115419865e-01   +7.238333249008325e-01   +7.778731858531516e-01   +5.623780189662346e-01   +3.388031805695509e-01   +7.724126558349896e-01   +3.945492769527147e-01   +4.182868030613941e-01   +8.794871952908327e-01   +6.010070041726049e-01   +5.846971863042579e-01   +5.349672889228203e-01   +1.340029227021584e-01   +3.527595303571807e-01; +1.190349964063297e-01   +2.358323399090936e-01   +4.563809789917518e-02   +3.958953374904829e-01   +4.356975403781687e-01   +7.864444137333720e-02   +6.638873289376963e-01   +2.976284544855380e-01   +8.461764183964398e-01   +5.244885942283759e-01   +7.466385329389141e-02   +8.461829480913924e-01   +6.569784956305263e-01   +1.742341843682821e-01   +7.024119220096589e-01   +1.324830094860862e-01; +5.642583344067154e-01   +2.873764742843840e-01   +3.154272364945893e-01   +6.265531734345312e-01   +5.458504103763320e-01   +6.113137623095597e-01   +2.613081584407194e-01   +9.668064191370943e-02   +5.658632083572730e-01   +4.457610644656881e-01   +1.022326565045410e-03   +4.145098813898558e-01   +1.797773915219477e-01   +9.235903678400982e-01   +9.240677850984748e-01   -8.671415978363142e-03];
L1E_L1I_iGABA_netcon = [-3.586512937886688e-02   +3.001541448799827e-01   +8.962938223045104e-01   +2.596812894005159e-01   +4.391487209315583e-01   +9.806190782887203e-02   +3.148266228588071e-01   +1.710032641026133e-02   +2.090815887533423e-01   +5.924679502233988e-02   +4.418847001114559e-01   +9.692171375185319e-01   +1.575380159847638e-01   +8.147513673468858e-01   +1.044413160777160e-01   +4.198353664267177e-01; +7.635004817283496e-01   +7.767100508499425e-01   +5.250344322504537e-01   +8.476086056788614e-01   +7.455093903164708e-01   +8.354868456034987e-01   +6.338658567341414e-01   +8.633036512018600e-01   +9.341056889790309e-01   +9.453745490865507e-01   +1.197023299987538e-01   +9.028275274278996e-02   +6.050105352960102e-01   +9.498726233390161e-01   +1.000000000000000e+00   +2.837508897285289e-01; +3.257588745616914e-01   +8.508961428598071e-01   +1.209069603647997e-01   +1.165129027422646e-01   +1.080658834522612e-01   +2.244693985675315e-01   +5.761921121181274e-01   -2.797310514508997e-02   +7.241804447805744e-02   +1.366549358080477e-01   +5.263683310551268e-01   +4.296787479285803e-01   +8.443669461316711e-01   +8.029350249888342e-01   +7.747349628392569e-01   +7.444689631270277e-01; +3.409749938407114e-01   +5.030894144842539e-01   +6.485709640060938e-01   +7.849529011493819e-01   +6.552924813730853e-01   +6.224232175260572e-01   +5.884643259604598e-01   +8.893662529395199e-01   +5.803036220328913e-02   +3.305454500060789e-01   +5.283672696780346e-01   +2.355268220405299e-01   +8.273975340927723e-01   +4.101891452536464e-01   +9.389651792822067e-01   +5.052232389204016e-01; +7.262213249123005e-01   +5.851752015437151e-01   +8.512055641170546e-01   +3.467289197384979e-01   +9.782538665110108e-01   +5.322869370474168e-01   +3.294777841373436e-01   +4.483827164740252e-01   +3.072639858392139e-01   +6.890912028474210e-02   +4.114241989044331e-02   +5.977490818519753e-01   +9.442457190796281e-01   +7.722036485568378e-01   -1.540018812635318e-03   +1.610794812692626e-01; +2.525082367207657e-01   +4.683819076639979e-03   +2.757568004888085e-01   +1.805623125417276e-01   -1.110295290804590e-02   +4.492467024771510e-01   +9.020090154107365e-01   +3.090559109322496e-01   +5.699306339066007e-01   +4.209395853341917e-01   +9.242129277100571e-01   +2.202884318713895e-01   +2.609530933993450e-01   +2.083814868755246e-01   +7.371154588228908e-01   +4.372019917899305e-01; +6.740645539094455e-01   +5.416459418877914e-01   +3.055659868711368e-01   +8.132241078086920e-01   +2.602348852413346e-01   +8.568484386756720e-01   +6.822550040618838e-01   +5.598767624779221e-01   +8.424499614450224e-01   +6.167290736761675e-01   +8.945725225256924e-01   +3.299650811846424e-01   +8.133467017040243e-01   +5.912813714819595e-01   +9.334346511841896e-01   +8.056508018007574e-01; +9.644231803795471e-01   +1.528133533022818e-01   +5.696299417484709e-01   +4.677835297692611e-01   +6.267622866071515e-01   +2.049051894829662e-01   +3.271388758205246e-01   +5.799500035422163e-01   +2.331826077445405e-01   +8.323752626188289e-01   +7.519039016728882e-01   +9.062906464440847e-01   +2.886932598482091e-01   +7.661419794003136e-01   +4.616290303389053e-01   +5.979332174647933e-01; +5.381978846052790e-01   +9.755797511048693e-01   +3.939083873928395e-01   +9.680756829702347e-01   +2.456938859258472e-01   +7.036544947966131e-01   +5.790116131830634e-01   +9.900295421803772e-01   +8.688144699216458e-01   +1.096085915446479e-01   +1.869304989228325e-01   +2.211742717080375e-01   +8.687962325587237e-01   +6.413008785073510e-03   +9.383247921139307e-02   +4.614748669215337e-01; +2.764842137945405e-01   +4.105489017895056e-01   +5.502523806116998e-01   +3.112383656923038e-01   +8.219029886524841e-01   +4.054564555130993e-01   +3.148835602382461e-01   +8.480369305099245e-01   +9.384943802691474e-01   +8.872493738976802e-01   +8.147749132172296e-01   +9.436193936180548e-01   +5.154806337228020e-01   +3.774740107172610e-01   +3.403385132674407e-01   +8.249918815828730e-01; +1.393251710848424e-01   +2.453291773126038e-01   +8.158111104632236e-01   +9.258900576953834e-01   +1.672067037883274e-01   +6.217952198474981e-01   +6.512185161269535e-02   +4.612083865899271e-01   +3.999814839261102e-01   +6.651626349758801e-01   +3.006338194753000e-01   +9.035125230887390e-01   +9.852118119397535e-02   +4.754387079067060e-01   +4.421087564263519e-01   +4.757838372482754e-01; +1.732020936289851e-01   +9.553030571651867e-01   +7.712576639385892e-01   +4.642577884560820e-01   +4.644232996566213e-01   +4.793627290921187e-02   +1.821978446029600e-01   +3.672834673563685e-01   +1.482794188527730e-01   +5.752317585813638e-01   +2.779113253829705e-01   +4.353969222341147e-01   +4.031968173646821e-01   +9.071275247530091e-01   +4.514100355646364e-02   +4.960804578377045e-01; +9.217675630391204e-01   +1.405914660612316e-01   +5.121299418786524e-01   +5.504192616456348e-01   +6.411521226688235e-01   +5.789006618287663e-01   +2.032841320451594e-01   +5.339331408898225e-01   +4.989328614344145e-01   +3.520158537470902e-01   +9.490625026145499e-01   +9.675260867219347e-01   +8.663765727108778e-01   +5.944051503243865e-01   +2.831259370316706e-01   +7.745304652113327e-01; +4.358904396361275e-01   +8.586967116770832e-01   +3.145394983574582e-01   +3.682180668110441e-01   +7.568317666651706e-01   +1.800715208424456e-01   +3.618820638852702e-01   +6.195742831397293e-01   +3.087987554852589e-01   +4.645088206668567e-01   +2.021841797695681e-01   +1.351422684036211e-01   +2.818121773776981e-01   +2.693895583627141e-01   +5.989668615252952e-01   +9.102101928029406e-01; +6.037202073499331e-01   +5.780253987125995e-01   +6.580749169756805e-01   +7.205470840994761e-01   +7.832933573364383e-01   +7.031454832058937e-02   +8.355249429247108e-01   +3.109063972416662e-01   +8.362924376527620e-01   +4.963015427581680e-01   +6.901099656013414e-01   +5.753136885047627e-01   +2.362934458791944e-01   +4.732729361545157e-01   +8.808823690533992e-01   +5.011460575163947e-01; +4.017999522160796e-01   +6.346617495755276e-01   +6.359342120206796e-01   +2.705451990080783e-01   +4.956143318001353e-01   +3.254210619398677e-01   +5.446491385644556e-01   +2.379237529214391e-01   +8.471556746176772e-01   +2.744735554312747e-01   +2.563979146098523e-01   +1.206893177574894e-01   +6.589184954424360e-02   +4.807039341616626e-01   +9.335819738063623e-01   +9.759327633786109e-01];
L2I_L1I_iGABA_netcon = [+6.706903159439790e-01   +4.840311679504187e-01   +7.338630333989521e-01   +5.489827294515127e-01   +9.528897472331018e-01   +7.148745662371472e-01   +9.166355530413217e-01   +1.787850322159825e-02; +5.120556978775535e-01   +6.799114244505436e-02   +1.747025015331753e-01   +8.823510416093570e-01   +2.039224313296206e-01   +9.022349971025427e-02   +8.555654556758240e-01   +7.297838909825636e-01; +1.000000000000000e+00   +5.068471415625756e-01   +6.628027693080878e-01   +6.245113066418151e-01   +8.261963265428075e-01   +7.413005323711995e-01   +2.821513418588922e-01   +1.955550558038616e-01; +3.613604623913044e-01   +1.801259690770146e-01   +9.273917363770436e-01   +4.006565450327753e-01   +7.669590227374647e-01   +3.391550602934125e-01   +8.903877727349335e-01   +1.784388051090824e-01; +7.209476221778454e-01   +4.754804401176708e-01   +6.424073002245853e-01   +2.677013972161559e-01   +9.378627366646186e-01   +4.012684087425689e-01   +5.688497818600164e-01   +2.301458535913893e-01; +5.309546519395705e-01   +5.976327600765572e-01   +7.856913715416923e-01   +2.184086837469446e-01   +1.868750678016797e-01   +8.003286105719263e-01   +9.516738916301728e-01   +5.918150332799479e-01; +8.959629348995095e-01   +4.510730851971829e-01   +2.265079163828440e-01   +2.738548602923112e-01   +7.525855437897792e-01   +2.096186791822734e-01   +6.064586808679449e-01   +3.621981078807391e-01; +9.628607755587186e-01   +3.948088306868874e-01   +6.719337833104124e-01   +9.433719686502652e-01   +1.083749676694013e-01   +4.595903983539606e-01   +4.646482884738897e-01   +2.443598629528342e-01; +7.345481443174524e-01   +2.048170652729874e-01   +4.684467576092100e-01   +3.790139576104781e-02   +8.074365372795853e-01   +3.426739818741979e-01   +7.655042742506086e-01   +7.395361054187440e-01; +4.316501928142150e-01   +8.739285038813284e-01   +6.777325789183586e-01   +8.347011654207949e-01   +4.198116907445097e-01   +8.309938662631473e-01   +9.211998371086459e-01   +2.843151109650731e-01; +5.124105129279882e-01   +6.198967701798836e-01   +4.728968658092062e-01   +4.330062153519349e-01   +4.706343484388939e-02   +9.011184513252948e-01   +6.479997552315698e-01   +4.624385129191403e-01; +2.953189240274627e-02   +4.134738197589105e-01   +3.592344572973894e-01   +4.152243884122699e-01   +3.881760646430393e-01   +5.503586148713847e-01   +2.649422804846334e-01   +5.635791780226131e-01; +3.912392029936348e-01   +1.798406968099610e-01   +6.321615933856422e-01   +7.390833826688978e-01   +2.321685425700097e-01   +6.463608571073786e-01   +4.155681471815596e-01   +7.601301755637299e-01; +4.558380702132513e-01   +4.648652007796180e-01   +7.347696007240592e-01   +3.779085927041367e-01   +8.869951811312368e-01   +3.979773712189135e-01   +3.403378805225777e-01   +3.113681369518153e-01; +6.489958064821596e-01   +1.781762074391167e-01   +2.975882639465450e-01   +2.744383776445133e-01   +5.611456461800526e-01   +5.739292077112363e-01   +3.400071564377435e-01   +6.949512875994678e-01; +7.723595729842081e-01   +5.397173928324284e-02   +7.300554774841681e-01   +2.528252459992076e-01   +4.219486497072999e-01   +6.587324134015552e-01   +9.975416477939580e-02   +3.048481560722872e-01];
L1I_L2I_iGABA_netcon = [+5.246828720230052e-01   +1.819721847449191e-01   +7.903902941150852e-01   +2.880806492761674e-01   +5.882528967929539e-01   +2.966458873242153e-01   +8.593671193857053e-01   +2.114883767077931e-01   +6.030532222311769e-01   +9.236330309144207e-01   +4.040081270024363e-01   +4.251808917539259e-01   -3.914858077406044e-02   +7.715276238730491e-01   +6.472169278789269e-01   +5.030633707361520e-01; +4.328991428663267e-02   +3.744515188618246e-02   +3.389017860831410e-01   +3.222333894524944e-01   +9.131915172143398e-01   +3.411578446764503e-01   +3.360872291666515e-01   +1.323915572989194e-01   +4.518667746858321e-01   +2.434707591775651e-01   +3.066758360920965e-01   +2.916598381298864e-01   +9.182598562951362e-01   +1.846381541348460e-01   +8.257700401178664e-01   +2.677773560799770e-01; +3.790992069553139e-01   +6.297888871327024e-01   +3.888090533018363e-01   +7.433886082066717e-01   +2.487144596968769e-01   +5.063537571557024e-01   +7.688089909358946e-01   +9.612140426780233e-02   +7.674738655805892e-01   +4.725677280065622e-01   +6.401035438957051e-01   +8.440497986427917e-01   +9.790227531554165e-01   +6.723600620186523e-01   +3.293125312772525e-01   +1.473005573255438e-01; +8.568010319372816e-01   +1.413853864760482e-01   +6.367209139471223e-01   +9.350805804348519e-01   +5.274543923334521e-01   +9.251797852982774e-01   +6.524920020097963e-01   +5.131063233238609e-02   +4.716823373197594e-02   +3.073295015681005e-01   +4.268471724748752e-01   +4.775014364851253e-01   +3.379425979064380e-01   +5.306660658454643e-01   +1.934136514193051e-01   +9.471225609103569e-02; +9.584434564612930e-01   +7.635158324369407e-01   +7.157981173316804e-01   +6.797184365979660e-01   +3.175368354878972e-01   +6.693468267912304e-01   +6.883725241786542e-01   +6.494085360153307e-01   +1.051472197560884e-01   +6.887329203300774e-01   +1.703982285410979e-01   +4.289872235803844e-01   +3.615657330683277e-02   +2.223788452824501e-01   +6.998620241539959e-01   +9.501941112220550e-01; +5.664535824495138e-01   +3.743601073772856e-01   +1.086870986392893e-01   +3.695143136971865e-01   +9.916121901631162e-01   +1.424156074746988e-01   +7.073773912633936e-01   +6.621678407689288e-01   +5.524417929182220e-01   +7.132553299787100e-01   +3.248771018385436e-01   +4.853428781226213e-01   +8.906543534830414e-01   +8.909876593346897e-02   +1.877270252707726e-01   +5.267110897661924e-02; +8.280481947266184e-01   +1.018668569703816e-01   +4.039401132424796e-01   +3.148748270415246e-01   +5.679404097773898e-01   +9.098181398808590e-01   +7.923356492089999e-02   +2.148423573460478e-01   +7.424279775707371e-01   +9.234756331118097e-01   +9.206505932363122e-01   +8.790534315480556e-01   +1.388403205448762e-01   +3.160801848757305e-01   -1.870493754020613e-02   +6.265792700469922e-01; +9.008829565684338e-01   +3.797218578250345e-01   -6.932468192250585e-04   +9.076013332612668e-01   +1.383255822384644e-01   +1.000000000000000e+00   +8.184435065939738e-01   -8.841458332143750e-03   +8.167957355891208e-01   +6.892260891821747e-02   +9.334224060542758e-01   -8.364517677349860e-03   +8.173004902286789e-01   +5.849503139591122e-02   +9.923522628993600e-01   +6.819594549304354e-01];
L2E_L1E_iAMPA_netcon = [+2.587616573340994e-01   +9.050187382937639e-01   +6.582834603599989e-01   +4.627054930058332e-02   +2.968436423910419e-01   +3.829394552539238e-01   +7.934620199977770e-02   +6.363912735273342e-01; +2.504535327148854e-01   +1.959889937883950e-01   +7.795362185073561e-01   +9.097461240978766e-01   +3.410796845991551e-01   +5.430185435880064e-01   +2.798351126535357e-01   +1.511014766028321e-01; +4.943779249697939e-01   +8.827983434544570e-01   +7.788220259528668e-01   +2.981565207171253e-02   +6.627727419198168e-01   +7.951509316741615e-03   +4.130315812811403e-01   +8.538687671089497e-01; +5.332662172845146e-01   +6.414498507096503e-01   +6.090905709594993e-02   +5.967778229716038e-01   +2.999619775382226e-01   +5.056672435549572e-01   +2.038277804417909e-01   +4.673078246132608e-01; +8.698050682963933e-01   +7.181779999108787e-01   +7.899279567790916e-01   +5.401181429638098e-01   +7.581107981767512e-01   +3.776285045779402e-01   +4.572931676986833e-01   +4.864618158179704e-01; +4.813706388423206e-01   +6.860053597441487e-01   +4.143796116233098e-02   +6.001060513882296e-01   +6.756419277628112e-01   +8.481786658907278e-01   +2.776603485026318e-01   +6.816633981146694e-02; +4.690504560916368e-01   +3.300605408980492e-01   +2.233463889010717e-01   +4.197851656659585e-01   +3.774502616325985e-01   +2.624438682172446e-01   +5.755394646745415e-01   +2.796182663639308e-01; +6.966037350556017e-01   +1.479809694024527e-01   -1.483608457842658e-02   +9.657860363310155e-01   +4.968502269856733e-01   +3.608405403175927e-01   +5.630637167002409e-01   +5.935519593834225e-01; +7.882161249117504e-01   +6.036797803606117e-01   +6.565950915687720e-01   +1.067066444404065e-01   +3.939584522376809e-01   +2.544737809635715e-01   +4.799548999281904e-02   +9.936155501768248e-01; +2.581915790751260e-04   +1.316875695063121e-01   +1.493671497169832e-01   +1.699423591048581e-01   +1.867180255526812e-01   +5.841173822199063e-01   +8.711307471955584e-01   +8.151847334449519e-01; +4.353514369119944e-03   +2.543059769725232e-01   +5.760371148976180e-01   +5.212631285816332e-01   +1.447810895117760e-01   +4.445791309945662e-01   +1.905000143577936e-01   +7.297462107800291e-01; +3.595854797804497e-01   +5.351492295546549e-01   +5.982990627808502e-01   +5.124284331377831e-01   +7.057864884058761e-01   +3.206504278926592e-01   +6.559287493673946e-01   +4.375366658549044e-01; +6.756959022879652e-01   +7.181623160326710e-01   +6.288624942881803e-01   +2.401919903696458e-01   +1.870693767069222e-01   +1.130906606119326e-01   +7.331754106767278e-02   +5.287015276151011e-01; +7.133357395663653e-01   +7.909276354640395e-01   +4.572691596397227e-02   +9.010527723356131e-01   +4.974045622167568e-01   +8.367130381986326e-01   +4.825554147202352e-02   +2.143062460523929e-01; +9.348801385548854e-01   +2.096772125675464e-01   +4.299727466176648e-01   +5.723420021166649e-01   +3.480778509618616e-01   +2.343003321147428e-01   +5.853273595233195e-01   +3.795566441091426e-01; +8.147571033965421e-01   +6.233283098000854e-01   +6.868039688850407e-01   +3.380783631420948e-01   +4.889781170923653e-01   +8.789736610026008e-01   +7.539278156261252e-01   +1.213294520089133e-01];
L1E_L2E_iAMPA_netcon = [+8.736293138510480e-01   +4.723375154013493e-01   +5.895826865713376e-01   +1.211393565594241e-01   +9.558645959546692e-01   +3.068278053415827e-01   +5.564548780460429e-01   +5.006219053380583e-01   +9.322589307996737e-01   +5.556995162386720e-01   +6.436683966431531e-01   +4.910331966197584e-01   +5.023613784877403e-01   +3.362140679988239e-01   +5.646068303220148e-01   +2.424514803305898e-01; +7.917071260922255e-01   +2.019715330101188e-01   +1.178485264432770e-01   +5.574958137323326e-01   +8.208119003927409e-01   +5.935675144738783e-01   +8.938015720722690e-01   +2.135056811360926e-01   +3.573942141545429e-01   +3.332188732403460e-01   +7.352800560042128e-01   +6.857383097377204e-01   +6.806889463955504e-01   +9.156880351350213e-01   +3.820931466738110e-01   +5.281277659411857e-01; +8.127989734758332e-01   +1.180084880608919e-01   +1.417579100973255e-01   +1.000000000000000e+00   +2.407302658645879e-01   +3.826307283667624e-01   +9.150542797013788e-01   +2.888259976494239e-01   +1.927067129097628e-01   +6.165112956596351e-01   +8.101052948379810e-01   +4.774218022257754e-01   +8.497225573940190e-01   +9.752700221173796e-01   +8.211797282177014e-01   +6.272432220739868e-01; +7.131768435258017e-01   +6.823303105020702e-02   +5.289302071539893e-01   +3.624084974726695e-01   +4.345678466735466e-01   +8.789631458640493e-01   +2.082820399760502e-01   +1.357074851978585e-01   +5.857634404678118e-01   +4.574515620548242e-01   +3.824087591010337e-01   +9.677702506337696e-01   +7.368755871042917e-01   +3.103629068582259e-02   +7.581712360656725e-01   +8.216440205325767e-01; +1.915296627410997e-02   +2.432181460293470e-01   +1.546029669758511e-01   +7.788172977693263e-01   +2.387390980519535e-01   +4.673046486313138e-01   +9.733309420290942e-01   +3.162882994270277e-01   +7.626182825682783e-02   +7.675692728272017e-01   +6.609967621666940e-02   +5.553671416632734e-01   +1.104902474232630e-01   +6.307104500268093e-01   +3.989557284741695e-01   +1.346949427303694e-01; +6.368998925023538e-01   +4.584862626534232e-01   +3.690413590214068e-01   -9.698364564291619e-02   +9.067423398247620e-01   +1.137858907621179e-01   +4.771517808266190e-01   +1.886222420882153e-01   +7.402387109523140e-01   -4.878786790134158e-03   +7.752076925696144e-01   +8.689916074447841e-03   +7.535998767995612e-01   +5.052831718494074e-01   +7.391459361673964e-01   +3.391543078964838e-01; +2.735803033626821e-01   +6.482354862458060e-01   +3.581178970601494e-01   +3.810361651443051e-01   +3.576451753313664e-01   +8.698797007239301e-01   +9.380305391469884e-01   +4.227985089268153e-01   +6.851154500627716e-01   +7.627840425416405e-01   +3.342163116270442e-02   +1.494876816036175e-01   +1.113645975751379e-01   +3.754887579364410e-01   +3.393842334798711e-01   +7.886336061037836e-01; +1.866051515139178e-01   +4.517520668171497e-01   +3.257808375159695e-01   +4.625935759959486e-01   +9.472099211933523e-01   +4.693435556315185e-01   +9.876435993697426e-01   +8.682692462679972e-01   +3.964769745846889e-01   +2.738972615981746e-02   +3.966320916391015e-01   +3.631706201153939e-01   +3.560415366953246e-01   +7.379563325737531e-01   +1.005641068317045e-01   +5.280511884657378e-01];
L2I_L2E_iAMPA_netcon = [+3.620963284726156e-01   +2.679942209098000e-01   +3.740870575520692e-01   +5.878482468310186e-01   +1.987578897032968e-01   +8.569435865387031e-01   +6.928603139111033e-01   +3.007221421241229e-01; +5.183541874462538e-01   +1.933693559176406e-01   +6.666435443077446e-01   +2.659949971816747e-01   +6.656806009247616e-01   +8.204028669883551e-01   +5.835387438670938e-02   +4.888176301443697e-01; +6.297132562468583e-01   -5.219742799017287e-03   +7.036878650512527e-01   +6.248740976895623e-01   +1.538311584105343e-01   +5.660794591871865e-01   +7.730396636144400e-01   +8.965335567001344e-02; +5.189268981040814e-01   +2.689135086743821e-01   +4.002843528958663e-02   +9.495623113018914e-01   +3.580751726898504e-01   +6.165181691517274e-01   +9.704130705037421e-01   +2.148688523375220e-01; +1.585973906778856e-01   +4.329623418413546e-01   +4.215140391035274e-01   +8.351216821421156e-01   +8.517653287660130e-01   +5.600215931137611e-01   +7.105952486434624e-01   +2.962385225212918e-01; +9.171927930532092e-01   +5.086848530299288e-01   +9.150256942841102e-01   +8.794558937220115e-01   +6.926451317426807e-01   +8.636319527759904e-01   +8.836747946176391e-01   +5.042368510793765e-01; +1.338217328393494e-01   +5.421237288723423e-01   +9.137395997988242e-01   +8.769336332800443e-01   +8.323147579810740e-02   +7.342452958836584e-01   +2.238102902939198e-01   +1.269337046001757e-01; +5.428579751641953e-01   +3.716212849207328e-01   +1.723031292030952e-01   +2.611905713545079e-01   +7.716808320781446e-01   +3.914582845312061e-01   +9.755953672205658e-01   +6.056086483870029e-01];
L2E_L2I_iGABA_netcon = [+4.447794229805480e-01   +6.129388669641059e-01   +6.174941948351150e-01   +6.470763302766662e-02   +4.768474480915781e-01   +5.041219674009987e-01   +2.674326893653223e-01   +7.527460988479550e-01; +4.038584815135461e-01   +3.635931705604248e-01   +3.059304841879707e-02   +4.834115777090729e-01   +4.634695488765189e-01   +5.981922520331010e-01   +5.008179946979437e-01   +4.912916500517141e-01; +5.768246313362536e-01   +5.248806474414738e-01   +4.078283099131727e-01   +5.787248812226420e-01   +3.245406652620916e-01   +2.376259784321124e-01   +1.978887395614124e-01   +1.000000000000000e+00; +7.569278324448434e-01   +5.533523599142003e-01   +3.729992179372574e-01   +8.586395944388044e-01   +2.226714154033749e-01   +6.634589832773757e-02   +1.575534924988140e-01   +4.171956100872841e-01; +5.322762198177524e-01   +7.860534330114788e-01   +5.204066678239628e-01   +7.734326528706859e-01   +3.796744408815463e-01   +6.956726033703494e-01   +6.370920240296785e-01   +3.371256882882472e-01; +3.842307780824295e-01   +2.618824577151450e-01   +4.709072241437650e-01   +3.660800892165547e-01   +7.948949693778879e-01   +8.384997458806911e-01   -1.205787635137780e-03   +4.432399070237293e-01; +1.613941877502132e-02   +4.676984585709184e-01   +8.509157968955329e-01   +5.859639807246761e-01   +5.025472843097232e-01   +4.001509243366849e-01   +9.289283424948506e-01   -5.271232728373048e-02; +8.643201017998993e-01   +5.489501062787260e-01   +8.817216008419206e-01   +4.729434130271188e-01   +8.830638217737562e-01   +5.143671437655541e-01   +3.249324502338259e-01   +3.586800877120236e-01];
L3E_L2E_iAMPA_netcon = [+2.438234205905005e-01   +8.907022397223744e-01   +4.431512296410991e-01   +7.882329415617420e-01   +1.446576779317275e-01   +4.218590483061517e-01   +4.184078930939257e-01   +9.913934983571247e-02   +1.347851997529799e-01   +5.532248344064458e-01   +1.481183044631309e-01   +4.664941858456824e-01; +2.754144961490647e-01   +4.498690139564174e-01   +1.586601342051067e-01   +2.096157400092830e-01   +5.913372895315636e-01   +9.092723304725473e-01   +6.984378178205496e-01   +5.849418041791233e-01   +2.662741108027620e-01   +4.872124072777329e-02   +1.271967677719366e-02   +5.303210605178679e-02; +8.035777747474673e-01   +3.634602975540208e-01   +5.497368678335919e-01   +1.348483432636313e-01   +8.530910189999383e-01   +8.818809779755650e-01   +5.239445805579042e-01   +6.469740616600529e-01   +7.120176688181062e-01   +3.609377596011397e-01   +4.357440015781593e-01   +9.168347283234900e-01; +1.652742171913963e-01   +4.514868515878469e-01   +1.728242354775686e-01   +8.368600842974876e-01   +4.846589298837314e-01   +5.873838383797022e-01   +8.702735156381637e-01   +2.754803456868442e-01   +8.436024685161112e-01   +8.264609382229031e-01   +4.566180591531457e-01   +2.040993948063109e-01; +2.042506911272792e-01   +8.139946076016534e-01   +4.509178660182305e-01   +4.113191982208966e-02   +2.263028289880281e-01   +9.991818834484218e-01   +2.213722309883831e-03   +6.679155210743181e-01   +5.523336992935015e-02   +8.453128706002149e-01   +2.632602403303979e-01   +2.321850994709799e-01; +3.732838616319626e-01   +3.789003411693079e-01   +8.312285277565217e-01   +9.898771672588904e-01   +3.686225605167228e-01   +9.440184015654349e-01   +8.183173242763701e-02   +3.656349020438718e-01   +5.169900868165340e-01   +8.232005070191422e-01   +6.190847736492814e-01   +8.578366324169835e-01; +1.669003448514845e-01   +4.774040537375901e-01   +5.730227581576733e-01   +9.018434676063052e-02   +6.579289844099071e-01   +5.116047861359856e-01   +7.913352288369784e-01   +1.403728120329689e-01   +4.529050305852984e-01   +4.004933594854125e-01   +9.584127927382560e-01   +7.443089834818770e-01; +5.870150279306037e-01   +1.183408152355326e-02   +4.086116174787713e-01   +1.707569428024093e-01   +2.760241923309121e-02   +8.857762009922643e-01   +3.972440885036496e-01   +4.564915250383106e-01   +8.647200362573548e-01   +1.000000000000000e+00   +9.469603543056943e-01   +3.295442421376725e-01];
L3I_L2I_iGABA_netcon = [+1.606010231804018e-02   +1.423427822318090e-02   +8.830314069802671e-02   +6.703269044244007e-01   +3.788792845990885e-02   +5.100039854929144e-01   +8.434723390375778e-01   +3.863808837176812e-01   +4.382686215243793e-01   +9.650060796007891e-01   +8.445035499833193e-01   +6.124059675885333e-01; +3.677675866555907e-01   +4.461917080054450e-01   +3.118601416548450e-01   -8.506287281801875e-03   +4.643642393551231e-01   +5.970963355421237e-01   +4.817106246976510e-01   +9.325479793284837e-01   +1.369794615789217e-01   +9.065613535076406e-01   +2.756945532741710e-01   +6.364315222302184e-01; +3.398063296851216e-01   +6.856605506583452e-01   +2.912202016862337e-01   +8.004115155914127e-01   +3.329360452624038e-01   +8.706541706278088e-01   +9.542279047803847e-01   +2.087094391329290e-02   +6.470406608188995e-01   +5.177078008022179e-01   +1.346460900779458e-01   +6.006473642061758e-01; +6.289832502302907e-01   +9.697033343424948e-01   +3.247725859891979e-01   +2.714627961187537e-01   +1.372061015173764e-01   +5.899407009077120e-01   +1.802813178624617e-01   +2.538930177988358e-01   +8.048894663958163e-02   +3.238914882931282e-01   +5.290718378411058e-01   +7.904736846859681e-01; +9.691125320816647e-01   +1.286114124383147e-01   +4.929922376998213e-01   +8.397800421198481e-01   +4.863187917607404e-01   +9.092109867802627e-01   +9.125243420859148e-02   +5.410676990093704e-01   +6.012220227364036e-01   +8.171474813126667e-01   +7.833667734865589e-01   +5.171062109153495e-01; +9.079563192471576e-01   +1.697321586079243e-01   +1.313147773974696e-01   +7.574852903585535e-01   +9.252319543250702e-01   +7.469124736078526e-01   +9.256202526782042e-01   +5.856485952807560e-01   +1.181973369106324e-01   +8.309388902485442e-01   +3.606165778088306e-01   +6.104728374271334e-01; +8.938507066013682e-02   +5.378216797967961e-01   +9.466939274905988e-01   +5.393868893224434e-01   +9.395820128615489e-01   +8.083322582353044e-01   +8.263411017009775e-01   +8.028989390515550e-01   +6.273598172255307e-01   +3.904585057107955e-01   +3.331475412066925e-01   +5.496543003364840e-01; +3.136784189231362e-01   -9.391263249290682e-04   +7.659549754005022e-01   +1.776844109466322e-01   +4.646120698460185e-01   +1.043663265878600e-02   -3.189062028499115e-02   +9.704781880111553e-01   +4.790704546195865e-01   +9.437368658085885e-02   +7.272753907989884e-01   +5.823450357455336e-02];
L2E_L3E_iAMPA_netcon = [+9.159631720807840e-01   +2.538824277569207e-01   +5.407083289073150e-01   +7.088076626527604e-01   +4.411235574658298e-03   +7.231572346412337e-01   +7.841014440535222e-01   +7.982586942457251e-02; +3.061872056567007e-01   +5.785107470695934e-01   +6.906051629018565e-01   +7.256173748046250e-01   +2.257933850340281e-01   +2.383676591740379e-01   +7.980745190111276e-01   +9.929055174042492e-02; +6.136678834840190e-01   +5.556020825971614e-01   +8.694503596001353e-01   +6.384410477156515e-01   +9.125177996653414e-01   +4.289098963514378e-01   +9.985180328339333e-01   +4.816028425590623e-01; +2.061860828087539e-01   +9.193275750334825e-01   +8.627870022719707e-01   +4.154370942992314e-01   +4.011268502644881e-01   +9.741081377991955e-01   +2.703148851192809e-01   +5.256927463027572e-01; +6.474420033553527e-02   +2.151304922407128e-01   +6.923743981492252e-01   -3.898292657475191e-02   +1.800606554214474e-01   +5.402373315473006e-01   +4.666202593378744e-01   +6.712400748570273e-01; +3.754492008618956e-01   +7.822233417930032e-01   +1.539880377294949e-01   +7.983393797203482e-01   +5.626829303322322e-02   -9.551925334296756e-03   +5.037388837187136e-01   +2.884097278520324e-01; +4.788533454551183e-01   +7.538022252785479e-01   +8.012286728192722e-01   +2.664705084845643e-01   +8.159949677144440e-01   +1.715954478678523e-01   +7.078801777123730e-01   +9.146496398830039e-01; +3.035402417080959e-02   +5.654202913820953e-01   +9.073473375781289e-01   +4.603265101076909e-01   +9.295419532979632e-02   +7.100102555279799e-01   +1.025995512814439e-01   +3.442990080244823e-01; +1.000000000000000e+00   +8.957163303928525e-01   +7.972471670240398e-02   +1.578972447601084e-01   +1.056669196955173e-01   +8.636560850966728e-01   +2.917544207084852e-01   +9.108700910876657e-01; +1.632923236937366e-01   +3.767205997960311e-01   +8.200969558162503e-01   +3.439037039822896e-01   +4.024607579508556e-01   +8.776139364667287e-01   +3.950992697706264e-02   +9.459954821630855e-01; +6.738424515154806e-01   +3.700422013286455e-01   +2.658662983393748e-01   +2.491036377538637e-01   +1.425446758102720e-01   +3.309911167986531e-01   +1.895361543146146e-01   +7.473829389962064e-02; +1.159972619738158e-01   +6.262322386831436e-01   +7.974991116967167e-01   +4.413610933659601e-01   +2.507023641941554e-02   +7.653197182134825e-01   +7.795754916078290e-01   +7.777329075174144e-01];
L2I_L3I_iGABA_netcon = [+3.552738917322614e-01   +6.304400888440490e-01   +2.425788726690612e-01   +6.612049429192091e-01   +5.094305725353995e-01   +4.405621251088064e-01   +3.872134196492547e-01   +5.034095853663910e-01; +3.474706900020766e-01   +1.418259907945763e-01   +4.244815900130404e-04   +8.424050647431345e-01   +6.839707710653519e-01   +7.270319264335622e-02   +9.307989885216432e-02   +6.130710598474609e-01; +3.436421793635467e-01   +6.146525598562939e-01   +4.113259129104845e-01   +1.004135683998786e-01   +8.292169811739208e-01   +6.156242095811932e-01   +1.818053097192195e-01   +1.109278005685242e-01; +6.217249416257092e-01   +8.716836643980912e-01   +6.105456442020640e-01   +4.458892435410184e-01   +5.163727732244564e-01   +6.759167795286537e-01   +4.028912865854312e-01   +6.947651817072272e-01; +7.888906190958261e-03   -6.143659324555609e-02   +1.092624284003748e-01   +6.891118093074562e-01   +1.989629815603823e-01   +6.764761012940194e-01   +4.965378961221623e-01   +2.863183824463457e-01; +5.108586008549242e-01   +4.424529729838299e-01   +4.345239398740863e-01   +6.726554767755391e-01   +2.680365411045217e-01   +8.240654856714641e-01   +3.814146605791461e-01   +1.273662248245485e-01; +2.603994646531111e-01   +1.920137077372235e-02   +4.575916701817628e-01   +1.000000000000000e+00   +6.187864701924641e-01   +1.038464648284196e-01   +2.534806049255020e-01   +8.462129593244555e-01; +2.038239281100144e-01   +9.185244099972666e-01   +9.118553279099330e-01   +9.310875701164036e-01   +4.809067537879838e-01   +1.223667117222522e-01   +7.427333398051145e-01   +1.424259695789606e-01; +3.463234897317168e-01   +5.555801941826957e-01   +2.808844606577545e-01   +1.755181725542061e-01   +3.782203968408183e-01   +2.503856710805536e-01   +5.751051405759940e-01   +4.534569493004671e-01; +4.066595755376303e-01   +2.100658252419055e-01   +2.137423460086003e-01   +3.896033879433873e-01   +9.193909923173724e-01   +4.795476495783978e-01   +4.715140008672975e-01   +9.317823671266798e-01; +6.247112353792780e-01   +8.587606788994193e-02   +2.788618497866204e-01   +5.500651580460078e-01   +5.264460138288176e-01   +7.236301316323303e-01   +9.035442108544810e-01   +5.979763330938286e-01; +3.618812200451213e-01   +1.952012265837726e-01   +6.076565380218468e-01   +2.871216533994244e-01   +1.066957025129558e-01   +1.906554947556946e-02   +3.137938725109519e-01   +6.583592315434147e-01];
L3I_L3E_iAMPA_netcon = [+1.380773669116297e-01   +6.787717089115184e-01   +7.537525459852290e-02   +1.959157223469755e-01   +2.991837023650770e-01   +6.306920737092738e-01   +5.569074706979982e-02   +3.094858618574198e-01   +5.132451405906016e-01   +3.353591454627620e-01   +6.073314813518903e-01   +9.146994552002309e-01; +3.885588745297807e-01   +8.526492178762567e-01   +2.320601375871541e-01   +3.684891388554301e-01   +7.790160230981644e-01   +4.073396099862956e-01   +3.916990757790910e-01   +4.090008914156658e-01   +6.481444079335853e-01   +2.809543696786345e-01   +7.246529425908512e-01   +1.965665006809119e-01; +4.837157423647127e-01   +3.935066836058669e-01   +8.105282287596683e-01   +8.759599521901712e-01   +5.848947772242935e-01   +6.096981634263438e-01   +9.992518613868631e-01   +4.406125733512523e-01   +2.082701546239262e-01   +3.185757787451716e-01   +9.462803970871982e-01   +8.473190659883267e-01; +5.134292898718784e-01   +1.182788709269972e-01   +5.402440800531505e-01   +7.488308892564279e-01   +4.319299791671586e-01   +5.990673030904843e-01   +5.707877090230715e-01   +6.906662549227196e-01   +5.116713064856118e-01   +2.114396344023869e-01   +4.516144336084222e-01   +4.858746713506485e-01; +9.087301774445651e-01   +8.431679290494597e-01   +6.131510778672581e-01   +5.126842334245455e-01   +2.302482381015222e-01   +3.223282051197462e-01   +3.220126593289876e-02   +2.305219511027765e-01   +7.547809663747395e-03   +2.693723849321718e-01   +3.435109624903413e-02   +5.081524405324060e-01; +3.728449590189057e-01   +2.088891141160233e-01   +6.519832875285518e-01   +4.538309739854755e-01   +9.932062821406569e-01   +5.978702754966538e-01   +2.808190212652994e-01   +7.195483488693326e-02   +1.759754661683464e-01   +5.814602067378153e-01   +3.039669452344796e-01   +9.268967194502964e-02; +4.740459779064893e-01   +2.136086139463386e-01   +8.476489541050848e-01   +8.502702395239098e-01   +9.448997939932814e-02   +2.938191114893328e-01   +3.959188270092495e-01   +1.479194951254237e-01   +9.018908274054969e-01   +7.294307876272903e-01   +3.084935662103887e-01   +5.160959465026659e-02; +3.902375696376442e-01   +4.085785190272336e-01   +2.813350851705043e-01   +6.100144750110393e-01   +8.512958255412024e-01   +2.289169481263695e-01   +4.017593425034839e-01   +3.133294236465567e-01   +3.092056212412399e-01   +2.473445304066182e-01   +7.003227341870587e-01   +5.511295791384428e-01; +3.276566533808904e-01   +5.472931732000550e-01   +3.883358796365051e-01   +5.774183273717283e-01   +5.730138152563365e-01   -2.684277629081255e-02   +7.995368854043813e-02   +5.277593662105404e-02   +3.184730828150404e-01   +2.190508634337343e-01   +8.872317963241030e-01   +8.632938957144985e-01; +7.348197152087717e-01   +5.967708522321734e-01   +5.579670382122189e-01   +4.020659476549236e-01   +4.453956609686839e-01   +4.282259224687608e-01   -6.745756362330732e-02   +6.568178134823281e-01   +4.034247831964055e-02   +9.275184695523424e-01   +4.909218839844522e-01   +1.299172988368788e-01; +7.365919793286391e-02   +2.878464772143579e-01   +6.643095111421143e-01   +2.656075971143007e-01   +5.816732465943120e-02   +5.094447047694295e-01   +7.810502093366521e-02   +7.743785668482674e-01   +7.308365791579340e-01   +1.729243373191164e-01   +6.891983169651199e-01   +2.893872078929944e-01; +6.140549583276385e-01   +6.352547008892122e-01   +3.761555827885610e-01   +6.317812329342040e-01   +6.608269025757320e-01   +4.121728710339215e-01   +3.034707662689808e-01   +7.772493511938457e-01   +6.311834433599376e-01   +4.387227304194229e-01   +5.293106690188142e-01   +4.180354886691728e-01];
L3E_L3I_iGABA_netcon = [+3.431592701355330e-01   +7.009650766635551e-01   +6.848573728773129e-01   +8.461893847083506e-01   +4.560550437957561e-01   +1.251369972936885e-01   +2.626444751384694e-01   +7.318249828871242e-01   +7.713162445527463e-01   +2.748263913983696e-01   +4.644841977186965e-01   +2.884077291897504e-01; +8.488791375309775e-01   +3.679277576907351e-01   +6.591023354799782e-01   +5.716048384562133e-02   +8.688437045166630e-01   +4.173312493451522e-01   +8.287280796406813e-01   +7.162998204434871e-01   +6.096304154005666e-01   +7.227964010644626e-01   +2.230481957817597e-01   +4.916084822763160e-01; +8.072701964899412e-01   +3.056705237197844e-01   +4.188335621913521e-01   +4.580745058118558e-01   +5.870765131493403e-01   +5.496597656206138e-01   +2.473785472554030e-01   +8.392649070043754e-01   +5.530279503450100e-01   +1.588280011913039e-01   +7.642558301980475e-01   +8.841460173151338e-01; +1.609015572149974e-01   +6.606994072647437e-01   +3.403926061819132e-01   +2.848074963432047e-01   +1.256296694172521e-01   +6.891641634988797e-01   +2.731552683459416e-01   +8.037157555801638e-02   +3.048491039420693e-01   +4.997758043988458e-01   +7.485162359528614e-01   +5.677129757705567e-01; +2.130563992066793e-01   +7.085160612563031e-01   +5.732406085113159e-01   +2.891290946165209e-01   +1.348679966743098e-01   +5.914757173511968e-01   +9.167388866160264e-01   +2.823731317926790e-01   +2.672096618873854e-01   +8.325760785674388e-01   +6.040136440419913e-01   +1.934149623252084e-01; +4.744477622543683e-01   +8.396855944730199e-01   +7.348960960600247e-01   +4.932820433540399e-01   +7.714549929030818e-01   +1.198385513980586e-01   +3.680301299326063e-01   +3.127851787366955e-01   +8.607453217589378e-01   +8.411889154247366e-01   +8.111123667650326e-01   +2.759284411960861e-01; +5.593493402389794e-01   +7.712883177603440e-01   +1.987117360586172e-01   -5.984431956019724e-03   +4.119440973997426e-01   +6.452537899512354e-01   +5.950819801896485e-01   +1.912126140642878e-01   +9.613710388744970e-01   +5.905059608060432e-01   -1.543776167980287e-02   +3.705141145305496e-01; +4.553754103334240e-01   +4.094736470566422e-01   +8.694526874482436e-01   +3.930670152017158e-01   +1.030546408955542e-01   +9.843191797842217e-02   +6.087476945787889e-01   +6.986575047899263e-02   +6.189627012281482e-01   +7.872803593138800e-01   +2.020168382869665e-01   +1.000000000000000e+00; +3.123167735705520e-01   +5.538102752390139e-01   +2.678475807205236e-01   +7.396347721746137e-01   +8.596270319960092e-01   +3.105017380360565e-02   +3.444716729412644e-01   +5.794779195119802e-01   +6.151871522628110e-01   +8.902228288803844e-01   +7.018838460642500e-01   +6.305616856865379e-01; +6.698050701917128e-02   +2.502056409454564e-02   +3.446817942046249e-01   +5.903770830864623e-01   +7.718208092325171e-01   +2.005560379929764e-01   +1.298123166118632e-02   +3.356129956884532e-01   +6.519999148166188e-01   +2.764873124068677e-01   +5.965990030831180e-01   +2.512322842312727e-02; +8.893619162754990e-01   +5.193550451468236e-02   +7.003452067076570e-01   +4.874478164432748e-01   +3.988918781857398e-01   +8.639550916175639e-01   +1.201783404366610e-01   +8.189915316917027e-01   +3.416040740350337e-01   +9.507141879873900e-01   +4.982773894151946e-01   +7.295558422409221e-01; +6.518440992203870e-01   +8.235562306862303e-01   +5.094326964024399e-01   +8.802201284705570e-01   +8.508042089926303e-01   +4.831724056102422e-01   +9.435001597117546e-01   +8.867121791192707e-01   +4.465856190406310e-01   +8.972605720351297e-01   +5.037541822154200e-01   +8.903543175291193e-01];
L2E_Input1_iAMPA_netcon = [+9.843002526971594e-01   +9.521241890413153e-01   +9.471025746536315e-01   +9.733688012714565e-01   +9.012006688790791e-01   +1.000000000000000e+00   +9.385294265707286e-01   +9.406159455337251e-01];
L2I_Input2_iAMPA_netcon = [+9.305857116127991e-01   +9.598266411896927e-01   +1.000000000000000e+00   +8.934943819788516e-01   +9.122842157664194e-01   +9.299800094636028e-01   +9.219130647639556e-01   +9.536256158069308e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
