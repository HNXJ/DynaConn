function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.183499609629729e-01   +3.995194935774105e-01   -5.881104697787618e-02   +1.158125723957755e-01   -1.707000011700112e-01   +1.014682923133829e-01   -3.028405145127590e-01   -7.000651744573799e-02   +7.150104273674592e-01   +1.834073374467891e-01   -2.273515029653219e-01   -4.726794218857968e-01   +3.936943496838538e-01   +2.413713405364926e-01   -1.593893897578967e-01   +1.923420161284317e-01; -7.792897653009575e-01   +2.651789958961286e-01   +3.345999320769114e-01   +1.971367578457055e-01   -2.755341685761638e-01   +4.138992043184967e-01   -9.497045844511857e-02   +4.255490499478371e-02   +1.009293776802964e-02   +7.573608637269262e-01   +3.270098299008511e-01   +3.056457806707910e-01   +6.604158780829787e-01   -4.104235630539640e-01   +6.168791271924685e-02   +1.251083056380584e-01; -4.313237649660784e-01   -3.328390505607182e-01   -4.938866060721600e-01   -5.093003126776170e-01   -4.557930042922973e-01   -2.645651028636543e-01   -1.529566365385348e-01   -3.941001729947633e-01   +5.458910366377017e-02   -8.527272897676771e-01   +1.522779141496411e-02   -2.107389730237327e-01   +1.184775857305717e-01   -8.473874210908655e-02   +3.451495575800064e-01   +4.164367694172301e-01; +8.771826960475179e-02   +6.168665369859176e-01   +5.474115841952648e-01   -1.584791901436678e-01   -5.618084238106190e-01   -1.444623165316589e-01   -5.856838043514259e-01   +6.756189275718900e-02   +4.139804133759186e-01   +1.264248420683713e-01   -4.476646853771784e-01   -2.190342389705661e-01   -7.930688103692086e-01   -1.229436428845594e-01   +2.586399343365195e-01   -2.030157373918199e-01; +4.925656685074672e-01   +5.067761796909662e-01   -1.571182635790352e-01   +1.616890513639201e-01   -2.503704914936147e-01   -3.697688003875476e-01   -3.360743072286781e-01   +4.096476174914817e-01   -1.634697587372894e-01   +2.474597509768447e-01   -4.665325105226479e-01   +6.287002086351152e-01   +6.667186206776395e-01   +9.223509444310178e-02   +4.912756471339002e-02   -8.086209700826386e-02; +2.597150424837868e-01   -8.414031082609380e-02   -2.293323868958154e-01   -3.422063460817872e-02   -6.900238376963765e-01   +3.249469432470998e-02   -3.568565952459247e-01   +4.730996898503211e-01   -8.432472942657017e-03   +6.209823638053935e-01   -2.359436821912458e-01   -4.200891017766870e-01   -4.637818941051320e-01   +6.259531788495687e-01   +1.166228304004589e-01   +2.745935756010460e-01; +1.266090516694060e-01   -1.071279908951076e-01   -3.568549792496316e-02   -2.308547942789710e-02   +7.543115627365734e-04   -3.707145058857741e-02   +3.538989652682905e-01   -4.444674502366020e-01   +4.832048351250119e-01   +4.452785177218482e-01   -1.000000000000000e+00   +3.827533111857209e-01   +1.318164569106916e-01   -1.422352020132218e-01   -1.466366413834923e-01   +5.272154757017985e-01; -2.289212267317189e-01   +1.603744472389143e-01   +1.159227138042105e-01   +3.091225276002825e-01   -6.200037211870552e-01   +4.474006519760391e-02   -2.337644423628452e-01   +3.084192979357976e-01   +3.078212710832763e-01   +8.362376983011620e-01   +1.721871950441440e-01   +9.972200056706848e-02   -1.752517227785524e-01   +6.244576643827633e-02   +2.212503369382126e-01   +4.332374273143993e-01; +4.684086875690993e-02   +4.974097566596423e-01   -2.172302209657345e-01   +1.628828073426997e-01   +1.420742418990405e-01   +2.347765935363192e-01   +9.569818361722122e-02   -1.787160412156898e-01   -1.613399319316476e-01   +3.348854648619706e-01   -4.431136231506345e-02   -6.815225555183442e-01   +4.203255924202905e-01   +3.365058349506978e-01   +2.204147390926900e-01   -1.111720792162620e-01; +7.291143861853233e-02   -1.798654881826054e-01   -6.413097011160163e-01   -5.610398467871099e-03   +9.588353204889004e-02   +4.647274295805870e-01   +2.513929112532009e-01   -4.432179894305812e-01   +2.275614403628040e-01   -4.936937359087668e-01   -1.808379103363610e-01   -4.866985891077262e-01   -4.739901474038853e-01   -1.120731920861019e-01   -1.415219733739457e-01   -2.110403699873767e-01; -1.691147805920856e-01   +1.329351343091828e-01   -5.815328841991291e-02   -3.561283864715275e-01   -1.400761669709070e-01   +1.117056119679665e-01   -1.132204690222134e-01   -5.409297767503944e-01   +2.248674911995755e-01   +5.102579719841366e-01   +4.629576249337883e-02   -9.095177896948260e-02   -2.336891399425483e-01   +1.896778884296294e-02   +2.598004400137519e-01   +4.231771850448198e-01; -6.734033874631785e-01   -3.089843842052091e-01   -1.396026715871886e-01   -2.030860522083265e-02   -7.632730433247039e-01   +5.427831492929377e-02   +6.937108423245185e-01   +4.341142050293911e-01   -2.527779157240360e-01   +6.843782225666327e-01   +2.232165925825985e-01   -5.987582026386279e-01   +1.394854020744905e-01   -3.205040223661493e-01   +4.601968833690039e-01   -3.766974867914010e-01; +5.981413101917671e-01   +3.676508151706688e-01   +2.307447249260681e-01   -2.052120051847433e-01   -3.179620580950132e-01   -2.424626943645475e-01   +1.754013681208302e-01   -4.159927377785136e-01   +2.742087139201453e-01   -4.887849970740785e-02   -7.495880057809189e-01   +3.142654540415857e-01   -4.756814716682558e-01   -5.094806082656573e-02   +6.415103320510607e-01   -1.194639178880970e-01; -2.660826381823550e-01   +3.144711335471446e-02   +6.575177874320000e-03   -6.718800583361546e-02   +4.065796649687867e-02   -1.063910468584848e-01   +2.325690969269145e-01   +1.462868458283989e-01   +1.489856234403203e-01   +9.544091366227701e-02   -3.297227427358043e-01   -2.727932385529332e-01   -1.365109020815555e-02   +1.713130813372112e-01   +3.900251982786128e-01   +1.071001911708111e-01; +6.267687223377175e-02   +2.178926527893641e-01   +6.471633953319325e-02   +1.001905840247159e-02   +3.346781911195367e-01   +8.554228244949590e-02   +7.213746823373811e-02   +7.816085288921537e-01   +4.174250107883715e-01   +2.330477547884571e-01   -3.317416114639340e-01   -1.726626402546808e-01   +3.550616119402095e-01   -4.792786605726541e-01   +1.900130300245991e-01   +1.336334016816040e-02; +6.295787987497485e-02   -2.071545322261579e-01   +6.425987685602533e-01   -1.827098530250407e-01   +2.069911721594715e-01   -1.070321105341370e-01   -1.006217652545454e-01   -6.468088485187015e-01   +1.451375181475744e-01   -4.878955806203538e-01   +2.429018536288557e-01   +4.821823350838984e-01   -2.731689441482864e-01   -5.068678175718961e-01   +3.212295989962103e-01   +3.890739706893766e-01];
L1E_L1I_iGABA_netcon = [-1.554086731617326e-02   -3.992566620599308e-01   +1.848336822579903e-02   +1.135152407325034e-03   -1.718359233424115e-01   -5.865432771396760e-01   -2.256821125709140e-01   +4.881347163260148e-01   +7.264414009471351e-02   +4.512335322270956e-01   -2.094546710387673e-01   +1.724110012349907e-01   +3.229163155283858e-01   +9.654375520866715e-02   -4.043999322656978e-01   -2.048420718413449e-02; +6.122955955124730e-01   -2.334521587825327e-01   +1.821416031063618e-01   +6.594722319425377e-01   +2.007551847060183e-01   -2.197523544904373e-01   -1.607725792839603e-01   +1.993514986575283e-02   -2.153309839717641e-01   +2.319082823728981e-01   -1.219121218914338e-01   -3.472805786329254e-01   +6.477922572171796e-01   +5.277810140078234e-01   -9.340139083224518e-02   +5.738534786299845e-01; -3.483060442447992e-01   -2.329578006634632e-01   -3.749579838162460e-02   -5.125554633559948e-01   +5.544382856148156e-01   +2.568411316506776e-01   +5.729195515744004e-01   +8.826224629469760e-02   +2.230570718673816e-01   +7.156580935387458e-03   +2.074480335958506e-01   +4.798506167211524e-01   -5.086042999791230e-01   -1.967417907113611e-01   +3.611480921458526e-01   +2.561332434438213e-01; +7.538477111520246e-01   -2.176106767751337e-01   -5.103325459851626e-01   -8.335751167888467e-02   -8.060595244445374e-01   +4.997328954634525e-01   +6.936944986637228e-02   +5.253082283451919e-01   -2.448039030054311e-01   +1.967901422095355e-01   -8.192167525180040e-02   +2.066863470247516e-01   +4.216293927759738e-02   +5.245360056296530e-01   -5.284322580925699e-02   -5.569534327538233e-01; +4.244861034869999e-01   -2.930813864366018e-01   -5.542137500024261e-01   +5.960287506957722e-01   -5.081107736996713e-02   -2.598136414542445e-01   -3.578312721440995e-01   +7.743684390140709e-02   -3.804093608705386e-01   +3.157870326887546e-01   -8.074979585476726e-02   -5.405186721442797e-01   +2.818063887487096e-01   +1.924571537341281e-01   -1.971688087603476e-01   -2.868386547791602e-01; +8.186343786532212e-02   +2.701748864297532e-01   +3.402446235676302e-02   -4.668484595800634e-01   +3.887917328128850e-01   +1.141661376254347e-01   -1.175848319537956e-01   -2.420131781665283e-01   -7.628498936938496e-02   -2.832775332165496e-01   -2.557542201501942e-01   -6.583371364034359e-01   +5.393611336101566e-01   +7.820785991218051e-01   -3.839777977861050e-01   +3.231080679062563e-01; +1.330030354520928e-01   -7.677913227944397e-01   +1.851350268372214e-01   -4.338637291206182e-01   -4.894831544694331e-02   -5.592073110228247e-02   +5.277119692315875e-01   -2.173805970295369e-01   -5.234849064622651e-02   -1.210563149766471e-01   +1.676513193591855e-01   -4.448833202694156e-01   +3.925999304995337e-01   +1.092194546213410e-01   +4.761644573003627e-01   +5.115491453944104e-01; -4.108862905676359e-01   -1.301923176146423e-01   +2.117267189805541e-01   +2.709232875245944e-01   -1.381124474784205e-01   -3.601006325927590e-01   -1.627883384276022e-01   +6.062606771159322e-01   -1.704785445192479e-01   +4.520907228892122e-01   -5.347653093566139e-01   +3.063991819670043e-01   +2.729587544839081e-02   -2.590358354540779e-01   -7.114237130872615e-02   +2.456703001184933e-02; +1.000000000000000e+00   +6.208827943444803e-02   -5.606570893954593e-01   -6.211602341230216e-01   +2.822660942448103e-01   -8.461465836995481e-02   +3.769497299424465e-01   -2.510390490255494e-01   +3.080432734246111e-01   -3.446773476352145e-01   -3.369543216042384e-01   +6.376555979717365e-01   +1.224423487717594e-02   +7.705269153470375e-02   +5.168694080982665e-01   -8.533002115036774e-02; -2.243902545031897e-01   -9.950951504434333e-02   +5.367589333170580e-01   +3.556769972253137e-01   +1.499795771364729e-01   +8.709755962051319e-01   -2.987098607340932e-01   -8.433062463364458e-03   +1.390482897108106e-01   +4.376050872773043e-02   -1.590704046662904e-01   -1.769396713891948e-01   +4.379262004243474e-01   +7.619133979616430e-02   -1.919636177317461e-01   +2.975868967671745e-01; -2.865170598605118e-01   +3.920142491705514e-01   -6.198253901052529e-02   +1.245615620671688e-02   -1.875498974228487e-01   +2.468686869415865e-01   +7.856896035229139e-01   +3.238822962954854e-01   +1.347079380651894e-01   +3.258111148750616e-01   +3.453267402583042e-01   -1.584804516045644e-01   +4.676640196358129e-01   -4.149115313364906e-01   +4.005621601465539e-01   -1.498139935615412e-01; +7.307217451226071e-01   -1.269294755635386e-01   -3.316798155375675e-01   +1.311727263964088e-01   +7.164850666567557e-04   +9.917967323075896e-02   -9.978861828679821e-02   +3.628570439063103e-01   +1.168100049194278e-01   -1.591350804607446e-01   -3.039939003294005e-01   -3.048455283364991e-01   -3.238486414383569e-01   +3.365906093255537e-01   +4.803410182530018e-01   -1.888753785935566e-01; +3.189718010657154e-01   +3.597273887355979e-01   -1.623191636242982e-01   +8.204643695786153e-02   -5.045223638598330e-01   -3.358826704825227e-01   +1.763931275449323e-01   +1.201460954989380e-01   +7.222854397966583e-02   +9.952492875580089e-02   +2.033966680563374e-01   -3.857635082220275e-01   -1.039201077392727e-01   +2.301136863774512e-03   -3.999261338517535e-01   +1.070521863779190e-01; -1.284753563383935e-01   +2.571889264726167e-01   +1.026734672130922e-01   -2.898942448543464e-02   -1.023863788699959e-01   -3.080499646092760e-01   -4.458931857824003e-01   -2.313694589816582e-01   -1.316016338935382e-01   -4.245120964336060e-01   +1.917600312379460e-01   -1.801121042607129e-01   +1.673903905314392e-01   -4.349727105921733e-01   -3.164755094808054e-01   +7.244770749684560e-01; +5.019773296957573e-01   -1.331878553635783e-01   +1.318764739321578e-01   +3.714518612383043e-01   -5.946569560910166e-02   -3.943003606708265e-01   +2.794116783220032e-01   +2.723289832307303e-01   -7.061884331343452e-02   -4.315892458622914e-01   -5.396611529269335e-02   -4.124099978585410e-01   -5.859489179792929e-01   -2.817811248426086e-01   +6.843782886459233e-02   -3.247069247677354e-01; -4.317357377857448e-02   +5.561444627751065e-01   +3.876470715941207e-01   -3.561571715993320e-01   -2.257806583901181e-01   +3.498672044876794e-01   +6.906598865570968e-01   -5.143196338551477e-01   +4.323565161455306e-02   +3.521681793747557e-01   -2.777313517583745e-01   +4.159005161317842e-01   -6.453300947710555e-02   -2.161257582633457e-01   -6.298817615911466e-01   +3.763222174896356e-01];
L2I_L1I_iGABA_netcon = [+2.928077515948054e-01   -2.641396425688212e-02   +1.432330767032153e-01   -6.405961617053713e-01   -2.000746158646149e-01   -3.506976791033622e-01   +6.757535689598646e-01   +5.207345353517434e-01; +8.170999776235712e-01   -3.548701189142637e-01   +6.801162100549804e-01   -2.306662851223510e-01   -1.386953995661750e-01   +2.149894872704757e-01   +1.015212919060275e-01   +1.796260429328918e-01; +3.320102564377004e-01   -8.347734526839719e-01   -6.139298020113365e-01   +8.457516253571155e-01   -3.283394521572391e-02   -7.088907789517099e-01   -6.502477560194857e-01   +4.339422189376139e-01; -6.983602232143726e-01   +4.192731478410210e-01   -4.914906580022170e-03   +1.730070600578121e-01   -6.112807482653637e-01   +5.242069224257604e-01   +4.727309102786371e-02   -3.973287523973924e-01; +4.163209371007546e-01   +3.685141211017340e-01   -2.650839155238402e-01   -2.113752833392347e-01   -3.587250944352278e-01   +1.624056390026890e-01   -4.430659358491400e-01   +5.570408300713746e-02; -4.401438958430123e-01   +1.357720790822385e-01   +1.076292008327808e-01   -1.206951083695362e-01   +9.198100302604005e-02   +4.851954759132034e-01   -4.474641873807632e-01   +2.653678164030532e-01; +6.321117033554874e-01   +3.731323286639070e-01   +2.495689710335651e-01   +1.195552538866203e-01   +3.111826783357927e-01   -1.123828965000804e-01   -5.896777171523298e-01   -6.078739686237398e-01; +3.230662082638204e-01   +7.911095773367744e-01   +6.587788813380784e-01   -2.445524284851540e-01   +4.133182294601506e-01   +3.307291733858873e-01   +2.049432783617378e-01   +9.413600157798465e-01; -2.141373873946776e-01   -6.295492480571514e-01   -1.418108395246512e-01   -2.690050022357115e-03   +6.149987027919248e-01   -3.922147086890339e-01   -5.178544614553829e-01   -2.871801146003372e-01; -2.151189019452234e-01   +1.524180297972098e-01   +4.636365174013042e-01   -9.150990698294659e-01   +8.712819376151129e-02   +3.825739508997269e-01   -5.194546933982532e-01   +4.834978303187565e-01; -2.267206886810336e-01   -3.503463839569185e-01   -2.610052123272946e-01   +1.365624400357410e-01   -9.573231807680022e-02   -2.549701078731530e-01   -4.311891254725889e-01   -2.140954807899001e-01; +1.109045927035749e-01   +1.697315019469466e-01   +4.331623971489787e-01   -8.838795753235343e-02   +4.044412019808030e-01   +1.967596426384319e-01   -2.973157004225237e-01   -5.241931707978469e-02; -3.316544908386541e-01   -5.562575768595865e-01   -3.103777696087862e-01   -2.484571915100073e-01   +9.707154765075188e-02   +2.477388682209387e-01   -1.000000000000000e+00   -6.001286018628459e-01; +1.608887433473559e-01   -3.109684025551731e-01   -2.722457286290993e-01   +9.244141219553310e-02   -2.487005877775340e-01   -2.925137664584402e-02   +8.284968109342893e-01   +7.342466268623730e-01; -9.026516670652042e-02   +2.355348704631683e-01   +6.841641884577365e-02   -1.426228538863718e-01   +5.587266723279256e-01   -2.230625165373291e-01   -4.362214658905839e-01   -6.419972752477259e-01; +6.095439311714369e-01   +4.106812122060816e-01   -5.699966560410058e-02   +7.149217365417124e-02   -7.510770282670858e-03   +8.527910694093167e-01   +4.196252283379435e-01   +4.553404766709112e-01];
L1I_L2I_iGABA_netcon = [+2.732087500983005e-01   -2.260616630650662e-01   +1.000000000000000e+00   -1.633557850152220e-01   -4.741755458434061e-01   +5.061694450092082e-01   +2.982337423996135e-01   -1.223365242058437e-01   +9.651453129383586e-01   -2.752126093905422e-01   +6.762595691823275e-01   -1.846888198743993e-01   +6.361483906241563e-02   -6.372424024639538e-01   +2.301440448180858e-01   +7.148610628321386e-02; +5.144870626817695e-01   -8.283068320583965e-02   -3.276400227941733e-01   +4.426175633617078e-01   +3.239922302430859e-01   -2.736148568518966e-01   -2.783212426595651e-02   +3.825926199566375e-01   -4.839913468377439e-01   -1.305860809181907e-01   -7.949278910853764e-01   +4.128572838235627e-02   -5.628902015870372e-01   +5.261055348960154e-01   -1.800509321265130e-01   +1.976110254817289e-01; +2.912582636391490e-02   +3.882904334974667e-01   -2.823347918798990e-01   +4.631991412988820e-01   +2.718425414332498e-01   -1.666663172593748e-01   +4.638841253389793e-01   -1.510433902300100e-01   -2.621441215707733e-01   +5.343290764567008e-01   -3.652925563379487e-01   +1.529411702041663e-01   -6.299822000092434e-04   -4.005969052098554e-01   +4.021030496862176e-01   +2.126113797481020e-01; +4.005757279187992e-02   -3.669907273328481e-01   -3.248450189524404e-01   -3.911756633846643e-01   -1.383921941114495e-01   +1.665422919721665e-01   -3.625785538284482e-01   -1.990764990818329e-01   +1.959784110801192e-01   -4.943693627552122e-01   -1.557718618483394e-02   +5.668053298342369e-02   +2.333444803217694e-01   -8.005108727669716e-01   +8.246903270549363e-02   -4.779732316017100e-01; +2.710590014501814e-01   +2.657628760113573e-01   -6.348710510447449e-02   +1.233252448864732e-02   -2.256554986305037e-01   -1.805440918473648e-01   +2.303276954066079e-01   -1.482928929316167e-01   -2.785039891668514e-01   -1.745016377853646e-01   -2.572668808579165e-01   +1.677823023360800e-01   +6.473008505475752e-02   -2.557254532124387e-01   +5.709252612218828e-01   -5.252950819846225e-01; +1.336023327653157e-01   -5.209175945542226e-01   +1.227684008748413e-01   -2.281893487734707e-01   -6.246809281271951e-01   +4.575851351194615e-01   +4.000046724167875e-02   -2.192874886014711e-01   -2.658165971200885e-02   +6.931352160880155e-01   -1.703110535932625e-01   +2.028992170644142e-01   -4.273607270131995e-01   -1.968402827426244e-01   +8.470548410492183e-02   -2.003081903013334e-01; -1.258994846742452e-01   -7.830614334467764e-02   +1.522915806073165e-01   +1.459678679080297e-01   +4.803165518660096e-02   +1.170846796158123e-01   -3.553015020415078e-01   +6.065876680680376e-02   -3.667427713446448e-01   +4.845918215987949e-01   -2.899084098682105e-01   -5.792200274961846e-02   -3.374566861062464e-01   +1.624769360138223e-01   +5.009347384217079e-01   +3.900569832123248e-01; +1.246350242795958e-01   +4.518805859185276e-01   -1.464811443809838e-01   -4.939488760773314e-02   -1.225906285680043e-01   -4.476102556342071e-01   +2.702467161174175e-01   -4.013608516699838e-01   +1.233256119929688e-01   +7.237375986320871e-01   -2.740507281855209e-01   -2.573583221942409e-01   -2.745739871944654e-01   +4.115578026863004e-01   +5.125646685743978e-01   -4.398212921299427e-01];
L2E_L1E_iAMPA_netcon = [-5.929431823387969e-01   +3.070690186184702e-01   -1.725056485942243e-01   +7.984058640953548e-02   -5.029754384773689e-01   -6.497880027303083e-01   -5.339631640419076e-01   +2.099578673787487e-01; +1.688919545759296e-01   +6.725518621990048e-01   +3.695248783272199e-01   -9.224698812585204e-01   -2.952147372255886e-01   -1.711776282732773e-01   -2.485974985305979e-01   -2.367513573299734e-02; -3.581600651763802e-01   +7.089202542730103e-01   -6.648945054863002e-02   +1.528215137051968e-01   -3.448607709529928e-01   -2.630236678714868e-01   +8.060826740520989e-01   -1.658642525023405e-02; +2.969740206820266e-01   +1.876130770671603e-01   +2.400289498356766e-01   -2.556819616669147e-01   +1.593225177770940e-01   -5.009393601409966e-01   -5.668947473600225e-01   -8.126751485395350e-02; +1.749544641449270e-01   +1.257460621777660e-01   +6.733755571541262e-01   +3.589788395447702e-01   -3.256160994793155e-01   +1.048210884919619e-01   +8.259320124940380e-01   -7.452127465868024e-01; +4.173687421044465e-01   -7.823487183728967e-01   -1.200845469429621e-01   -1.649918075631548e-01   -3.924130835898627e-01   +2.365331694060533e-01   +8.947198360756250e-01   -2.300036473355508e-02; -3.491830441690246e-01   +5.686082833930680e-01   +7.429867575440807e-02   +3.844682580571070e-01   +1.066015327962483e-01   +3.053918236717094e-01   -6.755992168174224e-01   +4.809840805622773e-01; +6.009727602870800e-01   +2.097913363689078e-01   +4.041005031745559e-01   +4.768299916049690e-01   +5.108147820121821e-02   -5.135918471422095e-01   +2.183178857010895e-01   +2.259551750546545e-01; +2.693664014796769e-01   -1.951658641701626e-01   +1.291231225408815e-01   -2.435110077370458e-01   +6.833661365137449e-01   +6.998037853587509e-01   -3.496242093750964e-01   -7.224543403484402e-01; -3.007367142443980e-01   -1.954536314340346e-01   -6.292428501331734e-01   -8.399508407737702e-02   -5.993613376970733e-02   +1.096781377757363e-01   -9.173263302399208e-02   +2.912870428022116e-01; -1.495130502432446e-01   +2.972649151073532e-02   +2.937431493239402e-01   -7.102171935974121e-01   +3.241930031894346e-02   -5.451566821467473e-02   -4.131138891323499e-01   -4.793697190242423e-01; +5.702344831088377e-01   -1.802821526804903e-01   +3.835282173541336e-01   -1.412814726648546e-01   +1.460559166327840e-01   -6.906584735219510e-01   -6.937294847944220e-01   +1.090036442685760e-02; -5.559353043827282e-01   -1.088434731461962e-01   -7.728064277566427e-02   -5.442419761030494e-01   +2.556452823212575e-01   -1.973012716207248e-01   +3.278966103837853e-01   -4.394448127165183e-01; +1.546623838788726e-01   -2.029322866654171e-01   -2.353432551573815e-01   -1.518813179367121e-01   -6.297255005160929e-01   +1.809375921959646e-01   +5.410153712116306e-01   +7.398328576510560e-02; +3.291451437358621e-02   -2.722327681013676e-01   -2.348706783900904e-01   -5.120779548870457e-01   +6.043797053022593e-02   +2.849348547038498e-01   -6.199371754550216e-01   +1.257884877622394e-01; -4.062925676987150e-01   +5.333695172818753e-01   +1.000000000000000e+00   -4.241215492897296e-01   +2.346036982290496e-01   +2.887783203739187e-01   -2.880701319923815e-01   -1.396771971793054e-01];
L1E_L2E_iAMPA_netcon = [-2.893326968807548e-01   +1.471009674841713e-01   +3.575687988740355e-02   +3.711852167041337e-01   -1.000000000000000e+00   -4.899185211555313e-01   -2.353164701336350e-01   +5.885762102470824e-01   -3.527564413194542e-01   +6.798457695964072e-01   -3.517023485607373e-01   +4.876766526104026e-01   -2.317783435363584e-01   +6.011808529190298e-02   +2.893131615913275e-01   -1.237528388711111e-01; +9.168008704689392e-03   +8.775269301776871e-02   +4.303121849423170e-01   +2.515783082173585e-01   -1.284150691147300e-01   +3.733117494281953e-02   -1.054898421338791e-01   +2.374751748632032e-01   +1.268002650839151e-01   -2.034294785599174e-01   -2.233304290408256e-01   -1.277633314221177e-02   -3.515073462217547e-01   -5.082258752274400e-01   +4.472775021703148e-01   -2.614805929784709e-02; +1.965784490785781e-01   +6.204363022086412e-01   -2.464357904540699e-01   +4.766115963056190e-01   -4.590737601531480e-01   +1.073136540302831e-01   -1.536813464429225e-02   -4.817479555658143e-01   +1.880752509435144e-01   -4.913341304122565e-01   +4.690836858634322e-01   +4.840729561581519e-02   +4.600774532531952e-01   -1.253123936119486e-01   +3.356815253708818e-01   -3.636173214712459e-01; -1.028671934362560e-01   +1.065718531725075e-01   +3.340259602127041e-01   -4.928926269468625e-02   +2.176531876742807e-01   -5.538998627238700e-01   -1.319579758670428e-01   +2.679525977211370e-01   -1.556537522866553e-01   +5.620999111934802e-02   +2.503611999772337e-01   +6.422064283383759e-01   +3.617813772073638e-01   -1.773129922391985e-01   -4.275068957003485e-01   -4.462398692083857e-01; -1.564880869884502e-01   -4.500430255300965e-01   +3.495121964335484e-01   -2.418676092854665e-01   -1.454954671349153e-01   +1.275031704884281e-01   +7.022046020817774e-02   +2.914572208791375e-02   +1.108210032141720e-01   +3.383218667463455e-01   +1.390637251120928e-01   -2.054670939096671e-01   -6.087087461201832e-01   +4.290077447276713e-01   +2.326656740739105e-01   +2.118178736173183e-01; +1.829212045335621e-01   -2.389747505704434e-01   +4.991788383666575e-01   +8.287232591285281e-01   +9.342947146511595e-02   +8.150071484464551e-02   -2.116852744729639e-01   -1.937424062218454e-01   +8.397031127735616e-02   +5.664942703587873e-01   +2.321581192725143e-01   -6.584834747332542e-02   +5.275362549494778e-02   -1.804792330426809e-01   +1.604869178015100e-01   +8.241352830557876e-02; +1.557635831064832e-01   +3.404742797776548e-01   +8.603051070429646e-02   -5.544047431935154e-01   +8.696974576392599e-02   -1.401063366137546e-01   -2.175815673139386e-02   -5.679894073456708e-01   -6.992663319362945e-02   -1.484037961233975e-01   +1.074954027875210e-01   -3.725830760521888e-02   -2.356606337774624e-01   -1.742122186503412e-01   -7.099884962384148e-01   -1.670317079969290e-01; +5.622064365161834e-02   -4.326950961694610e-01   -3.224483261473420e-01   +4.225749489066994e-01   -5.906406523803402e-01   +4.802489082208244e-01   -1.124245271650970e-01   -1.466236366341855e-01   +2.243301177983460e-01   -1.316244766237893e-02   -2.327575000176841e-01   +1.796525172331139e-01   +1.809576870384860e-01   -6.106635658404283e-02   -6.234761988875205e-02   -8.578223804513707e-01];
L2I_L2E_iAMPA_netcon = [-2.450631633421462e-01   -1.628163086123100e-02   -1.842293505768462e-01   -1.235712610517214e-01   -1.858767824384718e-01   +1.452586049123510e-01   +3.256921663792171e-02   +3.890449652684830e-01; -3.224768924069646e-01   +5.754520265910659e-01   -4.730082818044142e-01   +2.195128344782223e-01   -1.834748002844153e-01   +1.348520788736257e-01   -5.357913272945285e-01   +2.244284759518422e-01; +2.491041624609555e-02   +1.989278964404635e-01   +3.752040377964615e-01   +4.719201688576037e-01   +5.492662697657208e-01   -8.338665041985941e-01   -3.294936772662067e-01   -4.189093298972917e-02; -1.068610680069598e-01   +3.559021314945328e-01   -1.000000000000000e+00   +4.269415220319097e-01   -2.159019302050432e-01   +3.506849545709282e-02   -2.675781265221875e-01   +3.246817271397712e-01; +5.167056982496995e-01   -1.328102211744433e-01   +3.907347288075251e-01   +1.176451875088406e-01   +4.293836134274285e-01   -1.441551274963870e-01   +2.384820751676706e-02   +1.973937487621533e-01; -5.108211075234340e-01   -3.668605054281317e-01   -2.187097643890615e-01   +1.241730018336831e-01   -3.509120941500955e-01   +6.427024453183826e-01   -4.928785664293386e-01   -2.761175501434212e-01; -3.301209137283983e-02   +1.932924886524202e-01   -2.008478442835560e-01   +6.316261889102905e-01   -4.833857403572121e-01   +2.446980682986937e-01   +2.480385063196170e-01   +1.251382960946980e-01; -2.206586333415318e-01   -3.663681614407401e-01   +1.719066318203342e-02   -4.418926404687965e-01   -3.932402514312502e-01   -5.321130291451536e-01   -5.165967683626843e-02   -8.216369492884734e-02];
L2E_L2I_iGABA_netcon = [-6.858786059915657e-01   -1.029653230534174e-01   +2.198028013974275e-01   +1.013705472955257e-01   +2.724125677895543e-01   +3.361440472979739e-01   +4.821364434390631e-01   +1.421510997140552e-01; +1.217862549098010e-01   +4.277838890053120e-01   -3.786316246221749e-01   -7.113539522152477e-01   -4.566665108868688e-01   +2.253768449222584e-01   -1.590001607682372e-01   -1.037877249822680e-01; +2.702814437020557e-01   -1.788076553228957e-02   +8.791336060341050e-01   -2.171493243116711e-01   +3.335756763884716e-02   +4.505177854985441e-01   -2.172638576359098e-01   -4.893028185019873e-01; +2.903616455002425e-01   -1.863860958364591e-01   +2.040359548919335e-01   -1.843047475811131e-01   +5.860016467048317e-01   -2.262611830212055e-01   +2.256228019405901e-01   -5.632290833787768e-01; -8.143325230882803e-02   +5.372314357901289e-01   -1.972626742211974e-01   +1.571603799013956e-02   -1.708558644737242e-01   -3.582394874547341e-01   -1.454139392418711e-01   +7.273059580645459e-01; +4.708304176254222e-02   -4.918894323250297e-01   -5.084164750426107e-01   +1.000000000000000e+00   +3.942058661551383e-01   +2.140589013175828e-01   -9.296534591444471e-02   +1.749868993317843e-01; -1.950420442271698e-01   +1.494040754229278e-01   +8.456150095731320e-02   +2.596940143912457e-01   -3.446516568342630e-01   -1.483327651644084e-01   -6.568182667187618e-02   +6.395224341445316e-02; +1.793130961897730e-01   +1.113738511118234e-01   -8.820435849297685e-02   +1.504266662413953e-01   -6.153325194835160e-02   +6.066549463688229e-01   +2.389577408223077e-01   +4.500929044965524e-02];
L3E_L2E_iAMPA_netcon = [+3.714798009879516e-01   +2.671317378160791e-01   -9.776149509921715e-01   +2.650238861883158e-01   -2.011042788934011e-01   -1.328930829687281e-01   +1.642268642097911e-01   +3.454206750127716e-01   -4.733358551752052e-01   +5.693404230249502e-01   -5.152447077335264e-01   +1.515044023870745e-01; -5.047593520784235e-02   +1.679571857853850e-01   +1.854189090530770e-01   +2.453420508183405e-01   +1.076844179620411e-01   -2.933602101532057e-01   +6.263326925528641e-02   +3.156749826109501e-01   -4.234677497079520e-01   +1.260498297423830e-01   +2.763514083204063e-01   -7.437259304079799e-01; +1.188898771919877e-01   -9.988820355486137e-02   -6.496337579008126e-01   -3.191051910860511e-01   -2.269956664104017e-01   +3.429573848250704e-01   +1.756485488955510e-01   +7.174248177837196e-01   -3.251825682090899e-02   +5.328917570398571e-01   -4.311740882132102e-01   -7.658118912739450e-01; +2.418880824567607e-01   -4.379439460038299e-01   -1.016916671711919e-02   -1.621755511337543e-01   -1.316322462221198e-01   +1.044440832971540e-01   -4.410513290796518e-03   +2.676133878317199e-01   -6.438077534989862e-01   +7.071923706125661e-01   -3.388514887946479e-01   -2.560991987805037e-01; +3.224508167622263e-01   +7.955354517934610e-02   -2.981713054267665e-01   -2.614598724285810e-01   -2.522000171271115e-01   -2.055167953042795e-01   +3.696546381237552e-01   +8.288999897155032e-02   -3.823716214569839e-01   -6.275832754230952e-01   -1.479714042859541e-01   -3.155312750563128e-01; +3.692855609290299e-01   +1.693192843134278e-01   -2.867483829649587e-01   -2.383497847877736e-02   +7.390164854674182e-02   +3.845447412046911e-01   +1.264034535432952e-01   +1.490971617368010e-01   +2.033777561219796e-01   -3.957081791597086e-01   -1.126315526753179e-01   -5.731975835619533e-01; -1.324865704800267e-01   -7.977614744068067e-01   +7.201004770581312e-01   -9.406213157493967e-01   -2.345600707644780e-01   +1.250917491652064e-01   +4.054350654171645e-01   +3.299661728421739e-01   +3.648127607579097e-01   -2.022655684972727e-01   -3.709575063295724e-01   +1.000000000000000e+00; +4.083318246738736e-02   +2.788105681246292e-01   -6.685261657748146e-03   +1.241784159052039e-01   -3.286830140021520e-01   -2.594159080276119e-01   +8.765642334583058e-01   -1.287635935573038e-01   -1.428308689458171e-02   -9.523590480281821e-02   -5.973643994851355e-01   +9.850944785593796e-02];
L3I_L2I_iGABA_netcon = [-8.117681020125767e-02   -3.442744970428191e-01   +3.037466093162114e-01   -3.295644529806998e-01   +8.297188751198321e-02   +7.875219937008144e-01   -8.097697675912038e-02   -5.385553783448163e-01   +8.142281316880032e-01   -6.313303548046104e-01   -6.857114400846730e-02   +5.348396977352338e-01; -3.012017162921004e-01   -6.699070807913188e-02   -7.533598543085644e-01   -7.679332602215305e-02   -1.923611796532885e-01   +1.276413997116650e-01   +1.053947379274312e-01   +9.522320061847144e-01   -1.246524446324928e-01   +8.150996171970037e-02   +1.954479218284172e-02   +3.471139743061721e-01; -1.114825745576566e-01   +6.302291467350251e-01   -7.410832146688102e-01   +3.093777094036299e-02   -5.826145429148601e-01   -2.775115451198196e-01   +1.926883626086773e-01   -2.239127396858933e-01   -8.556425746249189e-01   +3.770803888546521e-01   +1.071591632828758e-01   +3.992974446988983e-01; -6.952154351714690e-02   -4.926483742960525e-01   +4.675783256714069e-01   -7.576099030310099e-02   -3.399262575981740e-01   -3.904104557312555e-01   -2.671741306922545e-01   -8.490071608566858e-02   +3.805255138704572e-02   +1.061131575870458e-02   -3.375651220862851e-01   +2.088616630927641e-01; +1.056533808471247e-01   +7.012237834921866e-01   -3.485506585897729e-01   +3.682371163301912e-01   +2.221258710894606e-01   -2.998308023090280e-01   +2.664494753437406e-01   +3.329754647834501e-01   +3.452416554062463e-01   -9.527492664374493e-01   +1.511085661204093e-01   +4.611921519098215e-01; +6.359835858960236e-02   +6.275650019358182e-01   -3.873399049545221e-01   -2.294825111705347e-01   +4.044540776330551e-01   +9.114246481113171e-01   -1.150330619748092e-01   +3.957720130814986e-01   -6.076983326583516e-01   +4.233740851405363e-02   -5.186412574296051e-01   +5.929035228941393e-03; -4.170757698957750e-03   +6.722492776361322e-01   -5.185330412660220e-01   +5.981091054120665e-01   +4.990699502230227e-01   -5.105883065910027e-01   +2.419282432016768e-01   -2.689499427946854e-01   +4.986861734731488e-01   +1.581827356921121e-01   -9.611583842902999e-02   -6.450580918571636e-01; -6.801363015211953e-02   +4.206550040770529e-01   +2.704173613764073e-01   -1.358331006059209e-01   -5.833808460961574e-01   +5.811484937823108e-01   +2.802188155264879e-01   +9.806330789754147e-02   -1.658033621499411e-04   +5.252223026978010e-02   +6.906515944185792e-01   +7.518080103387489e-01];
L2E_L3E_iAMPA_netcon = [+3.578531681403890e-02   +5.299035915924996e-01   -4.877706880606523e-01   +7.034387374059206e-01   +6.013623217477736e-01   +5.633594858103004e-01   -2.927917329673208e-01   -6.736122432874300e-01; +5.129699169539856e-01   +4.607379338710408e-01   +6.627734934385789e-01   -5.821414718956905e-01   -1.557891378001807e-01   -1.777840178985568e-02   +3.851401565451799e-01   +4.015526989832813e-02; +5.346352672671719e-01   -8.457501576521157e-01   -4.081347471034804e-01   +4.178896930991960e-01   +1.069572453486090e-01   +8.141043175341617e-01   -9.592853443705823e-02   +1.536279519631514e-01; +3.269559849672704e-02   +8.551600451221364e-01   +1.340179366367462e-01   -6.934420974052158e-02   +4.239343960187573e-01   +2.385745711945232e-02   -1.688486322067769e-01   +2.716743138464189e-01; +7.819161665208423e-01   +1.140019386848156e-01   -6.693470374001340e-01   -2.206633905482616e-02   +2.521896504969563e-01   -2.015858714800365e-01   -4.652231924846872e-01   -3.259962809586727e-01; -2.103767575189189e-01   -3.276794706704163e-01   -2.275107744753401e-01   +5.123974120517940e-01   +7.554781660149185e-02   +8.172611692733018e-01   +1.898582109026577e-01   +3.153248736696405e-01; +2.865168151804033e-01   -4.709143964289313e-01   +9.070427292938940e-02   +3.809072975351802e-02   -7.992737809140757e-02   +6.913304422807177e-01   -3.884777030817943e-02   +6.246510639220365e-02; +1.087632606450425e-01   +2.370554481037972e-01   +4.337966818227114e-01   -1.379174475522734e-01   +2.743637628306488e-01   -3.290690958607384e-02   -3.886925989052715e-01   +8.274196575855411e-01; +8.312237954085598e-01   +2.775841766287999e-01   -5.423890771346698e-01   -7.300788292674023e-01   -3.702715542585093e-01   -3.318237669014585e-01   +1.192820841821012e-01   +1.251328473034224e-01; +5.235383445680208e-02   +3.631014206662744e-01   -2.749624886539265e-02   -1.221646278775486e-01   +2.346681350489361e-01   -5.863495689687781e-01   -6.525202277501941e-01   +7.381650575939944e-01; +7.530448546711112e-01   -6.203536893450101e-03   -4.253115303361076e-01   -9.023747318756130e-01   +3.954348149620827e-01   -7.467110253709798e-01   +3.390069142301324e-01   -3.461464575572755e-01; +5.108419418677757e-01   +7.541514449489393e-01   +3.677689801928631e-01   +2.123761182607838e-01   -1.055007208874785e-01   +2.067810455441241e-01   -3.801087406063675e-02   -7.332368412240966e-01];
L2I_L3I_iGABA_netcon = [-1.162501504377529e-01   +6.931866559632094e-01   +9.771674956632549e-02   +5.815904795460379e-01   +5.435934215444468e-02   -3.006405218386828e-02   +1.603300250366997e-01   -9.747456473559103e-03; +1.169088960825741e-01   +6.365148940361021e-01   -3.778985893459466e-01   -3.407659021478057e-02   +2.652524331325032e-02   +3.173985331412470e-01   -3.612261972869411e-01   -8.972621574921431e-02; -4.831223642776794e-02   +4.769303613566705e-02   +5.414206864114717e-01   -2.410844384282723e-01   -1.125049002594076e-01   -9.772986680525561e-02   -5.375849496914076e-01   +4.494893390130704e-01; +1.149310687724534e-01   +1.582253892988856e-01   -1.000000000000000e+00   -2.481228196257984e-02   +4.210667588935331e-02   -2.086458167925211e-01   +2.539570103047306e-01   -1.801345550825018e-01; +2.160221167781783e-01   +1.560228570905066e-01   -5.345763740306099e-01   -4.445918048376273e-01   -1.128405019388945e-01   -2.531549321654622e-01   -4.388483614596105e-02   -5.800917823541257e-02; -3.180342471309389e-01   -2.660571153629766e-01   +9.949217249389036e-02   +1.142133877045049e-01   -6.862313039273881e-01   -5.897331348135126e-01   +1.531534026663249e-01   +3.426658937097021e-01; +7.940161516704732e-01   -1.079040172027174e-01   -6.861366498296151e-01   +3.879218291162869e-02   +9.345631265141799e-01   -3.892209876643886e-01   -2.183023708598797e-01   +1.711467068944361e-01; +4.208344617556947e-01   +1.382131699763093e-01   -1.611333078888286e-01   +4.004301072882813e-01   +3.564127311612915e-01   +2.147991126928173e-01   +2.304587512741766e-01   -1.458708963513997e-01; +2.017946826186997e-01   +4.093179423903419e-01   +3.716569879048529e-01   +2.391175236981727e-01   -1.066982224070616e-01   -4.053352486770774e-02   +5.024940790561967e-01   +1.422452848142858e-01; -2.218896493679302e-02   +2.380375060079178e-01   +1.067019958004120e-01   -2.480553698923452e-01   -2.722401301834437e-03   +5.665886307021827e-01   +7.470419052350525e-01   +2.125334619603423e-01; -4.177504526707505e-02   +3.778074363063054e-01   +4.038367845418193e-01   -4.822923908805108e-01   -1.510282084157798e-01   +2.675479206299967e-01   +8.354894015642524e-02   -3.214653855206152e-01; -2.253984553344705e-01   +1.238324866372721e-01   +1.274535134264260e-04   +1.840045001860069e-01   -2.094474811073216e-01   -3.666114416681617e-01   -8.071840851507042e-03   +2.432835048829145e-01];
L3I_L3E_iAMPA_netcon = [+1.425668874207033e-01   -3.186019264371348e-02   -8.002147883542022e-01   -1.458430365524853e-01   -1.590339159329868e-01   +2.336511044676088e-01   -5.829995478969123e-01   +5.221708082935833e-01   +3.765443066978198e-01   -4.147272739589591e-01   -7.258917103863852e-04   +3.387121018079817e-01; -9.354828215377348e-02   -5.656072888153292e-01   -5.676965367268529e-01   -4.207094965236164e-01   +9.255454747168279e-01   -3.763541212063778e-01   +1.256910455910418e-01   +3.171555000896039e-01   -4.600465641166508e-01   +1.521113330592765e-01   +4.190684458191507e-01   +3.769732660512792e-01; -1.662819771673769e-01   -2.887390701453280e-01   +1.000000000000000e+00   +1.566240389906319e-02   +2.533870241620240e-01   -3.153646674375183e-01   -4.680094670052591e-01   -2.517852626746464e-02   +2.178939509086076e-01   -4.466979422550686e-02   -1.312252416745015e-01   +5.501421942268396e-01; +3.037148887691333e-02   -6.397757274774034e-01   +5.458369792410006e-01   -3.509834063892610e-01   -3.139167839546771e-01   -6.618877111510769e-01   +3.473593926195089e-01   +6.381135599743230e-02   -3.589178865925234e-01   -7.481043498251594e-02   -1.130566550068985e-01   +3.804513342196717e-02; -3.404744713488307e-01   -9.559123765748008e-05   -9.721677019001256e-02   -1.377854224593517e-01   -3.613993835342074e-01   -8.297810852025815e-02   -1.290759226596372e-01   +2.207963664765022e-01   -6.361410438219501e-01   +3.461737577484555e-02   +6.173041706663598e-02   +2.385805971982012e-02; +3.049334755179590e-01   -3.538578537846710e-01   +3.622548320861442e-02   +2.424160546838412e-01   -3.202938563525126e-01   -5.172238032116410e-01   -1.891431372168790e-01   -6.245678138591824e-01   -8.595668949705895e-01   +5.671229073238953e-01   -2.188773181056541e-01   -1.869694822167808e-02; -4.130398979164495e-01   +1.764213392225964e-01   +3.726968809139419e-01   +4.879076510729997e-01   -3.334550363094272e-01   -2.867320765578696e-02   -7.411234397990558e-02   +1.539328108115236e-01   +5.276585362368674e-01   +5.933169132238068e-02   +4.077948723503944e-01   -5.628533668589059e-01; -7.644932551706245e-01   +2.793868593416292e-01   -1.987838669224675e-01   -1.006420972493682e-01   -9.255372698544586e-03   -1.446352969227196e-01   +1.115673337391536e-02   +3.702258827008747e-01   -2.205205771473438e-01   -7.461527264953298e-02   -7.133503467663744e-04   -2.211705734182030e-01; +8.172226307578191e-01   +2.262282350307270e-01   -1.992774949269704e-01   -2.599478059399743e-01   -2.474093308429520e-01   +3.069618573439633e-01   +1.294718305448290e-01   +4.922004950646176e-01   -5.787596401098289e-01   -5.163488714163017e-01   -2.796413105769094e-02   +3.557791474638891e-02; -6.340955383737862e-01   -3.460012513399250e-01   -8.175067325011469e-02   +3.090310173329011e-01   -4.176877927438698e-01   +1.709732137557674e-01   -8.369328008158454e-02   +3.774978044146238e-01   +8.144812485514156e-01   +2.682119866160561e-01   -3.585724033571182e-01   +4.065034680628223e-01; +2.730355436335526e-01   +6.326794296337401e-01   +5.041350768946701e-01   +1.502827082785233e-01   +3.782295938418146e-01   +4.483379774888905e-01   -6.147326902115160e-01   -1.863398102028054e-01   +4.697078627764727e-02   +1.621210171172834e-01   +1.840290029950913e-01   -4.074508471864791e-02; +1.715639651827545e-01   +2.851985384731867e-01   +1.098642510567773e-01   +4.344970798104414e-01   +9.042679901212982e-01   +1.844564093098353e-01   -6.718360523643097e-01   -6.887641624514010e-01   -2.453554979142296e-01   +2.838942423679126e-01   -7.547567415963620e-01   +1.823507307042365e-01];
L3E_L3I_iGABA_netcon = [-7.756900975192172e-01   +1.395019428944721e-01   +2.421361193683944e-01   -9.162666222903973e-02   +6.196607642139657e-01   -5.331146066181303e-01   -6.779950348098480e-01   -1.642791023705073e-01   +4.868342831705796e-01   +3.521941834205852e-01   +1.439789359388192e-01   -1.914347190125094e-01; +2.286880860094757e-01   -7.025261416278557e-02   +2.185746979674275e-01   +5.211970358488134e-01   -3.052333166030192e-01   +6.876753959905173e-01   -6.166256657524397e-01   +4.947498605908077e-01   -5.820660833075670e-01   +2.680745710707081e-01   -4.150151510888611e-01   +2.878721875810932e-01; -2.766781434098358e-01   -2.359332909252710e-01   +2.579416848511211e-01   -1.706113205660556e-01   -2.816331484873972e-01   +2.777065304091167e-01   -3.615033539847035e-01   +1.207297447028242e-01   -4.579461420402818e-01   -5.079643536048900e-01   -5.097057110364198e-01   +2.856381387807488e-01; -5.906338494508950e-01   -4.540682821887747e-03   +4.168070794495276e-01   -4.203721226509984e-01   +1.269720113013884e-01   -3.298362964013119e-01   -2.652602779419893e-01   +1.909855431992220e-01   -2.883874078334346e-01   +1.589365521472759e-01   -7.564908725315898e-03   +4.189305742544440e-02; +1.454663991329419e-01   +2.605428004761577e-01   -4.935691927661672e-01   +2.982960632605350e-01   +2.071332240596443e-02   +1.520858784300662e-01   -3.906815251913408e-01   -5.284810863420117e-01   +1.026180119248811e-01   -8.188712761206450e-02   +1.369871719207263e-02   -8.113734337497620e-01; +5.143699039897195e-03   +4.979039193182551e-01   -9.301519857853108e-02   +3.791270126132659e-01   +9.001043151572269e-02   -4.837755330717841e-01   +4.953993823233194e-02   +1.721006636862726e-01   +2.443105258909887e-01   +2.344775092801181e-01   -4.033297480434865e-01   -3.215727054462911e-01; +3.258774574297492e-01   +4.205647592534192e-01   -1.145174514537893e-01   -4.763448552978077e-01   -4.057114989046087e-01   +7.688189797100434e-02   +1.126191470063741e-01   +4.720229766026385e-01   -9.569711582853681e-02   -9.678065933928492e-02   -4.894684111084832e-01   -5.718738337950284e-01; -4.678627418656712e-01   -3.293557445491772e-01   +6.560537600249029e-01   +8.087526616636490e-02   -4.361975734439428e-01   +1.450060963684978e-01   -1.184584992851961e-01   -4.172860674048257e-01   +4.634731451116596e-02   +1.000000000000000e+00   -3.995814128676572e-01   +3.307849491071163e-01; +7.922999932354737e-01   -1.009829686208323e-01   +2.417107643018465e-01   +3.365701095809500e-02   +4.317862847062680e-01   -7.612272725127511e-02   -3.575495789265045e-01   +2.161386536087362e-01   +5.994498441812839e-01   +8.819721578187423e-01   -5.436854026867137e-01   +1.318706393534030e-01; -2.168913358731198e-01   +1.636586327440091e-01   +1.094468413982307e-01   -1.390324066317834e-01   -4.034079186370569e-01   +4.755150447452327e-01   +2.611678897325688e-01   +1.547797443093555e-01   -3.118504094391208e-01   +1.336828734276228e-01   -3.732057866138769e-01   -4.601549480209604e-01; -4.101513485246758e-02   -7.094063479430221e-02   +6.326287985218719e-01   +5.907171758335018e-02   -6.204688706346249e-01   +2.728926982445325e-01   -5.162368905603399e-02   +5.045642164305401e-01   +5.163207333946204e-01   -6.739496716085702e-02   -4.573718359466115e-01   +6.023795695424338e-01; -1.214673481631540e-01   +8.223015754524386e-03   -8.186674971242083e-01   +3.525744412881389e-01   +4.253262883059845e-01   -7.115491783277276e-01   -2.114292815283582e-02   +2.878735003995905e-01   +1.284685238619232e-01   +2.894266079528113e-01   +5.058355923633417e-01   +5.014425804912014e-03];
L2E_Input1_iAMPA_netcon = [-2.121146274733007e-01   -8.283446540439235e-01   +1.979820286581880e-01   +5.699152066208781e-01   -7.105924550056134e-01   +9.185777646464246e-01   +1.651613222892124e-01   -2.470596030967420e-01];
L2I_Input2_iAMPA_netcon = [+2.542553607050383e-01   +9.767552754157733e-01   +3.199799017727409e-01   +7.552001796840178e-01   +6.793242032281749e-01   +4.350156855292120e-01   -3.651735917328090e-01   +2.536070050634221e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
