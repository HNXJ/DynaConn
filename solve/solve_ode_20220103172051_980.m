function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.130047820394041e-01   +7.913646982248340e-01   +1.319328203112523e-01   +8.693794393474172e-01   +2.663806008341810e-01   +5.204566992446371e-01   +5.942485431550036e-01   +7.684245412565810e-01   +5.527037909313817e-01   +4.605231682402506e-01   +3.267529959304915e-01   +5.233132919096318e-01   +7.980972754525741e-01   +1.186020350861564e-01   +8.167258429333333e-03   +2.446393402026810e-01; +8.430862767393571e-01   +6.590674050872215e-01   +6.992000271487496e-01   +2.184668550803482e-01   +1.335033490403915e-01   +2.622140794433050e-01   +5.526092042523333e-01   +4.156525928049594e-01   +4.710848361633113e-01   +9.676985560049775e-01   +2.604324992247273e-01   +5.392664330876793e-01   +5.919446223317462e-01   +9.214136627188760e-01   +7.157992302518892e-01   +2.688275073248978e-01; +3.820583865589250e-01   +4.867098822492447e-01   +4.311568027916601e-01   +4.445735915742986e-01   +6.716477754653477e-01   +2.224893723372749e-01   +7.699402917710665e-02   +5.852053602145973e-01   +2.729218716856930e-01   +3.167699971733164e-01   +9.275481549408560e-01   +6.200154300573451e-01   +8.608748501882340e-01   +8.208908690538094e-01   +1.219057953454768e-01   +5.244775470146500e-01; +4.993314913316387e-01   +2.880961025218898e-01   +6.412840251247443e-01   +9.360430054379059e-01   +9.355785373435765e-01   +8.859763971438124e-01   +8.463318815710567e-01   +4.537182040993367e-01   +2.722737324298248e-01   +1.028922062492132e-01   +4.244720807923142e-01   +7.206676466637597e-01   +7.194630824038212e-02   +6.850785422377325e-01   +3.997114776233958e-01   +2.834900984837890e-01; +6.359677290119027e-01   +3.878456815471908e-01   +5.977753592345273e-01   +8.209332115340587e-02   +5.334962558384157e-02   +8.259136576683742e-01   +1.462723141099450e-01   +8.494636234556568e-02   +5.910078498244894e-01   +3.860763627207474e-01   +7.047508367794695e-01   +4.258233131481998e-01   +8.788171163973670e-01   +4.536355227855798e-01   +7.916202111538142e-01   +1.598062967112287e-01; +1.309008667078375e-01   +4.639696330254605e-01   +4.684715045203378e-01   +1.622225689491616e-01   +7.888298559034632e-01   +2.792395000561187e-01   +8.781561175980304e-01   +4.848502864615168e-01   +9.510490299973008e-02   +3.347104877694828e-02   +4.044813696043911e-01   +9.614773298399156e-01   +5.158355026587533e-01   +6.129371337273960e-01   +4.620884340483958e-01   +4.124296690981274e-01; +3.387770686198129e-01   +7.273961081619127e-01   +2.033507315068038e-01   +4.334627392670893e-01   +2.268633686775223e-01   +7.827628313993598e-01   +9.228025293174373e-01   +7.568567075484242e-01   +7.872057615929657e-01   +9.790966318879183e-01   +9.180588314079592e-01   +5.862406659775489e-01   +5.187016590637826e-01   -3.190870682857841e-02   +5.251202440004940e-01   -4.313442609195259e-02; +4.228395995080219e-01   +2.001865072605714e-01   +2.588792631109971e-01   +6.635991796739685e-01   +6.161086040832253e-01   +8.399187018130326e-02   +2.019930773403787e-01   +3.067681317245165e-01   +4.734109911683092e-01   +5.839882889861172e-01   +9.978613849725337e-01   +9.930509527311195e-01   +9.068371371143850e-01   +9.076459705246349e-02   +4.970844742543550e-01   +5.141965399354338e-03; +1.839647499315106e-01   +5.214184960197439e-01   +3.922666881913779e-01   +8.163391462539232e-02   +6.377945607713488e-02   +6.833243437451573e-01   +8.997968212916805e-01   +3.846637164738494e-01   +1.915792706720594e-01   +2.320492738015889e-01   +3.422230776026126e-01   +5.462704774644845e-01   +8.242125023213001e-01   +5.651850869250624e-01   +1.581927065861503e-01   +7.638548359038800e-01; +4.359998625601114e-01   +1.850043185506159e-01   +1.000000000000000e+00   +8.941651139662875e-01   +4.829679415986218e-01   +7.920081272959195e-01   +3.044541617461574e-01   +8.898923851750195e-01   +3.299218059012487e-01   +7.013171724808678e-01   +3.999921960691665e-01   +7.530191729661004e-01   +4.003818135541409e-01   +5.881254117851707e-01   +3.313153971308790e-01   +2.770127668983758e-01; +3.390934367881130e-01   +8.577989681485055e-01   +6.620340943210117e-01   +4.293185619909290e-01   +6.404504713308442e-01   +7.087359673267303e-01   +1.500495536012207e-01   +7.253874999966846e-03   +3.131216443720309e-02   +9.170315220959520e-01   +9.540778223514454e-02   +7.100237625959134e-01   +5.610963269363302e-01   +4.092219152462531e-01   +6.151655118104952e-01   -6.741437531667804e-02; +4.700552873011625e-01   +3.428377313450439e-01   +6.018046636501563e-01   +9.396421678520641e-01   +1.058942666078228e-01   +3.585333646945730e-01   +4.676607856936174e-01   +4.563877310956835e-01   +4.897310620176337e-01   +2.637546089963236e-01   +9.414575620288607e-01   +5.492426446066069e-01   +2.724108070698344e-01   +1.467314048217618e-01   +6.228635502087824e-01   +6.712831060046207e-01; +3.198823354432184e-01   +8.754216806294287e-01   +5.628343513234103e-01   +6.996863505471907e-01   +3.364771910431961e-01   +9.076025145533477e-01   +8.331257435633782e-01   +6.688201961060017e-01   +8.940110063840789e-01   +7.611489530165230e-01   +6.946365155137396e-01   +6.598337848710422e-01   +2.553439803184475e-01   +6.094183538094251e-01   +7.130159082235946e-01   +5.156196028298594e-01; +8.022813567226361e-01   +9.691284750165217e-01   +4.971002423451077e-01   +4.835167231732876e-01   +3.762465787270118e-01   -1.150184142301063e-02   +7.732101064774549e-01   +1.377060946195310e-01   +7.727262596372469e-01   +7.004374683784480e-01   +2.283953540660831e-01   -2.491446749044824e-04   +5.611065584751425e-01   +7.205091713676833e-01   +4.917148436784391e-01   +7.770134096380047e-01; +7.564522322559436e-01   +7.598998059895665e-01   +8.791772786030886e-01   +1.316176368235963e-01   +3.485675294454291e-01   +1.865843007829760e-01   +7.272912956363194e-01   +3.166072328141837e-01   -4.200707603104816e-02   +2.852758162619345e-01   +4.230963044999659e-01   +2.519276965280013e-01   +8.662745319684871e-01   +6.809426107126729e-01   +6.327162692337733e-01   +5.352832556504675e-01; +1.544954111387536e-01   +2.500514272687802e-01   +1.810421756997413e-01   -5.198449315970211e-02   +4.389777987730277e-01   +8.324991267785838e-01   +6.592439929474421e-01   +5.713275549177060e-01   +4.628959243928062e-01   +3.041983928776794e-01   +4.044981479179298e-01   +7.398422961022690e-01   +4.987159037307303e-01   +8.190184146911550e-01   +5.703855773178332e-01   +5.520452014222705e-01];
L1E_L1I_iGABA_netcon = [+6.130969187558470e-01   +6.162210981988474e-01   +4.711398553915838e-01   +6.641357137083205e-01   +6.488366975428361e-01   +6.434908898337215e-02   +2.447172763464034e-01   +5.547310072269546e-01   +2.296122898756361e-01   +1.392830660619906e-01   +3.358859144984435e-01   +7.771180000346443e-01   +6.888437974555102e-01   +2.564530265160151e-01   +2.217241992260254e-01   +8.330458111963636e-01; -1.478818012401037e-02   +2.769258108194925e-01   +7.087202523163060e-01   +5.373978576184265e-01   +4.543246766664875e-01   +6.321068804845901e-01   +8.344787028896825e-01   +7.201311615661250e-01   +2.229678143607910e-01   +2.368153402670054e-01   +5.481038198759777e-01   +9.488216966081923e-01   +1.809438404855409e-01   +8.356004942443644e-01   +5.295378096552269e-01   +6.144898486721112e-01; +1.472535217424899e-01   +2.044690519083167e-01   +5.084833276034301e-01   +8.405074753739386e-01   +5.920480562601244e-01   +4.323391611727789e-01   +3.235551446889197e-01   +7.815590046261957e-01   +6.943230278965539e-01   +3.231820043853384e-01   +2.733737363046316e-01   +2.051456703975995e-01   +6.953884691244437e-01   +7.012788822197031e-01   +5.364642269171378e-01   +7.437796643987653e-01; +1.291642231001210e-01   +4.656197982270323e-01   +8.568490917656294e-01   +4.943929579818744e-01   +1.750517201096187e-01   +3.115045790324528e-01   +7.060206128906170e-02   +4.702939584316292e-02   +7.302541115665668e-01   +3.125262819651785e-01   +1.000000000000000e+00   +3.150545291091953e-01   -4.258172471939140e-02   +5.558073695980350e-01   +2.205488399697144e-01   +3.468319573028105e-01; +5.906015791123359e-01   +3.153834573768639e-01   +1.519572772430222e-01   +5.523123234962595e-01   +5.394616261155545e-01   +3.156627600378799e-01   +1.988188783397289e-01   +8.994957643367112e-02   +5.719670049133727e-01   +5.280361912922986e-01   +7.210802825381325e-01   +4.473913113768512e-02   +4.022413594564409e-01   +7.058961026632202e-01   +5.360400038567648e-01   +6.327525742767406e-01; +4.089669624745065e-01   +5.197556713512312e-02   +7.415864632200195e-01   +6.589243946301347e-01   +3.665296289609215e-01   +1.064576435269695e-01   +8.528573534281364e-01   +1.075138122758466e-01   +7.715771271738172e-01   +6.128384285864851e-01   +7.051639578834219e-01   +7.335402964828953e-01   +5.135287364875909e-02   +2.270781667859272e-01   +3.038375448991086e-02   +8.375690119828754e-01; +2.748424980611566e-01   +6.153555474978936e-01   +5.740399063311159e-01   +6.305348009746620e-01   +5.792675811959386e-01   +2.778373602788587e-01   +2.424868823787532e-01   +3.453997868648661e-01   +9.013311838036685e-01   +1.487955442991813e-01   +1.033129921176972e-01   +1.107791019665640e-03   +8.487721361927556e-01   +8.185686915887094e-01   +5.476266516831991e-01   +4.918451504322941e-02; +9.065098178302190e-01   +4.025218311481625e-01   +4.408463201119903e-01   +4.807031545096982e-01   +1.425515656073836e-01   +5.985093125674539e-01   +3.746943164905226e-01   +7.994071959541933e-01   +2.006342884798546e-01   +8.015403927548937e-01   +6.571397968783469e-01   +2.471283799979848e-01   +6.941975294587510e-01   -1.937496967774440e-02   +8.155144653951293e-01   +5.508227240959679e-01; +6.694710840776875e-01   +5.485577036406003e-01   +6.748691547302853e-01   +1.944787304278310e-01   +7.417764985457795e-02   +6.700329381352057e-01   +4.951806346566677e-01   +4.400198469543124e-01   +9.702623941206452e-01   +1.072108200829313e-01   +5.902376172036994e-01   +3.798996794604766e-01   +6.604271995709855e-01   +7.620016599619375e-01   +1.184305890603436e-01   +6.742596074429704e-01; +5.420590395320199e-01   +3.472064695538463e-01   +5.086472137742732e-01   +6.933974157722915e-01   +2.268491163354974e-01   +7.073007103742461e-01   +2.264218976532683e-01   +4.542927038464691e-01   +5.317317600101217e-01   +5.056951259927143e-02   +8.385505705738024e-01   +3.186447420839614e-01   +8.158634906712021e-01   +6.116095447626598e-02   +1.562611085734396e-01   +2.036089347778938e-01; +2.770009716075325e-01   +1.204316115775665e-01   +4.999915174270746e-01   +5.105904654470768e-01   +2.761079775783796e-01   +8.323651814037727e-02   -3.640651964579136e-02   -4.331552546010810e-02   +1.558988249420471e-01   +5.449028937548420e-02   +1.358832227921970e-01   +4.419050269244538e-01   +7.366320262717201e-01   +5.241885199794983e-01   +5.075356219263248e-01   +8.460895168097422e-01; +6.610140417712990e-02   +9.668649522772707e-01   +6.073813315944834e-01   +7.281218240991284e-01   +5.244172387152807e-01   +6.911835053274323e-02   +6.003114367216007e-02   +4.354239953950870e-01   +7.087212969146351e-01   +6.291294318853715e-01   +4.615764460963392e-01   +7.679260388504747e-01   +1.659774585482511e-01   +7.199284589343498e-01   +7.451384964703662e-01   +2.201221374641698e-01; +6.051858526222338e-01   +5.686156257150415e-01   +9.113788412223379e-01   +3.325242049309094e-02   +5.409722314160564e-01   +4.592143521305310e-01   +6.913737269994682e-01   +7.515586255125846e-01   +2.400699587374568e-01   +1.719642622702549e-01   +1.566046563944430e-01   +6.292295805563060e-01   +4.049502054074081e-01   +2.924449129063031e-01   +2.024746230387838e-01   +1.197945072450245e-01; -3.858034964057135e-02   +1.522037859103641e-01   +4.989134531298246e-01   +2.850786856293584e-01   +3.181970864097545e-01   +7.980878369111239e-01   +6.868273110532235e-01   +4.434761052515900e-01   +8.078740866412074e-02   +8.708763291561258e-01   +8.277226823478963e-01   +2.765461714720972e-01   +3.429739126650379e-01   +5.245058185808252e-01   +2.039654608543228e-01   +7.102707719394693e-01; +7.893399445184321e-01   +8.199265190362769e-01   +8.161564190333994e-01   +9.579595009219549e-01   +1.097958224731861e-01   +5.088321245153216e-01   +6.823300321055256e-01   +8.280804361880173e-01   +3.843386589507360e-01   +4.149456705000804e-01   +7.701287116472213e-01   +5.283084389898007e-01   +7.542040300281704e-01   +5.837665542510591e-01   +7.597933436613434e-01   +7.222364371430842e-01; +3.928724265799716e-01   +3.729327992494907e-01   +6.046936830902566e-01   +1.745055780741308e-01   +4.218339157473662e-01   +6.284966457050584e-01   +2.961623779820223e-01   +4.875873171687998e-01   +4.635303792147298e-01   +6.572759608672266e-01   +5.223716508204236e-01   +3.538946104619279e-01   +2.021163650614143e-01   +4.932247392780432e-01   +5.670470053330177e-01   +3.302747719482822e-01];
L2I_L1I_iGABA_netcon = [+5.482491030655610e-01   +6.648928882509864e-01   +7.868871294780904e-01   +9.092965044693339e-01   +8.783176989419612e-04   +9.279760702653009e-02   +3.779350643591837e-01   +1.145488720041392e-01; +3.568320528870834e-02   +5.927687456812535e-01   +8.433396917131287e-01   +5.330912959296032e-01   +4.006501731719541e-01   +2.579980502550287e-01   +2.162566681383235e-01   +5.190103959518962e-01; +1.822996057576313e-01   +4.560705534640078e-02   +8.316476539278508e-01   +8.700343456421816e-01   +6.909069756402263e-01   +1.077468606044673e-01   +5.996164677391358e-01   +6.585448203756743e-01; -3.283233346370023e-03   +3.276973566198745e-01   +2.307147034345028e-01   +8.125595383177547e-01   +5.195410865406431e-01   +4.753519102043661e-01   +2.615006395077699e-02   +4.387621687232943e-01; +8.569287057497554e-01   +8.163299307328979e-01   +8.447458849066742e-01   +6.186363811246389e-01   +5.106425315678558e-01   +8.898410495524040e-01   +1.343129523645796e-01   +5.072700574386705e-01; +1.341208564937875e-01   +6.105549772387110e-01   +6.236422119516678e-01   +7.533241010028581e-01   +7.342504293424563e-01   +4.453661875970376e-01   +9.147922039937090e-01   +2.918281128520083e-01; +1.759510379195024e-01   +6.132149808315421e-01   +8.788612202549392e-01   +9.070565982186510e-01   +2.105432956266761e-02   +7.070139812576387e-01   +1.815563257599299e-01   +6.615773074162686e-01; +4.305278560378947e-01   +9.564903229503752e-02   +7.626719981782836e-01   +4.305847481255954e-01   +6.691367457154243e-01   +5.888307152760457e-02   +2.201142281434225e-01   +8.432232952020783e-01; -1.282975613058153e-02   +1.644845688946253e-01   +7.144660443264076e-01   +3.218596148855613e-01   +6.560287642020211e-01   +2.433033089887328e-01   +3.866297059801590e-01   +3.674940005587000e-01; +2.114151263218058e-01   +7.866106326272393e-01   +2.627362034916979e-01   +9.814236938003909e-02   +7.334942794086498e-01   +8.366573180473306e-01   +7.930007984833154e-01   +8.455983160064662e-01; +8.466061634959029e-01   +2.735302582873911e-01   +4.654751876225585e-01   +3.098436620865284e-01   +5.980287092505130e-01   +3.806627541796693e-01   +1.920291808751079e-01   +7.304889841257859e-01; +8.367258365350647e-01   +3.338314136797254e-01   +7.740425954484432e-01   +6.804463347618701e-01   +8.823270017179058e-01   +4.627162649571450e-01   +4.743132823088528e-01   +1.000000000000000e+00; +5.101197310906372e-01   +2.497697168373093e-01   +6.144647709936576e-01   +6.409169190102570e-01   +3.048985099626468e-01   +7.760785190824399e-01   +1.121577720086218e-01   +7.678835420142825e-01; +1.461622594596325e-01   +7.306556342428626e-01   +8.092477448757159e-01   +8.544488939607031e-01   +4.020040578873754e-01   +5.514494953566870e-02   +2.964741878786449e-01   +2.173297338988135e-01; +1.873089973466155e-01   +2.515893714241146e-01   +9.683820403133860e-01   +5.677028970191339e-01   -3.164273743268700e-03   +4.782171931699876e-01   +8.131702971740130e-01   +8.246740611379166e-01; +5.121612741647741e-02   +3.324192514263349e-01   +3.055104708571929e-01   +8.274033358571168e-01   +7.781740877115545e-02   +2.844584719326841e-01   +1.574730847364164e-01   +8.247141493623659e-01];
L1I_L2I_iGABA_netcon = [+2.334102140398901e-01   -2.080594241683556e-02   +7.801881366296010e-01   +3.305514280838530e-01   +7.415494471061510e-01   +7.023784339970097e-01   +8.422292434615891e-01   +8.128264614849626e-01   +3.957984349863066e-01   +8.977357059685019e-02   +5.191856525262777e-01   +7.159388321700422e-01   +6.431489601637556e-01   +5.666968033604493e-01   +6.905399085879361e-03   +1.156399728377798e-01; +6.087225514868529e-01   +5.889805034223291e-01   +5.507687645494250e-01   +9.399595668048935e-01   +8.775759090132344e-02   +1.792021668131467e-01   +7.920132945400544e-01   +1.160575428144835e-01   +2.221443204302315e-01   +4.879133209563957e-01   +7.045848816896434e-01   +8.366068981949797e-01   +5.740090174865911e-01   +6.782548212435965e-01   +8.410594456007279e-01   +7.581098481833660e-01; +5.122583088561241e-01   +3.862547262885591e-01   +5.549855778876727e-01   +6.037204615727607e-01   +8.229169848805411e-01   +8.180765617920781e-01   +6.274774902306125e-01   +2.345199498769738e-01   +3.726082653905769e-01   +6.359758127321007e-01   +5.342975933028522e-01   +5.265325751205828e-01   +1.596450604650422e-02   +7.841628614651824e-01   +2.437381845642144e-01   +3.512607163079768e-01; +2.721841511021056e-01   +8.983590652896248e-01   +5.557157392611874e-01   +3.786392536026459e-01   +2.820021189067093e-01   +1.755279035480494e-01   +7.033297688294087e-01   +3.883686175200425e-02   +3.182692120980778e-01   +7.554163046030968e-01   +2.932842404593133e-01   +6.361238548982494e-01   +5.717228724532537e-01   +7.706355876359402e-01   +5.697464998385563e-01   +6.240354410561109e-01; +5.520088889657562e-01   +5.350483243626327e-01   +8.695418454595418e-01   +2.622897478359671e-01   +9.337520465605219e-01   +5.939839970572196e-01   +4.691442082446722e-01   +5.093065794325682e-01   +2.222015014482407e-01   +7.849737947776989e-01   +1.077665836956303e-01   +7.567754994526502e-01   +7.510681199745292e-02   +1.806579408173506e-01   +4.098073015762242e-01   +3.527968072061481e-01; +2.173391965098311e-01   +1.159001868204740e-01   +2.053254087237365e-01   +6.285895315159928e-01   +1.000000000000000e+00   +2.067548419800592e-01   +1.165424521023138e-01   +2.139820830567301e-01   +5.123291520072694e-01   +7.129400962242723e-01   +1.081532654607061e-01   +4.459577186275452e-01   +8.037784649039945e-01   +5.246759598529139e-01   +4.633512113672509e-01   +3.940743110075000e-01; +4.697757338954415e-01   +9.582347501991865e-01   +1.283399185556681e-01   +7.999248443083853e-01   +1.867006972630490e-01   +9.121386513316888e-01   +1.216083548810451e-01   +2.831810006912434e-01   +5.123017701006953e-01   +1.554184967849882e-01   +8.605427698253503e-01   +4.781015684569779e-01   +4.142297908909282e-01   +5.133576043312408e-01   +7.302519704989859e-01   +6.086553370391903e-01; +6.463352220003822e-01   +8.629543711207517e-01   +8.799370746695907e-01   +7.945601421009438e-01   +1.819042899101072e-01   +6.119933782812695e-01   +6.266622823459138e-01   +5.095696977829078e-01   +8.223619408683231e-01   +3.644346687302420e-01   +5.320454748659634e-01   +2.985759285150122e-01   +3.789765190116491e-01   +8.342282442952134e-01   +1.352429440501527e-01   +6.697342697534684e-01];
L2E_L1E_iAMPA_netcon = [+6.072758815899877e-01   +1.911121544504252e-01   +4.269372938777127e-02   +4.514889028774076e-01   +8.175989266202577e-01   +7.119552772112701e-01   +8.642683887283750e-02   +3.592110242539395e-01; +8.080105429449570e-01   +6.763575227704544e-01   +7.789689491051852e-01   +8.325619556910763e-01   +4.881595668549541e-01   +2.439450138831082e-01   +3.334726543866618e-01   +4.118768617797356e-01; +4.260801783362917e-01   +5.404496666169006e-01   +2.642241149244827e-01   +9.697123282715731e-01   +3.303441378048836e-01   +2.706642659557528e-02   +1.316056104749376e-01   +3.890836463761745e-01; +8.560656504779512e-02   +1.750979273960032e-01   +8.042049709505953e-01   -6.140166752056736e-02   +6.874264169021694e-01   +5.050029404500584e-01   +4.885708692463647e-02   +1.329900079508018e-01; +5.789256505642413e-01   +4.053102758797948e-01   +4.024448483380409e-02   +6.905212740306736e-01   +9.243795111604588e-01   +4.145275977319631e-01   +2.294053884331114e-01   +9.235519832602676e-01; +7.457149173983209e-01   +5.490681063971123e-01   +4.220021004335836e-01   +2.715542033906531e-01   +4.796326110187126e-01   +1.889994366364192e-01   +1.939453780456855e-01   +5.894565343167159e-01; +8.769871487703222e-01   +7.720427834313338e-01   +8.711444511191900e-02   +9.835299724918625e-01   +5.057136356240048e-01   +2.257116787327515e-01   +4.580535854545727e-01   +4.799687210657558e-02; +3.374368946510494e-01   +8.051595056871385e-01   +5.692023736293823e-01   +1.163604368810565e-01   +1.603789357699916e-01   +1.405387965063797e-01   +1.124648255859995e-01   +1.228655334924179e-01; +8.252830380789818e-01   +6.305528657208681e-01   +7.530040675929893e-01   +7.835996143770915e-01   +8.757293721330516e-01   +4.699031338664831e-01   +1.587972000900925e-01   +6.602216825919230e-01; +4.009114493391208e-01   +2.429710066104000e-01   +5.589332669464447e-01   +1.994637780744793e-01   +5.983818444370663e-01   +8.577917080099727e-01   +6.316883344331522e-01   -2.272965819536884e-03; +9.573821377919345e-02   +8.461975611086222e-01   +7.415875595968361e-01   +4.697954722946968e-01   +6.368414804432718e-01   +1.461896612301882e-01   +1.000000000000000e+00   +7.840603156660496e-01; +9.454291607674074e-01   +4.879202793875591e-01   +8.876764302154109e-01   +7.103890064269227e-01   +2.750579652151828e-01   +6.304100413388207e-01   +5.413105162039299e-01   +1.443041753735325e-01; +8.218466756838785e-01   +8.169210046519803e-01   +1.916178410062208e-01   +8.418888317654728e-01   +5.769488247154402e-01   +1.793946424864008e-01   +3.119240133908194e-01   +7.147199144127319e-01; +1.669395024314393e-01   +6.908015183404494e-02   +2.950891197812762e-01   +8.545690243049351e-01   +3.415358485556119e-01   +5.953568623110407e-01   +9.207750022686885e-01   +2.226005993988969e-01; +5.751393438736096e-03   +1.621031256982512e-03   +4.994304914008350e-01   +8.032728528626869e-01   +7.258380879891744e-01   +1.944213629255923e-01   +3.466262539091225e-01   +6.402761191329068e-01; +1.203122944550680e-01   +6.259954894711709e-01   +3.764054306179178e-01   +3.988898166703936e-01   +1.960694461684375e-01   +2.799564120590949e-01   +6.751043370062303e-01   +9.333209936477856e-02];
L1E_L2E_iAMPA_netcon = [+3.967317025490118e-01   +3.270580715351377e-02   +6.741363020168151e-01   +4.295118496961168e-01   +8.786377205376615e-01   +2.516958300069937e-01   +6.789452424912977e-01   +4.614312544319585e-01   +7.676877486908692e-01   +7.497474021827807e-01   +3.875528336569852e-01   +4.201490086324212e-01   +6.938781146483619e-01   +6.712543056646425e-01   +2.425372229627666e-01   +5.282358315164410e-01; +2.470816682348694e-01   +9.671404335771151e-01   +1.361108984871993e-01   +3.440626147425990e-02   +2.690231370669555e-01   +3.828676667670570e-01   +1.857084069686999e-02   +3.883172652151030e-01   +2.233612068198041e-01   +5.221424793783765e-01   +6.548849041442030e-01   +5.803088203237516e-01   +7.620740834680022e-01   +5.330251665293708e-01   +1.000000000000000e+00   +4.156387200230720e-01; +4.501301076457387e-01   +4.741630030871510e-01   +8.860487620501190e-01   +4.591437895201583e-02   +7.333254611872531e-01   +4.392237931686402e-01   +2.868487911470603e-01   +3.729652909175387e-01   +3.593660088388772e-01   +7.400498330728459e-01   +6.952575809691875e-01   +5.122766647440966e-01   +7.392187064770768e-01   +3.186544568113839e-01   +5.410675231136287e-01   +9.593768631200472e-01; +5.503436707737430e-01   +7.120881973882747e-01   +7.746159741557015e-02   -2.942874237308045e-02   +4.820627868265124e-01   +6.159384920775136e-01   +4.206616449302951e-01   -1.527942318959192e-02   +9.186059350886157e-01   +4.095430513727744e-01   +1.577096072112598e-01   +2.222347797568537e-01   +5.509178685800209e-01   +5.984425202708722e-01   +3.546981442557114e-01   +5.168769661063865e-02; +6.907822797889916e-01   +7.514070009358020e-01   +2.935129914811747e-01   +5.231936809181621e-01   +2.941989606496677e-01   +4.168175988953067e-01   +7.635959379254210e-01   +9.174006850918366e-01   -4.575852152509693e-02   +5.508498262101444e-01   -4.758162173897728e-02   +7.495681418614632e-02   -7.892585301353408e-03   +2.419575667681612e-01   +8.063275221721148e-01   +3.102041501420786e-01; +5.932727509796698e-01   +6.746578783943707e-01   +8.351247529866970e-01   +9.265107861937567e-01   +7.155350562820466e-02   +3.305384928163883e-01   +2.358565509074711e-01   +4.402746606710768e-01   +2.121089936121557e-01   +3.561222880431414e-01   +9.543071426475316e-02   +6.067848895704282e-02   +8.958959594583673e-01   +1.434494864025474e-01   +3.502769187077172e-01   +7.963547968826262e-01; +5.185885634684509e-01   +2.647211411531872e-01   +5.799737571167314e-01   +2.672268705184107e-01   +1.775117322984081e-01   +8.053081820195604e-02   +3.385896362551507e-01   +6.705794545077495e-01   +8.931398177185007e-01   +5.566629340525903e-02   +4.968973094518397e-01   +5.231683775946735e-02   +3.971734751164925e-01   +2.244346505000928e-01   +1.830245034486644e-01   +3.827709251075380e-01; +4.893278901185945e-01   +4.243649469185199e-01   +7.038574644458474e-01   +6.952483588136600e-02   +6.029698500126175e-01   +7.004385398784316e-01   +2.516175855778822e-01   +3.386669717779053e-01   +4.579401461016953e-01   +2.063311766637112e-01   +4.824345788969457e-01   +2.375096873087299e-01   +4.918560786232377e-01   +5.597618768884898e-01   +6.712108868398945e-01   +4.285282173903938e-01];
L2I_L2E_iAMPA_netcon = [+1.654807930331125e-02   +2.585978621007669e-01   +2.566666453400128e-01   +1.720263030786882e-01   +9.668499869474618e-01   +8.981822099833081e-01   +6.197844859314868e-01   +6.877932244814366e-01; +7.896128233605971e-01   +1.923891336557479e-02   +4.763364518284549e-02   +6.264370550155726e-01   +3.147344482742407e-01   +3.586604390732355e-01   +2.736544227140505e-01   +9.574126249519683e-01; +1.962000528949177e-01   +8.583329387220925e-01   +4.314853094244877e-02   +1.178424295391473e-02   +8.138757963378380e-01   +8.571069847408552e-02   -2.324545491883007e-02   +3.168666172014409e-01; +4.909193066586132e-01   +7.869873716805029e-01   +2.196521912206870e-01   +8.171942418918546e-01   +7.435891846504072e-01   +5.006607367034884e-01   +1.367620203614901e-01   +2.972661093740186e-02; +2.653187715387528e-01   +3.723111902151070e-01   +5.734928542774425e-01   +5.274217348270118e-01   +7.121467657799434e-01   +5.082181870621862e-01   +6.971666102107728e-01   +3.351046137788095e-01; +6.982786349683090e-01   +2.077819916371148e-01   +2.666230763241518e-01   +1.992414330792254e-01   +5.781626326253224e-02   +9.974017800894399e-01   +3.197976743889432e-01   -1.153995145987428e-02; +7.422721320039871e-01   +8.580456982184670e-01   +5.305513379919597e-01   +9.270866311823890e-01   +6.830333483279483e-01   +7.381950311824874e-02   +1.030219479740144e-01   +1.071156582174376e-01; +9.828914149261594e-01   +2.060822486111024e-01   +4.692712927843148e-01   +4.733122820124075e-01   +5.140186690439892e-01   +2.074729722501798e-01   +7.472052697633910e-01   +4.315514344217511e-01];
L2E_L2I_iGABA_netcon = [+1.533585069171561e-01   +3.063446524787529e-01   +3.401260045978013e-01   +1.997232445586765e-01   +8.306890172171590e-01   +7.667937783014864e-01   +7.411499657619969e-01   +5.766314880676141e-01; +8.036627730214315e-01   +9.474164347810305e-01   -1.941088903499302e-02   +5.038058239109505e-01   +2.376947628855761e-01   +9.398182863484157e-01   +5.559200058126383e-01   +3.281802753818958e-01; +9.512707783089694e-01   +2.076449655902859e-01   +8.294744391697328e-01   +1.072915058879030e-01   +7.989088589440135e-01   +7.968043698742403e-01   +7.954281281719587e-01   +1.731948577570198e-01; +3.758502860608683e-02   +4.056735168264470e-01   +8.570436398979516e-01   +7.186388168804672e-01   +8.142049472492612e-01   +7.272649863208774e-01   +3.427387019377917e-01   +8.130816747837153e-01; +1.879084673267859e-01   +9.538905176904597e-01   +8.821732762001017e-01   +5.767118812491587e-02   +4.016225918176717e-01   -2.343375984060452e-02   +5.823921900668306e-01   +1.635778476965054e-01; +1.063715952972027e-01   +3.250105114759876e-01   +3.915801696572558e-01   +5.840931228555222e-01   +4.411466497142295e-01   +8.478941968434527e-01   +3.643531392521280e-02   +2.426134421385140e-01; +3.346765003850219e-01   +5.000413970917233e-01   +7.196956274945321e-02   +7.932054114529333e-01   +4.471783384884299e-01   +4.668509239471577e-01   +7.803878356347698e-01   +6.046892531445321e-01; +2.264832354095186e-01   -5.771076243724241e-02   +6.929009231835302e-01   +7.625886779634161e-01   +6.701626224715519e-01   +6.286515292690009e-01   +5.111055656607859e-01   +8.628146813121877e-01];
L3E_L2E_iAMPA_netcon = [+2.865780507214004e-01   +9.738693440395725e-01   +2.355218108164583e-01   +1.578156138078499e-01   +9.396441180233904e-01   +6.955628618221408e-01   +2.254198445452686e-01   +9.092265267015662e-01   +8.609351672866382e-01   +3.214208308374345e-01   +3.490279270533529e-01   +6.074444177662064e-01; +3.146806881604916e-01   +3.355121825704699e-01   +6.298929989352570e-01   +5.135292327067867e-01   +4.109201304141919e-01   +4.828635933390190e-01   +3.649177819701116e-01   +6.719248449770475e-01   +2.046975523388063e-01   +3.167166176931124e-01   +3.503196639303693e-01   +5.239545546719289e-01; +5.676154338182515e-01   +7.165230754915333e-01   +5.583838464121788e-01   +6.346253837840131e-01   +5.475849768523413e-01   +5.885624856927625e-01   +5.942525777443899e-01   +3.797691111211364e-01   +5.837758693580054e-01   +2.257034088200910e-01   +5.737030233503879e-01   +9.191113231761017e-02; +5.623153722965976e-01   +3.031157912405154e-01   +7.837266004824659e-01   +5.646506938214674e-01   +6.332765631241861e-01   +8.733445248039390e-01   +1.362071356838156e-01   +2.767647361163158e-01   +4.732753821698863e-01   +4.971588117806676e-01   +1.985258642670496e-01   +9.619427541568959e-01; +1.586865884101711e-01   +2.034571818323952e-01   +5.219912462421648e-01   +2.113547015069923e-01   +1.255596526982003e-02   +4.903550505516031e-01   +4.411425649267419e-03   +8.101107558889570e-01   +2.130024963953731e-01   +7.183352607749147e-01   +4.114006272981475e-01   +7.358601285082408e-01; +4.091449499620242e-01   +7.923590418916070e-01   +2.182817722210071e-01   +4.184407120959000e-01   -2.793729159352922e-02   +3.937280672921121e-01   +3.057985160387106e-01   +8.913343028824920e-01   +7.278340360134157e-01   +1.000000000000000e+00   +6.687980590334804e-02   +8.369533616288148e-01; +3.933420602021087e-01   +6.277520800612582e-01   +3.130455786545913e-01   +7.931385088394062e-01   +1.606643287262820e-01   +8.515770506397163e-01   +8.085089453958112e-01   -3.798205601870961e-02   +1.261516626136793e-01   +9.905637114221657e-01   +6.417664595778229e-02   +4.859300511377667e-01; +3.523362207219599e-01   +6.031109306471806e-01   +4.783960559272526e-01   +7.003413611514286e-01   +1.157336708626050e-01   +4.951847614964899e-02   +4.995204602386540e-01   +1.873416313955963e-01   +3.250547993775238e-01   +7.923322254055145e-01   +4.645857078214107e-01   +4.043267196395205e-01];
L3I_L2I_iGABA_netcon = [+4.991157844893875e-01   +8.056120121616843e-01   +4.384124374420213e-01   -5.616722809140379e-02   +6.182897672467291e-01   +7.569414365849232e-01   +5.218105146809476e-01   +4.670932441360677e-01   +7.516932788784040e-01   +4.016453173549871e-02   +5.728774781575672e-01   +6.806529841544920e-01; +5.622337461584337e-01   +4.419764353159571e-01   +1.810802448294896e-01   +8.638206909995312e-01   +4.466509563486642e-01   +2.898339141582915e-01   +2.156829086615779e-02   +3.019845890381289e-01   +9.339292858738555e-01   -4.044596159790907e-02   +1.454624312099381e-01   +7.004043421800615e-01; +1.270049196185418e-01   +5.620687752795781e-02   +2.114721716583167e-01   +2.183277426702684e-01   +6.418750029690106e-01   +9.616846974902189e-02   +5.938480319076597e-01   +8.744669447173414e-01   +2.844351629019124e-01   +4.919860110796291e-01   +8.516426382258240e-01   +7.155155864758547e-01; +8.523514797321444e-01   +2.238587288673253e-01   +6.664737013838439e-01   +6.277351294434905e-01   +1.655385278065755e-01   +8.945005933226026e-01   +2.488856614187992e-01   +9.928053478906258e-01   +5.229986179609719e-01   +7.867242402975311e-01   +7.273061373347046e-01   +6.725351042457125e-01; -4.629405179260986e-02   +4.814876895217933e-01   -5.645639140886791e-02   +5.397172519220967e-01   +1.024453954454900e-01   +5.253233650316455e-01   +1.726183633885713e-01   +1.128651913439243e-01   +1.228405642611229e-01   +8.658345490033824e-01   +8.263620427412026e-01   +1.495725433060970e-01; +4.846003573802015e-01   -3.703144993559208e-02   +1.042200964449854e-01   +7.532380266782727e-01   +5.967173039625348e-01   +8.510958611197573e-01   +8.652466129032585e-01   -9.658575297975498e-02   +1.402651661915236e-01   +5.361423291479043e-01   +3.098304271623717e-01   +5.244861845823788e-01; +2.815748107700297e-01   +2.902967937937975e-01   +4.598025525020198e-01   +4.125279734051204e-01   +8.050764805165005e-01   +6.264874442470632e-01   +5.310044102828841e-01   +3.319906325384219e-01   +6.585067091398655e-01   +3.516360304368575e-01   +9.043917076666596e-01   +8.085927438519613e-01; +5.838439626944949e-01   +4.991860893525500e-01   +3.858778868077802e-01   +4.696672617872346e-01   +4.585147938282921e-01   +4.718176469744321e-01   +6.215178092407697e-01   +5.778139734391894e-01   +4.849592943079289e-01   +4.231269710093648e-01   +2.126663590768247e-01   +3.799349338715977e-02];
L2E_L3E_iAMPA_netcon = [+8.982992881119803e-01   +1.617643905739579e-01   +2.712142661056749e-01   +1.957154325627563e-01   +7.492744105521868e-01   +3.760208065934426e-01   +4.948795794547373e-01   +2.714328271016387e-01; +4.004521209415902e-01   +7.828937418123683e-01   -3.223075175559680e-03   +6.798450671517420e-01   +2.825776806565393e-01   +1.758295543478547e-01   +1.780833641978878e-02   +6.255179490405970e-01; +7.796852274070613e-01   +3.599593767171729e-01   +2.386335869685997e-01   +8.211661957852477e-01   +8.645775498390033e-01   +4.493278119793634e-01   +4.078461590251123e-01   +3.534523198632348e-01; +4.491883007300868e-01   +5.185084798739790e-01   +8.469244327814015e-01   +7.289954255551032e-01   +6.190727309567068e-01   +3.803918079025671e-01   +4.457077761818481e-01   +6.974871560614226e-01; +8.339309404957989e-01   +5.728152505304989e-01   +1.781879235631189e-01   +4.443065487208396e-01   +3.252162982763389e-01   +8.438638634111189e-01   +1.158149830444120e-01   +5.151587728845648e-01; +6.481606511112394e-01   +4.453791685876315e-01   +7.756280473681674e-01   +6.536088396510129e-02   +9.161936526104769e-01   +1.000000000000000e+00   +7.475320540943277e-02   +8.799218871162588e-01; +6.072985421055047e-01   +4.853902874125309e-01   +4.378642871373473e-01   +5.152344201419440e-01   +7.454685269262735e-01   +5.324714174366529e-01   +2.531014910610259e-01   +7.041239411786796e-01; +5.963278886786441e-01   +4.730042338184062e-01   +4.572034680379066e-01   +4.640241396352206e-01   +7.928141364069501e-01   +1.554862418015173e-01   +8.216189822484780e-01   +9.624050711626720e-01; +5.186353031829813e-01   +4.246769509953587e-01   +7.322376164884260e-01   +3.641151494398683e-01   +2.530848362826742e-01   +8.788285556019693e-01   +5.430145039727635e-01   +4.737357651299287e-01; +1.482562450935764e-01   +1.397265292039811e-01   +7.000523590219664e-01   +5.242086201794310e-01   +4.087396175144029e-01   +7.862366019338389e-01   +5.448534235180982e-01   +5.719960938074480e-01; +8.573447417206511e-01   +1.823071519080619e-01   +6.584067808980494e-01   +1.515080055516366e-01   +3.576337004435992e-01   +3.957666866086815e-02   +4.410234713245421e-01   +6.028862589781466e-01; +5.650747300648886e-01   +2.735277583046288e-01   +3.840826605200037e-01   +2.042332035907649e-01   +9.183000370587449e-01   +3.133389242998721e-01   +9.423858744634220e-01   +9.398906025610517e-01];
L2I_L3I_iGABA_netcon = [+1.525559972838333e-01   +5.296594789076159e-01   +5.484637493625724e-01   +8.662913167413696e-01   +4.339834799355239e-01   +2.305108211475623e-01   +4.195004129529821e-01   +3.947552528244530e-01; +2.086463562264544e-01   +5.664464289700557e-01   +8.251737086547889e-01   +8.804934642509673e-01   +6.130492928880737e-01   +9.953334867521908e-01   +4.766742928201767e-02   +8.092651068946103e-01; +4.563143857461591e-01   +8.187086608451677e-01   +8.336282423947837e-01   +4.293848757124065e-01   +1.552453866342643e-01   +3.900866753507571e-01   +6.203859396761616e-01   +1.193816984185774e-01; +3.077709889205149e-01   +1.057451351320818e-03   +8.837606715966748e-01   +3.567709827307095e-01   +3.475731251072772e-01   +3.397032982630325e-01   +2.230497045620998e-01   +6.579487346566951e-01; +9.246134174208382e-01   +4.102416791774205e-01   +3.812451344199967e-01   +5.562944217410288e-01   +5.150205284965010e-01   +8.534803524221272e-01   +6.083940778284977e-02   -1.844777477840104e-02; +3.741614060009988e-01   +2.501811580224275e-01   +3.691282168649863e-01   +5.259842497873732e-01   +9.680676222932940e-01   +6.018754456779765e-01   +8.672421004834050e-01   +1.753576955159199e-01; +8.252911587810210e-01   +2.243815803175675e-01   +7.898292548550111e-01   +9.104341805018281e-01   +6.610199322113474e-01   +2.021340341557094e-01   +1.000000000000000e+00   +1.363021760337283e-01; +8.833798174245551e-01   +4.594194039243441e-01   +8.608835815363116e-01   +2.912872453375114e-01   +7.336930517923136e-01   +7.975515843838890e-01   +8.147279035597348e-01   +1.598235161299627e-02; +4.318834952305834e-01   +6.032329337912462e-01   +7.378208569907855e-01   +5.495007490510236e-01   +5.304378357452671e-01   +3.168467158271252e-01   +8.481970894486112e-01   +9.562916530791160e-01; +8.101630101233647e-01   +6.016321121957259e-01   +5.637931953359561e-01   +5.718929705045267e-01   +3.596667219271392e-01   +3.727157722361861e-01   +6.992271471079749e-03   +6.897508141286428e-01; +8.741968413228506e-01   +6.926009892095746e-01   +4.602227776455795e-02   +5.001254007715544e-01   +3.309384687261022e-01   +6.559237817503857e-01   +6.153815545840629e-02   +3.357274390978234e-01; +5.125480761002273e-02   +4.682791560863706e-01   +1.477949504733312e-01   +8.659554728556088e-01   +9.114915476785447e-01   +1.985298819558144e-01   +7.781283935382313e-02   +4.412680003792231e-01];
L3I_L3E_iAMPA_netcon = [+4.187098395350657e-01   +3.932116225409566e-02   +7.794894024480799e-02   -8.081817418445381e-04   +6.177956234565427e-02   +6.145587714654489e-01   +2.599076979439911e-01   +5.816500332340785e-01   +2.305764456582121e-01   +6.299164479757736e-01   +5.995885850597164e-01   +6.471270935438597e-01; +8.488714206318709e-01   +2.744964001042106e-01   +6.850970453922107e-01   +3.319968906153632e-01   +7.954526657652772e-01   +7.341910620097996e-01   +8.202653090094025e-01   +2.298636114199094e-01   +1.311856831774391e-01   +4.323137877803453e-01   +7.687274685621165e-01   +3.165102448566773e-01; +8.289819992573196e-01   +1.068632433197791e-01   +3.227381084452445e-01   +3.366195412403541e-01   +7.487773784391767e-02   +4.644534542969849e-01   +4.988017846967611e-01   +2.567953122530669e-01   +3.610354144386786e-01   +3.123704638725642e-01   +3.614251592625697e-01   +3.702420421614342e-01; +7.413985707254476e-01   +4.088210491503966e-01   +8.441094347619051e-01   +6.157349150759817e-01   +4.018690554954801e-01   +5.805905215812401e-01   +2.701076889223202e-01   +6.494408441868195e-01   +4.835790146613776e-01   +1.408013679756710e-01   +6.016279300663796e-01   +3.172735319114401e-01; +3.460354191116548e-01   +2.163693057395099e-01   +2.850559902375607e-01   +4.466421150156830e-01   +6.854727581431779e-01   +4.203082685844896e-01   +4.191523646473675e-01   +1.333963877968558e-01   +3.646536448949912e-01   +6.268684809882715e-01   +4.836360838537421e-01   +3.843471877955680e-01; +9.549059005802588e-02   +2.221568588072456e-01   +1.751918332388916e-01   +5.099749644069066e-01   +2.090207887265734e-01   +1.187583377979717e-01   +1.055029529731260e-01   +7.076044866912169e-01   +2.886707803187979e-01   +1.097916762561599e-01   +6.373652349525861e-01   +1.980595687761939e-01; +9.650829637259015e-02   +5.708484169971519e-01   +7.529130721225594e-01   +3.879900119319145e-01   +6.191297045983489e-01   +3.796972835961004e-01   +7.337985885591169e-01   +4.319944685948223e-01   +9.136205722427163e-02   +7.217241877657781e-01   +8.671202000953866e-01   +8.324803833550445e-01; +8.602407780741016e-01   +5.331116256943194e-01   +5.140583997436556e-02   +6.814399136295803e-01   +5.470152182601993e-01   +5.298067684495468e-01   +3.990312080776943e-03   +1.264673932935385e-01   +7.872615506253968e-01   +6.223495153156096e-01   +2.285820512388857e-01   +6.546900519387953e-01; +6.026361503501121e-01   +8.243384514815468e-01   +8.334049363510615e-01   +6.326085422502005e-01   +5.912239311700661e-01   +5.657510755266996e-01   +4.491671320944705e-01   +3.950455504747760e-01   +3.818030231263712e-01   +4.504573302052715e-01   +6.891815577444557e-01   +7.619368927481843e-01; -3.655217902315849e-02   +8.375436705595561e-01   +7.882144862975200e-01   +6.530616463863940e-01   +8.241359259564588e-01   +7.965092771373639e-01   +4.181266562094593e-01   +3.268358810621818e-01   +6.486154867247788e-02   +8.956250010968332e-01   +4.189025732740604e-01   +8.404481516887063e-01; +6.755903864214189e-01   +1.952801922440889e-01   +6.085456012039674e-01   +8.405046948953897e-01   +1.693648333773869e-01   +6.022184935173480e-01   +6.569547772579089e-02   +8.004142757497638e-01   +8.661389901610720e-01   +2.412815059957681e-02   +5.853506926772635e-01   +5.336920352665887e-01; +5.643572402817383e-01   +4.961774423327563e-01   +7.604864500792889e-02   +1.068058202454413e-01   +6.575343876641424e-01   +3.694360184310776e-01   +1.000000000000000e+00   +2.791909061247683e-01   +2.135952438930744e-01   +4.176095284660402e-01   +5.584023521967072e-01   -4.948254891200665e-03];
L3E_L3I_iGABA_netcon = [+5.269735015906206e-01   +9.603172724891018e-02   +7.575614765682783e-01   +2.011784562738719e-01   +2.960493546911785e-01   +6.761896238093661e-01   +9.305383357206041e-01   +3.918418106734281e-01   +3.539195964210903e-01   +4.769826484282637e-01   +2.177982421314933e-01   +4.100647611329628e-01; +2.033061090891475e-01   +6.962351893616106e-01   +4.038706694140538e-01   +5.524624766856248e-01   +5.908700610981215e-01   +1.974676154723465e-01   +4.041223716735997e-02   +1.268537199940599e-01   +4.718401703732344e-01   +8.165244253114584e-01   +8.102189180775556e-01   +5.452727210435209e-01; +3.582593389407235e-01   +2.416774508497079e-01   +6.380704466757280e-01   +5.546239579458117e-01   +6.662522245699239e-01   +7.872952189243704e-01   +4.037396540829937e-01   +2.425344991720165e-01   +6.959446527906789e-01   +6.743361103881931e-01   +7.868339617669862e-01   +9.467421317547791e-01; +7.957956844278480e-01   +7.121957543872662e-01   +8.063718593834704e-01   +5.259251144608078e-02   +3.819751724254349e-01   +6.789645445682654e-01   +4.615253558028853e-01   +4.800378259916915e-01   +1.493987248764350e-01   +8.338475383867998e-01   +7.173775138447210e-01   +8.038942444573299e-01; +9.332298552901429e-02   +4.840864680235060e-01   +5.885396030478086e-01   +5.224998200733090e-01   +4.625508099976545e-01   +2.488372689729976e-01   +5.488608801413825e-01   +4.970240969162161e-01   +5.107664390457878e-01   +6.455213385151548e-01   +6.758313196630862e-02   +8.400235066927090e-01; +5.534601441895848e-01   +8.240199726104965e-01   +1.030998152310311e-01   +5.848023141598440e-01   +9.089457375730142e-01   +2.285732201398449e-01   +5.067019477265221e-01   +3.997823922236287e-01   +6.131053946994044e-02   +6.005767887800461e-01   +5.136676176081462e-01   +8.773792930537002e-01; +8.915603858077455e-02   +5.014234722258726e-02   +3.698689893249430e-01   +6.955044411781276e-01   +3.818161394423816e-01   +3.358448531830215e-01   +7.283692864129135e-01   +4.947157226283937e-01   +3.395603431003414e-01   +7.311704341861844e-01   +6.039291725509097e-01   +2.053429069844689e-01; +6.449506179837111e-01   +2.469669854372769e-01   +7.694488843180262e-02   +2.114408610949507e-01   +6.445950958847428e-01   +6.150873169011938e-01   +7.437754856008428e-01   +2.825106191826158e-01   +2.904598569117700e-01   +1.581964232577132e-01   +8.930651409185383e-01   +9.526280708895122e-01; +5.152776121044869e-01   +4.489721287515242e-01   +3.016442210548007e-01   +6.749459268928314e-01   +1.809783921523116e-01   +6.222796156941460e-01   +9.755934381676403e-01   +3.689710481367157e-01   +2.190421647153022e-01   +8.113778985601221e-01   +8.889705919640318e-01   +1.232736909923508e-01; +1.741548659272778e-01   +6.193552251401027e-01   +1.043519550988242e-01   +7.098219299388723e-01   +5.517263209959693e-01   +1.601110857759054e-01   +3.862552646256629e-01   +1.000000000000000e+00   -1.606161196075855e-02   +3.705309155080447e-01   +4.532330133811705e-01   +4.169714115152752e-01; +7.044818836192113e-01   +8.006703055428726e-01   +9.187998269315250e-01   +3.162516980738495e-01   +2.375596752391684e-02   +7.299787037510291e-01   -3.534135673282043e-02   +8.805990529559334e-01   +6.290550887221353e-01   +6.750348847177848e-01   +9.282911846364843e-01   +6.194473953681197e-01; +1.355141610692298e-01   +4.830820043999562e-01   +4.939695385376268e-01   +6.879290396204489e-01   +5.330190969035564e-01   +2.983565980721700e-01   +9.763192348723535e-01   +7.128308824289172e-01   +7.102929759429280e-01   +6.532380193804455e-01   +3.929489778547944e-01   +2.189204950525720e-01];
L2E_Input1_iAMPA_netcon = [+8.549588826423158e-01   +9.050845451677586e-01   +8.231834087915565e-01   +1.000000000000000e+00   +8.617427399286219e-01   +8.511199418399346e-01   +9.721156602196600e-01   +8.954414112044736e-01];
L2I_Input2_iAMPA_netcon = [+9.466912233139783e-01   +9.255058487546801e-01   +9.766679956490579e-01   +7.963791803394970e-01   +8.025939131191520e-01   +9.306157426191429e-01   +8.457411970602945e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
