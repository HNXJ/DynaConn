function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.140928348348100e-01   +9.460228930950078e-01   +6.983103608355455e-01   +1.549581784781960e-01   +9.216383025804333e-01   +2.193565625396789e-01   +7.406452449677663e-01   +3.025988690754139e-01   +5.330466211122671e-01   +8.288628369209688e-01   +9.685305923662280e-01   +9.644730560573936e-01   +6.962044266353113e-01   +3.711554805056144e-01   +2.973085223991063e-01   +3.777519159751686e-01; +3.459691638879139e-01   +1.306263673416173e-02   +1.416106037266182e-01   +1.764773822731415e-01   +7.078730001986025e-02   +8.081265677896258e-01   +7.943604910621059e-01   +7.591353587703983e-01   +7.844399240793857e-01   +1.815554390178641e-01   +4.660511360232145e-01   +6.560291784380821e-01   +3.759889693740280e-01   +2.753690275261667e-01   +6.849091840997195e-01   +9.536387835886282e-01; +2.077435698235215e-01   +4.677015337480773e-01   +8.327582346263898e-02   +7.027842258552888e-01   +3.130637364083050e-01   +3.814287440480943e-01   +6.633820402801129e-01   +9.529614288467787e-01   +4.859649924334976e-02   +9.258535364792211e-01   +8.697956332728211e-01   +2.089848339097326e-01   +5.417553708786890e-01   +7.556546244961684e-02   +7.729646327582437e-01   +8.118227230564675e-01; +2.474910150689507e-02   +4.898467130897221e-01   +4.327558410678556e-01   +8.324201994487258e-01   +6.280985828522910e-01   +8.568115956081793e-01   +4.409003688228972e-01   +8.714115279724219e-03   +4.622666255554931e-01   +4.205668758597946e-01   +9.464359679873429e-01   +8.968772651480884e-01   +5.183410662147828e-01   +1.507586928445714e-01   +7.204370634700034e-01   +8.922918918398024e-01; +7.657515168091275e-01   +5.158651570945718e-01   +8.949521475356012e-01   +8.124698551287085e-02   +9.058596287054090e-01   +3.227686929079133e-01   +5.751929964639452e-01   +4.071097490206040e-01   +9.378342219624948e-01   +3.001562095437032e-01   +2.321161503590452e-01   +4.879894863812043e-01   +7.635817331042896e-01   +3.650141241229928e-01   +2.785487355806440e-01   +6.878435935007707e-02; +5.712739024718514e-01   +2.872655033176932e-01   +7.320677095541908e-01   +8.346605219428385e-01   +7.961497048892733e-01   +3.791535490934986e-01   +5.184006168048941e-01   +1.520857064187872e-01   +4.735443647194159e-01   +3.486035767462720e-01   +9.179410389497494e-01   +6.619153483494501e-01   +8.012727982452597e-02   +7.168912111994823e-01   +1.406540137650975e-02   +9.023877377601821e-01; +5.770509506839142e-01   +5.652522484482442e-01   +6.807069548789392e-01   +5.417136591100267e-01   +6.430858944724416e-01   +6.366558518013342e-01   +7.250247285559822e-01   +8.217033473518239e-01   +7.784287281257818e-01   +9.717052377290486e-01   +6.342235028898806e-01   +5.260305728822147e-01   +5.021767923376676e-03   +5.321641258692524e-01   +1.508389793701172e-02   +6.676741525149708e-01; +3.899868293865039e-01   +5.099484965850044e-01   +2.020748705611303e-01   +9.622292323407420e-01   +4.399048234643113e-01   +3.868493243172519e-01   +2.228356546934019e-01   +2.878804679746153e-01   +1.092238362151912e-01   +5.305790481915338e-01   +2.843660857209583e-01   +7.085926702152784e-01   +4.007926561892813e-01   +2.322136557865471e-01   +9.363255334719789e-01   +3.469858447515911e-01; +5.569417147222915e-01   +6.787515997684700e-01   +5.298239444359401e-01   +6.774848691431917e-01   +7.483666078919459e-01   +6.719593843049489e-02   +9.974244077588733e-01   +9.775932083764434e-01   +5.218462984099699e-01   +7.900290655306129e-01   +8.556577704815646e-01   +7.186192817717421e-01   +6.627624780635306e-01   +4.710857636298507e-01   +9.339249257695621e-01   +8.370000827025973e-01; +1.831443280755156e-01   +6.153213648200262e-01   +8.306694824534752e-01   +3.359793008238194e-01   +8.254989121867988e-01   +1.718191495876619e-02   +6.197539510426601e-01   +6.257387478900762e-01   +6.357376457430465e-01   +7.940968697672580e-01   +1.657911754012266e-01   +2.939837649253522e-01   +3.682246255867786e-01   +7.168989164122277e-01   +3.737144159118598e-01   +1.987949136630824e-01; +1.179793248998320e-01   +5.650203672645998e-01   +1.752922238155391e-01   +2.209033744230456e-01   +3.414689605754487e-01   +8.793782082074597e-01   +9.803520874540461e-01   +7.429231406487609e-01   +5.786516077999024e-01   +1.438068786395580e-01   +8.272085975029028e-01   +1.172235156693932e-01   +3.927823435129576e-01   +5.145891150752440e-01   +1.089433715122508e-01   +8.411443724358996e-01; +5.920985913878441e-02   +5.052401204841779e-01   +5.179558403630404e-01   +5.685520090953166e-01   +1.393921000474425e-01   +1.576413333786271e-01   +4.955081333272562e-01   +8.720911108221480e-01   +8.356662133280273e-01   +4.567031399206262e-01   +2.167133575029067e-01   +3.248790170180977e-01   +1.342622202740539e-01   +5.133582880782593e-01   +7.192047301072994e-01   +4.248593941490784e-01; +9.327017969769639e-01   +6.673690507593985e-01   +3.563836553227393e-01   +2.553187040588097e-04   +5.040106662121766e-01   +9.138093969686680e-01   +5.221390930442987e-01   +3.293914820905399e-01   +1.152359105178761e-01   +4.582588091304103e-01   +2.674713410806234e-01   +4.570447570383745e-01   +3.384375056508385e-01   +3.858942907700872e-01   +4.485502156422498e-01   +5.582354751174378e-01; +7.456002744770334e-01   +6.332644339621784e-01   +6.458218592776606e-01   +5.884772440800234e-01   +4.139179959382243e-01   +5.570423495887474e-01   +8.540697807633066e-01   +9.835580080458098e-02   +5.126478406531763e-02   +9.544727705211110e-01   +8.686559715761530e-02   +7.162989639327312e-01   +1.230194390989629e-01   +4.783963078102991e-01   +1.277094540991566e-02   +4.473324066874225e-01; +2.434335518782772e-01   +1.441903948577415e-01   +2.817060427136898e-01   +8.911161584499139e-01   +1.713763044983405e-01   +9.223385603491944e-01   +2.537390799819946e-01   +4.503184875885127e-01   +5.177213197114179e-01   +5.300645772672808e-02   +9.164986714209014e-01   +4.051981198467305e-01   +3.683251745940050e-01   +7.396497610339046e-01   +1.236460314905903e-01   +7.602365221256794e-01; +2.043048276532559e-01   +1.785742735305195e-01   +4.364496477348875e-01   +2.545252770079046e-01   +4.941143642172338e-01   +5.977214513725503e-01   +5.823840774014856e-01   +2.400447323320629e-01   +6.968017189001223e-01   +3.584791479971326e-02   +7.258540904985586e-01   +2.420849393864714e-01   +2.508336729552461e-01   +7.016253467419461e-01   +6.590110674116161e-01   +9.524687039208912e-02];
L1E_L1I_iGABA_netcon = [+8.432844107481259e-01   +7.524580389376531e-01   +8.741103950217219e-01   +4.358197213510280e-01   +9.179502874274826e-01   +7.794972248960254e-01   +3.217485428956264e-01   +6.413439422077876e-01   +9.427740686989507e-02   +2.627400776298630e-02   +1.291934326495602e-01   +5.197467072195714e-01   +8.695979801719270e-01   +5.759893105752756e-01   +1.660381893382852e-01   +6.274712029476082e-01; +6.208764325600628e-01   +9.952072227513608e-01   +3.094014816545377e-01   +1.472506384463354e-01   +8.829606923592248e-01   +2.725600891277768e-01   +9.628011350512659e-01   +4.297073111283582e-01   +2.928081065601091e-01   +5.140858538285719e-01   +4.243284684152898e-01   +2.037480545338672e-01   +8.029665827709770e-01   +2.884652660192428e-01   +5.442248147054792e-02   +3.369414967211162e-01; +6.709800602371923e-01   +3.708137254960706e-01   +4.330638699970500e-01   +6.544968215683796e-01   +5.857463315030663e-01   +5.269839788458464e-01   +3.527356815326057e-01   +4.784040827162652e-01   +3.264975311050913e-01   +8.623969144574523e-01   +4.810870490578303e-01   +7.754238853439678e-01   +6.460361205235834e-01   +1.322133627918410e-01   +2.118776888072420e-01   +1.569072323848765e-01; +7.818251742672379e-01   +5.029424950953173e-01   +3.814792060432711e-01   +7.213024716272642e-01   +8.355715375614283e-01   +4.032043296005625e-01   +3.198969392870239e-01   +1.002784455711971e-01   +4.830441640487134e-01   +5.822649519176504e-01   +6.735882316762266e-01   +3.911515899469706e-01   +7.346610817642247e-01   +5.040726728518537e-02   +2.039809910727699e-01   +4.021236272543228e-01; +3.091054387619676e-01   +7.579568228713202e-01   +6.566293087910602e-01   +1.618237598829951e-01   +7.757823940224324e-01   +7.794384016287209e-01   +9.086397206549307e-01   +8.066847533758488e-01   +2.413950218453979e-01   +4.221590857131888e-01   +3.570678570396754e-01   +6.664793183333513e-02   +6.671846257316895e-01   +6.234678346695218e-01   +2.176038205992930e-01   +9.132309060428195e-01; +3.295085050593881e-01   +1.263641552584814e-01   +2.377986109585496e-01   +3.432072377302627e-01   +7.857620036623439e-01   +2.572956226161724e-02   +8.852784929437497e-01   +6.475214431119039e-02   +4.537053498492995e-01   +7.135749106763035e-01   +4.960843968218766e-02   +7.565243949109068e-01   +8.810728765403258e-01   +6.051510178252910e-01   +5.785507090471934e-01   +1.491204872255193e-01; +6.339052277910627e-01   +5.179306746990564e-01   +6.862544584356717e-01   +1.060942319585619e-01   +7.013565925083171e-01   +4.116879885296327e-01   +3.532473389107666e-01   +9.543858974139340e-01   +7.583336072650022e-01   +2.339527039308392e-01   +2.903865505451302e-01   +4.534861636172148e-01   +8.528718767971497e-01   +3.716481189640602e-01   +3.372685804283598e-02   +4.639498032052575e-01; +9.020327672334567e-01   +9.061326096410690e-01   +3.265312285970042e-01   +4.130632732713508e-02   +1.793047939754182e-02   +8.263070585108624e-01   +7.500734827131249e-01   +7.735118740805862e-01   +7.177718354600002e-01   +5.942742188834596e-02   +7.942309039875842e-01   +3.195931722322456e-01   +4.038074700777746e-01   +8.317276264779485e-01   +7.956518777515794e-01   +7.759236226683297e-02; +3.713369663698130e-01   +9.953258805813973e-02   +8.803624035879611e-01   +4.782719044868943e-01   +3.301157952118952e-01   +5.930784279903862e-01   +1.268144800532707e-01   +4.409070600458938e-01   +2.383115884216129e-01   +9.765441650608732e-01   +6.513987357077636e-01   +2.775142521037726e-01   +1.048885607506100e-01   +5.199965629705249e-01   +1.351543550623900e-01   +3.424773780565714e-01; +8.816881845422032e-01   +1.789401152837774e-01   +9.990725539719194e-01   +4.772005132312950e-01   +9.469897994566582e-01   +2.128522281726052e-01   +5.995256817980968e-01   +1.654716269658932e-01   +6.989901279936034e-01   +9.694267383124149e-01   +7.096377276293075e-01   +5.841963428292534e-01   +4.036250064779640e-01   +8.009417881415373e-01   +5.826829539459847e-01   +4.960338068625974e-01; +1.243901894947229e-01   +1.726337715486206e-01   +6.810131754529258e-01   +5.460926289197126e-01   +3.989852772074752e-01   +2.966535533369262e-01   +4.371558266322342e-01   +8.088165848708150e-02   +3.062353587526215e-01   +1.372075253690374e-01   +7.647050400061233e-01   +9.116565218449091e-01   +3.403285566903628e-01   +5.700260266533204e-01   +8.569886615040781e-02   +4.897788300908132e-01; +8.803578949319829e-02   +5.345146406579188e-01   +3.449096702184020e-01   +6.524667679645461e-01   +6.317373106572962e-01   +2.686057086347609e-01   +9.586558059098791e-01   +7.419805519483241e-01   +4.694232098774143e-01   -1.617373046381563e-04   +3.843389808543886e-01   +4.510350942376506e-01   +1.146882774279198e-01   +7.143138369999034e-01   +2.282996463637483e-01   +1.278893271196190e-01; +5.460079826661858e-01   +9.788837150022844e-01   +5.612063814653440e-01   +3.491066259307598e-01   +8.594935399542707e-01   +9.284418500746006e-01   +9.644636788502859e-01   +5.439099201901708e-01   +4.442222438925952e-01   +9.359906990305578e-01   +3.616729827621972e-01   +9.803922441269100e-01   +8.522953952446513e-01   +7.329796741024620e-01   +4.521877890706282e-01   +8.529232089525692e-02; +6.101919592648198e-01   +8.434881846326405e-01   +8.904145703313648e-01   +2.566576851875594e-01   +3.766823943381726e-01   +5.531260573304989e-01   +2.424327907171656e-01   +4.853917434312797e-01   +7.336802986192323e-01   +7.407068712168683e-01   +8.105104619471466e-01   +1.105062534392244e-01   +8.920521609826800e-01   +4.543809676308979e-01   +1.791742944610510e-01   +6.735598566651262e-01; +7.277118457370453e-01   +6.726029586939120e-01   +6.466294109703201e-01   +1.763610224812793e-01   +2.041590478216029e-01   +4.329553015771585e-01   +7.701958220866314e-01   +8.951617708761388e-01   +8.756985187131037e-01   +4.330594409686632e-01   +3.852730389127643e-01   +4.158768116725145e-01   +6.859793658526467e-01   +2.826832914388909e-01   +4.155358107568090e-01   +1.221381321286306e-01; +9.913737240599173e-01   +8.781340100979978e-03   +3.770671517483125e-01   +4.782655741593662e-01   +9.117518803487034e-01   +3.281929062233764e-01   +7.125823198444322e-01   +5.831618450167186e-01   +9.129102266268553e-01   +9.437841021422104e-01   +8.711187155877208e-01   +3.832024061055259e-01   +7.427634885477823e-01   +1.516110220388814e-01   +9.655672035637045e-01   +9.894643271139208e-01];
L2I_L1I_iGABA_netcon = [+5.743196526528214e-01   +5.644708762468552e-01   +1.082432310078053e-01   +4.590818216409832e-01   +7.963027473468957e-01   +9.786892015018046e-01   +2.239531579235602e-01   +7.585122623759091e-01; +5.577246818762411e-01   +9.527816895303935e-01   +1.192087314917250e-01   +5.678801995030193e-01   +5.416217777189772e-01   +4.232232809670405e-01   +6.582542282179062e-02   +5.060413673125981e-01; +6.113351301305231e-01   +9.011959522402573e-03   +4.332642644140002e-01   +8.180732746386893e-01   +2.574195451525705e-01   +3.934361888836602e-01   +8.354990130423875e-01   +8.280662020672095e-01; +4.668755276160771e-01   +1.269039166597902e-01   +9.330704972880179e-01   +3.548116780791291e-01   +7.818297997340714e-01   +4.607591449629325e-01   +4.162066911480234e-02   +9.275273647381607e-01; +4.345205236190751e-01   +8.532839909709276e-01   +1.401803328180082e-01   +2.483224794029091e-01   +7.787383722959648e-01   +1.212033144192160e-01   +9.094372662804268e-01   +7.105616909678113e-01; +6.312843977576238e-02   +2.179516014293041e-01   +8.260947857751270e-01   +7.710376266888556e-01   +1.445402675344021e-01   +4.547360054039778e-01   +4.503757106202078e-01   +7.979967844935676e-01; +6.467019549535349e-01   +7.095613422510276e-01   +9.323124641746514e-01   +2.425555759357195e-03   +8.231830751758372e-01   +2.655707077354854e-01   +2.851897140402860e-01   +9.579874374188225e-01; +4.259150529140038e-01   +7.744967627315097e-01   +5.728440326954091e-01   +2.762077007715257e-01   +6.231191516081971e-01   +9.289088120427387e-02   +7.544007398624654e-01   +9.508733871378422e-01; +7.560515221222575e-01   +4.205681238294087e-01   +4.988277303198044e-01   +2.313321053347363e-02   +4.574102461562040e-01   +6.620843034240793e-01   +9.263044492160674e-01   +2.956152221647133e-01; +3.071674861284383e-01   +7.250337740438261e-01   +9.310457020961478e-01   +6.699578152836315e-01   +4.841073671891492e-01   +9.454955358523955e-01   +1.418668525206916e-01   +3.522805614738387e-01; +5.984592795544627e-01   +4.581549725629852e-01   +8.615616800151188e-01   +9.670570428594113e-01   +2.191362058796808e-01   +7.646056471431782e-01   +9.560345838890492e-01   +5.412808231715388e-01; +3.346713645092718e-01   +8.046943098511378e-01   +2.531630612949469e-01   +9.453489389239711e-01   +8.575456864733747e-01   +4.260010279104725e-02   +3.036619512129725e-01   +2.134978004288173e-01; +6.436686457722987e-01   +4.275390727646223e-01   +4.585851277975209e-01   +4.733476106326369e-02   +8.796694626604322e-01   +2.616382219640960e-01   +2.094525821442366e-01   +8.107608619443141e-02; +1.519587519309799e-03   +1.486264759316480e-01   +7.408659815106305e-01   +2.863502389637694e-01   +8.454857541766500e-01   +6.343884761533566e-01   +4.638963820822188e-01   +5.064989805316883e-01; +1.440600295856174e-01   +8.045138978955028e-01   +7.524370889061139e-01   +4.868633953609254e-01   +4.428961628337179e-01   +9.012443123273636e-02   +5.972512879011848e-01   +1.948612849270558e-01; +2.478799396437445e-01   +3.816432692970181e-01   +2.302323472849137e-01   +8.867477097734318e-01   +5.435140673259465e-01   +7.458561117743584e-02   +5.525863509585927e-01   +1.448747288530031e-01];
L1I_L2I_iGABA_netcon = [+6.982565950507849e-01   +8.672752651929450e-01   +6.139885014955572e-01   +5.517965217567146e-02   +1.430211858237856e-01   +2.351596848855801e-01   +8.389334813335251e-01   +3.705068484327336e-01   +7.063552189295642e-01   +3.843535734980327e-01   +2.395247382840730e-01   +6.663167641459351e-01   +1.674065544719022e-01   +5.699970968942901e-01   +4.394106664531578e-02   +4.946882403084926e-02; +5.976074926009467e-01   +7.981472132866209e-01   +6.105986454075347e-01   +5.755380688859307e-02   +7.445637327414240e-01   +5.562650587267871e-01   +1.977524248062289e-01   +5.593312757259259e-01   +1.870485437459601e-01   +7.197239175896331e-01   +5.133033937510121e-01   +3.299366574847363e-01   +1.158292639794411e-01   +8.097823207749177e-01   +4.420609697036533e-01   +9.212254514157604e-01; +1.627746877906711e-01   +6.272672700129106e-01   +3.132316484167957e-01   +5.966806592380083e-01   +9.511802116764261e-01   +1.134377733025140e-01   +6.170955031349123e-01   +8.303196998555500e-01   +2.308768972451408e-01   +6.414343776214537e-01   +7.321787887294219e-01   +5.515525263924440e-01   +7.365544010433491e-01   +6.736811919505384e-01   +9.169246102232341e-01   +1.740975459310596e-01; +4.828656757657093e-01   +4.720110523549458e-01   +1.421153443725512e-01   +6.572537736549242e-01   +2.659464216008944e-01   +8.185785762119843e-01   +1.549512581044281e-01   +7.074665471619797e-01   +9.984340123846726e-01   +1.007534116336343e-01   +7.714225687285803e-01   +5.321642056939635e-01   +2.103664238099617e-01   +4.439783628637929e-01   +8.843805966565598e-01   +7.434207650664516e-01; +2.855019814356538e-01   +1.931536381820884e-02   +6.051012709195437e-01   +4.795943369343216e-01   +9.538999828592655e-02   +6.509364411206519e-01   +5.837138279146636e-01   +1.155241962788340e-01   +9.049960022673657e-01   +4.920148987272438e-01   +6.767402872746547e-01   +9.015272804951960e-01   +4.838572135976508e-01   +8.937405220521062e-01   +9.273381305280687e-02   +4.760489978577008e-01; +4.035065211531064e-01   +1.179211359405114e-01   +8.899518327767989e-01   +9.785359651559500e-01   +2.309552754134071e-01   +2.373735886202668e-01   +5.451831245565165e-01   +7.402708104090145e-01   +1.145186338817570e-02   +5.625188427290631e-01   +8.131034775743015e-01   +2.842499511005322e-01   +5.077883734397054e-02   +7.837045624871034e-01   +6.754381269035273e-01   +2.462869815151706e-01; +4.907155142100746e-01   +7.191505049012593e-01   +5.623023353337793e-01   +8.633697291801079e-01   +8.961718467206161e-01   +3.016242529438797e-01   +6.818798863060018e-01   +9.242000007873596e-01   +8.346201924961412e-01   +5.625383330618370e-02   +4.182638417084356e-01   +1.392923912801326e-01   +5.712990936004791e-01   +5.817103003867711e-01   +8.966131209066901e-03   +6.629051627828939e-01; +8.618823535815449e-01   +6.825253107105711e-01   +6.328823925118588e-01   +9.538820808594560e-01   +1.992677901257440e-01   +3.307092029013690e-01   +6.986137627575558e-01   +9.234673135277560e-01   +2.523039281406457e-01   +8.924966463554745e-02   +4.973276461192170e-01   +9.566541839570236e-01   +4.913327672822490e-01   +6.160231624384507e-01   +1.211372524743997e-01   +6.083397918861168e-01];
L2E_L1E_iAMPA_netcon = [+3.678133039328899e-01   +5.624176463274312e-01   +2.008053692912381e-01   +5.145057373373280e-01   +2.896849416111780e-01   +7.495777101571878e-02   +2.781690040375436e-01   +2.667690011739419e-01; +4.373071113691957e-01   +1.931582207490859e-01   +1.371454572174947e-01   +6.847989992738530e-01   +6.201634522130682e-01   +5.943289408911502e-01   +9.283056586533103e-01   +9.046023873573137e-01; +7.181633344734818e-01   +6.134615223350376e-01   +8.182814754264262e-02   +2.074502021777770e-01   +8.631504308271435e-01   +7.717799796812866e-02   +7.638697199574270e-01   +1.597190663818005e-01; +1.914311487246659e-01   +7.403724254746934e-01   +9.132450631209153e-02   +9.719646874332225e-01   +8.207621697550107e-01   +3.975028876761222e-01   +2.630524414608715e-01   +5.540500256134657e-01; +4.053056071416715e-02   +8.324007494624995e-01   +5.516228391670668e-01   +3.506396356577695e-01   +2.060376601017419e-01   +6.003605616512289e-02   +2.425824379087738e-01   +4.232839314212136e-01; +3.151499585403899e-01   +2.781386530348879e-01   +7.314240014999150e-01   +1.839262972483300e-01   +7.508545224716348e-01   +1.285333463798635e-01   +1.656052097584895e-01   +5.475373509288310e-01; +7.899628525564396e-01   +6.081885155106785e-01   +5.439824305714800e-01   +2.381603819988977e-01   +1.987963640799601e-01   +2.437917698628353e-01   +2.875464020234927e-01   +7.541656488998603e-01; +4.784715173486775e-02   +5.474735482355171e-01   +5.453454389250976e-02   +2.542977773010509e-01   +5.776801625323311e-01   +9.437670707814828e-01   +5.645774780782159e-01   +1.301777455100725e-02; +2.160415600000400e-01   +2.746582191571052e-01   +6.325788066972998e-01   +2.220737856542781e-01   +8.770624268009440e-01   +2.035746905035079e-01   +4.045644325652511e-01   -7.751861434965828e-04; +2.739076600781999e-01   +3.402342481886956e-01   +9.943315027251381e-01   +3.577517515078535e-02   +7.135728962009924e-01   +3.269126492223396e-01   +9.861132112178157e-01   +2.112992941924537e-02; +7.890408322625815e-01   +5.668875106080075e-01   +9.145798720993168e-01   +3.565813977644965e-01   +7.008668908448461e-01   +8.666712230950901e-01   +5.445269314562324e-01   +3.589097926062292e-01; +9.908273733632941e-01   +7.437115126789061e-01   +7.680374281822806e-01   +8.990861933885447e-01   +4.678332330055883e-01   +9.224987644831185e-01   +9.285479803437789e-01   +4.263941597064670e-01; +9.494547018521302e-02   +7.715880535053812e-01   +1.921238390951871e-01   +1.399421517071604e-01   +5.045563180925123e-01   +2.320837853647570e-02   +9.923294917198453e-01   +5.450667855916520e-01; +1.958947816131449e-01   +3.984391092539999e-01   +3.238953617585055e-02   +9.554807341291592e-01   +7.964136182296496e-01   +3.644823613541207e-01   +8.355991780107936e-01   +4.922062445136774e-01; +1.164520155974303e-01   +1.489649050162958e-01   +3.736828726247343e-01   +9.022700312744922e-01   +9.399207750788255e-01   +5.282033975408388e-01   +1.801774239634369e-01   +9.203381578986566e-01; +6.473104074119292e-01   +2.079391524249745e-01   +5.753041961926069e-01   +4.100709971996996e-01   +7.821516169925626e-01   +4.064897691152606e-01   +3.132416324909292e-01   +4.159978400454124e-01];
L1E_L2E_iAMPA_netcon = [+4.969268383480388e-01   +4.500672052458674e-01   +6.165024559008023e-01   +4.906499114934129e-01   +2.299374094596488e-01   +7.215323486168477e-01   +6.943410023795522e-01   +6.324141047040943e-01   +5.225300770143771e-01   +2.403674513315565e-01   +8.770214467207483e-01   +1.742989386172265e-01   +1.366769453198717e-01   +2.434191621548783e-01   +1.836902208350942e-01   +2.308160152909743e-02; +8.383928875341804e-01   +3.696532759600705e-01   +1.031718436792917e-01   +6.615040823794140e-01   +8.362244497769655e-01   +3.809892498906389e-01   +9.800924972885150e-01   +6.267713862240561e-01   +6.728360922576542e-01   +7.293655598381366e-01   +6.586065950650800e-01   +3.029600257085523e-01   +2.830378545833040e-01   +7.485232385678022e-01   +1.466208152523185e-01   +2.514405574344264e-01; +1.853876552853387e-01   +3.002349554087248e-01   +7.520367391167631e-01   +1.782901263773449e-01   +7.345515711654128e-01   +3.843903702404148e-01   +7.505479610350992e-01   +4.071380412501674e-01   +7.765604996843024e-01   +1.359806888828443e-01   +5.373673140913470e-01   +1.092554652513703e-01   +7.188433812630029e-03   +9.367404766949696e-01   +1.325890011008050e-01   +9.891710444559438e-01; +3.366015568860030e-01   +2.331386888304285e-01   +5.371379551171257e-01   +4.784629674582679e-01   +4.891429384466604e-01   +7.156320084107061e-01   +5.532924483112208e-01   +4.251041018348048e-01   +4.634329364503256e-01   +4.096643696991993e-02   +2.518970875952660e-01   +4.515054447768453e-01   +3.059242965243317e-01   +3.006892354099203e-02   +1.723722413214544e-01   +6.293939859934469e-01; +6.928456482734872e-01   +1.368423910061526e-01   +4.437723240259189e-01   +4.990999080334180e-01   +8.487777834421781e-01   +8.384495440471308e-01   +2.953010912371236e-02   +5.103718187455665e-01   +9.074993352930389e-01   +6.498911553521477e-01   +1.054613182827957e-01   +5.842621064548782e-01   +9.045525331218318e-01   +4.353244323910785e-01   +9.224234780430264e-01   +3.576774591621800e-01; +6.922866100427433e-01   +9.966567377902177e-02   +7.437659536989238e-01   +6.006065891054020e-01   +7.143694948116557e-01   +6.679290577719104e-01   +1.955917165754381e-01   +2.593475500693476e-01   +2.525025878023121e-02   +2.001285323047544e-01   +9.715463364014628e-01   +2.245520104006217e-01   +2.936042261974377e-01   +8.316048778633498e-01   +2.592166897529752e-01   +9.382378642281078e-02; +3.679009460526680e-01   +2.267238065825342e-01   +3.875475675574312e-01   +2.407084742814504e-01   +5.225102059341834e-01   +6.504959588439589e-01   +9.416769380279565e-01   +4.229190082303529e-01   +4.807113221445911e-01   +9.730987920060320e-01   +5.974068380409748e-01   +1.107065680443694e-01   +8.332193346512486e-01   +9.992437338662208e-01   +2.059145474396178e-01   +4.088693047830620e-01; +3.397509054308990e-02   +3.468944310363449e-01   +5.264405084721497e-01   +5.172388108353215e-01   +9.378333843242254e-01   +5.636817836760112e-01   +3.972675939047033e-01   +5.234550836616336e-01   +2.708073245676977e-01   +8.206183591545189e-01   +8.194258064225556e-01   +5.610832848703182e-01   +7.453131195482561e-01   +9.204820389889983e-01   +6.136682232036987e-01   +9.313763083872914e-01];
L2I_L2E_iAMPA_netcon = [+6.771305829241064e-01   +6.144276767258301e-01   +4.174283055456421e-02   +7.924586012974155e-01   +5.235838852384466e-01   +8.257870609641303e-01   +6.442494821467148e-01   +3.863871383167111e-01; +2.316075955547511e-02   +9.448897438511857e-01   +5.467135771715503e-02   +9.304013778187848e-01   +5.362911279540154e-02   +1.083057232870915e-01   +3.960067357034878e-02   +1.670100796569568e-01; +7.343414095251073e-01   +9.642481585468735e-01   +4.014741063499778e-01   +9.365229678438641e-01   +2.871693925697055e-01   +2.307752862912062e-02   +5.680992501896265e-01   +4.439569896415090e-01; +2.139247920025578e-01   +3.692151844516123e-01   +9.840622268309243e-01   +1.462211118819310e-01   +7.097408159799458e-01   +1.221310686896727e-02   +3.050581307553210e-01   +8.734457521352448e-01; +8.611007874900668e-01   +7.951371844505393e-01   +7.120389552230340e-01   +3.194292614235141e-01   +8.781658340897712e-01   +3.363168284510368e-01   +2.604489561941825e-01   +4.112199498387901e-01; +1.567091390866309e-01   +7.287738706016040e-01   +9.886892119604554e-01   +4.289084977061892e-01   +3.657234316269339e-01   +6.635227863318709e-01   +7.216305548122137e-01   +1.624919774279876e-01; +6.684933631433045e-01   +9.536663173137262e-01   +6.456054473374526e-01   +7.022525434504354e-01   +5.606724536015960e-01   +5.953876496718553e-01   +3.056875498551541e-01   +6.622888909906953e-01; +9.348593227249354e-01   +1.114056044887869e-02   +5.018233820419244e-01   +6.149166818129614e-01   +8.842725447465822e-01   +7.983803964841392e-02   +8.961578683338834e-01   +9.253592964654554e-01];
L2E_L2I_iGABA_netcon = [+5.964746462164188e-02   +5.203801089521088e-01   +3.525091830313939e-01   +2.616300667414460e-01   +4.205365877814884e-02   +8.904389733956916e-01   +3.439649861164784e-01   +4.511111776333301e-01; +3.540661939480855e-01   +6.920814501973141e-02   +5.573466632311329e-01   +9.844151586410687e-01   +3.606951345254736e-01   +5.401557488803346e-01   +9.351949605459348e-01   +6.710707465273802e-01; +9.329026701576943e-01   +1.845582230326216e-01   +6.918758722272960e-01   +3.496207014941430e-01   +3.620631070656579e-02   +7.173250756638809e-01   +9.188599368084863e-01   +7.688749283828653e-01; +2.410426154917088e-01   +3.165290188242835e-01   -6.038005124999830e-03   +4.019029574681907e-01   +4.861618120067274e-01   +7.104385207761719e-01   +7.250993333009577e-01   +9.269485552882962e-01; +1.027237643940719e-01   +2.443625047851244e-01   +4.825925990741944e-02   +7.523719509900898e-01   +7.229400559666374e-01   +1.685662802296233e-01   +4.430339611120238e-01   +6.584085963423980e-01; +7.161592665149608e-01   +3.217731881113097e-01   +3.085170651756029e-01   +1.016638648521092e-01   +1.452931497635582e-02   +3.514203164797837e-01   +1.518832267885855e-01   +5.013931272529908e-01; +5.843217226046091e-03   +8.795067349670527e-01   +8.689313968036090e-01   +5.904518651172249e-01   +5.173060353661337e-01   +3.794867263691482e-01   +8.318656338040334e-01   +3.424480338227452e-01; +1.853134159535090e-01   +3.011985953125474e-01   +6.276316006749377e-01   +1.230854576018672e-01   +2.393778960599815e-01   +7.583232886368101e-01   +2.571021464463868e-01   +9.458508415437281e-01];
L3E_L2E_iAMPA_netcon = [+7.918302594797438e-02   +1.626831608041690e-02   +3.678074995910005e-01   +4.965341919666536e-01   +1.818956830737705e-02   +9.553728611469132e-01   +3.599004260347337e-01   +1.386384576858363e-02   +2.037541831676559e-01   +6.168841027773724e-02   +2.429719004066868e-01   +9.986313325228580e-01; +9.519923086728630e-01   +9.769533376745965e-01   +1.151287196470461e-01   +6.533841534165083e-02   +8.065300530306472e-01   +3.871795476169675e-01   +2.241586229787955e-01   +1.221263212769296e-01   +3.557141800167800e-01   +7.414980416402064e-01   +5.332392159603518e-01   +3.448601990858907e-01; +6.626107883522967e-01   +7.249129908208755e-01   +5.141614636043665e-01   +8.619969544951429e-01   +7.923346421094034e-01   +6.643335049033570e-01   +7.247156288997256e-01   +6.693853212819542e-01   +8.877878665814700e-01   +9.905363317576620e-01   +3.332307983935490e-01   +8.224545130401112e-01; +1.686048329440967e-01   +8.717912791348528e-01   +6.793136731443306e-03   +9.967392327639246e-01   +4.231946266917048e-01   +5.843775067582649e-01   +7.724039259619818e-01   +5.081206521925702e-01   +8.089872844849895e-01   +7.677963728903702e-01   +6.741644631514451e-01   +1.099027970093196e-01; +1.964476033284235e-01   +8.142507857602890e-01   +8.693208693385864e-01   +1.227375798652097e-01   +6.305228390446823e-01   +5.917730614060362e-02   +3.425921211001558e-01   +7.061914829524407e-02   +3.193633975731194e-01   +8.810817851452545e-01   +8.754167081941346e-01   +7.732150866169832e-01; +9.948235152461848e-01   +3.089624500202118e-02   +9.042714076614441e-01   +9.989089251363573e-02   +5.678695258915498e-01   +7.632793446900503e-02   +5.767819182796138e-01   +5.359703644941224e-01   +5.994207075895136e-01   +3.622390811608491e-02   +9.824853375912637e-01   +1.502757596369790e-01; +9.254187378977435e-01   +9.618663992173018e-02   +1.130239691469135e-01   +1.491614935169853e-01   +8.962120209728167e-01   +2.273592494243772e-01   +6.427497400861391e-01   +6.781256129741848e-01   +6.985936585130579e-01   +7.937091354065426e-01   +1.451091555987510e-01   +7.319225383494001e-01; +9.816979062862214e-01   +8.592920019462957e-02   +4.462121368290248e-02   +1.286376320493145e-01   +7.487570425008946e-01   +4.199927389936880e-01   +3.654863107090025e-01   +5.880923174571906e-01   +1.782174463095045e-01   +7.067272814967144e-01   +8.770229178956809e-01   +1.094958899790049e-01];
L3I_L2I_iGABA_netcon = [+7.674685931178703e-01   +5.357658530695916e-01   +5.972605025968943e-01   +3.050181621702878e-01   +9.668260237160670e-01   +1.152125678661291e-01   +2.982431023484286e-01   +7.954053790070844e-01   +9.142131891891521e-01   +9.944108114302331e-01   +3.096400307428227e-01   +9.963201194907398e-01; +6.374713848270909e-01   +4.526711760977294e-01   +5.622616641195800e-01   +7.623441807392374e-01   +5.443261562905674e-01   +6.986063956919088e-02   +1.687256632997851e-01   +5.250597136441024e-02   +3.859473607996056e-01   +2.870657039869506e-01   +4.427886428561735e-01   +9.144054833313169e-01; +7.963300366063926e-01   +1.145876360703037e-01   +6.830331060551684e-02   +6.471714342480011e-01   +9.816014232463288e-01   +5.122360978325942e-02   +7.239802318112259e-01   +1.817559477172171e-01   +7.500449860922087e-01   +5.156766566298682e-01   +2.085157432324771e-01   +6.919633923772922e-01; +9.600350203512686e-01   +7.200036572059191e-01   +7.682767523545585e-01   +3.316011933832199e-01   +1.242742387486345e-01   +1.298595814031377e-01   +2.986541019060009e-01   +2.464017713977592e-01   +8.792447155793546e-01   +3.592980835698640e-01   +9.412654398632389e-01   +2.216834881919270e-01; +7.168506186532752e-01   +1.863574743874258e-01   +8.681580359005100e-01   +9.710446441411044e-01   +1.682819468963499e-01   +4.918931100332936e-01   +6.776175887341380e-01   +2.615163748227882e-01   +3.926561974852270e-01   +5.171417993592144e-01   +2.896252117938794e-01   +3.152208836924573e-01; +6.434264506918936e-01   +3.249494667908939e-01   +7.081621659827495e-01   +5.318496578237984e-01   +3.344835314417983e-01   +4.675433652472327e-01   +7.456085116365655e-01   +6.471623590984937e-01   +1.679172735096780e-01   +5.011633657784502e-01   +1.226090343323408e-01   +2.367270979512243e-01; +5.124503321918967e-01   +9.667612615031911e-01   +1.080523085537812e-01   +7.517455628626173e-01   +5.312057491257723e-01   +1.584810886773297e-01   +7.463965896420617e-01   +9.813850064599547e-02   +4.366455051100793e-01   +1.880803784584625e-01   +6.934067988710492e-02   +7.076079027943023e-01; +9.519435663038242e-01   +7.009982749627336e-01   +6.661081793435668e-01   +2.690584389692345e-01   +6.924321303160675e-01   +1.379392655203195e-01   +7.845827217923264e-01   +4.689005902992266e-01   +8.573938999577888e-01   +4.776516834691688e-01   +7.295332512496094e-01   +3.759270259725717e-01];
L2E_L3E_iAMPA_netcon = [+6.567620025233292e-01   +3.867213059141499e-01   +2.349929821994427e-01   +4.645671652272760e-01   +9.045002611436693e-01   +9.501812797288433e-01   +7.620232201673133e-01   +3.544910574433230e-01; +3.837674063943187e-01   +2.304505232062449e-02   +9.054594975319986e-01   +2.837430763279313e-01   +6.790896044549859e-01   +2.562847423602746e-02   +9.035960500909830e-01   +6.636496250857212e-01; +3.080105344967217e-01   +3.295586332908240e-01   +4.872029462799706e-01   +2.762130655203862e-01   +8.428406786484057e-01   +5.017412304889534e-01   +7.964432513328302e-01   +5.925022173211122e-01; +1.574748045968882e-01   +4.847543206391085e-01   +5.955984633344146e-01   +1.426105224498432e-01   +9.522902795982335e-02   +3.396751546642451e-01   +9.563322063531705e-01   +5.359723738527609e-02; +7.775792842309789e-01   +2.626163302629285e-01   +9.552481611928153e-01   +1.399469026742834e-01   +7.350659653082149e-01   +6.725782726785108e-01   +5.349979885121980e-01   +2.163611325599167e-01; +7.089090273087946e-01   +5.257917067392813e-01   +8.486392937600694e-02   +2.644580090115260e-01   +5.438608833085822e-01   +1.675013879580047e-01   +1.636620280125582e-01   +6.015015418965958e-01; +1.728425124154511e-01   +4.161294692164492e-01   +2.213988713300610e-01   +6.111037318563378e-01   +2.565129274503211e-01   +2.259882894554083e-01   +1.341786366127071e-01   +2.695374408284016e-01; +4.483295095085239e-01   -4.509184438816908e-03   +1.525491725232276e-01   +1.064131444649361e-01   +7.148003823848922e-01   +1.179830829050555e-01   +3.363016761561367e-02   +1.095798893852005e-01; +8.379269698360832e-01   +8.940180255428696e-01   +3.901643980783372e-01   +4.846400526446370e-01   +3.602125965457380e-01   +9.939333233198971e-01   +6.811119219901216e-01   +2.109049871881911e-01; +6.981116143536206e-01   +2.396759371064707e-01   +1.848814359038608e-01   +8.940475353257740e-01   +8.531906021698713e-01   +1.399251702133178e-01   +5.867330323515709e-01   +8.734631385860090e-01; +7.658044428381234e-01   +7.921918106328264e-01   +7.631816048471207e-01   +1.886720418852895e-01   +8.192376763346891e-01   +7.692396902392167e-01   +2.988677442651954e-01   +4.590479919806476e-01; +9.806330661932050e-01   +5.781278280351262e-01   +2.279311309953371e-01   +5.216212077591126e-02   +6.106234239738353e-01   +6.342392515906929e-01   +7.374470342261900e-02   +7.267860873861800e-01];
L2I_L3I_iGABA_netcon = [+5.894328556160763e-01   +1.470170318181183e-01   +3.440870476021311e-01   +3.692001900050848e-01   +5.995157097969365e-01   +5.071596624968349e-01   +7.729538538195460e-01   +2.647385034487465e-01; +8.462363478762958e-01   +9.900505431760238e-01   +4.549435152273467e-02   +5.376145692698335e-01   +4.784008499595166e-01   +2.372135515941482e-01   +1.787557977389985e-01   +5.852490748175851e-01; +6.044337250310232e-01   +4.810127237979140e-01   +9.415814947410343e-01   +9.745800309292458e-01   +3.769418830478354e-01   +2.723013095669998e-01   +4.537716302459694e-01   +6.795777936567594e-01; +7.448441548466522e-01   +3.615376561743078e-02   +8.663146187458522e-01   +9.966767089434396e-01   +9.787542890429969e-01   +4.052181748927892e-01   +3.059023371573508e-01   +4.157158669598783e-01; +8.500031539289292e-01   +2.699097450209684e-01   +1.338835895886556e-01   +4.143929350604099e-01   +1.386990704585726e-01   +2.606572907148066e-01   +3.878791214360569e-01   +5.111324540394306e-01; +1.461502464755510e-01   +6.755147187535255e-01   +5.900372244903406e-01   +4.505862763018961e-01   +2.714903282243614e-01   +8.545739269527440e-01   +8.035964729638733e-01   +8.140002542957665e-01; +7.420301073838160e-01   +1.465007149558835e-01   +6.273202507898269e-02   +2.549020522800541e-01   +2.260607772771454e-01   +4.787086287257660e-01   +7.780183308925553e-01   +5.441519254248924e-01; +1.707235748701757e-02   +7.736511755408908e-01   +9.465871436920131e-01   +6.010765323042703e-01   +7.923811370965650e-01   +3.415347058533882e-01   +6.462667883527603e-01   +5.894344369050850e-01; +2.281317171697992e-01   +2.669146591655730e-01   +4.973316688494240e-01   +7.792005270490929e-02   +8.182808289463231e-01   +6.392849982483266e-01   +2.423687131522266e-01   +5.351485722712982e-01; +5.381051013719815e-01   +8.805562074360772e-01   +2.657267633017935e-02   +9.121279020677400e-01   +7.924686023840006e-01   +4.157586387882053e-01   +6.082470272044892e-01   +5.412361372192751e-01; +7.199569769086677e-01   +3.691358491686598e-01   +5.733605319494094e-02   +4.732672123341015e-01   +1.130543540783066e-01   +5.437995480721127e-01   +4.187516925728583e-01   +1.512991194200375e-01; +4.342191040506325e-01   +9.703076201052015e-03   +3.010867245108968e-01   +5.075534420672566e-01   +6.324807082788736e-01   +3.403336608768182e-01   +2.942975703245018e-01   +7.038504212713691e-01];
L3I_L3E_iAMPA_netcon = [+6.333071632889464e-02   +7.728911822652186e-01   +5.547012178509600e-01   +5.732848511391138e-01   +9.203154825074349e-01   +8.351680065429418e-01   +8.499663615681934e-01   +8.628189233772093e-01   +5.337023544832321e-01   +9.879568235871837e-01   +4.822407437606867e-01   +3.498717076334432e-01; +9.219899317199806e-01   +8.388199577504476e-01   +8.439415951277552e-01   +9.357237458587172e-01   +5.927452851135631e-01   +3.925220891449983e-01   +6.284904024417823e-01   +8.565426713779462e-01   +5.676596841896204e-01   +7.012599631896415e-01   +7.399088451879070e-01   +3.999595961249748e-01; +1.803042251623812e-01   +5.932033791510481e-01   +9.697665560631515e-01   +7.789252092697799e-01   +5.760393640613459e-01   +7.049899499939967e-02   +4.441397544304764e-01   +9.489123562712426e-01   +9.801878700991329e-01   +8.440913898752256e-01   +5.951026801916247e-01   +9.878605409024994e-01; +5.430738650327257e-01   +7.669160537610278e-01   +4.656878285827418e-01   +5.962486807055475e-01   +6.584265123697330e-01   +3.736795374381069e-01   +2.346891433945565e-01   +6.943894234687910e-01   +9.680331126235915e-01   +7.382027577190501e-01   +2.635603777881008e-01   +2.978344575507113e-01; +3.979736891236922e-01   +6.588264929182988e-01   +7.761802902663963e-01   +5.821385929210440e-02   +4.356818537188831e-01   +8.492791988541454e-01   +5.084389923792311e-02   +3.631029070516700e-01   +5.600128378575466e-01   +9.958479577929275e-01   +6.073110409018743e-01   +2.246612876838822e-01; +9.261006312012755e-03   +5.888901378128846e-01   +2.211639591853732e-02   +5.439791276914078e-01   +9.352259771766748e-01   +2.498013217893189e-02   +7.123921758435550e-01   +3.733370147678087e-01   +5.322252990014823e-01   +5.073873344737286e-01   +2.319775392257981e-01   +3.303618904343914e-01; +1.028710029377456e-01   +2.602564288270868e-02   +6.772645424238821e-01   +8.643588119423495e-01   +1.030385913588933e-01   +4.210943604981436e-01   +8.476923671082910e-01   +8.418523374980300e-01   +4.791499355694420e-01   +1.892365592308085e-01   +1.949045047430732e-01   +1.648864360439928e-01; +8.559610213615142e-01   +6.927605840806114e-01   +8.349775152417183e-01   +3.383573516039403e-01   +4.088779259527629e-01   +2.541782194445210e-01   +4.053230995772467e-01   +3.843171839554830e-01   +9.013570103407378e-01   +9.592490318156103e-01   +1.801727408556849e-03   +3.839573482178641e-01; +3.378789069413130e-01   +3.277078459637688e-01   +6.843572365278180e-01   +1.784903072019327e-01   +8.923496338851100e-01   +7.407919430041544e-02   +2.868426548268071e-01   +7.704780426734336e-01   +4.821252525355638e-01   +4.517171372921088e-01   +6.463695660155524e-01   +5.259999424931738e-01; +1.495258893877812e-01   +7.627544301110044e-02   +8.959268560760829e-01   +8.807238671685760e-01   +7.389300131473411e-01   +9.201274330099314e-01   +2.623648360483658e-01   +7.736924826079877e-01   +4.864268341150250e-01   +6.059738172603044e-01   +4.001696562245114e-01   +5.957492100206402e-01; +8.079426120482551e-01   +7.445046294632438e-01   +9.545784114656565e-02   +8.417678808002793e-01   +9.586727777224877e-01   +2.687235821786229e-01   +5.056349095270833e-01   +4.333456079930226e-01   +3.138140018245097e-01   +6.452112210669682e-01   +2.720283344634590e-01   +1.694487627927065e-01; +6.549371226907228e-01   +9.655285680210283e-01   +7.007784079752653e-02   +8.339007533030200e-01   +9.697052713370242e-01   +1.012932893265787e-01   +1.170951009234032e-01   +4.872392347905279e-01   +8.592824881790077e-01   +7.659180982228269e-01   +3.288963240897789e-03   +7.305000039872361e-02];
L3E_L3I_iGABA_netcon = [+4.368809091824646e-01   +7.134927490491327e-02   +5.732246655455334e-03   +4.950792600715124e-01   +5.435590546812102e-01   +2.522610692723801e-01   +7.183907744497754e-01   +7.614699864709015e-01   +3.784871738325063e-01   +4.484841616958698e-01   +2.000815765489607e-01   +6.498863615708301e-01; +5.756127391082926e-02   +8.072302781770981e-01   +1.325722644386270e-01   +1.928480197418508e-01   +2.116543910872740e-01   +3.339239466171327e-01   +2.222483151773568e-01   +8.887409326856051e-01   +6.105027718468686e-01   +3.939740641548151e-01   +8.283722489495289e-01   +8.993488653801185e-01; +6.264184763403281e-01   +9.088511044418470e-01   +3.087301579987723e-01   +6.422498764690195e-01   +2.698027007270442e-01   +5.910182640527457e-01   +4.978585459220485e-01   +7.315059155958958e-01   +1.677918180718364e-01   +6.683294989283818e-01   +4.471464951955681e-01   +8.384747911471278e-01; +7.989436078979700e-01   +4.258653143817485e-01   +2.389806206397163e-01   +2.555051589588561e-01   +1.324767063380989e-01   +4.817715405824543e-01   +4.760936375333198e-01   +6.976827319661016e-01   +1.055362360612438e-01   +3.361167607487218e-02   +4.172111160626248e-02   +1.705253729984475e-01; +4.006944800769884e-01   +1.839997742983607e-01   +6.486359189645059e-01   +9.487849350026337e-01   +1.569213507072414e-02   +8.981704791796341e-01   +4.310551006740347e-01   +6.463546782035264e-01   +6.256911040230568e-01   +7.870265704355366e-01   +7.688471881699724e-01   +1.608352271803974e-01; +8.835751961826785e-01   +1.831349644049582e-01   +8.078526065893525e-01   +2.870567748760064e-01   +1.474005657107128e-02   +2.947947998643627e-01   +5.563178619074503e-01   +6.200384727687158e-01   +9.517855855292426e-01   +3.786665072566286e-01   +9.773146855293252e-02   +1.352620513978613e-01; +7.230088897978405e-01   +6.724657121479173e-01   +7.414788421085430e-01   +1.496550303096838e-01   +9.792455338201974e-01   +7.888139373026644e-02   +2.069327457634212e-01   +7.807595373203682e-02   +6.653865627729029e-01   +6.512071612494441e-01   +6.525688945898150e-01   +1.592134333533280e-01; +1.973305934237088e-01   +5.243891723469971e-01   +1.220356539054945e-01   +8.702826632862284e-01   +6.472033495296622e-01   +3.920287349761931e-01   +2.765968516320014e-01   +5.488221007842541e-01   +4.722989389902044e-01   +4.975499529821388e-01   +2.708486236380032e-01   +3.943511434464956e-01; +3.746683185268547e-01   +7.768244450735371e-01   +1.720260866930958e-01   +8.867812562338644e-01   +8.162055085067755e-01   +1.988781914289520e-01   +8.126478542175377e-01   +8.842099617360750e-01   +3.402331835485288e-01   +2.125905850986673e-01   +4.369054184344890e-01   +6.667121813773292e-01; +2.129752306317212e-01   +2.995041451698792e-01   +2.737470287249564e-01   +6.686378454286878e-01   +2.764137826309517e-01   +7.226689484886796e-01   +9.526926940858411e-02   +9.876488996829400e-01   +5.908746524198015e-01   +2.160653176785629e-01   +8.485655238849672e-01   +2.232074455935614e-01; +2.592006634029403e-01   +4.737998755922998e-01   +8.144725220396590e-01   +9.976545858545316e-01   +1.503066272139564e-02   +4.217964108845761e-01   +3.345629014188677e-02   +7.123982141472386e-02   +5.465833857839261e-01   +4.517092165621204e-01   +9.023471680404471e-01   +6.434091538636515e-01; +9.923476191203064e-01   +7.072053705115625e-01   +5.916501690393938e-01   +2.676058202606146e-01   +1.019392132600395e-01   +2.680059374048517e-01   +6.439316235464058e-02   +3.272105144620462e-02   +3.884432609042781e-02   +6.297559951587813e-01   +2.857695925809865e-01   +6.121340599323057e-01];
L2E_Input1_iAMPA_netcon = [+9.924596179943500e-01   +9.897161532351639e-01   +9.995763457837807e-01   +9.875893814820663e-01   +9.851233119192118e-01   +1.000000000000000e+00   +9.840119138228433e-01   +9.977009875513343e-01];
L2I_Input2_iAMPA_netcon = [+9.915729133392546e-01   +9.989036305215715e-01   +9.844900434645881e-01   +9.952953949742414e-01   +9.884174705828271e-01   +9.893087431927444e-01   +9.960460562994577e-01   +9.969860436852932e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
