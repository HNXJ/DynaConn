function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.616344172480395e-01   -7.927510907731880e-02   -5.668074142089226e-02   -2.179306988687946e-02   +2.142578015955803e-01   -7.172262865405407e-02   -4.473062494256207e-02   -2.690123638490550e-01   +2.561734837911837e-01   -1.965242826534526e-01   -2.464502973982243e-01   -1.006206733448531e-01   -5.492584170665836e-02   +4.128697279019307e-02   -4.625498916888168e-01   +2.749023512380531e-01; -1.120157781742735e-01   +1.241721203004411e-02   -2.008064047435929e-01   +4.219987142940665e-02   +4.561365146530834e-02   -3.709616923683950e-02   -2.944508472954886e-01   +1.053593115445371e-01   +2.269782506180777e-01   -4.722714682278694e-01   -3.039550133359541e-01   +1.829543544049956e-01   +4.692338867872749e-02   -4.950612681458477e-02   -8.095862576788651e-02   +1.013710639308116e-01; -1.239307867477521e-02   +4.151867831090220e-01   +2.160721067357078e-01   -1.180179679329569e-01   -9.177700765812796e-02   -6.161979788900896e-02   +8.966778618217305e-04   +5.341523113833210e-02   -2.352457150642153e-01   +8.586179555556213e-02   +1.248125002754985e-01   -1.603498462687390e-02   -2.739971556715918e-01   +4.204636915774736e-02   +1.216585258745558e-01   -3.332586787317094e-01; -1.885152718024614e-01   +1.748817569610791e-01   -5.033061401672534e-02   +1.572166463800445e-01   +2.727574172846160e-01   +2.883479098082651e-01   -5.744548533583399e-02   +1.907545428827577e-01   +2.339682663591980e-02   +8.758789558237287e-02   -2.979640585709333e-01   +1.401390081722012e-01   -7.486044012743687e-02   +1.295224692665506e-01   -1.359579615926204e-02   +5.296859341835213e-02; +6.066284845538829e-02   +2.310291497754902e-01   +1.564272751216129e-01   +1.049196286598480e-01   +6.234158268967341e-02   +4.380840888986487e-01   -3.248324566645677e-02   +1.097963114222676e-01   -1.939083214236681e-01   +3.792679903516120e-01   -1.648228735679893e-01   +2.397782810354487e-01   +9.175891458403693e-02   +1.703349512371732e-01   +8.492615565883722e-02   +3.505326986065127e-02; +4.482781864626558e-01   -2.167344688557749e-01   -4.338268845234276e-01   -7.384214781357518e-02   +5.721108651086280e-01   -8.690905618742906e-02   -6.652450380958180e-02   +4.616419878687927e-01   -5.818315568844692e-02   +2.088511000533420e-01   -5.815703450508560e-01   -2.198153273611334e-01   -2.312102900349917e-02   +2.029153321706172e-01   -4.079436083215345e-01   -4.213986948321741e-02; -3.515009129056122e-02   -9.993718247912950e-02   -2.390305044258490e-01   -2.459551372632467e-01   -1.714133492679040e-01   -1.191287291596689e-01   -3.294788764598497e-01   +1.293856612995637e-01   +2.796809372977129e-01   +1.080273261135305e-01   -1.684315058767570e-02   +3.962592655526218e-01   +2.064517019112999e-02   -1.220628507748122e-01   +2.676573009674283e-01   -7.391664648534085e-02; +2.705815432000646e-01   -9.405084003203344e-02   -2.188487102746954e-01   +1.570919892121440e-01   +1.700787124149764e-01   -1.362710917254051e-01   -3.938839535256831e-01   +6.928998947205744e-02   +5.072395628643771e-02   -1.428708149217809e-01   +1.586543000458726e-01   +2.938040611593705e-01   -3.596878318677859e-01   +4.236752869868974e-01   -2.965153526332530e-02   -8.981246088636242e-03; +2.158975299686584e-01   +9.197523187200995e-02   -2.551709457230476e-01   +1.095493858374662e-01   -2.308443975332997e-01   -2.453243877633877e-01   -3.490688410202265e-01   +6.491735227973386e-02   +2.416872867853470e-01   -4.550388473555326e-01   -1.206335691783803e-01   -3.129713474195917e-02   -3.166999406569160e-02   +6.449200682032861e-04   +1.236567143834775e-01   +8.718463304539718e-02; -2.240200089783086e-01   -1.483227310105214e-01   -2.930077482200490e-02   +2.954280097609353e-01   +5.135416993646269e-02   +5.828604089273709e-02   +6.174074562162093e-02   -5.502143509246165e-01   -6.289505206012794e-02   -8.981883976825251e-02   -7.281505205740282e-02   +4.275227263883093e-02   -7.973392673989699e-02   +5.296104650120714e-02   -2.473025167996415e-01   +4.073084759196204e-02; +9.706474003551482e-02   +1.763174015519783e-01   -4.151924668756151e-01   +5.396717778349910e-02   +3.885172610574306e-04   +1.594975471359144e-01   -3.366994560527708e-01   +3.223761096649977e-02   -3.837381301594852e-01   -2.060369311448246e-01   -8.623178317558733e-02   -1.890166334902218e-01   +9.694107842757721e-02   +2.011457518867324e-01   -1.460738885881237e-01   -5.077658304434593e-02; -3.191791976849982e-01   +1.703188107971597e-01   -3.399483175473184e-02   -7.124790496735081e-02   -2.539975887210652e-01   +1.293115825265312e-01   -9.836059166666006e-02   +2.118643806849174e-02   +1.857300025339623e-02   +4.815247033262638e-01   -1.013790128889827e-01   -2.328135073588282e-01   -1.466170423797055e-01   +6.795753084091687e-02   +1.544796304988805e-02   -1.792220252844230e-01; -1.478105731127631e-02   -2.318129724187788e-01   -2.406568449212320e-01   +1.504718461520644e-01   -1.410763188387523e-01   -1.502673112526361e-01   -2.986198388849314e-01   +9.241415573787455e-02   -1.307248195735803e-01   -2.339966689404730e-01   -5.028226408410685e-02   -2.707594483635816e-01   -1.021149398355897e-01   -4.061431605267569e-02   +5.870404068752237e-02   +3.129341844949300e-01; +4.151253304427827e-01   +2.435177723503356e-01   -3.720546384623022e-01   -6.255403841663074e-02   +3.869438329145964e-01   -4.725835942991465e-01   -1.241107079684081e-01   +2.241226557028425e-01   -2.037438834310921e-01   -1.295779600261277e-01   -1.176313650546085e-01   -2.373992475252242e-01   +1.659107698369187e-01   -1.451072142709460e-01   -1.852023435888840e-01   -3.264389286764083e-01; +1.721552150411921e-01   +2.333084272906456e-01   -1.690077161082195e-01   +4.941146871710275e-02   -2.332811737857828e-01   +1.132779202282463e-01   -4.149502083086288e-01   -1.513282476401545e-01   -4.487659805031007e-02   +3.744143372565506e-01   +1.647158919803606e-01   -2.670300989476325e-01   +1.093716936852931e-01   -5.516423328099820e-02   -7.893347947640261e-02   +1.526855581420391e-02; +2.037949201616101e-01   +2.214431116983115e-01   -2.041367532525976e-01   -4.694090529856558e-01   -2.211120383147525e-02   -1.452604156652645e-01   +1.034719506423742e-01   +4.217183217171727e-01   -7.900606816991851e-02   -3.017404942752125e-02   +2.686805323171984e-01   -8.631868058883760e-02   -3.089200195189543e-02   +1.065135786550631e-01   -1.487838310673253e-01   +1.544002882311002e-01];
L1E_L1I_iGABA_netcon = [-1.032317186047205e-01   -2.093164249597916e-02   -3.594796319316695e-02   -3.058219104272447e-01   +4.432923422110753e-02   -4.335585738588680e-02   +5.089492040357487e-02   -4.269650375275572e-01   -8.879568408340438e-02   +6.092096631359295e-02   +7.652459212926394e-02   -1.459062425270822e-01   -1.644900459885336e-01   -1.175770315048031e-01   -9.896409541680426e-02   +2.807662622084259e-02; +3.099300343512535e-01   +2.421039696170321e-02   +3.539365860585921e-01   +1.373591001940042e-01   -2.471637853002699e-01   -1.214914318903644e-01   -4.954094350539555e-02   +2.589905722345759e-01   +3.608267184043411e-01   -7.024290307676817e-02   -3.299413264001519e-01   -2.184023447557745e-01   +2.509467554480829e-02   +1.419693583521374e-01   -3.185838100791871e-03   +1.708176250599731e-01; -1.530706586739668e-01   +3.025875596340006e-01   -1.861269275362705e-01   +2.839649891322960e-03   -4.230056039608999e-01   -1.809927223611836e-01   +4.478698398670963e-01   -1.336695476040756e-01   +3.222884532122619e-02   +1.518135762956674e-03   -1.590679462984808e-01   +2.803126703677921e-02   -1.458342920496185e-01   -9.834002310716673e-02   -5.417498279807970e-01   +6.559963313777140e-02; -1.924787151240878e-01   +1.918491165340360e-01   -7.429234259727685e-02   +1.505154826306066e-01   +1.747358571504052e-01   +4.009387184438998e-01   +3.378448029212806e-01   -3.322154557469388e-01   -4.247670017426086e-01   -1.865961734268144e-01   -1.465925890563849e-01   -6.076310660051445e-02   +1.176435908225198e-01   -1.437748808480735e-01   +7.098342058572790e-02   -1.661823851090840e-01; -2.425228839553802e-01   -8.630221365261059e-02   +2.876917561199367e-01   -2.941907963838251e-01   +3.226702603031090e-02   +6.531570957961061e-02   +5.376175708657187e-02   -1.554476294550516e-01   +8.618944190840255e-02   +3.482243785931267e-01   +2.632455266239446e-01   -1.549986535804614e-01   +1.625216435435679e-01   +8.845014946678104e-02   -3.037007679412247e-01   -2.322543212388295e-01; +6.821421465626290e-02   +1.389008894756691e-01   -8.183750458350786e-02   -2.475083091016325e-01   -1.247226626285417e-01   +1.127745669971008e-01   -1.195185769024248e-01   -1.203933798231230e-02   +1.666434779480599e-03   +2.896345333559339e-01   +1.688199285959158e-01   +3.454075441529356e-01   +2.980772744018457e-01   -1.871396238519909e-01   -2.181721174436275e-01   -4.375346171985889e-01; +1.970387242106580e-01   -3.981682786537499e-01   -1.197339126313735e-01   +1.881276543075328e-02   -1.009677607426825e-01   +6.106312813513523e-04   +1.137623549821448e-01   -1.210468942194530e-01   +1.664332917528139e-01   +2.362342401855302e-01   +3.974544990596237e-01   +3.154260216572835e-02   -1.219634313550653e-02   +1.418360483763065e-02   -8.692278114691976e-03   +2.472977551177991e-01; +6.449025748675238e-02   -2.291047049079782e-01   -3.687612840111819e-01   +1.973889482199970e-01   +1.063347578343087e-01   -2.418881809522928e-02   -2.422244732955538e-02   +5.417567334065804e-02   +1.761376340728634e-01   +4.117992484890834e-01   -4.206090861398559e-01   -1.121836267817446e-01   -4.235221937027331e-01   +4.652040054554564e-02   +1.708325360106484e-01   -9.555282627190098e-02; -2.486931655727517e-02   -3.646311516458028e-02   +1.482381037560823e-01   +2.697892472442542e-01   -2.407804564369704e-01   -8.822830423066405e-02   +1.679281160168657e-01   +2.883894639376052e-02   -2.158070767124940e-01   +8.799935893144574e-02   -1.405857334451875e-01   +5.319242345501436e-02   +1.514061486534778e-01   +1.198913895899508e-01   -1.606393147033977e-01   -3.428991939990058e-01; -2.664670171809974e-01   -4.179224598265651e-01   -1.160250602484612e-01   -1.448724421832261e-01   +6.898072092748973e-02   +3.971337189214883e-01   +2.219748925341941e-01   -9.703583279727429e-02   -3.601001502299791e-01   +1.656341979283517e-01   -9.540968012600765e-02   +4.524276668561196e-01   -2.198337711144571e-02   +4.558156828965858e-02   -1.286819945455178e-01   -7.011954460344719e-02; +3.056320913598105e-01   +6.747223848548092e-02   -1.304058095181256e-01   +4.264931333103770e-01   +1.889805553670504e-02   +3.021988474087686e-02   -5.992110857742808e-02   -2.247347843454495e-01   -3.601821614043405e-01   -2.167476926363173e-01   +1.440272640990015e-01   -4.578289132071314e-02   +2.977068128629732e-01   -5.291135729739096e-01   +1.440070013854671e-01   +5.252171713730265e-02; -1.521904836307024e-01   -4.072119959650042e-02   +4.362350388780367e-02   -3.348382714704582e-01   -4.466282809353244e-01   +3.572017926829964e-01   +1.123376756133292e-01   +2.165074529897658e-01   +3.699275037838856e-01   -7.222640829557760e-02   +6.753554002098890e-02   +1.683232116639084e-01   +2.520979449893567e-02   -1.603012503779135e-01   -1.872800049982848e-02   -2.485122055019456e-02; +3.611854131265728e-01   +3.913366359988865e-02   -7.164547621809969e-02   -1.680407333811983e-01   -8.406844148250475e-02   -3.644491771172653e-01   -6.773728650774298e-02   +5.651564304445110e-02   +1.455381169807740e-02   +7.675590348971530e-02   +4.526257962887528e-02   +6.057016218071051e-02   -2.301490752874905e-01   +1.629272874944315e-01   -1.467827055554740e-01   -6.139217491006585e-03; +3.436721951423967e-02   +5.581635596652246e-02   -9.386434953485671e-02   -1.326621338222028e-01   -4.439142242301241e-01   -3.835145987184036e-01   +8.190599993660344e-02   +1.387169337229648e-01   +1.659723375551271e-01   +1.761269905520336e-01   -1.362335206531504e-01   +1.680779458425633e-01   +1.028192131717320e-02   -1.493357793499249e-01   -2.713157660780129e-01   +9.844700505153317e-02; +9.893180577911195e-02   +1.296699207240965e-01   -3.147269359560872e-01   +1.754446372551146e-01   -4.440389193877611e-01   -3.283772780595340e-02   +3.866200928642492e-01   -8.190610167424008e-02   -3.762457439770474e-01   -3.844198271376766e-02   +1.106195461021124e-01   -1.555001518263812e-01   +6.105322491001773e-02   +4.120020079600606e-01   +3.645911533272165e-01   +3.760476663570835e-01; +1.367184863881105e-01   -6.380411499031680e-02   -4.823332711425183e-01   +4.106954467893114e-01   -5.502607542743315e-02   -4.927008499879987e-02   +1.499099548490400e-02   -2.100745547954465e-01   -7.416033992451598e-02   +2.296805943668291e-01   +1.035183006855214e-01   -3.525710820607869e-02   -3.517572564507453e-01   +6.308701445095430e-02   -3.881086341733078e-03   -4.801578068467680e-01];
L2I_L1I_iGABA_netcon = [+2.455246368518266e-01   +3.855704925908525e-01   +1.601433184666212e-01   -1.387403931708359e-01   -1.905800968837204e-01   -3.797837607084326e-01   +3.209170426487861e-01   +2.516429290695611e-01; -2.465776262541776e-01   -8.848228867719549e-04   +1.927034052068874e-02   -9.918230594385977e-02   -3.306451822920651e-01   -2.966912955402502e-01   -2.876572114662503e-01   -1.956775401362373e-01; -1.192152628486255e-01   -2.741799790339530e-01   -2.287731318379364e-01   -1.221888248920708e-01   +1.362319596255273e-01   +5.238163022726888e-02   -1.816158513269957e-01   +3.409513901668378e-01; -2.740123989907934e-01   +8.319565139466517e-02   -4.131390394462524e-02   +2.743310416069235e-02   +1.442065252028175e-01   +7.463475927462065e-02   +1.619168053144671e-01   -7.469468182977211e-02; -2.412590545187032e-01   -2.430048674962672e-01   +2.037289236786110e-01   -2.700261140537724e-02   +2.603508237029877e-01   -2.814773332309237e-01   -2.188663252894289e-02   -4.983126138340435e-01; +8.411762931139431e-02   +2.837324450484572e-01   -1.140049806321733e-01   -2.871278030168075e-01   -1.186435272729268e-01   -3.780803021886416e-02   +1.900062565827699e-01   -3.068693855654145e-01; +2.329996465778031e-01   +2.709620821669184e-01   -5.296359157181310e-02   -3.209104293851993e-01   -9.416381591555470e-02   -1.920365203619799e-01   +1.168734204419882e-01   -2.056763673842419e-01; +3.481852852638074e-03   +2.195687550740217e-01   -5.525418635750228e-02   -1.286494058640292e-01   -1.157535003521258e-01   -2.320733361068611e-01   +3.884277485746841e-01   -5.542604790546539e-01; -1.744610475161957e-01   -4.949946080839784e-01   +1.441006368740856e-01   -1.125811702540390e-01   -3.511092698511922e-01   +1.358945485304347e-01   +5.497042924602497e-01   -1.501617311260234e-01; +1.264156187752923e-01   -3.190903851960860e-01   -1.479581618232201e-01   +3.165877389851536e-01   +2.332725707237991e-01   -1.274584651434932e-01   +1.211967843444740e-01   +6.689336915640540e-03; +1.731342914360884e-01   -3.108564057631959e-01   +2.316707601697507e-02   +4.415694287304164e-01   +8.426902382857410e-02   -4.543646199350275e-01   +2.677950191427590e-01   -9.731210026505108e-02; -1.035840000981875e-01   +1.437678672172967e-01   +2.965359315336399e-02   -2.866425583227841e-01   +7.936658084214571e-02   +6.296337075286589e-02   +2.605337973349380e-01   -7.676853125853045e-02; +3.159983343440176e-01   -1.878208012112609e-01   -1.496360204041003e-01   +9.569698392174475e-03   -3.744194404334031e-02   -1.422087617775030e-01   -2.128050314568852e-01   -1.651463341712004e-01; -3.761104431910364e-01   -1.786152646192744e-01   -7.233459900681313e-02   +3.053228682627647e-01   -2.171668540303725e-01   -2.640091215133911e-01   +7.882405170797874e-02   +3.088613524696737e-02; -1.102966665630260e-01   +3.112064401680448e-02   -1.521320499982445e-01   -1.987657425224477e-01   +1.510658875536618e-01   +5.901220736075179e-02   -3.290510212159687e-01   +3.222283893627816e-01; +3.733907050257229e-01   +9.772937519392128e-02   -1.166015684783702e-01   -1.013161221289502e-01   -2.807231133489891e-01   -1.322243937973991e-01   +3.261171753773223e-01   -2.298252401540901e-01];
L1I_L2I_iGABA_netcon = [+4.376963314180755e-01   +3.967094688237158e-01   -2.707072877054777e-01   +7.454677718397376e-03   +5.395018534742576e-01   +5.038146391802059e-02   +1.402294899647043e-03   -2.011552046478254e-01   -3.174456795031007e-01   +1.953095683295149e-01   +2.175829636985151e-01   +2.075132971376055e-01   -1.703528180629961e-01   -1.124821129645580e-01   -2.580840000148544e-01   -2.574130969521508e-01; +2.663797738488320e-01   +7.348802558138634e-02   -1.038463796279540e-01   +5.475093005217689e-01   +1.004726432333936e-02   +3.656062190765216e-01   +7.047259470792892e-02   -1.164261482340704e-01   -2.054992575205316e-01   +2.391944650183481e-01   +3.919728609150307e-01   +7.829773023097032e-02   +3.560635342037359e-01   +1.876153204094986e-01   -2.961989341016429e-01   +1.125001365847700e-01; +5.459511543138829e-02   -2.457156126752873e-01   -9.962060092518749e-02   +1.386771140798881e-01   -8.578689442182126e-02   -1.579063237674707e-01   -4.444334213787374e-02   -1.857930200471015e-01   +1.619938665652077e-01   +1.255236224608186e-01   -4.087085957517272e-01   -4.437888605358814e-02   +3.802674816470781e-01   -8.864186527314077e-02   -1.861138237116611e-02   -5.048250555066941e-01; +1.123003464145196e-03   +1.324248304383485e-01   -1.403614783116024e-01   +2.557124891041899e-02   -1.887981336122596e-01   -8.567853019108566e-02   -2.212869770805971e-01   -2.908551522414322e-01   +2.669676698249163e-01   -2.332832781336480e-01   -3.445447634657576e-01   -4.055398446988854e-02   +4.027202221993126e-01   -5.364559014645580e-02   +1.915224564943468e-01   -1.950557489921992e-01; -6.217438978600311e-02   +1.072797634880743e-01   -2.794495423213574e-02   -2.403647043352989e-01   -1.360005496496907e-01   -5.245878955473386e-02   -1.921072706094306e-01   +5.877568395470943e-01   +6.252983016680921e-02   -4.135862060781689e-02   +2.140443177563944e-01   +1.055113857702508e-01   +2.269398452189917e-01   -7.063393110622487e-02   +3.810320361145454e-01   +3.216069688075905e-01; +1.989270727308469e-01   -2.732760651458123e-02   +2.276756420854189e-01   -1.528963773041411e-01   -3.608860520058770e-02   -1.524615602261180e-01   -2.057291031656812e-01   +2.633021408267028e-01   -1.153353497729240e-02   -6.877413071871785e-02   +2.412129706775012e-03   -6.106628536772282e-02   -2.876486202020462e-02   -4.436989711936767e-02   +7.590134317800681e-02   +2.838338958419022e-01; -7.318551827331531e-02   -8.686558995722399e-02   +6.892597627400224e-02   -9.653640035184347e-02   +1.444014782956334e-02   -7.084977013113863e-03   +2.621456434825982e-01   -4.355095843968926e-01   +2.264667137365129e-01   +1.733911679968556e-01   +1.302895073169144e-01   +3.323019625881365e-02   +3.915473950516640e-02   +9.128911970659896e-02   -1.760889607178991e-01   -2.452794634497969e-01; +2.005450823214513e-01   +3.850772338476183e-01   +1.746903662508387e-01   +3.579304977416613e-02   -2.823117397235727e-01   -1.537542869827463e-01   +1.201456019317563e-01   +1.779855141802475e-01   +3.199893306923752e-01   -2.141586248141898e-01   -1.749715038882625e-01   +1.075389746426398e-01   +3.920368233977904e-02   +2.674190946484915e-01   +7.480033346325968e-02   +2.063983058691168e-01];
L2E_L1E_iAMPA_netcon = [+8.041770684499433e-02   -3.665094131470683e-01   +6.805103894731501e-02   +3.265982843989035e-02   -3.840978892089990e-01   +3.164975412853454e-01   +8.243306597833157e-02   -1.113096307930084e-01; -2.454109731938689e-01   -1.947286367520449e-01   -4.797506556282800e-01   +3.121604048710899e-02   -7.033915755337367e-02   +1.049710232644731e-01   +3.461427245588430e-01   -4.464618810529045e-01; +4.923845035751426e-02   +1.352083619239465e-01   +1.997556172760955e-01   -1.104453714373674e-01   -1.464706605924944e-01   -2.015422131396616e-01   -2.683174086851544e-01   +1.357063755662842e-01; -2.499624434599051e-02   +4.585623161012146e-02   -2.294143168815269e-01   -3.501127369009674e-01   +1.050039994211243e-01   -4.464455574008858e-02   -7.428846218468022e-02   +2.692826231572996e-01; -5.760378722628713e-02   -1.873827986713925e-01   -1.275747708656138e-01   +3.084438524757063e-01   -4.547017542197102e-01   -3.099989944454914e-02   +1.774897331574030e-01   -3.693860931914753e-02; -8.917267467670387e-02   -1.166459602847587e-01   +7.234840365622991e-02   +2.337423936577836e-01   +3.601871962271992e-01   -1.266547492393376e-02   +5.370978245301219e-02   +1.945162826360184e-01; -1.236314683405369e-01   +1.155178154567155e-01   -2.680939578723071e-01   +1.344600582423948e-01   +1.910658712535282e-01   +8.132058115539510e-02   -2.778282654022363e-01   -8.088546372026224e-02; +2.436725369100343e-02   -2.372801126309141e-01   -2.585520961498323e-01   +1.773602591767002e-01   +1.858817394197622e-01   -9.492447893975482e-02   -5.640305095983147e-02   +1.110053207548296e-01; -4.189656538198575e-02   +9.718569106396648e-02   -1.791134411055838e-01   +1.096430563914988e-01   +8.996889139338927e-02   -2.031986199137184e-02   -2.517269533740958e-01   +1.337595828848711e-01; -9.157429384494986e-03   +5.340979034940546e-04   +7.454875751097470e-02   -1.805588823958942e-01   +3.660973252680889e-01   +1.307864670793582e-02   +2.079007356798466e-01   -4.421137661154170e-01; -2.324818333099085e-01   +2.045739487300709e-01   -1.967094178101693e-01   -8.823371356475118e-02   +2.077210077560103e-01   -1.796058908824287e-01   -3.301498033125633e-01   -1.246401040450354e-01; +2.569110514731738e-01   -2.981928620142312e-01   +8.483934561609556e-02   +2.762524632652757e-01   -4.439032771862862e-01   +2.651749606059650e-01   +1.169355306450936e-02   +4.601322226130630e-02; +6.597399475691365e-02   -2.788636977040224e-01   -1.241189062394613e-01   -3.931217137345597e-02   -4.945847386364952e-02   +8.711096677488657e-02   +4.870229010900194e-01   -9.405431064069159e-02; -1.365554409586493e-01   +2.387668264796439e-01   +1.658619592357064e-01   +3.637448539294057e-01   +2.753674026648653e-01   +1.248072514939689e-01   +2.783737234387201e-02   -2.465536420893587e-01; +1.956623026325846e-01   -1.722038232476334e-01   -2.264097403662569e-02   -6.474942799774730e-03   +1.693662233059811e-01   +2.112516640321933e-01   -3.343823285732089e-01   +1.606074155323749e-01; -1.197748489142076e-01   -3.651889000265114e-01   -5.612375918491132e-02   +1.567099162749007e-01   +1.380566227118078e-01   +3.278031406653532e-02   +3.494658353260763e-01   +6.163671998673984e-02];
L1E_L2E_iAMPA_netcon = [-4.681335173335502e-01   +1.134531839971153e-02   +5.969547683709504e-02   -1.395356236516780e-01   -7.220845264526179e-02   -1.843099978767639e-01   +2.893356764627341e-01   +1.789714084734503e-01   -2.621757616293001e-01   +3.089704008347642e-02   +1.863955732176854e-01   -2.420932978256006e-01   +8.886024339390400e-02   +4.249980629562228e-02   +2.628387688648540e-01   +2.623308014491817e-01; -3.280101297174834e-01   -5.050919308060536e-03   -1.314644038051219e-01   +1.790985475188477e-02   +1.888156765872561e-01   -4.102758612697340e-01   +9.841037278957726e-02   +2.618797709792700e-01   -2.532462193951966e-01   +4.175519458900641e-01   +5.170484039839003e-03   -3.334031610032811e-01   -2.729817703786478e-01   +1.994985203153518e-01   +3.305187250660261e-01   -2.945769589853844e-01; -1.689319698758829e-02   -2.483108522760332e-01   -2.787329605855944e-01   -9.921809493113576e-02   -3.809885342139592e-01   -2.513058716699083e-01   +1.468186398637242e-01   -1.730541985511822e-01   +1.724287275525026e-01   +4.910184739651691e-02   +1.739927642701253e-02   +3.187949952579910e-01   -2.474352559427553e-01   +2.529274590680073e-01   -4.293559325805313e-02   +3.171959509517650e-01; -1.494426758169697e-01   -3.851284829918326e-01   +1.093288697675696e-01   +4.544837707904036e-01   -3.856506024825290e-03   +1.418430469982692e-01   -1.640630946369940e-01   -1.130480884191211e-01   -3.434748740674947e-01   -3.084727333461512e-01   -7.566908624711190e-02   -1.676778091861220e-01   +6.158095310635023e-02   -1.574459246269725e-01   -2.808857956863978e-02   +6.338181107709422e-02; +3.954164675850231e-01   -1.391580000104607e-01   -7.527970057104094e-02   +1.189862932051874e-01   -1.823047466525006e-02   +2.663411288776903e-01   -2.332314815230709e-01   -1.764152817278673e-02   -1.138700926999485e-01   -3.823039076264603e-02   +2.423230930568959e-01   +5.137995916402582e-01   +4.236173100752716e-01   +1.853309599900181e-01   -2.909682313489439e-01   -1.464162075745286e-01; -1.330191229839590e-01   -1.203550581098796e-01   +2.282075731550418e-01   +1.592573439585898e-01   +2.765771135950407e-01   -8.196946485851793e-02   +7.229777233833774e-02   +1.424387173169131e-01   +5.253429768115638e-02   -3.032369429248564e-01   +3.451973389544817e-02   +1.930944811431301e-02   -1.773083007067983e-01   +5.766767634928283e-02   -1.671038615523715e-01   -2.294519377978534e-01; -1.290134907610517e-01   +2.995570997355800e-02   -8.017978208221928e-02   -2.938378820955577e-02   -1.716794779300861e-01   -2.800367951537304e-01   -3.239155167746475e-01   -6.038328752301415e-02   +7.125396162914432e-02   +1.506504539085722e-01   +2.644161093203151e-01   +2.798692948361095e-01   +1.251268968415290e-01   +1.541159804196703e-01   -5.109237748446722e-01   +2.246269827414110e-02; +4.224089639109175e-01   -7.230061122112859e-02   +9.023895558975326e-02   -1.484177173169018e-01   -2.652670586722823e-01   -2.368318224226201e-02   +2.240302624228760e-01   -2.204133235633999e-01   -3.243906040549774e-02   -8.114565963511630e-02   +1.077168970031361e-01   +2.728194659210913e-01   +2.463051630214261e-01   +3.004099223591876e-01   -9.326324140261019e-02   +1.476121552116329e-02];
L2I_L2E_iAMPA_netcon = [+4.310749156026284e-01   +4.783236838037110e-01   +4.860912200984192e-02   -1.796754880484254e-01   +2.505963072558451e-01   -4.835481074127393e-02   +6.628017815711992e-02   -3.964695197084575e-02; +2.070620736343276e-01   +2.827513723460378e-01   -5.784326773024862e-02   -3.863764921183656e-01   +1.260869829687886e-01   +6.716734549265256e-02   -3.936128027153999e-01   -1.848207375842300e-01; +1.072949457410058e-01   +1.419364966332441e-01   -5.847265762943957e-02   +1.587379067483807e-01   -7.554621283066995e-02   +1.118847119412212e-01   +3.766396266579859e-01   +8.335428189463673e-02; -7.319823343949393e-02   +8.985083870687022e-02   -1.631494277312184e-02   -1.216135568262234e-01   +3.041208145384292e-01   -7.432129799471485e-02   -3.681450669049087e-02   +7.763335260087367e-02; -2.985214896606467e-01   -3.607353197074082e-01   +1.247546465399714e-01   -1.897224567677756e-01   -7.881961537705695e-02   +1.375020305135047e-01   -9.916251309191591e-02   -2.636337934481192e-02; +2.386059320726332e-01   -1.430412806260485e-01   +2.439505754632799e-01   -2.735480009754032e-01   -8.391076916622896e-02   -1.716543609211363e-02   -1.686139078912355e-01   +1.920549099238881e-01; -6.985370937511670e-03   +3.411498008752076e-02   -1.560173236446749e-04   -1.561381416264142e-01   +7.151714007113172e-02   -1.253022725428100e-01   -3.082205749670260e-01   -2.111406945578278e-01; +5.717374621386412e-02   -4.802861393636582e-02   +2.867973187127096e-01   +4.197461309997561e-02   +1.575114685064264e-01   +1.315656829089149e-01   -2.553153656756642e-01   -3.177454782298155e-02];
L2E_L2I_iGABA_netcon = [+2.974606619865847e-01   +9.094751825654063e-02   +4.208551050806519e-01   +2.793083589136372e-01   +3.136647369826968e-01   -7.451567029098216e-02   -4.161627173137142e-01   +1.182048053116145e-01; +1.822754488147497e-01   +5.121918680868059e-02   +2.354865463649038e-01   +2.708397436487220e-01   -1.025062516008105e-01   +5.195677642306654e-02   -3.326216283777437e-01   -8.064918934352916e-02; +2.881455809848822e-01   +1.873933734528710e-01   -3.338921132183310e-01   +4.029622735322369e-01   -6.512791352427796e-02   +5.757683537826307e-01   -1.855869891337612e-01   -1.860097820985170e-01; -2.159728133604198e-01   +2.606361666617925e-01   +5.922853186435541e-02   -3.293811939997913e-02   -1.872933139877156e-01   -1.810138595801106e-01   +4.254667237476277e-02   -2.300668396138255e-01; -1.377727192431673e-01   -4.023528298922653e-01   -7.072725815976882e-02   +1.328164415788178e-01   -6.536689349751906e-02   +1.498925995875155e-01   -8.505831989264166e-02   -9.522204149418649e-02; -2.253057793622417e-01   -1.970018250305643e-01   +8.678054339444076e-02   -1.780292049264838e-01   +2.447727302096819e-02   -1.282256913947908e-01   -5.777680734342802e-03   +1.057733669285408e-01; -2.751806297809974e-01   -2.336792260109796e-01   -2.236805878168961e-01   -2.159912447947314e-01   +8.558982543648636e-02   -4.859071317623590e-01   -8.884117533515118e-02   -3.008437325271340e-02; -1.735783476142879e-01   -9.404075178463663e-02   -3.352701029844389e-02   -1.459971794239742e-01   -6.973364117668403e-02   -3.135380248706261e-01   -1.358155572081436e-01   -2.862449958620267e-02];
L3E_L2E_iAMPA_netcon = [+5.857152123841135e-02   +3.090974017634383e-02   +2.016952982417975e-01   -2.473910624228343e-01   -2.120935278199022e-01   -7.718154461820198e-03   +2.903496601263402e-01   +2.428985068433207e-01   +2.983629236597574e-01   -1.948769278324509e-01   -1.191210751776285e-01   -5.397711149274756e-02; -1.094065642592689e-01   -3.845383110802220e-01   -1.805906752828405e-01   +2.490330893354502e-01   +1.281020927420585e-01   +1.034623412977160e-01   +9.697431396786002e-02   +1.055696406681339e-01   -7.128784210138236e-02   +2.617898014943438e-01   -8.961034218772999e-02   -1.466427526109850e-01; -2.036767907620923e-01   +1.309905280450782e-02   -3.662400282615451e-01   -4.151584277632738e-01   -2.204196278981962e-02   -8.455153745536309e-02   +3.131720723609533e-01   +3.506704496333692e-01   -3.349625323855954e-01   +1.319991795109943e-01   -7.092726557715187e-02   -1.131238385841309e-01; +4.234031561148593e-01   -1.932926180769705e-01   -1.878621640681122e-02   -3.964495170322357e-01   +2.015148134081682e-01   +2.538598094719308e-01   +6.007797876329254e-02   -2.204538780532931e-01   -2.179610070993502e-01   -1.952271848825024e-01   +2.027325019296072e-01   +1.151876912902986e-01; -2.331277270032612e-01   +1.580192308119098e-01   -2.690356191317311e-01   -6.496069489597255e-02   -6.823890351723982e-02   +3.014408084219271e-01   -3.716519119733053e-01   -3.338896303156123e-01   -3.141221405002568e-01   +4.105782233146407e-02   +4.629589242863877e-01   +1.027293236133822e-01; +3.008517215000798e-01   +1.303227603359630e-01   +3.657537075150157e-01   -1.376817015591544e-01   +1.575693877725826e-01   -3.166406951040853e-01   +2.547640195797148e-01   -1.948016692095699e-01   +1.252679452707136e-01   -4.342688737742574e-01   +1.760361444929786e-01   +2.863667525305965e-01; +4.106919435295089e-02   -2.922887579249067e-01   -8.655172800053428e-02   +6.328451713076413e-02   +4.348530919855741e-01   -1.079060130597570e-01   +1.317992398467303e-01   +1.531892221573100e-01   +1.732134622503644e-01   +1.306265836020435e-01   +1.882356269463577e-01   -3.015958861436455e-01; -1.650275682168708e-01   -3.183264089092640e-01   +2.519330496320369e-01   +1.774651008917029e-01   -8.959202419461967e-02   -3.294005522314133e-01   +8.449887402638545e-02   -2.270843136109458e-01   -8.349485317178067e-02   -2.187972246619201e-02   -3.779381603820595e-01   -2.190497122088122e-01];
L3I_L2I_iGABA_netcon = [-2.768643355325646e-01   -1.251092777907691e-01   -1.410467372792523e-01   +3.998686823699393e-02   +1.108439426878810e-01   -1.376858134200787e-02   +2.616757699754918e-02   -8.776067850057663e-02   +4.355481923046031e-02   +1.614032357924564e-01   -2.873235138949156e-01   +3.585506443702103e-01; +4.183256735041050e-01   -2.581636991953823e-01   +9.918738625748276e-02   +2.441208499288242e-01   -3.998577180430254e-01   +3.628678632108252e-02   -2.035819562821892e-01   -3.544370875189740e-02   +3.229135151872949e-02   -3.690701779043577e-02   -1.187540843296417e-01   +4.671434363897350e-01; -7.112833637258806e-02   +2.265781683712904e-01   -3.393088504891541e-03   -2.350604202496464e-01   +3.205139750066857e-01   -2.698323335793069e-01   +3.015463960298722e-01   +7.087557214653487e-02   -2.078505635892838e-01   +2.774679616913407e-01   -2.410478330334249e-01   -1.434135334264992e-02; -9.024683984447990e-02   +1.553756296243091e-01   +1.405972500720815e-02   +2.914226542008031e-01   -2.542699579785850e-01   +7.223299862472847e-02   -2.119839580743196e-01   -7.737056208073353e-02   -2.028820858455076e-01   +2.560879506912406e-01   +3.678618886395373e-02   +1.780192361871318e-01; +1.121908654228033e-01   +3.075552565718376e-01   -2.282145154578563e-01   +3.937753231362418e-01   -5.686471962802198e-04   -6.248509074471326e-02   +1.268259789200429e-01   +3.788745813500499e-01   +2.683605911289242e-01   +3.787704630529836e-01   -3.254779636631353e-01   +2.230388030694758e-02; -3.249835876249222e-01   -3.506048825744370e-01   +2.520618070580313e-01   -1.381396618038437e-01   -2.759723106974712e-03   -2.338503613399230e-01   +2.341118638786880e-01   +3.999031490500694e-01   +2.595128873855941e-01   -6.313885842673297e-02   -4.922333278661836e-02   -5.685905276494493e-02; +2.616492267226642e-01   +4.426654461840236e-01   +1.111489514844376e-01   +1.274469002189677e-01   -1.475123715717153e-01   -2.577674753341335e-01   -8.807572076824596e-02   -2.343255928612615e-01   -3.598166963909365e-01   +1.378360887605353e-01   +4.399783051291063e-01   +9.667986781431863e-02; +1.310303750286577e-01   -3.066027389268287e-01   +9.376589441098550e-02   -4.708070032544444e-01   +4.035298136348861e-02   -5.597018009899236e-02   +2.262205728333434e-01   +6.506338557545416e-02   -7.132818171204959e-02   +1.099399837026989e-01   +1.510028856496739e-01   -2.537594445936386e-01];
L2E_L3E_iAMPA_netcon = [+1.208689470346282e-01   +2.357947436955145e-01   +2.343744209406729e-01   -6.597643423143765e-02   -1.521891765992354e-01   +1.053700297337666e-01   +2.127643288005222e-01   -5.371761549881818e-02; +3.686648694266298e-01   +1.466518958670339e-01   +3.131355136329805e-01   -4.023192156853955e-01   +2.977195122991227e-01   -1.750705949477309e-01   -1.208992130723522e-01   +2.466143968482929e-01; +1.227850678982369e-01   -1.420868573734686e-01   -3.067412593515687e-01   +1.563642321048624e-01   -1.342981535863189e-01   -2.450636492437546e-01   +7.848220133338393e-02   -3.672543161821628e-01; +1.270412793698850e-01   +1.365748590879716e-01   -1.610238769522718e-01   +1.839598328479689e-01   -2.846426965495769e-01   +1.890405011868846e-01   -2.007755970808114e-01   -4.139141415365200e-02; -2.243529831292093e-02   +1.927904321754627e-01   +1.680908242688894e-01   -3.419716811473564e-02   +3.300892457819378e-01   -2.840421903891241e-02   -3.463619705607180e-01   -5.694614871830654e-02; +9.407955246940622e-02   -5.488352686397732e-02   -1.007354495337648e-01   +9.424204563713118e-02   -4.295030632394875e-01   +2.962195763385578e-01   -3.034846039854626e-01   +4.527639818076819e-02; -1.153800806275309e-01   -1.383195588545285e-01   -2.941317119524269e-01   +8.471341054305159e-02   +3.003015368675763e-01   -3.219688732350107e-02   +1.824769674173592e-02   -4.376263406048587e-01; -3.401958008386970e-01   +2.700960752715407e-01   -3.590846612595957e-01   +1.270689586041362e-01   +2.711008881692077e-01   +2.365175012977432e-01   -2.349859870600771e-01   -1.073627224292569e-01; +2.801340866250963e-01   -3.464295817146921e-01   +1.480554946493123e-01   +4.018518533661619e-01   +1.587421011106082e-01   +2.404723033047353e-01   -3.391906907021213e-01   -1.847079357595104e-01; -1.131615075691690e-01   +4.562797111300572e-01   +1.067064419941525e-01   -3.285130942957014e-01   +3.425617108750831e-02   +1.433263112712781e-02   +3.449234563706212e-01   -1.264285668497980e-01; +6.171621688818645e-01   -1.004050723897321e-01   -3.872285758507787e-02   -9.976373286622839e-02   -4.807236670302933e-01   +6.810206952723744e-02   -1.229351531713498e-01   +2.234255306749892e-01; +3.048876956654930e-01   -1.714371434040685e-01   -1.213859923134528e-01   -1.471602773015455e-01   -1.147738834482260e-01   -1.364354125854897e-01   -1.928377490960165e-01   +1.233702837690832e-01];
L2I_L3I_iGABA_netcon = [+3.864527434784418e-02   -3.475004147241583e-01   +3.953169879787616e-02   +3.673368421526065e-01   -1.734717163184464e-01   -1.473122775846030e-01   -7.813210689785019e-02   -1.215882684847995e-01; -5.988291413580285e-02   +1.202956485712863e-01   +2.569642768651050e-01   -1.031257550729378e-02   -1.129173096958793e-01   +1.312506315186651e-01   +1.089960548804264e-01   -2.131072168665239e-01; +1.231824315118690e-01   -2.615772741140120e-01   +2.713158458950948e-01   +3.977997265528347e-01   +1.352706317613030e-01   +1.814799138373018e-01   +5.117457965782025e-01   +2.212009737451220e-01; -2.887717385168856e-02   -2.897648229369282e-01   -4.767639241870170e-01   +4.008719952993268e-01   -2.047789305062024e-01   +6.856905812056630e-02   +1.373422283425571e-02   -3.765036455777538e-01; -1.724723123435624e-01   -9.427142342677036e-02   +6.877332204614282e-02   -2.175963584100998e-01   -1.592174727704508e-01   +5.232466515061969e-01   -3.704703419546075e-01   -2.339676704391648e-01; +4.059950200632667e-03   -3.058843542259941e-01   +3.000946616464258e-02   -2.438296061076423e-01   +3.545305865623443e-01   -2.470843355673469e-01   +3.004382071847003e-01   -2.353481642883483e-02; -4.719775962273033e-01   -8.816224627328979e-02   -2.805316192067921e-01   -3.863671093076870e-02   -1.914155992916424e-01   +2.215297470476271e-01   -2.114313343080300e-01   -1.221540217470281e-01; -9.488442580830669e-02   +3.499038201597107e-02   +1.981096229211212e-01   -2.702283528248485e-01   +2.148037072860501e-01   +2.778206249628182e-01   +1.009358222729655e-01   -1.828055774221635e-01; +1.316182894168792e-01   -3.120761742026126e-01   -3.252867905314790e-01   +2.776797182363562e-01   -3.090704991096308e-01   -1.987274751924799e-01   -2.752893745957673e-02   +3.258732071147055e-01; +2.856853828830618e-01   +2.595572582501177e-01   -3.906066246933829e-01   +2.375252360303531e-01   -1.630827108959811e-01   +4.363988997061563e-01   +1.666732216493935e-01   -1.290930004390160e-01; +1.983845991851967e-01   -2.048254882904184e-01   +2.806128873041508e-01   -2.503339939233604e-01   +1.363434820101750e-01   -6.727531349216330e-02   +2.342889602610261e-01   +1.310619822719970e-01; -6.222335385002632e-02   -6.744910237127286e-02   +8.656846978030884e-02   -3.099087416064743e-02   -2.197980234219296e-01   +1.622618732770685e-01   -1.137110152443828e-01   +2.080612778777674e-01];
L3I_L3E_iAMPA_netcon = [-5.933991831067273e-01   +2.780655544180657e-01   +9.172722631292353e-02   -1.163430547475807e-01   +1.176742436059385e-01   -2.803115477462839e-01   -2.311871504325447e-01   -2.338257981505311e-01   -1.342432593507381e-01   -7.260721591639509e-02   -4.378218121809001e-01   -3.351742166341055e-01; -2.651230123200883e-01   +1.242121800183904e-01   -1.414626920934914e-01   -3.019106259864971e-01   -2.333008808917224e-01   -3.574667914575332e-01   -1.200761574665903e-01   -2.019291386869893e-01   -3.513550195842279e-01   +2.544754573912038e-01   -5.649193745611286e-02   -2.058698415474520e-01; +3.125642215346273e-02   -2.657465818059493e-01   -4.268104573044780e-01   -5.596322195097397e-02   +3.438745559980791e-01   -5.070707189529344e-03   -2.760338484364659e-01   +1.470991594795262e-02   +1.732731852317513e-01   +1.795585198849609e-01   +1.158693865067132e-01   +7.551102943562804e-02; +8.193850112919468e-02   -4.442563535744293e-03   -3.395911232165394e-01   +3.427062891800743e-02   +1.429028045198538e-02   +1.265662203771316e-01   -9.532367683958466e-02   -5.250553648856436e-02   +1.718123097502710e-01   -1.360746780809353e-01   +3.195364182639281e-02   +1.913941227112069e-01; -2.667935835923146e-01   -2.636978178918474e-01   -2.328159135299675e-01   +2.634398446564631e-01   -4.062338531148315e-01   -1.807496109452992e-01   -2.763159418208599e-01   +1.887025288444255e-01   -1.745884533493651e-01   -3.311617845854666e-01   +1.268761171537023e-01   -4.647230802229747e-01; -4.157975572705533e-01   -2.297534512059579e-02   +1.012443928853226e-01   -2.689389968004219e-03   +2.390974753286035e-01   -2.403634440635399e-01   +1.678495176570158e-01   +2.395168163144132e-01   -9.884236570228859e-02   +1.190718513792204e-01   -2.260671426119491e-02   -4.968780586772237e-02; +4.246348154544011e-02   -2.049771430682752e-01   -8.180432298701813e-02   +2.336276114497356e-01   +1.208984891720387e-01   +2.835599788289953e-02   -2.674993764670209e-01   +1.566171580448817e-01   +4.956873637101820e-01   +2.203636593158216e-02   -1.175057859042866e-01   +4.075111349741365e-01; +5.045610658952480e-02   +1.872866934499243e-01   -3.513600775830942e-01   +1.439000438915621e-01   -1.067313359945418e-01   +3.554704002661616e-02   -2.377762761882673e-01   -3.669580146489694e-03   -5.772103585205926e-02   -4.757176129883868e-01   +4.413796834238537e-02   +2.631615640745053e-01; -1.262079429563973e-02   +1.925628190077903e-01   +8.977571114891902e-02   -9.683166626656733e-03   -9.385419506384290e-02   +2.951537042799198e-01   -2.625424115746012e-01   -2.715214398859740e-01   +1.382361480440028e-01   -4.010293085999759e-01   -4.117956038517352e-01   +9.063291991610795e-03; +9.957921534552289e-02   +2.199056339557208e-01   +1.302374202212686e-01   +4.125753342278492e-01   +4.748167297212291e-01   -9.147057519417076e-02   -1.796746511242777e-01   -1.247447846793541e-01   +1.952051265318029e-01   +5.381779028928563e-02   +8.335243283788035e-02   -1.605248923196766e-01; -1.914055409723314e-01   +7.574600428058799e-02   +2.368277529586368e-01   +2.619106238248848e-01   +3.449943099346698e-01   -3.187033621450880e-02   -4.547807018947674e-02   -2.160744571233378e-01   +3.344243811839869e-01   +1.228874692818537e-01   +2.541962986933447e-01   +1.174388157983382e-01; -9.446656020212500e-02   -1.502398201573035e-01   +4.351754680185320e-01   -2.969875522212088e-01   -1.130914170724579e-01   +3.375462159917024e-01   -4.777009244097976e-01   +2.119371464396361e-01   +3.832366546603405e-01   +2.866085075604821e-01   -2.163013413327118e-01   -1.592774073161791e-01];
L3E_L3I_iGABA_netcon = [+4.053515136592793e-01   +1.944369113577369e-01   -1.901189396647301e-01   -2.287839246472014e-02   +1.612884046629046e-01   +6.539928281928714e-02   -1.923158805530352e-01   -4.603827855970569e-02   +9.482447044067949e-02   -3.597077523558176e-01   +1.895928707453950e-01   +3.072045967176045e-01; +5.000645646108873e-03   +1.289467248941426e-02   -3.518335349706733e-01   +1.818644303471368e-01   +1.489452515170280e-01   -1.883332164030307e-01   -2.794466495967456e-01   +2.607379430621238e-01   +3.609782467739882e-01   +2.601644310029930e-02   +4.448734016045046e-01   -1.366055544126375e-01; -3.785985095984230e-01   +4.236046760033486e-01   +1.678697208032952e-01   +1.442863616729124e-01   -2.610036814560396e-01   +6.988577426083839e-02   -1.664919222294464e-01   +9.548386433592736e-02   +3.432524575250673e-01   +4.226959982112996e-01   -1.466149116197588e-01   +3.195953320222956e-01; +6.535082824421251e-02   +6.939456614509887e-02   -4.296338793447377e-02   +3.769460749790693e-01   -1.994743255027328e-01   -1.402671658092655e-01   -7.790822675658481e-02   +3.018308539915693e-01   -2.856315449122544e-02   -1.456439376573817e-01   +1.861439631663903e-01   -1.977598066380497e-01; +5.005249678277661e-02   +3.114472436394798e-02   +4.267249540479539e-01   +9.511528184811351e-02   +1.245333215257979e-01   -3.164117957874789e-01   +2.087104384199645e-02   -1.867341192556108e-01   -1.198962050425908e-01   -1.740637857694195e-01   -3.704850611745042e-01   +7.902293261859797e-02; -9.575239589992482e-02   +1.558282426214978e-01   -4.038888699807452e-01   +3.524994018437526e-01   -2.662190224054650e-02   +2.065916678914287e-01   +2.549002873697714e-01   -2.552815141349695e-01   -2.065131713323698e-01   +2.473435865727174e-01   +3.619236864234240e-02   -1.491317227165358e-01; +1.838441099816294e-01   +1.146430378776980e-02   -2.946343562111742e-02   +1.383686341711711e-01   -3.198367386464509e-01   +4.009914887455081e-01   +3.765161510767909e-02   -1.941679649405417e-01   -1.002013040588629e-01   -3.742324882104434e-03   -1.777975746115823e-02   +1.164843806559732e-01; +2.125250525194078e-01   -2.233565386324673e-01   +1.875586814881722e-01   +4.608134052045664e-01   +2.953973831915321e-02   -1.957716958256231e-01   -4.493875646488359e-01   +2.318823121154598e-01   +1.255177147020902e-01   +1.776845810880747e-01   -1.022314386769861e-01   -1.038739742124968e-01; +2.012202115847797e-01   -8.033022324394801e-02   +1.644304938735613e-01   -2.062017310220816e-01   -2.918918827313942e-01   -1.159031563882823e-01   -2.551475304569810e-01   +4.894591848240342e-01   +2.101576871609151e-01   -1.948335681673996e-01   -1.400278286931383e-01   -3.915937131212505e-02; -2.887760923993647e-02   -1.514662824849832e-01   -1.440798452996052e-01   +1.656679906814415e-01   +1.404609906532560e-01   +4.288225417435029e-01   +1.822901670744421e-01   -2.045654366588940e-01   -5.684807643677064e-02   +1.151001247110543e-01   +3.061287182680644e-01   -7.239403224206341e-02; -2.531113358854417e-01   -4.252404892717320e-01   -3.526381162552679e-01   -3.475829626723415e-02   +1.875254619418698e-01   -1.383053479176428e-01   +3.460304159168294e-01   -2.492244526831717e-02   -2.237944660620941e-01   +1.942002863256028e-02   +3.992403919365253e-01   +2.660980524246923e-01; +2.161423738171984e-01   -1.918523186883569e-01   -1.826372852468078e-01   +4.718147695590330e-02   -1.087930844151564e-01   +2.360131086520859e-01   +9.195398849912925e-02   -1.551237700343980e-01   -1.060662513582014e-01   -3.411506768666360e-01   -8.557528569805753e-02   +1.016816034892344e-01];
L2E_Input1_iAMPA_netcon = [-2.234512031150580e-01   +9.781731451047820e-02   +3.617593125116604e-01   +1.993827130713502e-02   +3.318031872396863e-01   -1.701291237130675e-01   +9.678894162198762e-02   +3.981585508115710e-01];
L2I_Input2_iAMPA_netcon = [+1.070086804916343e-01   -1.858423074030556e-01   +2.612214398194324e-01   +2.578199075273510e-02   -4.086198262258872e-01   +1.975499158416471e-01   -2.389391486971209e-01   +8.231850857015696e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
