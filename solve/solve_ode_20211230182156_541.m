function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.293025410610643e-01   +5.632968293521935e-01   +4.960179343589820e-01   +5.057071790927862e-01   +4.022578187909715e-01   +7.089337130339984e-01   +2.287291933012416e-01   +4.368538479764023e-01   +8.872135739255045e-02   +2.970200998365751e-01   +3.120119329747274e-01   +7.696408655682860e-01   +6.642799242462933e-01   +5.403287229239819e-01   +4.615560939712057e-01   +2.251894362092226e-01; +1.078312945436646e-01   +2.663695593862688e-01   +9.580881328885879e-02   +3.608755930358530e-01   +7.154500381226430e-01   +3.827086916245097e-01   +1.309699878435692e-01   +2.372769873019572e-01   +2.275527156402565e-02   +1.963120833948273e-01   +4.306262487646701e-01   +4.267874236688340e-01   +1.188851478041056e-01   +5.733237525256984e-01   +2.488735134390485e-02   +9.251153748438244e-02; +5.314914858633876e-01   +2.117865097683109e-01   +3.982936888866690e-01   +1.714360218980353e-01   +5.137730302854464e-01   +7.573860619682189e-01   +6.167583302767290e-01   +1.237809144799390e-01   +2.088830852133360e-01   +1.214795672516127e-01   +7.824422635865163e-01   +4.951871844769490e-01   +3.356698995056835e-01   +2.678858497513179e-01   +3.960525684830969e-01   +5.070058254732922e-01; +5.608091119308767e-01   +1.720586313442379e-01   +1.923133217562988e-01   +1.617871757882021e-01   +3.125141159815307e-01   +6.020113374729880e-01   +8.897797990689416e-02   +7.157679291148286e-01   +6.189962156340627e-02   +4.042173089087771e-01   +8.717462341243382e-02   +7.813456396927941e-01   +2.776532278325518e-01   +7.962737484967383e-01   +4.595929304490015e-01   +4.150302201744924e-01; +3.382274764722868e-01   +2.879610369828128e-01   +7.616069000940373e-01   +3.610538177497959e-01   +7.621027144889800e-01   +6.549126886541339e-01   +6.816405051542702e-01   +5.734171330797954e-02   +3.741424707968669e-01   +1.406927813729055e-01   +5.889691621084862e-01   +4.038887597620159e-01   +4.742070302011947e-01   +1.342983487752454e-01   +2.539181147600158e-01   +3.755816367203945e-01; +3.238447832580059e-01   +1.603958451744874e-01   +4.651306348021347e-01   +1.507886787592556e-01   +5.698819698843228e-01   +2.753612403426056e-01   +1.299546011395367e-01   +2.497114242587668e-01   +1.475191630288417e-01   +5.212552111643597e-01   +2.283867571138523e-01   +1.969156529506525e-01   +5.869347252590523e-01   +4.093142604086684e-01   +1.503573198592998e-01   +7.481270202589976e-01; +2.971562662809131e-01   +6.350610235106402e-01   +2.599155483435491e-01   +2.699727867832089e-02   +7.758227229557796e-01   +3.129289791560339e-01   +3.371695465299709e-01   +6.007841897362658e-01   +5.220438298123059e-01   +2.726078122545203e-01   +7.876919539340660e-01   +2.064899518140176e-01   +1.559612637522755e-03   +1.403382632223308e-01   +5.610041319461111e-02   +5.936183927702514e-01; +5.392229748610634e-01   +3.503948789691786e-01   +7.853785370100923e-01   +4.418360722168115e-03   +3.025646670574792e-01   +7.339473874342192e-01   +1.140296466194870e-01   +5.410580445412473e-01   +1.651202632535725e-01   +2.860906161953912e-01   +6.678953556781765e-01   +4.274569713215324e-01   +4.696724492011051e-01   +4.920154485383028e-01   +4.297004479547301e-01   +6.163324644346544e-01; +6.835162585742883e-01   +2.843980430525825e-01   +6.205507585951979e-01   +1.456199994665983e-01   +4.692494507181420e-01   +5.375573942283151e-01   +6.293087459984859e-01   +2.529750590857551e-01   +6.057094367340999e-01   +2.677099373187207e-01   +1.136196810100471e-01   +7.035284194553307e-01   +7.495361044394913e-01   +6.120026650051045e-02   +4.748549101931623e-02   +6.625165430442065e-01; +6.778622294361506e-01   +5.005903991318812e-01   +2.318476279058864e-02   +4.067326843591137e-01   +2.917760885076082e-01   +3.787825426911698e-01   +3.743245242006919e-02   +7.423433499192869e-02   +2.439678215752662e-01   +6.061876067863912e-01   +2.313760805006478e-01   +6.732423069825065e-01   +4.614266400904531e-01   +3.125540768103411e-01   +2.098346022475049e-01   +2.936687824628725e-01; +6.151995481367212e-01   +5.098308843332791e-01   +5.618533193642056e-01   +5.960810618357108e-02   +6.881679020015687e-02   +6.657347877935454e-01   +5.299456216110058e-01   +7.525217578335334e-01   +2.703101368245109e-01   +5.985966876424487e-01   +7.038063330623661e-01   +1.845466952015590e-01   +3.541928871694903e-01   +6.477576526020915e-01   +3.734951868136248e-01   +2.315761236809479e-01; +2.071908076693345e-01   +3.564551169344152e-01   +6.990809494679197e-01   +2.919466517059854e-01   +1.322817014604340e-01   +7.806568683498325e-01   +1.888535504477040e-01   +2.861912406251549e-01   +5.263540300627018e-01   +7.530523616227627e-02   +6.625623798027949e-01   +3.973865610057125e-01   +7.944603071229746e-03   +3.638666022079987e-01   +4.632949007005196e-01   +6.660780036956013e-01; +2.414724058431951e-01   +7.381471636649251e-01   +3.987823295749227e-01   +2.792411579474502e-01   +4.749726039764822e-01   +5.711287444448461e-01   +6.218607268779444e-01   +7.761175738502593e-01   +1.675781304557104e-01   +6.488821835002338e-02   +4.701005193540512e-01   +8.302156252501398e-02   +4.434127716872127e-02   +2.551819759338035e-01   +7.793747545601372e-01   +6.531976829939578e-01; +2.357527858252473e-01   +1.927889345515054e-01   +7.706809293455776e-01   +3.984618347189463e-01   +8.004866638016075e-02   +9.564586297893858e-02   +2.790884944467767e-01   +5.488234597498558e-01   +5.342369049232465e-01   +1.053545623418565e-01   +3.163143836661103e-01   +5.411336902714314e-01   +6.802217778022327e-01   +1.110204591242929e-01   +7.175048288507214e-01   +7.096034201067659e-01; +4.371853786531366e-01   +3.526801253432804e-01   +1.047851700988532e-01   +7.834441891265376e-02   +4.788740837181417e-01   +3.841856871729815e-01   +1.266613865994562e-01   +1.898273825151275e-01   +5.066025709358444e-01   +1.096708290989868e-01   +6.784741655417639e-01   +3.794532491395712e-01   +2.568539427086398e-01   +4.911171865204984e-01   +6.366859475762254e-01   +3.756683287917060e-01; +7.675517729993734e-01   +2.244583942587130e-01   +2.170372614020832e-01   +6.825077884418433e-02   +3.216804263737376e-01   +3.377211506729805e-02   +3.458414941991705e-01   +2.180280470543429e-02   +1.007262925846207e-01   +5.194563227782918e-01   +4.292132930280587e-01   +7.001408022469409e-01   +4.951049860087271e-02   +4.533787599903654e-01   +7.930810271064608e-01   +4.868000364413785e-01];
L1E_L1I_iGABA_netcon = [+7.546339522857787e-01   +5.683609006790862e-01   +5.870073692151674e-02   +3.668220725276426e-01   +7.152019493510967e-01   +3.518980236323681e-01   +3.420979589269794e-01   +1.015865061656596e-01   +1.532709658737612e-02   +4.707973932774144e-01   +1.289065316963460e-01   +4.655968038056345e-01   +4.026706176203474e-01   +5.672033383900484e-01   +1.960768827969017e-01   +7.118460056419275e-01; +7.496086327703874e-02   +5.178893647440094e-01   +3.546445325708379e-01   +5.840005325291582e-01   +6.456270632176968e-01   +2.229337295940160e-01   +5.361864652028701e-01   +2.538992678396242e-01   +6.558884342874131e-01   +2.439663296045935e-01   +4.659588762682064e-01   +7.618812293510411e-01   +3.902629467882446e-01   +6.842457919277610e-01   +2.120100755488390e-01   +5.940607370063553e-01; -4.465113989871353e-04   +3.851670025029338e-01   +3.452977996837773e-01   +1.849965097940597e-01   +5.200943996717639e-01   +3.583343630942949e-01   +9.706044260862851e-02   +2.997436294432841e-01   +3.486811556016205e-01   +4.223020042128039e-01   +2.307667827889623e-01   +4.661730978319762e-01   +3.412448763854493e-01   +4.838624874051582e-01   +7.551491208960991e-01   +1.842074582606595e-01; +1.428275922473961e-01   +3.443563433803460e-01   +2.003842745450521e-01   +2.253607192343159e-02   +6.905267560165081e-01   +4.381603284451557e-01   +4.215887850830696e-01   +3.126183835338045e-01   +5.216853120646350e-01   +1.309485359005124e-02   +3.639069841056777e-03   +4.816031388796254e-01   +5.341013292979160e-01   +6.430124667232882e-01   +7.377060069417140e-01   +5.164216773727982e-01; +3.231218995809864e-01   +2.268235681478225e-01   +5.727759978530503e-01   +1.973977769416848e-01   +5.476296228771710e-01   +7.248444190949532e-01   +4.817576513067591e-01   +1.429663761116418e-01   +3.795769110365355e-01   +6.131632161583283e-01   +4.387798399083057e-01   +6.451748452229640e-01   +1.152258083743478e-01   +3.069749370714475e-01   +3.997119897459812e-01   +6.285656133105841e-01; +8.205192296082080e-02   +9.063617919369905e-02   +7.002241017754887e-01   +7.641475955687399e-01   +5.336120500127034e-01   +1.348102630462983e-01   +5.498377767172739e-01   +4.920441801111634e-01   +1.698765315434336e-01   +3.622110783192695e-01   +9.453200211889227e-02   +1.071365353178172e-01   +1.111482838781545e-02   +7.889480499403764e-01   +4.829246107054337e-01   +2.370609129116559e-01; +5.780476022142939e-01   +4.872851464234793e-01   +9.293374824098942e-02   +3.942757383509375e-01   +7.249665457996243e-01   +2.458029068893610e-01   +1.728714238035116e-01   +3.746884483407918e-01   +8.753661571721394e-02   +3.573597296833172e-01   +5.897268983309869e-01   +7.413224272521540e-01   +6.600575824189497e-01   +2.429514809883583e-01   +1.326597850376349e-02   +7.510044742322389e-01; +6.330898886504288e-01   +7.709559319724637e-01   +5.519557158799278e-01   +5.501096672726373e-01   +8.725251979146180e-02   +3.169116824578111e-01   +5.387794264693484e-01   +2.481713590783241e-01   +6.133727932170555e-01   +1.775498430549581e-01   +4.831293156294603e-01   +2.627826073903638e-01   +1.225431095984168e-01   +4.287703767820910e-01   +2.715486429983208e-01   +5.338344454023460e-01; +2.161757696643014e-01   +1.148928441279705e-01   +3.615607834969625e-01   +6.412439744667289e-01   +3.340298163905471e-01   +7.646721839172741e-01   +2.535592800341503e-01   +7.407342632584956e-01   +2.437094137269217e-01   +2.598139385387799e-01   +2.483538882235045e-01   +5.493056506192427e-01   +5.109460133447215e-01   +3.774586697856139e-01   +4.682525552016061e-01   +4.593392021394216e-01; +7.837280519344423e-01   +4.058412830224548e-01   +7.731029174040147e-01   +7.841237408402536e-01   +7.521049252928560e-01   +1.241572822103258e-01   +5.754964360051189e-01   +7.722946665006866e-01   +5.676289007628135e-01   +3.357174034164417e-01   +5.169010949580158e-02   +2.180425932881137e-01   +2.491521084688961e-01   +1.601583908590913e-01   +7.331652463180320e-01   +4.449125297485572e-01; +5.602617459912571e-01   +5.297728914392191e-01   +2.001095884941602e-01   +4.610540847900766e-01   +2.394147872890949e-01   +2.953609602945992e-03   +5.781223722357886e-01   +4.278576953874477e-01   +7.647275821878262e-01   +5.561123075226901e-01   +2.783847378548315e-01   +6.450427780814428e-01   +2.678655554623333e-01   +1.403151177342502e-01   +5.188536898818641e-01   +1.996955022432763e-01; +6.520129401243361e-01   +6.211151889685409e-01   +1.678900755278188e-01   +7.022665477289643e-02   +3.652561154740744e-01   +7.515694898758885e-02   +1.069509048184943e-01   +5.988991408311582e-01   +5.714537007640468e-01   +6.471902606994280e-02   +1.260195263688061e-01   +4.993080115853725e-01   +4.690053359198751e-01   +6.610262976167589e-01   +3.998868251370560e-02   +2.366071205147690e-01; +3.359479387107469e-01   +7.547802433557645e-02   +4.544377435272443e-01   +7.742936065481369e-01   +4.388986242324056e-02   +8.516365741050312e-02   +7.985768905963547e-01   +7.113293894074834e-01   +2.185031433894117e-01   +6.901429453451605e-01   +5.056848492500908e-01   +6.424722764754388e-01   +1.581063716489178e-01   +6.160711466707948e-01   +7.963180560307181e-01   +5.447688953473133e-01; +4.392274422386950e-01   +4.610689019807542e-01   +6.375684369195599e-02   +2.837968593009173e-02   +1.012835856331961e-01   +9.018958055785056e-02   +1.366451991360140e-01   +1.017085845942438e-02   +1.270741514415321e-01   +3.757855712076283e-01   +2.608210961524983e-02   +2.356154630873728e-01   +7.592550915282419e-01   +6.718100319852098e-01   +6.958927955966245e-01   +5.448718959290971e-01; +1.753360394889897e-01   +7.470646764520138e-01   +4.309900658803476e-01   +3.816222694274554e-01   +4.351682543834512e-01   +3.710927037300650e-01   +7.888675666395994e-01   +2.241498868326148e-01   +1.653801484694581e-01   +6.858370805171661e-01   +4.013160422379337e-02   +1.996224341346167e-01   +4.113530293383240e-01   +1.899270297579593e-01   +2.287477175779203e-01   +2.094865844859277e-01; +1.410377984493795e-01   +5.750095061709251e-01   +6.252333315646688e-01   +3.551916396589777e-01   +1.958787894630699e-01   +4.915009955637661e-01   +5.478138295865914e-01   +5.295191759991480e-01   +5.257622687676133e-01   +6.442863179757459e-01   +3.512214079256136e-01   +2.780323539536144e-01   +1.788916497415249e-01   +6.316863763608058e-03   +7.371250658748315e-01   +4.574588436037160e-01];
L2I_L1I_iGABA_netcon = [+5.992885554681366e-02   +5.914139006790249e-01   +1.570692798790571e-02   +6.510710096062419e-01   +3.891356949024583e-02   +6.176374077683917e-02   +2.778781617501432e-01   +2.483091314545400e-01; +5.663435620916212e-01   +3.851439030719592e-01   +3.227403945855903e-01   +4.473589777965555e-01   +7.123253822818745e-01   +4.426285026352628e-01   +2.516398961532437e-01   +3.288305307928228e-01; +4.358202834606393e-01   +6.572412615583388e-01   +4.398728517308534e-01   +1.566536631339793e-01   +4.551734737091283e-01   +2.359030229572886e-01   +7.930732530088223e-01   +2.010913073412663e-01; +6.286000558644258e-01   +5.643350279567894e-01   +5.018418958956337e-01   +4.638136774320061e-01   +1.558320455617724e-02   +3.648192914132597e-02   +6.269165670435239e-01   +1.079347038053321e-01; +1.418142971854350e-01   +3.098023325299317e-01   +1.809223875668109e-01   +5.774497637091572e-01   +7.307361581069713e-01   +5.599660276672150e-01   +3.652101376900532e-01   +6.207940931214302e-01; +3.852841708009997e-01   +1.825376502567052e-01   +4.953015647406180e-01   +4.027044174236084e-01   +3.201608690958700e-01   +3.858049122143201e-01   +5.294689759946193e-01   +5.510626296841196e-01; +1.804074082280024e-01   +1.177274391360100e-01   +7.218869927408371e-01   +3.379462083854398e-01   +6.242267385291937e-01   +2.301088612071776e-01   +5.051662312910699e-01   +8.513040903772663e-02; +6.867291535841045e-01   +3.304111151361789e-01   +5.833344710379631e-01   +3.314714489918805e-01   +2.453101684413131e-01   +7.241456687700522e-01   +2.724871845777262e-01   +8.102759496029087e-02; +5.458031098783045e-01   +1.102338295753817e-01   +4.544738479780837e-01   +2.763945645931714e-02   +6.650367705351925e-01   +4.420881205488208e-01   +3.604052627535931e-01   +5.057647288183583e-01; +3.062916628792508e-01   +4.814245219125839e-01   +7.926156870507491e-01   +2.978102961832566e-01   +6.452915005535822e-01   +5.329034610298456e-01   +5.908508629511759e-01   +5.018447541432277e-01; +7.363948062251586e-01   +1.677127051398923e-01   +5.850719868351796e-02   +5.924964129504735e-01   +3.747799407370244e-01   +4.267665834676578e-01   +6.997208710338114e-01   +5.380276747470578e-01; +1.875458635670089e-01   +3.346973930371069e-01   +1.835485515114271e-02   +5.560668221037606e-01   +2.315159374883494e-01   +1.816800744874188e-01   +3.712271357893108e-01   +4.421445382631917e-01; +4.747968385385038e-01   +3.032183257946577e-01   +7.128177487061100e-01   +1.648322931361971e-01   +2.894916736344571e-01   +2.970589317238793e-01   +6.287005159797491e-01   +1.284744772742742e-01; +4.785977542269720e-01   +1.373390773270773e-01   +5.860783681002562e-01   +6.012761744801634e-02   +5.762407237934900e-01   +4.539454860544707e-01   +5.451070762770771e-01   +5.070047430665345e-01; +2.823715642071704e-01   +6.414297089520776e-01   +2.972573132829241e-01   +1.462495045348307e-01   +2.984635684735242e-01   +6.314680205691255e-01   +2.216920742446393e-01   +2.456786879877934e-01; +6.417142549683210e-01   +4.476349549642611e-01   +5.253561496368083e-01   +6.739114493321129e-01   +9.182651801040527e-02   +3.952288608341548e-01   +5.255835105555339e-01   +3.336421225933956e-01];
L1I_L2I_iGABA_netcon = [+5.935244824616909e-01   +3.315265466177704e-01   +2.898065649736201e-01   +6.875588313664536e-01   +6.982125900645715e-01   +4.027427458689464e-01   +2.333715098796400e-01   +2.798207627067692e-01   +7.786342293160459e-02   +3.158971857895757e-01   +6.382087377164717e-01   +5.681581234433171e-01   +7.820382458925487e-01   +6.167590514330790e-01   +5.455208816901270e-01   +1.100228445509762e-02; +3.898625882330310e-02   +1.984658969621101e-01   +3.613214716636112e-02   +2.522065681679412e-01   +2.724957927407191e-01   +1.082167065021971e-01   +4.577764374928560e-01   +2.269453060965198e-01   +2.128688760437897e-01   +3.119949563450724e-01   +3.496507275055448e-01   +2.125487170292753e-01   +2.339669981535636e-01   +8.107624902818887e-02   +1.881038724184559e-01   +5.270399647114700e-01; +1.822818540574742e-01   +5.211443313546024e-01   +3.792399400538549e-01   +5.579557947870213e-01   +4.086018756829697e-01   +5.502461673578369e-01   +1.298845001552023e-01   +9.003049473260162e-02   +7.713610066994202e-01   +4.962073154205910e-01   +2.825139654306340e-01   +2.771303145107936e-01   +5.529772757448070e-02   +3.126810483996739e-01   +1.007616107469906e-01   +7.099376729037857e-01; +8.845460215951328e-02   +5.295159321503717e-01   +8.162352619748842e-02   +1.327986261198453e-02   +2.835069781988499e-01   +6.464845549150495e-01   +3.874539311274626e-01   +5.501279331558824e-01   +1.497303393796095e-01   +8.224248738720460e-02   +7.045021369304303e-01   +2.786757088899907e-01   +6.954845900033757e-01   +2.215518719963367e-01   +7.765154184695926e-01   +2.453604563461939e-01; +2.444959963610633e-01   +7.574323079892784e-01   +7.621827542104732e-01   +5.613624526004772e-01   +5.931644216233652e-01   +4.062115736800456e-01   +6.231202904919582e-01   +7.422555864582981e-01   +7.455889402739824e-01   +1.171805494335724e-02   +6.773114199893032e-01   +4.587775608616627e-01   +4.647311662299293e-01   +1.249822050184611e-01   +1.832236392034380e-01   +8.500993915534417e-02; +7.261594360930188e-01   +7.646572698020933e-01   +7.691574333744612e-02   +2.247997472143926e-01   +4.969430758691151e-01   +3.388568912424433e-01   +7.747473511913925e-01   +4.311777542771648e-01   +4.685979671712303e-02   +2.151780867052580e-01   +3.665040052616760e-01   +2.601503333044021e-01   +6.916671758869822e-01   +6.984727797364799e-01   +3.957763941202986e-01   +2.403682576065680e-02; +5.056479727104420e-02   +7.546901505767980e-01   +3.144027199679012e-01   +2.147194412433434e-01   +4.609828361042116e-02   +3.711095599203464e-02   +7.392441920638664e-01   +6.478809821051623e-01   +5.026971458091768e-02   +6.093125885508477e-01   +1.399851739601918e-01   +3.967711934453252e-01   +7.043648168422746e-01   +3.018895361216625e-01   +7.928899610868950e-01   +5.312623977050392e-01; +6.374986574271782e-02   +2.174735382287035e-02   +3.973556123951572e-01   +7.392591153289504e-01   +8.270411766039111e-02   +4.690361606586420e-01   +4.953489084356797e-01   +2.300162239848257e-01   +1.283676252975555e-01   +3.877123499097906e-01   +6.580737173018542e-01   +3.534758379311331e-01   +4.818429012367445e-02   +5.163975098998107e-01   +4.121751578125715e-01   +2.870678942633944e-01];
L2E_L1E_iAMPA_netcon = [+6.602282152590404e-01   +4.528743357945666e-01   +4.581164200546441e-01   +5.852777669002954e-01   +3.581847667520162e-01   +3.703778075261117e-01   +4.210983837121572e-01   +4.286959007451630e-01; +5.387606575113225e-01   +4.631524515167462e-01   +6.056655957614778e-01   +2.994135580290035e-01   +5.604490174419492e-01   +6.024932544389694e-01   +2.353067279371437e-01   +7.669205651224777e-01; +4.495141474723420e-01   +1.819215398572195e-01   +5.004061650640813e-02   +7.897600488185492e-01   +2.951947784406463e-01   +1.629848996892261e-01   +3.279422697587335e-01   +5.171195741720310e-01; +3.966092323118860e-01   +1.562307337611275e-02   +4.553119593308307e-01   +1.499639750252139e-01   +3.344767122191027e-02   +3.780013101927397e-01   +4.924949019681742e-01   +4.157431217922488e-01; +7.988705899530730e-01   +5.647531887697619e-01   +6.216862401184493e-01   +4.123710775832130e-01   +3.583454629066037e-01   +7.513236168378019e-01   +4.535417098468753e-01   +1.995389528093910e-02; +4.632248759609128e-01   +2.298043601555492e-01   +6.377562380229085e-01   +6.596201576634185e-01   +3.393601900286249e-01   +2.229971342831852e-01   +2.978839131467179e-01   +2.854945856696328e-01; +3.692636789523964e-01   +4.687178490982172e-01   +3.335102994639284e-01   +6.581617258561054e-01   +2.447598347172553e-01   +6.978725705550597e-01   +2.584155628000339e-01   +5.679070581590979e-01; +6.113173389905113e-01   +5.837361501783581e-01   +7.437027881045297e-02   +2.092705497133318e-01   +5.897686098878739e-01   +3.479923484206395e-01   +4.549933193817942e-01   +5.781972115303823e-01; +4.568800573902232e-01   +1.843230018159871e-01   +5.825707555355556e-01   +1.503296464012072e-01   +5.961216226881644e-01   +5.121122374942357e-01   +3.922107949027650e-01   +1.556899854603936e-01; +8.332272866722069e-02   +4.015064143912146e-01   +2.027945472378954e-01   +6.456077459486882e-01   +1.003594115765003e-01   +4.578957614576087e-01   +6.588808102680070e-01   +3.337395887356824e-01; +2.672284212169194e-01   +1.807528849714791e-01   +1.171513260018650e-01   +8.375870905355064e-03   +3.290925489293615e-01   +4.986878664464565e-01   +1.869138595209513e-01   +5.700208295513493e-01; +9.203391461048117e-02   +3.043275796306432e-02   +6.516404169379709e-01   +7.232636873865956e-01   +2.844667381537300e-01   +6.195370155743832e-01   +2.936720859299471e-01   +5.769456683551645e-01; +2.319610702628631e-01   +3.713697106461232e-01   +6.663971972691802e-01   +3.870337845506493e-01   +7.389401765557880e-01   +2.411571954731171e-01   +5.412441593798720e-01   +4.200591770476373e-01; +7.377986454253584e-01   +3.322106680449231e-01   +2.948877144429314e-01   +7.469158716745415e-01   +7.285737193696774e-01   +9.700100444326709e-02   +3.677719055543600e-01   +1.069976659863987e-01; +3.788438572670782e-01   +3.840376698472304e-01   +6.849957151763202e-01   +4.109457793864217e-01   +1.001048378581327e-01   +1.591264301553896e-01   +3.766787123415465e-03   +1.613387242470846e-01; +6.735414459003098e-01   +6.351984178405662e-02   +1.992630926498825e-01   +6.227001542625470e-01   +3.126627683966725e-01   +2.817973871841966e-01   +6.495287394580744e-01   +2.214641066425980e-01];
L1E_L2E_iAMPA_netcon = [+4.587712405584462e-01   +2.581835803169359e-01   +2.008789645242497e-01   +5.918802043506823e-01   +2.053941430172968e-01   +7.733289682394743e-01   +6.716824815684512e-02   +4.816778185525367e-01   +3.336003379517584e-01   +7.176775622816299e-01   +3.492351220030097e-01   +7.731046759719195e-01   +6.147273224532531e-01   +2.377299289379223e-01   +4.192185093825628e-01   +5.585854466436991e-01; +1.121059351930772e-01   +2.064302933912243e-01   +7.257495711603730e-01   +7.655227204194837e-01   +5.949127461912592e-02   +3.352165674753867e-01   +5.980237663264560e-01   +3.706859329911202e-01   +7.328786075966817e-01   +1.729334246558407e-01   +6.430490067813327e-02   +3.136320770974036e-02   +7.446169354633715e-01   +7.942593933852313e-02   +5.283876674139144e-01   +5.691127866663214e-01; +6.736495203733852e-01   +3.124002149609291e-01   +5.693974397580516e-01   +4.025073752940889e-02   +7.788366646613846e-01   +7.392646275191367e-01   +2.439327069589222e-01   +6.998212134590670e-02   +7.510012651953224e-01   +1.745866943511442e-01   +5.344156235410893e-01   +4.646839483872419e-01   +4.935868041101331e-01   +4.390207579414042e-03   +6.644621574687176e-01   +2.748381035045928e-01; +2.659634993112903e-01   +5.679811815450556e-01   +5.435323768411033e-01   +4.434573967357081e-02   +3.914408547853179e-01   +4.256910298645084e-01   +2.680605711942414e-01   +5.947027268598432e-01   +6.299965319998018e-01   +3.072771200216838e-01   +7.186521344092200e-01   +2.244085612495527e-01   +7.853367577746069e-01   +2.570844950190810e-01   +4.408013747224523e-01   +7.387101128987875e-01; +5.847996536855985e-01   +7.955592513664741e-01   +1.248820202908173e-01   +1.443716596104018e-01   +2.199104649486293e-01   +6.195807716525665e-01   +1.752186712057280e-01   +1.126625504782642e-01   +5.541680083563175e-01   +4.381969371023872e-01   +3.824658065737598e-01   +3.239069235305011e-03   +5.232833487349161e-01   +6.770968809235671e-01   +2.354578876696611e-01   +6.130415264363825e-01; +9.608297075881239e-03   +3.006040524603134e-01   +8.423016393067895e-02   +6.610398559049739e-01   +5.893726478485439e-02   +3.576247855980996e-01   +6.957551582812304e-01   +4.621355343368030e-02   +1.475992216344335e-01   +6.470478853644441e-01   +6.137391359076063e-02   +1.267173303165480e-01   +6.617507027610890e-01   +3.889857280693607e-02   +7.222653096738327e-01   +1.546182893953691e-02; +2.727360901082493e-01   +1.858001841620206e-02   +7.185533695647881e-01   +3.909483902495403e-01   +2.084483937932736e-01   +6.318839089555018e-01   +5.661049792925580e-01   +2.571817171900055e-01   +6.994289963466938e-01   +2.441830166882767e-01   +2.594427304145184e-01   +3.736021640555525e-01   +1.146835347859485e-01   +6.160690742896965e-01   +2.604072137271342e-01   +6.069233902181076e-02; +5.808372030848780e-02   +6.143655068777186e-01   +3.843188781833393e-01   +7.676406877327363e-01   +9.792736316326819e-02   +6.621638363821867e-01   +4.838052871550348e-01   +3.376414980045088e-01   +5.623703134263623e-01   +7.612929183162261e-01   +3.940186934109245e-01   +8.905617182365426e-02   +3.381874667172268e-01   +1.481630889759988e-01   +2.839384273126367e-01   +2.057472346145089e-01];
L2I_L2E_iAMPA_netcon = [+2.897846266034522e-01   +3.205283190363340e-01   +2.785001848124851e-01   +3.993277919374682e-01   +1.290453697787760e-02   +6.414325378431482e-02   +5.538022422276119e-01   +3.969468310203375e-01; +3.926730726561741e-01   +5.698120860568534e-01   +7.762920227262785e-01   +6.044111211825027e-01   +6.290129555356996e-01   +5.086005189527547e-01   +6.094275754321804e-01   +3.534293232702051e-01; +6.111914475397732e-01   +7.721701982966616e-01   +4.353514510039705e-01   +1.873691183718776e-01   +2.061061605376357e-01   +3.758877260520682e-01   +5.168477499442152e-01   +5.911483740438911e-01; +7.882253882932584e-01   +3.886627771261831e-01   +2.304056079588574e-01   +9.195233533946844e-02   +7.049012455956712e-01   +4.018776182714984e-01   +4.508500132307162e-01   +2.962977378834762e-01; +3.553986962525946e-01   +7.148126804849180e-01   +2.385883100183303e-01   +5.866853612741736e-01   +7.963524512470419e-01   +7.325562287094018e-01   +5.545184752037062e-01   +4.995286641182544e-01; +5.916404011969549e-01   +1.626078798105837e-01   +2.212157883002999e-02   +2.659458929921643e-01   +2.672065925163287e-01   +3.978989753654987e-01   +1.079412952413137e-03   +4.942114876572543e-01; +5.402419249367312e-01   +2.949000286436271e-01   +4.317904474622046e-01   +7.558381959066863e-01   +7.387973148737541e-01   +7.445979921478386e-01   +1.620900442656237e-01   +7.481567241913524e-01; +5.290242944323642e-01   +5.694183999597416e-01   +1.405681676612791e-01   +6.872843630935714e-01   +3.939214590179519e-01   +4.184649090209505e-01   +2.645915008045645e-01   +1.944382386155568e-01];
L2E_L2I_iGABA_netcon = [+4.822231333594176e-01   +1.053722061439942e-01   +3.355325418103333e-01   +3.641708552370830e-01   +6.542579256417306e-01   +4.240277415018649e-01   +1.032853752947581e-02   +5.593892374515708e-01; +3.482543439815488e-01   +7.174099332349795e-02   +6.376221917951134e-01   +6.590357902860177e-01   +1.919893313132945e-01   +3.894354642968397e-01   +7.626163120183423e-01   +2.996568956788142e-01; +7.505971887079684e-01   +4.184904427937048e-01   +3.786463267470589e-03   +2.124410802420949e-02   +5.636187425081803e-01   +4.603455844778299e-01   +5.388080147850353e-01   +2.241300745027770e-01; +1.682359635711410e-01   +7.966951150448438e-01   +5.895243212390582e-01   +6.466986883122178e-01   +4.978203016366744e-01   +5.741153829799348e-01   +4.231554950515152e-01   +4.802081537092556e-01; +6.979896988150537e-01   +6.396435008524651e-01   +1.156827430398217e-01   +5.313606255013092e-01   +5.519340140563364e-01   +2.637286777224617e-01   +2.766802695219440e-01   +4.288788552290456e-01; +2.731577607967151e-01   +7.064006428817061e-01   +4.063423603749949e-01   -5.507546853649145e-04   +1.933352624080303e-01   +9.617002271757415e-02   +3.415768737259314e-01   +4.386271767216074e-01; +6.735444872509856e-01   +6.520751327901207e-01   +7.526096192359487e-01   +5.625315078773891e-01   +4.288241583721507e-01   +5.054805639844635e-03   +1.858389975713111e-01   +3.940522586478903e-01; +6.501913957615356e-01   +4.464480330295801e-01   +7.671924548597174e-01   +2.608728214356977e-01   +1.269516660296674e-01   +5.445724464836035e-01   +3.337057531985528e-01   +4.304446736467822e-01];
L3E_L2E_iAMPA_netcon = [+4.430061132608627e-01   +5.735727273804484e-01   +6.661181146067136e-01   +2.531816504036672e-01   +3.868588362689425e-01   +4.735724044648425e-01   +6.832624915459101e-02   +1.004791853783682e-02   +7.867218564313423e-01   +5.315649491384864e-01   +4.768465610407418e-01   +1.836396723304401e-01; +7.366456207321729e-01   +5.815903443963175e-01   +3.095187313553441e-01   +3.824245359469240e-01   +3.902213011549011e-01   +9.179406312564824e-02   +7.473951217325581e-01   +6.495157031293474e-01   +3.928074344745244e-02   +6.752071197267751e-01   +7.663513436210900e-01   +5.310709228421095e-01; +6.180458893873547e-01   +6.000903169121372e-01   +4.353831031970548e-01   +7.886720879981604e-01   +2.634189600027981e-01   +5.597386704907970e-01   +3.762663848078323e-01   +7.543723543882614e-01   +3.130531573671765e-01   +3.358478635745482e-01   +6.440029612333481e-01   +4.881530126342985e-01; +3.684381695229204e-02   +6.300559493258250e-01   +5.606484043058505e-01   +4.500643617595534e-01   +5.801864529235377e-01   +6.197375369489341e-01   +5.018916567427084e-01   +5.780031637225322e-01   +4.153961902720575e-01   +2.171114110694962e-01   +4.632064823198444e-01   +4.468027944698319e-01; +2.226913521703434e-01   +4.750536083239941e-01   +5.446616840858690e-01   +4.696160000055514e-01   +6.248246056914963e-01   +5.743158080553935e-02   +6.846513046767275e-01   +4.289184532839682e-01   +4.965605172237031e-01   +2.563375838433284e-01   +5.582874507601165e-01   +5.071034416645035e-01; +3.000371744962031e-02   +6.452227362541267e-01   +3.815296762957680e-02   +6.137461320014618e-01   +3.797668584349836e-01   +6.872337252247652e-01   +2.337591022428284e-01   +2.604920695568706e-01   +3.571220911315921e-01   +6.083946862973936e-01   +3.484081726652559e-01   +1.067975175636743e-01; +1.249740372457409e-01   +2.350812629294607e-01   +4.893848706079529e-01   +3.195232852393829e-01   +6.053660303159875e-01   +6.726676075592688e-01   +2.573948647758306e-01   +2.825076807431005e-01   +1.776191117488918e-01   +7.055682854118127e-01   +2.923213812521717e-01   +2.120924201837869e-01; +2.826397332983155e-01   +5.390660623717883e-02   +4.809587785089486e-01   +6.340508195573769e-01   +4.163740041063269e-01   +6.599743222081135e-01   +6.814511849544660e-01   +5.152091599712267e-01   +7.728815724194502e-01   +3.726119375435354e-01   +7.050368984369259e-01   +6.966496429942420e-01];
L3I_L2I_iGABA_netcon = [+5.974159416902548e-01   +7.389971270269792e-01   +4.449829336362769e-01   +2.454139385219760e-01   +2.726547382635037e-01   +1.917881078435937e-01   +7.183832487628937e-01   +3.892371223606382e-01   +3.095058309386855e-01   +2.111788681432444e-01   +4.485238307479317e-01   +7.759117360989427e-01; +5.864744385870873e-01   +5.686059710329681e-01   +8.263514161770617e-02   +2.432448895807836e-01   +5.767891459405126e-01   +2.851080271278915e-01   +2.367083661990066e-01   +2.733374000085117e-01   +4.861878587801544e-01   +6.987876890381910e-01   +3.996842379789198e-01   +2.169637145911723e-01; +2.372830362261285e-01   +3.543033725347882e-01   +1.437331521403015e-01   +6.519922919573268e-01   +1.696703957024648e-01   +3.573935859111523e-01   +7.994637086087621e-01   +7.567379913654017e-01   +7.867359075020048e-01   +4.288689387858198e-01   +2.541787392619225e-02   +8.971049704972416e-04; +1.547334848056203e-01   +9.138019149815357e-02   +6.979327761933947e-01   +2.428536722806445e-01   +6.065749281080571e-01   +5.619205061106891e-01   +7.410835852178959e-01   +5.417539516393294e-01   +7.139633021547054e-01   +8.382663099486833e-02   +7.589828255932721e-01   +3.624954851607707e-01; +3.711084930427201e-01   +6.914440445902184e-02   +7.791073486794745e-01   +4.393609397891870e-01   +7.984865084396611e-01   +7.302907752231334e-02   +1.578063035559867e-01   +4.696853691766351e-01   +1.201898753281911e-01   +5.845811361015629e-01   +9.365675117698347e-02   +7.364599576464780e-01; +2.698869614038115e-01   +1.293155391459919e-01   +2.463957657412471e-01   +6.291026611676025e-01   +5.694852699424073e-01   +3.871884492293219e-01   +2.157324200240399e-01   +4.549214025834829e-01   +2.954327684848308e-01   +7.658184720217153e-01   +6.345000591903540e-01   +7.000710098611056e-01; +5.526531283292485e-01   +3.114541196396821e-01   +1.131218599407533e-01   +5.909551531450913e-01   +3.791803633423179e-01   +4.761015522784803e-01   +1.116345962563201e-01   +1.414042601130935e-01   +5.883476283853408e-01   +6.248012220151490e-01   +6.604917259802380e-02   +3.279803843593403e-02; +2.594864598292662e-01   +6.074706164158537e-02   +6.309607917241937e-01   +4.206536109641881e-01   +5.274248202652670e-01   +1.280914500287799e-01   +3.879070874330698e-01   +3.270700635972063e-01   +3.448258716674830e-01   +2.462392134159977e-02   +1.671731443661825e-01   +2.469080005202775e-01];
L2E_L3E_iAMPA_netcon = [+2.531250474185878e-02   +4.927383272734755e-01   +3.442141668915348e-01   +2.618931238988081e-01   +4.436899068629981e-01   +4.318925979768676e-02   +8.007153610079160e-01   +1.229616704663351e-01; +6.451643026948723e-01   +5.785870941104514e-01   +5.916674093428970e-01   +5.423198899396781e-01   +6.676017627528845e-01   +1.127758513209915e-01   +3.759290715120223e-01   +3.505509203822950e-01; +1.070642033730219e-01   +3.783481390478777e-02   +4.816073007177464e-01   +6.893245056664709e-01   +4.702322948484374e-01   +1.674017895111322e-01   +4.811134052471866e-01   +1.439004392157938e-01; +4.191259851022361e-01   +4.132065758894300e-01   +6.481457866312332e-01   +6.846465423171811e-01   +3.320308676588941e-02   +2.385597737499676e-01   +5.441239259670374e-01   +7.207468525095009e-01; +4.312825864448532e-01   +7.827312742878133e-01   +7.383782517200197e-01   +4.532521869091480e-01   +6.174750746664539e-01   +2.775763967776309e-01   +7.560849844165513e-01   +9.586018151284513e-02; +6.451506437283940e-01   +5.851954698293040e-01   +3.797340768828259e-01   +3.314770108561790e-02   +1.127109273143794e-01   +3.635432121187688e-01   +7.692454843795745e-01   +6.456754325248720e-02; +1.953271712228237e-01   +3.276036112658699e-01   +2.283068404481731e-01   +6.308045783844053e-01   +7.360957384478776e-01   +5.234557273227403e-01   +6.060387960967308e-02   +6.533743260513890e-02; +4.384803017710572e-03   +9.000085071204807e-02   +6.300362631328519e-01   +4.524240713381526e-01   +3.910659140424964e-01   +6.094702035331366e-01   +9.623566846924397e-02   +8.843394434193899e-02; +1.744002307374490e-02   +6.789526799951814e-01   +1.215664706612879e-02   +2.391145257633449e-01   +2.849183528683928e-01   +2.005777826604622e-01   +2.360172493650307e-01   +2.780811177999949e-01; +6.280986248218591e-02   +2.782315067182790e-01   +2.494558688442081e-01   +5.713854864666016e-01   +6.533963711458581e-01   +1.822921662080564e-02   +7.200174608052469e-01   +6.832139750796690e-01; +1.712153231745576e-01   +4.707458420682541e-01   +5.412094686994564e-01   +5.416150408701804e-01   +6.759528338889906e-01   +7.015920949276494e-01   +5.294137768000510e-01   +6.880968272239203e-01; +4.832955176597642e-01   +2.784096023524299e-01   +7.127691500439599e-01   +4.518780577533756e-01   +2.442542373837255e-01   +5.045896696307631e-01   +2.145703558150739e-01   +7.240486225502876e-01];
L2I_L3I_iGABA_netcon = [+3.355958295967266e-01   +3.801141852541013e-01   +6.034340659427133e-01   +4.993864924371219e-01   +6.484623767886567e-01   +5.908797765199432e-01   +4.200442442274794e-02   +1.182031274727367e-01; +1.402130896830373e-01   +1.926207746842484e-01   +2.878998602678110e-01   +4.856297486409387e-01   +2.004573532822582e-01   +5.755742972083639e-03   +2.493898113610135e-01   +4.627936777715255e-01; +4.505984779020437e-01   +2.388222256681581e-01   +2.888390433895826e-01   +5.462411713619242e-01   +2.783743253254604e-01   +6.681362657531095e-01   +6.852357433683962e-01   +2.995449140337336e-02; +2.379468688893785e-01   +2.539241833902693e-02   +3.219848193397865e-01   +7.690821494687775e-01   +4.899006606635948e-04   +5.441505085786974e-01   +2.840499432234890e-01   +4.871586463927806e-01; +5.669395763468201e-01   +3.740532826773739e-01   +5.506680525145660e-01   +2.760609468362937e-01   +2.658579517681670e-01   +3.263206993345004e-01   +3.218408236212522e-01   +7.740270059415030e-01; +1.134901106143665e-01   +4.054734690915189e-01   +3.158564300146709e-01   +5.086289759023175e-01   +1.513334155614906e-01   +6.593828706864864e-01   +6.140274596866447e-01   +1.839427332902437e-01; +8.704877855113337e-02   +5.414266491054929e-01   +8.480294707036559e-02   +2.997014296058112e-01   +7.533245467680602e-01   +2.257283484391311e-01   +3.173641144677707e-01   +5.800082031058511e-01; +5.513572036793500e-01   +1.698045614800224e-01   +4.972542395946361e-01   +7.274744365347671e-01   +1.853258739810000e-01   +4.204379435073292e-01   +4.904958900096631e-01   +7.350033770265749e-01; +7.314313759786228e-01   +7.305458230145636e-01   +7.481187879564055e-02   +6.721294281041704e-01   +2.808947052292501e-02   +6.760803931718675e-01   +1.955236169609523e-01   +2.070103765055955e-01; +4.243915234904891e-01   +1.459393439826988e-01   +2.184028792450076e-01   +2.564590831137721e-01   +5.207250598235197e-01   +6.224959162296850e-01   +2.592605357816071e-01   +4.922380508637959e-01; +7.362886311565826e-01   +5.632945712160491e-01   +2.227571676404487e-01   +3.651245216575652e-01   +2.088735510506066e-01   +4.739656599767742e-01   +7.654541914779046e-01   +4.581074957101270e-02; +4.895077178956324e-01   +6.242148130048443e-01   +7.716579684715839e-02   +3.773596114028827e-01   +5.518167024777068e-01   +1.925634318145468e-01   +4.436126394662313e-01   +4.769560920819275e-02];
L3I_L3E_iAMPA_netcon = [+7.147170129445946e-02   +5.431376696760848e-01   +2.551936606421970e-01   +4.172788231585912e-01   +6.827726767409886e-01   +4.002464071207952e-01   +2.697477237692361e-01   +3.602667520417887e-01   +3.999403045898890e-01   +4.540716867468566e-01   +3.672056678770573e-01   +3.581406709714928e-01; +1.089515514318059e-01   +7.049540667520901e-02   +6.102094233765262e-01   +5.328429055379120e-01   +3.150930998895946e-01   +5.460121780985159e-01   +6.564800106280990e-01   +1.001837642237857e-01   +3.897649052576722e-01   +5.001218866180985e-01   +6.664840791842189e-02   +5.352497004594265e-01; +6.647228529366337e-01   +2.484423039528505e-01   +7.402361370136392e-01   +6.096876149446439e-01   +2.030211057502218e-01   +7.846209998301868e-01   +6.900413864956743e-01   +1.062560455519517e-01   +3.230312115022771e-01   +1.217316071193914e-01   +7.638581341421240e-01   +3.029953164619766e-01; +7.745032402056237e-01   +6.590215255193503e-01   +2.014122600746540e-01   +5.297924989064446e-01   +1.537253391356675e-01   +3.487000737275125e-01   +2.055312957370575e-01   +2.982563164620869e-02   +7.583100788955000e-01   +2.730556753529995e-01   +7.841331941887736e-01   +5.209037897797405e-01; +2.722390995130149e-01   +3.348161043497823e-01   +7.043098620660365e-01   +6.207177825984843e-01   +7.928362887952810e-01   +6.763073471481373e-01   +5.692301464943291e-01   +4.518089049842186e-01   +4.272516156051034e-01   +1.985243607596414e-01   +4.527169875681267e-01   +5.840889134835020e-01; +7.034577646704908e-01   +6.116017818727103e-01   +7.898234316791444e-01   +6.786451008882721e-01   +1.748859546222570e-01   +4.802342574891673e-01   +4.600068221663216e-01   +8.006568575448865e-02   +6.384256551543486e-01   +6.896904678252184e-01   +2.194057675235201e-01   +1.632859641142739e-01; +4.658049023535717e-01   +7.218718256698295e-01   +1.557163549671256e-01   +1.271005330880324e-01   +5.149922535830739e-01   +2.321772189235869e-01   +1.864845555214122e-01   +6.072613966543908e-01   +7.871098293375404e-01   +3.715185859417735e-01   +1.472398868748708e-01   +3.119594219901694e-01; +2.104209046067424e-01   +3.558336819667744e-01   +5.965560886619651e-01   +3.561326960332686e-01   +4.449912937294959e-01   +4.362535451158959e-01   +1.475707174305495e-01   +5.390608584735707e-01   +3.322944810118869e-02   +5.318715355649429e-02   +4.180279849854078e-01   +3.521599673349390e-01; +2.662924985291884e-03   +7.213152352211163e-01   +4.224296990845612e-01   +5.167413490389159e-01   +2.018464889268279e-01   +2.086308012786846e-01   +4.389620397980344e-01   +6.980326786288455e-01   +2.937924016397863e-01   +4.388648539114958e-01   +7.514870754349138e-01   +5.769146582019202e-01; +8.105381652159122e-02   +5.372627222649802e-01   +2.056997652674550e-01   +6.258059775613897e-01   +3.225252213614510e-01   +2.767197161846691e-01   +5.398693726294884e-01   +6.901510891713363e-01   +3.890934783374894e-01   +4.276962134528998e-01   +1.561348340118145e-01   +7.895408303471513e-01; +5.517433467547576e-01   +2.544337007744524e-01   +3.217025659789030e-01   +8.000348146844841e-01   +1.046347024095071e-01   +4.809014306424411e-02   +5.606310165501474e-01   +7.763137390808532e-02   +4.472631898876210e-01   +7.024134321681395e-01   +6.376188266842501e-01   +3.545528819053814e-01; +3.474138068325663e-01   +7.752803739000607e-01   +5.469395561793493e-01   +2.555921418483904e-01   +4.487865826316604e-01   +5.396373807342315e-01   +6.340417869968450e-01   +1.356762449098669e-01   +7.043557886261755e-01   +5.036307643197574e-01   +5.974973675843278e-03   +7.230235694788257e-01];
L3E_L3I_iGABA_netcon = [+1.030538721153104e-02   +3.238409891292837e-02   +4.297611369564603e-01   +6.937771796215482e-01   +1.635835860282684e-01   +5.411041580880604e-01   +5.808972093979116e-01   +1.058342325396777e-02   +2.883079692213355e-02   +1.715376629342883e-02   +7.845678594750680e-01   +6.079224979385252e-01; +7.310266608247191e-02   +7.820132333499954e-01   +2.825144189544564e-01   +4.971074288695931e-01   +5.788287616974351e-02   +5.374558021650433e-01   +1.887191691139838e-01   +5.254911897752212e-01   +1.589927178144432e-01   +4.988817590862024e-01   +1.561953243554623e-01   +4.457398807184973e-01; +1.247800200137376e-01   +4.517570317017697e-01   +1.179291809585536e-01   +1.971250639179618e-01   +3.479175579823756e-01   +7.177247135397663e-01   +4.768421112801264e-01   +7.446622399357358e-01   +5.049804923739881e-01   +2.782078772962668e-01   +5.848874444371142e-01   +3.300429445554452e-01; +7.811902788968539e-01   +5.572499809345138e-01   +1.149801275324995e-01   +6.751161973464243e-01   +6.692804424793053e-01   +6.496776069817020e-01   +6.147526925633862e-01   +1.451873335872150e-01   +5.550523931625806e-01   +7.226429578092738e-01   +1.694205621787851e-01   +5.796210465525016e-01; +1.174834987281547e-02   +4.553591351761249e-01   +2.977367436795277e-01   +7.217012637461812e-01   +5.623432127755486e-02   +6.199060453197355e-01   +5.539908616786199e-02   +7.154428838212360e-01   +5.666825158538262e-01   +3.718510391894264e-01   +2.494788717278683e-01   +5.431485454441846e-01; +6.866290187420740e-01   +1.240307705825251e-01   +4.409818434821675e-01   +5.519403454444692e-01   +4.248740690272539e-01   +1.235880521676161e-01   +4.707743136554421e-01   +7.383445562066840e-01   +9.949612031618818e-02   +5.769760089046656e-02   +6.796199555081799e-01   +1.269599393220535e-01; +2.432914625357837e-01   +6.674484731287664e-02   +3.145925970067149e-02   +3.470541051174167e-01   +3.484244330307452e-01   +4.492293416835086e-01   +2.008748980803129e-02   +7.425102299138365e-01   +4.546970233008564e-01   +6.215100436207153e-01   +5.448613366175258e-02   +4.190241565863285e-01; +2.332767446947758e-01   +7.090503283991571e-02   +3.859626603971565e-01   +3.032841652594199e-01   +4.866421816203231e-01   +7.078192180541474e-01   +4.939824920919207e-01   +4.490938081739547e-01   +5.066701597850265e-01   +7.836040231255231e-01   +1.760194203418073e-02   +1.235025568524490e-01; +1.623036022532273e-01   +1.019251822380514e-01   +6.676445401643516e-01   +6.046423502341736e-01   +2.615370227342599e-01   +2.609687695341613e-01   +6.765758271041957e-01   +4.106287249838708e-01   +2.852614770841384e-02   +5.589896503381662e-01   +1.900601595180001e-02   +6.349187632941643e-01; +1.984482303637502e-01   +3.423119482523918e-01   +1.753678023381614e-01   +5.284204168685557e-04   +5.372661806916076e-01   +7.166975175129622e-01   +4.833578395239730e-01   +6.684792083337463e-01   +1.917945541129396e-01   +1.528252443390422e-01   +7.132760362669038e-01   +1.252561265475400e-01; +5.528211703298472e-02   +6.751285611064867e-01   +3.764339627285988e-01   +1.755453677136634e-02   +7.716811945275559e-01   +3.311914571062207e-01   +4.299325650448302e-01   +3.858483040422909e-02   +5.676359581461902e-01   +4.196423048797321e-01   +2.186698605772665e-01   +3.677578954880300e-01; +2.308328838353010e-01   +8.343712365405481e-02   +5.055814174257812e-01   +5.877599999623331e-02   +3.101061042444433e-01   +2.496210813058426e-01   +1.884826910260239e-01   +4.624740905129503e-01   +5.044860105031049e-01   +3.431387285378931e-02   +2.213021214735667e-01   +7.737425041946654e-02];
L2E_Input1_iAMPA_netcon = [+7.125276416343790e-01   +3.610729061435398e-02   +2.256775311593026e-01   +3.648580601718779e-01   +2.483640224174638e-01   +1.350361607305870e-01   +6.019417649894522e-01   +6.178474129099322e-01];
L2I_Input2_iAMPA_netcon = [+7.919407169453281e-01   +7.966788871802915e-01   +1.036315845128360e-01   +5.349884266853081e-01   +6.110254169982472e-02   +5.553514348933021e-01   +3.158420191521815e-01   +2.162174609564541e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.1*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.1*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 30*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 30*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
