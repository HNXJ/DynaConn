function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.042861159665107e-01   +2.032778959361343e-01   +1.467235558751780e-01   +6.381381848404276e-02   +9.042541856073172e-02   +5.771253785558653e-02   +9.695149810841975e-03   +2.432029258817727e-01   +2.153574033925352e-01   +1.775221023873732e-01   +4.799652608094685e-02   +4.491630121320377e-01   +2.705941067499836e-01   +1.832886261397141e-01   +1.468616232865143e-01   +3.243984779714397e-01; +2.702524210085386e-01   +9.110433009105644e-02   +3.242104265040313e-01   +1.859283677990336e-01   +4.646497527129226e-01   +3.547639534278230e-01   +2.288190447481979e-01   +3.299236784381240e-01   +3.094310028111573e-01   +5.022969128766775e-01   +4.732331369870509e-01   +1.718364690472935e-01   +2.572847966089029e-01   +1.905898580200071e-02   +3.115655419796525e-01   +9.715179650049421e-02; +2.358022041728395e-01   +4.835046736392108e-01   +1.455718742958405e-01   +6.805471722435473e-02   +2.692045149891381e-01   +5.074668909881558e-01   +3.083482310225698e-01   +2.029570788052066e-01   +3.369945098313799e-01   +1.365550927535246e-01   +1.746777926750167e-01   +2.035343002232195e-01   +3.277355407040158e-01   +2.463578491064328e-01   +4.195437139215855e-01   +3.353053920090412e-01; +8.759759375488614e-02   +3.420530864946540e-01   +3.951973108807768e-01   +5.148290852666174e-02   +3.671722025384498e-01   +1.948371698439598e-01   +7.783475550810638e-02   +1.038614714142921e-01   +4.062445916690016e-01   +1.909624058150862e-01   +7.710865154480211e-02   +2.261487805070140e-01   +4.096887862668096e-01   +2.734389582759729e-01   +4.863676235865674e-01   +2.651774622409865e-01; +1.060080890573233e-01   +4.331591194295059e-01   +2.576591207642173e-01   +4.254876119687781e-01   +3.760629157327624e-01   +2.079764331818416e-01   +5.987355791794509e-02   +1.205048716218643e-01   +1.585984197990490e-01   +3.536437688524826e-01   +3.451707951012715e-01   +3.537954452225171e-01   +2.007079070989063e-01   +3.715360807099586e-01   +1.139097628196979e-02   +8.130351740084560e-02; +1.278125988383029e-01   +4.632408951214541e-01   +1.932432194418729e-01   +2.920935960243362e-01   +3.601956855168287e-01   +7.751839652993672e-02   +2.593272385164229e-01   +2.860257425218311e-01   +6.308545280077243e-02   +2.814917361629719e-01   +1.602872753982388e-02   +1.245725157577645e-01   +1.241256219893170e-02   +4.189369545152679e-01   +2.889296753710815e-01   +2.348634737040161e-01; +4.358132609745625e-01   +3.235620830291464e-01   +3.089600827154145e-01   +3.558895325651704e-01   +2.653786013934584e-01   +2.063328731881350e-01   +8.539669612756674e-02   +3.677542128429199e-01   +9.919234299338929e-02   +2.066934745907955e-01   +7.447226775236766e-02   +8.324047923735715e-02   +2.296356986614418e-01   +4.662304590188555e-02   +1.236460984895988e-01   +3.494462033649922e-01; +7.149945461384859e-02   +1.007142368161031e-01   +3.336787846668020e-01   +4.187347775203097e-01   +2.735428782177807e-01   +1.070254490214980e-01   +9.132536818369197e-02   +7.515915952006033e-02   +3.548864647475753e-01   +2.912152101090684e-02   +3.940122801950222e-01   +2.881101709466206e-01   +1.909478809993965e-01   +4.974582233650097e-01   +2.797282671221759e-01   +5.247102791986706e-02; +5.102267616231693e-02   +2.057705566069723e-02   +6.147525111447447e-03   +9.139650168480598e-02   +2.504898781187834e-01   +5.017182517892947e-01   +3.807924051493820e-01   +2.588720053085377e-01   +1.989815966839126e-01   +4.297518172897969e-01   +9.824825995651235e-02   +1.187672461134531e-01   +1.831559952608577e-01   +3.896211177713235e-01   +2.440148625548126e-01   +3.345639107163756e-01; +1.522438304949122e-01   +7.382574903188174e-02   +2.712478336147926e-01   +3.096188585099129e-01   +4.018588112544209e-01   +8.242309892214832e-02   +6.925506391730400e-02   +4.824550964896437e-01   +3.218553626065752e-02   +2.622872833100007e-01   +1.975476707033157e-01   +4.408045147481242e-01   +4.573180124803093e-01   +2.255573186939232e-01   +5.666164745760616e-02   +4.201275163110309e-02; +1.875210796564582e-01   +3.155983719006470e-01   +1.428046963265583e-01   +2.943325049834234e-02   +1.355211234438574e-01   +3.286511728180174e-01   +4.147955942634476e-01   +3.419635678203378e-01   +3.215588160267082e-01   +3.444034668963285e-02   +1.658604182805368e-01   +5.133030228060900e-01   +2.208070776962963e-01   +2.879188058993649e-01   +2.054616351061917e-01   +4.242758521318825e-01; +2.426770489471774e-01   +1.692423383978385e-01   +5.014701533584814e-01   +2.034044360502918e-02   +1.232779607037309e-01   +5.050445587143354e-01   +1.669227277056345e-01   +4.223904754233631e-01   +3.872122708245947e-02   +2.643253610650484e-01   +4.145437187050440e-01   +3.919487650913095e-01   +1.749495163532538e-01   +4.559127096926969e-01   +2.981915035403972e-01   +2.762402122321935e-01; +4.429682215091300e-02   +3.704905499723906e-01   +2.893989225743464e-01   +8.855300803949308e-02   +1.154813156831261e-01   +3.845172403007736e-01   +1.252559524746200e-01   +4.439589072142472e-01   +2.387916036136470e-01   +4.584452856734854e-01   +3.643486982787517e-01   +2.531172313858135e-01   +1.886919442007055e-01   +7.929097430929948e-02   +1.235255280056537e-01   +2.175893484686262e-01; +1.105470974043845e-01   +4.291445403821215e-01   +4.297305938767386e-01   +4.112924335842121e-01   +4.067791792316311e-01   +9.603091584951663e-02   +1.152417149512354e-01   +2.306841893274090e-01   +3.776982071328251e-01   +2.944717644265995e-01   +4.446338460781606e-01   +8.839748757836013e-02   +1.354834775270706e-01   +1.601892532224547e-01   +1.935427119128215e-01   +2.328395451244460e-01; +1.855296739902751e-01   +5.106925261453543e-02   +2.601577370304671e-01   +3.437610208519532e-01   -1.814379587521141e-03   +2.408882011259087e-01   +2.520006810698568e-01   +1.083897993972823e-01   +2.544936637101915e-01   +1.171120497523397e-01   +8.948853477600054e-02   +3.784318934865626e-01   +3.590063328311296e-02   +3.125799738551766e-01   +3.969268640032496e-01   +2.972884625461812e-01; +2.514637988398193e-03   +7.866881246149036e-02   +4.004643420027988e-01   +2.549164121747406e-02   +2.476580319238546e-01   +1.144015295448542e-02   +3.324220346375639e-01   +2.730141098856053e-01   +4.916355037853639e-01   +2.097883095874835e-01   +2.554552672602923e-01   +4.059673193507722e-01   +3.220481774991890e-01   +2.687950263471638e-01   +1.675876772907886e-01   +3.406398120392807e-01];
L1E_L1I_iGABA_netcon = [+1.912339270171157e-01   +3.807752770151217e-02   +9.762586563509236e-02   +4.609314746799729e-01   +3.670942590459065e-01   +1.697033150995745e-01   +2.740586678551669e-01   +4.551405825352627e-01   +1.550923775278978e-01   +2.986560560242915e-01   +2.153599738245526e-01   +2.919096223904806e-01   +5.054067785845398e-01   +1.237830058449719e-01   +4.918538196034948e-01   +2.991971156260362e-01; +2.503426827827589e-03   +4.320273922132517e-01   +2.697921068901683e-01   +2.074660468376609e-01   +9.922279614440931e-02   +3.542603976130073e-01   +1.031029471071289e-01   +3.341362339933705e-01   +3.614511449883291e-01   +2.909404596482077e-01   +3.734022217001710e-01   +1.483990558935156e-01   +4.108845978687164e-01   +2.644470224236847e-01   +4.770156974096127e-01   +3.258756060287409e-01; +3.497301931346925e-01   +4.404900301925719e-01   +2.048185093170267e-01   +3.572213505840157e-01   +2.574369813652260e-01   +3.847111113890049e-01   +4.009372761164023e-03   +2.119020918545663e-01   +1.826190465806488e-01   +4.388272714745372e-01   +1.387366025643918e-01   +2.876172483907110e-01   +3.639740100629311e-01   +2.880859690732582e-01   +1.567620611004852e-01   +5.279583667221254e-02; +3.351530040815002e-01   +4.686264601179034e-01   +2.822945528620174e-01   +3.537837192921292e-01   +6.985516981113976e-02   +3.619801624474440e-01   +2.058139290733684e-02   +3.487883207422902e-01   +3.065582950763556e-01   +3.717496637724958e-01   +2.229385264334632e-02   +1.499578801174324e-02   +3.460137268249260e-01   +1.226029122724613e-01   +6.797987443233160e-02   +2.546093535240428e-01; +2.377124863547203e-01   +3.486336435708299e-01   +2.131157643249853e-01   +1.490323800301476e-01   +3.242369813450135e-01   +3.237131876885142e-01   +2.671898760932608e-01   +2.420715360050870e-02   +3.120698899437526e-01   +1.945992438179999e-01   +7.622160161537050e-02   +1.218282600436475e-01   +8.320307272306182e-02   +2.966022845074081e-01   +2.400536885144355e-01   +2.934583704129796e-01; +1.648559272328348e-01   +3.451806062238254e-02   +9.833099383656325e-02   +2.931915968337767e-01   +3.161743817659000e-01   +4.035902869693440e-01   +1.767616054972740e-01   +2.798106676591288e-01   +3.464057895946949e-01   +2.902001213474563e-01   +2.649594870972413e-01   +3.508634686868856e-01   +5.009343073114970e-02   +4.093796171926754e-01   +6.612520536841854e-02   +2.058463267942195e-01; +7.176607849163759e-02   +2.098473628664600e-01   +3.911536819432836e-01   +4.262746242485919e-01   +1.871334313060007e-01   +8.843057187969008e-02   +1.290849112595743e-02   +9.957488641891102e-02   +2.622213565462160e-01   +2.780301831312120e-01   +4.461536792009410e-01   +2.649673442866343e-02   +4.316100658980728e-01   +3.090045783834754e-01   +2.782294599819272e-01   +3.892014151185340e-02; +1.510059933296429e-01   +4.140690705642342e-01   +1.073975937137034e-01   +4.408564187010303e-01   +9.596471995008676e-02   +8.569582805905936e-02   +4.198264903191318e-01   +7.620920110297931e-02   +1.119664931386329e-02   +2.650802440475640e-02   +2.249614980990468e-01   +4.005316527836374e-01   +3.243906337247291e-01   +4.007589281631048e-01   +4.643899170911771e-01   +1.459173027877731e-01; +1.000124225116678e-01   +4.768498248122887e-01   +3.818714688091891e-01   +3.766359049585950e-01   +4.358796106392400e-01   +1.585082543876233e-01   +2.673288220821363e-01   +3.692986521147580e-02   +3.552764627324529e-01   +1.574380553969460e-02   +3.515367230898168e-01   +4.084861701052557e-01   +4.273714137839020e-01   +1.059717855979405e-01   +2.785653555482965e-01   +5.046529434386225e-01; +4.490094559981353e-02   +3.001014985178281e-01   +4.687155158772551e-01   +9.019234393140003e-02   +2.093040189888915e-01   +1.505870405247157e-03   +2.070224941993545e-01   +4.081166751035546e-01   +4.855179742299063e-01   +7.422091316771924e-02   +1.423330536179860e-01   +2.325015350596447e-01   +1.649291995242209e-02   +1.890501837190804e-02   +3.375622953747934e-01   +6.161206429817467e-02; +3.615937881352821e-01   +3.447621585092207e-01   +7.414486249290825e-02   +4.242093316945577e-01   +2.776378400581864e-01   +1.152948894850269e-01   +2.717777974660382e-01   +1.125695381187411e-01   +4.299648781445062e-01   +6.726524380151541e-02   +2.662614880544057e-01   +9.812129492071586e-02   +1.251720644942336e-01   +2.060895916942347e-02   -4.600530800111041e-03   +2.883222772734834e-01; +1.669350984063870e-02   +3.654517615132516e-01   +3.940475462261643e-02   +3.384323557677988e-01   +4.557082624528390e-01   +2.347968825764837e-01   +1.988763356066321e-01   +4.493603337311096e-01   +4.788702914850284e-01   +4.829596811151409e-01   +4.533252817196363e-01   +4.665626388041558e-01   +2.655563170734338e-02   +7.874112664172319e-03   +4.396473415860262e-01   +1.929143878241306e-01; +4.421369819358296e-01   +3.524401430020763e-01   +6.743189799565684e-02   +1.821753501431328e-02   +3.277569031509546e-01   +3.361369906453692e-01   +2.680975305397963e-01   +2.492772631497565e-01   +3.642913851413830e-01   +2.417168152636269e-02   +3.680517745134815e-01   +6.618015812323552e-02   +1.159138670108019e-01   +1.387724169693051e-01   +2.969680717941937e-01   +1.668403369489756e-01; +3.075343379270356e-01   +2.883733599150768e-01   +3.984315049623927e-01   +2.239938661087195e-01   +1.517522536435995e-01   +6.947037780035689e-02   +3.497827021014718e-02   +2.139957380762171e-01   +1.051971441496072e-01   +3.771050959381031e-02   +3.018296888259183e-01   +2.562203824966902e-01   +1.357120523710838e-01   +3.540402040072865e-02   +1.563987614068950e-01   +1.008186315136874e-01; +2.373198685777264e-01   +4.976741799617272e-01   +3.096335646312293e-01   +3.079875834205068e-01   +3.120431794692830e-01   +1.391162914966507e-01   +2.204931539529243e-01   +2.771252683279377e-01   +4.423852244285581e-01   +3.209002482027341e-01   +2.508465855482322e-03   +3.893454160410765e-01   +5.961670062041610e-02   +4.010841553657581e-02   +2.302910877627430e-01   +1.934600389763488e-01; +3.696048908385611e-01   +3.508224015297006e-01   +6.478518047409114e-02   +2.884221181963393e-01   +1.380317734168185e-01   +2.848239894204422e-02   +6.238998407742894e-02   +4.504362529199657e-01   +1.167889054193762e-01   +3.728090376204178e-01   +3.626164384870070e-01   +2.968732075276128e-01   +2.109646645778510e-01   +4.464827629529099e-01   +1.712126348930412e-02   +4.839098081527580e-01];
L2I_L1I_iGABA_netcon = [+1.045375575581747e-01   +2.906228582945701e-01   +4.614644244800595e-01   +6.306376759529762e-03   +3.823340991663216e-01   +1.054182630296950e-01   +7.274719155487534e-02   +4.375131618969307e-01; +1.534431978425156e-01   +4.295246862030432e-01   +1.009085060195389e-01   +2.713222571038796e-01   +1.288595369150039e-04   +2.036408935389334e-01   +4.289924948082555e-01   +2.822508761875347e-01; +5.300289765868328e-02   +3.382018626075266e-02   +2.596904753444960e-01   +4.961062100516018e-01   +3.435338572499784e-01   +4.142506252965845e-01   +1.720907002389473e-02   +4.315976995910655e-01; +8.593916716392040e-02   +5.147649138678400e-01   +1.971587621303523e-02   +4.385128020977407e-02   +6.389852566467244e-02   +3.518584433498591e-02   +1.344114615965058e-01   +3.489581644235640e-02; +1.523481590384659e-01   +4.790054065859500e-01   +3.433965273542215e-01   +1.198876145686655e-01   +4.907041132331948e-01   +9.687794365014121e-02   +3.026671154320627e-01   +3.123800169970556e-01; +4.057197932622014e-01   +4.566600116278063e-01   +1.864735214585935e-01   +4.679448554844125e-01   +3.125380886152396e-01   +3.288852221172563e-01   +1.774733044367852e-01   +1.766576449477918e-01; +6.212584173843667e-02   +2.622208795385880e-01   +1.680953336908973e-01   +4.387426394169236e-02   +6.908439039769095e-02   +8.834285721646892e-02   +8.495010627107040e-02   +1.310682139054133e-01; +1.715276298431151e-01   +1.867809183295477e-01   +3.337419896884101e-01   +3.355536527096063e-01   +3.357894975588272e-02   +4.996477092095220e-01   +2.667640828087249e-01   +1.153919397220739e-01; +3.294185625102445e-01   +7.099504169349399e-02   +4.734119990422648e-01   +5.154734540006156e-02   +2.167555021641425e-01   +1.259325774616204e-01   +2.546674514130263e-01   +4.890172063649377e-01; +2.611804737880175e-01   +3.994405763953520e-01   +3.516261418332858e-01   +3.521666432950188e-01   +3.446409235234949e-01   +6.269599183017140e-02   +2.974250505073474e-01   +1.352544140370966e-01; +2.066126076432603e-01   +4.391091387131704e-01   +3.180447846595912e-01   +3.238379523125731e-01   +4.250924955050051e-01   +3.852265188453184e-01   +7.284374249476009e-03   +4.925966703768580e-01; +4.655554103232166e-01   +9.628903635084823e-02   +2.309189381584268e-01   +4.907325618947470e-01   +4.558808606084670e-01   +2.151967059075303e-01   +2.872972011629614e-01   +4.924611877437848e-01; +3.485935216170284e-01   +2.913405368822755e-01   +2.981938263006869e-01   +4.546471387336019e-01   +2.220151884163169e-01   +1.269756877120628e-01   +1.826293581539726e-01   +1.625618700399485e-01; +7.313436751838524e-02   +5.017738903152384e-01   +4.755215255533338e-01   +3.600619030522229e-01   +1.485965352040126e-01   +5.573131832851350e-02   +1.197186796445862e-01   +2.395737931641382e-01; +3.110368499297045e-01   +3.791641253315403e-01   +1.138132383010110e-01   +4.336019255140731e-02   +1.808682377563422e-01   +5.131464123455109e-02   +4.195686267744266e-01   +1.054054244551771e-01; +5.440342367582921e-02   +2.189513061837638e-01   +3.760419302161756e-01   +4.142787579181319e-03   +4.595014316073551e-01   +3.230454743094477e-01   +2.901325676295970e-01   +2.234070263051037e-01];
L1I_L2I_iGABA_netcon = [+1.511372211418666e-01   +1.435503682787133e-01   +1.510767916880217e-01   +3.053170306865615e-01   +3.382976563755843e-01   +1.670266669620458e-01   +1.187745683994155e-01   +3.781834511430566e-01   +1.875779438057747e-01   +2.013901357572725e-01   +3.513145168603863e-01   +1.080977809657917e-01   +2.072573792221685e-01   +3.527588834418925e-01   +4.283838797095205e-01   +4.116618994341398e-01; +3.645224424780482e-01   +2.883114194528371e-01   +4.491094819525080e-01   +3.452184301423827e-01   +4.808253844213253e-01   +1.313113704637378e-02   +2.829339962667760e-01   +1.332865710208735e-01   +1.728032532816570e-01   +7.882608578892324e-02   +4.722130582639918e-01   +3.592878279383590e-01   +4.873943611582139e-01   +3.875565456643764e-01   +2.297092851269414e-01   +2.957071554517352e-02; +2.780406548350413e-01   +3.234872598642668e-01   +3.538691418488264e-01   +3.133660163073151e-01   +1.481392637288603e-02   +4.014146994052982e-01   +4.494979484368961e-03   +2.455743531022421e-01   +5.023907763085181e-01   +6.904355941400933e-02   +1.875234727088111e-01   +2.849667203060196e-01   +8.552118807193487e-02   +4.624192768526224e-01   +2.848386211109938e-01   +4.187691406844857e-01; +1.532509602406003e-01   +1.623066004539538e-02   +1.782152664658287e-01   +1.439873892781073e-01   +3.298337721076528e-01   +3.683568319817322e-02   +2.642232163592443e-01   +1.912648612799654e-01   +4.588669932639666e-01   +3.834346874889947e-01   +3.429452389323848e-01   +1.843398342092365e-01   +3.900372567124313e-01   +4.455222651284121e-01   +2.062387813355699e-01   +2.216080241538475e-01; +4.023585832711618e-02   +4.215810881965937e-01   +8.330667117962114e-02   +1.723530840773874e-01   +2.330518471264763e-01   +3.540585630066039e-01   +4.767197517590503e-01   +4.750394998146808e-01   +4.420758157400599e-01   +1.869178531705976e-01   +3.902293795939426e-03   +2.576655257276026e-01   +9.197825425597150e-02   +3.875987852588083e-01   +8.984909701851715e-02   +4.043664813572256e-01; +3.889694077498325e-01   +1.038221005122401e-01   +2.935327626114951e-01   +2.010674066399924e-01   +4.350705030300627e-01   +1.619482162586237e-01   +1.158690565648149e-01   +3.838745661270454e-02   +1.499269046209926e-01   +3.476251305246102e-01   +5.001543610567378e-01   +8.168960741947706e-02   +2.767674190132070e-02   +2.744713525641077e-02   +2.981977570893351e-01   +2.252191339118751e-01; +3.580898285118872e-01   +3.798909731370116e-01   +1.411421565874569e-02   +4.095297832857399e-02   +3.368475119998492e-01   +4.895492894176703e-01   +1.198989133158968e-02   +4.326259287667972e-01   +1.001804315475884e-02   +4.804171469194236e-01   +3.903626654635388e-01   +3.202580809086692e-01   +2.726588404712845e-01   +3.401823874119834e-02   +3.450130336790326e-01   +4.484225802841458e-01; +4.720373506715914e-01   +4.160131710980621e-01   +4.860662464542073e-01   +1.990783111535676e-01   +7.766027354990063e-02   +2.651438202090597e-01   +1.752207297317339e-01   +2.860599108260609e-01   +9.637387463657743e-02   +1.536850258240892e-01   +3.536191888005776e-01   +1.900457046191010e-01   +3.877504441962537e-01   +1.301385130186376e-01   +1.328083921562873e-02   +2.129162519841764e-01];
L2E_L1E_iAMPA_netcon = [+4.312601324196229e-01   +3.029588454206963e-01   +2.854367863319092e-01   +4.116440510918613e-02   +5.035684740003598e-01   +2.067894284672555e-01   +3.998230541439567e-01   +2.598805339617443e-01; +4.617676071098162e-01   +8.145286471998262e-02   +4.354299835612850e-01   +4.998617626893581e-01   +4.084539272109226e-01   +1.935327866466788e-01   +1.460890253018141e-01   +1.351905929089879e-01; +3.312367003086007e-02   +4.402257481904428e-01   +4.382007803618148e-01   +1.172598384371516e-02   +1.799256696214431e-01   +1.256640817143214e-01   +4.875228877169506e-01   +4.616903031124939e-01; +2.515775391793560e-02   +8.729149143732490e-03   +4.491723047650895e-01   +2.043982874047609e-01   +3.389436794425667e-01   +1.874352761339948e-01   +3.885048610587841e-01   +2.750381485394489e-01; +1.879638569288164e-01   +1.851427639522892e-01   +1.873024436230707e-01   +1.647689784243800e-01   +4.018072375070676e-01   +4.580122314010360e-01   +1.799047015233665e-01   +5.194854240951489e-02; +4.789772420238168e-01   +3.607939772366147e-01   +2.555445523274137e-01   +3.159241568282702e-01   +3.406525016130190e-01   +8.551188101661590e-02   +4.851256256137505e-02   +2.476607411697045e-01; +7.334847958789656e-03   +1.224643447823970e-01   +4.205547872795102e-01   +1.035395407512967e-01   +5.694803052963197e-02   +4.602548789150136e-01   +4.066845094575617e-01   +6.168381691482776e-02; +4.147826123405311e-01   +2.875524413555035e-02   +5.446272587147921e-02   +4.115486044570186e-01   +3.457056917523575e-01   +4.262191543785791e-01   +3.228427791039817e-01   +2.520357054770221e-01; +1.793688049383039e-01   +4.932235967274011e-01   +8.646044583271112e-02   +1.652101862824755e-01   +4.168491098797260e-01   +3.347519191230557e-01   +1.606024081641627e-01   +2.660182645820898e-01; +6.167099106835690e-02   +3.676624969069021e-01   +4.018949512048408e-01   +4.733297994859420e-01   +4.976388409975058e-01   +2.679894178984474e-01   +4.721265689041054e-01   +4.119469551465278e-01; +2.744915237343607e-01   +2.127994871353978e-01   +4.131108617999570e-01   +3.488792312579295e-01   +2.933098948184168e-01   +3.419182544650053e-02   +3.077753437577292e-01   +3.880496507669673e-01; +3.676736482862046e-01   +3.026570441238755e-01   +4.343608770993410e-01   +4.659022617005474e-01   +3.504489756796629e-02   +2.334020349805967e-01   +2.738977020671009e-01   +3.134386107068637e-01; +1.057855482293252e-01   +7.248940752526056e-02   +4.268946594447092e-01   +2.249232347705209e-01   +3.881339359339102e-01   +2.640961165423645e-01   +4.931808324603105e-01   +4.721337908257967e-01; +4.035677283600437e-02   +3.124710806248554e-01   +1.356140682261628e-01   +1.963494605872130e-01   +4.896206548382248e-01   +1.856596731759546e-01   +3.957776039841864e-01   +3.294012402720797e-01; +1.075592531294436e-01   +1.916074034578938e-01   +4.835362397461096e-02   +8.582579898605669e-03   +9.242518099435786e-02   +7.959345820309570e-02   +1.710206850047450e-01   +4.807972023355820e-01; +1.269154264587382e-01   +2.670356117735157e-02   +5.701744614997728e-02   +3.222855997562823e-02   +3.539987111977986e-01   +9.831083679762201e-02   +1.626674938164991e-01   +4.555746881180159e-01];
L1E_L2E_iAMPA_netcon = [+4.169095392798819e-01   +1.764064565987459e-01   +3.168774271891474e-01   +4.995649562461364e-01   +4.482678863640218e-01   +1.182559211303264e-01   +3.705756982816971e-01   +2.173313549518130e-02   +4.177597735242848e-01   +2.954423246295135e-01   +1.483390593650489e-01   +2.259452886814011e-01   +1.655791582730965e-01   +4.628818202693306e-01   +5.068073262058761e-01   +8.624637569028171e-02; +4.736819876687493e-01   +4.055787776313677e-01   +2.850068576492142e-01   +1.851004752640074e-01   +2.888858977402304e-01   +2.099859716030002e-01   +2.739690559846951e-01   +1.271047643210844e-01   +5.082078789211890e-01   +3.531945279659954e-01   +4.738772122970927e-01   +4.122204275349949e-01   +4.124259375730232e-03   +3.316517358267149e-01   +3.528386315078896e-01   +2.130126141998520e-01; +4.221094772807061e-01   +2.423626471883850e-01   +1.723433560666378e-01   +4.950039327661005e-01   +4.088216463418563e-01   +3.957756046766039e-01   +9.715862405645416e-02   +2.864227052786136e-01   +2.280737439491648e-01   +1.887320501728346e-01   +3.328465527709543e-01   +1.641525995925699e-01   +1.666380388805022e-02   +5.407970440102037e-02   +2.737365089491842e-01   +2.555586886381227e-01; +1.569189995821293e-01   +2.691617210056547e-01   +3.095021889744840e-01   +3.376271900108209e-01   +4.335878467439679e-01   +2.895271601187318e-01   +4.413653054198054e-01   +1.623001098103003e-01   +1.466725220238679e-01   +8.327012276386697e-02   +3.852367534135393e-01   +2.173262758007355e-01   +3.842266909859243e-01   +1.113196937395525e-01   +4.839175118185778e-01   +7.681627081512149e-02; +3.548906536635765e-01   +1.956098672645442e-01   +3.429133116825284e-02   +4.491642955614669e-01   +6.912573007813320e-02   +4.644077625213352e-01   +3.621692166996639e-01   +3.691686540423010e-02   +2.632559481177749e-01   +2.169591738874811e-02   +4.512155674145656e-01   +8.266026692071066e-02   +3.497474549187536e-01   +1.954981187269822e-01   +2.345350146557343e-01   +3.125105306485623e-01; +4.880981583249481e-01   +4.133034851387121e-01   +4.700184383020179e-01   +2.013794742294461e-01   +4.132739862794648e-01   +2.845882527587668e-01   +3.291146145480972e-01   +4.646241872761148e-01   +1.822881451474442e-01   +3.911737044421697e-01   +4.451737672652942e-01   +3.498167302084412e-02   +1.069489063601820e-01   +2.491370123921691e-01   +9.381507826409000e-02   +3.139160371802660e-01; +1.845118178212198e-01   +4.386192871692534e-01   +1.511028882072288e-01   +5.025351433215933e-01   +2.384174764943988e-01   +3.294455857447545e-01   +4.627279997229312e-01   +2.155036251219289e-01   +1.067064516085245e-01   +5.014935056476532e-01   +9.914610686391623e-02   +4.646142341192264e-01   +4.096650506381229e-01   +3.397432755550080e-03   +1.695406717662882e-01   +3.139693561601257e-01; +1.000182695137787e-02   +5.113633945841639e-01   +1.984481862952527e-01   +2.522917894204441e-01   +1.395108530735673e-02   +1.274047869538923e-01   +3.020019841332044e-01   +1.180122046577874e-01   +3.870612686452076e-03   +3.972255132034710e-02   +4.150177511029223e-01   +2.816216522576123e-01   +3.146272670945259e-01   +4.198393145147268e-01   +4.255602052438927e-01   +8.283980043439240e-02];
L2I_L2E_iAMPA_netcon = [+2.096101927594141e-01   +1.818547333346344e-01   +4.195196720477634e-01   +2.712133768809873e-01   +2.524166154575490e-01   +1.572338629501658e-01   +4.992452338024692e-01   +2.390711880190252e-01; +2.968883557068718e-02   +3.999619965503504e-01   +3.236155613188083e-01   +4.925168972518833e-01   +7.899406874725651e-02   +4.109044529594745e-01   +5.178764530644896e-01   +3.660346517646296e-01; +4.607487359397621e-01   +3.460556696477955e-01   +1.871561414659137e-01   +3.927685968452126e-01   +6.159800076195553e-02   +3.755556846909994e-01   +2.413323707062971e-01   +5.886131363613315e-02; +3.639881992292143e-02   +2.456167434668876e-01   +2.753831720422657e-02   +1.118557594092576e-01   +2.005651334655737e-02   +2.367456200030757e-01   +3.876222214344233e-01   +4.901434703149338e-01; +2.852095788123909e-01   +2.817309001582220e-02   +3.638606524719892e-01   +1.280520627030911e-02   +1.289390343960420e-01   +4.666018741761215e-01   +9.761547678687560e-02   +3.441095037121695e-01; +2.106357324364547e-01   +4.330306251325221e-01   +9.048173492597474e-02   +1.815653255321329e-01   +3.047974666063374e-01   +2.463528244140592e-01   +1.012170668539209e-01   +3.609293144271804e-02; +3.160304418819703e-01   +2.554228296142382e-02   +2.129193774043484e-01   +4.387965189958347e-01   +3.306646610100631e-02   +2.956343581104982e-02   +2.937071911194741e-01   +5.944439085920282e-02; +1.598002958275984e-01   +8.000004967713970e-02   +3.617319501701447e-01   +2.643214186284095e-01   +1.291478888592263e-01   +3.623772747509270e-01   +2.736812853240115e-01   +6.252634353584281e-02];
L2E_L2I_iGABA_netcon = [+2.352314941824393e-01   +5.083981008098496e-01   +1.426174961312228e-01   +4.468061205045774e-01   +2.847876975942276e-01   +2.446670041937109e-01   +4.613625843888582e-01   +3.354497274400824e-01; +3.758650357279489e-01   +8.256090566165959e-02   +2.204798897165748e-01   +4.023909247580014e-01   +2.389122954997554e-01   +8.914674897358767e-02   +4.445250638610608e-01   +4.446724849004405e-01; +2.672807703573544e-01   +2.571770218862172e-01   +3.201621387277575e-01   +1.695407358272546e-01   +3.572889386360075e-01   +3.778903029501958e-01   +3.777550852316768e-01   +2.305475159189381e-01; +2.095872538792251e-01   +3.101981239191638e-01   +1.392607663239931e-01   +4.271967777842859e-01   +5.105868425081996e-01   +4.398807136763007e-01   +3.628213637202863e-01   +4.672666109860314e-01; +1.659007632290755e-01   +4.642675777840914e-01   +2.458353758214508e-02   +4.098649317544045e-01   +1.499795857565746e-01   +3.030430852137808e-01   +1.187598992257243e-01   +2.200062741229775e-01; +4.150882990387449e-01   +1.099997022130344e-01   +2.293420709682243e-02   +2.472880281388055e-01   +2.736862086688476e-01   +2.804461475477005e-01   +2.912107541911593e-01   +1.690492446013051e-01; +3.967668109600274e-02   +2.306440818718641e-01   +1.564196641325111e-01   +3.401773155745712e-01   +3.202657339792207e-01   +4.264991419456167e-01   +2.379312636050508e-01   +1.108612350514075e-01; +4.007816800533621e-01   +2.713769716383669e-01   +4.768990289795864e-01   +1.201486395777896e-01   +3.832251141511565e-01   +1.655528546595590e-01   +1.426208847689918e-02   +3.399066212977155e-01];
L3E_L2E_iAMPA_netcon = [+1.035245511203859e-01   +2.977469289604143e-01   +3.265145024967624e-01   +1.221682446175775e-01   +3.554028251444377e-01   +1.720840461029112e-01   +4.387819858396327e-01   +3.024662857609099e-01   +5.038206647073915e-01   +3.780814265175690e-01   +2.499074448849934e-01   +3.760992004848989e-01; +3.909062272804425e-01   +1.208075772187299e-01   +2.732961083802963e-01   +3.095032617917931e-01   +4.713300356943012e-01   +5.550516718126475e-02   +4.685054535313097e-01   +2.241278293672888e-01   +2.534413296177902e-01   +1.005244714992130e-02   +2.480516781117739e-01   +1.149171958008973e-01; +3.517840075529466e-01   +3.196815833798002e-01   +6.916496329714213e-02   +4.310052970978465e-01   +9.275241824606544e-02   +2.639255026861335e-03   +4.824961735233352e-01   +3.645658704287341e-01   +1.951493271004768e-01   +3.746430396191345e-01   +1.721508148988945e-01   +1.458979341588927e-02; +2.626801093861647e-01   +3.294450408295591e-01   +4.914714081663930e-01   +3.299064697035303e-02   +4.034777123013790e-01   +4.456720640968999e-02   +1.120440818110362e-01   +1.274417615036552e-01   +3.573733425704225e-01   +1.414328782385428e-01   +4.477907524254955e-02   +3.884878951405848e-01; +1.763633800861516e-01   +9.659216749247387e-02   +1.371504402664296e-01   +2.040965452199421e-01   +3.569844472007703e-01   +2.597581908185552e-01   +2.892559000318002e-01   +3.984120264820074e-01   +3.181540437619704e-01   +1.458357068454586e-01   +3.303905251881833e-01   +2.617696991254705e-01; +3.092147024924092e-01   +4.290453903182694e-01   +1.702601946569391e-01   +4.527916253746427e-01   +5.656523269332027e-02   +1.508910149457343e-01   +4.903585341282349e-01   +1.890650774979959e-01   +3.366194831272893e-01   +3.556531099570625e-03   +1.696116437817892e-01   +5.026164530560249e-01; +3.650326080447402e-01   +3.274475022798966e-01   +3.785746602919051e-01   +4.816481038184258e-01   +4.458246786141215e-01   +2.285955417063550e-01   +3.121083517972557e-01   +1.394984826672089e-01   +1.985902970258858e-01   +7.881438194562446e-02   +2.556847590765405e-01   +1.087383651150128e-01; +2.833165691524046e-01   +4.306303354819933e-01   +1.496567292834786e-01   +2.461173784325313e-01   +3.804326007780843e-01   +1.440291066120835e-01   +2.718213574102668e-01   +1.154189787644169e-01   +1.639128870748348e-01   +9.891968047492178e-03   +4.738160555172393e-01   +5.999657355517204e-02];
L3I_L2I_iGABA_netcon = [+1.636198430480333e-01   +1.216587963281904e-01   +3.995641037503083e-01   +2.427333876597977e-01   +3.554617591457213e-02   +3.155209905783607e-01   +1.752015442294078e-01   +2.011320514681989e-01   +5.095479405334455e-01   +2.433021650433257e-01   +4.431259573530158e-01   +3.826772122782501e-01; +1.972422440482050e-01   +3.162411723884097e-02   +3.357608188520954e-01   +3.256425348055944e-01   +5.081929633169500e-01   +2.501374571354565e-01   +3.088365780775829e-01   +5.072912754398867e-01   +1.957027686431159e-01   +1.023405455897936e-01   +3.480638090534479e-01   +3.082801583532774e-01; +2.301321191775416e-01   +3.000565873978687e-02   +2.958860496272758e-01   +2.308937165877861e-01   +3.883844407763014e-01   +3.156522048395103e-01   +1.687035483036896e-01   +4.604171653662792e-01   +3.472485960527084e-01   +2.316762875687367e-01   +3.741921541853425e-01   +2.328349921708485e-01; +2.632591777402325e-01   +1.075320642584880e-01   +3.469120232444921e-01   +6.982659089675175e-02   +2.983262096660206e-01   +3.113386962290061e-01   +1.460215321266027e-01   +3.540538465218280e-01   +3.661954546897807e-01   +5.228384579347457e-02   +1.832863418704040e-01   +4.462246006186040e-01; +4.206084982842485e-01   +1.989150712151306e-01   +3.732153531450309e-01   +4.169298681171237e-01   +3.575977669532703e-01   +3.488740402933755e-01   +3.914456508841968e-02   +2.365307874526126e-01   +7.335249975552534e-02   +4.150234275056549e-02   +1.359058419517484e-01   +5.897896806527340e-02; +8.334915448547484e-02   +1.924474134931344e-01   +4.429636711837541e-01   +2.893089910771756e-01   +7.355689275918782e-02   +4.273310073725992e-01   +2.102336620125002e-01   +1.286769068075111e-01   +8.023695794544371e-02   +3.823403028391448e-01   +1.139853842655750e-01   +2.716730542716901e-01; +4.564119325261277e-01   +4.869412442617800e-01   +1.506907238023821e-01   +3.301133176908349e-01   +9.616749842671687e-02   +1.145454927703058e-01   +1.707907658373786e-01   +1.851378830409437e-01   +5.295886004927133e-02   +3.229842566963322e-01   +2.462853612743717e-01   +4.957755490157261e-01; +4.927758331062443e-01   +1.436735609464890e-01   +3.069081838640089e-02   +4.078688141424898e-01   +4.966212903723080e-01   +4.894408639833895e-01   +3.311592243091944e-01   +2.067826155429812e-01   +1.397660001237548e-01   +3.531117015018614e-01   +2.048292539923625e-01   +1.713852079722945e-01];
L2E_L3E_iAMPA_netcon = [+5.056384796691531e-01   +1.059791080765040e-01   +1.921660654299248e-01   +4.027570997865726e-01   +2.859478742637555e-01   +3.928100186174941e-01   +3.040963062201978e-01   +2.344549757038631e-01; +5.352069575303826e-02   +7.412629402551212e-02   +2.072400303210043e-01   +1.945944734539154e-01   +7.510658144712476e-02   +3.017109188923005e-01   +3.633652477863463e-01   +4.608966201252436e-01; +7.062038867607770e-02   +2.263152682770575e-01   +3.985363464764347e-01   +4.476032868336687e-01   +5.039409433205997e-01   +1.314973276407827e-01   +4.971487438341643e-01   +2.185289218961550e-01; +4.732796327667151e-01   +4.518107366319621e-01   +2.505554813704270e-01   +4.652873431780667e-01   +2.619899356487066e-01   +3.510002613601122e-01   +4.007482228698527e-01   +4.957333243893822e-01; +4.488122335519324e-01   +5.035604195515806e-01   +3.167391987149820e-03   +2.680973782361999e-01   +2.701207650161333e-02   +4.103794448979724e-02   +1.780886923634252e-01   +3.510483539585363e-01; +4.794513665113891e-01   +3.745328534397120e-01   +2.355278481363080e-01   +3.694924275452340e-01   +2.466724029930210e-01   +3.112563347679727e-01   +1.139810673783511e-01   +1.615968513395088e-01; +8.047813243520140e-02   +3.662429324164219e-01   +2.619937032956037e-01   +5.249386385761122e-02   +6.782085988069722e-03   +2.473151425265128e-02   +1.220305071743004e-01   +2.462030870142426e-01; +1.971241098758621e-01   +2.291725267286020e-01   +2.719252534772606e-01   +3.970337986697718e-01   +1.702427507919790e-01   +3.418696998938405e-01   +9.181863281069258e-02   +3.088699765405359e-01; +4.420312810223667e-01   +6.126151442371517e-02   +4.914707786744070e-01   +2.748353841045225e-02   +4.103853251856178e-01   +2.494051714408007e-01   +2.554196162871005e-01   +4.292135823670701e-01; +2.110338063984246e-01   +1.987748936838992e-01   +3.068147060342843e-01   +2.874713087239621e-01   +3.970828590779628e-01   +3.349050257777516e-01   +2.999823974477928e-01   +4.606867194005749e-01; +6.478123210952980e-02   +3.756100555258097e-01   +1.888687084643323e-01   +2.179146086940430e-01   +3.423980997256400e-01   +2.133834902158596e-01   +2.165131546627144e-01   +2.434189424452207e-01; +2.019461895196395e-02   +3.531131463837107e-01   +3.739962544328541e-01   +2.954121929316310e-01   +3.389388507980298e-01   +3.792636157527010e-01   +2.125738684038664e-01   +8.064197442223242e-02];
L2I_L3I_iGABA_netcon = [+9.614965787420028e-03   +3.404092196735697e-01   +2.315232336687922e-01   +4.221354742103062e-01   +3.020956840973808e-01   +1.645355658227871e-01   +2.979268660057519e-01   +2.284492514343466e-02; +2.070286583772298e-01   +3.037205423360982e-01   +9.639181073130587e-03   +3.684654326127975e-01   +4.555270989053394e-01   +3.623784136465953e-01   +4.105265572137203e-01   +2.152481056963272e-01; +2.129406886866628e-01   +4.344197448949042e-01   +3.829339176084508e-02   +1.054369166358998e-01   +1.813682847550615e-01   +2.003957329523288e-01   +1.498880766825893e-01   +2.176800190292827e-01; +2.436619165252700e-01   +3.953390234826257e-01   +5.099274100632017e-02   +5.060244315998360e-01   +3.842549098612450e-03   +5.075900580688877e-01   +2.192226227001685e-01   +3.974684860083070e-01; +3.202832304882201e-01   +3.672147565912094e-01   +7.366477823284485e-02   +4.317714767375134e-01   +2.704182275271613e-01   +9.605684736952887e-02   +3.464225094434033e-01   +1.991616702803042e-01; +3.391455099039489e-01   +1.791184662641400e-01   +3.207665393995087e-01   +4.869700711659809e-01   +3.523201176829572e-01   +9.965599615611330e-02   +3.287820477550102e-01   +8.092665771088213e-02; +1.813857176704075e-01   +3.841172542296190e-01   +5.027593185918925e-02   +3.669949243328184e-02   +1.359464001915905e-01   +3.933015734542584e-01   +3.179390106123033e-01   +2.744612965062077e-01; +4.366451391090285e-01   +3.151112508841578e-01   +1.497786625001135e-01   +2.441568340521938e-01   +3.482883781063763e-01   +4.215863822595728e-01   +2.789747990296064e-01   +2.859833022143821e-01; +1.639408686496188e-01   +3.257959449161080e-01   +2.262020449578704e-01   +1.075130250191580e-01   +2.510770724494133e-01   +3.300025943357636e-01   +2.306122939084007e-01   +2.160069461919946e-01; +4.157148049906975e-01   +1.554779523523938e-02   +1.602857387599166e-01   +2.319168669002230e-01   +3.006393720357581e-01   +2.233111021283642e-01   +1.285199033932964e-01   +3.212548990633138e-01; +1.482912004316466e-01   +2.317296764175458e-01   +3.943376484166847e-01   +6.195980265139860e-02   +3.125752994056790e-01   +2.498871780654604e-02   +3.761370331637596e-01   +2.010227646701818e-01; +4.475114800900724e-01   +3.876198641783402e-01   +3.932954298214661e-01   +1.323197393908156e-01   +4.980054980363980e-01   +5.005045746789701e-02   +3.170198466095134e-01   +1.780866517621938e-01];
L3I_L3E_iAMPA_netcon = [+3.341808682785746e-02   +3.256033805259010e-01   +2.409459742870640e-01   +2.335386146944040e-01   +1.583298556260425e-01   +1.383850985336364e-01   +1.255366734744699e-01   +2.926448704374048e-01   +3.717350640136194e-01   +2.694801000163720e-01   +1.320375972029624e-01   +3.375520436367239e-01; +2.840859563819259e-01   +3.432193732683963e-01   +2.532707356034519e-01   +4.105064303854629e-01   +2.408282723951539e-01   +3.489239366124344e-01   +4.965731795677297e-01   +2.800954647886973e-01   +1.510591672648148e-01   +2.126901993982580e-01   +6.221963680171366e-02   +5.011492831248249e-01; +4.178682461143832e-01   +4.247766075530729e-01   +2.718976561370759e-01   +4.278048197112034e-01   +4.129034171121573e-01   +4.357715291012544e-01   +1.140625682898862e-01   +5.600945445796622e-02   +4.210668521861398e-01   +2.730270277089134e-01   +1.225735563584757e-01   +1.453663823428107e-01; +2.045817368659385e-01   +2.263485091601905e-01   +5.378929982243397e-02   +1.125701755661087e-01   +5.184726550924154e-02   +1.998528025821507e-01   +4.017773458407690e-01   +8.718770844849508e-02   +2.577132467089229e-01   +2.140515390125766e-01   +3.450685156231720e-01   +1.590596665522830e-01; +2.443772538724126e-01   +3.499942859916644e-01   +2.988692167081651e-01   +1.079958332008011e-01   +2.449086001757738e-01   +1.363372473074198e-01   +4.889378382913402e-02   +1.232076151788832e-01   +6.855492470144164e-02   +4.969200239712098e-02   +1.509198317222687e-01   +3.248496999256602e-01; +7.489957012491590e-02   +1.140303436400685e-01   +2.302302865082597e-02   +2.691164949844522e-01   +2.213211163558753e-01   +1.479667645195502e-01   +1.219022827649225e-01   +2.527064816609988e-01   +1.633331981340805e-01   +9.759596615223323e-02   +3.815303046775619e-01   +4.738375533637078e-01; +2.922787832448277e-01   +4.458110881274334e-01   +6.168955994771546e-02   +4.787874832617474e-01   +4.485903743852048e-01   +2.162558577430884e-01   +2.274951485783042e-01   +8.555617665761130e-02   +1.727849060200873e-01   +3.755749620489736e-01   +1.283558134632369e-01   +5.005515222729890e-01; +4.054272540118344e-02   +3.307547328264905e-01   +1.806783115972169e-01   +4.816746540687578e-01   +4.790188545900823e-01   +3.642068088940673e-01   +4.079312476258994e-01   +1.781830327932182e-01   +7.779876886991077e-02   +2.696007630274441e-01   +1.370693097132594e-01   +9.555981564668047e-02; +1.396546850395005e-01   +3.460567174667213e-01   +1.741264568333942e-01   +8.569173252170187e-02   +2.916808452123010e-01   +3.200094164284998e-01   +4.230492990047802e-01   +4.045327993181546e-01   +3.465597532456332e-01   +4.854039209153914e-01   +1.587505488078906e-01   +7.064604752224343e-02; +1.661755484895638e-01   +8.419421177005627e-02   +8.032774130844496e-02   -3.949096254506901e-03   +1.557176318582146e-01   +8.075490274519652e-02   +1.954846594006925e-01   +9.711760394953156e-02   +4.154957682842026e-01   +4.520069645825051e-01   +2.649164995208690e-01   +2.111733091959080e-02; +8.397958602689207e-02   +2.112743969831211e-01   +4.322470983560305e-01   +8.697873920983377e-02   +4.570166899465410e-01   +2.976583539487089e-01   +3.615417502379001e-01   +5.096742634497635e-01   +7.919992249781917e-02   +4.682525935188174e-02   +2.812835534015590e-01   +5.033374253503671e-01; +4.065501065650224e-01   +3.251736128300306e-01   +3.868027997786047e-01   +4.257422322986005e-01   +4.872873940399805e-01   +4.754354595571239e-01   +3.020983328555404e-01   +2.085635140536399e-01   +4.229939716592698e-01   +1.057719170879349e-01   +2.860123489143702e-01   +3.036046945579340e-01];
L3E_L3I_iGABA_netcon = [+2.126573629125589e-01   +1.500237519220484e-01   +1.035804782075652e-01   +4.971051055065165e-01   +3.671563154289659e-01   +4.356283885497511e-01   +2.848056051662280e-01   +1.483916395533410e-01   +1.366027780366867e-01   +4.760854109362150e-01   +4.651472270266852e-01   +2.651103734577883e-01; +1.753628639596898e-01   +3.386863453327552e-01   +1.391724332518841e-01   +5.761948330194726e-02   +2.831589962147933e-01   +4.502515866978393e-01   +4.982911146521975e-02   +3.977189292106940e-01   +2.198040516243090e-01   +3.032767382217830e-01   +2.483491661635162e-01   +8.752704458020837e-02; +3.473337955726349e-01   +2.186055409810465e-01   +3.486550615930321e-02   +8.675496690197067e-02   +1.609496146647797e-01   +4.082747744437256e-01   +3.458729250470353e-01   +2.711753815870799e-01   +4.250656247005512e-01   +3.170715008346175e-01   +4.772301037767993e-02   +2.167496949333476e-01; +1.107558202480348e-01   +2.658592734508357e-01   +9.781800903085253e-02   +1.044036294846759e-01   +1.311016409104100e-01   +4.374388289578996e-01   +1.112741333682549e-01   +3.757320906414217e-01   +4.736970993652656e-01   +3.993577044490670e-01   +4.466269101679633e-01   +3.497026286648931e-01; +2.906811982408104e-02   +1.569925133640095e-02   +4.212687858895818e-01   +3.172632729424362e-01   +4.999181707374121e-01   +2.530565551485083e-01   +2.830680693955238e-01   +4.375066556840304e-01   +3.705291003306641e-01   +2.714452563401991e-01   +2.631197128579396e-01   +2.558986877745275e-02; +2.506736614775111e-01   +1.039291895409651e-01   +2.444970763122913e-01   +1.450531072865869e-01   +3.538361725046907e-01   +1.417985295810244e-01   +3.472060966065201e-01   +1.843759355955714e-01   +5.084917181777298e-01   +1.821671501073723e-02   +3.325524286515430e-01   +2.722468481419970e-01; +4.314481280378426e-01   +3.714541838847127e-01   +1.391117651493496e-01   +7.356058434256611e-02   +2.013748810589842e-01   +2.167404779982006e-01   +3.620702919936749e-01   +1.444822499292077e-01   +3.250435397202594e-02   +4.416288671341725e-01   +2.261899283851671e-01   +9.810399304901762e-02; +1.812504673317344e-01   +5.070681335680985e-01   +2.773905902113816e-01   +7.673411896511442e-03   +2.053176417112507e-01   +1.086107052619410e-01   +5.435248378310497e-02   +4.698988525252791e-01   +4.040924303627220e-01   +7.958318477428107e-02   +3.131065986860084e-01   +2.516004237658632e-01; +2.789146189968172e-01   +1.818043935337958e-01   +4.872388904249086e-01   +7.990349405292892e-02   +4.720672329875811e-01   +2.157187368665764e-01   +1.065265540894169e-01   +3.656641990489568e-02   +2.938672974624413e-01   +4.974621660223592e-01   +9.622822358996166e-03   +2.111198384849670e-01; +1.655118127387335e-01   +2.277324184037397e-01   +3.844206433719770e-01   +8.714658029347359e-02   +1.743839566544715e-02   +2.607607631096250e-01   +8.067817870954892e-02   +2.320387681197290e-01   +1.467082436105067e-01   +7.584502712409881e-03   +8.566576884320751e-02   +3.285528603336105e-01; +2.721015587779221e-01   +8.827170291793524e-02   +2.570595273785246e-01   +2.903564211206403e-03   +1.699512722254830e-01   +3.468574736304594e-01   +4.143817256915894e-01   +2.234523740847704e-02   +4.789301671132524e-01   +2.007019535190900e-01   +4.301175925576697e-01   +3.211780137700743e-02; +3.946732132441723e-02   +3.538464520469979e-01   +2.024514778896713e-01   +2.064930949672766e-01   +4.340927400138374e-01   +2.908643531138661e-01   +1.328722476116294e-01   +3.626073572714827e-01   +1.426346288587619e-01   +3.412580061580042e-01   +1.661942831307337e-01   +2.398179330461262e-01];
L2E_Input1_iAMPA_netcon = [+1.190022796867893e-01   +4.981108282165894e-01   +4.495002908957771e-01   +2.986855767140902e-01   +2.630186833652287e-01   +2.462093724764519e-01   +4.010135599954041e-01   +1.834513537797930e-02];
L2I_Input2_iAMPA_netcon = [+1.237110606017569e-01   +3.688940656963641e-01   +3.205226206105821e-01   +4.154298939260623e-01   +2.021239176279519e-01   +1.756929693433260e-01   +4.055025949560155e-01   +1.668894936858180e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
