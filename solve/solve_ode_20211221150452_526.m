function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.000000000000000e+00   -2.340611295707565e-01   -3.460704787103655e-01   -1.416623598817079e-01   +4.525590210297156e-01   -6.034236053475962e-01   +6.685167574673707e-02   +1.328643654858007e-01   +4.664738004964872e-01   +4.243001678930461e-01   -4.340805346285418e-01   -1.702000671841709e-01   -8.084025996071174e-02   +2.505246852529601e-01   +9.979420131849895e-02   +2.900779439154120e-01; -3.943175559845150e-01   -8.502695071344385e-02   +9.578294270549004e-02   -4.496273376129434e-02   +6.155051955035695e-01   -2.684616233997686e-02   -3.648102321449589e-01   -7.229950841392827e-01   +7.571302832768936e-02   +5.089781527844834e-01   +3.935801533633951e-01   +4.023925546712130e-01   -3.869542894603651e-01   -8.128255250080912e-01   -3.584440480493499e-01   +1.706337507138654e-01; +5.627571082156381e-01   -3.583888853069325e-01   +4.871306402677076e-01   -5.538753061427444e-01   -6.915837377089693e-01   +4.928845416513886e-01   +4.206858893312857e-01   -9.446924160722270e-02   -1.825293066423496e-01   +1.515639726788258e-01   -1.625969220545683e-01   +3.614171683851022e-01   +2.221011662558182e-01   +3.968311141680421e-01   -6.860295259694866e-01   +9.942064578320822e-02; +1.404014571568754e-01   +4.528948202828824e-01   -2.332079560694482e-01   -6.518731759575969e-01   -2.251909576465920e-01   +4.353604268305410e-01   +2.608497453576323e-01   +2.457040737008571e-02   +3.150790328972491e-01   +1.107438682410500e-01   -3.590344892191694e-01   +5.286288670225047e-01   -1.297735321275407e-02   +7.453913279606126e-03   +3.330208786183307e-01   +5.767980202298974e-02; +3.912636087314639e-01   +2.376502377251887e-01   -2.310124373102957e-01   +1.074028087088905e-01   -4.073243786066663e-01   +5.524273601768691e-01   +2.990108786474188e-01   +3.565846785673440e-02   -3.981601470818276e-01   -4.565257101667644e-01   -3.818172133312864e-01   +5.500519420818797e-02   -3.889883318903510e-01   -3.613383037121130e-01   +7.623282776651317e-01   +2.908168520260176e-01; -3.922496965920456e-01   +1.967949475343974e-01   -9.887282239306326e-01   -2.736471408675261e-01   -3.569592482932121e-01   -3.278669324273700e-01   -2.663100219508552e-01   -1.389973838803555e-01   +2.821156206793817e-01   -3.064111880644377e-01   -4.308613129292393e-01   -4.337801753557906e-01   -5.032863123426062e-01   +2.538896014212589e-01   +7.462985878653386e-02   +2.171065270994177e-01; -5.451032507861998e-01   +2.324077506305892e-01   +2.600191022961613e-01   -4.425865523758050e-01   -3.816466333668941e-01   -3.414852446447819e-01   +5.144735847145868e-01   +5.314541007011312e-01   -5.469986715913558e-01   -5.858597714410899e-01   -5.079315728174140e-01   -3.805810493232490e-01   -3.239519150467938e-01   +2.421735256309754e-01   +1.438869094762173e-01   -1.179149475820677e-01; +4.173911851043427e-01   +1.728539147902002e-01   +9.419528349258413e-02   +4.456448167360480e-01   +1.748964102436518e-01   -2.871969495406299e-01   +1.224964661074049e-01   -3.976176957157256e-01   +3.614859976087003e-01   +3.311117462579471e-01   +2.705477254119456e-01   -2.707071932377372e-02   -2.097311085481957e-01   -5.086973214091423e-01   +4.408043266641779e-01   -1.805203296417143e-01; +3.808974874979824e-01   +2.527099433565210e-01   +3.454579676485010e-01   +3.735103767721663e-01   -3.010147890787290e-01   -5.052121650339400e-01   +5.543998706784939e-01   -7.624260833250430e-01   -2.811237728103904e-02   +7.683947397360442e-01   +6.645513309792961e-01   -3.934478345925327e-01   +6.796986478904501e-02   +3.997563494290327e-01   +4.478732370231902e-01   +9.333755060043100e-01; +3.588072242897277e-01   +4.267878391229259e-01   +3.328533408720387e-01   -6.198172574845959e-02   -9.722862312142311e-02   +1.014396784380455e-01   +3.621064432592588e-01   -6.593574878827616e-01   -3.524113284258946e-01   -8.031657803665984e-02   +2.350472458756542e-01   -4.148801141133447e-01   -2.040082519528753e-01   +9.053037583504286e-02   +4.209036794263757e-01   -1.766149313126428e-01; -9.097670631194915e-01   -2.962428030309332e-01   -6.190621944829126e-02   -4.501192422200517e-01   -1.131721485357170e-01   -4.103628419179147e-01   -1.996761480456262e-01   +6.970718552456445e-01   +2.394657340760217e-02   -2.293879811800317e-01   -7.438672034321779e-02   -7.021380451860476e-03   +4.369420017325961e-01   +1.289181187856716e-01   +2.588538390764251e-01   +1.551642021670621e-01; -5.143531240172103e-01   +2.724711234163282e-01   +2.121095490290353e-01   +1.475630317670813e-01   +6.883822714937815e-01   +2.525880512715969e-01   -5.221870497534792e-01   -2.077797356310046e-01   -4.516847197880940e-01   +6.749277103979711e-01   +2.511563754891361e-01   +2.008921949481717e-01   +8.856940063894368e-01   -1.735910020798157e-01   +3.000535365875334e-01   +4.359164416132207e-01; -8.291548485119464e-01   -4.760123351865431e-01   -2.903107998662205e-01   -4.133657203685561e-01   +6.744983988645313e-02   -6.712435089392468e-01   -1.385693927047391e-01   -2.499905320602817e-01   +6.356503841231282e-01   +5.236893777790322e-01   +8.287267050852862e-01   +4.424388394184053e-01   -1.454371284040713e-01   -1.072088546897100e-01   +3.282244558191955e-01   +1.213097645129437e-01; +3.361278063734296e-02   -5.151148101489740e-01   -6.149421937057710e-01   +2.130315139889098e-01   +5.822666758319341e-01   -3.247623122151038e-01   +3.526910922689861e-01   -8.553354268782256e-01   +4.691666653113825e-01   -3.706855021304987e-01   +3.418707617035985e-02   -8.888921824370286e-01   -4.726676569124499e-01   -1.059710931232575e-01   -4.159644825637858e-01   -4.862608534122108e-01; -1.444164213694878e-01   +2.136529756158154e-01   -4.444252994239875e-01   +5.455802841527785e-03   +6.528808627721614e-01   +2.761865109736201e-01   -5.199482204282319e-01   +2.238304275595572e-01   -2.814743896415821e-02   -4.597226037856452e-01   +3.940503678773808e-03   -3.617657237962195e-01   -7.212280170686521e-01   -6.351935861487136e-01   -4.808494005620813e-01   +2.305800258553281e-01; -9.739099539577541e-02   +5.250153035976511e-03   -1.851104836413993e-01   -3.690187111066941e-01   -9.838333460457283e-02   -2.665239795732998e-01   +1.835872276806334e-01   -7.138821143204018e-01   -1.849611294548837e-01   +1.168535250734973e-01   -4.378813871420771e-01   -2.078397778505014e-01   +3.937148359542147e-01   -6.726967838708518e-02   +8.486982724608166e-02   -2.190847999523860e-01];
L1E_L1I_iGABA_netcon = [-1.443978867269882e-01   -2.680158613523807e-03   +2.942023299467718e-01   +1.621171124154940e-01   +1.832556377259201e-01   -2.423566669197615e-01   +7.421825810588415e-01   -2.315983621596657e-04   +4.502467325063924e-01   -3.612594375461378e-02   -1.787051209727426e-01   -6.066750605192912e-01   +6.347399545739699e-02   +1.712863471774362e-01   +5.020810027475135e-01   -2.802225040126821e-01; +8.628862522174026e-01   +1.466297997754256e-01   -3.051666516581050e-01   -2.382112735064723e-02   +2.748415146951679e-01   -3.089297939325165e-01   -1.745004312198360e-01   +2.119843617798045e-01   -4.185096764186676e-01   -6.753014002118599e-01   +3.998769786427907e-01   -1.319625776827580e-01   -5.975283001560994e-02   -2.530562363382352e-01   +5.551512068501345e-01   +2.331996613176824e-01; -5.875359433747115e-01   +3.002547744699032e-02   +3.923983172373244e-01   -6.621105959788671e-01   +7.384920490483486e-01   +3.131426282972738e-01   -1.271323269105615e-01   +2.027440644343872e-01   +6.124567135247194e-01   +4.421808083302701e-01   +3.994134886962559e-01   -5.483285683626313e-01   +2.460312475420695e-01   -5.228844893789479e-01   +6.590616574871696e-03   -4.523810919922914e-01; +5.983881699270349e-01   -1.047851864949303e-01   +5.079053700671021e-03   -3.056167430070869e-02   +1.329124698353053e-01   +3.741430941124690e-01   -2.211883116838921e-01   +3.842288317026257e-01   +3.264633601437825e-01   -3.658707772754021e-01   +5.150550748981333e-01   -4.868246118657164e-01   -2.517141275157095e-01   -5.425401073534591e-01   -4.914408708679496e-01   -5.537998812189907e-01; -3.144818255779099e-01   -8.730241025048210e-02   -2.846783058527873e-01   -3.981777011388256e-02   +1.889620919701704e-02   -2.215645822681346e-01   -5.319364675428764e-01   -3.588016732235033e-01   +1.677291953075745e-01   -1.015715101525061e-01   +3.095192328703222e-01   +1.056942718832149e-01   +5.406064901036335e-01   -1.268834347249833e-01   -7.916816075771280e-02   -2.898460044623146e-01; -2.169958243718175e-02   -2.023095491317642e-01   -8.678681001666939e-02   +5.380787541852915e-01   +2.522873198623837e-01   -2.359946648948495e-01   -4.823705775264552e-01   +1.941976028738190e-01   +2.700122452999182e-01   -3.675916046787749e-01   +4.289701748205680e-02   +4.871653220505026e-01   +3.806584340516930e-02   -3.220691860840285e-01   +1.074915157727986e-01   +2.234710138195766e-01; +2.802766905246215e-02   +2.244269368846350e-01   -1.104090750865500e-01   +1.640757295330078e-01   +7.172935303983099e-01   -2.085827895750187e-01   +2.140511897012575e-01   +3.965206891075604e-01   +4.317724136286995e-03   +1.889392293361063e-01   +2.654898621839251e-01   -5.324734299841897e-01   -3.018648261487528e-01   +1.317312523599991e-02   -3.163129828279675e-01   -1.312426671064431e-01; +3.471849082029388e-01   +4.542156088628512e-01   +5.994592130152853e-01   -5.260252196714663e-01   -8.977620065028329e-02   -5.783329725078454e-01   -3.909383200234639e-01   -1.719771283138980e-01   -2.087577597370743e-01   +3.693158583182379e-01   +1.874466900397056e-01   +6.787375698774966e-01   +5.474505117531895e-01   +1.271164808434152e-01   +7.464017238753784e-01   -2.966550382662612e-01; +2.863940617669109e-01   +4.181885871072162e-01   +1.248671633399810e-01   -3.354789376851137e-01   -1.719859651791434e-01   -5.163965735203079e-01   -5.700813369480320e-01   -5.950649624061415e-01   +1.402202388441356e-03   +5.438358367437441e-01   +2.795116315862621e-01   -2.262151269129684e-01   +3.973438886723360e-01   +2.021488570140373e-02   +1.891399181976794e-01   +6.183060580873802e-01; -5.547275899909357e-01   +1.427593035797476e-01   +5.007394340926185e-01   -1.983457710145815e-01   -3.072917889782244e-01   +4.101026226402384e-01   +4.172907040737667e-01   +6.971425513074930e-01   -6.335429520064139e-01   +6.637227743492745e-01   -2.030035874230783e-01   +4.729201309872664e-01   +1.407883232753515e-01   -1.983147778335705e-01   -6.144342373926373e-01   -1.877291313864722e-01; +7.005368959992863e-01   -7.519871501594518e-02   -1.868147546896420e-01   -6.116025949699554e-01   -6.918661877324490e-01   -3.979295250722880e-01   -5.032046885604662e-01   +1.839351908717508e-01   +4.851770993939779e-01   +2.255050991900321e-01   -3.198186405619863e-01   -1.019048000220838e-01   -2.403861713568063e-01   -1.855166866365629e-01   +2.838026753974927e-01   -3.513281215717241e-01; +1.048418815842485e-01   -8.159737516688642e-02   -2.357998656539823e-01   +2.736328565845544e-01   -4.517549178413915e-01   -6.472623309397109e-01   +1.306192477923829e-01   -5.646738265212917e-01   +1.131100539619620e-02   -7.052186216199555e-02   +7.198941726010503e-01   -7.508251031174688e-02   -2.548285736799807e-01   -8.196272558009240e-02   -5.850061014977939e-01   +6.154441930570507e-01; -3.152759966936771e-01   +3.787815165301947e-01   +1.413120333797539e-01   -5.765597457437599e-01   -3.149824841858787e-01   +6.409660156689301e-02   -3.748636198667336e-01   +2.739937026832840e-01   +7.909506296908056e-02   -2.850918950300292e-02   +1.715746776291628e-01   +6.968857466236310e-01   -1.457289113520154e-01   -5.526283182556686e-02   -4.327422437750236e-01   -2.324873728041845e-01; -5.264137555867363e-01   +2.239211029356871e-01   -3.358529805067546e-01   -7.487045319699620e-01   -1.725437850642443e-01   +1.434175230747328e-01   -4.743431608253552e-01   +6.968792976387757e-01   -1.834548623874138e-01   +1.770058325854039e-01   -3.407548308764178e-01   +7.141830323567688e-02   +3.442526809509307e-01   +1.182496334656291e-01   -7.506482641076516e-02   -5.430601834523944e-01; +5.058167306088102e-01   +1.414231598179258e-01   -5.685274418408366e-01   +4.024139486814813e-01   +5.710799099444799e-01   -4.036518660008239e-01   +3.163122570344774e-02   -6.331042141143745e-01   +8.434264476312084e-01   -1.756548761554347e-01   +9.730595685586735e-02   +4.500292360029689e-01   -2.047521118820344e-01   -3.235312733575021e-01   +3.990441772578011e-02   +2.868470722501278e-01; -7.933071979408273e-01   -4.045101260042607e-01   +2.158954870236028e-01   -3.691783991349763e-01   -1.047988125742123e-01   -3.377202216618196e-02   -1.844078532952141e-01   +7.460467870953473e-01   +4.151356805616688e-01   -8.093493485760889e-01   +3.777222071310597e-01   -6.361654696833242e-02   +1.000000000000000e+00   -2.513881687681110e-01   -5.078919166660648e-01   +2.101390529648366e-01];
L2I_L1I_iGABA_netcon = [-3.274806309999931e-01   -3.462852663195415e-01   -2.688047940954492e-01   -2.117619912530602e-01   +3.702761543061774e-02   -4.157166019439836e-01   +6.219431778236488e-01   -1.701905355498375e-01; +1.412373486993858e-01   +5.440599066779070e-01   +1.427137214283028e-01   +4.761164689448072e-01   +1.500085765850427e-01   +6.538702095794272e-01   -2.706877063901380e-01   +4.772960227430176e-01; +1.061179976294757e-01   +8.232834809070725e-01   -1.000000000000000e+00   +1.616318641662735e-01   +9.745515828407837e-02   -5.849048908837091e-01   -5.342716190131493e-01   -3.123393027210392e-01; +1.532111561115505e-01   -4.871994812579027e-01   +6.267922823579666e-01   +3.255571472347570e-01   -5.151383708306738e-01   +6.092351893866343e-01   +3.854904084564525e-01   +7.489723591343005e-01; -6.777728868434434e-01   -1.174926992885323e-01   +8.769236098792578e-01   +3.992312248058395e-01   +6.257199595494747e-03   +3.325229582864672e-01   -3.196453003439778e-01   -3.083245354226481e-01; -2.912927474423799e-01   +6.202211907599069e-01   -5.160652298688674e-01   +6.161529702476821e-01   +5.145947307130316e-01   +1.673589118912708e-01   +2.461886480534528e-01   -5.861244118267488e-01; -7.594215024421206e-01   +5.096705752489471e-02   -4.007055619989376e-01   -7.359013022548182e-01   -5.663998035269099e-02   -3.504302443813798e-01   +2.033458987501889e-01   -5.919224547973666e-02; +2.075520429404424e-01   -6.024209022679300e-01   +2.983686783530729e-01   +7.242663954416427e-01   -5.476502479840435e-02   -2.901984324923575e-01   -5.275042726028908e-03   +4.058979189875686e-01; -1.953860313247990e-01   +5.749551627972798e-01   +2.000579806539941e-01   +5.331575816358038e-01   +6.105712601817025e-01   -4.151791825831040e-01   +5.403193227032901e-01   -6.187174294292794e-01; +4.026755651667885e-01   -2.730311497380046e-01   +7.848730928895730e-01   -3.421297269627936e-01   -3.043596134114158e-01   -3.361177424214679e-01   +7.031661991759823e-01   -2.373577908570193e-01; +4.371477366468465e-01   +6.310325925695340e-02   -3.618744442028903e-02   +5.869320451127246e-01   -4.352714588191351e-01   +4.162534301974242e-01   +6.780339632755539e-02   -5.075845505621629e-01; +5.240848880147574e-01   +3.143376249475703e-01   -2.117652456495204e-01   -4.574874671408471e-01   -3.346617210226965e-02   +4.076548938607599e-01   -1.188945882919464e-01   +1.491619507946135e-02; +4.891738702180524e-02   +5.915031310701562e-01   -2.804143341113772e-01   -6.468949666379209e-01   -3.005926039975167e-01   +1.319584293750146e-01   +2.085898620478801e-01   +6.530143307980560e-01; -1.870788941959241e-01   -2.957507677873953e-01   +4.114119657188898e-01   -3.272761800342271e-01   -5.242712978598294e-01   +6.117194946896618e-01   +2.599552689083495e-01   -1.696713008465492e-01; +3.025981168406598e-01   -2.236209339507801e-01   +7.206109830850733e-02   +1.394606546932990e-01   +3.181649622814502e-01   +3.652740270927904e-01   +4.538439800072721e-01   +2.014553754052081e-01; +1.441530596554984e-01   +4.804218775527440e-01   +1.615452245045781e-01   +6.031947888878839e-01   +1.710206282499235e-01   +3.578517177426720e-01   +3.520657538588842e-02   +8.774731828671114e-03];
L1I_L2I_iGABA_netcon = [+3.126496608317231e-02   +6.686100680818281e-01   -1.387379763207123e-01   +5.427798393212961e-01   -6.325149104887428e-01   +9.076143194881531e-01   -4.606577981006205e-01   +8.586965500606416e-01   +5.084706359631715e-01   -9.444220406188051e-01   +6.388422378301951e-01   +9.602561108972687e-01   -8.792204863229997e-02   -3.193228004296055e-01   +1.000000000000000e+00   +9.440999910373272e-01; +4.101594557014777e-01   -5.164579740377980e-01   +4.035187060457026e-01   +1.695768732458846e-01   +4.459711355310225e-01   -4.330801144275940e-01   -1.994802393780220e-01   -8.460198437787623e-01   -5.782642801114266e-02   +2.630441437802146e-01   +1.179791563913342e-01   +5.446850050400969e-01   -6.536784128718450e-01   +8.239292730490363e-01   -6.264000223386311e-01   +2.459036988449272e-01; +7.302568147597929e-02   +3.787435827364257e-01   -2.444037993406414e-02   -5.704279030811479e-01   -5.617014285985741e-01   -6.834055405456078e-01   +5.364528340593216e-01   -6.013777188723398e-01   -6.927686070137079e-01   +5.243204350664179e-01   +3.001344250934646e-01   -7.325507272137521e-01   -1.862361288681942e-01   -8.024804683177632e-01   -3.358638813114522e-01   +4.065877562108804e-02; -3.179323856415565e-01   -4.915854805700478e-01   -5.815941959723834e-01   -3.680001592463938e-01   +2.804386757972495e-01   -1.223739198897445e-01   +2.755947900637821e-01   +3.467235366630371e-01   +1.948862807936929e-01   -1.287384538355405e-01   +2.458059499531600e-01   -4.120048654295741e-01   -7.383932910279181e-01   -8.519835473736937e-03   +7.358740243346810e-02   +4.421212479009411e-03; +3.608621121307835e-01   -9.003224187609474e-03   +4.490975066924913e-01   +2.775117260690678e-01   +5.632304554151746e-01   -7.010036506917896e-01   +3.417437868256987e-01   -4.631076345561229e-02   +1.409448955918693e-01   -1.947220257870317e-01   +2.485502425291245e-01   +1.591197579697854e-01   +2.398141580701288e-01   -5.444127448178205e-01   +3.319952733358471e-01   -7.591369320737407e-01; +4.596300555926252e-01   -8.429198654952065e-01   -7.277221418976922e-02   -6.553343488790155e-01   -3.898100714684567e-01   -2.371627331485406e-01   -2.296204972242989e-01   +7.504953969769400e-01   +3.968365355358470e-01   -4.910350981630350e-01   -4.837256723644836e-01   +2.624199177880593e-01   -3.166156790558201e-01   -1.725510269257086e-01   +3.068260388677408e-01   +1.566065865358323e-01; -8.695119004532563e-01   +2.292964510075766e-02   -4.318506548618260e-01   +5.362542157476210e-01   -2.884422059297627e-01   -6.149065817406729e-01   -3.212413362733247e-01   +5.928937364288117e-01   -4.341632710584142e-01   +6.147881191539862e-01   -4.051903435511254e-01   -3.130561856359632e-01   -2.031355987138983e-03   +4.723917677695554e-01   -7.195911327069747e-01   +6.188198512771820e-02; +1.605561459985739e-01   -7.388875796562309e-01   +7.541300036242374e-01   +1.948009654121446e-01   -2.132186800957568e-01   -2.299868445487780e-01   +3.598188805387424e-01   -8.289651626057732e-01   -1.898483951346664e-01   -3.071114090619811e-01   +1.390685557532778e-01   +3.812057420294552e-01   +7.805532529610801e-02   -8.436731381592975e-02   -8.175846827250339e-01   -6.682832090370230e-01];
L2E_L1E_iAMPA_netcon = [+5.468760035148557e-01   +3.612631836244558e-01   -3.485407826446128e-02   +1.635920592820179e-01   +7.420397271191322e-01   -6.570289522981535e-01   -3.170021662867928e-01   -2.518051033406450e-01; +6.969382463217447e-01   +7.475903366420416e-01   +2.927258623374825e-01   -4.841501070514756e-01   -2.959715595537050e-01   +8.482679484382850e-02   -8.505767597221069e-01   +1.669812598706224e-01; -4.751170756027817e-01   +6.151551175164841e-01   -4.622649645109223e-01   +2.025815167771353e-01   +4.813798954030169e-01   -6.654440800065643e-01   +6.936670158098540e-02   +7.496396001771547e-01; +9.027333851526611e-01   +4.748526964284181e-01   +7.223511116769397e-01   +9.710565699066706e-01   -9.570191141578300e-03   +3.684675486652346e-02   +5.377411401977663e-01   -5.100788408467331e-01; +9.820362016099213e-02   +5.298509794939166e-01   -2.175349344662850e-01   +8.440228569549770e-01   +1.673161320322062e-01   +8.620256252742196e-01   +7.673107195179869e-02   +5.114273615393730e-02; -9.695754582611953e-01   +6.338374564150017e-01   +7.368842624150426e-01   -3.404148203630885e-01   +1.150385362549068e-01   -8.138310281400110e-01   -4.294585948180106e-01   -6.120241735782238e-02; +4.961065923394803e-01   +2.759312465690823e-01   +4.323806910232473e-01   -6.782712514165447e-01   +2.617393131151946e-01   +6.266609487897186e-01   +1.049368798409202e-02   +6.637573930774097e-01; -9.667643515243057e-02   +5.488593819832230e-01   +8.163155998498703e-02   +3.924383357202708e-01   +2.934445900067567e-01   +7.874700479181547e-01   +5.642645772377521e-01   +8.949283017542496e-02; -3.506117192077401e-01   -5.392159927121221e-02   +2.831670291879909e-01   -4.043374949992986e-01   -4.457778313316467e-01   +5.652030754515890e-01   +4.194998494907904e-01   +1.083551883472659e-01; -6.806634723207142e-01   -9.396336173189116e-01   -8.113858802371073e-01   +8.585909477125843e-02   -1.509101425625606e-01   +7.037663679980215e-01   +7.825510976460967e-02   +8.926567407841111e-01; -5.895516811868415e-01   +9.517534481093606e-01   -8.041486394322475e-01   +6.967500577038771e-02   +3.892465099029754e-01   +6.069583460564031e-01   -1.331776885983511e-01   -4.111503971886569e-01; -1.894973856835420e-01   -7.319837905930131e-01   +6.279887580899377e-03   -1.809250641898797e-01   +7.469700295523951e-01   -5.261084144340715e-01   -2.655151151374589e-01   -2.529816943918301e-01; -9.278786016879373e-01   -3.645848162839040e-01   +6.630792673401465e-01   +4.209460050136477e-01   -3.820875904045939e-01   -1.508473420549494e-01   -1.319206037248258e-01   +5.295139867415389e-01; -1.393504874825965e-01   +4.720026894570532e-01   -1.553423070966315e-01   +3.916234061561500e-01   +3.945830419768037e-01   -6.113148751464972e-01   -4.403325195627723e-02   -4.731481009903546e-01; +3.091177666168675e-01   -6.008919190993847e-01   +6.886530917299382e-01   +3.604325408815860e-02   -5.628700391269508e-01   -3.804636444458807e-01   -1.804684696202383e-02   -2.894394454400623e-02; +1.000000000000000e+00   -4.728664149240528e-01   +6.787261171462530e-01   -8.205253459838223e-02   -6.495765315132564e-01   +3.144522026515875e-01   -6.292658931822902e-01   +4.863891612297490e-01];
L1E_L2E_iAMPA_netcon = [-3.309619624174331e-01   -6.110550676600184e-01   +9.865567409868184e-01   -1.000000000000000e+00   -6.684896653290675e-01   +2.722123644119626e-01   -1.440494545977810e-01   -5.864739835591924e-01   +3.168650024892226e-01   +2.630536584682019e-01   -6.070663515087853e-01   +5.740929862730205e-01   -5.274399100797126e-01   -6.854853545143380e-01   -1.876754839549085e-01   +3.165439506090036e-01; +3.856079430475030e-01   +5.876914315551673e-02   +5.368069115587153e-01   +6.850954853435746e-01   -3.509112691975568e-02   -7.768306042532434e-01   +6.491039560096404e-02   +4.359903523674555e-01   -2.747162458059198e-02   -2.256153876642707e-02   +2.969363601390519e-01   +7.262066419209559e-01   -5.723830812677944e-01   +1.926341793780890e-01   +1.216286735314844e-01   +4.342855597238215e-02; +7.663234161560158e-01   +1.668018208984781e-01   +7.298248112913217e-01   +7.761049416299619e-01   +7.982930445816934e-01   +3.342968764223453e-01   +2.215613566175682e-02   +1.818724471435390e-01   -4.152785815127714e-01   +2.489521759134145e-01   +4.896590856358636e-02   +3.800279059491307e-01   +2.553125475619932e-01   +3.099504306685085e-01   +4.628147329603745e-01   +7.035357891649370e-01; -4.286873618447574e-01   -5.751813489544597e-01   -4.947986890385693e-02   +7.286566452852663e-01   -6.671031402538303e-01   -2.232774136183920e-01   +3.849100441540994e-01   -4.303190785761469e-01   -3.872273643493629e-01   +3.493047980777447e-04   -5.696122176993085e-01   -1.201422902176990e-01   +5.372190733130656e-01   +6.176948659693235e-01   -8.217414418331001e-02   -3.327076232822169e-01; -2.693882344751114e-01   -1.762358517072886e-01   -5.208049325627552e-01   -2.693829025044273e-01   -5.329826629750172e-01   -9.182013232834244e-02   -5.015014548252532e-01   +3.444586012495850e-01   -3.089013959636901e-01   +4.696733488632462e-01   -1.499866293975935e-01   -4.117287297113441e-01   -1.667059302241512e-01   +4.150279234486043e-02   +6.445794849887171e-01   +5.320785527271950e-01; -7.757570790432649e-01   +4.718545237269901e-01   -6.031386626156525e-01   +8.650139085225955e-02   -5.926597381029535e-01   +8.993562128404686e-01   -1.474212417109867e-01   -3.360777904021838e-01   -4.557353084808677e-01   +4.136890879070629e-01   -4.535745888084285e-01   -2.481874360119991e-01   +5.893920718826245e-01   -3.376212761854228e-01   +3.839059152552137e-01   +2.055527376044093e-01; +2.256324330817817e-01   -5.012124996558770e-01   -4.462320346864195e-01   -3.658794248492999e-01   +5.813670603517193e-01   -2.001735530667139e-01   -9.115071647411210e-02   +2.300781517168102e-01   -5.136889557694722e-01   +7.782970585909069e-01   +3.224878339342933e-01   +3.620966062719225e-01   -8.377229519748324e-01   -2.194090764936868e-01   +3.912449555515201e-01   -7.352545454288421e-02; -7.325805291689460e-01   +8.487982847862613e-01   +5.269413114174658e-01   +5.249503192456483e-02   +9.684289053707239e-01   +2.127814264004224e-02   +5.335869949399622e-01   -1.232328794147620e-01   +2.872329985166488e-01   -6.766517036022789e-01   +4.099746780272692e-02   -4.337810487840411e-01   -6.040399579609244e-01   -6.007602546534306e-01   -1.339226427969707e-01   -5.098235467530544e-01];
L2I_L2E_iAMPA_netcon = [+7.689433298457581e-01   -1.860773532407331e-01   +7.010750769283667e-01   -2.874677183338240e-01   -3.351275513999037e-01   -1.774313115592648e-01   -8.393542982725987e-01   +1.456154268657606e-01; -3.107627476682687e-01   +2.727622498637894e-01   -4.283453633987546e-01   -5.695031353039856e-01   +3.298237997860458e-01   -1.000000000000000e+00   +4.723690332088630e-01   -8.256324552376610e-01; -1.592183960327886e-01   +4.536156131630703e-01   -5.289941119521349e-01   +3.832288009011059e-01   +7.450701587562139e-01   -4.649970581120847e-01   -9.936361345399100e-02   +1.126594123874240e-01; -2.642690088058947e-02   +3.183944438624419e-01   +2.496894229587708e-01   -1.092269116203000e-01   +8.431908279670016e-01   -6.170747090725852e-01   +6.945779911871412e-02   -3.387051363464424e-01; +5.083983471079383e-01   +1.345835080268275e-01   -7.619159562051505e-01   +2.520240450365325e-02   -9.008192368272631e-01   +2.700701301870554e-01   +4.990259799537923e-01   +3.438209615802996e-01; +5.058092389783969e-01   +2.623290530455205e-02   -6.493452387441488e-01   -8.912669453742492e-01   -3.977053324867318e-01   -2.424455283271237e-02   -6.449888862256501e-01   -4.698998988331901e-02; +6.880325984386900e-01   -2.683716884234924e-01   +1.028978611894305e-01   +6.945931923550667e-01   -5.518738791637924e-01   -5.625605984623654e-01   -4.063944563231657e-01   -3.958195321922626e-02; -7.168609665214621e-01   +2.273285884185305e-01   +1.245830773137066e-01   -1.326125254624172e-02   +2.549329787381428e-01   +7.057036890957693e-01   -1.690587298483913e-01   +1.974905957110128e-01];
L2E_L2I_iGABA_netcon = [+4.836087078858998e-01   +1.153715522214870e-01   -1.275298440525273e-01   +1.373656780507133e-01   +2.976344542558098e-01   +9.843236050946853e-02   -1.069773810504237e-02   +2.474412961619280e-02; -1.307169780128918e-01   -2.929828094543236e-01   -3.214026574602118e-01   +9.564889621308440e-01   -5.214104844877520e-01   +3.256857173632030e-01   +5.334441364293199e-02   -2.398845758666671e-01; +4.041860091593679e-02   -7.789501270098111e-01   +3.493023277790846e-01   -5.487390493841264e-01   +1.000000000000000e+00   +6.010467695338990e-01   -2.993148488398366e-01   +5.726714769593571e-01; -5.179301292003312e-01   -2.648935267852205e-01   -4.990507737335980e-01   -2.635546042120385e-01   -5.115479820183290e-01   +1.255041844126680e-01   -4.541816530820598e-01   -5.464157900790608e-01; -6.602914135367288e-01   +1.086898122969043e-01   -2.797901431741231e-01   +3.083697757348585e-01   +8.189161052029956e-02   +1.086308783232900e-01   -3.222912780648605e-01   -5.673865713860414e-01; +2.873389849785174e-02   +5.608807627576564e-01   -3.587743606703103e-01   -8.552511703185707e-01   -8.604950509890161e-03   +2.426005351816601e-01   +5.338676657916135e-01   +2.352567869975804e-01; -7.279548190155031e-01   -5.999985988842912e-01   -3.167607942659838e-01   +4.446174479589335e-01   -4.871723412755323e-01   +7.156388365481252e-01   -5.196221331941691e-01   -2.937750472801846e-01; +2.808680058948799e-01   -3.198334287262495e-01   -5.003759922228742e-01   -3.504320358125813e-01   +7.749768475157556e-01   +3.115845984981127e-01   -6.837236556188045e-01   -9.746489669841676e-01];
L3E_L2E_iAMPA_netcon = [+9.352625270290802e-01   +2.567013273551709e-01   -9.485015892283744e-02   +8.469725151155113e-01   -1.916089859043287e-01   +8.873557329250549e-01   -2.041121020571673e-01   -1.300301343461216e-01   +1.588039977991523e-01   -2.634828035139197e-01   +1.803321657657383e-01   -2.599868220592821e-01; +4.858974272558529e-01   +4.692104993005652e-01   -1.597226253424438e-01   -8.431319985168460e-02   +3.051746108472301e-01   +4.535869474445601e-01   +3.755101342868520e-01   -4.249725442116736e-01   +6.505914000686155e-01   -4.140100427237725e-02   +8.503300510880658e-01   -2.149306390213425e-01; -1.786360674138462e-01   +5.213908260166270e-01   -6.896364007024898e-01   -8.224313817425165e-01   +2.637731003785878e-01   +5.516955973341303e-01   +4.331873539996770e-01   +7.755829531448097e-01   -9.033371142550024e-02   -3.912844804397159e-01   +1.176522309910771e-01   -6.414864101612963e-01; -1.939998022519160e-02   -1.669782675317248e-01   -1.124192501745228e-01   -9.398452473770279e-02   -2.134309411498054e-01   -4.197156412777074e-01   +3.454665456277463e-01   -4.257092268637671e-01   +4.335506394392544e-01   +3.727802117089138e-02   +2.566398643058352e-01   +6.196286636893037e-01; +3.195750085804455e-01   +3.912300537495786e-01   -1.597924262881270e-01   +5.072408062560148e-01   +8.111746773730774e-01   +6.148354697216921e-02   -3.907835455413525e-01   +6.520269638511349e-01   -4.305497639163807e-01   -7.313352585111618e-01   +5.439193589507192e-01   +3.271658007324634e-01; +1.144676462344496e-01   -2.038390332121279e-01   -4.105084442082997e-01   -6.957949850260349e-01   -1.038695617113890e-02   -4.073200149517734e-01   +4.557144844829610e-01   +6.188905977666370e-01   -5.567997991394840e-01   +4.916140042668776e-01   +6.136029019375226e-01   -8.633104767108957e-01; +2.357153915994083e-01   -1.098705550388529e-01   -6.715328053663469e-01   -5.915325709875940e-01   -6.260645786265698e-02   -2.395473071133336e-01   -4.408549996356944e-01   +5.806602942317174e-01   +3.020962627939350e-02   +1.000000000000000e+00   -1.942635304899152e-01   -7.466966792076737e-01; -8.996009268744612e-02   +2.710169247480824e-01   -5.858517194967957e-01   +1.899682875414179e-01   +6.787490542763229e-01   +8.689739965548201e-01   +1.963831209795673e-01   +3.186355269788333e-03   +5.211538105283944e-01   +9.818255082651270e-01   -7.775460558632916e-01   -4.575641409388996e-01];
L3I_L2I_iGABA_netcon = [-5.309024251886394e-01   -1.323635004275527e-01   -4.555340847340238e-02   +4.906504683241120e-01   +3.614983338504602e-01   -5.606141217195671e-01   -2.023980922463042e-01   +2.368336656414208e-01   -6.507543091127045e-01   +2.335010244934247e-01   +2.078521174999747e-01   +5.162996944617806e-01; +2.968196240529825e-02   +4.270313798118323e-01   +5.285383270729388e-01   +7.286664866037245e-01   -5.792833462858462e-01   -3.573997776276553e-01   -5.609270464230571e-01   +2.810537470368298e-01   +2.792889080525059e-01   -6.567354038995477e-01   -7.959660957664763e-01   +3.644950390285112e-01; -1.456970803217111e-01   -9.101848531101822e-01   +4.025664576493842e-01   +4.928505928267060e-01   -6.445786880554656e-01   -4.169413352368038e-01   +7.702268955246873e-02   -3.915260683180681e-01   +2.821693263272407e-01   +6.329627543331619e-02   -4.191973233675522e-01   -3.698432089453829e-01; +1.948629840708275e-01   +7.501303573472954e-01   -9.961021626786163e-01   +1.603915462761224e-01   -1.276873890179905e-01   -4.987109770788292e-01   +6.469378800422945e-01   +8.484191110771169e-02   -3.512863949115305e-01   +8.019214714934845e-01   +4.195774180569969e-01   -5.465613031971939e-01; +4.236597888894006e-01   +6.010644870938813e-01   -2.027363537119073e-02   -2.622995949082015e-01   -8.737882523838378e-01   -1.438613948940075e-01   +1.497911617534919e-01   +1.508798354416170e-01   -4.488328200783501e-01   +4.027933346086426e-01   -5.795665577940305e-01   -2.471716505232091e-01; -4.095352671350792e-01   +1.597038718948207e-01   +3.293108517543226e-01   +5.191114337524957e-01   +1.148371905967089e-01   -4.516567326138428e-01   +5.095200854522210e-01   -6.039920650263518e-01   -2.911995003688021e-01   +1.420263370759584e-01   +5.292507127086591e-01   -4.880494634403392e-01; +7.147575263375752e-01   +1.000000000000000e+00   -1.750672500456584e-01   +2.084179861270854e-01   -5.104373864340280e-01   -2.456775374745706e-01   +5.405490300506278e-01   -2.345859014307434e-01   +1.973336834293034e-01   +3.328034581539370e-01   +5.064666015034411e-01   +1.940163883347671e-01; +2.881249917689567e-01   +4.862124096743776e-02   +3.019527770694944e-01   +3.629530072790810e-01   -3.698803570069899e-02   -6.755940247251104e-01   -2.777920927551121e-01   -7.094753300874801e-01   -4.245563811203759e-01   -1.090872348236731e-02   -4.101747665354993e-01   -6.201001115376200e-01];
L2E_L3E_iAMPA_netcon = [-3.604852201610153e-01   +2.775362867019567e-01   -3.495004619342423e-01   -1.231446072560140e-01   +5.685820285824359e-01   -3.755143900635712e-01   -2.787607227851905e-01   -3.685161874799743e-01; +3.134393320752354e-01   +3.128575062270332e-02   +4.466946223906142e-01   -3.241115181951117e-01   -5.115803141064970e-01   +1.904100552753465e-01   -5.122232673340241e-01   +2.642593806638337e-01; -4.736091639618658e-01   -9.454929621448029e-01   +3.370355071549936e-01   -4.159084588646921e-01   -2.774514493587629e-01   -3.108003915371375e-01   +7.362781225284653e-01   -4.644224334642523e-01; +3.825743967484194e-01   -5.758953619837217e-01   -7.039637353156626e-01   +8.607411370322289e-02   -1.488257947620849e-01   -3.654412245003484e-01   +5.451408664402595e-01   -4.489424836923330e-01; -2.174145702187419e-01   -7.434980726740252e-02   +2.617378969406423e-01   -1.391549280436935e-01   +1.542772652406531e-01   -4.733559094217365e-01   -1.668990733169479e-02   -9.506686217087637e-01; +3.741142217555148e-01   -4.772092163653137e-01   +6.028694863251687e-01   +5.919795753159139e-01   -1.000000000000000e+00   -2.203181614016340e-02   +3.874877841919186e-01   -3.335597765138420e-01; +4.234745524435589e-01   -4.689955460890661e-01   +5.931904685759393e-01   -3.824604458966196e-01   +2.811691290347843e-01   +4.356043507395929e-01   -1.895568139239876e-01   -2.951908337325309e-01; +4.571115272373263e-02   +4.744913694177504e-01   -7.746272464587377e-02   +7.763628174748174e-02   -3.619466391219026e-01   +5.702918606724986e-01   +3.630190033064240e-01   +3.618431377682087e-01; +5.629790350410130e-01   +1.397875891034027e-01   +9.418688998020226e-02   +8.330162030256497e-01   +4.497453878644592e-01   -1.139091923644933e-01   +1.233186157092853e-01   +3.401271363759858e-01; -3.653036187595056e-01   -2.715084978415514e-01   -8.145167728737096e-02   +8.561259883121808e-01   +5.159810592927532e-01   -2.294599378196013e-01   +3.278102245295362e-02   +5.739277568400419e-01; +3.791743073062952e-01   +4.864833102503051e-01   -1.085334942763140e-01   -2.786030266575273e-02   +5.474940069002958e-01   +1.078299181609734e-01   +3.822088619479842e-01   -2.802248067343722e-01; -2.698344997061745e-01   -1.617232097130563e-02   -8.816891945666852e-01   -2.551689007319727e-02   -8.997676034808418e-02   -3.571865929255835e-02   +4.190306408476147e-01   -3.187099548002666e-01];
L2I_L3I_iGABA_netcon = [-1.000000000000000e+00   -1.250651867082661e-02   +5.342314702135259e-01   +4.413672777586112e-01   -5.167850307588167e-01   +5.584596601931169e-01   -5.447345765455118e-01   +6.030094328487032e-01; +6.794781381404758e-01   -6.749833586118310e-01   +2.890608531974932e-02   +6.350842204343929e-01   +2.845163392669474e-01   -5.401257122104791e-01   +8.128419306194709e-02   -8.648288892705493e-02; +2.878394828721454e-01   +4.101444099999113e-01   -5.330369704727509e-01   -2.959171421628591e-01   +6.947488434511386e-01   -2.884207315053585e-01   -1.840224652559020e-01   +1.217926956987710e-01; -2.871918529996854e-01   -5.489249950115839e-02   -1.693869332402852e-01   +2.073191358532261e-02   -2.343945878854693e-01   -1.099907828786047e-01   +3.969019557155770e-01   -3.178887233413096e-01; -8.008824028951952e-01   -9.281270268615099e-02   -2.681164650413128e-01   -8.488691970284486e-02   -2.789150150189552e-01   -4.969758706189432e-02   +3.981254806794018e-01   -5.986487294721466e-01; -2.672267318107942e-01   +3.680378264773099e-01   +4.229411753260591e-01   -4.441665989499187e-01   -4.621431261847716e-01   +6.366397475117469e-01   -3.387709187520754e-01   +5.424467601311558e-01; +3.383182541030091e-01   +7.326445386219848e-01   -3.786347629631634e-01   -9.080051422997712e-02   -1.041727383840858e-01   +3.435690492340642e-01   -5.265345868557048e-01   +7.576873559424092e-01; -9.827766317198967e-01   -4.950097323264406e-01   +1.044334688617135e-01   -3.217870037716065e-01   -4.628177481858538e-01   -5.498180898819887e-01   -1.869114789699000e-01   +7.951655930795362e-01; +2.856324668745764e-01   +7.465136686118946e-01   -6.655953138175848e-02   -8.201143694169030e-01   +3.150604510800899e-01   -6.292408063727828e-02   +1.272450643145746e-01   -4.408193901468530e-02; -1.899312679523891e-02   +2.527326567632719e-01   +7.624083060714562e-02   -1.128145355222935e-01   -6.469223069504100e-01   +2.068525778368294e-01   +5.858888721661757e-01   +3.376371712377629e-02; +5.450168860767983e-01   -5.625116434053525e-01   -3.714893866290366e-01   +8.743734275871519e-01   -3.889540820319711e-01   +3.174000736607615e-01   +7.184616131985357e-01   +3.158861868655119e-01; -4.359239684303033e-01   -8.506457257180426e-01   -1.630884294543738e-01   -2.261995325332682e-01   +1.111561306846572e-01   -3.756755977659562e-01   -6.217384289420138e-01   -3.167727946400445e-01];
L3I_L3E_iAMPA_netcon = [+5.790932434817557e-01   -1.604966437008811e-01   +7.356516695440538e-01   +2.683687842776106e-01   -3.027636532855494e-01   +1.424532174478032e-01   -1.712692957897786e-01   +5.234679466193892e-01   +7.353299805669312e-01   -3.783445518584101e-01   -3.188827273314029e-01   +2.624344004918424e-02; -6.968254402703958e-01   -1.783435529880347e-02   +3.400287920663726e-01   +6.177597860401104e-01   -3.667556090969046e-01   -2.509563323015017e-01   -3.580231144020062e-01   -1.612322312238670e-01   -8.078606496051134e-01   +2.653324423447513e-01   -4.131305851104383e-01   +4.072065488397294e-01; +6.922208776756322e-01   -1.030461410463778e-01   +2.812857395659804e-01   -2.029774681583438e-01   -6.430261243957812e-01   +2.771278297356425e-01   +6.060102486789407e-01   -7.594616998975255e-03   -4.635254286714870e-01   -5.163468112343791e-01   -1.601762419720358e-01   -7.457887243949943e-03; -2.506193534992834e-01   -3.168079815416035e-01   +4.660684409593068e-01   +5.833896955795500e-01   -7.354236057683240e-02   +5.980467579748990e-02   +1.098942334293932e-01   -1.997671162627536e-01   -8.681215358250202e-02   -2.987610962123270e-01   -3.747271795705442e-01   +5.290983835818484e-01; -1.484163834177770e-01   -3.303599063016699e-01   -2.890040889994401e-01   +4.076432672494034e-01   -2.811497344411256e-01   -6.900595604653285e-01   +4.914992641322510e-02   +5.894420585220111e-01   +2.224375703880513e-01   +1.868234151491884e-01   +4.311920941365787e-01   -2.037285854545574e-01; -4.192546716466498e-01   +8.826705110033695e-02   -3.728199777644740e-01   -2.018877915343756e-01   -2.031319142428589e-01   +5.277849784514964e-01   +7.948996775754756e-01   +3.522891040086874e-01   -5.929732278868916e-01   +4.302583873000305e-01   -4.827200614130577e-01   -6.009155884348362e-01; +2.031438313860201e-01   +1.452629820778482e-01   -3.305435182894971e-01   -2.334511927035439e-01   -1.035236524831761e-01   -1.586993910602069e-01   -5.227319923143821e-01   +9.352781924810291e-02   -8.260650235457324e-02   -9.684422335755910e-02   +5.949196032433063e-01   -6.165126643623435e-01; +9.886800865521206e-03   +3.488278976935575e-01   -5.866820227555519e-01   -4.644426916437315e-01   +8.778226359226089e-02   -2.716472331922771e-01   -2.384841842139413e-01   -4.024791355746517e-01   +4.130282699179307e-01   +4.369102508989694e-02   +4.823643479357514e-01   -1.000000000000000e+00; +6.299206705113530e-02   +3.268312268929044e-01   +3.560510664764299e-01   -6.756339369551373e-01   +3.620234262594052e-01   -4.566979010475978e-01   +4.890365404972412e-02   -2.952662580045002e-01   +1.092236894109875e-01   +2.192814909691414e-01   +2.270614669103381e-01   -1.598475323657892e-01; +8.149942998802240e-02   -6.338915301706112e-01   +7.129739581757161e-01   +3.206658509925554e-01   -1.459765134754107e-01   +3.003641265920508e-01   +3.629289750314461e-02   +7.488989176021306e-02   -2.005888759408773e-01   -3.402345414151366e-01   +2.482845519941627e-01   +5.382154618832213e-01; +4.213269145012299e-01   +3.918948213215973e-01   +2.166021359593050e-01   -3.922861942606011e-01   +1.781807451030518e-01   +2.192721201554646e-05   +3.005506763362455e-01   +2.244453720802716e-01   +7.357620776706840e-01   -1.381574738551760e-01   +4.494890829053921e-01   +4.880877090073913e-01; -5.300357753807931e-02   +1.453108849272585e-01   +7.228026144456279e-02   +3.813933701189437e-01   +1.187664310514538e-01   -1.584856219173157e-01   +4.729021381526442e-01   -3.981015634337777e-01   -3.886646419561498e-01   +1.797230270786080e-01   -2.191187898546092e-01   +1.000206519832083e-03];
L3E_L3I_iGABA_netcon = [-4.068359396460846e-01   +2.131062190926810e-01   -3.440319413192735e-01   +4.011148024679601e-01   +5.529481173444002e-01   +7.159746242571209e-01   -3.688586876380957e-01   -5.996695938762654e-01   +5.812694031452325e-01   +3.045514850381927e-01   -2.362333043705986e-01   -3.067248459439254e-01; -4.589599554616319e-01   -1.330334219414022e-01   -3.622467634975131e-01   +8.863511972969301e-02   +6.689058612674347e-01   +6.033144046653072e-01   -5.173285814797968e-01   -1.326966252795718e-01   -3.802985654932965e-01   -4.961963478948611e-01   +3.123288915881289e-01   -4.214776590291777e-01; -2.924268028454920e-01   +3.816701059764143e-01   -5.928934100704057e-01   +2.875264433504761e-01   -1.743098835586208e-01   +3.849594715583188e-01   +7.326527635210404e-01   -4.919030659440374e-01   +5.369096106103021e-01   -3.130126212814079e-02   +3.820811996946943e-01   -6.368241728434351e-02; +2.452100134722734e-01   -3.063277372485972e-01   -4.180099464441876e-01   -1.758819795335297e-01   +1.255636788999642e-01   +4.624912569949142e-01   +6.040965778241201e-01   +1.176261000697212e-01   +5.114758846372897e-01   -1.427271712312993e-01   -4.396010270814502e-01   +5.703487199289156e-01; +3.529322136112769e-01   -4.141253789323034e-01   +2.796937522795256e-01   +3.622024539276054e-01   -7.227980470291184e-02   -1.985007329771982e-01   -1.208895973785846e-01   +1.187177252636849e-01   +3.645769817918091e-01   +4.969265140918444e-01   -2.746434310118799e-01   +7.671609964461206e-01; -7.226141987760796e-01   +2.542189904030759e-01   -3.859733572748031e-01   -3.024147652330563e-01   +2.095308937687503e-01   -3.827991985035631e-01   +4.672397791264717e-02   -7.763223335559900e-01   +1.087280973988661e-02   -7.369992410396771e-01   +9.338306784120820e-02   +1.186398201197014e-01; +1.592299760859281e-01   +3.498292763389024e-01   +7.122201399016643e-01   +5.531039919364080e-01   -1.691817345995797e-01   -1.660534328114574e-01   -3.518144681043286e-01   +5.170260363433992e-01   +7.498789830550178e-01   -5.871629090604642e-02   +3.222545803592477e-02   +2.055897474186832e-01; +6.788976065757273e-01   -2.482446235469067e-01   -2.521667878310869e-01   -1.200955413469896e-01   +7.466748940598093e-02   -1.893831242301596e-01   +1.338583472996639e-02   +4.369186994373400e-01   -1.502700802050619e-01   -4.103865824965908e-01   -4.515648909846080e-01   -3.475290552476592e-01; -1.550871312172864e-01   +4.523310141464550e-01   -1.587601321522015e-02   -2.697407398373575e-01   +3.423587064007971e-03   +6.777484399817353e-01   +1.039107018572243e-01   +7.256235139579359e-01   +1.482352519362030e-01   +1.761704747989363e-01   -4.242238352241891e-01   -8.947690248674968e-02; -5.720457423829340e-01   +1.684161054203830e-01   +1.317037822456414e-01   +3.288048712160430e-02   -2.426971192510761e-01   -5.412906101288215e-02   -7.126429864672178e-01   -3.617563930524531e-01   -9.094125344187880e-02   -6.403154316165500e-01   -8.633113634729687e-01   -4.832417574032480e-02; -5.381618537783339e-01   +3.720518674781098e-01   +5.637656710994493e-01   +1.693986532193026e-01   -3.987069596635689e-01   +5.091902481243060e-01   +5.403107452570755e-01   -2.764405948879742e-01   -7.783000885216652e-01   +4.358896925428769e-01   -3.326238646337554e-01   -1.252230486399919e-01; -8.795853734293407e-01   -3.957445258512015e-01   +1.017179269689686e-01   -4.291296741571878e-01   +6.997670086518468e-02   -3.466549035330029e-01   +6.278745348632453e-01   -1.000000000000000e+00   +1.688936012698367e-01   +6.628760138821866e-01   -3.389300391224777e-01   +3.837058743552371e-01];
L2E_Input1_iAMPA_netcon = [-2.802495791263702e-01   +1.546317836048758e-01   +4.202906911212660e-01   +3.109951972069808e-01   +5.998981150134602e-01   -3.390560554125641e-02   -1.928276944823611e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+5.601822738923986e-01   -2.870338251922719e-01   +8.301623697830495e-01   +4.244296452506649e-01   -4.632303257080665e-01   +8.382172159475410e-01   +3.282325785835353e-01   -1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
