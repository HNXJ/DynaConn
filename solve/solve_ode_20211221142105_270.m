function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.300215249458829e-01   +3.310329574218271e-01   +4.552798178430957e-01   +3.797348605885218e-01   -3.121517964844960e-01   +3.052755448350903e-02   -2.328873149983896e-01   -2.119775729641906e-01   +1.402714497974543e-01   +5.216786626051487e-01   +1.094431190276722e-01   -8.096749246487757e-01   +2.142182779937131e-01   -6.149629404955644e-01   -5.861485726024984e-01   +9.499085886363341e-03; -1.026635016952517e-01   +8.886753581124923e-01   -4.155049964738722e-01   +7.285861637238772e-01   +5.503935940174516e-01   -3.420589780513746e-01   +3.546914734899770e-01   +2.486512565190182e-01   -6.861718185959654e-01   -2.101587304124151e-01   -3.604207086291181e-01   -8.454114366957581e-02   +4.037324709917230e-01   +1.349176914746172e-01   +8.148335622090204e-01   +9.243932497958806e-03; +4.937684047201505e-01   +4.317926510186776e-01   +1.943194713839916e-01   -5.678204357214583e-01   -2.948044841456446e-01   +6.881588139097061e-01   -8.449312996942687e-01   -2.888182103389400e-01   +6.342684304231568e-01   +3.121395858506901e-01   -4.111872463118727e-01   +4.741192890855140e-01   +1.470529962570352e-01   -3.656639296738116e-01   +1.789904331122147e-01   -3.958457716774605e-01; -2.534817449768028e-01   +9.658332781171534e-01   +8.166063185863234e-02   -1.112570338189146e-01   +4.315011904248293e-01   -7.117040268778718e-01   +1.366670832180313e-01   -3.128476762112318e-01   -4.446154516362917e-01   -2.846371729567616e-01   +5.579011129022655e-01   -2.577015587977512e-03   -2.761830123075905e-01   +2.088098172332300e-01   -5.222895423635734e-01   -5.163877201306361e-01; -6.432882424831992e-01   +3.944076947086799e-01   +1.452437549968388e-01   -1.127369595020740e-02   -1.153658941040293e-01   +7.962871756658370e-01   +8.578976020213837e-02   +3.373425231447503e-01   -2.187437772810440e-01   +5.886935732515274e-01   -3.813276513797718e-01   -2.252633182923484e-01   +5.769390231834272e-01   +3.871148516357405e-02   +7.445727896174893e-01   -1.842354572717009e-02; -3.726682304050412e-01   -7.110909505297103e-01   -2.310525103941025e-01   -5.480594092861194e-01   -2.309772487930458e-01   +8.012396641086139e-01   +5.015780797299574e-01   -1.436472467169753e-01   -4.069131541322877e-01   -7.363613859889683e-01   +3.265706919227956e-01   -1.519711858778258e-02   -6.369504894222223e-02   -6.215451963940048e-02   +5.307467660484031e-01   +1.947077039789615e-01; -3.492088301062219e-01   +4.600565806266662e-01   +3.017596970462275e-01   -8.092092287252767e-01   +3.333663282893087e-01   -7.401738517024686e-01   +1.114237698116042e-01   -2.371172849544045e-01   -2.124225620134538e-01   +6.967891116325758e-01   -7.804440900005163e-01   +5.282821366152229e-01   -8.159822394983782e-01   +2.085995356250021e-01   -5.212514830337583e-01   -4.032710816840375e-02; -5.699808016828213e-01   +2.864000529761046e-01   +4.406620630184355e-01   -2.898823012095993e-01   +6.424807132961272e-01   -3.909907077496561e-01   +5.330823474337409e-02   -1.319118688078161e-01   +2.600783336301004e-01   +5.724799879941705e-01   -1.209681782947003e-01   -7.880575812669273e-01   -3.252808663880434e-01   +8.975264350075616e-01   -6.041052656058170e-01   +6.457060181832259e-01; -6.229549007786707e-01   -3.871572716869245e-01   +2.099357635709946e-01   -5.703800497534508e-01   +4.180816567396179e-01   -1.075432213997035e-01   +1.695063878229013e-01   +4.519487027496804e-01   -1.479137967633884e-02   +4.097500674049129e-01   -3.338285701951423e-01   -3.702059234089308e-01   +5.037617916410477e-01   +1.439989752430528e-01   +1.038307975884918e-01   -1.289336440114906e-01; +2.558427044587035e-01   -4.312715499896801e-01   -3.468084090020545e-01   -5.522487401853394e-01   -8.048521078367076e-01   +2.483217861619434e-01   -5.827246077048015e-01   -4.511097143288932e-01   +4.985279925514835e-01   -5.549316697910066e-01   -2.130824474081314e-01   -1.827405404494979e-01   +2.501118732153302e-01   -1.217803052839371e-01   -1.952933216400452e-04   +1.382937478369270e-01; -1.799642393795721e-02   +2.898683885410313e-01   +4.123415817976742e-01   -1.225036075877078e-01   -7.517160964154368e-02   -7.802527709873606e-01   -1.438533047072824e-01   -5.857311148542751e-01   +1.970710267042528e-01   +2.585752346548227e-01   +5.131923596457786e-01   +6.653318300903728e-03   +6.014189795131442e-02   +8.526707286267077e-01   +1.257758350670101e-01   -2.071518062346974e-01; +6.700226606741876e-01   -7.474921703018705e-01   +1.867982873507533e-01   +3.564509576104530e-01   +9.512007707452514e-01   +1.507365828468834e-01   -7.264620168216344e-02   -4.735631575435296e-01   +5.778975084295639e-01   +1.045418687862163e-01   +1.913085368570562e-01   +1.000000000000000e+00   -3.410056910210567e-01   +7.173631045275092e-02   -2.799874511205043e-01   +2.550182677085505e-01; +2.684430909484625e-01   +7.400514138431794e-01   -1.306587944805645e-02   -6.241254423405445e-01   -2.537052370627351e-01   -5.544828230132397e-01   -4.562694441424583e-01   +4.798236878349566e-01   +3.314322070230394e-02   -5.669056594461962e-01   -2.418666712927946e-02   -4.091397746725752e-01   -1.276459068799679e-01   -6.487579452560913e-01   -6.199490953263596e-02   +5.944834866640349e-01; +1.147965737868882e-01   +3.388910898292923e-02   +2.853334963526159e-01   +9.657770501297488e-02   -6.856165604167808e-01   -7.688589275324997e-02   -1.957249209879692e-01   +7.260174585752428e-01   -7.471154223124404e-01   -8.892964464075036e-02   -2.590825499975451e-02   +1.438399261402348e-01   -1.426683457355186e-01   +3.965144671999025e-03   +5.189647027815520e-01   -2.892230703325196e-01; -3.971439579219021e-01   +3.118305391357375e-01   +4.535955639648300e-01   +4.398791251820959e-01   +4.379721186150181e-01   -2.377430632855131e-01   +3.682509135447952e-01   +3.905683114489720e-01   +3.034591929086321e-01   +1.365824969419355e-01   +2.020318683573591e-01   +7.560809859621649e-01   -4.216134394270865e-01   -2.158617773525139e-01   -4.800412497695404e-01   +4.211849972883281e-01; +2.564067473609452e-01   -2.439232152216722e-01   -4.362077788095771e-01   -2.278606894281650e-01   +6.641119934365989e-01   -3.898886772139317e-01   -4.112069242661446e-01   +2.578284704073910e-01   -1.500544416873355e-01   -4.032449064489034e-01   -5.029458699089865e-02   -2.630183694540848e-01   +5.766712513995985e-01   -9.470485974382109e-01   +1.012965308360127e-01   -2.335219546012737e-01];
L1E_L1I_iGABA_netcon = [-1.317415248293064e-01   -2.999352468692250e-01   -4.511542413128646e-01   -8.591867812150468e-01   -1.861875756024108e-01   -4.290648323066676e-01   -5.127681870344590e-01   +3.893391828272331e-02   +4.635032578763618e-01   +1.539637570536962e-01   -7.023845116049674e-01   -5.812127500770925e-02   +5.443593946293137e-01   -4.448799275183178e-01   -9.951727562458819e-02   -3.095403464492866e-01; +2.482828142691734e-01   -2.988494535777488e-02   +4.768910243962770e-01   +1.000000000000000e+00   -6.407107971008134e-02   +2.787063575707264e-02   -6.284133036619138e-02   +2.462393883499667e-01   +2.122811929037927e-01   +6.383076395326176e-03   -4.949358359140315e-01   -7.473540938050589e-02   +5.363779775248323e-01   -2.366698742544465e-01   +4.930429175522860e-01   -4.936926488148290e-02; +5.894854592638488e-02   -9.069290140151873e-01   +4.304691286215739e-01   +1.518697742998852e-01   +5.419958514945636e-01   +3.559376633149108e-01   +2.409990392888840e-01   -4.028362446855716e-01   +1.956259141529715e-01   +3.431561137975433e-01   +6.242542370182725e-01   +9.006416531073452e-02   +8.813978006593439e-01   +8.883851715157489e-01   +1.088228603631066e-01   +5.431791144188962e-01; -6.506346473993945e-01   -6.580054595332382e-01   +4.042328338100523e-01   +4.859364601909765e-01   -4.305484921110855e-01   +1.098455891203652e-01   -3.220421611076963e-01   -5.387483281281095e-01   -4.804009751532553e-01   +6.447229678519049e-01   -5.107900573825893e-01   -1.171711344951741e-01   +2.283377346224393e-01   +2.158534697816023e-01   -2.819523365551588e-01   -1.219321145410315e-01; -1.573527496998483e-01   +1.901073200317912e-01   +4.756834028669059e-01   +5.236059348510118e-01   +5.020836255679105e-01   +6.304652903430564e-01   -4.080772434446540e-01   +3.576190960889285e-01   +4.063686268088604e-01   +1.358746708463530e-01   -6.470158541523189e-01   +3.333978012674865e-01   -6.110829055658901e-01   -3.056512417209976e-01   +6.789762672289047e-02   +5.456244837071674e-02; -5.023529070769477e-01   -8.826594164088255e-01   +3.235071536273721e-01   +2.791798488117926e-01   +3.220604384953120e-01   +5.142093591471114e-01   -2.512562617350037e-01   -2.339816452140883e-01   +1.626421323270238e-01   +6.990276217820148e-01   -3.707726005380650e-02   +6.394362850995060e-01   +8.620364393485360e-01   +6.762743322422641e-01   -3.117220515850193e-01   -5.045772440320142e-01; -2.770044808144304e-01   +4.485502566520012e-01   +1.472446146268756e-01   +1.078984349346544e-01   -1.211051485190707e-01   -7.409436774501185e-01   -1.717222608407334e-01   +6.022300458162487e-02   +5.579800052145107e-02   -4.754708879181180e-01   +8.308671570463716e-01   -5.632101543155783e-01   +1.861928489271995e-01   -6.230817822860206e-01   +4.790683948244879e-01   +1.265203800105576e-01; +7.010436447154793e-01   +2.281728543685501e-01   -4.719505983575058e-02   -1.650768006419389e-01   -2.083694687671925e-01   -2.609818618978663e-01   +3.868304896231570e-01   +5.721803654423782e-01   +7.457665080480996e-01   -2.422031833583966e-01   -5.306049198060386e-01   -2.744610846637367e-01   -1.133781670716037e-01   +7.404337051169273e-01   +5.809035932443428e-01   -6.871639484222951e-01; +7.078811688505351e-01   +7.983084820622999e-02   -7.003346592049182e-01   +2.219294012876938e-01   +1.384678718844888e-01   -1.815700596441839e-01   -6.761006056207475e-01   -3.990774299369654e-01   +5.718872597866695e-01   -7.180932805912194e-02   +4.556021446961328e-01   -5.406210866010330e-01   +5.081831296470819e-01   -1.386742164341087e-01   -3.077128739587099e-01   +1.342917314962361e-01; -6.287137717610320e-04   -6.882022237089308e-01   -5.720007708283396e-01   +9.562555042695813e-02   +4.947772978960048e-01   -4.578866042481712e-01   +7.754488964338575e-02   +6.292553064143998e-01   +3.953101698425237e-01   +9.596698407954534e-01   -2.751089529462543e-01   -5.580846735430968e-01   -6.105128582533729e-01   +2.110795911039370e-01   -2.993735980087787e-02   -2.670243654484443e-01; -9.712148963699534e-01   -2.999074104621264e-01   -5.742738307694378e-02   +7.267956763599019e-01   -6.570714772863653e-01   -1.995559464258784e-01   -5.164036726967490e-02   +7.190761840690815e-01   -9.463968070937219e-01   -3.351591947812783e-01   -2.347303777834309e-01   -3.215299102423436e-01   +1.565286598573393e-01   -1.403579696342831e-01   -1.586335645320147e-01   +1.367744746619423e-01; +2.306624550667939e-01   +2.652267863074023e-01   -2.218962611846609e-01   -3.950199738721655e-01   -3.072522881009889e-02   -3.078772668214632e-01   -1.401479259928024e-01   -3.166582696832373e-01   -2.167614648986889e-02   +6.258379728568010e-01   -2.096867049162905e-02   -6.070016991004169e-01   +3.678179961820449e-01   +5.961840405409449e-01   -7.109683405386245e-01   -6.231033457828603e-01; +5.399970369763210e-02   +4.886684779529289e-01   -3.807615146593349e-01   +4.596480267931425e-01   +4.227195208388633e-01   -7.346483053943846e-02   -5.007519853306827e-01   -6.344210542933694e-01   +1.341508471810920e-01   -1.825819855482446e-01   -3.719619296666525e-01   +3.094645659102702e-02   +5.921737375949245e-01   -4.460127027996815e-01   -2.108643240307443e-01   -6.719651069706685e-01; -7.963326541766659e-01   +4.419641849748421e-01   +8.027445286918014e-02   +3.326940841764564e-01   -7.516292793016496e-01   -3.870284819251612e-01   +3.405646678235886e-01   +1.731514745383761e-01   -2.235366627892804e-01   -4.800813576546032e-01   +1.962290243754790e-01   +4.334460492009458e-01   -4.687160625512599e-01   +4.872732589396304e-01   -5.431341377066411e-01   -6.427928054615353e-01; -7.825957873614101e-02   -2.280028626531815e-01   +6.701737817071514e-01   +3.303149255320421e-01   +3.266250852990942e-01   +5.296456131670904e-01   -2.477978398363279e-01   -4.860507711870801e-01   +1.988272645959119e-01   +3.744876372278464e-01   +1.857513364422773e-02   -5.884604699572210e-01   -3.150600984135026e-02   +4.798100840900292e-01   +1.593203190040580e-01   +7.176469343827396e-01; +4.451503590075223e-01   +2.414444724124912e-01   -4.661561163235374e-01   -2.178498533327893e-01   -8.281749144328504e-01   +3.348742429606505e-01   +6.918893879878354e-02   +6.426740471060789e-01   +1.042809505932504e-01   -5.191222634211858e-01   +2.959400213221559e-01   +1.220512018855785e-01   -2.902638846373043e-01   +1.882260275749001e-01   +1.174870869920329e-01   +5.677375608292309e-01];
L2I_L1I_iGABA_netcon = [+6.593509954812070e-01   -3.800482286264578e-02   -2.507083404295654e-01   +7.804583314066600e-01   -3.198524729529469e-01   -3.076327666344152e-01   -1.555329666035339e-01   -2.695432498125118e-01; +2.725652773588914e-01   +6.924549151523192e-01   -6.450140091353107e-01   -4.816912754273067e-01   -1.265900556873868e-01   -3.993713946502628e-01   +1.084016078349843e-01   +4.708481484505956e-01; -3.431556744059797e-01   +2.334354182104318e-01   -4.679849293642720e-01   -1.482902885615026e-01   -5.960770835805036e-01   +2.533104724994827e-01   -5.324812528677899e-01   +4.173304451343567e-01; +5.859102234778838e-01   +4.877280944589782e-01   +4.860478598145770e-01   +3.699628278676345e-01   +2.529202188963198e-03   -2.826275024988024e-01   -3.921748964260423e-01   -4.375335510144044e-01; -7.956025172726783e-02   +4.087611429674083e-01   +3.404727847448388e-01   +1.528989239024507e-01   -6.237326055538446e-01   +6.838253199230294e-01   +7.885091165525476e-01   -1.050738165434032e-01; -1.960486750333241e-01   +6.348410386039821e-01   +4.104193056295398e-01   +5.202602868722960e-01   +3.031203947540573e-01   -3.726050535355149e-01   +4.268277272015792e-01   +2.874741630071329e-01; -2.239063178384051e-01   +5.578954329344652e-01   -2.311588474929558e-01   -2.072290099990500e-01   +1.722108894589911e-01   +1.285920314811987e-01   +3.298238385907695e-01   -6.400009943139415e-01; +6.485307723490237e-01   -2.634815370458022e-02   -1.951780520366006e-01   +1.277805460730753e-01   +5.699580062439721e-01   +5.148438789231882e-01   +1.979701567831381e-01   +5.060496924788557e-01; +3.569215838176416e-01   +5.689737860143954e-01   +1.979188248814046e-01   +8.187776341867159e-01   +5.517736806522157e-01   -1.962569394652582e-01   +2.700867555474257e-01   +3.306758662998985e-01; +1.930165271069101e-01   +3.855553131717765e-02   -1.709183285029941e-01   -5.626346309777105e-02   +6.349540178758254e-01   +2.965920184749130e-01   +7.175667418860608e-01   -4.561880279125898e-01; +2.714218205776052e-01   +1.678579143561068e-01   +5.175063118972300e-01   +4.940453136711508e-01   -5.832385602443771e-01   -8.861713268606187e-01   +4.847531669464200e-01   +5.760837950235236e-01; -3.846816260970469e-01   +5.271945117948051e-01   +6.508651395236046e-01   -4.170913476339967e-01   -4.042344164783835e-02   -2.204650006765234e-01   -5.557389440445879e-01   +7.770309947384527e-01; -2.603831185732318e-01   +8.134028896036764e-02   -3.998995657687910e-01   -2.139000973777464e-01   -1.062638873792521e-01   -6.615321778664658e-01   +4.750359027611405e-02   -1.346892474961123e-01; +3.155639106767703e-02   +2.306756921139731e-01   +2.542808945614884e-01   +1.000000000000000e+00   +5.894315025824560e-01   +9.734056460516859e-01   -7.898021364893240e-01   +6.800525600988833e-01; +3.900681632418367e-01   -2.936456251016628e-02   -3.014012176045966e-01   -2.455479493466821e-01   +5.747109990040459e-01   +1.326496275163949e-01   +1.680648914631389e-01   -6.922640066836544e-01; +6.489435535741147e-01   -9.081749505938832e-01   +5.661178860235994e-01   +4.576866547217021e-01   +1.875273795102000e-01   +1.676878594476527e-01   -9.052993395097171e-02   +5.414358021275862e-01];
L1I_L2I_iGABA_netcon = [+1.000000000000000e+00   +1.013874569630399e-02   -1.774724282178528e-01   +7.705572464931892e-02   -2.915913262584887e-01   -5.829088835990339e-01   +5.625962024754418e-01   -4.334020307015805e-01   +6.641538735413453e-01   +1.579510135524277e-01   +3.706045322690747e-01   -1.902417408699655e-01   -9.999547156038548e-03   +4.225098845492219e-02   +5.914974185692962e-01   +2.907698988038093e-01; +1.483782985253195e-01   -6.056124688979886e-01   +2.876185849662610e-01   -6.119167753421302e-01   +3.074596942298929e-01   -6.699593520282454e-02   +2.179959836301781e-01   -3.076034817541369e-01   -4.318656883060563e-01   +4.379432049694080e-02   +4.218883841145640e-01   -7.636855049414645e-01   -5.022137525850059e-01   -4.383695735104744e-01   +2.167554270131975e-01   -4.864870989953377e-01; -3.767729132432050e-01   +8.220465556415400e-02   +1.123499419831636e-01   -5.583016284019665e-01   +2.504652444377261e-01   -2.816736084201223e-01   +6.152166736446577e-03   +4.022474816111674e-01   -4.884079256144046e-01   +2.730089121060773e-01   +2.879421053595833e-01   +6.439062763874389e-01   -4.111663730010500e-01   -2.046386010045096e-01   +7.686582702397351e-01   -2.498199112726531e-01; +6.134510655971841e-01   -2.546224349239680e-01   -1.117899325450557e-01   -3.357546477604167e-01   -1.057410110115754e-01   -2.673483258610161e-01   -7.942231189332505e-02   -2.870695929747281e-01   +1.652659965022181e-01   -1.543608347978331e-01   +3.683415218843871e-01   +2.819607134389538e-01   +3.245377964424719e-01   +9.335350572276385e-01   -4.285755523451811e-01   +2.645915377383437e-01; -2.604415503419749e-01   -3.134533245262215e-01   +4.476552083303022e-01   -1.100751755917914e-01   -4.731904771532633e-01   -6.204983828134971e-01   -2.777906787298995e-02   +3.294826452196337e-02   +2.425100384516924e-01   +1.853814071217265e-01   -2.616074742014790e-01   -3.813546948812224e-01   -1.133437847059246e-01   -3.427216446271639e-01   -1.084257795546407e-01   +4.672910251059761e-01; +5.416708508526568e-01   +2.399084997210710e-01   -3.463284255418150e-01   +5.118657612550203e-01   +2.163168108741788e-02   -6.514212301786554e-01   +7.875393239035604e-02   -1.433889190515514e-01   +5.422025743546979e-01   -3.237379474218612e-01   +9.820581393777782e-02   +6.156102234989361e-03   +2.173523682553140e-01   +3.782252686309347e-01   +6.578680016261833e-01   -2.437993844877599e-01; -1.106751372324761e-01   -1.346322034269079e-02   +6.226395616918514e-01   +7.330188114575845e-01   -4.049987930310018e-01   -2.204838462682545e-01   -2.524910434467142e-01   -3.146271593090984e-01   +2.102268623148992e-01   +6.627643145047971e-02   +6.210361292639074e-01   -5.777113892710952e-01   -1.551446105174825e-01   -6.000444856322319e-02   -9.874512673557977e-02   -1.925649167233689e-01; -1.096820640817225e-01   +3.651970047325069e-01   -2.099733588995629e-01   +1.625192096733797e-01   +3.709159533835705e-01   -6.918023761868891e-02   +7.283414786346397e-02   +4.153081132255533e-01   -3.247127301200246e-01   -3.911896289266306e-01   -1.707659968123954e-01   -1.717151678691296e-01   +3.030525564331306e-01   +1.103132661889248e-01   +3.844862331292911e-01   +3.097990870645864e-01];
L2E_L1E_iAMPA_netcon = [-3.595657189829361e-01   -1.068054563807773e-01   -7.893478517518475e-01   -2.609845932998288e-01   -1.859000926080856e-01   -8.897037066443603e-02   +2.442579266854247e-01   +4.059565605991994e-01; +9.914950586362550e-01   +8.388667028468813e-01   -6.314645339042810e-02   +2.508875876599960e-01   -3.682772336300785e-01   -8.674335227609193e-01   +3.883071130368543e-01   +2.221731442717011e-01; +3.347520656506482e-01   -4.015048860040257e-01   +5.841585376431213e-02   +4.635376258555110e-01   -9.144984772303646e-01   +3.414864330750341e-03   +6.096185011899005e-01   +1.121946436137127e-01; +6.193829413133748e-01   -3.447324895215381e-02   +7.563161501994524e-01   -1.114006263062175e-01   -5.400235904023771e-01   +4.224106765552658e-01   +1.707206704803506e-02   +6.549367373065466e-01; -4.903628398424306e-01   +5.475303708911060e-01   +1.052576012424080e-01   +5.407867553113543e-01   +5.677609636393300e-01   +5.049201906914390e-01   -2.151759479341610e-01   -4.453114757573375e-01; +5.477109749927298e-02   +3.946765412194773e-01   -3.039249950787817e-01   +7.819890591498080e-02   +5.417930385702344e-01   +8.597343300834920e-01   -2.937716655672883e-01   -9.301908682209410e-02; +1.730750290060646e-01   +3.851815047975688e-01   +2.605654963324790e-01   -2.211625974708566e-01   -2.097713286637800e-01   -1.000000000000000e+00   +5.041021695473429e-01   +8.147594845115995e-01; -9.146268163357969e-01   +5.809632858812472e-02   -8.350375364436323e-01   -3.230713643787210e-01   -7.351782872959836e-01   -3.876169747665307e-01   -2.812706765024467e-01   -6.302877734161070e-01; -5.139571786883108e-01   -3.775215321536572e-01   -7.193330338921458e-01   -5.084360765720021e-01   -2.918107346679352e-01   -1.944361797955705e-01   +1.084603974924361e-02   +7.195014286414999e-01; +1.683111583680107e-01   -6.092594683461275e-01   +3.533884406062945e-01   +2.817878567361878e-01   -5.474563259195732e-01   -6.684655574845932e-03   -7.218712154352485e-01   -1.441435369765435e-02; +5.996194786822229e-01   +2.738568336123232e-01   -2.406115919081482e-01   +9.093446315646625e-02   -7.867399233244398e-01   +1.985851798217113e-01   +3.374315581295732e-01   +5.079296046235072e-02; -2.784897695916628e-01   -1.394908032870276e-01   -5.748264690343908e-01   +6.682824765274478e-01   +3.130076401782472e-02   +1.518038214601221e-01   +4.240228595155736e-01   +2.925650707230750e-01; -5.537665912810131e-01   +1.989839661043691e-01   +4.113136963164907e-02   -5.456561400474831e-01   +7.466059213199883e-01   +2.697989454561361e-02   -4.273133148253798e-01   -4.807844565085913e-01; -5.702342167259475e-01   -5.273732504009110e-02   -1.598413270947759e-01   +1.567814001467485e-01   +3.178376145433737e-02   +2.653918425200807e-01   -7.323504702935814e-01   +6.408137836323148e-01; +4.998673098118998e-01   -3.701429741569801e-01   -4.701250719032746e-01   -1.871282271100577e-01   +7.949970256945262e-01   -1.938709095124380e-01   -1.359515726865549e-01   -2.366342521359138e-01; -2.482980660871833e-01   +3.659674868032787e-01   -3.033169994522945e-01   +4.053662687535991e-01   -2.019047124217728e-01   -3.786712416072033e-01   +5.142543182915450e-02   -2.850705713965347e-01];
L1E_L2E_iAMPA_netcon = [-4.100617805372340e-02   +1.777227211581308e-01   +1.031272608024626e-01   +4.674090666142528e-01   +6.619371408997804e-01   +2.609906894975599e-01   -2.705823249084940e-01   -5.865085578755881e-01   -4.059575784087448e-01   +3.319799684739176e-01   +2.038128225852195e-01   +2.495476533693121e-01   +1.455304870554133e-01   -1.061829698476780e-01   +4.455144357285518e-01   -4.817602603689845e-01; +3.451186821713673e-01   -6.279031078755672e-01   +2.183211129259999e-02   +9.978872186376303e-03   +1.980014603518788e-02   -3.207949305557752e-01   -6.300711733966328e-02   +5.310583495887838e-02   +4.460687538941713e-03   -1.073890017387553e-02   -9.567247235264949e-02   -3.190250555712142e-01   -5.913447881995201e-01   +1.139261017585561e-01   +3.220389436514262e-01   -6.400467908704528e-01; +1.134419968796350e-01   +1.978178524257996e-01   +7.593464890169076e-02   -3.536633745215653e-01   -3.576082226310127e-01   -5.585958662976843e-01   -1.301368846013132e-02   +4.932104512854156e-01   -5.846084183044897e-01   -3.874502672504722e-01   -2.709095526118261e-01   -6.848319606867279e-01   +2.213657342328899e-01   -4.689535796841221e-01   -4.848234876459583e-01   +1.862224849449369e-01; -5.829063066232339e-02   +3.279606589089904e-02   +2.602813785301717e-01   -3.226732363017445e-01   -1.616978175202115e-01   +5.885687039456818e-01   +2.336049038663574e-01   -4.144203057201782e-01   -2.258101658773627e-01   -5.164410651622700e-01   -1.531753199437562e-01   -2.865569628443895e-01   -9.737959804533432e-02   -2.736992914186375e-02   -6.563912122117876e-01   +5.521299304398284e-01; -5.110410393475555e-01   +5.564303525381885e-01   +6.454996937849229e-01   +6.163696096124575e-01   -2.651263389740992e-01   -4.991426449487173e-01   +4.288007239880149e-01   -1.279973732407374e-01   -2.778660183153068e-01   -9.368423827248587e-02   +2.691822429538845e-01   +2.725096594659931e-01   -5.708853634618546e-01   +5.096782501422575e-02   +5.127227791080426e-01   +1.428503729435218e-01; +4.920905987567152e-01   +1.264443324903509e-02   +2.748081897781628e-01   -1.839929428598971e-01   +5.767175325105320e-01   -4.130423934938557e-01   -9.936529249458520e-02   -1.358124042739974e-01   +4.086803536092095e-01   +2.585571139778119e-01   -1.986076710957853e-01   +2.238735460807398e-01   +1.434800906806941e-01   +5.064483515001481e-01   -9.907700786350231e-01   +3.408870385969093e-01; +2.274668379693149e-02   -1.500263318309296e-01   +2.817399001134309e-01   +7.020906090278309e-01   -4.730127836797801e-01   +6.530812846437174e-01   -4.387006126723242e-01   -1.882231292224489e-01   +1.650886771569576e-02   -8.734807150974304e-01   +6.145308399269238e-01   -5.868558989632449e-02   +1.475672961808164e-01   +1.000000000000000e+00   -2.447920690743222e-01   +2.813936345988480e-01; +3.760878734953836e-01   -2.800818334287977e-02   -1.514400250333488e-01   -3.579768559905483e-01   -8.211063342595519e-02   -4.748807925487247e-01   +2.051166621053898e-01   -9.843358627731126e-02   -2.495022749147379e-01   +2.345135487466483e-01   +6.302912460798550e-01   -2.310898945973789e-01   +3.771052046367304e-01   +1.452658005392417e-01   +1.197253679561864e-01   +5.031384102545258e-02];
L2I_L2E_iAMPA_netcon = [-1.351612592935965e-01   +5.302515029823946e-02   +4.860633255146923e-01   -2.123538797326971e-01   -1.313994931457118e-01   +6.924260877966487e-01   +1.916124696442129e-01   -3.965942862477428e-01; +4.147910614459308e-01   -3.774003082746260e-01   -7.932559014303291e-01   -4.156638365328971e-01   +5.116958539220382e-01   -2.880077538749601e-01   -7.526460897442692e-01   +1.160103402060772e-01; +3.227891701761876e-01   -5.397150575624520e-01   +3.392724154880554e-01   -3.688507650726464e-01   -2.205849501772538e-01   +3.107218432174540e-01   -8.493139907341857e-02   -5.725954235093973e-01; -2.829246459023982e-01   -6.620825538651250e-01   +2.789516642399135e-01   +1.930164360158744e-02   -4.546663720810876e-01   +3.344847465493303e-01   -9.552616388711443e-02   -3.346738660582219e-01; -6.286977210865080e-01   +3.822076441025584e-01   +1.203271045949212e-01   +4.882539038236268e-01   -6.572810366053083e-01   +1.875937870600975e-01   -6.838932323710351e-01   +5.079441592856960e-01; -7.522285571884737e-01   -3.716440566195976e-01   -2.929210455511184e-01   +5.218994388430945e-02   -3.528678983540715e-01   +1.902149055709437e-01   -6.877521186606544e-02   -7.250391832044372e-01; +8.141531161403482e-01   -1.000000000000000e+00   +5.259072987624861e-01   -5.790431312310266e-01   -1.755825611549942e-01   +3.110683462834173e-01   -9.854190477700979e-01   -6.610688678893714e-01; +6.585545213915543e-01   -6.311534427674754e-01   -4.909400384652987e-01   +8.097391458501286e-01   -1.326287180635189e-01   -6.737270288009718e-01   +5.927472084436629e-01   -3.720396487284878e-01];
L2E_L2I_iGABA_netcon = [-4.408605868023405e-01   +6.604173768030571e-01   -4.261307857913957e-01   +6.906225365504414e-01   +1.666664789971600e-01   +4.471193319465103e-01   +5.716292175325768e-01   -5.248344707103839e-01; +8.389745998609535e-02   -4.677548721576135e-01   -2.639757551082079e-01   +3.922132279265397e-01   -6.994415512079281e-01   +2.999744450079052e-01   +6.064795089034579e-01   +2.350639700593534e-01; +9.915103721690803e-02   -5.068171268099967e-01   +1.000000000000000e+00   +3.936046486883732e-01   +5.346084001998258e-01   +1.807186780617165e-01   +7.105162791920544e-02   +3.723462353358821e-01; +9.300434531478633e-01   -2.307325567124041e-01   +3.765360420740321e-01   -4.278529689650995e-01   +5.107445873348757e-02   -1.819699494528852e-01   -1.459411226803016e-01   +3.366940999632721e-01; +7.331149566053526e-01   +3.808976109184418e-01   +5.604388900480913e-01   +1.341735101164802e-02   +2.848639802059469e-01   -1.451415059486943e-01   -3.044211564341116e-01   -6.070946936367038e-01; -1.048450991460425e-01   -3.049110447211759e-01   -1.883049599686844e-01   -5.253560030991430e-01   -6.891439252774577e-01   -3.816853054473841e-01   +4.584300240419605e-01   +6.763790657905644e-01; -4.447777999748422e-01   +3.319701682210856e-01   +2.618548756817530e-01   -5.320073245642086e-01   -6.939173090471431e-01   +5.860706363193943e-01   -1.282350871021303e-01   -1.490366618904493e-01; -3.377966613368836e-01   +5.983933939666617e-01   +5.666041811533176e-01   -2.233474267974197e-01   +3.312288392409037e-01   -6.178257283855714e-01   +8.359345912519373e-02   +6.391822007181975e-01];
L3E_L2E_iAMPA_netcon = [+2.141878523878669e-01   -1.926190683434678e-01   -4.470191814760334e-01   +3.056767808135924e-02   +7.162204904480923e-03   +6.562279309002642e-01   +6.343425064683045e-01   +5.868271407661271e-03   +6.331118458762472e-01   -2.455987277404567e-01   +7.876845683899674e-01   -1.251602093749943e-02; -6.738991369046760e-02   +2.373428323356249e-01   -1.895046491121040e-01   -4.756963135700211e-01   +2.558516451083439e-02   -8.488428168881603e-01   +2.938020921038698e-01   +2.335869679840502e-01   +8.686318520643920e-01   -2.465407325170967e-01   -2.984609050480572e-01   +3.449964781612222e-02; -4.120291528987705e-01   -1.322162682338781e-01   +5.210975408106779e-01   -5.021694855957152e-01   +3.777876010278579e-01   +4.278167300450629e-01   -6.143974452465366e-01   -8.834676457219622e-01   +5.693536825335179e-01   -5.469328790699201e-02   -4.195658109363532e-01   +4.384382515642234e-02; +6.851393995119888e-01   -2.547990592094788e-01   -2.426405973977905e-01   -3.046449600073731e-01   +8.384456003648036e-01   +1.075593674376525e-01   -3.147014089140082e-01   +1.939668979644306e-01   +8.789174345584551e-02   +3.992248224395350e-01   -6.241834295595522e-01   +1.703839186618125e-01; -6.425821168617490e-01   +1.636405706494079e-01   +2.048130509766801e-01   -2.041273705613645e-01   +3.672571264402075e-01   +5.457502165869624e-01   -7.601352493203748e-01   -4.297903984808165e-01   +5.350208621970054e-01   +2.650160959481043e-01   -5.526792744810475e-01   -2.921210008917636e-01; +7.180755283680232e-01   +1.577724854323115e-01   -2.583765138100964e-01   -8.550543912621364e-01   +5.598471533310571e-01   +7.239520372876559e-01   +2.563004799082748e-01   +9.610782469026901e-01   +7.937623633637236e-02   -3.956303430271900e-01   +3.692854873205869e-01   -7.334695556108450e-02; -1.014324427330491e-01   -6.945013003132877e-02   +5.116907222521790e-01   -3.642147783916289e-01   +1.617542332453929e-01   -4.004447219444070e-02   +1.262449939287985e-01   -1.776395695359798e-01   +3.958349879659330e-01   -2.453115193409905e-01   -1.000000000000000e+00   -3.855740500739359e-01; +2.170644123414582e-02   +5.012179884860023e-02   +2.889021281897996e-01   +1.465713226229512e-01   +1.804180884070676e-02   +3.002155668324354e-01   -5.524802616435804e-01   +2.876925838025362e-01   -7.724977805448804e-01   -3.817813372469028e-01   -1.272909967438908e-01   -4.077200385672907e-01];
L3I_L2I_iGABA_netcon = [+1.728405469815731e-01   -4.723937376145710e-01   +6.978841601368015e-01   -3.984161526606040e-01   +7.671629238881121e-01   +3.793579493148343e-01   +7.041549301908976e-01   -9.697094477285837e-01   +5.299176706077799e-01   +6.938677227868398e-01   -1.751015463496173e-01   -2.922158339015398e-02; -4.041985183133213e-01   +6.300921376874276e-01   +1.079389673773808e-01   +5.047956497663512e-01   +1.035300942503399e-01   -6.752422922542105e-01   +3.155372959592946e-01   +1.775644015309928e-01   +6.223752204679900e-01   -4.439346291896768e-01   +8.537215590802438e-01   +5.414847688359201e-01; +8.729323249663962e-02   -7.130392895472188e-01   +4.291046619705057e-01   +2.484877075443416e-01   -3.982808654626654e-01   +7.759377942023717e-01   -3.816237603146735e-01   -6.143002987610426e-01   -5.824209717633005e-01   +6.667034238726076e-01   -5.005055570307455e-02   +9.296714172905904e-02; -2.518395662088166e-01   -1.246620450976560e-02   -3.330619593606134e-01   -2.026788951481439e-01   +3.868175901005383e-01   -7.368026343450058e-01   +2.701550824106466e-01   +2.033641872179242e-01   +8.964921555807053e-01   +5.312108300320634e-02   +6.564542225246651e-01   +1.687759203401661e-01; +2.194324697446060e-01   +4.179121091141170e-01   -2.428384721780740e-01   +2.396754575474277e-01   +3.333001393749930e-01   -2.271693778561095e-01   +6.444994818120445e-02   -3.660407231834592e-01   +3.007529129943801e-01   -3.206713334233374e-01   +5.784828069604877e-01   +2.560027916815347e-01; -9.827871929454703e-01   -1.637301368262859e-01   +2.828593449705293e-01   +5.550326799495443e-01   -7.286012330241073e-02   -4.557076567860593e-01   -1.000000000000000e+00   -4.255735299550727e-01   -8.770236721021332e-01   +6.120328981859798e-01   +4.290210237609063e-01   -4.772827209771359e-02; -6.751020212866784e-01   -6.442224752939840e-01   -2.370424208710842e-01   +3.767532722096797e-02   +1.724276340031894e-01   -1.178250218179259e-01   +9.950711837717142e-01   +1.398077080928972e-01   -3.211930679397389e-03   -2.031395133759812e-02   -9.717689173014875e-04   -1.666916809987204e-01; +6.326891642090994e-02   -5.165360242377456e-01   +4.585841704556455e-01   +5.995310999718548e-01   -4.011466989427865e-01   +6.645266180975437e-01   -6.391411150847147e-02   -4.391303293839831e-01   +3.317604671475306e-02   -1.377965914478324e-01   -3.363365430573449e-01   -5.479572141773542e-01];
L2E_L3E_iAMPA_netcon = [+7.354454828632793e-02   +4.310851973127143e-01   +3.218895805247037e-01   -1.633682997945761e-01   -5.626233630045729e-01   +7.052808299658012e-01   -3.877258169692374e-01   +1.085321973623634e-02; -6.057529771675194e-02   +1.165611380798992e-01   -1.122821812205413e-01   -3.743863240579232e-01   +3.462453143844644e-01   -5.528008860029321e-01   -1.970129397370009e-01   +9.932966911651908e-02; +1.519759171505776e-01   -1.305216502096917e-01   -1.049162842308401e-01   -7.301318971192339e-01   +2.270649380327464e-01   +8.140760942172190e-02   -4.304406700959464e-04   +1.350786267405504e-01; -4.864366766687817e-01   +2.113204318312426e-01   -1.007552976227217e-01   -1.617883922623650e-01   -3.041674396302997e-01   -1.700141248707390e-01   +4.226452705282110e-01   +2.455347507164711e-02; +2.291642454093303e-01   +3.044019923429547e-01   -1.743913889946811e-01   -2.671414250407498e-01   -3.125009624382721e-02   -4.030319584003297e-01   +2.200391012973151e-02   -2.504831272275932e-01; +5.247395789891454e-01   +5.011909455247733e-01   +4.279214685402066e-01   -4.495037944501786e-01   -2.108864033562929e-01   -4.315515240945081e-01   -4.805992098902054e-01   -3.858725843564695e-01; -4.572189533071246e-01   -3.786997653390375e-01   +1.129088724345953e-01   +7.620112066376831e-01   -9.722503538893264e-02   -4.388305078616743e-01   -6.671412401355401e-01   +5.459964805813132e-01; -6.514227909288398e-01   +8.418875034642267e-01   +2.119686570336977e-01   +2.451863386346070e-01   +8.908546642596364e-02   +1.823245419720357e-01   -3.970330493497429e-01   +1.938197273518231e-01; +4.071499953470975e-01   +3.735809629738885e-01   +3.229953386025761e-01   -4.643226038837481e-01   +5.368752893813789e-02   -6.049458558426726e-01   -3.669537464536832e-01   +3.367269333443494e-01; -9.563658770664804e-02   -3.596465824152916e-01   +1.691284564316669e-02   +6.346898358307063e-01   -4.902966202979687e-01   -2.887994725520767e-01   -9.728392934792389e-02   +5.348689425056505e-01; +2.105656869590904e-01   +1.290499902176678e-01   -5.299047986121759e-01   -4.580908809672712e-01   -3.398604852638845e-01   +5.082719780554949e-02   +3.652417917926670e-01   -3.551629085944447e-01; -3.141228951235859e-01   -2.770779339924503e-01   +9.103426133584436e-02   +1.777474566299650e-01   +1.477565914955929e-01   +5.746653043911909e-02   -2.470342237778994e-01   +1.000000000000000e+00];
L2I_L3I_iGABA_netcon = [+4.196051732416149e-01   +1.333833537723580e-01   -2.409638569619006e-01   +3.135355422627314e-01   -3.215483499662095e-01   +3.217250901067318e-01   -3.522479109975539e-01   +7.091270981330901e-01; +1.772324988301661e-01   +4.840589254729905e-01   -5.733747702898958e-01   -2.160587455585166e-01   -1.734472018833748e-01   +4.993239430623105e-02   +6.921060214800089e-01   +4.627132157423626e-02; -1.148607332501982e-01   +7.596335048060532e-03   +2.610109032136083e-01   +4.400870510646096e-01   -4.883704271210576e-01   -2.797086208195744e-01   -4.747871689780988e-01   -4.695142545569388e-01; -5.466865649818503e-02   +5.008790673333702e-01   +1.671119564215675e-01   -5.020608373175618e-01   +6.777184187164370e-02   +1.130752655916830e-01   -7.119540542758283e-01   +1.904475020831707e-01; +9.941366799481563e-02   +5.098766795723773e-02   +3.033149704855236e-01   -2.823405236055054e-01   -4.485900742238056e-01   +1.248332213261640e-01   +3.737635438898881e-01   +3.496959442319156e-01; -1.578437368351939e-01   +1.052663315609828e-02   +2.487240097765523e-01   -2.601114084973817e-01   +3.525955880153754e-01   +3.652813139569480e-03   +1.949508972985969e-01   +2.532156257645298e-01; +7.892985206126995e-01   -3.930696346310038e-01   -2.021987090797246e-01   -1.034944392421358e-01   -4.405476921394112e-02   +4.498922172361428e-01   +3.479913641360825e-01   +4.242387273922425e-01; -1.030388599057233e-01   +3.751684863300239e-01   +4.746439458374969e-02   -1.307620287739463e-01   +1.888489914094508e-01   -2.194984900083351e-01   -4.324384064526338e-01   -5.930163528749695e-01; +1.151398198592273e-02   -2.238545864149504e-01   +2.605711786017242e-01   -1.000000000000000e+00   +4.325452602703663e-01   -1.044904064613790e-01   -5.343986851774347e-01   +2.117110103720393e-01; -6.266956082270700e-02   -1.103255100736576e-02   -5.536334765946739e-01   +1.422519412078395e-01   -4.720247500644900e-01   +1.440011494222382e-01   +1.599087070547685e-01   -1.690872080634151e-01; +8.615177782427782e-01   -1.332568389185210e-01   +5.502025717454069e-01   -3.172989589116637e-01   +5.069836329261912e-01   +6.423807774590031e-01   -3.899272760308206e-01   -6.440378775181821e-01; +9.182568310653081e-01   +1.311444694022360e-01   -1.586835941980609e-02   -1.626081363777035e-01   +9.895113773238758e-03   -3.255749761885198e-02   +5.529886146205943e-01   +1.330793263225029e-01];
L3I_L3E_iAMPA_netcon = [-7.887961702463707e-01   -6.035659304315634e-01   +4.022263599736246e-01   -5.119094042769926e-01   -1.411416875543451e-01   +7.961676302746754e-01   +8.463875654735414e-02   -9.226016915949448e-01   +2.009382510727050e-01   -4.367177372344794e-01   +6.099428266615199e-01   -5.244556243285380e-01; -6.448651357735328e-01   -2.333451467407853e-01   -4.270885798439867e-01   -7.360143635056040e-01   +4.222837254922593e-01   +1.831036174768169e-01   -1.000000000000000e+00   +2.778003844218724e-03   +4.330946401580697e-01   +3.894580659353452e-01   +1.610425487905388e-01   -1.848017744376937e-01; +6.126165925731859e-02   -2.919446203656578e-02   -2.432703763783095e-01   +6.372028451038217e-01   +3.424607942600452e-01   +3.337889143833496e-01   +2.033295999946612e-01   -4.390302281557378e-02   +5.216901788504241e-01   +1.937169467773056e-01   -2.920699086738856e-01   +5.751894456259175e-01; +7.883658071138840e-01   -2.516321905179392e-01   +4.486048944942362e-01   +4.588502091678704e-01   +1.628611351292623e-01   -2.328375931582689e-01   +5.163551119924631e-01   -5.325292437606232e-01   -2.655633044673748e-01   +3.770294256411940e-01   +3.230315521412555e-01   +6.593083334296425e-01; -9.777551441680601e-02   -4.317647142263501e-01   +2.949219339013606e-01   +4.710745202957968e-01   +3.846129847883819e-01   +3.011864598103230e-01   -2.855012104494227e-01   -2.637956453182094e-01   -4.291369143908619e-01   -5.086468083662676e-01   +6.236525936355917e-01   +1.208986268824506e-01; +1.629780085356756e-01   -5.494561961794384e-01   +4.340567352637320e-01   -3.994501542093102e-01   +5.629711612087113e-01   +3.689594145711343e-01   +3.884148891120531e-01   -3.269414806262265e-01   -2.982217942621817e-01   +6.154740351933043e-01   +6.579109631360981e-01   +2.242012861862528e-01; -6.147853916753666e-01   +4.156976087691162e-01   +3.170340495357908e-01   +2.950973373410927e-01   +3.412239379086644e-02   -3.449976396961828e-01   -6.126516816725989e-03   -1.044294367701105e-01   +4.223390789277649e-01   -1.535050259936704e-01   +2.407586468693770e-01   -4.969906583662213e-01; -1.500831977108459e-01   -3.163218411601207e-01   +4.027885053179270e-01   +6.719065620891569e-01   -8.454426502782597e-02   -2.944299368405408e-01   -3.117965983543641e-01   +6.632499713383413e-01   -9.248001682191642e-02   +9.184049045535497e-01   +1.939912788768674e-01   -2.103445966428268e-01; -2.426111114815177e-01   +1.473158630192929e-01   +5.523110117100800e-03   -4.488161930138291e-01   +2.087490469862283e-01   -5.963401354764146e-01   -4.273059905567705e-01   -6.332899478256323e-01   +2.510979187577090e-01   +3.189349689379546e-01   -2.016679839040462e-01   +2.673993199086520e-01; +5.472979628265644e-01   -4.907043744858018e-01   +1.282535108355041e-01   +3.204047034049231e-01   -8.520818699683189e-02   +5.506250989215972e-01   -1.042251579933246e-01   +4.771443241010770e-01   +8.915693097246762e-02   -1.442652565894508e-02   +3.997481076184370e-02   -5.799726133894285e-01; -3.109338848925741e-01   +3.497397198467420e-01   -5.321184555508877e-01   +2.285839416667838e-01   +1.737938595042896e-01   -3.001828441033385e-01   +6.421049030235226e-01   +1.759826799772877e-01   -4.314453544144657e-01   +1.788177185613899e-01   +1.712690937201671e-01   -1.621338963663103e-01; -2.239454257256839e-01   +3.275087850460229e-01   +4.957853833549923e-01   +2.497923507020053e-01   -4.063748905678374e-01   -5.124570586017026e-02   +4.064658746134742e-01   -5.147231550312301e-01   -9.991768599211985e-02   +4.702094588852226e-01   +4.293584061841157e-01   -1.287958195264050e-01];
L3E_L3I_iGABA_netcon = [+1.299198929159337e-02   +1.676318120597403e-01   -3.761403663265145e-02   -2.847475221872414e-01   +3.391313328552089e-01   -5.911735322674468e-01   +2.338807505224030e-01   -5.599661873995501e-01   +4.074540128324421e-01   -1.534184125645943e-01   -7.526407964008668e-02   +3.488492317560665e-01; +1.698906239168873e-02   -5.722904617948420e-01   +2.087700598359655e-01   +3.509609889253286e-01   +1.423376120328115e-01   +3.970202456026836e-01   +4.649018093764878e-01   -5.109185515491086e-01   +7.918599931343485e-01   -9.762982606802990e-02   +9.815509805268665e-01   +3.043154117842182e-01; -9.156695560504041e-02   +1.302362637223813e-01   -6.396601341911765e-01   +1.508657927532367e-01   +2.579785759855470e-01   -1.937223551129545e-01   +4.927388360246831e-01   +3.557431842563705e-01   -6.638612079537205e-02   -1.220738261773361e-01   +4.452399509545606e-01   +3.034504297159140e-01; -4.954746351382767e-01   +6.084178376792530e-02   -4.796936352685473e-02   -5.552245471358771e-01   -7.581252846462511e-01   +7.721161512650586e-01   +4.234916300736539e-01   +4.052434767430005e-01   -1.464612214921330e-01   +1.071771618735738e-01   +3.666115107982502e-02   +2.201566944166727e-01; -2.479409460538640e-01   +8.694434307042219e-02   -7.185937458281132e-02   -7.133373802528881e-01   -2.579394738570107e-03   -2.298706728607660e-01   -1.884298852465779e-01   +3.646441117471020e-01   +5.481674562977298e-02   +3.070835553306089e-01   +1.405653587129303e-01   -3.507712160599505e-01; -2.421918301277560e-01   -1.227730767775343e-01   +1.001627732634379e-01   +7.783299573730947e-02   +2.921073710878349e-01   +9.228968171953715e-01   -2.309606993598376e-01   -3.962667658403416e-01   -3.485505568344101e-01   -3.962601444730828e-01   -3.764116148545092e-01   -1.234774714111255e-01; +4.169570749766665e-01   +5.007975742237635e-01   +3.710060550875968e-02   -1.859055963420362e-01   +1.911380180322666e-02   +7.915960890629632e-02   -4.766984856964379e-01   -3.082348550772696e-01   +3.040076939989986e-01   +2.746257685470908e-01   +4.389199144930830e-01   -2.533176426216607e-01; +1.900353505551192e-01   -7.252359869293422e-01   -1.400502005287246e-01   -3.921453206101141e-01   +5.654448144706635e-01   +1.193680299879730e-01   +5.940072572965924e-01   +5.170169786966929e-01   +1.643405033060806e-01   -4.186693784873765e-01   -5.963229198945201e-01   -9.541611220317420e-02; +2.747216995795975e-01   +8.958783664393996e-02   +2.617354314533991e-01   -3.789634254970430e-01   +6.426670821718666e-02   +1.934523379699179e-01   +5.221433728167455e-01   -1.808600788764092e-02   -4.938055892438641e-01   +6.888236116652050e-01   -6.431142440495834e-01   +2.611616435777487e-01; -3.372467714702142e-01   -2.430993126707303e-01   -2.625815795703529e-01   -3.742801174267403e-01   +1.166339734769190e-01   +1.698907305170466e-01   +1.205346112246951e-01   -1.778481613535144e-01   +1.000000000000000e+00   +5.818572761321527e-02   -5.621047501580926e-01   +2.502040268821182e-01; -1.592286895679175e-01   -3.928776874947780e-01   -2.389567449691579e-01   -1.636662924621896e-01   +5.978269407224535e-01   -1.576401478950355e-01   +2.826535494446898e-01   +6.325009896785312e-02   -4.333235742612697e-01   -1.328205754202599e-01   +1.880168600486157e-02   -7.425642822712676e-02; -2.833792240432113e-01   +8.412989817835187e-01   +6.038930131975752e-01   -1.372293831522879e-01   -2.052822587305121e-01   -3.999723550834144e-02   -1.630950952835546e-01   +4.301661413886496e-01   -4.084135859931149e-01   -5.475982935731273e-01   +6.936329887284791e-02   +1.775620710596198e-01];
L2E_Input1_iAMPA_netcon = [-1.000000000000000e+00   -2.754819512515829e-01   -9.437413514947429e-01   +5.987144091979322e-01   +1.948117511609751e-01   +2.700392951000602e-01   +3.826391649982182e-01   +4.065211078533679e-03];
L2I_Input2_iAMPA_netcon = [-2.556347986614148e-01   -1.686511399136015e-01   -6.012345778030566e-01   +1.000000000000000e+00   +1.873688286229748e-01   -5.209952358503923e-01   +3.062849217975872e-01   -7.022972723721899e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
