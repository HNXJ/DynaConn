function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.061800729869249e-01   +6.886451686688171e-01   -6.807689728927374e-02   +5.689602098005003e-01   +4.272089600793767e-01   +3.397705998871823e-01   +3.669148913289152e-01   +6.973593999758539e-01   +3.462264620964898e-01   +2.564372518335822e-01   +2.707130165833303e-01   +4.338835379938200e-01   +5.638527292796923e-01   +4.199832385922524e-02   -7.599751173193404e-02   +1.797680734650123e-01; +8.485394082253853e-01   +4.373497096039025e-01   +6.706104236276522e-01   +1.142182801185025e-01   +2.432432067512921e-01   +1.427926506207734e-01   +3.070970318287481e-01   +2.942268773970987e-01   +4.167185615111655e-01   +6.085718035647109e-01   +1.667774338955587e-01   +2.927331138821380e-01   +6.449584403618589e-01   +6.614515047603325e-01   +5.340483267485258e-01   +1.574360018628210e-01; +2.220440540007372e-01   +3.988611646592672e-01   +3.712641075505762e-01   +1.880298160111050e-01   +3.726946657118761e-01   +1.767568818691950e-01   +1.221201341677085e-01   +6.742259239925359e-01   +1.941872510098991e-01   +2.528179082401916e-01   +7.963529628726851e-01   +5.312500172218356e-01   +6.664427605248882e-01   +8.370972878344953e-01   +1.983879557310848e-01   +4.681446349420653e-01; +3.912598687815323e-01   +9.245201623167945e-02   +4.078171492845226e-01   +9.441148121526065e-01   +6.676146024636032e-01   +7.647872435968922e-01   +5.268064316202246e-01   +3.966560429060854e-01   +1.053976431015368e-01   +1.011983661000333e-01   +5.548024058627263e-01   +4.915794079851803e-01   +2.041391006392528e-01   +5.614013417951593e-01   +3.869118332156636e-01   +7.919662802100327e-02; +5.429640919276403e-01   +5.192888810253089e-01   +5.444010078806298e-01   +2.084676362497115e-01   +1.590724098959714e-01   +8.012456576238702e-01   +6.688883724359206e-02   +2.188770834789058e-01   +5.497244181081763e-01   +5.282348122362523e-01   +3.989923597773781e-01   +3.872627711349603e-01   +7.698126878009123e-01   +5.492175688179861e-01   +7.886135189391775e-01   -4.251285940286301e-02; +1.695431241277494e-01   +2.125903181204643e-01   +4.433378967419185e-01   +1.556366567929009e-01   +6.640009978691269e-01   +1.293578345090040e-01   +6.747047083842714e-01   +2.706541254506564e-01   +1.736638311234033e-01   -1.205930048878874e-01   +4.834259544470771e-01   +6.502303628703366e-01   +2.495092434098911e-01   +5.659296131555895e-01   +5.766217341297267e-01   +1.534270307520972e-01; +3.465610271777391e-01   +6.590502103443718e-01   +1.760407957784360e-01   +3.449589292257293e-01   +3.781587349661241e-02   +4.624564264858205e-01   +7.377417048390054e-01   +6.832367165906332e-01   +7.206384301841513e-01   +7.387590184294551e-01   +5.950024097825537e-01   +5.221454141719037e-01   +3.188791207314597e-01   +1.478588885816811e-01   +3.306295294067751e-01   +1.585441008409802e-01; +2.996194461064489e-01   +3.629267156825646e-01   +1.269003207585775e-01   +7.397334963277850e-01   +6.359170228118426e-01   +1.693374277386844e-01   +3.287242651791841e-01   +1.800842179594982e-01   +4.392744983296753e-01   +3.501755022586588e-01   +8.688902485102244e-01   +9.954187934804536e-01   +6.411359617714903e-01   +2.016235147858115e-01   +5.209945655474747e-01   -1.556268026204297e-01; +2.007483993506017e-01   +4.230221719624194e-01   +2.512582350407764e-01   -6.085043339455760e-02   +2.009057242257108e-01   +5.399841177190899e-01   +5.839460566451647e-01   +1.668006637601104e-01   +2.180047266891461e-01   +3.449916712138951e-01   +4.502869586660295e-01   +3.334691885780345e-01   +7.550971453617923e-01   +5.711265374025668e-01   +2.106552770513855e-02   +4.267583126003592e-01; +4.112601103486754e-01   +3.091855936980729e-01   +8.107769903843562e-01   +8.793122878157933e-01   +2.399201374942156e-01   +6.350439609849646e-01   +1.582456724000570e-01   +7.575867712221410e-01   +4.574454549571910e-01   +4.468280421270244e-01   +2.867953889761454e-01   +6.920797069297785e-01   +4.522520192288780e-01   +6.106666744175794e-01   +4.516693197643802e-01   +3.962904435188974e-02; +2.044968011693305e-01   +8.336078534346525e-01   +6.135914885758921e-01   +2.122541526439891e-01   +6.481513934766631e-01   +6.202806277694695e-01   +1.755597334862013e-01   +2.210120966915350e-01   -1.116683319639896e-01   +8.718792451364736e-01   +4.007154304280977e-02   +3.884168680602538e-01   +6.315758516321430e-01   +1.275289256700643e-01   +4.080650285011702e-01   -6.716104806043395e-02; +3.302944590065746e-01   +4.566421984099459e-01   +6.382837858881413e-01   +9.599778899756303e-01   +2.649717166380274e-01   +4.828686719099222e-01   +2.172016836345739e-01   +2.245291855176676e-01   +3.700220564405635e-01   +3.058477686821279e-01   +8.778489514386889e-01   +4.596166972766513e-01   +1.962697316919448e-01   +2.801110764176200e-01   +5.737392222623560e-01   +3.505914827390531e-01; +4.602499222639341e-01   +5.221064092748554e-01   +5.805859337148696e-01   +5.865639162262833e-01   +3.790770510243550e-01   +7.132400154064006e-01   +6.675996202831974e-01   +4.145397312303694e-01   +5.702916593843963e-01   +5.398813292269505e-01   +4.240934610711042e-01   +5.086478756263246e-01   +2.782148345912994e-01   +4.766365240804243e-01   +7.257580168354969e-01   +4.203757718845238e-01; +8.029030280910447e-01   +8.785449217526012e-01   +4.620784372237093e-01   +3.708631409426922e-01   +5.202121951491732e-01   -6.687552951509523e-02   +5.186495407562569e-01   +5.699692281527931e-02   +4.455239826461974e-01   +5.404296526315959e-01   +1.593145249295396e-01   +1.971380583381836e-01   +4.941787944616308e-01   +4.459973127806686e-01   +2.454499570244504e-01   +6.396565400385396e-01; +5.295874453799783e-01   +5.088164309388593e-01   +6.969023687305901e-01   +3.102374697890970e-02   +1.045167302358876e-01   +2.919857769380172e-01   +5.127747575429352e-01   +3.228795501752955e-01   +1.508718333953369e-01   +3.152777696869361e-01   +4.400434640772365e-01   +7.031934029069697e-02   +6.898795302363179e-01   +4.419499088723111e-01   +6.270425983045119e-01   +5.088265225874301e-01; +1.316344076658505e-01   +7.029756942101233e-02   +2.345535234516043e-01   +8.226243578195220e-03   +4.974912947108872e-01   +8.428829450100828e-01   +5.829355073779170e-01   +6.693002085799928e-01   +1.986559561470965e-01   +2.676617055943082e-01   +3.139937195406243e-01   +5.446497315581029e-01   +5.040303029850964e-01   +6.104015982496841e-01   +5.795747645728896e-01   +2.515353969339835e-01];
L1E_L1I_iGABA_netcon = [+6.888354241168818e-01   +6.100908398599695e-01   +3.406228571827261e-01   +4.886986280401770e-01   +5.812853479359920e-01   -4.542893919157260e-02   +2.462413265761468e-01   +5.309844502068207e-01   -1.003732049811071e-02   +2.943594232381242e-01   +2.670685904647193e-01   +7.097498914708508e-01   +5.242406363192461e-01   +2.679008299075579e-01   +3.070234448255845e-01   +8.807280882305307e-01; +3.497280087207081e-02   +1.687621629095205e-01   +4.684813165275015e-01   +4.299530142903840e-01   +5.430606885070173e-01   +7.747009326224443e-01   +8.932205574836106e-01   +5.851583468829905e-01   +1.498388849115773e-01   +4.347659736170708e-02   +4.047466040392533e-01   +6.982155175064284e-01   -2.082323569183562e-02   +8.402043625251386e-01   +6.108312233368076e-01   +5.556685867095184e-01; -4.701520754246269e-02   +2.886883676754237e-01   +4.059326294878910e-01   +5.668395279264852e-01   +3.894896855487380e-01   +6.200062307039880e-01   +4.130062944175951e-01   +5.029935981164024e-01   +6.311153365244013e-01   +3.177592384258709e-01   +4.351012637093191e-01   +2.953845050623340e-01   +8.590749769588611e-01   +7.019249336116339e-01   +5.690069708094635e-01   +7.015735110655253e-01; +1.499878591631083e-01   +5.886306860287229e-01   +8.906002010504791e-01   +3.963624978495743e-01   +1.130832668624964e-01   +2.115473209794956e-01   +2.440155867838374e-01   +5.144874495170790e-02   +6.560417412747044e-01   +1.246264918874809e-01   +7.899146619879733e-01   +2.120640048954399e-01   +4.993239434573871e-02   +5.575825513781497e-01   -2.187660701809677e-02   +2.899527959076474e-01; +6.640878092553130e-01   +3.484788577577293e-01   +3.422079914024199e-02   +5.754635966861820e-01   +6.800834415066739e-01   +5.130004393762606e-01   -3.058772303552265e-02   +3.052229512325822e-01   +3.536897251301558e-01   +6.488550859070289e-01   +4.499705999511964e-01   -2.560911272322990e-02   +2.747995956259248e-01   +6.813032834900329e-01   +5.464683278852992e-01   +3.931855583602768e-01; +2.716904974578276e-01   -1.683579655054019e-02   +8.580997057176107e-01   +3.822413068259418e-01   +1.052368342599592e-01   +2.668551450201549e-01   +7.475005774955673e-01   +1.176286254660332e-01   +4.933480398212000e-01   +5.630207009795879e-01   +4.615948704971385e-01   +5.201254702672737e-01   +1.440705750857874e-01   +3.312250189176328e-01   -1.985466356051033e-01   +6.470236870164566e-01; +1.984501959304726e-01   +4.154593301033831e-01   +2.916474142101631e-01   +5.674933728143783e-01   +5.413117310340173e-01   +1.980082940689014e-01   +8.149534551752501e-02   +1.615700514402071e-01   +8.391320629845818e-01   +2.879371477955052e-01   -1.610572998335278e-02   +8.218654828597090e-02   +6.563096502849065e-01   +6.521306489592641e-01   +4.795251677597395e-01   -1.907595272075396e-01; +7.718011688448694e-01   +4.804710280350168e-01   +3.239358482485146e-01   +2.793214665646391e-01   +4.106695073521060e-02   +4.582656625289770e-01   +2.426014696061261e-01   +6.001612902274067e-01   +2.431525824469313e-02   +8.148787787937998e-01   +7.198073815179516e-01   +4.513163267941063e-01   +4.807999582409080e-01   -1.946331547555387e-01   +6.531621432373488e-01   +6.987445654893660e-01; +4.990604277433258e-01   +5.074017550745553e-01   +7.316820099774981e-01   +2.824456689766925e-01   +5.341139552857299e-04   +7.594636093608054e-01   +3.610537989989440e-01   +4.335621137518224e-01   +9.974068703806359e-01   -5.016156117813088e-02   +4.823483964130300e-01   +3.623338022441674e-01   +6.709030285278436e-01   +4.862287280457562e-01   +1.800189086233701e-01   +4.789168227108415e-01; +6.955361779380973e-01   +3.331904763731491e-01   +6.194578652778920e-01   +6.425949679401415e-01   +2.635786330210384e-01   +4.474126433300847e-01   +2.409213323350277e-01   +4.648530749224621e-01   +5.187503644772290e-01   +7.744907813802114e-02   +6.523888705409582e-01   +9.226218258634294e-02   +7.961172227823140e-01   -4.265251491967630e-02   -3.820925082294333e-02   +2.896352297607561e-01; +2.488457042866916e-01   -1.084561320535857e-01   +4.903769227372833e-01   +3.166152712693482e-01   +4.591769211827896e-01   +2.653231016410399e-01   -1.237971275707871e-01   +4.201203935630740e-02   +2.636409448548923e-01   +1.844881375785302e-01   +1.901432368013040e-01   +2.347094089650382e-01   +8.681999076250471e-01   +6.835962718145212e-01   +2.857476077590348e-01   +6.906745533746755e-01; +3.308887876032873e-02   +9.250748718856924e-01   +6.990453743194047e-01   +8.117563849020456e-01   +6.211086116200836e-01   -9.024177176750427e-02   -3.645625013301453e-02   +1.988751777189632e-01   +5.319815420555053e-01   +6.423980047482559e-01   +6.175911112223408e-01   +5.917435671639060e-01   +7.153550479616601e-02   +8.648731517685754e-01   +6.998616301259998e-01   -6.328840798556014e-03; +5.037126343108952e-01   +7.004931930846052e-01   +8.649646828826757e-01   +1.754433438932171e-01   +5.831482874470073e-01   +2.895080999688970e-01   +8.590937733456490e-01   +7.452052937390327e-01   +2.704427402611440e-02   +2.928499517360574e-01   +2.898567608237999e-02   +6.421336471134417e-01   +2.927751860326764e-01   +1.874136350853812e-01   +1.026020639207747e-02   +3.331672765876751e-02; +9.890175043550696e-02   +3.119109469563899e-01   +6.418548857210348e-01   +1.719765943172995e-01   +2.626124586777537e-01   +6.839350198758166e-01   +4.232624211595329e-01   +5.563038970971954e-01   +2.004279437103379e-01   +1.000000000000000e+00   +6.071130406145308e-01   +2.878988957991655e-02   +4.576590483514885e-01   +2.983031969932973e-01   +3.841986328406407e-01   +5.929530906288377e-01; +6.466958149288092e-01   +7.898734228035377e-01   +9.319932628561436e-01   +8.196206386967760e-01   +2.938265648285215e-01   +3.699585944302931e-01   +4.384643251604110e-01   +5.233778002778225e-01   +3.773793094408617e-01   +3.297476976821202e-01   +6.112633825800963e-01   +4.093939014289713e-01   +7.309900062044251e-01   +7.255118443479079e-01   +6.086303340279170e-01   +8.044045127407898e-01; +5.451248528621800e-01   +4.554367314339140e-01   +5.501945931234111e-01   +1.496530101605775e-01   +4.659277663853056e-01   +6.678228765598241e-01   +2.794444469818306e-01   +4.229202204011454e-01   +5.579354654184934e-01   +4.347168423475049e-01   +6.731396896097621e-01   +4.208809316538173e-01   +2.605393473330709e-01   +3.592861941959898e-01   +5.680617406225668e-01   +1.008003895031444e-01];
L2I_L1I_iGABA_netcon = [+5.327734486706520e-01   +4.095181785080806e-01   +7.045049990509574e-01   +9.943739991880054e-01   -1.136174688955990e-01   +1.839797684832049e-01   +1.289873906686642e-01   +1.155114376112895e-02; -1.655087703605913e-01   +5.120144612072365e-01   +5.359624701426470e-01   +6.110339779867238e-01   +3.876064064680671e-01   +8.307187956604575e-02   +5.191932699034094e-02   +2.471025601551081e-01; +2.000070765692141e-01   -3.844057591141073e-03   +6.309383132539731e-01   +6.294543432413695e-01   +4.901415837799276e-01   +1.248991979442475e-01   +3.931963026764741e-01   +7.742412364643549e-01; +2.017663474891387e-02   +4.342630511826266e-01   +1.326731412324087e-01   +8.112942760995790e-01   +4.208822239353646e-01   +3.981807131850398e-01   -7.432706666621636e-02   +5.419398311306416e-01; +6.291956583020050e-01   +9.062646409143995e-01   +6.015243160199292e-01   +4.668978556686837e-01   +3.935762998805543e-01   +6.557493161883864e-01   -4.307083268611368e-02   +6.272984159211067e-01; +1.264787061448144e-01   +5.305422271924868e-01   +3.942821328086809e-01   +8.127176603464344e-01   +6.192429472714471e-01   +5.415175457299676e-01   +8.427549442836634e-01   +4.433081805598620e-01; +8.567128802902869e-02   +6.571895481258858e-01   +9.174955379824365e-01   +9.802028008295696e-01   +1.985594441663326e-01   +7.883893178266956e-01   +3.359278222012771e-01   +4.121628654680093e-01; +5.714320420762086e-01   +8.833485005116347e-02   +8.610020764588008e-01   +2.617462908239619e-01   +4.468780166651223e-01   +1.735282738245964e-01   +3.498165543214087e-01   +8.450455449430648e-01; +1.719149261333786e-02   +3.465015825003482e-01   +5.636539038232968e-01   +4.736607816901909e-01   +7.620697516763639e-01   +8.395943893326688e-03   +5.552778861497457e-01   +3.408617790457528e-01; +5.013207040163460e-02   +8.797248734680622e-01   +2.533818237436558e-01   +9.778145558990517e-02   +5.344610394598928e-01   +6.313759356700182e-01   +7.221045694255224e-01   +7.505205847949620e-01; +5.613696335302900e-01   +2.044666785977196e-01   +2.878324192182019e-01   +3.576394949633093e-01   +6.090960025236772e-01   +4.689154238878525e-01   +8.342153993185293e-02   +7.690093289709996e-01; +7.026705051308124e-01   +3.870637813462935e-01   +7.838430373399062e-01   +3.865347599810861e-01   +6.450792265076680e-01   +2.207664259396833e-01   +5.517750677146135e-01   +8.550503513122093e-01; +3.772158197275043e-01   +1.772356749760487e-01   +5.761479041041586e-01   +4.895317066364233e-01   +2.239728921109375e-01   +5.901229340666041e-01   -4.596574244738637e-02   +7.084315310511882e-01; -8.542107695569795e-02   +7.311457085997590e-01   +5.625148163687309e-01   +5.933250369255105e-01   +4.195977205651090e-01   +8.109711693038377e-02   +1.364976091518973e-01   +2.946804527484011e-01; +3.357614284185169e-01   +3.003592758042800e-01   +6.661543701105126e-01   +3.310288781262086e-01   -1.073416789034121e-01   +6.111458311850362e-01   +6.268682373515028e-01   +6.332868301704196e-01; -6.220047191445986e-02   +3.889669815774421e-01   +1.236913390737962e-01   +7.295430657147490e-01   +9.873631168737743e-03   +2.016618814428948e-01   +2.496733705401968e-01   +6.422871786180422e-01];
L1I_L2I_iGABA_netcon = [+1.983210292613642e-02   +8.705945725258234e-02   +6.772607739865671e-01   +1.741355527419264e-01   +6.201752597759271e-01   +4.020494553153532e-01   +6.085988416795236e-01   +6.944789624013333e-01   +2.163863894370600e-01   +2.105026675377157e-01   +5.605507078258933e-01   +5.632363939169763e-01   +7.200059554697819e-01   +4.434130886710899e-01   -9.447356860219576e-02   +3.028334985908054e-01; +3.250758996878072e-01   +6.669468982718835e-01   +5.168543208681042e-01   +7.093361870434793e-01   -6.194720825463552e-02   +3.066183544071656e-01   +4.554117756294522e-01   +7.835127387923640e-02   +2.730637567016044e-01   +3.073599036246697e-01   +6.881734591467794e-01   +5.563103326444415e-01   +5.021114633269138e-01   +7.264062016691482e-01   +7.860772617877574e-01   +5.812455476729823e-01; +3.601722162067252e-01   +5.269558537548190e-01   +5.073442204891023e-01   +4.121865432134207e-01   +5.127101182394901e-01   +7.943460080812225e-01   +4.032478578655686e-01   +3.523085393654849e-01   +2.576263120808797e-01   +7.273601537933660e-01   +4.667792857779867e-01   +5.640531733378071e-01   +2.074004658136316e-01   +5.754249588669574e-01   +2.615066033600654e-01   +9.602060000046844e-02; +3.103606243944532e-01   +7.641416812190829e-01   +3.469687328907656e-01   +3.560047473172270e-01   +5.097888615071752e-02   +2.616824861838633e-01   +4.866359538050005e-01   +5.605081360208948e-02   +4.097919515844100e-01   +4.228235493785550e-01   +1.655845942869804e-01   +6.530227557202219e-01   +3.147057395637238e-01   +6.145583729782224e-01   +3.638445714975077e-01   +7.118489956475671e-01; +4.141681797450404e-01   +5.584343232309037e-01   +7.949452029860088e-01   +3.588468784004684e-01   +7.102512805163714e-01   +5.637933629908155e-01   +4.205136128037277e-01   +5.966831125872881e-01   +8.676486370121406e-02   +7.214225397394324e-01   +2.723214611859274e-02   +7.866920224239206e-01   -1.143495781754732e-01   +1.646727360939545e-01   +1.528546291600676e-01   +4.143760961867969e-01; +1.991874855889568e-02   +2.434685551593794e-01   +2.074781719012489e-01   +4.960827382923236e-01   +7.712349744492388e-01   +2.037232053459723e-01   +1.503138659189565e-01   +3.305740037998283e-01   +4.265754911074810e-01   +7.196312109423766e-01   +1.788682832243060e-01   +2.898778570600519e-01   +7.381330977903662e-01   +3.166458347285016e-01   +4.828025122724221e-01   +5.001562506579624e-01; +5.430028905304854e-01   +9.962037810002822e-01   +3.130160020362073e-01   +8.084937057089805e-01   +1.296426814369425e-01   +7.972282485982909e-01   -3.682015563332379e-02   +4.247282715437121e-01   +3.634234247276675e-01   +1.188652249798797e-01   +6.631649142025913e-01   +5.547831332050979e-01   +2.834163464896252e-01   +5.961926275675629e-01   +6.054317907174709e-01   +4.018618842877875e-01; +5.246737025009287e-01   +8.022379476795840e-01   +6.675768185071004e-01   +6.094166289665625e-01   -9.886162346066747e-03   +3.377820131990068e-01   +3.427239827842390e-01   +3.118609785775914e-01   +5.908372769661672e-01   +4.016102910163394e-01   +2.471999163087303e-01   +3.976736718194271e-01   +4.619648556227050e-01   +8.271103913860872e-01   +1.844788798791744e-01   +4.569337402707627e-01];
L2E_L1E_iAMPA_netcon = [+5.229705197402594e-01   +3.387471327973146e-02   -1.004059218899821e-01   +4.667328715530848e-01   +5.252112257915229e-01   +7.159584792297883e-01   +2.481293143077695e-01   +3.091503701317523e-01; +4.944196568131035e-01   +5.595161405576861e-01   +6.601350343549480e-01   +8.675231167509891e-01   +3.066407439272013e-01   +4.163318279380575e-02   +3.652325012981990e-01   +2.135678308252850e-01; +4.194758983826140e-01   +3.157755448665625e-01   +1.863904361282882e-01   +7.198370734655990e-01   +2.422927681424452e-01   -1.624926943765171e-03   +1.605755634970454e-01   +3.433829832168439e-01; +2.413607116097614e-04   +2.659271548949679e-01   +5.435982775620891e-01   -5.829821041426283e-02   +7.007910286574988e-01   +5.261886025468032e-01   +1.169620664659222e-02   +3.069088846003264e-01; +3.524144410125135e-01   +4.161669243596054e-01   +1.223008336916469e-02   +7.203086087868256e-01   +9.398536567499863e-01   +3.745058974305701e-01   +3.237194208637658e-01   +5.967704458264009e-01; +6.065330626870860e-01   +6.081406553225110e-01   +1.771254701449373e-01   +4.236676493921766e-01   +4.020364382615376e-01   +2.558462656146224e-01   +7.842010728191547e-03   +2.867901163636637e-01; +8.942008921525479e-01   +5.012710675809313e-01   -6.140496270749992e-02   +8.830272029777159e-01   +2.534911969879721e-01   +1.760497313009551e-01   +3.918657549111387e-01   +2.447647488525314e-01; +1.622411580708948e-01   +5.652584225848540e-01   +6.330913707908510e-01   +1.153777450168939e-01   +2.469501025664102e-01   +1.862443570249680e-01   -2.728248226257268e-02   +8.661319746417839e-02; +8.213381306432285e-01   +6.323369122252246e-01   +5.228279235527253e-01   +4.898899407486008e-01   +5.397390624970682e-01   +2.936644403902866e-01   +1.938764858529468e-01   +3.749869462226436e-01; +2.068087664496225e-01   +3.091712978019085e-01   +3.747447740842269e-01   +6.211011236576691e-02   +4.510814456447624e-01   +6.838667674917470e-01   +5.820574207957777e-01   -3.687397503689558e-03; +7.967526156370516e-02   +8.085797264303651e-01   +7.607142886640745e-01   +2.084663626578213e-01   +6.778433407539142e-01   -2.261997819361531e-02   +1.000000000000000e+00   +5.105980459204886e-01; +9.540609089197076e-01   +2.293087913863212e-01   +5.945936250544515e-01   +5.391311615964289e-01   +5.238211368972898e-02   +5.443419499863368e-01   +4.782530161523405e-01   +2.762100436136901e-01; +5.865660518760050e-01   +5.032699765853434e-01   +2.758678714064808e-01   +7.464202233852343e-01   +6.478433947224299e-01   +8.794809933227320e-02   +6.369882386304557e-02   +5.292579621170123e-01; +2.418939825553194e-01   +1.820347868201361e-01   +2.304227342758141e-01   +5.912629464303125e-01   +2.196224761274816e-01   +4.342171820429371e-01   +8.800735882350417e-01   +3.677416160481531e-01; +1.515245165888671e-01   -6.838171110589643e-02   +5.101885573098859e-01   +7.823809120283668e-01   +6.960239662972836e-01   +2.838333331673311e-01   +2.472257921269559e-01   +6.097601230989821e-01; +3.895700594867835e-02   +5.769656027199257e-01   +2.716972497497921e-01   +3.319119679500554e-01   +2.381458931976627e-01   +8.040335682914306e-02   +3.961374262269450e-01   -4.775073706745953e-02];
L1E_L2E_iAMPA_netcon = [+3.540757539142076e-01   +2.427408931179500e-01   +4.918446001717241e-01   +5.292658414657020e-01   +7.875447402893672e-01   +3.885841151827965e-01   +8.099130559070452e-01   +3.381006119789851e-01   +5.377511429669601e-01   +7.320267329955812e-01   +1.766765893947961e-01   +5.578780550568970e-01   +5.776939888878079e-01   +5.784679040700557e-01   +2.207402285742898e-01   +5.566183446208159e-01; +4.370409450858496e-01   +6.465362428250567e-01   +7.762112097494853e-02   +2.330603048449517e-01   +2.088336258305802e-01   +4.165792540537785e-01   -6.997032574277327e-02   +3.930862335298775e-01   +4.092664815261412e-01   +6.004431471648022e-01   +4.148805013676122e-01   +4.688313345172704e-01   +6.180659734021071e-01   +2.812396313386763e-01   +7.776538573329186e-01   +1.519416085962836e-01; +5.338878194980776e-01   +2.932384247632725e-01   +9.856352123787836e-01   +4.883335342893806e-04   +7.465291637500361e-01   +1.798006783391980e-01   +2.721708897286192e-01   +4.664306555753376e-01   +4.038603496409335e-01   +5.803273975826463e-01   +4.081150864822836e-01   +6.516890099799069e-01   +8.172142359772159e-01   +2.576426060769407e-01   +4.525025146231566e-01   +9.921339551896019e-01; +4.710938552661946e-01   +8.438095459860003e-01   +6.373888894365279e-02   -2.590603289116302e-02   +3.849564361044642e-01   +4.853144442901313e-01   +4.600291185122056e-01   -9.641112578991978e-02   +9.333875311477637e-01   +5.071353830503604e-01   +8.345583236780325e-02   +1.774264121991093e-01   +6.231972032672075e-01   +7.205958915744900e-01   +9.537179839447466e-02   -6.894999083385736e-02; +7.101099147615739e-01   +5.841793102314191e-01   +2.859141298987541e-01   +2.833591505548842e-01   +2.327439838097705e-01   +2.895640991637157e-01   +6.834743309607726e-01   +9.540091282747700e-01   -1.283186254617723e-01   +5.310276249566602e-01   +1.632979765068330e-01   +8.449151568691030e-02   -8.238783827388713e-02   +2.637627492618134e-01   +5.417381731120016e-01   +2.780168791876181e-01; +4.343211545476195e-01   +4.679487649123359e-01   +7.306603969875202e-01   +9.870779394046257e-01   -1.401935264267742e-01   +1.749688625895378e-01   +3.806677413208643e-01   +5.164170235532176e-01   +3.636470326715792e-01   +9.143724929588540e-02   +2.904955115428239e-01   -1.687078434626640e-02   +9.304421358329599e-01   +1.320409338291803e-01   +4.231574517529664e-01   +9.371756824858610e-01; +6.565876585120306e-01   +4.949975708452958e-02   +3.352311650900889e-01   +2.339924107706381e-01   +1.520995163524093e-01   +1.792555818800325e-01   +2.718939793031131e-01   +7.155869084901134e-01   +5.912385747915959e-01   +9.212470633433655e-02   +5.784553586797345e-01   +9.541498745252399e-03   +3.488577645471557e-01   +6.619631613736594e-02   -4.502192715407497e-02   +1.582712251459996e-01; +6.384205757889604e-01   +1.539015114092014e-01   +7.531492697515149e-01   -1.324863657660462e-01   +7.499630230840890e-01   +8.053038122688503e-01   +3.647993548811845e-01   +1.650790244101958e-01   +5.026032092297010e-01   +3.474352378586361e-01   +2.625805498351484e-01   +3.026044261341469e-01   +2.303491254510166e-01   +6.929381422872064e-01   +7.653278049651659e-01   +1.732000589393758e-01];
L2I_L2E_iAMPA_netcon = [-1.509021875346536e-01   +3.361157960203440e-01   +3.399168408756635e-01   +5.111320800202929e-02   +8.754452470091195e-01   +6.427381483602814e-01   +3.434634107976141e-01   +8.161211212570879e-01; +5.391086783539492e-01   +1.790887267539422e-01   -4.942225574371951e-02   +3.935110342498706e-01   +2.534351637771323e-01   +3.849716988052870e-01   +4.057099591527712e-01   +1.000000000000000e+00; +1.226884784336585e-01   +5.812502518053310e-01   -6.851574092301642e-02   -1.574622002261287e-01   +6.843838206171464e-01   -9.059285653099716e-02   +1.002385767568461e-01   +4.959144687239047e-01; +6.584193762235258e-01   +9.310433868563602e-01   -1.480196456013319e-02   +9.858221852965758e-01   +5.365134817318320e-01   +4.394454197695959e-01   +1.611681901506868e-01   -1.078653394492439e-01; +1.497594309506057e-01   +3.234368518459586e-01   +4.103731924735945e-01   +6.657460262641917e-01   +8.463117666056154e-01   +6.722377565133507e-01   +5.744541699468197e-01   +3.139036559892744e-01; +8.056299498200340e-01   +2.579713408395402e-01   +2.219013270411554e-01   +1.784349204759322e-01   +5.945310765567122e-02   +9.531265162800180e-01   +1.033272365892289e-01   -3.318120686007564e-02; +4.899517477296239e-01   +7.408519180987136e-01   +6.910592697054764e-01   +6.787054183757006e-01   +8.553166862038123e-01   -4.186657201878968e-02   +3.209616060335128e-01   +2.501391293258700e-01; +8.846045726856649e-01   +4.216449322418677e-01   +2.014280513265550e-01   +2.530954650780439e-01   +7.034963940698957e-01   +3.069150929501076e-01   +5.235419621585391e-01   +4.755812931046783e-01];
L2E_L2I_iGABA_netcon = [+1.387351436015748e-01   +2.177402876270665e-01   +4.045265982853967e-01   +1.252352658996942e-01   +8.084440104051471e-01   +7.802627158098671e-01   +4.245860999210414e-01   +4.530341525819861e-01; +7.537560189014939e-01   +8.943510886291619e-01   +1.471830287289081e-01   +2.673969899172371e-01   +3.327467698051297e-03   +8.260237003291354e-01   +4.504301513336255e-01   +3.766953788801817e-01; +9.947220145920890e-01   +2.668941844503953e-02   +7.225036176310793e-01   +4.392253899232848e-05   +7.249415434120333e-01   +7.137172556914149e-01   +7.707960484628128e-01   +2.733660026696582e-01; +1.271662445840644e-01   +1.725828322617982e-01   +7.782598204374493e-01   +6.792025200091378e-01   +7.082273798381191e-01   +6.255908304745232e-01   +1.821627771879448e-01   +7.248719380007250e-01; +7.093461037350390e-02   +7.174299313948644e-01   +7.650733123467490e-01   +2.240896817633678e-01   +2.489397522749036e-01   +1.502932625626811e-01   +5.234010705842679e-01   +2.618366829986456e-02; +2.011128217508246e-01   +5.026157183545095e-01   +4.695565898310046e-01   +3.274513492028118e-01   +3.163337870306765e-01   +7.574395639199516e-01   +2.886157793380323e-02   +1.337578313898343e-01; +3.052359754926132e-01   +6.313677293846940e-01   -2.656577948436591e-02   +7.901179292895950e-01   +4.879775914687637e-01   +6.057133533621396e-01   +8.090335730304532e-01   +7.295341149984330e-01; +2.693489777049753e-01   -3.247360216063629e-03   +5.612103820434599e-01   +5.391137700934622e-01   +6.382681591622571e-01   +3.510686252335544e-01   +5.840226878354385e-01   +5.755283780480084e-01];
L3E_L2E_iAMPA_netcon = [+3.277554800977430e-01   +9.946303671095034e-01   +4.417212735986929e-02   +4.705608021719440e-02   +6.092086107393907e-01   +6.993848770603535e-01   +1.768986146148767e-01   +7.675078193987477e-01   +6.500974339852663e-01   +8.688777749941291e-02   +4.570732671571544e-01   +6.253772063946968e-01; +3.039820947988837e-01   +2.614639147220287e-01   +5.902607353482247e-01   +4.237580051507419e-01   +5.807254554515733e-01   +3.740704094317059e-01   +3.937866618555008e-01   +6.060902936281767e-01   +3.395897228571054e-01   +2.976731065683812e-01   +1.674358424828276e-01   +6.176457578901389e-01; +5.152090247093015e-01   +7.977644671813483e-01   +6.668723143456317e-01   +4.692615452792895e-01   +6.715759921557192e-01   +3.699427459050032e-01   +6.838298129586258e-01   +5.013279343676045e-01   +7.080996193336249e-01   +3.941738751647028e-01   +3.186366643544207e-01   -2.618807948189272e-02; +7.112218187328525e-01   +1.433066122051363e-01   +7.559179859269358e-01   +4.936891803339215e-01   +6.883306693381225e-01   +7.214786302862066e-01   +3.106350750845142e-01   +3.027798840108857e-01   +6.055848395806461e-01   +6.530461162899074e-01   +3.014304525559042e-01   +8.825927520483877e-01; +3.658368421984892e-01   -1.044561948119401e-02   +5.642927939979934e-01   +1.318179064941190e-01   +4.802169395200515e-03   +4.646623070617598e-01   -1.134134840892079e-01   +6.760517199162390e-01   +1.496164227350785e-01   +7.662066653921064e-01   +2.405277516264894e-01   +5.836391787455130e-01; +1.442826958763296e-01   +5.708039636016453e-01   +2.339359894878602e-01   +3.922401359323203e-01   -3.415111241909116e-02   +2.896116532182237e-01   +2.472228516524896e-01   +9.163432777994749e-01   +6.836637570777673e-01   +8.009735009994821e-01   -1.574962156688617e-01   +7.412611168953560e-01; +4.184344241057251e-01   +5.557160069414380e-01   +3.405469345986828e-01   +7.482716448321837e-01   +2.499212378179334e-01   +5.482555331086315e-01   +5.276508774234238e-01   -2.266774790599951e-01   +8.325923111715537e-02   +8.858179729112015e-01   -2.655208816326813e-02   +5.378848634274531e-01; +1.079470132835738e-01   +3.995699758780126e-01   +3.407902044948759e-01   +6.174281977783496e-01   +2.236993219220053e-01   +2.275548613814834e-01   +4.586002080493526e-01   +1.650354631605244e-01   +1.088497757565659e-01   +8.773813531638557e-01   +5.804974521172001e-01   +1.383885671618479e-01];
L3I_L2I_iGABA_netcon = [+6.107966465085810e-01   +6.129086969163879e-01   +5.141468941442037e-01   +1.096041149534362e-01   +3.761448099269056e-01   +7.847638712253046e-01   +3.967037938866552e-01   +3.499082881601938e-01   +8.290097953035377e-01   +8.551522317873875e-03   +5.650184788635306e-01   +6.317128016457531e-01; +7.041729942546184e-01   +3.087328656093149e-01   +1.258091893675319e-01   +7.023959097858713e-01   +4.084228628841022e-01   +1.112421216301663e-01   -3.991369399036486e-02   +2.368234272403088e-01   +6.323649746698021e-01   -2.740473549224227e-02   +3.115609144858482e-02   +5.358538160736861e-01; +1.336225096045583e-01   +2.166613687185424e-01   +1.064245886022104e-01   +2.455973958399553e-01   +4.995984826004937e-01   +9.944247135576188e-02   +4.496530561572045e-01   +5.935652664234594e-01   +3.676901843022049e-01   +5.535659809106013e-01   +7.185677472346506e-01   +7.356632349384693e-01; +7.967796370592889e-01   +1.070948579283799e-01   +4.700756665156730e-01   +7.230967963514295e-01   +3.193961460607952e-01   +9.815995315500837e-01   +3.928579691906451e-01   +9.588923152899890e-01   +3.960865977396231e-01   +7.447449200068952e-01   +7.619453421596540e-01   +6.887308863800317e-01; -2.283184206980347e-01   +2.698333561087574e-01   -1.820465882535902e-01   +5.054538422084602e-01   +7.192183567135389e-02   +5.298460844871136e-01   +9.947307617067216e-02   +1.570726452772180e-01   +2.930027945440608e-01   +7.557222544758042e-01   +6.725332527981515e-01   +6.501602498098430e-02; +2.687835672382975e-01   -1.214580326775958e-01   +1.873090856989293e-01   +5.744927564997169e-01   +5.831675878042648e-01   +1.000000000000000e+00   +7.469672707259197e-01   -8.722580212207630e-02   +1.295129269846311e-01   +5.865286795687823e-01   +3.613139694289330e-01   +5.611042710101334e-01; +3.906320829333599e-01   +2.384013869387281e-01   +3.766081979275678e-01   +3.384334215398423e-01   +7.550697176054992e-01   +5.137448860480286e-01   +3.409811334475117e-01   +1.746693457261795e-01   +7.565663842486503e-01   +3.116795289934389e-01   +6.576154678793036e-01   +7.621306680342906e-01; +5.008830467089874e-01   +5.490252977807418e-01   +2.075724079921621e-01   +3.304200208295959e-01   +3.003161294446033e-01   +3.279953960112857e-01   +8.077403079502520e-01   +6.628587287369587e-01   +4.181601515011328e-01   +2.800907889445794e-01   +3.724687225191544e-01   -1.607266671557470e-01];
L2E_L3E_iAMPA_netcon = [+7.925301519453641e-01   -7.645636851851770e-02   +2.763516082164956e-01   +7.049892673599009e-02   +5.991793062189718e-01   +4.856793875822447e-01   +5.779939293389083e-01   +1.519662809702475e-01; +3.485985480172810e-01   +8.616224237757608e-01   -1.305150606014540e-01   +6.145675036602849e-01   +2.549910290884509e-01   +3.392558532621268e-01   -3.696739500745198e-02   +6.547273154725982e-01; +5.907141808473406e-01   +5.131540730747084e-01   +3.684836633991245e-01   +8.741891162254902e-01   +8.105320807483075e-01   +5.732587799476149e-01   +3.293275281557213e-01   +2.995338955017790e-01; +4.317395716910913e-01   +4.764102744336063e-01   +6.324575063103576e-01   +4.642227146938600e-01   +6.459140041239705e-01   +1.520555396632411e-01   +3.840997826119222e-01   +6.247583260865720e-01; +8.661966663636023e-01   +6.998810419292295e-01   +3.108850462046643e-01   +4.035512667408402e-01   +3.009210870231873e-01   +7.500893935115569e-01   +4.848479672533793e-02   +4.755011283202425e-01; +6.216096308489184e-01   +4.876800667219484e-01   +8.513909917694362e-01   +2.456656428016535e-01   +9.647332696945754e-01   +9.740263071224982e-01   +9.228197155028493e-02   +8.913706471546943e-01; +6.903833419032790e-01   +4.000856750389198e-01   +2.755806825012354e-01   +6.239280009577737e-01   +5.428666176926075e-01   +2.635582668740328e-01   +2.988650724948447e-01   +5.511985721273227e-01; +4.221777719449690e-01   +2.138412376218838e-01   +2.840798354530820e-01   +2.142327360091573e-01   +5.842224097594724e-01   +3.362249603277961e-02   +6.108863022933958e-01   +9.492616217005879e-01; +6.166733700578185e-01   +3.500704535878434e-01   +7.247341072231124e-01   +3.423624678929221e-01   +7.718124767262154e-03   +9.257757288610020e-01   +5.578371683574399e-01   +6.203169391636669e-01; -6.224535719262473e-03   +3.342092696168630e-01   +4.808064794242006e-01   +3.765897773680081e-01   +4.093431036479534e-01   +8.850664212328205e-01   +6.040032032937719e-01   +6.309224404745877e-01; +5.779678304839676e-01   -3.326455585742203e-02   +7.107801790586623e-01   -4.629242371554303e-04   +2.906697781412015e-01   +1.381147988648656e-01   +2.894539740764095e-01   +5.593967549609542e-01; +4.583911043156874e-01   +3.552361867438261e-01   +2.285577984275850e-01   +1.985274227381524e-01   +7.134906941394537e-01   +7.688139585916987e-02   +1.000000000000000e+00   +7.974797448112120e-01];
L2I_L3I_iGABA_netcon = [+3.024656784036629e-01   +4.644538163972796e-01   +5.801788890729103e-01   +8.766723538547412e-01   +4.793772604917296e-01   +2.877851752316322e-03   +5.385094913859693e-01   +5.363502562618875e-01; +1.844673417143083e-01   +7.151759615496927e-01   +5.376683577439177e-01   +9.215301424147890e-01   +3.431675295803764e-01   +9.929440263358608e-01   -1.661739591298725e-01   +5.983194540353478e-01; +3.968669990417760e-01   +9.158353174519227e-01   +7.234705661484824e-01   +3.834038223374706e-01   -6.273221860690606e-02   +2.035035615525166e-01   +7.398692533587269e-01   +1.093226149612689e-01; +1.629426464924500e-01   -1.524105450758272e-01   +6.889197349772757e-01   +1.308702058220469e-01   +1.772153847196742e-01   +9.243826938163789e-02   +3.459970414386978e-01   +7.227416315690129e-01; +7.561470132242463e-01   +4.738578031748563e-01   +4.445361559006580e-01   +5.415968701229117e-01   +5.151416581310178e-01   +8.028997754357323e-01   +1.691690624010676e-01   +1.854965915825958e-01; +2.326287324517136e-01   +9.555351916724429e-02   +2.545283343665268e-01   +2.343142035690672e-01   +6.381067952248097e-01   +6.843651903308557e-01   +7.325207336473090e-01   +1.167753002223525e-01; +8.303422582713292e-01   +2.199493692328964e-01   +6.941818029160588e-01   +9.522444130724428e-01   +3.852563039693533e-01   +2.221537657286942e-01   +8.821100732564172e-01   +3.700726961253424e-02; +7.565963358526387e-01   +5.729907187645670e-01   +7.847319458985582e-01   +3.535225639475252e-01   +8.537431920491699e-01   +8.883762962641473e-01   +6.550851651806159e-01   +2.022902967357283e-01; +5.602511529815799e-01   +7.149312115527330e-01   +7.876989131556549e-01   +3.512992773181447e-01   +5.908208125105767e-01   +4.593871364570519e-01   +9.395958596272768e-01   +7.348046526434378e-01; +8.418967123449809e-01   +5.509255595006224e-01   +6.560369701097117e-01   +6.591951223532577e-01   +1.667814987677538e-01   +2.200800428123877e-01   -4.592247836423658e-02   +4.013148965688718e-01; +6.409856382554964e-01   +8.026607235879345e-01   +4.263294371689195e-02   +6.284301157794908e-01   +3.805770912058571e-01   +5.604122617525562e-01   -1.085981966824798e-01   +4.605025752505338e-01; +1.094083959471879e-01   +4.179023824687217e-01   +3.141155783263300e-01   +5.633223693473273e-01   +7.692251749240459e-01   +1.856015518004896e-01   +2.853712585878723e-01   +5.673339245211280e-01];
L3I_L3E_iAMPA_netcon = [+2.787336459880931e-01   -1.486029995301452e-01   -8.679426027313983e-02   -1.404145306409704e-01   -5.981462805533405e-02   +6.577277811686782e-01   +1.724262243762677e-01   +3.143698863865328e-01   +3.455477414372366e-01   +8.112000009502280e-01   +8.035816713460473e-01   +3.846307675894099e-01; +7.945337779595081e-01   +4.578642110447331e-01   +7.080578344531819e-01   +1.057793436910131e-01   +7.194330090630029e-01   +8.258468778408925e-01   +7.654235231933640e-01   +2.705762977668674e-01   -1.129005338652125e-01   +5.294451837135600e-01   +7.708679803893277e-01   +1.387566682301521e-01; +1.000000000000000e+00   +4.289131211908226e-02   +3.259457521704988e-01   +5.131720231097725e-01   +2.810734925589523e-01   +2.958022586342490e-01   +6.692662926523461e-01   +2.633044888847925e-01   +4.982569815084211e-01   +4.409109348916545e-01   +4.444204754991549e-01   +1.867339342011580e-01; +7.328987138517580e-01   +3.574465998809260e-01   +9.914490353713989e-01   +6.821826358391890e-01   +2.811281326773344e-01   +6.305877063063587e-01   +7.680577388956523e-02   +5.911203615698339e-01   +5.820555299834588e-01   +1.661713511794451e-01   +6.976846405073336e-01   +8.324147472922773e-02; +1.626831286704777e-01   +2.756035591845609e-01   +6.921782289036139e-02   +4.630763581998233e-01   +8.763833888698694e-01   +2.081576427452088e-01   +5.632911371672316e-01   +2.494413198388512e-01   +5.733198821989912e-01   +4.076499870215687e-01   +4.289234384280141e-01   +4.788780704697996e-01; +2.672752406757349e-01   +3.058745873468812e-01   +7.154620631717577e-02   +4.583767787100348e-01   +2.784204557388391e-01   -6.215858512573229e-02   +2.112508034409923e-01   +8.947233608481995e-01   +1.853092796578583e-01   +2.587873243140062e-01   +5.539686068982020e-01   +2.276271231960526e-02; +4.754325021077578e-02   +6.001692849270400e-01   +7.856272807464776e-01   +2.979315295730457e-01   +4.827542502869336e-01   +4.325176053168755e-01   +4.965517694025935e-01   +2.218942427627540e-01   -6.736359018346058e-02   +5.620383149665394e-01   +6.273560505545198e-01   +6.347659582071453e-01; +6.115165451801484e-01   +7.094014525499088e-01   +2.821010155932749e-01   +6.237168755129961e-01   +7.633819951666404e-01   +5.987264104042158e-01   +1.382938191654616e-01   +1.057152126043445e-01   +9.064051399425483e-01   +5.396581007540926e-01   +1.161401668974173e-01   +6.279667444951688e-01; +6.366229050967472e-01   +8.542011054156992e-01   +8.616594011603482e-01   +6.485023934018326e-01   +5.682321001180499e-01   +6.033866198023240e-01   +4.638593486258812e-01   +4.610236655408491e-01   +1.419072021114684e-01   +2.743569905593770e-01   +7.049868207568720e-01   +5.822678590097060e-01; +7.703455741660828e-02   +6.191269043493446e-01   +5.748574567465463e-01   +6.444274661081829e-01   +6.242697892376430e-01   +6.353301281316079e-01   +5.924739471393997e-01   +1.515526731334421e-01   +1.421760965151094e-01   +8.345276919662749e-01   +5.691391621027729e-01   +5.787994560440580e-01; +7.981710212580274e-01   +2.445840276189006e-01   +7.192717609584762e-01   +8.061599809756438e-01   +1.923269086246767e-01   +3.702692891143706e-01   +2.067257913440453e-01   +9.156000910634809e-01   +7.515102626530159e-01   +9.678200693809814e-02   +6.088988856542509e-01   +7.417233208699271e-01; +4.707786591865498e-01   +5.508033629643252e-01   -5.802308194149991e-02   +2.197968118895786e-01   +4.344541863456877e-01   +4.417673853572875e-01   +9.473488657902345e-01   +1.126800977341402e-01   +1.028774568873333e-01   +2.282486545541514e-01   +3.731436279253444e-01   -4.208450283880720e-02];
L3E_L3I_iGABA_netcon = [+3.381219702966701e-01   +1.696081709338348e-01   +8.290645604986546e-01   +6.653165511910081e-02   +3.754562782478436e-01   +6.360281130169131e-01   +7.529393262241110e-01   +2.940065748568228e-01   +1.118513423875181e-01   +2.819135424951511e-01   +9.070501599029818e-02   +2.996928095220510e-01; +1.853158830949596e-01   +4.034158715641614e-01   +3.062717819938371e-01   +6.608550656138119e-01   +6.072204511524570e-01   +2.784757891895243e-01   +2.064328317139248e-01   +2.085404425012233e-01   +4.757342223606922e-01   +5.468376727000168e-01   +8.498501941682034e-01   +3.340138791564901e-01; +4.369319213138816e-01   +2.970152764456525e-02   +3.701314222525240e-01   +4.730089961854139e-01   +4.839686663602482e-01   +8.308784504420698e-01   +3.457745060773678e-01   +4.011588563856525e-01   +4.955067085831738e-01   +3.541991436502075e-01   +6.107315422515828e-01   +8.802113165406220e-01; +5.989134412027857e-01   +6.450545775647497e-01   +8.780146603540671e-01   -3.580651768589387e-02   +2.322307805209605e-01   +3.702229649736312e-01   +4.563443200791816e-01   +3.193860905912792e-01   +2.703503277493328e-01   +5.091651072290287e-01   +7.507062055951148e-01   +5.235751776231756e-01; +1.559707749557621e-01   +2.892829660164973e-01   +6.162517334045983e-01   +4.056267021341337e-01   +4.849999637275981e-01   +3.383523123027457e-01   +4.149110507594224e-01   +4.652992517429541e-01   +3.060148348203336e-01   +5.044287674728845e-01   -1.339965977753151e-01   +5.764624809521414e-01; +6.308715082749354e-01   +6.031608990789750e-01   -1.118285595864765e-01   +5.030086591909745e-01   +7.044624339704610e-01   +2.276419196114254e-01   +3.764472296165662e-01   +2.270847096923262e-01   -1.540074075319731e-01   +4.895040094169161e-01   +2.657538276269213e-01   +8.329154072830841e-01; +7.975533058872857e-02   -4.377820233551701e-02   +1.160386310128220e-01   +3.732201938063635e-01   +4.666368294000877e-01   +2.462324457132614e-01   +4.280172451603333e-01   +5.341677534308352e-01   +4.777799950755302e-01   +7.261234341087689e-01   +4.810681428527458e-01   +2.338926882541625e-01; +5.032714010435800e-01   +1.433745456756440e-01   +1.095842315899683e-02   +2.386253254112739e-01   +7.119492216124983e-01   +6.839835924427573e-01   +4.961988406186880e-01   +3.170746899784652e-01   +2.088845780575987e-01   +1.395046137163641e-02   +6.103666423513511e-01   +6.955556928417378e-01; +3.113508175386072e-01   +2.619426343496434e-01   +1.645120769355347e-01   +5.606657234158470e-01   +8.160547418123523e-02   +4.323096568215892e-01   +7.807832081311259e-01   +2.020698447855505e-01   +3.248942207924899e-01   +6.213045662703749e-01   +8.866432016962206e-01   -2.515313782821964e-02; +6.295852107827755e-02   +5.459862885881944e-01   +2.269483086388075e-01   +4.154804581760091e-01   +3.683844336321331e-01   +1.841006867602880e-01   +3.697700243167370e-01   +9.919288361763450e-01   +1.941558780079962e-01   +2.128508282361459e-01   +3.060533486485746e-01   +3.791442633881013e-01; +6.638318611212715e-01   +7.160348887757315e-01   +7.734767713398991e-01   +1.331555782927666e-01   -1.693146380471569e-01   +4.682257306428649e-01   -1.354361101193097e-01   +8.706522447992622e-01   +4.505704907930467e-01   +6.123527983239943e-01   +9.009273288865650e-01   +6.201850644425568e-01; +1.717439291778038e-01   +3.727765024218910e-01   +2.911251261426424e-01   +6.702663434214788e-01   +2.642215311943297e-01   +2.427370394017127e-01   +9.484921638561392e-01   +4.493671075952123e-01   +7.611820600180207e-01   +7.198624298743654e-01   +4.402731206812187e-01   +1.226206288054628e-01];
L2E_Input1_iAMPA_netcon = [+7.156249206493703e-01   +7.578984574890252e-01   +6.986364928998449e-01   +1.000000000000000e+00   +9.359360247739142e-01   +7.623067181567248e-01   +9.664517742819235e-01   +7.867823184793062e-01];
L2I_Input2_iAMPA_netcon = [+9.991355047217310e-01   +7.460824122995049e-01   +9.892502393390757e-01   +6.800355153092948e-01   +5.965688451098611e-01   +8.654034110138035e-01   +7.067220663554603e-01   +7.778150543031525e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
