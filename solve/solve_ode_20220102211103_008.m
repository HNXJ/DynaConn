function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.824255931959635e-01   -2.226064098568254e-01   +2.615815982449817e-01   +2.738963179810784e-01   -2.430362137414291e-03   +1.076386803356688e-01   -2.629798851327294e-01   +2.878252233376962e-02   +5.319934461774436e-01   +4.495262398191799e-01   +1.527697982196316e-01   -1.385206163620366e-01   +4.145591675647614e-01   -1.699318814189496e-01   -3.044246278259991e-01   +1.520581737172494e-01; +4.049763886217639e-01   +1.852471813276151e-01   +9.053418940602313e-02   -7.265177591245693e-02   +7.198912550235541e-02   +4.944955237520843e-01   -4.279699554039275e-01   +7.272355210205995e-02   +3.748502203948361e-01   -1.266336966304728e-01   +3.174792482368816e-01   +1.937141678493897e-01   +2.969084773117786e-01   +1.089685060198120e-01   +1.009800521409157e-01   -1.935816471260030e-01; +4.701293619930210e-01   +2.586401822507314e-01   +1.673877842257543e-01   +1.701641574666459e-01   -8.861470238890139e-02   +3.706151148886399e-01   +4.666234427372311e-01   -1.948964135213644e-01   +4.744662104501881e-01   +9.228439664382714e-02   +6.419505234826061e-01   +8.798665039334590e-02   -6.842625311299567e-02   -4.984786046976080e-01   -2.931697887348350e-02   +2.056473819950805e-01; +8.399566515322214e-02   -7.386813827947797e-02   +2.078957693814469e-02   +4.841357240332601e-01   -7.296799211839597e-03   +4.868054659952026e-01   +7.284652238023238e-01   +8.050828891514026e-01   +1.898141891325777e-01   -2.744589269010709e-01   +4.307645560249183e-01   +3.609903901229076e-01   -1.861963938760611e-02   +4.180498496207883e-01   +6.178434693000014e-02   +8.022729415336491e-01; -2.373227983688115e-02   +2.280078965090789e-01   +6.568430918420899e-01   +6.962186035406104e-01   -1.554363329635536e-02   +2.256878755630915e-01   +1.897434220559317e-01   +2.084070794871856e-01   -1.119902603227208e-01   +7.414531388085563e-01   +8.543892740388700e-01   -8.728236120460607e-02   +2.671853736497073e-01   +1.597933389730670e-01   +2.502477897170278e-01   -4.354994070408399e-03; -2.102620586442824e-01   +8.653321052237127e-01   +3.285826059829047e-01   +7.802143334892702e-03   +3.503246217583784e-01   +3.222959819705268e-01   +5.415161568385135e-01   -6.878339463626995e-02   +1.595799181084499e-01   -4.518818258829604e-02   +4.165748497163714e-01   -3.634124766738920e-01   +2.040997923209933e-01   +1.806401461441300e-01   -1.995323524487344e-01   -6.299078117052214e-01; +2.749681497691386e-01   +2.810187847455795e-01   +5.405667743241271e-01   +5.168940958452324e-01   -3.329301654058952e-01   +3.623731605296301e-01   +2.212396583807486e-01   +1.313426429880752e-01   -7.855649161582215e-01   +3.133568261052245e-01   -1.863954878436003e-01   +8.453506212026950e-02   +5.834421176437183e-01   -1.178356353957885e-01   +2.899492472976962e-01   +7.461702690157850e-01; +2.329464190248107e-01   +5.383723575804206e-01   -9.798994073907623e-02   +2.372729816328073e-01   +3.331444765593792e-01   -3.397853935602257e-01   +4.499630439463485e-01   +4.411059219064041e-01   +5.119196058354766e-01   +1.694929058082805e-02   +5.079404269985265e-01   +1.696602318341857e-01   -1.136717815571363e-02   +1.961156571085623e-01   -2.116652678513190e-01   +2.258376716533897e-01; +4.314984912831050e-01   +7.190755402672754e-01   -1.474477659314225e-01   +1.880868664719585e-02   +2.730799628203662e-01   +5.121365073063943e-01   +2.321306925974904e-02   -3.529873168617868e-01   +3.078659957084026e-01   -9.452200796689825e-02   +3.026460908778589e-01   +6.468011834849736e-02   +3.127118161826244e-01   +2.742468610865320e-01   -1.674766392179118e-01   -2.849530334665380e-01; +4.700338381897257e-01   +7.369213600150936e-01   +1.249713581171763e-01   +1.963350584566972e-01   -1.574845537745603e-01   +2.791995201518532e-01   +5.528730795024691e-01   +2.161663033568563e-02   +3.371215987562248e-01   -3.296100086202550e-02   +9.357848343128853e-01   +4.488282688405842e-02   +3.630081255339766e-01   +1.930964653219285e-01   +2.467304336063188e-01   +3.427911292959280e-01; +2.829357222295231e-01   +1.000000000000000e+00   -1.319671971109235e-02   +2.063390173187230e-01   +4.907284050854838e-01   +1.614099928932236e-01   -1.050506174160503e-01   -1.874361809801523e-02   +1.017771481382775e-01   +5.042188399628870e-01   -1.204110492511008e-01   +8.233238963322154e-02   -6.871205110007812e-01   +9.113648121040750e-02   +2.676440593789229e-01   +1.810485208075307e-01; +4.108081835465266e-01   +2.230280518181776e-01   +1.070535175209624e-01   -5.359261062334324e-02   +4.777604147560979e-02   +2.818491479817747e-01   +1.970260314662070e-01   -6.760381945760272e-03   +5.250105133373657e-01   -3.352117742366879e-01   +4.768312754147436e-01   +6.439072703617135e-01   +6.679715328233679e-01   +7.750645868973892e-02   -3.508727467873700e-01   -6.437004664325606e-02; -1.706810876762857e-01   +3.100544976492621e-01   +3.038914306970093e-01   +3.637146494571774e-01   +9.044768876479284e-01   +5.784030778146986e-01   -1.407692440143840e-01   -3.359579707621332e-02   +2.949601440645926e-01   +4.616933835084769e-01   +3.379488499260341e-01   +1.931423162830468e-01   -4.115399882924402e-01   -9.608717499424359e-02   +3.284017682628410e-01   +4.945240863978929e-02; -2.922077649550666e-01   +4.995326954886428e-01   +3.585522556199788e-01   -2.421132649738638e-01   +3.049714490656350e-01   +4.228154524041451e-01   -5.562011260465303e-02   +2.924748535305753e-01   -3.499848937840669e-01   +5.203257691990691e-02   +5.807616353880691e-01   -1.571135160156210e-01   -2.044348209525740e-01   +6.511656270032881e-01   -1.927756681943792e-01   -3.297019918645010e-01; +4.471646520268844e-01   -3.149729826813424e-01   +5.098663928963405e-01   +3.514836116300084e-01   -2.580238397113954e-01   +9.389779432819681e-02   +4.476839244866632e-01   -5.838918210545217e-02   +7.582709078102758e-02   -1.922946966961300e-01   +7.432619431514068e-02   -1.349907937741743e-04   +5.748982192565955e-01   +8.172746751384002e-02   +1.978355338362810e-01   -1.907115159386185e-01; -6.768598769729458e-01   +1.610211145811634e-01   -3.080186563402850e-01   +3.821474212217286e-01   +9.079766293706235e-01   +5.211900119119849e-01   -6.580464450516037e-03   +7.911711698543953e-01   +3.983786449093338e-02   +2.213224370996047e-01   +3.075547922825689e-01   +1.538133229850874e-01   +1.827515820542069e-02   +3.453369106102867e-01   +1.191671930812463e-01   +2.614006718827490e-01];
L1E_L1I_iGABA_netcon = [+1.955127973878312e-01   +6.458210446449939e-01   -4.157492298170299e-01   -2.114493024936140e-01   +6.803700168426009e-01   +5.600550901765756e-02   +5.569335661135496e-01   +3.465804129144465e-01   -1.797367150585557e-01   -3.297620971783218e-01   -1.394652559974800e-01   +3.149694574054572e-01   +6.037127417806484e-01   -1.896378863984780e-01   +5.559583856591273e-01   +7.220782901892576e-01; -3.007703901323496e-01   -2.546406552238445e-01   +8.825596850789381e-01   -3.994343501948772e-01   +4.081849094632705e-01   -4.566263279560371e-01   +5.418128348523866e-01   +5.093890929493408e-01   +3.011229300296493e-01   -7.042208870909441e-03   +3.858364065127506e-01   -1.096882374173018e-02   +4.477140202031878e-01   +3.325894814702271e-01   +6.380050611218671e-01   +1.273291325549439e-01; -3.306472305142533e-02   +3.464486764225099e-01   -4.066979138230240e-01   +6.763009932450014e-01   -1.442331263494735e-01   -9.416451958506183e-02   +2.363393200201891e-02   -1.271719397295022e-01   +4.445004413537607e-02   +2.083787025382020e-01   +4.571551129257539e-02   +4.281136403941983e-01   +1.074329395408086e-01   -3.536270107973824e-01   +7.198693217725571e-01   -8.946282767304944e-02; +3.021019871510056e-01   -2.609807366646213e-01   -4.887033021994261e-01   -5.627005211525020e-04   -2.388718899087983e-03   +3.428407728014385e-01   -3.431713522814026e-02   -1.247245701993772e-01   +9.345726830943250e-02   +1.790518456862184e-01   +4.445976816329888e-01   +3.293226835530511e-01   -1.190416992197364e-01   +3.547400679710513e-01   +1.840028968254314e-01   -8.132140381795129e-02; +7.296449089756854e-02   +2.084740080075707e-01   +4.263817679986813e-01   +7.213811682733115e-02   +5.480588320354035e-01   +3.447165337951510e-03   +1.133744465244331e-01   -3.964416970028616e-01   -3.902093243553346e-02   +2.779686851276360e-01   -3.275058017585342e-02   +5.594120069774465e-01   +7.638841702303946e-01   +6.247004844001838e-01   -1.411131821426082e-01   +2.365687224745414e-01; +3.081817970490482e-01   +7.252227470448184e-03   -9.016554020697867e-02   -4.852515655792603e-01   -3.234152111261144e-01   +6.990589283924957e-01   -1.016676024902791e-01   -3.519884059748420e-01   +2.477505016418466e-02   -1.037587320734693e-01   -3.576044496008405e-01   +6.733909505828333e-01   +8.835929112628529e-02   -2.598785978760477e-01   +2.909739975718129e-01   +3.924351564793948e-02; -4.059107227176281e-01   -2.670432469542597e-01   -3.700411831216562e-01   -4.380907664345053e-01   +4.860144424882260e-01   +6.717430863172436e-02   -6.643334953254257e-02   -3.242012429797465e-01   +3.472456675572813e-01   +3.664161860765392e-01   +7.022395040225072e-01   +1.041162624464349e-02   +6.103460135478736e-02   +3.220833279064253e-01   +8.667590090015174e-01   -1.267944807809405e-01; +3.213240611542006e-01   +2.982669819509037e-01   -1.406919763477479e-01   -4.120374058823420e-02   +1.233219032214520e-01   -3.297893839990806e-01   +7.771148480452903e-01   +3.570859468417836e-02   +5.185111431502747e-01   +2.904190137628661e-01   +1.329420534292014e-01   -1.940074922124723e-01   +6.856928863107161e-01   +5.441815001767607e-01   +2.536256820109639e-01   +6.049041385743381e-01; +3.937965174210730e-01   +8.799692256298094e-01   +2.619449650349353e-01   -1.811694458576362e-01   -4.872884506693760e-01   +7.048939822143878e-01   +7.087866279398695e-02   +3.723125106214153e-02   +3.767255128059141e-01   -3.375540499500591e-01   +2.672842389239715e-02   -2.492357484355699e-01   -2.700659721394392e-01   +6.171364442132467e-02   +6.176928402981355e-01   -3.652480430377326e-01; +2.435405233555760e-01   +7.575954465526049e-01   +4.601925183171011e-02   -3.984381830088804e-01   -2.024880542812535e-01   +4.475130363971134e-02   -3.685364337875248e-01   +3.387696168947391e-02   +5.508367724605253e-01   +2.746116222945091e-01   -4.589622670304659e-01   +5.470951470845994e-02   +5.878481721693722e-01   +3.460995903306183e-01   +3.282186251639540e-01   +2.646532526535009e-01; +2.293527495983402e-01   +3.299113978966213e-01   +3.315856316574956e-01   +7.310983283822031e-01   +4.763965449612197e-01   -5.339083885064393e-02   +3.193339700129615e-01   -2.271581069882266e-01   +6.209391233443682e-01   +2.827028788362481e-01   -2.224084845615888e-01   +4.300425333715706e-01   +7.523811144651319e-01   +3.700808677431356e-01   +2.883599018931443e-01   -4.968216955920280e-01; +1.063141389633144e-01   +2.418707110733686e-01   +1.377718792486823e-01   -6.588707423249212e-01   -5.300265061749945e-02   +3.036652546173558e-01   -2.502042619949724e-01   +8.348060408151021e-03   +9.107045478404195e-02   -1.901976905474605e-01   +1.860801877803905e-01   +1.631921773097912e-01   +2.552642816566334e-01   +7.538447670375475e-02   +3.444424893211497e-01   +2.179584941300186e-01; +3.479561517872361e-01   +5.503455132121596e-01   +5.650789834090848e-02   +3.586731496788079e-01   -2.728723713496891e-01   -1.366248819465767e-01   +1.246076337893116e-01   +2.785258112594690e-01   +4.091224858171724e-01   -6.851690126591717e-02   -4.245552706678164e-04   +3.742457833888384e-02   +4.089822579673925e-01   +4.656833314647920e-01   +3.453096455185599e-01   +1.041529378216449e-01; +5.098464025810009e-01   -6.031897361286409e-02   -2.362538342214285e-01   +1.196335791358693e-01   +1.103376802737335e-01   -1.480313427725259e-01   +9.711306476854963e-02   +3.060388874185317e-01   +5.073548925254562e-01   -3.348742402343093e-01   -5.949399707351949e-03   +3.927243553493072e-01   +1.157169452400987e-01   -1.437693181919440e-01   -3.567353307442814e-01   -2.150163795784104e-01; +1.376698679139700e-01   +2.259956832605504e-01   +1.526908999590747e-01   +1.037690456078905e-01   -4.789230968040276e-02   +3.920622842881547e-02   +7.723741721459414e-02   -1.854332540569627e-01   +6.219712306278852e-01   -2.073572511095034e-01   +4.326435740732418e-01   +2.003127884185869e-02   +2.885810174596003e-02   -7.621639950906569e-01   +9.512219317280530e-01   +1.614880195875091e-01; -3.287254301205755e-01   +4.462304938523999e-01   -8.696018993462354e-03   -1.389434950821002e-01   -8.448660235003261e-02   +1.700184053202412e-01   +1.078366527173746e-02   +5.310245480027308e-02   -2.701057283453524e-02   +3.280794502998537e-01   -1.694250231867479e-01   +3.372656603127945e-02   +2.973926813119904e-01   +1.667359710715877e-01   +7.513128320038466e-02   +3.996907407963561e-01];
L2I_L1I_iGABA_netcon = [-2.413482150472535e-01   -1.842719694480174e-01   +2.332481017632998e-01   +1.760738982655253e-01   -2.930929978661956e-01   +1.284212691996126e-01   +1.459203350992956e-01   -3.161091838534771e-01; +3.250432358600601e-01   +5.081262143675931e-01   +1.351476698817831e-02   +2.587904187103074e-01   +6.272327746378940e-01   +4.545210941958974e-01   -3.853183218764541e-03   -9.758689276750492e-02; +5.763571026628939e-01   +9.039410561394971e-02   +7.093598437731567e-02   +3.106889989857583e-01   +7.301406972143953e-02   +1.375268378389258e-01   +1.371579244112578e-01   +1.825691126539285e-01; +2.980476223655730e-01   +1.336921233138326e-02   +6.775185522209143e-01   +2.138142483266561e-01   +2.204737282140287e-01   +2.960276403903324e-01   +2.715831641262062e-01   -5.094402036555774e-02; +2.893359005012887e-01   -2.160187990722205e-01   +5.284703596927397e-01   +2.896921165474262e-01   +4.769323264122354e-01   +3.112684788403903e-01   +1.181331784211140e-01   -5.321061805635503e-02; +1.535137445334165e-01   -1.562926124506795e-01   +3.594994662566472e-01   +2.245636866267793e-01   +7.254545599225050e-02   +3.090890421301959e-01   +2.398427456978329e-01   +3.417470794216934e-01; +3.620389227625798e-01   +1.881122389256658e-01   +3.538857733705211e-01   -3.506402921731835e-02   +2.691457473904295e-01   +6.744595100153639e-01   +4.549515457882646e-01   +5.288024280008781e-01; -2.255320186350102e-01   +4.472985700611755e-01   +1.676786281862499e-01   +1.377925317410922e-01   +2.781417999785690e-01   -1.954176915123853e-02   +1.382107837560603e-01   +6.234864136161484e-02; +3.100563454691471e-01   +1.000000000000000e+00   -2.611468523689391e-01   +5.601337417599477e-01   +2.312140655221065e-01   +2.819144822190565e-01   +1.588800117461708e-01   -2.704311044278798e-01; -2.441035573948821e-01   -1.156339839224218e-01   +2.502733145118024e-01   -4.247212204403630e-02   +3.377954018034142e-01   +1.537568105904164e-02   -3.344181250982279e-01   +2.449833110294811e-01; +9.551054154205546e-02   +6.102951541874277e-02   +3.458238690188936e-01   +2.142434128843386e-01   +1.890265765004197e-01   -1.137974062354210e-01   +2.337487251841051e-01   +2.847951371193602e-01; +3.040857299794212e-01   +3.690674453150299e-01   +2.325465328168514e-01   -5.020305632010809e-02   -4.174803622581309e-02   +3.919085088005857e-02   +6.651916673375902e-01   +4.383979918522552e-01; +2.941510706746273e-01   +1.500836940492317e-01   +1.900701294011685e-01   +3.384618846265433e-01   +5.505881425571343e-01   -8.406425579097096e-02   -9.343114874798376e-02   -2.370351784613246e-02; -2.711112609898759e-02   -1.890780986522796e-01   +2.198278256716583e-01   -4.878415613155934e-01   +3.176644676196022e-01   -3.217364372103354e-01   +2.394299546307422e-01   +2.801565615510626e-01; +2.471117026027445e-01   +8.259483718051498e-02   +3.628052103492348e-01   +1.601575047907167e-01   -5.593954815798104e-02   +8.277555701129089e-01   +6.106617230394974e-01   +4.504913338039480e-01; +1.072255115876741e-01   -5.975818713522359e-02   +2.125341687394281e-01   +3.823642074593596e-01   +2.111753326867378e-01   +1.947890095113933e-01   -1.289012440176430e-02   -4.170902973730744e-02];
L1I_L2I_iGABA_netcon = [+2.501987184643387e-01   -1.878749806959371e-01   -3.645478760142413e-01   +2.863919617500931e-01   +3.087172367448995e-01   +1.130855478842177e-01   -7.100647624887631e-02   +3.226274804611892e-02   -1.312575735180860e-01   +3.762908198925007e-01   -2.678850118746042e-01   +5.434519349716728e-02   +4.062658818125303e-02   -1.793518804082142e-01   -2.143430335827043e-01   +1.552214343195115e-01; +3.284968844230692e-01   -3.884601161202575e-01   +2.162892374328588e-02   -3.108132664269556e-01   -1.884219811070323e-01   -1.547629557068195e-03   +2.279864714051532e-01   +2.178781045781679e-01   +1.099844963752475e-01   +6.343446828515594e-01   +2.513790635310786e-01   -4.373077183955477e-01   +6.025650112155827e-02   -1.623331054791678e-01   +4.270880323881714e-01   +1.536420239183903e-01; +3.114779815773660e-01   -3.600688368702239e-01   +3.912355634667019e-01   +3.242302808843618e-02   +1.987009007567469e-01   -1.783577431793001e-01   +5.262527969841491e-01   +1.462458368665393e-01   -1.099677400512902e-01   -1.064745077180285e-02   -2.723044729167548e-01   +4.643984509254272e-02   +1.814660910644569e-01   +3.533720811064993e-01   +6.930581451161487e-01   -5.763807770025765e-02; +1.454501879727501e-01   +7.326852750251436e-01   +2.050895683570894e-01   +1.423191649355581e-02   +3.177269334172220e-01   +7.279667684283498e-01   +3.243197086544776e-01   +1.699653838943364e-01   +1.730451354873531e-03   +6.147974089042999e-01   +3.361797976063793e-01   +2.884481638177453e-01   +4.055627711954850e-01   +4.475632618452129e-01   +2.636979570222876e-01   +1.943575937977025e-01; -5.338078025101216e-01   +2.109107805885251e-01   +9.356359777040643e-02   +3.327925713470055e-01   +1.906554696203615e-02   +5.575767329616705e-01   +4.906112582050994e-01   +3.927912874332282e-01   +4.512746101935378e-01   +3.305921003230946e-01   -9.153919249262803e-03   -1.982511887954224e-01   -5.882112751441388e-01   +1.469383038515532e-01   +2.425436341066636e-01   +6.496041391575054e-01; -1.692530450804229e-02   +4.393946035856634e-01   -4.135396773502427e-01   +5.113261473324711e-01   -1.177727121124116e-01   +8.414192411128701e-03   +3.411581235234464e-01   -1.028699841836970e-01   +1.901824891434075e-01   +1.214385617574283e-01   +1.781202625294715e-01   +1.167941759893109e-03   +3.979616326883909e-01   +9.968311500136073e-01   +1.553360973510407e-01   +1.097630040538527e-01; +1.577027290560364e-01   +1.274116384724344e-01   -3.079176042720334e-01   +2.707190241971387e-01   +4.192434069410597e-01   -3.328289672165798e-01   +4.523594543263601e-01   -1.139845077352443e-01   -1.400028321396611e-01   -3.636189682898041e-01   +4.932256130427614e-01   +2.367034092653935e-01   +1.118623942797410e-01   -2.329195697967329e-02   +5.627484003540151e-02   +2.410174957653366e-01; +4.475606460885209e-01   +1.318700645284877e-01   -1.092273340924193e-01   +1.719977635423332e-01   +1.992304206017420e-01   +1.324720034838067e-01   -1.767184256835141e-01   +8.545119594789324e-02   +1.182011729798455e-01   +2.679284111549697e-01   +1.820084371078744e-01   +4.029425194607857e-01   -8.084464907533659e-03   +1.761451092096913e-01   +5.766488813871307e-01   +4.694880107366944e-01];
L2E_L1E_iAMPA_netcon = [+3.256285068044611e-01   -3.929340445468874e-01   +1.365485102567894e-01   +5.263410161152806e-01   +9.092358199140564e-01   +5.100950490540098e-01   +6.254458857810578e-01   +4.433872463366068e-02; -1.123268258577819e-01   +2.245933947624507e-01   -2.144670827370077e-01   +1.567764089359655e-01   +2.990578765076882e-01   +3.603292226542679e-01   +3.263887888132437e-01   +2.128483213325374e-01; +5.130276249170033e-01   +2.268565588793590e-01   -4.583763194609786e-02   +2.827989502824945e-01   -2.377161043515822e-01   -4.668896122649083e-02   +1.046349676265006e-01   +5.436479913317556e-01; +5.893748593415565e-01   -1.596737001868673e-02   -2.120369525401596e-01   +5.583186884748078e-01   -1.981932702443823e-01   +1.664831288554183e-01   -2.985445906241089e-01   +1.067906881875975e-02; -1.466539813202717e-01   +8.029826134003948e-02   +4.321868767465004e-01   -1.266122146616203e-01   +2.565034888866618e-02   +8.352623151704153e-02   -1.029783419388046e-01   +3.809310058011054e-01; +5.947347414062333e-01   -3.609143008981799e-01   +8.599056634010555e-02   +3.715589847442688e-01   +3.388716406515495e-01   +6.582677827393764e-01   +7.119512243543226e-01   +3.595662225462757e-01; -2.687455449521485e-01   +6.042749744807091e-01   +2.372346996772670e-01   -3.016639987424812e-01   -2.016826148786630e-01   +2.663608113859954e-01   +6.475893515857084e-01   -3.695114426996504e-01; -1.673424491749309e-01   +4.357345346226733e-01   +9.403096305587652e-01   +6.045790433388847e-02   -2.302646876911467e-01   +3.534872262491780e-01   +2.685416121364033e-01   +6.026857203607976e-02; +3.644357779110046e-01   -3.627861612582620e-02   +5.762611671448890e-01   +4.747066914262653e-01   -3.463076200462168e-01   +3.972876754493003e-01   +5.198705638437177e-01   -2.106981877722612e-02; -1.634564755520277e-01   +1.180642116778433e-01   +3.415506098965878e-01   +1.971514347389260e-01   +7.758088786458582e-03   -1.799787905287084e-01   -8.183209097340852e-02   -1.328145021879402e-01; -1.679520793349166e-01   +4.387591289107812e-01   +7.949851920986408e-01   +1.320191996209396e-01   -3.390313981935159e-02   -9.278368914153937e-02   -9.771092870436998e-02   +7.956080687734475e-02; +8.554684057411603e-02   -3.625186658182833e-02   +3.699399932071152e-01   -2.046847547601288e-01   -2.219525258208885e-01   +1.606359542212404e-01   -2.890701774391182e-01   -1.538035990825520e-01; -1.462638171181292e-01   +4.716211696304712e-01   -1.142272264217316e-01   -7.368182283060207e-02   +7.163951753192231e-01   -2.683730840177043e-01   +1.467632603415599e-01   -2.074544328876581e-01; -9.498576264073637e-02   +9.188761239525353e-01   -1.376918678167845e-01   -1.778815047451769e-02   +3.801952184675192e-01   +1.820397275107165e-01   -2.047033543796747e-01   +1.778266666393820e-01; +6.164104644548267e-03   +1.720097806355516e-01   -1.266270921035570e-01   +3.983708708050175e-01   -5.536228427744996e-02   -1.515410961953625e-01   -2.023086848441136e-01   -7.946486610299176e-02; +2.936836090075741e-01   -3.377236970612507e-01   -5.373251675135523e-01   +1.358464534323730e-01   +2.061675584181973e-01   +3.419882248283743e-01   +5.201663723198813e-01   +8.997131095287464e-02];
L1E_L2E_iAMPA_netcon = [+3.945163136560502e-01   +3.097632478801196e-01   +1.417618297223736e-01   -2.537678001059501e-01   +3.443122602242385e-01   +3.033365036393649e-01   +1.299421956495953e-01   +1.312357858859867e-01   -2.985494710789741e-03   -3.239522999053696e-01   +5.649425988464536e-01   -1.938169635659508e-02   +1.823390470232612e-01   -1.757534570325942e-01   -2.521281359999019e-01   +6.550143918608080e-02; +2.414241453912648e-01   -1.109930458357397e-01   +4.373604939948845e-01   -1.425272338000512e-01   +4.381114472748291e-02   +3.676421101216036e-01   +3.820547945391753e-01   +1.516729115982989e-01   -1.290530321687021e-01   +2.837651919874398e-02   +5.422265274418095e-01   +1.878988269101241e-01   +5.024857490994755e-01   +2.191094235261906e-01   +9.490621546358323e-02   -3.706046592070297e-01; +9.139785179296804e-01   +5.874146001190028e-02   +2.015191423001304e-01   +7.856737041921521e-03   +3.738185503173214e-01   -9.527101788670486e-04   -1.558386153469379e-01   +2.362256489080853e-01   -1.384145059833298e-01   -5.802641716061000e-01   -2.291432985363234e-02   +3.499800351487742e-01   -1.164161257143613e-01   +4.041163062726424e-01   -1.758402054251191e-01   +1.334950082126328e-01; +2.020165805171782e-01   -1.812212565525186e-02   -4.474500856074551e-02   +4.479038686844216e-01   +5.826101553115105e-02   +6.927263971715231e-01   +8.748287610283556e-01   -3.465836301005663e-01   -1.068778554524913e-01   +2.439558059922723e-01   +5.146174749652661e-01   -3.760078790050754e-01   -3.866106485794581e-01   +7.994979436897988e-01   +3.299763554302033e-01   -1.111462781465303e-01; +3.418439077600659e-02   -5.756607759037214e-01   +1.933725910374872e-01   +3.327451103138888e-02   -2.190301332158278e-02   +2.368107435521457e-01   +4.406468018022236e-01   +1.812637397422300e-01   +5.972287607060565e-01   +6.643432716150297e-02   -5.210890260435120e-02   -5.897380131641710e-01   -2.315058132874820e-01   -1.896017714443450e-01   +1.631462409016740e-01   -3.201786434002132e-01; +6.940331080274917e-02   +4.153646586878422e-01   -7.959360993824700e-02   +5.348105732179349e-01   +1.329964385001703e-01   -9.937207516160607e-02   +9.412882210883121e-01   -2.740100599466713e-02   +2.711635227848415e-01   +5.636708879284875e-02   +5.064058642153249e-01   +1.226871627793854e-02   -1.602605808375262e-01   -7.555897640993420e-02   -3.283831324950348e-01   +6.861252742218154e-01; +2.497357476153294e-01   +1.624266837247150e-01   +2.015138660675944e-01   -5.693655745876398e-03   +1.814026988015816e-01   +2.112896102561211e-01   +3.636233705823738e-01   -5.278673243578238e-01   -8.088573192148113e-02   +2.484239404768795e-01   -4.112496761084375e-01   -6.122596192309031e-02   -5.033980033159394e-01   +5.286647715283933e-01   +6.122613041400020e-01   +4.472012913570247e-01; +5.120807569084488e-01   +2.886539166451426e-01   +4.826391652236397e-01   +7.955567160551715e-01   +2.519613452150889e-01   +4.987301334174793e-01   +1.474215757402081e-01   +2.752770923526411e-02   +2.381576986997922e-01   +1.330564093869518e-01   -2.914579992693019e-01   +2.098355208955772e-02   -7.039940244991091e-01   +2.587796028921911e-01   +3.281305094000806e-01   +4.441470501224888e-01];
L2I_L2E_iAMPA_netcon = [+1.305518752624619e-01   +7.469858311945973e-01   +2.319716183987103e-01   -4.122966066174873e-02   +1.808257030634038e-01   +4.607736337517827e-01   -5.052193916965017e-02   +5.518734178940216e-01; +5.576855382186123e-01   +1.156634753561832e-01   +5.446348701031909e-01   +8.528423296426574e-01   +4.375064836712927e-01   +5.928064807514007e-02   +2.058652078808460e-01   +1.639055845306243e-01; +1.568741466697054e-03   +8.044783327783071e-03   -3.886999564371543e-01   +1.766385278575558e-01   -1.032370856816531e-01   -1.604994178427742e-01   +2.144280486501582e-01   -1.207275583084257e-01; +3.777072607305850e-01   +4.021433470420180e-01   -6.178375432759561e-01   +3.495625063776843e-01   +4.957448326311245e-01   -2.203202933854705e-01   +4.024998328733732e-01   +3.630282815603518e-01; +3.341636681464487e-01   +2.758350356492699e-02   -1.127342727836965e-01   +1.946720058489152e-01   +7.093832195979604e-01   -2.052697680639187e-01   +2.808590321500260e-01   -1.517185823734448e-01; +4.452388617104232e-01   +1.208856873357548e-01   -2.558807538485861e-01   +3.280326214276528e-01   -3.276378518410608e-01   +1.305073729614721e-01   +9.647363314164731e-02   -1.937605532169586e-01; +4.806518019022670e-01   -5.020803413546249e-01   +3.618408920918680e-01   +6.271013404386869e-01   +2.091588944015880e-01   -3.373884666734783e-01   +8.501014149244720e-01   -3.890033463459774e-01; +1.628858845188644e-01   -9.399326828186939e-02   -7.723493572304649e-01   +1.903649346385571e-01   -2.512015148474052e-02   -2.396584103254717e-01   +1.042351966563385e-01   +7.707191291270871e-01];
L2E_L2I_iGABA_netcon = [+1.636071011977392e-01   +3.141923606596422e-01   +1.352620014120831e-01   -3.296133479823790e-01   -1.073669527406031e-01   -6.971486761486616e-02   -1.001390298699436e-01   +7.430800212866864e-01; +2.597813739100263e-01   -4.736657454935472e-02   +2.983344346841281e-01   +9.804386604250125e-01   +5.302756963617471e-01   +8.156265000820866e-02   -2.537761708883184e-01   +6.253092076378684e-02; +2.901214871570012e-01   +7.272166973494187e-01   -4.419035925344930e-01   -5.507450818329648e-01   +3.873803016431456e-01   +6.055357916806046e-01   +1.246781190907092e-01   +2.367591950427280e-01; +3.086485824466002e-01   +3.933858084605045e-01   +9.353256430735277e-02   +4.315094301310226e-01   +6.743379056634882e-01   -3.696189693602050e-01   -3.022245567036693e-01   -6.490206538019207e-02; -2.259405446587581e-01   -1.752695168503551e-01   -1.532541083522023e-01   +3.021403803754052e-01   +7.141462977274032e-01   +1.518522248717943e-01   +2.677088203288344e-01   +1.010181725656172e-01; +7.315605372203573e-01   +4.078621306205578e-01   +4.548946425778163e-01   +3.126992389760839e-01   +2.250310050090961e-01   -1.840701347877504e-01   +4.273571740266272e-01   -5.200138414988299e-01; -3.086730503377590e-02   +3.016508639899843e-02   -4.818985453254667e-01   +9.726457393668916e-02   +8.251719889064157e-02   -2.739967571105987e-01   +5.299168821518133e-02   +7.090160143069385e-01; +7.177010175069024e-02   +3.258989265569728e-01   +3.087168839946330e-01   -8.053417927555839e-02   +5.064182272243076e-01   +2.913820625576764e-01   +3.401878457826776e-01   +4.338557101588738e-01];
L3E_L2E_iAMPA_netcon = [+3.332173561175320e-01   -2.557409548529763e-01   -3.033704941232475e-01   +1.972978326107584e-01   +4.762025489287450e-01   +2.842231445000790e-01   -3.849696927239040e-01   +9.938380117774531e-01   +3.916039703767572e-01   +1.322623916804650e-01   +3.101906894523140e-01   -6.650186111963023e-01; -1.776692065089678e-01   +2.621129129541311e-01   -6.965387284411043e-02   -3.630543820266506e-01   -2.361029350143132e-01   -3.200648140917982e-01   -5.270631652410838e-01   +8.957504613903673e-02   +1.174060559608614e-01   +3.832182517644863e-01   -8.740785781680038e-02   +5.562525038875458e-01; -4.583794809889812e-01   -2.715661692311859e-01   +5.832281557756804e-01   +2.219984417745470e-01   +7.505512072133869e-02   -1.207649366379732e-01   +1.019975708126787e-01   +8.839748516378211e-02   +6.806975054067603e-01   -4.771154216436281e-01   +8.336135988270733e-01   +3.334614113569139e-01; +4.452440791598123e-01   +4.126075772285250e-01   -6.945180450328253e-02   +1.651991751954042e-01   +6.132895694325089e-01   +2.709435040915217e-01   +9.699458274089477e-02   +6.090841993766215e-01   -1.376077152149548e-01   -4.168952251225663e-01   -2.584103111682131e-01   +1.641759703639616e-01; +4.144253979539295e-02   +5.676361438419183e-01   +5.035973584191208e-01   +1.798310420922863e-01   +2.603271009079661e-01   +5.773065959982605e-01   -6.522628135952756e-02   -1.634204072778068e-01   -1.756600156330897e-01   +7.055371129262022e-01   +2.430504305875864e-01   +6.031113323559048e-01; +2.617361309172111e-01   -9.133642103585404e-02   +4.635279358224068e-01   +2.693612239726449e-01   +6.578623842984782e-01   +4.843357220642797e-01   -2.712565511557776e-01   -2.283350501507981e-01   -4.672411386381407e-02   +1.696532046636808e-01   -1.595113496485597e-01   -2.911727329650220e-01; +4.992058381147381e-01   +2.751561218406653e-01   +1.708776905799260e-01   -1.328757936964156e-01   +3.221239137079653e-01   +5.414737854562182e-01   +8.626278985831323e-02   +2.192890986905469e-01   +5.880788452967795e-02   +9.539384450159920e-02   +1.403239720904124e-01   +1.693225563992824e-01; -2.592133957203576e-01   +9.067366024535802e-01   +2.560154266520799e-01   -6.416998436596784e-01   +3.550860621786299e-01   -3.355401316050592e-01   -3.504043391664695e-01   -7.293032649593179e-02   +2.485576217537252e-01   +8.932975780339647e-02   +3.244091276569884e-01   +1.315984278403812e-01];
L3I_L2I_iGABA_netcon = [+8.455090779082520e-01   +8.031455234205467e-01   -1.121127667868642e-01   +4.849006456080583e-01   -4.223842295754595e-01   -1.759574159203271e-02   +9.088749572070278e-01   +6.301371521984828e-01   +2.248844684549587e-01   +3.333926038968715e-01   +2.336408940969903e-01   +1.014803997940659e-02; -9.969764813622364e-02   +1.311481863750233e-01   +2.047057971063362e-01   -2.163233276599712e-01   +2.751150326734951e-01   +2.142991241250244e-01   -8.499922871950737e-02   -2.186641197573966e-02   +3.125677846810895e-02   -3.567219470613004e-01   +1.345797405734310e-01   -9.030063246976200e-02; +4.558954920756366e-02   -6.350603795309929e-03   -1.930895058632993e-01   -1.187644974206704e-01   -3.248977562929171e-01   +4.028300971875398e-01   +2.921989464322565e-01   +7.170892131042028e-02   +2.236626892166588e-01   -5.151307408880910e-03   -1.770921245998208e-01   +8.564621146466445e-01; +6.328743343707907e-01   +3.036332299687281e-01   +5.863192450186772e-01   +1.655595232979857e-02   +7.838703057069768e-02   +4.913443290380419e-02   -4.164960861595512e-02   -1.525083853909052e-01   +2.726917196801584e-01   +6.820837364109448e-01   +6.372811932365460e-01   -2.338410688367577e-01; +1.707380566955760e-01   +3.695123104681475e-01   -7.575445991147714e-02   -3.397566937437815e-02   +3.125685312955798e-01   +6.096048416067097e-01   +1.870208003932638e-01   +5.122620102325874e-01   +2.509847822795175e-01   +2.704032547292533e-01   +3.500924011566797e-01   +1.461144238103242e-01; -1.280734081118886e-01   +3.057926914684110e-01   +4.766830399087909e-01   +7.176898842521001e-02   +3.211910649557727e-01   -7.541917390137086e-03   +1.015522924239767e-01   -5.524186326582567e-02   +2.861573543526831e-01   +1.226553457923846e-02   -8.632843229142659e-01   -2.864392863755470e-01; +2.469582030744651e-01   +1.976598682916575e-01   +3.100260474523589e-01   +4.097071955918163e-01   +4.790775783597921e-01   +6.801359646973348e-01   +4.092433604361633e-01   +2.275126945870251e-01   -8.220144710188986e-01   +5.519283808619736e-01   +1.488054440586980e-01   -5.469439495610929e-01; +2.282992692266401e-01   -1.738371998983061e-01   +5.859162805446763e-01   +2.118505641731053e-01   +1.282558187768592e-01   +3.047618011421823e-01   +5.681047665931197e-01   +6.055704431347285e-01   +5.101419104772503e-01   +1.426928796708946e-02   +1.777350233350771e-01   +1.618778776202117e-01];
L2E_L3E_iAMPA_netcon = [+4.694575752739738e-01   +2.708447941302306e-01   +5.646028395975119e-01   -7.089241646398408e-01   -4.215894590867938e-02   +5.087254746839267e-01   +7.509586676401696e-01   +5.019486874828076e-01; +3.764239314947052e-01   -1.748406785456532e-01   -1.221749210731801e-01   +2.376839428071259e-01   +7.997950306598358e-01   -4.772243743235705e-01   -6.614914333020224e-01   -3.853904195384308e-01; +1.175659910413523e-01   -5.189416423067951e-02   +1.321924377301225e-01   +2.561307080426524e-01   +2.093507380950476e-02   +1.811389451076448e-01   +1.257258958621966e-01   -2.039862336864248e-01; +2.698572036116877e-01   +4.913016487216283e-01   +7.911259209391500e-01   +8.142646509707026e-01   +3.213035853359169e-01   +4.187298314070668e-01   +1.333901739680372e-01   -5.887899753896589e-01; +9.644315926065630e-02   +2.168917376682443e-01   +2.038443247539093e-01   +3.598698294625064e-01   +1.063279065085274e-01   +6.204244885179277e-02   +2.232199454463111e-02   -5.098106999972838e-01; +1.405522215406490e-01   +5.500611719809555e-01   +5.177860235349713e-01   +5.856839751477451e-01   +1.156249406268650e-01   +7.490957866264002e-02   -2.091358083214810e-01   +1.740146396669079e-01; +1.926370192071089e-01   +7.854798498173656e-01   +4.397857919960181e-01   -2.124882571600199e-01   +4.227529323176047e-01   +1.226936417937280e-01   +4.736711892253218e-01   -9.378223481228225e-02; +2.475761288475749e-01   +2.940924219702279e-01   +5.122561853766070e-02   +2.609387651667241e-01   -4.368593719154872e-01   -9.215515246144169e-02   -8.512423648207618e-03   +5.487689651865127e-01; -3.452732435445291e-02   +5.386650970087552e-01   +6.020895281320742e-01   +8.533405850720335e-01   -1.584081968593992e-02   -1.471472295689345e-01   +6.849327260004725e-01   -9.672011094614447e-02; -2.007762398939951e-01   +1.035926662254003e-01   +3.468752029444382e-01   +1.686332864292350e-01   -1.840010033889916e-02   -3.235680625203668e-01   +3.723817473081570e-01   +2.451424796031615e-03; +7.075140747826179e-01   +4.055543624952427e-01   -8.471736901067577e-02   +4.868759725816154e-01   +3.777360876389063e-01   +8.674844599119759e-01   -6.330815767764525e-01   +2.470676559362152e-01; -3.313659644288925e-01   +4.632212052227102e-01   +4.403102356843102e-01   +4.295655140052244e-02   +1.824273806665391e-02   +9.789691733695718e-02   -5.570882294422858e-02   +5.692908404837072e-02];
L2I_L3I_iGABA_netcon = [-2.327539714202539e-01   -5.827918192873063e-02   +2.245329162257093e-01   +2.513713697936378e-01   +2.929062974979701e-01   +7.075867528954117e-01   +3.877409943211046e-01   +2.281443322387514e-01; -3.654815867838559e-01   +2.668382141611697e-01   +1.985810900204488e-01   -2.041805386755540e-02   +1.190253081120970e-02   -1.263976549236610e-01   +1.912965302091120e-01   +6.533962740889750e-02; +1.565202823992992e-01   +1.000000000000000e+00   +2.387291400945746e-01   +7.501325901832590e-02   +2.227657782139851e-01   +5.788229362987470e-01   -2.094365994368220e-01   -2.438923842857472e-02; -5.978517224407378e-02   -6.911098146193215e-02   +8.020273107086008e-01   -6.752783495050564e-02   -1.082026987043654e-01   +3.616905090205943e-01   +4.255803589403515e-01   +3.662056440129074e-01; +1.019223785067716e-01   +9.178882467369440e-02   +3.055533901203412e-01   +3.329375781249653e-01   +1.017780216724480e-01   +4.617583297464248e-01   +4.565432386806419e-01   +5.713676679684983e-02; +1.357193910885436e-01   +4.391410635469142e-01   +1.734823827334869e-01   +1.524824908066381e-01   +4.771082893805270e-01   +1.314711233949184e-01   -2.576542336188257e-01   +1.409226274145273e-02; -2.049869692748260e-01   +6.903827595153005e-01   +4.524368760649058e-01   +2.560047629798359e-01   -1.807464855306645e-01   +1.493845437410671e-01   +8.667403713172998e-01   +3.131396783924539e-01; -2.798650658380890e-01   +5.288347955975052e-01   +2.804271774665839e-01   +2.673082432430961e-02   -2.039172086188621e-02   +5.190403690741953e-01   +2.060073075797974e-01   +5.681076590179449e-01; -5.091100037655396e-01   +8.301895462565728e-01   +5.827716435373977e-01   -5.975145985996292e-02   +3.169260246690583e-01   +9.746789220636663e-02   +2.085547446120084e-01   +7.663639192203939e-02; -1.057503519592110e-01   -1.866222886413862e-01   +2.197561416189756e-01   +2.300578089987128e-01   +2.829768158976578e-01   +2.095335798110725e-01   +1.064244911964273e-01   +2.010127841474033e-01; +4.617820670747321e-01   +1.250130385843335e-01   -6.038859635843827e-01   +3.536522849162510e-01   +1.427576961611007e-01   -1.917720815226167e-01   +1.755847745271498e-01   +3.315179916428973e-01; -8.027954294567136e-02   +3.506549093344766e-01   +1.050955778376152e-01   +1.884872010337130e-01   +4.449834411651302e-01   +3.436506309871130e-01   +2.621433079455277e-01   -9.704226513130387e-02];
L3I_L3E_iAMPA_netcon = [+1.019992543450211e-01   -5.296665669898143e-01   +2.774467457108507e-01   +5.605565139169243e-02   +2.748296733487052e-01   +3.370060561171967e-02   +8.343344978728505e-02   +6.606991810287506e-01   +5.395036020514470e-01   +3.498213125799359e-01   +9.967560325174982e-02   +5.884074585008889e-01; +1.781401943520211e-01   +1.150451624654772e-01   +2.297066054248010e-01   +6.763067331269771e-01   +5.288305060755719e-01   +1.999094390613763e-01   +3.725447808865565e-01   +6.142512780870042e-01   +5.503830031625249e-01   +5.068282534677165e-01   -2.858645763430056e-02   -7.757900490517837e-02; +2.194656074794786e-01   +5.846200443083372e-01   +1.374187190982661e-01   -8.417622141585977e-02   +8.257524126365899e-01   +4.939510953117896e-01   +5.917996891983893e-01   -2.104937574418922e-01   +3.297741047347993e-01   +1.622251771657273e-01   +2.082433708384997e-02   -2.014379433595472e-01; +1.430863129146723e-01   +9.239303974615989e-02   +9.399356844019961e-02   -1.408710934876887e-01   +3.038857876636371e-01   +1.686031485038976e-01   +2.037506281603085e-01   +5.272445274154265e-01   -1.520521542303427e-01   +2.334984604381334e-01   -3.017864749914917e-01   +1.695903899626822e-01; -7.326776605050540e-02   +4.431398953976559e-01   +9.853285254621512e-01   +3.861494081384659e-01   +1.374859772793145e-01   -1.299032559976219e-01   -1.186456067306977e-01   +3.900181137900358e-01   +4.153715282193595e-01   +3.072167727612898e-02   +1.809588134417716e-01   -1.033978056818491e-02; +2.712618763298424e-01   -2.356002316884580e-01   -1.802235832186127e-01   +3.684966445497036e-02   -1.506112687259095e-01   -7.564427331903732e-03   +6.319345784283669e-01   -1.629223029049217e-01   -8.642230360625169e-03   +2.470649747781155e-01   +1.633998541336983e-01   +7.916060822604269e-01; +3.047817686528711e-01   +1.659845277607545e-01   -3.184372047313391e-01   -7.643663137391181e-02   +1.928091540599904e-01   +1.140710343598427e-01   +2.497211555046293e-01   +1.245581869678062e-01   +4.049752554594379e-01   +1.030131250898364e-01   +2.042258298570505e-01   -1.577859126860615e-01; -9.368129071230599e-02   +3.003243957556482e-01   -4.046943698942002e-01   -2.528854785208577e-01   +2.300260191652159e-01   +2.515744905219338e-01   +8.738861587893948e-02   -4.353217676883400e-03   -2.559051444589769e-01   -4.240999001380007e-01   -3.446218999242465e-01   +1.639495632873479e-01; -4.318381220101460e-01   +7.832727028044342e-01   +2.346449689512525e-01   +6.020995129947639e-01   -1.354852490186213e-01   +4.347099333216178e-01   +3.879999974078014e-01   +6.409286588303418e-01   +2.454865953774478e-01   +2.880196726175975e-01   +3.685704856148588e-01   +5.763459668647443e-01; +8.449939061932521e-01   -7.516033102769047e-01   +6.617101319320633e-01   -1.247658046974539e-01   +4.689246565844314e-02   -1.031234696072475e-01   +1.193027103467134e-01   +3.078033492640168e-01   -1.049669136458365e-01   -6.605924369516321e-02   +4.907215343005147e-01   -3.346671966153175e-01; -3.403838806595426e-01   +5.785697247817002e-01   +5.019125597406279e-01   +2.886639089281823e-01   -9.469902472527787e-03   +1.419920468503068e-01   +4.013280186003778e-01   +2.466647380149738e-01   +5.928128230488849e-01   +1.872261441623863e-01   -2.299119794240788e-02   +3.841982239870164e-01; +2.845372319137623e-01   +1.081368672593190e-01   +7.150999797660494e-02   +5.176168492875515e-01   -1.938131258886648e-02   -2.112180059552327e-01   -4.607158486425934e-01   +3.264341060962584e-01   +2.272964082217968e-02   -3.171893467934890e-01   +2.418166982502920e-01   -1.542780792070974e-01];
L3E_L3I_iGABA_netcon = [+2.278756201604228e-02   -2.077371883908809e-01   +4.841547303101502e-01   +1.962439154736402e-01   +3.085436887291948e-01   -9.838448447045943e-02   -4.692165778052060e-01   +8.973351818881743e-02   -2.245102783385685e-01   +5.850324764285816e-01   +3.514404513745244e-01   +3.381046643421798e-01; +2.409082914270704e-01   -1.529444617991153e-01   +3.107443207531889e-01   +1.311534591196808e-01   +5.621561733052493e-01   -2.163962645276293e-02   +1.862442370687250e-01   -2.168849100029886e-02   -4.529203847171827e-01   +2.568595969133795e-01   -7.657543974017210e-01   -1.343615973006523e-01; +9.331467223586437e-02   -3.321839831687825e-01   -4.641512520954513e-01   +2.839109975538106e-03   -1.261874936765370e-01   +2.481590465595638e-01   +5.448417561314705e-01   +7.857110562878815e-02   -1.523591984070030e-01   -9.906561568901735e-02   -3.520163637921226e-01   +2.062836267611881e-01; +4.382113506591957e-01   +4.199429681692664e-02   -2.791243387289005e-01   +7.715103695900711e-01   +7.830745413067970e-01   -2.239203340747151e-01   +4.052024301602627e-02   +2.029993957925844e-01   +7.271459571563754e-01   +4.411559954431500e-01   +2.997444429573952e-01   -3.714108912807869e-01; +2.387899216539454e-01   +2.834121244125268e-01   -2.981082437594215e-01   +1.285567180286463e-01   -1.012811554555119e-01   -2.820345482263500e-01   +1.922772432247771e-01   +5.066053844065272e-01   -1.944688830939329e-01   +8.878409431890323e-01   +4.355382243588937e-01   -3.271853254648446e-01; +3.523287601841109e-01   -1.165819151365568e-01   -9.097439312607597e-02   +1.523081251032007e-02   -4.394328866651528e-02   +1.141934950928883e-01   +3.580550542182941e-01   +1.286533879139659e-02   +2.718301438826965e-01   +2.484461413040227e-02   -2.517960381761290e-01   +8.208352426813521e-02; -2.592887179168350e-01   +6.049915697783127e-02   +3.581319336901444e-01   +7.669802843881375e-01   +1.425739922745011e-03   +6.046798208206262e-01   +4.955296126193734e-01   +5.588924728394832e-01   -4.790102074086233e-02   +2.635563661567030e-01   +1.762435954177664e-01   +2.013140425647753e-01; +1.709968812466884e-01   +4.573589623653548e-01   +7.182696705141313e-01   -1.952723490846867e-01   +3.778771684594006e-01   -4.791947330872197e-01   -7.261908201404783e-01   +6.834902878864448e-01   -1.892610733414777e-01   -4.650004332912517e-01   +7.156675730518843e-01   +2.897853520305916e-01; +4.665816620574729e-01   -5.211921407654337e-02   +5.726569298040114e-01   -1.642013691563316e-01   +3.232817550594587e-01   -1.209879306220250e-01   -6.667643610273980e-01   -9.166001608558938e-02   +3.953564118179526e-01   +1.926980103707379e-01   -5.596227143043439e-02   +6.107005738562944e-01; +3.481790188842164e-01   -2.206544500315787e-01   +3.728496340805895e-01   +7.102913127125493e-02   -6.067921469809564e-01   -1.066944050358847e-02   -2.871488896670763e-01   +2.661453244545266e-01   -1.268083894763121e-01   -8.988764249755285e-02   +3.381059203073786e-01   +3.586149868325327e-01; -1.287800612216943e-01   -1.514108111908457e-01   +1.450765553494072e-01   -6.633478337598013e-02   -5.012212634938998e-02   +1.253579573566028e-02   +3.712577552618043e-01   -5.345402962810792e-02   -2.754234230886558e-01   -4.310552000125263e-01   +1.629917212617755e-01   +2.276216235097647e-01; -8.046518812452549e-03   -1.889745259650808e-01   -5.116858286867786e-01   -1.371103068659333e-01   +8.074232624340892e-01   +2.705313307560212e-01   +3.506854711065484e-01   +4.405564554465822e-01   -8.107963124617042e-02   -4.087418731314403e-01   +8.128894140323492e-02   -6.161004466950789e-01];
L2E_Input1_iAMPA_netcon = [+8.257599020591768e-01   +9.717553452542078e-01   +7.281205930464016e-01   +2.026200018881789e-01   +2.889429858028841e-01   +4.332962440290559e-01   +8.623399109083645e-01   +4.360888332122666e-01];
L2I_Input2_iAMPA_netcon = [+6.323489512942900e-01   +6.997290638925434e-01   +4.630818395579499e-01   +1.277730006727503e-01   +5.404594332988348e-02   +7.041779091318672e-01   -2.127866258281302e-01   +2.912475537068212e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
