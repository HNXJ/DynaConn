function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.423707937969483e-01   +2.353216990916030e-01   -3.303151658748686e-01   +3.147210659126889e-02   +2.639446443000584e-02   +2.889691517966821e-01   -9.822961208454550e-02   +1.416617777819515e-01   -1.819396972205065e-01   -5.355838974296411e-01   -2.875098304571708e-01   -4.929715595587167e-02   -3.279189038050246e-01   -3.583827481683102e-01   -1.172857029018130e-01   +3.260519145784069e-01; +9.972258840751755e-02   +1.780293988574697e-01   +1.423669838716672e-01   -4.598423453870560e-03   -2.116906994008960e-01   -1.354413849199992e-01   +9.778201097427933e-02   +1.196335082730575e-01   +3.641396849051377e-02   -2.122933013933839e-01   +2.589040316011355e-02   +1.728540307940809e-01   +2.589792724345319e-01   +9.460414542217047e-02   -6.637594585187254e-02   +4.091842320201132e-02; +6.659306099924336e-04   -2.321723508941206e-01   -9.219590347349894e-02   +3.707659887484293e-01   -2.022193178858261e-01   +6.667711532884796e-02   +2.329774995940707e-01   +1.775017330326400e-01   +1.220234628259390e-02   -1.124299047219860e-01   -9.289393649459838e-03   -7.571416642820621e-02   -1.625657596829556e-01   -9.218199175283655e-02   +4.465792384356682e-01   +1.341444731516146e-01; +1.779951048879133e-01   -2.327296475552865e-01   -1.138272849745143e-01   -3.251296259453104e-01   +4.509469976785324e-02   -9.864110562801126e-02   -6.770191297962744e-02   +1.831293602542265e-01   +2.411023909984508e-02   -4.821562714640697e-01   +1.261803309285595e-01   -4.013854260300707e-01   -5.763515131452106e-01   +2.608904940945281e-01   -4.545629665746620e-03   -2.856455342404479e-01; -8.174957754431977e-02   +5.055250268880900e-02   +3.689573876726773e-02   -4.117843170709301e-01   -9.454314052012303e-03   -2.382436617583846e-01   -4.134380305631802e-02   +1.236479636491969e-01   -2.056524271485920e-02   +4.359759571221280e-01   +2.245295047046941e-01   +5.793016883706834e-01   +3.404332221880649e-01   +1.554415649293422e-01   +1.275635582146248e-02   +2.722352277777923e-03; +8.567673816191596e-02   +1.406716556186591e-01   -5.888360024555381e-04   +3.023786678531851e-01   +7.883940590118799e-02   +1.798105481974063e-01   -1.192832511254876e-01   +2.510178721697860e-01   -3.561551653440609e-01   -1.620703554365845e-01   +6.674341412618467e-02   -2.130456746899484e-01   -1.061361023878793e-01   -1.459604372322975e-01   -1.972390451346384e-01   -2.220904304296433e-01; +2.119531404428437e-01   -1.043879665398606e-02   -3.611787953395561e-01   +1.530341052174050e-01   +4.948959802858763e-02   +2.032496881943896e-02   -3.572461041605687e-01   +1.133356722164841e-01   -8.534649809495394e-02   -2.361118457034579e-01   +3.879429313210809e-01   -1.874595500467083e-01   +1.478596353788823e-01   +3.506977627071856e-01   +3.097934147827552e-02   +4.067128972072961e-02; -6.344832974317553e-02   +1.742648931982811e-01   -1.184059409188785e-01   +1.144531036506075e-01   +4.231621621848063e-01   +2.397665874513508e-01   -3.204098458572428e-02   -8.333966385778015e-02   +1.127732894868832e-01   -2.752039093006968e-01   -2.953263573776070e-01   +3.111728972935017e-01   +2.337240842196328e-02   -2.921864689195446e-01   -9.017103401233154e-02   +3.773997828868672e-01; +1.781613155165778e-01   -1.648545432288356e-01   +2.953162755410140e-01   +1.628746544671852e-01   +1.853073999668206e-01   -1.148766998085275e-01   +1.956939158296113e-01   -1.119759491479312e-01   -2.682213130159775e-01   -3.099437220929983e-01   +1.017600705204224e-01   +3.537330342542149e-01   -3.362981221913964e-03   -2.767773301380821e-01   -8.463540262559485e-02   -2.985492870082449e-01; +4.720874372616246e-01   +6.063442363122372e-01   +1.485608595476609e-02   +8.885929418327077e-02   -2.496776205772699e-01   -5.377452367509440e-01   -8.830639317170996e-02   +1.545633786721415e-01   -1.314381180108942e-01   -3.043852033570225e-01   +4.749373062243910e-01   -2.652819821921838e-01   -1.401120005859925e-01   +2.774548194686390e-01   +1.613892108379815e-01   +1.039504590593206e-01; +2.313387048455587e-01   +1.157752772499167e-01   +1.423711726704494e-01   -3.114287131621316e-01   -5.990181291695458e-02   -2.896945060360956e-01   +5.983223260085668e-02   +8.779057118560321e-02   +5.372672725693876e-01   -2.201779736067185e-01   -2.090023396974660e-01   +2.579358791223097e-01   +3.574493049917834e-01   -1.567945287107463e-01   -8.507401924807353e-02   -2.049949693078051e-02; +1.269670668817607e-02   -1.560029940390233e-01   +1.139293441023027e-01   -1.419927736076233e-01   +1.297741606407865e-02   +7.526730587309857e-02   +1.024569128806636e-01   -4.973354185680420e-01   -3.424038817964539e-02   +8.789773035214338e-02   +2.069102839250997e-02   -1.518770249048909e-01   -1.709298446085571e-01   -1.854208702972894e-01   +1.639790922499468e-02   +1.624839816769796e-02; -6.494624891915121e-02   +1.300350230957065e-01   +1.825349949986516e-01   -1.334237067307321e-01   -2.016877725289695e-01   +9.522991290535865e-02   -6.170069593098615e-02   +1.449998777165673e-01   -3.343693819596453e-01   +1.391260387315105e-01   -3.128331207713662e-02   -3.917855877639270e-01   +1.766074538843836e-02   +3.103051619803904e-01   -3.824092452389996e-01   +4.243017697555115e-02; +2.341093389571741e-02   -9.412466093142671e-02   -5.038665085474159e-02   +1.614992912219318e-01   -2.003890082648146e-01   -2.456813816782699e-04   -1.835637491671856e-01   +1.176169068643315e-01   -1.989493869395957e-01   +9.726056673455449e-02   +2.504694306252294e-01   -3.259452507573841e-01   +1.114787489246875e-01   +3.991459711731689e-01   -2.542510917602236e-01   +1.995919663370187e-01; -2.332833470953599e-01   +1.731388632478127e-01   -3.844735570504824e-01   +3.276680326015523e-01   -9.530568293881578e-02   -2.296230229184862e-01   -1.311986758395617e-01   +3.831674418713407e-01   +1.144932421878317e-01   -9.533025420816359e-02   +4.888305841844868e-01   +4.254823460970641e-01   -2.955946230047972e-01   -6.937025498434866e-02   +3.047768718898370e-01   +9.021148791891737e-02; +2.866016200806518e-01   -1.243653884483250e-01   +1.471672734838708e-01   +1.914834889034202e-01   +1.006807820661203e-01   -2.350625648996471e-01   -3.310560190201588e-01   -5.414877348485586e-01   +8.033755586999494e-02   -4.026849526512986e-01   -2.137554734815583e-03   -1.152582346300759e-01   +2.716503349856402e-01   -1.678986387750361e-02   +1.777203065679687e-01   +8.721292714781032e-03];
L1E_L1I_iGABA_netcon = [-2.433423069032912e-01   -2.445145572453574e-01   -2.431101415676740e-01   +4.488187717276876e-02   -1.693143465594947e-01   -2.277089490897737e-01   +1.249207004106186e-01   +2.713552739597726e-01   +1.780124207944618e-01   +6.522355980492028e-03   -4.448355059873875e-02   -1.573445153199327e-01   -1.551708717956899e-01   -1.644900818240075e-02   -3.396823897072621e-02   +9.164259083242784e-02; -1.256477349634983e-01   -1.997507692555098e-02   +3.867168554594298e-03   -1.632380891286583e-01   -2.226552399535092e-01   +1.692225883520918e-01   +1.420876743231209e-02   +1.115760190722620e-01   -1.150462712935428e-01   +6.021306173270211e-02   +7.602100003907201e-02   +3.554642338619074e-02   -3.043979314828966e-01   -2.886116981744107e-01   -4.366567609276144e-01   +3.387032978985046e-01; +9.981633723164648e-02   +4.431779902783363e-01   -5.983723004439143e-02   +6.447421276297209e-02   -7.532686019310227e-02   +1.942670351793567e-01   -3.379786204478415e-01   -1.820223593551154e-01   -1.205191377951050e-01   -1.503173453706125e-02   +1.987646396933196e-02   -4.243557008273942e-02   +7.153362152200152e-02   +2.488163653409171e-01   +1.111858424273943e-01   +4.600206987963508e-01; +1.084639536974384e-01   +1.493492591552439e-01   -3.236616403203609e-01   +2.742050196945455e-01   -2.989675168844684e-02   +3.147559370980414e-04   -1.196427108724772e-01   +2.133353417750609e-01   +2.819278450880800e-01   -2.624395397334321e-01   +1.174990944877388e-02   +1.761469117839776e-02   +1.010589439243810e-01   +2.084403290198926e-01   -1.695036980816259e-03   +1.861549658570655e-01; +1.441710123637669e-01   -1.421755990258751e-01   +1.501203934013201e-01   +1.976124946980590e-01   +1.293025080766934e-01   +3.366178419011785e-01   -1.506569558721964e-01   +3.123301434608321e-01   -2.165998240857848e-02   -3.476542788661866e-02   -1.834371427236562e-01   -2.763080545688609e-01   -1.165328116324613e-01   +4.440218291028984e-01   +3.761725908694027e-01   +2.149036585926629e-01; +1.501937806483587e-02   +1.048480612783192e-01   -6.792583689449200e-02   +1.474465878495535e-01   -1.973525923913438e-01   -8.899255284404642e-02   +3.230048506452279e-02   +1.733481010684053e-01   -1.330489499449404e-01   -1.047696418000801e-01   +1.678456536592657e-01   -1.744298142381457e-01   +1.939902498196824e-01   -2.678319751111491e-01   -2.260398280770768e-01   -2.481138551321668e-01; +3.745598951091540e-01   -3.069008636101456e-02   +4.335280206406432e-01   -8.826661774683333e-03   -1.689957844075737e-02   +3.615164239115862e-01   -9.451333095198929e-02   -3.643061281005239e-01   +1.397782103827944e-01   +1.579604167114761e-01   -7.782105208512023e-02   -3.211774513256408e-01   +3.721697304207151e-01   +8.721959510462293e-02   -2.961078503462122e-01   -1.209416570601793e-01; -2.764411792136444e-01   -3.268491169189616e-01   +6.074436746178691e-01   +7.915913203437844e-02   +4.894821066376051e-02   -2.271028950168368e-01   -3.175209433625412e-01   -4.006113499652624e-01   +2.544890600758016e-01   -1.208694944342343e-01   -6.782679447961878e-02   +1.172094678278472e-01   -1.002502696633400e-01   -2.624405959009324e-01   +1.765994620970975e-01   +1.414695921035294e-01; -5.323611088251837e-02   +9.598744655351378e-02   +2.465038087607902e-01   -5.300286878459060e-02   +8.710065149497989e-02   -5.453836693022678e-02   +1.163628848477573e-01   +5.597416824511117e-02   +2.104803859155243e-01   +1.773588303772144e-01   -1.110529010145629e-01   +2.240202950121902e-01   +3.425200292292777e-01   -3.906622590222673e-01   +3.117952353640732e-01   -6.728484997466422e-03; +1.398443582741089e-02   -8.917726228693530e-02   -5.791093960127688e-02   +1.933653463057812e-01   +3.464607204159299e-01   -1.221744407193919e-01   +1.962786258652649e-01   -2.158741394364667e-01   +1.971434606563965e-02   -8.936757488362787e-02   -2.975156757116228e-01   +3.124126229006954e-01   -4.202260250654165e-01   -1.505079398863147e-01   -4.284378197151116e-02   +4.331692564929265e-03; -2.170997703577748e-02   +2.076894267539027e-01   -8.097808238915283e-02   +3.842009365057466e-02   +1.188264751187061e-01   -2.324484428753189e-01   -2.250457322469785e-01   +2.258307731070981e-01   -7.516903761354704e-02   +1.393591133595961e-01   -1.682117520136276e-01   +3.069850942456578e-01   -2.255850977461371e-01   -1.445875289963112e-01   +7.075669954399869e-02   +3.251651929545406e-01; +4.668364197366665e-02   -1.813602346200182e-01   +2.187835995865288e-01   -2.441908628197861e-04   +4.375988832740335e-01   +2.819450243238001e-01   +1.080653695813743e-01   +5.765427757947221e-01   +6.314086963922515e-02   +1.191816216451830e-02   -1.777843755362153e-01   +1.720276894922304e-01   -9.104825443246753e-02   -2.525417461246204e-01   -4.265825371085019e-01   +1.303706570228609e-01; -4.074520603299173e-02   -4.867968065178088e-01   +2.361256543272512e-01   +1.757615152511477e-01   +1.778332226414556e-01   -1.316401645292302e-01   -7.521809428171172e-02   -3.644759802167955e-01   -3.976293120266705e-01   -4.356474433629776e-02   +3.660377810470824e-01   +5.223959821370884e-02   +4.749327584197827e-01   -3.231202082415499e-02   -1.216154867631884e-01   +2.509462932504692e-01; -1.260018080293771e-01   +1.699372996091478e-01   -1.298841997478586e-01   +2.463956779361750e-01   +4.416156810703645e-01   +1.084426705289871e-01   -2.601800696596837e-01   +2.954065433368374e-01   +1.606762101759903e-01   +2.861682519081669e-01   -2.671789506100947e-01   +3.850387098530078e-01   -4.234372931946495e-01   -7.555011867913931e-02   -1.611785421778228e-01   -3.875320267439748e-01; -1.209545322001100e-01   -3.466689604703951e-01   +2.411770475768040e-01   -3.184575346328271e-01   +2.221259042319373e-01   -1.835814387991300e-01   +3.405491923321582e-01   -4.013345336959007e-01   -1.030349761534044e-03   -5.167672733520320e-02   -1.095382738609184e-01   +4.277028055592341e-02   +3.351008796167989e-01   +6.767224399376436e-02   -7.721613038924346e-02   +2.942151467470250e-01; -2.546450862682121e-01   +4.237861483019684e-01   -1.409396382758732e-02   -3.956193175195103e-01   +1.768025997013404e-01   -4.197278219221390e-03   -1.709535345531809e-01   -2.153800481628500e-02   -2.321363868436355e-01   +3.067415201063325e-01   +3.120357025399230e-01   -1.393884343718963e-01   -3.894097350695086e-02   +1.714438173891131e-01   +1.624559411407748e-01   +2.472646254264155e-01];
L2I_L1I_iGABA_netcon = [+5.097340929414296e-01   -3.036785493922948e-01   +2.194236051041628e-01   +3.992487722242828e-01   -1.539801202584169e-01   -1.399348479627170e-01   +1.619461498891173e-01   +3.924677513476091e-01; -5.648729323909697e-02   +2.675441569050246e-01   -3.137395587324874e-01   +3.732505608535475e-02   +2.755905337676472e-01   +9.006066081242142e-02   +2.908482978263861e-01   -2.783734100419626e-01; -4.949003830507880e-01   +4.915772862437228e-01   +2.379978882906567e-02   -3.109704556752357e-02   -2.813051738604886e-01   +4.725051378362904e-01   -2.566637609160805e-01   +4.051339330223530e-01; +2.053271441234312e-01   -1.966069208354273e-01   -4.100755860005662e-02   +2.372583760158353e-01   -1.189240108448367e-01   -1.302201789722502e-01   -1.213699932440290e-02   -1.147880349338557e-01; +2.424184667759438e-01   +5.885630704722686e-02   +1.113292495635429e-01   -4.863960110608528e-02   -1.700620782774857e-01   -2.960343229507398e-01   +3.772905479519024e-01   +4.208902146177040e-02; +2.791652754131231e-01   -3.303704030943990e-01   +1.767998523231047e-01   -2.597809986568344e-01   +1.670213293570165e-01   -4.088412860941595e-01   +3.884017148107055e-01   -4.802102793762753e-03; -8.751979015126315e-02   -4.732678364294886e-02   +2.948817254164145e-01   -3.789530820869894e-01   -8.666707469198807e-02   -1.801665556684179e-03   +2.276129765804603e-01   +2.696397022793681e-01; -1.432105157634832e-01   +6.395988998873935e-02   -1.607565456710333e-01   +6.027295147851874e-02   -3.360043449007496e-01   +1.749417991412279e-01   +1.477219524014219e-01   -1.193339107123482e-01; +4.190436859686236e-02   +1.273100719840380e-01   +1.919077743842664e-01   +9.819156909045967e-02   -2.476554623279509e-01   -9.077777706101023e-02   +5.091122574587275e-01   +3.456422125688149e-01; -2.747365299263680e-01   +3.185817239868505e-01   +4.747642304623180e-02   -1.664724424499710e-01   -1.769396086415503e-02   -9.556710977704772e-02   -3.112452793403757e-01   -1.461914924115472e-01; -2.442605719485683e-01   +9.912984076851344e-03   -5.586393271878612e-02   -5.544508440422918e-02   +2.423729595531419e-02   +2.499468664980273e-02   -1.109992656420334e-01   -1.480415667650968e-01; +1.671662720549858e-01   +1.454826261635089e-01   +1.715903404224559e-01   +7.181890910645949e-02   -4.880006231205081e-02   +1.221572026608676e-01   -3.065730729088559e-01   -1.193020418705866e-01; -2.699414295410720e-01   +2.985104476234087e-01   +4.221503564236359e-01   -1.695486574204995e-01   +3.247648936171258e-01   +7.571382264412393e-02   +2.426369253591291e-01   +1.583490604324724e-01; +5.552225454413039e-01   +1.076419384031316e-01   -2.448314318317932e-01   +1.651242466004118e-01   -2.302445677680263e-01   -4.884343785804088e-01   +1.133319131126598e-01   -7.220602057784739e-02; +1.468610547657784e-01   +1.169891816405840e-01   +2.681076212131802e-01   +3.921919770109308e-01   +3.561193307666244e-01   -1.785417531652555e-01   +9.213130384374853e-02   +3.087001332893103e-01; -3.132740700299040e-01   +1.570784122201691e-01   -1.271464905551380e-01   +3.286955679373126e-01   +1.671123932371134e-01   +5.126109383844616e-01   +2.932431243241105e-01   +1.045065641223936e-01];
L1I_L2I_iGABA_netcon = [-1.581777264661424e-01   -1.852853120584835e-01   +9.850702201935840e-02   +3.083560451442095e-01   -4.412585303194622e-02   -1.303345755299542e-01   +2.407022325869549e-01   +2.086683836005424e-02   -1.482538502749557e-01   +1.990403839293980e-01   -1.700510845164985e-02   -6.185935887131228e-02   -1.322235334987365e-01   +1.994858690056638e-02   -5.099184196897810e-01   +1.927897540430533e-01; +6.322290605574203e-02   -2.102093282787360e-01   -1.267064827570255e-01   -2.412648428591335e-01   +1.650405653091344e-01   -4.487147785466901e-01   +8.068025910460283e-03   -1.454284443711016e-01   +3.891889136798867e-01   +9.341368869211469e-03   -3.637312598311455e-02   +3.024850584791399e-01   +1.826687937945828e-01   +3.355086906837726e-01   -1.201252709327229e-01   -2.254425735727630e-01; -4.401762196764916e-01   +3.291145669778327e-01   +3.454541692525708e-01   +4.522157848676056e-01   +6.734890303289501e-02   -1.035309943123104e-01   -2.111623989947359e-01   -3.796314358561284e-02   +2.388017622455857e-01   +1.446859727732711e-01   -2.242177107785470e-01   -1.112447764974834e-01   +8.861731273379184e-02   -3.310469684239118e-01   -2.149128778866818e-01   +1.434952130168576e-01; +1.671630937991631e-01   -2.793617648469159e-01   +5.564012261857994e-02   -6.686328802349512e-03   -1.464581081066356e-01   +6.146146330157787e-02   -2.178014960299320e-01   -2.015001423265086e-01   +2.841895560264753e-01   -1.748340907071285e-01   -1.513537981767161e-01   +7.931448539891284e-02   -4.705386979870402e-01   +3.232501996221936e-01   +3.964657181501227e-02   -1.871099289715003e-01; -2.267713784919816e-02   +2.291586395337777e-01   -1.175125979753809e-01   +5.723744324315624e-02   +1.019209159851820e-01   +9.565133043267732e-02   -1.018426510863902e-01   +1.742055569180571e-01   -1.893459984182042e-01   -5.591505119491912e-01   -1.385853274765218e-01   -3.712768344690380e-01   +4.129257379193595e-02   +3.611592115959588e-01   +4.524175289005926e-01   -4.362336002257367e-01; -2.499601542481416e-01   +3.006224096621399e-01   -9.234273710403962e-02   +1.739054503025201e-01   +1.568983197601876e-01   -8.799583883881714e-03   -1.215603668617297e-01   +1.558331903662049e-01   -2.000703597763202e-02   -4.403914164628472e-01   +4.483053966796492e-01   -3.718826456883391e-01   +3.185475935894852e-01   +1.899974701175126e-02   +1.641863073591473e-01   +1.167705432502285e-01; +4.525119716239330e-01   +1.019327578937462e-01   +1.079828171349214e-01   -5.205616512428300e-02   +2.709963955463325e-01   +3.458418600945545e-01   +1.491909980619702e-01   -2.959574177941716e-01   +2.346304455194784e-02   +4.534986777140840e-01   +5.156217232828395e-01   -2.888552907974202e-01   +9.630605500777978e-02   -1.150789255903781e-01   +1.232910850458306e-01   +1.365504376903635e-01; -1.310027648883700e-01   -5.085455508116310e-02   +5.802182180462780e-02   +5.685142975952494e-02   +3.238111015665696e-02   -2.776555764411937e-01   +3.973709102684014e-01   +3.653040734823600e-01   -3.091926878522049e-01   -1.993873911508538e-01   +4.552216482234624e-02   -1.103528427526470e-01   -1.646162313097066e-01   +5.262033260932071e-01   +3.110186934846459e-02   -4.036716274118636e-01];
L2E_L1E_iAMPA_netcon = [+1.419725643574863e-01   -8.815224384202226e-02   -1.525694726920073e-01   +1.530560579914129e-01   +1.707335141916180e-02   -1.115766591329184e-01   -4.280315944298395e-01   -2.878284752091630e-02; +2.278355966796508e-02   +7.658933238380597e-02   +1.003190894193420e-01   +9.666943960918686e-02   -1.814118942586093e-01   -6.701195342714776e-02   -2.522144120740164e-01   -2.193198501277189e-01; +6.494260910243216e-02   +6.496931402919130e-02   +4.638422329094974e-02   +1.622669903092862e-01   -8.501243173293760e-02   +7.058861088831569e-02   +1.076233037686151e-01   -2.148997334049815e-01; -3.692485892266237e-02   -1.961638302199146e-01   +1.185984708157623e-01   -2.022525857720272e-01   -7.073360756369790e-02   -1.336139863466489e-02   -5.857512081210492e-02   +1.266099618947699e-01; -1.664793077197262e-02   -5.038170323915893e-01   +8.397980080980388e-03   -3.414109135743051e-02   +4.334394983398898e-01   -2.567056501829105e-01   -2.185022156508221e-01   +1.304096897197966e-01; -2.364236254155901e-01   -2.015010655248428e-01   +2.707044043671187e-01   +1.332037195484613e-01   +5.101055255333752e-02   -3.367198679010840e-01   +6.378305653408277e-02   +3.737350343791501e-01; +2.566403296861899e-01   +1.481659124687195e-01   -1.380025718205849e-01   -1.027457952991034e-01   -7.224394258790348e-02   -7.035180812221055e-02   -2.273089212720449e-01   +8.518042277724153e-02; -1.161031861524948e-01   -2.163786459861589e-01   +1.380323218070198e-01   -1.250411950244216e-01   -3.254265173598316e-01   +5.450780620482253e-02   -1.664886444856768e-01   -1.778987267347004e-01; +3.191281501558145e-01   -2.834547241006238e-01   -3.609048494078798e-02   +6.817584678324085e-02   +1.632079034130959e-01   -2.333376605832441e-03   -5.861791712741352e-02   -1.645631616225316e-01; +1.085530176584628e-01   -8.315333385218946e-03   +2.894883684405064e-02   +1.320967865309465e-01   +4.774616165311183e-01   +4.140110550474013e-01   -7.811916706945861e-02   -1.071272040082828e-02; -1.062825847124571e-01   -1.549374105300021e-01   -8.402183523882820e-03   -1.107310432850303e-01   +2.073645537927965e-01   +1.528547907116870e-01   +1.292195445168829e-01   +1.601469826581512e-01; +7.084339748946011e-03   +1.323001770628426e-01   +1.043923112324912e-01   -3.237482001538483e-01   -2.676965220003610e-01   +1.448848270834307e-01   +1.743351803323793e-01   -1.961248080757454e-01; +2.787485213290750e-01   -9.113701657789117e-02   +2.021458310017339e-01   -3.045626664860646e-01   -3.282184698940283e-01   -6.203993190188321e-02   +7.958431456449311e-02   -8.673387043784667e-02; +2.534474518338978e-03   -1.274796871392530e-01   -5.557675405552484e-02   +2.615672230608841e-01   -4.010523466042818e-01   +9.419666385974139e-02   -1.543382105494413e-01   +8.171672038138394e-02; -3.661806494438068e-01   +3.848721566799592e-01   +4.015551679844412e-01   +2.843571836926765e-01   -1.581475029325204e-02   -1.756125758124923e-01   -4.652573102595018e-01   +7.842135038005515e-03; +4.370512432496525e-02   -8.683036113472015e-02   +4.560954919670437e-01   -1.426767071474793e-01   -4.308217016950009e-01   +1.114942774820069e-02   +1.932908347606341e-02   +1.387578207292435e-01];
L1E_L2E_iAMPA_netcon = [+3.446320881695353e-02   -2.741931049141152e-01   -1.761227955829249e-02   +7.516052377242444e-02   -8.698200558523356e-03   +2.005487098624199e-01   -1.149648422545832e-02   +5.096996776062678e-01   +1.471123936825915e-01   +1.487308532590522e-01   -1.736864577984124e-02   +2.725769695051255e-01   +2.289402417925087e-01   -1.257301831171305e-01   -4.012955512258001e-02   -2.802423751334573e-01; -6.322355422892056e-03   +4.513931545720388e-02   +5.961727676131228e-01   +2.857100883233958e-01   +7.303622529520498e-02   +1.028469388610984e-01   +1.376723190268698e-01   +1.028675679331787e-01   +1.343899255379517e-01   -1.210435895630079e-01   -4.376302550201265e-01   -1.226215935932618e-01   +1.712999908476254e-01   -1.729316873805973e-01   -2.486489281930220e-02   -9.251010408800935e-02; -2.718573760337871e-01   +1.272511687702918e-02   -1.938866049922746e-01   -1.435650750556567e-01   -4.164567013488546e-02   +3.609932027810956e-01   +1.148559552656563e-01   +2.872379661988070e-01   -2.862577007639668e-01   -3.585617430625514e-02   -2.719797626161147e-02   +2.414460214327482e-01   -1.941935232070634e-01   -4.919375262391734e-01   +5.646735351008947e-02   +2.299980551017038e-01; -2.667945816007222e-02   -1.741423807212101e-01   +2.596789392863496e-01   -1.905175353937734e-01   +2.382622082856340e-01   -1.615631801279852e-01   -2.931092726430864e-02   -1.205422433455840e-01   -1.353671028053354e-01   +2.083684549300452e-01   -1.324173713478135e-01   -2.809168871326712e-01   +1.506537278807787e-01   -4.396970337673197e-01   -1.325601287391612e-01   +1.547336357888910e-01; +1.042269900636610e-01   -1.409367434397055e-01   +5.652623777772061e-01   -7.493637191714271e-02   -2.030613690376488e-01   -1.026957084621712e-01   -2.813778572474711e-01   +1.190962909648151e-01   -3.615482734146089e-02   +6.989568791217668e-02   -2.324249157693096e-01   -1.905826715536003e-01   +2.564945265955260e-01   +1.134175203907659e-01   +2.068525474100014e-01   +3.085671831435409e-02; -1.292295541024975e-01   +4.271391378992316e-01   -1.064196622449110e-01   +5.297489874607958e-03   -3.150068497459170e-01   +1.039301413542280e-01   -2.620450670903298e-01   -4.703377139371775e-01   -1.456391526760148e-02   -1.154903224420312e-02   -2.425865389201706e-02   -2.942829531942824e-01   -8.127599100116747e-03   -3.988420916673179e-01   -1.010479277116766e-01   +8.728856729260467e-02; -1.394549069404760e-01   +1.411779002973935e-01   +2.211872540303496e-01   -3.216929400480842e-01   +1.120408799065850e-01   +4.580356141229056e-01   -2.314971100006387e-01   -4.869944050025776e-04   +2.173455666190862e-01   +1.018788667925313e-01   +4.444980579060088e-01   +3.526447747150925e-01   +7.430104420790493e-02   +3.208826605340654e-01   +2.213523858442353e-01   +1.434954573990199e-01; -2.990021790047290e-02   -1.959667189966032e-01   -9.863294084713403e-02   +1.318143232205439e-02   +2.618363410595848e-01   -4.024936887776244e-01   +1.514377577387837e-01   -2.196822301964753e-01   +1.314894911182500e-01   +4.911865064352954e-02   +5.182636092603785e-02   -5.937893264173993e-02   -1.339520197249410e-01   +5.921314169146169e-02   -2.003751109824908e-01   +2.209541810703805e-01];
L2I_L2E_iAMPA_netcon = [+8.445359045675352e-02   +1.148982384206769e-01   +1.151481977810225e-01   -9.088158399202187e-02   -7.385389805615583e-02   -1.269895373634428e-01   -1.280818329155547e-01   +6.274219411766523e-02; +2.122914532622533e-01   +4.221734888615941e-01   +3.418277396007792e-01   -2.709135499995770e-01   +1.841399362982011e-01   +3.917128261738875e-01   +9.018031594391478e-02   -5.219994225946710e-01; -1.504142202164414e-01   -2.688498385206811e-01   -2.296973794690865e-01   +1.076985899565561e-02   -3.202336089101889e-01   -3.571959074639278e-01   -4.011403569572411e-01   +1.880794965211404e-01; +1.807919986122236e-01   -6.797031285599203e-02   -1.471145078361289e-01   -2.256472803650335e-02   +1.759610909699203e-01   +1.825492324754831e-02   +1.286639332776183e-01   -1.661810622784710e-01; -3.401249280627933e-02   +9.390057053634050e-02   -9.062220191271592e-03   +3.886959144736068e-01   +1.343926478833533e-01   -1.344394045252703e-01   -2.677228645133355e-01   +5.300062535453896e-02; +5.501410296254106e-02   +2.574130132186223e-01   -3.363648876587466e-02   +1.179379402959390e-01   +1.834789794508901e-01   -3.067446382771302e-01   -3.960677492539949e-02   -7.032366035208829e-02; -1.793217489981924e-02   +3.316489659102451e-02   +1.443155376992620e-02   -5.843271506277783e-02   -3.715655203319674e-01   -3.158457625142690e-01   +1.216798981222802e-01   -3.435502029359451e-01; +2.429312843143771e-01   +1.341457040970577e-01   -5.601178306034921e-02   +1.006435092443572e-01   -1.563435073323288e-01   +1.875033535026848e-01   +2.565362881265285e-01   -3.884096017106208e-01];
L2E_L2I_iGABA_netcon = [-6.026741965477178e-02   -3.037834535247517e-01   +2.348036210849844e-01   -9.624228151356018e-02   +2.590874346319144e-01   +2.046507314047130e-02   +1.593552844265850e-01   -3.509952774533184e-01; -2.099923625788805e-01   -1.729011585511983e-01   +1.790182256407196e-01   +1.622164711939326e-01   +3.732121650889336e-01   -5.562733550627433e-02   +1.251106541250883e-01   -1.031708139704666e-01; -1.425929576051457e-01   -1.027601764466520e-01   +5.957325484135867e-02   +1.579808932854414e-01   -1.318810464655373e-02   +4.383652577064079e-01   -3.235216818619298e-01   -2.205663972420852e-01; +1.373283176605589e-01   -1.197461692301980e-01   +6.681641019506165e-02   +2.608424083820314e-02   +5.475455755288851e-01   -2.024967329680754e-01   +4.340678540016388e-02   +2.143937656697265e-01; +2.252179916957883e-01   -1.260133970736936e-01   -1.990261509636234e-01   -1.732051914108328e-01   -3.724787606670595e-01   -3.636185554372010e-01   +5.357702644479132e-01   +5.343889495909648e-02; -6.788977911597902e-02   +1.358214863808529e-01   +1.526734512407559e-01   +1.864296686995462e-01   +3.805279122580629e-01   -1.426792764104025e-01   +1.928982793588800e-01   -1.947609678672582e-02; -1.764755967123103e-01   -1.333254445044776e-02   +7.189246374989878e-01   +1.236432271140687e-01   -1.380891905894756e-01   -2.151943629309946e-01   +3.659642412157810e-02   +1.133555373013400e-01; +1.993064222596510e-01   -1.091210960378740e-01   +7.390272648540142e-03   +6.348750927349781e-03   -4.460694069885643e-01   +1.390708147614157e-02   +3.176020083021617e-01   +1.414156737427852e-01];
L3E_L2E_iAMPA_netcon = [-7.257692752956145e-02   +1.814214140821185e-01   +2.473851938910901e-02   -4.506535087635177e-02   +1.587053912311745e-01   +1.728325110466880e-01   +4.116476585696059e-01   +3.239670092125346e-02   +2.614445905589363e-02   +2.717067314837691e-01   -3.695867854904475e-01   -7.376964110457207e-02; +6.590158802145973e-02   -2.133931327730441e-01   +3.744561906872166e-01   +1.960812779844648e-01   +4.075407829395639e-03   -2.183020857254418e-03   -3.688504873013475e-01   +1.726415678585903e-02   +1.819247339192920e-02   -4.028366337154995e-01   +4.346900830827782e-02   -2.431280516633961e-01; -1.366627657266474e-01   +6.601417272050242e-03   +1.913732175272116e-01   -1.051151771933560e-01   -2.537259225200720e-01   -1.851002328949086e-01   +3.157615931290120e-01   +1.107618929847661e-01   -4.392959141220035e-02   +1.881271506331669e-02   +8.806799915071410e-02   -5.218792522634347e-02; -3.327363082576051e-02   +1.027906638353939e-01   -4.926701888779092e-02   +3.621998982686170e-01   +1.980864031518564e-02   -1.340877233070552e-01   +1.414661353120509e-01   +2.552458339917422e-01   -2.128081067439546e-01   -1.301458952900370e-01   -2.719079262922097e-01   +1.690761496261811e-01; +2.024375309500401e-01   +1.894717253270836e-01   +1.289320861313401e-01   +9.126988877923567e-02   -5.481215143010951e-01   -1.122122560646022e-02   -1.435770422053411e-01   +2.769887844048874e-01   +1.943744017332558e-01   -1.148346312048808e-01   -2.975281170032764e-01   -2.268913452507931e-01; -5.983167153694520e-01   +1.521324227117862e-01   +7.705801648761232e-02   -2.034145911839743e-01   -1.814888386399059e-01   +6.483558788653748e-02   +3.202770381695476e-01   -4.186935563696655e-01   +5.647642264592176e-02   -1.151558412267257e-01   +1.829940075427443e-01   -1.808902231261672e-01; -2.484244583387160e-01   -3.381683480525292e-01   +5.979126679301741e-03   -1.768301906056694e-01   +4.463207150238370e-01   +1.413821682354996e-01   +2.451081246312915e-01   +2.807435894056088e-01   +3.492993699345021e-01   +1.458277312110801e-01   +1.758502977588717e-01   -3.172902141472028e-01; +6.342426349875246e-02   +2.598509931884935e-01   +2.802582008935194e-01   -5.547670398724966e-02   +8.029032435061326e-04   -3.043823778999599e-01   -1.198918440269331e-01   +2.775251621109243e-01   +1.630434038535576e-01   -1.507960291159022e-01   -8.327167373471460e-02   +4.164227172358162e-02];
L3I_L2I_iGABA_netcon = [-3.060112158795568e-01   +2.545765504635544e-01   -5.555416211453733e-02   +2.757588244491613e-01   -6.793676416072347e-02   -2.041898605081937e-01   -4.595169171415080e-01   -1.574837789922627e-01   +3.100538894812620e-02   +2.956942846976458e-01   -5.002793626740940e-02   +1.702036811197210e-01; -1.775314955061807e-01   +1.324531153867688e-01   +4.243602216380006e-01   +1.960815438639234e-01   +4.619082414996120e-01   +2.086182919488453e-01   +3.922561916735754e-01   +1.919878032744878e-01   -4.750316312641298e-02   +4.011421933758896e-02   +1.193814267474189e-01   -7.252527730498914e-02; +1.046066971965281e-01   +1.690798807978540e-01   -2.739840297044819e-02   -2.446965697703015e-01   +2.336858047033326e-01   +8.996935466023448e-02   -8.726774973828809e-03   +5.001993037461793e-01   +8.850071150521269e-02   -9.610753060881638e-02   -5.984932809389581e-03   +9.507844117683635e-02; +2.975288082700693e-01   -5.290153303823329e-02   -8.977692693384767e-02   -4.156114786494603e-02   +5.437645727950278e-01   +3.550471135487479e-01   -1.080270419498151e-01   +2.880999395624395e-01   -8.073652201660438e-02   -5.231589855673954e-01   +2.251793251303733e-01   +2.338517122100720e-01; +4.569887226594969e-01   -2.498145920995403e-01   -2.965375737859282e-01   +5.699502705419053e-02   +1.386908698334802e-01   +2.592336641916145e-01   -5.421930263692365e-05   -6.008529530624985e-01   -2.044692665712762e-01   -1.550748211836916e-01   +4.409615334441127e-01   +1.669185477876183e-01; +8.280050301715366e-02   -2.914483247613672e-03   +8.352603891532079e-02   -3.687170581625843e-02   +1.156433861536060e-01   -1.247007987197554e-01   -4.579969902451844e-01   -3.056605078111087e-01   -1.504147866325795e-01   -7.942633749223103e-02   -4.096327518747962e-01   -3.322878585942051e-01; -3.409043052076730e-02   +2.252846573395920e-01   +4.552948989073018e-01   -2.448501732903142e-01   -3.876319046328597e-01   +3.855869431963743e-02   +2.500808150667292e-01   -3.452843465608507e-03   +3.501111966290033e-01   -3.977317885874903e-02   -6.269970309922962e-04   +4.312211319704933e-01; -1.391591044327651e-01   -2.911364404179833e-01   -2.862931672151771e-01   +2.218150292716917e-01   +3.688524104599012e-01   -2.902206936224989e-01   +1.046162286097048e-01   -1.200972476830964e-02   -2.069630138839809e-01   +2.284303492170968e-01   -7.716646213933617e-02   -1.459820475440855e-01];
L2E_L3E_iAMPA_netcon = [-2.958969332577494e-01   -2.033581016612892e-01   +5.891916978501703e-02   +8.348909910720509e-02   +3.399281882628717e-01   +4.886340096773397e-01   -1.454808192613353e-01   -4.063363790003651e-01; +3.344264881673318e-01   -1.548925947881347e-01   +1.843349464926822e-01   -1.847516641233171e-02   -2.174559822262681e-01   +1.080017875070899e-02   -5.688839676469137e-02   +8.818248852665589e-02; -1.174947652801174e-02   -3.486354588829028e-02   -2.980489130600734e-02   -4.281041496577421e-01   +1.088607379805304e-02   +3.381782382961764e-01   +1.786164688745522e-01   +1.400257650580607e-01; -2.643552504740131e-02   +1.926276086121368e-01   +2.304881703846341e-01   +3.674082652758209e-01   -2.992651326327844e-02   -6.567608332013491e-02   -3.112558857006883e-01   +5.324175973427569e-02; -2.265814115122927e-01   +7.349266132700574e-02   +1.300923621186040e-01   -8.816459817282638e-02   -2.489121075571156e-01   +6.811520361404358e-02   -1.689372066201187e-02   -9.305911195311600e-03; -4.912933812037518e-01   -1.509881476648049e-01   -6.662775740036564e-02   +1.126568548052287e-01   +2.326637638765429e-01   -3.468388603937436e-01   +2.640936514147133e-01   -2.135268054124112e-01; -1.093451920751481e-02   -1.821544028263610e-01   +2.671129952482814e-01   -2.776935200367793e-01   +1.022980768384271e-01   -1.147920095877876e-01   -1.760391927850871e-01   -2.301162427530828e-01; +2.054286792606226e-01   -1.236626438812723e-01   -1.301225131107324e-01   +1.339742920126163e-01   +6.567318247288720e-03   -4.714872581665552e-02   -2.212878611980657e-01   -2.323106408282644e-01; +1.126097825038530e-01   -1.385903804343452e-01   -5.088868412830132e-02   -3.033876290407611e-01   +1.054593125433833e-01   +1.791892384583624e-01   -4.636941959468177e-01   -1.583643036376680e-01; -4.414821114053696e-03   +1.235975473143830e-01   -2.904619276939738e-01   -1.766887556901720e-01   -1.096387219938093e-01   +5.297832739867911e-01   -1.642968015840991e-02   +3.251564200413162e-01; +1.091350533400979e-01   -2.610697541281980e-01   +6.891391271426922e-02   -5.970327162842927e-02   +1.592461508316553e-01   +1.637357400595872e-01   +4.448480685114179e-01   -1.559226284157708e-02; +2.106586808469560e-01   -4.138672404861210e-03   -1.032259208953537e-01   +1.477320028959014e-01   -6.968557523618468e-03   -2.867903752528961e-01   +7.242121336279064e-03   -7.577236985939031e-02];
L2I_L3I_iGABA_netcon = [-3.454090986602668e-03   +2.863644269503414e-02   -1.868892657132298e-02   -4.670824469622914e-01   -5.629194843294196e-01   +1.167074542113018e-01   +6.903182201826311e-02   +1.031491418368740e-01; +1.631245318031258e-01   -3.869516393622476e-01   -1.742501277756118e-01   -2.639242885161664e-01   -2.281876828895754e-01   -1.148099856793200e-01   +2.755110029592273e-01   +2.295721169784432e-02; -5.230030097553956e-02   +2.093880967582882e-01   -9.789155133366283e-02   +1.768508659011385e-01   +6.175690187624927e-03   -1.184848453365877e-01   -1.727481211491599e-01   -2.983407533136094e-01; -1.538786344524901e-01   -3.204531928454440e-01   -2.795822968503260e-02   -2.604476718764419e-01   +4.793679684624387e-02   +1.215549757784635e-01   +2.732350937459016e-01   +1.381617906453267e-01; -1.867025381592791e-01   -3.608613181078028e-02   -1.002783773997309e-01   +2.532332924399962e-02   +1.179011838645689e-01   -2.408148432650695e-01   -3.475778430361623e-01   +3.335095148353441e-01; -7.115592373977545e-02   -9.382208695767129e-02   +4.455368028828399e-04   -2.412542546454583e-01   -7.905408912611728e-02   -7.941371508589459e-02   +1.420980783449930e-01   -2.114398706155865e-01; +4.995915499454968e-02   -1.989071017425043e-02   +8.590065932457024e-02   -8.248962546188844e-02   -5.525789565974024e-01   +1.026737228713287e-01   +3.106745963397026e-01   -2.715635001425003e-01; -4.361231663360418e-01   +1.220759071570387e-01   -3.682032073520625e-01   +4.596021388457389e-01   -3.879340043115868e-01   -3.476147232626535e-01   -1.950802189575264e-01   +1.961639139654768e-01; -1.396270777340476e-01   -2.696596979260987e-03   -3.761591068240964e-01   -7.706652778747389e-02   -2.264762912169604e-01   -1.840873435687277e-01   +7.001569726444012e-02   -2.268955281482118e-02; -2.491435540890573e-01   +2.091856548825564e-01   -3.966056839466631e-01   -2.331409308710661e-01   +2.925899680590982e-03   -2.096110294489933e-01   +6.877475488938381e-02   +1.422271249954206e-01; +1.602587812775062e-01   +9.333878101087043e-02   +4.438576226954399e-01   +2.824424676824754e-01   -1.640553689238527e-01   -1.273227824480926e-01   +3.221126778690336e-02   +9.050477693777148e-02; +1.110812643607669e-01   +1.463696124141024e-01   +9.193867893951531e-02   +9.838340188145960e-02   -6.579170855662980e-03   +1.494625490098006e-01   -6.246746802527206e-02   +1.964628584039495e-02];
L3I_L3E_iAMPA_netcon = [-4.791729716966889e-02   +7.378301952136665e-04   +1.726197943263347e-02   +2.737522119648982e-01   -7.320759294858147e-02   +1.732236471705372e-01   +4.380376788218392e-01   +9.189560453631046e-02   -1.828888173703239e-01   +2.995252989559380e-01   +2.424938985110196e-01   +5.352122982984274e-02; +3.295057735133328e-01   -3.844108346614075e-01   -1.063357696569015e-01   +5.203651248661524e-02   -3.009144596476330e-01   +9.500795611968429e-02   +2.339307607018930e-01   +4.374727099560344e-02   +1.832005152377265e-01   -8.247134065071451e-03   +6.058858419319202e-02   -1.023271265430100e-01; +4.812614169115881e-03   -2.426530761497145e-01   +1.118727908010712e-01   +8.843665454046032e-02   -4.434522038526381e-02   +7.829405080189408e-02   +2.725213547116427e-01   -2.410842788477280e-01   -1.606717880372101e-01   -2.630951456632770e-01   +1.816622529314516e-02   +3.328881961900620e-01; -9.824146316718291e-02   -2.014671103773759e-01   -3.732377639238834e-01   -3.752967239391806e-01   +5.510332811107660e-01   -2.841614957232135e-01   +1.189657127246255e-01   +2.014304788524171e-01   +3.379267778242439e-01   -6.721308993750909e-02   +4.146398772620853e-01   -1.401412510657580e-01; -3.690018700574088e-01   +6.773196490247158e-02   -2.860649789920604e-02   +7.767500125804322e-02   +1.902972971723762e-01   +3.201057005716441e-02   +2.266464195935948e-01   +7.924535417379631e-02   +3.632629639784585e-01   +1.531408383937809e-01   -5.324408108863911e-01   -1.789397083301397e-01; +1.839808168338150e-01   +1.020148267612106e-02   +2.428544531038088e-01   +5.158559255045532e-01   -2.716828864905729e-01   -3.759948580682733e-02   -3.612530762991162e-02   -3.211678339914409e-01   -1.522401414040201e-01   +3.438449747384770e-01   -3.702005661897967e-01   -1.142940776453530e-01; +3.896290877528312e-01   -8.531001700210754e-02   -3.062970457560345e-01   +2.576459805994483e-01   +1.399526333986856e-02   -1.277389003717307e-01   -1.541793253577761e-01   +3.639483092812156e-02   -3.325263601524699e-01   -1.672504029031484e-01   +6.875262710314439e-02   -3.251492405348878e-01; +3.002436226770664e-01   -1.778962804565883e-01   +1.014254388511314e-01   +2.667790670260302e-01   -3.370160102485682e-01   +4.355256859288301e-01   -1.328850440347351e-01   +4.987149003169217e-02   +9.678877970834178e-02   +3.075484404061050e-01   +1.643928542825616e-01   +6.717626979669075e-02; +5.537916647548985e-02   +1.945527983549222e-01   +1.978624064124473e-01   +9.592000333463833e-02   +9.761843890690067e-02   -7.960763334914250e-02   +3.542406893102951e-03   +6.516148093412959e-02   -3.513161097933966e-02   -3.250886446092605e-01   +2.060024149864925e-01   -3.525908145497226e-01; -2.452307895679791e-01   -3.116989369023259e-02   -4.494339433533592e-02   +1.293981585356339e-01   -1.424180095720678e-01   +1.752460345500431e-01   +1.065942175663137e-02   +1.621264937498234e-01   -4.907559169037845e-04   +1.930911724733145e-01   +2.727943112157798e-01   +5.290958204175343e-01; +1.077034411868219e-01   -1.686233610041225e-02   -1.489047551994656e-01   -9.943764600039090e-02   +1.225567798135055e-02   -1.811466234846713e-01   -3.412560146183066e-01   +6.164542938435084e-02   -1.010805085580591e-02   -8.915767326548431e-02   +1.067121912910341e-01   -5.999344818995449e-02; +6.396996843036511e-02   -9.767200192907480e-02   -1.975395867983732e-01   +7.247246569473872e-02   -5.041796954598410e-01   -2.636541273525864e-01   -1.599363541934604e-01   -2.362084040824564e-01   -3.064277259522715e-01   +2.362661230993537e-02   -4.316662538363760e-01   +1.485481455593886e-01];
L3E_L3I_iGABA_netcon = [+4.756130771017714e-02   +1.129660327871835e-01   -3.348201711567346e-01   -1.701461710412633e-01   -2.093332269039802e-02   +2.273942900558100e-01   +4.889277238648636e-01   -2.957808452166955e-02   +4.477545309228781e-03   +2.807306663990800e-01   -6.828173646038152e-02   +1.657003083487113e-01; +2.485030032147145e-01   -2.107820192326104e-01   -8.228837075737774e-02   +1.261320898846494e-01   +3.443089086250344e-02   +8.363622740779536e-02   +3.911268286636995e-01   +2.661795125225908e-03   -4.217631346834994e-01   +1.728372593612375e-01   +5.532291251681356e-02   -3.605027055405127e-01; -1.223239453633094e-01   +3.178620059513754e-01   -3.676999400888878e-01   -1.153701107208464e-01   -4.314292364533495e-02   -4.849328337622689e-01   -1.989091460825768e-02   +1.944975833550459e-01   -2.904777445405704e-01   +5.335704431607774e-03   -3.862284450914859e-01   -5.159596166590352e-01; +2.865053361914718e-02   -3.604368257521881e-01   +6.498499832302065e-02   -8.890754563049458e-02   -1.239493243520904e-01   -2.795750230214524e-01   +2.504368632217207e-01   +4.873842602120532e-02   +7.895682837348875e-02   -1.338150767559077e-01   +3.112193998075984e-01   -3.463978248998700e-02; +3.051684052842003e-01   -6.798346571415756e-02   -4.175351253189373e-01   +7.910638705587203e-02   -2.683895425377900e-01   -6.053033089385401e-03   +1.853172002820513e-01   +6.665848197609882e-02   -2.822344114765774e-02   -3.371723948493494e-01   +3.264831454166466e-01   -1.950144231275261e-01; -5.029891470970105e-07   -1.575115179004470e-01   -4.688317836854890e-02   -1.748822310601653e-01   +3.608209082031715e-01   -5.379118706105868e-02   -1.522174311155505e-01   +2.281652018208848e-01   -1.506591500223694e-01   -1.773900833157444e-01   -4.069581326219317e-02   +2.719327302543378e-01; -3.250786522501661e-01   -2.889600199056976e-01   -2.677107051132511e-01   -6.652011182719128e-02   -2.377054043324191e-01   +9.037028163633569e-02   +2.936228290449909e-01   -1.409429294813962e-01   +2.997212195540361e-03   +4.506245813929773e-01   +1.989067669908040e-01   -6.191224660713956e-02; -3.211705392568666e-02   +2.161715650932686e-02   -1.864886269224614e-01   +2.392737960794511e-01   -1.185429332989439e-01   +8.913044999429783e-02   -2.247398524309208e-01   +9.344370713213951e-03   -2.016318542653098e-01   -2.886941524949058e-01   -5.103464085732814e-02   +1.728754595501735e-01; -3.011375819981636e-01   -3.723998759247103e-01   +3.782327045751206e-02   -4.923757539715633e-01   +4.861040335599934e-01   -1.233208368702135e-01   -7.350202091920044e-02   +2.055671899331726e-01   +1.083552493127228e-01   -3.261168963087360e-02   +1.649703563354803e-01   +1.708737198209032e-01; +1.108896840453572e-01   +2.792645741297041e-02   +4.605969378574487e-01   -4.845912022724293e-02   -8.820664095632083e-03   -3.904080027669286e-02   -3.345261283542881e-01   -4.658106411480481e-02   -3.545616385429986e-02   +1.886588388009594e-01   +3.124091017768778e-01   +5.618001449636291e-01; +1.796872476761635e-01   -6.725145652107650e-02   +1.625204755473024e-01   -3.637161878686347e-01   -2.068765891228420e-01   +6.865524239383844e-04   +3.524635804483027e-01   -4.618125545757876e-02   +1.051562152171419e-01   +2.833497652414272e-01   +1.192829581344182e-01   +1.252813806882310e-01; +6.325221098742539e-02   +1.409082428329069e-01   -3.563864635796837e-01   +1.092671174489558e-01   -1.264743292997749e-01   +1.351041216958805e-01   +5.200940393892792e-02   -2.714542273442311e-02   +3.698150628929899e-01   +1.915160512215786e-01   +4.081416605304804e-01   -5.596841431702052e-02];
L2E_Input1_iAMPA_netcon = [-1.200288976134133e-01   -4.952739066022788e-01   +6.563499380013579e-02   +3.247013938211406e-01   +9.931558752149476e-02   -2.016857125932257e-01   +1.263518542164925e-01   +4.292554901606357e-01];
L2I_Input2_iAMPA_netcon = [+5.631320266566080e-02   -8.839782207939043e-02   +2.521491822216764e-01   -2.640273293224843e-01   +2.990370212012031e-01   +9.685513540876045e-04   -1.681090285637260e-02   +1.005240168686444e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
