function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.387955319883064e-01   +4.246282877782338e-01   +5.521351656512038e-01   +4.637013118366731e-02   +4.043475150702455e-01   +8.368153642395254e-01   +8.816773156378466e-01   -7.547584428265451e-02   +2.252018674020282e-03   +2.905053350324939e-01   +4.200448063448848e-01   +6.565983365571075e-01   +4.215363388850348e-01   +5.020033368262762e-01   +8.134288261279845e-01   +6.140323378506027e-01; +4.208287713745706e-01   +1.548441149106505e-01   +4.311503263391388e-01   +3.559995664712454e-01   +3.334346250958662e-01   +2.034114153160363e-01   +2.185999709763180e-01   +5.962284628677177e-01   +4.246076627252390e-02   +7.151747476069191e-01   +4.298964023179803e-01   +7.780993787493846e-01   +8.711285212416353e-01   +2.994095843927359e-01   +6.876190703811486e-01   +5.725042697244388e-01; +1.285334704572750e-01   +2.774416008784009e-01   +7.492508769606110e-01   +7.944507423816726e-01   +6.917440542642633e-01   +3.241478389597474e-01   +2.530713304556408e-01   +6.442131292831496e-01   +4.044352683195835e-01   -3.731334429836038e-02   +5.300660999408954e-01   +8.546082521613479e-01   +4.356293360310971e-02   +3.376259324817356e-01   +7.843962577790313e-01   +1.186163010147127e-01; +5.026512473077215e-01   +7.507010562004343e-01   +6.941427355236647e-01   +7.021816544743780e-01   +2.843356340831332e-01   +4.103144046270901e-01   +9.041842071737316e-01   +5.034161292898998e-01   +8.891097383254605e-01   +5.722427948972700e-01   -4.324693754438468e-02   +5.029622240958046e-01   +6.587537981801534e-01   +8.217677055320562e-01   -1.232790677747226e-01   +5.032586159488899e-01; +3.655278043524849e-01   +8.308170839047414e-01   +1.560131975112933e-01   +3.390963744296344e-01   +3.869713973923474e-01   +2.625574500888449e-01   +5.452414994552882e-01   +5.554806845013868e-01   +8.678423482537029e-01   +2.716810427107511e-01   +6.264652835322867e-01   +5.294477883312450e-01   +3.259241892864349e-01   +6.540102052284290e-01   +4.524070440411365e-01   +3.142916965477704e-01; +8.059843706859107e-01   +7.396663584052220e-01   +5.577286887150729e-01   +2.593858531909514e-01   +2.041851429679720e-01   +6.176799419497546e-01   +7.892785068190158e-01   +1.655059504205056e-01   +3.101986594083552e-01   +7.201965168248377e-01   +3.137170739788497e-01   +8.084381329022952e-01   +6.319674331649208e-01   +6.562598494962517e-01   +7.625107070687799e-01   +3.336353383660409e-02; +5.213215022081593e-01   +7.658867642828923e-01   +4.344477073666200e-01   +5.445824443660412e-01   +5.088413566581773e-01   +4.072717489767556e-01   +5.631528275607572e-01   -2.383751385130696e-02   +5.217861802421814e-02   +2.549048477255632e-01   +4.680205398217293e-01   +4.591802603531956e-01   +7.224357431888228e-01   +3.294739329401396e-01   +6.994188816290956e-01   +2.850665890918028e-01; +5.378079817400464e-01   +4.411247802458076e-01   +1.765052674183953e-01   +1.410066737095107e-01   +4.618613423049912e-01   +2.570620063124688e-01   +5.711657070890823e-01   +4.252124338973741e-01   +9.104282932090156e-02   +1.755832068392349e-01   +4.757003484700415e-01   +5.296777887496719e-01   +6.521555124722170e-02   +6.704607297269543e-01   +2.378724813569785e-01   +6.248655330008325e-03; +6.021479320719122e-01   +2.640568470172764e-01   +6.484599802913712e-01   +2.109064589750408e-01   +5.639611700045415e-01   +4.552117924952825e-01   +7.875269646054898e-02   +4.629398419984661e-01   +4.743619294184194e-01   +3.988433901679180e-01   +4.850980516635456e-01   +6.951060793039006e-01   +6.866697244875134e-01   +7.628351360014503e-01   +6.603599520540495e-01   +6.897616756960591e-01; +2.155696934515839e-01   +8.522166018156287e-01   +5.749624589538239e-01   +3.093162762868889e-01   +6.682893910803561e-01   +9.479763466181199e-01   +5.095016319617015e-01   +4.210329549519579e-01   +2.679071658827816e-01   +2.715742636258490e-01   +2.338977862638028e-01   +4.613780154641139e-01   +1.626871858864661e-01   -4.441752220707183e-02   +3.705247289907792e-01   +4.478159466575068e-01; +3.354427109417828e-01   +4.390388582663286e-02   +3.821094899167310e-01   +3.953894277687523e-01   +6.175230482940380e-01   +8.029086650449494e-01   +7.587375398543091e-01   +4.747457421067636e-01   +8.025097619963919e-01   +4.320310606635182e-01   +6.168141547163637e-01   +3.661843508632258e-01   +1.433490954617306e-01   +1.126215598770395e-01   +6.442834590339400e-01   +1.359190137488707e-01; +4.349631078242210e-01   -9.327010331521808e-02   +3.067935268110049e-01   +3.236086822899999e-01   +3.672886213983675e-01   +5.833766014296573e-01   +4.120422134181299e-01   +7.638045326491019e-01   +6.790671222874359e-01   +8.458704292195477e-01   +4.876086083386337e-01   +8.615247575765007e-01   +6.042199747251861e-01   +3.404549668374565e-01   +7.858591651120893e-01   +7.774336376994359e-01; -5.793927070558599e-02   +2.474660615589081e-01   +9.162980750963303e-01   +3.584968316851885e-01   +8.894461492749030e-02   +7.444570525480936e-01   +7.186048317806188e-01   +5.414484846295929e-01   +7.857427761994178e-01   +7.921805181508670e-01   +1.909563076387674e-01   +6.623688372988324e-01   +7.715334626756548e-01   +5.329683670496501e-01   +8.105610205866172e-01   +4.802986007226197e-01; -1.262783841699513e-02   +9.342598105154204e-01   +4.630178514055874e-01   +1.579733096636122e-01   +2.915322158612964e-01   +5.184446881875188e-01   +5.331848216136807e-01   +7.685367998127092e-01   +1.336905687462479e-01   +8.083597947333253e-01   +6.595210616407434e-01   +2.364107169545933e-01   +6.574801193992907e-01   +6.059540502084351e-01   +1.242774128426307e-01   +7.239115575537358e-01; +2.012581565407388e-01   +3.668209002065411e-01   +7.206129664989687e-01   -2.315421995314911e-02   +2.101452204540857e-01   +2.908410414003514e-01   +8.380442290523571e-01   +7.401740374236033e-01   +8.041758391530328e-02   +9.919150099880891e-01   +2.674038828206885e-01   +1.130584117348518e-01   +2.870494798369036e-01   +1.939725652528211e-02   +5.129856501335237e-01   +5.576134379698338e-01; +5.382615727216219e-01   +7.122181195366599e-01   +7.034902745381444e-01   +5.807322515502530e-01   +6.746386469512010e-01   +5.461984568139748e-01   +2.012677412405381e-01   +5.642359023124839e-01   +6.781697958193830e-01   +8.338036941718258e-01   +2.638317658439792e-01   +5.652620928516756e-01   +3.151316326687712e-01   +7.706156819587836e-01   +7.553950872843097e-01   +8.211638698263516e-01];
L1E_L1I_iGABA_netcon = [+3.530046216781272e-01   +2.325341969425906e-01   +1.871378453328142e-01   +4.733911108441397e-01   +2.489862822161408e-01   +4.394701228070234e-01   +9.766192870339993e-02   +5.174049839278885e-01   +5.268600567205282e-01   +3.530804462026351e-01   +6.987927173491193e-01   +5.278356857535883e-01   +3.856216493432557e-02   +7.002683683405656e-01   +4.736235826846216e-01   +1.706690467970009e-01; +3.724861660797164e-01   -6.770380987111436e-03   +6.560306189974641e-01   +4.500860469005646e-01   +5.030531718414016e-01   +3.648816884256733e-01   +5.333162370621302e-01   +4.891680147800676e-01   +1.254518335052998e-01   +3.696862432426541e-01   +1.889518512750911e-01   +4.780437827121585e-01   +8.002270551113087e-02   +2.024802444936444e-01   +5.003819255190692e-01   +3.948626265704341e-01; +6.950753904652242e-01   +2.704034485222601e-02   +5.399116091111169e-01   +8.153454790600163e-01   +6.232062622163335e-01   +3.609254098635070e-01   +5.020483041125746e-01   +6.392868346288850e-01   +2.171525541567054e-01   +2.988078542081797e-01   +4.744524576226061e-01   +2.400301358020139e-01   +9.779488680450358e-01   +5.676065303820944e-01   +2.466983311571900e-03   +6.296009292893392e-01; -1.793438882645820e-02   +6.950381541784394e-01   +6.955582847164734e-01   +1.901908193704876e-01   +5.914187080596469e-01   +7.024364357937641e-01   +1.702517512253886e-01   +4.906433208410967e-01   +1.533490850730153e-01   -2.067556457995670e-02   +5.757305987742051e-02   +4.811900309541559e-01   +2.857218256426067e-01   +4.972664864981683e-01   +2.896866875339911e-01   +5.933725331135796e-01; +1.795887570173809e-01   +2.529058871061893e-01   -1.616022151942349e-02   +3.620771583592314e-01   +2.812865592555673e-01   +4.966754575214358e-01   +3.512833680082700e-02   +1.794164205654159e-01   +2.195346705959109e-01   +2.095509226289980e-02   +2.595765357155490e-02   +6.955554652537151e-01   +3.028437400803983e-01   +9.949099413193609e-02   +7.371556754112986e-01   +8.433398425357368e-01; +4.887861969178023e-01   +1.862203499155550e-01   +1.017499163613813e-01   +1.591958796616561e-01   +1.308490021076310e-02   +6.061103291180224e-01   +1.650003104771033e-01   +7.822369121650908e-01   +4.064642127976873e-01   +8.720718922826650e-01   +7.435091688473132e-01   +7.596183575296664e-01   +6.463122698004462e-01   +3.603687012932324e-01   +4.692563193587967e-02   +3.767298668838899e-01; +7.371093688841514e-01   +1.650263715606634e-02   -6.003509893353103e-02   +1.131615038959697e-01   +5.934103113892486e-01   +5.962055780967781e-01   +7.965297265526944e-01   +1.401655299820291e-01   +2.496229348362893e-01   +8.475946996864269e-01   +1.084973147773897e-01   +4.696180697084302e-01   +5.298373947776218e-01   +4.345870448653442e-01   +2.441979599135062e-01   +2.598975386967122e-01; +3.613392698280790e-01   +2.360860053450224e-01   +7.184022773792492e-01   +1.000000000000000e+00   +2.088278648045513e-01   +4.177540567944038e-01   +1.988113802619379e-01   +7.937211322193723e-01   +3.905526210210170e-01   +4.161793993523770e-01   +6.623820622739174e-02   +8.811353151022691e-01   +6.582963989585241e-01   +3.455522200614302e-01   +1.051719626412648e-01   +6.611254827286411e-01; +7.268796838198581e-02   +7.275313971399363e-01   +4.781440705559596e-01   +9.985255390030726e-02   +7.937732489374996e-01   +4.024802519175029e-01   +3.732727739741264e-01   +4.709362104671061e-01   +1.129173129136159e-01   +8.783314482144784e-01   +7.037724812276056e-03   +8.654556462047149e-01   +2.681293742684905e-01   +2.103303932119909e-01   +2.897868374880579e-01   +3.870964573229000e-01; +1.578855575278558e-01   +4.410234317007952e-01   +3.637974467908363e-02   +8.227296908634259e-02   +7.279780591890918e-01   +7.212950906426008e-02   +5.737632675022947e-01   +7.966881933680797e-01   +2.428274284598195e-01   +6.998312774438911e-01   +2.415587825025134e-01   +7.774367532465872e-01   +3.132754768386906e-01   +3.755351957742857e-01   +2.676639005156580e-01   +9.146463110601873e-01; +7.362695735490458e-01   +6.844501836881142e-01   +7.581932299679001e-01   +6.591772937066526e-01   +7.740734431975425e-01   +5.349743697782776e-01   +8.957134896716416e-02   +1.370035658306286e-01   +4.486967366464817e-01   +7.185809515516825e-03   +6.131702422963999e-01   +5.705461955469476e-01   +1.683462230955260e-01   +9.449746232707172e-01   -1.038516422428432e-01   +5.746409922244686e-01; +1.066197116165477e-01   +6.248586713492156e-01   +5.445619895744437e-01   +7.382192143428875e-01   +7.376630573989515e-02   +3.335471661671824e-01   +3.869437639137981e-01   +5.007393753384758e-01   +8.346794304245608e-01   +3.238055781389925e-01   +5.454769290531880e-01   +9.026647107617993e-01   +3.591390691829028e-01   +8.535724145255668e-01   +6.961318574484704e-01   +4.690268432504813e-01; +3.189131776529936e-04   +4.945037794788094e-01   +3.636320044438838e-02   +4.838470063333818e-01   +2.026504151454731e-01   +7.520357365526941e-01   +5.807776304379755e-01   +4.435891508208837e-01   +4.811825308158722e-01   +7.036824520923527e-01   +3.505779466005715e-01   +7.301270400937016e-02   +2.483836177114269e-01   +1.528946553258834e-01   +3.342473015808314e-01   +8.104065920783271e-01; +9.251793735575434e-01   -1.158038808659891e-01   +5.549696558738180e-01   +5.084753649315673e-01   +4.429064939659828e-01   +9.160640433511803e-02   +3.999983118214793e-01   +2.094975505471622e-01   +6.849634113305305e-01   +6.832980284240252e-02   +4.058887084270705e-01   +6.500496251095623e-01   +4.547104955415900e-01   +9.479404123536423e-01   +1.092284680914479e-01   +1.839685052293350e-01; +7.794361946728597e-02   +5.411976809660908e-01   +5.570722678145525e-02   +1.402076877750961e-01   +6.019658536420953e-01   +3.357636288781494e-01   +8.667942882223619e-01   +8.417400037137791e-01   +7.334427185989093e-01   +8.433662310782400e-01   +6.887972902628172e-01   +5.679927663064321e-01   +3.517257972559500e-01   +1.184898780228201e-01   +2.905560743860500e-01   +3.459573204798091e-01; +4.413267838026712e-01   +1.735234771446183e-01   +4.822956043040390e-01   +2.380513804958730e-02   +4.557086690855622e-01   +7.078394951814341e-01   +4.754212873222198e-01   +1.260679724859316e-01   +8.341743258149672e-01   +8.112701487659650e-01   +5.795805191970060e-01   +7.036761327219473e-01   +7.246726519001900e-01   +2.963877155440470e-01   +2.378092396945174e-02   -2.489341452904610e-02];
L2I_L1I_iGABA_netcon = [+4.702377251673474e-02   +5.898076148422698e-01   +8.022042952089705e-01   -3.054569950472470e-02   +6.824208159971391e-01   +2.625871143155503e-01   +7.245540108219656e-01   +7.170768696524571e-01; +6.489017638704218e-02   +3.082056008041006e-01   +4.345666943015639e-01   +3.054218655344400e-01   +8.013374006599175e-01   +2.063353958226393e-01   +6.625288705040995e-01   +8.426950419902990e-01; +3.772593496697069e-02   +6.739243106806190e-01   +5.529117071050421e-01   +5.954081753556589e-01   +5.989717737738242e-01   +5.036542896964782e-01   +3.754477430923286e-01   +2.475675028196289e-01; +5.702280922010214e-01   +3.985263743418552e-01   +5.464898825163691e-01   +8.123322866852121e-01   +2.656236119321285e-01   +7.163816173514001e-02   +2.991807603101081e-01   +5.129827033224754e-02; +8.857036522995358e-01   +1.293396255679532e-01   +3.253834879585159e-01   +2.243012329117749e-02   +6.825396183222412e-01   +1.812210536147514e-01   +1.000000000000000e+00   +2.134082881673152e-01; +5.127334431166813e-01   +5.796572318293236e-01   +6.492514396120831e-01   +7.416508087917038e-01   +8.435913022301809e-01   +6.815186015526010e-01   +3.117340278890758e-01   +5.264663098210077e-01; +8.195992706912977e-01   +2.227100923550555e-01   +4.542130323600465e-01   +1.832842870802247e-01   +5.625231651915847e-01   +4.114827906167076e-01   +7.240265391219516e-02   +5.609158847849764e-01; +6.106260822170821e-01   +3.267817622997887e-01   +1.101724529717584e-01   +7.804594551137178e-01   +8.180208944667412e-01   +7.908868761500530e-01   +6.437954313652147e-01   +4.225933592478214e-01; +3.705835309557886e-02   +6.655707891906413e-01   -5.165473038455547e-02   +2.972709773272667e-01   +3.696731521628371e-01   +6.019880148400535e-01   +6.618030037709156e-01   +2.346400055331632e-01; +6.618623873873346e-01   +8.387194516238358e-01   +3.658185856444763e-01   +6.980922755903490e-01   +1.925591511096275e-01   +5.405315060511570e-02   +5.703200400639458e-01   +2.682911608462979e-01; +2.792180318093748e-01   +1.601156453740012e-01   +7.294531374053684e-01   +5.382559502149923e-01   +4.114520367370480e-02   +1.928665421480703e-02   +5.470447096393614e-01   +7.685703467099723e-02; +1.404072913980296e-01   +2.316490569536451e-01   +3.707530680031235e-01   +6.211595387358795e-01   +2.655427688051347e-01   +3.793722460771765e-01   +3.659855243411606e-01   +5.809849556819484e-02; +6.973500113401595e-01   +8.084954127599758e-01   +2.644142619436157e-01   +5.971986857264950e-01   +3.019016313464306e-01   +9.245905236941027e-02   -3.387892606953042e-02   +7.689701050834035e-01; +3.657350295307589e-01   +8.310368104801240e-01   -3.953481417013688e-02   +1.963059919911044e-01   +5.420961615904858e-01   +7.196556402475727e-01   +5.421928428957882e-01   +7.282406270283056e-01; +4.705855054195128e-01   +4.546147030414802e-01   +4.286095152290984e-01   +2.815298224515011e-01   +5.054853315271867e-01   +2.743575395551462e-01   +2.997352152178658e-02   +3.447469238417744e-01; -4.143823748956982e-03   +2.109178274880748e-01   +1.905399041013911e-01   +1.519701064350589e-01   +6.710287938154480e-01   +6.353019517283939e-01   +3.944058205249710e-01   +2.603064431495561e-01];
L1I_L2I_iGABA_netcon = [+8.921693395197629e-02   +7.526625889013988e-01   +1.951318609010015e-01   +3.329418128397995e-01   +7.905463389247191e-01   +7.433564656679098e-01   -4.690321153241711e-02   +2.432398081342473e-01   +4.487783958732400e-02   +8.186685858315249e-01   +6.567744594263034e-01   +2.843899616311618e-01   -6.878082108688438e-02   +4.001906535093990e-01   +2.436984657737575e-02   +7.575666883130762e-01; +8.941670968000985e-01   +6.611280042604213e-01   +5.143628512758260e-01   +4.433276166750051e-01   +7.425601525606747e-02   +3.509983240583807e-01   +7.446829140223015e-01   -4.241320910331874e-02   +4.804854211847636e-01   +2.901655113755630e-01   +3.322526754634558e-01   +1.619568017237340e-01   +6.841677733462984e-01   +6.698178741852386e-01   +1.000000000000000e+00   +1.953675690862313e-01; +3.933900365418177e-01   +5.739424729268088e-01   +8.987659688490678e-01   +6.010726226217868e-01   +1.954106275365424e-01   -4.245649341978993e-02   +6.351462604026930e-01   +4.370384745460963e-01   -4.261307616350862e-02   +5.646646429667952e-01   +1.252740042307736e-01   +4.277766755717248e-01   +9.169754213079805e-01   +6.112460932580249e-01   +2.237780116862914e-01   +3.297622419014991e-01; +8.096837954204583e-01   +4.369041153458659e-01   +4.761721974503924e-01   +4.086749116765281e-01   +8.096979907678636e-01   +5.666672563647001e-01   +6.082445656872593e-01   +7.142017193304065e-02   +4.709428816781733e-01   +3.377111849765006e-01   +4.137884653328834e-01   +4.097217340155455e-01   +4.137976149891483e-01   -1.344756513882314e-01   +1.017899913465058e-01   +5.091476506478535e-01; +7.974325264699588e-01   +4.958508634860785e-01   +4.074103050463299e-02   +9.080128598427991e-01   +5.972408572050875e-01   +3.053133290201896e-01   +6.874182938719930e-01   +2.305082605738891e-01   +7.800901294910293e-01   +4.064076840780421e-01   +6.754829167235209e-01   +7.118584499263175e-01   +9.198389445030646e-01   +4.249708650663560e-02   +6.068199665698983e-01   +6.912854383590983e-01; +3.264203016403027e-01   +2.587820851699692e-01   +8.326157755795949e-01   +8.800182177420567e-02   +2.482950803027298e-01   +6.078285412175675e-01   +5.833750633851298e-01   +7.026626381285828e-01   +4.625471193564642e-01   +5.039321919144536e-01   +9.089708914712100e-01   +7.489075169254322e-01   +4.754195879378069e-01   +1.163583646608879e-01   +2.987631266302292e-01   +9.154844594459912e-01; +4.676591023045180e-01   +1.091400042545454e-01   +1.456549847389198e-01   +8.908056625849798e-01   +5.265723629601032e-01   +6.968320054345621e-01   +2.261840559408546e-01   +4.774695330091846e-01   +1.246303677400178e-01   +2.052688718678581e-01   +3.749112581343610e-01   +1.332935687445221e-01   +6.423905838110268e-01   +4.292270709664631e-01   +6.838034523538203e-01   +1.433693083635518e-02; +5.501493582626965e-01   +6.023325123135846e-01   +8.522856426895180e-01   +3.890015659990126e-01   +6.923553164869504e-01   +2.011118147249147e-01   +1.299626214127179e-01   +7.083949187950686e-01   +6.328642820589119e-01   +4.119126357634736e-01   +2.797924562874317e-01   +6.763410958372418e-01   +4.117679433181738e-01   +7.815847616329884e-01   +2.558389820912197e-01   +4.646437534697301e-01];
L2E_L1E_iAMPA_netcon = [+2.374198624455900e-01   +5.008237876172972e-01   +7.650117819492761e-01   +6.095007207093620e-01   +4.575246769416949e-01   +6.991478406260697e-01   +7.829152970171736e-01   +2.249096541605845e-02; +2.105977520276759e-01   +1.918571705867777e-01   +3.023656507628875e-01   +2.348612776135077e-01   +4.402272279782809e-01   +6.040522026893774e-01   +7.825706754074626e-01   +2.208041863688353e-01; +3.138678110523039e-01   +6.493490766793614e-02   +9.489335253049913e-01   +5.278955044987063e-01   +3.113424214718730e-01   +4.602399887606926e-01   -7.846093649483078e-02   +4.870021298966178e-01; +2.125750460188232e-01   +1.916042786958541e-01   +8.458239162087439e-01   +2.248768427591864e-01   +4.043057101039342e-01   +8.086210308350152e-01   +3.576179859134533e-01   +4.583395922993645e-01; +7.051547318545767e-01   +1.014485984849218e-01   +6.759916446695901e-01   +8.700360745800597e-01   +2.150050503265135e-01   +6.078013314654475e-01   +6.813051106124888e-01   +7.391473015254506e-01; +8.034251611882813e-01   +4.528300334231607e-01   +7.510148742430426e-01   +5.696066389234812e-01   +1.989778223281973e-01   +8.072125355573820e-01   +6.388452870303464e-01   +9.532135891764569e-01; +8.849727255172627e-01   +7.856224430976462e-01   +8.460117833369382e-01   +1.407966779048940e-01   +1.645677671173801e-01   -3.051560067415896e-02   +8.705917664048752e-01   +7.665090592965980e-01; +5.811333339456978e-01   +9.810651290751889e-01   +7.082733033192310e-01   +5.190100762680910e-01   +5.305331309628594e-01   +7.260996839393890e-01   +6.692659516675600e-01   +6.977610738536010e-01; +9.239253496989966e-02   +3.091005130473475e-01   +6.755502242052847e-01   +6.498790304241459e-01   -1.315777325225782e-01   +6.496006262824859e-01   +6.221478711451713e-01   +9.660228581837440e-01; +2.337455571624601e-01   +2.609195884022551e-01   +4.829889121780783e-01   +1.496231038970621e-01   +7.235503571809809e-01   +2.832345596528013e-01   +5.002266293137895e-01   +7.298392211048759e-01; +7.335165774201702e-01   +9.035115818716163e-01   +4.007422204092105e-01   +1.011544042062986e-02   +1.978854610461208e-01   +7.059922039471657e-01   -2.324910291150631e-02   +1.694057693506545e-02; -1.995636408526373e-02   +5.270074354723996e-01   +7.380820788193171e-01   +2.273126365123315e-01   +3.223048008570688e-01   -8.490772370955731e-02   +7.537905146723385e-01   +6.097767996570014e-01; +2.548888529493945e-01   +8.433879332003305e-01   +1.000000000000000e+00   +1.762134099494500e-01   +3.102619856861745e-01   +2.213986010087864e-01   +2.854573669340090e-02   +9.278073321958314e-01; +1.979352530775961e-01   +1.480593797698610e-01   +4.441380351698341e-01   +8.697010325608392e-01   +7.514605010926946e-01   +7.643723670487816e-01   +1.721075416246176e-01   +1.751871464138557e-01; +5.782308751068340e-01   +7.567829722328753e-01   +3.267115234998880e-01   +7.474548496315422e-01   +6.817490046584123e-01   +4.341913982607568e-01   +6.497570740645577e-01   +7.050375205934838e-01; +4.546586944137376e-01   +6.848601589803673e-01   +7.938527829043239e-02   +5.816981971198362e-01   +7.402190507185387e-02   +5.452318261996014e-01   +4.141776720813335e-01   +4.108654875183786e-01];
L1E_L2E_iAMPA_netcon = [+8.136417002812153e-01   +5.047463567695804e-01   -2.202265166166877e-02   +4.519314080444234e-01   +8.551233161187265e-01   +2.959129222774846e-01   +3.759691068905245e-01   +8.345179234712066e-01   +7.353661591493275e-02   +2.712649602427391e-01   +4.280994634162137e-01   +8.125688347963319e-01   +9.147042648113232e-02   +1.234529257287643e-01   +8.118604795768863e-01   +3.641348752163500e-01; +6.871973170545095e-02   +2.055063028915992e-01   +6.309734261405120e-01   +1.564130514485599e-01   +2.559504464102452e-01   -2.303128287988329e-02   +4.208872241199254e-01   +2.343214282426679e-01   +6.654716531256737e-01   +9.557462717556646e-01   +5.311818214798826e-01   +1.722905522582701e-01   +9.112487613448482e-01   +9.055654659421061e-01   +7.081571390089303e-01   +5.300462275716817e-01; +3.243143354661887e-01   +7.435131962401771e-01   +1.602713362595639e-01   +1.093106289211949e-01   +5.094910697940246e-01   +1.486122452645878e-01   +8.296943246789817e-01   +7.531556419924158e-01   +6.785056258011437e-01   +5.673296642036091e-01   +6.522095185052541e-01   +2.589355931118368e-01   +5.363385220121406e-01   +3.396740038656716e-01   +9.347251994592497e-02   +5.111451745518786e-01; +7.139931364603511e-01   +2.623371378504852e-01   +5.516357249006506e-01   +1.820898252187409e-01   +5.073045395120909e-01   +4.161016258906331e-01   -1.191427731836884e-01   -1.179615550258616e-02   +8.619527441782571e-01   +1.420697697017054e-01   +3.886063987556275e-01   +2.921303691013187e-01   +4.788700142197315e-01   +8.275950889773527e-01   +5.404845204373979e-01   +5.521017763462394e-01; +3.606008669842234e-01   +3.500635028569863e-01   +3.555520074804686e-01   +2.662073556892258e-01   +4.093326465315714e-01   +6.347145280850955e-01   +3.567730702424832e-01   +5.613939582334710e-01   +2.140725188134983e-01   +5.018295072241851e-01   +3.951151565823330e-01   -3.029937381654246e-02   +2.341068313065554e-03   +8.701861174277641e-01   +6.769863731403836e-02   +7.170860147092929e-01; +8.489977181291534e-01   +1.222978458267366e-01   +6.615587246408933e-02   +7.173409368329575e-01   +8.959646579193672e-02   +2.345487348318265e-01   +7.049626056489039e-01   +9.657118120423240e-02   +3.794480321310666e-01   +2.366101918582135e-01   +4.379922868463123e-01   +9.259199863745797e-01   -9.709580689608130e-02   +2.417757744042225e-01   +3.254267471794693e-01   +7.635236819181028e-01; +4.215171039951156e-01   +1.972248703419699e-01   +2.138779008842191e-01   +1.246983228933976e-01   +9.605661850131073e-01   +5.546536456694445e-01   +1.403700443499682e-01   +5.456567398776148e-01   +4.040239494270610e-01   +7.168751164745724e-01   +5.778068192549723e-01   +2.879772466881863e-01   +5.025864188014892e-01   +3.441072552673149e-01   +6.245142092806140e-01   +2.138346557898340e-01; +3.590449136716480e-01   +8.510248108848172e-02   +6.544691448750851e-01   +1.280378203393009e-01   +5.552768610801662e-01   +1.067949384700910e-01   +2.523570597178558e-01   +8.333596810781435e-02   +5.239969689638952e-02   +7.094057657820243e-01   +5.403344942199718e-01   +1.866844506839545e-01   +8.415916610437025e-01   +5.199766271546820e-01   +3.476851604147300e-01   +1.873625093063437e-01];
L2I_L2E_iAMPA_netcon = [+4.681415101964208e-01   +8.218214925882279e-01   +1.830839068470013e-01   +6.012137363963035e-01   +8.179628430315599e-01   +7.749846136038168e-01   +5.498455808551106e-01   +3.329493236385245e-01; +9.126932550560514e-01   -1.758180202103568e-02   +5.978774121451502e-01   +2.668959989832586e-01   +7.093515618969752e-01   +4.601330890655181e-01   +2.646363778222666e-01   +8.891262594348891e-01; +1.000000000000000e+00   +2.538467842376714e-01   +7.760397655752140e-01   +6.864716245285012e-01   +2.265605143363495e-01   +6.428313614427638e-01   +1.285515939607436e-01   +5.778054729046296e-01; +3.750345559857758e-01   +7.728711027106293e-01   +3.434496895865894e-01   +3.161534732045380e-01   +4.958027002306611e-01   +6.125770718382771e-02   -7.472457520102287e-04   +5.313378275334092e-01; +3.584175087449490e-01   +4.388561485700722e-01   +4.274167720565827e-01   -6.600202780052332e-02   +7.936825447989437e-01   +2.221005724400134e-01   +2.308949813377250e-01   +6.103755753108138e-01; +3.067385638478609e-01   +2.247997323529327e-01   +5.814465490861448e-01   -6.368147365087515e-02   +5.379344013343733e-01   +7.426404834048547e-01   -5.227237146501847e-02   +4.748068457497948e-01; +1.610889276800872e-01   +1.395935079579557e-01   +5.944801609191805e-01   +3.938882526619835e-01   +1.669276507706419e-01   -3.876580777462994e-02   +2.656324521528347e-01   +5.233301398205910e-01; +4.504564877084150e-01   +4.616830238744415e-01   +2.048458940801011e-02   +6.694371045027350e-01   +1.771469442284427e-01   +7.740535527044500e-01   +3.835563054700226e-01   +6.055498600368829e-01];
L2E_L2I_iGABA_netcon = [+9.273009909487581e-02   +3.991103534359813e-01   +8.122061891657835e-02   +7.238494755543015e-01   +3.343027621525193e-01   +8.304462208565441e-01   +6.310396030025809e-01   +1.828316916485864e-01; +5.426955574163624e-01   +7.257308545961758e-01   +2.751483351906411e-01   +5.102849307202494e-01   +6.052360751580568e-01   +4.571704170340780e-01   +1.116517683178140e-01   +8.321858449240633e-01; +3.793115364550017e-01   +1.326536921902408e-01   +5.861752729443380e-01   +6.321784675309294e-01   +2.818414617741125e-01   +2.551973340947989e-01   +1.229572831072498e-01   +7.338435900788263e-01; +8.683193168421423e-02   +8.617836056426627e-01   +4.262004930940155e-02   +6.680686026944996e-01   +2.735804226273800e-01   +5.433279227768153e-01   +8.031486525350121e-01   +7.454448827101182e-01; +4.779107388233252e-01   +4.400184830663362e-01   +2.739124670551837e-01   +3.128208924873227e-01   +6.074122095331969e-02   +6.365376391955192e-01   +1.720290838422525e-01   +4.382935611311586e-02; +7.317584493163822e-01   +7.575827204236096e-01   +8.762985743124307e-01   +9.911694967381944e-01   +7.165540960364658e-01   +5.578961595700667e-01   +2.964553409830568e-01   +5.268485973958813e-01; +1.765281350097622e-02   +3.642413568838534e-01   +1.378724178748579e-01   -5.255021631788175e-02   +2.247898935153854e-01   +4.792470503357962e-02   +1.312062277513487e-01   +7.645307514335851e-01; -5.181292108117936e-02   +8.006715535005631e-01   +7.771175562895077e-01   +5.752420844898469e-02   +2.920260268907023e-01   +6.139846775810277e-01   +3.500328474854387e-01   +7.954192087215374e-01];
L3E_L2E_iAMPA_netcon = [+4.214859418653994e-01   +5.476608300496445e-01   +6.863454254721693e-01   +1.835891937370144e-01   +9.252476339952476e-02   +8.857432993754185e-01   +8.896072353827973e-01   +8.103322931842115e-01   +5.635971017253955e-01   +1.185940468407238e-01   +4.103966597861990e-01   +1.496941029807811e-01; -7.818546389265150e-03   +9.747487268446823e-01   +1.737078324190668e-01   +2.310394338764664e-01   +5.019931290155275e-01   -1.409117799572012e-01   +5.915821672543428e-01   +2.320307224424227e-01   +4.293422361214231e-01   +5.850704348237319e-01   +1.916152447763958e-01   +7.405522669204834e-02; +3.411257294233755e-01   +1.332439593742395e-01   +2.646802840622195e-01   +6.636980041325505e-01   +5.694962592624715e-01   +8.057622745636488e-01   +5.931868340081713e-01   +7.350198467800064e-01   +9.375317874412155e-02   +7.871695408024849e-01   +5.329981786396406e-01   +8.599198237209312e-01; +8.566519791759808e-01   +4.510883476702507e-01   +6.576832083497228e-01   +7.297492260476015e-01   +4.405051443049525e-01   +9.017871357464257e-01   +3.965241917373639e-01   +3.980430332483871e-01   +5.325430146920231e-01   -8.075075332204090e-02   +3.944362415965033e-01   +6.875587171935462e-01; +7.856382070765401e-01   +3.120746797232596e-01   +5.542592589790639e-01   +6.123292763251608e-01   +2.109557956238697e-01   +4.501149815307826e-01   +3.774077258847838e-01   +8.195656267850949e-01   +8.716316353889052e-01   +3.444412629211466e-01   +6.480340505240214e-01   +2.676621264841202e-01; +3.975408792739639e-01   +3.789939882887760e-01   +4.967382343716161e-01   +1.900438962414431e-02   +2.055897573423230e-01   +4.431802423809686e-01   +3.754152127318178e-01   +6.821060018178957e-01   +3.999326000397228e-01   +6.174311482166482e-01   +6.937924857885115e-01   -7.768853262292603e-02; +1.703293281466275e-03   +1.406399300070499e-01   +1.616446139817033e-01   +3.223926311514004e-01   +8.872242023283008e-01   +9.412697652932098e-01   +6.129846526906565e-01   +1.832433223756480e-01   +6.357987244679608e-01   +4.320196467012584e-01   +2.642187875021140e-01   +2.705283289968490e-01; +2.740923622777630e-01   -1.281667072180043e-01   +7.368116553825750e-01   +7.452167799632028e-01   +6.149502445154901e-01   +8.048615980410604e-01   +6.648288636758383e-01   +2.652649298962985e-01   +7.157382949696147e-01   +2.243547044123114e-01   +1.114927216866145e-01   +4.423955662949922e-01];
L3I_L2I_iGABA_netcon = [+7.533578685926667e-01   +1.176116085541042e-02   +5.147059633227929e-01   +6.991708400964221e-01   +3.166911865701385e-01   -8.348643137916882e-03   +1.841731554097918e-01   +2.244997747390897e-01   +2.979868127394619e-01   -5.723303678770561e-02   +2.242599636680579e-01   +9.110355680341453e-01; +8.218858282613570e-01   -6.948956104801274e-02   -4.841898085615913e-03   +5.953210176509048e-01   +9.448497293997283e-01   +4.358014565519617e-01   +4.539674243927916e-01   +3.121747699832115e-01   +2.404975350462196e-01   +7.232817178918087e-01   +1.736169529631939e-01   +3.307972132386581e-01; +8.370978524260748e-01   +2.553247451971665e-01   +7.994288218809074e-01   +2.029059289823345e-02   +6.852470536216401e-01   +2.622459732690230e-01   +5.809792472279406e-01   +5.035458231697995e-02   +3.046809830261852e-01   +5.655012108098066e-01   +4.424867773036193e-01   +8.798046291566649e-01; +5.265667764594668e-01   +2.423739322660842e-01   +9.337863157127415e-01   +9.598075700663555e-01   +8.224909093850008e-01   +1.405638867708227e-01   +6.936285436286482e-01   +1.517539825084879e-01   +7.899336254523466e-01   +6.037085821919197e-03   +2.930114545772378e-01   +6.387030866103304e-01; +2.066362031138386e-01   +2.377110415662684e-01   +5.219442867083880e-01   +2.880149720043770e-01   +6.222096980234199e-01   +8.787554893589111e-01   +4.312286331020626e-01   +1.866907497063543e-01   -3.689954519774136e-02   +1.615956765443038e-01   +9.225742626989092e-01   +1.588700411570922e-01; +9.869083779839944e-01   +3.253468179603582e-01   +6.323643034793937e-01   +8.696960939639444e-01   +6.068913020534746e-01   +3.626569131567025e-01   +4.701399151488669e-01   +9.675006984377063e-02   +4.439057882529074e-01   +1.201301574960413e-01   +2.142909028507398e-01   +3.083701478774076e-01; +7.283925766170204e-01   +6.616596222479408e-01   +7.666704727342968e-01   +5.439855287232478e-01   +2.428329054779458e-01   +6.523754914204970e-01   +4.624402907505541e-01   +6.898757547988211e-01   +8.541087863511747e-02   +9.259911373841784e-01   +3.926331923814683e-01   +8.829323699920426e-01; +4.213530096393706e-03   +2.294202163170472e-01   +6.074543483245914e-01   +6.602586379141464e-01   +2.488676827235202e-01   +2.260943059899154e-01   +7.228274239848785e-02   +8.877285633462630e-02   +6.440011948986409e-01   +4.582953987938462e-01   +3.538817855694448e-01   +1.665006023956087e-01];
L2E_L3E_iAMPA_netcon = [+3.903619739183353e-01   +8.608126506720882e-01   +4.871824652718059e-01   +7.982499333967608e-01   +3.643243907078261e-01   -1.369425931787919e-02   -4.438937544450671e-02   +4.227168452313015e-01; +5.101386186825601e-01   +3.827756913015064e-01   +7.043354361855887e-01   +1.251525752775501e-01   -3.597509032048562e-02   +2.582192856483992e-01   +7.096579448129351e-01   +6.084925828147787e-01; +1.096382580129679e-01   +2.464361371947591e-01   +1.000000000000000e+00   +8.313370799704024e-01   +6.466528278201246e-01   +2.688334908304303e-01   +3.719114859126378e-01   +5.976248246968703e-01; +2.985607698909499e-01   +3.835570436969120e-01   +2.135397733965967e-01   +5.658188012033124e-01   +2.495949922828041e-01   +6.263922926398938e-01   +6.308306086913956e-01   +1.968374705457516e-01; +3.027762382119339e-01   +6.813134550360307e-01   +5.679305265587525e-01   +8.124002425471326e-01   +6.570966238625481e-01   +1.501316820536366e-01   +1.120328612486812e-01   +8.211988901067090e-01; +8.598730236070898e-01   +7.363107015772056e-01   +3.032927533739083e-01   +8.965723047787877e-02   +4.092114500429868e-01   +6.704835627525616e-01   +5.868227607449166e-01   +6.994707144226845e-01; +7.015544997224667e-02   +3.280141174625961e-01   +2.736230570906040e-01   -3.600578118967435e-02   +2.163958790009283e-01   +2.841542588543181e-01   +2.101058627118492e-01   +2.557531639019966e-01; +7.062506804225804e-01   -2.507659659039661e-02   +7.988614160638651e-01   +1.846103347994255e-01   +3.099650712779362e-01   +2.873208533699383e-01   +7.980377115880530e-02   -1.804445977825282e-02; +4.366040007102568e-01   +6.344744027677666e-01   +4.872352311879874e-01   -7.132889391740994e-02   +2.700479511019808e-01   +1.320591727545143e-01   +5.205602792236049e-01   +5.046596439256538e-01; +4.311631122009547e-01   +6.651483784605505e-01   +1.847580860734608e-01   +5.059830302847250e-01   +7.336221042247829e-01   +4.449232419758068e-01   +6.872645694975541e-01   +3.380251809190043e-01; +4.922271560078981e-01   +1.877260937945659e-01   +6.690776995196159e-01   +3.462097000289490e-01   -1.276969138085877e-01   +2.417187754782975e-02   +7.654766013927978e-01   +5.165414034974839e-01; +6.670748652969595e-01   +3.624358667702291e-01   +5.444872052773885e-01   +7.595922717568987e-01   +4.777112453615878e-01   +7.326550246767849e-01   +2.955388638348270e-01   +5.327019322565480e-01];
L2I_L3I_iGABA_netcon = [+3.736342598039393e-01   +4.185006317250303e-01   +9.803009504400493e-01   +3.331722525407024e-01   +2.121480848606645e-01   +3.708472890920355e-01   -3.939655926056106e-02   +4.820455642186375e-01; +3.324899547700424e-01   -4.063266229500805e-02   +7.078040835286403e-01   +7.349499530852728e-01   +3.470315766191729e-01   +4.057512879066499e-01   +8.617204718960219e-01   +3.734314943958943e-01; +4.656980121501554e-01   +7.843914928776717e-01   +8.638781604662835e-02   +3.698091144026037e-01   +1.571376613731129e-01   +8.255150633823833e-01   +5.107413895336486e-01   +4.102330344267025e-01; +4.825604983944345e-01   +3.342503124748202e-01   +2.902568439048243e-02   +3.423944062282051e-01   +8.295602199219495e-01   +3.816078266363446e-01   +3.940888445403342e-01   +1.356598698039051e-01; +8.282964755213041e-01   +3.705993390499124e-01   +7.629231623511359e-01   +6.707038998321972e-01   +2.190026474222310e-01   +5.626210737483341e-01   +1.070914272825356e-01   +2.308549546848590e-01; -1.130033385730178e-01   +1.766673408796016e-01   +4.680114031664255e-01   +7.425213980922276e-01   +9.004472780353926e-01   +8.631235818272081e-01   +8.290569363719714e-01   +1.441431646725614e-01; +3.667479019247279e-01   +2.214063370959122e-01   +3.898488717585874e-01   +4.799750749818318e-01   +3.553151596831215e-01   +8.501656686926111e-01   +8.495009031566334e-01   +9.991709103631312e-01; +4.412436883848743e-01   +7.565322932037685e-01   +2.360950431493362e-01   +2.881951407837104e-01   +8.225051792275304e-02   +2.616049128953885e-01   +1.152073960936256e-01   +2.813388733123653e-01; +1.608783252939962e-01   +2.564571020132047e-01   +7.404239388463121e-02   -5.288396297669846e-02   +6.836184029777491e-01   +2.294752141080446e-01   +2.649609485474927e-01   +2.115275647544641e-01; +1.733957117000150e-01   -2.986035149190749e-02   +6.115983079639620e-01   +6.023387092519311e-01   +7.689137478385503e-01   +7.268547328128310e-01   +9.370760232801058e-01   +1.608905695784950e-01; +4.816958246236027e-01   +2.764935529462503e-01   +7.361942001337265e-01   +1.506911729222859e-01   +8.100409899698765e-01   +3.286910509363166e-01   +8.423438947926725e-01   +4.051662254316723e-01; +8.660637647408217e-01   +2.394015148910075e-01   +3.605525376766703e-01   +8.861261264822470e-02   +7.400051282536014e-01   +8.070733379073718e-01   +2.928748874395123e-01   +7.471420935153444e-02];
L3I_L3E_iAMPA_netcon = [+4.631599418695073e-01   +1.638833105244369e-02   +4.803073774940391e-01   +1.000000000000000e+00   +9.415751892860412e-01   +2.449963447827320e-01   +3.432120099973589e-01   +2.611445048253145e-01   +1.789678071664061e-02   +9.514717243331303e-02   +3.961197030953856e-01   -1.065134817017307e-01; +3.764330499521921e-01   +6.094785522908919e-01   +5.289254528225887e-01   +4.781687664480168e-01   +2.277836126441036e-01   -1.812502115533500e-02   +3.906603527285737e-01   +1.066180307815296e-01   +6.932492617341862e-02   +7.194392486574174e-01   +4.266936658855132e-01   +8.017897373199553e-01; +2.198090952267301e-02   +9.729591830771163e-01   +6.060420093231622e-01   +3.806745362104815e-01   +7.186274419716484e-01   +3.352042038526133e-01   +2.766348145535888e-01   +3.333580942716784e-01   +3.567740653744761e-01   +6.009188086444129e-02   +8.283024743628631e-01   +2.527124135040464e-01; +7.709000935863328e-01   +5.061451566198850e-02   +7.144723635486349e-01   +1.627832705795609e-01   +8.400578433093799e-01   +3.164131153258953e-01   +1.885782798775602e-01   +3.527579218864810e-01   +4.475788787322951e-01   +5.414273900377353e-01   +4.476394049554160e-01   +2.398548303709478e-01; -4.569804693787306e-02   +8.602673970914475e-01   +4.351472231324138e-02   +3.089826744687729e-01   +6.911537016777434e-01   +2.867316718816739e-01   +2.211053965481698e-01   +1.243942929203675e-01   +7.882799917214931e-01   +1.018925917988431e-01   +5.511608605209688e-01   +1.320345022812837e-01; +2.531544777522252e-01   +3.405672084531087e-01   +8.310415411583810e-01   +3.902500818418058e-01   +2.728391347955911e-01   +4.126781799655380e-01   +2.435205795077770e-01   +3.709203917369431e-01   +5.075020712966053e-01   +6.059704460841658e-04   +3.161180144841409e-01   +9.461550068453498e-01; +5.182425480039232e-02   +7.730875637310710e-01   +1.616827615484613e-01   +6.547891645569365e-01   +4.599837920613806e-01   +5.387374819646265e-01   +6.877909149596104e-01   +2.875247556417219e-01   +6.423744550499099e-01   +8.524284135442839e-01   +2.264541765196596e-01   +8.134026370432046e-01; +1.265867004083611e-01   +6.073241563230400e-01   +7.427201425883025e-01   +3.621038204752405e-01   +8.632306063125058e-01   +1.211831409569595e-01   +9.421535090196173e-01   +2.271857816106276e-01   +8.744688084149295e-01   +7.726554915512887e-01   +8.544259209591194e-01   +5.187313787426574e-01; +8.441526497438179e-01   +1.313188502145219e-01   -7.746274358767617e-02   +6.509849180813678e-01   +9.282704260427311e-01   +1.560067904554577e-02   +5.740981265895349e-02   +5.100139079598515e-01   +5.434397926823477e-01   +9.062801971452932e-01   +5.931735594647357e-01   +2.504209121282727e-01; +7.893739238700740e-01   +5.339187884540616e-01   +4.917411498237385e-01   +4.118283435533728e-01   +2.245128554088276e-01   +8.893259997506049e-02   +9.750146439456082e-01   +6.126102702430329e-01   +4.736822534848928e-01   +2.478112882627360e-01   +1.545241847158303e-01   +6.615355298715879e-01; +1.146617368490248e-01   +5.503683474762254e-01   +2.199148453105606e-01   +4.613242520843011e-01   +7.327112494535685e-01   +3.507861464893489e-01   +6.934867361457070e-01   +8.383771651520154e-01   +2.988531005290440e-01   +8.019244866767685e-01   +3.239694802126453e-02   +8.611370861966342e-01; +6.221493094623554e-01   -4.383026734191390e-02   +4.315261123465610e-01   +9.602480358394374e-01   +8.125570476926474e-01   +3.195936438584963e-01   +1.810273958881392e-01   +5.583827898629355e-01   +7.689927421698219e-01   +8.475319238951874e-01   +2.849108182890034e-01   +5.511717299951109e-01];
L3E_L3I_iGABA_netcon = [+7.598753054992902e-02   +6.961798015686095e-01   +3.333505740769713e-01   +6.497327221437531e-01   +6.814332698367163e-01   +5.383558620388565e-01   +7.670217292940031e-01   +8.193518089131142e-01   +7.829794684561917e-01   +2.060957204175735e-01   +3.936229144955604e-01   +4.272311969091473e-01; +6.342024961460417e-01   +6.299316976220818e-01   +5.975508437681111e-01   +7.251854292384564e-01   +2.618726600770419e-01   +2.269933910331011e-01   +7.667305932723002e-01   +7.686252751989399e-01   +8.254648194383385e-01   +6.292360207424538e-01   +3.994247032735997e-01   +2.863876305345138e-01; +3.149410486399675e-01   +8.358311600690177e-01   +2.208387049307975e-01   +8.749937456316406e-01   +2.847167813975660e-01   +5.381452370498606e-01   +3.337418288246841e-02   +3.259431858977918e-01   +2.149288568516214e-01   +3.914452881491479e-01   +6.925839675709503e-02   +6.539723819738408e-02; +3.019923375679508e-01   -2.030716214854883e-02   +7.165509086998332e-01   +9.064015247292105e-02   +5.256775375159732e-02   +1.730896652815080e-01   +8.855069061855552e-01   +4.354677821028828e-01   +4.364876700712526e-01   +3.765724516476359e-01   +2.485332819057662e-01   +2.057463499565075e-01; +7.821965715889780e-01   +6.304372212739391e-01   +8.015877429449901e-01   +3.522468706832120e-01   +5.883613879273946e-01   +5.961927378867434e-01   +5.799121465729504e-01   +8.028772350474085e-01   +2.833609718634363e-01   +8.053119794381777e-01   +5.359722629688299e-01   +2.764797972854721e-01; +9.035787021374758e-01   +7.930748831367194e-01   +3.114898390768927e-01   +5.594212971473539e-01   +3.455514820464216e-01   +7.710665416621733e-01   +2.359657616856756e-01   +6.276355709421800e-01   +3.116008980083467e-01   +6.127964639051271e-01   +1.456299409502574e-01   +1.646723049101162e-01; +5.886713000007386e-01   +5.176882906166419e-01   -2.649961266536980e-03   +9.274116575919942e-01   +4.149419102872576e-01   +3.633788860272806e-01   +5.243022788632972e-01   +3.129572571007679e-01   +3.510608065302146e-01   +2.118606393165589e-01   +1.000000000000000e+00   +7.357734524965747e-01; +6.647539268889354e-01   +3.318579756145470e-01   +3.704538824195479e-01   +7.385915481632240e-01   +7.141953721953435e-01   +3.781105085738042e-01   +2.270748078023304e-01   +4.647582203587879e-01   +3.409836910111068e-01   +6.400322051176699e-01   +3.089565729371725e-01   +5.160849807108245e-01; +2.023943172874555e-01   +4.768636111357925e-01   +6.222333090332709e-01   +8.348961455688656e-01   +1.271035356916242e-01   +6.751655017247363e-01   +6.879058983800522e-02   +5.517050462242453e-01   +7.971389399588974e-02   +1.170079843021584e-01   +9.975383926329970e-01   +2.195274024956553e-01; +3.403219660621405e-01   +4.274699824101421e-01   +2.648818500032237e-01   +2.570987466384747e-01   +2.080202499622890e-01   +5.490959595575383e-01   -7.665738903039908e-02   +7.249459894655895e-01   +2.061467273672183e-01   +4.167791777693409e-01   -4.754740067511804e-03   +1.541924464098249e-01; +7.083733646759516e-01   +2.300740944743714e-01   +7.928033573882661e-01   +2.368336952946940e-01   -3.151449738777679e-02   +1.892074810343597e-01   +5.303807006013060e-01   +2.685555302833019e-01   +2.109025904038272e-01   +1.181644686845671e-01   +6.037021921114794e-01   +6.417456547005702e-01; +7.310297277767891e-02   +3.907037375360434e-01   +7.755223819967584e-01   +1.680873501387463e-01   +2.869729176588932e-01   +3.808866933596500e-01   +6.595384420100976e-01   +6.661822937028663e-01   +1.950390277251191e-01   +3.047495049428864e-01   +2.284567709271339e-01   +4.876977846767008e-01];
L2E_Input1_iAMPA_netcon = [+8.466981929821097e-01   +9.672119814091846e-01   +9.001785024276925e-01   +8.639928147512770e-01   +8.130585761728875e-01   +8.588699271475639e-01   +8.662624334388045e-01   +8.606402128166168e-01];
L2I_Input2_iAMPA_netcon = [+8.773776789961547e-01   +9.995352273953019e-01   +7.942940091646361e-01   +1.000000000000000e+00   +6.948606348684484e-01   +8.366525676183553e-01   +8.750309732875210e-01   +9.522347328021497e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
