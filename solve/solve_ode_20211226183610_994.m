function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.858418664163148e-01   -4.370076189168436e-01   +5.261642954597870e-01   -1.413995990529411e-01   -4.169657691680047e-01   -2.511408876298303e-01   -5.013251766570846e-01   -4.179286763526566e-01   -3.598679595447329e-01   +2.352136528056934e-01   +8.007508248556630e-02   -4.117026043995430e-01   +3.003535653533086e-01   -7.520495343758414e-02   -3.312449739433517e-01   +4.880245224406202e-01; +7.625579572316330e-01   +5.210796611503354e-01   -3.209369845755133e-01   +5.243641202199125e-01   -2.544571821132299e-01   +2.316825539575498e-02   +1.617189742855392e-01   -1.205059601150568e-01   +4.854435833699657e-01   +3.178491140571096e-01   +5.745752322360436e-02   +1.510362204089103e-01   +7.490631367592558e-01   +1.632561206644595e-01   +8.561028217221295e-01   +2.823268551169064e-01; -3.623066816604680e-02   -2.549101037496281e-01   +1.279318051529338e-01   +3.321259473089501e-01   -4.115283534306662e-01   +1.969831583858247e-01   +2.113073047402069e-01   +3.311952107874855e-03   +3.509462284379172e-01   +2.177210013916051e-01   -5.216201187278267e-02   +8.916282404274720e-02   -3.844757675365676e-02   +3.688160829544752e-01   -4.390789941696690e-01   +1.325669176098345e-01; +3.010626694683212e-01   -3.110899248391867e-01   +7.309535035564450e-01   -7.247341042430711e-01   +4.339794433073986e-01   -2.063376388568947e-02   -4.793202369888883e-01   -1.360996226238847e-01   -1.648325924870264e-01   -3.922707602374903e-02   +5.968960524664728e-01   -3.982411919407419e-01   -2.013638839865219e-01   -5.547703940320200e-01   +4.733391699404573e-01   +2.226639298895422e-01; +1.977625960958581e-01   -1.502206261174938e-01   -2.863591311802575e-01   -1.060549899681190e-01   -2.395311648937808e-01   +3.383530006207676e-01   +2.492323452346674e-01   +2.440820590912042e-01   +2.118163458950303e-02   -3.046197028331193e-01   -4.151822768786145e-02   +2.986309662149281e-02   -2.284669552533979e-01   +6.584656282030096e-01   +3.535422481472788e-01   -4.580208633750649e-01; +3.707706396148925e-01   +3.940200961433274e-01   +3.922156054697815e-01   -1.542235968777722e-01   +7.915156840509724e-02   +3.644173185914877e-01   -4.687635459437301e-01   +1.535345566038528e-01   +2.865438243747147e-02   -2.650715406264813e-01   -2.020263593262649e-01   -3.092531494002114e-01   -7.399143621158952e-02   -4.622306168395927e-01   -1.976487916992648e-01   +1.967234432816217e-01; +8.241662677776906e-02   -4.173353128765319e-01   -1.436324088675318e-01   +1.218007682243782e-01   -1.062863057030311e-01   +1.188804061806835e-01   +2.303639889138929e-01   -3.982281723848154e-01   +4.893319541885814e-01   -3.773231186529349e-01   +1.293417699887899e-01   +2.225363256507703e-01   +1.600109447668802e-01   -7.072103258713071e-01   -1.123790096522731e-01   +5.450834107855875e-01; +1.250946960053789e-01   +1.541868462796725e-01   +1.845781613072343e-01   +3.021521495095014e-01   -2.713782593487595e-01   -6.496289252307588e-01   -1.807403729362745e-01   -1.952983592942013e-01   -1.246595236551675e-01   -3.514808043853553e-01   -5.485150438626929e-02   -1.080229981708712e-01   +5.452897886423305e-01   -1.085298957897021e-01   +1.803944985353217e-01   -6.901514827337799e-02; +1.826134271619601e-01   -7.423753083201579e-01   -3.540344508899691e-01   +5.009543960334764e-02   -9.539771651202367e-02   +8.478187923853706e-02   +5.567313038869005e-01   +3.369155349152719e-01   -4.465778801481980e-01   +6.092029652267079e-01   -2.745411750532472e-01   -1.654201964449015e-02   -2.479266400984435e-01   +6.559420755218808e-01   -2.913179918895588e-01   -1.886627975561954e-01; +2.142708561072335e-01   -1.460539161719530e-01   -5.894404585100618e-01   +3.175327572769794e-02   +4.366193467594797e-01   +1.035988530958056e-01   -9.170597741371460e-03   +1.586170182387050e-01   +4.729696104362603e-01   +7.438429903287108e-02   -5.200180651090494e-01   -4.773930007415766e-01   +4.896259471004670e-01   +4.367240068629251e-01   -8.665725004454222e-02   +5.878399252184219e-01; +3.885030314637365e-01   +9.169585747622805e-03   -6.826040574256373e-02   +8.779053618387503e-03   +2.555470131057498e-01   +9.962895291959170e-02   +5.066239045041040e-01   +5.219369049261208e-01   -2.461129635134388e-01   +1.798865229497261e-01   -2.001078379601529e-01   -1.464702591844066e-01   +2.439158455521228e-01   +9.375811259867095e-01   -1.571369111351147e-01   -1.355922746791533e-01; -2.485149764232243e-01   -3.018279992789227e-02   -3.800124901306215e-01   +3.059042753450587e-01   +5.451454212896392e-02   -8.176679695112056e-02   +1.629982941673245e-01   -8.620079642311174e-01   +4.301929941478267e-01   +5.074814086846213e-02   -3.629107476929329e-01   +2.575439734480532e-01   -6.097087615120815e-01   -2.804714776596243e-02   -2.001438852681746e-01   -5.038167656393679e-01; +6.611977249697300e-02   +3.667903620747439e-01   -4.325491151651982e-02   +4.166031609581436e-01   +1.648839088363326e-01   +4.872893139852418e-01   +6.257629457092853e-01   +6.169931272062755e-01   +3.306890444046121e-01   -2.963222354781830e-01   +1.032133858094043e-01   -2.331380315799546e-01   +1.917690915442705e-01   -7.118045160439834e-01   -1.368276874655110e-01   +3.603509078701500e-01; -2.330111783130368e-01   +5.731154787287501e-03   -7.093099405306353e-01   +1.557376153452494e-01   +4.042430559300877e-01   -2.351600426834329e-01   +3.296662165526189e-01   +1.484361996602165e-01   +1.182388468540932e-02   -5.372802812198910e-01   -7.495823932548624e-01   +4.848633389311963e-01   +2.700947980262693e-01   +3.936556421760844e-01   -1.659267474788685e-01   -2.699813944550572e-01; +7.325532434482462e-02   -3.338137069126792e-01   -6.611409568008514e-03   -3.792829042935790e-02   -7.460659546066130e-01   -3.442571794481173e-01   +1.225654542180477e-01   -2.824901958172117e-01   +4.351942106933380e-01   -6.150175813424236e-02   +1.901295745471441e-01   +1.018156347155819e-01   -1.862336189396930e-01   +4.799138828234015e-01   -1.916934981330598e-01   -4.549693306257251e-01; -5.261861297344420e-02   -4.198319810854525e-01   -1.202389239587931e-01   -5.198315325127276e-01   +1.756664894346002e-01   -8.678080570833360e-02   +6.548510109433124e-01   -1.445853592720681e-01   +1.674408027620217e-01   -5.522439715382590e-01   +1.338631306483774e-01   -1.131895292939348e-01   +6.069011614373029e-01   -1.382437643777284e-01   +3.859956563536014e-01   -1.279872508399235e-01];
L1E_L1I_iGABA_netcon = [-4.153787387632337e-01   +3.769455476545387e-02   +3.431199958125793e-01   +2.258787789531261e-01   -2.339915200174627e-01   -1.671713121438055e-01   +5.935601561281603e-01   -1.257323864709430e-01   +1.910443394391237e-01   -1.417875190910870e-01   -4.649432543959933e-01   -1.572265818505744e-01   +1.212241851068468e-03   -1.634981114874239e-01   +1.603774053030830e-01   +3.452080734002239e-02; -1.009775923476870e-02   +4.332650530829120e-01   -1.226094125318464e-01   +1.620955845954153e-01   -1.131299884070069e-01   -3.244928288403400e-01   +2.597674738902240e-01   -2.283037514620650e-01   +3.209897842968354e-01   +2.263804194420956e-01   +6.483767738916142e-01   +2.627711281438052e-02   +2.166190995330983e-01   -3.222374309867847e-01   +1.130093650101483e-01   +2.803875932317711e-01; +4.589172025254702e-01   -3.686100854597524e-01   -4.484352171047211e-01   +3.053631652230798e-01   +4.258527264503396e-01   -7.000766919082905e-01   +1.024520014037701e-01   +2.939879766567094e-01   +5.512297215650732e-01   -1.379323336833171e-01   -3.592369627869484e-02   +1.903991296180766e-01   +7.113588256225671e-02   +1.981121686810923e-01   -2.731142805310298e-01   -2.232864718095823e-02; +4.359290998036620e-01   -4.801428108233717e-01   -9.688548742067778e-02   +3.551906446304962e-01   -1.160833266793134e-01   +4.911334125638135e-01   -5.792920572651041e-01   +2.514342528323790e-01   -2.477416149032128e-01   +3.402538227851649e-01   +3.552847626921793e-01   -1.196320908363606e-01   +5.964633833760365e-01   +1.228854673021457e-02   -1.937070768088139e-01   -3.122804347513877e-02; -3.903059531784184e-01   +1.054995141320243e-02   -5.973887017032095e-01   -1.086427237438840e-03   +8.540186228998201e-02   +1.487427296154894e-01   +2.438694789525069e-01   +1.702219468037237e-01   -2.210862346918223e-01   -3.019143659875275e-01   +3.300092973302546e-02   +4.156315608923471e-01   -2.471505093046945e-01   -1.496443860579694e-01   -4.393407635783020e-02   -2.261200736219861e-01; +2.448223098861429e-02   +3.502684667474930e-01   -2.198929995647405e-01   +5.176804586358308e-02   +4.800507577032225e-01   +4.954813189423183e-01   -7.984216211942494e-02   +1.425166868027525e-01   -7.961100092746079e-02   -1.684681718028161e-02   -2.474371777908703e-01   +1.415246841215869e-01   +1.558929053518792e-01   +6.117978924365868e-01   -1.811739896493939e-01   +1.444225758105071e-01; +7.453056522373942e-01   -9.003120312486793e-02   +3.192722783907895e-01   -4.738857144852756e-01   -9.142443962566082e-03   -7.226119158474533e-01   +1.196921874241161e-01   -5.241693157742053e-01   +4.087190053919669e-02   +1.235302967566363e-01   -4.785508814811504e-01   +2.256297547090812e-01   -5.376479391147405e-01   +4.498393292593478e-01   -4.223772776892503e-01   +1.329585206292132e-01; -5.550829854510164e-01   +3.554498326309889e-01   -2.170384986345270e-01   -3.777104407772179e-01   -1.098800154206895e-02   +1.536987201164494e-01   -2.342692976868760e-01   +2.207788839611161e-01   +3.905783013600655e-01   +3.024323657806817e-01   -4.465383433590175e-01   +5.874767892688411e-01   +3.109691527824461e-01   -7.112406106323533e-01   +1.866007286806639e-01   -5.513063237719852e-02; +5.474376603742368e-01   -1.865804828645326e-01   +3.199902730766577e-01   -3.672728774560903e-01   +2.850310243345116e-01   +3.242422946728091e-01   -4.442101924066250e-02   +4.854089100315754e-01   -1.444275144209858e-01   -8.825441281387014e-03   +4.235098398725045e-01   +2.244882734443426e-02   +4.468760664636215e-01   -3.108535035113248e-01   -6.333705439268421e-01   +5.480508642619789e-01; -3.520154554504712e-01   +5.515835596554473e-01   +6.616510317081455e-01   -2.482522168855157e-01   -3.645035237217213e-01   +5.693595918131489e-01   -2.739886335965530e-01   -3.588356989416723e-01   -1.871214284065976e-01   -2.731791741955941e-01   +3.290862991384064e-01   +5.234079712741994e-01   +1.376225579740329e-01   +1.772747411583782e-01   -3.591414773174573e-02   +5.340341346541784e-01; -2.216205539624791e-01   -4.415836960935757e-01   -1.212656044896736e-01   -1.428881302082887e-01   -3.297068813791149e-02   +3.881541291495152e-01   +3.593808737002651e-01   -1.343945928246414e-01   +3.291285546848370e-01   -1.619292150675638e-01   -2.811117047710099e-01   -6.761470015537369e-03   +3.027743747037422e-01   -1.020524914184012e-01   -2.492513668801317e-01   -3.097234183648975e-01; -2.293073851522334e-01   -5.312069006757391e-01   +1.427137324189217e-01   -1.904290150941110e-01   +1.618847623149011e-01   +1.887417399912425e-02   +8.937257228012441e-02   -6.051036351115452e-03   -9.469898303690745e-02   +4.658319995852248e-02   +2.262032249871527e-01   -1.508679150577402e-01   +2.585133611419282e-02   -1.325591990548418e-01   -2.441826092520429e-01   -5.710900100221770e-01; -3.252737766555092e-01   -7.606491452699280e-01   -1.385772197828421e-01   +2.517547169692915e-01   +1.539307541798813e-01   -1.296242505902036e-01   -1.120688068304322e-01   -1.695806527892667e-01   -8.061545304271348e-02   -1.760496377174230e-01   +1.849468578314115e-01   -2.375927075529450e-01   -3.594674375017627e-02   -7.050597818459252e-01   +6.264796578165898e-01   +2.618923513137361e-03; +1.834171267307132e-01   -5.884039133300752e-01   +2.349707061867130e-01   -2.593827513175890e-01   -5.874779337688568e-02   +5.915620494860083e-01   -3.781054815660383e-01   -4.277784702110338e-01   +4.666784978774198e-01   +2.905332432719094e-01   -6.957007272819200e-01   +1.982029172033226e-01   +6.071325077890693e-02   -4.138276341253461e-01   +5.519665156739877e-01   -4.055323926746286e-01; +3.433542505952783e-02   +2.972983056582648e-01   +1.690621488529766e-02   +1.230307385998625e-02   +3.215306272025830e-01   -8.684577497580448e-03   -1.579082105220746e-01   +3.895949417175068e-02   -2.021118831781135e-01   -2.067416234979340e-01   -1.150232596993818e-01   +6.472850642606426e-01   -2.029150371231412e-01   -2.923501198498561e-01   +2.292473897065247e-01   +7.365522371386068e-02; +2.060752676026144e-01   -4.946905244364502e-01   -5.924354029253061e-01   +1.086990802349645e-01   -1.281808528606478e-01   -3.766663009368530e-01   +1.776316264432782e-01   +1.575623675743993e-01   +7.577822859121203e-03   +2.087251119578311e-01   +5.047355895824255e-03   +1.103916276822705e-01   +1.792136621244831e-01   -9.260037604971963e-02   -1.264278784946387e-01   -1.215627551173554e-01];
L2I_L1I_iGABA_netcon = [-3.567133774258924e-02   +4.600345302005621e-01   +7.455913578497426e-01   +2.216915610182096e-01   -1.655652704599055e-01   +4.894252084962565e-01   +3.048353812852529e-01   +2.492719400066329e-02; +2.004222284731130e-01   +5.893395089301874e-01   +1.692033086706679e-01   -8.847726063902182e-02   -1.229827424299770e-01   -9.336240109125812e-02   -1.796030751682254e-01   +2.447178429985224e-01; -9.148902084013283e-01   +7.351666293503546e-01   +5.008275526638291e-01   +6.852074044894618e-02   -4.889778975020977e-01   -5.640867548016235e-01   -8.553943064998919e-01   -5.800258374565599e-02; +3.579042549833499e-01   -3.212585520395132e-02   +3.881797750926579e-01   -2.236758345088019e-03   +3.033307995667522e-01   -1.134301409407566e-01   +7.624838646795966e-01   +4.998660562669759e-01; +1.057412609725543e-01   +2.264960466715411e-02   +1.566091572818011e-01   +1.005406864717419e-01   -8.925690958515091e-02   -4.154597533395194e-01   -3.363636479570700e-01   +7.147921525768899e-02; +4.928327398063805e-01   -2.245860364596934e-01   -4.660015508660839e-01   -1.981443289184580e-01   -4.524307562993529e-01   -8.461948108813749e-02   +5.214387158256222e-01   +2.359885981184310e-01; -5.775283287888047e-01   -6.679250299186590e-03   +3.238145627651196e-01   -4.246351564808092e-02   +5.160134850087357e-01   +1.055033837696576e-01   +1.093815771070717e-01   -3.827889209416476e-01; +1.040603837641115e-01   -4.110934940498795e-01   -4.940400816857439e-01   -3.693158382102015e-01   -6.211303286727311e-01   -1.571559862751316e-01   -6.667039694399512e-02   +1.865006354567888e-01; -4.128266464578620e-01   -4.303922907744704e-01   -1.037526925135798e-01   -1.365085210051624e-02   -6.433565900505723e-01   -2.277020558564051e-01   -4.621724316164939e-01   +4.623960130730403e-02; -9.774248338713025e-02   -2.012432557348315e-01   +3.617168379862344e-01   -1.920743924568766e-02   +3.107050080950401e-01   +3.477924152551656e-01   -9.018822396620757e-02   -3.964765561783146e-01; -2.062171723388310e-01   -1.518867133599479e-01   +2.352255521929323e-01   -4.954990769126267e-01   +2.051868786768178e-01   -2.874681984986872e-01   -1.358237624909959e-01   +7.481495178757511e-02; -3.287796020316102e-01   -1.941713710409437e-01   +2.781897135565521e-01   +9.457147666275666e-02   +1.197540636862202e-01   -6.839039891323728e-02   -7.285947533822377e-01   -2.991459855271144e-01; +2.529762201787274e-02   -2.113610483042586e-01   +2.633647279927732e-01   -2.010920530429526e-01   +2.093371598426003e-02   +3.119215717864747e-01   +4.957748976058515e-01   -1.989900370979085e-01; -3.504542882756230e-01   +5.246225521106225e-01   +5.002673120256138e-01   +5.694569476369796e-02   +3.810731411540942e-01   -3.462376631510709e-01   -6.930908297003883e-01   +6.649414175348375e-01; -5.193069156231538e-01   -5.215574264824017e-01   -1.067426370207008e-01   -3.162159297921291e-01   +3.517695762206926e-02   +8.933938793606480e-02   +4.610962625320803e-01   +3.884945257309822e-01; +2.443759002924207e-02   +2.075561555124157e-01   -8.343275739346867e-02   +1.569580554336706e-01   -1.598663972245618e-02   +4.946033702392941e-02   -4.718093693548414e-01   -8.673110347701095e-04];
L1I_L2I_iGABA_netcon = [+3.052890235871080e-01   +2.844619755442458e-01   -2.412510390366418e-01   -1.946923775023518e-01   -2.201926873639037e-01   +2.961282792035311e-01   -4.438904140548702e-01   +9.137178794942367e-02   +5.901900554810361e-01   +3.906606120675709e-01   -6.478869805336753e-01   -3.245735216443440e-01   -3.896908179016648e-02   +1.379429806540696e-01   +4.047526603695237e-01   +1.828066827375134e-01; -5.067551341593444e-01   +2.307180453067061e-01   +1.036421968594149e-01   +9.226959784299243e-02   +2.119957578460783e-01   -2.133001801952987e-01   +4.433320864791871e-01   -9.716074108846343e-02   +4.412230585893123e-02   +1.726451721180941e-01   -4.320895323216659e-01   -4.363509869777781e-01   -4.145332779896443e-01   +4.347496528308514e-01   +9.868456699915291e-02   -1.048609489115453e-01; +1.764655459359167e-01   +5.562595491175362e-01   -2.122517283874116e-01   -7.394248866339001e-02   -4.879952709293338e-01   -1.263260304416332e-01   -1.954976753681752e-01   +3.268519413901270e-01   -5.487052634675657e-01   +1.105808776221229e-01   -3.576200798860332e-02   +1.884962296170100e-01   +5.170502735418088e-01   -2.675888436847426e-02   +3.253534118718596e-01   -5.510170847590452e-01; -1.640437085518816e-01   -1.132720650567469e-01   +8.818408832497604e-01   -4.340504484372748e-02   +2.479346651493858e-01   +2.439434719822816e-01   +7.982916777609760e-02   -2.927787124199565e-01   +2.416018164707955e-01   -3.388822616650073e-01   -6.117326963709456e-01   -7.502811099488610e-02   +4.089822502831724e-01   -2.301843619118537e-01   -4.743383160560548e-01   -3.420652780462095e-01; -3.040012746982979e-01   -2.256848873828483e-01   -3.625949162466675e-01   +5.829563626210409e-02   -2.073487382258471e-02   -4.576117592884521e-01   -3.273103769897024e-01   +2.909923109611217e-01   +1.762694454718653e-01   -2.913915289942199e-01   -6.445205873373477e-02   +3.189546726941561e-01   -2.087379632675870e-01   +6.641891156596041e-01   +3.258259458560524e-01   -5.537632713076587e-02; -6.150660342776143e-02   +2.773425715620028e-01   +6.170928536070772e-02   -4.657232150168428e-02   +2.185359220774780e-01   -2.257916142446250e-01   -1.047164949094685e-01   +4.411618817288204e-01   -7.556750137754896e-01   -8.330349325830433e-03   +2.839654919092913e-01   -2.492902458454084e-01   -1.213158335973961e-01   +7.558911520397599e-02   -3.553622795630235e-01   +2.822864894998841e-01; +4.891510510300968e-01   +3.258222982198982e-01   +4.422337979094217e-01   -3.998753812133593e-02   +2.206625223823048e-01   -2.308505556741528e-01   -2.315415800935535e-01   +1.185347815466180e-01   +9.206388722026068e-01   +2.700390398949473e-02   +1.193863591517253e-01   +1.531710810922296e-01   +2.618746082751667e-01   -4.568443927547866e-01   -8.199638651133287e-01   -5.081772210252883e-01; +4.905262238050280e-01   -1.478715072738646e-01   +1.641936002134446e-01   +2.336634809740208e-01   +5.796639369813773e-01   -5.708961951408587e-01   +1.565077491341397e-01   +7.881678449561362e-01   -2.111513017181795e-01   +7.150302737628933e-02   -5.661633496978551e-01   -5.207619752287639e-01   +4.155118026264997e-01   +8.203257743548492e-03   +4.238363892360947e-01   -2.987405611199910e-03];
L2E_L1E_iAMPA_netcon = [+7.863064094198979e-02   -1.417927326090126e-01   -1.354409120167219e-01   -8.316275961395412e-01   -6.243541921002234e-02   +4.756664850694059e-02   +5.973470257570281e-01   +7.164368647235601e-02; +6.150738843834636e-02   -2.023721350871452e-01   -1.158883968168592e-01   +2.689256069812740e-01   +5.414534984321692e-01   -1.153499957704854e-01   +3.080299454999176e-01   -3.009765989592372e-01; +1.518249151088542e-03   +1.131560629485720e-02   -4.499311060304753e-01   -5.802593408384690e-01   -4.498097447995577e-01   +1.431241448135470e-01   -2.151999534043034e-01   -3.544613065461220e-01; -1.077319952907496e-01   +1.006726359011787e-01   -1.905511664300748e-01   -1.445479272514003e-01   -5.953114663919837e-02   -6.982329210344771e-01   +2.076426914539458e-01   +9.090457873389204e-02; +4.001683576119593e-01   +2.909833237896303e-01   +1.295287479031784e-01   -4.332059423938048e-01   -2.514113315944953e-01   +2.537949206253413e-01   +6.655706842297899e-01   +3.193238154779017e-01; +7.255568182536068e-02   -9.207545852150965e-01   -1.451409007260275e-01   +2.950290748483143e-01   +1.166305392265977e-01   +3.229201144963252e-01   +3.100247928899088e-01   -8.368246897166155e-01; -3.594225844700355e-01   +1.320884234547788e-01   +5.541330350930670e-01   -2.239138497274182e-01   +6.715740054590323e-01   +1.416374096708785e-01   -5.146563188571085e-01   +4.242152989297054e-01; -2.715341569934804e-01   -1.826770178869632e-01   -1.914331254780754e-01   -7.649133127411760e-01   +3.998025433825232e-01   -2.347136755241330e-01   +1.063211449764319e-01   +8.534315489222262e-02; +3.204086531310506e-01   -4.662469276432282e-02   +2.515538350949081e-01   +8.165275220450002e-02   -1.088374743102188e-01   +4.536436613141995e-01   -1.768328930992964e-01   -6.245938237924271e-02; +4.537918132898973e-01   +6.200147847643769e-01   +3.742843094030068e-01   -1.315413420737312e-01   -1.722881595196670e-01   -4.753759849174007e-01   +2.662523422621119e-02   +3.421144064567503e-01; -5.041569445033003e-01   +2.170998289346874e-01   -1.918091439404305e-02   +1.580335484916001e-01   +1.612610202037194e-01   -6.740863813463345e-01   +2.588189962410655e-01   -4.674313542436246e-01; -2.138656214683053e-01   -1.955900468534385e-01   +6.191726830667885e-01   -2.673964717037471e-01   -1.762443640006495e-01   +5.050390142040642e-01   -6.571063260181408e-02   -3.963239243266584e-01; +9.928208230130692e-02   -4.743037843813656e-01   +5.416952743933805e-01   +3.187166848588880e-01   -7.479147349811284e-02   +7.029537216000585e-02   -5.835774490255274e-01   +1.568998079864976e-01; -9.610156759426799e-02   +9.569485742797364e-02   +4.741210573505840e-01   -2.501053800022351e-01   +9.640017837244047e-02   -7.068813090641073e-01   -1.409784885380952e-01   +1.061616943786794e-01; +2.030424749427015e-02   -5.303213799635437e-01   -7.352652428199208e-02   -1.074568726973978e-01   -6.777819861983094e-01   -5.252354921795508e-01   +6.151397661736267e-02   -2.486297412542521e-01; +1.310560568197641e-03   -8.279771501684921e-02   -5.664650355136636e-01   +4.373534405476839e-01   -1.876123610533294e-01   -2.721853694646859e-01   -2.559229293498203e-01   -9.319684732351899e-02];
L1E_L2E_iAMPA_netcon = [-2.823586364216503e-02   +5.028732523246998e-01   -2.878387341670902e-01   +4.328147690340661e-01   +4.904201149312298e-01   +7.233408029965067e-01   -4.336903448247758e-01   -5.468644157511900e-02   -2.524494520802810e-01   -6.250647599769074e-02   -1.646180272499789e-01   +7.207723132021633e-01   -8.596701161184714e-02   +5.782153623596790e-03   -2.782220618894483e-01   +4.363551497396467e-02; -4.984020155906895e-01   -4.608205395558777e-02   +2.271634363934320e-01   +5.001703013786050e-02   -2.894703030832093e-01   +5.111667237394992e-01   +3.266399525030763e-01   +6.718516319470638e-01   +7.322164944502459e-02   -1.995114634429228e-01   +5.712268787231715e-02   +6.912653364238478e-01   +3.130798242518226e-01   -1.217836110592713e-01   +3.727415720815652e-02   -3.133747321678584e-01; +8.345924254436782e-03   +3.381356472668838e-01   +3.186154745466913e-01   -7.007977081967109e-01   -1.923925250345956e-01   -2.800233354005420e-01   -3.406006947372235e-01   -9.714708138275921e-02   +5.768205698791847e-01   +5.224680113006347e-02   -4.325478301881491e-02   -3.110912503666203e-01   -1.828516309472712e-01   +2.468320728500845e-01   -1.770625300421667e-01   -3.744547990875329e-01; +6.258871430670276e-03   -1.078676418071327e-01   +1.706830879810969e-01   +1.454064706426034e-03   +3.833180000149227e-01   -1.065440423462206e-01   +2.672749930456445e-01   +3.418647201250020e-01   +9.268648219435047e-02   -1.128833806690622e-01   +3.098697509228789e-01   +7.668260277517552e-02   -1.839213319239146e-01   -6.351764571996338e-01   -3.071430355993102e-01   -6.832130146679191e-01; -2.881603818151897e-01   +1.306859719854204e-01   +9.475183264211552e-02   -1.869279482582060e-01   +5.166508849595131e-03   +4.127698209432098e-01   +2.326945535057063e-01   +5.346985867797887e-01   -4.531172877634804e-01   +4.296032570260326e-01   -3.119566040539180e-01   -3.843340172011211e-02   -2.398237059815611e-02   -1.412452952863530e-02   +3.476816845861759e-01   +2.709497744509623e-02; -1.965393523071330e-01   +1.425609867551833e-01   -2.881978407350897e-01   +3.423963036602303e-01   -1.602539014983231e-01   -3.627374132481416e-01   -2.285269647989747e-01   +5.007664499450399e-01   +2.913180064548339e-01   +1.680429686170160e-02   +3.994105467984256e-01   +1.554369077732095e-01   +4.772370467050022e-01   -2.660475520190266e-01   +1.158887591808832e-01   +3.370557491781525e-01; -2.548986656028027e-01   -1.030249764904628e-02   +2.402567732718950e-01   -1.228402167442913e-01   -2.283153932203335e-01   -2.113534826660946e-01   +7.481129940751835e-02   -7.661733932733006e-03   -1.518833877246821e-01   +3.927196116529864e-01   -4.386726270934722e-01   +4.021661878807851e-01   +3.276952095623880e-01   +5.576289060511241e-02   -2.747895310421390e-01   +5.329112015263152e-01; +2.836899878865670e-01   +1.255296554257120e-01   +1.157655898172888e-01   +1.703249237285126e-01   +1.472806444405608e-02   -2.991519014879935e-01   +1.953446499682854e-01   -1.920042465419050e-01   +4.412233965865708e-01   -1.132388558766158e-01   -1.489521161038814e-02   -1.442375217750537e-01   -1.501065041323994e-01   +4.576441220385413e-01   -5.749154974919371e-02   +3.092438284643311e-01];
L2I_L2E_iAMPA_netcon = [-3.277001506011163e-01   -1.376720392928151e-01   -7.439796428875896e-01   +5.218691144549418e-01   +4.025248959065425e-02   -1.042916383982863e-01   +8.928603246842749e-02   -4.426853911510121e-01; -3.890582849888853e-01   +1.966861089110701e-01   +4.518925983561485e-01   +1.451276384274806e-01   -3.331707002989537e-01   -3.082550681678639e-01   -3.023050388797897e-01   -2.511374708677850e-01; -6.846974239117383e-01   +2.993140406770016e-01   +2.518690792603001e-03   -6.694565815621368e-01   -2.531162494722659e-01   +1.142745056384869e-01   -2.543434394644532e-01   -2.838223221965044e-01; +3.681827158827826e-01   +1.887376745354716e-01   -3.036393633779514e-01   +7.198846050502877e-01   +2.354594952537295e-01   +2.145374846974172e-01   -4.359434532068457e-02   -6.565830227378141e-01; +9.420523422272134e-02   +2.330256292224626e-01   +1.462949565526818e-01   -2.651418922209184e-01   -5.803848301488663e-01   -1.871101648855981e-01   +3.520078547850330e-01   +2.511419113951697e-02; +3.622002184905567e-01   -2.818450417497273e-01   +1.732211273769479e-01   -6.198799902528093e-01   +3.315877058759978e-01   -3.348661701425525e-01   -2.588731679063468e-01   -1.872453732706059e-01; +2.198248992554531e-01   -1.607049133166168e-01   -3.481554226037797e-03   +2.287978119128656e-01   -1.487994337772371e-01   +3.282095600336531e-01   +3.423970390282453e-01   -4.349558178668912e-01; -5.675192526204139e-01   -2.232936044699343e-01   +3.940433064194170e-01   -4.997871660080214e-01   +7.119367342525131e-01   -6.319774192336773e-01   +4.449272173526745e-01   -4.025171422916224e-01];
L2E_L2I_iGABA_netcon = [+7.390306155545888e-01   +1.875701139413625e-01   -1.224942686264223e-01   -5.582176224384285e-02   +5.310151483427863e-01   +1.924383015672022e-01   -5.709195705501872e-02   +1.916281219226834e-01; +4.225014453128405e-01   +3.822327505835217e-01   +5.461896869381621e-01   +7.037834269433598e-01   +5.339713114024450e-02   +9.500127518914611e-02   -2.286055128785494e-02   +1.455982669570321e-02; -2.802457134021717e-01   +3.718744973494792e-01   +6.281782911510657e-02   -1.418812989847392e-01   +5.266406553810311e-01   -5.463315872942177e-01   -3.386109873058833e-01   +3.547894682783481e-01; +1.979736922056319e-01   +7.270562863415134e-01   +2.651788641368296e-01   +2.835088957815003e-01   +4.132199552343225e-01   -6.418891855008813e-01   -2.423659888966030e-01   +2.749822849214272e-01; -6.867271858903278e-01   -5.975328558964816e-01   -7.650518413317554e-01   -3.944957245886477e-01   -3.143098471704256e-01   +6.510860432796639e-02   +3.546067647202764e-01   -7.772271128573738e-02; -1.006398485035472e-01   -2.238827244976859e-01   +4.637354226206576e-01   -7.106821132050163e-01   +2.157464333961607e-01   -9.422481031647667e-02   -5.468613582479141e-02   -5.030953666909426e-01; -3.778433197697155e-01   -3.124688705455755e-01   -2.658694056096055e-02   -2.866212157885484e-01   +7.767778072095714e-02   +3.165990535262817e-01   +1.076257827500764e-01   -8.778734284340116e-02; +2.268082546376372e-01   -1.453275556084232e-01   -4.977193797993973e-01   -4.324066704583947e-02   -2.217182178740113e-01   +5.982759666908440e-02   -2.800212328763939e-01   -1.270279038357211e-01];
L3E_L2E_iAMPA_netcon = [-2.863979383755192e-01   -3.903865805450038e-01   -1.247997313320613e-01   +2.292208089875097e-01   +5.798567758692111e-01   +4.045497532242288e-02   +9.403540041481508e-02   +4.175803180917197e-01   +5.321424890237156e-01   -2.232599818758533e-01   +2.300116052617145e-01   +4.083764107533463e-01; +4.351615502996648e-01   +2.040411449120807e-01   +2.397561987571896e-01   +3.234219929966152e-01   -2.961336570539545e-01   +6.135304698742498e-01   -2.216019795111552e-01   +1.492962553222662e-01   +4.131744857766490e-01   +3.458284379854847e-01   -1.716794643522939e-02   +5.400860921724456e-01; -4.487298761446775e-01   +1.231324831523392e-01   -1.057017809145650e-01   -3.244611281322993e-02   -1.987684624357583e-01   -1.795478766467665e-01   -3.726497672090751e-01   +2.874558964278452e-01   +8.947543486341493e-02   -4.763818655695413e-01   -1.947445551264826e-01   +1.658096526494924e-01; -5.375719604049365e-01   -2.639931320209360e-01   +1.324453817646992e-01   -4.264038399012031e-01   +2.541173562900853e-01   -4.189797832564953e-01   -2.353155709069293e-01   -1.754481045455004e-01   -7.848400864919472e-02   -1.988055628460765e-01   -2.767852895509710e-02   -1.752195457418078e-01; -5.014691127963574e-01   -1.000000000000000e+00   -3.631102047885969e-02   +4.934925843348809e-01   +2.300673770923932e-01   +1.092475748260406e-01   -5.971823475436461e-02   -2.307446390553591e-01   -2.529909300851798e-01   +2.771903174047689e-01   -3.680221262425302e-01   +1.637931592344722e-01; -1.396699585217338e-02   -1.051303632603501e-01   -4.487048058820277e-01   +5.126639849549105e-01   -4.773341472649723e-02   +1.663850518738308e-01   +3.027842899046114e-01   +4.139031242100896e-01   +3.383083719029127e-01   -1.183502995073250e-01   +2.357644702617601e-01   +1.057569174989703e-01; +2.875742714992279e-03   +2.722074971365795e-01   -3.712928286139079e-01   -1.083387201015705e-02   -2.239581097918072e-02   -4.769209462824563e-01   -6.305255367207161e-01   +5.489281828450042e-01   +3.271689644312611e-02   -2.509924182132223e-01   -4.192746164721883e-01   -3.757514610805509e-01; +1.210231701492406e-01   -1.279207762330408e-01   -1.132524466753492e-01   -9.972836151458400e-03   +3.953325651814670e-01   -3.485010397827545e-01   +2.276899953846585e-01   +3.174088467203758e-01   -1.570728037130721e-02   -8.495586427302688e-02   +5.364900586821941e-01   -4.380974504237748e-02];
L3I_L2I_iGABA_netcon = [+8.703172008191177e-01   -2.977669852839088e-01   -3.217737237638035e-01   +7.561890253425851e-03   -5.329637310694423e-02   -8.425436234237578e-01   +4.952886196721525e-01   +5.548994802284715e-02   -6.258326506931026e-01   -8.673360273416435e-01   -4.366741297561056e-01   -5.236106372877780e-01; -4.017593299616571e-01   -6.014527257174193e-01   +1.124507410436693e-01   +1.827231220233816e-02   -8.110627617501582e-01   -1.449152753615608e-01   +3.257687064332895e-01   +2.302326570963476e-01   -4.377018397712090e-01   +1.980665481490281e-01   -4.764519370686603e-01   +5.814015770957883e-01; +1.684374128151745e-01   -3.038029634883507e-01   +6.072875209089335e-01   +9.610447545824867e-02   +7.090556111234658e-01   +1.646898364010926e-01   +1.974729414032779e-01   +2.230080801151802e-01   -8.786861249494005e-01   -3.174050803514979e-01   +9.749303094777302e-02   +1.450503773142132e-01; -5.703501110071795e-01   +6.185164795377190e-01   +1.641489939701509e-01   -1.082803330856035e-01   -1.217435257627682e-01   -2.447861456123656e-01   +6.626401684361013e-01   -4.673280491165115e-01   -3.339624790058852e-01   -3.954857830994708e-01   +2.288059582003364e-01   +1.410662557801763e-01; -4.515953297442734e-01   +1.176836446916241e-01   -4.022133398586508e-01   -4.177750840943629e-01   +3.502520147378299e-01   +3.181935817240826e-01   +2.000986473110900e-01   -1.009734069313475e-02   -3.372611030126292e-01   +1.272334982077426e-01   -3.986781686769343e-01   +1.462981014243440e-01; -4.209999195365141e-01   -7.331087736713124e-01   +3.856897740890624e-01   -1.835269187999514e-01   -1.688042633801825e-01   +1.912475091406171e-01   -3.747040591233833e-01   +3.343471057246126e-01   +6.897307913574713e-01   -1.332898664900584e-01   -4.853329112211124e-01   +6.173972518184856e-01; +5.137671140501147e-01   -1.797976774291907e-02   +3.779410608519191e-01   +7.240424515103123e-01   -7.535083845190382e-02   -5.838292336609302e-01   -1.643563790092992e-01   +4.090576480633605e-01   +4.549473463083288e-01   -5.137717143034906e-01   -5.944303456227799e-01   +7.493968142407067e-01; +8.061329155653509e-01   +1.300180700982642e-01   -5.507790820103029e-01   -1.789029650506772e-02   -4.165044373961622e-02   -4.714395333052505e-01   +4.944523750461305e-01   +5.129342543021178e-01   -8.925220824597615e-01   -4.755382042826315e-01   +3.168179135908657e-01   -3.931386045664368e-01];
L2E_L3E_iAMPA_netcon = [+2.940086872561627e-01   +4.585537235970755e-01   -1.319871608569374e-01   +3.208066887372063e-01   +4.732865755938289e-01   -1.692123294790168e-01   +5.306522176444997e-01   +1.727716867333028e-01; +1.877771726348360e-01   -3.211494697993156e-01   +5.563681766442367e-01   -1.988111884334746e-01   +2.834374960791955e-01   -8.073051618762701e-01   +4.944091644762098e-01   -1.475978155374293e-01; -3.372596974613565e-01   -4.582747085842778e-01   -4.321022156931215e-01   +4.410268608335710e-01   +3.293300123549473e-02   -1.524541902502400e-01   -5.886719177657140e-01   +1.274065231877017e-01; -3.047588362451175e-02   -1.238899058198297e-02   +7.492064646658390e-01   -1.656175148067109e-01   +7.411427974561872e-02   +2.257788876740235e-01   +6.548011252965857e-02   +7.496556766879656e-02; +1.236460203898332e-02   +4.336838015691287e-01   -4.658512601359629e-01   -1.309650793307944e-01   -2.221727962073723e-01   +6.113038876239638e-01   -2.642337745988375e-01   +2.928489886061261e-01; +1.190420928220750e-01   -1.242610148579460e-01   +3.749808631151466e-01   +2.867489944394305e-02   -2.765682082998789e-01   -1.254933606473226e-01   +2.477412430170484e-01   -6.664248322312269e-01; -2.032314521460853e-01   -1.917511053809172e-01   -1.290671056640028e-01   -1.053709849375017e-01   -5.332197261150806e-01   -1.038838999645483e-01   -4.309277876987878e-01   +2.035630735063344e-01; +9.786678109104292e-02   +2.048287814020303e-01   -1.860038836070168e-01   +2.152313369766166e-01   +1.197017249033745e-01   +3.583634317590681e-01   +4.992319685708405e-01   -3.293870158947013e-01; +4.094270343941345e-02   -5.088838049197716e-01   +3.163635436075144e-01   -7.535124966415943e-02   -1.998008323273877e-01   +2.416434417201525e-01   -2.029877500907167e-01   -3.074460439368924e-01; -4.602656101748502e-01   +4.893838207272498e-01   -1.000000000000000e+00   -3.872401510794460e-01   -8.360318299899298e-01   -2.336566707970518e-01   +1.537244153233518e-02   -3.684825480112034e-01; -8.087973291381724e-01   +4.506586613322640e-03   -2.226375718753720e-01   +2.532927931667445e-01   -2.049247319049371e-02   +9.140612782396351e-02   +1.764229211611933e-01   +6.687156218523403e-02; +1.707835057630687e-01   -9.090265990451220e-02   -7.758586714184073e-04   +4.507523565519782e-01   +5.480688286476022e-02   +4.345210916428521e-01   +5.384164307942347e-01   -7.216738066402661e-02];
L2I_L3I_iGABA_netcon = [+3.601036124754216e-03   +3.882422296165737e-01   -4.132863008995856e-01   +3.167962139922420e-01   +3.681762239804921e-01   +5.467846929733006e-01   -4.459099714154696e-02   +3.378979070146640e-01; -1.878312030781858e-01   +4.828498742908342e-01   -6.670162805847257e-03   -5.808365203689322e-01   +2.624519811472547e-01   +8.239472986061922e-01   -5.750682225129421e-01   -5.026389845569836e-01; +1.953787324952735e-01   -2.610135266793957e-01   -1.797666543979552e-02   +6.051294277557349e-01   +2.872391354216480e-01   +3.806116380999994e-01   -3.075595931924868e-01   +2.098589936847465e-01; +3.976383819820746e-01   -9.630410921274773e-02   -5.386242486205757e-01   -3.228548251401799e-01   -7.576856121843437e-01   +2.322401250330122e-01   +6.194581223911154e-01   -2.300268815806389e-01; -1.567609208933005e-01   -3.804252587871491e-01   +1.142837020888944e-01   -3.547623547209162e-01   +3.277692774084831e-01   +1.711881767216367e-01   -6.797780682531325e-02   -3.458004978295922e-01; -4.828587397908717e-01   -3.512617106415194e-01   -4.080968080363930e-01   +4.355051054610172e-01   +9.884722512387855e-01   +5.849559211009383e-01   +5.006706278766018e-01   -2.943348482407935e-01; -2.457190635026362e-01   +2.273965791198967e-01   -3.687850134690278e-01   -4.350270919790120e-01   +2.055248955676435e-01   -5.222011668501985e-01   +2.253369951447032e-01   +4.819961325492829e-01; +1.779888993970618e-01   -1.617711474174024e-01   +9.985660086496978e-02   +2.375848171674044e-01   +3.441567085620872e-01   -1.184187862971018e-01   -3.737122210445661e-01   +4.695382503600510e-01; +3.675634193482805e-01   +4.320963258325928e-01   +4.690225810022157e-01   +6.537249842269864e-02   +4.745370738515859e-01   -8.997264854909048e-02   +4.469442580836981e-01   -5.029493185433039e-01; -3.355673422276259e-02   -9.295470137855968e-01   +2.133075816445142e-01   -4.467773664903740e-01   -5.396104949612108e-01   -3.196143977445194e-01   -5.444737225391296e-01   -5.316644368450173e-01; -1.428676164577324e-01   -1.639723629811103e-01   -6.655708695988151e-02   -1.785829953487346e-01   +3.965899311011186e-01   -3.334972320447056e-01   -5.204677176454935e-01   -4.259648833489552e-02; -2.767501676302099e-01   +4.618110164328408e-01   +5.880598035828124e-01   +1.185617500935040e-01   -2.556868830611417e-02   -5.180760656011446e-03   -2.846217809055166e-01   -1.118895222904505e-01];
L3I_L3E_iAMPA_netcon = [-4.765667884856026e-01   +8.716211891012043e-01   -3.290158033170253e-01   -4.279796985472605e-01   +3.910186910180106e-01   +1.950351508587594e-01   -5.711948013813940e-01   -6.506307149994739e-01   -3.180469372364977e-01   +1.025122375773094e-01   -3.702697179094332e-01   +2.376582974308554e-01; -1.477121339890436e-01   +7.180262931001987e-01   +1.647582196020252e-01   +2.664352394201972e-01   +3.772196341179442e-01   -2.275978524323634e-01   +1.418026414315640e-01   +8.894120332410119e-02   +5.135265160246330e-01   -3.765759803162516e-03   -4.188393792932064e-01   +2.854450448611234e-02; +3.751516112141517e-01   +4.678979486070897e-01   +1.584481262624955e-01   +3.412264962966320e-01   -2.211215100514213e-01   +5.980399415600933e-01   -8.048104083739138e-02   +1.808456399719022e-03   +3.582020554248560e-01   -1.151062371721703e-01   -2.364194581244055e-02   +1.414506992999447e-01; +1.876956582437614e-01   +1.669761027229286e-01   +1.014776847808797e-01   -2.693211370001960e-01   -1.186809116513892e-01   -1.653396985531257e-01   -7.974624042131175e-01   +5.989804675411472e-01   +2.024844890622513e-01   -5.048644984420434e-01   +6.263886889793115e-01   +1.133703545453486e-01; +5.014330753863383e-01   -6.071420265164207e-01   -6.714134369113126e-02   +2.781080041474667e-01   +1.896776655693975e-01   -1.303384348952192e-01   -3.116679532117588e-01   -3.217863772333728e-01   +4.978941829299764e-01   -7.777449879662894e-01   -3.319734488427055e-01   +3.285420845205320e-01; +4.980237442700470e-01   -5.777259769258879e-01   -4.099184733261128e-01   +1.926572991679843e-01   +1.152013939862456e-02   -1.620163189156247e-01   -1.405494126904907e-01   -4.515136878005642e-01   -1.361333055282071e-01   -2.346021672954353e-01   +3.892382706866510e-01   -2.445895284001900e-01; +8.220265544269459e-02   -7.039895159289404e-02   +4.935181950412454e-01   +2.503812325249852e-01   +3.082335613874239e-01   -6.858282092851172e-01   +2.941667286305561e-01   +1.458695104694775e-01   +8.958790881963730e-02   +5.700464128408400e-01   -1.726371823769512e-01   -2.424515819036782e-01; +1.397401034576041e-01   +1.489792897952554e-01   +5.039826868358990e-01   +3.613961774035478e-01   -3.632637694279585e-01   -3.313005006683756e-01   +2.275926192905322e-01   -4.247142040858308e-01   -5.048236829668939e-01   +3.136922160384700e-01   -1.060069003837612e-01   +2.500238865312533e-01; +1.297142255607423e-02   +5.237880107636370e-01   -2.052761164512675e-01   -6.545048862462562e-01   -3.574124420924397e-01   +7.370718633097709e-01   +2.580970867836664e-02   -3.659839190473821e-02   -3.004949056017884e-01   +4.974026921502651e-01   -2.669866197652994e-01   -2.431436337601902e-01; -3.102269323704401e-01   +1.582959744557944e-01   +2.558643353487250e-01   -3.838984229061856e-01   -1.754868189073522e-01   +3.269078303152876e-01   +2.424927810851946e-01   -2.053699793131986e-01   -1.032934020576402e-01   -1.124867604138484e-01   -5.607778219659214e-01   +7.682347318377404e-02; +1.814344098168344e-01   -4.305131373502068e-02   -6.608275727497567e-02   -4.102104636188946e-01   +1.319050429160567e-01   +1.596026123342988e-01   -5.211954436762085e-01   +3.727272297173962e-01   -7.531310507201308e-02   -1.295471291960400e-01   +1.345373487057098e-01   +3.705997492825527e-01; -4.149109066681265e-01   -1.609509971142018e-01   +7.053231349566078e-02   -1.981654140890836e-01   -2.524487694482828e-01   -1.421425178059932e-01   -5.376884446300166e-01   +6.894465163303498e-01   -1.007136979373152e-01   -1.378092702014421e-01   +1.530143694622659e-01   +3.465580002269025e-01];
L3E_L3I_iGABA_netcon = [+4.198078888194475e-01   +2.511237228766173e-01   +2.140729187966602e-01   +9.525477773507542e-02   +2.533495329317199e-01   +2.878357594796918e-01   -1.650655635709332e-01   -3.763560094775725e-01   +2.973342662900950e-01   -1.404463211677773e-01   +1.186921360168386e-01   +3.301848656033775e-01; +4.888292485658068e-01   -1.080018092662399e-01   -5.351602460135091e-01   -1.793013678362956e-01   +1.269477090245451e-01   -3.898008794861328e-01   -2.079564133559217e-01   -3.252247580458834e-01   +3.632903757249286e-01   -1.756951375439466e-01   +5.118500439012583e-01   -6.986131200693524e-02; -4.210820656765485e-02   +1.166939443856468e-01   +3.530689737230579e-01   +3.807333713240261e-01   -6.580790072119606e-01   -5.857340451248005e-02   -2.462752140117947e-02   +4.665795079060935e-01   +1.124905947659336e-01   +8.767321729001215e-01   -6.994215391435351e-01   +8.557711293164005e-02; +1.291782194199914e-01   -2.461305807184341e-01   -5.443763135138291e-01   +5.247793176364923e-03   -4.517938788669758e-01   -3.765473709571935e-01   -3.293542367749489e-01   +1.909651226373767e-01   +8.243968764121309e-02   -2.558461828887074e-01   -2.199567123430760e-01   +1.433246132484485e-01; +1.673593085965965e-01   -2.558771254200983e-01   -8.520612474034174e-02   +4.073939922194270e-01   +3.827172405531010e-02   -3.708010270475902e-01   -1.734422786266433e-01   +4.254166654102643e-01   +2.960253503955436e-01   -2.188092347579176e-03   -2.619699253821413e-01   +1.249277023861351e-01; +9.000344092187069e-02   +1.034444388567863e-01   +4.629148045968058e-02   -3.508032145202143e-01   -1.067113333055075e-01   +3.822586442764541e-01   +7.285288483743491e-04   +8.391216189618135e-01   +3.486850036120644e-01   -6.249305571852215e-01   +1.043000190776180e-01   +1.887427394307829e-01; -9.380762448235902e-02   -1.348458903269159e-01   +1.684307718646650e-01   -3.826405310054444e-01   +1.870848607165426e-01   -1.977157204002972e-01   -6.314285359999311e-01   +3.238509941064120e-01   -1.626631469603756e-01   -3.844848020309030e-01   -3.544743804828198e-01   +1.487736197504366e-01; -5.365558832747028e-02   +3.722892331837797e-01   -1.577431382404324e-01   +3.673356109031635e-02   -1.096610920625425e-01   -5.457598601748540e-01   +2.780184563690410e-01   -7.679155107003154e-02   +5.671273096046174e-01   -5.470782225084956e-01   +3.447813479961695e-02   +3.188708258314245e-01; +7.045556236337303e-02   +6.584470246068030e-01   +5.156768453652129e-01   -3.411184206875866e-01   +1.556573958727613e-01   -3.943144466685730e-01   +1.870958185734723e-01   +4.612937900891612e-01   -6.629471418912655e-01   +3.812025126550669e-01   +4.468584751861694e-01   +3.185956952005612e-01; -3.784573731890494e-01   +5.541864542549418e-01   +3.758600769517110e-01   -6.069132222652462e-01   +5.150789282902783e-01   +1.470267673045725e-01   -2.100627898286295e-01   +1.433414571239713e-02   +6.747036437674350e-01   +6.320197613904106e-01   +4.173831838253370e-01   +2.126635062641376e-01; +1.961144120058332e-01   +7.436682141994176e-02   -2.305669675904492e-01   -1.260467113012970e-01   +4.280846779868767e-01   -1.539817695984733e-01   -4.594824867299917e-01   +2.654279535663354e-01   -2.820238243427241e-01   +2.176233369815222e-01   +7.955947972478641e-01   -6.732910221350308e-02; -1.469974141296485e-01   +6.028209951710461e-02   +1.818397739310545e-01   +1.214521211139857e-02   +3.283215873957188e-02   -2.604111694475555e-01   -3.418719054065674e-01   +1.832469616990836e-01   +8.801404038421515e-02   -3.968641529188124e-01   +2.847761170572878e-01   -2.881506397605750e-02];
L2E_Input1_iAMPA_netcon = [+5.689045714467946e-01   -2.820676208804191e-01   -6.718538340223247e-01   -3.715031147535310e-02   -4.343527719553102e-01   -9.650254297077770e-02   -3.816402949515228e-02   +1.301745360716317e-02];
L2I_Input2_iAMPA_netcon = [-8.775384658985055e-01   +7.022125941201939e-02   +3.117082944406607e-02   -5.929555763210478e-02   -2.212197203896736e-01   +8.481170825435708e-01   -9.320666893070430e-02   -8.670754304007718e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
