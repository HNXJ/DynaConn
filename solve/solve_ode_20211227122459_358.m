function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-8.507663598460684e-02   -1.642556118532382e-01   +1.366727954277015e-01   -2.866371421707379e-01   +1.299842482157327e-01   -1.551714725578595e-01   +8.499408505804029e-02   -1.612021899441195e-01   -2.028832301206545e-01   +1.075822146529237e-01   +2.595881472589759e-01   -5.483639743904684e-02   +2.337668753977778e-01   +1.200311672200526e-02   +3.133274967790395e-02   +1.328621888207406e-01; +1.489714015570334e-01   +3.801347450818761e-02   +2.317633986870649e-01   +2.197854265600369e-01   -2.224128727458225e-01   +1.069619883526907e-01   -1.045320346858134e-01   +1.632783401881313e-01   -1.845932727223944e-01   -5.886493803159186e-02   +1.336522658117393e-01   +3.241317312374806e-02   +2.395662770322931e-01   +2.547444954470237e-01   +9.015936907104319e-02   +2.653074692311415e-01; +8.285938443560471e-02   -2.583089554713400e-01   +2.008365562966643e-01   -7.137428995028861e-02   +2.309779635185532e-02   -2.726110206647934e-01   -1.088237996749613e-01   -2.078501527787349e-01   -9.575180682180713e-02   -1.555492775079531e-01   +9.994924219281223e-02   -2.064699811296755e-01   +2.256474645641370e-01   -2.400018020195705e-01   -1.684884810423222e-01   +1.090040785641322e-01; +1.983499258841358e-01   +2.056303902738364e-01   -2.008221744009613e-01   +1.246009906703632e-01   +2.286070376462438e-01   -3.148147352317798e-01   +1.211192637119898e-01   +2.381105951869534e-02   +1.101974591611892e-01   +1.020052710402550e-04   +1.425866396226175e-01   -8.864947021649777e-02   +1.967061704620701e-01   +1.026540242965650e-01   +1.595209089694848e-01   +8.184350666526022e-02; +9.132904222304890e-02   -2.630136682655924e-01   -8.046709938870469e-02   -8.789218934880107e-02   +8.650975205583929e-02   +2.642632571042400e-03   +4.343201195129461e-02   -1.976069471888313e-01   -7.691074175608574e-02   +2.298644034228304e-01   -2.433915303816479e-01   +7.696515741915855e-02   -9.285509578062540e-02   +3.389812509484076e-01   +8.294404748080574e-02   -1.880104197249258e-02; +1.174686718223070e-01   +1.189304055313361e-01   -9.409870544305819e-02   -6.274418250817096e-02   +1.207343972174171e-01   -1.009071203223968e-01   -2.687892744841706e-01   -1.686086061582220e-01   -5.552953825264969e-03   -3.256540419491034e-01   -3.375788217521208e-02   +2.042161867470327e-01   +2.323958624551104e-01   +1.388898684132164e-01   -1.470667004926396e-01   +1.154729621380499e-01; +3.075423081723337e-01   -1.042590352917743e-01   -1.278766245575963e-01   +3.589682217981634e-02   -1.087842993769023e-01   -2.166804714016387e-01   +1.510605342677362e-01   -1.286022124691074e-01   -2.894735272393615e-01   +8.095256403483064e-02   -1.965951960070085e-01   -2.308102805109580e-01   +2.518269860128501e-01   -2.845570053106381e-02   -9.426030512316374e-03   +9.995630507945900e-02; -1.534692444616223e-01   -4.497673031215411e-02   +1.415533759549738e-01   +1.641338340439407e-01   +3.167484048058544e-02   -2.529968709209802e-01   +3.647665234613921e-01   -2.094871692685755e-01   +2.069710520202420e-01   +2.386656133164234e-01   +3.407875157766941e-01   +1.393469515957607e-01   -1.996706106118554e-02   +9.963337876288053e-02   +8.933139780706550e-02   -7.733115558675389e-02; -4.193744813417182e-01   +2.657667571334754e-01   +3.607292345451048e-01   -1.036067418277796e-01   -2.612128562502548e-01   +2.964281982383130e-02   -8.646915531810659e-02   +3.157812654694976e-02   -1.153954322662415e-01   +8.284872858180489e-02   +1.356392585867439e-01   -2.006277196074672e-01   +8.008918894357714e-02   -4.377607417473149e-02   +6.757912281304871e-03   +1.384018488808688e-01; -9.543043241308045e-02   +9.760978137133275e-02   -1.220495372983741e-01   +4.544220063711091e-02   -2.980535268973618e-02   -6.176103848160403e-02   +8.142592099296483e-02   -3.029137863859124e-01   +6.499036531648382e-02   +1.822402124944815e-02   +1.068390711937227e-01   +1.360161813102650e-01   +1.877138763399741e-01   -9.195266062908652e-02   +1.956320462852270e-01   -9.173968018976472e-02; -1.376345627153538e-01   -5.981000501703887e-02   -1.173920117836411e-01   +1.125742247882259e-01   -9.825120481369806e-02   -3.115344351743095e-02   -1.650013130286006e-01   -3.721087874438021e-01   +2.822164133195283e-02   -2.617218359826178e-01   +7.715767897667290e-02   -1.609996367631793e-01   -1.699302029499562e-01   -1.736184407126638e-01   +1.696845968881102e-03   +1.178927008987614e-02; +5.178385369121313e-02   -1.208415429073469e-01   +7.524820015389247e-02   +1.607296806613374e-01   +1.157035606264060e-01   +1.641359781449975e-01   +7.428846218535767e-02   -3.171433826110603e-02   -2.815850068455203e-01   +2.060675493982692e-01   -2.933473008298016e-01   -4.801484881523329e-02   -3.078948683870938e-01   +1.345238962046214e-02   +2.248425561656935e-01   -7.714004199381949e-02; +1.265563168766944e-02   +1.550784386714363e-01   -9.795548894052852e-02   -1.323399678595146e-01   +1.800386284676919e-01   +6.458069576867885e-02   -2.863929334773757e-02   -6.615551691750940e-02   +2.871698710518405e-03   -5.506949448155572e-02   +1.237398468192607e-03   -1.047652384526664e-01   -3.023049974163426e-01   +3.233449414472595e-01   +2.187991216252911e-01   +4.682689065531396e-02; -1.899515876560060e-01   +5.078440134351891e-02   -2.217652821644386e-01   +1.165083823205010e-01   +5.568546062591538e-02   -1.248666853176841e-01   +2.358023091435747e-03   -9.692658869508389e-02   +1.561742114118898e-01   -1.622306896796694e-01   -1.824761986316730e-01   +9.035590343074333e-02   +2.817641287426687e-01   -2.228826235021205e-01   +7.924997481839462e-02   -2.702478741278342e-01; +1.019982363994545e-01   -2.107303327980205e-01   -2.181843100671760e-01   -4.765790859740822e-02   +1.757453003845743e-01   +3.935568797051247e-01   +2.624305142058903e-01   +1.505242855587069e-01   -7.801834020797915e-02   -2.035720329755995e-02   +3.025318669269494e-01   +2.779556379246323e-01   +6.269399925287096e-02   -1.895958520927530e-01   -3.445518354358514e-01   -2.160280113379305e-01; -1.844082587371091e-01   -2.852102366187179e-01   -1.967075325205993e-02   -1.934375942318620e-01   -4.671593292607796e-02   +1.060530110623493e-01   -2.792206342057583e-01   -1.994539694107395e-01   +1.208756425021034e-01   -2.744790743533487e-01   +1.188690672816095e-01   +1.489538923998124e-01   +9.546068014755391e-02   -3.788722992940691e-01   -1.082980014376164e-01   +6.974422550860185e-02];
L1E_L1I_iGABA_netcon = [+3.839136131020881e-01   -2.999064139251623e-02   +1.957466192192031e-01   +9.163810648011950e-02   -1.392755153258844e-02   +7.539025013399083e-03   -3.135227366306200e-01   -2.219121264878814e-01   -2.739720552047854e-02   -1.046962821947711e-01   -1.247551239376155e-01   -9.131573142209083e-02   -2.024762012742123e-03   -6.400343192958702e-02   -9.979640221120607e-02   -3.121756351399972e-01; -2.197850598111546e-02   +2.043445252954639e-01   +2.363225791114960e-01   -1.739379576355411e-01   -2.525091810752245e-02   +1.766630166477789e-01   -8.025992395667154e-02   +8.141397481026946e-02   -2.992204533243518e-01   -9.301837579978919e-02   +1.948842471465003e-01   +4.334163586994845e-01   -1.395257710533911e-02   +9.624289235162360e-02   -3.757455977654816e-01   +2.272176882134358e-01; -2.754261948053332e-01   +1.457950704326821e-02   +1.301504106919287e-01   -2.622965847044090e-02   +4.825494461531481e-02   -1.332075279119920e-01   -1.234859581317050e-01   +3.553759221129446e-01   +1.147028193852932e-01   +4.151836798867549e-01   -2.290206397129168e-02   -1.044971869858500e-02   -1.919157890756681e-01   -3.760328927956044e-02   +2.279643133119526e-01   -9.557191207801635e-02; -1.618498963648222e-02   -6.145208951034452e-02   +5.274394297162407e-02   -1.307499752369839e-01   +2.683234592391738e-01   -9.663030458550674e-02   +2.016060926197012e-01   +2.329124372082943e-01   -3.037955823060556e-01   -1.518273970072156e-01   +5.733455578267281e-02   +1.980410080793974e-01   -2.671884010736401e-01   -7.048748969376677e-04   -1.333757461595116e-01   -9.916234810115272e-02; -6.449091696952247e-02   -1.783382791837900e-01   -4.609447312013375e-02   -8.114308268990217e-02   -2.547923559602067e-01   -1.225122561877231e-01   -5.785846464476326e-02   +2.068308827760988e-01   +2.890178732916525e-02   +3.281278952134358e-01   -4.224254160982932e-02   +7.158397739868066e-02   +2.428628125905967e-01   +1.985043984976530e-01   +1.952677491859990e-01   -1.211907711973265e-01; +1.791256892400215e-01   +2.469886019553592e-03   -2.043647984159954e-02   -1.090366527670589e-01   +9.896226952451194e-02   +2.319054237691045e-01   -3.630008435597505e-01   +1.770975438034513e-01   -8.789151327125341e-02   -8.656497726583895e-02   -1.146533725590549e-01   +3.114767954243098e-02   -1.690338619588937e-01   -1.176994461297234e-01   -4.666599690682019e-02   +2.646862292624746e-01; -2.612613706405073e-01   -1.260023109670737e-02   +6.497959413204343e-02   +4.266076112714693e-01   -2.159846171306356e-01   -2.106933054392907e-01   -1.286951233041005e-01   -2.477570465176403e-01   +2.270160656000671e-02   -3.227586473428560e-01   +7.134592811267305e-02   +9.735503664525344e-02   -1.588419562370038e-01   +2.389608273972588e-01   +1.767207617858492e-01   -4.319617600088239e-03; +2.125526687769754e-01   -3.050964893573208e-01   -1.014052482300452e-01   -6.173531989378633e-04   -9.637915523989765e-02   +4.861922750788462e-02   -2.618355266342801e-01   +1.446738200993671e-01   -1.438970404822426e-01   +6.539704743677026e-02   +1.274599890673699e-01   +1.378035657805815e-01   +1.585900958250860e-01   +2.983217354330664e-01   +2.877872804375364e-01   -3.628297137843706e-01; +5.438237425058758e-02   -4.080234565097508e-02   -3.145000799354759e-02   -3.453031745720567e-02   +4.224518430582312e-02   +2.772463822895118e-01   +2.250878570229293e-01   -1.532371426903517e-01   +2.425131447780458e-02   +2.490078808014811e-02   -5.017508481049839e-03   +9.843019753037906e-02   -3.704995234433922e-02   +2.500323031848147e-01   -9.398095540341672e-02   +1.813822951823147e-01; -3.349727824843186e-02   -1.529890660026412e-01   +7.774383775402119e-02   +9.533367257056186e-02   -1.330127705947498e-01   +2.830083266439978e-01   +1.133785930273598e-01   +7.183955800012125e-02   -1.049233541997770e-01   +3.601899127901749e-01   -2.049264759521308e-01   +2.449928275439972e-01   -1.652327735878909e-01   -7.882741184956328e-02   +1.551091013753435e-01   -2.358128639712312e-02; +7.850210613776260e-02   -1.739376409871368e-01   +7.653212492578723e-02   -1.280542000127029e-01   +2.613739759436261e-02   -2.710648586147694e-02   +2.587498040744755e-01   -4.863235568676676e-02   +1.539995955213293e-01   -1.069452611947444e-01   +5.685820548528507e-01   +1.618366379743055e-01   +1.695036187072267e-01   -2.107125766764349e-01   -5.918928978031660e-02   +1.004716396822469e-01; -9.143926549131037e-02   +2.149816544333417e-01   +6.838938827800291e-02   +3.184431409593467e-01   -1.166016438447555e-01   +1.902546457816991e-01   +6.618779951915585e-02   -3.792633189888595e-03   +4.169357484487449e-02   -1.168077824471194e-01   -1.064628786752713e-01   +2.392976728586002e-01   -1.980312801133916e-01   -5.101192950984761e-02   +5.919630150545407e-02   +7.540061919208671e-02; -2.436655776741710e-02   +9.312389381258352e-03   +1.391508693863171e-01   +4.972342318903850e-02   +4.246124624743106e-01   +2.349609365295393e-01   -2.709389377787501e-01   -6.642725570988212e-02   -8.893579411359367e-02   -1.753141202624833e-01   -2.122836340984108e-01   +2.700550875045352e-01   +8.783974005904557e-02   +5.153903540811738e-02   +1.866611873143154e-01   -1.640623926551204e-01; +1.904411266528308e-02   -1.114750435589498e-01   +2.096444332888713e-01   +1.333036162946022e-01   -8.467070847412134e-02   -9.581590758770019e-02   +3.710016049771510e-03   -1.115790851796850e-01   -3.856978761985654e-02   +2.274460751426066e-03   -1.025512898740053e-01   +2.536674541033958e-01   -2.469935390426889e-02   -1.301018061368558e-01   +1.340633729199659e-01   +3.068472991562537e-02; +1.866946948235777e-01   -1.368352133517666e-01   +2.863342807486532e-01   -8.779673663302011e-02   -2.019054413452171e-01   -3.605449514552338e-02   +1.179121525929184e-01   -1.881182052803487e-01   -7.271912393454660e-03   +8.410998002838489e-02   -1.876303155653749e-01   +7.380634941941996e-02   -4.995628511922524e-02   -1.254446123269872e-01   -1.680881477245842e-01   +6.597615480482273e-02; +2.219923719448531e-01   -2.637182561890675e-01   +3.033622487905094e-01   -1.977441361677732e-01   -3.586887416627054e-01   +1.675638465112962e-01   +2.813740099555019e-01   +2.726941826832410e-01   -6.501881485473879e-02   -4.555939527628296e-02   -2.061845893952885e-02   +1.070786115347337e-01   +2.104182789809243e-02   +2.925796080082141e-02   +3.136735925231067e-01   -1.881196438413102e-01];
L2I_L1I_iGABA_netcon = [+8.192201445122045e-02   +1.139066269233986e-01   -6.791280789983824e-02   +2.897239038201763e-01   -7.976209778331950e-02   -2.360106394710314e-01   +2.887393524594845e-01   +1.372355121946693e-01; -1.762521146370936e-01   +3.153072792356875e-02   -8.912245892864863e-02   -1.844912096858018e-01   +2.919035676733205e-02   +2.097247868956486e-01   +1.927081554305929e-01   -1.294323425427537e-02; -3.781431510591068e-03   -3.536629786507697e-01   -5.100820269472296e-02   +2.640137984036420e-02   +1.305613622622014e-01   -2.097662972862852e-01   -1.477829123479577e-01   +1.909373877755879e-01; +1.285163770303072e-01   +3.035701281751328e-01   -2.063737674199060e-01   +3.363583197226904e-01   +1.114291857233436e-01   -2.873561894706199e-01   +3.476586769977327e-01   -2.928070472571545e-01; -2.257168500423533e-01   +2.095246293849386e-01   +7.603458891006078e-02   +3.290359645596889e-01   +2.233428383438221e-01   -8.209794922590107e-02   -6.322421944302759e-02   +1.290333167491549e-02; -3.377528477593129e-02   -2.349304733897536e-01   +3.241099619941173e-01   +2.725717882999290e-02   +1.324816728502373e-01   -5.030277295149099e-02   -1.206618620165048e-01   +2.222891326925012e-01; +2.471276240506285e-01   -2.594642166574330e-01   -2.195090195836841e-01   -2.314667640388436e-01   +1.228821050351284e-01   -4.565445646390737e-02   +2.386651589829490e-01   -2.270193236680477e-01; +3.040095770725765e-01   -1.578815976887252e-02   +1.270886373523408e-01   +6.375671287864663e-02   +1.157300308244543e-01   -3.907946904354119e-02   -1.279424864386315e-01   -5.026281230698453e-02; +1.014929833023935e-01   -8.987695964105340e-02   -5.212239789592907e-02   -2.126038848456541e-01   +2.941070189692264e-02   -1.817063287629515e-02   +4.582254250668770e-01   -9.903702129774936e-02; -5.362826972770120e-02   +9.209521602507707e-02   +3.211316570628601e-01   -2.956344420686174e-01   -6.585683156379712e-02   -5.755316850398228e-02   -1.802958327834144e-01   -1.532486031563443e-01; +1.325779457466897e-01   -2.512666883126440e-01   -5.950980311870939e-02   +2.658958985456232e-01   -4.758347635537695e-02   +3.187005100834306e-02   +2.054035952511896e-01   +6.849681186340775e-02; -1.927953708896583e-01   -2.266713037250346e-01   -2.193510112075434e-01   +2.253464107952604e-01   +2.194494025671340e-01   -1.467017284115814e-01   -2.723729647279767e-01   +7.374240814346963e-02; -1.826450617106241e-01   -5.300681875136098e-02   -1.361504758685626e-01   -1.246332626961849e-01   -1.514198878904362e-02   +4.586849381994975e-02   -2.519628822731710e-01   -1.593353709441713e-01; +2.525601927786180e-01   -1.474601047137338e-01   +4.217475840773786e-02   -9.181449113009336e-02   -3.777051014641110e-02   +1.954724047328195e-01   +2.130474306196740e-01   +2.475076589237966e-01; -8.636602033992299e-02   -2.190943455116930e-01   -6.044937276285484e-02   -1.017444512663746e-01   +1.036667723079220e-01   +1.239311037366402e-01   -3.627468282838831e-01   -2.258046638979231e-01; -6.982709875671930e-02   +1.414983914518861e-01   +5.127618049917088e-02   -2.048431939736571e-01   -1.827349703799470e-01   -1.630034748849787e-01   +3.457452635363235e-02   +1.968058716407349e-01];
L1I_L2I_iGABA_netcon = [+1.198472129909259e-01   -9.159531109387709e-02   +1.709279897105726e-01   +2.327765552448026e-01   -3.803249368058619e-01   +1.629567624935495e-01   +9.956563399353474e-02   +1.241982599286650e-01   +9.993491114108938e-02   +2.483716727981295e-01   +1.778923426071395e-01   +5.788658597458214e-02   +6.436749776415382e-03   -1.444431131214082e-01   -4.698811823637028e-02   -1.745127339992472e-01; -2.465695497746080e-01   -2.689460157768898e-01   -4.098340129774360e-03   -3.248775199941244e-02   -6.113785420266483e-02   -1.757935705986667e-01   -1.236679062393698e-01   +4.127599191165735e-03   -4.530518164323861e-03   -5.105350812045831e-02   -6.316593160245640e-02   +8.883477271304316e-02   -1.292679537178481e-01   -2.541853981228218e-01   -2.159987038309876e-01   +1.033801258446896e-01; +8.781423998831056e-02   -7.254722059345234e-02   +1.700823377492207e-01   +1.825337051708130e-01   +1.238646572314434e-01   +4.406067819712892e-02   +1.489899444006938e-01   +1.955036475447482e-01   +2.581292915134379e-01   +6.440393640786288e-03   +2.307344146872342e-01   -1.945207294035681e-01   -3.803143011940363e-01   +1.412182940942816e-01   -1.548909735819854e-01   +2.930940382374818e-01; -2.070696831559353e-03   +1.031850254450424e-01   -1.016289314562018e-01   +3.256671770344041e-02   +5.982728067626786e-02   +1.365928056814600e-01   +6.982670263853578e-02   -1.926863904584651e-01   +1.919984509029901e-01   -1.076969181460456e-01   -2.156053465387126e-01   +2.845598757288856e-02   -5.828278545746891e-02   -2.982903277539042e-01   +6.208849466439767e-02   -2.834295204808616e-01; +1.658124497012032e-01   +2.156142382653404e-02   +1.454944512565185e-01   -1.575940898800779e-01   -9.272281019615115e-02   -4.841759542643650e-03   -4.884722848623234e-01   +1.480360412905779e-01   -1.443662809272594e-02   -2.753988363879078e-02   -9.508162819846247e-02   +2.686688146208308e-01   -1.314785826595347e-01   -2.613174101201850e-02   -7.789076594100308e-02   -9.784343956041144e-02; -3.345072555306242e-01   -8.084619267972493e-02   -2.533289344335170e-01   -1.122268748972886e-01   -1.414613864575906e-01   -6.092042352760552e-02   +2.770318176842550e-01   +2.555312669851618e-01   -4.802663704701046e-03   -1.847614348874900e-01   +3.885275184267906e-02   -2.826665987733974e-01   -6.954678515853389e-02   -6.140158131953430e-02   -1.471688384548265e-01   +4.445083672070871e-02; -7.644032265477219e-03   +3.996904450310131e-01   -1.384262358134483e-01   +1.177317736005352e-01   -3.079161635379547e-02   +1.944410140537267e-02   -9.382409221967436e-02   +1.005686756917604e-01   +3.091816822650410e-01   -8.443526481951566e-02   -2.025065587617952e-01   -2.340006265925025e-01   +1.122438704507110e-02   +1.794877311566787e-02   +8.509981589567084e-02   -7.744277838639069e-02; -1.176389930188451e-01   -9.945658371525931e-03   -8.705888658087826e-02   +7.863077578609132e-02   +1.078927828271089e-01   +3.250039210405645e-01   +7.920296437672927e-02   -3.199577586029078e-01   -3.813570067136530e-02   +7.792030605612225e-02   -1.148446556208662e-01   +6.966550106555375e-02   +1.319648240518397e-01   +1.086885917033681e-01   +1.152199744548321e-01   -1.135432183467116e-01];
L2E_L1E_iAMPA_netcon = [+1.841158198051345e-01   -2.602348680122190e-01   +1.351040437928379e-01   -3.558277393596384e-02   +2.085983330887751e-01   +4.190702293996633e-02   +1.062890304843835e-01   +7.273320381445253e-02; -2.955181605220999e-01   -1.463628168467200e-01   +2.079522858506790e-01   +2.091132954745182e-01   -6.775564826509042e-02   +1.526793350485438e-02   -1.668179162372511e-01   -4.140718334222174e-01; -3.047508863111190e-02   +7.056344645168294e-02   -4.405047876949703e-03   +2.067491424638949e-01   -1.557318495675526e-01   +5.270185210133470e-02   +6.042753481697290e-02   +2.005025695513363e-01; -1.135144015337579e-01   -1.209998374333924e-01   +1.788620894704777e-03   -3.188849875810416e-01   -8.120932743402426e-02   -1.801847397994183e-01   -8.029670938136044e-02   -6.705831340633356e-02; -2.882635446153474e-01   +1.722876483420358e-01   -3.010380280479401e-01   +1.617831679207966e-01   +9.478536867363654e-02   -8.887394384399747e-02   -3.691259225413834e-02   +9.844545934666322e-02; +1.317854602463963e-01   +2.953448026598153e-01   -1.361206810441699e-01   -1.462287936001019e-01   +4.767623070581096e-02   -1.509632587232504e-01   +7.890925484197114e-02   -6.100325756756229e-02; -2.125150190361084e-02   +3.275338750324405e-02   -1.325678090188419e-01   +3.708093655394040e-02   -1.053194529221700e-01   +1.404920990759580e-01   -4.107961927634119e-02   +1.795054103195747e-01; +1.647477491024710e-01   +2.299282851318793e-01   +1.191899042271766e-01   +1.890780482540009e-01   -5.619402415211315e-02   -1.743089983025895e-01   +2.689617768785624e-01   +2.746266503912618e-02; -1.562025698721248e-01   -4.155835304382700e-02   -2.812816845430866e-02   -4.448365958135019e-02   +1.069730368314664e-01   +2.836316668776149e-01   -4.959868427980468e-02   -4.181711179161396e-02; -2.626849929300930e-01   -1.656140520230800e-01   +1.451064219966818e-01   -1.984369251497023e-01   +1.026437379765905e-01   +1.949856340246980e-01   +2.413557151001310e-01   +2.840256137227573e-02; +3.574355254420670e-01   +3.851687697830532e-02   -1.271182690737508e-01   +2.549603778707185e-01   +3.306605690827891e-02   +9.216413956093913e-02   -1.576931978658985e-02   +2.194252000594543e-01; -5.897632036859572e-02   +8.486575136861899e-02   +2.467287405032486e-02   -1.491125667317111e-01   +9.659293384360840e-02   +1.913179105266367e-01   +5.019203061671594e-02   -3.263953490244431e-01; +2.752337609368775e-01   +1.071617862678402e-01   +1.729975702353995e-01   -1.416303980760116e-01   +1.080761321818601e-01   +6.238705921067739e-02   -3.185003670053112e-01   +8.789441845328566e-02; +2.381793461777247e-01   +1.721146865170581e-02   +2.612143376763809e-01   -3.202542024655378e-01   +2.243126208351881e-01   -6.101897939009625e-03   -4.404796391866335e-02   -3.148036645855075e-01; +1.886468598573859e-01   -1.059257036424837e-01   -3.449728525234579e-01   -7.567581545192979e-02   -1.021220045473069e-01   -9.124968698378480e-02   +7.600059513994270e-02   +9.893193567847418e-02; -3.491916944847164e-01   -6.687146347844908e-02   -2.305889407779545e-02   +6.671523413136908e-02   +5.539617214091556e-02   +7.055415047627175e-02   +4.048904705621009e-02   -1.469274238947217e-01];
L1E_L2E_iAMPA_netcon = [+1.506383264268470e-01   -7.438111503492370e-02   -1.204632806713549e-01   -8.199899664172590e-02   +3.410289008361869e-01   -1.165228405677738e-01   -3.853991211632895e-03   -2.992055357423653e-01   +2.695599264484564e-01   +1.479762101313401e-01   -9.196263978920420e-03   -1.907711724143784e-01   -7.290452289868207e-02   +2.086733101512993e-01   +2.029498000790353e-01   -5.731716634342039e-03; -1.691244154415291e-01   +1.934449967628938e-02   -1.869852728947539e-01   -1.264858832877599e-01   -2.024416426332737e-01   +2.793976415066266e-02   -3.676016158268820e-01   -1.328058636889997e-01   +1.191123747609631e-01   -9.731038712994804e-02   -2.193508502092406e-01   +3.826252901496601e-01   +1.681839621428787e-01   +1.475862878513032e-01   -5.802704613499488e-02   -3.400185258165827e-01; +7.473671698039924e-02   +1.922405267054039e-01   +1.988407694277678e-01   +1.503595647112467e-01   -3.397450920765004e-01   -1.239899975796557e-01   +3.404321815520667e-05   +1.003417750920973e-01   +2.839604542295361e-01   +1.738497934939835e-01   +4.166799964546695e-01   +2.850440679783299e-01   +1.056663531286134e-01   -5.297548468887169e-02   -3.049032855258248e-01   -5.755682251914844e-02; +5.859939946830257e-02   +1.959608620978986e-01   -2.127600551363429e-01   -2.626182148694405e-01   +1.817394278184814e-01   -1.741908215232238e-01   +1.723723058148618e-01   -2.426577771817881e-01   +1.521837999988144e-01   +1.541326892586071e-02   -2.920610332640859e-02   -2.772812608181668e-02   +6.925988053550151e-02   +1.430135426944585e-01   +3.711946746870438e-02   +8.632512043123657e-02; +1.526941573296861e-02   -5.488197737318216e-02   -2.756565371490894e-01   +5.480844866808818e-02   +4.297017332646815e-02   +2.000248760257998e-03   -1.348789950936662e-01   +6.428868824671645e-02   -4.964269596303869e-02   +6.270687966004115e-02   -3.026695748912676e-02   +1.499711977052146e-01   +2.596715111011670e-01   -1.641390541581278e-01   +8.864413041661022e-03   +1.637203615784795e-01; +2.091033127754054e-01   -6.893664259721163e-02   -9.599209811108227e-02   +8.788247032868754e-02   -3.114560845323257e-01   +9.001438500823242e-02   +2.107151908833111e-02   +9.767514228929831e-02   +1.187201811965663e-02   -1.943159090057098e-01   -1.176418053319057e-02   +1.931214121599169e-01   -2.245817351116381e-03   -2.963453448640419e-01   +4.138332182770764e-02   +1.215327141792248e-01; +2.261197680351519e-01   +3.579479763131665e-01   +1.435819732002313e-01   -2.514410354105053e-01   +1.771589028203013e-01   -1.526857709643445e-01   -1.867391261824414e-01   -1.128458646231075e-01   +2.217999171882338e-01   -3.256979494327833e-02   +1.514176498570307e-02   +1.304675056853590e-01   +2.810155231814910e-01   +1.294260567336488e-01   -3.127505247171829e-02   +3.940951685074176e-03; +9.104306868367479e-02   +2.146146872780427e-01   -9.698331596441781e-02   +8.701964462635894e-02   +1.328194598104387e-01   -1.472921233209159e-01   -1.700039447651986e-02   +1.380431646036179e-01   -4.943684998436786e-02   -7.238615548097532e-02   +1.945538716669252e-01   -3.389565129501300e-02   +2.992905601418043e-01   +1.920005494103840e-01   -2.829244939303798e-01   +7.066466046521871e-02];
L2I_L2E_iAMPA_netcon = [+1.800375465983725e-01   -5.299614220632083e-02   +2.496690522907689e-01   +3.084791523241247e-01   +1.077454539238616e-01   -2.536566897308127e-01   +1.630211701627152e-01   +1.217165641782861e-01; -1.273013094574224e-02   +2.244312316827059e-01   -2.551621446750804e-01   -1.177384345444361e-01   +2.691614265275971e-02   +2.023234274668152e-01   -3.124332562170560e-02   -2.039235676440523e-01; -1.719623868393778e-01   +3.900720530076808e-01   +2.119662844558409e-01   +6.741891246781710e-02   -1.446995699245383e-01   +2.381336315645369e-01   +2.076924352518466e-01   -1.421626835350130e-01; +3.100412475211562e-01   -2.926485034985817e-01   -4.326146009209135e-01   -8.549537220950058e-02   -8.256446860645088e-02   -7.711752803121022e-02   +2.593551237430096e-01   -1.907503918971196e-01; -6.521412358853790e-02   -2.878980454628361e-01   +6.994259994555027e-02   -7.598092724520623e-02   -3.332153097196673e-01   -2.147442388644090e-01   +1.907252913692832e-01   +3.706448991948726e-01; -2.410753356499940e-01   +1.212331579183975e-01   -8.188840967078263e-02   -7.503644287599420e-02   +8.264182912804589e-02   -1.168246177603421e-01   +1.109669288023520e-01   -1.890059357543896e-02; -1.459202709535305e-01   -2.443365287475867e-01   +1.085142706187275e-01   -3.351367930098484e-02   +7.000301436433565e-02   +1.756204197358533e-02   -2.067947678552916e-02   +7.492131139525757e-02; -2.719783598742917e-01   +3.041687225486692e-02   -1.402028224773101e-01   +1.829239518639149e-01   +1.691127335526412e-01   -2.879513478698811e-01   -4.348210493081822e-01   +3.281635645158898e-01];
L2E_L2I_iGABA_netcon = [+1.016065718328334e-01   +3.074968587549786e-01   +1.630086075276491e-01   -1.443359873164952e-01   -1.223085135799534e-01   -2.026839470380685e-02   -1.712169635193755e-01   -2.305544105574363e-01; +9.248292922952035e-02   -1.513250096264022e-01   +2.094292819747322e-02   -2.407019946132520e-01   +4.773832661538423e-02   -2.359687011717843e-01   +1.134192131062343e-01   +2.906057609987062e-01; +1.313185513004231e-01   +2.915576737764295e-01   -1.158475510822426e-01   +1.813481298125575e-01   -1.387244591993513e-03   -1.214944550947114e-01   +8.689487548722359e-02   -5.789105944167636e-02; -2.773198389278102e-02   +1.777252430443807e-01   +2.138832311886772e-01   +1.090828948661001e-01   +6.670713176726333e-02   -2.290246865548701e-01   +6.283285688649919e-02   +7.330998519276087e-02; -1.724999984992741e-01   -2.280683922083909e-01   -1.189278700093748e-01   -1.516223207131605e-01   +3.256009135041290e-01   +2.426387411094155e-01   +2.053013291243373e-01   -1.878844512731078e-01; -2.396657492260270e-01   +2.124269129455001e-01   +1.271609267984912e-01   -1.670971174921677e-01   -2.329240819894001e-01   -2.184947687851908e-02   +2.579654640540220e-02   -9.009189278447741e-02; +7.297970490412219e-02   +7.423365914056748e-03   -1.578000791886731e-01   -1.475525892026577e-01   +6.418989659814031e-02   -1.103104770837422e-01   +6.116765833708197e-02   -1.324588680273318e-01; -2.199735594698559e-01   +2.223853056445543e-01   +1.522467228736130e-01   -5.983629022856164e-02   +2.164743247389486e-02   -3.484233489180936e-01   -4.520604392340424e-02   -1.763799667591953e-01];
L3E_L2E_iAMPA_netcon = [-3.045059748027761e-01   -7.208141189853121e-02   -1.517587477531433e-01   -6.538502068171141e-02   +9.271213817263491e-02   +2.143748954879452e-01   +2.844256380441973e-01   -5.868475707452451e-02   -6.329685524641818e-03   +7.821664917937782e-02   +2.374529787077052e-02   +3.900755871873248e-03; +2.176256610854508e-01   +2.963168124699549e-01   +1.043303210241746e-01   +2.937950494636424e-01   -2.969674731732516e-01   +4.272359388871835e-02   -1.606494256667770e-01   -1.278659890592990e-01   -2.258619059169537e-01   -4.225976074514030e-02   +6.033993161930815e-02   -1.084366498109097e-01; +1.063795133771133e-01   +1.800567250325219e-01   +2.949323961336878e-01   +4.384332237806438e-02   +5.070663951049578e-02   +1.275758927587552e-02   +5.274276883627464e-02   -8.931880652778584e-02   -2.216531708383204e-01   -1.193858443752322e-02   -1.075002985690073e-03   -1.333284757834909e-01; +1.491528473801262e-01   -9.612425256028054e-02   -1.748515748243352e-01   -6.653508369120482e-02   -1.044127859351641e-01   +4.259726854795638e-01   -1.861981389490193e-01   +3.061329687388350e-01   +1.918256356600409e-01   -1.687124108528122e-01   +1.560777337714860e-01   -4.534377562586672e-02; +5.022070088331623e-03   +8.472064748129637e-02   -1.825407395354709e-01   +2.873364421725455e-01   +1.792361359767525e-01   +1.164530127541099e-01   -3.815435942614354e-01   -1.231211681645410e-01   +2.544773018743937e-02   -3.938309260020004e-02   +5.979194331484999e-02   -3.027847338005345e-02; -2.827728256684992e-01   +2.071041662125626e-01   +1.546766582527936e-01   +3.473182266750842e-01   +2.839641629695081e-01   +1.991170148535926e-01   -1.043141497702648e-02   -2.790140022137747e-01   -2.228687224659577e-01   +9.294005450279165e-02   -1.519711568509348e-01   -9.550741297295338e-02; -8.909816236912886e-03   -7.499688916567405e-02   +1.549031859593014e-01   +2.456490074903944e-02   +1.337627896965016e-01   +2.777957382637450e-01   +9.033253066574175e-02   -1.156965015941233e-01   +1.152195947180709e-01   -4.393960411970006e-02   -9.256436208206273e-02   -1.472469959474446e-02; -2.172345003976126e-01   -5.494080790176140e-02   -2.654242111384530e-01   +1.690009733122900e-01   +1.949025921504335e-01   +1.535030778387556e-01   +9.725948739837714e-02   -9.820802216770001e-03   +1.356138092825109e-01   -2.240701862266011e-01   +2.753996344991163e-01   -2.952143404706519e-01];
L3I_L2I_iGABA_netcon = [+1.712796810497986e-01   +4.334276897251870e-01   -8.401879111660804e-02   -4.036755028746408e-02   +1.067944958784309e-01   -3.541532663747399e-01   -7.050909234002170e-02   -1.116211162127136e-01   +7.694899428200688e-02   +7.490842996010426e-02   +1.524917712789040e-01   +1.110618041271509e-01; +1.508108853702791e-01   -1.135388137855197e-01   -4.431761047709998e-01   +1.505532435683192e-01   +3.464438081715124e-01   -3.630694892557340e-02   +3.494177274412386e-02   -2.305140477566171e-01   +5.005848114801570e-02   -3.106510186020159e-01   +1.816944376298286e-01   -1.087214226472508e-02; -2.161375819784616e-01   -6.478569415580798e-02   -7.373323088023806e-02   +2.826449239672946e-01   -1.004206422196971e-01   -1.551033798446691e-01   +5.662881479206409e-02   -3.378323544871552e-01   -1.630739731795574e-01   -1.358454518940650e-01   +3.810688259240836e-01   +2.278129926174901e-01; -2.123189721042402e-01   -2.381853305053448e-01   +1.864945830834675e-01   -1.425414320320355e-02   -2.102161235171349e-01   -1.581745065659864e-01   +3.430696966802228e-01   +9.900849898509903e-02   +5.289617958528091e-02   +7.985155081477492e-02   -7.025308076516217e-02   -1.402189995083058e-01; -7.013994128320994e-02   +4.018736307597177e-02   -1.056348123699847e-01   -9.331352632971936e-02   +5.930790293236355e-02   +2.898583470235491e-01   -2.897174260756757e-01   +2.183994206435887e-05   -3.175088448395340e-01   +2.869891314793853e-02   +3.066353894694158e-01   +2.426679339331964e-01; -1.163692725694896e-01   +1.392849565897830e-01   +1.004938949976150e-01   +3.614094128708186e-01   -1.856493124973329e-01   -1.318339288503520e-01   -2.488217750573038e-01   +2.489801015616191e-01   -1.214533662357416e-01   -4.137748463487353e-02   -2.649264627009698e-02   +1.177772960805627e-01; +1.757567900442307e-01   +1.134518446413128e-02   -3.125415127033730e-02   -1.670674656419576e-02   -1.555524677746608e-01   -1.626548010797505e-02   -1.215363935957195e-02   -1.633851500739915e-01   +9.925083471617914e-02   -4.788124052171276e-01   -6.567249781895315e-02   -1.606221518755857e-01; +4.649306337634135e-02   +5.546342379094740e-02   -1.278965737615649e-02   -3.704278462554253e-02   +2.903874085372923e-01   +1.261086371077805e-01   -1.271877026842131e-01   +2.128949089782888e-02   -4.012159223836801e-01   -2.956209692615102e-01   -5.495105768570419e-02   -1.651111351024838e-01];
L2E_L3E_iAMPA_netcon = [-2.859591736166102e-01   +1.718745992998423e-01   -1.338770858943367e-01   +1.060772588422705e-01   -1.180425330340668e-01   +5.450032388383104e-02   +2.599940175402377e-01   -3.957734285472772e-01; -1.070058947441630e-02   -1.947879232389744e-01   -4.876303933585027e-02   +4.199860693487946e-02   +5.676022823660001e-02   +9.363273584957885e-02   -3.994090859391787e-01   +8.744997835886897e-02; +1.510126371012108e-02   +1.153412370898589e-02   -1.621655454239317e-01   +2.163878044055021e-01   +1.884632261963922e-01   -1.873966829699539e-01   +3.020904185324476e-02   +2.174826005935019e-02; +2.144608751244220e-01   +2.010509576084022e-01   -1.999783156532587e-01   -7.978840591279024e-02   -1.695323596025596e-01   -2.310942583494250e-01   +9.384779150521792e-02   -2.568462649415555e-03; +1.751526350227252e-01   -3.645105044417281e-02   +3.726148657473600e-01   +2.680708138536562e-01   +5.272948123485881e-03   +8.893480958963193e-02   +2.905974766456635e-01   +1.766605946738124e-01; -9.520407069632657e-02   +8.848672012318383e-02   +2.069193153468264e-01   +1.598739742614471e-01   -5.460782408611588e-02   -2.421881795073778e-01   -7.788323472873378e-02   +2.969523630802076e-02; +2.694570785370658e-02   +1.151829090789732e-01   +1.780333210819590e-02   +5.869376710655919e-02   -4.442421419785603e-01   +1.598487938668394e-01   -1.514174667697972e-01   -4.147753842297627e-02; -1.818608396420169e-01   +1.993492043258565e-01   -1.252740406814717e-01   -1.021308670443006e-01   +2.625304670849802e-01   +5.648266968884201e-03   -1.439155745121576e-01   -3.133745462423539e-02; -1.698445235362289e-01   -1.250477679746443e-01   -2.424291526171708e-02   +4.891678307943166e-01   +7.318118070272502e-02   +2.062914629849223e-01   -8.699107503068074e-02   +7.528408600050496e-02; -2.078570936540335e-01   +1.196197516178254e-01   -7.969644688364867e-03   -1.186370937284176e-01   +2.472898311214161e-02   -2.823623656099984e-04   +1.093900779015036e-01   +1.128533802273011e-01; -1.286453533768242e-02   -1.980886722072991e-01   +1.316863082201586e-01   -3.962727894537599e-02   +1.478718802608922e-01   -1.612177833695855e-01   +5.662500399782004e-02   +1.790599564247062e-01; +2.359166758088100e-02   -2.056718770298069e-01   -1.144977446309797e-01   +2.223500245212230e-01   +3.618482841108336e-02   +7.374845105178468e-02   +1.479656962006547e-01   -1.482428481510572e-01];
L2I_L3I_iGABA_netcon = [-7.515372600677368e-02   +2.012590691091931e-01   +8.882585400902637e-02   -2.529300341959508e-01   -1.031800811446548e-01   -1.127657234638060e-01   +4.329535726738165e-02   +9.973683016339656e-02; +6.402662491185800e-02   +2.731489744300870e-02   -1.488771161623460e-01   -2.422270635056324e-01   +3.172313139441389e-02   -3.419968787642799e-02   +3.696364374273550e-02   +6.466072334878964e-02; -4.051021876287476e-02   -2.735812543989584e-01   +3.413659751140560e-01   -1.640680934274838e-01   +4.341263775943135e-01   -3.042829970850529e-03   -4.802222697507139e-01   +2.134724537176586e-03; -6.445707183956051e-02   +1.250858365796032e-01   -2.498287882045386e-01   -5.734117084783714e-02   -5.342553898948218e-03   -1.899650278934843e-02   +1.383487380038770e-01   -2.489206410242128e-02; -2.767578995373491e-01   -2.004638726083455e-01   -1.259501676131400e-01   +7.669188262341489e-02   -2.301334138580180e-01   +1.619029267521552e-01   +1.287807712785111e-01   +3.552099302176636e-01; +2.571568081277502e-01   +3.587892793955825e-01   +1.073098976436555e-03   +1.183941610720506e-01   -5.289886496106194e-02   +7.894474146380360e-03   -6.404635213634637e-03   +1.666227541595205e-01; -1.873467566197184e-01   -2.724737880908296e-02   +5.144709472357810e-02   -2.518528919392077e-02   -1.698659944570870e-02   -7.895205951613893e-02   -3.066941953965227e-01   +1.123132704961019e-01; +4.963120212102981e-02   +3.668351781190875e-01   -3.171400828012993e-02   +1.142430165948842e-01   -1.890502930603334e-01   -2.540812382156300e-02   +9.527215109123217e-02   -1.090408892918415e-01; +3.661907420079316e-02   -1.079452064885091e-01   -2.524024177967646e-01   -1.560370326132326e-01   +1.870062922420073e-01   +1.024999117976475e-01   -1.097381836979625e-01   -5.970516161103150e-02; +2.450565761411532e-01   -1.103971840584005e-01   +4.239091863228499e-01   -2.175850292529247e-01   +4.796442763640302e-02   +2.302674760689714e-01   +2.313187174838508e-01   +3.039171661271624e-01; -2.902882316277562e-03   +1.512060418027664e-02   -3.412482085001441e-01   +8.125696054916354e-02   -2.093962091470220e-01   -1.849704951047647e-01   -2.492572963399872e-01   -4.960902549117968e-02; -1.844634053379603e-01   -3.099942441559843e-02   -2.638142463159489e-02   -2.340367179941064e-01   +3.654690473950728e-01   -1.498805187282290e-01   -1.753545403784817e-01   +1.830818756128400e-01];
L3I_L3E_iAMPA_netcon = [+1.976541493367463e-01   -1.035718743228688e-01   +2.555669815151931e-02   +1.934427923771301e-01   -2.007748289869821e-01   +4.106912932115955e-02   -1.230831195056343e-01   -2.486660185201679e-03   +6.000309751017474e-03   -6.642912271197648e-04   -2.280588200594282e-01   -2.346751142328605e-01; +1.871005004017272e-01   -2.570912273008984e-01   +1.822236748453830e-01   -2.749901719934302e-01   +1.377212624530339e-01   -1.214284141547897e-01   +3.013773057928433e-01   -2.326574382926241e-01   +2.256857945125510e-01   -7.614676501776101e-02   -1.073204989515599e-01   -2.239643007540490e-01; +1.993613082469568e-01   -2.105840464935921e-01   -2.462083746747313e-01   +4.471739581706135e-01   -2.441160218297398e-02   +8.255743626151010e-02   +1.546888362531605e-01   -1.020002530784153e-01   +8.702220367470906e-02   -1.982434805221526e-02   +1.036676814859217e-01   +2.251735699529602e-01; +3.361887501401240e-01   -2.684039161992289e-01   +1.148414157484708e-01   +1.044368072032298e-01   -5.184559591504217e-03   -1.413512565219527e-01   +1.311630273499699e-01   +4.666337678936487e-02   +4.340387592082053e-02   -1.319525316283300e-01   -6.400360993963322e-02   -1.712271039285010e-01; -1.748102794804600e-01   +1.681800072870672e-01   -4.069455473496582e-02   -1.377088700144042e-01   +1.447849936581423e-01   -3.023701594742480e-02   -3.800522135828453e-01   -5.437838845479587e-02   -1.489325730747382e-01   -8.100813870103139e-02   -1.888088805321723e-01   +1.115622522867709e-01; +3.461078302920707e-02   +2.585181851702153e-02   -6.918984708688720e-02   -1.694167491820637e-01   -1.776134435606248e-01   -7.240569469720916e-02   -2.072061154930854e-01   +8.517487573290963e-02   +3.105179240142017e-02   +1.383152888693226e-01   +4.046684713870072e-03   +2.058488252438834e-02; -1.662873134606027e-01   +1.620040343955184e-01   -7.880455982589539e-03   -9.295250222568899e-02   +4.754283896711924e-01   -1.770945892897621e-01   +1.374039770961061e-01   -2.051795219463990e-01   -1.051035630299837e-01   -1.485505505254762e-01   +1.805372982337075e-01   -2.345073322954175e-01; -2.694951855415919e-01   -1.589199613169610e-01   +1.811035595181860e-01   +1.860235122385722e-01   +6.518344736886314e-02   -1.249638013064297e-04   -1.363004802430527e-01   +9.858639833172061e-02   -3.004634829772069e-01   +6.546039484019793e-02   +7.000332384571328e-02   +1.300310076461283e-02; +7.245424682100370e-02   +3.570854807607405e-01   -2.947714240020832e-02   -4.320469388031867e-03   +1.670431910702305e-01   +7.353891762869042e-03   -7.397995473181256e-02   -5.039271368416220e-02   +1.064327720955182e-01   -6.214386884775662e-02   +8.084991383041334e-02   +4.521662995947450e-03; +1.030248240068443e-01   +1.265158295623673e-01   +1.913789538728428e-01   -6.300455941857158e-02   -2.390621063810581e-01   +2.291721402848404e-01   -6.122633102578640e-02   +2.523716928018237e-01   +2.253204745549199e-01   -6.365167518073123e-02   -4.749866473013092e-02   -2.803462494488593e-01; +3.256718571609882e-02   -2.392457468942405e-01   +1.061055144969528e-01   +1.218762485085028e-01   -5.043212963265117e-02   +1.593720769849071e-01   -2.240920101472586e-01   +3.548321655156890e-01   +1.983331222307493e-03   +1.608659764369460e-01   +1.919849776172366e-01   +1.665706124430079e-01; +1.335916583488221e-01   -2.413568487411002e-01   -2.510808715458099e-01   -1.665217362671444e-01   -1.972692457778245e-01   +5.785434390909825e-02   +5.499018132436106e-02   -3.646887518171147e-02   +8.374516921185200e-02   -1.852281859702256e-01   -9.888175672286835e-02   -2.469979778489549e-01];
L3E_L3I_iGABA_netcon = [-7.935949966668571e-02   +3.379960535694255e-01   -1.058454181241204e-01   -8.918553390059195e-02   +2.047243254583615e-01   +1.589956534551306e-01   +1.619135826146851e-01   -4.547259908661155e-02   -1.753799727143796e-01   -1.969288607396339e-01   -1.018537302382204e-01   +1.573093777626535e-01; +1.420614416904924e-01   +2.208787922310926e-01   +3.725027663351181e-03   +2.931312312653690e-01   -3.121097112061076e-01   +1.106977969030488e-02   +7.320429210246907e-02   +6.427690385432472e-02   +1.033076931046259e-01   -3.166215846207469e-01   +2.368159652968670e-01   -4.364575925765846e-02; -2.259447826855927e-02   +3.530738806688748e-02   +2.239140527143465e-01   +4.791100192780660e-02   +3.079324902085175e-03   +1.679248291192555e-02   +1.941471881300419e-01   +5.816907538005133e-02   +1.355856866440917e-01   +1.727914232826892e-01   +6.734053269363417e-02   +6.631893353333189e-02; +3.320889278730713e-01   +8.480111413690300e-02   +8.529014094854989e-02   -1.762679315741253e-01   -2.771176743241861e-03   -1.248731584166800e-01   -3.456177181961553e-02   +1.381233643667013e-01   -1.309711150747314e-01   +2.517934466008713e-01   +3.249435942555878e-02   -1.464333751767051e-01; +1.077680127981282e-01   -7.745666047889429e-03   -1.378768384054312e-01   +3.492412551137201e-02   -4.514290337400466e-02   -2.397718249410190e-01   -6.511903216327201e-02   +3.631907720193953e-02   +9.395870580094831e-02   -2.714018110143509e-01   -2.132712428756684e-01   -1.823604857374576e-01; -4.126839191755480e-01   +1.185877704523011e-01   +6.945845434548764e-03   -8.719627262769380e-02   +3.687944090453287e-01   +3.261035057307396e-02   +1.621496050111549e-01   -1.040912360432075e-01   +3.977486339725699e-01   -2.406523577063049e-01   +2.063225783647796e-01   -6.525266749298782e-02; -3.838740601333975e-02   +1.182180595800453e-01   -1.138124284378030e-01   +1.685902626053745e-01   +1.498779269490451e-02   -3.903308142680930e-01   +3.939374621408092e-02   +1.658427979241264e-01   -1.540065653299415e-02   +2.799000713591449e-02   +6.036390159545600e-02   +8.859505959218344e-02; +3.656160599445788e-02   -3.843609134625526e-01   +1.251131301225263e-01   +2.535404275466384e-02   -4.405523020706740e-02   +5.979668272868771e-02   +2.346670669995636e-01   +5.538847730006775e-02   -2.901738098821185e-01   +1.291711844403723e-01   -2.358732459933838e-01   +1.251108593067268e-02; -3.957264208907625e-02   -5.148043968916831e-02   +1.767219433143314e-01   +4.119099809575671e-04   -1.509284599796877e-01   -7.133537953838773e-02   -2.029605828087748e-01   -6.594193110420851e-03   -2.870560381027230e-01   +9.684644054635075e-02   -1.398885264937673e-01   +7.851719914085972e-02; -3.167139176122062e-01   +3.740769363648636e-01   -1.822386104957148e-01   -7.964630121486924e-02   -9.163978395103316e-02   +2.054496103061313e-01   -3.780482641651482e-01   -2.920291805315211e-01   -3.682772594841850e-01   -1.092947197060129e-03   -4.953468788846312e-02   +2.256083592310121e-01; +2.776456109112404e-01   +6.422719506814673e-02   +1.084061507837710e-02   -3.013046826249755e-01   -3.259008306843549e-02   -1.444820703666674e-02   -9.354678926000404e-02   -1.583670123141408e-01   -5.227098429620288e-02   -5.063489684593734e-02   +1.810168524308485e-01   -9.521817619256275e-02; -4.752791254385342e-02   -1.995607218005727e-01   -6.796652985056467e-02   +8.761052454984235e-02   +2.218359357014243e-01   -1.937285349603026e-01   +9.438290915964880e-02   +3.486417239605302e-01   +1.064393151126844e-01   -8.990115353515910e-02   +2.177146886410489e-01   -9.587185055892658e-02];
L2E_Input1_iAMPA_netcon = [-1.456129971062445e-01   +3.294598788072643e-01   +2.016727633766625e-01   -2.459595326995697e-01   +1.367243457420227e-02   +2.302212306453700e-01   +4.866079666186326e-02   +2.425476472675165e-01];
L2I_Input2_iAMPA_netcon = [+2.349169088649132e-01   -2.256941739639604e-01   -1.036213137664407e-02   -3.770762449094014e-02   +6.633578452804896e-02   +5.377388437702346e-02   -8.955453604712596e-02   +3.676107753117386e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
