function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.015415113391550e-01   -4.659013426632306e-01   +1.614338157542433e-01   +3.003552386881241e-01   -1.303609674707129e-01   +1.405207032166901e-01   -3.070659616169437e-01   -1.480524569299425e-01   +5.652180751364702e-01   +5.833580528008477e-01   +1.474748183375056e-01   -1.355297659133208e-01   +5.691581916891082e-01   -6.048961372872515e-02   -3.837383529193232e-01   +5.452350255803094e-02; +4.175038037590600e-01   +2.551734329866538e-01   +2.268635506169356e-01   +1.988768473409783e-02   +2.947902634335404e-01   +4.660741760547755e-01   -4.443527499809168e-01   -1.162374719136391e-01   +2.799941637345855e-01   +2.915055992142830e-02   +3.192256091971587e-01   +2.745076202524883e-01   +4.919701111472812e-01   +2.206072574583588e-01   +9.222220998009020e-02   -1.523327430924222e-01; +2.769497879785570e-01   +1.760561012526037e-01   +4.392283426185930e-02   +2.118571711261622e-01   -2.803008597044310e-01   +3.090027567329293e-01   +5.799151012843741e-01   -2.187841461858078e-01   +4.568325664130615e-01   +2.825087283803372e-01   +5.891818636397796e-01   -1.727292108426439e-02   -1.397016728292300e-01   -4.583954580599558e-01   -1.392043163755027e-01   +2.819458119352801e-01; +1.342286067744909e-01   -2.015226414674759e-01   +3.860661776087768e-02   +4.560018279256481e-01   +2.693156963558694e-02   +5.491518206516525e-01   +6.475547482251645e-01   +7.916066399132297e-01   +2.615195636139505e-01   -2.398929016607365e-01   +4.843371181604969e-01   +2.689704735460144e-01   -7.614278877170216e-02   +5.547504585766535e-01   +1.936439017885643e-01   +8.532381289850262e-01; +5.242085076193772e-02   +1.281222724198386e-01   +6.310775757537364e-01   +4.752029919700891e-01   +6.849590883499219e-02   +1.253317823846651e-01   +8.597045558753853e-02   -2.190613272771760e-02   -2.040752886338645e-02   +7.013101334280317e-01   +7.544779292897884e-01   -1.251383441514609e-01   +4.015471035376103e-01   +3.130850463159167e-02   +2.363612258108368e-01   -6.319467454116008e-02; -3.344517002159728e-01   +9.780790464501192e-01   +4.572654156051404e-01   -1.077660271217499e-01   +2.547372776018032e-01   +2.821437027709502e-01   +5.313839011256221e-01   -1.706000814874057e-02   +1.730226758752615e-01   +1.225298410488866e-02   +2.408365061510100e-01   -2.797983972130441e-01   +3.004272467157831e-01   +1.734085306010793e-01   -2.331054836313166e-02   -4.106750859353052e-01; +2.731186267178153e-01   +3.167406289387841e-01   +5.922652159125813e-01   +5.523443027897151e-01   -4.220376883041256e-01   +2.535485791842002e-01   +1.973729613222220e-01   +2.467975145602929e-01   -6.692230355213022e-01   +2.527583059777408e-01   -1.186439765782616e-01   +6.121216778147080e-02   +4.720292767252433e-01   -3.209068187029939e-02   +4.509840758059442e-01   +7.411920009532019e-01; +2.005878835321689e-01   +5.927294971576330e-01   -8.647864590778634e-02   +1.969532799908812e-01   +1.952662851501749e-01   -2.055347797397110e-01   +4.454356614969904e-01   +3.053270664713075e-01   +2.475379069401084e-01   +5.874585559757575e-02   +3.303861878410476e-01   +1.477513898708787e-01   -5.549857410626538e-02   +5.010637602778213e-02   -2.825319100943648e-01   +1.639260218984562e-01; +3.378149696971661e-01   +9.251812700417763e-01   -1.019846940155742e-01   -9.119045531669118e-02   +2.679099392857286e-01   +6.018233394942756e-01   -9.357378011361078e-02   -1.585165242864689e-01   +2.469173400370287e-01   +7.918253260730963e-02   +2.845747067779908e-01   -6.809066076576584e-02   +1.286370344202991e-01   +3.712634631238321e-01   -2.270530404815891e-01   -1.605486072964000e-01; +3.356103483359383e-01   +5.419199497331664e-01   +2.743507672558572e-02   +3.124966601687518e-01   -2.493534337324244e-01   +1.673063074447936e-01   +4.726221054233677e-01   +5.666725806020619e-03   +2.085912161245149e-01   +3.406946917460858e-02   +9.657841290261489e-01   +1.121045371890334e-01   +3.618476021186686e-01   +3.038339236674578e-01   +1.397224944018425e-01   +2.684170633202443e-01; +2.980514770938503e-01   +9.404659830035073e-01   +1.424620068719358e-01   +1.381687815269684e-01   +3.751965364300266e-01   -4.259158442533477e-02   -3.211447984341615e-01   -6.687886709114912e-02   +1.607240127319678e-01   +5.511518333041528e-01   +1.964306252059123e-02   +1.886457001017817e-01   -8.457105920533723e-01   -1.127859847361391e-01   +1.942115811734138e-01   -8.794798313554565e-02; +5.282743716146121e-01   +3.297906578762995e-01   +2.287079209012771e-01   -5.895372034641794e-02   -9.931295603961020e-03   +1.428078550210799e-01   +2.357990607416929e-01   +1.257733838743145e-01   +6.923271832623149e-01   -3.840561753290168e-01   +3.782669887928131e-01   +6.525169363662560e-01   +6.748253145408503e-01   -8.466871104840665e-02   -4.040206820126362e-01   -1.121110036612953e-01; -2.617883264232921e-01   +2.376302959722389e-01   +3.311305420053330e-01   +4.890709024246257e-01   +8.795718801823276e-01   +6.215565999684718e-01   -2.370998819301551e-01   -4.795716194338866e-02   +3.637129465743129e-01   +6.563022332421051e-01   +3.521394777908067e-01   +1.951895103183571e-01   -4.755582378596929e-01   -7.294603227151361e-02   +2.303116994195459e-01   +6.839468666035928e-02; -4.597784798047579e-01   +6.422336636089717e-01   +2.433059370943887e-01   -3.207458940586944e-01   +2.223398184708263e-01   +3.699289323828239e-01   -1.352789871573022e-01   +2.828386330186907e-01   -3.904467670674192e-01   +8.890355645632932e-02   +6.809213774692014e-01   -1.428564891763860e-01   -1.311426212862403e-01   +5.911307755401888e-01   -3.799809992082572e-01   -3.020044927666086e-01; +2.617120176309446e-01   -2.227385312884031e-01   +5.083820534274509e-01   +3.422787183757967e-01   -1.706135112039042e-01   +1.522087907883300e-01   +2.888216192994660e-01   +2.294344498098661e-02   +1.223990168264286e-01   -1.350034567645924e-01   +1.413165109350531e-01   -1.184241227442047e-01   +6.617029215841239e-01   +5.622014319855018e-02   +2.200496257325989e-01   -3.030659506184390e-02; -7.533930721206291e-01   +1.646832979310844e-01   -3.246726229656491e-01   +2.910218742806243e-01   +9.138538288182868e-01   +4.667319699698444e-01   -3.223257830414980e-04   +7.152484395442698e-01   -1.237388256022867e-01   +2.249368939902402e-01   +3.907107674461212e-01   +2.834784781076309e-01   -2.531210127037984e-02   +3.138984731459826e-01   +6.680973262229249e-02   +3.099775059568744e-01];
L1E_L1I_iGABA_netcon = [+2.285961437421735e-01   +7.531543031053964e-01   -5.718725925638147e-01   -3.168486861577412e-01   +5.043734505282903e-01   +2.962672025800529e-01   +5.513255164587455e-01   +4.152067109013292e-01   -3.335274837620105e-01   -1.837246619668734e-01   -2.373617113956493e-01   +4.768051495123673e-01   +7.769244048067347e-01   -2.908739300020779e-01   +6.337894802503133e-01   +8.751468225138108e-01; -2.013993815193795e-01   -2.061220755814102e-01   +9.489562829673451e-01   -2.974463582158013e-01   +4.779177147080771e-01   -5.638870497127589e-01   +4.774389234438784e-01   +5.450318337148793e-01   +1.265607615302833e-01   +9.229252572999340e-02   +3.081243621623481e-01   -8.042452481955741e-02   +5.119686340594558e-01   +4.483521418877732e-01   +5.640644475446495e-01   +7.034267264866141e-02; -5.137680790001287e-02   +2.957966688759217e-01   -3.467031167383460e-01   +5.785946884312063e-01   -2.779751583659279e-01   -1.197906490659036e-01   -7.701746334886735e-03   -1.810622988729489e-01   -5.199891970040717e-02   +3.024318577040497e-01   -4.011790068349015e-02   +5.715080311386127e-01   +1.314964876630569e-01   -5.005007206284436e-01   +6.652041583081093e-01   -7.619783792888077e-02; +1.678428507249054e-01   -2.537499489243197e-01   -5.526332341321211e-01   +6.183437436485081e-02   -3.649808982729609e-02   +2.792940280253470e-01   +9.538060620684101e-02   -1.034841410989256e-01   +8.260167588209244e-03   +3.273802325934208e-01   +4.165129866185186e-01   +3.138494004716544e-01   +8.602489281446156e-03   +5.324544791307805e-01   +2.692150762587598e-01   -5.847447457619246e-02; +1.229756320261709e-01   +3.456784654861150e-01   +5.413909141520660e-01   -6.948906427307640e-02   +5.412411990173746e-01   -7.136554801395582e-02   -5.387341994270370e-02   -2.286314703499773e-01   +5.290773924103723e-02   +4.604875906627094e-01   -8.368186683619346e-02   +6.934639932870729e-01   +8.170929246432896e-01   +6.642611432492026e-01   -2.030325715386626e-01   +1.429799347507044e-01; +2.593932244222877e-01   +3.763816998946786e-02   +7.871424088469064e-02   -5.314811841495964e-01   -2.011326972706828e-01   +7.111535973806623e-01   -6.942847469844059e-02   -2.692208071254015e-01   +4.797642560248648e-02   -4.371870524152472e-02   -3.243439533975164e-01   +7.582336727437764e-01   +1.531866367615382e-01   -2.510924807077901e-01   +2.922226946928033e-01   -3.442722223199005e-02; -5.496334928836648e-01   -2.486562243273157e-01   -3.459282739469832e-01   -5.205679188012537e-01   +4.919349908490211e-01   -1.018779491877556e-01   -1.416533073955972e-01   -3.628888896156988e-01   +4.867908167342635e-01   +5.167116803823483e-01   +8.194808012329188e-01   +2.231796211960544e-02   -9.451978531407296e-02   +4.255361932959252e-01   +7.394682987907738e-01   +4.129413994700414e-02; +1.611526200228206e-01   +4.133614442951268e-01   -5.186031585653726e-02   +1.355685690770093e-01   +2.926517403680374e-01   -2.531372180723997e-01   +8.683227856655611e-01   +1.346552864703255e-01   +6.375532409741741e-01   +4.582369526236154e-01   -9.717101731964408e-03   -2.284295893089284e-01   +8.677203567112710e-01   +4.594637366236515e-01   +2.933094400488661e-01   +6.548557944332960e-01; +3.787371941877650e-01   +8.353909639163598e-01   +1.685012975853604e-01   -4.465458483188824e-02   -4.427245124716712e-01   +5.438759019139073e-01   +2.140472733746692e-01   +1.519951747020542e-02   +3.203170123504591e-01   -4.138651393076739e-01   +6.286655256130839e-02   -2.839758460689049e-01   -3.018126015023903e-01   +1.083286068636189e-01   +7.582915480783915e-01   -2.529783321384155e-01; +1.743926370442330e-01   +7.442391129592787e-01   +1.014377068599079e-01   -3.417579461286464e-01   -3.239913024730037e-02   -5.482956427861993e-03   -3.821506006365538e-01   -8.238563345235875e-02   +5.240717226179359e-01   +9.580628755828771e-02   -3.680979199376437e-01   +1.490849850389577e-01   +6.038112792137494e-01   +4.938997972898268e-01   +1.769823136665615e-01   +1.417762502657218e-01; +1.120644847707313e-01   +1.823869371793416e-01   +3.612789549364160e-01   +8.281139985122232e-01   +3.386003994348397e-01   -1.623253032158209e-01   +2.136919027440345e-01   -3.554948104660176e-01   +5.154474587822301e-01   +3.444567349048296e-01   -2.769117073758201e-01   +5.444333634522520e-01   +6.612522109286969e-01   +2.549824418390935e-01   +2.049660429341401e-01   -5.935328521547821e-01; +2.763496615979376e-01   +9.860861616036272e-02   +2.633941585104495e-01   -5.315934473638461e-01   -1.276615211395946e-01   +2.694300994296881e-01   -2.774508182013001e-01   +1.173501072518130e-02   +1.857822359687450e-01   -2.868169723867425e-01   +3.508630819639919e-02   +3.934653350813795e-02   +3.726672243964955e-01   -3.538391153960114e-03   +4.709820827683530e-01   +2.485162372065644e-01; +4.077533793830185e-01   +4.017632120102183e-01   +5.249163395539919e-02   +2.631800355057405e-01   -2.382254797397872e-01   -8.475738949745673e-02   +2.275504297489521e-01   +1.419067384335013e-01   +2.715655748799478e-01   +4.784695281724147e-02   +3.454903815834573e-02   -1.490078115534822e-01   +4.552416470265921e-01   +3.233023861500643e-01   +1.500340857451584e-01   +9.036803090149391e-02; +3.730445325142615e-01   -4.663397448495210e-02   -2.332442867473506e-01   +2.474796350629156e-01   -5.448756073073692e-02   -1.924629344839235e-01   +8.392679472386103e-02   +4.127262877656412e-01   +3.981707461893135e-01   -3.014874785582247e-01   +8.074283402403759e-02   +3.397031460158640e-01   +2.260577931103490e-02   -1.312618427648655e-01   -2.968196206765843e-01   -8.128435056613921e-02; +7.691898701044156e-04   +2.491346706114396e-01   +1.609431218944127e-01   +1.058073077857170e-01   -1.561035644813876e-01   +5.183131114493583e-02   -7.660448151712088e-04   -6.423426813257907e-02   +7.484206258969025e-01   -6.929907178071160e-02   +6.384424527605788e-01   -2.459730593683052e-02   -7.492779210600600e-02   -6.329102349299895e-01   +8.608377923564351e-01   +1.430240907529367e-01; -3.749696997330744e-01   +5.563739452101333e-01   +2.687998712028668e-02   -1.093576302452410e-01   -2.762910646002503e-01   +1.614030071250142e-01   -7.512482475892654e-02   +9.951604220583654e-02   -1.149821989980860e-01   +2.294981381289091e-01   -2.315889564985740e-01   +3.292307371768150e-02   +7.667901561405807e-02   +2.798510326432757e-01   -8.952266785913721e-02   +3.789744261532717e-01];
L2I_L1I_iGABA_netcon = [-1.724051641569326e-01   -3.680995438676577e-01   +1.186843601406126e-01   +3.914940335482282e-01   -3.979170171870772e-01   +2.743247504514446e-01   +1.685173623716520e-01   -2.307330813415626e-01; +9.605608264597376e-02   +5.415520361602125e-01   -1.468935550937039e-01   +1.250657621902063e-01   +5.581161591035811e-01   +5.837084458239230e-01   +3.887408673470749e-02   -2.094101162976934e-01; +3.867869086613595e-01   +5.641463682675013e-02   +4.438984434251093e-02   +3.253031513927804e-01   +4.198184087717947e-02   -2.766715348727109e-02   +1.118019035852635e-01   +2.717464305273075e-01; +1.617888656056134e-01   -1.132151545521550e-01   +7.065651410797384e-01   +3.304397275218088e-01   +2.046744812158182e-01   +3.105255907120105e-01   +2.340242584415522e-01   -1.616712160594858e-01; +2.132715655341992e-01   -4.107931106077690e-01   +6.306483045722151e-01   +4.027429416794379e-01   +4.557038665912496e-01   +5.207934123974280e-01   +2.733863391303207e-01   +2.621324810786493e-02; +2.301275476065002e-01   -7.037276199246906e-03   +4.053466643196652e-01   +3.584778250797500e-01   -1.134166277161816e-01   +2.965506692580884e-01   +2.831953618299209e-01   +3.949645503250319e-01; +4.350350003181735e-01   +1.557130247903277e-01   +1.916135925395731e-01   +1.190394974135857e-01   +2.767647379532250e-01   +5.797882866857563e-01   +4.007447094228730e-01   +2.799102419174592e-01; -1.994774421564502e-01   +5.608537667944267e-01   +2.516938346795697e-01   +1.393312733018077e-01   +4.300984872131191e-01   +7.694469934681480e-02   +1.982111974237978e-01   +1.119584961293297e-01; +1.526183614745238e-01   +9.438052434011799e-01   -3.636880638266601e-01   +6.078500216093894e-01   +2.821604865895244e-01   +2.321324150019002e-01   +2.849600238894596e-01   -3.434839081203609e-01; -1.900536113551365e-01   -1.195847570450362e-01   +3.140287595864580e-01   -1.368814595411371e-01   +2.967390159940756e-01   +2.885759478734565e-02   -4.972332560469191e-01   +1.914600925444005e-01; +1.693867651488282e-01   -4.295056318210546e-02   +2.286736026728850e-01   +3.017736714394882e-01   +1.956759202850668e-01   -7.141451098750841e-03   +2.075545884710433e-01   +4.153410498729777e-01; +3.440514902474322e-01   +2.164939691655536e-01   +3.132593899481945e-01   -1.589250055367533e-01   -1.887925025464286e-01   +4.628218892467924e-02   +6.508862595766721e-01   +3.456306331642509e-01; +2.533350964096040e-01   +2.287986560222469e-01   +2.145649710936640e-01   +2.087267188935608e-01   +6.244712863046026e-01   -1.673001912121197e-01   -1.723301525444812e-01   -2.341045824956441e-01; -1.354276906489909e-01   -1.724607286738242e-01   +8.607394063667957e-03   -4.275721851417282e-01   +3.063434950293285e-01   -1.490990045830470e-01   +3.650138462760830e-01   +3.121754621718448e-01; +3.126030853825687e-01   +2.164216716068146e-01   +4.263629308698832e-01   +1.469131032240739e-01   -7.402802491227320e-02   +7.624306366966450e-01   +6.803460113903288e-01   +4.289329022002935e-01; +7.312407000354798e-02   -1.447432256437716e-01   +2.797337749689705e-01   +5.824205303049044e-01   +2.038606105819568e-01   +3.519801140704366e-01   -3.613337294744311e-02   +4.172496978782438e-02];
L1I_L2I_iGABA_netcon = [+2.510477153127521e-01   -1.633056222213937e-01   -2.338723603012789e-01   +3.414409461485071e-01   +2.023475627215043e-01   +1.726727997216512e-01   -2.108904840137474e-01   +1.006350933031595e-01   -2.318225682936843e-01   +2.723225433718726e-01   -2.227933762861271e-01   +7.833162143164635e-02   +1.210063554658123e-02   -2.967779296743846e-02   -2.850212566508800e-01   +2.309642340857734e-01; +2.207186635597441e-01   -3.242169822443561e-01   +1.145938175699752e-01   -1.878073397335276e-01   -2.857135346824639e-01   -1.357449530516417e-01   +1.483402522078932e-01   +2.576233697111029e-01   -9.096303071596136e-02   +5.688503974839745e-01   +2.771541864546267e-01   -3.699468927188481e-01   +1.209490801602449e-01   -2.104636850467402e-01   +4.055296458095962e-01   +2.138902920016559e-01; +2.984078395857024e-01   -1.715251746747188e-01   +4.424910587607321e-01   -7.743576687359983e-02   +1.332925651829388e-01   -2.245184079155352e-01   +5.428505438478292e-01   +1.094586401036786e-01   -1.705317748338929e-01   +3.787074659330739e-03   -2.307842958105575e-01   +1.430266962127603e-01   +2.574021978480773e-01   +4.326829391037417e-01   +5.080683356130304e-01   -1.076458785214709e-01; +2.817855479621190e-01   +6.187510945268327e-01   +3.105221307945145e-01   -1.472103988556238e-01   +3.290127754114514e-01   +7.653523961861612e-01   +2.593997346680924e-01   +2.417841354998145e-01   -1.097136291407220e-02   +5.585598440533300e-01   +3.156307112328510e-01   +2.656817775109914e-01   +3.744840794868921e-01   +5.453455610803639e-01   +3.188350492757694e-01   +2.720034799355108e-01; -5.000341694589580e-01   +8.697603922729549e-02   +2.550509623388052e-01   +3.058773379343527e-01   +9.002128773211973e-02   +5.842554277096601e-01   +5.200951758565849e-01   +3.907623771501034e-01   +4.545067924232136e-01   +3.355502702102719e-01   +6.224870711541853e-02   -1.713489703563848e-01   -6.956032652507435e-01   +6.313962461228796e-02   +1.611649264490064e-01   +6.369348827633613e-01; +7.332318680011383e-02   +3.713281396544059e-01   -4.840916964200357e-01   +4.166801488908358e-01   +7.917388449889144e-02   -2.059697359285892e-02   +3.385451485964123e-01   +4.939068590232781e-02   +4.511058080202714e-02   +1.138991493458661e-01   +8.155330186245638e-02   -7.893012314281866e-02   +3.539641754895635e-01   +1.000000000000000e+00   +5.487770643385927e-02   +5.223880745892824e-02; +2.660557182291292e-01   +2.582295337975970e-01   -2.421223963043192e-01   +3.179217420859452e-01   +2.820659385448077e-01   -4.345083653371942e-01   +4.922013939990375e-01   -2.069282213256133e-01   -2.046395471266498e-01   -3.806515881905538e-01   +3.466360618464571e-01   +2.467121946582512e-01   +1.185587495985684e-01   +1.090387639413183e-01   +1.704548401770570e-01   +1.037531775689592e-01; +2.796933346089497e-01   +4.748556700254169e-02   +7.927379771788912e-03   -3.521276944484079e-03   +1.547577463067063e-01   +1.907820870863296e-01   -2.448425301043370e-01   -4.974504325160587e-02   +1.547982737309538e-01   +2.518829424766463e-01   +3.858958238117405e-02   +4.591939516138697e-01   -6.510917256225533e-03   +2.335538812104477e-01   +3.779669711157744e-01   +4.719421345500848e-01];
L2E_L1E_iAMPA_netcon = [+3.723473146674257e-01   -5.935697781868986e-01   +1.797890078546477e-02   +4.539475257243595e-01   +7.250272925011774e-01   +4.838414997784486e-01   +7.242168088718097e-01   +7.299590938867546e-02; -2.740801662936282e-01   +1.905976246977799e-01   -2.944081230548034e-01   +1.747763247238412e-01   +1.821608534043135e-01   +4.244325905334445e-01   +1.473524847702126e-01   +1.014216092067571e-01; +3.208406973990469e-01   +1.276283713988350e-01   +1.140130319479876e-03   +1.942759574751705e-01   -2.002300294409041e-01   -1.424284081267649e-01   +2.313437442898343e-01   +4.070608391966004e-01; +5.387284461600526e-01   -1.633666997435394e-01   -2.171796126711840e-01   +4.832346264646343e-01   -7.236702582842926e-02   +1.379091383113409e-01   -2.708340222971313e-01   +8.518898063849509e-02; -1.104365814473851e-01   +8.934376737692987e-02   +5.726077597451414e-01   -2.869897155160089e-01   -8.753799806897095e-02   +1.690180775878843e-01   -1.125339548928462e-01   +3.222509383990978e-01; +5.722647155823694e-01   -3.129920951382084e-01   +1.636515606835307e-01   +4.358402723308951e-01   +3.779466126874855e-01   +7.714935622295412e-01   +6.132061364965047e-01   +3.510977107182621e-01; -2.942717419207863e-01   +7.894886639273391e-01   +8.013574035679766e-02   -2.513739269035909e-01   -2.691082963182592e-01   +1.857236667675925e-01   +7.607152618931343e-01   -2.989198083012402e-01; -8.189454142903828e-02   +6.061673867266613e-01   +9.602497426784936e-01   +1.227570622694621e-01   -2.271376472763778e-01   +2.655238565568274e-01   +3.878052068517388e-01   +1.754582914768821e-01; +3.547391414300954e-01   +3.529110410316914e-02   +5.715928056924600e-01   +6.639722593279124e-01   -3.747798571601952e-01   +2.922461336516615e-01   +6.106377899804424e-01   +1.198333172051078e-02; -2.848849871164857e-01   +2.139495357548425e-01   +2.319357578470584e-01   +4.283842205791900e-01   +1.164150921297666e-01   -2.817998268754509e-01   -2.699419514026095e-01   -1.707105828122657e-01; -2.272615182863821e-01   +6.710811190845051e-01   +8.658858954832670e-01   +1.083368223223409e-01   -5.801869953034227e-02   +1.034638146177376e-02   -9.162464847633667e-02   +2.836224928475616e-01; -1.254783478678107e-02   -9.932650343459656e-02   +4.469207108755936e-01   -3.260872615889167e-01   -3.479028600756184e-01   +2.581073182493293e-01   -3.173832688396560e-01   -3.386364549997631e-01; -1.415072031383775e-01   +3.751715176735677e-01   -5.280563279383345e-03   -1.621104488700520e-01   +7.388265131719508e-01   -3.148628656966549e-01   +7.364764855227748e-02   -4.505676728710450e-02; -1.598286724015653e-01   +9.875160673331443e-01   -2.392843776345215e-01   +1.016069292481656e-01   +4.339127120567311e-01   +1.835234993005268e-02   -1.039910182418804e-01   +3.524122709749976e-01; +1.652519007525038e-01   +2.370894745879767e-01   -1.651962757932453e-01   +3.297149898918517e-01   -8.615131034417767e-02   -6.002892309441137e-02   -3.234489309457393e-01   -1.968579204310069e-01; +2.872386074945292e-01   -3.315765692726915e-01   -4.239455142669377e-01   +2.336468832490340e-01   +2.441389771159256e-01   +3.964935944539289e-01   +6.663672005363668e-01   +1.068350605247127e-01];
L1E_L2E_iAMPA_netcon = [+2.567672685576099e-01   +1.721121182668298e-01   +1.354589646950196e-01   -2.025318907325736e-01   +2.033167204193254e-01   +2.481994637803285e-01   +1.890812742613672e-01   +3.050666457286633e-03   -7.800139433258448e-02   -3.467609690142099e-01   +5.651111515843742e-01   +5.204571737083495e-02   +1.064988053974729e-01   -2.191692183481543e-01   -2.368521224247928e-01   +1.744733328101542e-01; +1.491068277893595e-01   +9.454718858036733e-02   +2.866149292130059e-01   -9.059157422286937e-02   +1.824803783622225e-01   +2.850482652973310e-01   +5.390445674063379e-01   +2.373463724002886e-02   -1.377503046473994e-01   -1.162010952109607e-01   +5.449721645709346e-01   +3.635458025742693e-02   +5.754879861912257e-01   +3.138937901483944e-01   +7.703864642238614e-02   -4.438653874067462e-01; +8.877041885291869e-01   -2.999715443113117e-02   +1.830239895939078e-01   +9.539463126169792e-02   +2.396526657346215e-01   -1.601402419132216e-01   -2.207930118088913e-01   +7.478736750793447e-02   -5.058443155508179e-03   -5.224068319338201e-01   -3.983333322582373e-02   +2.573385226957781e-01   +1.488788084856583e-02   +4.391976434543213e-01   -2.525686761570589e-02   +9.385058133275639e-02; +1.650089283585964e-01   +3.665445286556741e-02   -1.235174874735671e-01   +5.299457249238295e-01   -1.181046510351517e-01   +6.839412081762741e-01   +7.816169172108286e-01   -2.080356811525322e-01   -1.704611981964142e-01   +8.249477616067688e-02   +6.766369950247837e-01   -3.112602385339076e-01   -3.273122395818921e-01   +8.055899342955372e-01   +2.192602533639798e-01   -6.016879910389591e-02; +9.074265347728656e-03   -5.299439754089673e-01   +1.275539396534229e-01   +1.736542965144734e-01   -1.174661667714787e-01   +9.197563294297499e-02   +3.182629918201670e-01   +7.393730192367573e-02   +6.381346278822413e-01   -5.456144600691886e-02   +8.822967236770021e-02   -5.653564624180193e-01   -2.049967030904401e-01   -7.410105748213833e-02   +1.513990998226344e-01   -3.660025494181184e-01; +1.495157528515190e-02   +3.691804977395654e-01   -8.715241976607974e-02   +5.286980406751739e-01   +1.036530844566635e-01   -1.903222730285214e-01   +9.330369485456753e-01   -1.517626444755031e-01   +2.097187635193837e-01   +1.167996715696445e-01   +2.691991013922331e-01   -1.019770518737544e-01   -1.751295328491612e-01   -8.751067753510799e-02   -4.028338799006083e-01   +6.332239413137154e-01; +1.895284561074292e-01   +3.507048287297690e-01   +1.858360809620971e-01   -1.969591194231682e-01   +3.973749266735293e-01   +2.843897408502070e-01   +4.529348988176911e-01   -4.075708708557529e-01   -4.460326492591897e-02   +6.184256878615937e-02   -2.174482984558630e-01   -2.176513009466246e-02   -4.760397802040475e-01   +6.111128506673518e-01   +4.680585171310472e-01   +4.234246172578971e-01; +4.482796351730439e-01   +2.557239631820691e-01   +3.759701558385999e-01   +6.624615374104568e-01   +2.479416872454626e-01   +4.160869847539131e-01   +3.870642685533234e-02   +1.008849875735172e-01   +3.432282353000732e-01   +2.998805462843127e-01   -6.166704303065646e-02   +1.027804906077355e-01   -5.955112686019616e-01   +1.553131690111841e-01   +4.087015151283929e-01   +3.097086177611976e-01];
L2I_L2E_iAMPA_netcon = [+1.279690655163897e-01   +7.543356467055867e-01   +1.583381452108355e-01   -5.797763751204632e-02   +4.069877372080410e-02   +3.403093938870898e-01   -1.006981863854628e-01   +5.037383795038575e-01; +7.283838372989291e-01   +2.187195666498309e-01   +5.914756121530419e-01   +9.089425694271742e-01   +4.542148720650293e-01   +1.851144642214308e-01   +2.830250048390425e-01   +2.400983826442490e-01; +1.191027509107864e-03   +1.103842026996213e-01   -2.918020586719492e-01   +2.555660557837006e-01   -2.572732703782210e-01   -8.030509181436998e-02   +2.707929320900017e-01   +8.553525195545528e-02; +4.023308452945062e-01   +4.494569926470292e-01   -5.366279110804713e-01   +4.531544818516117e-01   +4.936335296135222e-01   -5.352172026617496e-02   +3.406697349008001e-01   +4.006533729209688e-01; +2.642084024058303e-01   +1.157920139576830e-01   -2.522766201360777e-01   +2.025296065455340e-01   +7.225142123761583e-01   -1.537185088143818e-01   +3.255247755935990e-01   -2.401299333326620e-01; +3.911858464737155e-01   +1.680859383012742e-01   -3.872627674203603e-01   +3.768183991731332e-01   -5.553529896588095e-01   +2.131910767227643e-01   +8.088047156775494e-02   -1.566874940345542e-01; +5.534946833695024e-01   -5.104924912941216e-01   +2.739640312894232e-01   +6.882350032979648e-01   +2.075534058739814e-01   -4.511463946953795e-01   +9.839283880910449e-01   -5.686856450168922e-01; +6.234193773353103e-03   -8.014612267093893e-02   -7.876390003099210e-01   +1.062302607519172e-01   -1.979069250240911e-01   -2.180084363487708e-01   +1.609371361898895e-01   +7.241676673426842e-01];
L2E_L2I_iGABA_netcon = [+3.016826426841949e-01   +4.682775538793336e-01   +2.297929624363185e-01   -1.860425452693256e-01   -6.839496933161920e-02   +3.087753252656309e-02   -1.316044460926447e-01   +7.039795746227294e-01; +1.735132590998834e-01   +1.025983497506467e-01   +8.082302093326538e-02   +9.205266844602615e-01   +4.853344623224953e-01   -1.745613865945949e-01   -3.848876438278628e-01   +1.106201840573346e-01; +1.307088759773968e-01   +6.040938027174071e-01   -4.831570345386407e-01   -5.038322118781915e-01   +3.034288925015789e-01   +6.321779050089101e-01   +2.306808322977293e-01   +2.759580917179445e-01; +1.701350201515087e-01   +3.605638438934315e-01   -4.592725357179135e-02   +5.550401290773711e-01   +7.247217359558176e-01   -3.627524327153688e-01   -1.952111628174315e-01   +3.984416119119311e-02; -9.945121901628545e-02   +1.044154310063510e-02   -7.840754439915157e-02   +3.746460416149693e-01   +6.351310459204620e-01   -2.612203752279074e-02   +1.054886389506101e-01   +2.732375221309760e-01; +7.565788969021977e-01   +2.239899007779322e-01   +3.731688663722345e-01   +4.137827460124054e-01   +3.402541618210980e-01   -6.126481964182533e-02   +4.499878289464918e-01   -4.642387954877913e-01; +8.164849693787274e-02   +7.017820274970764e-02   -3.483270866570426e-01   +3.140064376844384e-02   -5.018913549890150e-02   -6.029347096555178e-02   +6.636730288014074e-02   +7.957926344238475e-01; +1.575898316217846e-01   +3.265520912091242e-01   +3.415493255592609e-01   +2.210373498006041e-03   +5.926394925753049e-01   +3.967155752136818e-01   +2.410136353431754e-01   +5.036232806776418e-01];
L3E_L2E_iAMPA_netcon = [+1.547460135030487e-01   -3.709550471528698e-01   -3.662575497997600e-01   +2.191673791130278e-01   +6.644633507264893e-01   +3.029372602901905e-01   -3.725062594026725e-01   +9.291138465880897e-01   +4.435963327559608e-01   +2.062023511938158e-01   +2.855273119645793e-01   -4.839744467771689e-01; -2.679957756061752e-01   +3.362485712424034e-01   +3.595823536662845e-02   -4.819176439090438e-01   -3.006622842254918e-01   -4.228760165201511e-01   -3.563037489745559e-01   -4.305944029384780e-02   +2.340412584776244e-01   +3.103726149589364e-01   -8.626336969785009e-02   +7.187261594012234e-01; -6.230849064126153e-01   -1.784161772656669e-01   +7.125793864052505e-01   +2.371781804267579e-01   +5.907340971016406e-02   -7.751062983762136e-02   +8.938633981751348e-02   +1.821617851719278e-02   +5.820994476526407e-01   -4.632215710321707e-01   +8.713782070740907e-01   +3.248124158789119e-01; +3.433265578523510e-01   +4.263898810625998e-01   -1.418495270862555e-01   +1.064329676686047e-01   +5.638167765751047e-01   +3.430686784279149e-01   +1.761964564219544e-01   +7.785843277294872e-01   -2.890947679071998e-01   -4.491554936064262e-01   -1.130176950442571e-01   +2.656081165894210e-01; +1.618868398458693e-01   +6.681318641472438e-01   +4.409838691791957e-01   +4.766871649793303e-02   +3.528173980689764e-01   +5.349902893118379e-01   +4.652414153239722e-02   -2.095449096170958e-02   -3.276269730810975e-01   +5.676164899594981e-01   +2.268567527231768e-01   +3.816053892041767e-01; +1.317006197958988e-01   -1.020491318651651e-01   +4.282822710971503e-01   +7.500121192656908e-02   +7.314525372853469e-01   +6.432025647594198e-01   -3.447165775608684e-01   -9.442456077595568e-02   -2.327122230221624e-01   +3.013110558067422e-01   -2.725666143691751e-03   -2.290735307349431e-01; +4.199190232084986e-01   +1.731271183454314e-01   +1.501861947847242e-01   -1.460545553269789e-01   +2.524414631657799e-01   +5.719174511609295e-01   -3.931675628845450e-02   +2.127456225100055e-01   -5.472998575351253e-02   -2.704284552344244e-02   +1.357129222056448e-01   +1.803340892378975e-01; -1.367515692819258e-01   +8.328847335007149e-01   +2.711918317716942e-01   -6.233460977372994e-01   +3.850220857960173e-01   -4.375086199632067e-01   -3.736283767022368e-01   -1.175560965681354e-01   +2.293129004145516e-01   -4.536563169556571e-03   +3.419069454912781e-01   -1.393204678968776e-02];
L3I_L2I_iGABA_netcon = [+6.932845529288835e-01   +8.449692490323809e-01   -2.206018511939106e-01   +3.579745480539174e-01   -3.755280924122132e-01   -6.466632015927286e-02   +9.545861424851342e-01   +7.179070565992307e-01   +2.978684796208293e-01   +2.952056298551178e-01   +2.125269874086391e-01   +1.072826196472992e-01; +4.765865617168043e-02   +3.862703589307669e-02   +1.792295543056310e-01   -1.470632423505358e-01   +1.450969706235910e-01   +2.447143602979187e-01   -2.447207290317050e-02   +3.830637426469267e-02   +8.378829738033104e-03   -3.254879583120887e-01   +7.665707444519641e-02   +7.454059737482413e-02; -2.585230852615886e-02   +5.903727025083398e-03   -7.073921604724259e-02   -1.034260990530172e-01   -1.795271381995624e-01   +3.923115308487621e-01   +2.548143332459125e-01   +6.106767004370642e-02   +1.198067622916750e-01   +5.297972846452632e-02   -1.147528219961669e-01   +7.940425688126697e-01; +7.834711071158044e-01   +1.687092834819713e-01   +4.478235740507469e-01   -3.148064277342796e-02   -4.128646620079449e-02   +1.243588338128141e-01   -1.118447275104414e-02   -1.546744411766209e-01   +2.555453507945253e-01   +5.968212660168566e-01   +5.094534935187545e-01   -1.699917480690312e-01; +1.901596701664434e-01   +2.816210098133237e-01   -7.868144639461136e-02   -9.529231671009217e-02   +2.191917194120860e-01   +6.725850267048281e-01   +2.023382796215163e-01   +3.830107398830683e-01   +3.727461823407742e-01   +2.160471494446980e-01   +1.729227026243068e-01   +2.133190916026478e-01; -8.254194128604272e-02   +2.433419900230961e-01   +4.104816109633138e-01   +9.903456312150891e-02   +1.768144774197084e-01   +8.349911668901754e-02   +2.130359460236630e-02   -2.528486648517949e-01   +1.881176910487373e-01   +1.227009046193989e-02   -7.916388261939619e-01   -2.035320201273542e-01; +2.388213461770247e-01   +1.863665512608432e-01   +2.901669351298155e-01   +4.294588148239078e-01   +3.892105857924490e-01   +5.295212726783496e-01   +3.633969191450301e-01   +1.341677887313588e-01   -7.376750146066429e-01   +3.291244909666351e-01   +3.059157227174377e-01   -3.860107696439617e-01; +1.122178460672188e-01   -9.809039735677491e-02   +5.670627917102339e-01   +2.637866011431674e-01   +1.411879184305714e-01   +3.275479481291457e-01   +3.874224592163036e-01   +7.057347716796101e-01   +5.915356150164960e-01   +1.980627062296801e-01   +1.403542463701868e-01   +2.491599147035974e-01];
L2E_L3E_iAMPA_netcon = [+4.237724943417217e-01   +4.134352749193539e-01   +5.420771255121274e-01   -8.448491195849975e-01   -8.627823942917344e-02   +3.846746756161671e-01   +6.777130140041316e-01   +3.512840478472052e-01; +3.219201252592080e-01   -1.908760250797826e-01   -4.139251078233092e-02   +1.612379204056325e-01   +8.677586291396107e-01   -6.773974576229143e-01   -8.147681755999131e-01   -5.025170801828595e-01; +1.256948172613985e-01   -7.317472149254371e-03   +2.610780934030066e-01   +2.051948587251756e-01   +3.105054489859320e-02   +1.925273107974102e-01   +1.265818454907482e-01   -2.576725117904333e-01; +3.149303974806025e-01   +4.306117210007231e-01   +7.353544195380348e-01   +9.046750500928049e-01   +1.533318887228175e-01   +4.608864522680445e-01   +1.297576004467150e-01   -4.740426785059655e-01; +7.827891097837059e-02   +1.073776216403946e-01   +2.710473270511548e-01   +3.446636206109038e-01   +1.894749458280320e-01   -7.072230244040374e-02   -2.893490162596792e-03   -5.051046259032157e-01; +1.126968031598322e-01   +4.246607285028294e-01   +3.790291076292656e-01   +6.732833871072953e-01   -7.052171807148941e-02   -5.968019691919287e-02   -1.064828758860639e-01   +2.766666671755637e-01; +2.352174466526473e-01   +7.813991155993906e-01   +6.661219946630177e-01   -3.501120805598937e-01   +4.190912623784531e-01   +2.023542422023266e-01   +5.008643987682412e-01   -5.361654358532487e-02; +2.759255692528905e-01   +3.558454948947967e-01   +2.156706929550482e-02   +1.456360015221465e-01   -6.016867618554218e-01   -1.151514281231456e-02   +1.023140191977090e-01   +5.521187025714255e-01; -1.083534185513878e-01   +7.419199087426473e-01   +5.273779462875359e-01   +8.846146475950640e-01   -1.367907201625925e-01   -2.388633832319162e-01   +5.059997849964675e-01   -9.689222013318868e-03; -3.255078502190976e-01   +1.499863124347474e-02   +4.016236761086179e-01   +2.908784194038153e-01   +1.707094662902245e-01   -2.758781962843232e-01   +4.189076787335967e-01   -9.989912304116989e-02; +6.705897819089803e-01   +4.376423780146859e-01   -1.267173790233033e-01   +3.877792426108338e-01   +3.143969601019899e-01   +9.946929082072873e-01   -5.350109097344538e-01   +2.350676508438847e-01; -1.984152082761154e-01   +4.980130903049282e-01   +4.310940977809309e-01   +1.439310327293898e-01   +5.190549465357065e-03   +4.631645825914790e-02   +5.687601472475340e-02   +1.192753061117523e-01];
L2I_L3I_iGABA_netcon = [-1.393313365132871e-01   -1.289084216366521e-01   +2.454322752099011e-01   +2.097180905157778e-01   +2.546717441129983e-01   +6.497586505674364e-01   +3.721693487194395e-01   +3.213241305340754e-01; -2.902844940414220e-01   +3.295145334095444e-01   +2.864012624272533e-01   -1.366475984490653e-01   -1.838407123392665e-01   -1.408678752164403e-01   +2.833012700819284e-01   +2.228707471188204e-01; +3.841310330858747e-02   +9.910485411605374e-01   +5.136928253613744e-01   +8.507583302142390e-03   +3.109771152899667e-01   +3.850955663869367e-01   -1.761421668330906e-01   +4.819207430213593e-03; +7.849303111427750e-02   -1.174592981963950e-01   +6.055569309743501e-01   -6.527456699635324e-02   -9.064568326548018e-02   +2.683850674311662e-01   +4.308889181981524e-01   +3.363308799720717e-01; +4.685501557731207e-02   -4.660031253437951e-02   +2.961375110449400e-01   +3.512074977801610e-01   +2.398781968896970e-01   +3.015709619134134e-01   +5.195632102503129e-01   -3.145991079601454e-02; +6.856972229767624e-02   +4.142291380813802e-01   +1.170500665794852e-01   +2.235521536031004e-01   +4.120540547846835e-01   +2.016483145990875e-01   -3.163626418593991e-01   -4.369379088237571e-02; -1.779334831498974e-01   +8.037222489642276e-01   +3.742885537310215e-01   +3.339734468100103e-01   -2.189010281439790e-01   +5.399805076341015e-03   +7.998670470882501e-01   +4.302415430466610e-01; -3.135600567835706e-01   +4.951264616085939e-01   +2.931409146314093e-01   -1.199404268118167e-01   +2.253453111267796e-01   +5.085213293897723e-01   +2.076580854710981e-01   +6.547432538618717e-01; -6.368147714336043e-01   +8.726704831988518e-01   +4.453486193132661e-01   +2.159825546161257e-02   +1.713791182873592e-01   -9.628556578069726e-02   +1.575987287327340e-01   +6.949207274279331e-02; -1.503711780837944e-01   -2.879938313614305e-01   +3.450971243119899e-01   +3.456201592221580e-01   +4.070601699632410e-01   +3.857258141868958e-01   +8.826331476330358e-02   +7.687031528562542e-02; +4.389257113206187e-01   -5.915391871342712e-02   -5.031402579136970e-01   +4.571713688215615e-01   +3.654699154833070e-02   -2.178396784631809e-01   +2.364686694232744e-01   +3.674234953394527e-01; -2.112862841575878e-01   +5.082161358421524e-01   +2.106766754618919e-01   +1.462851647856457e-01   +3.684487543731277e-01   +3.482327869470311e-01   +5.469960586875762e-02   -3.502253078752329e-02];
L3I_L3E_iAMPA_netcon = [+7.243848725575187e-02   -5.836479626783597e-01   +1.019881773876467e-01   +2.076660222410928e-01   +2.305183023675379e-01   +9.952350452125323e-02   +2.297455808332558e-01   +5.798356812318817e-01   +7.000240899564500e-01   +2.899777561454351e-01   +1.867601529296752e-01   +5.725097228755350e-01; +3.248030600513804e-01   +1.333460245418809e-01   +1.084675972244783e-01   +5.559623169818283e-01   +4.292146277980862e-01   +1.471148681876860e-01   +3.381629097426477e-01   +7.975411146301796e-01   +6.158950679046468e-01   +2.992011895266210e-01   +1.141458405014407e-01   -2.737836149471356e-01; +2.705099022673338e-01   +5.527189345190879e-01   +2.941080399334407e-01   -2.796275713039181e-01   +7.420795292102548e-01   +3.276684009916561e-01   +4.781641258535025e-01   -2.444215985059837e-01   +4.657277010295243e-01   +3.010161333853558e-02   -8.681097531092048e-02   -1.062488959961939e-01; +1.191226368942490e-01   +2.383542341321598e-01   +4.324031103014665e-02   -3.345248352727268e-01   +4.589597417467650e-01   +1.521109507917248e-01   +5.485839361841179e-02   +6.097734669617723e-01   -3.064928337057859e-01   +2.490680857323526e-01   -1.041702352469713e-01   +3.079557074923934e-01; -1.828480053647629e-01   +5.498410477530212e-01   +8.453662383491169e-01   +4.093582004407784e-01   +2.036415540820607e-01   +6.479983733572246e-03   -1.428913791749638e-01   +3.395588393979441e-01   +4.714192452087070e-01   -4.417191088256574e-02   +1.733260076224223e-01   +1.500731490957580e-02; +2.856933861735085e-01   -1.586705399802918e-01   -3.651985495986697e-01   +8.033096797222683e-02   -7.499227103828399e-02   -1.264094875109392e-01   +7.395279687721503e-01   -9.307328511686208e-02   +7.362190871080222e-02   +3.936301939864933e-01   -8.886646354812504e-03   +9.452811520755565e-01; +2.806441821549163e-01   +9.588101306383490e-02   -2.761856057350854e-01   -1.039390057868196e-01   +3.768168004850508e-01   +1.581966880105954e-01   +2.657345433294011e-01   +1.934953133141176e-01   +3.147908576794963e-01   +8.542209880234622e-02   +2.535553224024062e-01   -1.659255843565035e-01; -6.756325206378692e-03   +4.026330284711524e-01   -3.016754916591818e-01   -3.240609551754727e-01   +4.199911412791917e-01   +2.825440358794233e-01   -6.067483199529999e-02   -1.649930207148763e-02   -1.495742230288541e-01   -3.725862961714961e-01   -4.362179469429073e-01   +1.212819809778832e-01; -3.586500866011736e-01   +7.904850441599248e-01   +2.030653507864199e-01   +7.647628177808874e-01   -2.055771480656139e-01   +4.593816258291935e-01   +2.212991555435581e-01   +5.688827157455474e-01   +2.664824998671592e-01   +3.478436158606100e-01   +2.726894614373090e-01   +5.497051304371898e-01; +9.581702303178087e-01   -6.627674317395887e-01   +7.072555974849128e-01   -2.108781935677335e-01   +1.728612964294686e-01   -2.715554741868057e-01   +1.867562951669904e-01   +2.798546160386604e-01   -1.746493221548166e-02   -1.252620936156983e-01   +3.889170558466696e-01   -2.460823525338054e-01; -1.190443261662205e-01   +6.351337968367654e-01   +5.200091604464330e-01   +4.448846769675521e-01   -1.613413332196771e-01   -1.471550644905943e-02   +5.080917885691504e-01   +2.994764904308428e-01   +5.217765083926040e-01   +1.053423624536488e-01   +6.327133410640337e-02   +5.966096408803652e-01; +1.407277395907996e-01   +1.678659939154754e-01   +1.003382577408080e-01   +5.306522781676164e-01   -2.300898320407266e-03   -3.793114731825190e-01   -5.429165551433029e-01   +3.403684952222639e-01   -1.065946258893108e-01   -3.665977167568418e-01   +1.671413183446184e-01   -1.387917667199264e-01];
L3E_L3I_iGABA_netcon = [+7.324713760789883e-02   -1.541221339182728e-01   +6.215866246286597e-01   +2.033925570061048e-01   +5.039403573730721e-01   -1.049895619161964e-01   -3.115181097273751e-01   +3.156138392213363e-01   -1.637946338359682e-01   +5.170531679366682e-01   +5.173250286418574e-01   +3.514795864472745e-01; +3.266583364843612e-01   -3.438553351409691e-01   +3.104819855902906e-01   -3.254015498193182e-02   +6.200785929017627e-01   -2.077472252242595e-01   +2.347777813523385e-01   +6.190913663363647e-02   -4.320686871138333e-01   +3.100114122244955e-01   -6.931110026022173e-01   +1.475546473748886e-02; +8.972504038143007e-02   -1.960363187392641e-01   -5.957032139779611e-01   -1.948056639560748e-01   -3.647663989569326e-02   +3.261271728289966e-01   +5.757240153350632e-01   -1.017523269450408e-01   -6.476293646651132e-02   -2.355958551636465e-01   -3.104322948266239e-01   +1.107068176500307e-01; +4.123371042434154e-01   -3.184572134587709e-03   -3.079523580345213e-01   +7.417561149616815e-01   +8.947615515328762e-01   -2.538840605978988e-01   +5.320446118565733e-02   +3.898734465781683e-02   +9.868197451770475e-01   +5.278151645772468e-01   +3.194165606147296e-01   -2.686312103000675e-01; +6.306107621574668e-02   +3.578151401596676e-01   -1.344316166795722e-01   +2.029151877420924e-01   -7.541775474944937e-02   -2.482362425831904e-01   +1.605219159262567e-01   +4.361877732487283e-01   -3.937140770095087e-01   +7.524188140197732e-01   +5.695748287647844e-01   -2.118681398101032e-01; +3.924100580857567e-01   -6.515805074120275e-02   -3.038779417202924e-01   +1.238249713465834e-02   +9.833922303254319e-02   +1.759319135107670e-01   +4.383538674565406e-01   -5.756208792628845e-02   +2.235841922088166e-01   -6.555846182325192e-02   -2.432939003212034e-01   +1.277880399372959e-01; -2.655075769607426e-01   +1.703248292179959e-02   +2.571215205445470e-01   +7.556534512194336e-01   -7.976889292820898e-02   +5.867825451682027e-01   +3.316553328331854e-01   +7.287684106857208e-01   -2.037558382151487e-01   +2.337870232446603e-01   +3.218041721806898e-01   +3.719607606439790e-01; +1.362639337975896e-01   +2.957169229115930e-01   +6.662039195787747e-01   -2.742219830810167e-02   +3.136546401131131e-01   -5.266857094647510e-01   -6.808763336617117e-01   +6.671333220648773e-01   -2.834280946574275e-01   -5.671028829797536e-01   +6.968682661711463e-01   +1.945008943698823e-01; +3.470903990763781e-01   -9.776424139582299e-02   +7.046768308712441e-01   -3.081808475740372e-01   +3.535440340576599e-01   -1.180379913190717e-01   -7.641247451758005e-01   -1.815032433281631e-01   +2.881297359008440e-01   +2.695981046128623e-01   -1.107937203467695e-01   +5.044260474450588e-01; +4.449281561423636e-01   -1.047705490717560e-01   +4.223372230330833e-01   -1.302347353853989e-02   -6.673874240509321e-01   +1.093416894943544e-02   -3.551117370950918e-01   +4.996827119291142e-01   -2.597846082394298e-01   +6.185265376262644e-02   +2.710446350880694e-01   +2.520240505214158e-01; -2.913630015639840e-01   -1.420075554045455e-01   +3.291991268424656e-02   +3.982337574291606e-02   -1.934647387767126e-01   -1.287405902193475e-01   +3.727115998498226e-01   +3.096564659653548e-02   -1.992991253055203e-01   -6.678934097572695e-01   +2.674977699807708e-01   +3.321467067993065e-01; +1.563190616493707e-01   -2.266700963920577e-01   -5.743203646088477e-01   -1.833243199924784e-01   +9.928443408628408e-01   +1.594452382653227e-01   +3.738258915500705e-01   +4.543138761016032e-01   -1.307334936479818e-01   -5.386373238308114e-01   +3.609764359207417e-02   -7.136738474957195e-01];
L2E_Input1_iAMPA_netcon = [+7.410244432434646e-01   +1.000000000000000e+00   +7.231651373096196e-01   +1.971996510470977e-01   +1.826482181229657e-01   +2.799593898119700e-01   +7.329317181053704e-01   +5.936324295928045e-01];
L2I_Input2_iAMPA_netcon = [+6.532876402248551e-01   +7.285790988623093e-01   +4.076570613588877e-01   +2.140894587891831e-01   -8.690738303226163e-02   +6.402150664051562e-01   -2.950705177138805e-01   -9.608625948244953e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
