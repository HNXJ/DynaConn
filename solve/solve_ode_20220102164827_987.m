function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.563792328308761e-02   +2.040424142546909e-01   +3.591940507251364e-01   +2.728402492371917e-01   +2.448468508938351e-01   +3.787171249414902e-01   +1.951354568436776e-01   +7.429458546612902e-02   +7.573066472519084e-02   +1.765854861958016e-01   +2.259255823538052e-01   +7.709540690933395e-02   +1.566226769109748e-01   +2.604056106688553e-01   +1.685427666033213e-01   +3.161681503020768e-02; +1.457295682389009e-01   +5.996608289815241e-03   +2.044089351936159e-01   +2.475822533850524e-01   +1.143921136131325e-01   +1.252128262145489e-01   +3.560624461705661e-01   +3.857668964491892e-01   +2.684543536653324e-01   +7.965565230334257e-02   +3.855605365463974e-01   +8.418494179190512e-02   +7.931589826771643e-02   +1.025657875925087e-02   +2.040596606677732e-01   +1.112275592559079e-02; +2.608285554209872e-01   +2.740597104178500e-01   +3.297315563854721e-01   +1.805908156378215e-01   +4.467226057684517e-02   +3.263973474523195e-01   +3.427522933914944e-01   +1.694950104482688e-01   +1.865853455762453e-01   +1.603452753938412e-01   +1.739505067056656e-01   +5.729795060321066e-02   +2.342103918358867e-02   +5.845968712794850e-02   +3.176660957890245e-01   +2.311856363693195e-01; -3.277925139999992e-05   +1.259689994956250e-02   +1.774441300444807e-01   +2.410244403957202e-01   +7.743059099060315e-02   +3.069251918734396e-01   +1.745703180099282e-01   +3.731339699123885e-01   +1.876795826376298e-01   +1.152825485184878e-01   +3.508105288845817e-01   +3.476964716481559e-01   +5.021003098266533e-02   +3.585764496596217e-01   +8.907122385260489e-02   +1.245135711439278e-01; +1.856073479730815e-01   +2.513639546256585e-01   +2.429827314022884e-01   +2.714107560118439e-01   +1.502794085231001e-01   +3.191763859850362e-01   +1.910353659589695e-01   +1.031187553090941e-01   +2.182482562971077e-01   +3.293628656704699e-01   +1.403178184603407e-01   +2.684598090524370e-01   +9.799607885626203e-02   +1.262209154124870e-01   +3.460682905934853e-01   +6.302486091902965e-02; +1.915505919829782e-01   +5.535880773572509e-02   +3.280249680504772e-01   +6.499619881657040e-02   +2.476820895799068e-01   +1.209965766226302e-01   +1.724795268651267e-01   +7.107396542246508e-02   +1.902055384238208e-01   +1.896264183158523e-01   +2.898976593297131e-01   +9.499645629067975e-02   +1.917198794109531e-01   +2.071112240720033e-01   +1.856952969338516e-01   +2.755964872518059e-01; +1.274263411761364e-01   +2.539485217932412e-01   +3.666614719297976e-01   +2.529089668641309e-01   +1.490962535361019e-01   +2.374853001080900e-01   +1.429398809376536e-01   +3.263178509389610e-01   +3.702664165472014e-01   +1.567424144084078e-01   +5.899132412112897e-02   +6.526959320384307e-02   +1.650687531953275e-01   +3.634940101917732e-01   +1.776708805115457e-02   +9.109265468317894e-02; +2.211256504102087e-01   +1.389912587618198e-01   +2.986960607870086e-01   +2.409578092454994e-01   +2.294970970995020e-01   +5.889499076555840e-02   +2.872556249870145e-02   +1.696584933553399e-01   +2.960103584412316e-01   +2.601375595903397e-01   +1.136089927710145e-01   +2.956666545179299e-01   +1.241696990968012e-01   +4.036429028977571e-02   +2.787270749269727e-01   +2.386794661948213e-01; +5.596810028856361e-03   +2.578783584510924e-01   +2.595711766567123e-01   +2.674261631291729e-01   +3.832288735005319e-02   +3.515697504200845e-01   +1.731871926550378e-01   +1.751916839723326e-01   +1.914496948235092e-01   +1.868792231952220e-01   +6.369651789635219e-02   +3.492218247194442e-01   +7.188461241490236e-03   +3.018454407490727e-01   +1.484868517460129e-01   +1.939625902595616e-01; +2.745411466958829e-01   +4.523351271954085e-02   +3.423360781108421e-01   +3.203202441961925e-01   +2.410813014322400e-01   +7.052149394137434e-02   +3.640411030483566e-02   +7.273611784029668e-03   +2.925337724792756e-01   +1.543722126795610e-01   +4.180811994734503e-02   +2.179098222450924e-01   +3.204871131526423e-01   +1.016564370116955e-01   +3.349713838189983e-01   +2.583905242082305e-01; +1.525911206262587e-01   +1.899568901089346e-01   +1.981228046445379e-01   +3.085210243018869e-01   +3.487266658702872e-01   +7.381554260201283e-02   +2.447984466681631e-01   +2.292852301149437e-01   +9.409061573436629e-02   +1.148829333173872e-01   +2.827910719743544e-01   +3.685961905806354e-01   +4.780718752342136e-02   +2.751811457989990e-01   +2.996735558882984e-01   +7.441993932078977e-02; +2.060704607765503e-01   +1.171444126371817e-01   +4.005890622393941e-02   +7.161954063009228e-04   +3.752332610350271e-01   +3.529481343357854e-01   +1.491485558734280e-02   +2.713138033893003e-01   +2.686587823322427e-01   +1.176559821348818e-01   +4.647945611933588e-02   +1.068094293709855e-02   +3.592858188667058e-01   +3.283327226471174e-02   +2.084114093057666e-01   +1.582949266195355e-01; +2.527580953680196e-01   +2.881953888660957e-01   +3.412675338170016e-01   +6.138500523491613e-02   +2.560193831334728e-01   +2.743850580377308e-01   +2.737885641600150e-01   +2.474632971255007e-01   +3.461134752318339e-01   +1.681006235179519e-01   +1.606834970803834e-01   +3.410565434165126e-01   +3.271237575029087e-01   +2.750663962066682e-01   +1.749460003082718e-01   +3.511322519720181e-01; +3.283424770427613e-01   +2.617777047952817e-01   +1.205197660328753e-01   +2.392312403246187e-01   +4.200028704587164e-02   +9.453162332626540e-02   +2.322693854020763e-02   +9.324024914280277e-02   +1.328165350705700e-01   +2.720436485625161e-01   +7.865627453849049e-02   +3.080012484890808e-01   +2.215383593068199e-01   +2.397971377548884e-01   +1.555375010970001e-01   +1.243734312836640e-01; +1.835453272188180e-02   +2.051565245332493e-01   +3.257687053733417e-01   +2.059819866376059e-01   +1.066853889970416e-01   +7.349277075627829e-02   +1.055131932381797e-01   +1.541568648598983e-01   +9.145068466867909e-02   +3.891016652305809e-01   +1.385282534235646e-01   +2.160237385151007e-02   +7.599552873542582e-02   +2.850301762701235e-01   +1.535351525168348e-02   +2.618419525644798e-01; +3.049690004546864e-01   +1.431911092526867e-01   +8.487761936037128e-02   +3.722851186065885e-01   +4.397283955028739e-02   +5.448532795648742e-02   +3.428139006872073e-01   +5.853628855888561e-02   +2.337403633345083e-01   +2.942778714290589e-01   +2.537877492252736e-01   +5.954673159693157e-02   +2.911864729335356e-01   +3.045505754128389e-01   +3.663388110871132e-01   +3.440261799989422e-01];
L1E_L1I_iGABA_netcon = [+2.010229809539366e-01   +2.522573260125969e-01   +2.479419118712502e-02   +1.257779435014758e-01   +3.225547203926344e-01   +1.500762656378968e-01   +1.414100981929977e-01   +8.857586677270841e-02   +3.554271905106849e-02   +1.451728408301794e-01   +1.421347886470601e-01   +2.243970064177414e-01   +1.216434041802387e-01   +3.499589460747030e-01   +8.691507175277038e-02   +1.962183138052890e-01; +5.404490437822340e-02   +3.563673857821287e-01   +1.981504010261464e-01   +3.405010503808817e-01   +1.742836250201369e-01   +1.630012201247026e-01   +6.137165469784314e-02   +1.979954273143208e-01   +1.828943700970196e-01   +5.811023255966132e-02   +7.565751230452042e-02   +2.757769780013399e-01   +1.873265195644533e-01   +2.813309366383529e-01   +1.946112654368188e-01   +2.777103397771424e-01; +2.472569624813303e-01   +3.864107194378012e-01   +3.026963944565972e-01   +2.507886448867942e-01   +3.990633218120943e-02   +2.264592711896543e-01   +2.543830326493560e-01   +3.368408370904823e-01   +3.396938120638858e-01   +3.678259318031236e-01   +2.590159703389626e-01   +1.950121569266942e-01   +3.754439166122644e-01   +3.198716275887420e-01   +1.676943268754673e-01   +2.190388648436859e-01; +2.185997491445500e-02   +5.525574399095305e-02   +3.549764269257213e-01   +1.864577566133789e-02   +7.187582001349074e-02   +2.757440969715186e-01   +2.759518490455060e-01   +2.178993589486232e-01   +1.953747048928060e-01   +3.748941584335606e-01   +2.477365114444822e-01   +3.317663902900359e-02   +1.373957775517725e-01   +7.333454962686141e-02   +3.944984263275293e-02   +3.757935897220638e-01; +7.416425158544865e-03   +3.406898832030969e-01   +2.024801366173174e-01   +3.861412843168645e-02   +1.616042500220776e-01   +3.274761798343104e-01   +2.762021551482913e-01   +1.556686733097298e-01   +1.886788276255278e-03   +6.000687118003243e-02   +2.761582097922801e-01   +4.597083775761918e-02   +3.173163258238916e-01   +1.792071175285130e-01   +2.576842004537772e-01   +2.119551810084534e-01; +2.971530365493765e-01   +3.634042015092609e-01   +5.757673469389323e-02   +2.616416879456401e-01   +1.363855870696807e-01   +1.142263791300697e-03   +2.658886310551673e-01   +1.177768493685883e-01   +3.211702033620313e-01   +6.529884127220942e-02   +3.671069627489963e-01   +5.434244218200714e-02   +1.426940894366087e-01   +5.372303401145373e-02   +2.085545386261873e-01   +5.688511456784917e-02; +1.903934376219395e-01   +8.477814521456944e-02   +5.425747472354774e-02   +1.003238074283624e-01   +7.638390934426496e-02   +1.484963484372046e-01   +1.181810168889694e-01   +2.050649586079384e-01   +3.402508661980958e-01   +6.430328686724796e-02   +2.937486742411178e-01   +3.858220687525856e-01   +3.864179888599594e-01   +2.001444870776848e-01   +1.973857002025423e-01   +1.123245166017521e-01; +1.093294505405380e-01   +8.673901401111689e-02   +7.502325318823368e-03   +5.876094143608078e-02   +2.818559582376716e-01   +1.996436317541217e-01   +1.894564309879405e-01   +2.395271041109420e-01   +7.687478984582966e-02   +1.622664772834431e-01   +3.211643037713894e-01   +3.662488765889822e-01   +2.036248843911825e-01   +1.768712313934045e-01   +7.392392866178238e-02   +2.733042300296497e-01; +1.173985994024498e-01   +2.401047334458055e-01   +1.182026072931950e-01   +4.173976062329916e-03   +7.014312785486589e-02   +2.715674874348604e-01   +3.076116756409442e-01   +3.478864532194694e-01   +1.408545273935614e-01   +4.336747333036836e-02   +2.927334550563194e-01   +1.391615374719417e-01   +3.426638198844367e-01   +3.641286411134536e-01   +2.335306216973804e-01   +2.794981521895935e-02; +1.687491050224437e-02   +1.571297382084305e-01   +5.975551755203715e-02   +2.231370847671129e-01   +1.558504388007653e-01   +3.244815672169548e-01   +1.219619205836874e-01   +8.656962439078784e-02   +3.620721575321768e-01   +2.951318855045344e-01   +9.185551505732976e-02   +2.373488910327728e-01   +2.969984696350008e-01   +7.431904885967920e-02   +3.037062467897879e-01   +8.047135832196010e-02; +3.362857643169666e-01   +3.658206589315794e-02   +1.182571039901731e-01   +1.578852513338483e-01   +2.038915452309020e-01   +2.578179319954029e-01   +1.747327463626048e-01   +3.765217910315550e-01   +1.224577505278926e-01   +1.591666677552398e-01   +2.243670072338637e-01   +1.864708885148676e-01   +9.978438611896659e-02   +3.750549346829248e-01   +3.441330383703037e-01   +1.308647613017872e-01; +6.787003701128592e-02   +3.497998424251188e-01   +2.124879567837497e-01   +3.588724482644918e-01   +3.809447965197155e-01   +2.541477470708607e-01   +1.851525916313924e-01   +5.297864745906478e-02   +2.760360338527670e-01   +1.796730275841110e-01   +1.298484212378023e-01   +3.225667039645143e-01   +2.622136704187429e-01   +1.895843189069729e-01   +3.057680038503256e-01   +9.427206259849448e-02; +2.823716335930359e-01   +3.249193933424979e-02   +2.070866986400973e-01   +4.285938991932450e-02   +2.128498832842395e-01   +2.211378613630773e-01   +2.283595803801321e-01   +7.831584946757514e-02   +2.885883595865299e-01   +3.445616591417910e-01   +7.311531482592547e-02   +3.022017655854491e-01   +3.773586043399752e-01   +2.400091464742924e-01   +1.432058619590020e-01   +5.037961782817130e-02; +1.011134931964251e-01   +1.033097706479192e-01   +9.188479333557141e-02   +4.202871154572811e-02   +7.622604807906515e-02   +3.386998392846832e-01   +3.590185510216168e-01   +2.966004431734786e-01   +1.692202171982824e-01   +2.509364319601825e-01   +3.825221155279891e-01   +2.858044710135575e-01   +2.438202138863349e-01   +3.341685955873405e-01   +2.530424203020818e-01   +2.858273892731594e-01; +1.616208620659022e-01   +6.941349568862649e-02   +1.740934689027671e-01   +3.380268305335882e-01   +2.397571904017054e-01   +1.946677114404654e-01   +4.774242848071720e-02   +1.341882524963245e-01   +6.926129128263729e-02   +2.005094353600195e-01   +9.889069927909390e-02   +1.692033094715408e-01   +1.450874323731466e-01   +8.554729699650014e-02   +7.089451704859384e-02   +1.153379584091613e-01; +1.723545463625825e-01   +2.605389790690145e-02   +6.770829508970483e-02   +3.585085651264531e-01   +3.634872003993822e-01   +2.464418590781054e-02   +8.185666270303608e-02   +3.159323179791775e-01   +3.063177913710997e-01   +5.067610706029527e-02   +1.715033056565178e-02   +2.414831419617554e-01   +2.551779940881630e-01   +2.010643497991728e-01   +1.558226498924820e-01   +1.750635679999028e-01];
L2I_L1I_iGABA_netcon = [+3.831991672856349e-01   +1.867749055487677e-01   +1.108346554154194e-01   +3.419819063790284e-01   +3.561319110812482e-01   +3.578342962986042e-01   +1.373786962332904e-01   +3.076463467940010e-01; +3.048660358749565e-01   +3.390597432257577e-01   +2.759137245711272e-01   +1.067343171432665e-01   +1.662174183642872e-01   +2.623225444517685e-01   +3.465508409722445e-01   +8.700565349923292e-02; +8.292513226397988e-02   +9.044580192436319e-02   +1.042389416697039e-01   +1.417788721357874e-02   +3.084804037469136e-01   +3.738719115612896e-01   +4.309822136622067e-02   +2.359841778143295e-01; +1.478573237450071e-01   +3.045193413544584e-01   +2.605206045026851e-01   +2.401037177556167e-01   +2.334568095896205e-01   +2.364749921046738e-01   +1.922504905838712e-01   +3.079445165841669e-01; +1.239811958481478e-01   +7.191556293613748e-02   +2.315446575001336e-01   +2.250556364497053e-01   +1.765173168572230e-01   +3.000833243887137e-01   +1.917916715182167e-01   +2.276445628377386e-01; +3.012129158754464e-01   +2.801455476585864e-01   +3.524017730706443e-01   +1.613554259553610e-01   +1.164130328708450e-01   +2.691250907882685e-01   +2.578626746034675e-04   +2.622582720405101e-01; +5.242567884230561e-02   +1.390720409146654e-01   +1.434741437653444e-01   +9.296026239391054e-02   +2.656169113449602e-01   +1.087276132200779e-01   +8.816367011465438e-02   +2.572506821644587e-01; +2.202790357439295e-01   +1.347969931162517e-01   +3.085508584696239e-01   +1.498668427163062e-01   +1.118910163256776e-01   +2.678394261097822e-01   +1.757527990891823e-01   +1.139054476209226e-01; +1.568328982294935e-01   +2.714773724122153e-01   +7.623398386393310e-02   +9.392350841985168e-02   +1.205266329589975e-01   +6.392471677154017e-02   +1.653974099002884e-01   +3.718350062160516e-01; +2.032368065081543e-01   +2.618226619467759e-01   +8.340967050876386e-02   +2.112373300811719e-01   +1.103822249704958e-02   +2.752608286347437e-01   +3.474579073659192e-01   +2.698538870537782e-01; +2.038846731462983e-01   +3.054479502830235e-01   +3.238399149415424e-01   +1.453814663659251e-01   +2.730169608215161e-01   +3.810095113477220e-01   +6.980652482568613e-02   +1.056909656649600e-01; +3.041685814477832e-01   +2.035590826274506e-01   +2.337070936247869e-01   +1.642173345560251e-01   +3.754193539282381e-01   +1.041423181433999e-01   +2.429723293132646e-01   +1.252195789145182e-01; +1.179774106157431e-01   +3.703451867586639e-01   +3.598537930830625e-01   +7.484096559367295e-02   +2.134212394752798e-01   +1.132930558490846e-01   +1.216181447888068e-01   +1.953002806739158e-01; +2.639715238539226e-01   +9.868668107992749e-02   +3.861749133464402e-01   +1.988433591811651e-01   +3.218382388765890e-01   +7.184845882783565e-02   +3.690922341345584e-01   +8.528680493383861e-02; +3.717873235264270e-01   +8.101746533785786e-02   +1.030237021035268e-01   +3.532346734130466e-01   +2.580297879332886e-01   +5.455278128747607e-02   +1.509120825631383e-01   +2.695177301193162e-01; +7.828841830129679e-02   +2.699922565991102e-01   +2.733355657913297e-01   +2.388630046012321e-01   +3.174820201775417e-01   +4.995280731259800e-02   +3.799458737211534e-01   +1.164299069924716e-01];
L1I_L2I_iGABA_netcon = [+2.191430523473326e-01   +2.641578928198215e-01   +1.187234586069530e-01   +2.951607324192641e-02   +2.007145903579226e-01   +1.472158206167160e-01   +3.776979488293442e-01   +2.691412041672438e-01   +1.612415780746610e-01   +2.978019059374162e-01   +5.508938236856137e-02   +1.217257930221432e-01   +4.385822795445735e-02   +6.111310783803500e-04   +7.746386490383435e-02   +3.067289484912183e-01; +3.094762968408259e-01   +2.319446694776643e-01   +1.517132333971577e-01   +1.802546281562291e-01   +3.567390490774823e-01   +1.734142629250826e-01   +2.590974763165030e-01   +3.754469909304820e-01   +1.652220656051043e-01   +3.792981535155274e-01   +2.529285711938260e-01   +1.383032951848150e-01   +1.933263034079827e-01   +2.551896019001471e-02   +1.792226955035493e-02   +3.452973263583148e-01; +3.304693762545310e-01   +2.226546902307792e-01   +8.576654274279009e-02   +3.191765037960442e-01   +1.286113733819523e-01   +3.339175140749466e-01   +2.923592133611448e-01   +2.526751926388351e-01   +1.463443384414549e-01   +1.394393650811245e-01   +2.634256036262331e-01   +1.511715777569030e-01   +1.262375452954792e-01   +6.518365601963101e-02   +2.338259066229448e-01   +5.493651940755255e-02; +1.578839559484558e-01   +1.744847535746303e-02   +2.287161332180252e-01   +3.350877584830178e-01   +3.901213279633498e-02   +2.516184041292472e-03   +1.376273924695998e-01   +1.343544144140710e-01   +2.624361671207536e-02   +2.503712219278749e-01   +2.164621750065026e-01   +1.850030400292182e-01   +9.331083908089917e-02   +2.540796168250236e-02   +3.063002462320850e-01   +1.984904303127312e-01; +3.103721036812838e-02   +3.116268502491636e-01   +3.030995906481529e-01   +2.549758057906359e-01   +2.444335425021314e-01   +1.922912167668576e-01   +2.405760565553348e-01   +3.274873765148403e-01   +2.362193510412867e-01   +1.314668406175343e-02   +1.236579146990528e-01   +5.234052374979490e-03   +9.698350777214033e-02   +3.428750346744557e-01   +7.939871044853439e-02   +1.813975502459695e-01; +2.400165141180911e-01   +2.755855492740889e-01   +5.021912786808137e-02   +3.465349039417701e-01   +2.193845786269703e-01   +3.763607638887028e-01   +2.813802665961638e-01   +3.199302361037599e-01   +2.127242106254092e-01   +2.242815581082083e-01   +3.917283286454160e-01   +3.196522939907319e-01   +5.172527277439410e-02   +3.534932688234276e-01   +2.783112734485462e-01   +3.476298839187557e-01; +2.998133100488277e-01   +5.152550013677474e-02   +3.344804847329820e-01   +3.779788275059429e-01   +1.479153132908756e-01   +3.797808119907169e-01   +1.983689607926225e-01   +1.810192762297818e-01   -3.527498441416897e-04   +2.247726486744225e-01   +1.159362643498300e-01   +1.364847246625913e-01   +3.036892777063032e-01   +1.607078401135022e-01   +3.231386630571375e-01   +2.229959019856256e-01; +2.865076433142358e-01   +3.529040825947773e-02   +3.503267382857227e-01   +2.790536550089090e-01   +4.128907385120429e-02   +3.050381842469743e-01   +2.282905682066731e-01   +3.004332533953655e-01   +1.380729804700508e-01   +3.334853560918076e-01   +1.049928725714521e-01   +1.926963657155241e-01   +1.956877709042754e-01   +2.118394261099111e-02   +3.530912596839297e-01   +5.837073673608674e-04];
L2E_L1E_iAMPA_netcon = [+3.038235037855438e-01   +1.119850288350243e-01   +5.681940779373613e-02   +3.865184887854783e-01   +2.772142344396399e-03   +1.888100515821437e-01   +2.570769651002567e-01   +2.968944636242752e-02; +3.570566506011644e-01   +3.323811506517395e-01   +2.056046978038739e-01   +1.427937750724157e-01   +1.958593201565943e-01   +6.621696729648789e-02   +3.539663832736792e-01   +1.565474477467289e-01; +3.946119937534488e-02   +4.764914848409008e-02   +1.231578136319520e-01   +5.737910624031546e-02   +2.470750335472417e-01   +3.266483055487439e-01   +1.282806390409516e-01   +1.221840141621674e-01; +1.017466335677939e-01   +2.832648992239559e-01   +8.002421700690512e-02   +2.569744224312274e-01   +2.913642858584816e-01   +1.205496601242964e-01   +3.428170910981640e-01   +3.203827341140962e-01; +7.410721094926313e-02   +3.823382609731363e-01   +5.789537386681709e-02   +1.081890746395159e-02   +3.623307757024751e-01   +3.689609869282994e-01   +2.677859679799210e-01   +1.804838269894099e-01; +2.689722258022130e-01   +2.035619350464343e-01   +3.646382739473848e-01   +3.028365924381812e-01   +2.709877050311340e-01   +8.922617508136285e-02   +3.045795394720460e-01   +2.647668588064618e-01; +3.929272208261485e-02   +1.326010711421615e-01   +1.071167391709928e-01   +1.750062957270336e-01   +3.546366735282115e-01   +1.818662899834569e-01   +6.416965852397817e-02   +1.331261096319898e-01; +2.698518705322881e-02   +5.278544771018651e-02   +2.078402595133650e-01   +2.593735243332339e-01   +1.513030962445563e-01   +3.537364449683179e-01   +3.744879940122824e-01   +3.529066077132933e-01; +1.388838442216224e-01   +3.435026281159317e-01   +1.926499184731919e-02   +1.009280262342505e-01   +6.076297381137614e-02   +3.739239274112304e-01   +2.094651200612895e-01   +2.609349338995082e-02; +1.143381686106773e-01   +1.110450115938727e-01   +3.298240238930246e-01   +1.552860705081842e-01   +3.186783523098408e-01   +3.459356729522186e-02   +5.053670706993085e-02   +3.697167246143361e-01; +2.239338239498726e-01   +1.855733043548528e-01   +7.481689852831833e-02   +2.362215359890598e-01   +1.587663832176903e-01   +1.624235716390063e-01   +2.291108534316938e-01   +3.463629494509730e-01; +1.016896132414759e-01   +1.769228733426867e-01   +3.173627205493540e-01   +2.855910954790588e-01   +2.489661729761128e-01   +7.510425365694615e-02   +3.858178114035000e-01   +9.517810032144952e-02; +2.303163205436488e-01   +3.244623194671709e-01   +9.505144003817301e-02   +2.142116040769911e-02   +3.800210235796294e-01   +2.560451303995022e-01   +1.750010573809163e-01   +3.141368780714686e-01; +1.631463223263389e-01   +1.446495669207410e-02   +4.328439106468455e-02   +2.584063973413137e-01   +3.634406488332912e-02   +1.132898220655651e-01   +2.931658287977789e-02   +2.871048414173036e-01; +1.090847826535606e-01   +7.950145581761928e-02   +2.715923897525813e-02   +3.013961840660358e-01   +4.312605895641344e-02   +3.724111530352160e-02   +1.595338820002165e-01   +8.799051474088185e-02; +5.475129281483210e-02   +1.784720960239569e-01   +5.466494411818306e-02   +2.096026773700108e-01   +9.788749540543874e-02   +2.136842028082947e-01   +3.920921112294726e-02   +3.198409493616917e-01];
L1E_L2E_iAMPA_netcon = [+1.425298127730888e-01   +5.818859487437518e-02   +3.625140538155459e-01   +3.681574136269890e-01   +1.314339255466997e-01   +3.655792916166825e-01   +1.989989447597689e-01   +3.823812044551907e-01   +5.428585424030637e-02   +2.524175465516675e-01   +2.483816313871587e-01   +2.936457188369129e-01   +1.426238450670070e-01   +2.581858537306179e-01   +2.198887684021696e-01   +1.922926040095307e-01; +1.453098939785663e-01   +2.002113032721191e-01   +8.526265463078479e-02   +3.191548700348528e-02   +2.223728547787346e-02   +2.641258671663692e-01   +3.109680131905789e-02   +1.214160324408635e-01   +8.359865808277631e-02   +1.247632606284324e-01   +1.032915385916758e-01   +3.652283791416995e-01   +5.644136065226834e-02   +1.052746845365387e-01   +2.304429853579435e-01   +9.602098136425964e-02; +1.261720041362065e-01   +2.261194216183294e-01   +3.501405100033992e-01   +3.552724156092963e-01   +3.715629877518111e-01   +4.602066679776388e-02   +1.181503151650164e-01   +2.215503278169249e-02   +1.726124878603978e-01   +2.235698015517669e-01   +1.329246476470488e-01   +4.172338136572511e-02   +2.882743667586684e-01   +2.328792584004589e-01   +3.403883373897394e-01   +2.521470928046658e-02; +3.011865683984850e-01   +1.037079081942749e-02   +8.216101765439895e-02   +8.442982045463042e-02   +2.761223152437381e-01   +1.232335979732373e-01   +3.525353871562489e-01   +3.433519398883865e-01   +3.037608748783168e-01   +2.993398191729719e-01   +1.786246848653832e-01   +2.184685044817673e-01   +3.560503510900613e-01   +1.322815772402198e-01   +3.526371259731761e-01   +3.782816250440376e-01; +5.457045365876891e-02   +3.339746025653532e-01   +3.354840534381278e-01   +9.916436616660239e-03   +6.289510046906729e-02   +3.198326158009109e-01   +3.584448006552534e-01   +6.671944758688843e-02   +2.258457519380207e-01   +1.664275237481393e-01   +2.180151229568477e-01   +2.974562892826763e-01   +9.096996483912681e-02   +2.060864866103803e-01   +3.845666830806774e-01   +2.324383278626966e-02; +1.427757557340975e-02   +3.332295198915164e-01   +1.035779800584287e-01   +3.150980665152091e-01   +3.781429459351288e-01   +3.325487303297250e-01   +1.999471587259218e-01   +3.563165017608063e-01   +1.280680550715803e-01   +1.533558606030315e-01   +3.300538620055542e-01   +3.554683461372665e-01   +3.266392512803963e-01   +2.433849864296445e-01   +7.630255556577510e-02   +2.204578395954432e-01; +1.193535883970659e-01   +8.530363703329860e-02   +2.244470776318041e-01   +2.252951726564269e-03   +1.482578873606360e-01   +2.047652139493562e-01   +2.878852740731803e-01   +2.304920853716993e-01   +2.262609768852893e-01   +3.046790482749464e-01   +2.454235569920873e-01   +4.692854027844143e-02   +1.388623640436235e-01   +2.151068869878626e-01   +9.154178933070051e-02   +1.362134347788783e-01; +3.445058653509979e-02   +2.104503022884221e-01   +1.934446791568118e-01   +1.544264296962989e-01   +2.840390318083456e-01   +3.796795855391136e-01   +3.802258246706620e-01   +2.503206522659784e-01   +3.399117723557704e-01   +1.525824503811667e-01   +1.346380610090367e-01   +3.777390812946311e-01   +2.547633462844872e-01   +3.521810265831745e-01   +1.260888187554390e-01   +3.957089403759287e-02];
L2I_L2E_iAMPA_netcon = [+2.411483857797269e-01   +8.929023248751111e-02   +3.526730004800425e-01   +1.845281844597569e-01   +2.988273256091098e-01   +1.747783110497206e-02   +7.817084545533851e-03   +3.529716824499528e-01; +6.222742244670666e-02   +4.911749489701963e-02   +6.768554889383760e-02   +3.296953909349569e-01   +2.953501038668244e-01   +1.535130672223000e-01   +2.726833404268270e-01   +1.872798792153726e-01; +3.289773789459152e-01   +2.907219481238693e-01   +3.222453141424725e-01   +2.917438210145711e-01   +2.039669907545110e-01   +1.978307000345599e-01   +1.911752204824013e-01   +2.788286417807655e-01; +1.548303229790645e-01   +6.419653710730415e-02   +3.495193164495884e-01   +1.658623641053256e-01   +3.728468748542707e-01   +5.733472642103028e-02   +1.731656118913595e-01   +3.301844697091607e-01; +2.699443731255021e-01   +3.319048124938577e-01   +2.496849664592756e-01   +2.362528593853703e-01   +3.562498991734819e-01   +2.863701139488483e-01   +1.551409080413235e-01   +2.879071260471752e-01; +2.402823957447551e-01   +1.195631109627514e-02   +3.412421794250334e-01   +2.845688858295516e-01   +2.052423152685405e-01   +7.641786986523418e-02   +4.414940300259641e-02   +2.772958902171187e-01; +3.679644775774790e-01   +1.792587161792820e-01   +6.502694691733214e-02   +1.839179883562865e-02   +4.720577827794888e-02   +8.423917295670749e-02   +5.794701026144605e-02   +6.575723566521595e-02; +3.537450335315796e-01   +1.278683218306094e-01   +2.139146181799963e-01   +1.924115224059996e-01   +3.396899733116732e-01   +9.352633253515770e-02   +4.651133044355484e-02   +1.111543192645914e-02];
L2E_L2I_iGABA_netcon = [+3.626613874362591e-01   +9.130214474091972e-02   +7.987620667821904e-02   +7.181563003890544e-02   +2.612200805324261e-01   +1.418858749758384e-01   +3.229427633759714e-01   +3.664515453273794e-01; +9.642151389347620e-02   +1.612642373489925e-01   +5.138906449297716e-02   +1.204637860623208e-03   +3.862252333499775e-01   +2.714450257529891e-01   +2.939443685176797e-01   +2.743656236146595e-02; +2.548300269169901e-01   +1.327171361446988e-01   +2.144714208597384e-01   +2.091806005851800e-02   +1.509835549528573e-01   +3.164330141103273e-02   +3.793676854962303e-01   +3.210007527492308e-01; +3.338036379746405e-01   +2.893309619300799e-02   +1.016194222712887e-01   +2.828920123411928e-01   +3.553441396967404e-01   +2.475330204607046e-01   +1.726019671608805e-01   +2.585782775963870e-01; +6.387035849801785e-02   +3.516727595144336e-01   +2.706215226055352e-02   +3.256230836609507e-01   +1.162929709106847e-01   +1.424751894689921e-01   +1.817950208136740e-02   +1.058827949476412e-01; +2.933641452263147e-01   +8.877435336990884e-03   +2.101004617471778e-01   +3.072080567128528e-01   +3.417067116391974e-01   +1.039816544047744e-01   +3.700084188854353e-01   +3.011617471924859e-01; +6.262513146663176e-02   +3.819841324442397e-01   +1.184797706540962e-01   +1.197009868141842e-02   +2.780748074302581e-01   +2.006353546560218e-01   +2.324115650232698e-01   +2.401618671041891e-01; +3.387556252136080e-01   +1.203749492654584e-01   +1.975585382208015e-01   +7.884432400244906e-02   +1.749041129690154e-01   +3.044569996523214e-01   +3.681045086306576e-01   +2.423513300623607e-01];
L3E_L2E_iAMPA_netcon = [+1.372183574926654e-01   +2.492215604213963e-01   +5.823793934799967e-02   +2.591332951765176e-02   +1.418055931584793e-03   +3.811545920343647e-01   +1.497750579966227e-01   +3.338124478110602e-01   +4.504997875691461e-02   +1.098551733099557e-01   +1.094180839308887e-01   +2.272347825674590e-02; +1.045903685354341e-01   +3.444819574105439e-01   +1.173889190919141e-01   +1.458937157625708e-01   +1.761405697339060e-01   +2.140259961845153e-01   +3.553154164968821e-01   +3.810729462832412e-01   +2.205875249358886e-01   +3.732067464641483e-01   +1.335379607358939e-01   +9.981847573231982e-02; +3.859251621752691e-02   +2.883006745288191e-01   +4.303516846043390e-02   +2.838736182480987e-01   +1.539191279871433e-03   +4.562579417631105e-03   +2.063520888736260e-01   +3.782287480659388e-01   +2.301695029971424e-01   +2.383526439839057e-01   +9.458751925164878e-02   +2.737130929716980e-01; +1.673817019631174e-02   +7.759225601624649e-02   +3.159286606148146e-01   +9.504593359571049e-02   +1.108606439165045e-01   +1.831923651758605e-05   +1.331125394185656e-01   +2.753244472946034e-02   +8.433848817623545e-02   +1.258874319320361e-01   +7.688534228566260e-02   +1.278526657884697e-01; +3.499389109808992e-01   +1.439712181377623e-01   +1.347191022517767e-01   +3.821765860135510e-01   +2.626351580508315e-01   +1.395712398724389e-01   +3.769597649162207e-01   +6.284709570310286e-02   +3.274782435624691e-01   +1.857802122998924e-01   +2.675149510526757e-01   +1.576126365608099e-01; +3.378329987290571e-01   +2.353719025772034e-01   +4.194008084765818e-02   +1.899735083947380e-01   +2.485132853218312e-01   +3.524775864485803e-01   +3.404343341617270e-01   +1.466804967829182e-01   +1.801109530047257e-01   +7.492344049004293e-04   +2.448972591825887e-01   +9.669932033216685e-02; +2.440864888578538e-01   +1.957738512320229e-01   +2.443274337175941e-01   +8.016673445743568e-02   +2.573373105367864e-02   +1.386784034761221e-01   +1.043951433459840e-03   +1.397841724058876e-01   +1.120989779198818e-01   +3.639912553299122e-02   +1.086385217039669e-03   +1.795194958779441e-01; +3.317672285404894e-01   +3.928104984378542e-02   +3.550267034132323e-03   +1.006340311145689e-01   +2.099689102155239e-01   +4.166096682126576e-02   +7.573855276007142e-03   +1.853264907186063e-01   +1.919931150034244e-01   +3.302369757816280e-01   +3.617046915583373e-02   +2.325829873821159e-01];
L3I_L2I_iGABA_netcon = [+3.793677677322402e-01   +1.907400280414713e-01   +2.551031585961311e-01   +1.076596292641522e-01   +3.668349964038818e-01   +1.665522605458810e-01   +1.841361916221552e-02   +7.930718829156965e-03   +3.375130843688477e-01   +1.746628013938563e-01   +4.131359041318194e-02   +2.872650828742557e-01; +3.485233671950455e-01   +3.753087741076067e-01   +3.425776500739772e-01   +5.660335764795063e-02   +1.969157276741532e-01   +3.219386656768445e-01   +2.458498043301894e-02   +8.258805407999478e-02   +1.915186534489431e-01   +2.628509822893498e-01   +4.457190583270974e-02   +2.470350852608705e-01; +3.780704266552781e-02   +3.334619944089661e-01   +3.475650492158361e-01   +4.595384266636356e-03   +2.771848274086071e-01   -1.318082525970362e-03   +2.413519705847821e-01   +3.654200325402573e-01   +2.768635608954869e-01   +1.041114627291454e-02   +2.362028203388744e-01   +4.297281030799910e-02; +3.723990519843886e-01   +1.524208883338501e-02   +1.579923599565227e-02   +2.527023764907016e-01   +3.433007250041357e-01   +2.132139774878121e-01   +6.265647366235431e-03   +4.181510894040278e-03   +3.363765297702203e-01   +3.212100094856249e-01   +3.854127575363012e-01   +2.133906747119509e-01; +5.987067042220687e-02   +3.720981355434409e-01   +1.638024571302421e-01   +1.677987613169926e-01   +2.243879208410562e-01   +3.590313128439868e-01   +1.529612605770974e-01   +6.617981170109248e-02   +3.938195364496884e-01   +1.954062615025779e-01   +8.288100580308765e-02   +7.363776997914191e-02; +1.350097698985225e-02   +2.636033115071311e-01   +8.006084963236179e-02   -1.777673276828412e-03   +6.392338472571484e-02   +2.504698276572062e-01   +2.695766049745681e-01   +9.178960721884588e-02   +2.258504204691461e-02   +2.934856638773422e-01   +3.388983974968996e-01   +2.654615968693888e-02; +2.399490476844658e-01   +3.414982750411875e-01   +2.234993092698982e-01   +2.529590954210687e-01   +1.674470065889059e-01   +1.191781294157916e-01   +2.693844995743370e-01   +1.030792097419972e-03   +3.292540619136401e-01   +1.475711737494960e-01   +1.910088418638777e-01   +2.769450822394044e-01; +1.943425417712640e-01   +8.604921223827555e-02   +1.210427768821167e-01   +2.281531736801057e-01   +1.325165771404969e-01   +4.834119030366922e-02   +8.841902904624069e-02   +1.070268831708946e-01   +2.169612315806168e-01   +3.760784738593209e-01   +1.079554028691098e-01   +1.148289101376175e-01];
L2E_L3E_iAMPA_netcon = [+2.594377698570901e-01   +2.548387710968775e-01   +8.656627940924892e-02   +3.371517377386674e-01   +2.268306545249694e-02   +2.018847786907600e-01   +2.630298790994544e-01   +3.626116207925351e-01; +2.115589964517228e-01   +2.840971473368736e-01   +2.871979504982139e-01   +3.104934901115627e-01   +4.147269873778696e-02   +1.983795219206698e-01   +3.330223754590631e-01   +2.672498543435359e-01; +3.279980155384077e-01   +3.433796416898410e-01   +3.233356279024016e-01   +3.524770740833750e-01   +2.262352313226403e-01   +2.553842050151721e-01   +3.419775939641612e-01   +2.258707736587301e-01; +1.558599034679569e-01   +3.704387296565343e-01   +3.328329562706344e-01   +2.347253371463763e-01   +2.017772166791919e-01   +1.984839717832422e-01   +1.044174490954002e-01   +7.106455430722207e-02; +5.506816121456330e-02   +2.181079151243911e-01   +9.791424764326315e-02   +3.437426734718636e-02   +6.773243119604845e-02   +2.117172569978402e-01   +3.455316939074103e-01   +2.963028317890394e-01; +1.927504626638900e-01   +3.839597372548109e-01   +3.476194899124859e-01   +2.119634037520438e-01   +1.978349153139586e-01   +3.752079258359270e-01   +2.797165423481296e-01   +3.799894574834745e-01; +1.887163183525646e-01   +4.475985847001247e-02   +2.025214719182939e-01   +9.427787695687077e-03   +1.390241432512934e-01   +3.126051600030101e-01   +1.359742159899529e-01   +2.980980911870449e-01; +3.621780914342471e-01   +2.659017633687551e-01   +1.696958809811176e-01   +3.046804194812970e-01   +1.360090260783025e-01   +2.945454829993364e-01   +1.984078095916182e-01   +1.648055811258442e-01; +1.793764367408754e-01   +2.168708061653926e-01   +3.428553330665197e-01   +2.413532403718784e-01   +2.205069431611197e-01   +1.344919110330949e-01   +2.340746410144005e-01   +2.618400238927895e-01; +1.075895036469664e-01   +6.131737134938470e-02   +3.030347417854667e-01   +3.369578353291967e-01   +3.480713169797129e-01   +5.018427596999641e-03   +5.350441631335460e-02   +2.500609733038226e-01; +2.231532415585609e-01   +1.272078070660023e-01   +2.860626464356136e-01   +3.168163918576408e-01   +3.654177454737473e-01   +3.737723691281967e-01   +9.814056231262218e-02   +1.446220794046479e-01; +4.419580798740318e-02   +2.292495322749170e-01   +1.628090207981126e-01   +3.345792063906900e-01   +1.913769267408486e-01   +7.846942244647892e-02   +2.532591456456409e-01   +3.324779213724069e-01];
L2I_L3I_iGABA_netcon = [+3.677140385617647e-01   +1.595551179060153e-01   +1.072310036052354e-01   +2.729321384699400e-01   +2.867000575667314e-01   +3.268660067694259e-01   +1.234547003851323e-02   +2.057605372008659e-01; +2.112882434226113e-01   +1.824123443062449e-01   +2.746722088972204e-01   +6.848764234887357e-02   +3.444928925140791e-01   +3.145458485991005e-01   +1.778073972646055e-01   +9.535432259677798e-02; +3.043994486600658e-01   +2.811157242447182e-01   +3.655822559180468e-01   +2.390357614110408e-01   +1.381483747740506e-01   +2.355590564795463e-01   +1.560293753419882e-01   +6.715287394853638e-02; +8.274228592519170e-02   +3.215275388172822e-01   +8.596508509199489e-02   +1.886393425611230e-01   +1.387236991798495e-02   +1.353615448123139e-01   +1.485947114643893e-01   +3.794393396404699e-01; +1.185379947911894e-01   +1.524009486856152e-01   +2.034356813210232e-01   +1.827611916552187e-01   +1.404085450502890e-01   +2.487375923511597e-01   +3.962653835885958e-02   +5.537387935711612e-02; +8.150719639770321e-03   +9.965184813693176e-02   +1.658568043645255e-01   +6.960113351604151e-02   +1.352064939395630e-01   +1.549559646013277e-01   +2.032637161562822e-01   +2.713608630906972e-01; +1.352820309569204e-01   +1.796299500071029e-01   +3.614260713619826e-01   +2.531663076878650e-01   +2.811136989198389e-01   +1.172903822223935e-01   +1.263827240791529e-01   +1.212221820331738e-01; +1.193888510056785e-02   +3.803826316652963e-01   +1.224051622521174e-01   +3.410225830467912e-01   -4.444721072515014e-03   +2.921809886541421e-01   +2.207071285774894e-01   +2.957540743583497e-01; +3.438221752830455e-01   +1.138869540219750e-01   +3.241205209917165e-01   +2.552747265297255e-02   +1.946003701965019e-01   +1.067216562202609e-01   +1.602492645630749e-01   +1.751012869924255e-01; +2.936220931874854e-01   +1.930484962997441e-01   +1.000320858590353e-01   +1.950253503550212e-01   +2.398258650227939e-01   +1.318682459721552e-01   +8.116341315377458e-02   +1.153506210057811e-01; +2.792947970558806e-01   +3.736637721159066e-01   +2.116996281071760e-01   +2.658835555618262e-01   +1.109341270043520e-01   +1.416866304549873e-01   +3.642981326700054e-01   +4.931174876353963e-02; +2.922783543259104e-01   +1.104972071714323e-03   +1.317537207793006e-01   +5.377545446504632e-02   +5.693797385685034e-02   +3.744201451604629e-01   +1.903122220068723e-01   +2.144170238103779e-01];
L3I_L3E_iAMPA_netcon = [+1.696909219225951e-01   +3.839679793510016e-01   +1.020919215483668e-01   +2.386018097676373e-01   +3.006572922232144e-01   +1.260763076753794e-01   +1.139447206834094e-01   +8.997389974360544e-02   +1.293998379014530e-01   +1.070819505692640e-01   +1.046894497747036e-01   +1.986623934076909e-02; +1.533896733594532e-01   +3.294438391439644e-01   +8.720477887649737e-02   +5.320533738488356e-02   +3.248918582266676e-02   +2.100959771682942e-01   +2.119633954121504e-01   +2.160568153843153e-01   +9.054392519964974e-02   +1.891483754794550e-01   +2.915675923222116e-01   +2.198071214799080e-01; +1.150672347456895e-02   +2.406243088793513e-01   +1.834484153760929e-01   +2.280214169739796e-01   +1.880370307051648e-01   +1.753536448671388e-01   +1.981747538977577e-01   +1.763437968131930e-01   +1.385481997260586e-01   +2.184783421622564e-01   +1.782251447503435e-01   +2.146288875837648e-01; +1.547248196665566e-01   +2.889772117709946e-01   +2.467419774321984e-01   +1.670982520361909e-01   +1.720831825539484e-01   +3.439108886425746e-01   +2.931673109672799e-01   +4.880940230615504e-02   +3.586849615103548e-01   +3.526034616788868e-01   +6.355614912414424e-02   +2.891747608312364e-01; +4.370735005344548e-02   +1.330559152033861e-01   +1.237987077017578e-02   +3.307514538402201e-01   +2.969169884515488e-01   +2.123914917216852e-01   +3.737063479515769e-01   +2.452875131507734e-02   +3.425721922133286e-01   +2.219060995525465e-01   +1.454810816714384e-01   +4.724684232356247e-02; +1.319235651666956e-01   +2.623654939682437e-01   +3.214771121166595e-01   +1.640766224329472e-01   +3.832714324250995e-01   +5.922094282852590e-03   +3.495938842597378e-01   +1.000679300894664e-01   +2.632680444547009e-01   +7.956786935604802e-03   +1.328788665048254e-01   +6.107799704934851e-02; +3.128956993839543e-01   +1.412335519773603e-01   +1.528581402065818e-01   +1.103378589597396e-01   +2.577300664499804e-01   +8.073806497781537e-02   +2.163491775423645e-01   +3.578675594139861e-01   +3.234511195189319e-01   +3.778320599047828e-01   +2.017438793146300e-01   +2.781264470621518e-01; +2.842601244839862e-01   +8.548109623288419e-02   +2.803924184055090e-01   +2.284874122853169e-01   +3.810600420971358e-01   +2.296004742660624e-01   +3.958150587479776e-02   +1.937991164740860e-01   +1.707757533205566e-01   +1.183339260673700e-01   +9.548607578207419e-02   +3.640706120218679e-01; +3.788146038574195e-02   +3.279403183184431e-01   +2.823087485625363e-01   +3.136191430876334e-01   +1.439371255357801e-01   +2.848252592025209e-01   +6.801525864421264e-02   +3.066085256882679e-01   +3.209298981364395e-01   +1.793834614289133e-01   +7.860394077227527e-02   +8.952772446981092e-02; +3.572769318699133e-01   +3.039261330383654e-01   +1.528602515447018e-01   +8.967336244246724e-02   +2.202729945491347e-01   +3.014487380804304e-01   +1.958299895388715e-01   +3.383161733855148e-01   +2.574126705271131e-01   +1.299647633601196e-01   +3.442705786849253e-01   +8.553867859932654e-02; +1.700076775835419e-01   +1.360568125874401e-01   +3.808863929039584e-01   +3.689947718391597e-01   +6.836294130737035e-03   +2.412134169223671e-01   +2.905616036751714e-02   +9.377439507446113e-02   +1.734509470654776e-02   +3.734595741015720e-01   +2.904412251029694e-01   +1.395040829570631e-01; +4.014592940166276e-02   +6.845427155787259e-02   +1.797766369078221e-02   +1.743894421713486e-01   +1.682472095608748e-01   +8.857540280497442e-02   +3.072815547695125e-01   +7.232809839002055e-02   +1.263302978937344e-01   +8.990507426140810e-02   +2.964132827339082e-01   +1.086588962345939e-01];
L3E_L3I_iGABA_netcon = [+7.281737628896025e-02   +1.768516606437992e-01   +1.273879009474428e-01   +3.534555624020071e-01   +3.207327595142578e-01   +2.112467208511269e-01   +1.221978936149535e-01   +2.937119982966430e-01   +2.464599050691046e-01   +2.837589101241976e-01   +2.327349171104991e-01   +9.062580518605413e-02; +3.004062005303582e-01   +2.495755189132834e-01   +1.176769511155037e-01   +7.307936860072856e-03   +1.423232911128063e-01   +2.747881961058839e-01   +2.510032442460717e-01   +3.808170608137007e-01   +3.294501482583369e-01   +1.736145227636293e-01   +4.172147225974918e-02   +1.914283707276020e-03; +2.258524724033617e-01   +3.731586838810909e-01   +3.697767769897413e-01   +3.255853571519502e-01   +8.454190691293582e-03   +2.903608473435016e-01   +2.250443286208678e-01   +2.727197449230487e-01   +1.584071373172921e-01   +1.589496494000538e-01   +1.059562400167733e-01   +5.660752505190320e-02; +1.620713037880842e-01   +3.762008556719397e-03   +5.598662547693874e-02   +2.787139682220876e-01   +2.797386997967644e-01   +1.034733815336701e-01   +1.596474230762265e-01   +1.459603594702477e-01   +3.839103864129010e-01   +1.795342884490544e-01   +1.780288197340116e-02   +2.291883139315061e-01; +1.676393113434160e-01   +1.504241696092348e-01   +3.852366950811103e-01   +1.086589265593735e-01   +2.104467977377378e-01   +3.004113083939425e-01   +3.779397205761412e-01   +3.584248308589436e-01   +1.013465600436859e-01   +2.202595046951197e-01   +3.231809213279266e-01   +2.497381970374272e-02; +2.678859804399855e-01   +1.856964852329185e-01   +3.240943049340663e-01   +3.876784207263251e-02   +1.623593173104349e-02   +3.826776189666635e-01   +3.628468884024572e-02   +2.793610210928441e-02   +3.156516666716764e-01   +2.376833234606888e-01   +1.010920457564704e-01   +8.522071389021901e-02; +2.255518722743430e-01   +1.389939458693986e-01   +1.869500686888807e-01   +2.277571099202967e-01   +2.640800800396279e-01   +1.848099693201885e-01   +1.314994505418376e-01   +8.083476900357815e-03   +1.310087617643381e-01   +6.685145894629724e-02   +1.216292099031678e-01   +2.771941148629934e-01; +1.168945471593076e-01   +6.412846746005571e-02   +5.144837636588141e-02   +3.527973861764994e-01   +1.689940197519657e-01   +2.912250456115282e-01   +2.009747789444305e-01   +2.948658360084476e-01   +2.948971707064949e-01   +3.292586217125962e-01   +6.525747738660556e-02   +2.245740581057696e-01; +1.084466024471407e-01   +7.169580332908487e-02   +3.025028667025518e-01   +1.692703885532911e-02   +3.627737876739098e-01   +3.514929885241696e-01   +7.153529130048515e-02   +2.743645624303918e-01   +9.186384668923434e-02   +1.608608402642778e-01   +1.617196521735706e-01   +2.413923976694001e-01; +3.190103558072674e-01   +1.214597599730897e-01   +3.248102073142826e-01   +1.272111142273628e-01   +1.401837788760779e-01   +3.807111545144231e-01   +2.945923680265534e-01   +2.176412514148708e-01   +3.616955865882506e-01   +3.738122712436079e-01   +6.752617069240879e-02   +1.617193182766308e-02; +2.178001860760208e-01   +5.349931815992947e-02   +7.730026929627556e-02   +7.366759432136430e-02   +3.048181440011200e-01   +1.972717037482660e-01   +3.354882312707554e-01   +2.380652702994091e-01   +2.199814767031036e-01   +6.717669832217789e-02   +3.626109421933692e-02   +3.147927748525746e-01; +2.431304311474920e-01   +1.956534540832776e-01   +3.880108751657392e-01   +2.796520716294663e-01   +9.928498722802810e-03   +1.980460710815627e-01   +3.783875925382535e-01   +2.617452074986967e-02   +3.044621922861986e-01   +1.558092008683806e-01   +1.817700777564746e-01   +1.700215530248669e-01];
L2E_Input1_iAMPA_netcon = [+3.843808749587194e-01   +3.872307747518929e-01   +3.850558911914845e-01   +3.886521378249481e-01   +3.905423106531243e-01   +3.906564150506429e-01   +3.909386026517665e-01   +3.848122947568031e-01];
L2I_Input2_iAMPA_netcon = [+3.880581707269739e-01   +3.911428097737797e-01   +3.888146937054307e-01   +3.865502216435455e-01   +3.872559871760488e-01   +3.865289743125854e-01   +3.893453372426804e-01   +3.873004994003664e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
