function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.758733087812165e-01   +1.564996225375279e-02   +2.735280989902553e-02   +3.745506510827746e-01   +3.904873921393262e-02   +3.637043609991698e-02   +2.458334838165195e-01   +2.768350858294873e-01   +1.659856945410463e-01   +8.351976755524954e-02   +5.686452927018447e-02   +6.845594204972960e-02   +2.625441075460324e-01   +6.476532795776644e-03   +1.559912308939137e-01   +1.446679898838053e-01; +5.424606586980858e-02   +1.494173533424214e-01   +3.333423644371470e-01   +3.414458153232893e-01   +1.381100598333840e-01   +6.781651857287055e-02   +1.912295706764039e-01   +1.939635341767853e-01   +5.412358350408506e-02   +4.802718671103420e-02   +3.543055834080965e-01   +3.160394715291810e-01   -7.579434731455428e-02   +8.757137080224886e-02   +1.708822534470265e-01   +4.497472721832411e-02; +2.588175031187310e-01   +4.325227931959069e-02   +5.791468997772462e-02   +1.839394399606323e-01   +1.543717667942107e-01   +9.504049722093169e-02   +2.072325844383756e-01   +3.580360129506140e-01   +1.585097249006223e-02   +2.540011106865649e-01   +4.020306639341380e-02   -1.193649130360546e-01   +7.906338358315790e-02   +3.484887129643756e-01   +9.335564930078520e-02   +2.401218592423000e-02; +1.723090648850280e-01   +2.973352539281368e-01   +9.655944889139390e-02   -1.198010713568607e-01   +3.140327948468696e-02   +2.168893133653661e-01   +2.249731477924813e-01   +2.738952816709702e-01   +2.007567023242226e-01   +2.556341734554793e-01   +1.497752910447839e-02   +1.256996908856571e-01   +7.503799234584337e-03   +1.544353924460725e-02   +2.361645442247496e-01   -1.384773794927739e-02; -7.502225417676354e-02   -4.241847473820151e-02   +2.257131188186468e-01   +2.690707735438791e-01   +2.286850736797121e-01   +1.019950373738045e-01   +1.608235576551354e-01   +3.884247401891919e-02   +1.147426828930818e-01   +2.557119354388821e-01   +1.175358813606770e-01   +1.537122720763668e-01   +1.612620607200068e-01   +1.653512913833349e-01   +1.997307960739748e-01   +8.516774121905826e-02; +1.031047074712896e-01   +3.485873892532592e-01   +2.258160650169593e-01   +1.154240897910533e-01   +3.256663496627084e-01   +7.250983509241299e-02   +7.029904823357468e-02   +2.226200820116964e-01   +2.730755974822416e-01   +2.740781557815633e-01   +2.678973253179387e-01   +2.016766723358593e-01   +2.690862587006686e-01   +8.535925139925082e-02   +3.116762704177697e-01   +2.976638961744681e-01; +3.197211776165709e-01   +1.026149639874965e-01   +7.257672520472018e-02   -2.405489101216579e-02   +3.117447584154217e-01   -5.900193045273068e-03   +1.070732064506794e-01   +1.813865786567139e-01   +5.197546406378063e-02   +2.066726467782807e-01   +1.017761244155046e-01   +1.711999240802808e-01   -1.749339746377491e-03   +3.460496698012909e-01   +1.028731656939582e-01   +3.521162484129126e-01; +1.884458890461738e-01   +1.648246856276954e-01   +2.751265599201551e-01   +2.412939772457167e-01   +2.469533384966978e-01   +1.363830503387481e-01   +3.037525518943207e-01   +6.259200519457549e-02   +1.555245321256285e-01   +1.265360028997897e-01   -8.738470901424468e-02   +6.315319397825982e-02   +1.581310800680485e-01   +1.003704113388952e-01   +1.385489847160991e-01   +1.270380009797056e-01; +2.874784564424353e-01   +2.822009578586925e-01   +1.077448262302590e-01   +3.104906736572580e-01   +1.160968480461534e-01   +1.034032988644732e-01   +3.366922306581253e-01   +2.074473636549694e-01   +3.285806376059653e-01   +3.256813857368835e-01   +2.301221596354238e-01   +2.208725571800350e-01   +3.408210481132958e-01   +2.236744439915724e-01   +2.633225770400298e-01   +3.216134944599878e-01; +2.849265255729310e-01   -2.957924813805679e-02   -5.732929997582665e-02   +9.566712644041017e-02   +1.432248746083159e-01   +1.766449687961084e-01   +4.424306207261031e-02   +1.246274109924128e-01   +2.339889155772478e-01   +3.031555761822331e-01   -6.315284659135792e-03   +1.975710334210956e-01   +2.174494216278058e-01   -1.642123557200901e-02   +2.387046363104008e-02   +1.407691193125445e-01; +1.263819915714307e-01   +1.154403218499865e-01   +9.686750135202757e-02   +1.477246216165720e-01   +2.966426206618281e-01   +1.998546251690407e-01   -4.624577405492028e-02   +9.785594073417649e-02   +8.809471265338298e-02   +3.346524195540983e-01   +2.335456110990795e-01   +9.498722024486402e-02   +1.987508285941059e-01   +3.006754289181034e-01   +2.673189878120743e-01   +1.850445838431632e-01; +1.738745306472957e-01   +1.671144068369493e-01   +5.394631150077121e-02   +3.927855541372494e-01   +1.103888288609874e-01   +1.767714080475991e-01   +2.341750094871081e-01   +2.730232700654247e-01   +7.013902775992194e-02   +1.294102675598008e-01   -7.099049978912945e-02   +1.145038283964893e-01   +3.024957004964666e-01   +2.793285846245049e-01   +4.545951579310984e-02   +9.399396659585917e-02; +1.748670018237712e-02   +2.451551663166984e-01   +9.986841692166878e-02   +6.760703683126994e-02   +1.547187699252980e-01   +1.955048889227802e-01   +2.882777493266153e-01   +1.712304270808802e-01   +1.481203718204946e-01   +1.625050579082238e-01   +3.148975504951610e-01   +1.870060066533727e-01   +1.619055772414777e-01   +2.717289830368174e-01   +1.900964110670422e-01   +7.777908930393232e-02; +1.289761661022537e-01   -2.756893507977237e-02   +5.144119267571232e-02   +9.778682452134037e-02   +1.994383893502246e-01   +3.709348758177713e-01   +3.121185783410236e-01   +1.932126973994890e-01   +3.743740622934442e-02   +2.008828973520003e-01   +6.572162300943647e-02   +2.893905760496093e-01   +1.556104871686021e-01   -2.078102802443369e-02   +1.358970104937413e-01   +6.026387537850907e-03; +3.219035955741106e-01   +1.163601956756977e-01   +2.824894466429284e-01   +9.938925815749501e-02   +2.777466522416270e-01   +1.681895399104775e-01   +4.962207884436139e-03   +2.337052074625462e-01   +4.324227749644183e-01   +1.959963802307540e-01   +2.617100817194987e-01   +2.614677870483911e-01   +2.868728287938086e-02   +2.590384178447494e-01   +3.130496582519987e-01   +1.012655364864125e-01; +2.181327506016850e-01   +4.354348044446500e-02   +3.126942783174967e-01   +1.650346198363751e-01   +1.155688229758061e-01   +7.466233175054755e-02   +2.750681103024110e-01   +7.162152100005133e-02   +5.609937717541127e-02   -4.225156591286405e-02   -4.928340824827000e-02   +9.192754071905450e-03   +3.237401434465393e-01   +9.159559265435858e-02   +2.169386540261759e-01   +2.230426465275596e-01];
L1E_L1I_iGABA_netcon = [+1.211898083532388e-01   +2.007029504676105e-01   +3.291536804777143e-01   +9.731755478482486e-02   +4.168484481734999e-02   +1.363160518185090e-01   +2.910255154931359e-01   +3.675854105500160e-01   +2.098576291807565e-01   +1.072380984869752e-01   +3.128997026677511e-01   +1.972372316115554e-01   +8.817728733287120e-02   +1.492643073283268e-01   +1.184388546710649e-02   +1.836920039002913e-01; +1.885637586555225e-01   +3.799548781050455e-01   +1.571445931622980e-01   +1.044813705150587e-01   +2.697528066485434e-01   +1.437594253323733e-01   +3.782779708422239e-01   +2.818566316846731e-01   +2.785820551028897e-01   +3.432390006937865e-02   +3.447962535627234e-02   +2.726854922423775e-02   +1.893775544509946e-01   +2.425157524267198e-01   +1.386443673922483e-01   +1.375354277667331e-01; +1.431479178013487e-01   -4.853789006439586e-03   +9.220500268395905e-02   +2.809160577234851e-01   -2.168364267969087e-02   +2.000782116521958e-03   +1.124734002612984e-01   +4.964790858192965e-02   +6.567302569022349e-02   +1.949103552858060e-01   +2.256746819375543e-01   +1.357516539097264e-01   +7.381454448525740e-03   +1.299116036227322e-01   +1.331220180133135e-01   +1.357745955183785e-01; +1.211433906316397e-01   +5.277763826255138e-02   +2.659479152154243e-01   +2.667787767025593e-01   +6.987535258751212e-02   +2.265066831382342e-01   +2.929598764595415e-01   +3.846831326209417e-01   +9.602371125962467e-02   +1.666406458867045e-01   +2.549567835477292e-01   +3.610437029939396e-01   +3.089706140703896e-02   +2.054228905080001e-01   +2.403332229280640e-01   +1.955510126580588e-01; +6.191282151508026e-02   +4.737384706252562e-02   +3.166642747678698e-01   +2.034865077549659e-01   +4.869158281660400e-02   +1.674034742087502e-01   +3.715729538030760e-01   -1.623104449851536e-02   +1.576819299733500e-01   +1.876717178281944e-01   +3.654153320520662e-02   +1.676573293181170e-01   +1.840058960942682e-01   +1.707949578857337e-01   +1.793850955186698e-01   +3.159015513070363e-01; +2.517011425308499e-01   +2.274893854686635e-01   +2.727110313586027e-01   +1.936188726175674e-01   +9.255937124207017e-02   +2.999840023271795e-01   +2.241519279866950e-01   -2.730775695817940e-02   +2.169389801946301e-01   +2.164846965406373e-01   +2.563200711249458e-02   +7.045167014780210e-02   +2.071029544900060e-01   +2.528400364175611e-01   +1.507528704971134e-01   -2.325760921044262e-02; -8.698914060498183e-03   +1.062250542433537e-01   -6.684277141412615e-02   +2.237677152965396e-01   +2.305835045895768e-01   +1.865027625066555e-01   +1.716585349611850e-01   +2.757702084926267e-01   +1.324148710836399e-01   +2.791184501717614e-01   +1.901747788970459e-01   +3.272438685804290e-01   +2.366084557633965e-01   +2.312560644600734e-01   +1.451107679944913e-01   +1.256079266968088e-01; +2.573124442993649e-01   +5.333341852276643e-02   +5.244268691337360e-02   +1.334464747504613e-01   +3.464209996779463e-02   +6.477664201910616e-02   +1.909605347664699e-01   +1.372713564662837e-01   +2.584350087457973e-01   +3.575179822063956e-01   +2.066756458394148e-01   +5.978458212777107e-02   +1.035922719418080e-01   +1.767651626119786e-01   +1.439523490720316e-01   +9.082788237380757e-02; +6.991431751723556e-02   +4.197060275047722e-02   +2.197970445260261e-01   +9.910644949209252e-02   +1.532275546813665e-01   +9.936128599104226e-02   +1.501408609066663e-01   +1.997480350556590e-01   +2.366653536660069e-01   +1.263305632718400e-01   +2.373404364133895e-01   +1.922374090953557e-01   +7.039447113835443e-02   +6.098874209494933e-02   +1.616715353951123e-01   +1.049826713691885e-01; +2.698724243251105e-01   +3.590152093868252e-01   +2.159851687300277e-01   +2.894759783163934e-01   +1.239849932921471e-01   +2.661355889346482e-01   +8.284194909029634e-02   +2.080895599215557e-01   +3.043287672655171e-01   +1.659418281138055e-01   +1.648717890074967e-01   +7.864918294968158e-02   +4.699933530926221e-02   +3.170891519123989e-01   +2.108318355548734e-01   +9.825459588334066e-02; +3.053817918512663e-01   +3.384713073271395e-01   +2.464812603242929e-01   +1.093390385744645e-01   +3.665250760306420e-01   +5.569732525656814e-02   +9.091425653960000e-02   +2.892086268812535e-01   -4.384802507648743e-03   +1.232316788062423e-01   +1.565787279969683e-01   -2.876187137349978e-02   +1.752202625970544e-01   +2.225076620878175e-01   +2.323057918811068e-01   +1.266489981068140e-01; +2.901709314590890e-01   +7.423307690583800e-02   +2.641797637632706e-01   +2.411142822439423e-01   +1.448401744073687e-01   -7.239929602308046e-03   +1.142086900783892e-03   +2.645634561691666e-01   +2.029872244202271e-01   +2.859995958508311e-01   +2.706863702706225e-01   +2.296800091306452e-01   +1.154656916166760e-02   +3.169919749841200e-01   +3.073801350032708e-01   +9.920737437445286e-02; +1.717486105606942e-01   +1.403328535450122e-01   +2.163061298022480e-01   +3.187532859010460e-01   +3.152116533090552e-01   +1.877105053516191e-01   +2.513576342648880e-01   +4.660700472654454e-03   +3.710928380588618e-01   +1.575191942548206e-01   +2.524797610687667e-01   +3.548717821148960e-01   -4.712212112607687e-03   -1.874663325580869e-02   +8.409720789171963e-03   +3.059014039573371e-01; +1.315254740013871e-01   -1.458183972547667e-02   +5.982994749254225e-02   +7.845909284353952e-02   +1.506668521124370e-01   -8.336125662204702e-03   +1.704459404134090e-01   +2.366041029888599e-01   +2.820977116415235e-01   +2.965649953528701e-02   +1.699301629484876e-01   +1.161990195326721e-01   +3.077764614602412e-01   +2.503540780495597e-01   +2.318989972010412e-01   -2.414359847666888e-02; +3.023089298758587e-01   +3.009706209136649e-01   +4.084681381234985e-01   +1.900992493805931e-01   +2.010623241401397e-01   +1.823082564347659e-01   +2.781554183002282e-01   +1.936815650952668e-01   +1.619584990816615e-01   +2.485827960606917e-01   +5.906227695509642e-02   +1.423369744556901e-02   +3.175985536305352e-02   +4.615082268358409e-02   +1.699550643701027e-01   +1.503799913443799e-01; -2.396257754065554e-02   +4.556638878341571e-02   +1.978159921437201e-01   +1.462505527008303e-01   +2.444747357987562e-01   +2.572939602803078e-01   +3.700004191148749e-01   +1.191230052419583e-01   +3.064057438692332e-01   +3.643477192234867e-02   +2.910366288173886e-01   +3.309541131507923e-01   +7.441279748517568e-02   +2.831998796503850e-01   +5.015474234543447e-02   +1.760009352555260e-01];
L2I_L1I_iGABA_netcon = [+6.588558108771667e-02   +2.410402924230394e-01   +8.887413998879881e-02   +2.921089217199444e-02   +9.645863174043323e-02   +1.897214188429789e-01   +5.042262454883305e-02   +2.233031363406686e-01; +2.133367670708357e-01   +1.109941334242759e-01   +3.196712354780843e-01   +9.576495246385579e-02   +1.123987845809668e-01   +1.708985536334368e-01   +2.171434964238645e-01   +5.778125132288191e-02; +1.395462648428534e-02   +5.274777150357454e-02   +2.453892865364450e-01   +3.311637200180886e-01   +5.797792479157163e-02   -6.406961281875134e-03   +1.882165742499732e-01   -6.219641993601550e-02; +2.099646440256220e-01   +1.646044854799099e-03   +6.828987960863361e-02   +3.427821653498491e-01   +1.270566769030271e-01   +3.615857426610970e-02   +6.150786031481503e-02   +2.384638240336491e-01; +3.147746117114086e-01   +1.067056942347222e-01   +9.425115748691579e-02   +1.754210603600726e-01   +4.009470607839222e-01   +3.179095914568058e-01   +2.944039667044643e-01   +2.728346693324574e-01; +3.248120047679831e-01   -3.466454772378125e-02   +3.346528066675916e-02   -1.925393234769593e-02   +3.406012701021361e-01   +1.144842968417152e-01   +1.471284244185380e-01   +2.229847792868466e-01; +1.696331235133182e-01   +2.500296506929297e-02   +3.341124393816925e-01   +1.499393685223002e-01   +9.816314555369110e-02   +1.522709052109356e-01   +1.898068018437260e-01   +1.446958214899464e-01; +1.659476023717311e-01   +6.818599158683587e-02   +3.034464164971477e-01   +5.079692596632124e-02   +6.061068986341136e-02   +1.487774898456166e-02   +1.737267179930220e-01   +1.310307073674183e-01; +3.285128231348430e-01   +1.924992245371391e-01   +2.041630608865113e-01   -2.193351588270647e-03   +1.773211580448051e-01   +3.311889641965667e-01   +2.296875923616578e-01   +1.054370574674666e-01; +1.495809336417990e-02   +1.240934708899008e-01   +2.541134972937737e-01   +1.362336206576484e-01   +1.926055986971257e-01   +1.185501026840496e-01   +1.717858708200960e-01   -1.109827360762734e-01; +2.509380439489507e-01   +3.538239755272568e-01   +1.594115818342747e-02   +2.794919948324758e-01   -8.447696170955886e-03   +1.435337689361225e-01   +2.620963255525359e-01   +3.423660999260927e-01; +3.208556269891014e-01   +3.275206007217704e-01   +8.753883878918045e-02   +2.507190190670684e-01   +2.709659072684754e-01   +1.265355254705464e-01   +1.252741138985614e-01   +2.557302112168549e-01; +2.390174768696087e-01   +3.112266281720304e-01   +2.373999540257150e-01   +3.461294795357646e-01   +1.432691586349823e-01   +1.700821908991782e-01   -1.531487234393459e-02   +1.909475094236476e-01; +2.050847163652453e-01   +3.233591789720193e-01   +3.328845753210909e-01   +2.157304431460852e-01   +2.646148588747171e-01   +3.355466302809659e-01   +1.981012971261943e-04   +1.130258112246874e-01; +1.855571471936669e-01   +2.227862826461573e-01   +2.061410691342092e-01   +2.065544037001274e-01   +1.814708369702852e-02   +7.038996840666867e-02   +1.010411726795858e-01   +1.347395553731829e-01; +2.774804776720677e-02   +3.181459737841933e-01   +1.343074608841742e-01   +2.941294422494214e-01   +2.719947610041852e-01   +4.433391147867543e-02   +2.992317502335170e-01   +4.996609881152334e-02];
L1I_L2I_iGABA_netcon = [+2.999345482368909e-03   +3.096233098498347e-01   +1.333221075001169e-02   +2.098103829608275e-01   +3.730601208648020e-01   +1.398131204927943e-02   +2.006963291554208e-01   +1.505590503409692e-01   +7.178021681216645e-02   -5.540348533508779e-02   +1.391919900780518e-01   +1.224218853381773e-01   +2.496337893076063e-01   +1.941682840536635e-01   +2.688019115555412e-01   +1.056666042588103e-01; +1.174625680582925e-01   +3.883844859943070e-01   +1.578420639622090e-01   +1.673042094539123e-02   +3.413423295898036e-01   +1.825375650685641e-01   +2.405038820593480e-01   +3.254367683975571e-01   +1.071766373647713e-01   +2.630082637352562e-02   +2.957808849851579e-01   +2.238053955743552e-01   +1.441409984239792e-01   +6.239404987163299e-02   +2.225793560366747e-01   +3.217404910562771e-01; +1.791711404833776e-01   +1.053652895898094e-01   +2.625013153182236e-01   +2.387133435040033e-01   +7.270861347068221e-02   +9.196982834632900e-02   -1.277807133081293e-02   +4.273140057826512e-02   +2.206139498408434e-01   +7.755634688089968e-02   +2.765579403825277e-01   +1.310826852491218e-01   +1.230685741066859e-01   +3.198315732998930e-02   +1.653390274657795e-01   +2.542267532469572e-01; +2.193075103987076e-01   +2.735562217703730e-01   +1.555305841808645e-01   +1.364064870589783e-01   +2.804680826133935e-02   +1.723656261741909e-01   +1.225874172415061e-01   +2.740770428614633e-01   +1.061588160868070e-01   +2.097244739621733e-01   +3.447244125019542e-02   +2.045739323897775e-01   +7.091528333366842e-02   +2.607700380091927e-01   +1.730635352875220e-01   +1.980134227889656e-01; +1.156956984385288e-01   -1.589487926513880e-05   +4.053950689534074e-01   +2.631811055531471e-02   +2.681670413657911e-01   +2.870616162516265e-01   +7.485980886764367e-03   +2.091311683902973e-01   +2.123573839008562e-01   +4.717831205992736e-02   +2.102406218125820e-01   +5.252305042526752e-02   +2.332745266084339e-01   +1.022923238906433e-01   +1.877612382077693e-01   +1.002832323946551e-01; +3.373602848077976e-02   +1.960104076556309e-01   +5.343190002485183e-02   +2.913809454902903e-01   -4.936490201261125e-02   +3.869859053398606e-01   +3.444084896365775e-01   +1.003396650836991e-01   +1.704557220229760e-01   +1.026353921619931e-02   +3.574846391432001e-01   +1.790933930773442e-01   +1.769906738504600e-01   +2.135784801184419e-01   +1.550253757241734e-01   +2.509374206936575e-01; +5.013486935628231e-02   -1.466928959262130e-02   +2.505095990128224e-01   -5.656137615747397e-02   +1.932946377440123e-01   +5.266803953325493e-02   +2.870200180172235e-01   +2.322650540223657e-01   +2.412548088903503e-01   +2.439981249618902e-01   +1.077001064210756e-01   +2.188414352288608e-01   +1.384680001122646e-01   +6.286194777152057e-02   +3.674208988527543e-01   +2.662198590732609e-01; +1.463735273119103e-01   +1.754741794467709e-01   +3.227673590837206e-01   +1.163363300498427e-01   +1.104871459971273e-01   +1.886465055841487e-01   +7.861007469715589e-02   +3.345730570319209e-01   +4.170647702639738e-01   +1.092593591182804e-01   +1.788283077581246e-01   +2.980628625692899e-02   +1.748518604878843e-01   +1.922557632139906e-01   +2.841906786950574e-01   +2.004970337723645e-01];
L2E_L1E_iAMPA_netcon = [+2.442825447966998e-01   +1.498615121123741e-01   +8.207813110521231e-02   +2.237953116619804e-01   +4.747492884012880e-02   +9.133828090483870e-02   +1.932282647556097e-01   +1.389904129675974e-01; +2.928726711052838e-01   +6.720352476165872e-02   +3.220867352242643e-01   +1.480467336374743e-01   +5.740361736771483e-02   +1.509935091118374e-01   +6.735547128798251e-02   +1.720530981794803e-02; +1.370271351607330e-01   +2.603614544950310e-01   +2.011332895953957e-01   +1.514001879979322e-01   +3.727265326672727e-01   +1.161752082946850e-01   +1.482904187053332e-01   +9.569088141820496e-02; +1.601756752598306e-01   +2.705175921139227e-01   +2.476346024710298e-01   +2.856540014435490e-02   +4.097718750812910e-02   +3.732045846155730e-01   +2.841389458854324e-02   +1.016915773114561e-01; +5.707204625433630e-02   +1.229131453912212e-01   +1.324626811235533e-01   +3.473328012145801e-01   +2.660778675483820e-01   +2.948921534921036e-01   +1.170630930259649e-01   +4.976913231374132e-02; +1.300766209701587e-01   +1.043917564590802e-01   +3.010228846377557e-01   +1.753913777377530e-01   +1.263656296188941e-01   +1.647102499767456e-01   +3.156139958309613e-02   +8.170980857489896e-02; -2.940247524819928e-02   +2.484805200501950e-01   +2.381660645411162e-01   +3.860215664654446e-01   +9.545858425855226e-02   +9.309137251858535e-02   +9.003535351226531e-03   +1.710909565287819e-01; +9.789890378646081e-04   +1.529701509233316e-01   +2.337044357033408e-01   -1.069211719177311e-02   +1.381436636322175e-01   +1.873278614518174e-01   -2.226195846341137e-02   +3.039316358140672e-02; +3.079975093417643e-01   +2.504876520922341e-01   +2.539442547011195e-01   +3.056458762968655e-01   +2.721369005947554e-01   +5.654645145962887e-02   -3.358847870352503e-02   +3.016440424372689e-01; +1.588386220608297e-01   +4.769352591413989e-02   +8.583726982320548e-02   +1.040510276575953e-01   -7.441659015847306e-03   +2.823923122446288e-01   +1.799282802109747e-01   +1.808945351718717e-01; +8.998358402796344e-02   +6.477921625630798e-02   +5.689821781417070e-02   +1.140870150252174e-02   +2.956747091525595e-01   +8.883952298310635e-02   +9.541972736617564e-02   +1.226390115262145e-01; +1.436437368714527e-01   +1.191328199758873e-01   +9.666086767873179e-02   +4.461815045559175e-02   +1.287316357617727e-01   +3.819163688455373e-01   +2.243488673759284e-01   +2.938546389585464e-02; +2.971106209490451e-01   +3.354207894752336e-01   +4.198189561542780e-02   +3.757067739783676e-02   +9.154640416542496e-02   +2.822168458712732e-01   +1.499209592673982e-01   +3.969515784490358e-01; +1.335717887355003e-01   +1.319191586439450e-01   +2.995781599599072e-01   +1.063711638678680e-02   +1.610885735325376e-02   +7.197247910891658e-02   +2.355166982903244e-01   -9.464749199211552e-03; +2.543748640261558e-01   +3.305794034969484e-01   +1.295946173855898e-01   +9.665342314405798e-02   +7.120705688076986e-02   +6.350145801988002e-02   -3.833056991938687e-02   +3.045810282439329e-01; +2.805032413701875e-01   -8.593891525248026e-02   +9.688553060663288e-02   +2.194507684209184e-01   +2.675300683738871e-01   +2.106791916764517e-01   +1.013449976068262e-01   +3.894280909598111e-01];
L1E_L2E_iAMPA_netcon = [+9.433957167702089e-02   +1.583136532336926e-01   +1.524186302897976e-01   +6.084171688220985e-02   +4.893307063277388e-02   +1.435789877255108e-01   +1.175317069495170e-01   -4.090427405478692e-02   +5.195081507320626e-02   +3.238395275976848e-01   +3.078070047648289e-01   +2.703952032385754e-01   +2.268732013687401e-01   +2.855432060555855e-01   +7.809413398564072e-04   +6.646505881538284e-02; +3.055002171174771e-01   +4.246698819134646e-02   +2.297152162085887e-02   +1.819391076403815e-01   +1.486438241902745e-01   +6.991816948586925e-02   +1.459689828421801e-01   +1.422424602248586e-01   +3.194496316432232e-01   +2.118374504334780e-01   +1.096771893469669e-01   +2.729571026508634e-01   +1.186621172131882e-01   +2.236408884524890e-01   +9.578881263017862e-02   +1.271377375510375e-01; +1.696884083306930e-01   +1.181504589526376e-01   +1.053094337547739e-01   +1.300481264889536e-01   +2.457781684036335e-01   +1.479744139077300e-01   +2.393267208518750e-01   +1.601662426978183e-01   +1.114426141860646e-01   +2.281658962886068e-01   +2.768447554882137e-01   +1.391387348220596e-01   +1.059211456842334e-01   +1.773554634723776e-01   +1.305648426054815e-01   +1.852575247469553e-01; +3.421865071920451e-01   +3.434700105262063e-01   +2.798757539874565e-02   +1.305434132405753e-01   +1.019342808279571e-01   +1.726419981945804e-01   +2.227408908612883e-01   +7.119302129580510e-02   +1.315892983788456e-01   +2.473741542280282e-01   +1.867354488542944e-01   +2.648667814507810e-01   +2.348958487408139e-01   +2.667568108971280e-01   -1.015783120587820e-01   +8.127710347803146e-02; +5.756620920871922e-02   +8.167821217474566e-02   +2.754833546179241e-02   +2.026838730598668e-01   +2.085610698643092e-01   +3.451608639950819e-01   +2.633412362752122e-01   +1.009062850588320e-01   +1.119245183163325e-01   +3.032104975156044e-01   +3.015813092176348e-01   +1.445028970920370e-01   +1.885560238082885e-01   +1.608203844648932e-01   -7.941635564227954e-02   +2.129087351044490e-01; +1.343388747991511e-01   +2.481325885741836e-01   +2.874699468351303e-01   +2.201659269910667e-01   +2.561638877390278e-01   +9.051994454836548e-02   +1.957375131083260e-01   +2.700741272811551e-02   +2.490379536542948e-01   +2.239003001605070e-01   +1.951528080882124e-01   +1.931675031876132e-01   +3.067350998278533e-01   +1.265692941238927e-01   +9.055956564678094e-02   +2.946266262821629e-01; +2.527558591116016e-01   +2.475263014402239e-01   +2.625570111081979e-01   +1.954445332441159e-01   +1.214291902954969e-01   +1.338396556900164e-01   +1.099963872569223e-01   +7.015390914294331e-02   +1.756841939533015e-02   +1.754867818589768e-01   -2.940716999595051e-02   +2.953616327699592e-01   +1.929741669552120e-01   +3.973443801142220e-01   +6.391903681531638e-02   +1.804227754271652e-02; +1.423126662282561e-01   +2.966003685382799e-01   +2.519393260067758e-01   +1.267450142074455e-01   +1.057724468420327e-01   +9.857799539336284e-03   +2.450585041020933e-01   +1.252246918749710e-02   +2.023319241223833e-01   +3.126159437005553e-01   +2.142072325669063e-01   +1.262859885902038e-01   +3.149802456328955e-01   +5.804840426149486e-03   +1.754718295376843e-01   +2.083591521729614e-01];
L2I_L2E_iAMPA_netcon = [+1.256628458395400e-01   +2.578935114138100e-01   +7.172652386198812e-02   +1.686929414735739e-01   +1.322965522393629e-01   +8.931386796122168e-02   +2.973871657103159e-02   +1.788858538153620e-01; +3.175962153048654e-01   +4.130597256523715e-01   +4.944136961701093e-02   +3.207630443094845e-01   +1.504465628219092e-01   +1.851436359877659e-01   +3.010982761425763e-01   +1.909530725778198e-01; +7.988515340664096e-02   +2.555589354337515e-01   +8.612680654761055e-02   +2.007968933750317e-01   +9.252296565322082e-02   +1.880638771504837e-02   +5.709342643087328e-02   +1.937432353484069e-01; +3.250557812260376e-01   -3.314507605826560e-02   +2.506823061950510e-01   +2.289172252505326e-01   +2.798213820297241e-01   +5.256960768889800e-02   +2.798634651213479e-02   +3.551188347314828e-01; +4.668383742533495e-02   +3.250044202267183e-01   +3.595737514708282e-02   +2.722738661484013e-01   +6.674793080773847e-02   +1.563310219330697e-01   +1.810740057499650e-01   +3.324303383981854e-01; +1.694375431203111e-01   +1.333155429271688e-01   +2.428468395643240e-01   +2.007143107596267e-01   +2.780165372112735e-01   +3.422873350866902e-01   +2.701317574318804e-01   +1.249889597146876e-01; +2.429328329907017e-01   +2.044530637870129e-01   +2.847401246088148e-01   +7.185438894161834e-03   +1.495209101382699e-01   +2.097265111681204e-01   +1.378144850399235e-01   +3.335702583927254e-01; +1.452026166834265e-01   +2.786881340813342e-02   +2.940978704310527e-01   +2.574290900702201e-01   +9.735320409593963e-02   +2.397309822725677e-01   +1.136238468881241e-01   +4.158692914462123e-02];
L2E_L2I_iGABA_netcon = [+1.203860678894828e-02   +3.723262492016207e-01   +2.463891860687356e-01   +1.490089251835574e-01   +7.930850513260215e-02   +2.164348245814493e-01   +1.430856518621898e-01   +1.699590036749779e-01; -7.018500281357122e-03   +8.910696084134245e-02   +2.442764878185490e-01   -1.454108649490798e-02   -1.180987296002013e-02   +2.522054211969957e-01   +1.990353576473731e-01   +1.391806226083188e-01; +2.074822769860606e-01   +1.558549901655344e-01   +3.206700081801466e-01   +1.821039839242014e-01   +4.437288102300720e-02   +3.236689895666306e-02   +2.449247049136377e-01   +1.290263397728760e-01; +2.974774877657341e-01   +2.166823289474273e-01   +6.069775517690320e-02   +3.339312006533183e-01   +1.197973376225620e-01   +1.006410234424877e-01   +9.941332642120111e-03   +1.613014042781755e-01; +1.776743619811592e-01   +2.884624874747823e-01   +1.890423026992246e-01   +8.213951132380709e-02   +6.838594862965611e-02   +1.645522089023187e-01   +3.364413246707230e-01   +2.814198357263293e-01; +1.116577097086245e-01   +1.626283173981415e-01   +3.581411489098499e-01   +5.538476998947804e-02   +7.800730701491129e-02   +1.611062105677500e-01   +1.698188687659737e-01   +8.092927641447981e-02; +5.194578416019976e-02   +6.642051401909346e-02   +3.012797050262114e-01   +3.316551020979163e-01   +3.672415198682803e-02   +3.149665627623206e-01   +1.739285628662385e-01   +2.814590843256471e-01; +2.416654528749244e-01   +3.210451934570249e-01   +5.802818457529629e-02   +3.298823365215303e-01   +1.103226203167996e-01   -2.319648742301333e-02   +3.576930259788298e-02   -4.334439883339745e-02];
L3E_L2E_iAMPA_netcon = [+1.633509790246160e-01   +1.091203824090206e-01   +6.805346468307012e-02   +1.225061463136090e-01   +2.680893180024170e-02   -6.195191892406240e-02   +4.761855353630182e-02   +7.735653767797120e-02   +6.403657303068849e-02   +7.126212453926280e-02   +2.735027879137018e-01   +1.912056845475869e-01; +6.653193275952274e-02   +7.892554611700144e-02   +1.846662465940912e-01   +1.474649298086500e-01   +1.029981800633078e-01   +3.305884269422650e-01   +1.960389411898767e-01   +1.226942025970139e-01   +2.627071528208440e-01   +1.930381515980045e-01   +1.061390472351987e-01   +1.596890504203000e-02; +2.622672555304716e-01   +9.923839852659551e-02   +1.289978528664065e-01   +3.009687527191961e-01   +2.922811484965878e-01   +6.571779190559840e-02   +2.515305589893289e-01   +2.306506759741231e-01   +1.818990912611643e-01   +7.262830002483514e-02   +2.319858612247429e-01   +8.485811187159123e-02; +3.018807624572502e-01   +4.508629280698481e-02   +1.204428595898039e-01   +3.159967367686151e-01   +1.592660648923482e-01   -3.178136923279234e-02   +3.250768055672183e-01   +1.583813474945470e-01   +9.162107742822111e-02   +8.509951055740451e-02   +1.263312305332921e-01   +1.990554214212543e-01; +2.118355898888711e-01   +4.070444756313334e-02   +2.699668727278542e-01   +7.023405783333017e-02   +1.094891487949481e-01   +1.767451570144607e-01   +2.828707508275642e-01   +2.583383823121900e-01   +3.354632197654711e-01   +7.069598534804862e-02   +2.041871942204838e-01   +3.702672688154237e-01; +1.628836194533082e-01   +4.427797095711754e-02   +9.951748723150977e-02   +1.162503328778649e-02   -2.494148405365458e-03   +1.877497413594430e-01   +2.304732547903919e-01   +6.532999495209534e-02   +2.279623269228030e-01   +2.824480837541759e-01   +2.899309208274119e-01   -4.636259052611074e-02; +4.073470750463510e-01   +2.660147860714256e-01   +1.531960126071887e-01   +3.959957009926846e-02   +4.024582267142963e-01   +1.050485884186429e-01   +1.434538034102167e-01   +1.425867565558793e-01   +1.484959862671100e-02   +1.022836035521810e-01   +7.450316368959503e-02   +2.794517707429158e-01; +6.500179849624402e-02   +2.259643616042036e-01   +1.733349164655383e-01   +1.110782129772874e-01   +2.334514414640642e-01   +4.868509969891367e-02   +2.545118946143201e-01   +1.812202888014470e-01   +8.631960878394523e-02   +1.033326004252615e-01   +5.560834619553759e-02   +3.321636556165508e-01];
L3I_L2I_iGABA_netcon = [+1.830447934381261e-01   +8.330156144812198e-02   +3.202164424830268e-01   +1.424021732502941e-01   +2.324157207756830e-01   +3.052937929456365e-01   +1.179038413806391e-01   +2.364336570846153e-01   +1.166014073703802e-01   +3.672121763313294e-02   +7.010317628887713e-02   +2.135865572441785e-01; +3.139954881617372e-01   -1.242294148803069e-02   +1.260087716166811e-01   +1.723323814917427e-01   +3.079152230168955e-01   +2.225938077541326e-01   +5.319177980168385e-02   +2.273231823939073e-01   +3.711957620003496e-01   +1.776606501310401e-01   +2.762054762465113e-01   +3.139454408347698e-01; +1.232110862082112e-01   +1.416729085990606e-01   +1.990069807269569e-01   +2.842544110675193e-01   +2.789587926579475e-01   +2.256078628534159e-01   +2.613771765982504e-01   +1.350985725679361e-01   +2.881726839712563e-01   +2.879140306689376e-01   +1.033565110551745e-01   +4.200119260960526e-01; +3.008244774842891e-01   +4.448802680019948e-02   +2.438005452206196e-01   +1.844581169045813e-01   +2.279828005373601e-01   +1.135471179245521e-02   +2.706876028962305e-02   +3.176251478318703e-02   +1.121809344845455e-01   +1.221128871299799e-01   +5.312868115509198e-02   +1.622877253929461e-01; +2.026192800022376e-01   +3.652696961810845e-01   +6.398063565727838e-02   +2.663807449792647e-01   +2.517618562776389e-01   +1.485109107666609e-01   +4.630513313676327e-02   +1.339296130636972e-01   +1.284435507129098e-01   +2.204561595718580e-01   +9.592264220649278e-02   +2.025989340721701e-01; +2.431365490833280e-01   +3.547243577824407e-01   +1.625865112274826e-01   +2.700628833343437e-01   -5.766453304351281e-02   +1.609923322549249e-01   +1.830964568540067e-01   +1.554096488110552e-01   +1.549078091958162e-01   +6.654241354848521e-02   -6.183896071700695e-02   +3.518376965468373e-01; +5.372753702711551e-02   +1.686886810991049e-01   +1.409017119095873e-01   +3.192317383635521e-01   +2.589053351598984e-01   +1.645765498194327e-02   +2.788127340691338e-01   +2.242203717970542e-01   +3.122413091642205e-01   +1.336570462352674e-01   +1.196523629297659e-01   +2.713444442439442e-02; +9.012788101254163e-02   +1.588506448456269e-01   +8.368007437686047e-02   +1.219852612997666e-01   +2.735883691329901e-01   +3.813815100858004e-01   +2.285444383233246e-01   +3.684583474834916e-02   +1.251875130587999e-01   +1.559517332215392e-01   +1.227637908105598e-01   +2.665442525598578e-01];
L2E_L3E_iAMPA_netcon = [+2.287607888622574e-01   +1.793254545345542e-01   +9.948495708389998e-03   +3.007856056596294e-01   +1.424288408688852e-01   -5.043872485120625e-02   +1.852800969408667e-01   +6.333443590175615e-02; +3.667348214791984e-01   +2.551945058181584e-01   +1.462402279678607e-01   +8.613806343476763e-03   +2.474169502844943e-01   +1.816888314943551e-01   +1.117357044399321e-01   +1.176849046904665e-01; +1.268085571651753e-01   +2.753143568077294e-02   +6.697408534610230e-02   +2.144135991356347e-01   +3.091681585173293e-01   +2.394982365661006e-01   +7.671818296494279e-03   +2.315875435367436e-01; +1.779350714756271e-01   +2.113221697224735e-01   +1.132038084789091e-01   +8.826119177388372e-02   +7.998572392048636e-02   +1.659422777279148e-01   +1.177468072496339e-01   +2.080035940111778e-01; +1.912683055383230e-01   +2.220969756013531e-01   +1.954695426312002e-02   +3.214188315500363e-01   +1.222548270780916e-01   -4.330601167551199e-02   +3.404141563230742e-01   +3.325376299864564e-01; +2.228193257506046e-01   +2.226398323581494e-01   +1.862878856869733e-01   +6.682269929000051e-02   +3.501619611926218e-01   +1.675884101071494e-01   +1.808053868962660e-01   +2.942843732750539e-01; +1.835505228391758e-01   +3.351612785473921e-01   +1.792514804864525e-01   +9.076293946631518e-02   +6.278667941783518e-02   +1.766476829658022e-01   +6.186388829535878e-02   +2.980384730470749e-01; +1.508591116920160e-01   +1.338872477553492e-01   +3.200833168546917e-01   +1.030321356897083e-01   +1.134625003409659e-01   +1.230615547015793e-01   +1.681820531396425e-01   +2.559592020665352e-01; +2.435162288340924e-01   +6.255620955658991e-02   +2.148725400934898e-01   +1.133417206280381e-01   -1.251497163170703e-02   +1.185700019870284e-01   -8.459122409461527e-02   +9.687442572389493e-02; +2.102723855276953e-01   +2.104013102630709e-01   +2.781827671719230e-01   +3.580949534477733e-02   +2.202590098276212e-02   +1.239480955623465e-01   +2.649442681026193e-01   +5.885958522392244e-02; +1.565708871597627e-01   +2.318356583156552e-01   +8.298820937181491e-02   +1.664559275136614e-01   -7.085453495535825e-02   +1.965458577095051e-01   +3.891515363843264e-01   +3.171331209071552e-01; +5.891838672639205e-02   +4.499302374239214e-02   +2.643362447686493e-01   +1.407114601652697e-01   +3.639093529874256e-01   +3.453348643858209e-01   -5.512681576335370e-02   +1.490484984263653e-01];
L2I_L3I_iGABA_netcon = [+1.747282704361108e-01   +2.224847161162387e-01   +1.902662635449937e-01   +2.198631683002674e-01   +2.478961179583532e-01   +1.526472225702145e-01   +2.600921594500669e-01   +1.380160417553502e-01; +1.599195306043990e-01   +9.505442847640279e-02   +8.708650258844432e-02   +1.068636258443277e-01   +4.307684373032253e-02   +1.843515563553907e-01   +2.625132865553542e-01   +3.556905731277109e-01; -8.091268456743281e-03   +3.706162579095350e-01   +3.103191725419102e-01   +1.072633110155455e-01   +2.242008418260856e-01   +9.285543947145221e-02   +3.537597715680003e-01   +3.467376972943299e-01; +2.550334574161863e-01   -2.231619010529894e-02   +1.965528688531797e-01   +1.074798971039969e-01   +1.447422637490200e-01   +2.121009623655659e-01   -4.084597224153157e-02   +9.318479847155216e-02; +3.334024460572259e-01   +1.397203344347043e-01   +1.057242853143842e-01   +1.048172047861562e-01   +1.037003061085395e-01   +2.826809070907633e-01   +1.597702431232901e-01   +3.990947421847234e-01; +1.876268644357421e-01   +2.545368476779641e-01   -8.065942743094934e-02   +2.618683299173903e-01   +2.782573625943218e-01   +1.396942093095965e-01   +1.494737058599494e-01   -9.622390163620151e-02; +1.636264628161170e-01   +7.684336283144214e-02   +2.719559519283909e-01   +2.875258789185293e-01   +3.263489812091415e-02   -1.318151721453275e-02   +9.521935231028218e-02   +5.837746086984755e-02; +2.993060485938608e-01   +2.541320151604575e-01   +2.277194563263340e-01   +7.242883596866634e-02   -2.236377983867920e-02   +1.942632337264985e-01   +2.057368734483630e-01   +1.957025074398094e-01; +2.796513998509591e-01   +2.318221348821422e-01   +6.850638609878619e-03   +2.710874679299977e-01   +3.014879298094714e-01   +1.665521715172944e-01   +2.289452095608360e-01   +1.642049519532917e-01; +2.056591531546489e-01   +2.991330603089231e-01   +6.528436217211868e-02   +2.303573199579270e-01   +2.215735510606225e-01   +1.870776735292722e-01   +1.943091190331957e-02   +2.658167021491354e-01; +3.237317311354178e-01   +1.279774775376925e-01   +2.942160766218851e-01   +2.220399356212460e-01   +2.406905706322869e-01   +9.102026413354833e-02   +2.708120174779557e-01   +6.684084258984786e-02; +2.269158522257872e-01   +2.823782979678580e-01   +3.060433304232642e-01   +3.323000591773400e-01   +2.510765772623876e-01   +2.593583161628891e-01   +1.182829904906123e-01   +2.230940926517033e-01];
L3I_L3E_iAMPA_netcon = [+2.382343380997989e-01   +1.589903872886845e-01   -1.259050268045773e-02   -2.100443639852374e-02   +1.299107523780507e-01   +2.382754335158079e-01   +2.825878248959278e-01   +2.457174622762769e-01   +2.570804233880176e-02   +2.113896404080558e-01   +2.754089844567225e-01   +2.273610829447580e-01; +1.681314848191788e-01   +7.784925727163457e-02   +3.406649482213046e-01   +9.677068261001136e-02   +5.567273179818029e-02   +2.725169079427239e-01   +1.177249614350798e-02   -6.756982247275603e-02   +1.130483855465461e-01   +1.905324584080321e-01   +1.970561262081053e-01   +1.857005744498656e-01; +2.312601061272263e-01   +1.894697376617767e-01   +2.852670969861513e-01   +1.812367763542775e-01   +2.118630469968697e-01   +3.199022083050297e-01   +2.015567041293938e-01   +1.745834726158902e-01   +1.886472529821485e-01   +2.714971830239432e-01   +3.265007983718984e-01   -4.128376497624477e-02; +1.966800745014313e-01   +2.706818865749738e-01   +1.309340859525075e-01   +6.690355616674828e-02   +2.119204082565324e-01   +6.182787139189863e-02   +2.562930494179542e-01   +3.330252548118146e-01   +2.306779063214971e-01   +1.499616517699541e-01   +2.052070012876901e-01   +3.383607279678764e-01; +1.855725164447892e-01   +2.225405268394915e-01   +1.120735129363191e-01   +2.960033257858654e-01   +3.192658396683909e-01   +1.589041388957178e-01   +1.583225548851717e-01   +3.231914754250022e-01   +9.303011416414234e-02   -8.225782090074221e-02   -8.953997624774504e-02   +1.741813152690702e-01; +2.687317447012201e-01   +2.684754986383558e-01   +1.581488723424232e-01   +3.062756807141844e-01   +9.050685040915264e-02   -5.075383859080330e-02   +2.927722239185169e-01   +1.987957071112897e-01   +2.222149697819674e-01   +2.071374806475620e-02   -2.634615874716188e-02   +1.458571552102017e-01; +1.458629827893464e-01   +8.265344370886742e-02   +1.404448124016455e-02   +1.974170957087128e-01   +2.524213800485289e-01   +1.064258950304402e-01   +4.514773134793414e-02   +2.409625832466695e-01   +8.692795098951940e-02   +3.220829820144367e-01   +1.946893931715007e-01   +7.884820977411777e-03; +2.340057785905351e-01   +5.745343074127664e-02   +2.963765938539933e-01   +1.057346821493823e-01   +2.420244330927254e-01   +1.003411153667196e-01   +3.342513401431192e-01   +1.997145436327345e-01   +3.791556545078185e-01   -1.207578020309902e-03   +9.020184171243517e-02   +6.324692475137907e-02; +1.683356460037481e-01   +2.203314388634942e-01   +8.777068869358234e-02   +2.572676512886601e-01   +3.917118593329026e-01   +2.077173845418816e-01   +3.848221048192509e-02   +2.656335933114816e-01   +1.262901174871975e-01   +2.912614752486830e-01   +1.142060958114653e-01   +2.225171131733186e-02; +2.269554772833142e-01   +2.646476682205651e-01   +3.123363987348104e-01   +1.687727492376415e-01   +5.554732071230538e-02   +7.332470448385416e-02   +1.712494086856865e-01   +3.100173401658018e-01   +7.291431136908141e-02   +2.474353970088814e-01   +3.287606392293457e-01   +2.139994624810003e-01; +2.835357918415360e-01   +1.607673891779011e-01   +1.042882215256191e-01   +3.161461356404181e-02   +3.020489947209480e-01   +7.379620075268647e-02   +1.308013025110452e-01   +2.292992379358392e-01   +3.042749128845363e-01   +1.415300666049540e-01   +1.910153360422229e-01   +2.570299063312194e-01; +1.975338519585911e-01   +2.173851127776772e-01   +3.388551406896433e-02   +1.758327579952099e-01   +2.842494901385416e-01   +2.903147163044219e-01   +2.175303133228650e-01   +2.083562716586460e-01   +1.344786639612261e-01   +3.104948649403222e-01   +3.514824592629239e-01   -2.469484885621124e-02];
L3E_L3I_iGABA_netcon = [+1.981602784974754e-01   +2.827266455837529e-01   +2.760649205082634e-01   +1.380638761786638e-01   +3.388005359393465e-01   +1.979833663029475e-01   +1.651209372560625e-01   +3.030502559494326e-01   +2.640192495380090e-01   +1.556248512287447e-01   +1.965236447219802e-01   +2.566792048978577e-01; +2.165753431889458e-01   +1.367960201466137e-01   +1.033634640933865e-01   +3.028041982702969e-01   +1.469714592214030e-01   +1.253008853520834e-01   +2.060943104334481e-01   +3.098134602562681e-02   +7.736731933454517e-02   +3.384577111313103e-01   +1.225619626196649e-02   +1.361072539573886e-01; +1.624712386453670e-01   +2.826389191029024e-01   +2.667247544215538e-01   +5.146041599734989e-02   +1.500688486415907e-01   +2.904803375935293e-01   +6.016053665019463e-02   +2.444516368026763e-01   +2.391328067317936e-01   +1.805333893033816e-01   +6.102307040001624e-02   +1.119723211304718e-01; +2.049567082261213e-02   +7.759759491367525e-03   -2.891380044455467e-02   +1.191233859885427e-01   +2.606334174076151e-01   +1.766155687395603e-01   +1.179496237152358e-01   +2.259799715235868e-01   +1.498362051898185e-01   +2.430334534103364e-01   +8.046485054055147e-02   +8.529781940485773e-02; +1.054724659332815e-01   +1.641110153253615e-01   +5.953454032172820e-02   +3.741940168803050e-02   -4.088219588858891e-02   +3.486504828774502e-02   +7.249991993387607e-02   +3.200387282061675e-01   +1.081164711716492e-01   +1.413326339460450e-01   +2.426980255893807e-02   +3.145388893709809e-01; +6.663921079207283e-02   +3.920010020053292e-01   +2.380171625807617e-01   +6.306844339275128e-02   +8.786454368082512e-02   +2.659336885475074e-01   +1.950656057020037e-01   +6.291662485598054e-02   +1.614279233433881e-01   +3.260052246184236e-01   +2.281577148671906e-01   +2.599747788728301e-01; -2.224579549758790e-02   +7.776052259546878e-02   +8.842759351298295e-02   +2.741292249004371e-01   +6.011539612641573e-02   +1.492578571860263e-01   +2.260718859158026e-01   +1.968832366712017e-01   +2.438664454845903e-01   +1.942068384392234e-01   +1.813719720197220e-01   -4.779058861676289e-02; +2.240039019523121e-01   +2.296265665803568e-01   +6.390753199115390e-02   +2.188531114811268e-01   +2.208646280673882e-01   +1.845081712376870e-01   +2.389743604399249e-01   +5.689255484442552e-02   +1.855482934275318e-01   +1.431153375553310e-01   +1.746166866892266e-01   +7.143115660541702e-02; +1.674402328849701e-01   +1.378153521982648e-01   +2.335276774714047e-02   +1.827833917460247e-01   +1.292368189542759e-01   +5.531485840797896e-02   +2.913842081441924e-01   +1.372337719081523e-01   +2.843526891668060e-01   +3.093456196424380e-01   +1.259183964840142e-01   +2.427430202548521e-01; +1.130736189544845e-01   +2.858339869734412e-02   +2.218031839736379e-01   -2.984752415299449e-02   +1.778175328232499e-01   +8.581367998777173e-02   +7.786496117716149e-02   +2.021927287184428e-01   +1.450051855126555e-01   +1.825499347845962e-01   +2.657976410019967e-01   +1.799268489891254e-01; +1.674767397249322e-01   +3.030497486251887e-01   +2.353697831351932e-01   +2.453858003249808e-01   +2.529446539413795e-01   +1.301804452243539e-01   +2.579391795021341e-01   +2.670027996627656e-02   +1.899214949229677e-01   +2.621461660855885e-02   +3.296802113933597e-01   +2.617526104911437e-01; +1.779014402409260e-01   +1.829508013671201e-01   +1.705804576528446e-01   +5.986324121429128e-02   +2.780944828373298e-01   +1.560298338584289e-01   +2.432032593685173e-01   +2.663184609592819e-01   +2.025580503458566e-01   +2.484596772964501e-01   +1.360969957479552e-01   +1.768353079747602e-01];
L2E_Input1_iAMPA_netcon = [+8.195226220809362e-02   +1.435389099517456e-01   +1.332255753266055e-01   +2.728978066925931e-01   +2.376917732387149e-01   +3.122450991180714e-02   +2.550504289873010e-01   +4.961776209916779e-02];
L2I_Input2_iAMPA_netcon = [+2.266695082400720e-01   +2.687953758653970e-01   -7.196769905100271e-03   +4.148830241667812e-01   +3.400911024287134e-02   +3.347106129699219e-01   +1.688167712946475e-01   +3.573484264895793e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
