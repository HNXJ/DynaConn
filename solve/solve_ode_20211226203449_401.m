function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.073566892334997e-01   +2.312414892206294e-03   -3.029934347823253e-01   -1.430958751573320e-01   -2.127653036171111e-02   +3.695293712616819e-02   +2.414275768028082e-01   -2.985445025986360e-01   -1.071448712092997e-01   +5.653647544245053e-01   -1.742324729290056e-01   +4.067073813467785e-01   -1.023495614837340e-01   +3.990892052049723e-01   -3.915269940812702e-02   -1.943754862881814e-01; -2.273936410582857e-01   -3.161212618343101e-01   -1.224046301095964e-01   -2.025524430518853e-01   +9.650890942713856e-02   +2.333724345468798e-01   +3.144526543817928e-01   +2.924816682437155e-02   +3.034844332967815e-02   +2.842965244146200e-01   -1.018594543550665e-01   -2.862457435892057e-01   -1.164426329589761e-01   +1.657340978211141e-02   +9.246611688171963e-02   +3.531519010654687e-01; -1.711784434728228e-01   -1.763593138396458e-01   +2.318122821387667e-01   -1.643568000160805e-01   -1.207327867301392e-01   -1.763413802797319e-02   -1.181117868597787e-01   +6.835245825226240e-02   -1.094484418425199e-01   -7.555473306768298e-02   -1.010274775024872e-01   -4.594437805986915e-02   +5.011544067794706e-02   -1.192158213028066e-02   -3.183295039042698e-01   +1.970155662248176e-01; +2.746228680429199e-01   -6.474145356577282e-03   -1.725047253153203e-01   -3.608098734539867e-01   +8.900603557688395e-02   -1.129781502037671e-01   -1.899965895174444e-01   -2.612242334607295e-01   +4.852008233845831e-01   +3.234127024517812e-01   +4.618537552697743e-02   -4.603948462404189e-02   +2.068356705896933e-01   -1.274262076968413e-01   -4.371174665300274e-01   -3.820402060486594e-01; +4.139074036084003e-02   +1.669459989948251e-01   +3.721261076577648e-01   -3.140708841504362e-02   +8.868549531137315e-02   +2.801398527330351e-02   -1.699722866374570e-02   -7.101689522744925e-02   -3.410208062901851e-02   +1.487999215732220e-01   +4.603568837490313e-02   +1.532166647736096e-02   -2.199402570613337e-01   -3.038903973805176e-01   -4.230839504386605e-01   -2.253744813536694e-01; -2.314353250880297e-01   +3.236985971310801e-01   +6.102532975272132e-02   -3.652849205174624e-01   -1.342046177464825e-01   -1.675035657425189e-01   -1.529623706664617e-01   +4.212367147052532e-01   -1.559127636465004e-01   -6.170890004765944e-02   +1.848164326751597e-01   -2.135812964575074e-01   -1.422944087834540e-01   -2.823711011900194e-01   +2.053092349132444e-01   +7.407583324857107e-02; -1.861102091752967e-01   -4.260142655982206e-01   +2.807392699689020e-01   -1.778266369263949e-02   -1.956449722093844e-01   +1.415235513319628e-01   +2.333845603909081e-01   -1.655817507696626e-01   -8.410592092069538e-02   -3.604585642201786e-01   -5.435024476024652e-02   +1.152700128974626e-01   -5.435502454738957e-02   -7.505901307435774e-02   -2.894859341962099e-01   +7.691390363308867e-02; -2.584089909385852e-01   +1.550250292496391e-01   -6.826132582117499e-02   -1.423871096503097e-03   -1.168037851775422e-01   -2.468255457155215e-01   -7.015396879169926e-02   +3.658912678435897e-02   +4.530329484139840e-01   +6.518038813717039e-02   -7.101715975483630e-02   -2.289658790492606e-01   +3.165552139157957e-01   -2.275689914022158e-01   +2.464035926966675e-01   +1.496716939126631e-01; -3.183978527083625e-01   -7.502206363302859e-03   +2.716146277845759e-01   +1.281624292014297e-01   +3.041615173289791e-02   -2.739442270130658e-01   +2.063104825112989e-01   +1.593287869347280e-01   +1.136873445310351e-01   -2.242180762210583e-02   +2.492075043223396e-01   -1.220440306188613e-01   -2.096392523092513e-01   +5.512761294246157e-02   +6.520067064490356e-02   -1.034105139920850e-01; +2.435603403772744e-01   -3.057573787112355e-01   +2.069314197395911e-02   -1.169516059752897e-01   +8.013886762034485e-02   -4.276582657431582e-03   -1.424739829873717e-01   -1.995232233548430e-01   +1.715360247756512e-02   -2.113378151099783e-02   +7.179542156144048e-02   -1.302181726981677e-01   -2.924084729983367e-01   +2.583292050026870e-02   +7.928584338884703e-02   +1.446292971003407e-02; -9.820456846072259e-02   +1.237198241441548e-01   +1.513538942684154e-01   -8.434266720977014e-02   -1.247869810159900e-01   +1.549117283939787e-01   -5.166461265720379e-02   -3.362174759134781e-02   +2.256905806839604e-01   +1.124235641088816e-01   -1.600040432989884e-01   +1.011042632799105e-01   +8.664700455086609e-02   -2.283252616923667e-02   +2.293867719215568e-01   -1.374198400077217e-01; -1.196364333310991e-01   +1.137122185496292e-01   -2.486396799670640e-01   +1.215784858669001e-01   +1.193921739553284e-01   -2.816952945443744e-02   +3.037925919849814e-01   +2.645521465948349e-01   +3.791237673827792e-01   -1.465659452324337e-01   -4.134170526306878e-01   +1.135088707507790e-01   -1.737053054401649e-01   -5.772601018470137e-02   -2.608052742052547e-01   +1.229451369355209e-01; -3.074770271979388e-02   -2.273328887999323e-01   -1.289280996000163e-01   -1.707502290813054e-01   +2.168481227595705e-01   +6.015557238278528e-02   +6.390132930678749e-03   -1.588798935077933e-01   +1.095213199353011e-01   +2.634559775882522e-01   -8.731120896412489e-02   -1.613399472855337e-01   +1.737243572223251e-01   -1.065976837172831e-01   -1.921969795923180e-01   -6.256119792326598e-03; +2.180053976839442e-01   -8.543327075652335e-02   +2.296260780122721e-02   +2.439598174004388e-01   +1.973306025086135e-01   +4.331826722128784e-01   +1.997505844812726e-01   -2.367587395711383e-02   -3.613632379887552e-01   +1.087379009919653e-01   -8.884045271657397e-02   +3.861224330189032e-02   -1.601682912436020e-01   +1.194504127151055e-01   -1.779124049035368e-01   -2.776949885531390e-01; -9.644441039931494e-02   -6.636463771336731e-02   +6.637543681952324e-02   -6.572459211844596e-02   -2.134591417298212e-01   -4.464811116592737e-01   -2.053745502009122e-01   -1.817160721704698e-01   -9.607527882463045e-03   -9.177631833984912e-02   +1.558597458508253e-01   +9.412642355177719e-02   +1.897645003928041e-01   -4.060530381528485e-01   +3.615915000813797e-02   +7.150149917927850e-02; -1.001358144489649e-01   +8.839467627852038e-02   -5.758790263061614e-02   +1.698342721902792e-01   -1.254357821099317e-01   -2.895330504904975e-01   +1.956729948381782e-01   -2.674769703383133e-01   -3.404606290660712e-02   +1.673461193271799e-01   -8.584586247766601e-02   +3.579534538113456e-01   +1.442244111540616e-01   +4.349825787959805e-02   -1.116367452530506e-01   -4.913846146063663e-02];
L1E_L1I_iGABA_netcon = [-3.330374965185824e-01   -2.187625305669338e-01   +2.245282981061313e-02   -1.394471148465057e-01   -7.663095854589472e-02   -3.401188145475190e-01   +3.075593081887486e-01   -1.172579209693453e-02   -3.614498908408481e-01   -2.048651230813851e-01   -4.227904491327933e-01   -2.597873131047691e-02   -1.716838379953176e-01   -3.228437395014596e-01   +3.414084777591956e-01   +1.298686532438028e-01; -2.334795445801886e-01   -3.910436001378623e-02   +1.134385220763744e-01   -4.946331782836090e-02   +2.049149644646219e-01   -1.223045279506448e-01   +3.655291124716311e-01   +1.260541217955003e-02   -1.607628683448243e-01   +1.500465221364895e-01   -4.948112446760074e-02   +1.086951879438289e-01   +3.941810681239725e-01   +7.520229517865046e-02   -1.316967557149490e-02   -1.129438961061338e-03; -1.294935713612701e-02   -5.206263417598118e-03   +2.915391036341466e-01   -1.764344808954171e-02   +1.463676562231536e-01   +1.968610839977605e-01   -1.212073526152032e-01   -2.289809660039643e-01   +6.231110135718953e-02   -7.869691723624386e-02   -4.473745268114423e-02   +2.626281624930892e-01   +6.690154478839204e-02   -2.662525641308844e-01   -2.003375631098587e-01   -3.037543731110815e-01; -2.193131744610732e-01   -8.707176927705854e-03   -3.804696337473646e-01   -3.782421534843989e-01   -1.792239234770987e-01   -4.577982843934320e-03   +1.139554961224648e-01   -2.199696293181538e-01   -4.952531339024374e-01   -1.629447357772595e-01   +8.563129013861148e-02   -2.357963552201284e-02   -4.772262333270369e-02   -1.112188902160719e-01   -2.360094109495564e-01   +4.159550952700938e-02; -1.497675291893808e-01   -7.206309261447441e-04   +1.174289538632073e-02   +5.039358109972898e-02   +1.637655749521982e-01   -5.932251672416434e-02   +7.664942793777912e-04   +1.213762079422549e-01   +3.379018342114510e-01   +2.198443001651040e-03   -6.632313614076643e-02   -8.671349273282979e-02   +2.278766942939445e-01   +1.925983809348590e-01   +1.633811849609899e-01   -1.035435886886077e-01; -3.546797569778631e-01   +1.926372085849462e-01   -3.565939304967668e-02   +3.831130614643387e-02   -1.561050507722548e-01   -1.706366355447186e-01   -3.010320337587575e-01   -7.638674371970150e-02   +2.658513814579943e-01   -7.777213134074490e-02   +4.167461545743523e-02   -1.198124513994527e-01   +6.759004049889442e-02   +2.805351342089945e-02   +1.218781638081188e-01   +9.711626175776893e-02; +1.511673900786993e-01   -9.721473207713509e-02   +2.353774361378210e-01   +3.854563189532881e-01   -4.355874901190406e-01   +9.894328768018686e-02   +2.247235653551382e-01   -1.002699763998042e-01   -3.046875464279811e-01   -2.179878032505838e-01   +2.386632378213032e-01   +6.075752386499253e-03   +3.321501691329983e-01   -6.268489668179758e-02   -1.803405329768373e-01   -1.774834761329822e-02; +9.094387550167324e-02   -8.069040491698162e-02   -2.179882157716649e-01   +1.416057154286532e-01   +1.253721583252756e-01   -8.791895700213494e-02   -5.703653669103935e-02   +1.074935623380891e-01   +1.153589079140866e-01   +4.335237846049358e-01   +1.572826127334888e-01   +4.101941335292392e-02   +2.289773169216103e-01   -1.199509221067265e-01   +1.174452375076104e-01   -4.074098400474790e-02; +4.066646969288221e-01   -1.169729956192600e-01   -3.029392989848916e-01   -3.081148261466027e-02   +5.850517909875035e-02   +2.795397777425321e-01   -8.590439646607435e-02   -1.232499804464827e-01   -4.911860777482416e-02   +3.407300009561037e-02   +2.051877608912405e-01   +3.791016017644992e-01   -2.144550870434822e-02   -1.371528147737988e-01   +2.928443332822817e-01   +5.000572694471923e-02; +7.507594986635324e-02   +1.247006626279574e-01   +2.133486464087440e-01   -3.057633261648925e-01   +5.649371749786858e-02   +1.100345808620292e-01   -4.863227228442742e-02   +2.856411946211987e-01   -7.500372008458098e-02   -1.621837496494803e-01   -2.507924784061425e-01   -2.458729954662187e-01   +2.350909121815171e-02   +1.637558386052990e-01   -1.845356263966203e-01   +2.072168348819111e-01; +1.477952577844440e-01   -4.403442548828239e-01   -1.261186621008414e-01   +4.973961164211071e-02   +3.926217364441120e-01   +6.151545699610340e-02   +3.051079104872203e-01   +2.669894604469413e-01   -1.704514799617701e-02   +8.298179996919376e-02   +4.551308656308749e-02   +2.175546305615116e-02   -5.897789345830826e-02   -7.155038889834614e-02   +4.710402633161609e-01   +3.681201742561860e-02; +1.811264635195433e-01   -8.879557325126544e-02   -6.556941566729245e-02   +1.019553275215050e-01   -4.408176264994503e-01   -2.780807731602096e-02   -2.564819400749950e-01   -1.973351782386246e-01   +1.810097129131982e-01   +2.152819735844764e-01   -2.402803075401228e-01   -3.237504924523572e-01   -2.240068178011819e-01   -1.509774183730375e-01   -1.065830187287991e-01   -7.823332274009778e-02; -1.530671790878493e-01   +9.773160389450930e-02   +2.805826468942344e-01   +7.902569329541330e-03   +1.043835378154204e-02   +1.701225736780907e-01   +3.564731256517777e-01   -1.364362002677365e-01   +2.640849555517176e-01   -1.846450419796496e-01   +2.349520789519942e-01   +1.560513445586929e-01   -1.378768802000284e-01   -5.507602603791148e-02   +9.334980505901908e-02   +9.390905205768149e-02; -6.974907543013165e-03   -5.686663232382563e-02   +2.327694894734531e-01   -1.267018952762317e-01   +2.710134021431008e-01   -1.593431795393345e-01   -2.374765416729686e-02   +2.054193482530445e-01   -2.063392318394226e-01   -1.687609754575723e-01   -3.156506794782676e-02   -3.110283525876291e-01   +8.667478548964011e-03   +2.592360467549432e-01   -2.794413469868074e-01   +2.326121829230174e-01; -9.770486064642130e-02   +1.992023313064513e-01   -2.960943781078848e-02   -1.659445199995124e-01   -4.780701896272907e-02   -9.902139222145631e-02   -9.471062660288385e-02   -9.488947582377924e-02   +9.601522407315705e-02   +7.832808789751111e-02   -2.046710610895771e-02   +1.324160220948907e-01   +2.407957238060333e-01   +1.025628931475233e-01   +1.869795173119513e-01   +1.868565783337219e-02; -1.896983035703149e-01   -1.113912186152311e-01   -1.681807758726277e-01   +2.804230103172434e-01   +1.076994203681138e-01   -1.155395398210227e-01   -1.899936783814000e-01   +1.899351556969291e-01   -4.691633270868663e-02   +1.558175615397390e-01   -1.556904849984961e-01   +2.519908549339267e-01   -5.218031418365800e-02   -4.988039913727930e-03   +1.492589493554745e-01   -3.534933350455002e-02];
L2I_L1I_iGABA_netcon = [-2.250266621854578e-01   -3.110838530841052e-01   +2.354241688510078e-02   +2.135634128278200e-01   +3.275566130609529e-01   -3.208631862948217e-01   +9.810455411177105e-02   +1.795126778255372e-02; -4.797274119086834e-02   +2.550197934119849e-02   -8.710698336499595e-02   -9.966285562923946e-02   -6.322507430516926e-02   -3.557083101218212e-01   +1.718125846050003e-01   -6.183734572604042e-02; -1.155091302380235e-01   +4.338428875161979e-01   -3.962154381601124e-01   -3.106622323305705e-02   -1.159607950407596e-01   -5.930336141705367e-02   +2.179179704295895e-01   -4.582691766278248e-01; -1.574693960398758e-01   -7.261969304950310e-02   +2.472271037575696e-01   -2.656164246334721e-01   -2.150428505730370e-01   +1.456932824519543e-01   +4.542846633080547e-02   +2.323815071155378e-01; +1.726707655129391e-01   -2.743952275646285e-02   -1.520030613559854e-01   +7.395351895312682e-02   +1.045351153546405e-01   +2.028012635935722e-01   +6.519363948384627e-02   +2.861225070005418e-01; +2.712041386043447e-01   -3.392828299113096e-03   +2.664023823617749e-01   -1.793948475161529e-01   -2.966613965949686e-01   -3.170681785408663e-03   -6.560562742391152e-02   +1.087344019785386e-03; +1.541281248520683e-01   -3.448310316704902e-01   +1.360544093603235e-01   -2.298979161010393e-01   +4.192686513346252e-01   -1.985896408889722e-02   -7.204504123096669e-02   -8.101148975877798e-02; +2.900728434338635e-01   -3.400331685088533e-02   +1.325925786747402e-01   -1.046988207058951e-01   -2.905315322818528e-01   +1.020704395214157e-01   +2.568924898516788e-01   +6.380277830364824e-02; +2.338328615053047e-01   -1.341235150327089e-01   +1.652427031167347e-01   -4.230169057905545e-02   +2.023108372438209e-01   -6.407780922897723e-02   +2.141594445298536e-01   -5.330880129100209e-01; +9.861278186205805e-02   -1.107556668881418e-01   -4.425528925938352e-02   -1.639506070831973e-01   -1.916445471818441e-01   -1.344186150303703e-01   -1.868052598755683e-01   +4.550839795835198e-01; +2.543545577979049e-01   -2.759675947198642e-01   +6.015680158960371e-02   +8.422844562970656e-02   +3.548894710470047e-01   +2.944792833603919e-01   -4.333101243601610e-03   +3.314136445303003e-01; -1.272342260631682e-01   +4.233860708291995e-01   -2.705019369053570e-01   -5.348604130958932e-02   -1.436379125243246e-01   -2.098748815087088e-01   +4.562703426527167e-01   -7.611082307094505e-02; +2.901368763674773e-01   +4.339494966543969e-03   -2.682248824931521e-02   -1.540549676396471e-01   +7.791969429909171e-02   -1.523165932678726e-01   +2.475270872033233e-01   -6.812272233099859e-02; +4.986863089454455e-02   -1.405336409610593e-01   -1.867729670396246e-01   +9.873962361213839e-02   -3.327158699344808e-01   -2.674915024716731e-01   -1.859948192476163e-01   -2.693604783875701e-01; -8.939579262654582e-02   -2.566124447140821e-01   -7.544435124075298e-02   +4.231488567349713e-01   +1.866373749899992e-01   -4.454169220180104e-02   +2.786995250749464e-03   -1.412118463984721e-01; +7.193028123070917e-02   +3.376707669703939e-02   +5.881919259785993e-02   +3.063000157071177e-01   -1.254351642454856e-01   +8.891176000660270e-02   +4.363551021088958e-01   +5.196390444175767e-02];
L1I_L2I_iGABA_netcon = [-1.819547410478951e-01   -9.843259800100336e-02   -3.967546798786412e-01   +8.581652006679361e-02   +8.273509527347234e-02   +4.340953181745660e-02   +8.464101490225211e-02   -9.665378575953855e-02   -4.073527610714304e-01   -1.006173036766751e-01   +3.856739955526900e-01   -1.157801944682609e-01   -6.895208019486002e-02   -5.896001402879008e-02   -3.341454367519481e-01   -1.458910098762748e-01; -8.296938369243767e-02   -3.418313673263896e-01   -1.344376353410510e-01   -1.941469651975926e-01   -1.840677940538975e-01   -2.178006953630663e-01   +1.822985579136796e-02   +3.108112573732173e-02   +2.325242749480357e-01   -1.649369014617088e-02   -2.217359645144094e-01   -2.568992679751986e-01   +1.244660657340674e-01   -2.664905158196582e-01   -2.856094378487319e-02   +3.335639707509617e-01; +5.023660744943113e-02   +4.688262289493998e-02   -9.162958668263906e-02   -1.677966457193192e-01   +6.519818313619311e-02   -3.351221790275512e-02   +4.309971658438573e-01   -1.540612393958291e-01   -1.606751604895996e-01   +1.431099535957809e-01   +3.317902092808496e-01   +6.785745284366582e-02   -1.775744305888332e-01   -6.750541400116078e-02   +3.541227140682565e-01   +2.584243243821396e-01; +3.010014745214610e-01   +1.899986857547974e-02   +3.132969903041785e-01   -9.744281669842583e-02   +3.382539666979074e-02   +2.971116769674396e-02   -3.168721605994572e-01   +5.684910155943395e-02   +1.962810798446755e-01   +1.423295444862160e-01   -7.526210304038695e-02   +1.410904091564119e-01   +5.133302250152143e-02   -3.791426029231298e-02   +2.896338331541234e-01   -1.718524399993901e-01; +4.055097992810220e-01   -1.880458032010244e-01   +1.768948420318887e-01   -1.492462102708556e-02   -3.281752458586718e-02   -3.569048664602661e-01   -6.129303414213907e-02   -1.599146645548679e-01   -1.817535083273136e-01   -2.268302761200766e-02   -1.554189447830858e-01   -1.144120907532852e-01   -1.094555601723067e-01   -2.256602838086251e-01   -8.219079627476421e-02   +3.757196352750238e-02; -1.457592075976085e-01   +3.474326900082997e-01   -8.362437542611023e-02   -4.454217749776996e-02   -1.269848261531048e-01   -5.080006744776373e-02   -1.188822266864956e-01   +3.894480969023258e-01   -4.256375212200683e-02   -2.552996276904755e-01   -8.301806479722720e-02   +2.405879880876717e-01   -3.486000060374169e-01   -3.413095741829326e-01   -2.495543224850250e-02   +3.568905952474352e-01; -1.432300657823363e-01   -2.514326182270769e-02   +8.260843053292621e-02   +1.170012656486883e-01   +3.074338364813278e-02   -7.757689962976991e-02   -6.886043979803588e-02   -8.939530567141631e-02   -6.173522523270139e-02   +3.245439793172225e-02   -3.069645380131091e-01   +7.064817454009202e-02   -1.503114829383722e-01   -1.125082308055065e-01   -5.205113710391347e-02   +1.197349041419524e-01; -4.221956695167320e-01   -3.497211922287455e-01   -2.620989791687995e-01   +1.325317728450776e-01   +4.655587007664642e-02   -1.808888429987344e-01   +1.160625308162359e-01   -9.659304192038365e-02   +3.626551065574081e-01   +1.005939616354375e-01   -1.832620004916111e-01   +3.501178428943073e-01   +6.399417186223571e-03   +4.071432395221103e-01   +2.304029068788351e-01   +1.615031643264980e-02];
L2E_L1E_iAMPA_netcon = [+9.921695046013156e-02   -1.904174452916772e-01   -1.298688500910213e-01   -2.174855018462352e-01   +2.974104851737268e-01   -5.955615706901505e-02   -2.515796336213171e-01   -1.724532205710544e-02; -1.252945556966781e-01   -1.603029570127692e-01   -9.795089517307211e-02   -2.563018247734264e-01   -3.739286234622504e-01   +1.874934911215069e-01   +2.977587132587102e-01   -2.280926705599869e-01; -1.257039442416070e-01   +4.877649536294011e-02   -1.110161490042311e-01   +4.283853951923321e-02   +2.870355788809546e-02   -2.855741755338261e-01   +4.404751003436947e-02   +2.624032144642116e-01; -1.320076815229474e-01   -1.570406638540421e-01   -3.953127574543223e-01   +2.278053714466310e-01   -1.058665248107427e-01   -1.975267098721268e-01   +2.201154370438016e-01   -1.843395493436020e-01; -4.066457328721737e-02   -5.519124957750035e-02   +5.480274902714888e-02   +1.007360015457865e-01   +3.235350431638088e-02   +1.208413943935586e-01   +2.209942382997523e-02   -7.913626251231362e-02; +1.020913308124938e-01   +9.461487098733133e-02   -1.274218292195354e-01   -2.341511528213583e-01   +8.756407252213494e-03   +1.715457275330352e-01   -3.086037105870635e-02   -8.866861251059528e-02; +2.765013067089346e-01   +1.034836396401981e-01   +8.984719612295586e-02   -1.032316110664954e-01   +3.606600804710993e-01   -6.782441792296653e-02   -9.670594320669304e-02   +1.514672662409480e-01; -1.850265968394487e-01   -1.528716533690825e-01   +1.176583824391918e-01   -1.751879875382435e-01   +1.650918374425481e-01   -2.744982019801719e-01   -4.032501259361811e-02   +8.089462231524663e-02; -1.425450241103174e-01   -1.085334687130943e-01   -1.360402537493723e-01   -3.014113099257230e-01   -1.653900028542236e-01   +3.569246596960873e-01   -7.788115668505582e-02   +1.340905036976184e-01; +2.056604314636314e-01   -3.555813257081741e-02   +1.027989512370048e-01   +1.483559350976054e-01   +1.901796152449306e-01   +5.186065527590883e-02   -1.595045228937607e-01   +2.183994331077126e-01; +2.292729224952879e-01   -2.936012198542527e-01   -8.225424802616077e-02   -1.475071327824296e-01   +1.517419051196880e-01   -3.465221272974168e-01   -1.492044132192849e-01   -8.301521264038098e-02; +4.050999892446797e-01   -5.311978169912926e-01   +2.200898081845542e-01   -1.595474075294998e-01   +7.843058135764747e-03   -1.224497663753373e-03   -2.133721071717739e-01   +2.804443791086265e-01; -2.783301157546704e-01   -6.601587948631793e-02   +7.183927748075995e-02   -3.533132741529319e-01   +2.611341809266108e-01   -1.820657984488214e-01   +5.440390397481643e-02   +1.686301847512045e-02; +3.114445415435790e-02   -1.663547422490908e-01   +1.021795071290013e-02   -1.081761632295442e-01   +2.515172246008126e-01   +1.009682855870602e-01   -4.049926594658934e-02   +2.483079390379617e-01; -5.493696052086484e-02   -1.843103675409784e-01   +5.290753639386472e-02   -1.817568242204936e-01   -1.330807753285835e-01   -3.083411703365869e-01   -8.139602378370447e-02   +4.041807322551624e-01; +3.708443827369921e-03   +5.267736927333599e-02   +1.784520636641584e-03   +5.476918975130795e-01   -1.632337461428091e-02   +1.463248048532325e-01   +1.331311658403609e-01   -2.609617555976718e-04];
L1E_L2E_iAMPA_netcon = [+2.886780182124712e-02   +3.412443171490590e-01   +3.271379279527040e-02   -2.882209595119845e-01   +2.339753545459539e-01   +9.344490104699060e-02   +3.539864266471150e-02   +1.232462715463302e-01   +2.778810268697817e-01   -1.463551754838341e-01   -1.484318798693720e-01   -2.058316911444065e-01   +2.882269039417696e-01   -1.847804748535283e-01   +1.908457032207870e-01   -2.231083025309880e-01; +1.829295462280385e-01   -4.768928996292762e-03   +8.894287793227175e-02   +5.516624561973361e-03   +9.931525818187514e-03   -5.027511846374511e-02   -1.000565144608880e-01   +1.367298563995327e-01   -1.307562629833796e-01   +1.020517908513499e-01   -9.278450170340527e-02   +1.260423994339127e-01   +1.905423863831782e-01   +1.215968127535569e-01   +1.530431568437028e-01   +1.264119353834965e-01; +3.091226952510404e-02   +1.862782692979498e-01   +3.781588651177179e-01   +1.949261837070992e-01   -3.373969420474030e-01   +4.428940478539292e-01   -1.826857173877515e-01   -7.709040971443108e-02   +2.143384764008271e-01   -1.249056379287550e-01   +1.981534664702403e-01   -4.783146490257397e-02   -4.343525750439045e-01   -4.277484347994981e-01   -1.609479181965889e-01   +1.821108540008023e-01; +2.811715580768253e-01   +1.140645536591895e-01   +4.411927397477497e-02   +1.899906876985621e-01   -5.548598721054653e-02   +1.834203762847079e-01   +1.565013867643152e-01   -1.151963982215639e-01   -2.680594049553064e-03   +2.198177198560807e-01   -3.576284482112222e-01   +6.904338251311591e-02   -2.552115089641978e-01   -2.653506753810717e-01   -2.901576657935566e-01   +1.722320155104511e-01; -3.158560118689892e-01   -1.152364886449196e-01   -1.273746687874239e-01   +4.572185537733483e-01   -1.023369339917296e-01   +2.434988371859106e-01   +1.755876074800675e-01   +1.244369058492232e-01   +2.113096810070549e-02   +2.336803068833100e-01   -2.315555513178208e-01   -2.787300515214529e-01   -6.093960396187015e-02   -6.062786354535751e-02   +1.862213068090448e-01   -7.284391064784762e-03; -1.897031648278996e-01   +1.652450641283991e-01   +1.543790887355156e-02   +9.444181469989422e-03   +1.921591333620411e-01   -2.423438759704384e-01   +7.548349795938225e-02   -4.288077980910477e-02   +3.088765622628276e-03   -2.724263453450322e-01   +3.923716222914506e-03   -1.181062956738444e-01   -1.988932262463018e-01   +1.571263000305497e-01   -2.048964166413590e-01   +3.250272645812316e-01; -2.967078189630764e-01   -1.505603493343571e-01   -7.187345953333139e-03   +3.371707254486545e-02   +1.893372635475925e-01   +2.408640115055740e-01   -3.550356367575352e-01   -2.843505791352394e-02   +3.252767318013130e-01   -2.192024189502700e-01   +1.622553693747997e-01   -1.453055033020891e-01   +3.226339796833791e-01   +5.372462407949836e-02   -2.907116485944701e-01   -2.864055687230029e-01; -6.410213715194324e-02   -4.572814632058125e-01   -4.397251433752215e-01   +2.289414465194039e-01   -4.623989562137232e-02   -3.840810847756697e-01   -2.211562545035299e-01   -1.073646033100838e-01   +2.592634126982824e-01   -5.288957342985206e-02   -1.876863942669066e-01   -1.149532025629305e-01   -1.645872052285057e-01   -1.791394881088066e-01   +2.504809430907156e-01   -1.686979117627988e-01];
L2I_L2E_iAMPA_netcon = [+4.183884811760616e-03   -2.323265542055195e-01   +3.784814743892657e-02   -4.899672792719439e-01   +2.396258284679222e-01   +3.016482996797164e-01   +2.002950492713096e-01   -2.004651784887040e-01; +1.241515132519020e-01   -3.778976652587892e-01   +1.297934628022078e-01   -1.472232541870759e-01   -1.605758199934303e-01   +3.133780451462356e-01   -3.952278326613660e-01   -3.564868630590807e-01; +1.338524683212099e-01   -1.522726488823631e-01   -2.166253092686500e-01   +8.020245329978143e-02   +2.877910839567687e-01   +2.029409718562717e-01   +3.787173434085552e-01   -2.192060445138593e-01; -1.394172359158506e-01   +1.850881210168775e-01   +8.083422275535816e-03   -9.770081654669305e-02   +1.567455609663695e-01   -4.485469563764234e-02   -2.662769560623461e-01   +2.160663113474824e-01; +1.301058738478404e-02   +2.046085417620859e-01   -3.315639079278430e-02   +7.358544715904272e-02   +3.870902939244823e-01   +1.813342733913947e-01   +4.410797649864898e-01   -2.228739769262574e-01; -1.477754294736742e-02   -2.297729740366934e-01   +1.501747199610210e-01   -1.302780224684586e-01   +9.639514133520100e-02   -5.481124840964657e-02   +2.200415554458099e-01   -4.906037574509962e-03; +1.152933505675012e-01   +3.507774388668445e-01   +3.984932465652077e-02   +1.606461153060160e-01   +1.183986881414704e-01   -1.902164106924505e-01   +2.202265483417417e-01   -4.984091072679490e-02; -2.737775119685176e-01   +1.060715591846612e-01   +1.360757642360806e-01   +1.682324472466897e-01   +2.422371166807925e-02   +9.781626286741618e-03   -1.263625925690628e-01   +4.535862824466342e-01];
L2E_L2I_iGABA_netcon = [+2.385848641645165e-01   +4.889449317620335e-02   +1.449712244869118e-01   -3.027483768855261e-01   +2.845244215404987e-01   -2.348625958401475e-01   +7.423474726882892e-02   +2.009242802913858e-01; -2.514921323891322e-01   -1.087322752115127e-01   +8.566953130318117e-02   -1.218735619350765e-01   -1.514092967484489e-01   -2.419912749534751e-01   +1.162277998610532e-01   -9.684675810487167e-03; -7.782450235800246e-02   -1.592423578723958e-01   +1.793009492023310e-01   +2.505865989966496e-01   +8.916847184009097e-02   -2.271679915925273e-01   -3.752857413810602e-01   +7.986161569871568e-02; +3.057856343951565e-01   -5.015434372719046e-01   -1.539459707607448e-01   +3.295839075865581e-01   +2.867490930378289e-01   -7.371899472380350e-02   -5.981473040616382e-02   -2.445428987302825e-01; +7.439520185768378e-02   -4.730384748300039e-01   -3.952803694875377e-02   +4.683844609265144e-01   +9.465582099378644e-03   +2.537888951876187e-02   -1.233463713357096e-01   +8.283654306215789e-02; +7.079182879948859e-02   +1.254473321216597e-01   -1.872821133454978e-01   -2.123727675610494e-01   -2.411956623813500e-01   +4.440799941125806e-02   -1.723189714111520e-01   +1.041160189514501e-03; -1.796439045672695e-01   +4.399512444858284e-01   +4.435471408865312e-01   +5.601918943120258e-02   +2.904185208108889e-01   +5.012944111411294e-02   +8.473923053859178e-02   -1.910041612057869e-01; +1.018809965524023e-02   -4.499311874165156e-01   +1.848066961146966e-01   -5.783052264831255e-02   -1.005987622300322e-01   +2.390189927143274e-01   -3.281087877679153e-01   -9.139701691500660e-02];
L3E_L2E_iAMPA_netcon = [-1.222145165089570e-01   -2.398409540520288e-01   -2.736241356388952e-01   -3.679435335859635e-02   +4.489819732654811e-01   -4.699601155663763e-02   +1.138917475027937e-01   +1.782607500356307e-01   -2.651734745696722e-02   -6.958841345392150e-02   -5.331838122559098e-01   -1.180420857526125e-01; +1.349717907930194e-01   -5.249824754830221e-02   -1.018515411919518e-01   +1.669070521367307e-01   -2.422844797748311e-01   -2.289288932790212e-01   -2.070673362517327e-01   -1.725727045959566e-01   +3.087168044487432e-01   +1.658061419902990e-01   -3.791152938045352e-02   +6.204620505093453e-02; +1.156671183141698e-01   +1.367820183045057e-01   -1.827833359258904e-01   +6.847854146142443e-02   -7.432845510023492e-02   -5.478220017853880e-02   +4.819655738453715e-02   +1.026767762597073e-01   -1.524160432812434e-01   -2.226267904740354e-01   +6.586655700997715e-02   +2.704722712090715e-01; -1.800453052406091e-01   -4.006558398462977e-02   +3.526375340457497e-01   +2.496203859235631e-01   +3.347650794332206e-01   -1.227544984676431e-01   +1.040601066433915e-01   -7.921367730910345e-03   -1.503195751615739e-01   +1.534321481629445e-01   +3.348459733318908e-02   -1.470604417012678e-01; -1.462005773270092e-01   -4.679570969976984e-01   +1.095794321273233e-01   +1.691633501127543e-01   +1.546191145955340e-01   +1.554203931770644e-01   +1.416214836705182e-01   +4.243900300617993e-03   +4.229727675581410e-02   +1.243986996542045e-01   -2.401161714182911e-01   +4.008632617257483e-01; -8.818460734133936e-02   +1.280113982063675e-01   +1.020831297650900e-01   +2.155689756138902e-01   -1.913096669851322e-01   +1.135250524491706e-01   +7.829929471043742e-02   -1.710859171014836e-01   -7.023449042483200e-02   +2.594938398468521e-01   +8.558415194447272e-02   +4.722586780386358e-02; -1.300272204422407e-01   -1.822414289761048e-01   -4.752159645030490e-02   -6.216800289348132e-02   -2.104378104165551e-01   -9.192641370857514e-02   -4.906350000737372e-02   -4.584984218806637e-02   -1.560567009228459e-01   -6.873046312861114e-02   -3.448918617882671e-02   +7.685381883340868e-02; -2.405498745796497e-01   -1.582123340700322e-01   +2.655244935146092e-01   -2.334581679652638e-02   -2.560638745549362e-01   -7.307512681108823e-02   -2.345688264515742e-01   -7.052674820734871e-02   -3.182715167446927e-01   +1.382259518220504e-01   -2.933239470535428e-01   +2.907786973967862e-01];
L3I_L2I_iGABA_netcon = [+2.286662825319292e-01   +4.707613970828578e-01   +2.697292199444534e-01   +1.530351622235921e-01   -2.883096116776827e-02   -1.941527317688590e-01   +2.856941457279419e-01   +3.747397569229546e-02   +2.615823766311827e-01   -1.183603737289257e-01   -1.923988410355371e-01   +1.939764272587460e-01; -2.248255560565109e-01   +1.310739249689654e-01   -4.062537443939230e-01   +1.947742668060051e-01   +4.689539436940543e-02   -1.303183787603389e-01   +7.100421310962376e-02   -8.513886803446884e-03   +1.336695370268106e-01   -1.480241289473044e-01   +3.690565405374503e-02   +1.825198540485256e-01; -2.007216950960132e-01   +1.667954842158742e-01   +8.157102045991294e-03   -2.570932149560864e-01   -1.144706450082033e-01   +2.466487949835613e-02   -2.291480631886037e-01   -4.052752364587876e-02   -4.275037458473009e-01   +2.929236180178835e-01   +3.643756876404036e-02   -8.504839224876042e-02; +1.789090500787469e-02   -3.958540470988295e-02   +2.216119590148122e-02   +6.961198933163491e-02   -1.964538558158340e-01   -1.973950424349261e-02   -1.343244504838868e-01   +2.543939523874272e-01   +3.436204654360267e-02   +7.642596020130189e-02   -3.082844537990417e-01   -1.021308378038134e-01; -1.105227085715809e-01   +2.061551820677120e-01   -2.529244471050391e-01   -8.239320458974068e-03   +1.816976216634744e-01   -1.400401171429651e-01   -1.961006916887587e-01   +1.151672531508533e-01   +2.693046782413085e-01   -1.056865487228198e-02   -1.082267851288289e-01   +7.415059157180812e-02; -8.437522482228843e-03   +2.087695599712365e-01   +1.861785221017437e-02   +1.763900318374096e-01   +7.771699910566324e-02   -5.215141477595193e-02   +7.333068693262070e-02   -1.391354298209019e-01   -3.629229106346457e-03   +3.093360240569350e-02   -2.885205987025423e-01   -8.096610135326329e-02; +3.293937484133342e-01   +2.695738125554568e-01   -1.761958656523945e-01   -2.840383040866453e-01   -3.979270626764109e-01   -2.406242688199484e-02   -3.738314620120922e-02   -3.761239549887023e-01   -2.747548079402254e-01   +1.347229919099580e-01   +1.009110712609803e-01   +1.735946270721667e-01; -1.724705546135693e-01   -2.599646603359221e-02   +2.635558557509613e-01   -1.270897350455108e-01   +7.708532581740288e-02   -1.970036980323409e-02   -3.663127948009154e-01   -2.081062432558485e-01   +2.224878223338183e-01   +2.748454253765256e-02   +1.313847221282936e-01   -3.251505919651605e-02];
L2E_L3E_iAMPA_netcon = [-9.068073642536723e-02   -1.104295093213145e-01   +1.809368249249687e-01   +1.619455359516871e-01   -2.670838026655672e-01   +2.654639751894772e-01   -3.715501824707854e-01   -1.271009718836305e-01; -1.950017292216152e-01   -2.386738915128898e-01   +2.425978350367455e-02   +1.672806868088236e-01   +1.121607192390628e-02   +1.175708919867606e-01   -3.223512882240870e-01   +9.944059760734233e-02; +2.308671772420982e-01   -1.013518070859679e-01   +2.400249407928354e-02   +8.706341810287574e-02   -1.721303106963809e-01   +7.275009228962347e-02   -2.176121769983443e-01   +4.963062177583866e-02; +2.987045529066293e-01   -1.713194697984725e-01   +8.614248352694191e-02   -6.181616973615869e-03   -7.808593105999143e-02   -2.430882252416192e-01   +4.298596484199860e-02   -3.567958152938738e-01; +2.747955266119734e-01   -8.686639911145255e-02   -1.386738553196454e-01   -1.389657614950267e-01   -2.253145592196736e-01   -1.377600542382878e-01   -3.833572702872497e-02   -2.828797025987948e-01; +1.949760718781199e-01   -4.589690058409157e-02   -1.588146114215465e-01   -1.584218099136685e-01   -7.273390871348598e-02   +4.091822196767562e-01   -3.974555323157103e-01   +1.162895765672873e-01; -1.524409264827576e-01   -2.337124261413971e-01   +1.627279699735009e-01   -1.795817607934083e-01   -4.797186069096460e-03   -2.004792914590703e-01   +5.081941592633841e-01   +2.168396661382296e-01; -1.866164005809407e-01   -3.170200665158093e-03   -2.639750203087350e-01   +2.272973991446955e-01   -4.940514488794525e-01   -2.356092512561081e-01   +2.191574936934872e-01   -1.595064681257059e-01; -1.767194757345290e-01   -1.566514248760338e-01   -1.327416318808366e-01   -3.312628098138828e-01   +1.451262762371271e-01   +1.842639043310027e-01   +1.646173351749821e-01   -2.079332139930404e-01; +1.662690438281125e-02   +8.691508645429336e-03   -2.490617260855336e-01   -7.968352782010460e-02   -4.078037451643018e-02   -1.440433422222422e-01   +6.617500528091318e-02   +6.961519707839398e-03; -1.225187448110416e-01   -1.423292943589702e-01   -3.380285078815576e-02   -1.954010627221502e-01   +2.512827845188910e-01   -1.609168452212456e-01   +3.408328022159433e-01   -1.790163249903248e-01; -5.506925527691850e-02   -1.102984989150401e-01   +1.227170981129392e-01   -1.094036443971350e-01   +1.346686841575961e-02   -1.354636659337857e-01   +4.419561551602356e-02   -3.063678859786547e-02];
L2I_L3I_iGABA_netcon = [+1.786285993585094e-01   +5.762771149557409e-02   +3.046157746424503e-01   +2.733452384015742e-01   -4.561584401354364e-01   +5.043607765335728e-02   +3.005266116288318e-01   -2.662744359071116e-01; -1.275267182501750e-01   -4.089761680575799e-02   +7.449737079746263e-02   -6.710656275523140e-02   -8.340041630130243e-02   -2.525141529047015e-01   +2.421778803241589e-02   -1.016657890169433e-01; +2.279909406203425e-01   +1.143746088717951e-01   -1.219360109864279e-02   -1.010192406131837e-01   +1.895784362629182e-02   +7.176295659887194e-02   +2.147050935163907e-01   +1.914987684607248e-01; -2.085737246617564e-01   -2.307143580056373e-01   -2.136004261832375e-02   +6.488826880518296e-02   -2.855737581854219e-01   +1.776557384966388e-01   +4.872656056766900e-01   +2.198156347328228e-03; +6.339010163408990e-02   +2.356263102139208e-01   +4.265900587107957e-01   +2.086892628999324e-01   +3.160218280661142e-01   +7.988165612888380e-02   +4.275293874939473e-02   +1.045972319749707e-01; -5.014498088144762e-03   -9.613370239781462e-02   +2.707868576245478e-01   +7.782031892085454e-02   -5.505276747326752e-02   -7.717102668457612e-02   +9.861736027345563e-02   +4.417356218211074e-01; +1.865296292332264e-01   +1.687200499221505e-01   +2.520571226107091e-01   +1.003428088929910e-01   +1.993489125828810e-01   +3.307683145542613e-01   +1.987724743710043e-01   -1.939082555722034e-01; +8.678081231521410e-02   +1.384615314054986e-01   +1.757480801774799e-02   -1.142823976011943e-01   +3.411136404921938e-03   +8.217331535113691e-02   -1.675085280760454e-01   +9.570256449753629e-02; -2.321095006299655e-01   +1.780929223760302e-01   +1.477675387583486e-01   +2.903372721697943e-01   +2.603142713985714e-01   +3.155889889459779e-01   +1.184008124290586e-02   +1.074136859053969e-01; +7.158470824465236e-02   +1.930384068729292e-01   +1.910707677439294e-01   -3.790380193199923e-01   -1.796519100866928e-01   -2.123390257146485e-01   -3.688877493516208e-01   +4.510705577499997e-02; +8.146115504758694e-02   +4.983149663955574e-02   +1.278024779320251e-01   +1.179296150332396e-01   +1.784777090245583e-01   -2.280596760782945e-01   +2.348852616637867e-01   -4.055492279798018e-02; +7.501228854071278e-02   -5.338367565924679e-02   +3.055642685040862e-01   +1.758295854443920e-01   -7.018273346770751e-02   +9.659144491004273e-03   +1.031629945582570e-02   +1.566357982610743e-01];
L3I_L3E_iAMPA_netcon = [-1.045418131341993e-01   -2.685503195134826e-01   -1.432106007234162e-01   +4.715465689166266e-01   -1.919260277890945e-01   -6.196369950367907e-02   +6.994517044135215e-03   -3.979961853424913e-02   +1.889451154876562e-01   -5.023733426281773e-02   -2.163118936493092e-01   +2.649849855495787e-01; -1.690410996196717e-02   +8.360413765076435e-02   -2.140728783389602e-01   -1.282609775173249e-01   +3.217044147048803e-01   -2.465846812585269e-01   +1.977979510356717e-01   -3.430653321243893e-01   +3.125852548896343e-01   -2.876581705309199e-01   -3.055999919842443e-01   +2.481908240145806e-01; +7.091309107435870e-05   +9.391722653017427e-02   +2.057032559061847e-01   +8.595821035470372e-02   +9.573400510029786e-02   +1.400745048998591e-01   +1.889192075833210e-01   +2.634698246991686e-01   +1.611819821886646e-01   -1.881553314723912e-01   -3.479655407202480e-01   +1.412688960292901e-01; +1.771182540966696e-01   -9.022094981495293e-02   -4.873687058015714e-02   -3.544001855471520e-03   +1.150198920207853e-01   -1.919657910411988e-01   -4.960085857427479e-03   +2.724543604065692e-01   -1.732901266677120e-01   +1.887852927211098e-01   +3.602478529041800e-01   -1.320745969519349e-01; +1.772579622076232e-01   -3.751176669234592e-02   -2.342177784449534e-01   -8.713432839713603e-02   +3.132506538073256e-01   -2.662581658548352e-01   +1.520925668804266e-01   -1.010855908675330e-01   -1.921045931327534e-01   +1.982421569186948e-01   +1.144612168606649e-01   -2.055520519799162e-02; -2.630480892551326e-01   +1.054257626954408e-01   -3.461091320414384e-01   +3.684795096220960e-01   +1.345054969136190e-01   -9.903908333641318e-02   -4.252547422692321e-02   +2.700220804113668e-01   +5.633780297215710e-02   +2.663329226427420e-01   -9.629329033634276e-02   -9.232125603301750e-02; -8.643455535368993e-02   +1.664345362095361e-01   -2.952369074894959e-01   +1.032361587364998e-01   +3.289357459839962e-02   -1.122091915173726e-01   +6.623754305491625e-02   -2.468318942546777e-01   +7.903389917805449e-02   -2.897155292988752e-01   +4.123693022434533e-01   +2.304667029399678e-01; +2.514025341422857e-01   -9.440878815963055e-02   -8.715418682551641e-02   +1.996632021055469e-01   +1.431737487428521e-01   +2.128385014488365e-01   -1.828557825365916e-01   +1.245587707297132e-01   +1.257879468885031e-01   -9.292686121453247e-02   +1.868408494272067e-01   +4.588152136601879e-02; +4.044030153407870e-01   -3.353258201179118e-01   -1.195686461444179e-03   +1.868406870790039e-01   -3.700480173284451e-02   -7.799800211541240e-02   -2.195906278179323e-01   +1.076994833216391e-01   +1.235197167196225e-02   -2.508386399653117e-02   -2.411982892176502e-01   -1.483718662835627e-01; -1.420481485552040e-01   -2.763449854030350e-02   -2.341128368685413e-02   +1.250489571812720e-01   -2.280397820728314e-01   -1.500761972603565e-01   -7.256151822891731e-02   +1.700741053651540e-01   -3.496866134985014e-01   -4.840559932063842e-01   +1.715877910711327e-01   +1.389051072798858e-01; -2.683744578287725e-02   -1.900119266767438e-01   +2.385516083910692e-01   -2.481898259996948e-01   +2.696644013273707e-01   -1.306071619354266e-01   -3.263239063822098e-01   +8.009191424333782e-02   -3.093829497285876e-01   +3.202722054375398e-01   -6.679288286745394e-02   -7.081286519103769e-02; +6.983784024196794e-02   -3.987032655717780e-02   +2.623104087380018e-01   +5.171221466532809e-02   -1.634421826417921e-01   +7.115833259155328e-02   -2.885116607342531e-03   +1.533311628093061e-01   -1.884752719116365e-01   +2.858149479023750e-01   +1.788244972246556e-02   +1.764651659014378e-01];
L3E_L3I_iGABA_netcon = [+3.590345217464709e-01   +1.646007815496418e-01   +1.172011990321092e-01   +1.935255629599235e-01   +1.444735570000102e-01   -2.032466515268058e-01   +4.170999264041561e-01   -3.874643009748942e-02   -8.907064265950987e-02   -1.599332266789284e-01   +7.572885627371165e-02   +3.200349214345566e-01; -2.242399368753028e-01   -1.721288820839766e-02   +1.487084499416169e-01   -6.744822221839558e-02   +1.320102354661854e-01   +3.199793937165884e-01   -1.264945222774869e-01   +3.348900457539579e-01   +9.825923120422268e-02   -3.260677644174528e-01   -4.620207355878161e-01   -6.978363638824799e-02; -1.117030735305183e-01   +1.768041144215467e-01   -4.597371265066105e-02   +4.603466011926641e-03   +1.472155649570925e-01   +1.245777598839199e-01   +1.856663040236208e-01   -7.663728698488220e-03   +6.554072208897790e-02   +2.188343366699269e-01   -6.658930937603111e-02   +1.550345201138452e-01; +2.364470732099624e-01   +4.288951042712404e-02   -1.993572523429030e-01   +9.162764193964280e-02   -6.682237952854612e-03   +3.113637017640863e-01   -2.952708507131021e-01   -3.138286844478676e-01   +6.406173318882352e-02   +7.431954598492627e-02   -4.588919727599885e-02   -2.567487436730745e-01; -3.156660589000854e-01   +2.581836774925403e-02   -1.767310170580380e-01   -5.055963805175574e-02   +1.004710766516537e-01   +2.826877155130817e-01   +2.570726975098924e-01   -3.147802279468359e-01   -3.502343288211526e-01   -1.125767984541848e-01   -1.093354538001074e-01   -4.774475600763222e-01; +1.093729045724245e-02   -1.350175087489738e-01   -3.223209463422239e-01   +8.758702140634622e-02   +3.551451486420945e-01   +2.756326451402603e-02   -9.734538083627495e-02   -3.153932950611199e-03   -3.470071826335170e-01   +1.195375641111817e-01   -1.270755667800028e-01   +1.364591564161187e-01; -3.575279522732329e-02   -4.191242292039810e-01   +7.762017726258358e-02   +3.313166246076955e-02   -1.954181696207930e-01   +1.539533927016072e-01   -9.099126865981795e-02   +6.215652908074638e-02   -5.015093399769061e-02   +2.199230417429561e-01   +5.691916732140628e-02   -1.991909827904054e-01; +7.446505368620231e-02   -3.750867574453678e-01   +1.542754009849698e-03   +1.731132462305280e-01   -3.633861220238122e-01   -1.554799878991700e-01   +5.027540269444530e-02   -1.183434812756723e-01   -1.828602238683601e-01   +3.796785857969048e-02   -3.239590967774818e-01   +1.207546940173894e-01; +2.412704061422753e-01   +1.682431078769692e-01   -2.111067623518731e-01   +4.832255271225991e-02   -1.078629739072092e-01   +4.006362661827315e-02   -3.150743274939136e-02   +4.280562072398612e-01   -2.817939118960235e-02   -1.567585761170207e-01   -2.689454235073540e-01   -6.965375514344589e-02; -3.658076813231128e-02   -2.918243833953006e-01   -5.148191534021881e-02   -7.007935799196438e-03   -6.017152074841049e-02   -7.300506177339636e-02   -2.943652931510610e-01   -1.825719831014718e-01   -1.792382054251521e-02   +1.957654438823226e-02   -7.861546562912759e-02   +1.007658897939842e-02; +2.565893335777527e-02   +2.467953435735170e-01   -1.695663564300012e-02   +6.654225439693598e-02   -8.667173928728626e-02   +9.616314082703289e-03   -2.190300157264514e-01   -3.928581689984844e-01   -4.140345468480162e-01   +9.016478985439100e-03   +7.514080190227496e-02   +1.187364193479754e-02; -3.023042887940764e-01   -3.527747975931279e-02   -6.489600393991200e-02   +1.326044865162728e-01   +7.065511603374593e-02   -8.999242408567910e-02   +3.331106348594004e-02   -1.135300137527546e-01   -2.945674561636061e-01   +1.022013387101987e-01   +7.807038823033782e-02   -2.700642631666869e-01];
L2E_Input1_iAMPA_netcon = [-1.848844541964941e-01   +1.934539727319154e-02   -4.644693070105604e-02   -2.210724710044938e-01   +1.187837559759612e-01   -6.970478237298723e-02   +1.982075674078708e-02   +1.978407785132925e-01];
L2I_Input2_iAMPA_netcon = [-3.075509397749928e-01   +4.919320297141198e-02   +1.617094295314110e-01   -2.518313355446705e-01   +3.439090783087359e-01   -7.984995288267749e-02   +2.029478055668208e-01   -2.759567553711094e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
