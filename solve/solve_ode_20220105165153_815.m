function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.235808141141852e-01   +4.228127172030075e-01   +5.303146366138108e-01   +6.368432558933544e-01   +6.001751992809076e-01   +3.414204204553293e-01   +6.477474919346008e-01   +8.393184100467843e-01   +5.443061065806255e-01   +1.930726787222810e-01   +4.476128721091548e-02   +8.224049314607880e-01   +7.676767249565689e-01   +1.096510516612012e-01   -5.325851571429711e-04   +8.430348079354071e-02; +9.836018097636537e-01   +9.573545967609903e-02   +3.242522983920573e-01   +9.565787657246824e-01   +3.871201024236972e-01   +6.065602051018693e-01   +6.785291736798004e-01   +8.317526584147203e-01   +7.224532410947170e-01   +1.382935017860169e-01   +7.534452471838605e-01   +4.300550125399962e-01   +1.675588975380097e-01   +1.356441903532505e-01   +8.651866310322881e-01   +6.267415842156903e-01; +7.307502203429324e-01   +5.973776577615537e-01   +1.059211208605039e-01   +2.419144299848147e-01   +9.156059403013921e-01   +1.914820969076860e-01   +6.346705199593156e-01   +2.563133862679651e-01   +5.212324509896664e-01   +6.959615746529501e-01   +2.419717740965844e-01   +8.874182008435776e-01   +8.637777226499663e-01   +6.787456575921103e-01   +6.127373083237686e-01   +6.613876038510308e-01; +3.438233415301901e-01   +4.723348256895376e-01   +6.119011503378837e-01   +6.754043869657763e-01   +1.005791492181980e-03   +7.389589802015845e-01   +9.455834523920978e-01   +6.133970755332351e-01   +9.935838356708132e-01   +9.286906424288636e-02   +4.428922577849594e-01   +3.920207316703561e-01   +9.903747560007183e-01   +4.940545840571248e-01   +9.886376364322843e-01   +7.304321251556863e-01; +5.859438668060010e-01   +6.959350213155724e-01   +7.796739965127658e-01   +2.886279662350105e-01   +4.626359095923281e-01   +2.422844990639922e-01   +2.092216202155706e-01   +5.822160257914324e-01   +2.210858238031094e-01   +5.239756695804135e-01   +6.875661165312764e-01   +7.693133600735020e-01   +5.156417905199515e-01   +1.894457488080747e-01   +5.266074404705305e-01   +8.926213066099162e-01; +1.086190414604200e-01   +7.005283248759145e-01   +4.243146634961102e-01   +6.709006226516494e-01   +4.250485162707330e-01   +9.188378768335800e-01   +7.090113982216598e-01   +5.408085110790500e-01   +1.046617605352377e-01   +5.306947813058566e-01   +3.585996327591922e-01   +3.972178164364758e-01   +8.838829150931256e-01   +4.943918749036062e-01   +4.807842715138452e-01   +9.822029758917100e-01; +9.056249017892218e-01   +6.396310386447455e-01   +9.040624471157331e-02   +6.945254992625001e-01   +4.609934884909286e-01   +2.701925381638894e-01   +2.373078852763169e-01   +8.707693586059755e-01   +1.112138185221495e-01   +8.619471125904403e-01   +7.368050242560273e-01   +8.102656112938765e-01   +5.874127495439982e-01   +1.480425859784730e-01   +8.023639875520879e-01   +7.693565402076007e-01; +8.808692625559486e-01   +3.343989673290893e-02   +2.653393476335877e-01   +6.699661532622295e-02   +7.703640989977467e-01   +7.653933281932970e-01   +1.196776823349785e-01   +2.646946145852904e-01   +6.544843067210070e-02   +4.852534168688518e-01   +3.943124442519549e-01   +7.549863186752591e-01   +1.551311673564536e-01   +5.345148963931007e-02   +2.284025583041958e-01   +5.830363721125152e-01; +8.179454588269048e-01   +6.823357624239790e-02   +1.538635970254059e-01   +2.529471239932044e-01   +3.240090958499054e-01   +1.900936163736145e-01   +6.078387737170462e-01   +3.164255866015604e-01   +4.040673259312932e-01   +3.923587970079490e-01   +6.844218713619891e-01   +3.774903597198523e-01   +1.999137989720029e-01   +8.512029976061717e-01   +4.964534145670679e-01   +9.263960897773864e-01; +2.602931428243383e-01   +3.188942791280489e-01   +2.817426987484863e-01   +2.217842640082514e-01   +7.840254663428106e-01   +2.860991046483583e-01   +4.517685988919782e-01   +1.191773397752585e-01   +4.475793697250397e-01   +6.716535696012351e-01   +7.044153654809528e-01   +2.166127256547763e-01   +4.075302570971762e-01   +5.618957341744948e-01   +8.987713041678228e-01   +5.813842952033487e-01; +5.939441542642508e-01   +5.299469867137133e-01   +4.420317067805439e-01   +6.682249864555441e-01   +4.704048857055659e-01   +9.099175787762843e-02   +4.587253560317709e-01   +9.403640031538569e-01   +3.651931304948852e-01   +7.421877370491188e-01   +4.428822699846359e-01   +7.901767380183338e-01   +7.483740099164368e-01   +9.302228716725228e-01   +5.759559799063902e-01   +1.626897226762343e-02; +2.319159431127457e-02   +6.542321659300805e-01   +5.263895397975012e-01   +8.441987255453943e-01   +3.577159973022569e-02   +5.782019174595604e-01   +6.622960937529723e-01   +6.458631375976643e-01   +7.626753442975334e-01   +5.192439319765481e-01   +1.847733525500466e-02   +9.497833990574693e-01   +8.241651745759329e-01   +6.980115249603266e-01   +8.447445004844263e-01   +1.212375826635040e-01; +4.262079722139631e-01   +4.078989298383612e-01   +4.584693504082236e-01   +3.449622146288907e-01   +1.769045436760023e-01   +6.840404913678119e-01   +7.701744458349638e-01   +4.798969543364353e-01   +6.265146701860554e-01   +3.451318460997687e-01   +3.294635403995729e-01   +3.286270437059795e-01   +7.915650504790206e-01   +5.842397682635718e-01   +7.389728183904678e-01   +8.623356484062648e-01; +3.119851421496012e-01   +8.192092087591798e-01   +8.751191195012988e-01   +7.822223208232660e-01   +7.205429115009039e-01   +5.470664472484920e-01   +3.500814347219545e-01   +6.397919070791732e-01   +7.727050705669688e-01   +1.497929923705861e-01   +4.232695224244719e-01   +6.724353420966742e-01   +3.192007094456009e-01   +8.155042533533343e-01   +5.861422613829473e-01   +4.834940056425984e-01; +1.602758215871515e-01   +7.205049575351887e-01   +5.194639261509051e-01   +6.764836072746798e-01   +4.738714298897194e-01   +4.239922121758389e-01   +6.621429726398422e-01   +5.444320376758319e-01   +9.331096904122987e-01   +5.863795686040990e-01   +2.693449789323412e-01   +4.399396555168157e-01   +5.335787962102695e-01   +8.810658777168763e-01   +2.449573641150188e-01   +8.449139232360358e-01; +1.778327556042479e-01   +9.684929406762357e-01   +9.449669465841635e-01   +7.519704632056814e-03   +1.529677139372414e-01   +6.431830729179574e-01   +4.154390725734474e-01   +6.470268149069447e-01   +9.734024579253064e-01   +2.613193674622856e-01   +1.969226812989210e-01   +8.330276161075776e-01   +9.024421711728441e-02   +9.890000285361759e-01   +6.655069968266144e-01   +2.095243227132845e-01];
L1E_L1I_iGABA_netcon = [+5.511782234872767e-01   +6.941852915670761e-01   +1.050250498282191e-01   +1.769887229648840e-01   +5.494276226584619e-02   +1.788412124213032e-01   +5.961714165347782e-01   +9.965729568909213e-01   +3.394378517668147e-01   +7.791025687426882e-01   +6.835176676985915e-01   +3.653437355300023e-01   +7.830467914088716e-01   +4.326952902126852e-01   +5.965774425253922e-02   +9.710246707437444e-02; +6.313908761513277e-01   +4.991744211036337e-01   +1.423360612041996e-01   +3.984617387852410e-01   +1.778120434863620e-01   +3.606144696182951e-01   +3.003492497416088e-01   +3.309003149116565e-01   +2.937866168940368e-01   +3.377204553424993e-01   +1.316134832054900e-01   +3.688264160871659e-01   +1.008871751697353e-01   +6.547805222889364e-01   +3.141426340341077e-01   +1.419497600806068e-01; +3.267151406154473e-02   +5.351051977739093e-01   +1.670661811656853e-01   +1.333224955622289e-01   +6.609406374901859e-01   +5.642748810916788e-02   +1.347432141985349e-01   +2.972508104382012e-01   +7.456483202080961e-01   +6.077406492381773e-01   +7.231235092012690e-01   +6.845668202580762e-01   +2.928934540450688e-01   +1.113380149903247e-01   +7.718363030892907e-01   +1.689858659331502e-01; +6.146399961312679e-01   +4.433163225748525e-01   +6.223436871943658e-01   +2.925164298941377e-02   +3.323676339588600e-01   +5.219038550226510e-01   +2.110640876518660e-01   +6.215097535843785e-02   +1.090450926629712e-02   +7.416062328262648e-01   +1.099938262079501e-01   +5.979987034714225e-01   +2.365562334165451e-01   +9.318829495142266e-01   +6.956194372806844e-01   +1.957983925478103e-01; +3.633319675473513e-01   +1.236990974539555e-01   +5.743100936237342e-01   +9.383234477630958e-01   +8.984775045325172e-01   +3.345694700263832e-01   +8.957275138823941e-01   +2.977922236629789e-01   +4.787580708734827e-02   +1.055623094728901e-01   +1.170277916894558e-01   +7.886376136972066e-01   +5.299485300526138e-01   +1.856823399236724e-01   +1.250603941066769e-01   +3.172903790733691e-01; +4.941715022715602e-02   +4.914900025538104e-01   +5.280454159151281e-02   +3.025568163640989e-01   +1.172342515250833e-01   +1.737474837630397e-01   +7.194725241123918e-02   +4.470802776758628e-02   +6.677751458960660e-01   +1.266315510233201e-01   +6.403053240974742e-01   +3.684176762629252e-01   +9.268619796593884e-02   +2.667058712783674e-01   +1.278515845685422e-01   +3.175212701309116e-01; +4.872179705646847e-01   +8.529492118059895e-01   +9.323741835368179e-01   +2.961317570896854e-01   +9.884104625892824e-01   +2.105446413342354e-01   +2.430991611823179e-01   +5.058173422462645e-01   +6.045350378650400e-01   +5.486414558427510e-01   +3.289538959919088e-01   +2.056002538577278e-01   +4.057280569590001e-01   +7.977941828917883e-01   +9.148129841160736e-02   +2.172062935173801e-01; +1.916828777571564e-01   +8.747972005917850e-01   +7.279746242675498e-01   +3.354246182412338e-01   +5.413815659641601e-01   +9.055389200870327e-01   +5.426951808212237e-02   +7.606519141234687e-01   +5.264967393883000e-01   +4.852931460388202e-01   +6.541116197617366e-01   +8.742590627534448e-02   +1.040582843498149e-01   +4.879304230668653e-01   +8.640247452077605e-03   +2.517930321787191e-01; +1.224899196053715e-01   +2.706671136647300e-01   +7.370910343157587e-01   +4.683945675696002e-01   +7.057750288136138e-01   +6.745369240704652e-01   +4.405408360170093e-01   +6.318297371534334e-01   +7.292767838018208e-01   +8.907807250404118e-01   +7.511013221032645e-01   +7.729412555657724e-01   +1.111916027641005e-01   +7.697469835551661e-01   +4.238195882364570e-01   +8.934210949044277e-01; +2.064796118182596e-01   +2.097504754850019e-01   +6.339054304810957e-02   +6.483182851734529e-01   +9.989714639365592e-01   +4.680913345317853e-01   +1.457660106678769e-02   +9.116851893606089e-02   +7.071713261759064e-01   +7.997832618937487e-01   +5.841618270197334e-01   +2.073193705764741e-01   +7.857760236440283e-01   +3.972127193304098e-01   +6.551314708671910e-01   +7.027518948806626e-01; +1.464038870039576e-01   +5.637205094509613e-01   +8.591316690893327e-01   +2.448706517065431e-02   +2.881961114753175e-01   +9.116586176643898e-01   +8.972196873117727e-01   +8.051476891551862e-02   +7.806333414832344e-01   +7.345634957361176e-01   +7.409753918184505e-01   +3.891487521062663e-01   +2.910191540591898e-01   +2.728191189830500e-01   +7.231797478787946e-01   +5.552966147886108e-01; +1.888975903076976e-01   +6.386223877053615e-01   +9.333593248807101e-01   +8.428028737191751e-01   +4.131750833215401e-01   +1.035705387726878e-01   +1.956652408501040e-01   +7.752110796584869e-01   +2.881800194844805e-01   +5.277645613056205e-02   +2.345199368000132e-01   +5.521093913738951e-01   +6.040868987756699e-01   +3.735914391709558e-02   +5.298297680424211e-01   +1.843813605380654e-01; +4.349728309696903e-02   +4.165827574714542e-01   +9.836195132149131e-01   +5.582378758853545e-01   +4.667244181833315e-01   +7.444591230614657e-01   +9.321791591672593e-02   +9.054542692701083e-01   +6.898353295443921e-01   +7.219348774655181e-02   +7.343535786575078e-01   +2.284286402077166e-01   +9.637360810014768e-01   +6.738387622138761e-01   +1.075226206662749e-01   +2.119254404835375e-01; +6.352009622766870e-01   +2.064387973320863e-01   +8.572292997110997e-01   +8.534419905011646e-01   +7.641361075512887e-01   +7.375848897316186e-01   +3.069823798050866e-01   +5.334025060782248e-01   +5.557248512628856e-01   +8.735172374595528e-02   +9.713520147231995e-01   +6.423599126305898e-01   +4.316648605960358e-01   +4.303796130277855e-01   +6.329666410667417e-01   +7.721822338199989e-02; +2.820838970035482e-01   +9.488162144095048e-01   +7.856418139364229e-01   +3.484675574357227e-01   +8.177001847743716e-01   +5.622752643242772e-01   +4.554351694363869e-01   +1.085891510485235e-01   +3.949269557571696e-01   +7.960791655805406e-01   +8.677554625862102e-01   +4.836042411715903e-01   +6.947590415605914e-01   +4.506031508388414e-01   +1.283352790664983e-01   +9.143516169439168e-01; +5.377290155415987e-01   +8.094022680191049e-02   +5.145380584469703e-01   +4.462118910650067e-01   +9.961339135470977e-02   +1.857005568561695e-01   +1.019191487446127e-01   +8.271330247292829e-01   +6.151919173049617e-02   +9.426055366277304e-01   +8.668356359013898e-02   +1.512811523664787e-01   +7.582116851050801e-01   +6.082132651550746e-01   +1.342439421757202e-01   +7.073825222272692e-01];
L2I_L1I_iGABA_netcon = [+5.586640084494181e-01   +1.592991248369660e-01   +4.234031606183650e-01   +6.830567029402661e-01   +8.088427506566579e-01   +7.953029372828950e-01   +7.884805504719613e-01   +2.609281659905792e-02; +3.128693077651773e-01   +7.585456085231141e-01   +4.290106682933093e-01   +4.632399512810394e-01   +7.479348505075387e-01   +5.776821368177956e-01   +8.509406256561484e-01   +4.210009460740650e-01; +1.655352297237193e-01   +8.704594976893919e-01   +1.250489307212477e-01   +2.133607700006021e-01   +1.189178153839712e-01   +4.412539118659213e-01   +5.062450136295263e-01   +1.830668388227435e-01; +6.213443394944226e-01   +3.509643061890790e-01   +2.378181583056130e-02   +9.878969093471092e-02   +5.251638843825012e-01   +2.573225014668235e-01   +6.357518364741612e-01   +7.265169945690955e-01; +9.877271938126377e-01   +6.858435673729786e-01   +2.899470854877187e-01   +8.231698387964118e-01   +3.253997281405093e-01   +7.519945630856035e-01   +9.518645871156319e-01   +3.698762726644986e-01; +1.709794539009864e-01   +2.933180881568995e-01   +3.184345506891963e-01   +1.758859377068526e-01   +5.462008062449801e-01   +2.288095171581376e-01   +4.442076637509624e-01   +8.417892769788694e-01; +2.583594563416653e-01   +5.301614667084247e-01   +6.541092966874612e-01   +1.641770780881254e-01   +4.005184349703184e-01   +6.549103357405400e-02   +5.830810318927369e-02   +7.329978420918725e-01; +3.971567935434041e-01   +8.327547391137952e-01   +9.571117180762330e-01   +6.677944619400498e-01   +4.151859374715982e-01   +7.666914620011571e-01   +8.674943446123089e-01   +5.694534619462527e-01; +7.468695083944414e-02   +5.991035435147302e-01   +9.369336035335821e-01   +8.933292327482565e-01   +1.793503127510833e-01   +6.717950707327609e-01   +6.310141895785548e-01   +1.775892483433891e-01; +6.839094528414010e-01   +3.350303803363917e-01   +4.582190105585353e-01   +5.164290106892178e-01   +2.555618960653787e-01   +7.143738951291521e-01   +3.532137093198983e-01   +9.593041524746573e-01; +4.036317515948716e-01   +2.990481700509904e-01   +2.397958831153293e-01   +7.027169565813087e-01   +1.953944462656606e-02   +6.426260245397754e-01   +9.968936914598667e-01   +2.655172819550559e-01; +9.825937741589823e-01   +4.532066496566149e-01   +7.645447807395098e-01   +1.521934383087121e-01   +9.231364067002474e-01   +4.188638081523765e-01   +2.248648271346401e-01   +9.246588379320702e-01; +4.009469239592298e-01   +4.237732568610266e-01   +7.593569693595024e-01   +9.530316798175315e-01   +6.544457198297202e-01   +3.904071016722767e-01   +6.520483917426658e-01   +2.219817420160980e-01; +6.216893780351970e-01   +3.596366181983730e-01   +7.398828617506880e-01   +5.401977537139681e-01   +9.332783326741251e-01   +8.172487439127356e-01   +6.042083912966831e-01   +3.726942169597657e-01; +1.552203006305217e-01   +5.605215907368652e-01   +7.445534073329166e-01   +6.810506105800016e-01   +1.640960150077158e-01   +3.163181049738888e-01   +3.874995862016279e-01   +8.792314592629309e-02; +3.821322450203670e-01   +7.431725589976341e-01   +1.082215210390042e-01   +3.721660531472805e-02   +9.219569199942100e-01   +8.158654612137357e-01   +1.401710378271945e-01   +6.416039090504135e-01];
L1I_L2I_iGABA_netcon = [+1.814637233129423e-01   +9.116161528699548e-01   +2.761047080992262e-01   +8.701539279968908e-02   +5.332127340832490e-01   +1.069713609854773e-01   +9.884547111485715e-01   +4.117784249285979e-01   +7.197904031624776e-01   +2.179975729600564e-01   +9.221095307622279e-01   +6.736609708932554e-01   +1.066318612727112e-01   +5.563027628513511e-01   +6.304586865136131e-01   +4.840837884853134e-01; +4.591783362743825e-02   +7.999565649506173e-01   +2.475134182293989e-01   +8.027900862758497e-01   +8.866435755402384e-01   +6.150677657319434e-01   +7.668655192892879e-01   +6.009972852096254e-01   +9.969736457083715e-01   +1.263243155620082e-01   +7.701255484795215e-01   +4.774552193265939e-01   +1.807889424403714e-01   +7.715849049549719e-01   +1.003996423067387e-01   +8.947186772157862e-01; +7.230830630902643e-01   +7.445679122351239e-01   +4.520354778444561e-01   +9.891625418582035e-01   +8.985020360005096e-01   +9.406137010418966e-01   +3.364187729248468e-01   +7.492799948874465e-01   +3.542896377532677e-01   +3.085237369775665e-01   +4.268066815304922e-02   +6.236968371155998e-01   +9.991778757842378e-02   +3.125402470227925e-01   +3.920414162501418e-01   +1.388377345690729e-01; +3.483133509563305e-01   +8.127148210362268e-01   +2.268772044326449e-01   +6.650125315047899e-02   +6.260049601345266e-01   +3.532776448635542e-01   +6.629421827748482e-01   +5.847653613374723e-01   +9.707528412685940e-01   +7.251919144093510e-01   +3.792869825743287e-01   +2.376385626231526e-01   +4.903985699352372e-01   +1.784348039192179e-01   +5.526408815780798e-02   +3.893402881718479e-01; +6.604235462631746e-01   +3.836246159379466e-01   +8.047576768011837e-01   +9.399173722967337e-01   +1.375887073583323e-01   +4.108952176274275e-01   +2.455772852675878e-01   +5.514149819236970e-01   +3.476778134208610e-01   +7.828136787330410e-01   +7.041025303849897e-01   +1.779832793088421e-01   +1.924592098475789e-01   +3.384483602389515e-01   +5.004759601135885e-01   +9.274548282095574e-01; +3.852322609752070e-01   +6.183280881269423e-01   +9.855581429498032e-01   +1.775852279847893e-02   +2.188993184602525e-01   +9.840598881444377e-01   +2.942941583231624e-01   +5.809514734354035e-01   +8.859353684457667e-01   +6.922970040854097e-01   +7.276013877195863e-01   +8.287318213795418e-01   +8.939750368241692e-01   +2.097919158629960e-01   +4.312745151030303e-01   +9.192484848420834e-01; +6.280884352837913e-01   +5.769379860705219e-01   +3.008792918839814e-02   +6.845335302797744e-01   +1.813486667123550e-01   +9.458074090658419e-01   +6.784111726260335e-01   +5.112583705297141e-01   +4.549324616665827e-01   +9.618249364443391e-03   +2.254839144375298e-01   +7.660052184814536e-01   +9.933651168958213e-02   +5.101191251741113e-01   +9.981436734486862e-01   +7.150774896149196e-01; +2.306316337970280e-02   +5.279393044304157e-01   +5.354201384855172e-01   +7.832541591456852e-01   +4.221543990096648e-02   +6.770037159561799e-01   +5.261887156209847e-01   +8.140684292117654e-02   +4.149338818833395e-01   +8.450024821260437e-01   +2.688259427579611e-01   +9.348903588980542e-01   +4.461945252789360e-02   +9.050342134174152e-01   +8.105022223126892e-01   +6.179123109989719e-01];
L2E_L1E_iAMPA_netcon = [+3.424255690684251e-01   +7.583685875918628e-01   +5.893936270075807e-01   +5.015577214839367e-01   +8.511252295011910e-02   +4.736596294293670e-02   +9.236283621035346e-01   +4.755990679139893e-01; +9.368134497877191e-01   +4.144365937440321e-01   +6.617333042699014e-01   +4.890292314361619e-01   +9.743420244395651e-01   +3.435290171371925e-01   +8.011425110949992e-01   +3.641415825701514e-01; +1.238376260336572e-01   +4.934843646763474e-01   +4.793611969304074e-02   +8.787687102764657e-01   +6.510560182789984e-01   +7.373358034642902e-01   +2.862066271357617e-01   +7.881884901829833e-01; +7.315443300363420e-01   +6.958449444849337e-01   +3.483222329460742e-01   +3.523048016295313e-01   +2.310644546530152e-01   +7.954444590651186e-01   +5.437678313662702e-01   +7.807611998459526e-01; +6.470479318580954e-01   +9.739816872570289e-01   +4.488901827056757e-01   +4.490223379029553e-01   +4.024136525946331e-01   +5.451928431748270e-01   +9.836523549597971e-01   +6.684536037061364e-01; +8.335723292322705e-01   +3.278414686449179e-01   +2.389306021956966e-01   +9.636930328978595e-01   +1.210339964313314e-01   +6.873598877523027e-01   +7.153131412332847e-01   +1.336477754833498e-01; +3.970510826919118e-01   +8.377807052374479e-01   +7.147818804540464e-01   +4.255989304320706e-02   +2.688360518650264e-01   +8.951335036080722e-01   +8.381504047018776e-01   +1.968200176522649e-02; +7.499976638801382e-01   +7.399901199188375e-01   +8.569226345989518e-01   +9.736370428267731e-01   +2.558351277350426e-01   +5.418447315509016e-02   +4.348647521478207e-01   +5.598700564782717e-01; +8.349264973387494e-01   +9.536612497004898e-01   +2.828443735613589e-01   +1.875966144802083e-01   +3.328435408635461e-01   +3.040960271932388e-01   +4.711349885223978e-01   +3.016901936936443e-01; +3.240024312029299e-01   +3.313045375891784e-02   +7.311151051423112e-01   +6.661049515901287e-01   +1.498221284108347e-01   +4.506250014686137e-02   +5.612584667662968e-01   +9.389094403011244e-01; +5.512654869943666e-01   +3.553592989109688e-01   +1.399491939556469e-01   +5.876201815794573e-01   +3.475777147465442e-01   +1.950748999736492e-01   +2.697510334880739e-01   +9.820148859155575e-01; +9.814680404901608e-01   +6.621596447951231e-01   +8.388132126563637e-01   +6.751828879708066e-01   +1.202784322255105e-01   +7.185667277631594e-01   +7.484564161536728e-01   +2.866487015559865e-01; +5.483936719854535e-01   +2.815334942787237e-01   +1.387545232530316e-01   +3.591371086532970e-01   +8.831397735968101e-01   +7.221860778643802e-01   +5.044789788075096e-01   +8.001677470254432e-01; +3.309451784532247e-01   +2.303432789139153e-01   +5.873561269942797e-01   +6.201384414604973e-01   +9.526589026717311e-02   +8.778322772270529e-01   +6.470874059932286e-01   +8.949868689424109e-01; +6.189691299659382e-01   +7.105761036857647e-01   +3.667422682250124e-01   +8.110263092628909e-01   +9.310783069397410e-01   +5.807311802651917e-01   +3.074525586145591e-01   +5.982779008832724e-01; +3.618055460618074e-01   +6.236397868906568e-01   +8.058181888385576e-01   +1.978710515168653e-02   +4.000990146510063e-01   +7.252160494609730e-02   +1.388108013718238e-01   +8.837976232683550e-01];
L1E_L2E_iAMPA_netcon = [+9.432448310186291e-01   +3.721615460005848e-01   +6.680764796227330e-01   +4.851582390074452e-01   +2.468668261831627e-01   +4.519370696447055e-01   +1.234512288166347e-01   +4.972025203598182e-01   +8.827343870335741e-01   +3.245689276929740e-01   +5.142212426844884e-01   +8.591067681717632e-02   +6.316046113662351e-01   +4.291232130014891e-01   +6.128252380374606e-01   +5.038244519239136e-01; +5.488830700871040e-01   +9.366433648268117e-01   +2.084873307039303e-01   +7.572420640687084e-01   +7.849723025542308e-01   +2.055653223182794e-01   +4.062869163083320e-01   +6.935008452864908e-01   +7.199708978750402e-01   +2.459762368879341e-01   +6.573122907810623e-01   +1.632978896037479e-01   +8.587095746144536e-01   +4.918424539015898e-01   +8.202834870185720e-01   +6.127432355710100e-01; +7.286066457887431e-01   +8.289988435281249e-01   +6.534856949043637e-01   +4.165676809172170e-01   +8.829831557996924e-01   +8.983191127660778e-01   +2.757643800377960e-01   +8.336606947226423e-01   +1.933757941606269e-02   +3.430445296203393e-01   +9.520038173286605e-01   +3.245124720788020e-01   +9.760912071333701e-01   +7.137451264548345e-02   +8.864603723434730e-01   +8.201967626157519e-01; +5.769861888587995e-01   +8.498757198698349e-01   +7.205875717881303e-02   +9.722008366347427e-01   +9.124101309403148e-01   +7.636286031533029e-01   +7.170140550237939e-01   +6.120154377437972e-01   +6.740445473742942e-01   +3.752069785820270e-01   +7.224206945353084e-01   +3.016213652137107e-01   +5.699003635768625e-01   +8.874544745228690e-01   +9.307165950362741e-01   +5.325913305319557e-01; +2.585284134370600e-02   +3.716656039261952e-01   +4.073457462113320e-01   +9.896307004509316e-01   +5.577273835997602e-01   +8.834076122815254e-01   +2.829569831740138e-01   +5.749750175182062e-01   +4.389171354467457e-01   +5.455996735137778e-01   +3.994710862932594e-01   +1.143568030172120e-02   +9.968787862694718e-01   +6.452860985132142e-02   +1.922368141313215e-01   +2.023972138376679e-01; +4.475735153324055e-01   +5.928365220560619e-01   +6.663110684486363e-01   +8.636953289133338e-01   +5.992030566291416e-01   +2.869019031995139e-01   +8.960411917872362e-01   +3.243656500240075e-01   +4.361748887522846e-01   +5.633426173529106e-01   +8.338669617811562e-01   +5.408318218756687e-01   +5.537848149526952e-01   +4.355615746390817e-01   +2.580257569460913e-01   +4.549745779817368e-01; +6.471437996919327e-01   +8.739192743263453e-01   +9.360671867871422e-01   +3.879945687357710e-01   +1.478928384804217e-01   +6.712561727714335e-01   +8.268829456658385e-01   +4.555908447984675e-01   +1.162657348180812e-01   +3.953134681477981e-01   +1.351842914648780e-01   +9.678205654997495e-02   +5.149774901585945e-01   +8.253213049383972e-01   +8.969493936394702e-01   +4.285171553025732e-01; +5.216423718743017e-01   +9.336357097351941e-01   +8.094286784101091e-01   +4.538798326575517e-01   +9.014066490733773e-01   +6.636582149709657e-01   +3.900165547219006e-01   +7.143638848626883e-01   +8.146092976506756e-01   +3.973660787533921e-01   +5.999351360065736e-02   +1.470023237908111e-01   +3.317023006754005e-01   +3.927975466694472e-01   +5.941710915405291e-01   +9.657745318732420e-01];
L2I_L2E_iAMPA_netcon = [+6.193486678249138e-01   +6.961344994529339e-01   +7.340880343646776e-01   +5.905546847033337e-01   +6.696614065373169e-01   +5.486261075481805e-02   +9.916880428745754e-02   +8.480725188184743e-01; +6.969002687660945e-01   +4.261586188835111e-01   +4.298426832452492e-01   +4.591276757857762e-01   +5.007355395899854e-01   +1.535729802617933e-01   +9.079777935873564e-01   +9.170472488108998e-01; +7.210901993229732e-01   +8.367097057115416e-01   +6.939065733643016e-01   +5.171250321622129e-02   +2.191723680958915e-01   +1.965541144144355e-02   +1.106102532824441e-01   +9.867510752370937e-01; +3.470802834556014e-01   +7.304726424941997e-01   +9.452438113047263e-01   +2.286200920729757e-01   +5.723963205459810e-01   +4.348576450094384e-01   +5.177899804773451e-01   +5.039204145788323e-01; +5.178460220583860e-01   +3.600986078391588e-01   +7.840769133700491e-01   +8.340565827098684e-01   +1.219963455870531e-01   +8.317933522229634e-01   +1.431040114129065e-01   +2.709767220146960e-01; +5.570266831622148e-01   +4.540956693711225e-01   +7.054461252204609e-01   +1.495690777037429e-02   +6.707128907615538e-01   +6.165182420742273e-01   +5.591075824005162e-01   +1.011211367695805e-01; +1.579465249586043e-01   +3.877880268037913e-01   +1.095545312938003e-01   +8.643329182196959e-01   +5.997440389530638e-01   +5.194039376926999e-01   +4.354975651523697e-03   +5.083499313212902e-01; +5.636023693239639e-01   +7.751005116393219e-01   +3.895803056137518e-01   +7.907533422752840e-02   +5.593544001873917e-02   +8.637342474242097e-01   +7.677229447381739e-01   +5.843970426390288e-01];
L2E_L2I_iGABA_netcon = [+7.641795190931279e-01   +9.418955686814952e-01   +2.385735843201967e-01   +8.335791019726599e-01   +2.576083506495588e-01   +7.526448074030580e-02   +1.735421318363058e-01   +5.239874834912166e-01; +8.273991357385838e-02   +6.569420395547152e-01   +5.781777529252623e-01   +4.025526122898706e-01   +2.987033802486334e-01   +3.945487304941649e-01   +1.393291279561849e-01   +2.648284219819211e-01; +6.600266997606343e-01   +4.516489412590558e-01   +8.665209262483807e-01   +3.908854841300418e-01   +4.248601826614847e-01   +3.729185416047272e-03   +5.983035308462524e-01   +6.807172301327710e-02; +5.167846711792560e-01   +8.398015742122638e-01   +4.055506944607056e-01   +3.620160820883350e-01   +1.184263578273755e-01   +2.197692254034340e-01   +8.994508642262640e-01   +4.364022507411223e-01; +1.721704787648828e-01   +5.332936120109215e-01   +1.117953289610420e-01   +1.382603063864857e-01   +4.971010016831180e-01   +6.918247838315782e-04   +9.386903604181802e-01   +1.730663844484376e-01; +9.398655338640857e-01   +5.539128028240482e-01   +4.437128419340369e-01   +2.576905914716228e-01   +7.065998936913204e-01   +1.904162098557957e-01   +2.199630006749461e-01   +2.722018391382070e-02; +5.909052156331666e-01   +6.806771214211064e-01   +2.977889303775964e-01   +8.653017418615834e-02   +2.433984171206032e-01   +1.424392648626603e-01   +4.814307367006660e-01   +9.537757971874765e-01; +4.403898824013860e-01   +3.670437659458731e-01   +4.008593010263924e-01   +4.293396436676559e-01   +7.846450966988380e-01   +2.679229545870562e-01   +3.765301813986859e-01   +4.308784368480226e-01];
L3E_L2E_iAMPA_netcon = [+9.615209859448290e-01   +7.732117338677287e-01   +9.110468145963985e-01   +5.311182321224638e-01   +4.795664824713017e-02   +8.190189071881856e-01   +6.250111386465539e-01   +7.487835698134079e-01   +6.736398478483284e-01   +9.055345404015406e-01   +5.824162818769225e-01   +5.901735544280097e-02; +7.621967799457574e-01   +2.271899182839404e-01   +9.075220537799352e-01   +7.163050651925691e-01   +5.521515584957747e-01   +7.269116087848280e-01   +5.419841712527544e-01   +6.461332505213645e-01   +4.317180437750023e-01   +3.938764418936488e-01   +6.867834542482064e-01   +9.806852208483691e-01; +8.334411818978323e-03   +3.706901975889701e-01   +5.915138617469324e-01   +1.797783332405129e-01   +2.744994629817887e-01   +1.776498750313689e-01   +4.379034923955678e-01   +1.220085644855894e-01   +6.926467531588694e-01   +2.512393065399598e-02   +7.203673667862653e-01   +2.849162016342493e-01; +6.799135561775076e-01   +8.920548016500430e-01   +3.313055039671794e-01   +3.353838121665391e-01   +2.431469615098524e-01   +3.610290754015315e-01   +2.868379960316355e-01   +5.053525472105684e-01   +2.571424947022841e-01   +6.704991412395473e-01   +6.494378738195211e-01   +5.937220307111842e-01; +7.048473222487588e-01   +8.566745154283906e-01   +8.530284932200469e-01   +1.869408043445180e-01   +2.425913167830765e-01   +1.871909165990155e-01   +5.013962761179276e-01   +3.474406580401946e-01   +1.163022636332865e-02   +8.369566159408622e-01   +7.255255371243347e-01   +9.613862186986529e-01; +6.451558147601357e-01   +4.012167891758083e-01   +4.425008219202105e-01   +3.214314018677700e-01   +1.545610881302412e-01   +1.155066345653545e-03   +7.630353614462786e-01   +9.096851453325842e-02   +5.317092160861804e-01   +9.712364539161716e-01   +3.744295256554317e-01   +1.871476577569229e-01; +5.537633246385313e-01   +3.190395913101007e-01   +9.023754389644868e-01   +4.040087150867437e-01   +9.584564388394072e-01   +3.144752347740649e-01   +7.616310705352501e-01   +1.479483281643935e-01   +2.798041954919099e-01   +5.664796630602106e-02   +5.805008104151974e-01   +1.927017054029209e-01; +2.177132948283664e-01   +6.088208048536285e-01   +3.422658963854139e-02   +5.486859646131447e-01   +9.362891833190952e-01   +6.985633445960343e-01   +5.769430332505561e-01   +1.989133488819458e-01   +9.460030360658447e-01   +4.495404690425248e-01   +1.148840235589352e-01   +3.406222567985663e-01];
L3I_L2I_iGABA_netcon = [+9.332904807798593e-01   +9.266389727658882e-02   +6.168084668698120e-02   +2.785022454874119e-01   +2.548397481922046e-01   +4.044983632232615e-01   +5.292860146953836e-01   +1.090473257071451e-01   +9.126730365378583e-01   +5.846708673239847e-01   +2.087074862397972e-01   +9.081374016435855e-01; +3.904870744911315e-01   +6.165555936815080e-01   +4.945076767659984e-01   +7.460864787122651e-01   +8.576175882988949e-01   +9.880207088301050e-01   +8.293041933949126e-01   +2.711057865241502e-01   +6.392636677814270e-01   +2.839350672102170e-01   +3.178285692811096e-01   +5.510779530817734e-01; +2.723917117774349e-01   +1.159716742103543e-02   +6.431496836103836e-01   +2.382191923435348e-01   +9.113555150278501e-01   +8.977878513576265e-02   +8.577340273836627e-01   +5.241656276669632e-01   +2.552060283912169e-01   +8.277640722319700e-01   +1.331014730260213e-01   +3.381387611173289e-02; +1.525456852572390e-01   +5.730966569727614e-01   +2.226936840258008e-01   +9.574439131623511e-01   +6.990025593088124e-01   +3.219667159342023e-01   +7.881704816579194e-01   +9.721870470122955e-01   +9.049281167744412e-02   +1.918438733954669e-01   +6.726792086854291e-01   +5.397065017427816e-02; +3.964764620112335e-01   +7.877535293696766e-01   +8.374864564222452e-01   +6.216233405737891e-01   +7.262604560509206e-01   +5.133044792346342e-01   +3.186851128194839e-01   +7.085584372044806e-01   +8.384831587189923e-01   +4.411662130522070e-01   +5.701234727995192e-01   +8.061313883826193e-01; +3.747704855439790e-01   +2.358406455275574e-01   +9.707749682386944e-01   +6.009047871153554e-01   +2.300265963344537e-01   +5.912183851568820e-02   +4.524183133425015e-01   +3.104378399379503e-01   +5.843636598293592e-01   +3.933083945095104e-01   +1.706536006971159e-01   +4.515079446182170e-01; +1.291852086725020e-01   +4.477190431758074e-01   +8.467642274876067e-01   +1.726320399395466e-01   +5.744433974691319e-01   +7.250108302318291e-01   +7.526619385687381e-01   +2.933723706994609e-01   +9.482216378850422e-01   +8.270956909765949e-01   +1.481325726320670e-01   +3.809052055370740e-01; +4.341637469703487e-01   +5.692771185227127e-01   +5.064711040637959e-01   +8.971480878106675e-02   +8.111652311502923e-01   +5.570811901863590e-01   +1.110789882280518e-01   +8.495701968584323e-01   +6.176771137478926e-02   +6.785801520439237e-01   +4.761431996073611e-01   +7.904363444066667e-01];
L2E_L3E_iAMPA_netcon = [+3.647329309507546e-01   +7.560999526034438e-01   +7.392100154824197e-02   +5.175298222720714e-01   +7.576210368720609e-01   +4.322068396761082e-01   +1.998960924625676e-01   +8.757479697114967e-01; +5.315350438654534e-01   +9.975759471742995e-01   +5.913004670237907e-01   +9.947860454238486e-01   +9.953126250207489e-01   +5.428815649873648e-01   +1.938836935978342e-01   +7.864462730196976e-01; +7.130344839381114e-01   +1.877484011321236e-01   +9.103829206516372e-01   +8.567927035804878e-01   +9.625326383733770e-01   +7.121818926575627e-01   +3.263531998250478e-01   +4.663733397148980e-01; +8.710928493163362e-01   +7.811208334965862e-01   +1.920431778106877e-01   +9.611255196239579e-01   +5.354010931917802e-01   +1.591748970795453e-02   +8.801071841853165e-01   +8.136954861866389e-01; +3.288092397087841e-01   +1.953785420894815e-01   +4.318211706762261e-01   +6.782439176999228e-01   +9.654447286609813e-01   +8.015945808806590e-01   +4.713143908706302e-01   +8.972106493184405e-01; +6.492538008704895e-01   +9.923410539199458e-01   +7.491132261306499e-01   +4.025487759324203e-01   +1.168076129140604e-01   +1.424032863896321e-01   +4.041079512174364e-01   +4.280114812265536e-01; +9.763515311914729e-01   +8.020394705247054e-01   +4.017427652283670e-02   +9.333170977829002e-01   +4.988964731741551e-02   +4.792743108855944e-01   +1.801092960392680e-01   +3.339960419903467e-01; +7.639207668751713e-02   +4.243976758629405e-01   +9.462891038482951e-01   +4.801136336056248e-01   +3.029288706128010e-01   +2.551601846685151e-01   +9.692632255321794e-01   +5.967403318853015e-01; +5.885257069417070e-01   +7.284508520417138e-01   +7.632821559343371e-01   +2.298957887881313e-01   +5.813565502315409e-01   +3.694835905453469e-01   +4.085974111937795e-01   +9.008892806308222e-01; +4.130216090094502e-01   +4.978792892108175e-01   +5.569960968282794e-01   +3.965339262022553e-01   +5.318906651095306e-01   +6.615018066983265e-01   +8.439977502285317e-01   +7.019792179631453e-01; +3.082758430240843e-01   +8.086739085721878e-01   +1.836788362363280e-01   +7.047282951404347e-01   +9.005103770049426e-01   +1.681339057739928e-01   +6.169223043711605e-01   +3.785743835875527e-01; +2.635244831131726e-01   +3.568161120823399e-01   +5.002885242592281e-01   +5.582782963826152e-01   +5.402477391428616e-01   +2.799644228920638e-01   +3.748057581785705e-01   +7.351254871785547e-01];
L2I_L3I_iGABA_netcon = [+9.545407611766686e-01   +3.164731269110871e-02   +9.057163374581680e-02   +4.593617084469611e-01   +3.274399098050120e-01   +3.678212563672690e-01   +6.851429520096454e-01   +8.046337102327953e-01; +5.427377649776026e-01   +2.083367455233609e-01   +5.933940466016764e-01   +6.380305398230951e-01   +8.040539523137507e-01   +2.095071040100047e-01   +9.098920892608624e-01   +6.659240598337858e-02; +5.385653753261143e-01   +4.546540043895495e-01   +2.405949856414603e-01   +9.163304930054097e-01   +9.999708816123100e-01   +4.408050133227709e-01   +6.107032775475629e-01   +9.487636726649239e-01; +3.097143724959205e-01   +1.265838255599661e-01   +8.390467225864192e-01   +1.616031380097207e-01   +9.794840189628140e-01   +9.544695504744611e-01   +8.995875167643730e-01   +4.957097397528424e-01; +6.968973621454140e-02   +9.482432681199303e-03   +8.579069858710323e-01   +7.137167218184003e-01   +1.257746235145809e-01   +1.236754919378350e-01   +1.940932682343609e-01   +7.538177879528177e-01; +1.824386984368070e-01   +7.275350388160390e-01   +9.609266184453671e-01   +5.771061330364009e-01   +2.305074087520904e-01   +4.692534235112522e-01   +7.533003484466060e-01   +7.402797606512559e-01; +9.195340100407716e-02   +3.533372776720804e-01   +4.882673322488410e-01   +4.321203625459212e-01   +2.413435882872897e-02   +8.552194920629536e-01   +3.474066295875319e-01   +8.306937124971047e-01; +4.638966960247969e-01   +7.792503584402966e-01   +2.182911534910057e-01   +8.827666994466610e-01   +6.075909101597740e-01   +4.246905808113706e-02   +4.189243219130645e-01   +1.559764563422974e-01; +1.005543648217901e-02   +4.360328586467802e-01   +2.267071470384718e-01   +3.912049497661125e-01   +1.095080348046461e-01   +6.896900305426149e-01   +1.542142188602099e-01   +4.571301477685227e-01; +9.141879970948157e-01   +4.373589704564695e-01   +5.366693861967429e-01   +1.776149606327962e-01   +4.070011806676539e-01   +9.771162869512754e-01   +8.188718423704093e-01   +6.183343630520317e-01; +6.423059178895100e-01   +5.055536477423634e-02   +7.619852726857762e-01   +6.311837518352116e-01   +8.838217424341942e-01   +2.840700237171435e-01   +6.225899441424343e-01   +9.298864903231177e-01; +1.988184180712067e-04   +4.830331952435698e-02   +3.460662309872187e-01   +6.236342228128118e-01   +5.484119931521209e-01   +1.337536734330705e-01   +7.399360400442947e-01   +8.338791647782429e-01];
L3I_L3E_iAMPA_netcon = [+8.951636188908570e-01   +2.552201680170463e-01   +7.402394994417963e-01   +6.815652295823021e-01   +6.016440812822911e-01   +7.483452982104893e-01   +7.454736399650261e-01   +2.232816054345845e-01   +4.549449725993437e-02   +8.009799412956057e-01   +2.904837055748870e-01   +8.021163951520689e-01; +5.822211716500960e-01   +3.228811756336193e-01   +6.933302864177697e-01   +2.363238120564172e-01   +8.559671595345075e-01   +5.431867425622062e-01   +1.267529667748816e-01   +3.510015627365078e-01   +2.141578099569917e-01   +2.339382678601756e-01   +4.030670779546722e-01   +1.040130863987326e-01; +5.826448763267907e-01   +4.022086970639551e-01   +8.231052359212483e-01   +4.557976374756029e-01   +9.899655344268800e-01   +3.394881594333554e-01   +8.218990364667234e-01   +2.863979196391432e-01   +3.970374173918622e-01   +9.312760499892462e-01   +8.625804239536771e-01   +8.210022839145806e-01; +8.550268286173088e-01   +4.051741059654624e-01   +8.288178137952621e-01   +3.835288343009248e-01   +9.288618703000957e-01   +8.323911751186189e-01   +2.657337100174861e-02   +9.272311705864943e-01   +3.338907864734028e-01   +7.634804453504457e-01   +6.147795914557367e-01   +8.410619046181854e-01; +3.334865037132666e-02   +3.860781210675208e-01   +2.950993599588861e-01   +5.377452798695156e-01   +4.102274366819452e-01   +5.509373158839080e-01   +4.161136553697575e-01   +5.112108558569728e-02   +2.288844872951792e-01   +8.276411074728353e-01   +9.907408047903156e-01   +3.558695783982119e-01; +8.844085604493298e-01   +6.087936672002366e-01   +3.092679483114305e-01   +9.911568574360481e-01   +9.339255034150726e-04   +9.577023697504196e-01   +7.302175868622692e-01   +5.930480152624847e-01   +9.348836097814289e-01   +5.732196591402978e-01   +2.038013402287030e-01   +4.298761647783600e-01; +4.064518075433542e-01   +1.654176478626120e-01   +5.239902176440713e-01   +7.556265974470802e-01   +5.425873770924412e-01   +8.935361667845334e-01   +7.816957477481881e-01   +1.619292878932136e-01   +6.816031580624634e-01   +7.924541249006862e-01   +8.278855295599395e-01   +5.701072786684608e-01; +3.690791533570650e-02   +1.889381516462996e-01   +3.266542884942492e-01   +9.818440234350447e-01   +2.082022746276322e-01   +3.575927632982500e-01   +3.675836656669837e-01   +8.372900690103600e-01   +9.631376531844739e-01   +3.290053263045848e-01   +6.765067112505503e-01   +6.998300047161153e-01; +7.460784602254010e-01   +9.614408729607664e-02   +8.339050803068582e-01   +2.354995681880596e-01   +2.196132529313944e-01   +5.479573132954678e-01   +7.465772682406069e-01   +1.678145620301902e-01   +4.390637216176765e-01   +2.236781874758814e-01   +2.485316639149808e-01   +7.431355796189267e-01; +1.553710509092976e-01   +3.223766577370786e-01   +8.088490465259757e-01   +5.284050118974781e-01   +3.281169244283114e-01   +3.464667624403940e-01   +8.928669007980372e-01   +5.015386847506154e-01   +9.389140145357259e-01   +3.111554118963051e-01   +4.769616407294965e-01   +7.568513844682947e-01; +1.444256338618955e-01   +7.696987085953113e-01   +5.583724293772921e-01   +5.324544826738516e-02   +9.595481304389494e-02   +6.233400676799764e-01   +2.442813102510919e-01   +9.986631201321410e-01   +6.195044451884158e-03   +5.848974549128011e-01   +3.993106699642663e-01   +3.891074560408845e-01; +6.065698504217979e-01   +2.353225372100270e-01   +2.638232824046867e-01   +7.578673850914391e-01   +7.492621926920927e-01   +7.983885364536601e-01   +1.288487224342432e-01   +3.549390217580732e-01   +6.112742843383610e-01   +8.302477171339450e-01   +5.988877493436571e-01   +4.270135201024789e-01];
L3E_L3I_iGABA_netcon = [+9.556617878238727e-01   +8.848706900428174e-01   +8.003820568490096e-01   +9.855229678320157e-01   +9.015553833045711e-01   +9.613577304970804e-01   +6.535863658877691e-01   +4.970976875847008e-02   +1.085280525260684e-01   +4.523197474007079e-01   +8.291767119252269e-01   +5.804430286778612e-01; +5.727202010159135e-01   +4.372987374373143e-01   +9.870260468466506e-01   +5.597697923283376e-01   +9.944313785014266e-01   +5.421778313878035e-01   +6.619260066206926e-02   +4.660032109511659e-01   +4.610080499584917e-01   +3.344060848761723e-01   +6.258577928016269e-01   +6.363683634584835e-01; +8.503066655216284e-01   +7.817367472705234e-01   +1.592854615584426e-01   +9.329116582596904e-01   +6.518237820726440e-01   +3.155303809459521e-02   +2.758826135896241e-01   +3.245411888342825e-01   +4.514638070331300e-01   +5.874938390170754e-02   +5.398828641251223e-01   +6.503019245771484e-01; +2.764692016425939e-01   +1.495295193954386e-01   +2.375957592824285e-01   +7.201945022280095e-01   +1.074097865500277e-01   +6.958267317547603e-01   +2.817897869291545e-01   +6.309354181056911e-01   +5.501330866323801e-01   +7.407708168074025e-01   +6.502465510460732e-01   +8.638967144103181e-01; +6.226593407175052e-01   +6.207310873334105e-01   +7.018513385569976e-01   +4.849847479812038e-01   +3.739840530111694e-02   +5.194562045158323e-01   +8.793715682616833e-01   +2.294939193949045e-01   +8.060826249375463e-01   +5.066051627350717e-01   +7.257860604355406e-01   +5.674539697860279e-02; +5.902345655402721e-01   +2.602494164891468e-01   +3.769966613005476e-01   +6.394961790984173e-01   +6.187412461909880e-01   +6.012539457862544e-02   +4.448872253121003e-01   +5.801844919535414e-01   +7.011528762196144e-01   +2.008401310602651e-01   +9.447826983668514e-02   +8.183228673323130e-01; +9.642736115027941e-01   +4.449965484779732e-01   +9.752676724473532e-01   +8.874795361724735e-01   +5.663980136299323e-01   +8.886889063860312e-01   +7.577674895420633e-01   +6.037572043990183e-01   +8.726672771533701e-01   +4.261761731522548e-01   +8.790801850346794e-01   +5.284323203265988e-01; +8.674259410781426e-02   +8.451745854701561e-01   +9.709645088414099e-01   +1.974656573546006e-01   +9.615579689275235e-01   +3.298222993565531e-01   +6.015743888713271e-01   +6.002256571069211e-01   +5.220743779541562e-02   +1.679071795160607e-01   +1.247659223003928e-02   +6.952715068834037e-01; +5.010625984635314e-01   +1.975332657827771e-01   +6.427839231726031e-01   +3.961824425851150e-01   +7.477940442894599e-01   +2.282895822915518e-01   +7.832359961301157e-01   +4.477208390576176e-01   +2.184230942848899e-01   +7.513091542915653e-01   +2.921133485354490e-01   +2.122883549997592e-01; +5.218509810849401e-01   +3.031036672115511e-01   +8.595562040033560e-01   +9.922449074609566e-01   +6.624216050708821e-01   +1.135343444127326e-01   +1.143964847437753e-01   +3.382005119487813e-02   +4.592195698292161e-01   +3.672691351423042e-01   +1.793677804934280e-01   +5.440990806703763e-01; +9.054516105655561e-02   +4.808246909583534e-01   +4.019067056898776e-01   +4.014639618484720e-01   +5.239719526627138e-01   +3.119421647522460e-01   +9.777655774004841e-01   +5.128618232101925e-01   +9.584467450952857e-01   +9.426636385906962e-01   +9.262876708304710e-01   +7.038152375981773e-01; +9.057713966109727e-01   +3.373178838877326e-01   +6.308052919390371e-01   +6.587754213725090e-01   +2.592205796293860e-01   +2.271897870819008e-01   +8.489135989492571e-01   +4.070878866889062e-01   +7.920407724717841e-01   +1.570029133268894e-02   +6.881378265313572e-02   +9.560396942570999e-01];
L2E_Input1_iAMPA_netcon = [+9.973510123510253e-01   +9.999927441157642e-01   +9.984419416832330e-01   +9.987869780305195e-01   +9.967914060926819e-01   +9.975266098643946e-01   +9.978252956926250e-01   +9.969672072069599e-01];
L2I_Input2_iAMPA_netcon = [+9.986773762254632e-01   +9.985378296262740e-01   +9.992556956225209e-01   +9.995500569095344e-01   +9.991320820835206e-01   +9.974047078200352e-01   +9.998773470133246e-01   +9.974772436787631e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
