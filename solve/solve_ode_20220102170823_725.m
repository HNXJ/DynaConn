function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.012602945618405e-05   +1.051069109197883e-02   +1.663486833961147e-02   +1.549254041630613e-02   +7.695701447081167e-03   +2.045396978203089e-02   +1.978841588881099e-04   -1.018846444761762e-03   -6.299634786082836e-04   +7.014903725505033e-03   +7.960349131801100e-03   +4.611532164534119e-03   +7.109469203241932e-03   +2.036811495982828e-02   +1.003738277682121e-02   -4.018595496607263e-03; +1.112970917794921e-02   -3.391110234061569e-03   +1.342099206770779e-02   +1.570880878509616e-02   +4.479221375973685e-03   +1.717904697904891e-03   +1.670109885790690e-02   +1.687417670177725e-02   +1.502073162269525e-02   +1.080036725896392e-02   +1.806267179081646e-02   +9.930096102317586e-03   -1.632568588611262e-04   -6.219673429285717e-03   +9.147346178081573e-03   +5.430264625709011e-03; +7.195109278770854e-03   +1.233921717624589e-02   +1.338916529521906e-02   +5.891041923558457e-03   -2.071109679131254e-03   +1.498252227814582e-02   +2.056075718501834e-02   +9.238623483941432e-03   +4.123965786460027e-03   +1.067445629711564e-03   +1.092794301213746e-02   +3.353850728724448e-03   +4.711483847066093e-03   +9.991596166254193e-03   +1.786236830780996e-02   +1.273175009489985e-02; -6.261338913187281e-04   -5.541727878934309e-04   +5.869324335450904e-03   +9.635347427761455e-03   +2.049402710363484e-04   +1.197194810809141e-02   +1.315577377026976e-02   +1.698267898341917e-02   +9.665009723305137e-03   -5.008455086841136e-04   +1.533175669171895e-02   +1.240081164915228e-02   +6.476339041349909e-03   +2.037913653783341e-02   +7.750103137890996e-03   +3.439524566382057e-03; +8.618113314015064e-03   +8.830666175855949e-03   +9.104237254439741e-03   +8.687972806433972e-03   +1.214605206595861e-02   +1.761531941251650e-02   +1.220350925033767e-03   +6.954744445586605e-03   +1.118465085663227e-02   +2.575459990045761e-02   +6.629268751294092e-03   +1.139449440701200e-02   +4.564628093459271e-03   +9.644941465954834e-03   +2.368320245176488e-02   -1.129400791184774e-03; +8.124830134013021e-03   -1.117369222897492e-03   +1.305514975738607e-02   +3.991030663290034e-03   +9.920872242053669e-03   +7.084884715615255e-03   +1.194434876825535e-02   +7.187225245237534e-04   +5.313081130146708e-03   +1.062092469417357e-02   +1.353455268689198e-02   +6.173755230565762e-03   +1.204459117249739e-02   +4.908151358506442e-03   +9.481402806383170e-03   +1.443127406866032e-02; +4.797209980607592e-03   +1.033880113136511e-02   +1.703404349564191e-02   +1.758761448432320e-02   +1.243506825182225e-02   +1.084571664875549e-02   +5.643139925991420e-03   +2.072878040991144e-02   +2.087723775214876e-02   +3.115246672007850e-03   +7.900755346813484e-04   +5.772532672566047e-03   +2.273437515659952e-03   +1.776520470265877e-02   -3.415121037428131e-03   -3.732808884569590e-03; +1.476869142349714e-02   +1.662791825530428e-03   +1.502705396684483e-02   +1.619961910169143e-02   +8.230527069530567e-03   -3.570098386383364e-03   +1.977377550069919e-03   +5.654927704920893e-03   +1.397805055522864e-02   +1.911111546808509e-02   +4.641628691784154e-03   +1.215670134721303e-02   +8.107543196873374e-03   +5.649945324143289e-03   +1.319811819053973e-02   +1.472468508117438e-02; +1.651683055618866e-05   +1.410269708177043e-02   +1.009714834393322e-02   +1.182689485022183e-02   +1.285187855528225e-03   +1.185436450379197e-02   +4.151209416096579e-03   +9.424749751960868e-03   +5.892211223181979e-03   +1.105866068819432e-02   -1.028857661781223e-04   +1.498295621953601e-02   +1.670748197146272e-03   +1.565647329949912e-02   +1.288892797861691e-03   +1.692130522435350e-03; +4.279457908698650e-03   +5.235973472672049e-03   +2.092137355882294e-02   +8.260151401734989e-03   +9.176728033675677e-03   +5.685595274511115e-03   +4.307308159731714e-03   -5.056941734820055e-03   +9.105796275931275e-03   +2.219860956366893e-03   +6.220829821647062e-03   +1.219981810494196e-02   +1.393018048390056e-02   +1.512949330049379e-02   +1.820725064568869e-02   +9.767002754178184e-03; +3.827225295281477e-03   +2.957617984149091e-03   +1.370991117108042e-02   +1.593512603771692e-02   +1.233280955281497e-02   +9.612742983513913e-03   +1.397881899921798e-02   +1.466857823568690e-02   +6.105866210642604e-03   +4.503454123049733e-03   +1.675155597902962e-02   +1.421165717978875e-02   +1.750790053306811e-03   +6.445803569801804e-03   +1.386017914810374e-02   +9.675457379028630e-03; +1.066602808171446e-02   +1.433523811043482e-03   +1.826038112389292e-03   +2.870414817370175e-03   +1.511753904979442e-02   +2.209334130509882e-02   +3.776735829852855e-03   +1.002245172973970e-02   +1.115320376739971e-02   +3.968805662803525e-03   -1.474425085023957e-03   -2.187550605027113e-03   +1.749188082284390e-02   +2.728608685375384e-03   +9.220190215455922e-03   +8.661771843778247e-03; +9.756204573473226e-03   +1.547267716728508e-02   +1.070837052114379e-02   +4.671749976819429e-03   +1.908803517845445e-02   +8.636969238568855e-03   +1.127963067684113e-02   +1.733662958451841e-02   +1.458528158981145e-02   +6.346818409665570e-03   -9.066757086438887e-04   +1.795093684133267e-02   +1.121949916666733e-02   +1.071832667785539e-02   +9.981621539226384e-03   +1.816239188129740e-02; +1.316950144980196e-02   +1.240113677266542e-02   +5.096626977388168e-03   +1.272400224237124e-02   +1.852110496727688e-03   +6.913766841332562e-03   +1.351482198336581e-03   +5.006599839924161e-03   +2.961592277272795e-03   +1.230059873258004e-02   +2.664075378380235e-03   +1.995018506124673e-02   +1.119506121331488e-02   +1.119798454123536e-02   +2.430466764923557e-03   +5.899418769101629e-03; +1.361382858732474e-03   +1.745519964129405e-02   +1.634438458006894e-02   +8.509848350635851e-03   +1.470760408883346e-02   +4.850043292000503e-03   +4.383500712865245e-03   +9.826043103256870e-03   -9.108127999045732e-04   +1.863246501689878e-02   +1.392728038312799e-02   -2.456731573417517e-04   -1.856041113972665e-03   +1.758314949373269e-02   -1.583384333053729e-03   +1.143855074176620e-02; +1.620035609082489e-02   +4.567270313463542e-03   -7.428830792940418e-04   +2.516473728455452e-02   -2.042979432935696e-03   +1.672891689369900e-03   +1.322908312823911e-02   -3.418786652058805e-03   +2.826947740376942e-03   +1.893943302052807e-02   +1.468339479943439e-02   +7.680449694970537e-04   +1.299535991618940e-02   +1.524823925250125e-02   +1.648969094747717e-02   +1.612056609793381e-02];
L1E_L1I_iGABA_netcon = [+1.094207278228692e-02   +1.105513523257133e-02   +3.884961963186615e-04   +8.064209762945097e-03   +1.331868424098968e-02   +1.328325815398505e-02   +1.063385499540206e-02   -5.847333815608619e-04   -2.254576805737216e-03   +5.332670389372043e-03   +6.108917940687656e-03   +9.504168583321071e-03   +5.017898774691491e-03   +1.965998556012901e-02   -4.724574835766057e-03   +6.010915894382973e-03; +3.834310448924266e-03   +1.228898018829235e-02   +1.078152876094962e-02   +1.387425039026283e-02   +8.947100334280101e-03   +1.006764867033282e-02   -3.972876995894035e-03   +1.548366563405639e-02   +1.271790190363340e-02   -1.934086097782860e-03   +1.508331565400376e-03   +1.329669212186117e-02   +3.575010954777512e-03   +9.591818848205981e-03   +4.424757596557347e-03   +1.580255824061162e-02; +6.405078406181627e-03   +2.129583172384721e-02   +1.989788591417833e-02   +8.074744518544771e-03   +1.197049035726357e-03   +1.203556927698271e-02   +1.158471511257007e-02   +1.380006906528867e-02   +1.667554095010147e-02   +1.456864504808084e-02   +1.232377815266213e-02   +1.121461219653459e-02   +2.154149815748665e-02   +1.429393601429418e-02   +2.384995005806017e-03   +8.895839973734757e-03; -2.330285129202521e-03   +9.975195445450480e-03   +1.709250330226421e-02   +8.288398938373331e-03   -5.090250133835394e-03   +9.501729679348571e-03   +1.491039917669414e-02   +1.115075447225438e-02   +6.586416739033569e-03   +1.586569903839472e-02   +1.090788340505074e-02   +5.931527256626014e-03   +7.456847198316249e-03   +6.562027752082422e-03   +8.899411606786159e-03   +1.721927073890176e-02; +4.403832455894275e-03   +1.834540307660902e-02   +7.206546527544723e-03   +3.294324229813485e-04   +1.105318952301602e-02   +1.584033325750023e-02   +1.088946953739445e-02   +8.231880091731477e-03   -1.592968972270915e-03   +5.719833503827997e-03   +1.314310798972552e-02   +6.196756283220868e-03   +7.014809461214513e-03   +7.298904783668644e-03   +8.116382653544318e-03   +3.592978595562669e-03; +1.581377902725797e-02   +1.089470275540332e-02   +3.436249498152267e-03   +1.413552801031380e-02   +5.473704568150510e-03   +2.881907565518708e-04   +1.346895428219809e-02   +5.832516484721792e-03   +2.004547208051436e-02   +5.411744119204210e-03   +1.323957487588849e-02   +3.657386513949026e-03   +3.872627505241828e-03   -3.166366781885631e-03   +1.536608191153535e-02   -9.023327323392067e-04; +1.074830570560460e-02   +5.497022247754388e-03   -1.768394550307103e-03   +9.752656163209533e-03   +3.882001885675368e-03   +1.045744327908083e-02   +8.657101345026431e-03   +4.958424586759629e-03   +1.712461552340244e-02   +4.231494065849998e-03   +1.944465476744639e-02   +1.565020632156806e-02   +2.390696399085132e-02   +1.110248226289316e-02   +4.275352583480477e-03   +7.537707881534668e-03; +4.970223111825751e-03   -3.017448012237992e-04   +2.612347260158613e-03   +1.383296072122446e-03   +9.417438553038854e-03   +5.784114243843208e-03   +1.439725888330199e-02   +1.052138903803992e-02   +3.691041519733044e-03   +9.791868198250783e-03   +9.429525824640062e-03   +2.284353863367992e-02   +5.762767304851953e-03   +1.165134786117758e-02   +4.639100942654488e-03   +1.439066311833393e-02; +7.872097391505939e-03   +4.266598496547591e-03   +3.125890395664055e-03   -5.561349782228172e-03   +6.686713995657719e-03   +1.221566723819151e-02   +1.802963538959717e-02   +2.174252619626821e-02   +9.706028740155997e-03   +4.584398903911651e-03   +1.500551535062063e-02   +2.143557575661835e-03   +1.939502680171733e-02   +1.869152357827993e-02   +6.189772697936311e-03   +5.111790378284325e-03; -1.778165510698982e-03   +5.942070680357989e-03   -4.326346381611235e-03   +1.426645509672807e-02   +2.727415576354048e-03   +1.419431893515855e-02   +4.459762736377365e-03   +5.313727630835997e-03   +2.084924696560870e-02   +1.318382291398137e-02   +2.928111447526335e-03   +1.637278659932672e-02   +1.747836435119420e-02   +1.038615631656258e-02   +1.437231892760825e-02   +4.296223846308317e-03; +1.815692792577826e-02   -1.670356073272827e-03   +7.174323883335817e-03   +4.148645598476966e-03   +1.302545477113003e-02   +7.203498548726421e-03   +1.062590318298055e-02   +1.785860121192835e-02   +6.967987648850997e-03   +8.096506681624510e-03   +1.687186949338472e-02   +1.283501815764792e-02   +4.885593633233660e-03   +1.965444970663363e-02   +1.607990897051734e-02   +5.982287779485937e-03; +1.242575231510982e-02   +1.414728454953940e-02   +7.587906842286701e-03   +1.534965265179263e-02   +1.749672703978865e-02   +9.070837495418786e-03   +8.301232045779471e-03   -2.734373703500826e-04   +1.161565157938843e-02   +7.715824245031668e-03   +1.803319579748029e-03   +1.708498237259814e-02   +1.184612413447598e-02   +1.625375308916905e-02   +8.691001154802008e-03   +7.388679468900458e-03; +1.980705200942757e-02   -3.156605558769171e-03   +1.252130549405787e-02   -1.150661746066392e-03   +6.933910871667511e-03   +1.200620855645732e-02   +6.063908406095431e-03   +4.242590201872862e-03   +1.628272508765909e-02   +1.301687589143261e-02   +5.126998261271823e-03   +1.125408295982156e-02   +2.131205423840949e-02   +1.160049498717494e-02   +4.421195593309579e-03   +5.103890332786597e-03; +3.421035591578372e-03   +6.200450442401552e-04   +1.788893995718577e-03   -2.744177475768895e-03   +1.756008443612540e-03   +1.134682361525110e-02   +2.292000996487900e-02   +1.302109900253648e-02   -1.482523742062621e-04   +6.642273384938427e-03   +8.639155339692181e-03   +1.310671933739404e-02   +6.445495829574995e-03   +1.990236765510829e-02   +1.667396717083887e-02   +1.280968830715841e-02; +1.736739690453281e-02   +3.108868257943986e-03   +7.359654028483535e-03   +1.514546360623441e-02   +1.020905007742007e-02   +5.609838980659002e-03   +3.668562743964702e-03   +4.311505101891410e-03   +3.545407983745431e-03   +1.126472042391660e-02   +3.683462431513723e-03   +9.221004717112661e-03   +5.928012515410627e-03   -2.587553709267757e-04   +4.256736980413227e-03   +7.589726225481450e-03; +1.040736607549767e-02   +3.899536767673917e-03   +6.983751558838906e-03   +1.518293558449991e-02   +1.730314996508158e-02   +8.550491306210529e-03   +5.338402669894288e-03   +2.040802504746082e-02   +1.228262161445292e-02   -1.254147926097244e-03   -2.298294326929236e-03   +6.729609402550149e-03   +1.681033740652905e-02   +1.680868058586131e-02   +6.307171487615876e-03   +1.155491229475416e-02];
L2I_L1I_iGABA_netcon = [+1.707234726286547e-02   +5.528120971814671e-03   +5.566753778286943e-03   +1.886564905001846e-02   +1.681788177047491e-02   +1.307519811029830e-02   +4.356769041439691e-03   +1.955057769411643e-02; +1.381229623273327e-02   +1.551895077336106e-02   +8.508270893203619e-03   +9.373161923180277e-03   +8.495585818222469e-03   +1.051242995649716e-02   +1.453213525727635e-02   -2.593584893349442e-04; -2.363571163865009e-04   +9.284878168592119e-03   +6.081022942357691e-04   +8.564531890384322e-03   +2.003436437423275e-02   +1.847537297280810e-02   +7.466301266291275e-03   +1.311549264601750e-02; +4.539772644391633e-05   +1.270137962701064e-02   +1.222532059826265e-02   +1.047497837155719e-02   +1.451936451753993e-02   +9.528894936079767e-03   +5.431068966266622e-03   +1.534774822873951e-02; +1.182147525292948e-02   +4.768932607350666e-03   +1.684465026335353e-02   +7.894257969146903e-03   +1.032499702491614e-02   +2.025290250208754e-02   +9.111097914728927e-03   +1.801782284635677e-02; +1.409333264291580e-02   +7.685883402052189e-03   +1.202089955646127e-02   +1.406786537190986e-02   +1.028146519045130e-02   +1.264555450187172e-02   -3.501399021361319e-03   +1.016751168296567e-02; -9.883654915861647e-04   +8.118520150058973e-03   +9.657265579990094e-03   +9.687613135743055e-03   +1.744990518873895e-02   +1.151381117987366e-03   +8.617389376182600e-03   +2.031838061789579e-02; +1.045302814389451e-02   +6.981839728607661e-03   +1.717166501152506e-02   +8.304544577635990e-03   +6.851318294804596e-03   +1.605627948698635e-02   +1.326185778297572e-02   -2.390575865234002e-04; +8.063838919122154e-03   +8.963722852591505e-03   +6.103573437856000e-03   +8.147252914552676e-03   +7.518428316451721e-03   +2.022958777154195e-03   +8.343419569233618e-03   +1.436760907452270e-02; +6.243533324325516e-03   +6.629886681289760e-03   -6.728416937730999e-03   +6.349681132501438e-03   +5.562426034171605e-03   +6.443343818523404e-03   +2.044675297736471e-02   +4.882800447951448e-03; +6.331463135345887e-03   +1.771973047582731e-02   +1.321600607831595e-02   +2.782934319627257e-03   +1.534102074058638e-02   +1.551876623465231e-02   +2.199806098434516e-03   +8.680748342376416e-03; +1.316643106170698e-02   +6.469848650234666e-03   +8.135754693135065e-03   +2.196051284643210e-03   +1.874047617346429e-02   +2.833152396196246e-03   +1.235862250778164e-02   +2.783917837968970e-03; +6.199507747472713e-04   +1.896834201169140e-02   +1.171262840907643e-02   -3.272647833877160e-03   +8.893627409067533e-03   +4.969518179247170e-03   +1.317007542376405e-02   +1.236925911186893e-02; +1.633621000187819e-02   +1.901615862655426e-03   +1.424100709601318e-02   +5.705747251833673e-03   +1.441089779078634e-02   +3.415763051306173e-03   +1.889768121506368e-02   +4.426930286751346e-03; +1.354952261039187e-02   +3.799261319807261e-03   +1.902473831618513e-03   +2.231394514544423e-02   +1.646273118029887e-02   +5.264750958448095e-03   +1.066964842464080e-02   +9.838203913069160e-03; +9.499957950521133e-04   +1.493994422554486e-02   +1.009573963939816e-02   +1.346339060304899e-02   +2.084409964951570e-02   -6.567386920492677e-03   +1.823997545488351e-02   +9.443069114598850e-03];
L1I_L2I_iGABA_netcon = [+1.491829737475302e-02   +1.687195678566733e-02   +2.876057607045235e-04   +5.197085355263831e-03   +9.430993478659796e-03   +9.777366498207008e-03   +1.839952070124917e-02   +1.578257067540405e-02   +1.004769206855090e-02   +1.806274664232429e-02   -3.140499631438787e-03   +4.766217568776853e-03   +4.048992492019766e-03   -3.634375222232441e-04   +6.868458581728517e-03   +1.857165810082755e-02; +1.844196040201444e-02   +1.205475482111183e-02   +3.392127257464181e-03   +9.091754927388992e-03   +1.025280614182110e-02   +1.213523634043837e-02   +9.359338724160553e-03   +1.542894563852729e-02   +1.016035268224433e-02   +2.233348995016204e-02   +9.031341801428722e-03   +6.631585171122719e-03   +5.611979762415938e-03   +5.160922682346773e-03   +2.760745573037764e-03   +1.731195341416162e-02; +1.216004399260931e-02   +9.017218136592325e-03   +2.137584681889686e-03   +1.359020004853444e-02   +7.534572762102612e-03   +1.425260626329001e-02   +1.051634731116287e-02   +1.345004158744719e-02   +4.956206630154394e-03   +1.012796644214077e-02   +9.403104366757351e-03   +5.381853994172498e-03   +6.770715372138603e-03   +2.736527457464539e-03   +1.305865248416804e-02   +4.431010055035343e-03; +1.004160741403823e-02   +2.031594330387181e-03   +1.066257945488499e-02   +2.183502450399879e-02   -1.842081162438072e-03   -6.872891652922053e-04   +8.333536071260993e-03   +5.475545847807147e-03   +8.945234328424596e-03   +6.767818316349879e-03   +5.129622457603073e-03   +7.678629459123051e-03   +3.581060077651373e-03   -2.276079702770181e-03   +1.325599255996761e-02   +1.030103833552735e-02; +4.636263605476894e-03   +1.717085548851294e-02   +1.777017567577910e-02   +1.400528106776567e-02   +1.054423862580391e-02   +1.270561513221617e-02   +1.197031349280418e-02   +2.217163103553827e-02   +8.803583964881401e-03   +9.285109172380863e-04   +7.296185246854949e-03   +7.861845918179914e-04   +5.818643802329138e-03   +1.699220486219673e-02   +8.416368937242572e-03   +1.058734341999090e-02; +1.058839132335853e-02   +1.545954709247002e-02   +3.065168992913833e-03   +1.882665323523122e-02   +9.574862851080545e-03   +1.406103482118329e-02   +1.536041096669602e-02   +1.489177223314218e-02   +1.801747360881439e-02   +9.546267007058015e-03   +1.290110948790273e-02   +1.100589282832976e-02   +2.397460262933923e-03   +1.603197434049607e-02   +1.921365544927665e-02   +1.490724315275715e-02; +1.702879440204279e-02   +3.557059412275230e-03   +1.299156485951008e-02   +1.780959726709287e-02   +1.030408918334019e-02   +2.154730183276378e-02   +1.002987666986184e-02   +7.534670528182888e-03   -4.469787831074974e-03   +1.274206593471100e-02   +6.944541673638982e-03   +2.594818034110840e-03   +2.161226674993114e-02   +1.145354648042011e-02   +1.219694346335239e-02   +8.793716891200894e-03; +1.675976950832777e-02   +1.658787624597781e-03   +1.257072480949604e-02   +1.242702226738426e-02   +1.143243240595893e-03   +1.248327753969858e-02   +1.274690593303826e-02   +1.428828754225797e-02   +5.434724211270120e-03   +1.396369767980362e-02   +3.578273900595928e-03   +7.645161484758006e-03   +5.048416751409646e-03   +1.410207705509767e-03   +1.220443660628481e-02   +7.281702417401181e-03];
L2E_L1E_iAMPA_netcon = [+1.350382774488806e-02   +3.846846198420177e-03   -1.288019713489744e-03   +1.756909365754500e-02   -2.640388507970240e-03   +1.998185374762282e-03   +1.093440280075235e-02   +5.425644342512677e-03; +1.629686468794979e-02   +1.340950800336384e-02   +1.204879195644761e-02   +6.416183807265586e-03   +1.234120283514420e-02   +7.229963271709373e-03   +1.592515695448063e-02   +9.977905285401130e-03; -3.627971980528090e-03   -8.829706319569496e-04   +2.303519818921666e-03   +1.260857546111355e-02   +1.011283294723368e-02   +2.067374142096131e-02   +5.984868614892819e-03   +8.104178362927310e-03; +1.766007213040260e-03   +1.298812890259801e-02   +3.679277393596071e-03   +1.896071838893066e-02   +2.213016208764902e-02   +8.873891618239255e-03   +1.548235431220540e-02   +2.125573402216535e-02; +1.547157560183307e-03   +1.906073508232090e-02   +1.117827132936654e-03   -4.785726939287073e-03   +1.679809848824987e-02   +1.955542910808988e-02   +2.045478509439180e-02   +6.979864521819461e-03; +1.126520277890719e-02   +7.728482618187897e-03   +1.932905128843536e-02   +1.540542518041122e-02   +9.730724780534541e-03   -1.940795164372877e-03   +1.183022354704061e-02   +6.927708738864786e-03; +8.713340114546589e-05   +7.408748965969499e-03   +3.960710581690499e-03   +5.684322454481835e-03   +1.466311109528641e-02   +7.044388227986257e-03   +3.726659753243894e-03   +6.669210782808511e-03; +2.007739121149388e-03   -6.605531674281283e-03   +4.659013087492950e-03   +1.565265822399955e-02   +9.791398509148518e-03   +1.956762554732361e-02   +1.265425284777157e-02   +1.301421761575017e-02; +5.651167152569585e-03   +2.012330536769164e-02   +4.023569450313292e-03   +1.981003169478588e-03   +1.967717133846065e-03   +2.182237492309557e-02   +7.710644046865278e-03   +7.029259571259905e-03; +6.021152487787600e-03   +4.844850966253589e-03   +2.154661872055978e-02   +1.105342625715625e-02   +2.040301027004444e-02   +4.798941266273633e-03   +1.849760612719306e-03   +8.592297413277241e-03; +1.490356110138807e-02   +8.480851615323420e-03   -2.536785519317440e-05   +9.140867128397411e-03   +1.242414526219868e-02   +3.291186091707067e-03   +1.423333354630481e-02   +1.777930503558671e-02; +3.744091683540786e-03   +9.738758526365470e-03   +1.267796172469148e-02   +1.357120015698474e-02   +1.186339137345165e-02   +9.252190382741558e-04   +1.763708393051976e-02   +2.647854234206912e-03; +9.875305031663586e-03   +1.034639260638591e-02   +7.506227509320462e-04   +1.124317288850363e-03   +1.799010207581491e-02   +4.397544160155917e-03   +1.506356635135579e-02   +1.096297255530444e-02; +5.672548590990263e-03   +2.400495611606251e-03   +4.034881631554778e-03   +1.564479324339585e-02   +2.526881253726998e-03   +6.158851279543589e-03   +3.843068419576203e-03   +1.836909155524413e-02; +8.950107190350991e-03   +6.355334521213496e-03   +2.361041112706641e-03   +2.038017506756451e-02   +4.441970146031860e-03   +2.364647695835543e-03   +1.071346322984292e-02   -7.574658463428432e-04; +1.021742919762967e-02   +1.127911884020348e-02   +2.887756003194708e-03   +9.171564814991985e-03   -9.186229229980708e-04   +1.207615659886806e-02   +4.983571044539423e-03   +1.608368836205134e-02];
L1E_L2E_iAMPA_netcon = [-2.787143182321681e-03   +1.860147170189713e-03   +1.817690302303045e-02   +1.510625719447570e-02   +1.096388742998611e-02   +1.655908464192391e-02   +7.966715078212103e-03   +1.452641297647216e-02   +7.966629779697417e-03   +6.546887586282401e-03   +9.446753102575272e-03   +7.085408530397595e-03   +9.076503141703314e-03   +1.591408239731678e-02   +1.258845885515817e-02   +1.381976668498717e-02; +3.077585149585040e-03   +1.441423440325483e-02   +6.883325684308350e-05   +2.190997824837881e-03   +4.392950422165420e-03   +1.657108710948048e-02   -1.225202702119131e-04   +2.844057383103596e-03   -2.001289972110333e-03   +5.217447784007200e-03   +5.722561230766841e-03   +1.295084704277214e-02   +3.337208183492070e-03   +2.661097398458859e-03   +1.020609817973910e-02   +5.509792472745670e-03; +3.303452938028105e-03   +1.511271116262800e-02   +1.796271836754944e-02   +2.123113338503096e-02   +1.959198991714756e-02   +4.964709029598764e-03   +8.345578804724373e-03   -2.508670259326746e-03   +6.501523266490966e-03   +1.255787134666262e-02   +6.203858423636176e-03   +4.051370526374869e-03   +1.049235217217783e-02   +9.643075290476069e-03   +1.789747916856861e-02   -3.737755620346122e-03; +1.239105549138953e-02   -4.830858707570203e-03   +2.758337975346770e-03   +4.847984583110783e-03   +1.645514955940500e-02   +7.686088631883446e-03   +1.739670126155439e-02   +1.394255918596764e-02   +1.494165432829152e-02   +1.594556578001153e-02   +2.628962382984073e-03   +1.036371943388894e-02   +1.853789578220991e-02   +5.701778040890938e-04   +2.008463585433839e-02   +2.015031344947124e-02; +3.423482303266305e-03   +1.704828648516547e-02   +1.066092550825893e-02   -1.458104627422944e-03   +2.527853030211771e-03   +1.338983942836999e-02   +1.557501375989599e-02   +2.032641188825691e-03   +9.689925996192041e-03   +6.293680319156347e-03   +7.005897956333875e-03   +1.734695401990145e-02   +4.264186653242468e-03   +9.620206608993386e-03   +2.036701826579405e-02   -9.462671181707303e-04; +4.877957992036472e-03   +1.650178218241628e-02   -1.261760892632745e-03   +1.835070015429517e-02   +1.625757405405870e-02   +2.044564020775879e-02   +1.039613327068848e-02   +9.446850622157081e-03   +8.971184534033094e-03   +1.017239556821438e-02   +1.158556602982964e-02   +1.880387935624125e-02   +1.461070272035283e-02   +9.133757469600982e-03   +2.174116687141125e-03   +1.777646159699156e-02; +2.729843395291073e-03   +2.841303951221989e-03   +1.473545494643829e-02   +4.449174371383667e-03   +9.479895502243823e-03   +1.006744892922552e-02   +9.165829202797513e-03   +1.370828933988207e-02   +8.398641222469430e-03   +1.356663602511745e-02   +6.751483864947339e-03   -4.326016069625545e-03   +7.932057191603071e-03   +9.140622291939378e-03   +2.910984687340537e-03   +5.371834025655848e-03; +5.796245050655147e-04   +9.236156614299433e-03   +8.023879959996641e-03   +6.005043080234036e-03   +8.851451556957397e-03   +2.176256628545380e-02   +1.281861300389703e-02   +1.414421027506342e-02   +1.666230471330079e-02   +7.156066318692634e-03   +5.136751223199535e-03   +1.904861837429547e-02   +1.679976236101617e-02   +1.257371496646997e-02   +7.651440515896394e-03   -1.772888837818199e-03];
L2I_L2E_iAMPA_netcon = [+1.225748213373890e-02   +7.481360685731640e-03   +1.330004069106377e-02   +1.027865445251567e-02   +1.810900941967818e-02   +7.812857946386859e-03   +4.327073024712295e-03   +1.535750197259750e-02; -1.700989899068497e-03   -2.047530725783709e-03   +7.778736697277234e-03   +1.522970919796250e-02   +1.700207253362140e-02   +5.010652239471804e-03   +1.243947270802283e-02   +1.385974653011596e-02; +1.655676501154429e-02   +1.584961050743689e-02   +1.217769660786122e-02   +1.499988562689079e-02   +1.080505303237290e-02   +1.121361849894642e-02   +1.093278361648399e-02   +9.657364581194147e-03; +3.101681007842500e-03   +3.760120481439793e-03   +1.923840811092603e-02   +7.176918876516646e-03   +1.833730319405218e-02   +2.901352162398020e-03   +4.473982386655828e-04   +1.896917168125009e-02; +6.046903101952154e-03   +1.241612282167626e-02   +6.639401152604866e-03   +5.806922693675961e-03   +1.200561915446414e-02   +1.190646602923361e-02   +5.088801138477953e-03   +1.259238332948251e-02; +1.250244774593927e-02   +3.264005252862009e-03   +1.478824599081830e-02   +1.182891585173964e-02   +9.930987278149306e-03   +5.483301715193394e-03   -3.256301370732660e-04   +1.776802360669473e-02; +1.751153737584448e-02   +4.556043926660069e-03   -3.044406445921006e-03   +1.013586594524947e-03   +1.061792694411386e-03   +7.881997723877692e-03   +1.728372444041543e-03   +4.813570069701414e-03; +1.321451384902151e-02   -2.786695157275469e-04   +3.693167446228851e-03   +8.212042362142255e-03   +1.585165402548292e-02   +4.684231929405969e-03   +3.555930421544144e-03   +3.986022962802469e-03];
L2E_L2I_iGABA_netcon = [+1.644711579946492e-02   +2.239790873237595e-03   +2.608073250441280e-03   +5.018066911650626e-03   +1.718094384393544e-02   +8.039957002909170e-03   +6.902648931211538e-03   +1.506321797286109e-02; +3.956559634388660e-03   +9.785569436361809e-03   +7.957824604922736e-03   +7.226687768046274e-04   +2.274932686098733e-02   +1.383585767096305e-02   +1.437291634286277e-02   -8.854315108689300e-04; +6.128261863016476e-03   +1.808280147942997e-03   +6.996654510392868e-03   +4.293655487422357e-03   +5.245105122519999e-03   -9.203961005136985e-03   +1.894786718080812e-02   +1.547806790740928e-02; +1.365337654421939e-02   +3.402223615591364e-03   -8.847593178719919e-04   +1.509984158677313e-02   +1.230855392769500e-02   +1.405530538305512e-02   +1.002409749801200e-02   +8.409039429839706e-03; -6.684392800677741e-04   +9.030332048324496e-03   +6.876016525364657e-03   +1.426848557516892e-02   +1.043494108307729e-02   +4.941434615128810e-03   +3.043722553717438e-03   +4.007132856714561e-03; +1.404834376237316e-02   -4.050139235071176e-03   +1.032788408504264e-02   +1.613400723316305e-02   +1.556117587906161e-02   +5.373620371774981e-03   +2.339388567188209e-02   +1.258186618898564e-02; +2.336531276705456e-03   +2.155261837985648e-02   +3.618666577301010e-03   -7.048392414020262e-03   +1.301570416707763e-02   +3.814819948747844e-03   +8.251797776006892e-03   +6.865656473196207e-03; +1.645008785523109e-02   +4.613886046447509e-03   +8.617420284175928e-03   +2.444975748121560e-03   +5.805561652735112e-03   +1.614418131425323e-02   +1.594191339696191e-02   +1.962891817064968e-02];
L3E_L2E_iAMPA_netcon = [+7.868114845032690e-03   +1.526915690430115e-02   +5.827080155132123e-03   +1.418627422240441e-03   -7.661091969006230e-03   +1.841243918499129e-02   +8.945235672652393e-03   +1.848246421680943e-02   +3.272331274856640e-03   +4.776765712432402e-03   +7.393439154637772e-03   +4.257635029788218e-04; +1.000883020544241e-02   +2.003604441746825e-02   +3.926974817733166e-03   +8.935183299778703e-03   +7.609769300429954e-03   +7.633336498134767e-03   +1.334950373606705e-02   +2.112108567583248e-02   +1.312860618191136e-02   +1.981262655373651e-02   +1.445471517040489e-02   +3.799868254850743e-03; +2.649327181244304e-03   +1.272690021236125e-02   +1.375611774752440e-03   +1.468826219803077e-02   -3.483461831387941e-03   -2.426203092637295e-03   +1.280369359428523e-02   +2.421983001805624e-02   +8.916508666021445e-03   +9.450721095308198e-03   +8.406072665248440e-03   +1.254102760872926e-02; +2.809845683470181e-04   +2.492154934889058e-03   +1.088119728565320e-02   +1.289833729741955e-02   +4.890943163386952e-03   +1.515878458520050e-03   +8.516985743199951e-03   +2.151743107960175e-03   +5.781779258728957e-03   +1.106850638724887e-02   +7.219320054258720e-03   +9.033236045169377e-03; +1.561443347825697e-02   +1.558374797946680e-03   +5.640683657261995e-03   +2.217858044328148e-02   +1.253295497310255e-02   +4.242975729235975e-03   +1.877549074608119e-02   +1.637310644704949e-03   +1.099062462604442e-02   +1.700533058539386e-02   +1.433894570618056e-02   +7.007691307460589e-03; +1.741153714402733e-02   +8.459225014606490e-03   +5.697858629991636e-03   +4.661134953070771e-03   +7.564036618449567e-03   +2.062818777811548e-02   +1.965145252604401e-02   +7.367594525784458e-03   +5.573302221876277e-03   +2.456051190251969e-04   +1.753434928054058e-02   +4.764871753044650e-03; +1.138549412857381e-02   +6.836655346091551e-03   +1.339348368721655e-02   +7.551494891400787e-03   -1.225171032968396e-03   +5.925185771812367e-03   +4.554880870384376e-03   +1.084234686256268e-02   +6.502459639248259e-03   +2.033888230660669e-03   -1.150360755732144e-03   +7.462542752183882e-03; +1.816020055256098e-02   +2.275211143626280e-03   -2.024269532335185e-04   +9.568049556445021e-03   +4.614100141753062e-03   +3.098587023746836e-03   +1.971599995260831e-03   +2.276919741393779e-03   +3.389764981561389e-04   +2.171900987922492e-02   +3.782182530769559e-03   +1.004268356257569e-02];
L3I_L2I_iGABA_netcon = [+1.446243765406957e-02   +1.020403967711850e-02   +1.557453578305898e-02   +1.368146088778582e-02   +1.562737263768262e-02   +1.166560722917504e-02   +4.991433972231629e-03   -2.867112615862847e-03   +1.947222080428689e-02   +1.296825602560670e-02   +1.145399737739704e-03   +1.782293797515036e-02; +1.349356279610592e-02   +2.022619165608089e-02   +1.972687060732541e-02   +2.113832191214553e-03   +6.996623502081199e-03   +1.173725636933701e-02   -1.964972540520150e-03   +7.541535437253535e-04   +1.347633286591596e-02   +6.547533176772370e-03   -5.062317092056345e-03   +8.529134275460648e-03; -1.941175651525354e-03   +1.102181334323792e-02   +1.769469054034968e-02   -1.529496089540165e-03   +1.575837445555986e-02   -2.284259795810211e-03   +9.604695131570334e-03   +1.520648658781769e-02   +1.235750666638239e-02   -1.970551416973967e-03   +9.011429887831102e-03   +2.872017291045301e-03; +1.951250544001448e-02   +8.412224016949232e-04   -4.215911991138433e-03   +1.329987558914397e-02   +1.695258043952574e-02   +1.380921361949947e-02   -3.229046875742823e-03   +5.570674615193890e-03   +1.406779639874795e-02   +7.365254032450183e-03   +1.395267148408463e-02   +1.232090772973266e-02; +8.170929936441654e-03   +2.354123081870952e-02   -2.870668832873494e-03   +4.296356040221183e-03   +9.695166560419768e-03   +1.668017167723465e-02   +8.184293868944820e-04   -2.352019768042773e-03   +1.523692838446114e-02   +1.634229392080170e-02   -4.325726610591153e-03   +4.997160281879727e-03; +2.278988069310508e-03   +1.565533289090325e-02   +5.848880029699744e-03   +1.566263796046949e-03   +3.194149196581699e-03   +6.008159496714720e-03   +1.276529931386463e-02   +3.682707433517402e-03   -2.823383747710080e-03   +1.211598975162014e-02   +1.075421993610035e-02   +5.151829172054936e-03; +1.439339824843160e-02   +1.139158659296588e-02   +1.087273471609658e-02   +1.630351326999058e-02   +7.770604818688462e-03   +6.709456880928720e-03   +7.431651830668484e-03   +4.821673300542562e-03   +1.064085984347831e-02   +7.260330509391132e-03   +8.595186694244663e-03   +7.036006107515502e-03; +6.973040864779463e-03   +9.396456704169336e-04   +8.029637401612919e-03   +1.104927756640820e-02   +6.122799708270669e-03   +3.425254937273455e-03   -2.696620393466101e-03   +5.365828392348674e-03   +1.247490947421594e-02   +1.264223305558213e-02   +6.642444861818123e-04   +1.099599699827376e-02];
L2E_L3E_iAMPA_netcon = [+1.431085269503994e-02   +1.043894645770968e-02   +1.053747577711192e-02   +1.059197173061877e-02   +2.751027286539327e-05   +8.066847664433944e-03   +1.731894900109398e-02   +2.211925784509938e-02; +1.035099440347504e-02   +1.586830843181259e-02   +1.508623004987224e-02   +1.029264772526099e-02   +5.826866178476815e-03   +1.133735362158583e-02   +1.914957032963991e-02   +9.430711772090641e-03; +1.296129362945745e-02   +1.583998683303560e-02   +2.239733278693378e-02   +1.655515138781691e-02   +9.973150037179166e-03   +1.334513958900660e-02   +1.047713398477586e-02   +1.530012512246046e-02; +5.785387916633465e-03   +1.460527054925902e-02   +1.323230227710040e-02   +4.301450980911061e-03   +1.031444261816254e-02   +6.446080000439593e-03   +1.767494970080595e-03   +5.603810900232728e-03; +4.045144602753591e-03   +9.069047221684608e-03   +2.143827210618544e-03   -3.381835872223995e-04   +2.488855344431743e-03   +8.443650573192508e-03   +1.155813356121047e-02   +1.459390511670420e-02; +1.301054948463853e-02   +1.751123704247928e-02   +1.550331160420568e-02   +7.698547360788567e-03   +1.477693972821725e-02   +2.404233036206962e-02   +8.742201754851964e-03   +1.308877035482750e-02; +5.525621985138037e-03   +8.039807833758550e-04   +1.070689801180219e-02   +1.903612325504080e-04   +8.323992502873538e-03   +1.930968559287921e-02   +8.441540726534263e-04   +1.289609873902899e-02; +2.286051997031447e-02   +1.770925978774509e-02   +1.397452548718537e-02   +1.910887440551842e-02   +6.308850000316484e-03   +1.857901316615831e-02   +1.328867788954811e-02   +6.896410542740759e-03; +6.806207697160586e-03   +6.578983006727406e-03   +1.803144241337552e-02   +1.384959717079133e-02   +1.166183919005691e-02   +7.870231482677330e-03   +1.647628212725895e-02   +1.331653518929608e-02; +1.524595196370929e-04   +7.538367468990744e-03   +1.021057734900732e-02   +1.534927835008190e-02   +1.973479045153078e-02   -1.332015408201120e-03   +1.932817494485741e-03   +1.189253120734468e-02; +1.359483867040160e-02   +4.196103855264461e-03   +1.393809710451996e-02   +1.457402424482136e-02   +2.035209385526933e-02   +1.898743871749600e-02   +3.303817772185307e-03   +4.868879234345763e-03; +2.329524592992779e-03   +9.627034730406329e-03   +7.865613612825770e-03   +1.495260742716266e-02   +1.006983385145241e-02   +4.852193375829300e-03   +1.494879599000507e-02   +1.838643493038767e-02];
L2I_L3I_iGABA_netcon = [+2.078263991882694e-02   +9.695757703150456e-03   +8.726751836085401e-04   +5.325481813704355e-03   +1.503128705883771e-02   +2.065400259252927e-02   -4.925029582592973e-03   +6.140803452495416e-03; +8.682379783462958e-03   +1.088113418108280e-02   +1.817925866069078e-02   +1.963789053821130e-03   +1.546307715252593e-02   +1.238837450908274e-02   +1.219982866026171e-02   +1.097279720499625e-02; +1.220598045430936e-02   +1.246592757633891e-02   +1.008884953885784e-02   +1.233989676832466e-02   +4.345098387697841e-03   +9.006617947632358e-03   +6.244192468888906e-03   -9.953698340339342e-04; +1.245317426022374e-03   +1.515830338269222e-02   -9.838809897528234e-04   +4.644940159742443e-03   +4.731187787066645e-03   +5.324218870953247e-03   +4.719102577677244e-03   +1.805489147143604e-02; +8.937198893213337e-03   +7.581842271834939e-03   +7.667930215538124e-03   +5.094734641698532e-03   +7.351132971024095e-03   +7.095857980781845e-03   +1.170896026985877e-03   +7.949301037731518e-03; -1.453868231934279e-03   -3.179209486688121e-03   +1.213062979420298e-02   +5.257418151964560e-03   +6.776914319383519e-03   +9.111736732528720e-03   +1.313377024959260e-02   +1.799249113832730e-02; +4.271697330504889e-03   +1.083676870530124e-02   +1.499763042544967e-02   +1.144923230583873e-02   +7.853416573650823e-03   +3.104054438400328e-03   +7.861339328156535e-03   +8.994873287265160e-03; -7.396169020104718e-03   +2.284834996625059e-02   -5.038338480027901e-04   +9.223309950854993e-03   +5.102898268005600e-03   +1.465243556813249e-02   +1.447912202070053e-02   +6.505902317407934e-03; +1.430149735071283e-02   +1.256268729993935e-02   +1.821560638609076e-02   +4.158349251397616e-03   +6.731146955182761e-03   +1.646473581768927e-03   +5.000177420467235e-03   +1.111579381038763e-02; +1.421949225992034e-02   +1.301866150714691e-02   -2.575696326965519e-03   +1.026943062443468e-02   +2.925499479845769e-03   -3.251204745065121e-03   +5.437613597101450e-03   +6.985906496811156e-03; +1.506296858667454e-02   +1.972180918909806e-02   +5.198809503936422e-03   +9.877557500893856e-03   +3.410460726293425e-03   +5.153862344963047e-03   +1.183596378866500e-02   -6.948323779104376e-05; +1.326189944406905e-02   -4.173101815533538e-03   +2.720498958267907e-04   +3.482812897157672e-03   +2.410195907216344e-03   +1.476296229161886e-02   +1.252123830282076e-02   +1.157504736243350e-02];
L3I_L3E_iAMPA_netcon = [+7.114419287323106e-03   +1.665923813794418e-02   +7.175668358456034e-03   +1.137319604627552e-02   +1.689386861167281e-02   +1.240754121128696e-02   +6.069320579935450e-03   -1.463276670629186e-03   +1.523837723871792e-02   +6.229992971265660e-03   +7.204864684614160e-03   +5.862825226132333e-03; +8.873293877883812e-03   +1.153553414223520e-02   +4.939703662098497e-03   +4.329235941474737e-03   -4.329476802664156e-03   +1.022683354769563e-02   +1.340794214820247e-02   +7.348597742565611e-03   +4.597541340894233e-03   +7.497386895981608e-03   +1.630771259760238e-02   +1.139146350138272e-02; +4.051597555886703e-03   +1.472180795808052e-02   +6.655876858135797e-03   +1.425878727723709e-02   +1.115959618980872e-02   +8.914995183062331e-03   +5.390821686263525e-03   +5.082688074678769e-03   +1.359603638733014e-02   +1.278050601098726e-02   +1.225451666793014e-02   +1.517722371441137e-02; +7.933260251164495e-03   +1.402283144477929e-02   +9.895838610233847e-03   +5.385401489408109e-03   +1.012682907076540e-02   +1.585269051407742e-02   +1.567809409024325e-02   +6.591243885010523e-03   +1.632623879482584e-02   +1.890427509505195e-02   +9.325335328929093e-03   +1.590710802973280e-02; +3.834605137079149e-03   +7.483446204325986e-03   +5.977905572864527e-03   +9.196043467177718e-03   +1.099168443207517e-02   +8.580192336038824e-03   +1.982885582584696e-02   -4.718258597945359e-04   +1.138452301773320e-02   +6.675888745216811e-03   +5.485578382459794e-03   +6.761539948489556e-03; -2.754756293922287e-04   +6.306304300615179e-03   +1.874549463658892e-02   +8.577311683196720e-03   +1.881568400989568e-02   +7.989038824148247e-03   +1.537567633074107e-02   +4.443820033243961e-03   +1.527128927684719e-02   -4.113084938498406e-04   -2.404305358087148e-03   +7.935310450446875e-03; +1.294182023183217e-02   +5.578552417992873e-03   +1.176635928652400e-02   +3.793491169283272e-03   +6.109255409734919e-03   +5.963403096653656e-03   +9.353808225175432e-03   +2.090790586600632e-02   +1.219148865672688e-02   +1.580115418840478e-02   +4.867771628416067e-03   +1.313248115225944e-02; +1.527224312730531e-02   +3.915865365947140e-03   +1.346760619661946e-02   +9.480533331524509e-03   +2.202338854714181e-02   +9.884831174039443e-03   -6.551911910388816e-04   +1.025400421945533e-02   +6.699961190535496e-03   +3.589313390578144e-03   +4.661610367769093e-03   +1.638061222094993e-02; +2.292859421404924e-03   +1.355163304235310e-02   +9.830655910785246e-03   +9.999474671993415e-03   +8.826190054731583e-03   +1.403018506713887e-02   -7.636356722064749e-04   +1.781408221693537e-02   +1.201534340113223e-02   +9.833592294272305e-03   +6.860243669758148e-03   +1.981668571533222e-03; +1.454483870294613e-02   +1.576401155877766e-02   +1.521574100405508e-02   +7.087756664955672e-03   +1.010709542336519e-02   +1.581694817948093e-02   +5.352317931266087e-03   +2.408411417029947e-02   +1.524213406894812e-02   +7.234516406293925e-03   +1.155512380650152e-02   +5.194229658084820e-03; +1.050510452472835e-02   +6.145815754137295e-03   +1.768988798712461e-02   +2.059285957443054e-02   -5.829497222518817e-03   +1.383719193846158e-02   -2.738996231624305e-03   +7.401117407627869e-03   +3.211248082793917e-03   +1.690333113926728e-02   +7.394182298861723e-03   +8.447089135491366e-03; -2.747448266691208e-03   +6.728203917484312e-03   +4.146440428060786e-06   +1.715007434806068e-02   +8.475582581859934e-03   +2.964971214112759e-03   +2.021074111136298e-02   -2.873670031811686e-04   +1.549658776210382e-03   +2.844601372757715e-03   +1.592706197506813e-02   +6.317938692246247e-03];
L3E_L3I_iGABA_netcon = [+5.449235973575041e-04   +1.038822716630547e-02   +3.796429996474018e-03   +2.136134540908975e-02   +9.576227752398284e-03   +1.422677264409409e-02   +7.710121049470491e-03   +7.540389669067667e-03   +6.293942530415868e-03   +1.394050197748745e-02   +8.263540267326560e-03   +3.300768701303740e-03; +1.203023309639418e-02   +1.286081734118904e-02   +5.723288877111047e-03   +4.577646955887821e-03   +3.226795167062353e-03   +1.551091566181733e-02   +1.272338654083959e-02   +1.703970933718603e-02   +1.456872984871762e-02   +9.123590291577274e-03   +1.243731067855843e-03   -2.080956405422839e-03; +4.226898944462650e-03   +1.643164194402329e-02   +1.321786629359767e-02   +9.939969333220404e-03   -1.646006297970754e-03   +1.644436030530278e-02   +1.160453591255797e-02   +1.631304087118650e-02   +4.504866899598134e-03   +9.863833895903179e-03   +5.663856000882614e-03   -2.918813506970481e-03; +3.654136895492307e-03   -2.344310697021550e-03   -2.403176799167650e-03   +1.642770381072899e-02   +1.354355557002099e-02   +3.852607952547128e-03   +5.849139849288987e-04   +9.390291166458724e-03   +1.292238604470824e-02   +3.129272735938006e-03   -3.061694007730424e-03   +1.146356756995756e-02; +4.117252109556651e-03   +8.815832444860158e-03   +1.898210292151341e-02   +4.979764215798246e-03   +5.441905840676811e-03   +1.389613301569219e-02   +2.178512304922746e-02   +2.018598856251986e-02   +2.004639008298968e-03   +1.289826107735565e-02   +2.040434113087015e-02   +3.848709790199792e-03; +1.512115711600833e-02   +6.797230806621369e-03   +1.644548500470435e-02   +4.579074122999851e-03   -1.801949370340751e-03   +2.121135688567069e-02   +1.025202472695029e-03   -2.850096931456622e-03   +1.207877167274651e-02   +1.048401075679582e-02   +6.747356624841854e-03   +2.361943717275575e-04; +8.489333466888712e-03   +1.003446305559481e-02   +5.880329435365209e-03   +1.530944034876422e-02   +9.287119493402274e-03   +6.018309285661621e-03   +9.017838748706616e-04   +1.662157218823988e-03   +1.167787763419680e-02   -1.030249986277936e-03   -1.339373768224427e-03   +1.288353828966498e-02; +4.463437945028331e-03   -1.004610553203033e-03   +8.694245259024342e-03   +1.487543207057569e-02   +8.907583599459047e-03   +1.181769148971542e-02   +7.122528506561271e-03   +1.557427682121704e-02   +1.504794431131515e-02   +1.529664571307388e-02   -2.246937660368784e-04   +1.569143012925074e-02; +7.882133869760156e-03   +5.297129345970604e-04   +1.998114648262082e-02   -6.960838168854500e-04   +1.753975841696705e-02   +1.380576075389329e-02   +6.516994667572261e-03   +2.101610769504503e-02   +3.332417086676010e-03   -9.801259619496758e-04   +5.694892833470799e-03   +9.642948012448471e-03; +1.827395451602703e-02   +6.688052482465496e-03   +1.615520991953520e-02   +8.430825240766467e-04   +3.204530704176982e-03   +2.297584996094618e-02   +1.170315183212249e-02   +6.949439105447161e-03   +1.875533443446122e-02   +1.589021079920816e-02   +8.693478636303228e-03   -1.388574439959340e-03; +7.675874160163954e-03   +3.274772037485046e-03   +5.563678242785328e-03   +5.210510663519264e-03   +1.275233875504908e-02   +1.202054734729398e-02   +2.064009554670726e-02   +1.423101544099067e-02   +1.273635659152750e-02   +4.489096305594833e-03   -2.774530635197976e-03   +1.105114011490662e-02; +7.017566084570508e-03   +5.192760887890165e-03   +1.398197938786990e-02   +9.745875488994259e-03   +1.028053685829522e-03   +4.894754322844209e-03   +1.645642417926569e-02   -4.407733911556602e-03   +2.104160325317923e-02   +1.069021927050877e-02   +9.009853690270049e-03   +8.115625639506054e-03];
L2E_Input1_iAMPA_netcon = [+1.592338774410068e-02   +1.842302623792805e-02   +1.023613850296500e-02   +2.195092719740835e-02   +2.093749214551668e-02   +2.464221388547884e-02   +1.924838094750521e-02   +1.068527765651171e-02];
L2I_Input2_iAMPA_netcon = [+1.191460020846736e-02   +2.049982545665348e-02   +2.155783986497540e-02   +1.281383406502887e-02   +1.289362793826168e-02   +1.806703356063469e-02   +1.567176543804746e-02   +2.006731081385903e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
