function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.635503537229402e-01   +1.482209690599194e-02   +3.431922165300710e-01   +1.365648510465724e-01   -1.969846133580789e-02   -3.670223315121533e-01   +3.198174408655308e-01   -2.234281191446087e-01   +1.189363321707208e-01   -1.527547038020483e-01   +3.337427691346757e-01   +2.762896239524984e-01   +4.527325552062070e-02   -1.598304837612027e-02   -1.399802512252146e-01   -1.115393711592319e-01; -2.699319815021840e-03   -1.836880577800015e-02   -2.180145036952236e-01   +1.519021961055025e-01   -1.734285302342836e-01   +7.141228091166105e-02   +7.274820172445748e-02   +3.918450244466867e-02   -3.876078605461070e-01   +1.986810433781713e-02   -2.975459793721061e-01   -5.474289314909900e-02   +5.301463983270271e-02   +2.230475895864080e-02   -1.343497133682516e-01   +1.913602660884222e-01; +1.412369827896345e-01   -8.975713701518237e-02   +5.495661856557437e-02   +4.384599277323269e-01   -7.341844741098727e-02   -1.141331600827590e-01   -2.332259496595493e-01   -3.937663847006022e-01   -3.620558299864476e-01   +1.617816105293511e-01   +5.000886487992081e-01   -1.214027861691965e-01   +3.109952982805351e-01   -3.605768886550814e-01   +4.436858627505020e-01   +5.261045368046743e-02; +4.924530176367173e-02   -2.826656632540434e-01   -4.089809454384682e-02   -9.577502844290246e-02   +7.823246475283342e-02   -1.794639457792608e-01   -7.064035363705318e-02   +1.807680290411082e-01   -3.160835788230767e-01   -1.779461094520041e-03   +2.961243420876549e-01   +2.578721134052367e-01   +5.021451694500793e-01   +3.227009745764557e-01   +4.070611707964467e-01   +2.417038323282681e-01; +6.077458234414149e-02   +4.821450348804340e-02   -2.357928965717079e-01   -5.879180123198499e-02   -7.443614333486415e-02   +9.641478434111292e-02   +1.710564779318010e-01   +2.518599826146669e-01   +4.077864375572636e-01   -1.148878977322650e-01   +1.827730331818220e-01   +8.943123657023992e-02   -3.776688587114109e-02   +1.816477255967292e-02   -6.550328481887821e-02   -3.038676761854133e-01; -3.376520121044977e-01   +2.419894369540977e-01   +1.193607535003490e-01   -2.372537233166463e-01   +1.575908938580064e-01   +2.267549070573451e-01   -9.174992026038375e-02   -2.919848868178281e-01   -4.580353552188934e-02   -3.383642797499823e-01   -3.505035613321366e-01   -2.169113543643316e-01   +2.753306213239498e-01   -1.758680602618528e-01   -1.336298080655109e-01   +1.588638496076638e-01; +1.642280993134571e-01   +3.943575163358830e-01   -3.384138563849593e-01   -8.218821771916671e-02   -2.842888648303077e-01   -4.027537179756877e-02   +1.019594158046753e-01   -5.062953012000508e-02   +5.448531029028868e-02   +2.721359942539781e-01   +1.783716439610030e-01   -3.038412389882757e-02   +2.180263376337448e-02   -2.389819144810778e-01   +2.063903595368652e-01   +3.389620976646202e-02; +1.309124238982609e-01   +1.656425074553988e-01   +4.040594307837722e-01   -7.629241047109256e-02   -1.216084567117061e-01   +6.576010415680093e-02   +1.621364867003033e-01   +8.108896624635852e-02   -1.163695521529936e-01   +1.566300485027660e-01   +4.496454251466284e-02   -2.756404044813520e-01   +1.098729350338131e-01   +3.275536911571444e-01   +1.282814484094393e-01   +1.526778504400057e-01; +5.646574140370025e-02   -2.369612064516577e-01   +5.172539545230579e-01   +5.752495387713869e-02   -9.698406692437195e-02   -3.604842725543253e-02   +3.055039379224557e-01   -3.014981747566655e-01   -2.558652644314910e-01   -8.359587434404153e-02   +1.255663948044200e-01   +4.751886539535011e-02   +3.940799788825152e-01   +4.769018991905852e-01   -1.056357783490963e-01   -2.035058440661472e-02; +1.724408667619320e-02   -1.278490560775858e-01   -1.318975323630058e-01   +3.189491074939331e-01   +3.611071702255041e-01   -2.177011445584913e-01   -3.898651643365067e-01   -2.453316143398618e-01   +7.692832135308997e-03   -1.490162142816339e-01   -2.054394173147617e-01   -1.764538766368512e-02   +2.388542079654752e-01   +3.757988093288342e-01   -1.101563022812013e-01   -4.223082967540787e-01; +4.275005135487976e-01   -5.819438294225511e-02   -1.178397608464821e-02   +2.776708270455913e-01   +8.179971489987187e-02   +4.154537115145152e-01   -1.560070435472686e-01   -2.017607321008547e-01   +2.314499433808910e-01   -3.249446844092375e-01   +1.009472585929933e-01   -2.040014231453403e-01   -3.428674221420407e-01   -2.066409606999571e-01   -2.887239267286075e-01   +1.403124334933629e-01; -2.681853585545400e-01   -3.566155579609785e-01   -9.579231822833881e-02   -1.797338884204031e-01   -1.542964174315893e-01   -8.263241603392141e-02   +1.367298872294027e-01   +2.177834751232849e-01   -1.291945350392499e-01   +1.213625548530067e-01   -8.003405313512715e-02   -5.029274512480809e-02   -2.792707840025045e-01   -8.784782115669201e-02   +5.557913667416850e-02   -7.459938913075320e-02; -8.027058499156581e-03   -1.090638293190130e-01   +8.698926685165459e-02   +1.004050391978045e-01   -6.330465678916655e-02   -1.256812415226238e-01   +1.109774822682313e-01   -3.274466856527025e-01   +1.061815790912138e-01   -2.303064577062616e-01   +1.533590554547664e-01   -2.493692577413253e-02   +3.110516509919282e-01   +2.278451673828675e-01   -1.693658965550396e-01   -1.883475219908891e-01; -1.459906769241179e-02   -2.122695885134972e-01   -5.648283154870058e-02   -1.146565809198741e-01   +2.454777582629883e-01   -1.867298126725271e-01   +2.790139993575713e-01   +2.451016293992587e-01   +1.117286842315590e-01   -3.250092295517616e-01   +3.008155945247212e-02   -3.293918150017519e-01   -1.003037376242546e-01   -8.658613014724398e-02   +3.245745573321606e-01   -1.725225867060946e-01; +1.006588025895895e-01   -2.682260520192910e-01   +2.312538380864465e-01   +3.792130718472447e-02   +2.885098765434413e-01   -2.755206053602426e-01   +3.641270415274022e-01   +1.357473180207177e-01   +1.398679993975172e-01   +9.424673129312527e-03   +7.140318469199071e-02   +4.701964289586978e-02   +3.240741135598408e-01   -4.782832794687673e-01   -5.442624736228006e-01   -4.959387499135893e-01; -3.683067225843711e-01   +1.410990526360954e-01   -1.489704854323207e-02   -2.810235982828087e-01   -3.322323023449790e-01   -2.731115190753736e-01   -3.041428570284638e-01   -2.484888591217906e-01   -7.378268343219058e-02   -1.136085917885811e-01   -4.257986601492997e-01   +8.045423743996041e-02   -1.550535693042475e-01   +2.921996026181428e-03   -9.124157112515674e-02   +2.699091816121465e-01];
L1E_L1I_iGABA_netcon = [-5.677386404177408e-02   +3.113419271477769e-02   +2.705694180959112e-02   +3.329290362850414e-01   +1.532928619458728e-01   -1.380574844892134e-01   -3.633790612429114e-01   -4.626908015003449e-02   +4.004130147710271e-02   -2.370370685088932e-01   -3.825310973279615e-01   -2.900810376016597e-02   -1.647620365642558e-01   -1.498946546926667e-01   -4.826629665733440e-03   -1.697173878261473e-01; +8.730051025343652e-02   +4.309816718692085e-02   +1.281233587606838e-01   +2.833665105315965e-01   +3.869512956157662e-01   -3.246155946107572e-01   -2.711655093331156e-01   -1.223236466485502e-01   -6.805779370447110e-02   +3.573282222796875e-02   -1.146897190977635e-01   +2.293964744401387e-01   +1.333731687457578e-01   +1.843034709699479e-01   -1.606067772920819e-01   -2.268786954074514e-02; -2.017871589717425e-01   +3.698059093216823e-01   -2.165350930609618e-01   +2.263803010995849e-01   -1.275680199560525e-01   +2.317668025630507e-01   -8.871254413132607e-03   +2.107321592182316e-01   -2.157021735508739e-01   -1.901955887457826e-02   +3.568999526820003e-01   -4.940702695685120e-01   +1.572697265770224e-01   -3.954919638415298e-02   +1.319408550231524e-01   +2.298877640923120e-01; -2.224174894658221e-02   -1.142387145047198e-01   -1.229352665098168e-01   -7.688614978752117e-03   -1.076834501329176e-01   +9.469418540608995e-02   -8.438049735157468e-02   +2.127187485752806e-01   -1.662332523603357e-01   -3.255891002864096e-01   +3.275524155101467e-01   -8.941096357306126e-02   -3.762607115479618e-01   -2.497932599964519e-01   -8.058770816901079e-02   -2.890803522022888e-02; -3.511355888535388e-01   -7.362716624499072e-02   -3.111488480203003e-01   -1.131787340111428e-01   -5.801183654800149e-02   +3.188389863985146e-02   +3.114236160307574e-01   +4.432478422355418e-01   +4.319820963182535e-01   +7.624039964433199e-02   -2.824742249516266e-01   -9.364831667546375e-02   +4.713190819800006e-01   +4.184639169455480e-01   +6.001659121297848e-02   +7.953295127264767e-02; +1.799250170159611e-01   +2.470996150777872e-01   +4.363230535492203e-01   +3.076750734080180e-01   -1.442259786955926e-01   -7.093496539648955e-03   +1.388329999217632e-01   -2.346227325245293e-02   -1.265489617359092e-01   -2.843272705826742e-01   -6.832206180732875e-02   -3.714193322391922e-01   -3.053476439581027e-02   -2.076615412809573e-01   +2.076831706504120e-01   +1.325980968768077e-01; +2.279593121732466e-01   +9.507795710155052e-02   -1.402867538130056e-01   +2.801352680694739e-01   -3.189893539838050e-01   +3.339434896901816e-01   -2.753384551711853e-01   +1.976205424027139e-02   -2.435129820095283e-01   +4.513650841242438e-02   -5.627423358347310e-02   -2.463395671034563e-02   -4.529980674160704e-02   -1.338431503702359e-02   -3.569689251047609e-01   +2.317348738868751e-01; +3.178650448928815e-01   -2.180554912987236e-02   -2.172570006371832e-01   -1.882072779212698e-01   -1.510707851211042e-01   -6.271533625667405e-02   +2.291784548153506e-01   +4.423344184313323e-02   -8.407799640876584e-02   -1.093092219182393e-01   -8.522956981869263e-02   +1.065044201343263e-01   -2.612394909731648e-01   +1.778945157316454e-01   +7.094368963711023e-02   +1.566539239816111e-01; -2.939125296521207e-01   -2.493418504965049e-01   +1.425314651326410e-01   +1.190814963740078e-01   +2.655725227189464e-01   -1.544434804316119e-01   +2.320403523744232e-01   +2.149279886992062e-01   -1.713161410887881e-01   -3.193230135819006e-01   -3.585285864835258e-01   +7.090271433136527e-02   +1.594245138219044e-01   +3.363811083563513e-01   +2.874266239153196e-01   +1.904262037896498e-01; -1.489343306364548e-01   -2.529365380641435e-01   -3.636537978424464e-01   +5.395124867000629e-01   -2.119790321422985e-01   +3.026546435334492e-01   -2.042377458067396e-01   -2.693725237428802e-02   -1.182061473899463e-01   -2.624981282067030e-01   -3.918032031548299e-01   -9.295953709215934e-02   -6.303047907699107e-02   +2.708759015963808e-01   -2.201314051881920e-01   -2.189316202771686e-01; -3.861303636254476e-01   -4.584935697488977e-01   +1.717353937667667e-01   -5.520804248791975e-02   -3.743882126783094e-02   -4.957554052165455e-01   -1.083179471225991e-01   -1.287932074221881e-01   +5.373366919200420e-02   -1.814401223422404e-01   -1.558845179325380e-01   -1.275688046794924e-01   -2.858838324332765e-01   +7.565646445012059e-03   -1.295676191519655e-01   -2.692403784042202e-02; -1.739239842747259e-01   +2.761691261300937e-01   -1.901789042125807e-01   -7.987683560807204e-02   +1.566764340568977e-01   -1.620811039233113e-01   -3.334816818338122e-01   -1.294582021373532e-01   +2.472402834855834e-01   +1.109082004184858e-01   -2.506942474659888e-01   -4.195370758376834e-01   -7.358088367575837e-02   -2.804071641502221e-01   +4.692496083487749e-02   +2.882514434188969e-01; -2.468938788544968e-01   +7.613933444030782e-02   +5.175016103858684e-02   +3.338459842054450e-01   -8.906638975150535e-02   +3.848888505439239e-01   -2.954026500758532e-01   -6.732362264939122e-02   -3.950756523058342e-01   -1.550145946045436e-01   +2.460588004366792e-01   +9.054069453011460e-03   -2.603131847007130e-01   -2.332951637865101e-01   -2.003650119886174e-01   -1.627460421524418e-02; -2.132508799831116e-01   -2.986809556349633e-01   -5.195208347486102e-03   +2.840727922992426e-01   -2.850738340247309e-01   -2.308348280205410e-01   -6.825249368287805e-03   -3.154225238779105e-01   +1.765004820542230e-01   -3.729188737890477e-01   -1.399235019390383e-01   +1.272769771969356e-03   +1.387141287889848e-02   +6.191573931316267e-02   -1.089665974519731e-01   +8.145846848483911e-02; -7.001713476772564e-02   -2.866653988490184e-01   +1.244534807501123e-01   +9.046443334947879e-02   +2.599333860176027e-01   +2.401583666170568e-01   +2.748436292618590e-01   -3.725817100177067e-01   +1.477399239142525e-01   +1.028978283890354e-01   -1.298068500286123e-01   +1.172755040978846e-01   +4.972557117195762e-01   -4.810113230265800e-01   -2.793260427779846e-02   -2.001302279811473e-01; +6.772594701059718e-02   +2.035424921752778e-01   +2.587751331875920e-01   -3.070516257096042e-01   +1.962549707739074e-01   -4.349199742503685e-01   +5.114846691866467e-02   -2.188237281980323e-01   -2.309731125825390e-01   -1.884895416880268e-01   -7.199682241359917e-02   -1.196939597180435e-01   +1.660778221855625e-01   -7.541659177424527e-02   -5.296306158872188e-02   -3.559904939280104e-01];
L2I_L1I_iGABA_netcon = [+3.801276498163345e-02   -3.053606049875083e-01   -2.878502171472077e-01   -3.158002846696088e-01   -3.707200520304658e-01   -1.953163288158028e-01   +2.544207516694651e-02   -2.768032004510967e-01; -1.073483895969152e-02   -1.139716758765173e-01   -1.064667635928275e-01   -4.433567857765847e-02   -2.540330179659279e-01   -1.777639400756257e-01   -5.038008396412384e-02   -4.667790726433020e-02; -2.354270684151713e-01   +6.897815491627905e-02   -1.751874028644743e-01   -2.890304121759582e-01   +3.253504349680456e-01   +1.329372655635202e-01   -1.063204758450083e-01   -1.902466878095036e-01; -3.461161653550703e-01   +2.186322041402130e-01   -5.051227526997322e-01   +5.262990222913876e-02   +1.112403648530327e-01   +4.683179056107685e-02   +5.566328564165510e-02   -8.239887226603848e-02; -2.196713863066026e-01   +1.464118385722031e-03   -2.629445322668429e-01   +2.439356922178963e-01   +7.894699977137956e-02   +4.169431992685894e-01   +7.072595162840289e-02   +4.352863892697770e-01; +8.805617279803511e-02   +3.969612258292619e-02   +2.894164118341475e-01   -1.197888055410789e-01   +2.649799347095152e-01   +1.561115525381095e-01   -1.068541262372236e-01   +5.511733054845860e-02; -1.703788433957386e-01   +1.958971286623944e-02   -2.657798925007791e-01   -3.364180681446907e-02   -3.746228094279383e-02   +1.794923385551689e-02   +2.041831829107338e-01   -7.441517679164535e-02; +1.898763493490602e-01   -1.939101090200384e-01   -1.711203408943362e-01   -1.971391800474634e-01   +3.521049511625705e-02   -4.572523788641031e-02   -8.500940020008152e-02   +1.591209932689431e-01; -3.616908693242531e-01   -7.320464976081176e-02   +1.239978260112266e-01   +2.033194929857920e-01   -2.022800950217929e-01   +8.419535256218558e-02   +4.835498230431343e-01   +3.880746209589165e-01; -2.868485747921480e-01   +1.745793963263872e-01   -5.776978572730486e-02   -2.065362813091686e-01   -1.109370570623210e-01   +4.209631912404937e-01   +2.814424573677634e-01   -6.899290346819317e-02; -3.198160875552708e-01   +2.681905248193697e-01   -1.486675447636557e-02   +5.751533948807344e-01   -1.987871070018260e-01   -2.623140059983348e-01   +2.723028147734418e-01   +3.110526593141965e-01; +1.790549224156052e-01   -4.328151392691115e-02   -1.607597777711358e-01   -1.885787520408109e-01   -2.081640176386755e-02   +3.067618574077743e-01   -1.319375803610395e-01   +1.786956531108322e-01; +6.224920522682367e-02   -1.129468895621903e-01   -1.004868625222524e-01   -1.483275655648587e-01   -1.203077544174487e-01   +4.076290678678340e-01   -7.647923971108171e-02   -1.358244916163715e-01; +2.604735428775914e-01   -1.260440416003453e-01   -9.057786106121513e-02   +1.178620487474635e-01   -2.392705017319301e-01   +2.696173291351994e-01   -2.626844683891689e-01   +4.306523055659397e-01; -2.575450191916577e-02   -2.555093032652482e-01   +2.421096889555750e-01   -1.382770440130296e-01   -1.101804565994312e-01   +2.917176412113610e-01   -4.225341497081743e-01   +6.530529298090661e-02; -2.075313186468759e-01   +5.129593160699916e-02   -1.021931948966721e-01   +8.978338094105948e-05   -2.254931123252804e-02   +6.215219088678291e-02   -4.211376103500551e-02   +3.100409830098656e-02];
L1I_L2I_iGABA_netcon = [-2.725951133508754e-01   -2.379764345274960e-01   +1.606707063495733e-01   -7.913281619303481e-02   -3.733402283770540e-01   -5.823296219371215e-02   -7.479550560529349e-02   +4.498214275999717e-01   +1.765918065372417e-01   +2.329792466237195e-01   +2.455959172509595e-01   +5.123245408410919e-01   -2.323236040458041e-01   +5.911941989060035e-02   -7.960324633688433e-02   -5.855468965340505e-02; -2.765980224886377e-01   +1.733094002781034e-01   -2.122520480201477e-01   -1.858704667307783e-01   -3.628655767078345e-01   -3.200830901158080e-01   +4.071135935165504e-03   +4.782271690827568e-01   -7.723721041399373e-02   +7.070419562843079e-02   -3.093504019687890e-01   -2.533652362302998e-01   +7.993564779286730e-02   +1.422476483286777e-01   -1.475800666118694e-01   +4.070939243978247e-01; -2.531415229822372e-01   +6.220651681860256e-03   +2.755027529898513e-02   -9.807171720757690e-02   +5.534059140893777e-01   +2.188085620837398e-01   -4.980835013523555e-02   +2.955401133941785e-03   -5.821310973521895e-02   +2.891886208095330e-02   -2.736160689929878e-01   +1.827996424078064e-02   -2.990426015007153e-03   +1.193863423364866e-01   -2.983467189247133e-01   +3.851122893678875e-02; +1.135839161475695e-01   -1.471331632700436e-01   -7.430373369253229e-02   +2.558079995127530e-02   -3.487064360084743e-01   -1.923994723810664e-01   -2.709725619577706e-01   +1.435709630447726e-01   +3.851107590788841e-01   -3.566689528402845e-01   -4.873447847260687e-02   +3.203774410179278e-01   -1.895471819638189e-01   +1.543744729523138e-01   +3.729723480690468e-01   -5.518761243730241e-01; +2.260455233298803e-01   +2.118387687034444e-02   +4.735926920010980e-02   -3.323172722915990e-03   +1.457205142870438e-01   +1.650055732510460e-01   +4.375497143045191e-02   -2.170085223960981e-01   -6.649713742730949e-02   -1.272993648401174e-01   -5.678945693481892e-02   +2.567950067724589e-03   -2.000777511744836e-02   +2.541613026796575e-01   -1.694639499335045e-01   -1.829984749006466e-01; -3.370009502843189e-01   -2.355340714590498e-01   -1.840006078626254e-01   +1.136728465252314e-02   -2.570018037805633e-01   +1.691787066411035e-01   +7.460779949188598e-02   +4.316277395794178e-01   -2.710152446669272e-01   -3.669698872746865e-02   +9.317806823385084e-02   -5.508819331300627e-02   -1.126666258066926e-01   +2.578369412506861e-01   +1.790980908788493e-02   -3.909861439224492e-01; -3.098872307015635e-01   -4.106836226928380e-02   -5.846829900493458e-02   -6.916565022214377e-02   +3.217558659686154e-01   +4.820463969515413e-01   -1.095597816400896e-01   +4.324640124854454e-01   -7.005586146120754e-02   -2.103802067037510e-01   -3.231782256031719e-01   +2.934625299401425e-01   -3.060798497962067e-02   -1.350489923619973e-01   +1.355570443055686e-01   +2.219945953759148e-01; +2.744669798605958e-01   -1.921271548690481e-01   +1.109095424504915e-01   +7.705514143719447e-02   -1.076877661832922e-02   +2.419988986587740e-03   +1.324727963742943e-01   -9.824523301731661e-02   +1.258601762020416e-02   +2.035505850586043e-01   +7.326873452223259e-02   -7.075709282364470e-02   -1.233156651059687e-01   -1.669064624867427e-01   +1.571181602555516e-02   -2.684630380642479e-01];
L2E_L1E_iAMPA_netcon = [-2.854120556790679e-01   +2.104425237538365e-01   -1.247470788734588e-01   +2.856869093307868e-01   +9.973678255478807e-02   -4.891192406162051e-01   +4.246754929608751e-02   +3.142183768001177e-01; -1.689850689599483e-01   -1.788798769357895e-01   -2.217286447708422e-01   +2.848356277328921e-01   -1.796035537958787e-02   -3.008209550525701e-01   +3.330028268638965e-01   +1.318943235067320e-01; +3.668075687189732e-01   -1.041599188087917e-01   -4.751579288910615e-01   -7.014724817314989e-02   -4.419367952067951e-02   -1.198948199464617e-02   +1.995267295329460e-01   +2.194253409074368e-01; -4.995660926468383e-02   +3.739350084532720e-01   +9.604993475026979e-02   +7.894131827548348e-02   -6.914124148295558e-02   +2.027868222386172e-01   +2.380791489375890e-01   +2.043547687568310e-01; +2.690753637905926e-01   +3.903779544995767e-03   -4.938534937131618e-02   -1.169518941424579e-01   -1.314556947268779e-01   -1.721305747889568e-01   +3.377092252295936e-01   -3.530753830812883e-02; +5.862677675326165e-02   -4.899387576173557e-01   +8.982472958274734e-02   -2.782121217104871e-01   -1.697713563934930e-02   +1.446973250715703e-01   -2.574894629155385e-01   +2.827856469253539e-01; +1.129338274241246e-02   -2.924948998822322e-01   +5.810525788383508e-02   -1.592210031263100e-01   -5.263125341300576e-02   -5.782994345933423e-02   -1.033655822668216e-01   +4.530250119004929e-01; +3.062535743071024e-01   +1.067900790983367e-01   +5.159119330208808e-02   -1.045754671299879e-01   +2.962753034328058e-01   -1.193332576256011e-01   +1.969685245278204e-01   +1.494864862918228e-01; -1.167668882358153e-01   -5.641534004210174e-01   -1.982258957021996e-01   +4.789406799462831e-02   +2.650218646250743e-01   +8.971128018336055e-02   +1.631282109179359e-01   -3.597540281000471e-01; +3.658317192116812e-01   -3.826317668469329e-01   -2.183491120606653e-01   +9.080624388574401e-02   +2.662539861986693e-01   -1.289362493154479e-01   +6.640329865211425e-02   -2.173722460890411e-01; +1.778650914190453e-01   -5.774808596554228e-02   -5.796474389764633e-02   +6.585960212966212e-02   +2.436759207224944e-01   -9.120543758661734e-02   +1.897852090358697e-01   +1.506351774956764e-01; +7.420327168479940e-02   -5.672145836627307e-02   -9.091026054921647e-02   -1.814622220763410e-01   -3.834193434223001e-01   +2.419680406334672e-01   -1.423041118294756e-01   -1.451198345145551e-01; +7.962296091508111e-02   -2.008864238052530e-02   +1.927480273468944e-01   -3.132003963755601e-01   -7.070811293272869e-02   +4.836500437956957e-02   -2.416574555191099e-01   +2.971582767982602e-01; -2.942778260004427e-01   +2.084858301426189e-01   -1.371727385910834e-01   -2.957416595608514e-01   +3.262405737295114e-01   -2.712973621856463e-01   +1.021724002447090e-01   -3.345894745982617e-01; -9.018320509581765e-02   +7.029152741899780e-02   +3.939370959887969e-02   +1.585092981883793e-01   +9.571728025554581e-03   -1.960914763297899e-01   -2.399219567598707e-02   -8.860756580238791e-02; -2.697189800435933e-01   +2.769943143535379e-01   -1.707016849576917e-01   -4.619284488695569e-02   -4.755776522425692e-02   +3.785959179374164e-01   +2.612623734422883e-01   -1.232910976367341e-01];
L1E_L2E_iAMPA_netcon = [-1.777236375436904e-02   +3.821152674636288e-01   -1.109983835254810e-01   +3.496610982757146e-02   +1.275394362727304e-01   +1.552399076715130e-01   -2.295643011542185e-01   -1.139988710337741e-01   -3.356117531112696e-02   +9.334361439593564e-02   +3.398819491065577e-01   -9.480898687130419e-02   -2.409351974310545e-01   -2.043117947489821e-01   +3.459270459510134e-01   -3.362090997056447e-01; -1.279918832985656e-01   +1.130379850386890e-01   -4.005990971017204e-01   +1.761625882057202e-01   +2.203680429005683e-01   +1.000074132668978e-01   -6.300016980613550e-02   +1.554589051480095e-01   +2.084786796443339e-01   -3.695726971007048e-01   +9.750226085113149e-02   -2.917924223283778e-02   -7.896892707528415e-02   -7.800878861233071e-02   -2.557989117943406e-01   -2.621791156015483e-01; -2.093516794851821e-01   +1.724472443976241e-02   +1.937023247796612e-02   +2.750977039262390e-01   +7.103184065629434e-02   +2.965712456645443e-01   -1.688984129881034e-01   -1.870263994977558e-02   -3.274411485956377e-01   -1.204185044840075e-02   +3.840369174502206e-01   -2.861781418210941e-01   -1.712626737240308e-01   +3.726002654815840e-01   -4.958533393280957e-02   -1.543757158003876e-01; +3.129810757744125e-01   -4.363387874644774e-02   -2.306273458113703e-01   +1.337572622712578e-01   -1.890059425397020e-02   +4.713680336931338e-02   +2.633459346580685e-01   -5.120779986045056e-01   -6.315490017356201e-02   -3.749542894260515e-01   -2.872375378507953e-01   +3.443670218595607e-01   +3.064748838801787e-01   +2.126559077085814e-01   -3.136790469613678e-01   +9.635119156236779e-02; +3.911469017684128e-01   -2.744566933826222e-01   +1.269094335436963e-02   +6.521121725908320e-02   +5.387872024666337e-03   +2.533187658129538e-02   -1.388963740527392e-01   +1.438882958945371e-01   -2.559885795016557e-01   -1.503709648769846e-01   +4.152362734119639e-01   +1.897661223045396e-02   +8.285276767855862e-02   -8.069916416388037e-02   +2.630131072875109e-01   -2.134549034892214e-01; +2.775412049855177e-01   +1.032844189918788e-01   -2.832241204201880e-02   +3.292224221204591e-01   +8.536430264816264e-02   +3.508091577917602e-01   +1.383404302642124e-03   -1.163747702539285e-01   -4.560134933420624e-01   -6.336672892182332e-02   -4.662438782824599e-01   +5.709790430332916e-02   +1.012489679932123e-02   -7.935899911566563e-02   +2.946939655101599e-01   +1.087898012689603e-02; -2.657813324752173e-01   +2.639580451500691e-01   +1.985320943427629e-01   -1.148825757590080e-01   -2.485073699872073e-01   +4.332096762019820e-01   -1.797566215391914e-01   -1.626531302326288e-01   -3.439854785422426e-02   -3.644400379276486e-01   +1.570058853416883e-01   +2.132077400686874e-01   +2.141860138659065e-01   +1.512983846442147e-01   -3.011590702802546e-01   +1.289420210958893e-01; -2.260010958455319e-01   -2.504536556807127e-01   -5.182796484512321e-02   -9.764601217531463e-02   +1.256288568287027e-01   -1.670268986330113e-01   +1.067148182031672e-02   -8.016176386735041e-02   -1.099220211927680e-01   +4.348021027136046e-02   +2.965991231552477e-01   +3.382648537238709e-01   +4.189343709830287e-02   -2.973000085810439e-01   +1.809141241969632e-01   +1.535340020116167e-01];
L2I_L2E_iAMPA_netcon = [+4.722200763258427e-01   -3.584779120752890e-01   +1.485839175661997e-01   -4.244221273912356e-01   +2.808889139160332e-01   -8.183526578291547e-02   -8.055696239589555e-02   -1.450533867919478e-01; -1.635952105163241e-01   -3.127050485102842e-02   -3.003145148677738e-01   +4.149905126269123e-01   -2.354313398783114e-01   -1.434441183784491e-01   -7.452446274742849e-02   -2.255950028067344e-01; -7.142356310703349e-02   -2.779188683133316e-02   -1.285908526635780e-01   +3.790212657373876e-03   -3.011798638134005e-01   +3.213672012694924e-01   +2.247934194175756e-01   -5.776911751737682e-02; +3.252490807662163e-01   -1.426968456049079e-01   +9.842222214666158e-03   +1.259872611086477e-01   -1.203066877781507e-01   +2.533632289886272e-01   -1.417966242039259e-01   -1.582465199123555e-01; -3.220177153166176e-01   +1.301927761977691e-01   +6.220806844617882e-02   -1.118938158389846e-01   +2.010898721098496e-01   +1.250320165007268e-01   +5.431849086712666e-01   +2.627503270480110e-01; -2.118336517000317e-02   -3.036248923367942e-01   -2.101433891219338e-01   +2.456986363690133e-01   +2.431414652665210e-01   -3.338312073055841e-01   -2.067759380491684e-01   -1.053135200052699e-01; -1.045097186152925e-01   -1.194192846838735e-02   +2.996820828582505e-01   -7.899916877885141e-02   -5.171245560249937e-02   +9.064028939717553e-02   -1.473412457851382e-02   -8.701051815130238e-02; -2.622178786562154e-01   -2.304583614937052e-01   +2.858466378088382e-01   +1.475310032504309e-02   +1.421231745151582e-01   +2.122091968670468e-02   -9.213683028821072e-02   -1.259291152631491e-01];
L2E_L2I_iGABA_netcon = [-2.028338078771064e-01   +3.906679626964508e-02   -1.806969111052165e-02   +2.322099517003730e-01   +8.437549616607076e-02   -1.027239478193926e-01   +1.856057285085984e-01   -1.892294295701049e-01; +1.728019693888408e-01   -3.718494266104455e-01   +3.173051489128154e-01   -3.731800415571133e-02   +3.716519464539338e-02   -2.213627892379460e-01   +1.224990604938839e-02   +4.815663495157760e-01; -4.408628399480987e-01   +4.126958029613951e-01   +1.029464672897179e-01   -2.954357682738704e-02   +1.856453676534493e-01   -3.660643491201696e-02   +5.332500107447311e-02   -2.191980346401807e-01; +4.588780283809681e-01   -1.414810228389758e-01   +8.560247049987052e-02   -2.984667827251281e-01   +1.023959787137143e-01   -2.278074596138983e-01   -8.966183519008367e-02   -2.063724516684612e-01; -7.857342282901220e-02   -3.490420308974193e-01   -3.073818078475502e-01   +2.068114266228300e-01   +2.739598029285106e-02   +1.527424046470894e-01   -1.958665307121045e-02   +2.258552087065773e-01; -8.885194042714087e-02   -2.988880272615863e-01   +9.471899921206103e-02   +6.624175657859131e-02   -2.649068213390904e-01   +6.333265762225102e-02   +7.605128689942836e-02   -6.720646770616409e-02; +8.293517116714440e-02   +1.732882212112178e-01   +3.827412243210926e-01   +1.565740724027001e-01   +1.922397294109858e-01   +1.963785151355123e-01   +3.053770888305618e-01   +2.636132339350000e-01; -1.510855202235878e-01   +2.810870171432729e-01   -3.522154777938688e-02   +1.718966735177460e-01   -2.621937240544080e-01   -4.937120128951092e-02   -1.800313637097120e-01   -1.490859524836256e-01];
L3E_L2E_iAMPA_netcon = [-1.402913155932443e-01   -9.391586437952311e-02   +2.948347523540670e-01   -2.210190306807934e-01   +2.907865495198320e-01   -3.795465482286264e-03   +1.382151152845901e-02   -1.720737988723472e-01   -5.072532815361829e-01   +1.176644707096695e-01   +2.752244366567983e-01   +2.331517612221269e-01; -4.031105969701032e-02   +2.922050886241261e-02   +3.580853890195987e-01   +1.610314980578617e-01   +1.842008615207265e-01   -1.003772870026198e-01   -1.185247649988003e-02   +1.969449485886213e-01   +3.049828234456379e-01   +1.278610056252100e-02   -2.183166908368205e-01   -3.111323774262663e-01; +1.040325361064084e-01   +2.774616010324321e-01   -2.229834048053551e-01   -2.350729048647298e-01   +9.624981475573913e-02   +6.754662715980117e-02   -2.882927854004075e-01   -2.233211158889568e-01   -3.566892627913411e-01   -3.153199181802483e-01   -4.905782991931339e-01   +7.351182357035652e-02; +1.565961412285442e-01   +1.206566924251170e-01   +1.515371031344218e-01   -2.436397901461318e-01   -3.233256330167189e-02   +4.212225204166498e-01   -8.065374433716133e-04   +2.451256498486011e-01   +3.496960972072206e-02   +4.151973586283845e-01   +8.250827290559933e-02   +5.862289569215982e-02; +1.562269890681205e-01   +6.706849736402881e-02   -2.904073653286323e-01   -3.232524202249132e-01   -7.229191005597597e-02   -7.103227818186791e-02   -1.146269430957568e-01   -4.282537327496558e-01   +2.930559258910790e-01   +9.692022112055167e-02   -7.340463363203670e-02   +1.045517861925767e-02; -2.992798348421704e-01   +2.514082362121633e-01   -3.350324896920949e-01   +8.495472163631779e-03   +2.166976321609144e-01   +6.060883086653153e-02   -4.873037160147231e-02   -2.516257070540968e-01   -1.657544060824316e-01   +3.539487745958624e-01   +2.235315588145553e-01   -9.998835268236719e-02; -1.568775632038155e-01   -1.799643505808579e-01   +2.811748437680915e-02   -2.129250655564573e-01   +4.230607334332003e-01   -2.858142982321736e-01   +9.086973164489126e-02   -3.477205524094609e-02   +7.189475560136427e-02   +3.064910454146572e-01   -4.083196879483578e-02   -1.849969635153994e-01; -4.193586232273203e-01   -1.111275984239544e-01   +8.081567708645154e-03   -1.740968376217283e-01   -3.566016639452475e-02   +2.436621462413450e-02   +1.762449102194400e-01   +3.084232653333475e-01   +4.507170809443482e-02   -8.594427289458920e-02   +2.638167461452844e-01   -4.800726230379608e-01];
L3I_L2I_iGABA_netcon = [+4.059588408328689e-01   -2.528838014922669e-01   -2.380461309776953e-01   +2.149164647206230e-01   -2.140482775965969e-01   +7.797202017457558e-02   +1.936342482353031e-01   +5.910436459071119e-03   +1.644508496204107e-01   -9.720327995799516e-02   +5.684956747830548e-02   +1.995719771579632e-01; +4.921087194231017e-01   +1.095802487606223e-01   -2.173668093418832e-02   -2.229214596259704e-01   -6.732685241472555e-02   -1.186910113146902e-01   +6.078444058225142e-03   +3.451830948150237e-01   +1.728080519000665e-01   +1.507269234373778e-01   +1.562451094185676e-01   +1.534743624905036e-01; -1.211966914730361e-01   -2.443365836130390e-01   +2.944802771648396e-01   +2.506129091315963e-01   +7.018239669217205e-02   +6.461224510962646e-02   +3.321468733122962e-01   -1.938799622094240e-01   +7.956866380401785e-02   -3.731700809904838e-01   +1.097677266683612e-01   +2.113554570138758e-01; +2.606503672092320e-02   +2.960516158975276e-01   +2.278158751258606e-01   +4.903738906766410e-02   +1.048557042082294e-01   -7.239078742453518e-03   +3.471038673476616e-01   +1.741089264800407e-01   +8.470105519288516e-02   -3.792351202417346e-01   -7.330564773574522e-02   +5.854047591217901e-02; -1.543174708062561e-02   +8.529301713888994e-02   +1.925690111606330e-01   -4.807585504997966e-02   -2.168950277380938e-01   +4.003868979426006e-01   -1.602976110631249e-01   +7.138062585140023e-02   -7.876688932662498e-02   +4.866536911418713e-01   -3.515323860428532e-02   +2.645625307431952e-01; -3.195757626747576e-02   -2.672120605990753e-01   -3.217575464392854e-01   +2.897009529854869e-01   -1.714785875330766e-01   -9.800726735657229e-02   -1.585257765608823e-01   -1.511281450502343e-02   -4.062354323757911e-01   -1.156549917960804e-01   +9.055515250332027e-02   +2.033452177690825e-01; -6.904109677361867e-02   +2.679501495380786e-01   -1.269787354030958e-01   +9.349640191479663e-02   -1.622122517458997e-01   +8.451039516125014e-02   -2.429400345573989e-01   -3.169705220251293e-01   +1.437006437113980e-01   -2.002078081023529e-01   -2.707013461867188e-01   +9.395161641839897e-02; -4.338556849694637e-02   +3.595645697599019e-02   -1.870943055485277e-02   -2.455384773227823e-01   -1.224901877059569e-01   +2.991833732028824e-01   +1.512187417602154e-01   +1.270552419266977e-01   -1.944521571719591e-01   -2.654460697553017e-01   +3.540604177772496e-01   -2.065431230256578e-01];
L2E_L3E_iAMPA_netcon = [+2.013734829783452e-01   -1.818326452306083e-01   -3.580207478045194e-01   +3.291214215501451e-01   +1.305322018229839e-01   -1.576212472483688e-01   -2.724589753300415e-01   -1.462641828233734e-01; -1.712849129397373e-02   -2.657736016064653e-01   -3.344648939696447e-01   -1.635973392333785e-01   -3.252347221389144e-02   -2.510992446582503e-01   -3.980747206830072e-01   +3.222183905750308e-01; -3.905153717853911e-01   +5.574913688858092e-01   -1.337313504194034e-01   -7.880276216185360e-02   +3.080248088138963e-02   +6.295592008187770e-02   +1.649334558442021e-01   +2.175561109336690e-01; +4.189878965764667e-01   +3.757270084819105e-01   -6.126500937703484e-04   +9.719820963294097e-02   +2.730825508959425e-02   -1.629186884285672e-01   -4.806025361038667e-02   +3.250226588047703e-01; -1.267739795015484e-01   +1.266922654082002e-01   +9.211804485206844e-02   +3.715804805213235e-01   +1.586295267652702e-01   +1.063428567803617e-01   -9.677742678446999e-02   +9.579400971053503e-02; +1.104266301236899e-01   -2.061591180512206e-01   +1.345247185891922e-01   +1.502548224623563e-01   +1.826561125890366e-01   +1.276578350962470e-01   -2.155338238849568e-01   +2.121000909166380e-01; -2.793989430184272e-01   -9.106414836018634e-02   +2.382482620353736e-01   -1.373702074567958e-02   -9.071972476491891e-02   +1.777295132174992e-01   -1.308893841721787e-01   +1.848557015282587e-02; -2.415894645495754e-01   +9.186406611972041e-02   -1.835030606185499e-02   -1.993010528925728e-01   -1.598592895220441e-01   -9.707928258177959e-02   +1.259279295603328e-01   +1.533596390122564e-01; -9.838646226451972e-02   -2.224024305280534e-01   +1.991693906609131e-01   +2.682965352347098e-01   +2.598372966469090e-01   +2.029565623586466e-01   +3.163439075529269e-01   -5.907625455890220e-02; -3.491562406458034e-01   -2.190577960369602e-01   +2.448602936224356e-01   -1.591235141603490e-01   +4.047322147215231e-02   -1.980450928891470e-01   -6.803064055242465e-02   -1.214443409138198e-01; +2.167893275332682e-01   +1.052590065419673e-01   -1.371280766620677e-01   +2.178577597157978e-02   -4.732493149518127e-02   +1.783696159941095e-01   -2.346922579445874e-01   -3.914624478402648e-02; -1.633824274541647e-02   -2.795768839896606e-01   -1.357134730676359e-02   +5.829426373154691e-02   -1.343956977420175e-01   -2.633804722951557e-01   -2.270150473961545e-01   -2.630100795597117e-01];
L2I_L3I_iGABA_netcon = [-3.217884723696087e-01   -2.043896904076280e-01   +6.633222588736938e-02   -2.489564090683906e-01   +3.336391668000073e-02   -5.132832645715357e-02   -9.900721528888351e-03   -2.565738259562886e-02; -1.511134471230106e-01   +4.192532399564515e-02   -2.516662834677991e-01   +3.333339881562895e-02   -2.941275342195128e-01   +2.942808744472312e-02   +3.460478640124605e-01   +1.920180882813244e-01; +2.980308222918427e-01   +5.370125312339341e-02   +1.936880323770195e-01   -1.621167266478732e-01   +6.883466950585110e-02   -8.449800418408315e-02   +1.597457481301429e-01   +1.187646237132448e-01; +1.495567055040636e-01   +3.134430435658207e-01   +1.343336134979157e-01   -2.326541273288602e-01   +9.909755973754072e-02   -3.343379559724530e-01   +5.694138189589486e-01   -3.414148941205610e-01; -3.698704699597748e-01   -4.750359816857699e-02   -3.919762021659495e-01   -1.726722498861406e-01   +2.706867178682191e-01   +1.393047124459024e-01   +1.357064603166905e-02   +2.150301762318844e-01; +1.155347900487052e-01   +8.024610969546542e-03   +5.126088087607159e-02   -3.734311167034052e-02   +1.370527812718362e-01   +2.968000915240075e-01   +2.011387102845293e-01   +2.472561544610927e-01; +1.819168093118545e-01   +9.794091649888324e-02   +2.531151255582866e-01   +8.785159753412242e-02   +9.673359765131859e-02   -2.181927387165096e-01   -7.858920719700857e-02   +6.212547588313780e-02; +1.594751450598416e-01   +2.402359076949720e-01   +1.658569551532096e-01   +1.852647571586983e-01   -3.483902939196675e-01   -4.939438809469490e-02   -3.541814778727220e-01   -3.119392442018038e-02; +4.147226310583507e-01   +2.174098915252969e-01   -9.204928810788779e-02   +3.365539297791264e-01   +4.866563574074848e-02   +3.050457245043031e-02   +4.151719005747279e-01   -1.869151286440369e-01; +3.667030611872612e-02   -7.672570303803347e-02   -1.235652307310218e-01   +2.524487780294185e-01   -3.813313907373754e-01   -3.365795936675926e-01   +1.093301372424257e-01   -5.336740699864947e-02; -1.954886190079969e-01   -1.592859984627451e-01   +2.353973786592341e-01   +9.052064712253560e-02   +1.522063354673362e-01   +1.654886861481474e-01   -2.830249063141648e-01   +5.847982487331520e-02; +5.592866031695820e-02   +3.035408375381888e-01   +4.531530111651827e-02   +6.167922435069584e-03   -2.726065837456852e-01   -4.717115383985307e-02   +1.113621165076782e-02   -1.834608429806706e-01];
L3I_L3E_iAMPA_netcon = [+3.652782998982494e-01   -1.979834333518766e-01   +4.508626767602797e-01   +2.217278643833968e-01   -9.182068776033234e-02   +1.894238081212125e-01   -3.739076501273227e-01   -3.859429160629517e-01   +5.643923693809816e-02   +9.224424383507725e-02   -1.842888234078677e-01   -1.458033193381042e-01; -1.522611320015820e-02   +1.217732536643976e-01   +3.693696634415642e-01   +3.523332870898233e-02   -1.299992907662837e-01   -5.086259891440600e-01   +1.645578779954755e-01   +4.022265643012934e-01   +5.582176357735883e-01   -2.524897344928727e-01   -1.509001531219038e-02   +2.540737736373583e-01; +8.036404340986070e-03   -2.418206416252024e-01   -2.702510428537594e-01   +1.745730083463378e-01   +1.540267531032549e-01   -2.126126460163629e-01   +1.309629185995563e-01   +4.467741493902702e-02   +1.164080101270857e-01   +5.787301854027344e-02   -8.160551877788952e-02   +2.031024204469991e-01; +9.766900717306191e-02   -4.848448402573730e-03   +4.236041199858546e-01   -1.128869282277496e-01   -3.340464556467727e-01   +2.869789771170858e-01   -2.099091313547841e-01   +2.615856910507809e-01   +1.486879546906976e-01   -1.748975118278623e-01   -1.926037371039890e-01   +3.130634790199098e-01; +3.744393300219048e-02   -3.559304798417202e-01   -1.304746221339674e-01   -4.691483151518376e-01   -9.648622678860483e-02   -3.150995749388893e-01   +2.003874487165878e-01   +6.725971041873387e-02   -1.202515669186703e-02   -2.522566609703194e-01   -2.126304121598273e-01   -1.984622753588728e-01; +2.748220925858510e-01   +1.845838006219704e-01   +3.671993494694710e-02   -3.743356330249243e-01   -4.246422971996460e-01   -4.847818453257507e-02   -1.367003374632295e-01   +8.666646584451922e-02   +8.875632499375978e-02   +1.153157125046904e-01   +1.200316321560658e-02   +3.639337289119203e-02; -7.742746711771271e-02   -3.405183723585778e-01   -9.120635327399337e-02   +1.170892339589807e-01   +3.272912308639315e-01   -3.462586502832229e-01   +1.177882001903716e-01   +9.117623295647478e-02   -7.873102610420271e-02   -2.379459015540029e-02   +2.316963317337087e-01   +1.831390403316137e-01; -6.893020243754588e-02   +1.417749372019657e-01   +2.837277259331766e-02   +7.421747143802543e-02   +4.023456460129792e-01   +2.445225700007931e-01   -2.185166146520878e-02   -2.284506272655647e-01   +5.761077919939792e-02   -9.260539155827048e-02   -2.676015285685424e-02   +1.322766919998951e-01; +2.957204980459194e-01   -4.190788881173019e-01   +1.710231325754342e-01   -1.304075359160590e-01   +5.537804012870605e-02   +4.278125262654425e-01   +1.535201674612660e-01   +3.301939605908909e-01   -2.390273164864837e-01   +8.612594186378911e-02   +3.181092604056741e-02   -3.685403885218843e-01; +1.457958825033613e-01   +1.372117455005191e-01   -2.130576762551306e-01   -7.428047274420821e-02   +7.869851416956547e-02   -3.207751475090781e-02   -2.298545237050151e-01   -3.475426993899766e-01   -1.158361426774744e-01   -1.368217404455721e-01   +1.695261815231968e-01   -3.059078880061895e-01; +1.569403787419085e-01   +1.343432550008650e-01   -3.488801500259397e-01   -1.566360936841879e-01   +2.292133440567747e-01   -2.755651693535022e-01   +1.831223051469512e-01   +3.050868511800717e-01   +1.037336275102991e-01   -3.257665447867938e-02   +5.916517589370729e-02   +7.318250979489298e-02; -2.496339025540520e-01   +1.916451147779599e-01   -9.575026698544087e-02   +1.297796670437667e-01   +2.448663848696339e-01   -2.008784779349772e-01   -7.268497897701041e-02   -2.724864131424348e-01   -1.104185704730600e-01   +4.536778657507523e-01   +2.095993357280900e-01   +3.570830308092779e-01];
L3E_L3I_iGABA_netcon = [-1.655112170840306e-02   +2.193709139593178e-01   +5.180713968577494e-02   -1.685189301398545e-01   -1.747420537625690e-01   -3.367857950266456e-01   +2.696168568066545e-01   -1.739625624856433e-01   +5.356411768859495e-02   +1.124493587879636e-01   +1.677437151813860e-01   +1.301476922892753e-01; -9.219484434213179e-02   -8.025181201064557e-02   -4.389325459702603e-01   -2.371888712613230e-01   +2.791158567377468e-01   +5.923920070631875e-02   -1.545439404808122e-01   +1.718269875152975e-01   +1.132588189256538e-01   -2.400487359738038e-01   +4.977365506702245e-01   +3.460887142045075e-01; -1.125214103813483e-01   -1.771824776707837e-01   +2.567988713047779e-01   +7.624622483202655e-02   +1.039986671762144e-01   +3.800559704927617e-01   -2.146550714787315e-02   +1.257613218189860e-01   -3.488290410802262e-01   -2.283749013028797e-01   -4.111111869659947e-02   +5.006177913796013e-02; +8.856175125022327e-02   -2.910606283350247e-01   -1.194314017770401e-01   -3.546000611475653e-02   -9.917197908433151e-02   +4.595164324046343e-01   +1.110641906734561e-01   -1.705813645344605e-01   -4.233873054221242e-02   -1.737067571721712e-01   -1.948658771115246e-01   -1.001913285915895e-01; -1.659254669182790e-01   -6.828320705741496e-02   +9.559566644591629e-03   +1.539271978032467e-01   +5.063193757993904e-02   +6.548970646989691e-02   -2.166358439583775e-01   -3.676286947649429e-01   +6.316051398913844e-02   +3.106520485348807e-01   -2.140671430781609e-01   +2.533143469754172e-01; -1.990955035876089e-01   -2.335105819436763e-01   +3.072569457612465e-01   +5.486224409012053e-02   -3.663380772856828e-02   +2.331311640637428e-01   -2.170467984586292e-01   -2.257584618432757e-01   -1.505883450941682e-01   -5.977766950225442e-02   -2.184114351757434e-01   -9.489395520640645e-02; -2.831206247246092e-01   +6.510481258916848e-02   -1.482149639219216e-02   -3.155288520326527e-02   -1.700112811482911e-01   -2.243030469586310e-01   -4.991531193707345e-02   -1.176655718221873e-01   +1.639986025785409e-01   +4.044632972287428e-01   +1.209724088431473e-01   -2.678690128895281e-03; +2.142802909775862e-01   +4.153676516355262e-01   -1.231444772755321e-01   -1.843103402636778e-01   +3.681135893794721e-02   +1.740083491957806e-01   -8.247667926520597e-04   +2.303483097863310e-01   +2.195738176754326e-01   +3.163955915310650e-01   +3.011753431188536e-02   -3.893706743161336e-02; -3.098564314059981e-01   +2.857170434227906e-01   +4.134656979434492e-02   -1.841144817039684e-01   -5.491100387191009e-01   -4.568638099304974e-01   -4.890423546825631e-01   +1.205079212129418e-01   +1.023009868879533e-01   +2.292500045096744e-01   -2.632879351736011e-01   -6.251574284789205e-02; -1.283022119866580e-01   -1.925895629845124e-01   -1.226269639630434e-01   -3.573508466911074e-02   +1.607339904175988e-01   -2.754104057263896e-01   -2.180200110946675e-01   -3.345207738522851e-01   +1.014893356362449e-01   -2.180124938518510e-01   -1.213050493262637e-01   -5.294347203912875e-02; +2.434772260617890e-01   -4.308702736860323e-02   -1.775297338286766e-02   +1.610867600880276e-01   -1.076836192904185e-01   +3.336833030948706e-01   -1.617720477500444e-02   -1.567840302445953e-02   -1.995051634702538e-04   +3.643609922145720e-01   -2.236075940075881e-01   +6.551013944695736e-02; -1.320979535744600e-02   +1.287328764969796e-01   +2.623280731763808e-01   -5.435546284925748e-02   +4.060506330205739e-01   +2.516363852394682e-02   +2.889615375148630e-02   -1.305183766652070e-03   -2.137858619404782e-02   +3.550243164011192e-01   +2.910256322525568e-01   +1.471757609462239e-01];
L2E_Input1_iAMPA_netcon = [+2.193956605861925e-01   -1.539944801054322e-01   +3.962774982878489e-01   -1.876268433049823e-02   +1.215760270083359e-01   -3.930031626311081e-02   -2.174980018757872e-02   +3.235813982409087e-01];
L2I_Input2_iAMPA_netcon = [-6.016910932732472e-02   +5.979727189053091e-02   -2.239469194681623e-01   -4.687676168452267e-01   +3.271370927478534e-01   -2.472837203013293e-01   +3.904131713873117e-01   -2.537873275744891e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
