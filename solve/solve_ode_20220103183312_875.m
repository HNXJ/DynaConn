function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.126431364633233e-01   +9.491935615377467e-01   +7.004034050679011e-01   +1.636074763866482e-01   +9.210992731835199e-01   +2.101703945498071e-01   +7.429883051438257e-01   +3.046863594329114e-01   +5.373996664347984e-01   +8.360048288840582e-01   +9.713177080458183e-01   +9.695090195554767e-01   +6.980899440329436e-01   +3.719797669955036e-01   +2.957368306585900e-01   +3.817726803152770e-01; +3.492226844035387e-01   +1.265990427482252e-02   +1.397516014379350e-01   +1.714204156109085e-01   +7.736818051546969e-02   +8.132521056210232e-01   +7.980517142792624e-01   +7.554913542136992e-01   +7.911503381796698e-01   +1.872611637639121e-01   +4.760148350085419e-01   +6.643131054106335e-01   +3.692723578769699e-01   +2.770554471360435e-01   +6.850549323695755e-01   +9.610373989884181e-01; +2.019180953642931e-01   +4.764350611198088e-01   +8.342533961806593e-02   +7.113440615339117e-01   +3.144648511519209e-01   +3.837098183772422e-01   +6.596386907242860e-01   +9.563387569423607e-01   +4.841838502634305e-02   +9.270647410752910e-01   +8.736418109471711e-01   +2.027276064677468e-01   +5.447835927566146e-01   +7.002926932702276e-02   +7.777424491327931e-01   +8.132116151241130e-01; +2.558389280549506e-02   +4.894545087297218e-01   +4.327043899812476e-01   +8.421783947473991e-01   +6.354211282211717e-01   +8.659712687347030e-01   +4.409219270275307e-01   +6.488459108300517e-03   +4.639875980999762e-01   +4.208550973679883e-01   +9.417570713475119e-01   +8.988604388090035e-01   +5.136487243238306e-01   +1.537865887432446e-01   +7.167735815463449e-01   +8.936272703981422e-01; +7.642090775441527e-01   +5.177915555597200e-01   +9.027976998493130e-01   +8.010831430552523e-02   +9.077141514132840e-01   +3.198567239583034e-01   +5.790004275066465e-01   +4.028784137902012e-01   +9.418053480591824e-01   +2.982711304412801e-01   +2.398951211176629e-01   +4.825869342683516e-01   +7.684466493989760e-01   +3.653992253095296e-01   +2.741012102731141e-01   +7.051667815689905e-02; +5.737845850466620e-01   +2.870289190701137e-01   +7.238839900333404e-01   +8.368585516264515e-01   +8.009319527248754e-01   +3.831668694188460e-01   +5.187443287688349e-01   +1.562703013298010e-01   +4.736078251889094e-01   +3.519962708060865e-01   +9.219324603991591e-01   +6.655460011022533e-01   +7.561657578007802e-02   +7.132033796659152e-01   +1.808021263162377e-02   +9.030522083217825e-01; +5.821496595301103e-01   +5.633259278220566e-01   +6.846695026700524e-01   +5.486029537369701e-01   +6.456931818279682e-01   +6.453397220064717e-01   +7.278228601645910e-01   +8.273862816330743e-01   +7.792808484079786e-01   +9.765707789558633e-01   +6.337701935542305e-01   +5.251466478023136e-01   +6.569738169122075e-03   +5.376209545923282e-01   +1.601638235323260e-02   +6.715430695791530e-01; +3.885532067405688e-01   +5.152457647752109e-01   +2.050525213243068e-01   +9.658303820388319e-01   +4.415033209325309e-01   +3.893909856452023e-01   +2.193384129729228e-01   +2.839441495041066e-01   +1.119298858207731e-01   +5.348116273453015e-01   +2.894746105425874e-01   +7.054626999296186e-01   +4.079114324808206e-01   +2.346769064121418e-01   +9.327312825769563e-01   +3.454076424780329e-01; +5.562464081620377e-01   +6.730663948269866e-01   +5.259841077742243e-01   +6.729706666033710e-01   +7.495864312307261e-01   +7.413120814451848e-02   +9.992070172509979e-01   +9.796936183636350e-01   +5.183645823003695e-01   +7.930598322086416e-01   +8.483451926314730e-01   +7.193119960790511e-01   +6.607279730302926e-01   +4.718407789400576e-01   +9.360218033735518e-01   +8.427897720820402e-01; +1.871111477490254e-01   +6.162748282713876e-01   +8.254261608804039e-01   +3.364402500028111e-01   +8.329019084734846e-01   +1.681508092437978e-02   +6.218862868696563e-01   +6.258721656329697e-01   +6.408426476311558e-01   +8.002798372086385e-01   +1.631982604717951e-01   +2.928319913310700e-01   +3.752527075446735e-01   +7.205609395146197e-01   +3.746432480407682e-01   +1.958627001198018e-01; +1.204502835516103e-01   +5.670777903174896e-01   +1.803802945970793e-01   +2.178514800443474e-01   +3.453468478415604e-01   +8.741474939605537e-01   +9.874852833846813e-01   +7.479832938657232e-01   +5.776633415511560e-01   +1.397595443849177e-01   +8.253955976151497e-01   +1.139479838730948e-01   +3.954270750165777e-01   +5.204106775781702e-01   +1.031158004083171e-01   +8.453192981093849e-01; +5.419990899567479e-02   +5.059686354663387e-01   +5.151076500300946e-01   +5.703255499484637e-01   +1.487032626874458e-01   +1.582419808507597e-01   +4.939116570868726e-01   +8.825055480330252e-01   +8.382955144030525e-01   +4.575890167693862e-01   +2.161708038762737e-01   +3.293516035428752e-01   +1.369516773556851e-01   +5.167830662228720e-01   +7.242994095103126e-01   +4.258987946478610e-01; +9.384721052081204e-01   +6.635742686714196e-01   +3.563330745808162e-01   +4.172929008533976e-03   +5.030268057603093e-01   +9.206478965216829e-01   +5.235424726484339e-01   +3.310423552463551e-01   +1.150425508623937e-01   +4.538316426538170e-01   +2.695096904721219e-01   +4.635371239531558e-01   +3.384390914760927e-01   +3.900250201911458e-01   +4.539937691845539e-01   +5.598519788897518e-01; +7.444526972123766e-01   +6.385587345838425e-01   +6.508421920497253e-01   +5.933535860345328e-01   +4.141926745440836e-01   +5.630978522695259e-01   +8.568981923878144e-01   +9.503013760738029e-02   +5.064908249897147e-02   +9.613489545236915e-01   +9.054026020480634e-02   +7.172942337275959e-01   +1.231583463037440e-01   +4.835649506890172e-01   +1.429325579266532e-02   +4.464250140705102e-01; +2.394388705762657e-01   +1.415688207399409e-01   +2.797701716113066e-01   +8.962937827206491e-01   +1.744445741281062e-01   +9.219278910095243e-01   +2.526652927664588e-01   +4.468189670599925e-01   +5.235349105477256e-01   +5.089778625880068e-02   +9.178444578194773e-01   +3.996145353209714e-01   +3.673106529867981e-01   +7.438326682415272e-01   +1.175081346749924e-01   +7.622786428218750e-01; +2.018499040350829e-01   +1.800299995612833e-01   +4.338240333173270e-01   +2.581884418392665e-01   +4.950797641754886e-01   +5.976029766091885e-01   +5.788637512668836e-01   +2.359263699649656e-01   +7.035832837335415e-01   +3.748455808568196e-02   +7.303242587954435e-01   +2.395709845899053e-01   +2.463389512978026e-01   +7.064612108795192e-01   +6.593382140612934e-01   +9.780326778225561e-02];
L1E_L1I_iGABA_netcon = [+8.387246461565144e-01   +7.491195655682199e-01   +8.733591976942170e-01   +4.358335488671831e-01   +9.206787903809219e-01   +7.707144015498018e-01   +3.220043904688832e-01   +6.415938639601871e-01   +9.525144182216640e-02   +2.796824862916824e-02   +1.317920884811800e-01   +5.212541118942529e-01   +8.734340979272018e-01   +5.757571872642769e-01   +1.704990318845647e-01   +6.328516199345656e-01; +6.133644428349980e-01   +9.935768376506805e-01   +3.108799111509079e-01   +1.483024517112772e-01   +8.851091517918622e-01   +2.730131238520726e-01   +9.665532443963971e-01   +4.347514912900513e-01   +2.931041332187439e-01   +5.103862570062008e-01   +4.291541487533234e-01   +2.049452699661009e-01   +8.055550412459817e-01   +2.909233564516641e-01   +5.788083234272279e-02   +3.415104512848731e-01; +6.648566040275994e-01   +3.736770202497920e-01   +4.328850688860781e-01   +6.510056481526290e-01   +5.881804028747972e-01   +5.250381417953738e-01   +3.546144140691951e-01   +4.824259992865942e-01   +3.312264808027002e-01   +8.654660626254262e-01   +4.803234085949212e-01   +7.694187955060108e-01   +6.410161978900765e-01   +1.396967787680997e-01   +2.157317727627176e-01   +1.537055379851831e-01; +7.800205030678069e-01   +5.052272465244746e-01   +3.816393404693957e-01   +7.261939328497463e-01   +8.355813854333444e-01   +4.092060087294543e-01   +3.191240201787360e-01   +1.010838421778610e-01   +4.775251052884656e-01   +5.810001105449001e-01   +6.710599512486086e-01   +3.867954832848338e-01   +7.343220579085249e-01   +4.223385334452895e-02   +2.087010717613802e-01   +4.001882588626111e-01; +3.143600222067458e-01   +7.548390620567703e-01   +6.549613675480702e-01   +1.685562547654040e-01   +7.801136262103787e-01   +7.835747821894665e-01   +9.141343457207461e-01   +8.072434960891613e-01   +2.432535235961640e-01   +4.273156981746194e-01   +3.523559290887725e-01   +6.745361234672466e-02   +6.668487935629849e-01   +6.250381214237827e-01   +2.168932374004398e-01   +9.124295869945702e-01; +3.282255733946909e-01   +1.328797609365775e-01   +2.440730186367572e-01   +3.424078474375086e-01   +7.879834113660457e-01   +2.381961954255167e-02   +8.831568096054266e-01   +6.249557734320179e-02   +4.592493596509887e-01   +7.170678574725521e-01   +4.615427823768319e-02   +7.540022223568572e-01   +8.879179314079052e-01   +6.055971139450379e-01   +5.800051120155759e-01   +1.581156454559889e-01; +6.327460743926324e-01   +5.153284658941246e-01   +6.873446797734636e-01   +1.053020014971870e-01   +6.969538950561452e-01   +4.089584145020519e-01   +3.605772331973129e-01   +9.565685921870254e-01   +7.558282711133580e-01   +2.299710067476797e-01   +2.935974877327174e-01   +4.549102505147126e-01   +8.528318549919098e-01   +3.698245490094230e-01   +3.458622865138797e-02   +4.683969254618497e-01; +8.998603312600210e-01   +9.047847650045113e-01   +3.283809559385742e-01   +4.445855938705706e-02   +1.934088011874396e-02   +8.289095100404510e-01   +7.437624504709432e-01   +7.730177762730245e-01   +7.155580630784310e-01   +5.835431865841372e-02   +7.976392127883467e-01   +3.174463112135388e-01   +4.069086877684310e-01   +8.346035037453612e-01   +7.954412210294710e-01   +7.868626699642152e-02; +3.727776075199811e-01   +1.023506210455715e-01   +8.737998818310098e-01   +4.757284611000070e-01   +3.235030264353417e-01   +5.929211090744693e-01   +1.258121993182226e-01   +4.442554250645411e-01   +2.309466612606439e-01   +9.773246117697104e-01   +6.502574403766482e-01   +2.740547952304763e-01   +1.095649509608063e-01   +5.192848229538115e-01   +1.366431410192436e-01   +3.364351353277131e-01; +8.810729343947226e-01   +1.808140032008962e-01   +9.990745340062159e-01   +4.791864466507757e-01   +9.449487094605034e-01   +2.113998218460476e-01   +5.924993151940172e-01   +1.654108005476545e-01   +7.043558803034582e-01   +9.717651515746125e-01   +7.087814856582019e-01   +5.737971323840926e-01   +4.066732485357270e-01   +8.091528296484254e-01   +5.787141570614315e-01   +4.906164495674274e-01; +1.199112871478585e-01   +1.770396125748673e-01   +6.865280994146010e-01   +5.507235219003337e-01   +4.073691687318880e-01   +2.945812488683320e-01   +4.379690948728457e-01   +8.244423651431507e-02   +3.048894123599718e-01   +1.341377946766661e-01   +7.573829862946497e-01   +9.097966564811198e-01   +3.374180396562657e-01   +5.749734245534882e-01   +8.406833908394760e-02   +4.971513425566204e-01; +9.122937139519664e-02   +5.396150815575859e-01   +3.464762750152984e-01   +6.504140110309402e-01   +6.282059801015064e-01   +2.692597635080559e-01   +9.632626714981479e-01   +7.414704568181203e-01   +4.673839744243304e-01   +1.537432441529628e-03   +3.901461475396579e-01   +4.490236404426872e-01   +1.123678942234053e-01   +7.114956880141201e-01   +2.262534326173667e-01   +1.309205276906417e-01; +5.434774562479082e-01   +9.729236356257533e-01   +5.608084959842766e-01   +3.499027492369736e-01   +8.523778303645902e-01   +9.318514579056296e-01   +9.726896105489986e-01   +5.363291113123335e-01   +4.400354310728147e-01   +9.304216133482638e-01   +3.664611321892975e-01   +9.792145152368568e-01   +8.565619542557473e-01   +7.350487058281867e-01   +4.491425949700183e-01   +7.869361916868180e-02; +6.022015059177591e-01   +8.452629743841303e-01   +8.912329888138657e-01   +2.520836180618174e-01   +3.698648809771444e-01   +5.544559887543503e-01   +2.505294228423238e-01   +4.870575240051901e-01   +7.310546529347413e-01   +7.377770444115894e-01   +8.151866618017815e-01   +1.045302672120479e-01   +8.960306994384774e-01   +4.479228560901474e-01   +1.806784139837431e-01   +6.737695358895117e-01; +7.264536829058376e-01   +6.698119375989051e-01   +6.481109456233909e-01   +1.815171901644416e-01   +2.038848105740516e-01   +4.323374478951922e-01   +7.743309481534019e-01   +8.867553275732418e-01   +8.751586845287768e-01   +4.292232775942315e-01   +3.886985230845270e-01   +4.203800710332750e-01   +6.879458580850971e-01   +2.808096714907763e-01   +4.130399168779295e-01   +1.198804990885685e-01; +9.931980603159469e-01   +1.240576290026365e-02   +3.789870356108120e-01   +4.763052010036773e-01   +9.081104019385651e-01   +3.232503886881712e-01   +7.084623273844977e-01   +5.856380672554763e-01   +9.120866936594488e-01   +9.447434413360536e-01   +8.701530825498072e-01   +3.880084449504551e-01   +7.483648907663909e-01   +1.526642899648542e-01   +9.669144563431705e-01   +9.909112192790492e-01];
L2I_L1I_iGABA_netcon = [+5.743174489842920e-01   +5.646287196478493e-01   +1.051314548764232e-01   +4.534703855443461e-01   +7.963175935607435e-01   +9.784419836292915e-01   +2.211487753879612e-01   +7.601158625445998e-01; +5.652951876214145e-01   +9.529995887948221e-01   +1.256881991234403e-01   +5.678489902185859e-01   +5.464123789648381e-01   +4.259475936003443e-01   +6.515028714909206e-02   +4.975005204677495e-01; +6.095560854595459e-01   +1.171606812708166e-02   +4.330514783240921e-01   +8.165214109252962e-01   +2.607577573282928e-01   +3.938788679613039e-01   +8.272103568435071e-01   +8.274047306971763e-01; +4.668597510649291e-01   +1.266336724082300e-01   +9.298108519261405e-01   +3.599612906277746e-01   +7.780619780870817e-01   +4.593044201496677e-01   +4.263582950346297e-02   +9.177518556776335e-01; +4.379538886021366e-01   +8.548871452297735e-01   +1.362862294437670e-01   +2.430679016283893e-01   +7.762804826730135e-01   +1.273062056613861e-01   +9.118263266989518e-01   +7.107229366935172e-01; +6.695011613210868e-02   +2.188952308266393e-01   +8.235924864455074e-01   +7.621060436164848e-01   +1.452518474627161e-01   +4.600016096672167e-01   +4.546031322557965e-01   +8.013182692559361e-01; +6.388448619200602e-01   +7.045846974155821e-01   +9.299104828751498e-01   +2.129509608969528e-03   +8.258936593249759e-01   +2.668863113360791e-01   +2.799401235098788e-01   +9.571298590383981e-01; +4.258805493948780e-01   +7.752353562529926e-01   +5.722532870323812e-01   +2.760091472258283e-01   +6.224640353592932e-01   +1.021842114655285e-01   +7.564295271340320e-01   +9.525787901827356e-01; +7.508998795425440e-01   +4.232359702272157e-01   +5.000317887311994e-01   +3.118657915184904e-02   +4.589811019328927e-01   +6.603188676390809e-01   +9.269324129640697e-01   +2.962828213182293e-01; +3.090606998595696e-01   +7.288110012699095e-01   +9.314818879254586e-01   +6.715912107033565e-01   +4.839190415078298e-01   +9.429629862045954e-01   +1.420073541132891e-01   +3.531459922795195e-01; +5.998552642400770e-01   +4.555594776446966e-01   +8.620193886847693e-01   +9.732453506810620e-01   +2.215636906583914e-01   +7.642046297336913e-01   +9.477819239253361e-01   +5.459330057674514e-01; +3.318609410770803e-01   +8.042922344985833e-01   +2.549911322953262e-01   +9.457898531277240e-01   +8.569223738608263e-01   +4.243927380277124e-02   +3.118289780585739e-01   +2.142152943055532e-01; +6.488865892847985e-01   +4.296451385155619e-01   +4.568024468504905e-01   +4.871880945290486e-02   +8.788705540248009e-01   +2.614377923186553e-01   +2.101639222380823e-01   +7.908844317924218e-02; +6.458969079276683e-03   +1.493379722176174e-01   +7.371276199011589e-01   +2.885506774982547e-01   +8.410468336080320e-01   +6.432036186762801e-01   +4.631949249206746e-01   +5.109987955991672e-01; +1.456213202750338e-01   +8.050996688490925e-01   +7.531217982521946e-01   +4.844643184968563e-01   +4.418409547459683e-01   +9.046757381511140e-02   +5.942926507948953e-01   +2.012127417391512e-01; +2.470187096715229e-01   +3.740438825028763e-01   +2.363006655494963e-01   +8.874494893245894e-01   +5.451226811677929e-01   +7.354319094033916e-02   +5.514511776601464e-01   +1.449005382557814e-01];
L1I_L2I_iGABA_netcon = [+7.085545631001652e-01   +8.682237964136111e-01   +6.148096386333715e-01   +4.851272056599158e-02   +1.444735735056234e-01   +2.339919538989133e-01   +8.404426623268239e-01   +3.686348583187881e-01   +7.099251495635167e-01   +3.881770186477038e-01   +2.441692508361679e-01   +6.711268166484887e-01   +1.617444771102876e-01   +5.724086364401823e-01   +4.241987707458587e-02   +4.504369888562869e-02; +6.047898509275120e-01   +8.030555366849427e-01   +6.152574248741918e-01   +5.546725981784641e-02   +7.473834140857349e-01   +5.527517556469116e-01   +1.991165327421309e-01   +5.596009847573702e-01   +1.888701246708172e-01   +7.244778190257766e-01   +5.100220029058510e-01   +3.358936425988778e-01   +1.083002314680188e-01   +8.118068752188747e-01   +4.353136809185544e-01   +9.229110075217483e-01; +1.626915253698681e-01   +6.218755973154058e-01   +3.083256237146802e-01   +5.990939007276771e-01   +9.538004859581916e-01   +1.123442318024458e-01   +6.178788113537051e-01   +8.321742915573154e-01   +2.298166611790978e-01   +6.335058286416400e-01   +7.347741952252649e-01   +5.501068936614220e-01   +7.426948101047219e-01   +6.758573081676365e-01   +9.259406015704148e-01   +1.768479575618063e-01; +4.811052213200434e-01   +4.750521414432962e-01   +1.326926662214815e-01   +6.589385188360912e-01   +2.652997835831815e-01   +8.230288548457534e-01   +1.599247235488669e-01   +7.152095751332215e-01   +1.000000000000000e+00   +1.015594410853925e-01   +7.806666634109959e-01   +5.370784302150237e-01   +2.155816193847516e-01   +4.428363256648572e-01   +8.833763517654677e-01   +7.423057399565304e-01; +2.908653879116807e-01   +2.075385543345545e-02   +6.041267217202084e-01   +4.866732696273263e-01   +9.187910640354569e-02   +6.564947838350871e-01   +5.848070431752692e-01   +1.151606585556088e-01   +9.012700045866044e-01   +4.937291436732398e-01   +6.827457206092519e-01   +9.049101539046602e-01   +4.878257477468938e-01   +8.901337939228836e-01   +9.567765019171857e-02   +4.729377258788945e-01; +4.032487662226382e-01   +1.197606609769564e-01   +8.928128123960725e-01   +9.798517573302757e-01   +2.325375121066857e-01   +2.347577663417071e-01   +5.445310353564531e-01   +7.387745909633983e-01   +1.425070310629979e-02   +5.558530162436682e-01   +8.159092992522256e-01   +2.816842223392258e-01   +4.997642193086563e-02   +7.869057514216796e-01   +6.818324668665539e-01   +2.505767073352526e-01; +4.897682164696688e-01   +7.213742931254660e-01   +5.640833473401116e-01   +8.677428232674171e-01   +8.911106762243601e-01   +3.029015290652035e-01   +6.856920006375455e-01   +9.231217031684151e-01   +8.329889579671077e-01   +5.180235246214664e-02   +4.206839281407854e-01   +1.408189622696719e-01   +5.782512895516692e-01   +5.887220040387873e-01   +9.894945686257482e-03   +6.651967791838278e-01; +8.611734186676858e-01   +6.705259360445748e-01   +6.338915989668695e-01   +9.576198521619812e-01   +1.967597539199374e-01   +3.276871689273214e-01   +7.007223397834986e-01   +9.194947549394225e-01   +2.525671044410723e-01   +8.141576450924737e-02   +4.959227612557429e-01   +9.567223261236030e-01   +4.961477623305636e-01   +6.199326523064383e-01   +1.231143414026608e-01   +6.099151068952882e-01];
L2E_L1E_iAMPA_netcon = [+3.729171169225079e-01   +5.620593273583147e-01   +2.039928705201912e-01   +5.161777756496992e-01   +2.938972394633722e-01   +6.811182607042285e-02   +2.805753924612088e-01   +2.660229762083842e-01; +4.339138886324126e-01   +1.852066994359272e-01   +1.357131553080039e-01   +6.851425959358608e-01   +6.213066639776992e-01   +5.895504055141267e-01   +9.303908550282418e-01   +9.008755563902953e-01; +7.159969478831335e-01   +6.085233376316517e-01   +8.305392005399355e-02   +2.052334914159358e-01   +8.675277913738835e-01   +7.589724086783844e-02   +7.612952313382167e-01   +1.530053134506083e-01; +1.929009299922205e-01   +7.366698220473265e-01   +9.310429643905584e-02   +9.740825332909234e-01   +8.159376425659485e-01   +4.004576255566124e-01   +2.613888239549292e-01   +5.534751536254964e-01; +4.284608190578842e-02   +8.358708475265670e-01   +5.522442184721004e-01   +3.508089953549454e-01   +2.111206429347724e-01   +5.699563532384189e-02   +2.431734646736802e-01   +4.249553239801959e-01; +3.153718352312735e-01   +2.730548361710405e-01   +7.337132401202761e-01   +1.817539934027123e-01   +7.495230536212104e-01   +1.271742201792004e-01   +1.627183022498004e-01   +5.481252275064175e-01; +7.917364156787354e-01   +6.082817607299102e-01   +5.477747610406308e-01   +2.419298097189876e-01   +1.968255437925776e-01   +2.423851980334013e-01   +2.880024872349349e-01   +7.482667439397617e-01; +4.281664814751747e-02   +5.474141869536037e-01   +4.922171560220301e-02   +2.577391721438997e-01   +5.783165727204587e-01   +9.426108343881372e-01   +5.644688161332212e-01   +1.061876938353016e-02; +2.129031501282390e-01   +2.784221273299230e-01   +6.352114408816758e-01   +2.210682452020217e-01   +8.783051819889763e-01   +2.046129031145728e-01   +3.981243627593800e-01   -7.246366493116210e-04; +2.692166898159327e-01   +3.371939664047698e-01   +9.919406367982074e-01   +3.632039146097499e-02   +7.170142360108900e-01   +3.301769077506284e-01   +9.879599871401400e-01   +2.030181349637506e-02; +7.920480399859614e-01   +5.685274806753583e-01   +9.097121626696515e-01   +3.542297294982994e-01   +6.993987827480098e-01   +8.655331923296977e-01   +5.464386781706829e-01   +3.518797372328322e-01; +9.859017155816124e-01   +7.408617129563358e-01   +7.752462179888052e-01   +8.976755583836333e-01   +4.610654653985874e-01   +9.214076960651859e-01   +9.313640188242466e-01   +4.292264551918187e-01; +9.775688229437231e-02   +7.656522573045791e-01   +1.934772796132230e-01   +1.383526263472030e-01   +5.022281793859845e-01   +1.921804456224607e-02   +9.888614923834598e-01   +5.461392880919729e-01; +1.973218715572886e-01   +4.049426561614508e-01   +3.168462983986517e-02   +9.543987429129462e-01   +8.024763901405195e-01   +3.583272974133203e-01   +8.339562669507273e-01   +4.846145166168951e-01; +1.181617818430891e-01   +1.538960681946887e-01   +3.792594367143329e-01   +9.049202225656080e-01   +9.345042556154681e-01   +5.304175871157251e-01   +1.785501097473852e-01   +9.167872836799238e-01; +6.381506936295510e-01   +2.029399572685222e-01   +5.780701442779153e-01   +4.089028910769634e-01   +7.898189117768553e-01   +4.049041639467733e-01   +3.083442565968040e-01   +4.163016854417800e-01];
L1E_L2E_iAMPA_netcon = [+4.980074672179414e-01   +4.509254932141552e-01   +6.126268846198732e-01   +4.924606370217091e-01   +2.324102270142590e-01   +7.148518248155211e-01   +6.882369706910554e-01   +6.348834556111289e-01   +5.208671735340237e-01   +2.400016017561293e-01   +8.722226325546973e-01   +1.768760419199245e-01   +1.372844727074181e-01   +2.501498721613887e-01   +1.840687788874184e-01   +2.771760089134627e-02; +8.343529803477435e-01   +3.640504769716232e-01   +1.057495769911455e-01   +6.632584254978022e-01   +8.368124509311506e-01   +3.815574899322047e-01   +9.747844765514684e-01   +6.202253337786092e-01   +6.711535892668344e-01   +7.250608525430710e-01   +6.611713136097500e-01   +2.988466518701872e-01   +2.841875416668475e-01   +7.494861309403226e-01   +1.516604074873348e-01   +2.469531481103913e-01; +1.844804304696620e-01   +2.989964713585067e-01   +7.563330551724730e-01   +1.781065126191333e-01   +7.378217939743930e-01   +3.800799224980614e-01   +7.559863632366142e-01   +4.086945069693867e-01   +7.713017953364866e-01   +1.294575402948743e-01   +5.424298105658676e-01   +1.059000440756199e-01   +6.723772620806996e-03   +9.328170948094946e-01   +1.352870045048170e-01   +9.863873882014143e-01; +3.404785373800879e-01   +2.375764998611593e-01   +5.402062638389149e-01   +4.756518313184780e-01   +4.898512196738444e-01   +7.161731258577221e-01   +5.572938485904333e-01   +4.275263282148336e-01   +4.627355721056525e-01   +4.330533098090916e-02   +2.500924099796513e-01   +4.513675723268092e-01   +3.105248333103589e-01   +2.863569474911800e-02   +1.628738987844542e-01   +6.308630900178682e-01; +6.941329333677199e-01   +1.372173211148875e-01   +4.463439785216800e-01   +5.033006384157854e-01   +8.500943547612758e-01   +8.328983506761516e-01   +2.888222313265666e-02   +5.098643815761180e-01   +9.065347350290679e-01   +6.525757327337544e-01   +1.103745423938297e-01   +5.880414857015356e-01   +9.064752136662133e-01   +4.331706685788687e-01   +9.212800604244441e-01   +3.597751486681389e-01; +6.950495455466177e-01   +1.021032520472865e-01   +7.420004492839930e-01   +6.047028143639676e-01   +7.214494769170502e-01   +6.672260261606123e-01   +1.912706219991480e-01   +2.629614599756485e-01   +2.378301144000965e-02   +1.983699993853434e-01   +9.723775250462412e-01   +2.219682416162025e-01   +2.929453845359702e-01   +8.274258309458513e-01   +2.620546650765228e-01   +9.653906332768823e-02; +3.688478780629230e-01   +2.307295802639185e-01   +3.866311313360810e-01   +2.464529800428463e-01   +5.223955795780622e-01   +6.504883145103715e-01   +9.372529732103878e-01   +4.219601591903796e-01   +4.827429097311198e-01   +9.738658074824016e-01   +5.893983480284499e-01   +1.085258832347740e-01   +8.237261340078714e-01   +9.979991763717285e-01   +2.067458093768508e-01   +4.130317463945845e-01; +3.111891255132787e-02   +3.456250381513273e-01   +5.351460864190487e-01   +5.187106814703537e-01   +9.363778126477562e-01   +5.591029623788244e-01   +3.944987250891817e-01   +5.225267359462221e-01   +2.750308295537617e-01   +8.202592621820798e-01   +8.191621918832811e-01   +5.602835142506764e-01   +7.409635109487376e-01   +9.219694092318181e-01   +6.192732187418122e-01   +9.300462775758304e-01];
L2I_L2E_iAMPA_netcon = [+6.728865060289855e-01   +6.099999739748774e-01   +4.129405205450944e-02   +7.983212943698758e-01   +5.193946747354161e-01   +8.237676569703450e-01   +6.478470496955505e-01   +3.892020372564934e-01; +2.457904120677586e-02   +9.447377434882166e-01   +5.404511118334233e-02   +9.352677799912980e-01   +6.580910120351220e-02   +1.102275235632444e-01   +3.602270459313733e-02   +1.721342116186067e-01; +7.380169626675381e-01   +9.622860943500613e-01   +4.061496546133765e-01   +9.399151057600096e-01   +2.886702071724380e-01   +2.340813619312509e-02   +5.639785444573066e-01   +4.446543956914226e-01; +2.170772121786909e-01   +3.680886536149939e-01   +9.820110281739124e-01   +1.397441530588953e-01   +7.134392191088312e-01   +5.984505291476570e-03   +3.058357458008182e-01   +8.768797243473609e-01; +8.572996241996531e-01   +8.014354109922139e-01   +7.123252700106361e-01   +3.235444863788682e-01   +8.856819543525780e-01   +3.345359594519020e-01   +2.610757176213830e-01   +4.055256756199888e-01; +1.592183969901121e-01   +7.248051207529849e-01   +9.866410979499175e-01   +4.295542471006011e-01   +3.639616134795772e-01   +6.652300507100771e-01   +7.199945383749098e-01   +1.632057932016278e-01; +6.741709800961158e-01   +9.528398765480152e-01   +6.464755302336579e-01   +7.050733412820629e-01   +5.673467885348736e-01   +5.929884070631826e-01   +3.106083506076611e-01   +6.639042520714838e-01; +9.369699334301783e-01   +1.395925182438159e-02   +5.047924659499284e-01   +6.180317918047087e-01   +8.783454032270874e-01   +7.589403606817323e-02   +8.998802164280045e-01   +9.315000900923903e-01];
L2E_L2I_iGABA_netcon = [+6.239303924552017e-02   +5.226983930111273e-01   +3.509149426833349e-01   +2.578894085147816e-01   +4.444016917431057e-02   +8.984956217967847e-01   +3.431755570359947e-01   +4.502756864321573e-01; +3.567208950548288e-01   +6.829423654876554e-02   +5.598834781942540e-01   +9.809639038210869e-01   +3.621214004662264e-01   +5.475244919005405e-01   +9.327003035008075e-01   +6.738365312184340e-01; +9.327535109835712e-01   +1.823898707560907e-01   +6.930958284397500e-01   +3.498036498182843e-01   +3.723072723999479e-02   +7.133121617342083e-01   +9.144374150856143e-01   +7.708546678374882e-01; +2.396187757609679e-01   +3.139886689114443e-01   +4.407051545570105e-03   +3.954285557175388e-01   +4.881262596490781e-01   +7.143852940178208e-01   +7.254295137950683e-01   +9.221205567483016e-01; +1.063145788369530e-01   +2.457818253768171e-01   +4.739610058718568e-02   +7.503168076079342e-01   +7.252890371193077e-01   +1.710635086019452e-01   +4.440339012566409e-01   +6.537675189663597e-01; +7.112393352630703e-01   +3.235894352822933e-01   +3.017473643277814e-01   +1.079992671771299e-01   +1.470384196642372e-02   +3.535115009677072e-01   +1.493609755720850e-01   +5.046015462468565e-01; +5.955294299896852e-03   +8.736761787819328e-01   +8.728309297267162e-01   +5.927520592844535e-01   +5.123578905078229e-01   +3.796921405180647e-01   +8.299633183489076e-01   +3.447861672173595e-01; +1.766723109230003e-01   +3.074492285442150e-01   +6.244377745377414e-01   +1.224036145377575e-01   +2.411630456574650e-01   +7.594360372694544e-01   +2.514710406485423e-01   +9.462230873504909e-01];
L3E_L2E_iAMPA_netcon = [+7.900908397473105e-02   +1.626735112888963e-02   +3.699221632823884e-01   +4.944393686049193e-01   +2.273259466558190e-02   +9.610152598414422e-01   +3.575732432047701e-01   +2.134320345434813e-02   +2.056982335695202e-01   +6.905541186721252e-02   +2.451673877906353e-01   +9.996911055025809e-01; +9.514984566853900e-01   +9.800098110232638e-01   +1.158022422673839e-01   +6.452071682842839e-02   +8.073842698313056e-01   +3.907689897223092e-01   +2.284840511982255e-01   +1.266275572617949e-01   +3.540172903951674e-01   +7.431128600904946e-01   +5.369344441143320e-01   +3.411406285011901e-01; +6.650884350488974e-01   +7.202593973929864e-01   +5.103004369149854e-01   +8.697197992850668e-01   +7.975448512807752e-01   +6.643515102751772e-01   +7.250685073920479e-01   +6.640129258774830e-01   +8.895193463983417e-01   +9.915470056586864e-01   +3.335798662600551e-01   +8.264121958192370e-01; +1.693577008281417e-01   +8.740348658832539e-01   +8.377722848635326e-03   +9.989674146209498e-01   +4.198516586145881e-01   +5.850880640472588e-01   +7.727923543856861e-01   +5.091291149282957e-01   +8.185101516435136e-01   +7.664596986636757e-01   +6.689708500301403e-01   +1.107805707483295e-01; +1.982662756212516e-01   +8.171521002373430e-01   +8.722081869030518e-01   +1.190882113643000e-01   +6.307468539244988e-01   +5.390370013346943e-02   +3.406380538732538e-01   +7.882067556890315e-02   +3.179247936015408e-01   +8.873404723119838e-01   +8.785444628222807e-01   +7.793094462316082e-01; +9.897468215967101e-01   +3.346511048482213e-02   +9.093098698516334e-01   +1.063861282579752e-01   +5.669043590776452e-01   +7.207644172478646e-02   +5.705528657166126e-01   +5.379982361854845e-01   +5.976976332479588e-01   +4.336289930685856e-02   +9.827199300770911e-01   +1.521913051664349e-01; +9.286933781378143e-01   +9.438830101833377e-02   +1.112267083099723e-01   +1.497773105843551e-01   +9.014225898165845e-01   +2.305783378812357e-01   +6.373989830531672e-01   +6.828355632448839e-01   +6.990670600138936e-01   +7.960986443873493e-01   +1.404176917969079e-01   +7.323750448168704e-01; +9.777681048611220e-01   +9.167448437254561e-02   +4.603739938395379e-02   +1.281613327733718e-01   +7.502916847021903e-01   +4.133344690883821e-01   +3.713959973575301e-01   +5.912335870859987e-01   +1.802425183856388e-01   +7.106194251462236e-01   +8.803040744402747e-01   +1.164372016299660e-01];
L3I_L2I_iGABA_netcon = [+7.693352341423156e-01   +5.381718678558353e-01   +5.986591010658607e-01   +3.039097797210694e-01   +9.653515850312715e-01   +1.164151467489733e-01   +2.953156361993309e-01   +7.971660154130604e-01   +9.217796151667832e-01   +9.941875374638816e-01   +3.103536000291651e-01   +9.917895807761770e-01; +6.367631433393219e-01   +4.484483139275357e-01   +5.623313953875064e-01   +7.574504104326225e-01   +5.490594708333711e-01   +6.254580771315021e-02   +1.658558748791329e-01   +5.189231843979455e-02   +3.872382739596597e-01   +2.921258640416062e-01   +4.471213207659258e-01   +9.167626583272951e-01; +7.976583028175723e-01   +1.158841053731638e-01   +7.544004555826619e-02   +6.519922023025092e-01   +9.791412676976478e-01   +4.469115030584041e-02   +7.231979107427624e-01   +1.787666155640498e-01   +7.484431536688323e-01   +5.218712476760459e-01   +2.031708770339824e-01   +6.883181457010343e-01; +9.635319965069434e-01   +7.189317582918098e-01   +7.692794913667373e-01   +3.342189610711927e-01   +1.263962875845222e-01   +1.321896630427479e-01   +3.005472725980833e-01   +2.456158250691355e-01   +8.756444936800468e-01   +3.582843194608700e-01   +9.426264503528772e-01   +2.158163999686735e-01; +7.111422635018261e-01   +1.829279798447470e-01   +8.631041909224345e-01   +9.757192459642159e-01   +1.631738761397839e-01   +4.906624836111727e-01   +6.774507067709913e-01   +2.573266135412239e-01   +3.964031028424679e-01   +5.212127136905601e-01   +2.896073362059317e-01   +3.147978199717163e-01; +6.430093631016351e-01   +3.229208049544638e-01   +7.025812656493069e-01   +5.314946055201550e-01   +3.349251972459418e-01   +4.699419973592807e-01   +7.487165157949355e-01   +6.511506384852597e-01   +1.705823585336077e-01   +4.944958456327908e-01   +1.162129447803870e-01   +2.278214961261657e-01; +5.150313989810689e-01   +9.648385679482090e-01   +1.095511027181861e-01   +7.521117856920149e-01   +5.338330384996898e-01   +1.571307022747675e-01   +7.470899667079846e-01   +9.874745114552687e-02   +4.388516389473862e-01   +1.817517980674909e-01   +6.774442504913744e-02   +7.075729311009998e-01; +9.511713062424566e-01   +6.978434378937363e-01   +6.586846590023270e-01   +2.639849436861943e-01   +6.911342763669873e-01   +1.390152474291410e-01   +7.805297384379175e-01   +4.694641629615909e-01   +8.523735348343453e-01   +4.815162846537890e-01   +7.293983878609696e-01   +3.707192082297415e-01];
L2E_L3E_iAMPA_netcon = [+6.579221587531339e-01   +3.854608366030152e-01   +2.333084265361711e-01   +4.647626990595071e-01   +9.051122019627641e-01   +9.533941892578112e-01   +7.682701867098759e-01   +3.571806980379540e-01; +3.811593114442595e-01   +2.209981713402267e-02   +9.116513734830181e-01   +2.881193826510574e-01   +6.833796190026820e-01   +1.959563524741368e-02   +8.971078537146248e-01   +6.611855558993546e-01; +3.041514914022435e-01   +3.309083447982391e-01   +4.853825826243072e-01   +2.746815161811957e-01   +8.449377132723969e-01   +4.989058535980878e-01   +7.925474976893608e-01   +5.918606903563525e-01; +1.570071380236608e-01   +4.896475694531744e-01   +5.901142705283755e-01   +1.448553868057491e-01   +9.613947053478324e-02   +3.346606182288036e-01   +9.497218618896420e-01   +5.269865956046109e-02; +7.735871568940215e-01   +2.622800550380652e-01   +9.539423163492424e-01   +1.466771596369055e-01   +7.377434014355388e-01   +6.690871635047195e-01   +5.370335674165425e-01   +2.106411655489691e-01; +7.113202571432201e-01   +5.281480930296939e-01   +8.023009586802889e-02   +2.665153739156845e-01   +5.471349178045731e-01   +1.655855679787973e-01   +1.625633444557456e-01   +6.022946762838064e-01; +1.718814289619579e-01   +4.147906662080974e-01   +2.217639375560093e-01   +6.066694737533398e-01   +2.547528264128457e-01   +2.248570543301129e-01   +1.363131211912472e-01   +2.695464598322401e-01; +4.518149997347646e-01   +1.649713503258876e-04   +1.598842392207405e-01   +1.033795475619964e-01   +7.155711689451074e-01   +1.144081208957841e-01   +2.693936913195940e-02   +1.125514519036518e-01; +8.388711415419970e-01   +8.922582757826444e-01   +3.931458350654685e-01   +4.876635779656253e-01   +3.607304526412592e-01   +9.886238603788373e-01   +6.849018567850466e-01   +2.179610940442902e-01; +7.034441279489078e-01   +2.398844293694481e-01   +1.842842612045646e-01   +8.982459442039670e-01   +8.457410633700384e-01   +1.397441724403422e-01   +5.860591398056348e-01   +8.785023066178046e-01; +7.654937183175735e-01   +7.993591342261368e-01   +7.619766363006798e-01   +1.893721282151706e-01   +8.196213795863214e-01   +7.666749698401816e-01   +2.945151768645738e-01   +4.614083765926535e-01; +9.791184739919635e-01   +5.816482731830529e-01   +2.299744194103859e-01   +5.395932217860195e-02   +6.160273321277729e-01   +6.281421391751290e-01   +7.476630381589822e-02   +7.314796902059207e-01];
L2I_L3I_iGABA_netcon = [+5.902739779616305e-01   +1.437337126494362e-01   +3.471544409486859e-01   +3.725505684169317e-01   +5.965571863202628e-01   +5.112882510755182e-01   +7.723409879340292e-01   +2.674310699487612e-01; +8.409341305675144e-01   +9.930090193753972e-01   +4.474880934273651e-02   +5.343490946076992e-01   +4.754624864964204e-01   +2.415269722724970e-01   +1.794265553430674e-01   +5.934595328004316e-01; +6.091180189117484e-01   +4.832921484000888e-01   +9.485516121629491e-01   +9.735285616479815e-01   +3.810271607316035e-01   +2.728097468318704e-01   +4.514111790996025e-01   +6.828493172315755e-01; +7.451576702053374e-01   +4.074652747245248e-02   +8.609383367437922e-01   +9.968931417864751e-01   +9.802968814986985e-01   +4.105997664598224e-01   +3.031389050902210e-01   +4.164258206593170e-01; +8.500421732198424e-01   +2.683304000309952e-01   +1.371030054142212e-01   +4.122777412058998e-01   +1.402921270188411e-01   +2.621555630642693e-01   +3.860437196087932e-01   +5.121600661213196e-01; +1.455074165091870e-01   +6.689927806989486e-01   +5.881703844219033e-01   +4.454324405179890e-01   +2.728595455909119e-01   +8.530297476010723e-01   +7.971305677534521e-01   +8.155596489805580e-01; +7.385439689273321e-01   +1.457272178926078e-01   +6.534054538478822e-02   +2.449062911317946e-01   +2.257354336848315e-01   +4.806324845196080e-01   +7.794418990877546e-01   +5.399640170645190e-01; +1.916531862505299e-02   +7.739941931925596e-01   +9.511419229580638e-01   +5.983899921601737e-01   +7.942991473393737e-01   +3.391859475218840e-01   +6.486432607344097e-01   +5.897774992353585e-01; +2.289880727737324e-01   +2.648546048496774e-01   +4.976425118633617e-01   +7.696397312572738e-02   +8.218990412488020e-01   +6.363568817181320e-01   +2.427915568837898e-01   +5.388726091475413e-01; +5.358589652252690e-01   +8.828233809124484e-01   +2.752615934794249e-02   +9.075353629673452e-01   +7.986207447610640e-01   +4.142823501966081e-01   +6.043846390313797e-01   +5.409696812099756e-01; +7.153588292315048e-01   +3.635766018246513e-01   +5.197117637073633e-02   +4.779860410850721e-01   +1.145349054526703e-01   +5.461422420461765e-01   +4.191543134212208e-01   +1.552716481380651e-01; +4.339297590547642e-01   +1.433900560856141e-02   +3.013490217775112e-01   +5.056916244694870e-01   +6.382858304093316e-01   +3.392366472082281e-01   +2.977825237226576e-01   +6.973107938097353e-01];
L3I_L3E_iAMPA_netcon = [+6.103722303787383e-02   +7.761623174822767e-01   +5.527887812487952e-01   +5.718575568409934e-01   +9.141111860091985e-01   +8.303910476618050e-01   +8.459665771927380e-01   +8.605745793072173e-01   +5.272484913587543e-01   +9.929617185044114e-01   +4.825918383542221e-01   +3.485270118955001e-01; +9.248945984820452e-01   +8.354597379847660e-01   +8.474345154450414e-01   +9.350257624281711e-01   +5.916917350219191e-01   +4.010180459286020e-01   +6.301357799919719e-01   +8.548918181114969e-01   +5.643598207052921e-01   +7.019253717554115e-01   +7.417161195175277e-01   +3.949058971360016e-01; +1.840655672399551e-01   +5.923989366405027e-01   +9.694584998670315e-01   +7.814112013186509e-01   +5.748540284893721e-01   +6.982111474752944e-02   +4.423030690654514e-01   +9.502829417104847e-01   +9.833518596131841e-01   +8.416943364455308e-01   +5.929847840993615e-01   +9.879870140633631e-01; +5.418034234608082e-01   +7.624808193679634e-01   +4.637931232104366e-01   +5.963483772708451e-01   +6.526872552433207e-01   +3.769809044293473e-01   +2.311273271886923e-01   +6.983265902780401e-01   +9.622977989824073e-01   +7.336531368330841e-01   +2.547061820861292e-01   +2.923377100089629e-01; +3.996544233219562e-01   +6.644156983177278e-01   +7.691179578138114e-01   +6.372928044771080e-02   +4.276825970340388e-01   +8.570535554851741e-01   +5.200233181610162e-02   +3.573797800978079e-01   +5.575897822609265e-01   +9.959021561651051e-01   +6.112342882178640e-01   +2.298173603738718e-01; +9.221102448812036e-03   +5.857442629869438e-01   +2.567930532490551e-02   +5.392999944480019e-01   +9.397954278610106e-01   +2.531760055598202e-02   +7.029933150100012e-01   +3.757600491034031e-01   +5.239082752461962e-01   +5.073486186082417e-01   +2.316429251839240e-01   +3.260822261283658e-01; +1.064672680725579e-01   +2.503610759084886e-02   +6.743115390595130e-01   +8.601812461649189e-01   +1.005264083131623e-01   +4.219115626077822e-01   +8.492847262725461e-01   +8.476996953499201e-01   +4.723878597864489e-01   +1.924042910714501e-01   +1.964225690189421e-01   +1.668985061651990e-01; +8.516204572985504e-01   +6.846386416536637e-01   +8.424031907564365e-01   +3.387706820079485e-01   +4.080498163961260e-01   +2.523650042423092e-01   +4.066873956305799e-01   +3.861388651322427e-01   +9.009168803402163e-01   +9.533548617993862e-01   +1.176084629687559e-03   +3.784323123549857e-01; +3.338397864786792e-01   +3.253201771633648e-01   +6.913467235314815e-01   +1.785365925429007e-01   +8.919677920738263e-01   +7.080551896376595e-02   +2.905080205704997e-01   +7.736277181699827e-01   +4.800590854564862e-01   +4.529015382827681e-01   +6.517368264719440e-01   +5.290984491739683e-01; +1.463360686525331e-01   +8.057744750592363e-02   +8.991151966277067e-01   +8.776213798033041e-01   +7.359910430234156e-01   +9.144024583812140e-01   +2.584962451235649e-01   +7.776761349086284e-01   +4.888261920479629e-01   +6.053792258948838e-01   +4.000362272094865e-01   +5.950236765473256e-01; +8.008015579042005e-01   +7.438195423187851e-01   +9.587624714421709e-02   +8.426230372825468e-01   +9.580150136957108e-01   +2.659630494892901e-01   +5.111158203240687e-01   +4.299399129523566e-01   +3.126331640033266e-01   +6.439630834540010e-01   +2.712937074007520e-01   +1.707242771842234e-01; +6.518132482586554e-01   +9.665403782323063e-01   +7.928107539969868e-02   +8.285458970344541e-01   +9.752778012194556e-01   +1.073803471349206e-01   +1.176946602960522e-01   +4.844033891330566e-01   +8.515483731317206e-01   +7.617828461089357e-01   +2.744796787028940e-03   +6.790983997948986e-02];
L3E_L3I_iGABA_netcon = [+4.438713870825902e-01   +6.582592720823498e-02   +6.342547432252535e-03   +4.933906345074474e-01   +5.444542022182837e-01   +2.522317445114052e-01   +7.194231252700621e-01   +7.605384274114663e-01   +3.773344833197740e-01   +4.483988513262863e-01   +2.000348110639498e-01   +6.539956562879216e-01; +5.927277787748689e-02   +8.067666365509059e-01   +1.317042315748481e-01   +1.904636912267168e-01   +2.183552679371639e-01   +3.338751785237227e-01   +2.255410393342795e-01   +8.909694440160237e-01   +6.094448063390783e-01   +3.951379636728221e-01   +8.272051572066842e-01   +9.068135500505103e-01; +6.253181401544035e-01   +9.123470657553494e-01   +3.100138988703252e-01   +6.454451925154744e-01   +2.674746600574803e-01   +6.010725840345414e-01   +4.987862229423598e-01   +7.341910956026884e-01   +1.668861365669699e-01   +6.745240217969997e-01   +4.398050827697006e-01   +8.362718221818871e-01; +8.051733230456862e-01   +4.257624194702229e-01   +2.365775585115102e-01   +2.571648989864880e-01   +1.349375957345914e-01   +4.821157392169206e-01   +4.758704085023643e-01   +6.927440774832482e-01   +1.016811736854759e-01   +3.440971406006305e-02   +4.203033053504738e-02   +1.706514100178242e-01; +4.050730434338283e-01   +1.920834437612886e-01   +6.513111866539090e-01   +9.422111247697694e-01   +1.671955921889117e-02   +8.978564001274532e-01   +4.303900162228579e-01   +6.420553029146299e-01   +6.198644160271856e-01   +7.830931224374522e-01   +7.661170326330831e-01   +1.624542802812323e-01; +8.840176021852647e-01   +1.851666198758379e-01   +8.093945423798397e-01   +2.930319856551226e-01   +1.110640202499433e-02   +2.898936117730803e-01   +5.551562754489133e-01   +6.160765832348598e-01   +9.610793175550704e-01   +3.723171155972279e-01   +9.331530471748888e-02   +1.361788782028420e-01; +7.195901061569115e-01   +6.718852132293021e-01   +7.392531046232239e-01   +1.422968970056382e-01   +9.835483147459548e-01   +7.497290420865188e-02   +2.074020654853293e-01   +7.577886247079484e-02   +6.697337258508663e-01   +6.398085273528598e-01   +6.567170861358578e-01   +1.575915854478308e-01; +1.992185252506456e-01   +5.269443985381508e-01   +1.218507978083894e-01   +8.647440682280647e-01   +6.478778212378568e-01   +3.880184262201046e-01   +2.769523991176254e-01   +5.492640360142911e-01   +4.711458256347926e-01   +4.970789069306045e-01   +2.661576334563147e-01   +3.983424236404604e-01; +3.733266785725380e-01   +7.746935042707095e-01   +1.746065608827390e-01   +8.831764839398277e-01   +8.145427055650042e-01   +1.909667106255926e-01   +8.084496431873479e-01   +8.777202802900225e-01   +3.369683052017463e-01   +2.194010012597333e-01   +4.356801451504562e-01   +6.621890837699451e-01; +2.063923154107078e-01   +3.034140978810564e-01   +2.689435750565297e-01   +6.621764019140884e-01   +2.802255255843260e-01   +7.287596624620870e-01   +9.880133560849488e-02   +9.873970691020432e-01   +5.885248590362827e-01   +2.133032218481609e-01   +8.510657209097148e-01   +2.230801420691309e-01; +2.632649657861653e-01   +4.746950233980846e-01   +8.140065821125354e-01   +9.982602563790759e-01   +1.372173573850368e-02   +4.229960725323049e-01   +3.615696557159737e-02   +7.111855887011014e-02   +5.428718354368408e-01   +4.532547665521727e-01   +9.063180802985763e-01   +6.431378068739745e-01; +9.906962943066456e-01   +7.113342664385081e-01   +5.936681824744554e-01   +2.656975676376355e-01   +1.009900496789504e-01   +2.704345858969114e-01   +7.098482691449039e-02   +2.808003992478475e-02   +3.953720200482221e-02   +6.320938429177591e-01   +2.847471111010165e-01   +6.112275815085277e-01];
L2E_Input1_iAMPA_netcon = [+9.999901665339347e-01   +9.916195143676715e-01   +9.959646427660380e-01   +9.925160174082103e-01   +9.899717594579771e-01   +9.990659425093504e-01   +9.869516321636819e-01   +9.992029106011420e-01];
L2I_Input2_iAMPA_netcon = [+9.966423753486706e-01   +9.990344317549692e-01   +9.901331803773525e-01   +9.891324900967322e-01   +9.891608255509176e-01   +9.903067425623829e-01   +9.919892893136281e-01   +9.949288959843131e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
