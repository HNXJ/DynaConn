function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.451957175407410e-01   +3.048346118412688e-01   -2.548965295287644e-01   +2.422237602999944e-01   -1.680076871047069e-01   -5.092102439142931e-02   +2.075758111185103e-01   +2.775029614832657e-01   +1.448820394457057e-01   -2.020041575852558e-01   -3.531358477262048e-01   +6.168401878961721e-02   -9.881425322488921e-02   -5.154042712492363e-02   +1.406320411939959e-01   +1.001911621399666e-01; +2.254258874588614e-01   -9.162263608143650e-02   -8.344910476462859e-02   +2.519238022860978e-01   +9.829865590821758e-02   +2.365271556395276e-01   -1.630081378879628e-02   +1.309451560775914e-01   +3.321365246747754e-01   +7.771816026965916e-03   +3.368227341508229e-01   +4.482125607262766e-01   -5.903255449889139e-02   +1.330830466118338e-02   -4.130787066548477e-01   +2.030532216278675e-01; -1.948776700302066e-02   -2.111937971166215e-01   -3.716257950451310e-01   +5.276330080214968e-01   -4.496760356165413e-01   -1.970009153518064e-01   +3.928893278237115e-01   +2.890779691775934e-01   -3.193989383992006e-01   +2.318762033988697e-01   +2.422706062906669e-01   -2.677999448300404e-01   +1.006957376686765e-01   +9.768964616487641e-02   +1.522239791455119e-01   +7.420463676690411e-02; +6.486673119072491e-02   +1.486971262943962e-01   +9.668726461383503e-03   -1.393890284437808e-01   -2.082555062303925e-01   -3.431544759735769e-01   +8.543474503896417e-02   +1.737011572025893e-01   +9.855337103355238e-02   -5.745030577510282e-01   +1.510849059453079e-02   +5.160329380901890e-02   -4.017491213509957e-01   +4.668338973544588e-01   +9.564830486796817e-02   -7.163839960397761e-02; -9.263910005588272e-02   -8.442437771783620e-03   +1.336140973737259e-01   -5.264978652344693e-01   -3.126949566947140e-01   -3.505333930560656e-01   +2.028738217762629e-01   -6.623829700424713e-02   -1.709146040903878e-01   +1.176041281056589e-02   +1.081941861193929e-01   +7.128404692427771e-01   +3.645979579596317e-01   +4.073050832414228e-01   +3.415151371632743e-02   -3.351985684129621e-01; -6.625300054188103e-02   +3.313548711977973e-02   -3.749871642537655e-02   -8.397515757221341e-02   +4.420852148802523e-01   +3.629977666430358e-01   -3.639734456028482e-01   +7.107366169124238e-02   -5.481320550767521e-02   -2.281359256624312e-01   +3.060827444844756e-01   +2.051390586887598e-01   -4.230913402358213e-01   +1.630430030608446e-01   -4.735747787470199e-01   -4.009822730216956e-01; +1.101439515295979e-01   +1.212500795701258e-01   -9.980009665926234e-02   +2.223733307893712e-02   +1.725498229816722e-01   +2.978525508883494e-01   -2.479747204636546e-01   +1.556891012404103e-01   -3.885500639602321e-01   -3.024493332308390e-01   +2.263387555942360e-01   -1.882992599927710e-01   +2.741583821820601e-01   +1.540608713852543e-02   -9.811187927663637e-02   +3.074366098161026e-01; -1.084244351664790e-01   -3.781815243414430e-02   -1.763277996716872e-01   +4.070649430136376e-01   +3.203953810461372e-01   +1.788658228629847e-02   -4.153121334602583e-01   +1.415973971441271e-01   -9.576583341663904e-02   +5.675819656580344e-03   -2.315983502297081e-01   -2.359754803396857e-02   +2.030381243681036e-01   -5.360202823039418e-01   -2.835944039297114e-02   +4.362994956623836e-01; +2.694392409629447e-02   +1.926299733123516e-01   +2.018742630546316e-02   -4.731213093674930e-02   -1.122460937562739e-01   +2.140914925159945e-01   -5.176092433088786e-02   -7.605298087852495e-02   -4.909397554845403e-01   -2.674626679132096e-01   +1.939105895698159e-01   +7.083198292018231e-02   +2.013185864734594e-01   -4.746969443028349e-01   -3.419686774216572e-01   -5.229025796068313e-01; +1.657921438849258e-01   +4.329555671403684e-01   +1.530437649542610e-01   +2.062056544627733e-01   -5.524510006509156e-01   -6.122799298818131e-01   +1.256923701334934e-01   +1.418099117674541e-01   -7.493655987001774e-02   -4.070994418132581e-01   +2.085016874032088e-01   -1.117577686538821e-01   -2.315680977338686e-01   +4.055993089333244e-01   -1.353486168402869e-01   -1.504969152983428e-01; +2.939742161774921e-01   +1.587456449453075e-01   -2.605934174421028e-01   -3.561026779401535e-01   -2.540678940991192e-01   -7.330391356492363e-02   -1.111634326219222e-01   -2.390393206038920e-01   +2.060373984109964e-01   -3.627352139027269e-01   +4.918780380993787e-02   -7.099875419579668e-02   -4.347208858921325e-02   -3.536598539496683e-01   -3.558203029686316e-01   -1.857953235630311e-01; +8.889029518515829e-02   -1.936228852623937e-01   +3.190006219334389e-01   +9.450283842287092e-02   -2.406230212563150e-01   +2.079554475459532e-01   -3.202455820636283e-01   -5.853393068301530e-01   +3.370705072547336e-01   +2.067234539497281e-01   -4.447219247684488e-02   -4.497857701363530e-01   -1.668608011055461e-01   +1.321395510176095e-01   -2.981385572876882e-02   -1.973580310365649e-01; +8.764914200994185e-02   +1.406601182422637e-01   -1.809149993801418e-01   -4.924372889317674e-02   +3.543973797465266e-02   -1.412703704629898e-01   +1.705318919728877e-01   +1.192933548004963e-01   -8.755816945385961e-02   +4.539871636586029e-01   +1.337423396103332e-01   -4.890805826623230e-01   +1.905927005299426e-01   +3.244699617198248e-01   -4.327788407127831e-02   -3.025663664152816e-01; -2.313323554757643e-01   +8.898794593265284e-02   +5.245465981011771e-02   -1.501682663755791e-01   +2.660878265413629e-01   -2.392101580347250e-01   -3.542706919671247e-01   -2.518728639253018e-01   -1.623024910544385e-01   +1.640552601301803e-03   +2.192137636710888e-01   -1.153408653946251e-01   -8.556114437214876e-02   +4.617476445903635e-01   -3.644100496180649e-01   +1.379181730349904e-02; +1.746592394121904e-01   +2.786785082664112e-01   -1.276431590531370e-01   +4.822693625045228e-01   -2.822955390980595e-01   -3.151892268439161e-01   +2.602547014634488e-02   +6.287737760901541e-02   +3.372118093260791e-01   -1.296469405535370e-01   +3.672971653387976e-01   +8.494052953684350e-02   -5.565763183498060e-01   -2.831692673668889e-01   +1.177236210284521e-01   +9.114935975491258e-02; +4.711975715531793e-01   +5.544185038762058e-02   +3.800710309061905e-01   +4.030744668928540e-01   -1.817145933325974e-01   -4.372702037440576e-02   -4.318870002968215e-01   -6.214042112921832e-01   +1.022864486893221e-02   -3.580063360679857e-01   -1.430976116342116e-01   +6.136512715704305e-02   +4.215433331322213e-01   +4.628666715704876e-02   +4.895338111622383e-01   -2.348130383265298e-01];
L1E_L1I_iGABA_netcon = [+1.225197025172892e-01   -2.793868698364417e-01   -1.899888950487806e-01   -3.215294687621080e-01   +1.745391161751139e-01   -4.414705896809710e-01   +2.902496475994958e-01   -9.689215884987373e-02   +2.720775333604785e-01   +4.088853335774571e-02   -2.278464925826397e-01   -3.483821036188289e-01   -3.987780980705540e-01   -3.747837345965387e-01   +2.709364620591570e-01   -2.558209726345032e-01; +5.417235372202914e-02   -1.435611872335450e-01   -6.550849693940190e-02   +1.193454127393328e-01   +1.328074207366752e-01   -4.822937973799915e-03   +1.607026226844162e-01   +2.566759525784208e-01   -1.442843779178818e-01   +2.374067491575109e-01   +1.267701243480803e-01   +1.354087627472537e-01   -2.193854579484186e-01   -5.282268301084574e-01   -5.743815936730233e-01   -5.775989511117879e-03; -5.916384001612276e-02   +3.645637492839546e-01   +2.241610025407040e-01   +3.059930540795610e-01   -2.576141905503808e-02   +7.760891088334498e-04   -4.347842565050450e-01   +1.430764432747050e-01   -2.668623591076677e-01   +1.000200952392102e-01   +1.417938870890792e-02   +2.087728314093146e-01   -1.198663998000986e-01   -9.811074913609708e-02   +1.219832822085996e-01   +5.159586334957140e-01; +7.656705896316440e-02   +2.451447120477785e-01   -3.531865907699959e-01   +3.591650315320051e-01   -1.791107703331264e-01   -1.039573789204451e-01   -7.373585102498652e-02   -1.320152521798436e-01   -1.697311257716805e-02   -2.886954982863441e-01   -1.386008008797792e-01   +4.010676818712068e-01   +2.100995833612565e-01   +2.171486519336895e-01   +1.707448235061166e-01   +1.417489714915301e-01; +2.453872497225995e-01   -2.179913183458670e-01   -1.014026625666187e-02   +2.528337687874554e-01   +2.202892503438023e-01   +1.044976727682831e-01   +4.858991884652251e-02   -1.484787858786101e-01   -1.107198618942108e-02   -1.501751304737468e-02   -2.847583762266831e-01   -5.424234073692197e-02   +1.040912243900370e-02   +3.258615080954208e-01   -9.908672302697830e-02   -2.264340768016063e-02; +1.339501683588777e-01   +4.235745077350935e-01   +1.070139359003035e-01   +3.230340773566709e-01   -2.230380941093738e-01   -1.497302469075248e-01   -2.741783557511688e-01   +1.992929734271369e-01   -3.313155165773823e-01   -1.280180878129072e-02   +4.451090189531282e-02   -2.300399905303331e-01   +1.561050850934460e-01   +1.458890304763932e-02   -2.549770866550140e-02   -3.389708875318032e-01; +8.413292578560362e-02   -2.853964637523209e-01   -3.585976834428672e-02   +3.425571113427978e-01   -3.465708265274839e-01   +2.142835201734027e-01   -4.062026328935573e-01   -1.122593541664120e-01   +2.613353194211496e-02   +2.091050593890965e-01   +2.062244010115065e-01   -2.232696732806450e-02   +4.256358918098581e-01   +2.146260808497156e-01   -4.317213762108184e-01   -1.760140214396068e-01; -5.302620081053563e-01   -1.738681948048144e-01   +2.569776640116209e-01   +1.699464424372548e-01   +2.029651408558174e-01   +1.930229619110059e-02   -3.265527575836262e-01   -2.988114845605525e-01   +2.284052044343576e-01   -1.899868328700256e-01   +2.413604102072726e-01   +9.686899978734453e-03   +1.638182555300556e-01   -1.171140043311082e-01   +3.984032951344027e-02   +2.042226614828361e-01; -1.888451202724068e-01   +1.714245303620968e-01   +5.059604648207483e-03   -2.123257533364074e-01   +1.217939498163191e-01   -2.187142837161336e-01   +2.058168705770431e-02   +3.314918388171981e-01   +4.926818294719720e-02   -1.881179712878253e-01   +1.536613614253067e-01   -1.453272239067110e-01   +3.174117308759132e-01   -8.398456319946560e-02   +9.680930633341470e-02   -3.590707843752506e-01; -2.640794077098775e-01   -8.084756187133414e-02   +2.896469280937676e-02   +2.727181441303667e-01   -2.961516369787143e-04   -2.467301796114197e-01   +6.370261244943762e-02   -6.248326325927739e-02   -4.491234927834277e-02   +2.070217443461978e-01   -5.413360875876136e-02   +2.764244906345988e-01   -3.769890001153413e-01   -3.399474560116567e-01   +1.372321754897563e-01   +1.737040331167680e-01; -5.477487051544558e-02   +9.555375502327870e-02   +5.277489289574075e-02   +1.063968554115997e-01   -7.511674220564216e-02   -1.091550444418068e-01   -2.390547291308337e-01   +3.895342209205507e-01   +9.139338132779470e-02   -2.452280172926232e-01   +1.776381837472152e-02   +1.478695216258443e-01   -3.468742833704659e-01   -1.108418472180339e-01   -7.243019377014506e-02   +1.484146863609050e-01; +4.016525784216253e-01   -3.639876340069829e-01   +2.151241941503129e-02   +1.183590902659863e-01   +4.431543057608601e-01   +2.637108285359466e-01   +2.758516582812741e-01   +1.450237863013404e-01   +1.025187264305880e-01   +1.704956295459108e-01   +1.798996820742195e-01   +1.758081234330602e-01   -1.932984652357802e-01   -1.303962026139424e-01   -5.648396721230330e-01   -2.047079737846976e-01; +1.768964790870581e-01   -1.439850074464901e-01   -2.353446141567595e-01   +2.100614638778396e-01   +2.872900237543508e-01   -1.930741771903985e-01   +2.230363989746873e-01   +1.104962113561978e-01   -1.200469918753145e-01   -2.665191473725209e-01   +8.889634311457884e-02   +2.937988844252934e-01   +2.098371116339709e-02   +5.652799654244832e-03   -9.001830185400321e-02   +3.891969308849906e-01; +6.432143553915055e-02   -1.573128613202503e-01   -2.987553248977796e-01   +3.872077847907353e-01   +1.530001631234775e-01   +4.413992322225999e-01   -4.368776722899015e-01   +2.381962092441953e-01   -1.370528052356591e-01   +3.137762159839571e-01   -2.826360809297949e-01   +1.878144936716347e-02   +2.508222944064836e-02   -4.053537778994037e-01   -1.708924398411491e-01   -7.630390802220932e-02; +1.547457271796229e-01   -3.215262245689307e-01   +4.003947133048603e-01   -2.512412903843491e-01   -2.261435965647651e-02   +3.023560762896449e-02   +5.824725566520406e-01   -4.963248394896669e-01   +3.448910960365171e-01   -1.165836864691136e-01   -3.363606267842669e-01   +3.417643193721834e-01   +1.494034975425472e-01   -1.784637607354083e-01   -1.319715345291736e-01   +1.315811492559811e-01; -1.275038783712374e-01   +4.852346412901276e-03   -5.842165497778440e-03   -2.112957198364394e-01   +1.886692539257664e-01   +2.179964781198215e-01   +1.000961352882671e-01   -3.697717583052131e-01   -2.009287402491766e-01   +1.938111047132897e-01   +4.808219461535920e-01   -3.383602495072280e-01   +9.341805013268939e-02   +1.925594400547273e-01   +1.067576015702362e-01   -7.748540531933626e-02];
L2I_L1I_iGABA_netcon = [+6.706612353430423e-01   -1.592948124323808e-01   -8.179997248447327e-02   -1.437269031468538e-02   -3.362434269655107e-01   -3.447541818632328e-01   +2.803278835226428e-01   +5.926330025547383e-02; -7.063853615420135e-02   +4.488158486308014e-02   -4.786722148293767e-01   -3.633991463686541e-01   -1.738438385997139e-01   +2.809055391895792e-01   +3.755389069756151e-01   +1.548120012429170e-02; -4.859701187795272e-01   +4.526837982670803e-01   -7.281170281901085e-02   -2.539275146171152e-01   -4.022536055408518e-01   +1.072818286890626e-01   -1.154168408411365e-01   +2.649457748667499e-01; +2.825025565310884e-01   -4.012516755412511e-01   -2.986115365577875e-01   +3.226604343651382e-02   -1.186582282030919e-02   +1.905393241651142e-01   +4.486884325941361e-02   -2.574847043652463e-02; +1.053640677671082e-01   +3.189703183180542e-01   -2.912639979920545e-01   +1.345858265422341e-01   -4.090510139028624e-01   -9.109408792616835e-02   +3.342367575015361e-01   +3.290459132720871e-01; +1.391152535309379e-01   -7.185493316506705e-02   +2.470321432046274e-01   -9.394360273878793e-02   +3.640655008717676e-01   -2.655021330328527e-02   +4.742712170080559e-01   -1.441258743065001e-01; -1.137076615603927e-01   -3.601803453542927e-01   +2.272324273737464e-01   -1.540580150882914e-01   +1.431582527676193e-01   -2.316794101320124e-01   +6.627842775143118e-02   +3.853596242382805e-01; -1.420836337019390e-01   +2.613806715173916e-01   -3.428168229377310e-01   -3.089603820679162e-01   -1.265782683640919e-01   +3.402661616492548e-01   -1.719212251041754e-01   +7.256995023643495e-02; -1.945728353697153e-01   -1.749178193670443e-01   +4.167022351490835e-01   +3.970098630916650e-01   -1.837746725606800e-01   +1.862638238479032e-01   +1.044714457907417e-01   +1.888253339679776e-01; -5.425017190501823e-02   +3.617145297309747e-01   +2.283442237269450e-01   +2.632547925286721e-05   -1.882280035720096e-01   -1.124645436516256e-01   -4.575444442080749e-01   +2.315682158056945e-01; -4.415172262219645e-01   +1.032369780001600e-02   +2.437362653663762e-01   +2.481548522167245e-01   -2.748970420043271e-01   -3.495500653858793e-01   -2.010324791614321e-01   -3.788966832046697e-01; +2.906704539202714e-01   +3.106101579968579e-01   -1.082177305140235e-01   +7.003483718745017e-03   -1.674734790395979e-01   -1.688482352783578e-01   -2.392852520619690e-01   -6.815578567799416e-02; -1.904686313448655e-01   +1.301753784282836e-01   +2.014037016799856e-01   -3.006176093072306e-01   +3.461148725652841e-02   -1.778367008136913e-01   +5.928150892809199e-02   -9.796899303810419e-02; +3.141308067112916e-01   -1.212365039155368e-01   -3.429902097264318e-01   -1.725034648823540e-01   -3.414947975296415e-01   -6.130336142552848e-01   +2.853124917661954e-01   +1.815142929944577e-02; +4.196231467967106e-02   +1.770077614668319e-01   -1.879972101662374e-01   +3.229908916553022e-01   +2.858747744345941e-01   -8.527253843441134e-02   -4.091570749066042e-02   +4.660923388117250e-01; -2.918691898847557e-01   +1.790403931168714e-01   -1.271240237868447e-01   -1.285577340233035e-01   +1.067235525773862e-01   -4.312665021238504e-03   +5.210762480388116e-02   +3.310580382350536e-01];
L1I_L2I_iGABA_netcon = [+7.710425652956310e-02   -2.631515753848430e-01   -1.713327515573489e-01   -1.406719963083619e-01   +2.226689617029894e-01   +3.473473215368483e-02   -1.669668110609795e-01   -2.543777565591180e-01   -4.054124022679617e-02   +1.394966293610113e-01   +9.267502889140231e-02   -3.043566489155498e-01   +4.145015464387801e-03   -2.538051630124341e-01   -5.776691428646152e-01   +4.242219516375416e-02; +2.441417223116463e-01   +1.209095630573388e-01   +2.238111840916508e-01   +7.502721408679594e-02   -2.867369637264902e-02   -1.890828172165330e-01   -1.756162296832391e-01   -1.932934715068318e-02   +9.381491951892554e-02   +2.281783593841318e-01   +2.285992047501893e-01   +1.415859219307013e-01   +1.040500505311949e-01   +3.641933679359419e-01   +1.942973052406513e-02   -2.377770899634213e-01; -5.159776436126986e-01   +3.431547520470286e-01   +3.536979945509028e-01   +4.123576537213402e-01   +7.892702040704526e-02   -2.088291344944793e-02   +1.312906434315034e-01   +2.085170471088841e-01   +2.120514684645119e-01   -1.672027445484824e-02   -4.101225680952982e-01   -2.763575116641221e-01   +1.017523030161247e-01   -5.992918508447134e-01   -4.242146464522868e-01   +1.488082604393329e-01; +2.209309447538427e-02   -2.019241240344487e-01   -3.165875708113708e-01   -3.303802762274629e-01   +1.835317902937730e-01   +2.804077237147277e-02   -1.132453179881027e-01   +2.757685431845646e-01   -1.008358445564055e-01   -3.943351823235798e-02   +1.270165280933424e-01   -2.848286422393410e-01   -7.972934945353977e-02   +1.058962518263959e-01   +3.449220709450778e-01   +5.052651912794109e-02; +1.496264228611641e-01   +5.039899483699980e-01   -3.610345156552654e-02   +3.574504620412935e-01   +3.022411977161515e-01   -2.230316555000592e-01   -2.213030997084919e-01   +2.233309096056628e-01   +1.041419729741950e-01   +4.388308455833378e-03   -4.224275161611944e-01   -1.140003127673840e-01   -1.978310997326042e-01   +2.829516827672093e-01   +5.251002510718235e-01   +5.166994036928257e-02; -4.287942882926765e-01   +4.006480015919934e-01   -8.943451384065920e-02   +3.237796500463758e-01   +1.781514643094453e-01   +2.584761960738841e-01   -8.982597047702625e-03   +2.990562035897087e-01   +1.454840772579494e-01   -1.705389452071170e-01   +5.840449645098904e-01   +8.337340929134740e-02   -1.890331509914314e-01   +8.664834681247913e-02   +4.589192254100587e-01   -7.717719355610211e-02; +2.115729600195252e-01   +2.521666624920498e-01   +2.427518133974770e-02   -2.845079987557556e-01   +3.637092425728292e-01   +8.065941464859452e-02   +3.848532922093589e-02   +9.084372397749423e-02   +2.769375965867706e-01   -1.152120597040729e-03   +4.886166960047034e-02   +1.530519647800339e-01   +1.703113808637269e-01   -4.151508099176153e-01   -7.488826425092540e-02   -1.695737011408380e-01; -2.457895000705299e-01   -6.816667698679349e-03   -2.790118975461854e-01   +8.914605889250285e-02   -1.866809590499247e-01   +8.346665118914839e-02   +5.343212175971320e-01   +3.088223336229837e-01   -2.208975640033175e-01   +1.055882176964150e-01   +1.539293485863995e-01   -1.827254905255639e-01   -2.684338154541324e-01   +6.710386260811785e-01   -2.227390345020341e-01   +8.353521014119583e-02];
L2E_L1E_iAMPA_netcon = [+2.762503028907678e-01   -8.158773799512668e-02   +4.616194644143935e-02   +1.880534901965087e-01   +3.082718846431212e-01   +1.597006383151177e-01   -4.850356490820126e-02   -2.369520218421206e-01; +1.105104476164295e-01   -1.780743163223736e-01   -1.430585468677542e-01   -2.502943625571711e-01   -4.255420568227512e-02   +1.710357503006157e-01   -4.503069520151242e-01   +1.072453165472168e-01; +1.969807145547298e-01   -1.500870045496221e-01   -1.224958916530920e-01   -2.322786024901398e-02   +4.299572515063299e-02   -2.641258594922958e-01   +1.248579104853500e-01   +1.129346474646026e-01; -1.983627265132719e-01   -2.460202111435384e-01   +4.531279899371403e-02   -5.082651271526589e-02   -2.643043715307384e-01   +2.957342922883918e-02   +9.422144133912627e-02   +3.755217444011795e-01; +3.914901770038429e-01   -3.873383161342124e-01   +2.603935236595066e-01   +1.581508898094441e-01   +3.396075094860955e-01   -1.714860660352604e-01   +1.137476794762890e-01   -8.792794595439532e-02; -4.974369254177951e-01   -3.849234076049623e-02   -2.066625576538469e-01   +1.588024190982658e-01   -2.533760120175469e-01   -3.442737955442476e-01   -6.937091336427061e-02   -1.055916626691293e-01; +1.373687604811000e-01   +1.887460668282935e-01   -4.633703776833683e-01   +5.811382327325541e-02   -2.844545054426378e-01   -1.575506117003981e-01   -1.250186875194327e-01   -2.323124572075693e-01; -3.786746885293962e-01   -2.965876648014902e-01   +2.008316951470400e-01   -1.992174059201722e-01   -1.538266908569099e-01   -1.731604707647842e-01   +1.008224762066988e-01   -2.316371207048462e-01; +3.431112929878516e-01   -3.604472765398501e-01   -1.273148965261164e-01   -1.419165865477648e-01   +2.510029281913546e-01   -3.553300353208149e-01   -4.756295000761569e-02   +2.514759665187256e-01; +8.289268156540726e-02   +3.804853889443985e-02   -2.041407538503348e-01   -1.030241968274355e-01   +2.408969106284767e-01   +2.595134347745304e-01   +1.773824902578273e-01   +2.771871462789722e-01; -1.261365231944158e-01   -2.803616265012358e-01   +2.086067618107682e-01   -2.445377200278865e-01   +3.675275716448266e-01   +6.953745566898406e-02   -5.409606926756683e-02   -2.019719094945774e-01; +1.574826508345685e-01   +2.764956324299790e-01   +2.766376801455403e-01   -5.028363081596976e-01   -2.944179746289968e-01   +1.976858578386668e-01   -2.826439922758875e-02   -4.204526895605392e-01; +2.267225150838957e-01   -2.864735105865291e-01   -2.517577915787264e-02   +1.534847565514941e-01   -1.715311491119745e-01   -1.232951625398830e-01   +1.796684563068128e-02   -3.023682710043792e-01; +2.960841921241816e-01   -2.275763506991699e-02   +1.186186964505812e-01   +7.482528850511729e-02   +9.639467402225599e-03   +2.752940327078310e-01   -4.203265085305163e-01   +5.954440990265994e-02; -5.060630282222215e-01   +3.202490686280437e-01   -5.460433276252066e-02   +3.651407847503627e-01   +3.218589996761964e-01   -1.314391601598781e-01   -1.506785052290693e-01   +1.497222398552411e-01; +2.538419092717248e-01   -1.721492967355177e-01   -5.061475682569691e-02   -1.953280976364533e-01   -6.150524117424174e-01   -2.452387860106562e-01   +2.686880973886727e-01   +4.458874884959850e-01];
L1E_L2E_iAMPA_netcon = [+4.156477059660088e-02   -4.619671005504411e-01   -1.408944180402560e-01   +2.870494263194603e-01   +2.371267264617646e-01   -2.115931911409050e-01   +1.747950613113920e-01   +5.560006046009123e-01   +2.776630858566453e-01   -5.748828037646218e-02   -4.559350058143334e-02   +5.404938738894621e-02   +3.733419463713981e-01   -1.740880065594984e-01   -8.451117601074287e-02   +7.903649032508495e-02; -1.604950318585181e-01   +2.045698203516643e-01   +9.450996041835447e-02   -2.258089559294057e-01   +1.939379481167737e-01   +9.208198055251920e-02   +1.013406461857234e-01   +1.966628721326560e-01   +9.222994007536869e-02   -1.914666041945977e-01   -5.925421743590130e-01   +2.437401094369048e-01   +2.380253835457276e-01   -2.965731732640291e-01   +6.051141116466158e-02   -6.735080310265128e-02; -2.514209616535768e-01   +5.916229648379417e-02   -3.672670392572188e-01   -3.315219402273886e-01   +2.404596629182021e-01   +4.321163842081140e-01   +1.884479137772933e-01   +3.621117129093385e-01   -6.643018246309346e-02   +3.091841035843479e-01   +1.610995217633367e-01   -5.764328108661246e-03   -1.944746154396226e-01   -2.204191088966327e-01   +3.690802181708650e-01   +1.008448223839579e-01; -2.137213339930768e-01   -3.154477965239291e-02   -2.445194528139487e-01   -2.951177164083477e-01   +1.490404529628557e-01   +2.122143665570731e-01   +2.838286327194751e-01   -7.068840580195800e-02   -3.515034317774597e-01   -5.744184704881691e-02   +1.757821061158085e-02   -3.643891139710447e-01   -1.389261528724649e-01   -4.074869121770069e-01   +1.075286235749789e-03   -2.544491076789144e-01; +3.243647665583645e-01   +7.572281813580800e-02   +3.917068791112077e-01   +1.900398449287906e-01   -2.611541037685929e-01   -3.260059921903812e-01   -6.455694388455030e-03   -2.776916401981466e-03   -2.744974724543129e-01   +1.608949068008344e-01   -3.382375506789679e-01   -2.265860262702145e-01   +1.296334443229041e-01   +1.544394359293800e-01   -1.455455197651349e-01   -1.152364658984019e-01; +8.832616383134392e-02   +4.186497045935675e-01   +1.371278395381753e-01   +2.517600022147024e-01   -4.321008695337002e-01   -1.905173890982867e-01   -3.073738346208226e-01   -4.496931146503730e-01   +3.281138988808859e-02   +2.177579995474523e-01   -2.174424104336843e-01   -3.104617805875689e-01   +8.255157673124415e-02   +4.963287971211511e-03   +7.501339465384453e-02   +6.379263729236649e-02; -2.233957762293568e-01   +2.832990938187181e-01   +5.628391663141582e-01   -2.953839848057899e-01   +3.648484577606574e-01   +3.097375465081323e-01   -4.154053833976420e-01   +1.482828193189112e-02   +1.985181211850551e-01   -2.974014027373051e-01   +7.561654658534345e-02   +6.011701009395289e-01   -1.337710159400837e-01   -9.774377488560415e-03   +2.662783404153063e-01   -8.746828904884718e-02; +1.725472874954452e-01   -2.959474497631256e-01   -1.711561949726680e-01   +2.168268790927365e-01   +3.197922132887305e-01   +4.746161581601238e-03   -2.799119673387678e-01   +2.276450676226330e-02   +2.519013724045913e-01   +2.225292274818521e-01   +1.577152122253087e-01   +3.357690499475370e-01   +3.753794205764872e-02   -1.586426393142128e-01   +2.526735283228278e-02   -7.906966643818122e-02];
L2I_L2E_iAMPA_netcon = [+1.856674013144241e-01   +3.344706913900772e-01   +1.368282740633317e-01   +4.166295969929603e-02   -1.545780450293632e-01   +5.196582161602387e-02   -1.327116005437150e-01   +1.539640955388823e-01; +3.337887214590548e-01   +2.036748968045590e-01   -4.448056575753834e-02   +8.883077544202775e-02   -8.890995062472842e-02   +2.531318097828596e-01   -7.766468930269138e-02   -5.575374788192690e-01; -9.805586747470303e-02   -1.363849383117408e-01   -6.045448414161091e-02   -2.768641385562507e-01   -2.886390330760959e-01   -1.109341446882008e-01   -1.580528938695862e-01   +2.084467701923390e-01; +4.497692658614840e-01   +3.761551280464248e-01   -3.910793729794530e-01   +1.471421272765430e-01   +1.230362397922671e-01   -8.286844269674505e-02   -4.366909957059587e-03   -5.255866305209680e-01; -6.374004229153472e-02   +2.407333867131530e-01   +1.179847823029779e-01   +1.468870794564809e-01   -2.030420458920491e-01   -4.707537097953327e-01   +1.587654349483394e-02   +3.095051179782643e-01; +1.597401544931496e-01   +3.044238662485403e-01   -1.978324610843463e-01   +1.318006923589802e-01   -4.758114116553780e-02   -1.516845929227023e-01   -9.275502841630581e-03   -2.278767062129105e-01; -6.216475872144925e-03   +2.787386398840845e-01   +2.532602306586869e-01   -3.281946633226757e-01   -4.485686578176553e-01   -4.242375554118787e-01   +2.556445463178634e-01   +6.212336206365560e-02; -7.937209877639863e-02   +2.577543211082675e-01   -2.294448316856878e-02   -2.600289567398886e-01   +2.183533807723769e-01   +5.061839840161315e-01   +1.584088519880526e-01   -5.055847268488616e-01];
L2E_L2I_iGABA_netcon = [+1.324480236364840e-01   -1.233990477402699e-01   -4.581158689301496e-02   -1.334223451804465e-01   +3.776161861263527e-01   -3.005549808892196e-01   +6.777596211180231e-02   +2.594268713083231e-02; +9.616666809881584e-02   -4.311648604787124e-01   +3.056730661056644e-01   +2.192922139424699e-01   +3.595439479492823e-01   +1.847014283199829e-01   +3.566487050569329e-01   -2.087160205553914e-01; +9.960024406903999e-02   +2.705437282361902e-01   -3.095393648677730e-01   -2.041752492299336e-01   +1.049844590933467e-01   +5.662935095615718e-01   -1.372940621869428e-01   -1.537162796599168e-02; -1.836062293098388e-01   -1.752401172277210e-01   -1.883201820811593e-01   +3.696981060178811e-01   +9.890506681340658e-02   -2.577332437539169e-01   +2.407240897275089e-01   +1.309810421112687e-01; +4.235708172156176e-01   -4.547262997624960e-02   -1.777099584321069e-01   -3.912555943873692e-01   -4.888063461703589e-01   -2.040009240769108e-02   -3.046682502194886e-02   +9.676017230716744e-02; -3.072905389495055e-01   +1.935948673343534e-01   -1.544931658904850e-02   +1.667287120467448e-01   +9.074258466444363e-02   +6.464998840882673e-02   +7.743435997485822e-02   -2.288369551099592e-01; -2.407139578618144e-01   +1.079842023980108e-01   +5.529987579607266e-01   +3.701219193457797e-01   -2.313605677110799e-01   -3.326170974718120e-01   +1.597157330188409e-01   -4.863817391392875e-02; +4.161993272206489e-01   -3.182215676906100e-01   +1.858066631922347e-01   +3.003021976718721e-01   -4.540259542915732e-01   -9.743856315484813e-02   -1.155649240168364e-01   +3.257582086885474e-01];
L3E_L2E_iAMPA_netcon = [+3.854418878621448e-02   +2.130750573688663e-01   -1.385090878416897e-01   -3.368011279472182e-01   +1.114830294037147e-01   +8.674268315053563e-02   +4.135583468300225e-01   -2.715242664538477e-01   -2.158615801203613e-01   -7.089795453661429e-02   -4.140956928222392e-01   +1.194633990655078e-02; +1.048718193296342e-01   -9.575120332615916e-02   +1.384694816059306e-01   -7.811723382798627e-02   -7.092361343523862e-02   +2.811796241940421e-01   +3.869776064698793e-03   +1.384998625643130e-01   -9.935220303216682e-02   -1.721829108072947e-01   -2.190176725454913e-01   +5.514859873260364e-03; -2.945853765598628e-01   -3.810580258772220e-03   +1.460641120252785e-01   -9.959261625824212e-02   -1.422104333010266e-02   +1.323803764542441e-01   +7.478607307266977e-02   +4.901731672771383e-01   -3.713313709286265e-01   +1.857697038799880e-01   -2.852240600223134e-01   -9.762076278213640e-02; -1.150733728486284e-01   +1.859853175739252e-01   +3.037399909675267e-01   +3.539650066105401e-02   -2.169615868111548e-01   +1.717146912856965e-02   +4.865393552204667e-01   +4.960910651208300e-01   -4.337053516331263e-03   -3.292005058206276e-01   -9.355209134302883e-02   +1.065820726426633e-01; -1.171647148742332e-01   -1.745763886379482e-02   -9.842425788090811e-03   +2.856839313949666e-01   -2.806296147634010e-01   -2.568900819464847e-01   +1.216646999626212e-01   -8.839912392787941e-02   +9.251925073737263e-02   -1.668388702792140e-01   -2.336907386958046e-01   -1.045640165930479e-01; -9.698681309315527e-02   +8.035966658632182e-02   -1.906923615337563e-03   +3.577351266130942e-02   -6.696155606476309e-02   +6.579397046691247e-02   +5.801301578832293e-01   -3.824625854157344e-01   +5.980085509338455e-02   -4.037068014035740e-01   +1.623942350544783e-02   +5.624145738091446e-03; -2.299107369878955e-02   -2.846411419036096e-01   +2.812315238953423e-01   -3.208909370180089e-01   +4.254539220363827e-01   +3.766180697160474e-01   +3.944900477085012e-01   +3.491298838216007e-01   +3.290010644825572e-01   +2.587930341220258e-02   +6.174181180098841e-02   -1.850768354243848e-01; +1.801891310807693e-01   +2.574582038757564e-01   +4.120720694989483e-01   -2.862780258128713e-01   +2.915702007659747e-01   -1.328790497775206e-03   -1.115678150742353e-01   +5.874430361405211e-01   +3.012576885411711e-01   -5.379372434748531e-02   +7.966915368322627e-02   -1.697122072438131e-01];
L3I_L2I_iGABA_netcon = [+1.357708548366657e-02   +3.987297662033583e-01   -1.715371533943428e-01   +3.951982622940076e-01   -2.691934882297479e-01   -1.596713874804950e-01   -4.829669755662502e-01   -1.950189690357166e-01   +1.972932043176923e-01   +3.602135573718356e-01   +3.027822605439309e-03   +2.730930089186078e-01; -1.730101943710255e-01   -8.194723740901874e-02   +1.670321158624483e-01   -6.107294576409454e-02   +1.437166358934513e-01   -8.463243234957286e-02   +5.728468849607182e-02   -1.211634826298391e-01   -1.114321916293186e-01   +1.156701386330210e-01   -1.334595497557327e-01   +2.766388588113639e-01; -1.008939319019676e-01   -1.435063908208287e-01   +2.113980923961534e-01   -3.257949009714796e-01   -9.425652925449360e-02   +2.623032820811148e-01   -1.430183862559122e-01   -3.515557610372172e-02   +8.671870900969422e-02   -3.059576356729816e-01   -1.982328547584153e-01   +3.509815552425004e-01; +4.307941159140994e-01   -3.438072409419229e-01   -3.357365802575717e-02   -2.963956284158888e-01   +3.421863206794030e-01   -3.382781414827885e-02   -8.646309176924147e-02   +1.013495443115017e-02   +2.276896308474589e-01   -4.410248068164702e-03   +4.643045470223523e-01   +7.348291661216322e-02; +6.648002277886097e-01   -1.309939264427595e-01   +3.633339550388226e-02   +1.891790591949074e-01   -7.169644952218834e-02   +1.864968294851588e-01   +6.266942826974470e-02   -1.048169847116218e-01   -5.055790627603263e-01   +1.420025996065541e-01   +4.055202214897330e-03   -1.265805808029278e-01; +1.854135600581768e-01   +1.808232444238743e-01   +7.124874320175206e-02   +5.662608145542106e-02   +2.875390370536153e-01   -3.769580140406776e-01   -2.371739746860087e-01   -2.639578742126333e-01   -4.352504565762236e-01   +1.526063604692913e-01   -5.292389628373542e-01   -2.438939038105165e-02; +6.337267856098212e-02   +3.489926352707454e-01   +5.855282712071198e-01   -4.018099675387914e-01   -3.785619761147878e-01   +4.895329476991464e-03   +5.143203749009606e-01   -1.581860628380164e-01   -1.169686496437031e-01   -1.760880518913380e-01   +2.340673419584401e-01   -2.611411960039925e-02; +8.640194117394530e-02   -2.115838030589862e-01   -3.447952958876827e-01   +2.997591035942228e-01   +3.516822381113325e-01   -7.987242580716933e-02   +2.384010501639000e-01   -3.482147030430766e-01   -2.098502252174552e-01   +1.529253754399210e-01   -2.513914649502271e-01   -2.265994176378616e-01];
L2E_L3E_iAMPA_netcon = [-2.354824798809010e-01   +6.488290676090830e-03   -1.615245487019908e-01   +1.536619447475827e-02   +3.362150226052439e-01   +6.736303011606880e-01   -2.369322082722097e-01   -4.029656315126103e-01; -1.338972425065320e-01   -4.994313989708873e-02   +2.715838839805990e-01   +1.833487492307353e-01   -2.521955685404482e-01   +4.903253615733626e-02   +6.112511059464082e-02   -5.220600715214284e-02; -3.036655667061361e-01   +1.083375184779860e-01   -3.196450038546058e-01   -8.113728208616619e-02   -6.036089062231839e-03   -9.685408328027029e-02   -1.677415442339993e-01   +2.488748592236402e-01; +1.743755186548533e-01   -1.160276115233144e-01   -5.529794233938762e-03   +4.577672588313816e-01   -9.161682949415817e-02   -2.595989180032479e-01   -2.055798749197590e-01   +1.765360740463566e-01; -2.658911098437359e-01   +5.516298601597860e-02   -1.488324227105775e-01   -1.197711677038764e-01   +6.594608139093310e-02   -2.215504292462784e-01   +3.200260609727720e-01   -1.289467228371649e-02; -4.923169853273520e-01   -2.427685559111912e-01   +2.021425612578194e-01   +2.463416393632872e-01   +3.928657588104444e-01   -3.836060332029698e-01   +3.396347990693970e-01   -2.192291659731344e-01; +1.011742031990634e-01   -2.193616150004429e-01   +4.424916470634331e-01   +4.725445802999509e-02   +3.733296357538838e-01   -1.462180450799397e-01   -8.233294108472197e-02   -2.648301877796301e-01; -2.156991071615652e-02   +1.892252915524258e-01   +8.887801253994715e-02   -1.175164820245950e-01   -1.700972025499563e-01   +5.157654708682190e-02   -4.103661102827773e-01   -3.854886004552862e-01; +3.555189934205915e-01   -1.721413963930315e-01   +1.800524602330557e-01   -2.809533923462573e-01   +3.012308142107473e-01   +4.696089674728654e-02   -6.176330273917028e-01   -2.649315702399695e-01; +1.065295540865940e-01   -1.577171398579834e-01   +1.328068242251973e-01   -5.426200348047638e-03   -2.288028353826877e-01   +4.290717399164551e-01   -7.114865388788515e-02   +4.129317130756326e-01; -5.785113982759543e-02   +1.105374511805527e-01   +2.703422182860151e-01   -1.687630679092680e-01   +3.036960591443590e-01   -1.347809235623658e-01   +8.248967280542546e-02   +2.785744100901295e-01; -5.103992197512694e-02   +2.149252912801571e-01   -3.213504870173450e-01   +2.609845371971068e-01   -1.556339584856337e-02   -1.061304382622160e-01   -3.338861758524524e-01   +2.346576628269172e-01];
L2I_L3I_iGABA_netcon = [-3.131492813272404e-01   +1.374062182818175e-01   -2.438021818421390e-01   -2.509521223176994e-02   -4.076566621104666e-01   -1.736734574350196e-01   +2.816662280305530e-01   +1.304444684657479e-01; -1.407426996599435e-01   -4.975337388492613e-01   +2.012674462227870e-01   -2.994424099676067e-01   -2.283602649179136e-01   -8.106565056707778e-02   +5.272161049399809e-02   -5.521459057019465e-02; -1.167276808596307e-01   +3.424456901590242e-02   +1.267977496208374e-01   +3.834561952499448e-01   +2.646254559393366e-01   +2.810743978896815e-01   +2.498279799011025e-01   +1.992699373853604e-02; -4.554185214570425e-01   -3.030010136656927e-02   +8.981157170745291e-02   -9.692293122158097e-02   -3.763676820223313e-02   +1.983144252369980e-01   +3.770766066887986e-01   -8.712832603093551e-02; -1.021392737261249e-01   +2.000155220927043e-01   +3.331976989139119e-01   -1.836802521862206e-01   +1.066145158204819e-01   -2.592888870950346e-01   +1.049226206952961e-02   +5.208689630663096e-02; +3.080242112018906e-01   -4.380765235961874e-01   -1.509383149038974e-01   -1.170558760746357e-01   -2.539483791786136e-01   +2.367264839363084e-01   -1.303398261367333e-01   +1.795277812891011e-01; -1.020209702696407e-01   +3.186269556681720e-02   +1.524055733091804e-01   -8.848120212004373e-03   -4.079006004888115e-01   +3.623108356178419e-01   -1.622562133674132e-02   -1.354443478479772e-01; -2.416821328231903e-01   -1.679584529426719e-01   -2.563721892907120e-01   -8.511886522354906e-03   -5.670693490026953e-01   -3.694932746159446e-01   -2.961779328944478e-01   +4.982113031527067e-01; +2.209209613482614e-01   +1.080303377363591e-01   +4.459496460531653e-02   -1.587403402361339e-01   +3.206338460250294e-02   -3.769126158756009e-01   -2.716294077375130e-01   +1.971156660272942e-01; -9.820192996871244e-03   +3.738899754580102e-01   -5.712284386797506e-01   +7.626990144493936e-02   +1.612643802498517e-01   -2.141779736070417e-01   -2.582191159166790e-01   -2.982506623636724e-02; -1.807826194617559e-01   +3.374305976606977e-01   +5.604001830560206e-01   +4.373691002461956e-01   -3.665285925495532e-01   -6.425262692503793e-02   -2.073808109718528e-01   +1.403927438895204e-01; +2.992098674158832e-02   +2.295262775959940e-01   +2.686692038379411e-01   +1.518478542692462e-01   -3.303387640092543e-01   +1.316509145423230e-01   -3.756641690878009e-01   +1.379391369097768e-01];
L3I_L3E_iAMPA_netcon = [-1.509392580782084e-02   -2.535356520791412e-02   +9.165377613596046e-02   +4.811620127441741e-01   -2.968493286446691e-01   -2.489320809001001e-01   +3.665997786097858e-01   -1.963436096150400e-01   -1.062656617013020e-01   +2.794930318345917e-01   +2.295943392809643e-01   -1.989905303611413e-01; -1.522559440238655e-01   +3.637934354983918e-02   -6.761519439993248e-02   +1.882776473016693e-02   -2.426932891506488e-01   +3.578099121916667e-01   -2.025710503061469e-01   -1.817188572575609e-01   +9.008811322111021e-02   -3.637339273648800e-01   -2.043822761645940e-02   -2.454219300867039e-01; +2.297154845401215e-01   +6.602259012265013e-02   +2.759376925624458e-01   +2.823749360345651e-02   -6.909154619323120e-02   +2.423843158030933e-01   +4.794748327686170e-01   -2.200523136353305e-01   +1.073299610120747e-01   -2.181850626143374e-01   -2.656514467076421e-01   +3.118299146123837e-02; +2.399278962320956e-01   +9.634430641821512e-03   -1.786736683134545e-01   -2.215757182433549e-01   +3.836722549333928e-01   -3.576353115208963e-02   -2.199196784714385e-01   -4.224541564966476e-02   -5.241173928745879e-02   +2.633789528362497e-01   +8.050989192207292e-02   -4.176694464420483e-01; -4.016657863931287e-01   +2.365968009630486e-01   -3.787059656867728e-01   -1.610977857895563e-01   +3.289687712159016e-01   +1.603253253461568e-01   -7.631743476339309e-02   +6.795865438980678e-02   +1.463063776444995e-01   +3.570175775447511e-01   -3.285714064697314e-01   -1.543104011833631e-01; -5.117914779776714e-02   +3.125821718811430e-01   -3.753101695508099e-02   -3.738519921598560e-02   -1.012999252109392e-01   -1.529863919233690e-01   +2.457100747055977e-01   +4.356623556557249e-02   -2.335723784541553e-01   +4.556193927759944e-01   -2.974904208326453e-01   +1.027579978563143e-01; +5.124131473243713e-01   -2.843882908607903e-01   -3.323494415249729e-01   +4.917927854452409e-01   +3.065018909001049e-01   +1.093978796958112e-01   -6.184397179941331e-02   -2.246476672399210e-01   -1.389172921574024e-01   +2.430695052866385e-01   +3.639750848777544e-01   -3.650220042290922e-02; -2.087736567020071e-02   +9.284965232902107e-02   +6.430729095378163e-03   +7.989878941409512e-03   -4.446411803135955e-01   +1.658450536622500e-01   +4.237599595172592e-02   +2.655222482828050e-01   +2.894503281419563e-01   +2.445520661167012e-01   +1.735333729450797e-01   +2.050249959087199e-01; +2.887096657399842e-01   -5.722783500218027e-02   +4.689129526287763e-01   +9.549936041209692e-03   +1.435747464777124e-01   -9.934646229322909e-02   +2.770744546688733e-01   +4.316680209694490e-01   -4.223200719696404e-02   -1.069776379007512e-01   -1.323795716755298e-02   -3.693493994887542e-01; -1.744473857152481e-01   +9.508353019276024e-02   +1.358344397599797e-01   +1.241475822789389e-01   +2.524831006732772e-01   +2.427315446267863e-01   +1.201308717576419e-01   +4.240954914171424e-01   +1.561129061481268e-02   -8.703706254764682e-02   +5.723218518954257e-02   +1.406327738723456e-01; +8.892382990735145e-02   -1.288927002185934e-01   +2.687476583101128e-02   -1.096501845176868e-01   +3.527915486511596e-01   +5.016128457135961e-02   -3.341761933707826e-01   +7.804207851645026e-02   +6.333787253433820e-02   +2.174148778926925e-01   -2.422532777708861e-02   +1.989028346776840e-02; -7.146366352715905e-02   +3.059376254472556e-01   -3.465136444192135e-02   -1.222952634022050e-01   -1.652128363198580e-01   -5.121327591688606e-01   -3.192023782289296e-01   +1.994377356701918e-01   -3.672401626877119e-01   -5.401495280949668e-02   +5.007496742545492e-02   +2.444056186179251e-01];
L3E_L3I_iGABA_netcon = [+2.417562770578350e-01   -1.106948524292317e-01   -2.523499978807541e-01   -2.930826563636241e-01   +5.830207614460914e-02   +5.151661468036291e-02   +6.396738761343523e-01   -8.751202638035499e-02   +1.537312224002597e-01   +3.574892275045606e-01   +1.438443426385153e-01   -3.150638440074013e-02; +5.331205217609533e-02   -1.857290931184433e-01   -4.257333368283929e-02   -8.247049256068745e-02   -1.663739804984795e-01   +4.521952667755152e-03   +1.627411140531315e-01   +1.446957189795258e-01   +1.404489867956454e-01   +6.156317304372239e-02   +1.252250448675290e-01   -2.896446678249980e-01; +6.008035274309663e-02   +2.817850813697910e-01   -2.408031290564281e-01   +1.111140582705788e-01   +3.348468710101032e-01   -4.267715716854551e-01   +1.033996073695045e-01   +4.421502521699303e-01   -8.529492544681637e-02   -3.356452828338891e-01   -3.133775289847404e-01   -6.505114357630513e-01; +4.216833922498905e-01   -3.465121430587740e-01   -7.487170499523446e-02   +6.177301911790338e-02   -1.782668664623508e-01   -3.518576625224697e-01   -9.420375756534559e-02   -1.808972283371748e-01   +9.336610086231360e-02   +2.764582178423560e-01   +3.281358278694757e-02   +1.240971630367472e-01; +2.685728675639323e-01   -5.570132233612195e-02   -3.827452614538849e-01   +1.607823513972809e-01   -4.562448141023655e-01   +1.823560709980619e-01   +1.197998684271132e-02   -3.403829165324150e-01   +1.156052699418344e-01   -3.040450433223549e-01   +2.412990858711833e-02   -6.187109264085745e-02; -8.234350293854728e-02   +3.618054650546255e-02   +5.048044950641202e-02   +2.709509157167065e-01   +2.602897016661909e-01   +9.522969441248115e-02   +1.602772088981309e-01   +2.076731234478078e-01   -4.057837882381901e-01   -3.372586903568863e-01   +1.125868915499458e-01   +6.082518959322183e-02; -5.427773597231916e-01   -2.944958828077645e-01   -2.252150932962712e-01   -2.223104240292874e-01   -2.690383481435027e-01   +6.324236080792286e-03   +8.802080924173974e-02   -2.139517730071105e-01   -3.419811886224237e-01   +5.632810278035383e-01   -1.882373753108056e-01   -1.053442960745894e-01; -2.299290318702314e-01   -3.331887335737120e-02   -1.271799920300263e-01   -1.231535303877683e-01   -2.989685706218413e-01   +8.939412704778105e-02   +1.729573737681624e-01   +1.043487517876336e-01   +9.236260283158881e-02   -4.136288479896186e-01   -9.320203145850328e-02   +7.304065077584959e-02; -1.815748701837845e-01   -3.233012356709690e-01   -2.450778620009303e-01   -6.489803579089998e-02   +3.622383201677960e-01   -3.939333146007482e-01   -7.435727422095940e-02   +4.012023041580859e-01   +1.519509904123624e-02   -2.995037365603284e-02   +3.658732236571673e-01   -1.060114956338173e-01; -9.246439772366918e-02   +4.873001772152150e-02   +5.329643190077542e-01   -2.400982947536366e-02   +1.494816594236552e-01   -2.520829794665196e-01   -3.106695804024832e-01   -1.327823075075090e-01   +3.310875935448713e-01   +1.501223819835699e-01   +3.671602463847967e-01   +3.067060651762316e-01; +6.293195966591041e-02   -1.232450047140662e-01   +4.724760781489315e-01   -2.127216184996397e-01   -3.862025570151427e-01   -7.860310401313042e-02   +2.955423407754232e-03   +8.820261089640838e-02   -1.000887758259205e-01   +3.467844710944880e-02   +1.733401547682442e-01   +2.125950582053417e-01; +5.224281973546557e-02   +2.610617449794588e-01   -6.070876863983902e-01   +1.750175160657523e-01   -3.556795548181719e-01   +3.276990978565118e-02   +1.490032105653133e-01   -3.031786822829244e-01   +1.334884684918319e-01   +2.559635167209173e-02   +5.846674845280941e-01   +9.910629410443461e-02];
L2E_Input1_iAMPA_netcon = [-1.533715129759820e-01   -5.662353465678704e-01   -3.567232889778149e-01   +4.036260256483600e-01   +1.887722531817399e-01   -4.536300341025397e-01   +2.181208645326670e-01   +2.454510874340658e-01];
L2I_Input2_iAMPA_netcon = [-2.417196792951711e-01   -2.228480387351791e-01   +2.031378201461909e-01   +5.282494927215461e-02   +1.824770330864496e-01   +2.372926067666925e-01   -2.121561206989364e-01   +3.121909787574010e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
