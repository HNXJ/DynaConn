function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.235591377648350e-01   -4.795699693389705e-03   +6.364613624925805e-02   +2.446573424670423e-01   +4.109120991738848e-02   +8.205388989634112e-02   +1.056441328247603e-01   +2.423006054047691e-01   +1.329685843925778e-01   +1.140176756354462e-01   -4.769685264966537e-03   -1.627882441312824e-02   +2.280896000099493e-01   -3.762220787460590e-02   +1.204823029623083e-01   +1.055143611892815e-01; +1.702638718055357e-02   +4.397771573404042e-02   +2.496014343588682e-01   +1.960687521572373e-01   +8.886685788389398e-02   +6.578130276118477e-02   +1.333410866211487e-01   +1.913490820336549e-01   +7.029916160323771e-02   +4.020173613799515e-02   +1.702934176059076e-01   +1.574063024170722e-01   -1.293488528907964e-02   -2.278055305606404e-02   +1.113703493826807e-01   -1.382354222097588e-02; +2.401196143551929e-01   +3.589971057019057e-02   -3.073618556528537e-02   +9.151069436097856e-02   +7.275073786844882e-02   -2.044980618600557e-02   +1.064410559373414e-01   +2.971879166852195e-01   -5.602305979502525e-02   +1.428638573859158e-01   -6.216611660522470e-03   -1.024115916308963e-01   +2.804845895827173e-02   +2.866171904168569e-01   +6.952451481721818e-02   -2.814673355978104e-02; +9.299657642625020e-02   +1.075911080505406e-01   -2.360736592740964e-02   -1.069186609865184e-01   +7.879258826210314e-02   +6.314073363474100e-02   +1.543804835907548e-01   +1.574234629901467e-01   +1.129882918408393e-01   +2.171404639480730e-01   -5.038535730560627e-02   +1.010316169536707e-01   -4.112022604483814e-02   +2.983085331549484e-02   +2.095399079155791e-01   +9.130496797605411e-03; -3.061363242591902e-03   -4.039351261011463e-02   +1.088193984190394e-01   +1.567574497825477e-01   +1.941021789288898e-01   +3.342369161024749e-02   +1.159452499362898e-01   +8.989978206245415e-02   +1.883365015219012e-02   +1.231472857285606e-01   +9.363709046083007e-02   +3.870793271000575e-02   +1.066805951912064e-01   +2.388323982735399e-02   +9.556757234205678e-02   +1.076296427979065e-01; +4.800009525435262e-02   +1.926709986263272e-01   +1.823687216608529e-01   +8.962737021700687e-02   +2.725282421847895e-01   -1.733748331803354e-02   +1.220618594304852e-01   +7.217426695813757e-02   +1.747106281423735e-01   +1.895965945587757e-01   +1.434164958865866e-01   +8.322622866495810e-02   +2.445995698546964e-01   +3.369589741579130e-02   +1.678429190754955e-01   +2.426112359766511e-01; +1.281342480494060e-01   +4.835579807530355e-02   +9.245297723303125e-03   -8.862731765082565e-02   +2.458616282439424e-01   -3.602170578163436e-02   +9.302544933104409e-03   +1.555952036540844e-01   +5.989513463262396e-02   +1.914666219784437e-01   +5.369975271510281e-02   +1.363989277337483e-01   -1.535848704415237e-02   +1.923784900003693e-01   +6.606228671526933e-02   +2.830772664010096e-01; +1.490873180557612e-01   +1.502855697581872e-01   +9.552667965099242e-02   +2.044811863157346e-01   +1.948422259984380e-01   +1.292952907915392e-01   +2.616876329981362e-01   -2.622184579792625e-02   +8.275854636445081e-02   +7.944607600143722e-02   -5.238146928859087e-02   +4.854856963840543e-02   +3.902710360601750e-02   +1.920456380338578e-02   +4.919583198969831e-02   +3.842510874223456e-02; +1.798827814775579e-01   +1.812111946267498e-01   +6.403739696949302e-02   +1.369611792578987e-01   +6.173588132396543e-02   +1.013543562659893e-01   +2.303067774221778e-01   +1.160659893977236e-01   +2.423655563187786e-01   +1.727189435065383e-01   +7.203831560773903e-02   +1.564990024798145e-01   +2.874566843333426e-01   +6.611989763871440e-02   +1.054198407009787e-01   +1.305840240488174e-01; +1.536677731146558e-01   +6.037512685666654e-02   +1.647702726790436e-02   +9.494557265561908e-02   +1.019287826460836e-01   +8.443241334568169e-02   +9.352534729171637e-02   +2.347824937628680e-02   +2.169797179261730e-01   +2.454286984012168e-01   -6.874563968873962e-03   +8.640752573117924e-02   +1.418627191250294e-01   -5.308732934386914e-02   -4.190308953996694e-03   +1.076036424465988e-01; +1.402507266330313e-01   +8.842967453310213e-02   +9.442509078825627e-02   +6.693713794380229e-02   +2.105821333595704e-01   +2.033418708733786e-01   +4.627013299303363e-02   +8.932680553039399e-02   +8.628171798781802e-02   +2.243384539965375e-01   +1.857639995534749e-01   +5.410079291427301e-02   +1.375447827344246e-01   +1.414732919360857e-01   +1.392324699426912e-01   +1.457258680423890e-01; +1.552335692239523e-01   +5.238599296876129e-02   +9.404043598610690e-03   +2.199208003078829e-01   +9.045581747597296e-02   +1.195317441040589e-01   +2.046404338970153e-01   +1.213036523538100e-01   +7.759247104883155e-02   +2.675293162570054e-02   +1.569859247725198e-02   +7.204439919196115e-02   +1.770855884848464e-01   +1.261470693529905e-01   -4.095915271772135e-02   +2.459880929870594e-02; +5.007825283744553e-02   +1.032876855490179e-01   +5.121277790778776e-03   -1.959074115830266e-02   +7.569384755510115e-02   +9.215445560597851e-02   +2.578233698984219e-01   +1.692748732464635e-01   +8.173627561612409e-02   +1.643442857237858e-02   +1.973965832981793e-01   +1.030617176110200e-01   +4.989506681202018e-02   +1.248989539694220e-01   +1.822967585394892e-01   -5.909630383196439e-03; +4.299908209424303e-02   -7.509377749221827e-02   -1.047799368852560e-02   +7.966008541544778e-02   +9.911172120419073e-02   +2.055099204247592e-01   +1.375928937863644e-01   +6.410046803753135e-02   +8.082836052319105e-02   +2.055538368623905e-01   +3.047909786237355e-02   +1.487426758801358e-01   +2.903439707338966e-02   +3.200073798383124e-03   +7.448125096655282e-02   +5.050346440515346e-02; +1.728639910472443e-01   +8.442357980498347e-03   +1.309344428673326e-01   -6.036425911553088e-03   +1.207439773267118e-01   +1.712907762836843e-01   -6.026646710920341e-02   +2.061556094072344e-01   +2.449161192068295e-01   +1.461823388248459e-01   +1.330156012668387e-01   +2.191690475501787e-01   -3.389646575244874e-02   +1.642937769472687e-01   +1.909144721020598e-01   +1.159422151597804e-02; +1.627415855092681e-01   +1.265542966566277e-02   +2.324956626561762e-01   +9.501965137332516e-02   -1.723864734656341e-03   +9.883212121404306e-04   +1.165476314752415e-01   +5.051663333788911e-02   +1.901386326533944e-03   -6.309920299718941e-02   -5.668430775957542e-02   -6.090366522171446e-02   +1.348922290591082e-01   +8.065411997823403e-02   +1.002224289796180e-01   +1.251300961303367e-01];
L1E_L1I_iGABA_netcon = [+7.224908847753644e-02   +1.705385601663414e-01   +2.388309538910664e-01   +1.180427309403058e-01   -2.764872800170253e-03   +8.528783003154064e-02   +1.699504579181307e-01   +2.973266083900899e-01   +1.279018774763893e-01   -8.520819066095073e-03   +1.887288995735943e-01   +6.522830035013431e-02   +7.295359123093814e-02   +6.812438555338274e-02   +4.891653998931653e-02   +9.086521243807708e-02; +1.868840986103761e-01   +3.102952136672050e-01   +7.347443939212121e-02   +2.945907562269825e-02   +9.604892151952876e-02   +8.001129292972806e-02   +2.074255988590880e-01   +2.238304179024811e-01   +1.499879726547579e-01   +3.524989095306875e-02   +6.735341039802757e-03   +7.690497190229420e-02   +1.370845718300823e-01   +8.912875562356920e-02   +1.077000535927134e-01   +6.748963420306626e-02; +1.366158128256410e-01   -2.174885477059865e-02   +7.822958745995359e-02   +2.285832093053014e-01   -6.554637866449417e-02   +2.794928348254421e-02   +5.544307591715061e-02   +8.394915854340743e-02   -4.700580483496405e-03   +1.198149115313574e-01   +1.744195487850864e-01   +1.090977240612791e-01   -3.567774904347073e-02   +1.702649244930127e-01   +6.696981174653673e-02   +4.244391684328949e-02; +9.225923308730823e-02   +7.393991456525692e-02   +1.152076289742071e-01   +1.604918535968095e-01   -2.293451036325122e-02   +9.964629856991232e-02   +1.342480302316210e-01   +2.998336995914395e-01   -2.320824232927410e-02   +5.965143017230974e-02   +2.248935763653295e-01   +2.527997493028983e-01   +1.034491621206491e-02   +1.772970265757082e-01   +7.770412755764027e-02   +1.857704634096699e-01; +1.176160871171073e-02   +8.866032374774993e-02   +2.627097192484279e-01   +7.476606965122438e-02   +2.590815991064404e-02   +1.521194189555519e-01   +2.857940182548870e-01   -6.231714004458948e-02   +1.626526333586098e-01   +1.643451914615949e-01   -4.270410039954646e-03   +1.100072095282932e-01   +6.929520502325646e-02   +1.426503650975531e-01   +8.955773263944858e-02   +2.836789022763009e-01; +1.809807715797552e-01   +1.379254055800529e-01   +1.861712266492613e-01   +1.157225929176083e-01   -1.602937129926943e-02   +2.675513182799430e-01   +1.365141836374484e-01   -9.758543642938416e-02   +2.035822691685689e-01   +1.538733852708442e-01   +5.022513791678006e-02   +6.177114998252346e-02   +1.263291629496383e-01   +1.427927663896559e-01   +1.137986438676256e-01   -7.559889504757802e-03; -2.730589849470230e-02   +2.995582716279376e-02   -6.608241871180459e-02   +6.043221614639624e-02   +1.943365205296810e-01   +1.615614458846006e-01   +1.279687907028411e-01   +1.622969475165463e-01   +1.103610683468902e-01   +2.178158022699218e-01   +4.710575972044739e-02   +2.209639286777541e-01   +1.736924493053098e-01   +1.162748387800080e-01   +8.908565961902228e-02   +1.045164153037088e-01; +1.429520976489728e-01   +2.911072983204799e-02   +9.155698150201999e-02   +1.275073459036878e-01   +4.292243523111759e-02   +5.245340937306305e-02   +6.759766233583299e-02   +9.431378575620408e-02   +1.443336219358370e-01   +2.573899641226348e-01   +1.506041501640780e-01   +1.916769688588066e-02   +1.256580393380108e-01   +1.823498977636289e-01   +6.684352114844462e-02   +5.740905220964158e-02; +4.749062646883030e-02   +2.896738728450961e-02   +1.655627566089745e-01   +7.651609252696595e-02   +1.379613685576291e-01   +1.326008564946005e-01   +4.353429193456645e-02   +1.333579498538425e-01   +1.084257477333047e-01   +4.391419933266905e-02   +2.338525530646921e-01   +1.195213218845919e-01   +1.107717904874730e-01   +9.290902178016840e-02   +1.627030566957659e-01   +8.021139827982193e-02; +1.959569186971318e-01   +1.644477924919566e-01   +7.501148761083221e-02   +2.394813303765596e-01   +5.740463872982876e-02   +1.670749656211802e-01   +1.062575614455712e-02   +8.829733718887584e-02   +2.554712269420628e-01   +4.062610034613517e-02   +3.839846347624096e-02   +1.772395328282023e-02   +5.639964252538206e-04   +2.132955032941015e-01   +1.308649781818491e-01   +2.416692714754647e-02; +1.730129781978807e-01   +2.531030431756264e-01   +1.816028002538984e-01   +6.003307431558013e-02   +1.550964798440563e-01   +1.127591789105674e-02   +1.032391505014129e-01   +1.545374362285158e-01   -4.553907850573622e-02   +4.658750220243427e-02   +7.668314895238951e-02   -6.907919183245224e-02   +8.513076611338613e-02   +1.524778408159977e-01   +2.275269669555149e-01   +5.615388420120142e-02; +2.225064272310297e-01   +9.606975013438999e-02   +1.815340018512512e-01   +2.148391516650797e-01   +1.033407052157734e-01   +3.059576610176634e-02   -2.956897380313912e-02   +1.812016654459231e-01   +1.013963278004877e-01   +1.029823236798755e-01   +2.318150818575805e-01   +8.387359041820548e-02   +2.971511846733889e-02   +1.999779221380904e-01   +2.005083479616987e-01   +8.106274242490108e-03; +1.621501538921650e-01   +7.854759371360107e-02   +5.552459800546404e-02   +2.780564123629200e-01   +2.613058939934937e-01   +1.625625073777330e-01   +1.157115211498676e-01   -7.542955757340460e-02   +2.742238033953043e-01   +1.266787329129772e-01   +1.048955984138188e-01   +2.407889764884876e-01   +4.539530684066553e-04   +5.509356541152657e-02   +7.270296845700638e-02   +1.246906856656023e-01; +1.644323587626532e-02   -7.106546505578684e-02   -4.029893435142914e-02   +1.028480877559042e-01   +1.099098750655919e-01   -5.595745768437821e-02   +1.750022599751440e-01   +2.226337091535573e-01   +1.694743522251373e-01   +2.792202557125353e-02   +4.266627305963298e-02   +2.298356750470142e-02   +2.741917606145867e-01   +1.757430908254289e-01   +1.566101610924057e-01   +1.343967492833621e-02; +1.340953022932437e-01   +2.028515444272602e-01   +2.663308466888252e-01   +1.829742809159355e-01   +1.756450919135848e-01   +6.886543414132058e-02   +2.199628144461763e-01   +1.766642577922556e-01   +1.760287935977185e-01   +9.293747393720470e-02   +8.488413988087981e-02   -6.837828377322093e-03   +6.125783879861158e-02   -5.132502427133860e-03   +1.318083434772176e-01   +1.239157501234268e-01; -7.316037975185255e-02   +4.614885326665924e-02   +1.377170020739802e-01   +6.256225443205499e-02   +2.130068688259382e-01   +2.308224652817602e-01   +2.926983018423260e-01   +1.293342168012832e-01   +1.801003462277184e-01   +6.145529092817944e-02   +2.233540611420086e-01   +1.614466244450249e-01   +1.008790143828311e-01   +2.097583464218097e-01   +7.424621182574576e-02   +9.688982934601086e-02];
L2I_L1I_iGABA_netcon = [+9.740774907056918e-02   +1.780924892907750e-01   +1.776467940423150e-02   +1.376444661115967e-02   +8.382482211471767e-02   +1.497332135326845e-01   +6.729477008555650e-02   +1.275660143150356e-01; +9.925242837885631e-02   +8.310227198695792e-02   +2.056340478489175e-01   +9.917064065567924e-02   +1.485786229436244e-02   +1.243489249762074e-01   +6.851448802479687e-02   +3.760417630025879e-02; -1.996910030136643e-02   +1.033941670920663e-01   +1.466604492033148e-01   +2.601719593794441e-01   +3.075495587110312e-02   +3.492571408507247e-02   +5.852321268712651e-02   +1.302493261862004e-02; +1.703167217404499e-01   -6.676240015778649e-02   +9.411664493153914e-02   +1.744257956789164e-01   +1.096610598128070e-01   -1.697244203943484e-02   +1.375177232501916e-02   +8.500504291176109e-02; +2.020479604751333e-01   +1.911435705135654e-02   +6.007059955391668e-02   +5.218270858823907e-02   +3.094723209706469e-01   +1.435594672763811e-01   +2.601349705026417e-01   +1.061366288801274e-01; +1.449306291779976e-01   -5.602077303197986e-02   +4.714345958095724e-02   -8.601570797815360e-02   +2.310416780416376e-01   +7.263100273147291e-02   +3.266371629498198e-02   +5.823059505354904e-02; +1.437418057128877e-01   +5.486228065666438e-02   +2.360494906181480e-01   +9.186689371849903e-02   +9.163513001291643e-02   +1.076242903756827e-01   +1.804191269975009e-01   +1.377478687435724e-01; +1.651895889183593e-01   -1.125503387890071e-02   +2.363901876529308e-01   -5.332769248829052e-02   +4.429997359601714e-03   +3.107057940084908e-02   +1.146444103829126e-01   +8.629401005537221e-02; +1.375474472129325e-01   +7.924291991141905e-02   +1.549188447956268e-01   -1.877316289803329e-02   +3.549933568040350e-02   +1.736627041788066e-01   +1.946325054499135e-01   +1.094948897825424e-02; +4.364149469478593e-02   +2.133803886285603e-02   +1.927807523996811e-01   +5.383739326992939e-02   +1.166949695672703e-01   +5.449711658103911e-02   +1.696162119744160e-01   -5.796901328825932e-03; +2.119087959052890e-01   +1.854946185220686e-01   -2.349045063631327e-02   +1.498006934571188e-01   -7.519407058005075e-02   +4.712082720878444e-02   +1.168402160907852e-01   +2.478564980646930e-01; +1.194454601043179e-01   +1.671100165559093e-01   +8.289299358864574e-02   +1.090951081099397e-01   +2.462200156928536e-01   +2.794930383355478e-02   +1.366762089721981e-01   +8.463655810084725e-02; +1.809930324528090e-01   +1.755688281567883e-01   +1.263425419542770e-01   +2.804242309575307e-01   +1.461595138986995e-01   +1.811690889607497e-01   +5.195162383435097e-02   +1.157023431483389e-01; +6.940190881180762e-02   +2.946345059397255e-01   +2.424312355964182e-01   +8.245857215877216e-02   +1.971016871787559e-01   +1.991276089426201e-01   +1.724265989024559e-03   +8.323179299348139e-02; +4.994941814977785e-02   +2.075406316889717e-01   +1.399507045068107e-01   +1.513467831884840e-01   +5.313669908099183e-02   +3.039984296894946e-02   +1.456576627019037e-02   +9.440615261633879e-02; +1.199234291491954e-02   +2.297179582172693e-01   +9.498330948137981e-02   +2.252812372466213e-01   +2.382900487709246e-01   +9.241601221353594e-03   +2.264642253994010e-01   +4.723333417015937e-02];
L1I_L2I_iGABA_netcon = [-3.175560397330161e-02   +2.854812375748562e-01   +1.088961574196588e-02   +2.067008790187581e-01   +2.599270645560146e-01   +7.460183884822123e-02   +1.692364125996653e-01   +6.989464310271060e-02   +4.768313148999274e-02   -3.355460024129774e-02   +7.560972519522417e-02   +6.672310679650834e-02   +1.419567678806598e-01   +1.226963254603209e-01   +2.277233791628767e-01   +8.376680552887317e-04; +9.132731526213970e-02   +2.693623440238592e-01   +1.103577751286640e-01   +4.998142678413584e-02   +2.665653072108000e-01   +7.442687593160234e-02   +1.108393708938755e-01   +2.006169574356990e-01   +8.536566051450936e-03   +8.043501617873183e-02   +1.272883543717411e-01   +2.187570452355238e-01   +1.360898563606838e-01   +3.233783755828057e-02   +1.143862993083592e-01   +1.587645195123632e-01; +1.657783484313019e-01   +2.123599127869649e-02   +1.307436777483197e-01   +1.434479627993398e-01   +9.285995633623208e-02   +1.065311042282906e-02   -2.759565996999627e-02   +6.701872019809196e-02   +1.374259556217360e-01   +6.899146417573621e-02   +2.010035764544547e-01   +1.339701858220591e-01   +3.531766153419939e-02   +1.072240250453157e-01   +1.604286131976566e-01   +1.256373231864538e-01; +7.105198804492693e-02   +2.438942242363484e-01   +4.282787991118312e-02   +7.581885832829624e-02   -4.188896689728364e-02   +8.339237806466362e-02   +1.281753250008412e-01   +2.047650699611600e-01   +1.027433301648345e-01   +1.890754534189823e-01   +8.083373519859166e-02   +1.770235510099626e-01   +7.219810730154820e-02   +2.327167006988907e-01   +1.120492061405234e-01   +1.544371399695756e-01; +1.318640799723218e-01   -1.891947748374268e-02   +1.999401780801621e-01   +3.961597070639802e-02   +2.274876059409433e-01   +1.064644032660355e-01   -5.044182252356498e-02   +1.427546006240396e-01   +1.914520696312035e-01   +2.092969732935865e-03   +6.402737685506947e-02   +1.613582083054693e-02   +2.228316732174134e-01   +8.375088819041984e-02   +1.373809942061619e-01   +1.252867043637866e-01; +9.421637308146141e-03   +1.696143020716420e-01   -1.940750590375138e-02   +2.440376626765513e-01   -7.806550892753009e-02   +3.098352744547779e-01   +2.753425226439737e-01   +7.786664428212980e-02   +6.547475726653709e-02   +2.764269620347281e-03   +1.542360273327354e-01   +1.215731053961258e-01   +8.893692229963238e-02   +9.550011262676610e-02   +4.859436070157324e-02   +1.990423835878402e-01; +4.105151572089704e-02   +1.592847547485942e-03   +2.041032751821182e-01   -4.316366865172692e-02   +1.299506543019585e-01   -1.478129777653932e-02   +2.227292080895968e-01   +9.273423018877555e-02   +1.665479940719388e-01   +1.878412604634223e-01   +9.806275532570088e-02   +1.417098226173934e-01   +9.633717899104098e-02   +2.535230411408984e-02   +2.152508383348538e-01   +1.602686300694051e-01; +5.417794716584768e-02   +7.498854010912989e-02   +2.263116289806906e-01   +1.277566934283604e-01   +8.074419055425083e-02   +1.516601645527058e-01   +2.619519776802767e-02   +2.957040726428048e-01   +3.268814113341058e-01   +9.357856855176193e-02   +6.186286494884752e-02   +9.457677252542424e-02   +9.020283715281907e-02   +9.436198332822307e-02   +1.700025549222343e-01   +1.926057105389374e-01];
L2E_L1E_iAMPA_netcon = [+1.505163015402626e-01   +1.209795434902250e-01   +3.172410108079872e-03   +1.236673057433177e-01   -1.074594776305410e-03   +4.933519855832900e-02   +1.609866485060233e-01   +1.525766991931049e-01; +2.453271216774008e-01   +5.468710624849392e-02   +2.482678610094674e-01   +7.767728711542976e-02   +3.492087645805131e-03   +1.371690774401692e-01   +1.280597650076460e-01   +4.513415741339834e-02; +1.378408476243191e-01   +1.172038525849980e-01   +7.706920084584384e-02   +1.527361126630289e-01   +2.390914951074672e-01   +3.598941162211113e-02   +1.580965668543919e-01   +1.292531510805213e-01; +1.522431198733551e-01   +1.396336001312372e-01   +1.694351845563002e-01   -1.470646370826657e-02   +5.523779629460032e-02   +2.755233279168519e-01   -7.455772644328458e-03   +7.642635949651616e-04; +3.473454611090707e-02   +1.137021241441645e-01   +5.058657385791755e-02   +2.039563513933617e-01   +9.662688775282052e-02   +1.462278566394317e-01   +4.919071510016887e-03   -2.754911762818328e-02; +1.417003175177444e-01   +1.163771997831933e-01   +2.250847823594516e-01   +1.089836601340941e-01   +4.451027062999809e-02   +1.770147721158811e-01   +7.234492794377884e-02   +6.873842484381354e-02; -6.531430672233508e-02   +1.406643266604913e-01   +8.426560147680834e-02   +2.842578177151439e-01   +8.154449179595123e-02   -2.179813299854828e-02   -7.693972924234202e-02   +1.755644140410078e-01; -3.492058393990249e-02   +1.024183584856477e-01   +2.332957385341294e-01   -5.113564130507427e-02   +1.648271920814605e-01   +8.461592664080761e-02   +1.523800824106153e-02   +4.504906263396086e-02; +2.138048110191535e-01   +2.234214747655038e-01   +2.058173101585430e-01   +1.441837208229159e-01   +1.259331309812315e-01   -4.568885980195733e-02   +5.605326727014983e-02   +1.465404535408832e-01; +1.557862107372908e-01   +2.997771136717397e-02   +4.969293880295779e-02   +6.803973482283154e-02   +7.165870959373480e-02   +2.490273708840829e-01   +7.811671214754753e-02   +4.561975701880672e-02; +5.119061075815090e-02   +1.006006238199519e-01   +1.369821530582453e-03   -9.764156348809033e-03   +1.763577072524529e-01   +2.394760481242428e-02   +4.715486110263561e-02   +7.323635100541194e-02; +1.664168585032339e-01   +1.172576593421804e-01   +1.173443350062051e-01   +1.704271298794762e-02   +1.450186341715084e-01   +1.771196833888018e-01   +8.806419940774673e-02   +5.030863976642486e-02; +1.445933444259742e-01   +2.093134003085092e-01   +4.467079205528598e-02   -4.883622654439770e-03   +1.276961239764381e-01   +1.381628811485311e-01   +1.797541920447906e-01   +2.786791734833228e-01; +2.266494352487856e-02   +3.198932434228587e-02   +1.818863817097144e-01   +2.634346779182722e-02   +3.512288110954714e-02   +6.821176883068397e-02   +2.328867618182799e-01   -2.658150639633662e-02; +1.378514148591922e-01   +1.907384238780554e-01   +9.087230861656345e-02   +8.795832648989360e-02   -1.833302658062512e-02   +2.730136218581519e-02   -9.202032231814448e-03   +1.348900229037382e-01; +1.022250831084929e-01   -2.456508989887306e-02   +3.309141706542413e-02   +5.729960765356200e-02   +1.929283551517396e-01   +1.989313115836353e-01   +1.109002384858553e-01   +1.829075199050464e-01];
L1E_L2E_iAMPA_netcon = [+7.976284496904894e-02   +1.144544211454924e-01   +1.099344859798419e-01   +7.982286033517588e-02   -2.515420815845584e-02   +2.690798229144740e-02   +1.243140210260892e-01   -8.497949203185159e-02   -6.678698807452570e-03   +2.570500650241726e-01   +1.385472628748324e-01   +2.502276246274864e-01   +2.122640868565445e-01   +1.981408193268754e-01   -6.720972785481343e-02   +1.124032458178283e-01; +2.076013680744620e-01   +4.524172698387755e-02   -2.814822327044855e-03   +1.296426485310694e-01   +1.539047009165144e-01   +5.888584013835212e-02   +8.601634357586142e-02   +1.366678177652957e-02   +2.584036378162484e-01   +1.271360879673097e-01   +1.084390980288974e-01   +1.230428269115711e-01   +1.058757501460203e-01   +1.876640713022516e-01   +1.260113321103894e-01   +2.068352818258854e-02; +1.434663465312981e-01   +5.371426329720354e-02   +2.124600699777823e-02   +1.275835800312096e-01   +1.394436291307458e-01   +1.398041380999394e-01   +1.004185823672773e-01   +1.637988519881772e-01   +1.095301590959104e-01   +1.310757227307111e-01   +1.329560923435502e-01   +1.415400021212839e-01   -1.664849381300145e-02   +8.329623888642179e-02   +3.356221709465507e-02   +1.732239098134105e-01; +2.566622307581509e-01   +2.925128870719003e-01   +6.029359032071377e-02   +3.107251042755815e-02   +1.332551659369298e-01   +2.366432227017018e-02   +1.770456332484207e-01   +1.707704239989986e-02   +3.408968780825121e-02   +2.136219289998161e-01   +1.040978109980666e-01   +1.443154835881581e-01   +1.887159673603865e-01   +2.558489470048515e-01   +2.042635515692115e-03   +2.490041662461999e-02; +3.086966672044736e-02   +5.785497440339010e-02   +3.738540947365119e-03   +1.696727254902088e-01   +7.530015674722604e-02   +1.382435414086154e-01   +1.775159714696490e-01   +7.827931791087143e-02   -6.991185462820321e-03   +1.490476519229855e-01   +1.469275030168924e-01   +4.202653119195791e-02   +1.650226984389623e-01   +9.668711525181511e-02   -1.254474445103438e-01   +7.373646108136185e-02; +1.300711522468769e-01   +2.100150596987828e-01   +2.356457502816862e-01   +8.162610823355612e-02   +1.206344298004646e-01   -9.270884131099486e-03   +1.928345544793223e-01   +1.191507630197807e-02   +1.066938554289480e-01   +1.538076613612176e-01   +1.241814211652619e-01   +1.225741001000215e-01   +1.963672194591620e-01   +2.665725327023533e-02   +1.003441173550086e-01   +1.285501513441729e-01; +1.046287980626911e-01   +1.712583141035705e-01   +1.087444429678829e-01   +1.590159734635826e-01   +9.825698411093539e-02   +6.760267011189916e-02   +2.902985547372571e-02   +1.122599807560768e-01   -7.491935374510351e-02   +5.494391290557216e-02   -8.579297570132717e-02   +2.185002810193580e-01   +7.423540474348932e-02   +2.905091579626074e-01   -1.284663365823901e-02   +4.512940140402197e-02; +1.381559453438899e-01   +2.493724835711530e-01   +2.045392145065181e-01   +2.678275218741370e-02   +5.290612238655180e-02   -1.892035595372550e-02   +2.161524417703256e-01   -1.688520196839017e-02   +8.859433245412306e-02   +1.839627832500935e-01   +1.373607429559813e-01   +7.243375413947103e-02   +2.025954979617628e-01   +1.921300508798325e-02   +8.854643484684495e-02   +1.277078931730561e-01];
L2I_L2E_iAMPA_netcon = [+3.177873216191611e-02   +1.838401498423309e-01   +8.493061103036333e-02   +1.160037338096329e-01   +1.223929227340782e-01   +2.463645701334461e-02   +6.137732136529950e-03   +4.772780331481584e-02; +1.285059560408607e-01   +3.284787838509269e-01   +1.113053566992817e-01   +2.003994905414934e-01   +8.993150151755754e-02   +1.921510361584821e-01   +1.664259453600325e-01   +1.648096122148502e-01; +6.863978957672795e-02   +1.240402672440943e-01   +1.857527103974951e-02   +1.359266022279135e-01   +1.043734305033872e-01   +5.142578024231748e-02   +8.688724719317950e-02   +7.662433014257679e-02; +2.547144419393053e-01   -8.563731122752918e-02   +1.807986924686610e-01   +8.175005883656819e-02   +2.016746335334437e-01   +9.035529372218476e-02   +8.382709658350367e-02   +1.611191436420332e-01; -2.667281865468887e-02   +2.767098179398179e-01   -4.265520487769288e-02   +1.378755099605101e-01   +7.314656958366289e-02   +1.556991238411091e-01   +1.774187251875041e-01   +1.396290241408430e-01; +4.762873127319616e-02   +5.655618810957286e-02   +1.378154323987807e-01   +2.001396989026245e-01   +1.468449736943748e-01   +2.601439938598017e-01   +2.023311786288765e-01   +4.402632024721246e-02; +1.349753287686062e-01   +1.616953456261361e-01   +2.032410883217241e-01   +5.355349502809313e-02   +1.231315291350827e-01   +1.563064713608690e-01   +2.473756383002246e-02   +2.466107856846538e-01; +1.391672921899767e-01   -9.911114111187717e-03   +2.479467640114557e-01   +1.548652611198386e-01   +7.808152129177012e-02   +1.889295715253153e-01   +4.051465307205918e-02   +5.637307681954390e-03];
L2E_L2I_iGABA_netcon = [-4.277799991060831e-02   +2.075028812576416e-01   +1.613562005021466e-01   +8.172967854589033e-02   +1.500691437483846e-03   +1.020529525068189e-01   +1.630574390200639e-01   +1.292102298204643e-01; -6.883491372067045e-02   +5.883854892924964e-02   +8.866376334559035e-02   -6.356080801802125e-02   +4.149047090133801e-02   +1.263819085408463e-01   +1.369750543168813e-01   +1.327264028300160e-01; +1.777635956427550e-01   +2.587799580766771e-02   +2.139992592772835e-01   +1.412015215794877e-01   +4.768688272230103e-03   +5.295921906138560e-02   +2.379411860704462e-01   +5.866897223466271e-02; +2.057772125497038e-01   +8.419236336912325e-02   +8.019133193264412e-02   +1.891451356994184e-01   +8.945322565954117e-02   +6.335747870333142e-02   +4.819176080631326e-02   +9.367846163191922e-02; +1.120534643978717e-01   +2.258592883317743e-01   +1.044731367087936e-01   -3.253321209717938e-02   +5.862551177762926e-02   +1.467230058106448e-01   +2.771305442068365e-01   +1.981154355908351e-01; +3.264134409921088e-02   +1.455156717786302e-01   +2.527878013322546e-01   -3.464710289823579e-02   -3.418068529697224e-02   +1.689499017341320e-01   +4.272182571311122e-02   +6.438488439987801e-02; +1.596398909978020e-02   +1.098066528361683e-01   +1.645995067852079e-01   +2.866773860132109e-01   -3.111197600226765e-02   +2.332603097803131e-01   +1.277812394084226e-01   +1.252010127187294e-01; +2.352035337009007e-01   +2.782361816596716e-01   -8.962431755892758e-03   +1.607506131845902e-01   +5.972658437528046e-02   +4.593051141315328e-02   -1.449199364880888e-04   -8.142505678820035e-02];
L3E_L2E_iAMPA_netcon = [+1.075981649057840e-01   +1.847764330668399e-02   +4.393654799381674e-02   -1.091153328379751e-03   +4.258204171983446e-02   -2.374432527794214e-03   +6.814276914764097e-02   +1.524744406131665e-03   +8.498559385766800e-02   -1.432984919488792e-02   +2.467019659877361e-01   +1.325015370579039e-01; +2.954960031327943e-02   +1.875657404682207e-02   +1.296879277897725e-01   +4.193317633286293e-02   +1.296939282143189e-01   +2.458968048834994e-01   +1.726199251786590e-01   +1.075418836461711e-01   +1.768140887890543e-01   +4.507684950166088e-02   -1.716295406879949e-02   -4.355456410294869e-02; +2.316163617695667e-01   +1.007069857577529e-01   +8.871026173522549e-02   +2.117132485567092e-01   +1.834281299220495e-01   -8.303339442139665e-03   +1.781944040517216e-01   +1.681633004130484e-01   +7.275367380341954e-02   +1.020713516503325e-01   +1.946303105401487e-01   +9.866820770614917e-02; +1.298265959572383e-01   -5.738624047728685e-02   +9.913088713954174e-02   +1.700528356946696e-01   +1.035984308320959e-01   +1.145829743453469e-02   +2.697175227262248e-01   +2.389971085328160e-02   +7.397551484240601e-02   +8.211757722956298e-02   +1.351427217508490e-01   +1.076916173274240e-01; +5.796765366350891e-02   -4.287563820208834e-02   +1.558245906152800e-01   +7.691381911632726e-02   +3.892009205761893e-02   +1.245420926991247e-01   +1.960862888881445e-01   +2.120346336581701e-01   +1.791123489106662e-01   +6.140151068377168e-03   +1.362233302120809e-01   +1.857320098208024e-01; +1.203004156687677e-01   +3.115721297671308e-02   +9.709469247162421e-02   +9.740933347871461e-02   -4.995355575867867e-02   +1.577102185709413e-01   +2.325770413548563e-01   +4.298984868352511e-02   +7.617718860493027e-02   +2.380236692096130e-01   +2.494434364422350e-01   +2.036721221899285e-02; +2.163551315576897e-01   +1.859052207209019e-01   +1.744128955343947e-01   +7.285300086002047e-02   +2.407861828869957e-01   +3.325650821848711e-02   +5.996178868765717e-03   +1.508283330423007e-01   +6.135751877260516e-02   +1.092913745458969e-01   +5.618603377675353e-02   +2.439811104639263e-01; +6.111098438355629e-02   +1.113067384911746e-01   +8.164784113120241e-02   +6.291883598166796e-02   +1.888628497714831e-01   +8.045878411929727e-02   +1.693095372763491e-01   +1.374229814363197e-01   +3.863916363854052e-02   -4.466865675845713e-03   -3.370963003262960e-02   +1.833997310122690e-01];
L3I_L2I_iGABA_netcon = [+1.937931662364102e-01   +1.058563446183267e-01   +1.362645867042417e-01   +5.602464106633114e-02   +2.037008890015409e-01   +1.601326334119871e-01   +1.448658632068607e-01   +1.575184024132755e-01   +2.815673026709156e-02   +6.660263197822128e-02   +4.967161413255308e-02   +1.958069141062761e-01; +2.424613561655320e-01   -1.325999994222280e-02   +4.422485202175049e-02   +1.487521915187036e-01   +2.194578341869098e-01   +1.520070956281072e-01   +6.310638428217155e-02   +1.934132460619225e-01   +3.276405751718059e-01   +1.951792964332535e-01   +1.799720381445240e-01   +2.462188214457076e-01; +1.428350312508030e-01   +1.330324311778023e-02   +2.065170713856407e-01   +1.395053091550041e-01   +1.470854016796772e-01   +1.783328104651272e-01   +1.304912728673659e-01   +1.131619786027440e-01   +1.342778646076920e-01   +1.900196510770428e-01   +8.474369549146926e-02   +2.478455027918451e-01; +1.401134413929495e-01   +6.154322185816547e-02   +1.940163677933585e-01   +6.827964555919296e-02   +1.187045625654314e-01   +6.235658249018834e-02   +1.759243079092270e-02   +7.197185171827357e-02   +1.182537076842559e-01   +9.961378825644639e-02   +7.534966325713263e-02   +7.159629901721118e-02; +1.161413881134330e-01   +1.926525583253937e-01   -2.219825292932669e-02   +8.002621567520395e-02   +2.339770485834290e-01   +1.733613816675313e-01   +5.661287272055934e-03   +4.138819858242751e-02   +9.817213615734058e-02   +1.353601226532137e-01   +5.113119057455049e-02   +1.729935224228820e-01; +1.229985279025163e-01   +1.492344236559073e-01   +1.091768667581289e-01   +1.702221245662733e-01   -8.390290688659489e-02   +4.892482089347745e-02   +1.402309060910437e-01   +7.299426167831000e-02   +1.882371294305515e-02   +7.894779960967949e-02   -1.025161772475584e-01   +2.418100208255549e-01; +8.141646417219342e-02   +8.826799801723351e-02   +4.795157759668534e-02   +1.686014899056034e-01   +8.663968572131653e-02   -9.278803374128745e-04   +2.450786785107916e-01   +1.051833680704618e-01   +2.594366010701393e-01   +1.406333102980442e-01   +3.107167585769242e-02   -1.128452646580182e-02; +1.806191152496459e-02   +1.590234438855455e-01   +4.163174750458049e-02   +1.203297293093156e-01   +2.574827374736568e-01   +2.589622791699397e-01   +9.461581456207266e-02   +4.025482098017213e-02   +3.022629648107577e-02   +7.010450637280045e-02   +5.094444156599112e-03   +2.528345966269165e-01];
L2E_L3E_iAMPA_netcon = [+2.060809833487396e-01   +7.039290414866997e-02   -4.954312263079447e-03   +2.509821407713888e-01   +7.102689677300339e-02   -9.105448570821266e-02   +8.605400571729153e-02   -7.432937617481226e-03; +3.039496542042718e-01   +1.802638297885472e-01   +1.387580642677139e-01   +2.800580212758981e-02   +1.473518314395525e-01   +1.106720008635233e-01   +1.256171546466460e-01   +4.700338114581747e-02; +1.300670904231564e-02   +3.196522703336997e-02   +1.767175445926851e-02   +8.170419674743649e-02   +1.173450569941702e-01   +1.753960832279703e-01   -2.761323421341541e-02   +1.919814879740357e-01; +1.522442008310011e-01   +1.581985270906308e-01   +4.169012002243307e-02   +6.348010556505336e-03   -1.438879899537502e-02   +4.157834965990158e-02   +3.829587211557120e-02   +1.963297480922007e-01; +1.161704146406338e-01   +2.239245197336940e-01   +6.639975348268060e-02   +2.396067068595322e-01   +5.672023326684969e-02   +4.415405646798730e-02   +1.528137291106676e-01   +2.063974171104162e-01; +1.292319634760376e-01   +9.304820121888399e-02   +1.158242524426191e-01   +6.138386579509306e-02   +2.729518913692139e-01   +1.485875125751425e-01   +1.008702450319007e-01   +2.149073453293152e-01; +6.198879268104995e-02   +2.112996362601082e-01   +1.524154850493204e-01   +1.005058982106146e-01   -2.503527219431884e-02   +1.704553547137228e-01   +4.607574576608696e-02   +1.577918066321992e-01; +4.036221329609654e-02   +8.543749687983772e-02   +1.503646795732272e-01   -2.395935153519435e-03   +1.019705396426496e-01   +1.121506535146467e-01   +5.355807636549073e-02   +2.409908021060789e-01; +1.180968877855167e-01   +1.220557753127531e-01   +1.220908925126435e-01   +4.500017076952363e-03   +6.340780595984079e-02   +1.191263568669123e-01   -9.282509674573021e-02   +1.210203547293315e-03; +1.580520582580428e-01   +5.339702065366558e-02   +1.511732648569791e-01   +7.988820333992970e-02   +2.748771357027474e-02   +7.777542752054008e-02   +1.897259422752874e-01   +1.120124988506588e-01; +9.134074015869544e-02   +1.493463432047382e-01   +7.213084231983546e-02   +3.151578552700993e-02   +1.462478066438758e-02   +1.604684786422185e-01   +1.744894080244399e-01   +1.609154457581422e-01; +7.261258501256530e-02   +8.359568152923627e-02   +1.081662643053704e-01   +1.342437372821043e-01   +2.717477082332180e-01   +1.827837878369021e-01   +4.042585641967561e-02   +5.843703507858750e-02];
L2I_L3I_iGABA_netcon = [+9.766279390458134e-02   +9.079796957859326e-02   +1.094384959691580e-01   +1.886657460294854e-01   +1.134953876107565e-01   +3.731400352780784e-02   +1.487972706065988e-01   +1.785935185284585e-02; +1.468040839722226e-01   +2.251686433879623e-02   +7.830340009727001e-02   +9.292841216737437e-02   +1.047111071537237e-01   +6.433980548390833e-02   +2.213668287682750e-01   +2.710622585963356e-01; -6.306752792737765e-02   +2.140504603224505e-01   +1.683536207749035e-01   +3.260593575637026e-02   +1.767155748419280e-01   +1.194102944562675e-01   +2.878591018118010e-01   +2.265374028366691e-01; +1.601579758463672e-01   -1.018816071996153e-02   +1.920364758960383e-01   +2.776071994022968e-02   +1.138778166138015e-01   +8.209346179623224e-02   -3.081279633418765e-02   +1.367176938885655e-01; +1.503653010422532e-01   +4.494807487134329e-02   +8.399374233885379e-02   +1.203809548979992e-01   +1.325334966314887e-01   +1.626074614212118e-01   +1.419082721441129e-01   +1.937811429504078e-01; +1.098280296770068e-01   +1.673809315568146e-01   -8.337776985988524e-02   +1.486073064305369e-01   +1.248210518102184e-01   +1.623273768696465e-01   +9.185481423970085e-02   -3.100809049457691e-02; +8.840558308557930e-02   +1.100195051491815e-01   +1.502871513156481e-01   +2.106373020411540e-01   -1.873536934642719e-02   -1.555372560470468e-02   +7.710471134559280e-02   +8.137144408628952e-02; +2.369707174101758e-01   +2.172377891320021e-01   +8.906180335497879e-02   +7.121262806777696e-03   +3.934720218913739e-02   +3.900796405882076e-02   +1.069725808992384e-01   +1.116108958827661e-01; +2.293773790229189e-01   +2.004284486029153e-01   +3.756763751850928e-02   +2.317776748196609e-01   +2.451989149479530e-01   +8.569945283451907e-02   +1.702180092438391e-01   +1.132962427701101e-01; +1.469564857313812e-01   +1.779298193357284e-01   +2.092969131976180e-03   +1.665367540087536e-01   +9.967047483623397e-02   +1.722435843490636e-01   -1.360315651263092e-02   +2.053532505660368e-01; +2.105765572736481e-01   +9.328872384110626e-02   +2.334111089408183e-01   +2.339946508609377e-01   +1.800053806662040e-01   -1.245736978004551e-02   +1.311387855833234e-01   +6.139805448020466e-02; +1.676994604145410e-01   +1.328548442311553e-01   +1.470540999620041e-01   +2.140187010280288e-01   +9.559722659670336e-02   +9.574138805614366e-02   +1.340512753986934e-01   +1.158508078237514e-01];
L3I_L3E_iAMPA_netcon = [+1.379056631125757e-01   +4.561296383646027e-02   -4.188244985716452e-02   -2.740652566983264e-02   +4.920062856758865e-02   +2.133095829447059e-01   +1.343799717141400e-01   +2.042330420651659e-01   -5.545982494770806e-03   +9.399448989983050e-02   +1.767908913110415e-01   +2.011908684085682e-01; +5.470812243097636e-02   -1.686961724030314e-02   +1.541413751256517e-01   +1.337694065000795e-01   -1.716387787218783e-03   +1.512770126002179e-01   +8.745246304800569e-02   +1.559871714941423e-02   +1.385898809932236e-01   +4.079048414903387e-02   +9.834063308281998e-02   +1.918761502326649e-01; +1.849476508413073e-01   +5.430211222704559e-02   +2.420523382938152e-01   +1.452540395646723e-01   +1.508016403460289e-01   +2.368607133736375e-01   +1.845719935615485e-01   +6.987140169105838e-02   +1.858984223636757e-01   +9.604097022805738e-02   +2.341139498329630e-01   +2.310297246504160e-02; +9.628850700864704e-02   +1.696451628763926e-01   +1.137604471211250e-01   +9.349628052100581e-02   +1.034819589026709e-01   +1.189088772364204e-02   +1.327276782769797e-01   +1.836908854045596e-01   +6.903337151568474e-02   +9.490373119487418e-02   +1.579846827270130e-01   +1.687359792918093e-01; +1.534132909876668e-01   +2.148249942414547e-01   +1.614679132339885e-01   +1.630330177172983e-01   +1.997543299347264e-01   +1.697209302319095e-01   +9.924534253446794e-02   +1.454351945648507e-01   +1.472357508156068e-01   -4.586949578579603e-02   -4.961654340815083e-02   +1.896313303710631e-01; +1.330246545399415e-01   +2.535149491597686e-01   +1.297751362331699e-01   +1.584998146745158e-01   +2.919847296068919e-02   -8.578416446666774e-02   +1.440777534568752e-01   +1.781692719012033e-01   +1.936340819904942e-01   +7.265592026061480e-03   +2.979330626832485e-02   +8.965517858701756e-02; +1.110695611556425e-01   +1.128028563507218e-02   +5.619426100333421e-02   +1.609175054871309e-01   +1.622626089674412e-01   +6.207958775926695e-02   +3.922816338344502e-02   +9.174352702407662e-02   +6.834727955887901e-02   +1.912398172703040e-01   +1.179542280336969e-01   +1.044895704052095e-02; +1.032335029119833e-01   +1.484207217162022e-02   +1.570244141326226e-01   +2.839318543172360e-02   +1.244125823680155e-01   +8.000747778046699e-02   +1.605427774000914e-01   +9.641717892461460e-02   +2.239372766697638e-01   -7.649279790300591e-02   +2.589129703688219e-02   -4.204595534999048e-02; +4.135695197298762e-02   +1.008017109964389e-01   +5.198967685476130e-02   +2.090787038658358e-01   +2.249039860806946e-01   +1.224465911267525e-01   +8.705616923880648e-03   +1.794952564328341e-01   +7.751502602947334e-02   +2.443218266993821e-01   +5.023034998383947e-02   +1.639558456188413e-02; +8.551987573544920e-02   +2.244679547070965e-01   +2.327791519382535e-01   +1.002301507337268e-01   +4.423781999982608e-02   +9.929204058968479e-02   +1.468754648667934e-01   +2.454895890541160e-01   +4.105749511662896e-02   +1.654223367785600e-01   +1.962795447761869e-01   +1.376196115306547e-01; +1.650884658257756e-01   +6.416633772351046e-02   +2.928119611147458e-02   +3.754886887884651e-02   +1.444689472251522e-01   +7.389724822845387e-02   +8.310616589359794e-02   +1.280080846005309e-01   +1.487363721666274e-01   +7.543632269287219e-02   +1.930704329396085e-01   +8.926000921479146e-02; +7.822009002087864e-02   +1.699132680355941e-01   -3.619291778757195e-02   +8.413298746513785e-02   +1.876627707439716e-01   +1.365356884407573e-01   +1.500844312758226e-01   +8.083498706074933e-02   +1.638787219076935e-01   +2.641481740337278e-01   +2.505059951690672e-01   -8.029144397569576e-02];
L3E_L3I_iGABA_netcon = [+5.107296834521655e-02   +1.279021450418526e-01   +1.890686296225083e-01   +1.196167740511368e-01   +2.033012350368944e-01   +1.432083095325718e-01   +1.732513496923168e-01   +1.726717301558049e-01   +2.373196664283186e-01   +5.052911611177114e-02   +1.067845653927304e-01   +1.470383545917624e-01; +1.880059419581199e-01   +1.435698933199805e-01   +1.244234686139434e-01   +1.341136495330655e-01   +1.266132717775774e-01   +5.198106147294559e-03   +6.291390594421804e-02   +8.760123177525483e-02   +1.001302659946516e-01   +1.899928447768945e-01   -3.212938670490663e-02   +4.788712976223085e-02; +1.507227804081220e-01   +1.335662991259907e-01   +2.243044490234191e-01   -1.199950513277132e-02   +1.258924480645582e-01   +1.438706023372530e-01   +2.859352471174723e-02   +1.204790787369665e-01   +1.706801922995757e-01   +1.108627094023496e-01   -3.062964314126283e-02   +1.224662310945638e-01; -1.208294509087894e-02   +1.574570003093377e-02   -6.131731187937658e-03   +9.673957874476213e-02   +1.990641489941050e-01   +5.469275027675277e-02   +1.480971432401239e-01   +1.618837334857997e-01   +1.253015793477163e-01   +1.024837894680865e-01   +4.628272336011420e-02   -1.308983255398435e-02; +3.690592765374652e-02   +1.602284979976300e-01   -6.937220015586720e-03   -4.175517500865000e-02   +1.402114920691945e-02   -5.194730028689749e-02   +6.400820523992329e-02   +2.734490126961734e-01   +1.187805866911372e-01   +1.364451823239857e-01   +6.320490912969426e-02   +2.218014159115665e-01; +1.561231638547126e-02   +1.883082399180672e-01   +1.677350758417232e-01   +6.227035245379686e-02   +1.232161578354575e-01   +1.832108482143811e-01   +1.530422894138322e-01   +8.910583088409203e-02   +1.011492427015225e-01   +2.455242073899115e-01   +1.060307154812775e-01   +1.368787098775335e-01; +5.754579264866579e-02   -1.322451590907790e-02   +2.353562195302908e-02   +2.137167431628728e-01   +2.682169320521471e-02   +1.424332163882597e-01   +1.155853414255991e-01   +9.853717563152796e-02   +1.199939216620168e-01   +7.574597980289305e-02   +7.348308258002872e-02   -1.056338505292266e-01; +9.053025764704661e-02   +1.528841838190912e-01   +5.784772236338453e-02   +1.658990753887194e-01   +1.936401775623170e-01   +1.464522933618818e-01   +1.246438599976653e-01   +1.090705553856067e-01   +1.570438007866993e-01   +1.202805373860362e-01   +8.236630109265422e-02   +1.301265382919895e-02; +9.152776208629931e-02   +2.990166117267803e-02   -7.677491522419012e-04   +1.835043537974051e-01   +1.493017122323225e-01   +5.315283854153344e-02   +1.254365384638329e-01   +1.130306770511380e-01   +2.125668888535578e-01   +2.143607779482300e-01   +6.967907407481223e-02   +2.126686256078016e-01; +9.694955979879909e-02   -2.610581045223976e-02   +1.012262665862119e-01   -3.522012247027177e-02   +1.769716462097045e-01   +3.055891603610166e-02   +1.191884351266785e-01   +1.827918051137761e-01   +2.992565495735494e-02   +1.558162178269559e-01   +1.322404068007085e-01   +9.775144124393356e-02; +4.476538627068691e-02   +2.542888280240028e-01   +9.644661053161051e-02   +1.435663949351826e-01   +1.377705405980740e-01   +3.429545570977938e-03   +9.606941900990074e-02   -2.862799757006160e-02   +1.336519483797796e-01   -5.706180824480800e-03   +1.650306123907010e-01   +1.355655458801613e-01; +1.884979024334829e-01   +1.558390351286805e-01   +6.824920590580301e-02   -4.660393296127415e-02   +1.869891067018126e-01   +1.588690129043904e-01   +9.434405415691557e-02   +1.038297727629710e-01   +1.658747971301905e-01   +1.433059401296759e-01   +5.111031379869700e-02   +1.632778011067043e-01];
L2E_Input1_iAMPA_netcon = [+1.032817917441402e-01   +1.069795233409447e-01   +3.479063898101872e-02   +9.838548988427936e-02   +1.993132255462454e-01   -1.343932915719031e-03   +1.803503365023374e-01   +1.588841911081411e-02];
L2I_Input2_iAMPA_netcon = [+1.415048960026095e-01   +1.329173766839164e-01   -3.395760405012527e-02   +1.831912637292128e-01   +3.908097074081388e-02   +1.508912565212743e-01   +6.135954664599773e-02   +2.541281105755427e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
