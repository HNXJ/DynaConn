function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.316046529481993e-02   +8.849321206655522e-02   +1.203830857475947e-01   +4.139741639693949e-02   +1.984862455979015e-01   +4.909136909914851e-02   +1.029241877835114e-01   +7.477809605095963e-02   +2.039195191074903e-02   +1.106494939567496e-01   +2.885616352000866e-01   +2.544912577192067e-01   +1.089434116410889e-01   +1.213341707096432e-01   +1.918330439489561e-01   -1.903184265342568e-02; +9.837572198769530e-02   +4.724805221284817e-02   +7.656033070608720e-02   +1.942998127849307e-01   +6.953665395128326e-02   +2.209089631800318e-01   +1.043532860930634e-01   +6.474829648546951e-02   +1.174401877956523e-01   +9.668780610000571e-02   +9.499395350070461e-02   +2.413331904496909e-02   +2.017343324481368e-01   +1.066601149353940e-01   +1.653664327698720e-01   +1.460821270804696e-01; +2.038111068154785e-01   +8.919928046464956e-02   +6.614522993049039e-02   +3.607608754487288e-02   +9.245410073202005e-02   +5.213524528573808e-02   +1.119116015691577e-01   +8.887520667979469e-02   +7.496899173868951e-02   +2.567757186965260e-01   +6.733577613760757e-03   +1.305013313179118e-01   +1.937833473333486e-02   +1.438808530845670e-01   +8.592169853711655e-02   +1.426131443785846e-01; +1.682678617273286e-01   +1.881291811752454e-01   +2.037095022157862e-01   +2.052509185558990e-01   +1.660800208073648e-01   +9.543461070071617e-02   +1.157155150366668e-01   +2.119208991106180e-01   +4.875136240214397e-02   +1.271266573486885e-01   -1.103306435302604e-02   -4.301368446468164e-02   +1.343626357796406e-01   +8.658524311515075e-03   +2.095187328268799e-01   +2.620899602493426e-02; +7.518564701555702e-02   +1.466647995721301e-01   +2.236721808986538e-01   +1.287094879002115e-01   -2.854943336550312e-02   +1.940347711825854e-02   +2.042789573392255e-01   +9.735310493096999e-02   +1.062231613503264e-01   -3.645713900586729e-03   +5.627744751232704e-02   +3.788949341148745e-02   +1.347134607562352e-01   +1.093017768213003e-01   +1.766576271454814e-01   +2.412117127135556e-01; +1.184507955376368e-01   +1.579429279019339e-01   +5.808479892813261e-02   +2.333746146697047e-01   +2.044738323387588e-03   -1.055742541433251e-02   +9.742280987523702e-02   +1.020717987820200e-01   +1.518601280638742e-01   +7.701395143591960e-02   +2.041012684539168e-01   +2.217759884195744e-01   +6.580908626499624e-02   +1.683995085036069e-01   +1.009551715234808e-01   +1.034239854950664e-01; +2.976539998070483e-02   +6.233226970617012e-02   +1.060183743198175e-01   +2.232475651724882e-01   +1.116149139444379e-01   +1.848169972644221e-02   +1.408055453199685e-01   +4.205279762564468e-02   +2.182809698201253e-01   +7.917097111256809e-02   +1.145671479063277e-02   +1.759891185303597e-01   +6.328152079835885e-02   +1.437700089041013e-01   +1.576192739062020e-01   +1.195520705672498e-01; +1.811585835607661e-01   +5.418578744100329e-02   +5.715201162561913e-02   +3.841528238890242e-02   +3.891343200325597e-02   +2.359965372879699e-01   +8.147605953502782e-02   +6.999249278481379e-02   +1.821747171935175e-02   +7.280202924767508e-02   +1.214760580856482e-01   +9.799890828424770e-02   +1.050407747741786e-01   +1.930544498813286e-01   +7.412107912909281e-03   +3.388783116733084e-02; +1.527347176307500e-01   +3.347557329543725e-02   +1.121739462738302e-01   +1.553286724153917e-01   +1.482483979078686e-01   +3.628107268409680e-03   +4.732208543971673e-02   +3.334727707094315e-02   +1.457000045586306e-01   +1.899272273335918e-02   +1.669028203021838e-01   +3.202376767995887e-02   +6.842041712151523e-02   +7.940239993024564e-02   +1.205580398293422e-01   +8.485918060206474e-02; +1.131118749507729e-01   +1.498967135073694e-01   +1.624076688893031e-01   +1.309386709530033e-01   +2.038068657356313e-01   +1.914606621760667e-01   +6.970723654339481e-02   -1.463365014869466e-02   +5.466966106429927e-02   +2.313367099188880e-01   +1.296086278159755e-01   +1.094433127599363e-01   +2.617711828383441e-01   +1.769953457852683e-01   +1.557604288562955e-01   +3.970670873735958e-02; +3.435821735036461e-02   +1.565735590800211e-04   +2.189768329581745e-01   +9.540750762758413e-02   +8.672013124286712e-02   +2.914155316716371e-01   +1.272725200101856e-01   +6.759398901684269e-02   +4.464698232852651e-02   +7.405417064326621e-02   -3.091906946496047e-02   +9.980017732601799e-02   +4.853676562815466e-02   +6.575948377143960e-02   +1.871661519036219e-01   +7.800248811339747e-02; +5.830899850991099e-02   +5.534765016034008e-02   +2.876852902690856e-02   +1.440028673573468e-01   +1.375676389953157e-01   -1.197619043871742e-02   +2.611500384641755e-01   +1.770788813575231e-01   +1.249844787771545e-01   +8.867437822679861e-02   +1.236214616643788e-01   +1.771724849403564e-01   +1.303890307533227e-01   +1.424887591451182e-01   +1.976645400688105e-01   +2.115575935580229e-01; +2.560397754126942e-01   +2.013324193348620e-01   +1.190542503751728e-01   -9.466829529629826e-03   +9.735692874564203e-02   +8.126647059114764e-02   +1.399965820212432e-01   +1.759739381322321e-02   +1.763920726458170e-01   +2.058170998017473e-01   +2.002140274190786e-01   +2.207205494365388e-02   +1.031975825317349e-01   +1.273772570692280e-01   +1.865517052855251e-01   +8.383907851837813e-02; +1.793668285492938e-01   +6.694365870728000e-02   +1.129647681914478e-01   +1.952601648733252e-01   +2.011785842806714e-01   +8.225777923130009e-02   +9.049535042826506e-02   +6.128777513357249e-02   +1.743668773786245e-01   +1.312801981351402e-01   +2.070755355300667e-01   +2.168501470352244e-01   +1.658134004287402e-01   +2.186147367276441e-01   +2.315039258947306e-01   +9.312208210899105e-02; +1.885852434777983e-01   +5.275077810900246e-02   +1.841253515682556e-01   +2.006575103604526e-01   +1.681623224051435e-01   +4.549130502345611e-03   +1.704303586343018e-01   +6.685185289218350e-02   +1.176255839276522e-01   +1.453940448160122e-01   +7.408991796448312e-02   -4.230972875792692e-02   +1.920369486945110e-01   -1.030491797500130e-02   +1.298020284007728e-01   +1.918017017770682e-01; +2.383130211737172e-01   +1.615155955948957e-01   +1.926065808892629e-01   +1.573089630151785e-02   +1.539363846961427e-01   +1.455439077115950e-01   +1.407390070017156e-01   +1.344058866133525e-01   +1.284621393411159e-01   +7.781239028214905e-02   +2.801535514905868e-02   +1.955119764915952e-02   +6.104296271480229e-02   +4.222209427528633e-02   +1.930676428912702e-01   +1.733736654165516e-01];
L1E_L1I_iGABA_netcon = [+2.396732620794437e-02   +2.549308728497139e-01   +2.524723447952035e-01   +1.865183883391925e-01   +1.965739994703923e-01   +1.327743075336401e-01   +1.912381312310219e-01   +3.199298404673474e-02   +2.275631669097567e-01   +3.536655385316867e-02   +1.875134379061097e-01   +5.542618067733900e-02   +8.083333425548726e-02   +1.972908145629552e-01   +1.157251037978261e-01   +1.973107796468812e-01; +1.881140614466986e-01   +1.122572298446122e-01   +1.317894093625089e-01   +2.950810458983734e-02   -2.724091480851602e-02   +1.209892437016407e-01   +8.336915762363634e-02   +1.558791031676194e-01   -2.539060941301671e-02   -1.853886079181652e-03   +2.502485491927394e-01   +7.662208980085353e-02   +1.330695561814977e-01   +9.966037184409453e-02   +4.464305438532004e-02   +1.304146123349793e-01; +3.510958281550680e-04   +1.527392857852557e-01   +9.310096719664952e-02   +9.281449020924031e-02   +6.203534999935725e-03   +3.407676869165929e-02   +9.586738897153740e-02   +1.685012473948020e-01   +3.335448709497557e-02   +4.375499580254651e-02   +1.341044575689624e-01   +1.107973418747615e-01   +9.629059241679382e-02   -4.178339162608170e-02   +1.294225751536863e-01   +1.687156759470584e-01; +7.553033207544929e-02   +1.064605656296743e-01   +1.614097098048928e-01   +1.067622885294320e-01   +1.261560974414427e-01   +2.471272036728748e-01   +1.375434505306277e-01   -2.089883895983212e-02   +1.233702548213486e-01   +2.175401582361412e-01   +1.417728303736600e-01   +2.301676595469579e-01   +7.658145283431611e-02   +1.589501287109949e-01   +1.818621344688473e-03   +6.368505157976539e-02; +1.046903722389388e-01   +1.937710350103760e-01   +2.526977968748576e-01   +2.074653488172552e-01   +8.244366702488003e-02   +9.070966225861786e-02   +1.242442859657267e-01   +1.826806332554017e-01   +2.252341874510479e-01   +1.503438293683935e-01   +2.337073077436297e-01   +1.420413068261748e-01   +3.883767634312635e-02   -3.038178521452096e-02   +5.745562444816981e-02   +2.128511627379580e-01; +2.061630828943781e-01   +1.381243639742473e-01   +1.129316200136843e-01   +1.687129359499426e-01   +1.407551695536496e-01   +1.507110060524394e-02   +3.301038628436289e-02   +3.154099056050186e-02   +2.208001903842114e-01   +1.389646731040362e-01   +1.726212844967282e-01   -5.151925615181635e-02   +1.110394106727425e-01   +3.919077379190214e-04   +8.308945939733062e-02   +8.891858365706488e-02; +3.754577652253885e-03   +2.143964889659699e-01   +2.172747609090475e-01   +4.436958428817853e-02   +1.112051128447504e-01   +1.645640710020737e-03   +2.334783457991234e-01   +2.042691727913344e-01   -5.386326951724587e-02   +1.473171510821975e-01   +2.920803331832904e-02   +1.384016544690309e-01   +1.218620764753376e-01   +1.197897399436129e-01   +3.827108226181748e-02   +1.076284993069977e-02; -9.565524529336839e-03   +1.553781588673189e-01   +8.176450395066816e-02   +1.027138665986359e-01   +1.080415436844295e-01   +3.008187681954889e-02   +8.284846319432165e-02   +1.600193788661107e-03   +1.645768951197941e-01   +1.058619939480200e-01   +3.643954518305968e-02   +7.196679211696294e-02   +5.603877598907300e-02   +6.828104101455551e-02   +2.137945842835820e-02   +2.648041062433403e-01; +1.367066395320971e-01   +2.135709800006182e-01   +2.083376760073578e-01   +1.031313528342795e-01   +5.968461177479809e-02   +2.460549345355854e-02   +2.973889087207821e-03   +1.810777187134108e-02   +1.592660752712617e-01   -6.186787322105767e-03   +2.131621916792998e-02   +1.687477790941136e-01   +1.421026829845341e-01   +1.512485424420352e-01   +2.462775553335555e-01   +1.418528378919369e-01; +9.756243020922413e-02   +1.715267882106714e-01   +3.122317229992976e-02   +7.972184856824779e-02   +5.496013108714037e-02   +1.090073912161255e-01   +1.490955826348651e-01   +7.197820895454130e-02   +1.614041304043174e-01   +6.540622549878491e-02   +1.270794513170043e-01   +7.985351828633322e-02   +1.840729853020640e-01   +2.201543995162258e-01   +1.608622578678724e-01   +1.320238376434627e-01; +1.539875973821065e-01   +8.041675239965973e-02   +6.445387574094746e-02   +5.450496229252195e-02   +1.933352676143263e-01   +2.393097116709380e-01   +2.047204724348483e-01   +1.679862116643570e-01   +8.979820759642688e-02   +6.829760656434743e-02   +5.087428638930834e-02   +1.745906792684465e-01   +7.231181831301368e-02   +5.379394213994150e-02   +1.104067729563888e-01   +1.280040667925131e-01; +1.895132455863824e-01   +3.938263987184253e-02   +7.208310417085635e-02   +1.219115965710265e-01   +1.710896291621234e-01   +1.272734869307004e-02   +1.393472777307045e-01   +1.423185317716698e-01   +1.439461962629918e-03   +6.959739333931397e-02   +1.406953908630256e-01   +5.391407885992714e-02   +1.399270572330824e-02   +1.295290051070324e-01   +2.163996583929897e-01   +1.708307697672971e-01; +4.867344497886890e-02   +9.259480822666068e-02   +1.702419573571801e-01   +1.545874525792743e-01   +9.157582035121939e-02   +5.038597337692777e-02   +1.328872063723178e-01   +1.275729502334967e-01   +1.561733708385364e-01   +2.275408019897344e-01   +3.937541276843839e-02   +9.693421089607218e-02   +2.656466906151160e-02   +1.069387702920141e-01   +7.427107127637529e-02   +1.094571773798988e-01; +3.419766397031617e-02   +6.119329469538674e-02   +5.971597816690915e-02   +1.208781086903972e-01   +1.962029410861421e-01   +4.315018547529766e-02   +1.713182096100063e-01   +5.567843537692565e-02   +1.212071382613265e-01   +1.107303918514144e-01   +1.394987948944058e-01   +8.051072983668964e-02   +2.199698105578725e-01   +2.079306512306626e-01   +3.681620716697060e-02   +2.571159108711716e-02; +5.900430366182370e-02   +5.661449626768954e-02   +1.854787730660295e-02   +1.474127937117578e-01   +9.277302085616509e-02   +9.716146277215680e-02   +1.244684369982600e-01   +1.130542074125782e-01   +1.315371530439347e-01   +1.587838918631932e-01   +1.019879636136396e-01   +1.003196602588883e-01   +5.423505181280732e-03   +1.162267681454505e-01   +1.412754399919639e-01   +2.199959652079994e-01; +1.091576205559058e-01   +9.946683387124589e-02   +8.802947121622062e-02   +5.995150679634211e-02   +1.342310234949279e-01   +2.241428440028200e-01   -2.729801368560787e-02   +1.827214942539660e-01   +1.207573655052263e-01   +1.948810856138557e-01   +1.336101761230634e-01   +1.045056667285571e-01   +1.205777576694728e-01   +2.645314656132913e-01   +2.980147075582579e-02   +1.048570169524994e-01];
L2I_L1I_iGABA_netcon = [+1.483548673258606e-01   +2.011450227859917e-01   +7.827772560462458e-02   +1.447864252673281e-01   +7.198599736432407e-02   +1.531582926470633e-01   +8.498088195856125e-02   +1.775705469567957e-01; +4.521594797242112e-02   +1.638734082314063e-01   +1.055659894014839e-01   +1.051097430746705e-01   +1.221654812409609e-01   +1.679813674897047e-01   +1.540914450097988e-01   +6.343780711395064e-02; +5.193083931843621e-02   +1.193948712548552e-01   +2.152314318061658e-01   +7.517429490475269e-02   +1.153837105544099e-01   +1.648132893632856e-02   +1.803555352055668e-01   +1.946486453912081e-01; +1.144228951093085e-01   +1.661674726663143e-01   +9.445327095923797e-02   +1.038634568261983e-01   +7.096045175632815e-02   +1.950855889889129e-01   +1.143789679010860e-01   +1.971707956177732e-01; +1.806582808701004e-01   +9.785960834092677e-02   +1.243664770628899e-01   +4.180439437579161e-02   +2.290655424178076e-01   +2.287648418150355e-01   +9.602001200815685e-02   +1.472616404001121e-01; +1.288031468510573e-01   +1.812911121774720e-01   +2.020397753276003e-01   +1.117511499522280e-01   +1.276327524969545e-01   +1.247782165323944e-01   +9.097952066596098e-02   +1.376722608450983e-01; +1.894434199585400e-01   +3.175818800243799e-02   -2.155380398096195e-02   +1.673805283206559e-01   +8.674343444383812e-03   +5.870126163482606e-02   +1.088350581732434e-01   +7.950658384562229e-02; +1.157719071298150e-01   +1.112348822472427e-01   +6.775602794931575e-02   +2.600537040152859e-01   +8.037313637767715e-02   +1.735236316887936e-01   +5.567180840390820e-02   +3.819753209436656e-02; +1.622638819540854e-01   +9.782503924728038e-02   +3.989540211605778e-02   +1.669182649994864e-01   +1.662776368049973e-01   +2.238404680497946e-01   +2.822710325493113e-01   +4.085288019217247e-02; +7.490943807664659e-02   +1.794096438339176e-01   +9.423677629216380e-02   +2.142686443087408e-01   +1.832002094204110e-01   -1.382682308702312e-02   -1.066662790549347e-02   -2.755525552994232e-02; +1.808852764866020e-01   +7.117431915937861e-02   +2.018161274659131e-01   +1.019218790875572e-01   +9.103845792148040e-02   +2.865060884936375e-02   +2.012007181020165e-01   -6.659913703005289e-02; +7.821339809437276e-02   +1.935085382452800e-01   +7.195705553251246e-02   +1.410872461425999e-01   +2.379537763073419e-01   +1.197396321013415e-01   +7.591694055970583e-02   +4.192134682250944e-02; +9.954532050578310e-02   +2.127243881977258e-02   +4.376298266032606e-03   +2.396042619262117e-01   +2.159320540930943e-02   +1.571893876520778e-01   +1.312087179722143e-01   +9.588294753374940e-02; -6.479145875430344e-02   +1.857887724801267e-01   +4.533638713764161e-02   +1.222888265349886e-02   +1.286981149786297e-01   +1.385687332104921e-01   +2.258875749411340e-01   +1.053557391245384e-01; +4.402845778271963e-02   -7.316703079676786e-03   +1.256895817553951e-01   +1.167481945344294e-01   +1.095348743171339e-01   +1.176713036058338e-01   +1.831825036960676e-01   +9.759481398227035e-02; +3.326346797869906e-02   +1.858219105745315e-01   +4.482602920134111e-02   +1.568907836710766e-01   +8.283712914393732e-02   +9.403518257592391e-02   +1.071367000570402e-01   +6.135939440974364e-02];
L1I_L2I_iGABA_netcon = [+2.137107222758468e-02   +1.074960781374759e-01   +4.875029611049188e-02   +8.996473044383555e-03   +2.110980615899257e-01   +4.708712894704611e-02   +6.778806288117817e-02   +1.322777616744353e-01   +1.144768213540648e-01   +7.292231760861799e-02   +5.927399128859812e-02   +1.632271478002367e-01   +6.426639195071940e-02   +2.820087215551098e-01   +3.219143220211763e-02   +1.246390956725218e-01; +1.860350106799296e-01   +6.620558202841922e-03   +7.394168804658600e-02   +1.879212533624947e-01   +6.789813897306876e-02   +1.625120777526969e-01   +2.038296993667876e-01   +9.446705862549552e-02   +1.927577832559529e-01   +1.983421447479429e-01   +7.341206367226254e-03   +3.499362628084611e-02   +1.712921641889198e-01   +7.878103729905143e-02   +5.846729310897826e-02   +1.134111411102819e-01; +1.577843653404106e-01   +1.643851679890238e-01   +1.650871424000740e-01   -9.284539903998128e-03   +1.341648081811277e-01   +7.104763108427158e-03   +5.647156862183117e-02   +8.614494311968597e-02   +9.488965390888178e-02   +2.471149915394252e-01   +1.931002693825317e-01   +1.205008809206050e-01   +1.717917836108281e-01   +7.858151259926019e-02   +7.416173570068600e-02   +8.347414026128690e-02; +1.448727077569785e-01   +7.503262813119539e-02   +1.832756616688505e-01   +1.345071588787867e-03   +1.228961839416714e-01   +8.835962319337848e-02   +9.991336939062462e-02   +9.291331571799907e-02   +1.625911579178583e-01   +1.910701466844291e-01   +2.070081446297947e-01   +1.377566372500479e-01   +2.011486897953262e-01   -9.607607204479778e-03   +2.101277464685072e-02   +2.304713850979196e-01; +8.983564216813414e-02   +1.394832071126303e-01   +1.804441621511858e-01   +1.173070555369412e-01   +1.765117711235675e-01   +2.652120166654464e-01   +9.921595550760959e-02   +1.107603931801350e-01   +7.425816569072946e-02   +1.188467333237190e-01   +1.219239815621519e-01   +1.611066142962340e-01   +2.040059603051961e-01   +2.915330156605870e-02   +1.885209844681729e-01   +2.135407376225733e-01; +4.765841251008640e-02   +1.233191290871497e-01   +5.727930625129005e-02   +1.429018398161860e-01   +2.221650605722476e-01   -1.161128821820797e-02   -5.125605675974983e-02   +1.500239002964156e-01   +1.143458636815811e-01   +2.144722481031078e-01   +1.568916031876963e-01   +9.000538209237724e-02   +1.209772930011095e-01   +1.164616265418565e-01   +1.446454358012788e-01   +2.098147328184716e-01; +1.738345579299759e-01   +4.612563861349776e-02   +2.325527721220233e-01   +1.947420139026193e-01   +1.967842181149326e-03   +1.794202635694937e-01   +1.335726407403062e-01   +1.493557886084765e-02   +1.844601038185645e-02   +2.302975032813959e-01   +1.701100651558876e-01   +1.908996135735980e-01   +9.216008118074250e-02   -4.818514316147958e-03   +9.890870725615196e-02   +1.497546284065347e-01; +8.362697995621551e-02   +5.925577557865701e-02   +1.531304371040046e-01   +7.791298534109430e-02   +4.411257064886083e-02   +1.686172210710810e-01   +1.365131872974311e-01   +2.031477181614172e-02   +1.935941581639420e-01   +1.167663800460313e-01   +1.877172055822375e-01   +2.270479403519392e-01   +1.517563338365135e-01   +1.223938737448570e-01   +1.333164036828006e-01   +2.075800987554387e-02];
L2E_L1E_iAMPA_netcon = [+1.066963802371269e-01   +1.854311627988096e-01   +2.562301711386224e-01   +7.182293109117763e-02   +1.767024565811687e-02   +8.327290081599442e-02   +5.748048100619724e-02   +1.074782045214709e-01; +8.917759216467143e-02   +5.586980649568652e-03   +1.771404109182064e-01   +1.267871211127256e-01   +1.321609169080262e-01   -2.905944553272737e-03   +1.067974573366885e-01   -3.512198433452777e-02; +7.071143828951097e-02   +5.571697422650527e-02   +5.511720950335434e-02   +1.711516167446141e-01   +1.585081041222119e-01   +2.747967712244136e-01   +2.196031651723150e-01   -1.590104872121203e-02; +1.591511992851254e-01   +1.057148342020913e-01   +1.389686450838420e-02   +1.046071207376102e-02   +4.678608525352716e-02   +2.438824598015577e-01   +1.265198476836528e-01   +2.768779901029443e-02; +1.400371469658179e-01   +1.992127907083197e-01   +1.842302117071166e-01   +1.136259703906262e-01   +7.716930423239579e-02   +9.294732828545084e-02   +4.893676418304881e-02   +2.701654596473720e-02; +2.349503057664049e-01   +2.039132333908550e-01   -3.828655930925308e-02   +1.833677775844246e-01   -3.390901011624329e-02   +1.580766853035777e-01   +8.678102672115202e-02   +1.235681952915377e-01; -3.185818344917728e-02   +1.609042925776545e-01   +5.943290388496242e-02   +4.819595267376013e-02   +6.665825139985208e-02   +1.982087801860313e-01   +1.042243896543266e-01   +2.310238220526102e-01; +1.431616237270526e-01   +2.432417812954044e-01   +1.541227555767561e-01   +1.860766492605131e-01   +1.719538234624500e-01   +1.079383856866154e-01   +1.617095492876353e-01   +1.422503445470540e-01; +7.706207078516583e-02   +1.822925104750531e-02   +7.115510200637493e-02   +9.986209760162969e-02   +2.806957965689305e-01   +1.524839877676205e-01   +4.680487556899868e-02   +1.518660148321048e-01; +2.876867677473045e-02   +2.439805142565449e-01   +1.609521320248093e-01   +1.849098437212114e-01   +2.446037654704439e-01   +9.223173468312289e-02   +1.520238523263475e-01   +2.646443762618175e-02; +1.617347835958036e-01   +1.765834734109299e-01   +7.816001107121606e-03   +5.275947634015223e-02   +1.004842504945615e-01   +2.141657862246357e-01   +1.381308205553280e-01   -4.083051353491058e-02; +2.690052046229706e-01   +1.009821977688377e-01   +2.754521738667945e-02   +1.507002140620592e-01   +1.868124052943554e-01   +2.997212743988694e-01   +1.291688503453887e-01   +1.761250186900762e-01; +1.156380133521125e-01   +2.046821014925797e-01   +2.903874334110367e-01   +4.935535125003699e-02   +1.303673064732211e-01   -5.740962510865546e-02   +1.484231033151457e-01   +2.025315944436408e-01; +1.536898774854654e-01   +6.066534266189384e-02   +1.291096520434844e-01   +9.635211600379863e-02   +2.181047475238265e-02   +1.776396626794252e-01   +1.499450066846143e-01   +1.160579202233550e-01; +1.520295417825118e-01   +1.887438105670724e-01   +5.962869228874563e-03   +1.572990675042608e-02   +1.514493658864381e-01   +1.802807624535874e-01   +1.127886590743617e-01   +1.651167854868311e-02; +1.657628022701579e-01   +8.482822965007811e-02   +1.456022254419761e-01   +3.916500832631883e-02   +1.038306800639254e-01   +3.083091077854233e-02   +1.663811429807403e-01   +1.979018866553672e-02];
L1E_L2E_iAMPA_netcon = [+1.092261881153106e-01   +7.898520539944863e-02   +1.861367031977950e-01   +1.222398383254854e-01   +1.820749300790196e-01   +4.670289693765060e-02   +1.563629599009541e-01   +2.241433212198889e-01   +1.008214624306631e-01   +1.260566744945897e-01   +1.966539492959599e-01   +2.310720131667145e-02   +9.422049506904116e-02   +1.119652552930537e-01   +1.723971681305187e-01   +2.441762730586516e-01; +1.659874495385784e-01   +2.383076457056055e-01   +1.605314009052727e-01   +3.370505533369669e-02   +1.095342264518118e-01   +1.314316530250310e-01   +1.598233221929652e-01   +5.545487758055298e-02   +1.109224969189702e-02   -2.862893451069193e-02   +1.052148792086139e-02   +5.830003763033256e-02   +4.283466214452361e-02   -4.806580633087949e-02   +3.100261895949723e-02   +1.012295852592694e-01; +5.078645925577259e-02   +1.823172913222675e-01   +2.354967752424667e-01   +1.861824581608251e-01   +3.090883428282100e-02   +1.654291380362331e-01   -2.067168854292283e-02   +2.021497033162697e-01   +1.210951790417036e-01   +1.338210071160174e-01   +4.800205532175594e-02   +1.585566971486101e-01   +9.544158933811506e-03   +3.573305211854546e-02   +8.375705803145685e-02   +1.511159492531560e-01; +1.340523417715501e-01   +1.109026377514253e-01   +4.787129973292125e-02   +2.302759101575067e-01   +2.971282054624397e-02   -2.443823807370266e-02   +5.152335747013737e-02   +1.707462292450013e-01   +2.382132372006055e-01   +2.229544395144678e-01   +1.125185334205140e-01   -1.276942015632506e-02   +8.741005529468424e-02   +4.162960706224383e-02   +5.671082520878531e-02   +1.672688147850631e-01; +1.827830126120559e-01   +7.038063646053137e-02   +3.052490854207608e-02   -7.505595811012214e-04   +1.923244599362711e-01   +1.944559585419147e-01   +2.559574158132676e-01   +1.138138919782938e-01   +9.229938621191960e-02   +9.013816111273422e-02   +2.332249413753537e-01   +9.030331943216782e-03   +1.484121773471389e-01   +1.683467172824232e-01   +9.906729211506157e-02   +4.585903035843777e-02; -5.849086498750846e-03   +6.955691521532364e-02   +6.450584635153497e-02   -2.384682925196979e-02   +1.447114030108950e-01   +6.001234603761460e-02   +1.665776769984111e-01   +1.914638416703941e-01   +2.236642535904868e-01   +1.862919887252092e-01   +1.955831756845979e-02   +1.056339596376815e-01   +2.209309614739392e-01   +1.301343382751867e-01   +4.686636107018000e-02   +1.385538931014595e-01; +7.825584351239208e-02   +9.463445394634180e-02   +5.612693853397494e-02   +7.211266080564348e-02   +9.187282697706758e-02   +1.876950051033392e-02   -1.878642680615129e-02   +2.137249057605073e-02   +7.061303627444800e-02   +1.548299205352459e-01   +7.475550488122998e-02   +5.919546607301526e-02   +2.537784355056772e-01   +1.861956476483619e-01   +2.503926682527363e-01   +1.324159948632440e-01; +3.766213334195723e-02   +9.329815968692996e-03   +1.932344841281756e-01   +2.417801968014756e-01   +1.461258897139511e-01   +1.120626218468028e-01   +2.125284440637422e-01   +3.921038419150491e-02   +1.005866751662853e-01   +2.043632388638139e-01   +2.520031902508015e-01   +3.017550285957572e-02   +1.563973654459522e-01   +7.267073822204666e-02   +1.852302434513654e-01   +1.409098139132770e-01];
L2I_L2E_iAMPA_netcon = [+7.673389530927445e-02   +6.821303233640777e-02   +5.712302730603300e-02   +8.074168657797984e-02   +2.034290536508051e-01   +9.438237054401481e-02   +6.610038440341293e-02   +9.392601234381728e-02; +4.868388897635857e-02   +4.641830987260660e-02   +2.078543284882347e-01   +1.934779118373350e-03   +1.466559877865450e-01   +8.737618604374121e-02   +2.817116661291991e-02   +1.149415426097475e-01; -5.557100960059170e-03   +1.896319426234219e-01   +4.717009562932294e-02   +1.150527716421647e-01   +2.227564830189905e-01   +2.298512929169345e-01   +1.440538361084936e-01   +8.561828720238747e-02; +1.926022635737656e-01   +2.274811718157612e-01   +2.070978423725981e-01   +1.159203029517467e-01   +1.480576873498999e-01   +1.220901465060420e-01   +2.431360479628685e-02   +1.562101855951710e-01; +2.070595885545580e-01   +1.953561281695821e-01   +9.237310106064345e-02   -2.545076571271685e-02   +7.211400566567999e-02   +1.627606330357741e-01   +4.598956813992774e-02   +2.197756404852552e-01; +5.973952511651001e-02   +8.445811491104765e-02   +2.279226587373754e-01   +1.069817782459819e-01   +4.685557147705560e-02   +1.583598222236407e-02   +2.212045213860588e-02   +1.281663919540254e-01; +7.127038494007165e-02   +9.399692099173010e-02   +2.267634496347038e-01   +1.975987153334175e-02   -8.132001752717538e-02   +6.296086105880411e-02   +4.895524846287168e-02   +2.654739201687668e-01; +9.774625956564351e-03   +8.815908294527353e-02   +1.671092342452284e-01   +2.849861942752964e-01   +2.283773236052740e-01   +1.795222893309777e-01   +2.497442805344268e-01   +9.428881554451232e-02];
L2E_L2I_iGABA_netcon = [+2.210376906897034e-01   +9.085133717512688e-02   +1.541530503994933e-01   +3.261237128953944e-02   +2.651387770992537e-02   +2.077875335046096e-01   +1.774708808478454e-01   +1.927862409652148e-01; +2.679698048790568e-01   +3.203221555739778e-02   +9.149867849175718e-02   +2.582740081537992e-01   +1.089314406255478e-01   +1.865243148203491e-02   -3.430892103678166e-03   +1.552031485362768e-01; +7.278212572097101e-02   +1.235441341842433e-01   +1.378935526806679e-01   +7.980514637611691e-02   +1.052217603544127e-01   +2.125983765071351e-01   -1.639169830263971e-02   +1.049612274113482e-01; +1.994132175682546e-01   +5.415247524050693e-02   +8.776360318225027e-02   +1.254281376545789e-02   +1.702273550132337e-01   +1.938153456191301e-01   +1.283289025829694e-01   +1.129401552065313e-01; +1.068326809075784e-01   +1.904349114665658e-01   +1.938037865011134e-01   +2.197926635676532e-02   -6.868812862443996e-04   +3.838635450798392e-02   +1.899973813744852e-01   +6.529786546653442e-02; +1.643558888944927e-01   +8.560491299268243e-02   +5.376283301112154e-02   +1.011920237969924e-01   +1.069721726000992e-01   +1.759297810306588e-01   +1.656028368893815e-01   -1.930685427266184e-02; +1.806081507613047e-01   +1.188648054711961e-01   +1.405775877366340e-01   -5.058373921675799e-02   +7.230516211840175e-02   -6.855317934132375e-04   +1.817217534071224e-01   +4.912348713167915e-02; +3.722592325860932e-02   +1.053866696379145e-01   +1.024694900694594e-01   +6.707453982081406e-02   +1.824558755127857e-01   +1.532238029024127e-01   +1.256505163248061e-02   +2.701320194106061e-02];
L3E_L2E_iAMPA_netcon = [+6.579695303813109e-02   +1.295837837985863e-01   +5.141765235996565e-02   +1.576735186630341e-03   +1.351827446184521e-01   +1.058445954619097e-02   +1.797356985288689e-01   +1.359310667827814e-01   +1.671839976779159e-01   +1.209709225739584e-01   +1.124277059639426e-01   +1.674017346114079e-01; +5.917678046040209e-02   +2.164518087055948e-01   +2.206649131780184e-01   -1.126283083207422e-02   +1.871295767085113e-01   +1.810882794461980e-01   +1.318951595835846e-01   +1.480616175207068e-02   +2.037366191799413e-01   +4.868498231228317e-03   +1.530791231535956e-01   +1.886716663272232e-01; +1.533710946382954e-01   +8.498897094532749e-02   +2.120918144443626e-01   +1.789100444680103e-01   +1.803209488025899e-02   +8.695450460865764e-02   +1.460421982099730e-01   -4.204966076170778e-02   +9.236494249386268e-02   +1.972420056515042e-01   +1.165157975204657e-01   +1.991910414850981e-02; +1.628490588584699e-01   +1.469714811716389e-01   +5.423943846792673e-02   +4.638143999947485e-02   +2.009716032173413e-01   +9.184937558422530e-02   +2.762301431222650e-02   +9.620262662123540e-02   +4.306085698735980e-02   +1.157873217959204e-01   +1.607612517506755e-01   +5.799729505618523e-03; +1.541183529574739e-01   +2.567571418532799e-01   +2.226447480399067e-01   +2.421590763788374e-01   +2.245841874820224e-01   +2.278362769405044e-01   +1.159944189441618e-01   +6.659281223291248e-02   -1.631154338893895e-02   +8.730910809393186e-02   +1.502771099866630e-01   +1.070506288946466e-01; +1.023582992684874e-01   +1.276717049243186e-01   +3.299124177644615e-02   +7.274872709727606e-02   +1.258644793405350e-01   +1.225808902103308e-01   +2.793629975484989e-01   +2.306351619310047e-01   +2.364576559530600e-01   +9.096068892460404e-02   +2.294794152570196e-01   -2.195909774626973e-02; +2.176321938971316e-01   +7.740910352011920e-02   +5.891264986272912e-02   +7.258716534745369e-02   +4.222108598226782e-02   +7.096684450087021e-02   +1.203137267426379e-01   +5.558843793867713e-02   +6.017035808546924e-02   +5.572348162760667e-02   +2.204409519068060e-01   +1.773406197667209e-01; +2.273220607666009e-01   +1.760094276029129e-01   +1.075508965305653e-01   +1.858449117873845e-01   +1.886333244666281e-01   +1.026555616140058e-01   -2.858681272035505e-02   +7.892420572571929e-02   +3.531702223873733e-02   +2.415500264427017e-02   +8.938161797267739e-02   +8.637944844123967e-02];
L3I_L2I_iGABA_netcon = [+1.172195732218983e-01   +2.425826519208195e-01   +1.526581213265913e-02   +1.640238747602701e-01   +1.096906150410379e-01   +1.838518965130344e-01   +1.474824902767749e-01   +3.175904935057906e-02   +2.783998857095612e-02   +5.474017605666196e-02   +1.407493075285816e-01   +2.205912097531460e-02; +1.409645761952349e-01   +1.369741277052698e-01   +1.040728905399583e-01   +1.439918605215455e-01   +1.706696586909223e-01   +6.838213996979053e-02   +2.271507891390115e-01   +7.430748894108209e-02   +4.442229353846339e-02   +8.221230028957746e-02   +1.091410673713368e-01   +3.329579981184526e-02; +1.201360716242152e-01   +1.785909679573274e-01   +1.801381857595675e-01   +1.126985961214282e-01   +1.525459649079842e-01   +9.381214472646654e-02   +7.022139759233106e-02   +1.379502906362745e-01   +1.215267364930084e-01   -5.768545003103736e-03   +2.091705477243762e-01   +1.518422258947419e-01; +1.848356113394170e-01   +2.497043251803525e-01   +1.622950567572133e-01   +8.365498099672490e-02   +9.067586106794748e-02   +1.825376953788753e-01   +2.609218098772547e-02   -7.085187019692823e-03   +1.846404504424966e-01   +2.072706425308689e-01   +4.937910787082987e-02   +1.804187659895323e-01; +4.569446072205369e-02   +2.005694204587044e-01   +2.438789717468044e-01   +1.499695552948473e-01   +2.338619186712220e-01   +9.447659209599876e-02   +5.725020541649575e-02   +1.534306358041030e-01   +7.865667481336854e-02   +2.890859471532201e-02   +2.991629191985250e-02   +7.314432771888818e-02; +1.119367962286884e-01   +5.801527060664358e-02   +1.605086680010303e-01   +1.112119128254134e-01   +1.726769819737855e-01   +2.042194177627124e-01   +1.097193758369924e-01   +1.091916087658931e-01   +5.810864773593946e-02   +4.296971270191497e-02   +1.224956464125927e-01   +1.195094583511267e-01; +1.308276535628247e-01   +3.284937322415458e-02   +2.437890269683609e-01   +2.217054862439931e-01   +9.872545873625974e-02   +2.463607718331791e-01   +6.856655765332696e-02   +3.954859414612649e-02   -4.139789761994424e-03   +1.554225668396078e-01   +2.247314090892533e-01   +9.018772218327778e-02; +9.711172237122555e-02   +5.785848450216299e-02   +1.541263173068145e-01   +4.162567892213453e-02   +1.916938868530537e-01   +2.022356833313067e-01   +2.077455689436209e-01   +1.743097164997077e-01   +5.435519477583343e-02   +1.701881115803608e-01   +2.002229318393531e-03   +1.817558857206912e-01];
L2E_L3E_iAMPA_netcon = [+2.122224067505981e-01   +1.080936240660040e-01   +1.473769494641473e-01   +1.022151052403055e-01   +1.274384555651354e-01   +1.477231764321502e-01   +7.828484311624263e-02   +3.208598488570159e-02; +1.540477469960637e-01   +1.151260399436961e-01   +1.297802564072558e-01   +1.455440375341414e-01   +2.255038198507169e-01   +7.046220218276844e-02   +9.938481929341951e-02   +2.279726359054159e-01; +2.922120297522229e-02   +8.284393133578224e-02   +1.524382412478406e-01   +1.654481751646760e-01   +1.413433281047921e-01   +2.126178743610549e-01   +1.776910380471554e-01   +6.958038012197531e-03; +1.105790015703122e-01   +6.587826245344068e-02   +1.456368379266645e-01   +1.534540719353034e-01   +7.898041873682569e-02   +2.215562132502663e-01   +1.261518809972421e-01   +8.976787350145035e-02; +9.025094789962784e-02   +1.577578112971068e-01   +2.332161356900936e-01   +3.885177127692325e-02   +1.854966635884762e-01   +1.340840290536324e-01   +1.441087715128248e-01   +1.686773031823297e-02; +1.321199526727787e-02   +2.309067302940964e-01   +1.939567212858287e-01   +6.373983533164465e-02   +2.721639096996852e-01   +8.559401846583452e-02   +9.873556496976321e-02   +1.271494080654849e-01; +1.357920570049478e-01   +3.916355608705521e-02   +1.086174552787057e-01   +3.352119115547620e-02   +1.229902759904687e-01   +1.270876851054419e-01   +1.687020552755950e-01   +1.182734759072935e-01; +1.039237381579875e-01   +4.531813213316437e-03   +9.046782582942232e-03   -1.353572612920940e-02   +1.598598525548152e-01   +7.821297876583240e-02   +6.628679672643771e-02   +1.642647582752173e-01; +2.284484794733167e-01   +2.258254680358523e-01   +5.162666066823376e-02   +1.460640949336648e-01   -4.597893836964524e-02   +1.123074888467829e-01   +2.162418326339183e-01   +1.337668889841874e-01; +6.375975859977501e-02   +4.456150804478447e-02   +2.076326318725783e-01   +1.186381583925039e-02   +6.340699225091763e-02   +5.323348331097521e-02   +2.506010898987390e-01   +1.607519513505975e-01; +1.527492314439142e-01   +9.196737196063375e-02   +7.696616491547949e-02   +1.656772873330818e-01   +8.045643110300553e-02   -1.615507914917188e-02   +3.221428547530118e-02   +2.063908151956705e-01; +1.658010203213076e-01   +4.749564694496845e-02   +2.489255158279129e-01   +1.251371634029790e-01   +1.354647129359220e-01   +4.331865873040652e-02   +1.491003208691735e-01   +6.691131450226556e-02];
L2I_L3I_iGABA_netcon = [+1.324508675359060e-01   +8.203939994066169e-02   +4.712130098960179e-02   +1.501630194451623e-01   +1.324373257040729e-01   +1.169877102755320e-01   +3.683035510868674e-02   +1.101996160818807e-01; +1.055762453789553e-01   +1.948804934434291e-01   +6.641059705603235e-02   +2.345405896922269e-01   +6.951389017815288e-03   +1.432365411543924e-01   +5.135749791986321e-02   +1.096996400888129e-01; +8.050090727534383e-03   +1.772944141258601e-01   +1.939248670871890e-01   +1.955805617223225e-01   +1.035253970242077e-01   +1.119611208269091e-01   +1.965423752539411e-01   +2.312924712017919e-01; +1.940725315250777e-01   -1.231530712403819e-02   +1.827305994680112e-01   +1.225853062804892e-01   +1.227530320369935e-01   +1.904991271940434e-01   +2.138147205270977e-01   +2.028899896613263e-04; +7.913729038788601e-02   +2.804783620058834e-01   +1.497761694332132e-01   +1.647021860068052e-01   +5.642572338811325e-02   +1.582824644088674e-01   +1.985995050126625e-01   -2.119288771360738e-02; +1.370891385043920e-01   +1.208026783784758e-01   +1.195502980955163e-02   +2.564066813296418e-01   +4.612940894109854e-02   +4.880479506808597e-02   +1.104803059219830e-01   +1.387358574748506e-01; +1.473651688238008e-02   +2.039556519110874e-01   +6.981923443975166e-02   +2.523363831433449e-01   +1.338689905720759e-02   -3.927211292501568e-02   +1.622689255990080e-01   +1.479220954102227e-01; +1.847389287811122e-02   +8.783855140003816e-02   +1.054885765481903e-01   +1.058990627349640e-01   +1.960112277588021e-01   +1.431162352180909e-01   -1.384732317104062e-02   +4.489046888883958e-02; +7.060319958915474e-02   -4.803350250135236e-02   +2.496450546363702e-01   +2.933188009947620e-01   +1.524667611073107e-01   +1.890384593233050e-02   +5.576329226996831e-02   +1.891570653837589e-01; +3.921432129859696e-02   +1.624659437073958e-02   +5.147000452638788e-02   +1.477364950357209e-01   +1.748938743454405e-01   +5.943465775146400e-02   +2.075225486061842e-01   +1.114356247528536e-01; +4.189888785632950e-03   +1.742916759469249e-01   +3.737712107889715e-03   +8.761864663718172e-02   -6.753138578699074e-04   +1.687374968580332e-01   +3.051189121979402e-03   +5.466589710856719e-02; -3.802828283022366e-02   +5.634809096869615e-02   +5.348163676235374e-02   +3.786836783170818e-02   +1.553258853214151e-01   +1.869024477952916e-01   +8.608011789363157e-02   +6.300348198432232e-02];
L3I_L3E_iAMPA_netcon = [+1.020650402871067e-01   +1.227667562237597e-01   +9.764744049300468e-02   +1.918925825220393e-01   +3.311113095840258e-02   +1.953666550781338e-01   +9.052293483355417e-02   +3.046056620050592e-02   -3.088631788329854e-02   -1.756712035338072e-03   +1.752949331957585e-01   +9.003365489663449e-02; +2.219283551968875e-01   +6.315407150711479e-02   +7.675343003033103e-02   +2.233290016451279e-01   +1.571177511137621e-01   +1.534047113073671e-01   +1.938200361405124e-01   +2.629967161841130e-01   +1.193558502347012e-01   +8.231674138373113e-02   +1.394209387130419e-01   +2.125227267070600e-01; +7.150153143340977e-02   +1.776584351814606e-01   +4.552259392871929e-02   +6.083298384687325e-02   +1.975039464199447e-01   +1.816933540003229e-01   +1.382585715704706e-01   +1.306423571131230e-01   +2.840669325265731e-02   +2.102682979493960e-01   +3.829139691591072e-02   +1.884782830172188e-01; +2.363283218312843e-01   +6.888747165845806e-02   +1.111157322198463e-01   +1.809007803865508e-01   +9.701977578867102e-02   +6.365844451124417e-02   +1.261427637524677e-01   +2.163662915903746e-01   +1.361462699549777e-01   +1.929065755096450e-01   +8.516100328230673e-02   +1.395694902913019e-01; +6.265544315013209e-02   +2.169579716110205e-01   +6.737405542731778e-02   +1.783668245323849e-02   +5.387303949151756e-02   +4.648059737172938e-02   +5.118412884836955e-03   +1.072438678516826e-01   +9.961715771164599e-02   +7.074796323520244e-02   +2.142051535940283e-01   +1.746753401498433e-01; +1.142633834153772e-01   +1.726607147261198e-01   +9.372592439669902e-02   +2.463997686789812e-01   +4.226474079554206e-02   +5.210512660938679e-03   +5.193338660986389e-02   +6.530467892515709e-02   +5.291914908183254e-02   +2.136781495337595e-01   +1.661954145041346e-01   +8.648065134173287e-02; +1.266658920252561e-01   +9.750483573256701e-02   +1.309672482564866e-01   +1.941546724439791e-01   +1.603280085452992e-01   +7.797759872429869e-02   +7.665856177011079e-02   +2.510396955480037e-01   +1.852938818931475e-01   -9.510482269846760e-03   -6.498475662102214e-02   -2.222728661715826e-02; +2.582557066720040e-01   +1.618621008309847e-01   +1.098814434413589e-01   +1.482297584487996e-01   +6.004357983769844e-02   +3.831915013996329e-02   +1.063277530941782e-01   +2.272975080258942e-01   +1.187040242931608e-01   +1.703852183691582e-01   -1.284751150568807e-02   +5.574189329391012e-02; +2.825295312579562e-02   +5.912334399429910e-02   +1.018653951684984e-01   +2.406843219119588e-02   +6.092390537598613e-02   +2.572307238612480e-03   +1.585161800689779e-01   +7.130023073610564e-02   +9.732945638826855e-02   +2.207726701623855e-01   +1.328196922966286e-01   +2.264994525687450e-01; +1.971970444960067e-01   +4.847965908416983e-02   +1.863818839223702e-01   +8.197948626735176e-02   +5.702566336391253e-02   +9.328215910762516e-02   +1.083709838718386e-01   +2.684067609906531e-01   +1.465423804565582e-01   +1.278477193563499e-01   +5.735268276004454e-02   +2.274783414961980e-02; +2.142726873379497e-01   +1.202269635779535e-01   +1.874786471598563e-02   +5.105797962414716e-02   +1.768281300687456e-02   +1.662970017261529e-01   +1.307584092111593e-01   +1.748943405972968e-01   +1.855191474656730e-02   +6.094059070866484e-02   +1.151850178371053e-01   +2.150332003162735e-01; +1.153090993622038e-01   +3.147792068948650e-02   +3.614994172033599e-02   +2.324404211868470e-01   -2.351093148572140e-02   +5.099271806902792e-02   +1.598718683111708e-01   +1.173867203817848e-01   +3.072167933854573e-02   +5.855137671639393e-03   +1.052379121728661e-01   +2.534644759381903e-01];
L3E_L3I_iGABA_netcon = [-2.993573952127127e-02   +1.970186283964618e-01   +7.818190853018389e-02   +1.988012014908408e-01   +2.191186845186147e-01   +1.560734703668052e-01   -1.097919356285344e-02   +1.064879003983574e-01   +1.748902535474217e-01   +2.011134823823573e-01   +2.158493342284977e-01   +8.845618443525867e-02; +2.061532197695810e-02   -8.959809964711065e-03   +2.554050593110723e-01   +1.268644462451337e-01   +9.897710504087598e-02   +1.700618351527209e-01   +2.248199317584581e-01   +7.881229975896213e-02   +1.099516894596949e-02   +2.524164791646829e-01   +1.212581622752573e-01   +1.099217746059939e-01; +1.435877504693968e-01   +1.784450994226257e-01   +1.874528211734120e-01   +2.163207391784129e-01   +6.622607592243208e-02   +1.917919102655049e-01   +1.179544384900573e-01   +8.114688373619433e-02   +6.891123652022443e-02   +1.554500599083982e-01   +1.232751566089286e-03   +1.194850576630106e-02; +1.659567822916513e-01   +1.648423377066831e-01   +3.993997335025257e-03   -2.767572900351882e-02   +9.864743022180500e-02   +2.165214522061958e-01   +1.006695339455723e-01   +2.047045453662508e-01   -2.324352184694698e-02   +2.837654611831895e-02   +1.766378207862421e-01   +4.992496382695381e-03; +1.489415440509351e-01   +1.714974027879340e-01   +2.742897318819949e-01   +6.215343920442590e-02   +2.087077922681128e-01   -1.618636566385231e-02   +1.238836138300905e-01   +6.570731777880266e-02   +2.770665970056287e-02   +2.241827306013279e-01   +5.910341195718199e-02   +1.199917850614880e-01; +8.382156146167365e-02   +9.461661649486202e-03   +4.196142508371314e-02   +2.480362227779365e-02   +1.987128004835926e-02   +1.977469029245669e-01   +8.088358171767449e-02   +1.048648964672921e-01   +1.775137186859259e-01   +2.190344850005247e-01   +2.021865231684122e-01   +3.993259828864719e-02; +1.915110544720278e-01   +1.618135326127938e-01   +1.147739937460737e-01   +1.645910812942245e-02   +1.521861992070149e-01   +2.151076143853948e-01   +1.903551528177846e-01   +2.136471356085614e-01   +1.367621852411588e-01   +2.033194543924298e-01   +1.758448948647392e-01   +5.346684672087715e-02; +8.732151647991726e-02   +1.234157553716067e-01   +1.518683333788065e-01   +2.389538924504709e-01   +1.551862209773544e-01   +1.294049916786597e-02   +1.102323761906070e-01   +9.708814050731104e-02   +9.365853846614562e-02   +6.673135705801043e-02   +1.338890854388436e-01   +1.895853701544916e-01; +2.378142995975892e-01   +8.505408642960324e-02   +2.024108769906099e-01   +1.015366823717639e-01   +2.023643085369246e-01   +6.482953951466154e-02   +1.238064258179380e-01   +1.328527595863769e-01   +1.311204937530564e-01   +2.145806955053972e-01   +1.494568080791914e-01   +1.689422968020733e-01; +1.707053687657661e-01   +9.984127365508916e-02   +1.167615159255583e-01   -1.645414658120671e-02   -1.497393425923224e-02   +1.260030197465020e-01   +9.596082957167644e-02   +3.912018945070062e-02   +1.194102035927621e-01   +1.406503446033332e-01   +8.556951118422848e-02   +5.506511339051658e-02; +7.614631540708061e-02   +1.926463193759680e-01   +8.934857169975859e-02   +2.375817086313448e-01   +3.734323434297757e-02   +2.622639100490788e-02   +2.084110307785836e-02   +5.557450175494901e-02   -2.452253446439314e-02   -5.940379911879381e-02   +2.455423533861597e-01   +1.892971796316114e-01; +1.246659690669212e-01   +1.271881504275481e-01   +3.390082952786360e-02   +1.149768115460901e-01   +1.272102408592908e-01   +6.519317711133731e-02   +1.553202165886970e-01   +1.322286910961635e-01   +7.017921750307851e-02   +6.519206015658901e-03   -1.893502670934848e-02   +7.351746978032814e-02];
L2E_Input1_iAMPA_netcon = [+1.391754956437178e-01   +7.340650863427152e-02   +1.435630812811897e-01   +8.048112908702069e-02   +1.488211483165579e-01   +1.211875317201486e-01   +7.297598052708597e-02   +1.723871198218051e-01];
L2I_Input2_iAMPA_netcon = [+1.250428689159941e-01   +5.530981138543888e-02   +2.265232685038547e-01   +1.937079117496630e-01   +1.264642561749867e-01   +1.072141254772716e-01   +1.615085573541465e-01   +2.080519244721486e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
