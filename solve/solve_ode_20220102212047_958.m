function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.271534509548283e-01   -4.021614581005169e-01   +1.597950786361682e-01   +3.535110006550883e-01   -7.377064254364320e-02   +9.825771916702659e-02   -2.603128132454759e-01   -1.271289949987831e-01   +5.475550730249668e-01   +6.284395017322021e-01   +2.173935645965945e-01   -8.587788797290592e-02   +5.258031023140494e-01   -6.503828031422328e-02   -3.851277334656865e-01   -1.245404366924223e-02; +4.299748029688347e-01   +2.142299390686415e-01   +2.402321600848164e-01   +7.110663176695448e-02   +2.429905539473083e-01   +5.232703009803147e-01   -4.882726084248958e-01   -7.800079720126894e-02   +3.419783148136110e-01   -1.044758580848307e-02   +3.067387195489112e-01   +2.842867965986241e-01   +4.282828007322330e-01   +1.809030939263392e-01   +3.604151932487865e-02   -8.661450030657880e-02; +3.367380338735220e-01   +1.177696922679616e-01   +5.328910580648432e-02   +1.827113442581462e-01   -2.319926185458659e-01   +2.428682208486023e-01   +5.530501247154451e-01   -2.350769499086460e-01   +5.153572934289091e-01   +2.529952328938255e-01   +5.729279454513658e-01   +4.969114236527555e-02   -1.438588303553207e-01   -4.533085786092410e-01   -1.497011267326422e-01   +3.427364487186474e-01; +1.785313025404558e-01   -2.250962915734384e-01   +8.484523061727264e-02   +5.135463927186054e-01   -6.632403185509946e-03   +5.176912986177317e-01   +6.153632306857435e-01   +8.331532035659247e-01   +2.510028347076839e-01   -2.557016669257203e-01   +5.506652965195625e-01   +2.901732664439549e-01   -1.071370436070877e-02   +5.012607998748115e-01   +1.492714819657251e-01   +8.772713663963776e-01; +4.400597012716276e-02   +1.552702280031407e-01   +6.447650132946426e-01   +5.439357743749852e-01   +4.190538831678328e-02   +1.459323626221792e-01   +2.728606934995856e-02   +1.416750955267364e-02   -5.040947655270368e-02   +6.680173635740033e-01   +7.597574934405175e-01   -1.737573343565880e-01   +3.750904142457562e-01   +3.787427391537759e-02   +3.037490945439624e-01   -3.265428591330529e-02; -2.835254737008414e-01   +9.628574289212051e-01   +3.960989408889914e-01   -9.289695745670887e-02   +2.883467968258459e-01   +3.194818823241445e-01   +5.543108866314000e-01   +2.710970748121774e-02   +1.278621663735224e-01   -3.884323361946204e-03   +3.108019956644324e-01   -2.236298784046495e-01   +2.764216464368441e-01   +1.104696583494009e-01   -4.162379163285283e-02   -4.672558313765613e-01; +2.895297381189454e-01   +2.686919059686630e-01   +5.449319422330051e-01   +5.897005536451815e-01   -4.443801785630649e-01   +3.028959144386545e-01   +1.769044287130419e-01   +1.992715531284726e-01   -7.218981505911560e-01   +2.896752867049798e-01   -1.372754594900590e-01   -3.754616270783224e-03   +5.407293077947792e-01   -6.266638740775218e-02   +4.436200010404961e-01   +7.082853666096183e-01; +2.256648730211855e-01   +6.336673141749973e-01   -1.404461978514643e-01   +2.064866826782792e-01   +1.913267664391550e-01   -1.740999251362704e-01   +4.947307686569888e-01   +3.188512025696877e-01   +3.068372907836074e-01   +8.408262377614985e-02   +3.622845446367549e-01   +8.958668532031587e-02   -6.626984053598098e-02   +1.740380158363351e-02   -2.252146077057465e-01   +2.247244328488482e-01; +3.349983941515907e-01   +9.260701296130999e-01   -7.504520197347667e-02   -5.440119157153878e-02   +2.706236702209925e-01   +6.462606227420755e-01   -9.836568576030173e-02   -1.944256812752906e-01   +2.961278507691717e-01   +1.193084942776225e-02   +3.529200783699008e-01   -6.384182770984605e-02   +1.464478263575663e-01   +3.298597771113288e-01   -1.669678455153328e-01   -1.589629440445107e-01; +3.973269408982089e-01   +5.871266064308241e-01   +8.620201484986574e-02   +2.488237787596220e-01   -2.988586608537025e-01   +1.712591319069366e-01   +5.413903706999191e-01   +2.738841636025828e-02   +2.533986956871009e-01   +4.099570758234609e-02   +9.973992300829413e-01   +7.324553521104270e-02   +3.288939486539599e-01   +2.933763746586643e-01   +7.309508105338414e-02   +3.183868959160356e-01; +3.551062519974653e-01   +9.313188991730731e-01   +9.679574413179011e-02   +1.324370065051793e-01   +3.343840846081056e-01   -2.956795583489278e-02   -2.692028056510474e-01   -8.772973826368320e-02   +1.249986045957990e-01   +5.098473852435946e-01   +3.078353289730695e-02   +1.570620254962247e-01   -8.277158165142360e-01   -9.713289364331568e-02   +2.108826629826652e-01   -1.949953287375501e-02; +5.115672625566083e-01   +3.097023588562512e-01   +1.604258465644121e-01   -3.760719865786687e-02   +5.542047856096378e-02   +1.923992386045434e-01   +1.698572980052991e-01   +1.011151553167515e-01   +6.395127824542576e-01   -4.327253292876282e-01   +4.301988512586621e-01   +7.217853998743734e-01   +7.017957351841827e-01   -6.528081509680668e-02   -3.491747179835399e-01   -1.044807890341990e-01; -2.360746993974575e-01   +2.278887444305493e-01   +3.248816174535021e-01   +4.550084191694368e-01   +9.371108328589799e-01   +5.844337522935684e-01   -2.992365073843658e-01   -5.244610687960734e-03   +3.577470439660781e-01   +6.336252929774250e-01   +3.691738866119033e-01   +2.658241273473169e-01   -4.503871048806918e-01   -4.033534121606729e-02   +2.930423828297630e-01   +8.215003482914580e-02; -4.902229322783513e-01   +6.046584892146399e-01   +2.251983989450777e-01   -2.522254062180802e-01   +2.363854387821276e-01   +3.524139898290428e-01   -2.037650001129982e-01   +3.406999577300487e-01   -4.179529516904523e-01   +1.035304900419311e-01   +7.509192259230851e-01   -1.481168544336731e-01   -8.007589665169536e-02   +6.615057958087606e-01   -3.309643014100921e-01   -3.038753590846024e-01; +2.550566301016736e-01   -2.537178245691273e-01   +5.623345748877080e-01   +3.400059765523661e-01   -1.606719542039174e-01   +1.496277003768840e-01   +3.454871463486221e-01   -3.995412529883625e-02   +1.255035951110710e-01   -1.943459187710475e-01   +9.081299999613882e-02   -8.594261161528263e-02   +6.209295500440527e-01   +4.929733887259721e-03   +1.966465350702339e-01   -9.697655542071977e-02; -6.899343899530046e-01   +1.757185632638150e-01   -3.954581929679316e-01   +3.541620945857588e-01   +9.195564072794584e-01   +4.676221278890694e-01   -2.750213986991560e-02   +6.572310748737712e-01   -9.669344861526044e-02   +1.624108315276064e-01   +3.844280092516711e-01   +2.315327067851665e-01   +2.966408974070590e-02   +3.029081449285539e-01   +9.714391586251730e-02   +2.833358975865438e-01];
L1E_L1I_iGABA_netcon = [+2.680651351606413e-01   +7.785027576775462e-01   -5.391993933749688e-01   -2.796704835744340e-01   +5.750821596594945e-01   +2.323930005467959e-01   +6.079142774766614e-01   +4.069797242006539e-01   -3.071222329916252e-01   -2.432260703002281e-01   -1.990620465863754e-01   +4.176631285823218e-01   +7.498925813042748e-01   -2.632909177216320e-01   +6.600939564744531e-01   +8.401305676515778e-01; -1.594638031334910e-01   -1.917041936150370e-01   +8.958815594598024e-01   -3.560325323765143e-01   +4.245758725395863e-01   -5.478388278611678e-01   +4.842459591172188e-01   +5.578969531077421e-01   +1.546310895373666e-01   +9.226607386596147e-02   +3.079259567409900e-01   -1.295763184732002e-01   +5.385193928283162e-01   +4.749230162270189e-01   +5.078916841100176e-01   +4.109090659983591e-02; -4.423931969706982e-02   +2.759467069410468e-01   -3.144605734488785e-01   +6.422013232781737e-01   -2.839359670247449e-01   -8.769910767149680e-02   +5.751437863244637e-03   -2.071395527960474e-01   -4.048730461377233e-02   +3.302446608040725e-01   -1.809019861528087e-02   +5.028710608137953e-01   +1.304893742214721e-01   -4.365945517846643e-01   +5.981843209681861e-01   -6.670468406690826e-02; +2.127866158326791e-01   -3.031710751043888e-01   -5.943925530589990e-01   +2.650228524888495e-02   -6.986822051216525e-03   +2.093415195724118e-01   +3.218554675741590e-02   -3.787610740110398e-02   +7.228548851202568e-02   +3.240711678012937e-01   +3.586711510780786e-01   +3.789217366013454e-01   -1.797860157955194e-02   +4.914793913297498e-01   +2.016172950406787e-01   -7.132136597351398e-02; +9.022863871114500e-02   +2.894799411859278e-01   +4.767786905924415e-01   -3.445209239827580e-02   +5.517977386293385e-01   -1.887802077577905e-02   +1.465425106755726e-02   -2.641784276758644e-01   +8.230424480090287e-02   +4.528257651152870e-01   -8.642940509454912e-02   +6.568285867628056e-01   +8.508205854930408e-01   +5.972117456125213e-01   -1.528930589897416e-01   +1.985767422048302e-01; +2.473188394112609e-01   +7.859605734351546e-02   +2.433392289834683e-02   -5.975463746350949e-01   -1.445983478670220e-01   +7.399938367582629e-01   -5.538669302035121e-02   -2.409537408268667e-01   +5.917610415393486e-02   +1.433361353261301e-03   -3.158088990420673e-01   +7.457121906255906e-01   +1.734637195215555e-01   -2.775660136872672e-01   +2.530771065574935e-01   +6.570973745387407e-03; -5.336504725420863e-01   -2.655300669887828e-01   -3.337489130866286e-01   -5.354204129077067e-01   +5.587757378639875e-01   -9.761821263207762e-02   -1.686294202932866e-01   -3.171569321815815e-01   +4.538354796571993e-01   +4.680063473207449e-01   +7.601718819616670e-01   -3.294870396774015e-03   -5.107847455331151e-02   +4.192702059678359e-01   +8.085357888116900e-01   -1.254439705927372e-02; +1.636124129123298e-01   +3.620782219564951e-01   -9.043169730217754e-02   +1.165068915061300e-01   +2.593136109332298e-01   -2.807648215698645e-01   +9.359057661920500e-01   +1.347917208838146e-01   +6.183290045718601e-01   +4.257394665798991e-01   +8.150139056104150e-03   -2.561986067972259e-01   +8.705243579122700e-01   +4.164120752888740e-01   +2.542113892521545e-01   +6.199998964064861e-01; +3.331697651789979e-01   +8.173365212415501e-01   +2.156880641124551e-01   -7.602624673039823e-02   -3.815892850198210e-01   +5.946099741648445e-01   +2.339794445001335e-01   -1.774421813942276e-02   +3.787149690572802e-01   -4.511245581798589e-01   +5.291417948118559e-02   -3.083156473500065e-01   -2.611411211314599e-01   +1.625005110517370e-01   +7.293885070764999e-01   -1.952628904353687e-01; +2.399777888388101e-01   +7.249489430700539e-01   +9.502004814028908e-02   -2.986456772045174e-01   -1.010367583452226e-01   +3.969244707100225e-02   -4.351059446223392e-01   -1.056132074051571e-01   +5.519022213987019e-01   +1.325584217634465e-01   -3.886879252455870e-01   +1.230878940254662e-01   +6.555715186672297e-01   +5.274821187084182e-01   +1.443478363931850e-01   +1.090895972244485e-01; +1.479358893418186e-01   +1.706424135311405e-01   +3.852717642096112e-01   +8.931837855502944e-01   +3.081939460258354e-01   -1.218060091508617e-01   +2.807620169645209e-01   -2.850194204804296e-01   +5.220526166866507e-01   +3.073189128962340e-01   -2.294825598389622e-01   +5.138368444646967e-01   +6.628906021065519e-01   +3.117344647455771e-01   +2.321648006785068e-01   -6.034793884835918e-01; +2.084019178694890e-01   +1.044469143926184e-01   +2.428000362448134e-01   -5.883361978382063e-01   -1.288086338616875e-01   +2.682726197295581e-01   -2.885824036418295e-01   +4.176266746237843e-02   +1.216602060424334e-01   -2.317383416308410e-01   +5.715057100652740e-02   +9.737287842011629e-02   +3.475812181954480e-01   +2.142654654644843e-03   +4.893260171868779e-01   +1.952487526368892e-01; +3.571038099378154e-01   +4.048794412791780e-01   -1.711149067243613e-02   +2.609118055476363e-01   -2.291202371712771e-01   -3.308166160265610e-02   +2.729437182264794e-01   +2.061308114795475e-01   +2.936442816431440e-01   -1.285718723762193e-02   -3.620948144964241e-02   -1.261313609356981e-01   +4.777542860236034e-01   +3.080392769789311e-01   +2.055130263685226e-01   +8.030580027916304e-02; +3.956707031405464e-01   -2.099261066520320e-02   -2.335771306033443e-01   +2.626485726099383e-01   +1.631872173469448e-02   -1.478058412500697e-01   +3.369104356070748e-02   +3.445464213149383e-01   +4.259296228789049e-01   -3.190892582874464e-01   +5.853270409911475e-02   +3.827409346747769e-01   -2.814847201036461e-03   -1.324911712941388e-01   -3.668572738243442e-01   -1.424477367815082e-01; +4.690612759795298e-02   +2.204569198347605e-01   +2.006947106858664e-01   +7.685415554855847e-02   -9.327502593976396e-02   -4.870794607442113e-03   -4.567647776606044e-02   -1.238083819618345e-01   +7.543423877842540e-01   -9.282674144063915e-02   +5.955658531812505e-01   -3.790548591727501e-02   -1.178521380949882e-02   -6.895462840807234e-01   +8.970127779587211e-01   +1.177300738220824e-01; -3.235798929809704e-01   +5.064516996752653e-01   -1.759799313606545e-02   -5.527361235270949e-02   -2.323988331594805e-01   +2.084164326491012e-01   -7.068338117117551e-02   +1.676641661777380e-01   -5.073684793345265e-02   +2.624513969483907e-01   -2.031367842167834e-01   +8.919480265419232e-03   +1.172662180628331e-01   +2.542399776995934e-01   -2.762906477404705e-02   +3.542955116989700e-01];
L2I_L1I_iGABA_netcon = [-2.223337431527180e-01   -3.812177480679048e-01   +1.724533983917026e-01   +3.274599626314486e-01   -3.454014491470853e-01   +2.609170546019974e-01   +1.068229816965797e-01   -2.739772079293761e-01; +1.331731135928602e-01   +5.116939351169125e-01   -1.549807978639677e-01   +1.209416836717257e-01   +6.256007453659594e-01   +5.690150539252792e-01   +1.266035538711791e-03   -1.721650418936197e-01; +4.330531656331884e-01   +3.053434758252295e-02   +3.867210205660605e-03   +2.693550460096106e-01   +1.002471787932323e-01   +1.377985608574211e-02   +8.495940721759922e-02   +2.836518645286552e-01; +1.226022557728484e-01   -1.309357146467786e-01   +6.735552875454819e-01   +2.715745771752966e-01   +1.362262049814990e-01   +3.707733282906703e-01   +3.000899804217129e-01   -1.119947086131607e-01; +2.241728889720488e-01   -3.634829629920704e-01   +6.381464862686977e-01   +3.653667057336194e-01   +5.032094194628781e-01   +4.512920874198992e-01   +2.846715008386769e-01   -3.684025141481900e-02; +2.379200660228036e-01   -5.601109457321564e-02   +4.020980681412254e-01   +3.777611563971756e-01   -1.142331753946810e-01   +3.273774060555473e-01   +3.275176008840981e-01   +3.407437973155216e-01; +3.669693762286258e-01   +1.912177966470350e-01   +1.785493588069832e-01   +1.152159110437675e-01   +2.067957718463350e-01   +5.867916094253645e-01   +3.300484208475488e-01   +3.292388551297718e-01; -1.708707075552218e-01   +4.958952102649410e-01   +2.946711821646052e-01   +1.629940576438566e-01   +4.130989750096770e-01   +3.010056590640493e-02   +1.471634997159487e-01   +1.404791639881028e-01; +2.128500535464608e-01   +9.251538935300689e-01   -3.008242785549306e-01   +5.910122923763008e-01   +3.481238740651278e-01   +2.191676724550985e-01   +2.813233927916192e-01   -3.801824370939905e-01; -2.179613360784524e-01   -8.634553377286125e-02   +3.577582992353532e-01   -7.187998952809016e-02   +2.717756406979564e-01   +4.153307052968962e-02   -4.772488816704745e-01   +2.172632959445940e-01; +1.592512457586672e-01   -5.949320410270652e-02   +2.256030925726651e-01   +2.547038132261856e-01   +2.450694659132610e-01   -2.028331122770945e-03   +1.917862673136328e-01   +3.688497152073310e-01; +3.520209669582858e-01   +2.759948337990954e-01   +3.129585964568760e-01   -1.006323502676529e-01   -1.789076531359981e-01   +4.513523943154581e-02   +7.171369103463799e-01   +3.201440301403806e-01; +2.987003391892693e-01   +2.577269915546190e-01   +2.702094301709008e-01   +1.864052484996747e-01   +5.706377337174241e-01   -1.577809213504521e-01   -1.555118160792002e-01   -1.638843486579193e-01; -1.921159313877402e-01   -1.497309009867915e-01   +4.114214446740992e-02   -3.938667706687748e-01   +3.162962330977063e-01   -1.843937384360693e-01   +4.096270122478235e-01   +3.309870457095954e-01; +3.621349900868092e-01   +2.276903791197424e-01   +3.642659004632594e-01   +1.235107423477030e-01   -4.053580061102834e-02   +7.762701018705437e-01   +7.212876911892062e-01   +4.146316025128807e-01; +1.312624459548204e-01   -1.734047736214594e-01   +2.472328589659377e-01   +5.191262008481244e-01   +2.404648508908142e-01   +3.087460688796521e-01   +1.758895104152903e-02   -2.221190570486438e-02];
L1I_L2I_iGABA_netcon = [+2.173516466264733e-01   -1.677314445734542e-01   -2.509128286863954e-01   +2.850531195460006e-01   +2.575434929765894e-01   +1.727184500840157e-01   -1.623984632391989e-01   +7.521290626435817e-02   -1.715955291818436e-01   +2.488602743843405e-01   -1.902456070448620e-01   +1.284384091035761e-01   +7.406016878524654e-03   -4.559482190582295e-02   -2.273487502909721e-01   +2.311487897731330e-01; +1.622721043292958e-01   -2.552457801114975e-01   +5.941415101075694e-02   -1.873651268357705e-01   -2.727544302895286e-01   -1.105856816108299e-01   +1.725614699443586e-01   +2.465036125605527e-01   -7.977235401891451e-02   +6.104102219772787e-01   +2.696502356176788e-01   -3.368299662197876e-01   +7.690889967562833e-02   -2.740219332409746e-01   +4.272988362448275e-01   +1.826046208376737e-01; +2.901977371370982e-01   -2.143975187788343e-01   +4.474361491006584e-01   -4.711105549536040e-02   +1.972282572092869e-01   -2.296089676391001e-01   +4.975624059927931e-01   +5.089934156476537e-02   -1.094063611900606e-01   +3.969943570872048e-02   -1.900716231216228e-01   +2.005204879215719e-01   +2.304007119618781e-01   +3.655980307387901e-01   +4.526756165955698e-01   -5.387189801281973e-02; +2.209441404447402e-01   +5.873574837046547e-01   +3.156559891852702e-01   -1.295824362855670e-01   +4.001021801201207e-01   +7.931698756915911e-01   +2.320432253691607e-01   +2.321117562771946e-01   +5.726093814115323e-02   +5.414872890330068e-01   +3.528394919224544e-01   +2.809550214348241e-01   +4.418936254174651e-01   +4.819384537772159e-01   +3.134318524773575e-01   +3.072527503155593e-01; -4.633930485485903e-01   +1.471364536689435e-01   +2.194584929319935e-01   +2.609379499652401e-01   +3.149894349334152e-02   +5.298168784653045e-01   +4.563262512868836e-01   +4.351559921520133e-01   +3.956467143170639e-01   +3.992796084055434e-01   +1.081136420329347e-01   -1.562072694552841e-01   -6.362884547503930e-01   +1.310214185743589e-02   +2.166560288459527e-01   +6.002421506574503e-01; +7.556633834149368e-02   +3.650799417657241e-01   -4.589080696699985e-01   +4.638757376148802e-01   +2.644995336905568e-02   +4.633054886510213e-02   +4.036672405686058e-01   +3.254320990168328e-02   +9.095746612492915e-02   +5.374787738480140e-02   +8.911405508319835e-02   -4.857166960246285e-02   +3.735513671461246e-01   +9.990085508268005e-01   +6.971042673409446e-02   +1.804425115986259e-03; +2.248423837185943e-01   +2.196091278787450e-01   -1.886583812810941e-01   +2.696222414208174e-01   +2.820226979753507e-01   -3.854979629079655e-01   +4.578637632647866e-01   -2.460169587153897e-01   -1.595963051946266e-01   -4.143226660707702e-01   +3.929224607785947e-01   +2.406655072693762e-01   +1.040219436292036e-01   +6.527948584686558e-02   +1.494901284460805e-01   +1.314443006662335e-01; +2.356142165596464e-01   +8.152118769804274e-02   -2.154681130750315e-02   +5.814638454793988e-02   +1.544480885906535e-01   +2.277355112726422e-01   -1.898705493886948e-01   +9.080669227282527e-03   +1.478704994782830e-01   +2.539608115697082e-01   +2.890151384530443e-02   +4.361012033872070e-01   +1.956144228061590e-02   +1.932487903493998e-01   +4.151859020813021e-01   +4.417581281909505e-01];
L2E_L1E_iAMPA_netcon = [+3.239056885995156e-01   -5.416120849397870e-01   +4.630106853078458e-02   +4.259109448872183e-01   +7.688347012860068e-01   +5.188158516713272e-01   +6.758074031706495e-01   +9.854036277284173e-02; -2.675786463042531e-01   +1.716052128777228e-01   -2.594651043028564e-01   +1.401151768392465e-01   +1.759459942153974e-01   +3.827507551086909e-01   +1.757837767291505e-01   +1.504904525978460e-01; +3.221756987971779e-01   +9.122656072900473e-02   -6.142138314985075e-02   +2.191007554597533e-01   -2.064284507827152e-01   -8.207830526466986e-02   +2.145612886535886e-01   +4.741763829632608e-01; +5.920997240971361e-01   -1.627993071241828e-01   -1.992899911882255e-01   +5.229875163864585e-01   -5.370109887342726e-02   +1.261837542052002e-01   -2.428260259565371e-01   +1.508269007418379e-01; -1.585177515310270e-01   +7.954379389321092e-02   +5.719519733787123e-01   -2.672649278406582e-01   -1.357630904527007e-01   +2.213916553091781e-01   -8.557743843082488e-02   +3.777758067226826e-01; +5.118560689328492e-01   -2.457017581297322e-01   +1.042590401491436e-01   +3.667864053580709e-01   +3.932347534487757e-01   +7.536281950626934e-01   +6.821352464480281e-01   +3.079614944625868e-01; -2.772270310910846e-01   +7.698298751138218e-01   +1.200489802828673e-01   -2.982791932914852e-01   -3.365692970627608e-01   +1.660168313112255e-01   +7.073179675124399e-01   -2.551433386638250e-01; -1.513284784561679e-01   +5.908293322130076e-01   +9.996805272631616e-01   +1.367916117842229e-01   -2.158458956238528e-01   +2.714294062001706e-01   +3.396305972166691e-01   +1.050199387332094e-01; +3.954517016584220e-01   +6.892801025729162e-02   +6.389797383618975e-01   +5.977009198278822e-01   -3.117816383965706e-01   +2.825365985618666e-01   +6.126183506341762e-01   -5.589165179930484e-02; -2.824062973165822e-01   +2.180108804332926e-01   +2.935892341437419e-01   +3.611181601387482e-01   +6.118896483610499e-02   -3.348215924244428e-01   -2.061601723645282e-01   -2.171770911978010e-01; -1.808744653317616e-01   +6.209442840223262e-01   +8.732132811919624e-01   +8.880966471246354e-02   -7.707222014736241e-02   +4.668165683028052e-02   -1.153783735210975e-01   +2.561532247042533e-01; +3.960837127796220e-02   -1.671565102524842e-01   +4.457706400987081e-01   -3.506137593829902e-01   -3.092462421039173e-01   +2.700740760962125e-01   -3.081485272713244e-01   -2.873248459422226e-01; -1.178531931841737e-01   +3.309578397477024e-01   -6.439801492557082e-02   -1.979119705540073e-01   +7.964076949528415e-01   -3.121586249922679e-01   +4.002511707657756e-02   -9.050011314596368e-02; -1.822637566057554e-01   +9.696498045769465e-01   -1.911621209631804e-01   +9.944845228417805e-02   +4.221354289044458e-01   +2.409846303401405e-02   -1.378741058078427e-01   +3.415483131765072e-01; +1.277727569325738e-01   +2.023034640529836e-01   -1.432940820363246e-01   +3.736474392367096e-01   -8.641023925342697e-02   -1.205102127132916e-01   -2.966642750600321e-01   -2.088832469400330e-01; +2.226707118662518e-01   -3.208003258959515e-01   -4.294767632813321e-01   +2.372324960002825e-01   +1.880732404341467e-01   +3.530788815834187e-01   +6.765436201758234e-01   +1.054133637492827e-01];
L1E_L2E_iAMPA_netcon = [+2.384391000248309e-01   +2.287460071907455e-01   +9.782909271512800e-02   -2.332025008029590e-01   +2.255864217671208e-01   +1.931347733139824e-01   +1.398065710710728e-01   +5.250137518598078e-02   -2.464081658155294e-02   -3.344237461311689e-01   +5.877469699975345e-01   +9.766573079011563e-02   +1.262701910436520e-01   -2.649060965067430e-01   -2.342382349317539e-01   +1.166679827517533e-01; +1.437346219339039e-01   +4.387793019498940e-02   +3.190919450145721e-01   -1.438482914554762e-01   +1.838280442067834e-01   +3.255273940551001e-01   +4.739808837890222e-01   +1.199362354690267e-02   -2.045732671508484e-01   -1.118752142465426e-01   +5.996593878943572e-01   +4.401206153486004e-02   +5.172547496498519e-01   +3.340231723381413e-01   +1.406194205915263e-01   -3.981758840401900e-01; +8.381414300298468e-01   -5.272913104257931e-02   +1.583677339091658e-01   +5.860506007144508e-02   +2.512627545014146e-01   -8.952258152563557e-02   -1.969712065859887e-01   +1.168574990935733e-01   -5.068846854158453e-02   -5.137472714229411e-01   +2.603587072072737e-02   +2.812590559852636e-01   -5.295327864591077e-03   +4.693145402287772e-01   -5.810137311575498e-02   +3.364076300953141e-02; +1.020677354377611e-01   +8.272961846374631e-02   -1.659676366423749e-01   +5.034407165839613e-01   -9.943125694000882e-02   +6.432003609905012e-01   +8.104660564235711e-01   -2.115466681733667e-01   -2.119286696144937e-01   +1.248413049947233e-01   +6.129556103297357e-01   -2.968918519867088e-01   -2.583666881063689e-01   +8.433815714570909e-01   +2.112148422038932e-01   -1.239214979231198e-01; -5.474018654055798e-02   -5.073027512946898e-01   +6.099960856405921e-02   +1.456941544904139e-01   -1.633008666513333e-01   +6.398399634019979e-02   +3.681722430455200e-01   +1.162188212932109e-01   +6.579450718667426e-01   +5.201030532769086e-03   +4.212881645216682e-02   -5.330559451777123e-01   -2.241792103356169e-01   -9.577098450235130e-02   +1.406680826415883e-01   -3.561410844548503e-01; +7.166351766152568e-02   +3.603962047116145e-01   -1.554213245246930e-01   +4.851365706340015e-01   +1.656171575635043e-01   -1.307850220769914e-01   +1.000000000000000e+00   -1.533256602816051e-01   +1.741362478579936e-01   +5.867512086979112e-02   +3.264937647766091e-01   -8.582468779959902e-02   -1.568174367604824e-01   -7.657765440760558e-02   -4.169082083895563e-01   +6.874223301508618e-01; +1.457864309466147e-01   +3.281283100210796e-01   +1.373177308858704e-01   -1.429852398075631e-01   +3.414702833824712e-01   +3.073170774561342e-01   +4.138850528476933e-01   -4.179987131474243e-01   -1.043670802644210e-02   +5.707790648544781e-02   -2.858587832448442e-01   -2.638949138956603e-02   -5.035072048868990e-01   +5.637112070361394e-01   +5.264729646488344e-01   +3.732901525898903e-01; +3.941796229840853e-01   +2.939535334689424e-01   +4.288286600200024e-01   +6.015027905140053e-01   +2.392527058408000e-01   +4.632127278165002e-01   +9.143845424466736e-02   +7.455655793248984e-02   +2.945320236602428e-01   +2.660191943485077e-01   -1.064094370021493e-01   +7.633595196213712e-02   -6.220239378518455e-01   +1.609786201429041e-01   +3.516555120076373e-01   +3.600460670109007e-01];
L2I_L2E_iAMPA_netcon = [+8.510486108540674e-02   +8.088386875081990e-01   +1.592763580305559e-01   -1.208864520137528e-01   +6.832259209303274e-02   +4.006973254814938e-01   -6.435844769295671e-02   +5.722439666813942e-01; +6.787370186796894e-01   +2.243245872833827e-01   +5.419212716310960e-01   +9.269098643346991e-01   +4.989791346894110e-01   +1.526280418872361e-01   +3.117851173216130e-01   +2.676618571034961e-01; -4.591277398909461e-02   +1.384793116401956e-01   -3.207561612310206e-01   +2.685933683445561e-01   -2.591409458279705e-01   -1.348341447112875e-01   +2.893428104874372e-01   +3.087260820735513e-02; +3.502454130088362e-01   +3.921693603763128e-01   -5.710052203991163e-01   +3.885104220337068e-01   +4.784047821668499e-01   -1.054246057057876e-01   +3.648067728614952e-01   +4.562754913063743e-01; +2.776629025829472e-01   +1.821212679789466e-01   -2.565783695892922e-01   +2.236515758440772e-01   +6.686667655876971e-01   -1.917517784970408e-01   +2.832854324863234e-01   -2.601020869344954e-01; +3.394054992930556e-01   +1.372495289407860e-01   -3.922633060977060e-01   +3.248164298457311e-01   -4.963454494658238e-01   +1.687797071241116e-01   +1.014487577603533e-01   -1.736146483222125e-01; +5.090698927833965e-01   -5.237028093032116e-01   +3.369779419820385e-01   +7.378105834563040e-01   +2.677799287230349e-01   -3.825328685039881e-01   +9.630179706754798e-01   -5.314517295208769e-01; +5.391630889921346e-02   -7.063450026995784e-02   -8.417413415204080e-01   +1.042163906211898e-01   -1.644206496225381e-01   -2.787170471207455e-01   +1.052215586746095e-01   +6.647112820569441e-01];
L2E_L2I_iGABA_netcon = [+2.508803602408909e-01   +4.043618055219373e-01   +2.869882759939032e-01   -2.345318143191545e-01   -3.455530523340456e-02   +1.030852492720558e-02   -1.546590820647655e-01   +7.052798118600488e-01; +2.091876488805133e-01   +4.735513670354930e-02   +1.350276018979031e-01   +9.811205410454185e-01   +4.782366297624411e-01   -1.071807675374495e-01   -3.519830374758015e-01   +8.397373607082488e-02; +1.154325238896516e-01   +6.587943182922588e-01   -4.340318568968488e-01   -4.979926457363229e-01   +3.013072922643137e-01   +6.344264866092995e-01   +2.314337561361383e-01   +2.804201609579050e-01; +1.719668389043002e-01   +3.516626589311665e-01   -4.211976290410135e-02   +5.116399234778797e-01   +7.327512612200220e-01   -4.003686457588725e-01   -2.148157336505638e-01   +8.220043391126985e-02; -8.632849859816469e-02   -5.329775854284327e-02   -6.968889551899457e-02   +3.468376443398777e-01   +6.348602632435516e-01   +3.445336907962079e-02   +1.619292761199138e-01   +2.169182269657180e-01; +7.051885047317911e-01   +2.764047310186913e-01   +3.398939372353305e-01   +4.624101494873240e-01   +3.330541113640810e-01   -1.067590645302246e-01   +4.293426870585969e-01   -5.234992403095743e-01; +9.667792731336056e-02   +1.153076844539216e-02   -3.672719531259216e-01   +2.945475709988397e-02   +1.102528283633726e-02   -1.034160413243811e-01   +1.307102009092907e-01   +7.506256337705154e-01; +1.579821488264724e-01   +3.198134500265297e-01   +3.852586747867108e-01   -4.703299018421365e-02   +5.218471347971507e-01   +3.549868810708317e-01   +2.902098802355234e-01   +4.328631325694903e-01];
L3E_L2E_iAMPA_netcon = [+1.774579066014476e-01   -4.024175469245922e-01   -3.240251387229471e-01   +2.452143392806451e-01   +6.602762243904997e-01   +2.405358365403874e-01   -3.517173195227310e-01   +9.810660047115560e-01   +3.886682044840349e-01   +2.751395355358957e-01   +2.303771933657242e-01   -4.815112622090197e-01; -2.927672109362787e-01   +3.006086844909216e-01   -3.643539414639029e-03   -4.701086927941446e-01   -2.608682457565871e-01   -4.916775029981068e-01   -4.048712074119457e-01   -4.713886601218924e-02   +2.111837016096092e-01   +3.591040126570438e-01   -9.097452589997024e-02   +6.590296610163930e-01; -5.781665986350646e-01   -1.291766897679454e-01   +6.560095359707786e-01   +2.985675039196570e-01   +1.264808849062433e-01   -8.093898304433281e-02   +1.135477158119072e-01   +1.534664727244203e-02   +6.177810184584244e-01   -3.980744364644099e-01   +8.079414594211923e-01   +3.301691620681469e-01; +3.006137891296452e-01   +4.800875641432017e-01   -2.095680239889913e-01   +1.355191512659916e-01   +5.048367954401826e-01   +3.135505258868947e-01   +1.829019708304155e-01   +7.148590554002521e-01   -3.318148707844312e-01   -5.107293007184186e-01   -1.520479154356613e-01   +2.250612319255874e-01; +2.033113606524072e-01   +6.906146506880241e-01   +4.094218188183349e-01   +1.071035650665474e-01   +3.589738941247613e-01   +5.541374454629154e-01   +4.328272927740295e-02   -6.245913464507037e-02   -3.431906009175733e-01   +6.017563869553573e-01   +2.049338409851299e-01   +4.358614227753643e-01; +1.995512746526942e-01   -9.784586041978312e-02   +4.807361095904806e-01   +1.416015337750350e-01   +7.070308200213651e-01   +5.969111757011515e-01   -3.879088247550818e-01   -1.206300573727584e-01   -2.194873116813722e-01   +3.175741548944773e-01   -2.660711778990764e-02   -2.367916983416608e-01; +4.792591509067591e-01   +2.069124942722328e-01   +1.348836843814478e-01   -1.326551296542289e-01   +3.136887989181864e-01   +6.244751046444375e-01   -1.069321869584269e-01   +1.601705031293728e-01   -3.333355297063399e-02   -1.701224556823940e-02   +1.475227245588745e-01   +1.989932320019763e-01; -1.939911789942373e-01   +8.258730789716152e-01   +3.304488565139587e-01   -6.638509445056370e-01   +4.541912560944879e-01   -4.523120782553347e-01   -3.628877502469793e-01   -1.279377565308425e-01   +2.032432568436652e-01   +2.080450080043762e-02   +4.062718796665328e-01   +7.577839703822691e-03];
L3I_L2I_iGABA_netcon = [+7.354478802660614e-01   +7.911282384532619e-01   -2.475302299000801e-01   +4.033389588274837e-01   -3.738686858473207e-01   -3.194735672259060e-03   +9.924668904595698e-01   +7.107429454929037e-01   +2.755313259944839e-01   +3.380031906836385e-01   +2.195827080527151e-01   +5.206384611667541e-02; +7.881705056939196e-02   +9.954844819157829e-02   +1.559648504576153e-01   -1.345476739280906e-01   +1.654760835660828e-01   +2.179981778199178e-01   -4.649930222305264e-02   +9.381480574680286e-02   +6.380446905709794e-02   -3.809920914500179e-01   +5.910971561765600e-02   +1.382686959009512e-02; +1.416055510652617e-02   -2.855003969279868e-02   -1.086706923407010e-01   -4.630368898779579e-02   -2.225872352941868e-01   +4.428999010178932e-01   +2.197442495713378e-01   +5.843252672291364e-02   +1.853800000797931e-01   +4.707908978624935e-02   -1.420682845747644e-01   +8.057035328253502e-01; +7.306884142177321e-01   +1.910712078816547e-01   +4.758624833265642e-01   -9.812922530813372e-03   +1.307824198957082e-03   +1.739946413755726e-01   -6.815531278404646e-02   -1.805415004126448e-01   +2.701913855056103e-01   +5.849797337788502e-01   +4.565593210476059e-01   -2.177014809488390e-01; +2.283208344188928e-01   +3.508933281660697e-01   -9.122277185245829e-02   -2.903839689917296e-02   +2.006388807374336e-01   +6.537066159364929e-01   +2.280191695109015e-01   +3.946560150798740e-01   +3.146234722564828e-01   +1.671120457544085e-01   +2.165686484023045e-01   +2.377588820046392e-01; -1.000201992695401e-01   +2.947330085387320e-01   +4.642100405860052e-01   +1.035077417128812e-01   +2.212038006152811e-01   +7.275800057647891e-02   +2.749722230652198e-02   -2.024756104318107e-01   +2.319407069749179e-01   +7.916770017930874e-02   -8.367406398211301e-01   -2.588041303950890e-01; +2.351311999755382e-01   +2.342005309563417e-01   +3.195202686160624e-01   +4.301374615554805e-01   +4.320961840431499e-01   +5.162157839797681e-01   +3.075008658806614e-01   +1.805081314893409e-01   -7.501504741423639e-01   +3.986607891889736e-01   +2.575551800372081e-01   -4.405525037174183e-01; +7.545919813607102e-02   -1.349777088882257e-01   +6.276378197033404e-01   +3.310214757143305e-01   +1.251891720652686e-01   +3.593798113539100e-01   +4.399033934782279e-01   +6.354635863868416e-01   +5.526496040099474e-01   +1.809192033979495e-01   +1.007070136925381e-01   +2.508984568325141e-01];
L2E_L3E_iAMPA_netcon = [+4.180969369923345e-01   +4.073292339857555e-01   +5.096750947340503e-01   -8.369634132006984e-01   -1.399893860358130e-01   +3.392889543137764e-01   +6.489948100843527e-01   +3.752195317794467e-01; +2.705140197230487e-01   -1.901374597941237e-01   -1.049343098121123e-01   +2.158644043810351e-01   +8.381372336941361e-01   -6.207702388243171e-01   -8.004357825835745e-01   -4.940421197188883e-01; +1.290738662265010e-01   -6.498296864806626e-02   +2.311881779596252e-01   +2.135111785952835e-01   +8.309249919592847e-02   +2.115247470198370e-01   +9.718482292331200e-02   -2.667326798338184e-01; +2.614472015183941e-01   +4.753686726533474e-01   +7.195052440812717e-01   +8.738772830542065e-01   +2.194819247321929e-01   +4.063728225266060e-01   +6.231768039727068e-02   -5.125603492487942e-01; +1.050994349190343e-01   +1.663414297362769e-01   +2.927028383537668e-01   +3.238048414330413e-01   +1.577545030090220e-01   -2.823681980840276e-02   +1.947273467945381e-02   -4.862971885940563e-01; +5.252964610269899e-02   +4.597225294767602e-01   +4.347862180476827e-01   +6.908924644017093e-01   -2.120578429808529e-02   +1.084246263374455e-02   -1.032982477311706e-01   +2.227624188159210e-01; +2.567224385712966e-01   +7.931500395208438e-01   +5.981650682626474e-01   -3.918861939365121e-01   +4.372706108422132e-01   +1.733848426077869e-01   +5.448584038755375e-01   -1.094548504060237e-01; +3.178400506743404e-01   +3.565748667183514e-01   +9.044681678100436e-02   +1.528886398267834e-01   -5.386601126087551e-01   +4.959900739523928e-02   +1.404023223595103e-01   +5.178887887400835e-01; -4.670365876625628e-02   +6.860034137808841e-01   +5.924847080068327e-01   +9.445008934768289e-01   -1.476136641177767e-01   -1.954483332322485e-01   +5.687636101994360e-01   +1.745666284916845e-02; -2.576033803330621e-01   -2.294918304237139e-02   +4.513273930970570e-01   +2.804003047590644e-01   +1.334157364551346e-01   -2.896336745149823e-01   +3.485318656253419e-01   -1.123547910516786e-01; +7.203019823350731e-01   +4.048671672467216e-01   -8.963975683260511e-02   +3.772673567405960e-01   +3.128925694710221e-01   +1.000000000000000e+00   -5.426348769836150e-01   +2.057298084848835e-01; -2.423428955293163e-01   +5.247825953170154e-01   +4.352242822998190e-01   +9.899242831527652e-02   -2.154169761932150e-02   +4.862188676308758e-03   +4.797858816796511e-02   +1.267988698271635e-01];
L2I_L3I_iGABA_netcon = [-1.986468953138837e-01   -9.925295450019465e-02   +1.763476569674131e-01   +1.900492441831293e-01   +2.465972661073148e-01   +5.959934934692099e-01   +4.036739150475073e-01   +3.547818696614339e-01; -3.514468524145845e-01   +2.797223544838500e-01   +2.202618501293647e-01   -8.253677172444444e-02   -1.849198823080938e-01   -1.655085957580249e-01   +3.285070018353831e-01   +1.675907663202289e-01; +5.747395023514357e-02   +9.966951836786726e-01   +4.430390904297627e-01   +3.105198587625301e-02   +2.636372036838777e-01   +4.499020813343393e-01   -2.388428026645507e-01   +7.195790714188458e-02; +8.264823165702208e-02   -1.096382132521004e-01   +6.521786144747488e-01   -7.715285070728267e-02   -1.468303176509799e-01   +2.479308972048218e-01   +4.614000008979268e-01   +4.037872803644174e-01; +7.661126677431915e-02   +1.195183276964155e-02   +2.620902003748397e-01   +3.268763278547548e-01   +1.883293902013535e-01   +2.884409946040446e-01   +4.798443878702026e-01   -6.499673767594887e-02; +1.057819750234822e-01   +4.547439701836750e-01   +1.653848006293567e-01   +1.842228182816665e-01   +4.196014880726112e-01   +2.580088279048889e-01   -3.381392818745274e-01   -8.390946355419888e-02; -2.126663965142842e-01   +8.253506353092918e-01   +3.160477912544071e-01   +3.485751349552897e-01   -2.246382456191551e-01   +6.532630868945163e-03   +7.525187773242595e-01   +3.828589514181823e-01; -2.470508039759398e-01   +5.322326413366898e-01   +3.110640464416086e-01   -5.094767249785056e-02   +1.957541664482226e-01   +4.972528655151974e-01   +2.182690834310253e-01   +6.272584248347832e-01; -6.224628712321656e-01   +8.963846558185112e-01   +4.659059606872107e-01   -6.255957625720038e-03   +2.155383982361209e-01   -3.970345046891729e-02   +1.914133737057097e-01   +1.235902714691088e-01; -9.945703878751529e-02   -2.791842175535949e-01   +3.282823254035051e-01   +2.784161542535437e-01   +4.073162480727948e-01   +3.570032402213321e-01   +1.144911204640101e-01   +1.130938957716660e-01; +4.367325429016333e-01   -1.060157978818956e-02   -5.174929467084476e-01   +4.744035439591111e-01   +6.202221135222848e-02   -1.695667102071790e-01   +2.317038598093535e-01   +3.938560753865623e-01; -2.524245962349942e-01   +4.624535164736349e-01   +1.703953042475629e-01   +1.347614562406854e-01   +3.823307641262951e-01   +4.026567081023875e-01   +1.229722143970042e-01   -6.640094150811053e-02];
L3I_L3E_iAMPA_netcon = [+8.348880477426641e-03   -5.217423286540359e-01   +1.157039008155500e-01   +2.368334881723919e-01   +1.648648152616721e-01   +6.133437808546590e-02   +2.098626344138076e-01   +6.412997923549733e-01   +6.558581051774048e-01   +2.854644867188481e-01   +2.072251635389694e-01   +6.405825828824271e-01; +2.561281134591619e-01   +1.246850027569404e-01   +1.506573145260195e-01   +5.074111898416535e-01   +4.750879507625749e-01   +1.712359749801229e-01   +3.933617641766839e-01   +7.362540930908229e-01   +6.413167622267071e-01   +3.697804824748420e-01   +9.311985569512048e-02   -2.234197227976080e-01; +3.154915850661140e-01   +5.664277534916475e-01   +2.855450782478302e-01   -2.306938871031762e-01   +6.927650079754369e-01   +3.549510030165159e-01   +4.760244978760058e-01   -1.760755682243386e-01   +5.082651045235719e-01   +5.626098353485608e-02   -3.702306963337444e-02   -3.817669351390362e-02; +1.380526590824149e-01   +2.331488084949684e-01   +7.748774541816665e-02   -2.687131659300978e-01   +4.389962683837158e-01   +2.111800242048996e-01   +1.000155449558682e-01   +5.851645052989427e-01   -3.062229475266497e-01   +2.777480913598931e-01   -1.682933074953503e-01   +2.720587572506716e-01; -1.489398847948051e-01   +4.795877583711093e-01   +8.236286638528231e-01   +3.782420502896796e-01   +2.353226131775232e-01   -3.555992923882743e-02   -9.490909542550607e-02   +3.883668422481243e-01   +4.383707088583982e-01   -1.956385951345580e-02   +1.417808819846562e-01   -4.109033743582181e-02; +2.675946102929587e-01   -2.122989920038601e-01   -3.547690273178301e-01   +1.111893613317087e-01   -6.380295095936274e-02   -8.441806801987752e-02   +6.815695595106820e-01   -1.545261389177135e-01   +1.407209638293014e-01   +3.476259942582515e-01   +2.588248222203174e-02   +8.768037368150223e-01; +2.946372353194142e-01   +5.302439522746302e-02   -2.117808427157492e-01   -1.264602555644302e-01   +3.166871308905550e-01   +2.083761047934079e-01   +2.514090445013548e-01   +2.455872435133949e-01   +2.572745083861185e-01   +8.293585130377670e-02   +2.399739750047912e-01   -1.304978760592019e-01; -2.313611795704189e-02   +3.985069464439613e-01   -2.657056085020251e-01   -3.465985944393027e-01   +4.136096320929804e-01   +3.163464411600816e-01   -3.620609711606063e-02   -3.208349550744034e-03   -1.886966747033698e-01   -3.105015684959833e-01   -3.705973151507786e-01   +5.258450645341543e-02; -3.104598215677433e-01   +7.222868596514749e-01   +1.873609619135043e-01   +7.353369676784784e-01   -2.026695886341076e-01   +4.344992210917253e-01   +2.913239934873471e-01   +5.235342193897635e-01   +3.123946511683706e-01   +3.684328893338514e-01   +2.310508071450978e-01   +5.291084860104293e-01; +9.063700014010136e-01   -6.510498666497109e-01   +7.737818607102245e-01   -2.462831037012914e-01   +2.257967397247052e-01   -2.881031181140547e-01   +1.686248569499495e-01   +3.266576021433742e-01   -4.794830702278385e-02   -6.813500672321088e-02   +4.166969652166174e-01   -2.480223472023558e-01; -1.355344669773932e-01   +5.842950901261355e-01   +5.300037628085291e-01   +4.078540061254494e-01   -1.973276744669828e-01   -9.020745968360413e-03   +5.246942545631039e-01   +2.739509287713483e-01   +5.476128994687612e-01   +1.389570676575307e-01   +1.338515347206588e-01   +5.303321842934600e-01; +1.799435967587600e-01   +1.010271384535164e-01   +1.464854059044476e-01   +5.962008469107221e-01   -5.197852636381745e-02   -3.340341757878694e-01   -5.201243629048319e-01   +3.950772083989985e-01   -1.177783354295545e-01   -2.992671672767935e-01   +1.701152303640866e-01   -9.511158145113842e-02];
L3E_L3I_iGABA_netcon = [+1.614357761800428e-02   -2.068057505359834e-01   +5.562721885914602e-01   +2.186231807533061e-01   +4.368126138636168e-01   -1.265197958297222e-01   -3.446415752041151e-01   +2.528182460773302e-01   -2.160736850649602e-01   +4.634056548289001e-01   +4.657562040361781e-01   +3.394495571843317e-01; +3.652744211350650e-01   -2.761180050151943e-01   +2.868930255239984e-01   -3.152609337707438e-02   +5.788856323514123e-01   -1.597976215994245e-01   +1.833579663135002e-01   +1.073195572193504e-01   -3.958727311276383e-01   +2.918719278030227e-01   -6.274760812122937e-01   -3.249591551797409e-02; +9.783222082001095e-02   -1.945030931574538e-01   -5.847191574404249e-01   -1.293270676120993e-01   -1.812928998774288e-02   +3.049479197765979e-01   +6.070129719083586e-01   -1.129155972654791e-01   -7.429319013072921e-02   -3.000618404171403e-01   -3.079791081908597e-01   +1.573895466345789e-01; +3.722433779745554e-01   -1.425142981614587e-03   -3.143246012754967e-01   +7.490007836512736e-01   +9.055789408962078e-01   -2.423049530717542e-01   +5.703023093731240e-02   +7.908257284540068e-02   +9.315717788434804e-01   +4.614175173030775e-01   +3.670768998637271e-01   -2.251008679095398e-01; +8.432126825673816e-02   +3.456489472345713e-01   -1.982777105825259e-01   +2.254420629054525e-01   -7.158813815529139e-02   -2.468070354937695e-01   +1.148768472561814e-01   +4.890085068756687e-01   -3.235772541596387e-01   +8.137765258623042e-01   +5.113459487495731e-01   -2.702489440879176e-01; +4.002305076300260e-01   -4.369607427664428e-02   -2.387692159535809e-01   +4.529066796846910e-02   +7.445051335326675e-02   +2.107674177683520e-01   +3.998510868079448e-01   -1.120337975931523e-01   +1.725420325181899e-01   -3.933446803019274e-02   -2.747686472369829e-01   +8.379377912348257e-02; -2.152311033137381e-01   +1.899822202113957e-02   +2.441690976932032e-01   +7.335240473363981e-01   -1.288296849212228e-02   +5.899569260879725e-01   +3.884627786038493e-01   +7.095408708259975e-01   -1.703465518216969e-01   +2.683702086404890e-01   +3.328966303483792e-01   +3.351444228082163e-01; +1.397298424026209e-01   +3.076269990373735e-01   +6.445698890110499e-01   -6.186816928226903e-02   +3.503526704135932e-01   -4.688618093743376e-01   -7.208835874894920e-01   +6.069723978682072e-01   -3.372167852704899e-01   -5.843092689204917e-01   +7.638759969622374e-01   +2.012514628601377e-01; +3.217164773181432e-01   -2.724643696868264e-02   +6.713107399102380e-01   -2.501687499401473e-01   +3.961269775539003e-01   -8.676080538965178e-02   -7.840191573459443e-01   -1.431149334559145e-01   +2.723146630519149e-01   +2.972566084177748e-01   -4.758033892485547e-02   +4.918593282660705e-01; +3.875575533988593e-01   -1.336393894040127e-01   +3.545993739037954e-01   -5.010070751856790e-02   -7.115832735532384e-01   +4.643088944821334e-02   -3.536989530743198e-01   +4.308547066285867e-01   -2.776238329472310e-01   +4.179166921517605e-02   +2.136875168981374e-01   +2.685830452604974e-01; -2.226491897635919e-01   -1.217929732233344e-01   +8.943450112103311e-02   -8.399317106974707e-03   -1.600239257652422e-01   -1.019237983633076e-01   +3.260504803624936e-01   -9.972574273980449e-03   -2.107580708610687e-01   -6.318952687364910e-01   +2.306752998728146e-01   +3.149897720849228e-01; +1.434993022015882e-01   -2.852280149611203e-01   -6.233172675157561e-01   -1.692243881065215e-01   +9.301671678451986e-01   +1.976803325379169e-01   +4.089974047003628e-01   +4.970590650466086e-01   -1.466631383955501e-01   -5.190088718587436e-01   +1.277730408058532e-02   -6.576128351315657e-01];
L2E_Input1_iAMPA_netcon = [+8.346588138049355e-01   +1.000000000000000e+00   +7.476274958323309e-01   +1.610999592953949e-01   +2.209909537822684e-01   +2.609677451499551e-01   +7.162046763090473e-01   +5.561294951651677e-01];
L2I_Input2_iAMPA_netcon = [+6.942005438015579e-01   +7.903085559306209e-01   +3.405115719610511e-01   +1.736447818376848e-01   -1.616051358361639e-02   +6.477061995696204e-01   -2.981660145832103e-01   -8.848869395509132e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
