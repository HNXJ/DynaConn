function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.004996119227901e-01   +1.538539158351793e-01   +3.550712671187702e-01   +2.077913773226947e-02   +3.998443249747384e-01   +5.069416004183916e-01   +3.058631908832041e-01   +3.146024624164421e-01   +7.700252797242002e-02   +3.082841536067144e-01   +4.257578780496822e-01   +1.692233968966570e-01   +4.332950836386599e-02   +4.779716396663432e-01   +1.517745516470767e-01   +3.970032183707198e-01; +4.678547737118554e-01   +5.526506231177214e-01   +1.858994558224052e-01   +2.733464549153204e-01   +4.585961096966522e-01   +1.407943462620410e-01   +3.039874976245275e-01   +2.076323581642986e-01   +3.034284725126896e-01   +4.689849087929017e-01   +4.201138398538003e-01   +4.593065842397668e-01   +3.839493121219730e-01   +2.162360016076924e-01   +2.560593375848156e-01   +3.621186756513686e-02; +1.575176626787003e-01   +1.652675488203960e-01   +3.122289546698784e-01   +1.444875549717819e-01   +2.024252151412683e-01   +4.383973958251731e-01   +2.777554089623644e-01   +3.558314627364392e-02   +4.457527402072214e-01   +1.201189092950319e-01   +3.226223837897644e-01   +4.666623990355385e-01   +2.192731491903300e-01   +2.893055671026823e-01   +4.388672357256272e-01   +1.709018198306895e-01; +3.350425546585881e-01   +2.766876338741991e-02   +4.061627316122186e-01   +3.413774243457641e-01   +2.212619049996712e-01   +6.291405256808237e-02   +2.032628009311881e-01   +1.378062267665377e-01   +3.957001427065741e-01   +3.437242242120382e-01   +2.099366089394456e-01   +9.832158746646091e-02   +1.129690995984799e-01   +2.680063703441336e-01   +4.807916518428310e-01   +3.788231291908338e-01; +3.173055356374559e-01   +2.839975365523167e-01   +3.871131056024703e-01   +1.138863181726533e-01   +1.722928197721286e-01   +2.299296702895945e-02   +1.776524504787386e-01   +5.341247756275871e-01   +2.874801037524260e-01   +4.181010211919169e-01   +4.865975886916369e-01   +2.869198407755316e-01   +1.897722287120994e-01   +8.467700393400629e-02   +4.727894721702280e-01   +2.124472394797723e-01; -4.433380364183546e-02   +1.989059449605432e-01   +4.798438502534573e-01   +1.333562019628542e-01   +1.906471323518354e-01   +1.208795610216847e-01   +3.419968371216180e-01   +3.370297296389836e-01   +4.678898740215163e-02   +1.600659931454688e-01   +1.015317358964519e-01   +1.765614097416224e-01   +4.379191504742211e-01   +1.401447799915601e-01   +4.167276053027167e-01   +3.179978103809619e-01; +5.255909923348135e-01   +3.923311165648642e-01   +4.358286616132678e-01   +4.909925797582260e-01   +3.183723276577131e-01   -7.394640918713802e-02   +5.053781659633251e-02   +1.213442289656137e-01   +4.878338316621880e-01   +1.599170920568837e-01   +1.839997249971636e-01   +2.076704642947611e-01   -3.306446805648658e-02   +4.184757119436642e-01   +2.379038576772993e-01   +3.698384352729238e-01; +4.457175828275717e-01   -6.245723221879643e-02   +3.058068875506824e-01   +4.952764796971336e-01   +5.290321551074656e-01   +4.261305059168402e-01   +1.775637621964639e-01   +2.260884933570310e-01   +2.028057489659416e-01   +3.850158767493493e-01   +5.923880312579276e-02   +3.640555856807803e-01   +3.908804365953589e-01   +2.339190463239000e-01   +8.857725480737429e-02   +4.217167094888200e-02; +3.334135663083683e-01   +4.208235323886201e-01   +4.786525958673333e-01   +6.523617097734367e-02   +9.567830417345752e-02   +2.100593442464111e-01   +2.467359088289798e-01   +1.191753699790485e-01   +4.283982212780412e-01   +1.393510564333965e-02   +3.907911085520256e-01   +2.687116547648681e-01   +1.790220281467983e-01   +1.315761171166764e-02   +3.607711226246638e-01   +2.063843917281053e-01; +3.157911287759999e-01   +4.567545241644029e-01   +4.883363124395838e-01   +1.642358218728716e-01   +4.142001894801702e-01   +2.065736317860229e-01   +4.384611943102839e-01   +4.160898916348613e-01   +4.368551380112646e-01   +2.735305840439847e-01   +5.138548170636652e-01   +4.682741151752225e-01   +3.990940554045440e-01   +3.792089289665581e-01   +3.314657407118869e-01   +4.397643691272237e-01; +1.124994836341643e-01   +1.278442172960144e-01   +1.300567423597558e-01   +3.126156675936918e-01   +4.576407566556401e-01   +1.879154391496958e-01   -2.425738235275680e-02   +2.306772259636646e-01   +4.106597607378302e-01   +2.102071802242579e-01   +2.593223855825336e-01   +4.471997050211509e-01   +2.622511743411595e-01   +1.283653554943546e-01   +2.846275131344759e-01   +1.705966382688167e-01; +2.917940573263707e-01   +4.151151040759612e-01   +1.153102991621171e-01   +1.567182238631294e-01   +1.134604750423089e-01   +2.736758986598538e-01   +2.380658183681674e-01   +1.162431907970942e-01   +4.317682489021531e-01   +1.513210613765973e-01   +5.756918529713514e-02   +1.929027666484275e-01   +2.809646172382268e-02   +4.572177952191030e-01   +7.673838516739684e-02   +4.943833656846010e-01; +1.145182078301460e-01   +4.114175988736004e-02   +3.776505095535237e-01   +4.387136463756184e-01   +8.965740257828250e-03   +4.359188102456855e-01   +2.818222086905756e-01   +2.647112861025837e-01   +2.371236553959282e-01   +2.159014695931941e-01   +4.440343834682877e-01   +1.633092470835029e-01   +4.833661820009960e-01   +6.941746934130241e-02   +9.940209828594497e-02   +3.286327298020701e-01; +3.553297501483209e-01   +4.611077390430499e-01   +2.444231964626764e-02   +4.468867838142873e-01   +4.125035081441614e-01   -1.827497095700954e-02   +2.399257646698839e-01   +4.166743031425956e-01   +4.080632240086490e-01   +4.496551039322098e-01   +4.169494606331103e-01   +1.904173258290337e-01   +9.160765004188287e-02   +4.624319595883816e-02   +2.636156508662832e-01   +3.565165154561877e-01; +3.084239941881513e-01   +4.861731556776564e-02   +3.924103830683281e-01   +3.682954276995438e-01   +3.488708516117434e-01   +2.035409723374549e-01   +2.957910689141128e-01   +2.102815408074211e-01   +4.014870484804062e-01   +4.872302941521657e-01   -4.676208908242507e-02   +3.730458893040277e-03   +7.014101870597070e-02   +4.022231208391828e-01   +5.249670937471154e-01   -1.721949293814782e-02; +2.755976123191796e-01   +3.303180532908587e-01   +2.109118037968928e-01   +2.222393272151924e-01   +2.546840302328065e-01   +4.241187548397907e-01   +2.952686891001734e-01   +4.491226831194335e-02   +6.687054978116690e-02   +2.339589940094927e-01   +3.681874257412977e-02   -4.162362918315621e-03   +1.391321041933671e-01   +4.616358833708513e-01   +5.128494684570061e-01   +4.440245296465957e-01];
L1E_L1I_iGABA_netcon = [+3.117021776671436e-01   +1.636398094163636e-01   +7.931161340007595e-02   -2.383300997795072e-02   +2.671243546786766e-01   +2.445676897770469e-01   +1.353284078429378e-01   +2.185321666662434e-01   +4.489110824510006e-01   +1.721611476606508e-01   +2.319008744473092e-01   -3.227923798614364e-02   +1.910651724799179e-01   +1.588565837937580e-01   +1.451577328250564e-01   +2.666869705239305e-01; +2.902317740275458e-01   +2.086387633533747e-01   +3.970237538089534e-01   +1.902330351248912e-01   +3.687266991241873e-01   +1.961882622347977e-03   +4.492389308138228e-02   +7.717974631632131e-02   +2.903061194113711e-01   +2.560800738146957e-01   +5.024137645717986e-01   +2.860620980244604e-01   -7.048464690786290e-03   +2.583608277236341e-01   +1.362496758274488e-01   +4.351909497000071e-01; +3.819747214860874e-01   +3.707994013856606e-01   +3.142650276489339e-01   +3.984833087249922e-01   +4.664229237310237e-01   +5.610733650506574e-01   -5.452334092126348e-03   +2.031889037435470e-01   +2.638288918876542e-01   +4.882380261364088e-01   +3.880477196813786e-01   +4.335301576514194e-01   +1.493272174209858e-01   +4.847012386580761e-01   +4.813365043209252e-01   +3.092941264241039e-01; +1.431059921870642e-01   +2.856748571546334e-02   +1.584951178060864e-01   +1.994581006822543e-02   +1.355214329098144e-01   +3.521926041479879e-01   +4.606894934022649e-01   +3.088404287929997e-01   +7.097306738313133e-02   +1.034496646459243e-03   +2.317278540582874e-01   +1.498147373998624e-01   +3.799143138623093e-01   +1.658361614359338e-01   +1.968246860328509e-01   +4.191204025602565e-02; +2.065341573916389e-01   +4.720828508589544e-01   +7.483096211928293e-02   +3.527351014580456e-01   +1.844712469891243e-01   +3.191853796824705e-01   +1.356457518056773e-02   +6.555957456970163e-02   +4.298011405117713e-01   +4.186518219090177e-01   -8.801604175621366e-03   +3.625549315252946e-01   -3.851990443670160e-02   +3.046893235934132e-02   +3.640085292353457e-01   +2.758834255295826e-01; +5.291730033884101e-01   +2.600529685029138e-01   -1.253843220925778e-02   +1.062295381127972e-01   +2.184001705298233e-01   +3.994549324167114e-01   +1.814405920642756e-01   +3.477747051958454e-01   +3.281586208510289e-01   +3.541549368143937e-01   +1.518221197588059e-01   +3.735154072620429e-02   +7.942586656781547e-02   +3.939439758854034e-01   +4.525875968535055e-01   +4.010868393504732e-01; +1.033514856747705e-02   +3.901940218064351e-01   +2.615712677857396e-01   +4.719412939967165e-01   +4.823114791633202e-01   +3.178069588995487e-01   +5.428462338996566e-01   +2.589985764111339e-01   +1.007885932641388e-01   +1.021394338285002e-01   +4.850183435044694e-01   +2.946549118874747e-01   +1.595099738754061e-01   +5.237165921678525e-02   -6.032929109746848e-02   +4.200585260901829e-01; +2.827197750643080e-01   +1.251316225168080e-01   +3.707101965627807e-01   +3.150711235359455e-01   +2.989983613317410e-01   +2.795426275240824e-01   +4.185513313373556e-01   +1.880374299237242e-01   +2.922177810003509e-01   +8.046511968617019e-02   +1.672306719152693e-01   +2.916921569402687e-01   -7.512286972772233e-03   +5.106900510546863e-01   +1.347615863403503e-01   +4.284669543593750e-01; +1.544442959905816e-01   +3.768137165299819e-01   +4.237939712538546e-01   +5.109719214637447e-01   +3.728700558864682e-01   +1.286806300955289e-01   +4.796896187245729e-02   +2.192329446829729e-01   +2.350911405740568e-02   +5.528102138845156e-03   +3.611700714738879e-01   +4.267750626229411e-01   +3.715852185225723e-01   +2.741898877540986e-01   +1.941548794594052e-01   +6.773807712632697e-02; +9.691844373180870e-02   +4.697596353130113e-01   -8.220945364872731e-02   +4.219734817321188e-01   +1.973081121334071e-01   +2.677094832277088e-01   +9.574911750816717e-02   +2.777976593562133e-01   +3.372632688014258e-02   +9.173801184661164e-02   +9.303196112425988e-02   +1.542417054486609e-01   +1.450097804012633e-01   +1.088538584811404e-02   +1.373418048661173e-01   +1.586786001606467e-01; +4.880572182011322e-01   +4.142887768211938e-01   +4.258437860134656e-01   -1.726341959378186e-02   +4.221014392096423e-01   +1.436866204529250e-01   +3.991431767130565e-01   +1.533852088182130e-01   +2.695323222772207e-01   +9.426826129086327e-02   +3.607719055555935e-01   +4.732063783790083e-01   +5.013726997785751e-01   +2.155218965082729e-01   +3.138133465738246e-01   +1.243175915036255e-01; +4.045994544437225e-01   +9.216605217624368e-02   +1.810097012196445e-01   +2.715679737838597e-01   +3.940480289018581e-01   +2.667927148677323e-01   +4.918770988089146e-01   +2.026318853681679e-02   +3.961796769878824e-01   +1.810155443721295e-01   +3.870831004221306e-01   +4.801747449255682e-01   +3.723082075007771e-01   +2.965279405278923e-01   +1.781505311660841e-02   +4.886642731801186e-01; +2.354960452320295e-01   +8.427897278884729e-02   -2.675234299770807e-02   +1.048494599091909e-01   +3.789407567163386e-02   +2.290323116648551e-02   +2.163559500943987e-01   +5.059943235154557e-01   +1.428369206713230e-02   +4.856709005786398e-01   +1.668016794469039e-01   +2.461613299608664e-01   +9.689915562921836e-02   +1.662668151265644e-01   +2.103521758374421e-01   +2.477238901823663e-01; +1.612975611052037e-01   +3.291557375549903e-01   +5.075988009272779e-01   +1.118698453014266e-01   +4.887417386339056e-01   +5.253672100464923e-02   +4.418995661115349e-01   +1.538846165785525e-01   +2.005975538184593e-01   +1.560612663715214e-01   +5.086877775415251e-02   +4.901904299905020e-01   +1.742667749625468e-01   +8.078029813667519e-02   +1.042685838576473e-01   -3.050892307126036e-02; +4.722240023978827e-01   +4.398190448839362e-01   +2.637057963366585e-01   +1.593381861954342e-01   +1.064069325945235e-01   +1.983444794627398e-01   +1.269677258026380e-01   +1.280801885730635e-01   +1.693288941736742e-01   +6.794401183039607e-02   +1.924337779246141e-01   +1.810959578710913e-01   +5.175841235796422e-01   +3.476649209623315e-02   -4.882964841378354e-02   +2.012155854779245e-01; +3.836445654054468e-01   +4.427325696197522e-01   +4.724734050076045e-01   +1.704110106589635e-01   +5.696054243634329e-02   +1.450404568422658e-01   -2.326708854833363e-02   +4.205355434783778e-01   -1.661659127698836e-02   +2.591688032604567e-01   +1.694234854574874e-01   +4.818279423140526e-01   +1.732912405142151e-01   +2.973625926409535e-01   +5.281600093774921e-01   +5.827859957866593e-02];
L2I_L1I_iGABA_netcon = [+4.161464209661383e-01   +1.916465213867058e-01   +1.557293952182319e-01   +4.897596498924266e-01   +2.952282102425627e-01   +3.259597006925639e-01   +1.627864422180224e-01   +5.504397481412664e-01; +1.081720883140598e-01   +5.477672750474992e-02   +1.044950770439099e-01   +3.275973358702856e-01   +1.447245487542612e-01   +1.072276406098553e-01   +3.389345848376968e-01   +1.426117152967807e-01; +2.489043747958817e-01   +4.210983680912714e-01   +3.065672528003265e-01   +1.726912231795604e-01   +3.662065294420384e-01   +4.713245188203471e-01   +3.140951043430282e-01   +1.236249153409348e-01; +4.915180684804527e-02   +4.221310384841607e-01   +2.449127492944956e-01   +4.193461721663997e-01   +6.134140110713990e-02   +4.783529881305671e-01   +3.003432617249991e-01   +4.854518387966381e-02; -6.042520685381835e-03   +2.014615003442411e-01   +2.297148723243228e-01   +2.975501953677305e-02   +3.333720187231586e-01   +3.146670727471600e-01   +3.297335558168404e-01   +2.864490613054215e-01; +1.903049198526964e-01   +4.302629789489065e-01   +1.301667944537975e-01   +8.738403176151262e-03   +4.635097085916148e-01   +1.258194229953272e-01   +4.482933881197675e-01   +2.444999279569099e-01; +7.166865887982592e-02   +2.112926975434369e-01   +2.273807660237159e-01   +2.862168367403811e-02   -5.254496062146851e-03   +3.518488092769250e-01   +3.137062987462531e-01   -3.017986678897011e-02; +3.989032660567722e-01   +2.652571652809447e-01   +4.428578008367555e-01   +3.206909514556732e-01   +1.725611849413445e-01   +6.355395550189462e-02   +3.655936821653105e-01   +1.021862668525937e-01; +6.987092390958413e-02   +4.166627798719960e-01   +3.244119415592703e-02   +3.764945376567443e-02   +4.455529642711260e-02   +3.290678866047093e-01   +4.429296932650576e-01   +2.681689729952933e-02; +1.276593652995923e-01   +4.898731469516664e-01   +3.803078244275080e-01   +1.134535999170619e-02   +3.242605980807529e-01   +1.284174098216941e-01   +1.074755518579090e-01   +3.195001725186321e-01; +3.161691539429262e-02   +4.439741160920221e-01   +3.305433922031826e-01   +3.194580796042329e-03   +2.798780439855131e-01   +1.280317918876674e-01   +2.006792757311042e-01   +2.964634681592693e-01; +4.227583268671653e-01   +1.372338846487619e-01   +9.533576866947119e-02   -4.874447448882085e-03   +2.173157078208177e-01   +1.107781817295624e-01   +1.773607642728012e-01   +8.564863729025832e-02; +3.189730430317917e-01   +4.940596099488152e-01   +1.349262712199899e-01   +2.696273380355474e-01   +2.626404677140353e-01   +3.864928241385583e-01   +9.685162005376688e-02   +9.115180513854189e-03; +2.434477930543827e-01   +1.055507948002500e-01   +2.107641480699639e-01   +2.041430602005484e-01   +2.200438819954079e-01   +1.218972072795386e-01   +3.869118865375377e-01   +2.544251197002378e-01; +4.039590869359223e-01   +2.157115975254933e-01   +4.300372930916441e-01   +4.418246371162742e-01   +2.893380148389225e-01   +2.924667282454648e-01   +3.045709889445875e-02   +1.191148586355608e-01; +8.612811904073771e-02   +5.251883916298932e-01   +2.900809288534605e-01   +3.883028968323086e-01   +3.663030426534289e-01   +5.261329902816921e-01   +2.832092601548311e-01   +3.706944068162306e-01];
L1I_L2I_iGABA_netcon = [+4.272423540982056e-01   -7.255084628838117e-03   +5.177776326764717e-01   +9.937710730935750e-02   +3.166164205937669e-01   +6.118161837507992e-02   +1.252299849742952e-01   +2.603596662985639e-01   +7.368137012393210e-02   +2.239697125020376e-01   -9.398946548050757e-02   +2.188468917525953e-01   +2.031620088068145e-01   +1.226097468938876e-01   +3.151045646818963e-01   +4.343006151267231e-02; +2.430843285828895e-01   +4.494087418639718e-01   +1.806598310722020e-01   +4.522048825340685e-02   +3.015167866985006e-01   +9.027586672969774e-02   +4.802043952429226e-01   +3.668664226742349e-01   +3.921733181638144e-02   +1.633251458240737e-01   +2.782041567864817e-01   +1.355131020972542e-01   +2.226657976564690e-01   +2.607312906251694e-01   +6.904550742725207e-02   +1.056575433149069e-01; +1.130577121032379e-01   +1.281655806086266e-01   +1.896407697954770e-01   +5.854927222159277e-01   +6.635558839920347e-02   +2.965066368395205e-01   +1.733910946760577e-01   +2.678847423590333e-01   +4.956515601509983e-01   +7.418674331161540e-02   +1.511541225007402e-01   +4.465979004488782e-01   +5.211391558981333e-02   +3.536592302023198e-01   +2.086891371845145e-01   +4.753129390482401e-01; +1.514189568185777e-01   +7.215469843146712e-02   +4.604910668005198e-01   +3.135840138829064e-01   +1.236853417659144e-01   +3.952143618582029e-01   +1.879461782188402e-01   +3.272363852860573e-01   +2.650534973726193e-01   +1.965570380701957e-01   +4.212533166382750e-01   +1.156702934892048e-01   +3.995514862694192e-01   +3.922992038242582e-01   +2.259527684733726e-01   +1.821399605439303e-01; +1.941850930115457e-01   +4.144174592622760e-01   +1.648345973617207e-01   +2.959732832821340e-01   +5.355949902864962e-03   +3.754810531445808e-01   +3.776487006086905e-01   +5.423687036835746e-02   +2.593422432703970e-01   +1.459141508100852e-01   +2.092753449442027e-01   +2.287278177483171e-01   +4.229498988325291e-01   +1.794357589503559e-01   +2.254718924330925e-01   +2.019299111039973e-01; +2.453198434009903e-01   +3.262089042466686e-01   +3.668772571088216e-01   +4.290050702698075e-01   +6.925883370946236e-02   +1.870260708642527e-01   +6.838381766755704e-02   +7.887342627687749e-02   +4.698908618308077e-01   +5.103508665226337e-01   +4.947294196083338e-01   +1.481626222777254e-01   +3.031138859114992e-01   +3.189210169320312e-01   +4.143302791978905e-01   +4.484120785994089e-01; +2.877503439866274e-01   +3.209426391317064e-01   +2.583391707689227e-01   +3.898370543231758e-01   +3.674339776799059e-01   +4.328666273306038e-01   +2.808585928396442e-01   +3.154287544391696e-01   +1.708598164070081e-01   +4.199334399675388e-01   +1.659142320787878e-02   +1.714098027959830e-01   +2.827658722270315e-02   +1.977640487947985e-01   +3.320032384775612e-01   +5.128022492272207e-02; +3.842484587695126e-01   +1.080495381111551e-01   +4.147646711919039e-01   +1.055737781662458e-01   +1.199774204514036e-01   +4.853394831088134e-01   +8.660861538185867e-02   +3.189994002899189e-01   +1.680576835376955e-01   +4.721372463576946e-01   +2.823451275672725e-01   +1.262168698433130e-01   +1.949206319352231e-01   +1.041901256630039e-01   -2.596872627130635e-02   +8.519302012310037e-02];
L2E_L1E_iAMPA_netcon = [+2.509626688730487e-01   +2.250326775286277e-01   +4.698036837665170e-01   +1.676326466218041e-01   +7.478908898113065e-02   +2.278291655501299e-01   +1.681951126796538e-01   +4.195086875790855e-01; +2.464978074105589e-01   +1.027554537900630e-01   +5.081069647848305e-01   +3.642317863288123e-01   +4.070445247818507e-01   +3.329906527283714e-01   +6.697981052615128e-02   +2.225807931402003e-01; +4.176450558597438e-01   +5.370191656342144e-02   +8.351767386791473e-02   +2.680710929500579e-01   +2.732682018094109e-02   +3.720622382679389e-01   +1.890540045272333e-01   +9.041650926964281e-02; +4.165978136982773e-01   +1.649243221274984e-01   +7.835874348781285e-02   +1.793750346720894e-01   +1.406990922195544e-01   +1.234561904318581e-01   +1.964777561390331e-01   +4.166288004144372e-01; +2.128868872807501e-01   +2.845152116875082e-02   +1.016048272028226e-01   +4.870900556751030e-01   +1.070368223097616e-01   +3.880174854490653e-01   -2.687527749152855e-02   +1.804511566534648e-01; +1.500580767503903e-01   +3.453705022724317e-01   +1.740712509492118e-01   +5.017028818138715e-01   +4.997813357897654e-01   +2.141043572641148e-01   +3.407478727592071e-01   +3.834450563227700e-01; +3.763403488657794e-01   +2.620720437008152e-01   -2.376715937699239e-04   +4.392330828376897e-01   +4.624316734096371e-01   +2.701010136443838e-01   +3.564455414848384e-01   +2.020462152754061e-01; +1.371823535771800e-01   +1.701270289901070e-01   +4.603983238655508e-02   +3.844864959324023e-01   +1.507073904056065e-01   +4.232603938124928e-01   +3.064823529044138e-01   +4.697616244956988e-01; +9.314852794811602e-02   +3.240599386438119e-01   +1.585098921553781e-01   +4.552811577403929e-01   +1.818555404882339e-01   +3.994568372473798e-01   +3.228539340938233e-01   +4.380868814627790e-01; +2.598584203271901e-01   +4.537183378452973e-01   +9.510204646883794e-02   +1.517170955246233e-01   +4.259052700732620e-02   +1.683217659934006e-01   +1.060957196050234e-01   +2.310051606717810e-01; +2.053925786747983e-01   +7.152856182955353e-02   +6.307283752711364e-02   +3.673077065481747e-01   +1.548672228467563e-01   -1.896899143011190e-02   +3.556387096055872e-01   -1.705957245148641e-02; +3.294368608859310e-01   +3.109341876244004e-01   +4.752836309989854e-01   +3.062898037035901e-01   +2.204099768597318e-01   +3.534682309503301e-01   +1.163079511960890e-01   +5.778083266540800e-02; +1.127010328616271e-01   +3.414191112059329e-01   +5.303803373328999e-01   +3.721204600369410e-01   +4.062169659102228e-01   +1.357123558240180e-02   +1.697830162534602e-01   +4.835613424187331e-01; +4.247361406052960e-01   +3.578171535913456e-01   +4.396257565338444e-01   +1.688264323774091e-01   +3.609126456157986e-02   +1.572089400983784e-01   +4.465114381812368e-01   +3.290075454437880e-01; +3.148566425008372e-01   +6.574202699464031e-02   +9.087116401206215e-03   +4.134966624118375e-01   +4.710216631318931e-01   +3.945637058141072e-01   +2.009574736468290e-02   +2.032402783957751e-01; +2.506492557489718e-01   +4.412829433397683e-01   +1.527811173681843e-01   +3.166495638747786e-01   +3.567496206394435e-01   +3.984025428535291e-01   +1.403718967789430e-01   +2.994463090117517e-01];
L1E_L2E_iAMPA_netcon = [+1.900866982217836e-01   +1.194925743588243e-03   +1.028247716452791e-01   +9.747775479596610e-02   +4.287682570539259e-01   +2.953786339526758e-02   +2.356974306025184e-01   +3.018730871113011e-01   +5.793306484318956e-01   +2.688343087176603e-01   +4.011720888069154e-01   +4.684948621456930e-01   +1.600516916934185e-01   +2.198749245464315e-01   +3.787434122999898e-01   +2.263692383255425e-01; +3.642047673948626e-01   +3.602685705704373e-01   +2.562632706248755e-01   +1.358415905267851e-01   +7.325323068364201e-04   +1.121734652499801e-01   +4.495339870355622e-02   +4.687424009522709e-01   +4.331684864995379e-01   +4.154100128836471e-01   -3.175373982857130e-02   +8.407657524066586e-02   +2.801692803445018e-01   +2.538601710688833e-01   +7.635671472262602e-02   +1.841108890592268e-01; +5.445491489723441e-01   +4.090046719441767e-01   +2.377466583088731e-01   +3.979355951282990e-01   +2.262150543786427e-01   -3.078155936341775e-02   +2.213900549904393e-01   +1.543028497956687e-01   +2.229671946327247e-03   +1.101285325647799e-01   +2.334413242686190e-01   +3.737992293933852e-01   +7.573898094549303e-02   +4.860768605021359e-01   +3.009908799507336e-01   +4.861051526683624e-01; +2.547988639704418e-01   +3.616417378536300e-01   +1.066343509512813e-01   +1.727823027825660e-02   +2.020432411001609e-01   -2.820716804726911e-02   +2.656556071555253e-01   -5.588922305161288e-02   +3.209920645746179e-01   +4.752148254392703e-01   +2.698112683177523e-01   +3.604932400266445e-01   +1.569258495179199e-01   +3.577663748193966e-01   +4.186743757950772e-01   +3.220041501163246e-01; +4.604611476561230e-02   +2.198658050464063e-01   +4.243388375502673e-01   +7.968743655626009e-02   +1.793184138131152e-01   +5.587158026842387e-01   +9.622140922199542e-02   +4.947618347932419e-01   +3.713202579847920e-01   +4.235694186255951e-01   +1.667269978375047e-01   +1.278101744483252e-01   +4.010671775733302e-01   +3.158874404203558e-01   +1.022360737309635e-02   +1.711605723547923e-01; +1.815892815475364e-01   +4.737625091764501e-01   +2.504072142235865e-01   +4.506493498400505e-01   +1.827312509305743e-01   +6.978271842365737e-02   +4.231823587083623e-01   +1.371263503932727e-01   +4.107442498525559e-01   +2.790905077924059e-01   +2.867350627191309e-01   +2.440730700240387e-01   +6.457553400712893e-02   +3.506039941364383e-01   +3.694763172829312e-01   +2.092211572005556e-01; +3.877170824600470e-01   +4.334942105007761e-01   +2.114888569261796e-01   +2.526715672553703e-01   +4.904473364688490e-01   +5.242072370884835e-01   +2.774791749342464e-02   +4.599553875561958e-01   +9.675177554290987e-02   +4.301545018799967e-01   +2.604217765484191e-01   +5.296565531102498e-01   -4.181347786221382e-03   +2.361500269222753e-01   +2.736613929457326e-01   +2.460442173687365e-01; +4.531602624764927e-02   +6.691396155173711e-02   +2.965841767593262e-01   +4.428243921948721e-01   +2.247234114609466e-01   +6.462451924972736e-02   -5.366391233015747e-02   +1.902175623530996e-01   +2.715711914929686e-01   +5.328297913752220e-01   +1.264499350915328e-01   +2.885245758056097e-01   +2.446235996686603e-01   +2.899025069881948e-01   +6.575245237665245e-02   +1.399479260167928e-01];
L2I_L2E_iAMPA_netcon = [+9.778969010444384e-02   +3.838567405895132e-01   -3.212136402184645e-02   +5.422411007375081e-01   +2.352571912592721e-02   +4.047823582585802e-01   +2.270447868508949e-02   +3.109809062276887e-01; +1.213453216578623e-02   +3.168641075915672e-01   +1.694495178211884e-01   +1.902888916545249e-01   -3.699256714709594e-02   +4.158858833200044e-01   +3.101590939350436e-01   +3.630570278784493e-01; +2.969426010324473e-01   +1.102836886817596e-01   +3.555724849495684e-01   +6.768535918817646e-02   +1.217783013540287e-01   +3.674167993699959e-01   +2.330181707020640e-01   +3.350307067985471e-01; +3.320070217280093e-01   +1.027096722763435e-01   +3.395630030981447e-01   +3.173001624500645e-01   +1.726873216817416e-01   +2.810848301065522e-01   +9.365012425758887e-02   +3.445925785455463e-01; +4.404480215319390e-01   +4.246275471978752e-01   +5.183988200896711e-02   +1.821441884145179e-01   +1.770379505892716e-01   +4.074305252192166e-01   +4.371122221772233e-01   +3.032351010689475e-01; +4.792560520104821e-01   +1.207702258837822e-01   +8.393367674339650e-02   +1.805254856221324e-01   +1.941856977387853e-02   +1.094649268184337e-01   +1.255569322006723e-01   +4.732495897047982e-01; +2.570606288816856e-01   +3.503057868631653e-01   +3.913626416474540e-02   +2.592632606119182e-01   +4.703937722340780e-01   +2.130148308880769e-01   +4.352349935042861e-01   +4.999665424221141e-01; +3.060128012252702e-01   +4.960298706746196e-01   +7.790381711469984e-03   +1.384816670636737e-01   +4.459201175626555e-01   +1.948856852613735e-01   +4.973417287729317e-01   +1.542533144420171e-01];
L2E_L2I_iGABA_netcon = [+4.486314520390761e-01   +2.645052808916377e-01   +2.077162619091073e-01   +4.737972272938517e-01   +1.585363576375924e-02   +3.999263782866846e-01   +5.283396338272165e-01   +2.480863964872311e-02; -8.626767732198143e-04   +1.101789225216473e-01   +4.445412359795589e-01   +3.076306108264671e-01   +3.914763372710106e-02   +1.928812396278042e-01   +5.611505997564386e-01   +4.969330154582302e-01; +3.035143766951937e-01   +3.952240576968135e-02   +3.526549179345883e-01   +1.836943404175270e-01   +2.635334143925828e-01   +3.066320460678855e-01   +4.128140628075513e-01   +1.750077147307166e-01; +2.884395884225914e-01   +4.695625187867311e-01   +1.806922384032048e-01   +2.083503532523589e-02   -2.604161843282552e-02   +3.104628951700120e-01   +2.811107927791615e-01   +2.187354245917997e-01; +3.146405494421621e-01   +2.667569473749944e-01   +9.134642482267030e-02   +8.830530016427918e-02   +4.217233479246078e-01   +4.921344371022867e-01   +1.238562535179633e-01   +3.218868916476317e-01; +4.925835729413476e-01   +1.989672380095596e-01   +1.554358351939718e-01   +5.959564374964455e-02   +3.336286879123264e-01   +3.491269327393275e-01   +1.862721681048443e-01   +5.337383458874065e-01; +9.726709923573287e-02   +2.275970428153405e-01   +3.744860195463371e-01   +7.060711462426834e-02   +3.868283501715458e-01   +1.503297668346718e-01   +2.594097716211423e-02   -3.258049055034094e-02; +3.096049029329229e-01   +1.235804872713510e-01   +5.329614050661170e-01   +2.476480855027388e-01   +4.614513935488387e-01   +3.777461496295128e-01   +3.816331863918285e-01   -9.669724275512657e-03];
L3E_L2E_iAMPA_netcon = [+3.235729854397878e-01   -2.140749573365118e-02   +2.729921327738880e-01   +3.097815736264401e-01   +5.218397350556537e-01   +3.931903586123182e-01   +1.106572905729227e-01   +5.612492563266882e-01   +2.185482490003988e-01   +8.823842049152437e-02   +4.486560747433772e-01   +4.129516505784630e-01; +4.551779234806926e-01   +5.427538774383266e-01   +3.733587858194997e-01   +3.120154475326939e-01   +1.385856698993659e-01   +1.637360598616134e-01   +2.736822256502443e-01   +1.455965624130781e-01   +6.800039622384019e-02   +2.608433912612418e-01   -3.020231814823326e-03   +1.416781580852646e-01; +5.344892142225919e-01   +2.606368390348672e-01   +3.330126422823838e-01   +4.359021275615840e-01   +3.846565379003806e-01   +1.382717181540797e-01   +3.792006264945805e-01   +9.037097448869635e-02   +2.873462095455618e-01   +2.024237511630005e-01   +1.781915615589842e-01   +1.772691363331631e-01; +3.418046527982400e-01   +2.446402229144759e-01   +6.577328250612843e-02   +7.194270946274596e-02   +2.912494493507050e-01   +3.392073233929954e-01   +3.590032967296177e-01   +4.517262030421872e-01   +3.694937972205301e-01   +3.117526668080652e-02   +1.793575993509739e-01   +1.537418844001469e-01; +3.351731859371321e-01   +2.920926261811650e-01   +1.359883871883290e-01   +6.298580840066782e-02   +4.246602622600673e-01   +4.199929345844832e-01   +3.824718562542765e-01   +2.367901842418562e-02   +7.126736622066783e-02   -2.223844101343612e-02   +5.168135355303790e-01   +3.847349759776306e-01; +2.746793383306587e-01   +4.741683351035287e-01   +3.712741211675774e-01   -1.269942619998295e-02   +6.678971620539643e-03   +3.508976037502367e-01   +4.179291593404851e-01   +4.271430126534861e-01   +1.671444266359179e-01   +8.618630180290721e-02   +4.018103988730896e-01   +2.511360235805987e-01; +2.494746195795325e-01   +3.256142809990181e-01   +4.411962952553227e-01   +5.248866043130285e-01   +1.424490005291313e-01   +3.552322924085839e-02   +4.005500369376894e-01   +2.319930222355714e-01   +5.883019462152442e-02   +1.683049562398333e-01   +7.673420383867623e-02   +8.658850851382310e-02; +8.636626373847600e-02   +3.953379364025646e-01   +4.333148341403326e-01   +1.092137162221674e-01   +3.173045586916393e-01   +3.389930321441277e-01   +5.016673541269097e-01   +1.728231614122095e-01   +2.105741963620056e-01   +2.712612547588650e-01   +5.338989727412018e-01   +1.983670298436613e-01];
L3I_L2I_iGABA_netcon = [+3.145626383198142e-01   +3.092527290731734e-01   +3.529909294150003e-01   +2.152934220629203e-01   +1.764721274148635e-01   +3.490736907400490e-01   +3.783083113282474e-01   +2.943534603784903e-01   +7.033601941727922e-02   +1.726289397058562e-01   +2.698497115208899e-01   +3.314747172637436e-01; +9.166648484506100e-02   +3.683298055898659e-01   +3.982128579843348e-01   +3.351990518307950e-01   +4.748979879300365e-01   +5.377289891506331e-01   +8.496599820248191e-02   +4.075795968773218e-01   +1.653586480553619e-01   +3.368808951863660e-01   +8.552989769295893e-02   +6.523900801304451e-02; +1.039387350810169e-01   +4.249674351628772e-01   +3.976520784759044e-01   +4.400278398505099e-01   +2.285123990801705e-01   +1.975764044881857e-01   +3.964628227985248e-01   +1.622763655665913e-01   +5.062588009785310e-01   +4.081651667688202e-01   +8.219942502527852e-02   +6.817032185050011e-04; +4.970450101179163e-01   +3.420816294007569e-01   +3.474923842611483e-01   +1.224715051128459e-01   +4.068761280739142e-01   +2.358207959633345e-02   +4.465746851386343e-02   +1.280568611319435e-01   +4.378188237079814e-01   +4.602101695329513e-01   +3.128511688696515e-01   +1.142026722283276e-01; +3.690059345257068e-01   +1.529873343776765e-01   +3.555672635096442e-01   +9.250854277376108e-02   +2.403953737889991e-01   +5.779462236891357e-02   +1.595290316282808e-01   +6.158814073607548e-02   +4.429998821295287e-01   +2.304470815464283e-01   +4.667843174101127e-01   +8.611679945925577e-02; +3.603054200551493e-01   +1.721464997522422e-01   +3.425666136889933e-01   +1.907406916100937e-01   +3.066345191514173e-01   +3.221054018005010e-01   +4.834859449335736e-01   +3.124838214447204e-01   +2.975046306366580e-01   +1.321408197239886e-01   +2.245584350681534e-01   +9.286291891374414e-03; +2.115625621195565e-01   +3.521821855367203e-01   +1.340176373076006e-01   +1.283314231351886e-01   +4.152345837046269e-01   +4.768362642224280e-01   +3.074787711022875e-01   +2.613661274568480e-02   +3.746506008989648e-01   +3.239010822348550e-01   +1.158260552233113e-01   +7.057247705224859e-02; +1.218474707974688e-01   +3.280677590117927e-01   +2.972886730056700e-01   +2.908353322763343e-01   +2.711992514292149e-01   +2.267516452787681e-01   +1.008795555714967e-01   +3.623258170397183e-01   +1.269867920739506e-01   +3.087142145641841e-01   +4.235693002703048e-02   +3.130399281228299e-02];
L2E_L3E_iAMPA_netcon = [+2.739268775737360e-01   +3.050082244653106e-01   +4.117393136915682e-01   +9.365228871712979e-03   +2.420506496101682e-01   +2.685065054510466e-01   +2.047838569816202e-01   +5.342221086438723e-01; +4.282964035215222e-01   +2.214846618452462e-01   +4.919268555472665e-01   -1.734307780607992e-02   +3.910333462770325e-02   +3.868176254239112e-01   +2.642900924680360e-01   +3.539144483279780e-01; +1.305390971325449e-01   +1.975419603381989e-01   +4.478976567833214e-02   +3.084802169498722e-01   +2.050930278188084e-01   +1.312428027521806e-01   +3.946528567447776e-01   +5.181615152711513e-01; +3.478545664302114e-02   +1.001283884285062e-02   +1.323776884449420e-01   +2.408062535044194e-01   +4.637504067265860e-02   +3.077383029003401e-01   +8.819576008492280e-02   +4.774910093722034e-01; +3.536138242249053e-01   +3.713138046208364e-01   +1.335561561440407e-01   +4.880117599605549e-01   +1.340403242160573e-01   +8.582848219380623e-02   -2.572504510773229e-02   +3.010715434508892e-01; +2.065930003392637e-01   +1.036398817447072e-01   +1.687207518303332e-01   +2.560217180156102e-01   -8.610063393267316e-03   +2.903878899382181e-01   +3.032637649428893e-01   +3.295908990035407e-01; +3.618724906747375e-01   +4.630454866244045e-01   +2.633178002007898e-01   +1.984376279957448e-01   +2.459043106989189e-01   +4.291291194457685e-02   +2.493135707923158e-01   +3.844500065613600e-01; +3.358589791856496e-01   +2.351122672183967e-01   +3.124633846266349e-01   +3.736792300428741e-01   +3.399636332769351e-01   +3.724702685766615e-01   +2.921465003717508e-01   +7.841222354517240e-02; +1.074735260748455e-01   +2.884099176888995e-01   +2.415864374657861e-01   +3.576134156419811e-01   +2.328831734669736e-01   +2.616594013733440e-01   +1.854494922531982e-01   +4.465296652009492e-01; +1.305352185120249e-01   +1.337245927097598e-01   +1.284753253193654e-01   +8.890556621023880e-02   +1.152555548533093e-01   +3.421599635113772e-01   +3.923590393621045e-01   +4.334606314649481e-01; +2.951677637960932e-01   +1.629372774822886e-01   +4.139322765305237e-01   +2.618109650181878e-01   +5.408599581892450e-01   +1.273842465724578e-02   +3.360687234041293e-01   +1.154025070138036e-01; +4.538576673715066e-01   +1.517700033438754e-01   +2.346638704320022e-01   +1.233525716500322e-01   +3.354508847940706e-01   +2.629337372376996e-01   +2.638554297247391e-01   +2.991269609116353e-01];
L2I_L3I_iGABA_netcon = [+1.877817408166543e-01   +5.458029583922909e-01   +6.012375918350553e-02   +2.135631474951676e-01   +5.255193689750978e-01   +3.915861459538841e-01   +3.113956506885624e-01   +4.999791842744239e-01; +4.659989998486340e-01   +4.311549336747625e-01   +1.308080724979420e-01   +3.026045933466809e-01   +3.750508677005415e-01   +5.488590729959356e-02   +8.691160311841449e-02   +4.522983459873895e-01; +4.784713690093836e-01   +4.200858962697154e-01   +3.340995336293549e-01   +3.969881297569580e-01   +1.499361510834178e-01   +3.252049765469659e-01   +4.048768293199763e-01   +5.379404635509418e-01; +2.363212612817246e-01   +1.777143797629414e-02   +2.970969611577169e-01   +2.696655970727366e-02   +1.674318363294568e-01   +3.201097465489274e-01   +5.248227696925330e-02   +2.159901156731964e-01; +1.390519661263639e-01   +3.978740066107144e-01   +1.644142674955918e-01   +2.391087041174222e-01   +2.502680591055014e-01   +2.726770966613850e-01   +2.645158428440815e-01   +3.762965789079457e-01; +6.705464972668140e-02   -1.754266175962435e-02   +2.864247748514804e-01   +2.503044093112444e-01   +1.529607828215473e-01   +8.000941470277523e-02   +3.921465285129200e-01   +1.451602600673707e-01; +1.197545267908255e-01   +2.173480246847315e-01   +3.365804733629492e-01   +8.498554317469370e-02   +2.848964676523042e-01   +2.017886073220208e-01   +5.251087342041245e-01   +1.551702069450464e-02; +3.124217191794576e-02   +4.478725803283962e-01   +1.343599517905512e-02   +3.235318999253476e-01   -1.996640897994876e-02   +7.334962177709074e-02   +3.253284109239689e-01   +3.370699011634349e-01; +2.201098228010719e-01   +1.723474401897448e-01   +2.898633201965108e-01   +3.566448128578452e-01   +3.673158796748472e-01   +5.056319432242184e-01   +6.600782380313576e-02   +6.288687409835797e-02; +2.207345338763950e-02   +1.128736490294930e-01   +5.741364468966690e-02   +4.559495085550744e-01   +3.010393054043090e-01   +1.651151843045257e-01   +4.835684900595950e-02   +1.707554251583975e-01; +2.499490989831417e-01   +4.316910635004478e-01   +1.024623665957650e-01   +5.175555629849603e-01   +1.773906301996607e-03   +3.986145991694485e-01   +1.281934032827382e-01   +5.618629236904855e-01; +4.108775648550812e-01   +1.802607161058711e-01   +2.540607453109873e-01   +8.605400495272432e-02   +4.938986025717951e-01   +3.341839085055201e-01   +2.821136720431090e-03   +1.751280119589134e-01];
L3I_L3E_iAMPA_netcon = [+3.961316058509128e-01   +1.680270628039247e-01   +3.350107024120980e-01   +3.478714513166722e-01   +4.735692885071141e-01   +2.800258427053956e-01   +1.657297157016543e-01   +5.612290249672661e-02   +2.422000433012600e-01   +2.459831684181689e-01   +3.346395645292566e-02   +2.309772463457005e-01; +4.717403273266648e-01   +5.193193119504168e-02   +1.297981815889559e-01   +1.835021921764982e-01   +1.348851869241031e-01   +1.973821131307236e-01   +1.917078025624835e-01   +4.327327785918031e-01   +3.921001278934775e-01   +3.728822130679206e-01   +5.278374567366928e-01   +3.161885677392832e-01; +3.358798846799777e-01   +3.040263441061964e-02   +4.418849483023667e-01   +1.083843730361096e-01   +1.371445547435027e-01   +4.332328137554252e-01   +9.868204659658643e-02   +3.261422995070098e-01   +1.974069804268842e-01   +2.565311721837966e-01   +4.288744413629350e-01   +3.443697446943365e-01; +3.606369188988267e-01   +5.955994971287899e-02   +3.495849950452494e-01   +4.363690633821712e-01   +8.168383449780157e-02   +4.877916249887481e-02   +5.034671059358979e-01   +2.295116266527768e-01   +1.908866917749697e-01   +5.353712923307651e-02   +1.242424482712934e-01   +2.367920339049928e-01; +4.721579926051916e-01   +2.277849763649017e-01   +2.585277610600709e-01   +4.207775483656062e-01   +2.704052219488013e-01   +1.550214626222698e-01   +7.068742020736923e-03   +2.437847098599955e-01   +2.969909852877099e-02   +3.500212921288647e-01   +3.139100728584298e-01   +3.067466802020272e-01; +5.504880934809111e-01   +4.007555326161202e-01   +8.418150580376410e-02   +2.820041502380870e-01   +4.861231500901527e-01   +3.213899592455223e-01   +7.320191403466100e-02   +8.399392556665761e-02   +3.371880264364194e-01   +2.518161466009616e-01   +4.549878172432145e-01   +5.031896779153012e-01; +2.146783138816364e-01   +1.991595312315406e-01   +1.754115047467561e-01   +1.039278024928662e-01   +2.289949620502114e-01   +3.927177757267261e-01   +3.253626409001502e-01   +2.373313788376546e-01   +4.139680606412479e-01   +4.057333501864417e-01   +1.954037783260276e-01   +3.649089593527744e-01; +3.313113760668311e-01   +3.971169412277106e-01   +8.522199687771408e-02   +2.960130676400412e-02   +4.729186616871440e-01   +8.140431463015663e-02   +2.628510765560436e-01   +3.941577349158842e-01   +3.643232826372620e-01   +5.207088786872234e-01   +2.277519017098539e-01   +4.414395018882281e-01; +1.020055130163150e-02   +4.574054672165926e-01   +9.061091139587144e-02   +3.991714872141225e-01   +2.879533204375807e-01   +2.329279615108407e-01   +8.551182261670973e-02   +4.960952673921371e-01   -2.313325571763192e-03   +3.157709621674420e-01   +4.449837737413305e-01   +3.656183529050193e-02; +1.354644382403345e-01   +4.343148997278305e-02   +1.660701760599083e-02   +3.251204804295063e-01   +1.966816375158041e-01   +4.435832481267649e-01   +1.820233145417277e-01   +8.197825192798053e-02   +3.528520252179596e-01   +3.663818169943788e-01   +4.184390260349092e-01   +3.563355128638688e-01; +2.988383317399536e-01   +9.671499673814310e-02   +4.538735412475061e-01   +2.022315034976564e-01   +2.466557856383852e-01   +3.604217669227973e-01   +1.609937599343319e-01   +8.425333750332978e-02   +1.067163121040680e-01   +3.038201003112001e-02   +4.120594222626073e-01   +3.291476611508590e-02; +2.367857376062232e-01   -5.820613722690083e-02   +3.141112456842303e-01   +3.506357882283009e-01   +1.693814311543708e-01   +4.266431990324940e-02   -3.704412805924149e-02   +3.431304013600867e-01   +1.563445609655336e-01   +3.775536098944303e-01   +2.686359630048704e-02   +1.434044383095367e-01];
L3E_L3I_iGABA_netcon = [+3.780369777990218e-01   +1.326881083500893e-01   +3.660361761814304e-01   +4.360895305871188e-01   +3.615064694921136e-01   +4.443244043431809e-01   +2.047055219290281e-02   +3.570634246780195e-01   +3.916218561804272e-01   +3.679103093461843e-01   +4.756369947827060e-01   +3.331661238500584e-01; +2.761644723661241e-01   +3.577726155254524e-01   +9.122201069540435e-02   +3.293217170115017e-01   +6.352602256586554e-02   +4.235844608645275e-01   +4.537979743636364e-02   +2.604933481013543e-01   +1.905681004809809e-01   +9.102699585343828e-02   +3.109596787441939e-01   +3.862314159711606e-01; +2.449958606095125e-02   +4.899319648152162e-01   +1.561709421742768e-01   +8.722689417972566e-02   +2.042261339582110e-01   +2.210421857170674e-01   +5.167715623406408e-02   +8.853107783087694e-02   +4.331431800738659e-01   +2.743627771025026e-01   +2.022167931951816e-01   +9.084641901960611e-02; +3.848445820411748e-01   +9.944595968074411e-02   +4.038884413215312e-01   +1.755386881215613e-01   +5.198382644976437e-01   +8.384650647860376e-02   +1.322734111443174e-01   +1.737952754422489e-01   +3.773033309743918e-01   +4.727865837640398e-01   +1.308666878384224e-01   +2.922266636902276e-01; +4.901868139962239e-01   +3.315805971196481e-01   +4.677524875112005e-01   +4.865024355177769e-01   +4.043040264357995e-01   +2.336574146203331e-01   +2.281976864854528e-01   +3.418292192814277e-01   +2.989624398675051e-01   +2.810104765116206e-01   +1.813805049427079e-01   +3.867038339485283e-01; +1.866732086126136e-01   +4.458765992472942e-01   +3.299991287343543e-01   +2.252709092008691e-02   +4.531657654847777e-01   +1.813224958820457e-01   +3.488757499690001e-01   +4.503951759908253e-01   +2.784450287771768e-01   +3.091324713657848e-01   +2.115873927062799e-01   +5.551143118905701e-01; +4.177949037655979e-01   +1.385960048835524e-01   +8.252229005785569e-02   +2.091268721541509e-02   +1.573390584076159e-01   +2.577589970152461e-01   +3.925905468649965e-01   +3.591349402314418e-01   +4.903230639930667e-01   +3.973271457790079e-01   +5.925169382991187e-02   +6.135171294878163e-02; -2.290432270377108e-03   +2.219006759219583e-01   +2.120371345729246e-01   +4.126540668560719e-01   -1.649809952346433e-02   +3.448587356154028e-01   +1.970325557437429e-01   +3.331113433694295e-01   +4.639653015560496e-02   +2.699731381048688e-01   +3.178865755341930e-01   +1.461391272905341e-01; -3.008080571069290e-02   +1.201429010158464e-01   +4.085433136179055e-01   -2.296093153164660e-02   +4.481975841972461e-02   +4.767501868934828e-01   +5.480697814386936e-01   +1.781900343078132e-02   -4.116834058117924e-02   +2.308976740815200e-01   +3.609017075555252e-01   +1.505560374949248e-01; +4.880377712325242e-01   +4.843787302027539e-02   +1.398652835066095e-01   +2.807518960841461e-01   +2.994744387237936e-01   +2.625268881227675e-01   +3.613162331777431e-01   +3.081232503275374e-01   +9.522073711334739e-02   +5.996868125621319e-02   +2.377584108624458e-01   +1.676979408542596e-01; +4.207001422149644e-01   +1.608775268104933e-01   +2.985320883730746e-01   +6.985309900380093e-02   +4.476745219957182e-01   +7.431992484023277e-02   +4.840551084325990e-01   +4.867351089225265e-01   +1.953861497480024e-01   +8.003805305849193e-02   +7.509243974372420e-02   +8.007525846376388e-02; +9.894355854408918e-02   +4.244353524668153e-01   +6.309206188319781e-02   +4.643544368333508e-01   +3.577673358714353e-01   +9.988631544173313e-02   +3.472012039596003e-01   +4.708867572082670e-01   +3.543195741600786e-01   +5.625222295999276e-02   +3.661237364261780e-01   +1.568206300452633e-01];
L2E_Input1_iAMPA_netcon = [+1.424122174518880e-01   +9.094427241239139e-02   +4.295613026082844e-03   +3.886299666203207e-01   +2.520400344560924e-01   +2.744498618162060e-01   +9.216188389718881e-02   +2.308191588588738e-01];
L2I_Input2_iAMPA_netcon = [+1.476192296570547e-01   +4.799536763171737e-02   +6.374722842135730e-02   +2.563439791239801e-01   +1.331893798659387e-01   +5.138149538889833e-02   +1.133519655649938e-01   +1.226998041748369e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
