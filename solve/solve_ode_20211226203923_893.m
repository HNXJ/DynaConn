function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.683994049687453e-02   -1.469949248024087e-01   -3.079127462615163e-01   +6.057674252789770e-02   +4.838542113015278e-02   +1.289533758384435e-01   -1.347977791303453e-01   -1.471706373944173e-01   -1.244153094574995e-01   +3.349705796503116e-01   -1.489257831906373e-01   +1.997171155341483e-01   -9.626223033013430e-02   +1.519746680266147e-01   -2.320510828634924e-01   -5.374500315257007e-02; -9.349150717907059e-02   -3.929786707320335e-01   +1.011780387711904e-02   -2.348516459289614e-01   +1.071259392727347e-01   -1.900573230346814e-01   +3.303368280859427e-01   -4.833990409040276e-02   -5.563945725017653e-02   +1.372021788252260e-02   -2.928776882966916e-01   -2.502748028483884e-01   +2.912830936857447e-03   -2.027473832573572e-01   +5.496959634809249e-02   -1.136986610663794e-01; -8.346428359268784e-02   -4.731313624451679e-02   -5.562086761207024e-02   -7.050605631151809e-02   -8.401808793214015e-02   +6.372143768080621e-02   -1.377034084958829e-01   +3.739282187350845e-02   +1.780466377130108e-02   +1.212386517371552e-01   +2.156887721165834e-01   -1.526371757171741e-01   -9.825501032449138e-02   -6.101875139366250e-02   +2.106068919699730e-02   +1.169040201670736e-02; +9.173870670947647e-02   +2.063964033631028e-01   +6.652365536011595e-02   -1.399112460106807e-01   +2.993260224586433e-01   +9.640902605461388e-02   +9.721418409366989e-02   -1.328593594088585e-01   +1.349695669022634e-01   +3.273223517940176e-01   +7.322669027516887e-02   -1.189647142930987e-01   +1.679719505973020e-01   +2.510724889452917e-01   -4.282225473794765e-02   +1.096462879433583e-01; -1.436698338842943e-01   -8.573362690409784e-03   +2.794166082577296e-01   -2.755579860775115e-01   +2.013190050193357e-01   -1.902914252492340e-01   +1.204945029944891e-01   -1.519348115882017e-01   -1.027370044911885e-01   +9.356777810660032e-02   +7.847199521744050e-04   -4.045231677029346e-03   -1.013106168689689e-01   +6.427977120644396e-02   +2.520821330797142e-02   +1.578810182400988e-01; -1.003331895240213e-01   +1.193188320783343e-02   +2.344880605920864e-01   -9.946422295735705e-02   -6.526640841042683e-02   -1.012091164872690e-01   -1.444950274899962e-01   +1.329359807348451e-01   +5.235230548719759e-02   -2.109248573866790e-01   +3.308425241072555e-01   -3.383067597995555e-01   -3.138524697923321e-01   -2.624490774654909e-02   -5.228869762494922e-03   +7.634721728343062e-02; -3.079690587736424e-02   -2.059769432761376e-01   +1.635312502825665e-03   +1.343293345937895e-01   -2.991295526716817e-01   +3.214360901346224e-01   +3.860445763345051e-01   -6.727066754219851e-02   +1.450718679477203e-01   -7.719148050209433e-02   +1.655014012584138e-01   +1.946128338785672e-01   +9.845142343507549e-02   +1.738430899363694e-01   +1.612448125630283e-01   -4.542138800484453e-02; -1.311960644489812e-01   +8.332651381866089e-02   -2.617863093232504e-01   -5.116795023027897e-02   -9.680701729031041e-02   -3.123066702883873e-03   +8.232747656327180e-02   +1.103564501304540e-01   +1.544637525093796e-01   -1.627471053591628e-01   +4.953681772856772e-02   +8.504026642773108e-02   -1.163347650179851e-01   -3.420194522137245e-01   +1.980770535304346e-01   -3.378788210732440e-02; -3.191417545068022e-01   -4.715929969673414e-02   +2.713273495665621e-01   +1.933619659607983e-01   +5.880879220768905e-02   -2.218220398953113e-01   -4.086922264197655e-02   +2.206633770024637e-01   -3.872857227376392e-02   +1.899787421940929e-02   -1.160613596515480e-02   -3.118295021860247e-02   +2.369224274866834e-02   +7.679087137157528e-02   +8.442828753237309e-02   -2.152196694451402e-01; +5.444912202892940e-02   -2.332686361682966e-02   +1.383628401718153e-01   -7.614472941307532e-02   +2.808776107666977e-01   +5.167504302702647e-02   -1.926374152915540e-01   -1.252340141817957e-01   +8.936171331877868e-02   -7.732067787422772e-03   +3.131703248616992e-02   +1.892450642342708e-01   -2.953144264164966e-01   -2.052331565276669e-01   +1.457717037938456e-01   -1.597492645538453e-01; +6.520889114494254e-02   -3.765855972739793e-02   -8.866371799532392e-02   +8.385408585130757e-02   -5.555278726855950e-02   +1.653070857178059e-02   -1.436478278592630e-02   +7.548108566724082e-02   +9.675383652884564e-02   +1.342165849145602e-01   +2.221497057511056e-01   -1.672639841064155e-01   -2.040059231444565e-02   +2.274513098681603e-01   +1.282313793971679e-01   -9.457521531927672e-03; -9.675944079748955e-02   +3.662447605367873e-03   -1.842492745699204e-01   +2.810981165056678e-01   -1.018082206933138e-01   +8.406556783197826e-02   +3.435334331005938e-01   -1.144221647540125e-01   +1.288539112121030e-01   -1.993983343689188e-01   -2.440374542830122e-01   -2.302340978275692e-01   -2.022154139525099e-01   +1.870092986358617e-03   +2.500751964538539e-02   -1.249139070566308e-01; +3.638269611347900e-02   -1.260429862245427e-01   -2.313827586194213e-01   -3.256506272854791e-02   +1.682840206583064e-01   +1.167279711093420e-01   -1.516786599682373e-01   +1.801679180208882e-01   +4.135040749322551e-02   +3.836089068883313e-01   -6.568064789147338e-02   -1.285224766041804e-01   +6.295353571592899e-02   +2.484176955858867e-03   +9.763447357506347e-02   -3.430005034609859e-01; +3.672232762323611e-01   +1.400947489930641e-04   -9.715054270935455e-02   +1.334954326903108e-01   +1.581631217956083e-01   +1.144485632946782e-01   +9.144992258691456e-02   -3.997688326372812e-02   -2.340406933975616e-01   -4.098077792385653e-02   +1.005710904344498e-01   +1.020740302102089e-01   -5.359168352275490e-02   -1.804807818779773e-01   -2.658358183709317e-02   -4.234647900907579e-02; -3.379996382381441e-01   +2.597622978259449e-02   -9.809231043756930e-02   -2.182446854056323e-03   -5.861984514787669e-02   -5.377381638528640e-02   -1.056534811427755e-01   +1.835105763431178e-01   +3.410341733627400e-01   +1.114139755427209e-01   -8.695783455583807e-02   +2.496193090010218e-02   +3.089791734061865e-02   -3.282039217402092e-01   +2.093304530401235e-01   -9.617999879104461e-02; +7.390961882578180e-03   -4.218930896883598e-02   -3.682871126267195e-03   +1.764492045261936e-01   -1.197115790460007e-01   -2.286602327257565e-01   -1.876967446112988e-02   -2.864872809188627e-01   +6.292275951367169e-03   +1.350728213271268e-01   -1.421841485007091e-01   +3.699672484940278e-01   +1.364049835073222e-01   +6.598606290299830e-02   +1.152623535057623e-01   +1.108889768495022e-01];
L1E_L1I_iGABA_netcon = [-1.279003437757472e-01   +1.498903222608813e-01   +3.851701512240009e-02   -1.812664009561808e-01   -1.904708712605516e-01   -2.878532695086466e-01   -2.491286815467067e-02   -2.298395408773619e-01   +2.045075825777257e-01   -1.575625704011825e-01   -2.695167814136287e-01   +1.296119404376220e-01   -2.222859535814552e-01   +8.048336780827509e-02   +1.888792541555342e-01   -2.664043397319822e-02; -2.531711131460740e-01   +3.383828202429868e-02   +2.367915391405131e-02   +1.649672718784194e-01   +1.891643802526783e-01   +9.226624183466453e-03   +3.127261494622552e-01   +2.573066018043439e-01   -2.371610206095091e-02   -2.975063078413305e-02   -1.938002129251165e-01   -1.868758880292131e-03   -1.206673453639834e-01   +4.825670925328235e-02   +2.879359339605404e-01   +2.386146225902469e-01; -1.118364620922060e-01   +2.325089398215951e-02   +2.079048538206830e-01   +2.111757043251477e-01   -2.984687386727729e-02   -6.096602552287284e-02   -1.999744525036779e-01   -1.928084788560670e-01   -2.867480906064878e-02   -1.740143387932871e-02   -2.506513262235349e-02   +7.685226315461258e-02   +1.154628162007230e-01   -6.547679295446635e-02   -2.430453599801547e-01   -2.175374199603739e-01; +1.018330433716865e-01   -1.190162008352514e-02   +6.683726769689488e-02   -2.449538223415005e-01   -1.043716981636890e-01   -6.055773993917581e-02   -5.385043020857817e-02   -3.333556073176478e-01   +1.039893740973798e-02   +1.070623098668383e-01   -1.791208182481898e-01   +2.105889332366726e-01   -2.228178506405621e-01   -3.461083618723598e-01   -1.434609103852048e-01   +2.016627833717354e-01; +2.667409801252034e-01   -2.092338850736718e-02   -2.962250825177341e-01   +6.801531097009308e-02   -2.841671802115208e-02   -1.090944845421856e-01   -1.450810104137871e-01   +2.295041437089588e-01   +1.166119776655196e-01   -3.396317088938425e-03   -5.548805196047903e-02   +2.309545898735579e-01   -5.155305843239717e-02   +3.275822452592467e-01   -1.268477352908113e-02   -1.863923437372433e-01; -2.474434345503436e-01   +6.319843143902426e-02   -1.090942026738110e-01   +1.361064869216060e-01   -5.683387174235863e-02   -4.271477651065284e-03   -1.892867714056818e-01   -1.241782947907474e-01   -2.833505143885107e-01   +8.714783539365314e-02   -8.899460626569308e-02   +3.925019859542891e-02   +1.355745488699147e-01   +1.544662847867017e-01   +2.611551371342408e-01   -2.290906693774533e-01; +1.678118565669253e-01   +1.693347618188537e-01   -3.173349854124040e-02   -1.758274608341279e-01   +1.136371873583648e-02   +1.941319378602090e-01   +1.767426593509162e-01   +2.445666629549059e-02   -1.219196009100163e-01   +1.339167589016226e-01   +1.765675740732702e-01   +1.170541764912578e-01   +4.224333549718888e-02   -2.525139433152990e-01   -8.965734124568597e-02   -7.059861802470130e-02; -8.731701311735462e-02   +2.311371671712649e-01   -2.486813762588314e-02   -9.206147751454130e-02   -2.220390685413536e-02   -9.464231765356751e-02   -2.026274015705350e-01   +1.500714022147204e-01   +9.307717607893005e-02   +1.725068930467859e-01   +2.911421952060624e-01   +5.717435927545950e-02   -5.812811721018932e-02   -5.368261052245615e-02   +5.501104379367225e-02   +1.002317667414085e-01; +1.414597914313200e-01   -3.374143206126119e-01   -5.576852889610667e-02   +3.418000203318159e-01   -3.274673317200082e-02   +1.548732447942505e-01   -1.114320659239676e-01   -2.107189528137759e-01   -2.442016779572716e-01   +2.949782599888401e-02   +8.786213613392796e-02   +1.420640672611270e-02   +2.390902696333375e-01   -5.057677327462025e-02   -1.096252165686915e-01   +1.084283712667618e-03; +2.175242227051406e-01   -6.999720229909835e-03   +2.785164754118569e-01   -7.356619990353690e-02   +2.286527025837554e-01   +9.170867863210040e-02   +1.002256199239376e-01   +1.830885865944111e-01   -7.252040685998126e-02   -2.003220189980209e-01   +9.160752495886028e-03   -1.532619162365671e-01   +7.347417182344103e-02   +9.589048172244000e-02   -2.013156146215461e-01   -7.537545927085330e-02; -1.433847660149360e-01   -3.972681966337644e-01   +2.123458022409742e-01   +3.476685058892329e-02   +3.246268924590947e-01   +1.711487076428472e-01   +3.476176658395794e-02   -1.023350384852005e-01   +2.517426656579510e-01   -2.401206618576603e-01   +2.370905126622118e-01   +1.561433845101854e-01   -5.852132241981327e-02   -1.591385556827320e-02   -3.574679162710818e-02   -1.908244349276158e-01; -1.765327191174715e-01   +2.000184423109439e-02   -1.714539139428474e-01   -1.046713852919953e-01   -2.619381904841288e-01   +3.109933657810790e-01   -3.298603005170743e-01   +1.550376669031640e-01   +1.642167295170549e-01   +2.543840377087945e-02   +7.581266767954686e-02   -1.921467457520274e-01   -4.216039586918654e-02   -4.922370634093641e-02   +3.805283209224400e-02   +1.682042561601189e-01; -1.841884875660273e-01   -5.959460956335293e-02   +1.892562208886082e-02   -1.032492498735745e-01   +5.014894242717135e-02   +2.035904347630872e-01   +3.414832401827335e-02   -3.733035115010164e-01   +2.103528870280289e-01   +7.653846664671066e-02   +9.633390487484572e-02   +2.124084957334053e-01   +5.633748176379797e-03   -1.633812618763840e-01   +3.683344338452720e-01   +5.057212866848632e-02; -1.698005878948194e-01   +2.222741864776094e-02   +1.305475691531642e-02   -2.225090842961320e-01   +1.087670206775179e-01   +4.081920558624769e-02   +1.832628192654530e-01   +2.117272385450510e-01   -2.147535914192912e-01   +1.457930043276050e-01   +1.184318340658229e-01   -3.528393877015921e-01   +4.989395828885373e-02   +8.691979873884526e-02   -2.288765777358084e-02   +1.054186295040175e-01; +3.448015132014592e-02   -3.501957977937477e-02   -8.482277776329641e-02   -6.290934466824180e-02   -1.002917866281219e-01   +1.117461726974973e-01   +5.320039312096540e-03   -1.856388170880498e-01   -5.749646462465607e-02   -2.548981356374623e-01   -1.928972290721663e-01   +1.375091809042322e-02   +1.969886621395037e-01   -2.023744114113347e-01   +9.641424854666972e-02   -7.985458866783524e-02; -1.619898445574630e-01   +1.186457808998759e-01   +1.020990137330993e-01   +3.061634456327066e-01   +1.023205221680205e-01   -1.350053205161822e-02   +1.840899200895847e-01   +2.129900085221252e-02   +5.092484297713203e-02   -2.122404193315059e-01   -1.675530318671738e-01   +3.192632431732471e-01   -5.313814985016383e-02   -4.961845827275698e-02   +3.058716299878271e-01   -1.169734480454141e-01];
L2I_L1I_iGABA_netcon = [-1.493422135911426e-01   +3.909245213198159e-03   +1.179844573917507e-02   +1.159308645009963e-01   +1.110934540600848e-02   -1.753290861132469e-01   +1.161155159575575e-01   -1.151016367330522e-02; +1.369722492243705e-01   +1.326276946592929e-01   -1.178711657957658e-01   -5.804349724814720e-02   -1.898686859513047e-01   -1.316095274722578e-01   +6.211904886180822e-02   -1.232495334179975e-01; -4.753536461294170e-03   +1.175196516257320e-01   -3.652384681353602e-01   +4.439069778841875e-02   +1.498171565019583e-01   +5.661275684948357e-02   +1.307834116062483e-01   -1.568825942017578e-01; +2.280057597462599e-02   +8.518987492727473e-02   +2.321067571792243e-03   -2.185420404795275e-01   -1.180291115171510e-01   +1.262803135197794e-01   +1.210611061135855e-01   -6.089535086391634e-02; -1.656920211945200e-01   +1.176386231111833e-02   -5.787953980416665e-02   +4.906631235177623e-02   +1.496613463064494e-02   -2.086145245924639e-02   -3.294809677135355e-02   -2.652545628950821e-02; +2.325811227623467e-01   -1.250949275346220e-01   +2.172253288410682e-01   +2.963854607380362e-02   -1.930846653698134e-01   -6.788696609989690e-02   +1.610049301656184e-01   +2.539239319942619e-01; +3.063054314154344e-01   +3.794113699498081e-02   +2.166289437491674e-02   -3.458481326162913e-02   +2.232391588666625e-01   +2.252244067103876e-01   -1.375522681349267e-01   -1.941398757157089e-01; +5.134909009110511e-03   -2.324054185475326e-02   +4.084830091546588e-02   +1.702710357884271e-01   -1.678169869197013e-01   -9.977247180055170e-02   +3.371827534166356e-01   +4.707520397521166e-02; +3.532215730804783e-01   -1.453081079449316e-01   +3.525258068845727e-01   -2.499616600116605e-02   +8.721797817561530e-02   -2.190623222488235e-02   +1.875844344292747e-01   +1.589259082464989e-02; -1.756986701570524e-01   -3.037834060269656e-02   +1.381701583744124e-01   -1.322220806340348e-02   -2.005762169952424e-01   +7.315798816977982e-02   +9.378580643387600e-02   +3.326612637866084e-01; +3.388649561283673e-01   +1.527978673756744e-01   +1.742703578030985e-01   +1.035220077346619e-01   -2.221505787587754e-01   +1.538280283097750e-01   +1.128344933786986e-01   +2.015531891307271e-01; +1.147556863012595e-02   +2.684853210850879e-01   +4.700840090136896e-02   +3.025121572039750e-01   -3.762560918092722e-02   +9.996333732763818e-02   +2.991359035608340e-01   -6.975478579628926e-02; +1.830927849843395e-01   +9.418007202266487e-05   +9.294121832952831e-02   -1.814468869077386e-02   -1.526427224687471e-01   +1.545690437393344e-01   -5.996482016477405e-02   -9.360922981789287e-02; +1.079529047106977e-01   -2.962160992676712e-01   -4.084942430797415e-01   -1.678650043119080e-01   -1.341451733714395e-01   -1.256085291925386e-01   -2.580869478483099e-01   -6.271167461485723e-02; -7.375704892853537e-02   -4.282169363362844e-01   +2.112247975292982e-01   +2.568986142277138e-01   -9.412151075467294e-02   -1.405256840880104e-01   +2.739537135050639e-01   -8.454775294466603e-02; -2.683794195152190e-01   +2.230367496986233e-01   +7.135188701497215e-03   +8.248037000657130e-02   +3.416476770626301e-03   +5.954793295318739e-02   +9.942921742324445e-02   -2.257519794566137e-02];
L1I_L2I_iGABA_netcon = [+7.680727418337846e-02   -2.392061494592203e-02   -1.609435844411304e-01   -1.279933240870815e-01   +2.858818726824811e-01   +4.544809573445208e-02   +3.213326239662472e-01   -1.296976254497346e-01   -2.058992494684930e-01   -1.082043949046326e-01   -1.403548209475164e-03   -2.446171098755062e-01   +1.773803182713198e-01   +1.206652021060750e-01   +6.679615850723608e-02   -4.359648917894790e-02; -4.778176057715569e-02   -4.753098580992689e-02   +1.640562484939032e-01   +9.993002546371840e-02   +1.470630035396762e-02   -8.443465879613261e-02   -2.315315650523652e-01   +8.223980979440968e-03   -1.299463460811651e-01   -2.638869273146770e-02   -4.511661692205420e-02   -1.420037548593703e-01   +1.326468186153177e-02   +2.172373932047242e-01   -1.479419404007423e-02   +1.834092596073764e-01; +7.846456841147169e-02   -2.437673869259019e-01   -1.256076048986619e-01   -2.978257326623965e-01   -4.463380483656865e-02   -8.352596753308852e-02   +7.854322698519788e-02   +2.822814618768487e-02   -7.400215808532322e-02   -7.233013147794573e-02   +1.217101172331640e-01   -2.020032009123082e-01   -2.005872234078812e-01   +7.366634162009653e-02   +8.455151795986136e-02   +1.437361684717858e-01; +1.313376063945479e-01   -1.941120454043709e-01   +1.677684705005406e-01   +1.825561200330927e-02   -1.678985308705613e-01   -1.156009991144663e-02   -4.887508471945533e-03   +1.741013776126101e-01   +9.503722796555461e-02   +1.750201071383737e-01   -9.622610129547225e-02   -1.400419973488982e-02   +6.303666622620788e-03   +1.228853404157298e-01   +1.319345769748028e-01   -2.517901405414455e-01; +3.679294477749430e-01   -1.963408665851519e-01   +8.049821556041262e-02   +9.966685463690997e-02   -1.827068376582232e-02   -1.713461795963821e-01   +5.778900514190573e-02   +1.048897476514181e-01   -3.180473808239802e-01   -1.021096803873008e-01   +9.297167616336603e-02   -3.996772841961957e-02   -3.120261464221407e-01   -3.367441387141547e-01   -2.275884531797284e-01   +1.781632538459805e-01; -3.637808777290778e-01   +1.504177874715275e-01   -3.890363553239606e-01   +1.138873812688675e-01   -9.424941637682691e-02   -1.052307762015634e-01   -1.884461306265987e-01   +2.143008944341986e-01   +8.903608766998458e-02   -7.819454620952559e-02   -2.250697884822815e-02   +3.240327811434348e-04   -4.507206631330381e-02   -1.047285039701187e-01   -1.257135355464852e-01   +1.985784588576683e-01; -7.286580768300095e-02   -1.976750643520614e-01   +1.350355946512380e-03   +2.561110379418249e-01   -1.333888106794518e-01   +8.388380643579791e-03   +8.436011063801192e-02   -3.159368156117421e-02   -1.755776567823869e-01   +3.601456322207572e-01   +9.822250143198238e-02   +1.572874249565625e-01   +2.047382629924474e-01   -2.377793052891807e-01   -1.701336260638609e-01   -7.655457843384603e-02; -4.939862292275395e-02   -4.172491028347113e-01   -3.627219479397451e-01   +2.210200033369113e-01   -1.075113817541930e-01   -1.587069307981088e-02   -4.867807506465086e-02   -2.049590718167940e-02   +4.124071481002180e-02   +4.476800628568253e-02   +3.340379322832938e-02   +1.398544135840745e-01   +1.329211938578365e-02   +4.029197864729676e-02   +1.242972916221027e-01   -9.861715409839572e-03];
L2E_L1E_iAMPA_netcon = [+2.722063169034128e-01   +5.113296406781834e-02   -3.624878277163547e-01   -1.140392217828804e-01   -6.763535930316600e-02   -1.261360751142558e-01   -1.234603842805484e-01   -1.336676435529170e-01; +1.925669376301535e-01   +1.163759421633683e-01   +2.177950857688187e-02   +2.779951649518747e-03   -8.690536644687406e-02   +8.344697979269079e-02   -5.081867911588736e-02   -9.875973203763794e-02; +6.397763106214804e-02   +1.308561320055174e-01   -1.966185199294235e-01   +2.712593386101084e-02   +8.059762612061198e-03   +5.189956302070080e-02   +4.131890507792838e-02   +5.935085032289494e-02; -1.049034689144662e-01   +2.955192890999052e-02   -1.422495499358887e-01   +1.463072267572529e-01   +2.387076231838446e-01   -3.253683329863115e-01   -7.812538906082497e-02   +2.413004876068764e-02; -7.696828004598113e-03   -1.423583716036030e-01   -8.012834398759219e-02   -2.319855307089214e-01   -1.639226382806213e-03   +1.265400194874017e-01   +1.412717752126308e-01   -1.048927870912694e-01; -4.184174397701285e-02   +2.087007143660126e-01   +2.590945250733269e-01   -3.001616979737183e-02   -5.926126961351728e-02   +6.100011872191333e-02   +1.367404347362154e-01   -2.413265671677127e-01; -3.770208220012961e-04   +1.279092371488140e-01   -2.706959035142715e-01   -2.916555127188502e-01   -4.715645276199193e-02   +3.788952418145115e-02   -1.571627336619573e-01   +7.279523950118291e-02; +1.735833963912476e-01   -2.383777010906817e-01   +3.698963624040486e-01   -5.730256965885447e-02   +7.348843076872881e-03   +5.795034090046097e-02   -5.891697195984297e-02   +1.209057502106851e-01; -1.522969842867707e-01   +1.179159776905785e-01   -9.998264773746041e-02   -1.554588244660320e-01   -6.914653386024913e-03   +2.646338845837214e-01   -8.140011876074257e-02   -2.121979086737244e-01; -7.834208162944949e-02   -5.808730991866527e-02   +2.439821206688812e-01   -8.500249281581287e-02   +9.459124107948583e-02   +3.769364687196838e-02   -1.298815337285264e-01   +9.369410860179811e-02; +2.560463708657282e-01   +8.593664218152308e-02   -5.207339816472533e-02   -7.098819855545660e-02   +1.815721431705180e-01   +4.639131915482512e-02   +1.466887826804607e-01   -2.878948861417133e-01; +4.320756666406624e-01   -2.886003370174189e-01   +2.811010963530475e-02   +1.566714063147716e-01   +1.101430448569040e-01   -1.845062529797016e-01   -1.686930397894462e-01   +3.055885135297695e-01; +5.319981068151641e-02   -1.863574927810542e-01   +7.201908568821770e-02   -1.165106091743322e-01   +1.451446596100384e-01   +1.410121561973104e-01   -6.445162993574412e-02   -2.906829150835650e-01; -2.243281765767587e-01   -1.888352562019291e-01   -1.301022053480571e-01   -1.797284769054280e-01   +9.192742115902677e-02   -9.344964767966799e-02   +7.459224211497037e-02   -2.278830505082366e-01; -1.925815301847969e-01   -3.141497009668366e-01   +1.288341050145170e-01   +1.097811197697945e-03   -2.518149634788373e-01   -8.220266207124721e-02   -2.319648266960312e-01   +1.349853555620734e-01; -2.402658085027361e-01   -8.449195801847086e-02   -1.855014670463785e-01   +1.541493464818588e-01   -1.131912969881289e-01   +2.395836535880219e-01   +3.119096339305174e-01   -1.053546655525814e-01];
L1E_L2E_iAMPA_netcon = [+1.445313839421229e-01   -1.799918731153552e-01   +2.469551369200416e-01   +3.889501289830065e-02   +2.901947439554083e-01   -2.535972012778098e-01   +2.127376568583951e-02   +2.348321617939311e-02   +2.982579989564677e-01   +1.283564339591884e-01   +1.405840739458487e-01   -1.695489632272626e-01   +2.764589220324393e-01   -2.382186513783307e-01   +4.109730257674433e-02   +1.711169854706988e-01; -1.802027187631224e-02   -1.111731657719532e-01   +4.795735705520764e-02   +5.698253909887869e-02   +1.238140535439775e-01   +2.010359076488550e-01   +7.452442937220743e-02   -1.271867602302674e-01   +9.963489291839082e-02   -6.843031952409608e-02   -1.746978558344608e-02   +1.612792398860277e-01   +1.255250664595248e-02   -6.161117780985101e-03   +1.497998980107547e-01   -2.629688950064323e-01; +3.651413684022962e-02   +4.031972311781967e-02   +2.391967121565865e-01   +3.242866760471783e-02   +7.405500842836460e-02   +1.908974704047360e-01   -1.009016776880837e-01   +9.820475037022990e-02   +3.716161699865824e-01   +1.187923110394561e-01   +2.103865934222892e-01   -1.361525304581853e-01   -7.641816211989437e-02   -4.636401943411587e-01   -7.650405246397136e-02   +6.856352747034943e-02; +1.693776699192196e-01   -1.369171561080286e-01   -7.239066336846814e-02   +2.739162549764432e-01   +2.942922277086792e-02   +1.361050530738015e-01   +3.056979285005803e-02   +2.383354974392454e-01   -3.069361033061838e-01   +3.443666078095107e-01   -1.923010668355623e-02   -2.786344460017768e-02   -3.157223288115441e-01   -3.862593159177342e-01   -3.731622492100828e-02   -3.949183377264841e-02; -8.340821038436722e-02   +4.777586876238209e-02   +1.435927221944049e-01   +4.313676088919781e-01   -1.917242982664496e-01   -5.376763070949606e-02   +8.806037773713633e-02   +2.603854673022013e-01   -9.706455672305012e-02   -1.761697449652174e-01   -1.800458456052203e-01   -1.131175817418649e-01   +1.969589075048618e-01   +1.767918728498596e-01   +1.932210125633627e-01   +6.898580875882936e-02; -3.813893090866905e-01   +9.425285229172936e-02   +6.860422752814824e-03   +1.083356634925835e-01   -8.173524241253526e-02   -4.740288984159256e-02   +2.892617236840151e-02   -7.256929389823004e-02   +2.577549531520064e-01   +3.772515948920646e-02   +9.091444987830939e-02   -8.444820627500577e-02   -7.828574304670651e-03   -8.250679513859568e-02   +2.151260079419728e-01   +2.767879366154904e-01; -3.490880469679374e-01   -3.715857375974164e-01   -1.904568733679778e-01   -1.055374504467625e-02   +2.726206345915018e-01   +7.065661547080250e-03   -2.360776762985640e-01   -1.982246295369427e-01   -5.780702651865860e-02   +5.426055031332831e-02   -1.014625217914817e-02   -1.747909110575637e-01   +2.026146052121597e-01   +5.638916845253439e-02   -2.554716516277145e-01   -1.702256786433015e-01; -5.547540246243599e-02   -3.046804858482677e-01   -6.678890867488733e-03   +3.210899196958855e-04   +3.721215492019841e-02   -2.001816946108047e-01   +7.130367738354390e-02   -2.961664897918957e-02   +4.444438118139894e-02   -1.972526248325699e-01   -2.524177505949683e-01   -1.856049887573675e-01   -9.779105882509499e-02   -4.996477879548317e-02   -3.193942888776063e-02   +4.175301895709569e-02];
L2I_L2E_iAMPA_netcon = [-1.261488900828358e-01   -1.962656323294475e-01   +1.928630333780082e-01   -3.621584100023449e-01   +1.817682424294095e-01   +3.238703973227683e-02   +2.648035051421359e-01   +1.860790442819745e-01; +1.630570948283930e-01   -9.786872569279426e-02   -5.014549573510885e-03   +1.136664019376888e-01   -2.277392862774379e-01   +1.825470074701374e-02   -2.926405548922542e-01   -2.778400626597324e-01; +4.305622114887497e-02   -1.554072084228789e-01   -2.219092071525768e-01   -1.125176855317640e-02   -1.079468398325591e-01   -1.846737361403272e-02   +3.337953938380155e-02   +1.817958149065925e-02; -1.946908310908726e-01   -9.991778507816859e-02   -7.679648242905446e-02   -1.077915357193211e-01   +1.690907609117256e-01   +1.849686983306565e-01   -3.526056126269973e-01   -1.286444144843946e-01; +3.372916261839036e-02   +8.134560931048257e-02   +1.600759062910919e-01   +2.452046708648572e-01   +9.885326518517007e-02   -4.525236470174520e-02   +1.726017278369855e-01   -2.354044052622212e-03; +1.687066217126385e-01   +1.383294123729919e-02   +9.058029139511821e-02   -1.866487128208297e-01   -4.354551200433234e-02   +9.213131654112454e-02   +1.664857140352341e-01   +2.144789395256605e-01; +3.096231517235584e-01   +7.547568247109365e-02   +2.375398930882408e-02   +1.600176648288214e-01   -1.725014816789178e-01   +5.715682765322921e-02   +1.792424754665431e-01   -1.594219097322497e-01; -1.634759410938888e-01   +1.285468053621203e-01   +2.035207986413852e-01   +1.250046043706553e-01   -1.033431894729801e-01   -1.029933017313865e-01   +1.590994158042821e-01   +1.399254066746064e-02];
L2E_L2I_iGABA_netcon = [+4.385974574013736e-02   +1.385597080641959e-01   -1.980030755836821e-01   -7.163710647719101e-02   +2.906605136351864e-01   -2.007317707999716e-02   +8.334125378195864e-02   +2.861608324688193e-01; +8.374328512214825e-02   -1.324986031127554e-02   +1.646664416719860e-01   +5.550476271180361e-02   +4.831500785674929e-02   -9.568802484243424e-02   -1.393321223948309e-01   +1.958259522645642e-01; +5.829664527326713e-02   -6.073464092067971e-02   +1.532346643553193e-01   +1.849959049303223e-01   +1.933993704499548e-01   -1.835661238843431e-01   -5.482921588741655e-02   +1.715342333245123e-01; -5.341118285731571e-02   -2.992657461060793e-01   -1.314860257779628e-01   -6.287399141732504e-02   +1.908643063751754e-02   -1.381371518655153e-02   -3.444584766545197e-02   -1.525877298264225e-01; -2.021473623978185e-01   -2.966251213121440e-01   -3.788118123196577e-02   +1.600381323819881e-01   +6.320918298840758e-02   -3.447118422993725e-02   -3.884383147278653e-01   +2.400959381246698e-01; +9.674219267545806e-03   +2.909890455089116e-01   -5.598833955494711e-02   -2.564513231538406e-01   +7.375387848784712e-02   -1.401855160459277e-01   +6.332734710558230e-02   -5.766477923391526e-02; -2.170732560839534e-01   +2.685290535542403e-01   +4.481873939489428e-01   +7.250225231094224e-03   +1.068591925944378e-01   +1.107762149726101e-01   +1.193539024997351e-02   -3.281101875560993e-01; +2.394731827658614e-01   -3.771046164507184e-01   -9.854654114920271e-02   +3.313815645435232e-02   +1.737863514589262e-01   -7.083263000803272e-02   -1.445753018042254e-01   +1.675872432485334e-01];
L3E_L2E_iAMPA_netcon = [-2.003894603751696e-01   +6.432394718687345e-02   +6.530329217390299e-02   -1.329387137567829e-01   +2.965697117484115e-01   -2.037566903111895e-01   +1.437405075977343e-01   +1.830196540158819e-01   +1.614619188978381e-01   +4.987958396789658e-02   -1.417582454981392e-01   +1.652393235750501e-01; -8.221367459766941e-02   +9.576322477396534e-02   -5.710681988546520e-02   +5.293072797020978e-02   -7.361000364911474e-02   -3.710688196943855e-01   -3.126798439246087e-02   -3.631286105559838e-01   -7.676375140128010e-02   -1.092117067785345e-01   -1.450128288510368e-01   -4.004300315622793e-02; +1.316673384571687e-02   +3.862719216326566e-01   -2.599777937590236e-01   -1.893252875539680e-01   -1.885288173461953e-01   -8.276173117811833e-02   -1.197103238185851e-04   -1.683585868289349e-01   -2.671597381071901e-01   +4.708425339214755e-02   +2.409995734956340e-02   -1.306387371809696e-01; -3.128784344672619e-01   +2.986094388922171e-02   +4.520026476461965e-01   -4.694724308400530e-02   +7.738474365859895e-02   -1.914054960492932e-01   -5.979241923022485e-02   -2.807110511846028e-02   -5.895799775584418e-02   +2.829307131593668e-01   -1.113151787989614e-01   -1.941568123536532e-01; -3.427511755756615e-02   -3.193533361639873e-01   -5.145464692960349e-02   +1.510888073971231e-01   +1.949322559771904e-01   +1.558168590501447e-01   +2.601020947494023e-01   +2.474148003179769e-01   -2.222399866304500e-02   -3.717994562214895e-02   -1.884179868648068e-01   +4.699486029250421e-01; +6.454844302363374e-02   -1.361227800990325e-01   +3.456154437537957e-01   +1.630120015341049e-02   -1.752090847116296e-01   +6.695540697615970e-02   -4.128924464445467e-02   -2.464239379613573e-01   +1.522443650403114e-01   -3.027548186986087e-02   +2.101833340910439e-01   -2.285363891459683e-01; +1.855827744447127e-02   -2.937458698679025e-01   +1.307139206685433e-02   +1.010913476358700e-01   -8.138970294703748e-02   +1.018820679603888e-01   -9.408813064346251e-02   -4.972088864351826e-03   +4.917139114913097e-02   +3.763520359613332e-03   -5.785478199460239e-02   -1.563050969699099e-01; -1.312920914324436e-01   -4.132927447275523e-01   +5.090578143111232e-02   -1.254712874445764e-01   -1.368362703342399e-02   +6.434408698745595e-02   -9.243627923432154e-02   +2.778055352479227e-01   -1.165925058547217e-01   +9.302409031579403e-02   -2.388138560720644e-01   +2.398185665342050e-01];
L3I_L2I_iGABA_netcon = [+1.227790532584161e-01   +1.560627539748231e-01   +8.162643748800442e-02   +1.522262052585648e-01   -1.305437357214741e-01   -2.260308188560328e-01   +1.003138800564550e-01   -1.721321952434532e-02   -2.445566970684221e-01   +2.036880105116022e-02   -1.077265724861037e-01   +8.770958920892767e-03; -1.605391562028905e-01   +1.905937568733846e-01   -2.008107253907021e-01   -1.028304693081685e-01   -2.046561596932499e-01   -1.085868262220473e-01   +1.120704506331485e-01   +1.961635873614460e-01   -1.926440255680943e-01   +3.360058931845220e-02   -3.389807455500704e-02   +2.456828648271136e-01; -1.424360772952080e-01   -1.394534606388254e-01   +1.535938169373259e-01   -1.878756556672919e-01   -3.604624081544162e-01   +2.576085071758962e-02   -2.949122315340627e-01   -2.458338355418659e-01   -4.419106979964678e-01   -9.508002454889014e-02   +4.341805595673256e-02   -1.010269252282877e-01; +1.277766737525168e-01   -9.759115557594431e-02   -7.700555744966483e-03   +3.402538724879577e-01   +9.948218357556912e-02   +1.644079970031146e-01   -2.615913211189149e-01   +1.208719987686065e-01   -5.881636334998883e-02   -2.834583332662438e-01   -2.607223075655175e-01   -1.173884409960139e-01; -2.446864779836824e-01   +1.851369010671333e-01   -1.573748966846796e-01   -2.707861666534202e-03   -1.370374241468819e-01   -2.217213750549472e-01   -1.164326545575623e-01   +1.115408206081624e-01   +4.008194907797502e-02   +1.208564921076703e-01   -1.738693450696178e-01   -1.369194550595931e-01; -2.887996810229653e-01   +2.730669236153701e-01   +2.444156831398730e-01   +1.928559559720981e-01   -3.271931798981507e-02   -1.113924936525333e-02   +5.607870163054446e-02   +8.005401727980470e-02   +2.138223771102191e-02   -7.628105454601777e-02   -9.734620345263255e-02   -5.905484824859947e-03; +1.133673339626865e-02   +1.987812937247049e-01   -1.072131305840198e-01   -4.115375001597879e-01   -1.624671643800020e-01   +2.032867733771559e-01   -1.526791307145057e-01   -2.308204040126612e-01   -4.635783377437640e-01   -9.465719394818911e-02   +2.071926654433533e-02   +2.922620001223637e-04; -1.644450535981697e-01   +1.321687736454860e-01   -1.985674770807561e-01   -1.666731067589652e-01   +1.000328615183821e-01   -1.679385932909811e-01   -2.817824870889189e-01   -1.163914810528354e-01   -6.795763507520983e-02   +1.395892679116280e-01   -3.605420452994113e-02   -3.402709895396288e-01];
L2E_L3E_iAMPA_netcon = [-1.812211025407503e-02   -6.436946582225136e-02   -1.177678180037644e-01   +3.285257122999803e-01   -6.942517655824906e-02   +6.795702564385465e-02   -2.047698377342175e-01   -1.018643254986134e-01; +2.746024488872956e-02   -1.502398975936652e-01   +5.749042826389720e-02   +3.649180352666932e-02   +1.807557609607866e-01   -5.396185180255500e-02   -1.115017718982242e-01   -4.778051898791598e-02; +1.940802458426556e-01   -3.452553101844054e-01   -2.123031021600556e-01   +2.196116995974704e-02   +1.649721246059001e-01   +3.074386773187871e-01   -2.666814525665649e-01   +1.227094608290916e-01; +1.646340624993123e-01   +1.277337696471012e-01   -1.864060958702135e-01   -5.255250528475482e-02   -1.465249938792567e-02   +1.205198719564312e-01   +4.454016103038837e-02   -4.026217580213310e-01; +3.158936043518626e-01   +1.298400116210871e-01   +2.574980403397870e-02   -1.938011902469312e-01   -6.260701615245579e-02   -3.385233432824176e-01   +1.252710025594537e-01   -1.517178897845783e-01; -1.383795682497494e-01   +6.079868184263100e-02   -3.597667500757091e-01   +1.494307936199601e-02   -2.692745571804233e-01   +3.585009935896739e-02   -2.391601419118609e-01   +3.045915183240970e-01; +7.907279852450855e-02   -2.358649569556479e-01   -1.339180951527189e-02   -3.797075123084749e-01   +7.595860666747301e-02   -3.407425042943327e-02   +2.918361978308595e-01   +1.334384951596487e-01; -7.885795645500454e-02   -7.665229865044086e-02   -1.832242016906361e-01   +4.914736703031322e-02   -3.667791807822299e-01   -1.065469006153213e-01   +1.015714755206975e-01   +1.248733907734386e-01; +3.692911664919577e-02   -2.594284866050079e-02   +6.851035830945132e-02   -1.354665249221028e-01   +5.008902755531938e-02   -1.620208118030061e-01   -1.408100251875874e-01   +2.388509748300778e-01; +3.130051554003306e-01   +2.006776914835304e-01   +2.044426955081502e-01   -2.364181817391433e-01   -6.267339430888794e-02   -4.424980025570190e-02   +3.653352869260312e-02   -1.766690792662056e-01; +3.016459931926645e-02   +7.082551880715732e-02   -7.758950763203500e-02   -1.470674696485919e-01   -1.934769864322691e-01   -1.146370209805612e-01   -2.386633126484053e-02   +9.512306535792452e-02; -2.612926918079043e-01   -1.155201572010489e-01   +2.599774535730968e-01   -2.271710661328264e-01   +2.105086916086855e-01   -6.534648768256672e-02   -1.809276356624998e-01   -7.859073434502455e-02];
L2I_L3I_iGABA_netcon = [+5.127005415744178e-02   -3.804714831091566e-02   -1.420270801765474e-02   +5.937217075014466e-02   +2.984188181927715e-02   +2.717722164774443e-01   +3.938379150770129e-01   -1.083574487148522e-02; +1.168502955433841e-01   +4.215129886872457e-02   -1.069297795136197e-01   +1.879752797479292e-01   -2.424325772300231e-02   +1.043400138721558e-01   +6.015723248492670e-02   -9.198160003821109e-03; +6.388367660093289e-02   +1.961460266182261e-01   +1.131461879441337e-01   +2.044215035665250e-01   -9.261156530889506e-02   -5.370776938910719e-02   +1.208113058077503e-01   -1.556496857749290e-01; -2.961565344777369e-01   -9.805603179358130e-02   +1.059808201504375e-01   +1.750117474183074e-01   -1.032317691133985e-01   +9.538736031292917e-02   +3.347667915336604e-01   -2.547798569949752e-01; +3.080244636866826e-02   +2.643913065679379e-01   +2.583682295084488e-01   +1.822355616967446e-01   +1.467017631993387e-01   -1.471794804670372e-01   +2.873024474089368e-01   +3.045887073979806e-01; +8.802525296887480e-02   -1.143380028041112e-01   +3.653291962894276e-01   -2.245989270213438e-01   -1.955580092557779e-01   +1.993777756504861e-01   +2.728334997960665e-02   +4.104447317673542e-01; +1.016279288359785e-01   +1.910588121660471e-02   +3.623042903323463e-01   -2.156338198473438e-02   -2.277277101376311e-01   -1.160174517554667e-01   -9.091455836603773e-02   -1.154277474046247e-01; -1.146551952983276e-01   +4.982975020172564e-02   +1.964646293191500e-01   -1.869896829168080e-01   +2.599893130922881e-01   +5.174142833279526e-02   +2.571720702438571e-01   -2.244041649794485e-02; -1.408945509666460e-01   +3.231822469734987e-01   +2.533427484317659e-01   +1.968336838902225e-01   +1.856675686274442e-01   +6.684519402821018e-02   +1.234698875545623e-01   -3.398228165379301e-02; +9.544082977191001e-03   +8.903739023856469e-02   -1.145112543993715e-02   +1.247005978466379e-01   -2.758449631059519e-01   -9.288069507307900e-02   +1.068646087793131e-01   -2.066293566488747e-01; -2.268807026069349e-02   -3.036867294051996e-01   +9.846785326935621e-02   +9.018432481164548e-02   +1.843748888927871e-01   -1.811615179238257e-01   -2.766646023397784e-02   -1.634007046296628e-01; -8.246905470674502e-02   +6.136200617011654e-02   -9.711841162792371e-02   -8.325220680691880e-02   +2.435836140180223e-02   +5.558095436894013e-03   +2.360995860322746e-01   -5.865111501170330e-02];
L3I_L3E_iAMPA_netcon = [-1.928472807505984e-01   -2.820071676384279e-01   +5.021148462408606e-02   +1.906778594739503e-01   +1.561281170005055e-02   +9.283562942521385e-02   +3.347027139293297e-02   +1.988572807396713e-01   +1.040809387010204e-01   +1.794208712363214e-01   -7.883510987311168e-02   +4.369959529713214e-01; +1.136572248252222e-01   +2.020613799250785e-03   -1.872840516555731e-01   -3.438622269985293e-02   +6.576862142226531e-02   -1.892228990526563e-01   -2.019647113702180e-01   -2.936583190643659e-02   +4.475891363792001e-02   +4.334667498871590e-02   +1.863578451760481e-02   -1.129651941422692e-01; -1.925917302039516e-01   +3.612086265699121e-01   +9.434273370053305e-02   +2.341758206713202e-01   +1.600332527069015e-01   +3.282093022729194e-01   -7.418844472510611e-02   +1.541490615098061e-02   -6.684613642878665e-02   -3.577436578019591e-01   -2.039800498399004e-02   -1.635631325639722e-03; +3.393736433454255e-02   -2.758470417514453e-02   -2.334033179686923e-02   +2.676726352900920e-02   -2.682628267853533e-02   +2.605414608292000e-02   +6.812805980404114e-02   +1.933737816139881e-01   -1.874184621574574e-01   +1.410973975830286e-01   -1.127176790478048e-02   -3.283065847137018e-01; -1.517748430962742e-01   -2.114734062662892e-01   -1.415808941340796e-01   +2.195621250297742e-02   -2.658516403408258e-03   -9.516727643876782e-02   -1.712145568296831e-01   -1.443250212092352e-01   -4.187122649720434e-02   +1.559174968283752e-01   -8.761505043272294e-02   -6.585141459572842e-02; -3.990242455528331e-01   -2.849598012997881e-02   -5.386607035144114e-02   -1.173119513316753e-01   +2.713305959937559e-01   -1.397276636468956e-01   +2.030764233720447e-01   +1.769802847543225e-01   +1.285026780403426e-01   +3.267379667821759e-01   -1.856021432475352e-01   +1.985363143930209e-02; -9.748894308023555e-02   +7.962256659337433e-02   -3.963652115208968e-01   +5.939468450979137e-02   -2.265352910780468e-01   +5.518127583365671e-02   +1.959877968379093e-01   -1.622148840093996e-01   +1.056216583444392e-01   -7.097696077304408e-02   +2.573437052286172e-01   +1.274127278231549e-02; -1.310657814002684e-02   -2.620122206792260e-01   +1.286433537670043e-02   +2.933790737915581e-01   +1.502838246440950e-02   +1.590418915931056e-01   +9.059791928234098e-02   +6.496345839049950e-02   -9.993329520645736e-02   -1.451562446907516e-01   -4.770883417639511e-02   +1.129466583595270e-01; +2.810386733766194e-01   +7.119837481679005e-02   -1.848331744853793e-02   +2.168567897592293e-02   +1.529687341794475e-01   -3.531711805368439e-01   +2.791211653737127e-02   +2.087088314449752e-02   +9.935833775658119e-03   -2.175741055672248e-01   -9.908890992504314e-02   -1.591578005888531e-01; -4.769607727134872e-02   -2.631162871741686e-01   -1.949598043745926e-02   -7.214931701195777e-02   -2.311615463539979e-01   -2.038060333436963e-01   -2.969395381604644e-01   +3.346142172868294e-01   -2.194764905662196e-01   -7.453437862771431e-02   -1.070409189247765e-03   +4.766356305464283e-02; -1.159684743987165e-02   -1.524622214605675e-01   +1.100629462897295e-01   -2.000355242348929e-01   +3.223224373603542e-01   -3.644610851826623e-01   -7.685804954890266e-02   -4.927500386877879e-02   -3.308399062188508e-01   +9.834851472285250e-02   -1.244943943627050e-02   -1.199547297899947e-01; +1.674383608326113e-01   -1.342633470103139e-01   +2.534441195750217e-01   -1.680499511225052e-02   +1.000532837772826e-02   +1.175612981416592e-01   -1.809372571506176e-01   +1.455488233029372e-01   -8.934788130102340e-02   +3.894508574504604e-01   -9.221029132213905e-02   +4.230625836509894e-02];
L3E_L3I_iGABA_netcon = [+6.170383102517561e-02   +2.397758263242494e-01   +2.389095461436365e-01   +1.820722432475646e-01   +1.715813080894164e-02   +4.280592192444004e-02   +4.250072415045001e-01   +2.971336871346392e-02   -1.445156180458043e-01   -2.352147814484661e-01   +2.093373374357946e-01   +2.047357472393678e-01; +3.441713804996062e-03   +1.179649949970683e-01   +7.811207327062629e-02   +2.107506745125863e-01   -9.730220634277095e-02   +1.737552791485632e-01   +5.565512744983834e-02   -2.015254286604855e-02   +8.923935976021091e-02   -3.235473201419022e-02   -4.349535226069574e-03   -1.061868211180642e-01; +1.397849273031850e-01   +2.288785393016302e-01   -8.795647121523320e-02   +2.033546527138723e-01   +3.997166803132143e-01   -1.793431146245680e-03   -1.826422245477733e-01   -2.395346878942059e-01   +7.427774321622418e-02   -9.386201391832379e-02   +3.513083967403237e-02   -2.973670209536557e-01; -3.036158936554112e-02   -1.490745923199889e-01   +2.337998022179367e-01   +1.586657532941709e-01   +1.071798497931536e-01   +1.675260927640242e-01   -2.917577872149548e-01   +3.120799656943025e-02   -2.833790219833536e-01   +1.552333014451573e-02   -2.332885525798242e-01   -1.902224427404141e-01; -3.734532755438379e-01   -1.496309523025453e-01   +1.706713542790657e-01   -1.160099720449015e-01   -5.673572142464132e-04   -1.396912223974996e-01   +7.102868381881512e-02   +4.252144945769365e-02   -7.987585542419670e-03   -7.989298494616381e-02   -1.527927423611322e-01   -5.735475611310978e-03; +1.995955533004751e-01   -7.720456768691468e-02   +2.327857603231877e-01   +1.276767021547290e-02   +2.233551076953412e-02   +1.950610488791018e-01   +1.060680163051941e-01   -1.105795435730351e-01   +6.079257518526137e-02   -1.599288668761546e-01   -6.659297188229077e-02   +2.469916586969101e-01; -6.937081385430598e-02   +5.453478761766463e-02   +3.935588466032598e-02   +3.559676897292688e-01   -1.522678092056070e-01   +2.144193471457783e-01   -1.936977463150884e-01   +5.136463168276099e-02   +2.844556165195942e-01   +1.744794559552065e-01   +9.505390908902225e-02   +1.272204340634446e-01; -3.063800441777823e-01   -1.257516525396050e-01   -4.571541902415990e-02   +1.594611033291910e-01   -1.839537544566851e-02   -1.292982058824579e-01   +5.560288756052052e-03   +8.414878121344935e-03   -9.654935368623382e-02   +2.545769576794218e-01   -2.606291548949502e-01   +2.397161922513997e-01; -1.712945203433094e-01   -1.668135926200540e-01   -2.333678493763582e-01   +6.243477765932510e-02   -1.098805048549659e-01   +1.436109258042441e-03   -2.676201421006482e-01   -1.094443841313739e-02   +1.009888462852764e-01   +2.963973682016171e-01   -1.018806259548595e-01   -1.330331895088784e-01; +1.816440559871473e-01   -7.222130166738114e-02   -7.623994583450125e-02   -6.861766928633813e-02   +1.311466262748755e-01   -1.987248740090368e-02   -2.552157556998216e-02   -1.719240809557492e-01   +1.114180942207738e-01   +3.919928311333017e-02   -4.809202239897976e-02   -6.361335220178391e-02; +1.454523826881174e-01   +9.459455303427336e-02   -3.390993619141022e-02   -6.887364052709913e-03   +2.602044462635957e-01   -1.261491036471781e-01   +2.229069225891542e-01   +4.839781957685835e-02   -1.220221615388783e-01   -2.081060082424676e-01   +1.536624958274630e-03   -2.472163743034040e-01; -9.474990159155174e-03   -2.381966044305356e-02   +9.349443814679370e-02   +1.541533799158041e-01   -2.281761964956268e-01   +9.103211089334601e-02   +2.775763501721786e-01   -6.588014160276578e-02   -2.952547414384405e-01   +1.161148272828656e-02   +6.776738304054747e-02   -2.767406215277719e-01];
L2E_Input1_iAMPA_netcon = [-1.896818301054689e-01   -1.031074784449966e-01   -3.040416276101130e-02   -1.962122542315669e-01   +1.186688120982275e-01   -7.522675132642766e-02   -2.060579087986539e-01   +2.626193123126968e-01];
L2I_Input2_iAMPA_netcon = [-2.433813785781368e-01   -6.416394213674433e-02   +2.892282377828156e-02   +4.322395317494170e-02   +2.842904925189625e-01   -2.079491713285989e-02   +2.535914215457377e-01   -2.286265129821763e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
