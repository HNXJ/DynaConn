function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.148149888390277e-01   +9.465801095362802e-01   +6.992947367672253e-01   +1.553574078119312e-01   +9.219345354328996e-01   +2.196907174103735e-01   +7.406926872189620e-01   +3.018291708112208e-01   +5.329829134652122e-01   +8.293199189612520e-01   +9.688346277900892e-01   +9.644556784255583e-01   +6.960147340802790e-01   +3.709494029626831e-01   +2.976937152288516e-01   +3.790129133872621e-01; +3.449235626604413e-01   +1.337729579380203e-02   +1.415638552213151e-01   +1.754260140345794e-01   +7.124551859850849e-02   +8.071431794588820e-01   +7.949537350617262e-01   +7.582418601837581e-01   +7.845133098747481e-01   +1.812693316200207e-01   +4.663991884103820e-01   +6.566657889205494e-01   +3.753989834737579e-01   +2.748209112832685e-01   +6.851653398076996e-01   +9.534285248696361e-01; +2.076660962528199e-01   +4.674445816275747e-01   +8.334803332341149e-02   +7.036744393832017e-01   +3.138284355715258e-01   +3.821959860095377e-01   +6.638085610092748e-01   +9.527718813138638e-01   +4.887757692918828e-02   +9.266345562928079e-01   +8.696715714725456e-01   +2.093815592008203e-01   +5.411645034151613e-01   +7.543339164433961e-02   +7.720669342557790e-01   +8.110859661005930e-01; +2.505294177910216e-02   +4.898782969537906e-01   +4.333082651588127e-01   +8.321349720926304e-01   +6.275567751054333e-01   +8.563219262059277e-01   +4.418324877542050e-01   +8.506011994679439e-03   +4.626375515261970e-01   +4.205924829034259e-01   +9.461176043244460e-01   +8.976280738464358e-01   +5.180241740077800e-01   +1.509614451259974e-01   +7.208088227153721e-01   +8.916783327972043e-01; +7.655560562862298e-01   +5.153381907143720e-01   +8.951158654903169e-01   +8.139645071640629e-02   +9.056528447855514e-01   +3.242650267172381e-01   +5.751788948864471e-01   +4.070913689618864e-01   +9.380563203309550e-01   +3.008841528287639e-01   +2.326447493488567e-01   +4.880917483880922e-01   +7.643166496916974e-01   +3.650203585654815e-01   +2.786074670229713e-01   +6.845167589967403e-02; +5.711350183960654e-01   +2.871436679907676e-01   +7.320531477915817e-01   +8.356083957344140e-01   +7.969023328469832e-01   +3.789490838498040e-01   +5.180413942568886e-01   +1.511478065084769e-01   +4.726242320553621e-01   +3.486121131155608e-01   +9.183515338764374e-01   +6.615002376642809e-01   +7.987572334316202e-02   +7.183578891288335e-01   +1.379244773880979e-02   +9.028044666113534e-01; +5.765029093196569e-01   +5.647613734918394e-01   +6.803070479560184e-01   +5.410906518453901e-01   +6.427879911641906e-01   +6.369711997876045e-01   +7.249739893436167e-01   +8.214448082264677e-01   +7.791569541848508e-01   +9.721730010431002e-01   +6.349106554018266e-01   +5.259359936847067e-01   +5.115737533612180e-03   +5.325373140362593e-01   +1.459996158899978e-02   +6.681732090475911e-01; +3.905264905158901e-01   +5.099121495302364e-01   +2.012912881090437e-01   +9.630066841696973e-01   +4.400473165325291e-01   +3.881066781096985e-01   +2.224283807714851e-01   +2.876001118058563e-01   +1.090645578149031e-01   +5.307084282549278e-01   +2.837306731878249e-01   +7.086989901213623e-01   +4.004557963152781e-01   +2.325806234079467e-01   +9.367103534846032e-01   +3.465903835932367e-01; +5.566367602051664e-01   +6.781344905680942e-01   +5.296545498309302e-01   +6.776001353680171e-01   +7.480489055115304e-01   +6.748344127639268e-02   +9.982602254371483e-01   +9.781214750288587e-01   +5.224742909346525e-01   +7.902212060443535e-01   +8.552162505305058e-01   +7.188072617852933e-01   +6.618749505760930e-01   +4.706226116123585e-01   +9.338973199451345e-01   +8.367497577294053e-01; +1.836871572274805e-01   +6.157213322198360e-01   +8.304016650450832e-01   +3.364178915520130e-01   +8.251055955504811e-01   +1.709271362034431e-02   +6.200340039867375e-01   +6.253068676277269e-01   +6.360352616311794e-01   +7.937559630803789e-01   +1.653850435065412e-01   +2.947730970112523e-01   +3.682283994609715e-01   +7.170431824266165e-01   +3.744749676662024e-01   +1.986032618042969e-01; +1.183323415853032e-01   +5.652961701668260e-01   +1.747815045906544e-01   +2.208865635085424e-01   +3.411400729876941e-01   +8.792687627268486e-01   +9.798648911242417e-01   +7.440791213715747e-01   +5.784049927153252e-01   +1.450834648731414e-01   +8.282374603364621e-01   +1.170174241358068e-01   +3.923282347182205e-01   +5.146638781509163e-01   +1.092822978353915e-01   +8.421134890841491e-01; +5.874192451584323e-02   +5.045419854865981e-01   +5.183949536816839e-01   +5.693701718603823e-01   +1.392930207532498e-01   +1.575592907121673e-01   +4.952123092114643e-01   +8.727133023865251e-01   +8.352721112684828e-01   +4.560587407568930e-01   +2.165266905739910e-01   +3.251247661824311e-01   +1.345358492377078e-01   +5.142071454669672e-01   +7.194550198417075e-01   +4.251906232887985e-01; +9.327878885451397e-01   +6.680092212347295e-01   +3.557917363047504e-01   -3.227095990502400e-04   +5.039158472884452e-01   +9.139531034663930e-01   +5.230106895053700e-01   +3.291412929030562e-01   +1.160822987853844e-01   +4.588158263153559e-01   +2.686188996118121e-01   +4.566139299267868e-01   +3.384995779661234e-01   +3.859072170932042e-01   +4.495562945728733e-01   +5.590519405372820e-01; +7.456423039013107e-01   +6.330378689382886e-01   +6.447542979391222e-01   +5.885929454612051e-01   +4.137943951685432e-01   +5.558876388229848e-01   +8.546978544993155e-01   +9.897801235949488e-02   +5.215546221716810e-02   +9.540775000869971e-01   +8.663481663385411e-02   +7.170837826066075e-01   +1.219696448477925e-01   +4.795342887979264e-01   +1.251973464347555e-02   +4.485557261940947e-01; +2.430290880668689e-01   +1.451207377213381e-01   +2.819339407526205e-01   +8.914006788612018e-01   +1.715386198976273e-01   +9.222296098948759e-01   +2.540678494359911e-01   +4.507866811376308e-01   +5.174982373866825e-01   +5.350794439181437e-02   +9.165513551275640e-01   +4.050099775238909e-01   +3.689310651700851e-01   +7.397297748026502e-01   +1.240962232487887e-01   +7.597328821775331e-01; +2.044779157235138e-01   +1.792266119440734e-01   +4.366351062414461e-01   +2.548725713943196e-01   +4.939269468678452e-01   +5.976604171377138e-01   +5.828499121741216e-01   +2.397506258023587e-01   +6.975537985050444e-01   +3.659818370566588e-02   +7.263178300963311e-01   +2.418014537987191e-01   +2.507679936929204e-01   +7.019831077346634e-01   +6.586901325624835e-01   +9.591042191045397e-02];
L1E_L1I_iGABA_netcon = [+8.440349751401152e-01   +7.527473661156828e-01   +8.744121393938328e-01   +4.350836198370478e-01   +9.179825257751267e-01   +7.789392948004864e-01   +3.219052040161621e-01   +6.409311994632286e-01   +9.420322941503585e-02   +2.661765765029629e-02   +1.292095450390867e-01   +5.201892703965669e-01   +8.702406641114074e-01   +5.765670638406770e-01   +1.657355373325116e-01   +6.270978036174248e-01; +6.213231437734046e-01   +9.954278491786394e-01   +3.092929873784934e-01   +1.473177971204603e-01   +8.833236540023539e-01   +2.728424594384223e-01   +9.630791158101613e-01   +4.292719416058784e-01   +2.924662615353470e-01   +5.144171297760293e-01   +4.250665841518559e-01   +2.041884171303917e-01   +8.029573503952557e-01   +2.882161071192811e-01   +5.491910224471728e-02   +3.361640005771539e-01; +6.717996868550868e-01   +3.709928137680420e-01   +4.335987934059768e-01   +6.543672040260878e-01   +5.859082460821438e-01   +5.268659301915558e-01   +3.527908978735623e-01   +4.778154437903865e-01   +3.261193683601215e-01   +8.632490645579309e-01   +4.807347212401862e-01   +7.750566558800420e-01   +6.468395414380268e-01   +1.320619827768567e-01   +2.110932668405814e-01   +1.561103264111482e-01; +7.819503776217184e-01   +5.020481446195363e-01   +3.816120539507830e-01   +7.212415229047243e-01   +8.352986920985180e-01   +4.030532781937310e-01   +3.201736710884669e-01   +1.002024447719976e-01   +4.829799455644876e-01   +5.812745658037686e-01   +6.738664830058768e-01   +3.911990346171427e-01   +7.347582602841765e-01   +4.954311324461653e-02   +2.041130979826982e-01   +4.022751524868940e-01; +3.090531733211414e-01   +7.588572586923354e-01   +6.566632438278438e-01   +1.618144781894907e-01   +7.766115363909860e-01   +7.791048208142380e-01   +9.082554383595939e-01   +8.073284334900005e-01   +2.415936165658405e-01   +4.222773763557066e-01   +3.574176362106230e-01   +6.672254002719001e-02   +6.671922143289083e-01   +6.242206830229453e-01   +2.173393039723926e-01   +9.130069662814682e-01; +3.302877024310779e-01   +1.273556049494556e-01   +2.368592116349921e-01   +3.426978476924367e-01   +7.848174489885174e-01   +2.580768520853770e-02   +8.846761338945497e-01   +6.534192006622891e-02   +4.537126475012759e-01   +7.131824485612199e-01   +5.019414036960097e-02   +7.561219394602288e-01   +8.809453349321857e-01   +6.059195968750387e-01   +5.782879470903821e-01   +1.490247786835926e-01; +6.340231111387512e-01   +5.179232384912766e-01   +6.857495256081583e-01   +1.063344252256144e-01   +7.014862769045364e-01   +4.120663291582634e-01   +3.523834411446375e-01   +9.543753912051890e-01   +7.585627096963855e-01   +2.338990571063385e-01   +2.906315727709370e-01   +4.529727270062748e-01   +8.530434903395536e-01   +3.711996224245737e-01   +3.335435528976970e-02   +4.640530057331424e-01; +9.019405305680167e-01   +9.060029510232706e-01   +3.267926461977381e-01   +4.125886385676714e-02   +1.847245524322737e-02   +8.264418679185989e-01   +7.499394476428276e-01   +7.730178948607045e-01   +7.188959858325735e-01   +5.870857931462600e-02   +7.941209738237361e-01   +3.190207196517431e-01   +4.037762275141256e-01   +8.318493564785475e-01   +7.954506731928616e-01   +7.856045808954229e-02; +3.711357921933400e-01   +9.912703060791596e-02   +8.812019769217618e-01   +4.785302969745693e-01   +3.306401764737756e-01   +5.925449993761807e-01   +1.263217622740990e-01   +4.404453452348301e-01   +2.376678680023775e-01   +9.762837840124637e-01   +6.519668837259356e-01   +2.780855735151145e-01   +1.054169705764785e-01   +5.196848353686208e-01   +1.341851482850907e-01   +3.422987634420019e-01; +8.818603217915292e-01   +1.789669813068541e-01   +9.990195734553737e-01   +4.771650975348263e-01   +9.477628166934827e-01   +2.134791650794085e-01   +5.992823641943754e-01   +1.657006923358756e-01   +6.993705247908529e-01   +9.696783545794880e-01   +7.099247556943862e-01   +5.838265064437496e-01   +4.032575645721994e-01   +8.008631223897166e-01   +5.823794753969123e-01   +4.966637131464680e-01; +1.242065132221718e-01   +1.729326617137045e-01   +6.805234497653233e-01   +5.461736773288000e-01   +3.988356350914596e-01   +2.961394929293757e-01   +4.369506677718716e-01   +8.097440211370971e-02   +3.049519677262000e-01   +1.368820850635945e-01   +7.656512539334955e-01   +9.117763778226805e-01   +3.406521873461759e-01   +5.703593384937595e-01   +8.547979490027179e-02   +4.892651667234137e-01; +8.865559699998769e-02   +5.338680421501005e-01   +3.445432212053761e-01   +6.512965793778749e-01   +6.322209532071058e-01   +2.680910658565692e-01   +9.590795441900851e-01   +7.424181876771999e-01   +4.700368637877592e-01   -2.795849502550504e-04   +3.837948800406837e-01   +4.507915089736349e-01   +1.146310216151235e-01   +7.149192741114139e-01   +2.289926864624388e-01   +1.275901209442002e-01; +5.459805122332191e-01   +9.791608395958302e-01   +5.605021327535185e-01   +3.489878287263966e-01   +8.588688688076679e-01   +9.283307202723027e-01   +9.641222464953060e-01   +5.441766290600235e-01   +4.444340107123584e-01   +9.368318011344839e-01   +3.616374463755624e-01   +9.803040952621022e-01   +8.517889839362631e-01   +7.326202745235675e-01   +4.519247068791406e-01   +8.596953182646365e-02; +6.105079048567051e-01   +8.432230447719016e-01   +8.905249074510292e-01   +2.559842393498882e-01   +3.773386767081113e-01   +5.526748970283791e-01   +2.422382379051083e-01   +4.857778500803330e-01   +7.343343563603163e-01   +7.410209510114698e-01   +8.101864263259793e-01   +1.110616971106901e-01   +8.924105007475578e-01   +4.549375115560991e-01   +1.787714988939341e-01   +6.742100409488432e-01; +7.275189711996185e-01   +6.728293025506942e-01   +6.464561923555361e-01   +1.763546523730978e-01   +2.046923122503179e-01   +4.322375715009182e-01   +7.704624948245703e-01   +8.954721150486070e-01   +8.762908911437457e-01   +4.325197404247021e-01   +3.858758181176836e-01   +4.154395001793768e-01   +6.857133129986613e-01   +2.830989036992607e-01   +4.141006999527082e-01   +1.220850349012181e-01; +9.920067527928971e-01   +9.231411575428949e-03   +3.768709754699694e-01   +4.785115975117321e-01   +9.120897239224552e-01   +3.279917076410507e-01   +7.125831244459673e-01   +5.824302890914352e-01   +9.135598420197886e-01   +9.441874565135442e-01   +8.715667423445632e-01   +3.827743678379223e-01   +7.429208919829347e-01   +1.515698560928055e-01   +9.650564658281644e-01   +9.889052622906798e-01];
L2I_L1I_iGABA_netcon = [+5.740773443715588e-01   +5.648104336792272e-01   +1.078611942723250e-01   +4.598086059526577e-01   +7.966673355386947e-01   +9.780049990911228e-01   +2.238827882499758e-01   +7.582895498136587e-01; +5.581572355005073e-01   +9.534950928689294e-01   +1.188475586240286e-01   +5.666907979390280e-01   +5.423341664814186e-01   +4.225925378193175e-01   +6.612582887842855e-02   +5.063112366988086e-01; +6.109606599996324e-01   +8.640875828689961e-03   +4.341693556817086e-01   +8.168395814712981e-01   +2.571173168841994e-01   +3.930209752209325e-01   +8.356101540242370e-01   +8.283476965780258e-01; +4.668546966152349e-01   +1.260885683871941e-01   +9.321418422952298e-01   +3.555095428757968e-01   +7.813935144669242e-01   +4.608445681939950e-01   +4.142190834087521e-02   +9.274671608581631e-01; +4.343412293539566e-01   +8.537837509110671e-01   +1.399536176882037e-01   +2.484085822206963e-01   +7.794381181554878e-01   +1.215124164877038e-01   +9.094757338404377e-01   +7.107470074975381e-01; +6.259369367872512e-02   +2.181206062419088e-01   +8.260175153565306e-01   +7.711498153868351e-01   +1.443546116005058e-01   +4.545389501016964e-01   +4.492803480152615e-01   +7.975701815039028e-01; +6.466997704178689e-01   +7.097457735487109e-01   +9.327372250014645e-01   +1.677131103975575e-03   +8.235920592121526e-01   +2.646902350945265e-01   +2.845042969010619e-01   +9.589185438581311e-01; +4.263119202201191e-01   +7.748756338503856e-01   +5.727954474530081e-01   +2.765010753513586e-01   +6.234382764116513e-01   +9.287529221192423e-02   +7.555213464645232e-01   +9.514770274610295e-01; +7.562404026372413e-01   +4.213502343789849e-01   +4.987253220007830e-01   +2.314898316109610e-02   +4.569075031004372e-01   +6.619302256040481e-01   +9.269612871093080e-01   +2.954670314406761e-01; +3.064400680103108e-01   +7.257412542644726e-01   +9.314859842993887e-01   +6.702424638802610e-01   +4.835991691480942e-01   +9.450894553899246e-01   +1.408597738569223e-01   +3.521066355522266e-01; +5.972618098997072e-01   +4.582032508885771e-01   +8.623787563872346e-01   +9.673393593353997e-01   +2.190296049328638e-01   +7.647072382576239e-01   +9.555324783615512e-01   +5.413198477599559e-01; +3.346344281201671e-01   +8.050994169881084e-01   +2.538182217658662e-01   +9.455529384268622e-01   +8.578133912174144e-01   +4.332632958012152e-02   +3.043128060691760e-01   +2.129467487507659e-01; +6.431274085819734e-01   +4.279027622450649e-01   +4.585766491528810e-01   +4.632629554233303e-02   +8.799885279313544e-01   +2.608516390423853e-01   +2.096189822125480e-01   +8.092807356882877e-02; +5.998174016213300e-04   +1.489846534464062e-01   +7.409222364389636e-01   +2.866481369202308e-01   +8.456892832657030e-01   +6.346295794014871e-01   +4.637777441941842e-01   +5.065179591052074e-01; +1.444729286158215e-01   +8.053312454557340e-01   +7.523423896857555e-01   +4.877952434454572e-01   +4.431022717620881e-01   +8.947554879705502e-02   +5.972887215624706e-01   +1.947278562396004e-01; +2.478595890366065e-01   +3.814652248513514e-01   +2.299254017080098e-01   +8.876858255682105e-01   +5.429310828459011e-01   +7.496188318473423e-02   +5.518827077961422e-01   +1.458593557184912e-01];
L1I_L2I_iGABA_netcon = [+6.987085259056243e-01   +8.673113091329893e-01   +6.140281802073730e-01   +5.529363903189162e-02   +1.433857098216186e-01   +2.346229202108917e-01   +8.383402387428208e-01   +3.708017979602964e-01   +7.065935236707414e-01   +3.844349681603482e-01   +2.395178106095706e-01   +6.668760272350747e-01   +1.682069623440866e-01   +5.697349519655823e-01   +4.344248027664772e-02   +4.865509372851894e-02; +5.986382970832176e-01   +7.976929649153461e-01   +6.102905302428810e-01   +5.792127078608318e-02   +7.447022531900266e-01   +5.563627555514326e-01   +1.977090380440763e-01   +5.586299537793761e-01   +1.867679449852867e-01   +7.196052486124669e-01   +5.138151394096991e-01   +3.291411828527616e-01   +1.151165025064700e-01   +8.097962669773823e-01   +4.423054852895855e-01   +9.217492067882060e-01; +1.630713010351196e-01   +6.270263072073899e-01   +3.142604460893612e-01   +5.970727740525484e-01   +9.515205538860484e-01   +1.137699031886123e-01   +6.174163938111982e-01   +8.296989992472837e-01   +2.311523634932295e-01   +6.421398980322766e-01   +7.319389028094403e-01   +5.514293570195898e-01   +7.356664446885256e-01   +6.741609624364127e-01   +9.167497370453991e-01   +1.743175341635864e-01; +4.837104253193771e-01   +4.723464278225031e-01   +1.420468165465552e-01   +6.573193214493785e-01   +2.656230703390485e-01   +8.179464727399028e-01   +1.550424749401453e-01   +7.066958447103642e-01   +9.982458182193119e-01   +1.015855441118937e-01   +7.705505499891863e-01   +5.325718314356848e-01   +2.107800046860748e-01   +4.435444055599114e-01   +8.851387679470103e-01   +7.440058656876190e-01; +2.854825753899911e-01   +1.859123852243373e-02   +6.052770849955134e-01   +4.806388661207255e-01   +9.514431263522276e-02   +6.508447435184518e-01   +5.833361514832546e-01   +1.158613110912556e-01   +9.056580040507246e-01   +4.918886102618632e-01   +6.772700344680020e-01   +9.012481187185235e-01   +4.836287362026576e-01   +8.939123709731351e-01   +9.251067869501613e-02   +4.755256697708054e-01; +4.038225907178187e-01   +1.180266677563282e-01   +8.895269833924737e-01   +9.780476911861601e-01   +2.314422131387573e-01   +2.374353690248869e-01   +5.447078646158754e-01   +7.409392257922334e-01   +1.147749701592900e-02   +5.611894083601052e-01   +8.131914319895783e-01   +2.839352138858380e-01   +5.059752771056497e-02   +7.829531328451707e-01   +6.753600771928653e-01   +2.462376115965499e-01; +4.915128247353100e-01   +7.192584675668653e-01   +5.626284175033808e-01   +8.640128542545641e-01   +8.960271823101386e-01   +3.019259595358820e-01   +6.812879569575285e-01   +9.241545697273024e-01   +8.340695633247788e-01   +5.558660385938854e-02   +4.185092597900290e-01   +1.389269310133688e-01   +5.712007451213741e-01   +5.817147610508018e-01   +9.768156478174014e-03   +6.632456766305179e-01; +8.625647487375869e-01   +6.820691019146795e-01   +6.329365508146440e-01   +9.544986910811366e-01   +1.996062491020541e-01   +3.302940111719512e-01   +6.985315896087142e-01   +9.235546933780721e-01   +2.529653348611856e-01   +8.935134709772398e-02   +4.977412863796629e-01   +9.573917684335461e-01   +4.910470721779169e-01   +6.161843735859648e-01   +1.213979879796655e-01   +6.089042157962198e-01];
L2E_L1E_iAMPA_netcon = [+3.674965411274488e-01   +5.617088482116610e-01   +2.005015184211757e-01   +5.137263903791794e-01   +2.898537224493862e-01   +7.412770426471364e-02   +2.789648803247370e-01   +2.673750980379435e-01; +4.377697390918980e-01   +1.935454686515274e-01   +1.371959632043257e-01   +6.851817265369542e-01   +6.202211957830238e-01   +5.937610734817335e-01   +9.293333891103257e-01   +9.046507029624988e-01; +7.183902014883203e-01   +6.128822094394172e-01   +8.180104331930697e-02   +2.071817225108432e-01   +8.629475683331302e-01   +7.574805514690607e-02   +7.640776382703468e-01   +1.592616936672419e-01; +1.918470935820986e-01   +7.407785401485458e-01   +9.095866144313292e-02   +9.717665365018280e-01   +8.201104567111069e-01   +3.970669267131744e-01   +2.619245751215482e-01   +5.540496870686118e-01; +4.005353750344259e-02   +8.311367977366055e-01   +5.511808824659695e-01   +3.505308784851658e-01   +2.058420420317360e-01   +5.890800372906415e-02   +2.430790803120201e-01   +4.221292031524117e-01; +3.145695054517898e-01   +2.769458700314499e-01   +7.321935975178903e-01   +1.848144159470828e-01   +7.509016628486154e-01   +1.290028058863548e-01   +1.660269106897148e-01   +5.469384301075507e-01; +7.903390814977197e-01   +6.083365381755629e-01   +5.442856518347514e-01   +2.380356584330659e-01   +1.984490174354787e-01   +2.445490544997348e-01   +2.875041019301123e-01   +7.544012728348019e-01; +4.724117421623521e-02   +5.478941373231563e-01   +5.447428121058200e-02   +2.537888027934523e-01   +5.775687162820941e-01   +9.437265644065792e-01   +5.643369606619562e-01   +1.387983531709350e-02; +2.160523740843249e-01   +2.742793002793036e-01   +6.323012569113359e-01   +2.227160020266852e-01   +8.768404862044389e-01   +2.032458072250198e-01   +4.048696127707729e-01   -1.638098159006976e-03; +2.741050971201277e-01   +3.398200381774098e-01   +9.944717418110400e-01   +3.589609836675996e-02   +7.140935574894198e-01   +3.274070154812837e-01   +9.871355768585435e-01   +2.122444803040859e-02; +7.895673712287885e-01   +5.665238374472390e-01   +9.152590486681902e-01   +3.569820650948090e-01   +7.005088816369165e-01   +8.669317512397855e-01   +5.445233038614635e-01   +3.592272253558663e-01; +9.903771627450298e-01   +7.439598898339704e-01   +7.686069950046095e-01   +8.985218764347910e-01   +4.675961549479503e-01   +9.221061834222932e-01   +9.288150246246446e-01   +4.266354170807045e-01; +9.455867430989767e-02   +7.718679554698772e-01   +1.909400539823835e-01   +1.401268573074513e-01   +5.041389892233734e-01   +2.350969861705112e-02   +9.924777668751371e-01   +5.446845124409381e-01; +1.963870915368514e-01   +3.979885576182709e-01   +3.201318462037576e-02   +9.556122879690124e-01   +7.961105043502770e-01   +3.648932811844870e-01   +8.363712536654256e-01   +4.924428952139056e-01; +1.166561440885929e-01   +1.486491243594353e-01   +3.730461201531134e-01   +9.025069319806227e-01   +9.401133076104244e-01   +5.283027886623148e-01   +1.808934260297775e-01   +9.202114296682643e-01; +6.471252735330253e-01   +2.074898471648215e-01   +5.757484654028715e-01   +4.105060258895535e-01   +7.820415052755829e-01   +4.066193711705344e-01   +3.132441333489546e-01   +4.165963053401162e-01];
L1E_L2E_iAMPA_netcon = [+4.969120415533476e-01   +4.494914484948475e-01   +6.162582461950975e-01   +4.906226605539988e-01   +2.304341612246162e-01   +7.205632915113137e-01   +6.945794833804759e-01   +6.325719812627350e-01   +5.224238337184520e-01   +2.414565027450513e-01   +8.764399161707913e-01   +1.740372110431632e-01   +1.379652651817459e-01   +2.436232442987661e-01   +1.833641718070325e-01   +2.379744628085691e-02; +8.382930657008327e-01   +3.694081901086957e-01   +1.039433544348441e-01   +6.609053360244570e-01   +8.358988775273689e-01   +3.807157792428099e-01   +9.788721361291248e-01   +6.264334734629260e-01   +6.729759525780803e-01   +7.286923177742234e-01   +6.588199380152719e-01   +3.026233228250476e-01   +2.826262381186667e-01   +7.486989523774232e-01   +1.460752699301141e-01   +2.509882422393527e-01; +1.849975361390751e-01   +3.007606333630527e-01   +7.521136140267700e-01   +1.790635896663667e-01   +7.342062538991142e-01   +3.839776736918784e-01   +7.503857548993544e-01   +4.072694722369650e-01   +7.777093773449816e-01   +1.363826510338819e-01   +5.382500484675176e-01   +1.093481992914846e-01   +7.011542636914523e-03   +9.371231031093656e-01   +1.323742712045294e-01   +9.889647237238495e-01; +3.369295036471556e-01   +2.326607779273445e-01   +5.363969507183091e-01   +4.795476954712681e-01   +4.889340704320751e-01   +7.159314857447637e-01   +5.535641886000935e-01   +4.252725291032260e-01   +4.640054943650979e-01   +4.136004759708104e-02   +2.523022736673541e-01   +4.513783051801913e-01   +3.060618083152145e-01   +2.949650917678911e-02   +1.717498340423800e-01   +6.295318174117617e-01; +6.925996979737524e-01   +1.369204927409609e-01   +4.435696952103418e-01   +4.986060403807053e-01   +8.492793581968295e-01   +8.388983314294918e-01   +2.985749286168468e-02   +5.103016127448605e-01   +9.073727752029817e-01   +6.499246272136738e-01   +1.049911576508007e-01   +5.840929206897018e-01   +9.050425044321441e-01   +4.352615585971198e-01   +9.228688005129707e-01   +3.574364023734767e-01; +6.925902114858153e-01   +9.955925954128000e-02   +7.429062733350470e-01   +6.003889689979055e-01   +7.153364968729035e-01   +6.676469219151377e-01   +1.951159605608247e-01   +2.598479820833882e-01   +2.541347398975888e-02   +2.002902228301765e-01   +9.714694281539477e-01   +2.243579894905906e-01   +2.946884313188232e-01   +8.308935274820535e-01   +2.590083441289492e-01   +9.393788465074183e-02; +3.681823388581907e-01   +2.267864715587235e-01   +3.874180126402095e-01   +2.408079884656946e-01   +5.214707941757530e-01   +6.510836529741876e-01   +9.418004552446051e-01   +4.232262969723526e-01   +4.794929163266936e-01   +9.734285942989482e-01   +5.967312985560305e-01   +1.104206665652537e-01   +8.330928257178309e-01   +9.997828988475276e-01   +2.054524952968466e-01   +4.095390002870092e-01; +3.495671729920866e-02   +3.462756077924483e-01   +5.259515880386186e-01   +5.173273166194386e-01   +9.375999550805266e-01   +5.635137085788285e-01   +3.972395526051607e-01   +5.236023854508167e-01   +2.713515691015037e-01   +8.207837308426661e-01   +8.193269965513229e-01   +5.604263564787584e-01   +7.451461869848209e-01   +9.202665357774498e-01   +6.128111131490039e-01   +9.311947168653488e-01];
L2I_L2E_iAMPA_netcon = [+6.775840036420041e-01   +6.147934616522694e-01   +4.182871634090173e-02   +7.926790552704021e-01   +5.240377522115337e-01   +8.264139973995998e-01   +6.439418713336846e-01   +3.859976410944644e-01; +2.331356764234270e-02   +9.450665405211498e-01   +5.451318092920060e-02   +9.294869079803579e-01   +5.426977501150580e-02   +1.077567192336312e-01   +3.953226910347366e-02   +1.673914969704959e-01; +7.336839688273850e-01   +9.639274310283300e-01   +4.015247158435680e-01   +9.361618323544925e-01   +2.873025783117561e-01   +2.307404600608812e-02   +5.683119657951586e-01   +4.441017708714597e-01; +2.127492042306811e-01   +3.690130994083404e-01   +9.836831708767323e-01   +1.460541013733436e-01   +7.095460140758173e-01   +1.141381458881267e-02   +3.040980928329570e-01   +8.733672773223944e-01; +8.600520208333966e-01   +7.950387877842880e-01   +7.122245650903106e-01   +3.191752794506116e-01   +8.781713289575376e-01   +3.363342065371013e-01   +2.609646574245297e-01   +4.116582579752308e-01; +1.568739272954664e-01   +7.286992919158376e-01   +9.887669163241528e-01   +4.281870091586117e-01   +3.665630589950197e-01   +6.634223189901968e-01   +7.214588290923672e-01   +1.625076810953047e-01; +6.689669419915008e-01   +9.539779940312086e-01   +6.459431583440899e-01   +7.014543791966679e-01   +5.606401069348075e-01   +5.953918256165046e-01   +3.054803073000689e-01   +6.623097338899672e-01; +9.363178089346541e-01   +1.115491490881771e-02   +5.023482052757213e-01   +6.152178033804125e-01   +8.836682309803121e-01   +8.036223708613872e-02   +8.951746435616491e-01   +9.254035630484362e-01];
L2E_L2I_iGABA_netcon = [+5.998569927068865e-02   +5.194091670571434e-01   +3.525517098601396e-01   +2.618937088690860e-01   +4.199516268846850e-02   +8.905371658861340e-01   +3.445920090743246e-01   +4.510303573022206e-01; +3.539883498318753e-01   +6.924572956966316e-02   +5.568423435544546e-01   +9.843487111250890e-01   +3.606451760800264e-01   +5.404784616476572e-01   +9.351536596791732e-01   +6.718152723569416e-01; +9.321403596995336e-01   +1.842138368130023e-01   +6.926444826486317e-01   +3.494607228664834e-01   +3.544286674545017e-02   +7.174274522743521e-01   +9.182404347688362e-01   +7.691753389020892e-01; +2.420783393653762e-01   +3.174297547057487e-01   -6.196169369742838e-03   +4.022534164154470e-01   +4.858012695094478e-01   +7.110777900289091e-01   +7.248723980667019e-01   +9.268768533647629e-01; +1.019633651887010e-01   +2.438525199112380e-01   +4.771166492617873e-02   +7.524756345733588e-01   +7.237603433757527e-01   +1.691670488976738e-01   +4.426542370870462e-01   +6.579364540892859e-01; +7.164417181820685e-01   +3.225730516663688e-01   +3.081052034066166e-01   +1.010283296752467e-01   +1.398158767688590e-02   +3.523042846189976e-01   +1.511440978371032e-01   +5.019783797811477e-01; +5.532177850069256e-03   +8.792519022545793e-01   +8.691572459756933e-01   +5.905620265337375e-01   +5.171111793354987e-01   +3.793108511050328e-01   +8.312864708912420e-01   +3.421972499326086e-01; +1.849681592887363e-01   +3.013129489104516e-01   +6.275940640200210e-01   +1.236025816724920e-01   +2.392087659277403e-01   +7.578304330228844e-01   +2.569239879902745e-01   +9.464844328551447e-01];
L3E_L2E_iAMPA_netcon = [+7.930347809425989e-02   +1.553024788524021e-02   +3.682014259193275e-01   +4.963823884116659e-01   +1.773068680882800e-02   +9.559463118967919e-01   +3.592110392856989e-01   +1.375625582265601e-02   +2.037795064491569e-01   +6.196793808107789e-02   +2.429858906519987e-01   +9.986790737522195e-01; +9.523914018828550e-01   +9.773201007782779e-01   +1.163539241392118e-01   +6.569542465060217e-02   +8.063691647620670e-01   +3.870146112429471e-01   +2.241969133672092e-01   +1.215130967306495e-01   +3.564016426425072e-01   +7.417053707726781e-01   +5.339363594169839e-01   +3.445806629503247e-01; +6.626174076248563e-01   +7.245219922543708e-01   +5.143918670583939e-01   +8.623599427494439e-01   +7.917225484858194e-01   +6.644448235933839e-01   +7.244784566491868e-01   +6.699096021239793e-01   +8.876241868017076e-01   +9.907109503819270e-01   +3.333886989165505e-01   +8.224462684993147e-01; +1.688690028696127e-01   +8.718998291120194e-01   +6.876366048334533e-03   +9.968693152107586e-01   +4.234342426003587e-01   +5.854963696342359e-01   +7.724023115859447e-01   +5.084848837335740e-01   +8.085160117531656e-01   +7.676961189446087e-01   +6.746017482284912e-01   +1.090599016125411e-01; +1.971844166911001e-01   +8.147127316323409e-01   +8.686350951361144e-01   +1.226272860629589e-01   +6.306107094062831e-01   +5.918033010195781e-02   +3.421842604764820e-01   +7.044902779269531e-02   +3.197225829953703e-01   +8.818539253452959e-01   +8.752576701163700e-01   +7.737622754797655e-01; +9.953192309542075e-01   +3.039711023812395e-02   +9.041254796558063e-01   +9.987919419618473e-02   +5.683291801509268e-01   +7.585994834217086e-02   +5.763803493939724e-01   +5.352767648567119e-01   +6.011536020421782e-01   +3.626092111399374e-02   +9.833586027369264e-01   +1.499722094831315e-01; +9.260051485394017e-01   +9.700996577771248e-02   +1.133851996146415e-01   +1.490725141842444e-01   +8.961988963794416e-01   +2.280168119444201e-01   +6.430202694835763e-01   +6.777667095914397e-01   +6.982732252479482e-01   +7.944138884698816e-01   +1.456837460134030e-01   +7.313437070674651e-01; +9.821830164550569e-01   +8.526966193714272e-02   +4.417468747477733e-02   +1.291329635082756e-01   +7.488143448631511e-01   +4.210105945108989e-01   +3.663678427637790e-01   +5.881746809478345e-01   +1.779760954406529e-01   +7.066755454967714e-01   +8.772751465882460e-01   +1.087348117808069e-01];
L3I_L2I_iGABA_netcon = [+7.680428301274657e-01   +5.351169037667680e-01   +5.970910283475502e-01   +3.039373646043654e-01   +9.655741891634537e-01   +1.150372391072975e-01   +2.978140143822348e-01   +7.949172117582624e-01   +9.136893722765638e-01   +9.955958420158111e-01   +3.096753553552654e-01   +9.964028052521290e-01; +6.367493716751615e-01   +4.531853149219570e-01   +5.630618731679716e-01   +7.629247832576247e-01   +5.440060110742974e-01   +7.062239621516612e-02   +1.676693685039384e-01   +5.258789104513321e-02   +3.857072966767533e-01   +2.874462697450488e-01   +4.421943415385240e-01   +9.153420163654555e-01; +7.960440495339987e-01   +1.144250052635559e-01   +6.816952800680051e-02   +6.477462680169520e-01   +9.819916861221600e-01   +5.051324905064147e-02   +7.243757128021404e-01   +1.808937695069434e-01   +7.509012420421999e-01   +5.161285953696324e-01   +2.090586020753468e-01   +6.906614454883483e-01; +9.597808078661569e-01   +7.205588252697229e-01   +7.683642984341240e-01   +3.323856481145622e-01   +1.248999125585746e-01   +1.304150726068202e-01   +2.986654587084493e-01   +2.463321842799728e-01   +8.785923546224971e-01   +3.585421782399759e-01   +9.411813200251201e-01   +2.211227680700487e-01; +7.168969336690725e-01   +1.857577059959476e-01   +8.682262556666304e-01   +9.711693060880254e-01   +1.683843903435123e-01   +4.911708377416519e-01   +6.780491344683798e-01   +2.618537054423646e-01   +3.925168056033922e-01   +5.168425199478721e-01   +2.900136073778946e-01   +3.139343989791462e-01; +6.438953095033791e-01   +3.246326388152576e-01   +7.088458644501205e-01   +5.317355845563524e-01   +3.342087556016797e-01   +4.680685501561239e-01   +7.464727980633138e-01   +6.475281097576566e-01   +1.671347970481229e-01   +5.010848985014450e-01   +1.223662367398360e-01   +2.368223270806720e-01; +5.120032570955179e-01   +9.670404642550001e-01   +1.085925740466370e-01   +7.514936922584315e-01   +5.314331336238900e-01   +1.586568434240918e-01   +7.451147840211276e-01   +9.769867997432931e-02   +4.367212924465062e-01   +1.885796957376010e-01   +6.987156914126148e-02   +7.082473470661486e-01; +9.517617665954461e-01   +7.006460069316299e-01   +6.658261617273576e-01   +2.706222712142566e-01   +6.927663371138473e-01   +1.387981607327123e-01   +7.847439036796160e-01   +4.690030152835023e-01   +8.584108245841223e-01   +4.772290540238798e-01   +7.291540912650455e-01   +3.755932029981996e-01];
L2E_L3E_iAMPA_netcon = [+6.562962266819897e-01   +3.868642570806957e-01   +2.345033824893432e-01   +4.635019673486176e-01   +9.050880268667840e-01   +9.504974839668496e-01   +7.621943071604458e-01   +3.545381749156729e-01; +3.842946446416682e-01   +2.280530128734508e-02   +9.047292904990019e-01   +2.831059591949618e-01   +6.794943659591288e-01   +2.635891050254677e-02   +9.030613245327780e-01   +6.635935779354972e-01; +3.084985929709549e-01   +3.297571074894152e-01   +4.874308295275046e-01   +2.761507886104833e-01   +8.428920484634936e-01   +5.019062946524380e-01   +7.964749541120945e-01   +5.921560005403830e-01; +1.574117491116508e-01   +4.845836195278818e-01   +5.958495274662777e-01   +1.424627196198011e-01   +9.473322888077930e-02   +3.393489305445501e-01   +9.565060418362931e-01   +5.429677802478223e-02; +7.781712769621908e-01   +2.622044956764832e-01   +9.549973593941662e-01   +1.393932416816192e-01   +7.354252854908776e-01   +6.722788875091985e-01   +5.350810735321018e-01   +2.168090950898531e-01; +7.089491965854618e-01   +5.265087350228869e-01   +8.480660433948085e-02   +2.652023592355249e-01   +5.437616166568294e-01   +1.676251918851847e-01   +1.639840451859229e-01   +6.021651988620739e-01; +1.727277139524569e-01   +4.164920981614699e-01   +2.220439862364952e-01   +6.102374780549756e-01   +2.565009060265458e-01   +2.271267642969681e-01   +1.347509645879200e-01   +2.693478736567123e-01; +4.481859781931121e-01   -4.654523924729859e-03   +1.515779901910068e-01   +1.062304346551517e-01   +7.147835025765052e-01   +1.176701522918650e-01   +3.402585608029157e-02   +1.094263143515985e-01; +8.378508044019084e-01   +8.939823279554814e-01   +3.896026693126123e-01   +4.851073492974698e-01   +3.604067721616138e-01   +9.927463464795181e-01   +6.807074037772234e-01   +2.114491217321037e-01; +6.976064632988271e-01   +2.389052120763276e-01   +1.851513575677604e-01   +8.933020809937506e-01   +8.544920265152431e-01   +1.396975806590301e-01   +5.871174146546383e-01   +8.732081504538020e-01; +7.657408921183461e-01   +7.921025672191012e-01   +7.635241840781481e-01   +1.883889632808314e-01   +8.185451891175952e-01   +7.692706051953759e-01   +2.984291500924613e-01   +4.591686693152153e-01; +9.802830924415591e-01   +5.789253553711655e-01   +2.286945706063898e-01   +5.183363132748003e-02   +6.107954558915063e-01   +6.340499040826881e-01   +7.389582891483616e-02   +7.271005461580556e-01];
L2I_L3I_iGABA_netcon = [+5.891901498570512e-01   +1.476417850805343e-01   +3.444163688276654e-01   +3.700397900897263e-01   +5.993491909277219e-01   +5.069794521912793e-01   +7.729445789090162e-01   +2.649077608448774e-01; +8.459156463814571e-01   +9.901860526608183e-01   +4.647652585170554e-02   +5.376779634582423e-01   +4.786456561186728e-01   +2.368186866340714e-01   +1.789734949516811e-01   +5.850005596474882e-01; +6.049014618691433e-01   +4.809170428989165e-01   +9.421071959479753e-01   +9.745084152445191e-01   +3.765791749871192e-01   +2.719608403781573e-01   +4.543874435142570e-01   +6.790056376943417e-01; +7.444909045176545e-01   +3.497378297797538e-02   +8.672055640627031e-01   +9.968365625349063e-01   +9.783289228072130e-01   +4.052402604097232e-01   +3.058245391818865e-01   +4.151670007741100e-01; +8.490701569007947e-01   +2.697864439246875e-01   +1.336782090725069e-01   +4.149325625451398e-01   +1.382629497297436e-01   +2.603252802285276e-01   +3.876523874421448e-01   +5.114570670006774e-01; +1.466148437446971e-01   +6.758310947919562e-01   +5.908901979232825e-01   +4.510371157054360e-01   +2.710332010493156e-01   +8.539700170434272e-01   +8.032433741563658e-01   +8.144417514381418e-01; +7.417822230280042e-01   +1.469315173690382e-01   +6.196508705680156e-02   +2.551344814272875e-01   +2.255552929272299e-01   +4.792042834979430e-01   +7.779681240211723e-01   +5.444327940440108e-01; +1.714868779833182e-02   +7.738282977247412e-01   +9.471818249733451e-01   +6.011272474526848e-01   +7.910123947159056e-01   +3.412691040868280e-01   +6.455703331441222e-01   +5.892692618370089e-01; +2.278440748662113e-01   +2.674042870463154e-01   +4.969978794296265e-01   +7.815145921077023e-02   +8.175868387822158e-01   +6.387283994790969e-01   +2.420003055589867e-01   +5.350288371853830e-01; +5.373695674114602e-01   +8.805237898146507e-01   +2.645115549014713e-02   +9.122674603733876e-01   +7.921192131325310e-01   +4.152376133699440e-01   +6.092123819253177e-01   +5.413042832755094e-01; +7.208594320800191e-01   +3.686061146849521e-01   +5.750183648676877e-02   +4.730086431899342e-01   +1.126001103225951e-01   +5.434221887171642e-01   +4.198469649859993e-01   +1.519344984694556e-01; +4.340130867756791e-01   +1.021931869530413e-02   +3.008169124348937e-01   +5.080558177790387e-01   +6.329466585210440e-01   +3.393785278463196e-01   +2.942653223242019e-01   +7.031021227332372e-01];
L3I_L3E_iAMPA_netcon = [+6.426107330988197e-02   +7.734804233054914e-01   +5.554330727058903e-01   +5.731625433917676e-01   +9.200801296930962e-01   +8.349707483091415e-01   +8.491624107760932e-01   +8.626040418758030e-01   +5.340183363489419e-01   +9.883683606663771e-01   +4.817503178051486e-01   +3.506237481086916e-01; +9.227914546444099e-01   +8.387751055804223e-01   +8.440861152797885e-01   +9.353176521448109e-01   +5.921798879773537e-01   +3.923325097855457e-01   +6.280136784839697e-01   +8.559874883815037e-01   +5.667299871215843e-01   +7.007760082887777e-01   +7.397338392934361e-01   +3.997020363108979e-01; +1.804024755896273e-01   +5.930891840195774e-01   +9.692929923292906e-01   +7.786625320937629e-01   +5.752538704132827e-01   +6.993065410035028e-02   +4.449173629513667e-01   +9.494029335655351e-01   +9.802750995789884e-01   +8.440395892792367e-01   +5.950075737794320e-01   +9.877563172255994e-01; +5.434763149424746e-01   +7.671727925404457e-01   +4.668697571490814e-01   +5.970739701029114e-01   +6.584750578941448e-01   +3.734895855313919e-01   +2.343885692452183e-01   +6.937889224911321e-01   +9.678107188317296e-01   +7.377395558314525e-01   +2.626760717694343e-01   +2.970712785141160e-01; +3.969825630537051e-01   +6.587631114619674e-01   +7.764207803815403e-01   +5.844362229646688e-02   +4.357461578813343e-01   +8.492482544984136e-01   +5.111968256688824e-02   +3.633570628809412e-01   +5.603575976463654e-01   +9.959197113481144e-01   +6.071083621248110e-01   +2.246335245447325e-01; +9.269168545966181e-03   +5.891587278496135e-01   +2.162752318964391e-02   +5.437192370239609e-01   +9.352741757863842e-01   +2.415521379437245e-02   +7.127776852622957e-01   +3.734170040208295e-01   +5.322909388821448e-01   +5.078397831607194e-01   +2.323865432360566e-01   +3.308751757368194e-01; +1.028589948103827e-01   +2.665964784135062e-02   +6.777419196769128e-01   +8.646191820399066e-01   +1.024444442499429e-01   +4.218070465763364e-01   +8.485901115642090e-01   +8.425518394217748e-01   +4.787047899047879e-01   +1.894045185648036e-01   +1.947469164281953e-01   +1.647505653917714e-01; +8.564641140791789e-01   +6.927107256858236e-01   +8.355220602077171e-01   +3.383410058325413e-01   +4.098140059291893e-01   +2.549437222353453e-01   +4.044420698752849e-01   +3.840941600560933e-01   +9.012949095721855e-01   +9.596021663863368e-01   +1.977391693966811e-03   +3.841270649343794e-01; +3.379405053404503e-01   +3.269218778861583e-01   +6.843537015856188e-01   +1.786636050755177e-01   +8.926447955553776e-01   +7.443919858521637e-02   +2.868306508791849e-01   +7.701306760534382e-01   +4.821082998339880e-01   +4.520794100472257e-01   +6.464255998386866e-01   +5.257287685603799e-01; +1.497143713032358e-01   +7.597610816550709e-02   +8.958256230989718e-01   +8.814885832516501e-01   +7.385467925847823e-01   +9.208563149131430e-01   +2.627768881441854e-01   +7.724335944571653e-01   +4.872098515778128e-01   +6.058074754491132e-01   +4.001621864290419e-01   +5.952098928152156e-01; +8.071736515808849e-01   +7.440825564677557e-01   +9.567061770795884e-02   +8.417619717767316e-01   +9.586733320208720e-01   +2.679385761231934e-01   +5.047732207765757e-01   +4.333961181049666e-01   +3.140242464853903e-01   +6.439913852123342e-01   +2.723151885991972e-01   +1.701710309840920e-01; +6.556764042409066e-01   +9.652901822919113e-01   +7.100529587731279e-02   +8.337190615233395e-01   +9.699319865640433e-01   +1.010088037406546e-01   +1.168175198879924e-01   +4.879259144705508e-01   +8.592897687902439e-01   +7.661937038911094e-01   +4.013443341398882e-03   +7.249908680996921e-02];
L3E_L3I_iGABA_netcon = [+4.374159067888592e-01   +7.066770365166652e-02   +5.447781086239219e-03   +4.951158203206084e-01   +5.437330394917916e-01   +2.520414766250730e-01   +7.177156963592478e-01   +7.610757353678563e-01   +3.785745329186098e-01   +4.489784442227511e-01   +2.001628649134852e-01   +6.490359139744966e-01; +5.802671956518626e-02   +8.078752121838548e-01   +1.326122867602658e-01   +1.935649568091632e-01   +2.113057530507343e-01   +3.344194270050009e-01   +2.225310724891253e-01   +8.883556863270942e-01   +6.108127398841687e-01   +3.947266928710343e-01   +8.277480019454448e-01   +8.984088290324836e-01; +6.252766643643778e-01   +9.094898088005152e-01   +3.083983509653683e-01   +6.419845380324299e-01   +2.698763966501091e-01   +5.918225333858704e-01   +4.987149806167027e-01   +7.312102436705720e-01   +1.679129884764343e-01   +6.682540067219747e-01   +4.465399381948166e-01   +8.386472018126139e-01; +7.984368582417415e-01   +4.258842900362370e-01   +2.385316308248797e-01   +2.551922972080762e-01   +1.326443612825307e-01   +4.813826304322378e-01   +4.752212859104539e-01   +6.979932814472584e-01   +1.053084555997818e-01   +3.332401235296707e-02   +4.225892447182823e-02   +1.703685097149920e-01; +4.011365236940443e-01   +1.843032874845561e-01   +6.491591221547746e-01   +9.481637187344064e-01   +1.613815786310124e-02   +8.972396505253811e-01   +4.311175493377379e-01   +6.465696184377062e-01   +6.259597829491580e-01   +7.869032272055787e-01   +7.686053005099573e-01   +1.612454558621607e-01; +8.842259365418912e-01   +1.834874454278701e-01   +8.084047136145951e-01   +2.880618299776155e-01   +1.530614834795306e-02   +2.947981763842195e-01   +5.568136792954860e-01   +6.205287153186948e-01   +9.527793145069331e-01   +3.784534126214962e-01   +9.771631210749085e-02   +1.357751609223379e-01; +7.221220944463023e-01   +6.723157504956531e-01   +7.401172533858419e-01   +1.491570652446611e-01   +9.791007188102705e-01   +7.913366630349450e-02   +2.072697207162236e-01   +7.821378826071583e-02   +6.653554087761933e-01   +6.515154816615166e-01   +6.520917510421326e-01   +1.586606923983694e-01; +1.968922142624256e-01   +5.242861997110186e-01   +1.222207252571871e-01   +8.705182976146062e-01   +6.472873336983354e-01   +3.920428397033107e-01   +2.773391807470026e-01   +5.482807400279907e-01   +4.733862893723734e-01   +4.968486320512245e-01   +2.706238547618490e-01   +3.945290114122602e-01; +3.747079416071345e-01   +7.766055297536377e-01   +1.726614416520256e-01   +8.865966684686682e-01   +8.159042766602378e-01   +1.987743027311001e-01   +8.125795196565002e-01   +8.838490332017386e-01   +3.405691027210066e-01   +2.131504955785088e-01   +4.370143733831351e-01   +6.669774876686256e-01; +2.118930718428759e-01   +2.994264245439429e-01   +2.740807901872658e-01   +6.685770324359120e-01   +2.758667920801047e-01   +7.224391332127793e-01   +9.562227481037358e-02   +9.875787460097137e-01   +5.911514584436730e-01   +2.163880646731821e-01   +8.484954977180916e-01   +2.227352448190464e-01; +2.594873513640409e-01   +4.745428815072355e-01   +8.149378238272844e-01   +9.973920320407926e-01   +1.556819161904097e-02   +4.217080758219553e-01   +3.326643830145221e-02   +7.065753170898512e-02   +5.458255901065014e-01   +4.519331072828077e-01   +9.020249989588276e-01   +6.438300887796707e-01; +9.921739525673823e-01   +7.066168168094090e-01   +5.914606430129186e-01   +2.680919134645842e-01   +1.011724975888817e-01   +2.679601557227297e-01   +6.473728148069140e-02   +3.271193087470355e-02   +3.928388138889163e-02   +6.292287056182830e-01   +2.851982846011290e-01   +6.120182945859578e-01];
L2E_Input1_iAMPA_netcon = [+9.920629980851252e-01   +9.895915419576135e-01   +9.998592893459777e-01   +9.878768298378084e-01   +9.852739998895351e-01   +9.992324075677224e-01   +9.835734461984912e-01   +9.968627009850373e-01];
L2I_Input2_iAMPA_netcon = [+9.919571454207041e-01   +9.986443616834845e-01   +9.853519469416008e-01   +9.946530803999021e-01   +9.889841264151338e-01   +9.901712075603166e-01   +9.955618688205158e-01   +9.966693392425486e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
