function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.178354718494672e-01   -7.202000853880662e-03   -2.880904010465261e-02   -8.273551950619715e-02   +3.100581106773211e-02   -2.014263327010609e-01   +2.964868842109565e-02   -1.548932524481895e-02   -1.662534331120314e-01   -1.495685569158309e-01   -8.818423083471050e-02   -1.286796527277096e-01   +1.755719807825312e-01   +1.062293548166007e-01   +2.146916096885823e-01   -9.772476568299594e-02; -8.472459711455264e-02   +4.533844129224893e-03   -2.408967054887731e-02   -3.493454750659665e-02   -1.830551406261814e-01   -1.836944125432291e-02   +3.993818784249319e-02   -1.990040160120496e-01   -3.838194101562393e-02   +1.472704606583025e-01   +1.713989663823350e-01   -2.280720162188117e-01   +7.030157755780379e-02   -1.090164739559603e-01   +1.321618569284634e-01   +1.177269584147945e-01; -3.512216947766629e-02   -1.577516857019217e-01   -6.373404570139730e-02   +8.901578810477188e-02   -4.107234096238598e-02   +5.097417878056144e-02   -4.249174133976651e-02   -1.580078150779226e-01   +1.899965672390002e-01   -5.820281295780122e-02   -2.109147565662926e-01   +2.062718504133670e-02   +7.214839595817955e-02   -2.638523731146464e-02   +2.808424637687850e-01   +1.148868951156140e-01; +6.333834243275059e-02   -5.706953300513511e-02   -5.480025675168460e-02   +1.932063047918723e-01   +5.065590982813344e-02   +1.880682905578617e-01   -1.074808570265146e-01   -1.578008926325929e-01   +5.316178513262629e-02   -1.815870883907991e-02   -6.852918679018415e-02   -1.550368480646706e-01   +1.269483938602099e-01   +2.365372980710846e-02   +4.258051458258023e-02   +8.961094073490805e-03; +4.148906050534486e-02   +7.557727835069412e-02   +3.205692558808965e-01   -1.344502265777335e-02   +5.753948013733561e-02   -1.201900931296276e-01   +1.427149674675099e-01   +5.105340470901927e-02   +1.958733024924497e-01   -2.130181713801449e-01   -1.130386984570896e-02   +9.534524571446416e-02   +8.110471420672068e-02   +1.861473480405372e-01   +2.005754720944886e-01   +2.734260222473149e-01; +3.296337201846197e-01   -1.908415433812918e-01   -1.282160015693900e-01   +6.992344010785365e-02   -1.982896935253453e-02   -1.924045712920137e-01   -8.662674599105775e-02   +1.229521644588211e-01   +2.336966813704868e-01   -1.571514498779129e-01   -4.160109750110005e-02   -2.496280899518322e-02   +6.229698731423879e-02   -3.266203555240847e-01   +1.503052018597466e-01   -2.366442623610846e-02; +4.177898889254378e-02   -1.813973338477405e-01   +4.945798432015489e-02   -4.691449794805682e-02   -6.613524737239995e-02   +1.931496121325985e-02   -1.632251213808937e-01   +2.286467686946417e-01   -2.693866442966177e-01   +1.105311027239891e-01   +7.012026454229313e-02   -1.021593553652485e-02   +1.640039381580981e-01   +1.732267272468959e-01   +1.199414669083450e-01   -4.205158182120738e-03; +2.560272652750089e-01   +2.373834071299337e-01   +1.617493060734472e-01   +1.795019474735623e-02   +8.581797236287636e-02   -2.258635636593015e-01   -5.910103265978396e-02   -1.193562758993782e-01   +1.073728647925926e-01   -6.833179948512763e-02   -5.606050265394409e-02   -7.608757714111059e-02   -2.128935513991888e-02   -1.832987083011750e-01   +5.057344428690687e-02   -1.023501927307851e-01; -2.484705823383860e-01   -3.511973616039102e-02   +1.260577819501508e-01   +7.781616161852763e-02   -6.607458285374916e-03   -1.033503978663358e-01   +5.658277826728077e-03   -1.319387883621970e-01   +1.583494250430937e-01   +4.825691982542814e-02   -1.617898905357270e-01   +1.629802551436885e-01   -1.738803753181558e-01   -1.935679830636557e-01   +6.922239702859882e-02   +1.187560513425614e-01; -1.174002108475782e-01   +6.048285342815114e-02   +2.256810814047273e-01   +1.786600696250488e-02   -6.026033594739392e-02   +2.139454525752603e-01   +6.880347048243018e-02   +1.465814987473360e-01   -6.621143489374029e-02   +8.670970591796331e-02   -9.354689767940100e-02   -8.659358627036004e-02   +2.620097822650392e-02   +3.057724212609937e-01   -7.039551826524747e-02   +1.095520336503626e-01; +6.034598269747683e-02   -4.564620580947598e-02   -1.268504096382946e-02   -1.530391527757264e-01   +8.878542473481377e-02   +9.359951358033705e-02   -1.673754094586701e-01   +9.278344632840750e-02   +2.520646647969189e-02   -1.127058309101913e-01   +2.364076632494665e-01   +9.444659001101627e-02   +7.682345909741476e-03   -1.966970169140000e-01   +4.538255755201537e-02   -2.886583706703524e-01; -1.161657672169088e-01   +2.273708624222408e-01   +1.269682235330456e-01   +7.626390310323290e-02   +3.098952183093585e-02   -2.625124394903203e-01   -7.693551484872302e-03   -2.543689021353901e-02   -1.600904976169913e-01   +2.615838053515008e-01   +3.547851549138917e-02   +2.897146745924064e-02   +1.087101244703270e-01   +1.583834287211439e-01   -2.647125183332574e-01   -9.783011879889929e-02; +1.604073327930490e-01   -9.735552044992597e-02   +1.856757924560976e-01   +1.430825042385352e-02   -1.015112889429312e-01   +1.185203260001282e-02   +1.855169586098045e-01   +2.233252156680784e-01   -7.421469838420565e-02   -1.318738204865999e-01   +2.673436485988943e-01   -1.443890990609422e-01   +8.573270728466478e-02   -7.423095667038852e-06   +1.580642941324751e-01   -2.526454413549587e-02; -3.834109685645800e-02   -7.048246647907713e-02   +1.057692221938095e-01   -7.587827149788785e-02   +1.309901599848822e-01   +3.654784912949297e-02   -4.468791361832887e-03   -2.868501258266033e-02   +1.856417681492241e-02   -8.475128033389720e-02   +8.692584216233869e-02   +2.109682239408457e-01   -1.589512676368832e-01   -1.006980858629317e-01   -1.736537330994192e-01   -3.143699587927565e-02; -1.194846980139942e-01   -3.659112234342344e-02   +2.937813811397976e-01   +2.571722099053464e-03   -2.185593404844144e-02   +1.117551447688615e-01   -1.097798404548419e-01   +7.377000924785407e-02   +1.206534609639806e-01   +9.515872760525947e-02   -1.433327613593402e-01   -8.235038641195422e-02   +5.314958059996368e-02   +1.818837942194595e-01   -4.656842767522295e-02   +1.276305934289704e-01; +2.100980269284482e-01   +5.680466189931779e-02   +1.563598431429465e-01   +2.143480987384066e-01   -1.105121736920108e-01   -1.814431584261189e-01   -1.046423263779625e-01   +1.451894008427308e-01   -2.782711763106806e-01   -1.209896978223831e-01   -2.399486903130988e-01   +7.943800967411112e-02   +1.148793634086111e-01   -1.151016148800059e-01   -1.978880222539333e-01   +5.868206324000707e-02];
L1E_L1I_iGABA_netcon = [-1.769525358383612e-01   -2.493038702424712e-01   -7.121109819004817e-03   +2.550017923403738e-01   -3.169632700008662e-03   +2.474771518068134e-01   -5.494721359367472e-02   +9.370549811103188e-02   -1.197864179468064e-01   -2.027722357817463e-02   -9.642586840930233e-02   +3.535557427697390e-02   -3.180374758589978e-01   +1.628822861505322e-01   +5.672066828617540e-02   -1.108034300475216e-01; -1.361567423128444e-01   -1.635511502568948e-01   -1.078572928971925e-01   +5.230330877964712e-02   +1.189672399881319e-01   +7.877739268319267e-02   -2.189540680339706e-01   -1.621786075013179e-01   -1.731999939014475e-01   -1.154146093880929e-01   -9.106434317437619e-02   +1.318067929094758e-01   +2.441243199324343e-01   -2.018138053017795e-02   +3.769526757666376e-02   -3.531411157942266e-02; -1.719377387931743e-02   +8.147177653442889e-02   -3.303692524934486e-03   +9.427649591542070e-02   +1.681652040621711e-01   -9.829723035367906e-02   +1.079020752435785e-01   -1.047371828205910e-01   +5.826650871870859e-02   -1.232322431588537e-01   -1.161134603189943e-01   -1.196348355468384e-01   -6.868689307662421e-02   -1.964736128506415e-01   -3.853670122317150e-02   +1.612830360892503e-02; +1.809980175918064e-01   -6.648975570351844e-02   -6.711483719051534e-02   -4.965757903508084e-02   +3.568936727117460e-02   -3.700996585554037e-01   +1.071183155853312e-01   +8.021846198476655e-02   +2.156929071423073e-02   -5.061363824116005e-02   -1.146919307675301e-01   +6.395820540811731e-02   -1.835362374456218e-02   +7.343291528209035e-02   -3.182733770741319e-02   +2.137236036766466e-01; -1.009250793677364e-01   +9.486066747982798e-02   +1.698060753464794e-01   +6.733495154367407e-02   +3.015080706798678e-02   -8.210475722037751e-02   -2.347405621801987e-01   +1.425970834839755e-01   +8.553360449370132e-02   +1.906473088989479e-01   -1.323240695549099e-01   -8.307196598233713e-02   +7.712770628297855e-02   -1.596672481395559e-01   -1.329004338274843e-01   +2.827654120020681e-02; +1.451436216393335e-01   +4.186075938305080e-02   -1.620124572943990e-01   +1.106720657675721e-01   +2.017699579174650e-01   -7.131927601245043e-02   +9.165577175095330e-02   -3.147606610423626e-02   +2.415371846619186e-01   +3.012614423144089e-01   -2.695644348084421e-01   -1.725552009604967e-02   +2.663045614998153e-02   +1.407627136454684e-01   -3.125115421440584e-01   -2.006219484292396e-01; +6.283842368604139e-02   +1.223987615955983e-02   +4.463656525848890e-02   -2.761871276260162e-01   +1.172670965742874e-01   +7.002551470629979e-02   -6.459401438751611e-02   -4.646491622693214e-02   -1.058823625924959e-01   -6.063698530948755e-02   +3.196593078678246e-01   -1.191637866567163e-02   -3.796889753044886e-02   +1.337902356603780e-02   -4.450997669600017e-02   -1.810063588225579e-01; +2.949380228216074e-01   -1.291973554377399e-01   +7.629597942020395e-02   +5.768373194023308e-02   -7.732883672711678e-02   +1.120384139893441e-01   +1.680660362682348e-01   -7.940167003005985e-02   +2.190143146615306e-01   +1.879381239462397e-03   +7.121521070303802e-02   -4.450609865650575e-02   -2.670245881611927e-02   +2.658027105630115e-01   -2.431768426502065e-01   +4.949687524166980e-02; -2.128482006236226e-01   +2.128291564396514e-01   +6.081884202642109e-02   +2.923156044046909e-01   +2.829967745009865e-02   -1.198739183967935e-01   +1.628064837181195e-01   -7.866874880328249e-02   +1.902857038276208e-01   -1.284804645520370e-01   -8.629878321846415e-02   +9.349065885820529e-02   -6.369939021870900e-02   +1.113914077815462e-01   -1.335119615734440e-01   -7.479230602150137e-02; +6.999308824553951e-02   -3.288155500967510e-02   -2.596364766530859e-01   -1.944961448254468e-01   -1.289338829523840e-01   +1.875730533473756e-01   -1.060077035921190e-01   -4.226539617165077e-02   -4.612704293396096e-02   -2.389304842035792e-02   -2.217556721036954e-01   +1.525047738609464e-01   -1.796911691367087e-01   -2.430988839685577e-01   -8.368741799453953e-02   -1.145082046487713e-01; -2.159818902500852e-01   +1.875601238087431e-02   -8.988018386819778e-03   -1.878415142879975e-01   -8.310588787223758e-02   -2.339035504723178e-01   +3.481775763480802e-03   +1.666453650601122e-01   -8.559125022560929e-02   +4.373281187801042e-02   -9.233913741016618e-02   -7.317930299464440e-02   +2.672335817505945e-01   -4.528162257973625e-02   +2.291046632990396e-01   -4.731292694011519e-02; -2.459077668816943e-01   +7.975815203635456e-02   +9.671513418479272e-02   -6.531124495619399e-02   -1.536394019359548e-01   +7.886351448611924e-02   +5.618388994336579e-02   -1.868446128650947e-01   -4.406532583759310e-02   +5.920707791856800e-02   +3.227292627118608e-01   +1.227988421084725e-01   -3.153624170325441e-02   -4.522429815583535e-02   -1.528020289094582e-01   +2.615638478174234e-01; +8.667451821975140e-02   -1.584847736744923e-01   +1.639582530566346e-01   +1.820717072426734e-01   -3.071523430076885e-02   -6.223207565995518e-02   +3.545590467646449e-02   +1.225429280882345e-01   +1.909910610272207e-01   +6.165321669506665e-02   -8.630383683527423e-02   -1.770479443321054e-01   +1.189194869303610e-01   -1.087640476167105e-01   +5.595408284855422e-02   +7.756145407762388e-02; +4.572576860870837e-02   -1.008863282085107e-01   -5.706524015855269e-02   +1.789164276128466e-01   -2.500924928846642e-03   +2.075519136571939e-01   +7.550962085464613e-02   -3.520163879073608e-02   +8.567915247313049e-02   -5.135692792467458e-03   -9.671914484829630e-02   +6.901088698255677e-02   -3.378978757799873e-02   +3.864422702352112e-02   +1.210539059340181e-01   +1.951010130391339e-01; -2.275071773695531e-01   +5.393393762655001e-02   +3.266897125562240e-01   -8.803491116695357e-02   -2.267461501388843e-01   +5.260888736931592e-02   +2.719606516890613e-01   -2.902113279157129e-02   +1.148542592795117e-01   +1.066615088325033e-01   +5.951530397017875e-03   -2.934680407788905e-01   -1.140209125962514e-01   +1.065517558984043e-01   +1.959421424948485e-01   -1.851271938545616e-01; +6.348764577905740e-02   -7.968880067718154e-02   +9.600621112634847e-02   -2.615144738406853e-01   +1.668093247216074e-01   -6.544283645009598e-02   +2.676797353748498e-01   -3.232611009615027e-02   +1.989658799869004e-01   +5.871845807642523e-02   -6.488960665947274e-02   -9.512425482219776e-02   +1.096085996087725e-01   -1.164590652254355e-01   +1.489894340900646e-01   -2.257858272945907e-01];
L2I_L1I_iGABA_netcon = [+2.007965551450424e-01   +2.030629996272520e-01   +1.408892396791968e-01   -1.086011320227008e-01   -2.018282776727554e-02   -1.276536178195233e-01   -2.145710423541475e-02   +1.695839797910829e-01; -3.568161555064113e-02   -3.628305396140037e-01   +6.371584937249078e-02   +2.508673282142989e-01   -2.233513273993142e-01   +2.846194715019529e-02   +2.384413881970481e-01   -1.053097375324009e-01; -5.759723689775743e-02   +1.904468186413980e-01   -2.232828475106155e-02   -7.695302622989025e-02   +3.253538739112223e-01   -6.618815769934144e-02   +1.819162536600436e-01   +2.523425511460509e-01; -6.698856831173972e-02   +4.288117489190817e-02   -7.377759101963853e-02   -4.368017530196784e-02   -5.368771777859106e-02   +4.541017584444555e-02   +9.885355146094392e-03   -9.455693943636785e-02; -1.890903857731561e-01   -3.554880533032673e-02   -3.052907032743773e-01   +5.520558141493369e-02   +1.073549997872422e-01   -1.193046642059262e-02   -1.195996221451694e-01   +1.895513596561329e-02; -4.278691549768238e-02   -2.904875848569940e-01   -4.095731932277862e-02   +2.201833793804300e-02   +1.402523987568847e-01   +1.862531592162617e-01   -1.468167189573244e-01   +1.607265767115842e-01; -3.281720922218291e-02   +4.513647002202039e-03   +2.050071179234313e-01   -1.009409749238626e-01   -1.406868684299850e-01   +4.426681062340025e-02   -3.132529536876426e-02   +7.716536631949165e-02; -4.322047374397035e-02   -9.065026419025185e-02   +7.795136483523387e-03   -9.583500512200889e-02   +2.155865830708468e-01   -1.136831570248345e-02   +6.758335149603496e-02   -1.685022752674093e-01; -1.164365987468824e-02   -7.413726861929283e-02   -1.146522167187672e-01   +2.190379145832311e-02   +2.002534669678094e-01   +2.565762381958261e-02   +1.228272711218184e-01   +2.643705360433032e-01; -4.754743952144643e-02   +1.542238212137413e-01   +7.086804744132867e-02   +4.653649512611845e-02   -7.923066231342318e-02   -8.848182662896498e-02   -8.807272568429721e-02   -1.550709204550840e-01; +2.129310766007435e-01   -2.360237999170805e-01   +8.255089642448261e-02   -1.677281150090939e-01   -2.629621214630015e-02   +8.072605981869985e-03   +7.475198105263128e-02   +8.868486909146293e-03; +1.202539602789600e-01   +2.340048652841177e-01   +3.364964687884673e-02   +1.838200191493681e-01   -4.047871210003969e-02   -1.804023600949168e-01   -1.657667598604264e-01   -1.892073945102070e-01; +4.113490241966743e-02   +4.319343420520159e-02   +2.050649672390958e-01   +1.737659415353640e-01   +2.246537528984083e-01   -1.930190899795270e-01   -2.667215266899889e-03   -7.606398714826509e-02; -1.366184059360958e-01   +3.546787944490491e-02   -1.168656927256541e-03   -8.191834569187685e-02   -1.676464621968905e-02   -1.394685084373571e-01   -2.778035273459161e-02   +2.702649638754157e-02; -9.696203600944119e-02   -2.223887757209779e-01   +7.312805247246529e-02   -2.329102499709337e-01   -2.160697106377513e-01   +3.269525159066003e-02   -1.809366738196771e-01   +9.824001551811176e-02; +2.142223752712646e-01   +1.218871225918124e-01   +2.494419424731708e-01   -2.438266737550084e-01   +9.768679107217199e-02   +1.035085022364315e-01   -3.923720525932601e-02   +5.924310271486396e-02];
L1I_L2I_iGABA_netcon = [+1.761301473139319e-02   +1.059658079684551e-01   -1.198264417248649e-01   -1.043623657145203e-01   +1.380143525643955e-01   -7.880646779030633e-02   -1.338700170533982e-01   +2.837471324808550e-02   +1.147350395448302e-01   -3.708235514308292e-02   +2.946801229860681e-01   +9.809552722085332e-02   +2.171647913035785e-01   +1.937892192955357e-01   -1.508228172532013e-01   -1.358294567856974e-01; +1.673067694431404e-01   -2.490741550811842e-02   +1.186591999269145e-02   +3.877552596201990e-02   +5.636740422393482e-02   +1.085805381958564e-01   -1.505689536666970e-01   +6.740055664247598e-02   -1.294012936191734e-02   -2.088270301041951e-01   -2.414853134121040e-01   -2.058560080700472e-02   +1.234388931511402e-01   -2.228162131444886e-03   -2.405223093301710e-01   -7.669805082691583e-02; -2.159322125502142e-01   -2.299105616578783e-01   +1.999030008285477e-03   -7.092450648710727e-02   +1.311356262388599e-01   +7.430017119804512e-02   -6.053903843693481e-02   +2.565514603385807e-01   +1.270453288224144e-01   -6.196918184479781e-02   -4.015849280837766e-02   +7.172208072745631e-02   -5.147350287207315e-02   +5.500810399394040e-02   +2.251323158030097e-01   -7.934942519421637e-02; -5.647669661841188e-02   +9.011915845262566e-02   +6.933080898235892e-02   +6.474324383689968e-02   +6.950776332808066e-02   -5.839092737910878e-02   +3.171617099418116e-02   +5.197282808708410e-02   +2.089585715068361e-01   -1.518848438881341e-01   +1.312219604840856e-01   +1.099182081901427e-01   -9.658940123483301e-02   +5.328785911692022e-02   -6.746408323449055e-02   +1.223962732980384e-01; +1.039032262349730e-02   +4.347016615483228e-02   +1.102393094784609e-01   -2.182167362052888e-01   -8.173866025444161e-02   -2.104286722884058e-01   +1.033373776712973e-01   +9.895772091549269e-02   -4.546021491670149e-02   +2.033971470358515e-02   -1.094260804989145e-01   -2.380716423414699e-02   -3.831575772391888e-02   +1.190654062873446e-01   +1.926365730098676e-01   -8.174409834431193e-02; -1.039047568225744e-01   +5.222863290831065e-02   +1.515750614734112e-02   +1.048197350666067e-01   +2.766266301769487e-02   -1.705629531461909e-02   -7.818338280563671e-03   +6.688326765178874e-02   +1.046241250826824e-01   -2.388161128830232e-01   +7.206506833471678e-02   +1.252654001510562e-01   -1.742520601535082e-01   +7.193117639396988e-02   +7.334949106735818e-02   -1.879846330892354e-01; +1.557746019162984e-01   -6.585845138715163e-02   +1.497373441455817e-01   +1.694973017961096e-01   -3.021341241653999e-01   +2.117594103886002e-01   +2.083918727440621e-01   +4.316099263243011e-02   +2.775393109262764e-02   +1.653336323973534e-02   +2.233244888513152e-02   +6.615686563325696e-02   +1.159933463808732e-01   +3.254602643278313e-03   +6.194417033474151e-02   -6.814861768809910e-02; +9.741285712237775e-02   -7.952665071882992e-02   +1.480632108451245e-01   -4.976575561515524e-02   -4.802526770484987e-02   -9.033064088713545e-02   -4.230596348870497e-02   -1.684916656848211e-02   -5.304681118241693e-02   +1.671884429744486e-01   -9.396920283998574e-03   +4.307703431020199e-02   -9.172671052878265e-02   -7.996900146947980e-02   -1.691237825385776e-01   +2.733097320841958e-01];
L2E_L1E_iAMPA_netcon = [+8.888008495399696e-02   -1.355929922525416e-01   -2.076983449495581e-01   -7.075559757280975e-02   -8.417959891359539e-02   -1.540261730867121e-01   +1.197070402508538e-01   -1.987972007505824e-01; +1.947787626033494e-01   -3.290096814402402e-02   -1.117288196931926e-01   +1.673543999560799e-01   -3.693984661663378e-02   -4.184022293799829e-04   -2.107716871862252e-01   -2.053435893193213e-01; +6.082891148253734e-02   +2.983993560357684e-01   -1.329153870746936e-01   +1.513081071760029e-01   +6.460008858920713e-02   -2.183996892640573e-01   -2.148436269800775e-01   -2.734253125701506e-02; +2.792227794306160e-01   -5.665538342575983e-02   +1.858359115077371e-01   +1.031255386502421e-01   +5.960085254723977e-02   -1.976786486173092e-01   -1.795285503912297e-01   +2.193052692561309e-01; +1.354999082142468e-01   -2.151995501954602e-01   -1.138583700524346e-01   +1.951783898379580e-01   +2.435945407323831e-01   -2.321558838912530e-01   +3.354502596977964e-02   +1.577475647312411e-01; -1.259969327954324e-01   -2.206713971523862e-01   +1.085565785459761e-01   +1.214613998314644e-01   +1.656562667951218e-02   +9.428000839704456e-02   +1.800254936939047e-01   +2.403847949528328e-02; +1.745878766717539e-01   -1.021024479294403e-01   -7.968475606043607e-02   -2.197368309188222e-01   +3.673038196223167e-01   +2.314893422254258e-01   +9.425781406708048e-02   -9.613899245512811e-02; +9.891019579009516e-02   +1.516593270620053e-01   +2.332656776491105e-01   -2.481718404884755e-01   -1.306374683090266e-01   +5.338747472612521e-02   +5.955026633193303e-02   -5.860325522172890e-02; +6.176783635288292e-03   -9.290839285008225e-02   -1.917915506615531e-01   -1.246758375608757e-01   +2.050529336483255e-01   +1.952987851606057e-01   +2.218644537342025e-03   +2.006601427879418e-02; +1.448522761779858e-01   +1.410599457341770e-01   +7.601552959479122e-04   +7.756282137886970e-02   -2.657615456310122e-01   +1.073276955762431e-01   +3.923909129929518e-02   -3.138769977768716e-02; -1.462715517438300e-02   +2.675926038020005e-01   -2.024660254187791e-01   -1.045608262320415e-02   -5.669446174264596e-02   +1.358787276709121e-01   +1.887627059606637e-01   +8.372546655716381e-02; +1.922100527824832e-01   -1.460146611790502e-01   -1.153751184624289e-01   -2.381786002786942e-01   +1.588965088118903e-01   +2.007842382919391e-01   +1.637407898498891e-01   +7.080313763975303e-02; +1.068822617474876e-01   +2.035849181292851e-01   -2.052930025056090e-01   +7.981729218920830e-02   +2.894884755622301e-01   -1.612362425071935e-01   -1.636882488123177e-01   -6.363698140646080e-02; +1.762708476640136e-01   -1.700098519237338e-01   -8.315144066847281e-02   -9.584542856827538e-02   -8.899327261123965e-02   +2.408929483251973e-02   -1.220099312959710e-01   +1.231021107438664e-01; -1.103763506793317e-01   +1.422152619974287e-01   -7.810173455140695e-02   -8.028880630654714e-02   -2.677305007156977e-01   -1.076661706537077e-01   -6.447549417192240e-02   +2.563246924308904e-02; -1.363497578089226e-01   -1.846779355583291e-01   +3.146292732325617e-01   -3.837538133995065e-02   -1.705968784425217e-01   -1.252632340413661e-01   +1.095297737726531e-01   -2.498495383920961e-01];
L1E_L2E_iAMPA_netcon = [-1.788631159540212e-02   +6.011204498382807e-03   -3.532702626765114e-01   -1.217154899570284e-01   -1.846608319031917e-01   -1.771264688181036e-01   +3.428555472757727e-02   -8.108434965881413e-02   +1.633786215598270e-01   +1.295279173796379e-04   +1.284295711040535e-01   +2.892423346794560e-01   +4.016461258058156e-02   +6.177080338243338e-02   -3.358001257395395e-02   +1.188506751475821e-01; -1.122933361547206e-01   +3.197675033483316e-02   -1.379773929234561e-01   +1.565893558225547e-01   +2.139221447021635e-01   -1.080100122815934e-01   -1.244637300429013e-01   -1.357357029850016e-01   +1.168157579636110e-01   -1.605138435799372e-01   +7.622791630486210e-02   +2.441185796064497e-01   -1.951970109690750e-03   -1.446178675663182e-01   +3.543617442413136e-02   +3.659813644480139e-02; +9.254123338172289e-02   -2.041626028290529e-02   +7.265562919580634e-02   +1.579840932609302e-01   +7.333267563266929e-02   -3.813702739030522e-02   -1.060104094312086e-01   +2.101316857676122e-01   -4.508661303473712e-02   -2.326353933743866e-02   +7.734901316475418e-02   -8.697851809491196e-02   -5.555894794332485e-02   -9.633954506077325e-02   +2.212441722758548e-01   -3.809957119801485e-01; +4.925906340657202e-02   -1.846033727025443e-02   +1.343956945101979e-01   -1.469507627278803e-01   -9.301548073561114e-02   -9.621566653541795e-02   +9.722167914677042e-02   -1.249815851921443e-01   -1.624388812967299e-01   -2.242364116898096e-01   -1.445070814848353e-01   +2.309836231795459e-01   -1.141250322558497e-01   +1.122456802569443e-01   +1.070152388876122e-01   -2.424646109391096e-03; +2.419885270686756e-02   +1.085512985155020e-01   +1.220197791145370e-02   +2.870408671695207e-01   +9.118711073284758e-02   +1.843906968836403e-01   -1.008992492819060e-01   +1.961026799266538e-01   -3.261860554929995e-02   -1.832356533259662e-01   +2.772063402234344e-01   +1.781509329789548e-01   +5.121331072706600e-02   +5.445122688785935e-02   -1.182610345483965e-01   +2.898714697895047e-01; -4.642642453132238e-02   -1.518970824989720e-01   -2.578798436968066e-02   -1.398277062810607e-02   -1.635521137831231e-01   -1.714960861743956e-01   +5.089444962480880e-02   -5.234671730624876e-02   -1.025785216478413e-01   +1.661895765768956e-01   +3.666226351010817e-02   -2.472384586062107e-02   -1.231330064440728e-02   -6.042332079525227e-02   -7.800746202021687e-02   +1.463049070806506e-01; +9.525514465259805e-04   -2.121172252788370e-01   -8.581261076620537e-02   -2.940334319328866e-01   +1.669698935191851e-01   -6.160437017477332e-02   +7.848563683265497e-02   -2.828051093123296e-01   +7.698687531154270e-02   +5.527805731034265e-02   -4.648122252665221e-02   -1.639663578767933e-01   -1.853174953844247e-01   +2.085530907806164e-01   -1.056466118316736e-01   +9.412505980086358e-02; -2.491009041477324e-01   -2.935061935245369e-02   -1.042904706344894e-01   -1.897126969515530e-01   +1.008926534950229e-01   -9.296797381425759e-02   -3.990460247083433e-02   +2.627614069714618e-02   -4.030620555064636e-02   +9.654572448793731e-02   +1.690083721925095e-01   -3.914383648473003e-02   +7.918962722996228e-02   -1.995963223760146e-01   +3.502334880663436e-01   -2.628564266775808e-01];
L2I_L2E_iAMPA_netcon = [+1.530521145297422e-01   +6.712993169370668e-02   +4.328322663526943e-02   +1.566457313928687e-01   +1.011784891621348e-02   +2.976884555260775e-02   -1.345912715933145e-01   -1.907364251073236e-01; -1.743885661370984e-01   +2.557016949540716e-01   +8.050063945039997e-02   -6.635142846982943e-02   +5.603289526506430e-03   -7.149681433368149e-02   +2.851183384051038e-01   +2.807966248742801e-01; +2.012343999848055e-01   +1.135812933001313e-01   -3.232688480282042e-01   +7.863765034501906e-02   -7.650645772189342e-02   +2.003494540479180e-01   +3.209302722499940e-01   -3.236320749355211e-02; -8.290502456415978e-02   +1.587334484989743e-01   -7.656374621188258e-02   +2.273428524208468e-01   -1.552399636918271e-01   +2.153688003493599e-03   -2.013831561529643e-01   +3.863002098106876e-02; -2.758483232385524e-01   -2.333007506008424e-01   -2.771220193417078e-01   +7.474944557579741e-03   +1.219127358165134e-01   -1.996917097483009e-01   +2.118869309413045e-01   +2.150665091236030e-02; -2.260380381611220e-01   -3.716151544337217e-02   +2.790237056471698e-02   +2.260500817343715e-01   -1.075718955150373e-02   -1.825517281517613e-01   +1.094217385234118e-01   -2.944861314038616e-01; -1.792820885156150e-01   -1.759406916157752e-01   -1.674875862186493e-02   +6.182527741042079e-02   +5.520343614926180e-03   -1.561001383572613e-02   -6.595847565792708e-02   -5.988683384056614e-02; +1.082183487825398e-01   -6.515026794796852e-02   -5.126532837839205e-02   +6.577483643455086e-02   -1.241452058266655e-01   +2.153741363398279e-01   -3.654737084436072e-02   +2.293283418169500e-01];
L2E_L2I_iGABA_netcon = [+1.821950593432361e-02   -1.248547606181985e-01   +1.371746980543724e-04   +9.298303828013343e-02   +1.471992751374833e-01   +1.697329598011742e-02   +1.455580408964031e-01   -5.940152702093066e-02; -9.620017370267740e-03   +5.821871288148048e-02   +5.966643132563916e-02   +4.513033736107373e-02   +1.451505173086691e-02   +3.613096575584093e-02   -1.224915566256013e-01   -1.110735938654716e-01; -5.205273388223032e-02   +6.124285786724243e-02   -3.584020122165631e-02   +1.829460546063523e-01   -2.004601010115538e-01   -1.575107679811742e-01   -1.598516714501020e-01   -1.161453627663898e-01; -2.593791452747253e-01   +1.342029841174835e-01   -1.734231397252901e-01   -9.064186540348124e-02   -3.263516522982648e-04   +2.607109789685534e-02   -3.099210679715416e-01   +2.571130371016805e-01; +1.473945586405856e-01   +5.029276984879771e-03   +9.778486463590043e-02   +3.600489121123033e-02   -1.040528434236298e-01   +7.393315555309286e-03   +2.681914823902004e-02   +1.319413536347780e-01; +1.214788461553127e-02   -1.851876560308981e-01   +5.965170782258753e-02   -8.170923882711018e-02   +1.617574952138199e-01   +1.116601324367746e-01   +1.689431421745815e-01   +6.786446666071501e-02; -1.591314815908772e-01   -4.343578438152859e-02   -4.159131140578654e-02   -2.795962288800083e-01   +6.791807839035023e-02   -1.476463607844301e-02   +7.167935369628925e-02   -5.191467359507662e-02; -7.274480724289431e-02   -4.939852921333836e-02   +1.703524513603032e-01   +2.753646372769686e-01   -2.516793114715039e-01   +7.109906202003788e-02   +1.273575894417907e-01   -1.927497934116941e-01];
L3E_L2E_iAMPA_netcon = [+1.149396213581834e-01   +5.346569135421381e-03   +1.186393014728185e-01   +3.109181662242557e-02   -2.858025412207603e-01   -1.878931023274735e-01   -2.102070145425450e-01   +2.454309654787430e-01   -9.017727291128076e-02   -2.520689948385494e-01   +2.392468922643187e-01   -1.458864505115405e-01; +2.533998453439364e-01   -1.205861291510490e-02   +2.775016500082932e-02   -4.802849674725572e-02   -1.196034774430316e-01   +1.255609141895237e-01   -7.778202421619825e-02   -2.538176427587019e-03   +1.604122866041693e-03   +1.406748471941108e-01   -2.990444816106765e-02   +2.004433375251568e-01; -1.370189784217970e-01   +1.374496739126969e-03   +4.459532490266582e-02   +3.374155897572345e-01   +1.726254573432171e-01   -7.700683686223983e-02   +6.428734728631018e-02   -7.443055714065205e-02   -2.726335161965336e-01   +3.320189845044886e-01   -5.579323826236678e-02   -1.619846082141788e-02; +3.657030965819674e-02   +1.570285628026361e-02   -2.822213356835430e-01   +6.744560186152407e-03   +1.359915834248834e-01   -1.208208542059791e-01   +3.452521795033073e-02   -1.707378066099122e-01   +1.293439189268827e-02   -1.722141445943007e-01   -9.894703155075327e-02   -1.012338502956592e-01; +6.915097926153821e-02   +3.256688711733705e-01   -6.574855936141026e-02   -7.910003781096062e-02   +4.601234312535511e-03   -2.217682743941299e-01   +4.601563271145909e-02   -1.901456890395199e-01   +1.484292396330064e-02   +1.171179547463626e-01   +2.478172559123157e-01   +1.087071318785702e-01; -2.641878893082137e-02   +1.396239571338749e-01   +8.502652714164917e-02   -5.710449656312178e-02   +2.044724970197110e-01   +4.859059912983206e-02   -2.376593468001257e-01   -6.549500049728112e-02   -1.036950594308592e-02   -1.822477992911621e-02   +8.392414330150207e-02   -3.981392909182724e-02; +1.363829647978874e-01   -1.790587491355893e-01   +3.062487659218983e-03   +8.293869193421111e-02   +5.154663104620928e-02   -1.126732253499960e-02   -4.019315194954321e-02   +9.811119920197372e-03   +1.725639810799745e-01   -2.705400747179882e-01   -3.846626495168715e-02   -6.913373297856874e-02; +2.091537341399632e-02   +1.021234592283706e-01   -1.445548932703851e-01   -2.194953656928156e-01   +4.675898736059506e-03   -3.014631765519324e-01   -4.080738158484812e-02   -4.753352601633062e-02   -1.082884689494517e-02   +1.084462368326991e-01   -1.609993995997332e-01   +9.192180845013376e-02];
L3I_L2I_iGABA_netcon = [+2.604522044264689e-02   -1.188321507660827e-01   +3.812542296710637e-02   -2.081088554573355e-01   -1.449676306114543e-02   +2.546963083052279e-01   +2.554240688172327e-01   +2.989823972025121e-02   -7.065250233366183e-02   -7.364512502580574e-02   +2.855730869584197e-01   -8.998675190804425e-02; +6.683895369359140e-02   -2.611739020346179e-01   -1.214205522623038e-01   -4.284084687663883e-02   -2.344676898918258e-01   -2.024426772850913e-02   -3.954616888143944e-02   -9.361110930404344e-02   -7.950932292795374e-04   +3.677637362490510e-02   -2.455360914711101e-01   +2.597959767786376e-01; -7.730146044320561e-02   -4.977418033094827e-02   +2.762334047000087e-01   +1.182425580852842e-01   +8.117166872131396e-02   +3.030433129376971e-02   +1.304571275860828e-01   -1.743026032541590e-01   +2.386158660797698e-01   -2.138230809847511e-01   +1.202451514947838e-01   +2.146640066495973e-01; +1.172058625168452e-01   -6.363654923536950e-02   -6.844459929897381e-02   -2.271170583930687e-01   +1.364040704522750e-01   +9.859693239579964e-02   -3.152403055496381e-01   +6.725424435578499e-02   -1.679116740996928e-01   +5.439519607116820e-03   -1.367127127768312e-02   -2.771578164456215e-01; +3.799220744788273e-02   -7.189876262818054e-02   -1.182213263703332e-01   -1.039616158002688e-01   +1.480366731199244e-02   -2.917185235938989e-02   +2.385187425160575e-01   +1.192468637511159e-01   +2.336532769195436e-02   -2.846999259338956e-02   -1.683318327126198e-01   +7.020859522233769e-02; -9.911008414507595e-02   -2.610172697520525e-01   -1.060782029907793e-01   +8.767941302790402e-02   -1.301140514729430e-01   -1.602176072873806e-01   -1.730557655020833e-01   +2.284999412129664e-01   -1.673056314462682e-01   +2.587339669155308e-02   -2.092411020376590e-01   -5.209010958533600e-02; +8.778284145333425e-02   +5.856345159792990e-02   +5.039371141972679e-02   +9.130637454212269e-02   -4.807507253174756e-02   -1.199236414521913e-02   -4.804518409364685e-02   +3.551936395442124e-02   +1.244181728105914e-01   +1.798318804802952e-01   +5.316949957134692e-02   +1.137116768720922e-03; -8.047994720037789e-02   +1.622871912031347e-01   +7.605234272270249e-02   -2.406526032480458e-01   -1.643049112317758e-01   +6.255018457585584e-02   +1.478306009143801e-01   -1.218989214259659e-01   -1.516278898931179e-01   -2.083154163758589e-02   -3.571949673692581e-02   +4.896312570680280e-02];
L2E_L3E_iAMPA_netcon = [-4.704281505615902e-02   -1.742207252052007e-02   -1.873145761124290e-01   +1.684464851714346e-01   +1.000535085442364e-02   +3.151867863318116e-01   -2.133874466110056e-01   +6.610869048640068e-02; +6.712214131769280e-02   +1.392581898654965e-01   -1.816763797204538e-01   -3.144056718866202e-01   -9.117499895230116e-02   -1.111237417692934e-01   -1.193245573953764e-02   +9.098336975811110e-02; +2.569252250207649e-01   -3.299538097237921e-02   -2.255686928882299e-01   -1.815298292090045e-01   +7.670026244976373e-02   -3.174143713876409e-01   -1.223094788306940e-01   +6.721966595818252e-02; -1.702208278183491e-01   -1.328562698517514e-01   -4.585425166560247e-02   +8.599384865310908e-03   -4.927358562781788e-02   -8.229317560839576e-03   -1.969624722302035e-01   +1.804079803415857e-01; +8.688459926270252e-02   -1.757384224234434e-01   +5.115009709963748e-02   +1.429790393308074e-01   -7.434206618515311e-02   +7.479973983716148e-02   -3.402433224535911e-02   +1.955958835328147e-01; -2.329711144025348e-01   -8.435543862591335e-03   -3.554303476130442e-02   -1.023022669528013e-01   +1.644520797201352e-01   +1.315934097853025e-01   -9.357939411635380e-02   -1.753585521205713e-01; -1.902174345365885e-01   +1.647056555583641e-01   -4.959467791705223e-02   +6.380961097718935e-02   +2.221414554228655e-01   -7.347670869192890e-02   +2.336315212272826e-01   -2.977341499439153e-01; +3.755679166088298e-01   -2.036855729307111e-01   -1.024519929266388e-01   +2.505120128487527e-02   +8.580244086458562e-02   -2.013180388495672e-02   +1.138315635439196e-01   +6.158792898698363e-02; +2.811649508514502e-01   -3.907729621705952e-02   -1.614688611942211e-01   +6.895880197000996e-02   +4.003370683337686e-01   -2.649043956701115e-02   +1.059138633886628e-01   -8.919243552444696e-02; -2.205375247545833e-01   +1.183373464285821e-01   -7.347108414703014e-02   +2.251178060130685e-01   +1.377122415700034e-01   -7.569987246791834e-02   +4.559509017807195e-02   +1.405630976415147e-01; -4.549982473287427e-02   -1.453965353933693e-01   -3.143554914899416e-01   +9.491287147463943e-02   -9.472098779659469e-02   +5.674856406780187e-03   -1.154059291157903e-01   -7.365669514081929e-02; -8.522531695783794e-02   +3.705959553856226e-03   -1.172436054990533e-01   +9.099371834568257e-02   -1.541442405539945e-01   -3.778581502965958e-02   -1.926944319705846e-01   +3.139325970125895e-01];
L2I_L3I_iGABA_netcon = [-1.783965793098161e-01   +2.013582504776665e-01   +7.396629009953028e-02   +8.218584554414189e-02   +3.015012885330610e-01   -1.786757631532553e-01   -1.848423928753636e-01   -6.651042223147725e-02; -3.296652200264806e-01   +4.294092736377005e-02   -1.977381656678794e-01   +6.577190085913673e-02   -9.819616957530349e-02   +7.935877818857966e-02   -1.367343115176680e-01   -3.056899788003463e-01; -4.184450980092439e-04   -1.239620667708665e-01   +6.554314158970459e-02   -5.713131023485232e-02   +7.416906065730722e-02   +1.798375662465949e-01   +5.458572930463196e-02   +9.054447873336254e-04; -2.464042853873374e-02   -1.548127281808416e-01   -1.025167182524467e-01   -9.198386194307745e-02   +1.884195736508249e-02   +8.199672750137612e-03   -1.671811164569425e-01   -4.742939421157127e-03; -6.666932332638290e-02   -1.401190848896214e-01   +1.536547315844579e-01   -1.433836350306993e-01   +5.284453419170820e-02   +3.075309764385699e-01   -1.441994182208834e-02   -1.066979297494144e-01; +2.477162927808960e-01   +2.830161914554655e-01   +1.218661904833675e-02   +8.474395423926438e-03   +1.720382594147335e-02   -1.786908778902756e-01   -9.196125032526935e-02   -1.894350078779690e-01; -6.289405206809758e-02   +7.145950452769496e-02   +2.731250619319019e-02   -1.835976116208741e-02   +1.020426599264994e-02   +1.516222369277883e-01   -2.194572148668393e-01   -2.820482371513098e-02; +1.506254976344398e-01   +2.485561120812666e-01   -7.069119443671143e-02   +1.088348530177947e-01   -3.708823159265714e-02   +3.005076534134035e-01   +1.394956323202154e-01   -1.214542949576357e-01; +7.291928822651483e-02   -1.344652728742179e-01   -1.397397141584755e-01   +1.789617523823835e-01   -1.057869693813720e-01   -7.210791012919684e-02   +3.121247063708877e-02   +7.317867898405743e-02; +2.152492693212280e-01   -2.328352416448147e-02   +1.591438437927644e-01   -8.870561246559053e-03   -1.107003587582033e-01   +5.231507237318830e-02   +1.886131390504084e-01   -2.028560270184095e-02; +6.525908914093793e-02   -1.305222757311923e-01   -1.126298429631060e-01   +1.464011619640427e-01   -1.091144107111545e-01   +1.371992567952316e-01   +2.089891006589641e-01   +2.131234097590690e-01; -6.207877853307311e-02   -1.530078485128773e-01   +1.193306358537398e-01   -2.483052070567733e-01   +3.712189633951529e-02   +6.486074059777522e-02   +1.463914906319877e-01   -2.334787287905709e-01];
L3I_L3E_iAMPA_netcon = [+5.479514142170130e-02   +2.374343125124763e-01   +1.351060606205917e-01   +3.380848864839414e-01   -1.429715018716552e-01   +1.465444234914759e-01   -1.720266155308187e-01   -3.870390455881725e-02   -1.628066665427609e-01   +1.280939491441081e-02   -4.564847103985782e-03   -1.171719036886523e-01; -7.730583829524891e-02   -3.022954396025115e-01   -3.747752198043333e-02   -2.825563542890790e-02   -3.780682996121637e-02   +1.977616799061076e-01   -1.036296700519391e-01   -5.354803964456292e-02   -7.170571376552888e-02   -1.463770556750005e-01   +3.372790749301320e-01   +1.181157758711492e-01; -4.839425163579941e-02   -1.477179653946433e-01   +1.996174760774206e-01   -3.278899693037014e-02   +7.667499284449576e-02   -1.456673415965778e-02   +2.491013878612387e-01   +6.081353696526382e-02   -1.083443472230229e-01   -1.253294461547467e-01   +1.152359941700116e-01   -3.838993186818404e-02; +3.944202766140607e-02   +5.586160101932306e-02   +1.012768369179468e-02   -1.793166228675805e-01   -1.963989929705109e-01   -1.939375961312083e-01   -2.274680279030950e-01   +1.786578721855941e-01   -6.727622256878984e-03   -1.190579665585424e-01   -5.739348688508784e-02   +9.497478549061622e-02; -1.172250753044925e-01   -2.275508030551448e-02   -1.480807768102578e-01   +4.325794073079512e-02   +3.337026431905271e-02   -2.069095893926109e-01   +2.973035539821428e-02   +3.330194143499801e-02   +2.189330567634275e-01   +4.994535190814704e-02   -2.886095339331767e-01   -3.014797923281550e-03; -2.975323818566668e-02   -7.185856399706320e-02   -1.297788275836576e-01   +3.847308738028432e-02   -1.104693477411336e-01   +2.250581138673867e-01   +1.876257981544205e-01   +4.917023169808997e-03   -1.522991164124557e-02   -7.746691644245585e-02   -2.964647796651009e-02   -1.698032061852778e-02; -1.259788436055225e-02   +1.537224597861723e-01   +9.355798485909819e-02   -6.745948161873322e-02   -2.170975241396932e-02   +1.652639738694273e-01   -2.468789975322256e-02   +1.953856491027524e-01   +4.408818306599323e-02   -2.686630613930929e-01   -1.214171706801187e-01   -3.147098954958568e-01; -7.109627511860929e-03   -5.864682947489539e-02   +1.694678504552163e-01   +2.493186065525552e-01   -4.749001789645128e-02   -8.135685859157460e-02   -1.490351953884342e-01   -1.949168835577818e-02   -4.534212800579705e-02   -9.282869257931536e-02   -5.618826412199285e-02   -1.618291805022321e-01; -2.783941132258469e-02   -5.959708304454994e-02   -1.307444460439529e-02   +1.317753987836308e-01   -2.012487143088210e-01   -8.225960874067363e-02   -1.099356930344037e-01   -1.242121637561683e-01   +5.542329507329657e-02   -6.872304751140275e-02   -7.766824690064743e-02   -6.013379448191208e-02; +1.204466198806415e-01   +2.876852943603163e-03   +1.505669901518436e-01   +1.712254585636916e-01   +7.538202321044062e-02   +6.872202507265018e-02   -1.540211736374913e-01   +4.876813977736262e-03   -1.230481902016419e-01   -4.935936095136035e-02   -6.945215783728018e-03   +1.700225437953006e-01; +1.348019675423197e-01   +1.390545080887635e-02   -1.076012017782061e-01   -1.032166092645294e-01   -1.389155614304502e-02   -4.975561337518855e-02   +1.959960496143774e-01   +2.086791098834768e-02   -4.698650989352712e-02   +2.502081230842816e-01   -8.463722125370345e-02   -1.989616072383640e-01; +4.042874837764829e-02   +1.517185472812475e-01   -9.741676320813147e-02   +3.668165056187535e-01   -2.033930648083626e-01   +1.764557858000756e-01   +1.554995475183258e-01   -1.177341979210548e-02   +4.228189866356401e-02   -1.845444050211640e-01   +2.067188810570175e-01   -9.730822829744898e-02];
L3E_L3I_iGABA_netcon = [+1.601661342204492e-01   -2.245854164701144e-01   +6.136961459234749e-02   -5.956519817409640e-02   -1.599468935642768e-01   -2.142297971925547e-01   +9.144849384317300e-04   -1.316493104165784e-01   -6.675304832082098e-03   -3.948832581747798e-02   -4.842241956898247e-02   +4.543554638873183e-02; -1.100743398806302e-01   -1.765969621588327e-01   +2.252620155066281e-01   -7.865299237703943e-02   -5.085462662897217e-02   -8.296059055341419e-03   +4.813925645689585e-02   +9.588398320403807e-02   -2.815020620348322e-03   -1.894254023479510e-01   +3.101121882750817e-01   -7.143745240513255e-02; -4.249594355420667e-02   -2.815507661220613e-02   +2.003056285022852e-01   -2.779826177659911e-01   +1.202907868338617e-01   +3.718274577025708e-01   -5.323599041396144e-02   -1.107010282662711e-02   -3.656296035967658e-02   +9.010801995374629e-02   +1.570379764706492e-01   -7.535518212773679e-02; +2.400721817986429e-01   -6.888462544729142e-02   +1.342179965994117e-01   -2.410655066048976e-02   +4.776526152312560e-02   -2.171402558819305e-01   +2.407758928757693e-01   +2.273581682659617e-01   -6.589807938678383e-02   +5.143933655805569e-02   -7.560405371149327e-04   -1.860369303498244e-01; +2.603378605232684e-02   -1.244768081336002e-01   -1.268783307084337e-01   -1.369619159311406e-01   +1.922476281948679e-02   +1.556330632510945e-01   -1.875086045120910e-01   +1.591239990266122e-02   +1.344011310734711e-01   -1.958389791735587e-02   +1.910142398957141e-01   +1.426288222264247e-01; +1.653439649805206e-01   +6.300567490689334e-02   -3.452944518055606e-02   +1.232443562924467e-01   +6.498041565947212e-03   +3.844226432828117e-02   +6.526886475247232e-02   +2.328140494887089e-01   -4.935103690874920e-02   +1.950294105644924e-01   +5.486905220011005e-02   +7.931178799951091e-02; +1.547092717231618e-01   -1.918445697723455e-01   +1.725815035666397e-01   -1.097480548092149e-01   -7.202079736654488e-02   -2.680944367687116e-01   +6.642739730996802e-02   -8.338946135683260e-02   -3.295649488811812e-01   -2.751283268361746e-01   -1.531930931222296e-01   +9.085807242973996e-02; +2.024476806114456e-02   +5.334559630605588e-03   -8.895096110625468e-02   -1.907206791544273e-02   -1.371477047565787e-01   +2.289128392827585e-02   -2.718346613410752e-02   +2.491790428244711e-01   +4.901917376078245e-02   -5.012049249296278e-02   +1.038286141081733e-01   -1.558945344620352e-01; -6.694792336581461e-02   -3.979630079816337e-02   -1.179059426682830e-01   -4.007672479956902e-02   +3.693935157237099e-02   -4.248389108092313e-02   +2.182672805942596e-01   -8.475668908136744e-02   -1.747232105634386e-01   +1.665319237401799e-01   -1.628426598369584e-01   -1.866586420710174e-01; +5.030460990262339e-02   +8.421645716810959e-02   +2.590146100911045e-01   +1.696938278012868e-01   -8.444426486374618e-02   -2.565946180629962e-01   -5.892085368514584e-02   +8.344461802609135e-02   -2.714576455094932e-02   -3.016480578273619e-02   -5.309226356970999e-02   +2.127913583761850e-01; +2.348890884629022e-02   -8.691028859133271e-02   -1.225382615306243e-01   -1.161176016351154e-01   +3.405735702092178e-02   -2.320518111671824e-01   +1.731457453037009e-01   -1.816102093543284e-01   +5.583701856791889e-02   -3.594756953441843e-03   +1.911170522588546e-01   +7.543947391016782e-02; +1.062456797153345e-01   +9.421175842072221e-02   -6.781778553806671e-02   +2.309598331238135e-02   -8.790914895233459e-02   +2.688338390660366e-01   -2.439539738463279e-01   -1.154791526627812e-01   +1.904862410870034e-01   -1.626643823528271e-01   +8.860065971700001e-02   +1.547785563151524e-01];
L2E_Input1_iAMPA_netcon = [+1.937209162791111e-01   +2.472017452812934e-01   +1.539985869217214e-01   +1.478946649487579e-01   -1.555078198768572e-01   +2.858069594033411e-01   +3.191822953417247e-02   +1.799751065602423e-01];
L2I_Input2_iAMPA_netcon = [+1.476569639569797e-01   +1.449498550407042e-02   -1.821659262285259e-01   -1.215842142868854e-01   +1.967645990504718e-01   +1.797599666396362e-01   -2.774819619112111e-01   +3.095550130445945e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
