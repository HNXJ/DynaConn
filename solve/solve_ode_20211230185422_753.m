function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.644027369880062e-01   +8.554124849002932e-01   +5.350068139284061e-01   +3.688887227729730e-01   +2.602583388932522e-01   -3.310918183202597e-01   +4.831190060888640e-01   +7.957848733770667e-02   -2.660362122825726e-02   +3.235914801045787e-01   +2.742959455249114e-01   -1.384738542445747e-02   +2.257773206191389e-01   +2.814896331065364e-01   +6.165027288398803e-01   +1.000000000000000e+00; +5.239601957277156e-01   +9.149887680313377e-02   +4.537324782249174e-01   +1.933841741145342e-01   +1.524784428666660e-01   -5.866282221628526e-02   +1.041945160375993e-01   +2.609831637042393e-01   +5.767625264712110e-01   +3.161386445933501e-01   +4.706013988110975e-01   +1.837126120052502e-01   +8.016585483745828e-01   -1.607112147887798e-01   +4.933111256622972e-01   -5.395948136278448e-02; +4.020467481598340e-02   +5.881682985248166e-01   -2.014905368341037e-01   -1.617735103273748e-02   +1.698674725473223e-01   +4.576290394746639e-01   +1.171546043027698e-02   +5.287341156805150e-01   +9.656349296028480e-02   +7.293848145407791e-01   +5.759909694998372e-01   +4.573364604300206e-01   +2.085701888201401e-01   +4.360164830487202e-01   +1.326664264106646e-01   +4.384735593599671e-01; +2.710005869187574e-01   +9.053221424813755e-01   -6.550336383613407e-02   -7.860738259396007e-02   +5.281035545513285e-01   +1.498327151936578e-01   +3.038717644209493e-02   +4.537008756702117e-01   +3.214190155387973e-01   +4.345652618698489e-01   -1.795438731762272e-01   +5.019486274626822e-01   +2.774656788921866e-01   +2.301960236310691e-01   +6.733196834094033e-01   +2.004776760372488e-01; +1.814127445292618e-02   +1.087457175423858e-01   +1.514166169453928e-01   +3.215460284438795e-01   +3.250320289027847e-01   +4.902937401240035e-01   +5.489424333783315e-02   +1.422558654903807e-01   -2.174488211788518e-01   +1.245474515866931e-01   +5.556127840290750e-01   -1.485141182224554e-01   -1.316631668740622e-01   +4.371153769877489e-01   +1.777755020560754e-02   -7.376073762638403e-02; -2.278900343747634e-02   +6.610756976467618e-01   -2.807314195612896e-01   +5.161430745365288e-02   +6.019791487240609e-01   +4.565877690933188e-01   +1.417547394935325e-01   -7.115747113384011e-02   +6.156448507973700e-02   +9.326638005765933e-02   +2.838523260395704e-02   +3.573892901761411e-01   +1.239838197188042e-01   -2.138596369136382e-01   -3.489961889944643e-01   +4.675894803674113e-02; -9.705382715071292e-02   +1.757785994968012e-01   +4.507014219605009e-01   +8.408988163663043e-01   +1.171943169996305e-01   +2.148851467862677e-01   +3.184706854649235e-01   +3.300729290560079e-01   +4.033249677609647e-01   +1.775048913448006e-01   +5.617489043231408e-01   +4.289838778582757e-01   +4.265539461277931e-01   +3.340039662900876e-01   +6.949766204584149e-01   -6.504287298647429e-02; +3.115510077739563e-01   +6.911930364666204e-01   +1.257113978706700e-01   +1.674099919891266e-01   +5.253614738844435e-01   +3.045900039721472e-01   +2.219181368756749e-01   +1.449922598189984e-01   +3.337004035043185e-01   +3.897937149978014e-02   +3.274409586754388e-01   +7.565587673621461e-02   +9.393171379539127e-02   +2.156292615842747e-01   +3.773881756696981e-01   +6.005963332377737e-01; +3.298203453313395e-01   +1.075804419430728e-02   -2.656961148108853e-01   +2.843832397346987e-01   +3.391241227409572e-01   +1.209458419275833e-01   +5.650572942606349e-01   +6.128860415782338e-01   +2.819718379993236e-01   +3.531126658016546e-01   +3.570182758283839e-01   +4.870172432884796e-01   +3.970768330528042e-01   +2.067339357792020e-01   +1.466912100645825e-01   +3.814574644704902e-01; +4.216332021267024e-01   +2.007229920951629e-01   +6.625376105318956e-01   +8.517215869681147e-02   +5.608321977000464e-01   +3.481399464075262e-01   +5.787917641374680e-01   -5.420879999882824e-02   +1.918381752728498e-01   +5.513385723858368e-01   +2.604328841861069e-01   +1.035574206690424e-01   -6.742838431879540e-02   +2.962266429513702e-01   +2.574642674116776e-01   +3.527375045331370e-01; +2.010334098962362e-01   +1.440284815172321e-01   +3.762431756725736e-01   +1.918148684998581e-01   -5.026075738469367e-02   -3.824210881103506e-02   +6.510366288455932e-01   +3.128491172471562e-01   +4.937465397344336e-01   +4.230709277207595e-01   +5.264482419814964e-01   +2.952158616492205e-01   +4.751763538777026e-01   +2.850908213883067e-01   +3.010853401057951e-01   +2.400284747907180e-01; -5.057940381548726e-02   +3.651009680147074e-01   +5.385702841287937e-01   -6.664639756032721e-02   +4.973018219265110e-01   +1.721334569552606e-01   -1.110924460702406e-01   +3.145885672561133e-01   +6.415492847289005e-01   +3.014843046303258e-01   -9.233128372453507e-02   +7.143088167836388e-01   -2.601720774421680e-01   +2.966261601447810e-01   +6.627876326587451e-01   +6.156666914075575e-01; +7.904018793130085e-01   +1.129830838590124e-01   -1.715668859360311e-01   +3.317860574673916e-01   +6.248320791601799e-01   +1.900107560388815e-01   -2.603406713094579e-03   +2.609080289193454e-01   +3.932647746636639e-01   +4.657927285868119e-01   +2.461316354277552e-01   -9.212360645543657e-02   +1.600695180884520e-01   +3.283813098355973e-01   +3.474252613821771e-01   +2.653577573017821e-01; +1.851537823592597e-01   -1.268772160087745e-01   +1.076707471615855e-01   +8.035184129159350e-01   -9.541310893417738e-02   +2.236992927709325e-01   +3.376244127532800e-01   +3.413181537390882e-01   +2.166048111367004e-01   +3.758949181998892e-01   +2.140605098056310e-01   +6.039625430758793e-01   +3.034315721141494e-01   +3.087910110492889e-01   +6.602208645719384e-01   +3.531278165699654e-01; +4.898506278916751e-01   +6.952549246277676e-01   +3.627362614587198e-01   +5.687559288113538e-01   +1.421923310144755e-01   +5.339113671502810e-01   -3.041074818875983e-02   -2.864837339440634e-02   +1.113727509301560e-01   +6.750839338135204e-01   +3.970279390212744e-01   +5.115555661688495e-01   -2.452310536899294e-01   +1.608662864243751e-01   +3.257962546369936e-01   +2.156697004909195e-01; +3.519827915399143e-01   +4.373641886363367e-01   +2.559638486145367e-01   +7.656080140756962e-01   +2.062922321648500e-02   +3.137786942503753e-01   +2.473311244024947e-01   +2.265424680730414e-01   -2.593178766239667e-01   +3.315491184059927e-03   +6.707842652651748e-01   +5.416374693112291e-01   +4.050296131608266e-01   +3.961303415185252e-01   +6.697981054454659e-01   +7.284250552762442e-01];
L1E_L1I_iGABA_netcon = [+4.809598061491506e-01   +1.759842255511524e-01   +4.826965559363329e-01   +5.923950895300566e-01   +7.498384360443837e-01   +6.754207390553444e-01   +5.671779855845716e-01   +2.635798502716690e-01   +1.283038320218635e-01   +6.320331665709416e-01   +6.022931496702499e-01   +1.188482217566367e-01   +1.809379065070184e-01   +1.687071196633012e-01   +7.608745382218770e-01   +4.341978775347141e-01; +7.013903564852661e-02   +2.828888198134638e-01   +5.776751084781709e-01   +2.419634799089574e-01   +3.963784757405230e-01   +2.386683316219669e-01   +5.681069697418182e-01   +4.856447250482020e-01   -6.878794917238250e-02   +2.457480539631451e-01   -1.371711310957160e-01   +3.426046079469367e-01   -2.864332823404284e-01   +2.347013814653557e-01   +7.828138698659973e-01   +3.599921600103444e-01; +4.474598880409789e-01   +4.524829475797630e-02   -3.261489715628390e-01   +7.516271740554739e-01   +1.518345574657421e-01   +8.087987093060394e-01   -1.259246653616193e-01   +2.925820462319849e-01   +5.015440388058919e-01   +3.792796694969930e-01   +2.454286637664107e-01   +6.726449941714557e-01   -9.110555643599232e-02   +3.938390728668247e-01   +4.606351820454487e-01   +6.219394353408692e-02; +2.674281921731509e-01   +1.161076558189453e-02   +5.972959246148375e-01   +3.536415451388567e-01   +3.328373792598052e-01   +3.658959474925667e-01   +4.341178018532207e-01   +3.778653337505688e-01   +1.228845573561091e-01   +2.874461919203097e-01   -2.207064989585729e-01   +6.136397252805722e-01   +6.229529435410204e-01   +9.616786506943278e-02   +8.381376323867323e-02   +6.518159366036476e-01; +4.457557917124356e-01   +2.591597196015710e-01   +3.459996119390548e-01   +2.905976361441687e-01   +3.233048141802290e-01   +2.172842483836707e-01   -1.176259958683118e-01   +4.618507917912863e-01   +4.314947422680907e-01   +4.767592859235999e-02   +4.147003761063738e-01   +3.443086001569569e-01   +1.758554023022788e-01   +1.364480008050975e-01   +2.103912121879193e-01   +7.593827987173403e-02; +2.989852508038075e-01   +1.128270764794211e-03   +5.478441827786418e-01   +6.513733924197959e-02   +5.604433109183070e-01   +3.239378470153959e-02   +5.429148099971191e-01   +5.713099309617073e-01   +9.058335221464562e-01   -1.107211671947264e-01   +1.469791780066249e-01   +7.046968558902147e-01   -1.675542539432480e-03   +8.606363884831914e-02   +8.471726957928447e-02   -1.557333433158610e-01; +5.943448402073312e-01   +1.202416374994988e-01   +2.241484997223857e-02   +3.057616326384014e-01   +6.104856959947738e-01   +6.093810388371530e-01   +2.690658925098614e-02   +3.280283766793946e-01   +8.035337580457781e-01   +2.973520873271180e-01   +1.049684308524650e-01   -3.637807533618977e-02   +2.684679363486382e-01   +1.081422342535045e-01   +8.139449969952539e-02   +5.612084425474303e-01; +2.090949309037444e-01   +6.594941163869413e-01   -1.523574303079170e-01   +4.694999426120187e-01   +3.389066581734966e-01   +2.144588094870047e-01   +1.675614960304950e-02   +6.906172819743422e-01   +6.351119544395830e-01   +5.904578032793854e-01   -2.646152539431069e-01   +1.901545534808329e-01   +2.820934437250386e-01   -1.473749228480588e-01   -8.711030047526089e-03   +6.291730930146392e-01; +4.097567411806259e-01   +7.570720425431595e-01   -1.856565542112939e-01   +5.669408888216099e-01   +8.751425545803673e-01   +3.473934432639863e-01   +2.484746637434348e-01   +1.247958414090128e-02   +2.877888050814609e-02   +3.932583316026729e-01   +5.283766848664981e-01   +2.824584033949038e-01   +4.471253271598299e-01   +8.310922704764134e-02   +2.118840580580528e-01   +1.759586089858436e-01; +2.070115851359326e-01   +8.884274000998624e-01   +6.369389619715717e-01   +2.879371257361921e-01   +1.631413125757036e-01   +3.291370945010752e-02   +2.251378054560841e-01   +6.845185783778250e-01   +3.796945332812003e-01   +3.618589727903105e-01   +1.489464503307302e-01   +6.984861889941257e-01   +9.583218785936541e-02   +8.753214458318358e-02   +6.098857292926115e-01   +2.493362682945716e-02; +3.883606734601325e-01   +7.054950621756177e-01   +1.591395678908600e-01   +3.210117374732087e-01   -2.520808847596748e-01   +4.003794305074855e-01   +5.343047192286391e-01   +5.777993731254556e-01   -2.255920804577727e-01   +6.661492804866714e-01   +5.692338164933748e-01   +1.130765990506491e-01   +4.228203726581031e-01   +4.621738491269706e-02   +5.700443392598271e-01   +4.625164504940630e-01; -1.748293296965686e-01   -1.385640646273984e-01   -1.105294441861103e-01   +4.458242626617667e-01   -4.882884178272005e-02   -2.065618090303739e-02   +4.633064074027612e-01   -3.447303889482473e-02   -3.593486802314001e-02   +4.626981144460363e-01   +7.877616646854316e-01   +6.370881888963695e-02   +3.001430544482138e-01   +1.108308418711902e-01   +5.397410132013568e-01   +2.814686257913876e-01; +2.470143293983983e-01   +4.338267249339329e-01   +2.913689014490298e-01   +2.486535573866704e-01   +3.085819264715412e-01   +5.876724676331430e-01   +9.997601961663094e-02   +5.025555318576438e-01   -1.994063363487988e-01   +2.680746486186578e-01   -5.696572461420128e-02   +4.602870161038778e-01   -3.985872215105637e-02   +1.585232461041787e-01   +2.715159715406015e-01   +6.420652398103809e-01; -7.802601945774473e-02   +3.621434181338589e-01   +1.986534755936689e-01   +1.929134517174454e-01   +7.365724730010486e-01   +2.610350999279789e-01   +9.521938845770866e-02   +5.561903208302763e-01   +3.532616365772036e-01   -1.214269800163325e-01   +5.925117655997970e-02   +5.070222778090285e-01   -3.245481690781177e-02   +5.741603704074469e-02   +5.628357234245399e-01   +1.345692043946809e-01; +5.477219705878720e-01   +4.068133883529192e-01   +3.342466228848032e-01   +4.635134631317196e-01   +1.939208164030371e-01   +1.955211452107997e-01   +1.596225525670317e-01   -3.684266770429385e-01   +2.541024215965920e-01   +4.990787166743561e-01   +4.941902681149789e-01   +4.252597947807746e-02   +3.403129243762568e-01   -2.260375161524433e-02   +6.943031602364583e-01   +9.539343741907820e-02; -2.615396378906558e-02   +6.355649658211046e-01   +3.210062686567095e-01   +5.599325142882555e-01   -3.767457270093877e-02   -2.372589416052689e-02   +3.573552454287597e-01   +5.144248341031262e-01   +4.225921126507946e-01   +1.707390016858296e-01   +4.319571982893563e-01   +5.617505049635396e-01   -1.957921269824275e-01   -2.018709255803077e-01   +6.019252363644299e-02   +6.135817383168665e-01];
L2I_L1I_iGABA_netcon = [+3.125885358158969e-01   +9.626633599874770e-01   -1.686460446547074e-01   +5.710159140072293e-01   +4.600859547695764e-01   +3.091683493094458e-01   +4.417719465834522e-01   +2.033336986138999e-01; +5.294987655174054e-01   +6.555253294213351e-01   -1.289908980393488e-01   +2.685436077456133e-01   +1.960284109402697e-01   +3.420538609389623e-01   +5.631678566740340e-01   -4.229799773964262e-01; -2.750305517534198e-02   +7.639319633252605e-01   +2.740677320711170e-01   -3.129899826511834e-01   +8.057921491136284e-01   +1.985852076455139e-01   -4.250280920969574e-03   +5.031143940785895e-02; +2.104621542427895e-02   +4.249940877298782e-01   +3.820081913994713e-02   +2.820293904604293e-01   -2.150208752126854e-01   +2.469993951008117e-01   +4.940227703376340e-01   +4.203031537786066e-01; +5.359994965967719e-01   -3.505930463244382e-01   +2.493841619826089e-01   +6.872398554432710e-02   +2.729115907236759e-01   +3.448596325065113e-01   +5.788814131064473e-01   +1.570275832555507e-02; +6.553249036797628e-01   +2.925710626207759e-01   +1.743916225808760e-01   +1.721232199101945e-01   +7.628930422995613e-01   +3.108794621991743e-01   +2.724222412946443e-01   +2.631592671744634e-01; +6.018245852298870e-02   +4.779920388264720e-01   +3.322280957573050e-01   +1.070417687135026e-01   +7.284247776231598e-01   +4.741000527676585e-01   +2.931322670642388e-01   +1.042717514475525e-01; -7.007674869538164e-02   +6.014264656284734e-01   +3.561644513244838e-01   +7.254489228172084e-01   +5.069537534766839e-01   +8.315781142770178e-01   +4.556143787736716e-01   +6.087833242148595e-01; +3.060723819973203e-01   +4.115895057792711e-01   +2.234454137054784e-01   +1.243646872328147e-01   +5.054321273113039e-01   +1.091247691272702e-01   -5.351400902307267e-02   +2.300685241873698e-01; +6.190343166400184e-01   +2.205668344901565e-01   +1.716824755118902e-01   +5.534652336497751e-01   +6.707804224312969e-01   -2.420722352239157e-01   +2.358769524350774e-01   +3.916792995477347e-01; +5.110241046935537e-01   +4.487817950720187e-01   +7.983724913126677e-01   +5.789282612729263e-01   +1.868796921472507e-01   +6.728477955800145e-01   +5.667129876165606e-01   +2.212085254207875e-01; +2.189384704468747e-01   +2.987970217155358e-01   +6.281374442058711e-01   +4.690410850649935e-01   +3.804765991678644e-01   +5.325367969109807e-02   +8.745444020370693e-02   +9.892942098252103e-02; +1.268687969385310e-01   +4.399446148508560e-01   +2.463618915915844e-02   +6.662487189251835e-02   +3.539986913619341e-02   +2.883967554658917e-01   +6.122208189658811e-01   +2.322877692958592e-01; +5.811796089049942e-01   +1.151208889278186e-01   +1.993454674193287e-01   +6.358386005159240e-01   +8.090153966916419e-02   +3.408329237179932e-01   +2.654500283886566e-01   +1.669246364791793e-01; +6.025923361695029e-01   +3.205107667923975e-01   +5.101865969667613e-01   +4.543912764161613e-01   +5.734280572440860e-01   +2.469337879326736e-01   +9.765545012817353e-02   +8.535810147219096e-03; +1.500778018692289e-01   +1.682787690903201e-01   +1.263966713517182e-01   +3.213721501355696e-01   -2.675687300864142e-01   -2.598095149071232e-01   -6.789175435065353e-02   +9.655653648273052e-02];
L1I_L2I_iGABA_netcon = [+5.245603880013024e-01   +1.121702493695809e-01   -1.646182205030162e-02   +2.897849567989375e-01   +2.442973903496869e-01   -3.071848048014487e-01   +1.704867773191790e-01   +2.905297805169447e-01   +2.042579992692820e-01   +2.028091697091465e-01   +3.230409790377300e-01   +2.611069842537841e-01   +2.273292601534917e-01   +4.788705372535541e-01   +1.912163147453680e-01   +4.846244115887482e-01; +5.606557479640403e-01   +2.749300971924311e-01   +2.094187353589803e-01   +4.161128062390977e-01   +7.479024237319508e-01   +8.748860671441144e-02   +1.497369160858762e-01   +3.743811302096868e-01   +1.379390574616089e-01   -1.211923345236967e-01   -1.217358420568686e-01   +1.067581407626779e-01   +4.072991622094151e-01   +1.441559829316748e-01   +1.388249259751741e-02   +4.585366349842784e-01; +2.631580270687951e-01   +5.879769751038939e-02   +2.280053437336951e-01   +7.639503657150396e-01   +6.857818757721129e-02   +2.571282156348085e-01   +6.923846797053768e-01   +7.594419823489305e-02   +7.080213327447731e-01   +4.955495845963150e-01   +3.081585895285716e-01   +2.955539418090348e-01   -2.903343502994808e-01   +1.031506828377493e-01   +3.569401150297999e-01   -2.176508089657322e-02; +6.050555594048228e-01   +2.215696129976928e-01   +7.621536611566970e-02   +4.573747158436007e-01   +3.111184976559537e-01   +2.132751728737841e-01   -1.135832118370673e-01   +3.292894007240987e-01   +8.429408538647680e-01   +2.982559260342740e-01   +5.360580116775783e-01   +8.035360981716775e-01   +1.803297058387832e-01   +4.243374129437683e-01   +1.480533690012232e-01   -2.822838317812540e-01; +3.415130488117792e-02   +9.387515839819652e-02   +1.678060842426136e-01   +5.128252907492336e-01   +1.549385541279769e-01   +5.196773687955426e-01   +4.968218914885996e-01   +7.345596237019927e-01   +2.182799168923943e-01   +3.740954741003329e-01   +6.876138921848517e-01   +2.604776531262747e-01   +1.753221875906308e-01   +3.481348699790761e-01   +3.034989078293496e-02   +1.307004835163239e-01; +4.881762268071930e-01   +1.172324389138419e-01   +8.475873460992470e-01   +1.625716317321480e-01   +1.552741010090426e-02   +1.430476104501473e-01   +2.454424854474934e-01   +7.120726794133017e-01   +7.348683870817708e-01   -8.845398642646610e-02   +2.803048911537342e-01   +2.850450931380066e-01   +1.568091120339950e-01   +6.200618249038536e-02   +8.255987045465418e-01   +4.202952318832840e-01; +1.404585761999090e-01   +5.330974804331291e-01   +2.080036829975435e-01   -6.059940055132909e-02   -1.237247782795163e-01   +8.504876581615257e-01   -7.475836077183093e-03   -1.530990724742000e-01   +1.533484536195479e-03   +4.583431223356050e-01   +7.657388807071291e-02   +7.086999666948002e-01   -3.353688126481135e-01   +4.834823535730401e-01   +6.302230581405297e-01   +3.828660004603474e-01; +3.173286333588204e-01   +7.310552218171069e-01   -5.176656852922111e-02   +3.001917872113994e-01   +2.522040567182958e-01   +1.192130263243627e-01   +5.450701414623662e-01   -1.615071578807861e-01   +1.502020031315503e-01   +2.656423922905134e-01   +2.071395634314797e-01   +4.337152869254568e-02   +3.021761543564431e-01   +7.424681195227849e-01   +4.236271168742053e-01   +4.639640163237147e-01];
L2E_L1E_iAMPA_netcon = [+3.767620743862124e-03   +3.384085916331217e-01   +1.807525890868469e-01   +6.262537324156235e-01   +5.291162624166083e-01   -2.209305641991765e-01   +2.414260818474392e-01   +1.290634759817495e-01; -1.845220433944225e-02   +6.784172294933002e-01   +5.549998606363932e-01   -2.362306726591315e-02   +9.327038515995325e-01   +4.710995771560635e-01   +1.679677498543455e-01   +5.946264466347209e-02; +2.595102231395119e-02   +3.809466807556061e-01   +1.813963023082877e-01   +2.194177830405541e-03   +4.786909941606037e-01   +4.290435913054618e-01   +2.275076734434914e-01   +5.441639621042920e-02; -1.000515796500552e-01   +2.464731869870117e-01   -2.371128090436547e-01   +2.700316148749844e-01   +1.011988679788549e-01   +7.740150196341997e-02   +6.994539983646474e-01   -9.720315959608511e-02; -1.180801565589516e-01   -6.695044363639205e-02   +5.645664362907683e-01   +2.705026143254919e-01   -1.245992748166774e-01   +3.055753016515360e-01   +2.643920312237196e-01   +2.502497175840410e-02; +2.817989244942891e-01   +5.060353593682998e-01   +2.095413689557987e-01   +2.843993760635221e-01   +4.493104832762244e-01   +3.083933687028901e-01   -4.385924124395080e-02   +5.891095124873674e-01; +3.049779207469349e-01   -2.387536197598378e-01   +5.548730556302276e-01   +5.303091230992013e-01   +3.030895175334303e-01   +9.017235096324401e-01   +2.684470954084829e-01   +2.447048169317828e-02; -1.364785700075860e-02   +2.161051664866603e-01   +3.326231543746436e-01   +2.371501380876465e-01   +2.926896608778302e-02   +5.386303729307028e-01   -2.390565382783706e-01   +3.538484810826892e-01; +4.086496027669414e-01   +3.623530508279825e-01   +3.737937135302479e-01   -3.444584956884059e-01   +7.257090215269131e-01   +1.582355254056137e-01   +1.026423659572774e-01   +4.363123030043289e-01; +3.774997781770707e-01   +4.713251139186564e-01   +3.187042894077841e-01   +6.196569905004807e-01   -1.104012073769157e-01   +6.686451500768125e-01   +4.669166614635982e-01   +2.925971561138576e-01; +2.815129875332013e-01   +5.169989011479135e-01   +5.446974785384173e-01   +1.818581175564296e-01   -1.060863640434467e-01   +4.372839635671888e-01   -1.794907276995998e-01   +4.628806878156609e-01; +3.466254818857438e-01   +2.449962954750190e-02   +2.156465421365175e-01   +1.064305207438904e-02   +2.383311088446380e-01   +2.435277110180812e-01   +1.099953654098059e-01   -2.902952756855499e-02; +2.630692923601168e-01   +4.558107097547405e-01   +1.818277707988248e-01   +2.192747029553435e-01   +3.368293680776392e-01   +2.946665499617186e-02   -3.571184427953041e-01   +5.469842283368023e-01; +1.947917057713438e-01   +5.656512491950058e-01   +3.818614048639575e-01   +3.660711029670312e-01   +1.836059202519225e-01   -1.567943242024042e-01   -4.171419761936289e-01   +1.832074959354673e-01; +1.932622488241061e-01   +4.613659523243895e-01   +2.407057994950529e-02   +3.979820216177687e-01   +2.120182541059143e-01   +3.467356636440398e-01   +4.770388460513065e-01   +1.476129798098963e-01; +4.242382535071018e-02   +4.317103051854388e-01   -2.312394344038004e-01   +5.635305206578654e-01   +4.151013351296802e-01   +5.335066396081659e-01   +7.686326200034173e-01   +7.217123838026273e-01];
L1E_L2E_iAMPA_netcon = [+3.096709792501585e-01   +2.207398861328169e-01   +3.935256443592521e-01   +3.266992140401791e-01   -1.184375936077168e-01   +4.556763386774241e-01   +6.709818539729556e-01   +5.412338253520977e-01   +4.724458813422915e-01   +4.970216974415617e-01   +2.357904436547372e-01   -1.177087346859359e-01   +7.425756125829126e-01   -6.554737674350639e-02   +3.634214730206980e-01   -1.144697682827713e-01; +5.215191265211573e-01   +4.708651598388350e-01   +6.148837698310622e-01   +1.265696498790947e-01   -6.919211710202151e-02   +2.036229948075229e-01   -1.637519161296266e-02   +3.388390369474362e-01   -2.401445019859039e-02   +4.257847280066328e-01   +7.766045028346612e-01   +4.899899877204442e-01   +4.020590711004530e-01   +4.384955210514556e-01   +3.795312619376545e-01   +4.133088348120930e-01; +5.423967102340882e-02   +3.966920918191000e-01   +4.602012968838954e-01   -4.642655878239088e-03   +3.003101523552536e-01   +3.104772212521127e-01   -8.942226469360302e-03   +8.303527474550839e-01   +8.386196390934034e-01   +3.621047827132506e-01   +3.330667994044809e-01   +6.091066705744929e-01   +4.120380726090559e-01   +3.957050314283205e-01   +2.224099701015760e-01   +5.988370950933748e-01; +4.496720662195048e-01   -1.223474079254325e-02   -2.259526491063452e-01   -9.403241135665767e-02   +2.383641264577742e-01   +1.660945037578894e-01   +8.568219549461100e-01   +1.654383636341333e-01   +5.825769059793767e-01   +5.690694091195979e-02   +4.398956382513021e-01   +5.962859057265867e-01   +4.115752229286880e-01   +1.771701502545492e-01   +2.311612784790136e-01   +6.995619490026409e-01; +4.267012956126148e-02   +6.215316633942845e-01   +6.943609458662170e-01   +3.330459770554681e-01   +7.971228956459534e-01   +6.115438281288104e-01   -1.759506358191262e-01   +3.513275033471882e-01   -2.726838674461671e-01   +2.522083584655748e-01   +2.561771976329635e-01   +4.335472363241543e-01   +5.150549446479361e-01   +7.365823778895568e-01   -2.870900240086671e-01   +4.356851249226489e-01; +1.093757222955850e-01   +3.155348146191697e-02   +6.770967981833579e-01   +5.562947056301148e-01   -2.161172838583200e-02   +3.208670414825518e-02   +2.002486296197999e-01   +6.940433886751972e-01   +3.061083141612314e-01   +2.788478750308610e-01   +3.208467357788583e-01   -1.008662024929491e-01   -5.673823326451571e-02   +5.066080054501130e-01   -2.645129415931442e-01   +4.120330006285066e-01; +4.549571734145177e-02   +4.736784118307190e-01   +2.436187341550078e-02   -1.092520596822419e-01   -1.506402288832717e-01   -6.823111648430492e-02   -1.153798198985200e-01   +2.886997564576406e-01   +2.157440004673234e-01   +4.120594482573906e-01   +4.519726849669308e-01   +8.396964529916270e-01   +4.564946599375632e-01   +4.140270730655708e-01   +7.316546979328591e-01   +5.443293719395600e-02; +5.182898906440320e-01   +2.313740266400361e-01   +7.147191579417819e-01   +1.686387698596165e-01   +8.908106667020903e-01   -2.579640898351516e-02   +4.226362811418701e-01   +4.778248350550257e-02   +1.530078553469381e-01   +4.169981168797274e-02   -1.723260817594326e-01   -4.253122706867281e-01   +4.637229267250261e-01   +2.269549073766783e-01   +5.013442862262746e-01   +3.363637280633699e-01];
L2I_L2E_iAMPA_netcon = [-5.969026315279832e-02   +3.043257303478398e-01   +1.446001956479495e-01   +2.645741992668670e-01   +4.895907812459479e-01   -1.499209532872340e-01   +6.163287134613729e-01   +5.717545598025866e-01; +1.734467863839100e-01   +1.886541753542069e-01   -1.637154358033209e-01   +4.004224087035161e-01   -2.486893679917167e-01   +2.397830390088196e-01   +2.874132400773127e-01   +6.172606431299945e-01; +3.936182690037786e-01   +1.077537236646227e-01   +3.854345730713121e-01   +3.762714291983409e-02   -9.315096796847611e-02   +1.354983019344939e-01   +2.741689331829079e-01   +5.779297020955377e-01; -2.213116018479823e-01   +5.464482620791268e-01   +4.016733467682375e-01   +1.553933121197189e-01   +7.437011442828609e-02   +5.169257720808575e-02   +6.380583418759314e-01   +8.571710170460473e-02; +2.091632923718749e-01   +4.235057391090269e-01   +1.550714026928708e-01   +2.226725553627900e-01   +2.588831844137298e-01   +2.126310649571774e-01   +4.599964884933526e-01   +2.378873583769643e-01; +1.529337862050150e-01   +1.585389961092828e-01   +1.676677727022782e-01   +5.170066957545320e-01   +4.886702668673552e-01   +7.100421694722138e-01   +4.988257685730562e-01   +4.510780605536385e-01; -2.424004148474289e-01   -1.132607949423822e-01   -2.270533375273292e-01   +7.873470767847016e-01   +1.800441806487861e-01   +8.238745048031357e-02   +1.515629153728006e-01   +6.368570729848404e-01; +1.059542017441847e-02   +2.911143833934546e-01   +8.930109826238564e-02   +8.091800610361886e-02   +3.026454400409804e-01   +2.344496908282193e-02   -6.386242789965955e-02   +2.267696609421981e-01];
L2E_L2I_iGABA_netcon = [+5.277143748040417e-01   +2.590990386951101e-01   +4.134989146868965e-01   +4.345411830024859e-01   +1.900459076034890e-01   +5.209406189315674e-02   +3.295719252978132e-01   +6.686644461996633e-02; +7.322782797072241e-01   -1.377875635605864e-01   +2.809989773187115e-01   +7.142954613069425e-01   +2.767928784208560e-01   -1.983488103980771e-01   +2.434467727959355e-01   -1.140286172750281e-01; +4.864118601485557e-01   +2.967348874440663e-01   -2.127278568546534e-01   +2.576914806895620e-01   +1.144208268713040e-01   +2.512384615852816e-01   +6.808619832938355e-01   +5.083839085548755e-01; +2.831547642143869e-01   +5.514799539180707e-01   +5.479072383918299e-01   +4.387306540877129e-01   -7.644171596568972e-02   +1.232884187504122e-01   +1.886745638990668e-01   +4.833269759064455e-01; +6.977615667395690e-01   +2.913888940168435e-01   +2.445994978799746e-01   +2.327499543516390e-01   +8.426572704218765e-02   +2.812791725282212e-01   -5.886620193288297e-02   +9.211361340567303e-02; +2.451331462354567e-01   +5.768628335472498e-01   +1.729627819699375e-01   +1.695413408188420e-01   +3.494031561491060e-01   +1.072630823262616e-01   +3.697521099241453e-01   -4.387036571070265e-02; -8.428105248156387e-02   +1.861607621182293e-01   +1.427194006321051e-01   +4.680540609356002e-01   +5.924396169754820e-02   +3.406638272659410e-01   -1.549258149456342e-01   +3.880500797903745e-01; +1.401109202356849e-01   -8.392535407692570e-02   +2.931720913376651e-03   +7.261653094168595e-01   -9.424856263705439e-02   +3.824708745426600e-01   +7.183347684383815e-01   -3.678590704148058e-02];
L3E_L2E_iAMPA_netcon = [+1.783538524242539e-01   +5.458364465106553e-01   +3.992829025506043e-01   +8.282152891110244e-01   +4.986013399062312e-01   +4.614543477981680e-01   +8.442114713776219e-02   +4.238018808451402e-02   +1.601637410625427e-01   +3.094608106462337e-01   +7.049429885472991e-02   +2.544688764692535e-01; -1.365719425652815e-01   +1.333911872752605e-01   -7.596178427721909e-02   +2.697334929411640e-01   +3.585557761603204e-01   +1.189359117264552e-01   +4.682602679478666e-01   +1.814646300597605e-01   +4.604725702533223e-01   +6.491338790179982e-01   +6.665879059850618e-01   -7.003192877534066e-02; -1.290959879368413e-01   +2.372745399798208e-01   +2.315391320767534e-01   +6.487858926265179e-01   -1.655432560728538e-01   +5.840096793958981e-01   +4.370614310237171e-01   +6.665414471354910e-01   +1.899652086340260e-01   +6.649189728487077e-01   +3.305199298205188e-01   +8.274523262500709e-01; +3.580589284620499e-01   +1.875379730585194e-02   +2.081530271161236e-02   +3.610793330449793e-01   +5.278550586572289e-01   +1.328281643975193e-01   +2.138506444946084e-01   +1.813611250377052e-01   +2.475247559157120e-01   +4.435821420077233e-01   +4.361785605868231e-01   -7.947850536815415e-02; +4.407042382634160e-01   +1.897471486613000e-01   +2.591613290808631e-01   -4.910487243155368e-02   +2.440541923702635e-01   +7.994773907672414e-01   +5.406441800408753e-01   +2.912162431664582e-01   +1.173027050216074e-01   +6.863622508093858e-03   +3.223206226202246e-01   +1.608502217144141e-01; -1.628008540649849e-01   +2.214033708272191e-02   +1.207377247444711e-01   +2.688099761387569e-01   +2.723374034512203e-02   +4.681299016339545e-01   +7.310446161654419e-01   +2.698828111777195e-01   +3.624358469446680e-01   +4.030750027301644e-02   +3.725463559141761e-01   +2.545749177024618e-01; -6.615463880553862e-02   +5.868465148532627e-01   +4.895657686221920e-01   +2.686639361726100e-01   +2.777645195106847e-01   -1.128051548173821e-01   +2.502173138199821e-01   +5.323448227539563e-01   +5.564683693438131e-01   +2.232464748084114e-01   +3.398775181458915e-01   +3.375434423398316e-01; +1.264579978208674e-01   +1.690849608581008e-01   +1.062999599842562e-01   +8.892183921768149e-02   +1.629072563383601e-01   +1.727355326812530e-01   +4.471697317367666e-01   +3.321726245243128e-01   +5.657472642160797e-01   -1.236396095422196e-01   -1.235131961091262e-01   +2.225493811220874e-01];
L3I_L2I_iGABA_netcon = [+3.155265977580064e-01   +3.133648813691218e-01   +6.004367096673804e-01   +1.357030798234303e-01   -1.277136251170329e-01   +5.779050963512503e-01   -2.647097490735090e-01   -1.096961662863319e-01   +2.717708747765155e-01   +4.034376887669045e-01   +6.239808023692212e-01   +2.215047606216315e-01; +7.277596304102346e-01   +1.098635171499670e-01   +2.766775176000095e-01   +2.132651102617431e-01   +7.392613663456351e-01   +5.388968096733200e-01   +2.025846844299324e-01   +7.431447045378158e-01   -6.065935292120067e-02   +4.091171332847768e-02   +3.800540720423185e-01   -3.527435018968215e-02; +3.811808031291365e-01   +2.764095103692357e-01   -6.410432898434516e-02   -3.511922994972781e-02   +1.963883819703769e-01   +3.343323122400690e-01   +2.538005769325398e-01   +3.504087121715628e-01   +5.259828087499742e-01   +3.529784423529315e-01   +6.717455993974925e-01   +1.578233083288949e-01; +7.421952021721765e-01   +4.177588487604135e-01   +5.469273049858860e-01   +3.027089591184978e-01   +5.545051849424443e-01   +3.079516279077520e-01   +1.000000000000000e+00   +4.296607570335199e-01   +2.091293585599803e-01   +3.082190935549796e-01   +2.011184933543667e-01   -8.915194851924529e-02; -7.104222114879868e-02   +4.276603646581587e-01   +6.169144349155697e-01   +3.976833196383321e-01   +1.978102447345439e-01   +3.216138294711324e-01   +5.405968934436798e-01   +7.716013361743641e-01   +2.768965145158931e-01   +6.239217904305097e-01   -1.565898152913886e-01   +1.043122562684387e-01; +6.698310533945540e-01   -1.470247192170003e-02   +4.294739390477403e-01   +1.570286808296476e-01   +3.190182180282152e-01   +4.418661259825185e-01   +7.763108171879000e-03   +2.745801810939733e-01   +1.484090628175830e-01   -1.813182646209707e-01   +2.855698994849178e-01   +5.653791968342000e-01; -9.479915004374809e-02   +1.749329843330808e-01   +3.746854095249945e-01   +5.452438894353097e-01   +8.081804045635004e-01   +7.230504836277404e-01   +3.946274298095783e-01   +7.785253015741513e-01   -1.853282888731573e-01   +2.794476082724043e-01   +3.387439683676430e-01   +3.159346522845980e-01; +6.847022744353219e-01   +3.444483948439278e-01   +3.759034804773175e-01   +6.655566984820700e-01   +3.762805877152516e-02   +3.836184928765635e-01   -3.276544837935694e-01   +1.711899418407955e-01   -5.171088562191881e-02   +3.423475221067931e-01   +4.009370974082346e-01   +1.507528316732192e-01];
L2E_L3E_iAMPA_netcon = [+3.656129582746445e-03   +2.315429547813206e-01   +3.462905168771331e-01   +2.781443142056834e-02   -1.423059904851381e-02   +1.000000000000000e+00   +6.731748053223929e-01   +3.380777174465067e-01; +3.781652772933200e-01   -1.240185138435819e-01   +5.584790907166496e-02   +6.491838601907896e-01   -8.579862985205076e-02   +2.077749627988877e-01   +6.214089345809524e-02   +3.821623472400048e-01; +5.312517383365388e-01   +3.801118243709800e-01   -1.387448960596322e-03   +6.922123684409992e-02   +5.610859228642125e-01   +3.074709550804160e-01   +3.644877748641441e-01   +7.441501714337646e-01; +4.276411904988200e-01   +3.265200248552447e-01   +5.089393432756938e-01   -2.738167144528690e-01   +3.682193140766372e-01   +4.593955331244650e-01   +4.527844338444149e-01   +3.659960127103270e-01; +3.530655520874339e-01   +7.711543029599676e-01   -3.053663099370776e-01   -7.034731529137399e-02   +1.422825070352444e-01   +5.819661339638429e-02   +6.004492261230820e-01   +3.151537543188551e-01; +8.075457252518216e-01   +5.677979234209519e-01   +7.484350387928058e-02   -5.460834978848320e-02   -2.936886134223344e-01   +3.960808179086119e-01   +2.521700379787266e-01   +3.068069879890888e-01; +4.399415826761175e-01   +3.967918411211719e-01   +2.378390038420612e-01   +3.974899767303455e-02   +4.897176306007107e-02   +3.340856868686807e-01   +5.354456464948334e-01   +2.817407225538622e-01; +3.460917631158454e-01   +3.858083866413319e-01   +4.858061810771788e-01   +6.650824230233864e-01   +3.014152175367726e-01   +2.551107882050128e-01   +2.694048031208835e-02   +2.928976611408022e-01; +1.036183090878292e-01   -1.955266946207472e-01   -1.459278375769202e-01   +3.249409558998163e-02   +1.113136936992029e-02   +5.404463369888657e-01   +7.402200053491889e-02   +3.658135012524428e-01; -3.279566939038729e-01   +3.267243221992056e-01   +1.266384533658685e-01   +3.602348244370318e-01   +3.117400150094425e-01   +5.392783847361355e-01   +5.440955351731508e-01   +2.879913897839672e-01; +4.580415861201364e-01   +6.482744409255324e-01   +3.434928866798506e-01   +3.222153288953002e-01   +4.033388996369121e-01   -4.192497897291053e-01   +4.849247691598944e-01   -1.197545892886950e-01; +2.651146807063739e-01   +4.202591081500533e-01   +3.530014598095381e-01   +9.005212478408310e-02   +4.268968605024371e-01   +4.207556006319986e-01   +1.436122157723979e-01   +8.620739603068376e-01];
L2I_L3I_iGABA_netcon = [+3.423275731402739e-01   +8.125242826667629e-01   +6.767694274229841e-02   +2.996894216460466e-01   +3.412568429965424e-02   +8.450663324283956e-01   +4.759387245071051e-01   +4.836002070147744e-01; +2.130967266197557e-01   +1.539901251376364e-01   +8.271750828242734e-01   +2.717084157366290e-01   +4.512025835915987e-01   +6.295867393001556e-01   -2.799511282659104e-01   -1.979568608749844e-01; +4.887818329574786e-01   +5.422914755194228e-01   +4.055736616364444e-01   +3.745501829103812e-01   -3.147646585260760e-02   +2.901057158537380e-01   +5.559155359650870e-01   +8.107559168311337e-02; +3.762599144572811e-01   +7.466076699160603e-01   +3.001427355118950e-01   +2.018927327594212e-01   +3.553661137397586e-01   +5.442633449388310e-01   +2.790058859678931e-02   +4.629771449870077e-01; +1.602319342108369e-01   +1.442565655768863e-01   +4.576869494005510e-01   +1.067803977733205e-01   +4.999719816874446e-01   +7.550541814954594e-02   +2.336023872243229e-01   +3.210735498492329e-01; +4.282632537107569e-01   +3.447587205160927e-01   +7.561730236580555e-02   +1.000000000000000e+00   -8.762206867556158e-02   +1.657268294401743e-01   +2.235750436090906e-01   +6.488175297087632e-01; -1.291152180908290e-03   -1.667615913740582e-01   +2.502218684635384e-01   +2.507821252498038e-02   +8.412814474965747e-01   +6.992641190299470e-01   +8.195933201848873e-02   -8.074346717266233e-02; +3.997831155139902e-01   -3.320730189199755e-01   +5.852548019422623e-01   +2.424695799262092e-01   +2.312095606639706e-01   +1.122987158044508e-01   -4.416632283397335e-01   +6.704280028126797e-01; +7.896176004648417e-03   +7.558717783593401e-02   +2.674144004991969e-01   -1.781239710357775e-01   -1.516414719964956e-02   +5.036368197211929e-01   +2.725974461733371e-01   -2.304376860001091e-01; +1.282323418671968e-01   +5.724950068424391e-01   +6.294311308934459e-01   +2.847406553540469e-01   +4.799355269659191e-02   +4.056739398696261e-01   -1.857785421191795e-01   +2.171177867479928e-02; +3.296792547232041e-01   +5.446613058976233e-01   +1.632720468860865e-01   +3.249249430504195e-01   +3.640673213627210e-01   +3.504762128957806e-02   +3.595178653320615e-01   +6.502975576647842e-02; +2.514921445276255e-01   -2.008537011368570e-03   -2.072773118836844e-01   +1.245853665336888e-01   +7.347673975981898e-01   +1.048205438602385e-01   +6.096169158960638e-01   +1.929986440117347e-01];
L3I_L3E_iAMPA_netcon = [+1.618654118497515e-01   +1.769932651757122e-01   -1.780159906453822e-01   +5.549873262880383e-01   +7.335427384644576e-01   +1.273156368377516e-01   -1.737311358463492e-01   -8.130321828151704e-02   +5.240081859445596e-01   +2.393692902011070e-01   +9.332540951620498e-02   +4.719018963510778e-01; +1.976122212970708e-02   +8.580205790787035e-02   +5.084336392796677e-01   +3.202049988163630e-01   +3.798003923143513e-01   +6.429933445511037e-02   +7.295778972239686e-02   +2.958275698980502e-01   +5.228709144169507e-01   +5.144169061253107e-01   +1.477676183996793e-01   +5.715109322471286e-01; +3.323698283930291e-01   +4.285216912436928e-01   -2.896298616162057e-02   -1.304900786406234e-01   +6.285268040389557e-01   +2.297048265664746e-01   +1.139935519783584e-01   +3.211540912706545e-01   -9.390842192033040e-03   +4.660735561399725e-01   +3.762192214577360e-01   -8.922123989802583e-02; +1.065026455364571e-01   -1.021785218574161e-01   +2.162273237027278e-01   +5.816706223525892e-01   +3.879465648432479e-01   +9.268409369002153e-01   +3.680619674801253e-01   +6.934636064848962e-01   +1.000921281588331e-01   +3.130575897848148e-01   +3.166290683630289e-01   +4.795881425221767e-01; +1.086068150550202e-01   +3.998498221527716e-01   +4.158122770160144e-01   +1.078369694216462e-01   +3.065349607507621e-01   +4.109449356069692e-01   +1.694862705916162e-01   +6.010317340722723e-02   -4.810447412640237e-02   +3.006430305601341e-01   +2.596143662585510e-01   -5.592200826542563e-02; +3.590359086889187e-01   +1.230319658612963e-01   +6.330607960879604e-01   +3.578711931058137e-01   +5.524527234691392e-03   +4.190551783497984e-01   -8.729540068011761e-02   +8.555308920977807e-01   +3.099027846814728e-01   -1.669800713012920e-02   +1.182033140399562e-01   +1.731836265850387e-01; -1.242160520175042e-01   +6.973673073104572e-01   +9.141260167137981e-02   -1.936560830950082e-01   +1.349024957810074e-01   +4.035164179150496e-01   +7.530998238277437e-01   +3.107441342662468e-01   +7.406537546580061e-01   +3.013406027392247e-01   +2.346493849829392e-01   +5.421948825061610e-02; +2.423061755192993e-01   +5.820025647716900e-01   +6.394137738366653e-01   +1.663982629349317e-01   +3.325567594184997e-01   +4.511460122613233e-01   -9.491266537168493e-02   +3.770531536307178e-01   +2.213490233582193e-01   +5.710916255248107e-02   +3.222159325828036e-01   +2.095959243630101e-01; +5.341088175919131e-02   +6.627979596809987e-02   +5.024434558355197e-01   -4.591867138109166e-04   +3.210336477636867e-01   +1.217209155715833e-01   +2.690262502288507e-01   +6.024395590805623e-01   +4.821316383512116e-01   -2.013684189311946e-02   +2.740688209237727e-01   +5.293016875689458e-01; +5.925030768444302e-01   +3.426638578887752e-01   -1.035017536704285e-01   +4.401464516307255e-01   +3.123592945693888e-01   +3.208119500916565e-01   +6.480703519821530e-02   -1.456366886109778e-01   +4.192709437035885e-01   +1.000000000000000e+00   +1.845410615838972e-01   +3.980518243261954e-01; +2.469988842061148e-02   +3.351686458220095e-02   +3.745437550716851e-02   +3.419895271641443e-01   +4.279262029618707e-01   +1.470321695792665e-01   +3.252640992729297e-01   +2.300519935876915e-01   +8.108633412441837e-02   +4.341283271145225e-02   +5.783133970858479e-01   +2.577642223025606e-01; +5.805740090870978e-02   +5.821217489827698e-01   +3.986400440934539e-01   +6.445339230496139e-01   +2.411171618945200e-01   +2.978993189965666e-01   +7.447703089593419e-01   +3.752391227504521e-01   +7.050461758980700e-02   +3.798813357711921e-01   +5.025516671254695e-01   +2.366863919980899e-02];
L3E_L3I_iGABA_netcon = [+2.855970368201038e-01   +5.283766404740512e-01   +4.317558636409976e-01   +7.624431878535760e-01   +4.624540784239856e-01   +6.615960840199289e-01   +2.107446467603132e-01   -2.756833978692486e-01   +7.615652394892128e-02   +8.184367320563187e-01   +3.400652875654686e-01   +1.298991095404062e-02; +4.689564658188143e-01   +3.299429311784667e-01   +1.730618013984840e-01   +4.475316755221808e-01   +3.386156309970791e-01   +6.872409880789422e-01   +1.583198476176818e-01   +7.395288354518681e-01   +5.835711467801222e-01   +5.892524727710524e-01   +6.468339361441640e-01   +3.821886866671477e-01; +1.887023386547661e-01   -2.611843155032335e-01   +3.270222239994981e-01   -2.664078480178553e-01   +7.611849738721725e-01   +4.534912353225763e-01   +2.605061992704127e-01   +1.229985247568656e-01   +1.056772269778637e-01   +4.341766540668375e-01   +2.194982462909893e-01   +2.774686837244906e-01; -1.163888760736413e-01   +3.635001553587517e-01   +1.600620062941912e-01   +3.036988873654986e-01   +6.282165572002781e-01   +3.633263687727686e-01   +2.406802972007744e-01   -2.952853927199535e-01   +2.482798316999030e-01   +4.433583236794402e-01   +2.863647651833264e-01   +1.412343155719303e-01; +2.976454150986326e-01   +1.491027338352458e-01   +4.710016328380275e-01   +2.384841151238118e-01   +4.140418767997792e-01   +6.439753654814458e-01   -6.033261405300039e-02   +3.384392184248139e-01   +2.392085517093812e-01   +8.824071253251140e-02   +2.661516562803247e-01   +1.971278855632904e-01; +5.225543390064035e-01   -1.496346446142651e-01   +3.068828652404375e-01   -2.482846550787559e-01   -9.480405249345758e-02   +2.991074197213425e-02   +6.516477909821672e-02   +2.722866507271554e-01   +2.902437889128183e-01   +6.205650985715664e-01   +1.504499454399302e-01   +7.505607034897650e-01; +2.834351916897180e-01   +3.441514886360682e-01   +1.883967402355703e-01   +4.536765366133152e-01   -1.143195601310759e-02   +3.673176129345921e-01   +5.922299615302636e-01   -1.178144461903242e-01   +9.362714363435573e-02   +2.945635004799253e-02   +3.318988342908583e-01   +3.348281780458977e-01; +6.868996588277232e-02   -1.445568249221830e-01   +7.690452491298249e-01   -9.466948811849364e-02   +1.397538102906477e-01   +2.657489419375011e-01   +3.786263807834978e-01   +4.979982357051414e-01   +4.983802536661647e-01   -3.839788582954165e-02   +5.149562324611565e-01   +1.447582065576608e-01; +5.812414884559580e-03   +6.395919491739616e-01   +3.562563889765433e-01   +2.413749376649805e-01   +6.061870083646953e-01   +1.956480191630651e-01   -2.791953462444171e-01   +1.217314693158806e-01   +5.218079632766659e-01   +3.711395881762440e-01   +1.712998942776093e-01   +3.425126386457467e-02; +3.789972892869607e-01   +3.182551196921632e-01   +4.093041784751260e-01   +2.394422214113605e-02   +3.026452602602143e-01   -7.646803355954193e-02   +3.609949279597586e-01   +6.987196800936933e-01   +1.239547765823687e-01   -3.853268874223612e-02   +7.135501168828113e-01   -1.800505545352913e-01; +2.515063716080975e-01   -9.786193322438097e-02   +2.156469298167528e-02   +5.200684538338518e-01   +1.889261962823887e-01   +9.841730194573474e-02   +4.850259237596765e-01   +2.848354884388336e-01   +2.457355785376545e-01   +7.486830761897485e-01   +5.664691139905678e-01   +2.179904904244102e-01; +2.310562671829447e-01   +5.008219951405188e-01   +3.339577484756926e-01   +3.808403768083164e-01   -1.185980256397775e-01   +1.712530479123623e-01   +3.332982395867786e-01   +5.024832118911521e-01   +3.857297138877904e-01   +2.270411322082634e-01   -8.925755428843297e-02   +5.569669541808879e-01];
L2E_Input1_iAMPA_netcon = [+2.775034496393434e-01   -2.727778958222646e-01   +7.174365694836066e-01   +2.743353540920597e-01   +2.410531790036392e-01   -2.095584022058599e-01   +1.493511717080624e-01   +1.997114810251973e-01];
L2I_Input2_iAMPA_netcon = [-1.979887416208651e-01   +2.195033968856734e-01   +5.499347553066460e-01   +7.388582989543561e-01   +2.520533767210954e-01   +2.338224894166276e-01   +7.297091094763901e-01   +9.251623584138083e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 30*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 30*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
