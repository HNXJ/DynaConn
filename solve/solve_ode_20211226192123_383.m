function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.118054485105396e-01   +9.612974359115145e-02   -2.561255607430870e-01   +7.797525798212737e-02   +1.941292990043101e-01   +3.064889407180246e-02   -4.832206033230840e-03   +2.457176038167604e-02   -2.019438073390217e-01   -1.625009894956283e-01   +1.097634546156123e-02   -3.092840835343566e-02   -2.756192826212474e-01   +1.361069697299531e-02   -5.861618654775547e-02   -5.965865620996881e-02; -4.286967227449851e-02   -2.529478880589593e-01   +2.830494149849624e-01   -7.974005879102164e-02   +1.735674947174486e-02   -1.176828748578711e-01   -3.222439990501050e-02   +2.961755756783632e-02   +1.641675514992096e-01   +3.219109587103445e-01   -1.531262378395951e-01   +1.387740698874995e-01   +2.102241419072268e-02   -1.490575445016293e-01   +4.494028912650876e-02   -2.017727911982908e-02; -4.459796629514309e-02   -1.610806629482634e-01   -1.846790412165108e-01   -2.958114738507852e-02   -1.749009906293663e-01   -5.450003394589220e-02   -7.090292525667086e-02   +1.245250182440120e-01   +2.724083293353800e-01   -1.403579415664173e-02   -1.754408688530142e-01   -2.392201294478883e-02   +1.284360226583232e-01   +4.939334465398726e-02   -1.186534537365347e-02   -1.798051807028087e-01; -3.963871121272872e-01   -2.147940533918321e-01   -1.226272743952417e-01   -4.824641803353460e-02   +2.907419841489595e-02   -9.037922028518446e-02   -1.740471506072650e-01   -3.153206902881222e-01   +1.352235478621678e-01   +4.572660631281784e-02   -1.089802278837213e-01   -1.680777969189180e-01   +5.462662783158258e-02   +1.736910603850637e-01   -2.703922486166251e-02   +8.911094661021375e-02; -2.283773237821822e-01   +7.093959551274259e-03   -5.266939796419222e-02   +7.856868895656394e-02   +2.329567697763479e-01   +2.464453281647388e-01   -1.722440451089466e-01   -1.348924278204089e-01   -7.798915561687170e-02   -1.074701078378799e-01   +5.533613271668874e-02   -8.006378857618607e-02   -1.393981710681319e-01   +1.786694210038896e-01   +3.789404506154093e-01   +7.091524687427547e-03; +1.075666713707035e-01   -2.496227266785564e-01   -3.285874707805849e-03   +2.483156992626450e-01   -1.433398587620453e-01   -3.254936144929939e-02   +3.062078265411129e-01   -1.160860990138711e-01   +1.592361004758992e-01   -1.880414037035815e-01   -2.635054610744296e-01   +2.928032295493448e-01   +9.687861254972620e-02   +2.455698491854183e-01   +7.602240396166281e-02   +2.024840890495316e-01; +8.130359099185239e-02   +2.666493730653033e-01   +6.162735900676781e-02   +1.952788986343143e-02   -3.002381288737143e-01   -2.707173066663238e-03   +9.882836800919670e-02   -1.254057563792185e-02   +2.709837972666447e-01   -2.465843309621706e-01   +5.694994835519038e-03   -4.156804462665223e-02   -2.397395393955818e-01   +6.624501653482838e-02   +3.341556121965814e-01   +1.368236985327622e-01; -1.728023041846929e-01   -8.670431949126019e-02   -2.216680418021207e-01   -6.207362285648656e-02   +6.770927571003832e-02   +2.194749071436371e-02   +1.960272630254708e-01   -1.569158931689492e-01   -3.356827672422737e-01   +1.878005388229117e-01   +2.754853562975904e-01   +3.361633790852165e-02   -3.398791290145566e-01   -3.905164338422133e-02   -1.194049431236054e-01   -1.836230315098893e-02; -4.905862061569774e-02   +3.360702281128401e-01   +2.802295260491287e-01   -9.550718000393624e-02   -1.795023032545859e-01   -2.956724541697110e-01   -1.023418701845163e-02   +8.216341505971894e-02   +4.312629461132851e-02   +1.904525685207174e-01   -1.069923740400758e-01   +3.824695913989208e-01   +3.765606023123643e-01   -1.482036653191318e-02   -3.865911634216086e-01   +3.222635261211533e-03; -1.850772949438236e-01   +2.992302272086455e-01   +9.575812408622722e-03   -3.262193140036892e-01   +6.322856903384295e-02   +3.331114455964435e-02   +1.380172425667727e-01   -2.915586270188179e-01   +2.906494606179715e-01   +1.166603539570526e-01   -4.407850640432864e-03   +4.801222285462024e-02   -2.777600243964535e-01   -2.199976418866194e-01   -9.624819407486748e-02   -2.943914971958748e-01; +5.419832514564654e-03   -2.483775854616570e-02   -2.519137317507434e-01   +1.813798135412825e-01   +1.922981770440824e-01   +6.666142139802227e-02   +4.298566517768474e-01   -2.987742645505199e-01   -3.711335502905726e-02   +1.099378322674937e-01   +1.179056717829590e-01   +6.641967566041408e-02   +4.704717557914944e-02   -1.033648289013047e-01   +5.851347295579259e-02   +1.164186097764823e-02; +2.684649758090095e-01   -1.892815151228640e-01   -9.989767837176565e-02   -5.574412661026418e-01   -2.068811901261458e-02   +3.339016999778469e-02   +2.053107295449727e-01   -4.924981795350647e-02   +7.883731424142840e-02   +6.573152497699263e-02   +2.993959232210621e-01   -2.500001923045427e-01   -3.309513904007212e-01   +2.459644810049872e-01   -2.641368963496519e-01   +3.774011631620416e-02; +5.037833759355154e-03   +5.266496290290994e-02   +3.727375871386460e-01   -1.304833205118260e-01   +9.259532902658568e-02   +2.858209995983731e-01   -1.308891120781597e-01   -8.886771920446884e-02   -5.978606359846955e-02   -4.839069488258643e-02   +1.541781361545203e-01   +1.657569292686563e-01   +1.617122105922266e-01   +2.404934373824003e-01   -9.422838767387529e-02   -1.742880054440729e-01; +1.678461070162581e-01   +2.695439282266240e-02   -1.444441348766142e-01   +1.300906244827413e-01   +5.958056439985135e-02   +1.314786487049815e-01   +1.666679733727224e-01   -1.034050996305994e-01   +2.422561357166283e-01   +1.368029722461553e-01   -4.207149249190944e-01   +1.063188136764762e-01   -9.714903305505153e-02   +1.196628990314979e-02   +1.386306980534291e-01   -2.485350428176253e-01; +8.233554708447033e-02   -1.731689594571901e-01   +2.708210358024063e-01   -9.705474615796424e-02   -6.349045379770904e-02   +3.664438734415591e-02   -6.206691165031147e-02   +2.500625548964473e-02   -1.269128439916987e-01   +1.613507213294126e-03   -9.385324868079122e-02   +1.335928800356724e-01   +2.347769656845711e-01   +9.624131522435721e-03   -1.615948288635262e-01   -1.415354452827462e-01; +1.222244488205501e-01   +1.787071690555208e-02   +1.138567912154807e-01   +1.372713198067287e-01   -1.853009590493352e-01   +2.111194242183477e-01   +2.573250821883934e-01   -1.029417121132058e-01   -4.722815020324450e-02   -3.153758800334586e-01   -4.954506844315641e-02   +1.321510657128421e-01   -2.732470441118960e-01   -3.764446179843779e-02   +5.773866347414398e-03   +3.066343949177341e-01];
L1E_L1I_iGABA_netcon = [-1.738941249077562e-02   +1.931882881659246e-01   -6.700633181583171e-02   +2.608292482644627e-01   -6.265310165757135e-02   +2.240318026490234e-01   -2.896291969313976e-01   -8.911301310321187e-02   +2.522866452814315e-01   -2.140424798499522e-01   -9.191370219437517e-02   +4.093609966302544e-02   -1.260631602360409e-01   +2.343545379787534e-01   +6.087677732307399e-02   +2.189320311650874e-02; +8.295646260203868e-02   +1.751557455107197e-01   -3.065390443573730e-02   +2.538829290335719e-02   -2.819109588820856e-01   +1.684911790507988e-01   +1.860848741031683e-01   +4.818100727828864e-02   +1.081436431222289e-01   +8.427671918719298e-02   +9.492007673316363e-02   +7.751108114541444e-02   -1.794724387796347e-01   -3.817640048303867e-01   -1.189278601881086e-01   -1.948126809944791e-01; -1.086724965960645e-02   +1.953007826450019e-01   -8.996940002153993e-02   -9.821311081920633e-02   -3.985429770931581e-02   -1.092710602179277e-01   +2.805426042711821e-02   -1.282660292388682e-01   +1.217174383298420e-01   +3.458387662039052e-02   -2.312806488344159e-01   -1.220434100972271e-01   -9.742698840761246e-02   -2.143878176493766e-01   -3.021155562292570e-01   +3.655617296882361e-01; +2.560062144191098e-01   -3.328109328056758e-01   -1.707838752711041e-01   +1.848876537571131e-02   +1.450356594630238e-01   +1.171877643800810e-01   -2.065540714007253e-01   +2.080119922902997e-01   +9.399572078155724e-02   +7.809244593356218e-03   -1.946978561674701e-01   +6.741467042234559e-02   -9.268343461915841e-02   +1.643217131321681e-01   +2.195569354649163e-01   -4.290444608372639e-02; -2.432198090160772e-01   +1.131651550938692e-01   -2.199245744772933e-02   -4.943338827892221e-02   -3.963683261576882e-02   -1.053951270051291e-02   -1.421199517975247e-03   -1.603105081211389e-01   +1.553029322421002e-01   +1.562132775058478e-01   -2.777858782107632e-02   +7.237514994664042e-02   -2.653765965218171e-01   +6.891671785505439e-02   +2.371734768761584e-02   -2.351160751692389e-01; +3.817978516263904e-01   -3.139553852199483e-01   +2.235232088552305e-02   -1.915778253378905e-01   -2.108712068827863e-01   -3.834528104478833e-01   -3.302922394140387e-03   -1.293284406996338e-01   +1.120660474808393e-01   -1.025415916044363e-01   -3.890004425178027e-02   -1.387731691309468e-01   +8.113082243114467e-02   +3.321038741106557e-01   -4.729172529255064e-02   -2.495446225590171e-01; -6.300346129178527e-02   -2.479389048075440e-01   +2.264811529725922e-01   +7.227772284766378e-02   -8.952409392568511e-02   +2.435333160266985e-02   -2.193371239251892e-01   +1.474488030025545e-01   -2.525142468920112e-01   +1.353101526110191e-01   -2.684304437580689e-01   -1.225223692176944e-01   +3.386136912246859e-02   +1.648559965159262e-01   +1.561724674643056e-01   -1.024359436191126e-01; +1.115610305448538e-01   -6.093392182866036e-02   -1.372035642555134e-01   +1.109900398017557e-01   -1.550094546516093e-01   +1.972505797941185e-01   +1.504685772762271e-01   +8.453082760063968e-02   +8.098132046230749e-02   -8.359095503739623e-02   +2.554834485260775e-01   +3.367482323507013e-01   -2.975617873816091e-01   -2.033204784450338e-02   +1.332455898798003e-01   -1.315453119969259e-02; -2.180688064614400e-01   +1.826438370132788e-01   -3.295810584983831e-02   +3.113083849932337e-01   +3.996529130458473e-02   -5.756463826234327e-03   -6.947720827741394e-03   +6.922041447380972e-02   +4.560800594572323e-02   +3.910040070689449e-01   +6.853189091053828e-02   +2.512479818929605e-01   -1.808241873077305e-01   +1.624347916428815e-01   +1.093654105048582e-01   +1.171250088979827e-01; -5.896100715965930e-02   -1.552498630768423e-01   -4.710051139272525e-01   +1.374272330544976e-01   -7.904821868529238e-02   +1.018036769501689e-01   -1.411454015789308e-01   +8.064773616710882e-02   -1.417182684753276e-01   -1.546117566958576e-01   -3.641855214054407e-01   +3.868751556549681e-02   -1.312170668544745e-01   -5.793386128975262e-02   -4.401603092287923e-02   +3.172142574576867e-01; +1.642378990022580e-01   +1.332497916493291e-01   +4.977462149068705e-02   +1.277308932529330e-01   +3.331931093890112e-01   -7.168142396952912e-02   -1.920434080352572e-01   +1.816285836860492e-01   +1.165267702814358e-02   +4.974149489038063e-02   +2.247091421401039e-03   +1.570981515031550e-01   -3.213542798897927e-01   +1.528953666470872e-01   -1.902316674816711e-01   -2.163796943156604e-03; -2.510477917891406e-02   +2.401841834090929e-02   -2.138990708591203e-01   +1.399847333565296e-01   -2.703388319667532e-01   +3.206684324347660e-02   -9.000058909930511e-02   +4.606388024298526e-02   +2.553558912623288e-01   +9.657082638417233e-03   -1.568773971164445e-01   -3.973241979212366e-01   -1.548376895855866e-01   -1.500635868884265e-02   +1.996857359372811e-01   -2.128703708172648e-01; -1.709018187597996e-01   +2.401131607132742e-02   +2.199663297692423e-01   +3.132946853182730e-02   +3.153838407580870e-02   -3.055982388718733e-02   -1.089022765300512e-02   +3.216917353932175e-03   -1.918396423552748e-03   -3.003508505130460e-01   +1.504512090248949e-01   +2.501317876660071e-01   -1.794958157750605e-01   +2.428437037513559e-01   +1.389052947060631e-01   -2.423989730842208e-01; +3.183814400509993e-01   -1.837385817297085e-02   -1.236501122464263e-01   +2.219617312846517e-01   -1.207113498038422e-01   +1.767964656233565e-01   -3.304468222867414e-01   -1.658326291311141e-02   -1.021780419134967e-01   -4.590123353866138e-02   +2.167862998459980e-01   +2.134313496592800e-01   +8.742569031836411e-03   +4.306902777951404e-01   +1.384197251578004e-01   +1.987741852605718e-01; +2.198100971739355e-01   +2.583790581310239e-01   -1.825951449231950e-02   +2.942198474530634e-02   +1.861900324682011e-01   +1.276056519268071e-01   -1.135156906047053e-01   +2.185145169794788e-01   +3.590872030757813e-01   -8.434011456547255e-02   +6.187618112549371e-02   -2.966008009483219e-01   -4.706144675598747e-02   +1.331964230591703e-01   +1.543489285307436e-01   +1.023817552139093e-02; +3.269855384272893e-02   -6.432767605485140e-03   -2.488958985497573e-01   -3.267222484428815e-02   +2.822842402856962e-01   +8.318506290943020e-02   +1.925145565027666e-01   +2.249826674070772e-01   +2.334760338533821e-01   -1.657301348818167e-01   -1.451864687227802e-01   +2.358435894682603e-01   +2.612031002733998e-01   +1.058367307465784e-01   +5.785117426796928e-02   +1.184827645595096e-01];
L2I_L1I_iGABA_netcon = [+1.697513934268421e-02   +9.453978761191681e-02   +2.555044436387454e-01   +2.088747976051558e-01   -2.459862076443947e-01   +2.184362855470801e-01   -4.516949440469810e-02   -9.127283097376129e-02; -3.547335409038412e-01   +1.405641641101616e-01   +4.602704007670066e-02   +2.069361867823606e-01   -3.201882466145733e-01   -1.774885998360565e-01   -1.882793618759344e-01   -1.772424384297528e-01; -7.372967357823834e-03   +1.513555942659826e-01   -2.360499999490402e-02   +9.319202480510433e-02   +3.600164964671619e-01   +5.765398919576826e-02   +1.448443945254307e-01   -1.846711486747006e-01; -2.445314514690934e-01   +1.801850497487549e-01   +4.279410650150032e-02   -2.293259051666998e-01   +1.632318767040981e-01   -2.361762473729845e-01   -1.673961088383133e-02   -3.243990587913947e-01; +4.577782606104228e-02   -2.303220860196689e-02   -1.480356316776577e-01   +1.403593239029018e-01   -1.531783777533945e-01   +2.971677195115542e-01   +1.443834869002689e-01   +2.900405503601113e-01; -1.100269833321649e-01   -1.710119254769633e-01   -2.469744985187505e-02   -8.452010022314949e-02   +2.320075659258204e-01   +8.356656920563812e-02   -3.323542809453525e-01   -1.065152780105730e-01; +3.014566856538620e-01   +1.396400761622845e-01   -2.878036849119323e-01   -2.014106957993368e-01   +1.143065240561791e-01   +1.479244716429895e-01   +6.592072945495450e-02   +1.739647146010373e-01; +4.040364545787044e-01   +7.121842735892257e-02   +7.032313572066493e-02   -3.566128372051862e-02   -1.134259047784746e-01   +4.066213815312812e-01   +6.910450495908542e-02   +7.413412617730994e-02; -1.130162531764111e-02   +3.945628503177955e-01   -6.036885399538790e-02   +2.521018424689507e-01   +2.400455860014658e-01   +2.361715551992962e-01   -1.950181730906492e-01   -6.708677139955460e-02; +1.951230309260922e-01   -1.420148994090405e-01   -4.598082063780437e-01   -2.323389993539234e-01   +1.665415593589328e-01   -1.081438318272422e-01   -1.488320717216056e-01   -1.287652486986475e-01; -1.404621208665484e-01   -1.219801044929036e-01   -6.147206563755457e-02   +2.085358572138397e-01   +3.498426110797240e-01   -1.006669312117429e-01   -3.250451919464244e-01   -1.903087187770285e-01; +1.769451237094717e-01   +3.281459739015240e-01   -2.236072755981006e-04   +7.302886555023942e-02   +4.079970886618260e-01   +3.821541883175843e-03   -2.236154624897652e-02   -1.759553444581492e-02; -2.135563522502584e-01   -7.824923539601825e-02   -1.741787220488208e-02   +2.782739561309581e-01   -2.423320136262617e-01   -2.210469626873667e-01   +6.733729816297870e-03   -1.671328494767508e-01; +2.062043397536388e-02   +1.845471175192518e-01   +3.032078441612117e-02   -4.026874355314320e-02   +1.443200198123976e-01   -5.708251695355553e-02   +3.005332472910266e-02   -1.287751300046820e-01; -3.842410229402825e-01   -5.732217921930098e-02   -4.027504842257195e-01   +2.902981144079779e-02   -4.651761103752462e-02   -3.565686106114072e-02   -2.041914157827036e-01   +5.480084632478731e-02; -9.842284327952057e-02   -4.294522169882304e-02   +2.375821501553021e-01   -3.931020088351111e-03   +1.488141335018243e-02   +6.890674800768405e-02   +4.378404315030564e-02   -1.592335631537295e-01];
L1I_L2I_iGABA_netcon = [-2.206390029643599e-01   +1.871534976091969e-02   -3.415580205989270e-02   -1.542131317043003e-01   -2.319672414023728e-01   +6.478328934648497e-02   -3.116273398208868e-01   +1.615285381040072e-01   +9.714917545367276e-02   -4.104319586367762e-01   -2.373053269402381e-01   -1.448805087283193e-01   -4.236235418810810e-02   +1.893528845223333e-02   +2.249001277788245e-01   +4.348887736299813e-02; -3.694467779662466e-02   -1.077579770850367e-01   +2.291710934903163e-01   -2.838525411794009e-01   -3.182765390138912e-01   -2.651020312782029e-01   -3.082304906115174e-01   +4.940815995300070e-01   +1.587708567674946e-01   +4.129156598091074e-02   +4.918984632897977e-02   -1.004157517315303e-01   -1.240849849084699e-01   +2.214094483324754e-01   -1.903475977982482e-01   +5.173617086240853e-03; -2.163462852188544e-02   -3.627441997819080e-01   +9.096857209807113e-02   -1.265899335788591e-01   -1.203340660202006e-01   -2.539067232538994e-04   -1.934137601621014e-02   +1.804661906319279e-01   -4.737168829718572e-02   -1.435371482490881e-02   -1.367306672995390e-01   -5.222714611074423e-02   +2.218777513908629e-01   +1.536003055557973e-01   +2.231282930103288e-01   -2.907303231666987e-02; +5.812348563598359e-02   -2.590921655589240e-02   +1.483412631185528e-01   +6.594335894048485e-02   -1.785471302497569e-01   +3.829092719129185e-02   +6.130696163776923e-02   -9.057913813209456e-02   +1.476929886684364e-01   -2.955220412100899e-01   -1.184967022218181e-02   -1.614122852296477e-01   +3.681605878511591e-03   -8.379797838078423e-02   +1.612086580030874e-01   +1.596463605705774e-02; +1.188397714707133e-01   -4.949894068661650e-02   +4.024112494626879e-02   +8.425953128250516e-02   -1.134477085994457e-01   -3.602051383299980e-01   +2.494298669272978e-01   -1.475572569953632e-01   -3.419807171662974e-01   -8.162334152417713e-02   -3.514147209911294e-01   -1.493211089642915e-01   +3.909304701033470e-03   +1.230913073369769e-03   +5.633483319361879e-02   -1.101352519907070e-01; +5.026811570429131e-02   +4.519319197204459e-01   -3.751957324318741e-01   -2.960795406660541e-01   -1.528044189530441e-02   +2.545247122410633e-01   +2.197752758397435e-01   -1.223889719706672e-01   -2.390120238770419e-01   +1.241774488321362e-01   -6.119227437206513e-02   -1.339295954094256e-01   +1.809150488038884e-02   -2.715403244298139e-01   -3.333547801040794e-01   -1.860928504003184e-01; +3.663919915255549e-02   -3.943652949397226e-02   -1.427899449510130e-01   +2.857218389997488e-01   +1.072606705198668e-02   +7.402476100800910e-02   +6.701321510457336e-02   +3.220060943448544e-01   -1.508168941017019e-01   +1.685683400533660e-01   +9.759057478562980e-02   -1.572005860974187e-01   +6.975853152167970e-02   +1.279281292067442e-01   -9.486433537793829e-02   -9.376448240304228e-02; -3.230118084407805e-01   +3.091698730801952e-02   -1.709665559957069e-01   -3.505210939979603e-03   +1.347331839250041e-01   -3.342725257452785e-01   +2.382630388444781e-01   +9.299350663409517e-02   -1.300156751195383e-01   +1.369464894374117e-01   -1.427588255956352e-01   -1.204088206631280e-01   +1.123676424895353e-01   -1.889005380420074e-01   +9.915363521991134e-02   +1.402937843804759e-01];
L2E_L1E_iAMPA_netcon = [+1.291328472486782e-01   +2.144346996882388e-01   +1.111014187459246e-01   -2.904222372589264e-01   -7.858105568617914e-03   +1.431490623484659e-01   -1.769244543531996e-01   -2.515216504064750e-01; -3.587111412641697e-01   -3.845901257120475e-02   +1.482002515411179e-01   +3.581622881728476e-02   -1.396711478254083e-01   -2.021133138566623e-01   -7.555725307328566e-02   -7.983580167810478e-02; +3.331898796874928e-01   -1.590147113235262e-01   -3.410575295703198e-01   +1.384854406292185e-03   -1.463847113446008e-01   -2.505502792105386e-01   +8.995714710342695e-02   +2.242310086606775e-01; -2.508973998626294e-01   +7.958179188616510e-02   +2.744479071493485e-01   +2.024742138649269e-01   -1.039105725079099e-02   -3.556845805122607e-01   -5.025312706284662e-02   +1.352425510521637e-01; +1.704489450618591e-01   +1.379192154658374e-01   -1.925934128272700e-01   +2.657943528838707e-01   +6.192420864343832e-02   -2.962506003683405e-01   -1.384428621340422e-01   -9.286053348075286e-02; -2.506392950610626e-01   +3.472513431452759e-02   +1.944880174972703e-01   +1.672967361752718e-01   -3.583281827972518e-01   -5.763165546583738e-02   +9.424954321689535e-02   +4.445262044009343e-03; -2.332437271338513e-01   -5.234192317036132e-02   +1.564471046142618e-01   +2.184615813891325e-01   +2.369327729802029e-01   +1.327918290491710e-01   +3.005848660297695e-02   -1.998384605342703e-01; -1.645188266585838e-01   +9.829116859354173e-02   -1.146176913881492e-01   -2.896424993562694e-01   +2.532169303629894e-01   -1.407518626447570e-01   -1.513930974698333e-01   -4.268372989439426e-02; +2.681143031293920e-02   +1.025910444701385e-01   -1.204379042734967e-01   -2.207492710068227e-01   -7.989063173658584e-02   +1.062311963143154e-01   +2.373194089850221e-01   -3.829299139843965e-01; +5.215586022583230e-02   +2.608523583553599e-01   -4.822980907858799e-02   +2.219417778684994e-01   +3.973671964351962e-01   +2.869904879191872e-02   -4.570156267758312e-01   +1.800632159016691e-01; +4.987339468929538e-02   -1.929226207116208e-01   +3.487883235404978e-01   +1.394314764055706e-01   +3.707935630078613e-01   +9.232828053951217e-03   -3.320979919762652e-02   +1.574833235295535e-01; -2.073416276841088e-01   -1.184795825484061e-01   +2.006665953110082e-01   +3.862418350172041e-02   +8.833122013817786e-02   -1.229065445944199e-01   -4.494851352653033e-01   +6.792889383131416e-02; +1.771919066050541e-02   +1.777244024505881e-01   -1.201452953326095e-01   +2.653465568713734e-01   +1.225819708466542e-01   -1.453982946945814e-01   +2.759861320322562e-01   +5.113778539712684e-03; +5.630109983607370e-02   -1.783903824207957e-01   +2.892221622507263e-01   -1.096639620947113e-02   -1.970984578767174e-01   -1.961636425379928e-01   -7.268614353452504e-02   -2.600969282747240e-01; +8.408337310874933e-02   +1.030938921731711e-01   -3.613189829000178e-02   -9.102620857622062e-02   -9.473409087722359e-03   +1.801560723444347e-03   +6.056103326094544e-02   -3.091557650590316e-01; -4.525064487084027e-02   -3.721205116284594e-01   -6.373109222450522e-02   -2.964853044892099e-01   -2.423921864445118e-01   -1.110125539843190e-01   -4.869230983293371e-02   +2.995229539727422e-01];
L1E_L2E_iAMPA_netcon = [+2.286174336613210e-01   -1.407468958597352e-01   -1.470870278669890e-01   +3.379671022009384e-01   -1.664237695951643e-01   +2.630723881356570e-01   -7.050484129912057e-02   +1.739025934284201e-01   +7.499262336251247e-02   +1.239632508976687e-01   +1.580363654148208e-01   -1.249049570327115e-01   -1.523169521275241e-01   +1.143777497685972e-01   +1.481068483873208e-01   -1.856077388634091e-01; -1.027916284587486e-01   -4.103661003984766e-01   -3.372592750903677e-02   +2.196372337216207e-01   -1.503302823430396e-01   +2.913793419926131e-01   -9.726889095179603e-05   +1.797627981215918e-02   +2.010590580748321e-01   +1.458635732302731e-02   -1.131812157607595e-01   -4.645880514732673e-02   +1.428433106265841e-01   -2.726271016580759e-02   +1.548635644389688e-01   +7.582399915736025e-03; -4.273386030980731e-01   +2.993559223113114e-01   +2.292389303524331e-01   -4.466556481736635e-01   -6.366172125028423e-02   +1.019598803123974e-01   +5.509434818877212e-02   +1.066531625758382e-02   +5.215395599440907e-02   -8.530626289616569e-02   -1.569195445563861e-01   -5.217034822001457e-02   -2.415536050514626e-01   -2.830127589486545e-03   +7.094791462693274e-02   +1.423315656850205e-01; -1.270937460028063e-01   -2.489191307662687e-01   -1.253027099003992e-02   +2.653856938166337e-01   +3.033639363469955e-01   -1.787158417811298e-01   -2.622858973545153e-01   -1.081531584429506e-01   -1.381802448025762e-01   -5.202374861498014e-02   -2.105475222846088e-01   +1.060928214622844e-01   +1.394010436436321e-01   +3.505289445015153e-02   +5.281961374669408e-03   -3.001064363451462e-01; -3.060663750771553e-01   -1.430748984231578e-01   +1.223046448451623e-01   +6.373027641536416e-02   +1.623386749938045e-01   +1.608598958783360e-01   -1.781442642611408e-01   +9.378735054229220e-02   +1.236104886874326e-01   +5.437000580616078e-02   -2.024037065338566e-01   +8.650539686109698e-02   +2.735506530817278e-02   -3.982756378210353e-02   +1.286944980790327e-01   +2.374906432409691e-01; +9.258787838354185e-02   -1.440646458799994e-01   +3.509322427781575e-02   +1.761874939927318e-01   -2.186126727903399e-01   +2.157340061079394e-01   -1.745942255253657e-01   +1.251044109576653e-01   -2.099864949150520e-01   +2.787594419197692e-01   -1.797879605775015e-01   +2.212450415411925e-01   +3.113031114665359e-01   +1.485544110387036e-01   +2.010636966671995e-01   +6.455546045295371e-02; -2.600876926074186e-02   -1.111146370329392e-01   +5.984404184102973e-02   -2.949024440435617e-01   +1.855789753878742e-01   -2.455353830428971e-01   +3.511733875223794e-02   +2.178599110866045e-01   +4.157110172523407e-01   -2.063358436022041e-01   -4.941004254357788e-02   -1.296187118382220e-01   -2.639431781661967e-01   -4.391335184664480e-01   -9.835866928032722e-02   -1.404103343092701e-01; +1.957488087707178e-01   -3.636643559094041e-02   -1.032688422425482e-01   -3.750775486475191e-02   +8.813062324645160e-02   -2.035406333174035e-01   -2.259142337090973e-01   +8.278527552871490e-02   -5.320032131353994e-02   -5.837689149610309e-02   +2.678720844895023e-01   +6.474008200369086e-02   -1.547471689186006e-01   +1.075711093599835e-02   +2.359635736395773e-02   +4.760604105745322e-02];
L2I_L2E_iAMPA_netcon = [-1.178065391931573e-01   -1.354096665228548e-01   +1.328909683472496e-01   +2.060368956230950e-01   +4.093728850200379e-02   -1.146204503147828e-01   -2.270930422182472e-01   +1.721831717297119e-01; +1.184056593254294e-01   +3.194837926310231e-01   +1.095645567521136e-01   -1.669264793378962e-02   +1.864951325122523e-01   +3.055964075368418e-01   -2.752291921467353e-02   +8.286826612725839e-02; +1.387722367397340e-01   +7.520048058576839e-02   -5.836226462015716e-01   -2.472637532563177e-01   +8.646420711018568e-02   +2.515539465134028e-02   -2.364905205283143e-01   -8.355258987882902e-02; -7.901044681414893e-02   +1.999723758711560e-01   -1.702915810398768e-01   -5.172706611624381e-02   +1.850784431067646e-01   +1.192684424389245e-01   -4.069370174446522e-02   -4.135476273998732e-02; -1.689218902895492e-01   +4.883733716653963e-02   -2.848500046249753e-01   -2.023222382621495e-01   -6.515747263849692e-02   +2.728328408646244e-01   -2.044884035427075e-01   -8.543563274235028e-02; +7.869141436695484e-02   -4.542853183411699e-02   +1.303553324302405e-01   -1.689684521411683e-01   -1.005463867986409e-01   +3.464727866067767e-01   -2.897964558281244e-03   -1.858300990071830e-01; +1.560864952990546e-01   -1.267638839477882e-01   +3.454380718191205e-01   -1.088808570893209e-02   -1.180622391356549e-01   -4.780180142584889e-02   -2.620378140622998e-01   +3.836250160038862e-01; -2.360035883522127e-01   -5.203322816834928e-02   -4.190774861652576e-01   +2.866779986247410e-01   +2.406179712327153e-01   +1.550043600494957e-01   +2.364999705787926e-01   +4.168213111721723e-01];
L2E_L2I_iGABA_netcon = [+1.482940352266137e-01   +2.156590740410745e-01   -1.219196839633726e-01   +5.979548474453374e-02   +2.016097925928212e-01   -2.546058757192521e-04   -1.748925199176611e-01   -2.355014957469821e-02; +2.598036336127755e-01   -1.270039165720665e-01   -5.202230955935701e-03   -1.878442416895759e-01   -9.134454078962548e-02   +6.386437949941751e-02   +2.614063641979651e-01   -1.136343853762703e-02; -2.422660186634707e-01   +1.768215226443686e-01   -5.878504914421168e-02   +2.191293333280922e-01   +2.159295812361970e-01   +1.531465524679110e-02   +2.092150108653152e-01   +2.304935598858370e-01; +2.431221555074475e-01   -1.431556631275735e-01   -2.770482551778007e-01   +4.206717982654401e-02   -3.514402541080865e-02   +4.217696002778859e-02   +1.461833020280272e-01   +1.676044724136060e-01; +8.295835558062847e-03   +1.903591648516157e-01   -2.291843941844780e-02   +2.893537863655989e-01   -6.487885119820742e-02   +1.524179645357558e-01   +2.667162098700247e-01   +2.491451459448469e-01; -1.442707321190410e-02   -4.276142590020812e-02   -8.289982381222613e-02   -1.966678161332296e-02   -1.675178541511384e-01   +3.600647631882485e-02   +1.949836950786061e-01   -2.513083638571865e-01; -1.917275272626293e-01   -3.293685540599803e-01   -3.331665700671740e-02   +2.475983359343202e-01   +1.209324345230529e-01   -1.048306034854922e-02   +3.046974876798606e-02   +7.052727653305968e-02; -2.613228595886821e-02   +6.495243186283139e-02   +7.554447912906866e-02   +4.384149359755923e-03   +3.371797005484447e-01   +1.042364792362755e-01   +2.073649383353350e-01   -1.061312221883950e-02];
L3E_L2E_iAMPA_netcon = [+2.647511421367591e-01   -9.211976209638006e-02   -9.781947062529334e-02   -1.204600187652550e-01   +2.118969444641466e-01   +3.189143964952372e-01   +1.575269569928006e-01   -1.829945662713495e-01   +1.723376759034558e-01   +1.587077738330121e-01   -6.042903560130881e-02   +1.498147135858818e-01; -3.465408161442893e-02   -1.146151305625615e-01   -9.812553075178349e-02   -2.348144291450992e-01   +2.498068103529470e-01   -7.709139606071849e-02   -1.648997681197899e-01   +8.925600019409098e-02   -6.525771911762407e-02   -1.639985347220911e-01   -1.842138886149325e-01   +5.151745641079735e-01; +2.322215350279295e-01   -1.404594374547280e-02   +3.260543531873004e-01   -1.673384506736176e-01   +1.562537430815895e-01   -1.089980207705265e-01   -1.480014474701791e-01   +9.261088289836714e-02   +2.772216077352710e-01   +2.956029071196196e-01   -3.252492552859549e-01   +2.570626168558033e-01; +2.646608608805876e-01   +1.600728906906813e-01   -7.176154843617431e-02   +5.909030915156445e-02   -3.017983988352378e-01   -1.954374870835408e-01   +1.115722845800571e-01   -1.092072944489818e-01   +1.430110643257847e-01   -2.062104773413439e-01   -8.187851759653846e-02   -1.431902150205924e-01; +1.600989736319841e-01   +1.415065349147698e-02   +1.941905650404881e-01   +1.184391297687986e-01   +3.310275522751377e-01   -3.334361055453553e-01   +1.772038945723872e-01   -3.499055063425470e-02   +1.142972240111880e-01   +2.415827713267386e-02   -9.720295256106820e-03   +6.034006585860650e-02; -5.606438018429447e-02   +1.356458285399018e-01   -3.510755391832301e-02   -7.412962609963879e-02   -1.876784225551361e-01   +2.180524041054285e-01   +1.412586034676324e-01   -1.327024173030627e-01   +2.461820686304815e-01   +1.088609005476994e-01   -5.364839501672362e-02   +3.000724603565135e-01; -1.316764545015296e-01   +1.588046120399954e-01   -4.008892888212289e-02   +6.184086200370281e-03   +1.736383447668699e-01   -2.737671928288262e-01   -2.510059511750871e-01   -5.056238409424781e-02   +1.682914754083648e-01   -3.745036033286143e-01   +3.890295405639477e-02   +3.608248531185720e-02; -2.462337689562883e-01   -3.811706033050197e-02   +5.565864581710380e-02   +1.072859362547053e-01   -3.715461467019114e-02   -2.081866707034676e-02   -1.372854681834455e-01   -7.744567735286952e-02   -7.485026298244535e-02   -2.609982793759150e-02   +1.564498509937918e-02   +1.540403881128538e-01];
L3I_L2I_iGABA_netcon = [-8.274171152541582e-02   -9.163266192695892e-02   +8.613409768956078e-02   -1.653708610653446e-01   +2.833917070476200e-03   +2.170271643465374e-01   -5.897141581546367e-02   +2.317194530389036e-01   -1.035814302754703e-02   +1.690969592413171e-01   +1.704515958552398e-01   -7.691461306939214e-02; -3.272087482205523e-01   +3.448946475781707e-01   -1.565117498053892e-01   -5.815582040853885e-02   +2.257351206589761e-01   -2.316330100300105e-02   -7.976618255315798e-02   +8.230963975851648e-02   +2.748398834489375e-01   +1.071368863818624e-01   +2.197602170778586e-03   -2.230848674620904e-01; +2.529689227975485e-01   +3.425935895391603e-02   +1.484391664025924e-01   -1.401213515614345e-01   -1.677941240527388e-01   -7.465097873168003e-02   +3.594398553952836e-01   +1.145646865192827e-01   +2.877650992589776e-01   -1.380879102540751e-01   -1.486386819774214e-01   -1.046264276455616e-02; +1.580298937027690e-02   +2.799244754576645e-01   +3.246809890139321e-01   -2.287321855465435e-02   +2.103501684665377e-01   -6.012881999091675e-03   -4.058397785992670e-02   +1.814120807838229e-01   +1.071695628876387e-01   +2.684072255983873e-01   -3.548679568538662e-01   +5.801908934662742e-02; -9.039480957161245e-03   -2.070004124126117e-02   -2.796577189987832e-01   +2.179639429285714e-02   -1.721983540037784e-01   -7.033364297270384e-02   +1.296794819533488e-01   +1.249404881130424e-01   +1.348186730749741e-01   +1.449325469202151e-01   -4.358098253203301e-02   +2.351193340595219e-01; -2.044592874182822e-01   +4.921305945718088e-02   -8.473321782995673e-02   +1.208801103621650e-02   +2.944774569753137e-01   -5.650726686737567e-02   -6.916770737108935e-02   +7.242729370033983e-02   +2.424549737410918e-01   +5.548276202914618e-02   +9.962083499081384e-03   -5.207541600586952e-02; -6.711729925914513e-02   -5.713117605094759e-02   +1.491407802585590e-01   -9.634447271520855e-02   +6.053091304515868e-03   +1.304777201649364e-01   -3.204182247977231e-01   +2.017507869086136e-01   -3.749111587020683e-01   +2.736123777822335e-01   -3.675395901883788e-01   -5.385792003753985e-02; +1.761098845730141e-03   +5.163503472656283e-02   -8.998396271405983e-02   -3.289047676631035e-01   +3.555489113649218e-02   -7.803012341960358e-02   -3.194677149413492e-01   -1.684634503111955e-02   -1.048540467736438e-02   -9.670362868794195e-02   +1.292005227174273e-01   -7.952493194614318e-02];
L2E_L3E_iAMPA_netcon = [-9.666359937001032e-02   +6.434352574683429e-02   +1.968222982207722e-01   -2.014701814621639e-01   +1.017183052921941e-01   +1.786941234928055e-01   +2.376095022144565e-01   +3.109062219979550e-02; -7.680479739695731e-02   -1.561173724974993e-01   -1.857936033796173e-02   -1.684184566288069e-01   +4.681441827043099e-02   -5.897229575219984e-02   +1.143294221022207e-01   +3.795925257687935e-01; +4.779016676572670e-02   +5.309662402994740e-02   +1.948930797338357e-01   -1.931502514134843e-01   +6.106108131408261e-02   +6.360101498234388e-02   +9.975353783438234e-02   -1.403089257618245e-02; +1.418303721272868e-01   -1.835156353927453e-02   +5.881698408347207e-02   -2.293710877649194e-03   -1.930457527867821e-01   -1.981669376636607e-01   +2.240758639394518e-01   +7.847328111044617e-02; +3.764630381576990e-02   -6.822721368565331e-02   -1.319878530524467e-01   +1.530075276679623e-01   +2.209346509213576e-01   +5.007734633635852e-03   +2.195755445119533e-01   +1.419347581772222e-01; -5.476565002167794e-02   +4.244800701514528e-02   +4.676088749339381e-02   +1.494842585755480e-02   +3.981663887856907e-02   -4.210035272298489e-02   +1.490977947966844e-01   -1.280768667274391e-01; +3.693896103943385e-01   +9.301146244542130e-02   +1.526558421133167e-03   +1.969705617359327e-02   -1.890534499458216e-01   -2.302232865418193e-01   +2.213083967724731e-02   +1.086502337856695e-01; +2.410567409486615e-01   +1.564332818865548e-01   +1.257484663022176e-01   -2.903333704908728e-01   -3.892494427206377e-02   -1.765295628859208e-01   +2.140317464571357e-01   -5.249942178348829e-02; +2.668654502892006e-01   -3.009762001999681e-01   +1.729586246184428e-01   +3.214009462230965e-01   +9.737401229404002e-03   -6.062735612328751e-02   -9.631001992432819e-02   +1.238325912533721e-01; -4.948906371692370e-02   +2.447487821009813e-01   +2.788455929755331e-01   -1.070296736629534e-01   +2.267408414256325e-02   -1.977924243508515e-01   +3.209506580051222e-01   -2.951595253700909e-02; +6.704320461740793e-02   -2.251721095961278e-01   -3.877780718235398e-01   +2.725398524750590e-01   +1.810891004325451e-01   +2.232768056649003e-01   +5.734639493237465e-02   +1.167744190912903e-01; -2.257948351351852e-02   -5.385949707388266e-02   -1.429648398620015e-02   -1.168093809122494e-01   -2.860029844368699e-01   -3.971405708646593e-01   -3.535582826203170e-01   -2.224983585726202e-01];
L2I_L3I_iGABA_netcon = [-3.488281216789168e-01   -5.332783391254019e-02   +3.019444976733318e-02   +1.136882109216133e-01   +3.330868466390384e-01   -1.904120146079784e-01   +9.501236229677334e-02   -1.216244363317028e-01; -2.065502922956436e-01   -2.816298833602168e-02   -3.132350570937925e-01   +3.989328929056078e-02   -1.038704152864274e-01   +4.248226985260323e-01   -3.643695048833310e-01   -1.146475549226679e-01; +3.940079209225061e-01   +2.024427021538301e-01   +1.317081752047470e-01   +1.174245442615695e-01   +1.866573688607640e-01   +2.414854752539141e-01   -1.769149195446588e-02   +2.144554037538848e-01; -6.281399787465750e-02   -2.537605111950894e-02   -9.320558247105259e-02   -4.610024887557371e-02   -3.475179216824472e-01   -1.112611501004939e-01   +2.928036406933828e-01   +6.875539719614493e-02; +2.422185868938322e-02   +1.412178482786204e-01   +3.261153580592105e-01   +1.038491478800583e-01   +1.292480731633960e-03   -2.193400344346684e-01   +3.371720334080238e-01   +3.840247412953357e-02; +5.670936895652066e-02   -4.203460001140405e-01   -7.426716042488292e-02   -5.364428259630981e-02   -4.813121897531196e-01   -1.741208092863191e-01   +1.578406424701169e-01   +1.065858062582739e-01; +1.644225524189590e-01   +6.112577590158710e-02   +7.424902582722809e-02   -1.553949520143054e-02   +3.130704779989305e-01   +7.000103816764042e-02   +3.549058626826559e-01   +1.558263854906912e-02; +6.043409848316873e-02   -2.633492861464964e-01   -9.399536763660665e-02   +3.347575544015226e-01   -2.308282306358553e-01   -1.750593514311794e-01   +3.363377631235758e-01   -1.296360964108698e-02; -1.379117715407478e-01   -1.264512917154307e-01   +2.077415041666408e-01   -5.660016464268493e-02   -2.528324537382447e-01   +8.187837095033841e-02   +1.224369494165475e-02   -2.548968622448216e-01; +2.287043685179525e-01   +5.784912978647762e-02   -7.740843738285832e-02   -4.142605166400481e-02   +2.126266542274830e-01   +6.791672526094306e-03   -5.233720139262037e-02   +2.379447581257444e-01; +7.035262216874541e-03   -8.476603765678994e-02   -8.598889229947683e-02   -2.292642348444700e-01   -3.062247893152155e-01   -1.441468150771167e-01   +8.020791260260775e-02   +4.510956958802301e-01; +1.351940995740129e-01   -2.425814612033556e-02   +1.153479116804423e-01   +6.653326390843679e-02   -1.171849280178985e-01   -6.172197297727859e-02   +8.594751956917993e-02   +1.002061247100562e-01];
L3I_L3E_iAMPA_netcon = [-6.731614827592086e-02   -1.586159405747678e-02   +1.055398992130943e-01   +3.471432236890293e-02   -5.645438834806447e-02   -2.382969383940116e-01   -3.026533679830689e-01   +3.166256880620442e-01   -4.459031319668740e-01   -1.147323526989356e-01   +1.872643812705303e-01   -4.510569069997319e-03; +2.225354508347396e-01   -6.551613676498363e-02   -2.489693370440786e-02   +7.790291170380344e-02   +2.675019102632298e-02   +3.128017314109910e-02   +2.278858774445530e-01   -6.757709834687470e-02   -5.796983690213529e-02   +1.900848841241483e-01   -1.378677730988949e-01   -6.304754950890556e-02; -2.104508422141035e-01   +3.924675864381614e-01   -1.002913809831833e-01   -7.473499166239521e-02   -1.401433902354115e-01   -1.224761030427985e-01   +3.178511219028112e-01   +8.515460071059805e-02   -5.796449917600954e-02   +1.351732588595826e-01   -1.859840501605564e-01   -2.712592091986068e-01; -1.019877966774736e-01   +2.430057978837523e-01   -1.999657058520738e-01   +1.236193220724939e-01   -3.772612612203780e-02   +1.251503260756399e-01   +8.908347674665055e-03   -2.138689609834031e-01   +2.408445780475837e-01   -4.057509536682604e-01   -1.806117856517978e-01   -2.184293691235084e-01; -1.133025909898292e-01   +3.259440134705126e-01   -1.897380080215448e-01   +4.194265785116307e-01   +2.175295736979272e-01   -2.873234753566725e-01   +4.574616404288038e-01   -6.135029533322257e-02   +1.711460733421563e-01   -1.981460242803459e-01   +2.775614860930072e-02   +2.789725474254580e-01; +1.103073150804292e-01   +1.657468552173463e-01   +1.787884044447310e-02   +3.255413896064675e-01   +3.786923785262267e-02   -4.200556711918142e-02   +3.754081813841375e-01   -9.448059200132838e-02   -1.935012806570668e-02   +1.268714691389203e-01   +1.515763027212891e-01   +1.100749284142557e-01; -7.569670270873085e-03   -1.394484463014593e-01   +4.134818931381986e-01   -4.065172577835219e-02   +1.090780003750487e-01   -4.040872009780628e-01   -3.171108133538955e-01   -1.969624822987548e-01   +8.402485521317035e-02   +2.888527399923203e-01   +7.245723725035930e-02   -2.254233034779105e-01; -6.606557695984834e-02   -3.786542814813179e-03   -1.049083894837665e-01   +6.536764911205944e-03   +4.151404897076379e-03   -3.931972901780112e-02   +2.044126496297646e-01   +6.884355309192873e-02   -5.653823913271266e-02   -4.001698381356222e-03   -1.377923353481111e-01   -6.251297685063353e-02; +3.182183312873653e-01   -1.212183227541146e-01   +8.090866760738347e-02   +1.041152922937193e-01   -1.331845332706410e-01   +1.290638051175194e-01   +1.175540014036642e-01   -1.434852123059016e-01   -4.940095354538807e-02   -1.811881267455135e-01   -3.188641289283423e-01   -5.129883604795452e-03; +4.099995207826571e-02   +1.235680051497905e-01   -1.873507685983341e-01   -1.004158940426996e-01   -2.319018516594456e-01   -3.150623160696943e-01   -2.087182270056538e-01   -8.103130186557483e-02   -1.394955682206422e-01   -2.638935744357307e-01   -1.717270524526416e-01   +2.532502765539735e-01; -2.535766352116967e-01   -5.041613900180877e-02   -7.685838451017037e-03   -6.757611582837210e-02   -5.869265776074842e-03   +1.400189524140429e-02   +5.702908451807349e-02   +1.363116930785732e-02   +9.523896057631660e-02   -3.252019941209913e-01   -3.610683198489810e-01   +5.879799094722302e-02; -8.637333468768840e-02   -1.283636247026635e-01   +3.026217726004348e-02   +2.670955238739720e-01   +2.233774061402542e-01   -2.514753607342963e-01   -5.313079209047222e-04   +2.918240273187669e-01   -4.299296955406167e-01   +5.512475747579863e-02   +5.438566281564563e-02   -2.628322658884366e-01];
L3E_L3I_iGABA_netcon = [-8.827717626507106e-02   -4.274562140131929e-01   +2.306014768212937e-01   +1.817648842696541e-01   -2.026427435269983e-01   +2.903028103599520e-01   -1.198104953437565e-01   +2.816431442617197e-02   +5.224984935089552e-02   +8.461209957005676e-02   +3.222994950315541e-01   +5.429725369064682e-02; +1.219493943039818e-01   -4.528517189665402e-02   -9.133854562386257e-02   -8.113372675423480e-02   +3.593887223154091e-03   +1.306263929334720e-01   +6.280580697747980e-02   +2.377633303609110e-02   -1.695074986396088e-01   +9.783412199086894e-02   -9.780563313219956e-03   -6.787649280777006e-02; +1.544654460429375e-02   +3.934847662497784e-01   -1.841292711016996e-01   +4.929397124833212e-02   +2.666930748118149e-01   +7.044410767371620e-02   +1.853708715013366e-01   +3.222002676711075e-02   +6.201857160759817e-02   -1.117642868998189e-01   -6.256551318041370e-02   -1.971632805042369e-01; -1.628809563813596e-01   -3.873849796021234e-01   -2.920995959623422e-02   -1.419818877631960e-01   -2.102395602461971e-01   +5.308104919482030e-02   -4.757112138006390e-01   +1.918623517073147e-01   +9.086681178274375e-02   +2.634817798558080e-01   +1.101581170268906e-01   +8.792183939452840e-02; +1.085257009819396e-01   +1.788304413058807e-01   +3.226425975072379e-01   +1.222019094577664e-01   +2.873470082244085e-01   +4.235073731896308e-02   +2.616619878648669e-01   +2.215619276186898e-01   +1.742246517382005e-01   -2.212107084336441e-01   -3.098255707760584e-01   -4.472932857887975e-02; +7.960085923184981e-02   +3.155213541040026e-01   +1.743132034158275e-01   -5.461175919148020e-02   +2.245436188810289e-01   +6.784404751059402e-02   -2.470530224630939e-01   +2.179435338566414e-01   +3.476346310942663e-01   -3.661822244751707e-02   +3.228865905163900e-01   -1.782595423138732e-01; -4.628617484080167e-01   +4.138289148292055e-02   +1.458909852759437e-01   +1.912057592211598e-01   +1.473799832885188e-01   -5.912830212013270e-02   +5.954266422003122e-02   +1.728734840112421e-01   +1.691588850776737e-01   +2.009757869323593e-01   -1.398018308634464e-01   -2.244276879340923e-01; -5.004746763028005e-02   +1.351852266705305e-01   -1.972214291455571e-01   +4.368940160470210e-02   -1.402822767660519e-01   -3.862545836830322e-01   +5.002014610911891e-02   -1.658662419512881e-01   -2.757433425818064e-01   +8.144161550337053e-02   +8.621993270000897e-02   +2.144312506261926e-01; -3.727786920851352e-01   -3.683595038112560e-01   +1.315767103311222e-01   +3.022326776043565e-03   -1.574735460937534e-02   -6.598287077918533e-02   +1.824888163938024e-01   +2.930544485958473e-01   +4.118617135691192e-01   -5.393750969727329e-03   +9.217009063901821e-02   +1.609670421254767e-01; +1.093013299473687e-01   -2.859075631241534e-01   -8.022433657077949e-02   -2.646476923300416e-01   -6.600621018897185e-02   -3.243133367452405e-01   +2.136733464857348e-01   +1.750684467282148e-01   +3.669846156966469e-01   +4.145848442018224e-02   -2.324006878249589e-01   +5.575833859138289e-01; +2.064439958107561e-02   -3.366720041852133e-01   +5.240989224059714e-02   +1.466791536392250e-01   -1.717620581786281e-01   +2.748464154760902e-02   +4.201874368671832e-02   +1.331741654865516e-01   -8.966603785330295e-02   -4.925824312357854e-01   -3.768471602318940e-01   -7.287591674364557e-02; -6.631261510262880e-02   -8.522938372301414e-02   +2.572084207102131e-01   -2.283223031403557e-01   -1.495706003370583e-01   +1.781645482845781e-01   +1.360715937402928e-01   -1.821255603226265e-01   +2.701810105918634e-01   +7.633803427436693e-02   -1.102013372564475e-01   +4.451115620165507e-02];
L2E_Input1_iAMPA_netcon = [-2.265960025720497e-01   +1.419572518352907e-01   -9.628041311806124e-02   +9.904071538622827e-04   +1.473718244867052e-01   +1.954275446130654e-02   -4.394033954584367e-02   -1.379607859991205e-01];
L2I_Input2_iAMPA_netcon = [-2.126608473907347e-01   +1.736659166820164e-01   +1.325468512694947e-01   -1.877987136249774e-01   -8.587062533247286e-02   -1.052289298767307e-01   +5.521905200072771e-02   +2.990522560138867e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
