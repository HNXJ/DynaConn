function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.418968903958806e-01   -5.610476827303976e-01   +1.257456357214725e-01   +1.343621050713996e-01   +6.377275742791758e-02   +1.931044955076085e-01   -3.726955242786066e-01   -1.000976525352976e-01   +6.705919913409076e-01   +5.524520137751449e-01   +1.943566518988536e-02   -5.873155442277638e-02   +4.560026768651589e-01   +7.897429852189292e-03   -2.818427157316102e-01   -6.184095454593697e-02; +3.220857377775644e-01   +3.135592727478377e-01   +2.419131431473889e-01   +1.130873685600828e-01   +1.671507973994566e-01   +5.673009212218005e-01   -2.304935497326686e-01   -3.486268909519016e-03   +2.238374402967257e-01   -1.558660280339280e-02   +1.654481996363211e-01   +1.996051782683317e-01   +2.830619616317462e-01   +7.082657727532418e-02   +4.615526897819332e-02   -1.427811805136027e-01; +1.880257031630566e-01   +6.278480776849323e-02   -1.195916320374810e-01   +3.024232469888706e-01   -2.790806831295644e-01   +3.108812831369061e-01   +6.161873451232999e-01   -1.495946246939928e-01   +5.011222793172779e-01   +2.026871570999524e-01   +5.349835280725391e-01   -4.935494313677173e-02   +1.357378868147651e-02   -4.299849264968787e-01   +8.164546418100832e-02   +4.266121653449104e-01; +2.617488824621493e-01   -2.476209025938165e-01   -1.399794830704398e-02   +4.611993723831797e-01   -4.128964048152458e-02   +6.289000132343943e-01   +6.582386755298308e-01   +5.622694483002997e-01   +1.774840502007272e-01   -3.246475044867638e-01   +3.857760624238761e-01   +1.050750043284388e-01   -2.624487592003631e-01   +4.266775476325962e-01   +2.238271466872180e-01   +9.499633193838961e-01; +2.414381661342944e-01   +1.300898513986574e-01   +5.764621391572784e-01   +3.997213177962382e-01   +9.668450876612625e-02   +2.264138825755774e-01   +2.462688571029521e-01   +1.581777179738220e-01   +1.411990131804965e-01   +5.760106958937656e-01   +6.489454586274019e-01   +1.559712322175475e-02   +5.415577293541817e-01   -6.340187068033608e-02   +2.354563936706031e-01   +2.545094364902808e-02; -1.152582149917948e-01   +9.678657610852589e-01   +4.550698777637864e-01   +8.293336362871953e-02   +4.152370893761434e-01   +2.862951313730702e-01   +5.715693689431504e-01   +1.934889617235379e-01   +2.360097415639272e-01   -5.444680906552182e-02   +1.178382753315481e-01   -2.215407340702715e-01   +3.175608530427195e-01   +1.387415377633295e-01   -2.141309065915708e-01   -2.347618977135836e-01; +1.510925136449072e-01   +3.135452357261863e-01   +7.106132500576633e-01   +4.715185888897785e-01   -4.562060509916420e-01   +2.068958588004764e-01   +1.141780151403256e-01   +1.919691592251095e-01   -5.934214568633349e-01   +9.806225780791741e-02   +2.907702913301058e-02   -3.479781732602501e-02   +3.106444256710580e-01   -1.756943566136176e-01   +5.526832766511688e-01   +5.633677162425215e-01; +5.755313874471525e-02   +4.185527734776682e-01   -1.835937092646502e-01   +2.203370657762330e-01   +2.433458269012292e-01   -1.138835596989750e-01   +6.132893854209431e-01   +2.911219122709147e-01   +3.019819401290663e-01   -1.495197492845718e-01   +3.345989305217780e-01   -6.585594988873729e-02   -2.407108559413300e-01   +7.748805426408895e-02   -1.151596071083261e-01   +1.358084195282683e-01; +1.683286960793672e-01   +7.801329434425369e-01   -2.728690954794404e-01   +9.609428150550541e-03   +3.447911456963625e-01   +3.665293810357317e-01   -1.594254159914746e-01   -1.976492831814467e-01   +2.218391874687494e-01   -9.931607307627779e-03   +3.118491033675517e-01   +5.670778305524225e-03   -1.685114649196406e-02   +2.673341901565755e-01   -5.895971498596561e-02   -6.115393778541026e-02; +4.981655606174846e-01   +3.522088827613653e-01   -1.202674206015026e-01   +4.192257525030738e-01   -3.322608110029539e-01   +7.794941168996425e-02   +4.815721737924468e-01   -1.460739695545878e-01   +2.050353573138647e-01   -1.455254452154963e-01   +8.385537486479796e-01   +1.839876999232791e-01   +2.576322472805120e-01   +4.382899491439085e-01   -7.415817082775800e-02   +7.172875576390912e-02; +1.517490883430024e-01   +7.546057912689366e-01   +2.052924190147844e-02   +1.367783642038208e-03   +4.196184616328180e-01   -9.162052873517607e-02   -2.135813069309599e-01   -9.077455822371440e-02   +3.065758033408563e-01   +4.756081629646882e-01   -2.298798926832049e-02   +1.320091246296563e-01   -6.333096099492523e-01   -2.441357575802957e-01   +3.406129862011514e-01   -3.572623741119011e-02; +3.113416030027885e-01   +2.785726700605488e-01   +1.534344112854040e-01   -1.873549579039633e-01   +1.059270850044783e-01   +1.774703175918346e-01   +2.786007975348921e-01   +8.951807870553184e-02   +4.083359599697481e-01   -5.587125176386466e-01   +2.759245162825613e-01   +4.832440632392509e-01   +5.669094058912908e-01   +4.096882287043236e-02   -4.406592050864936e-01   -1.446971943115795e-02; -4.248085801921985e-01   +2.380193726542982e-01   +1.283243826236905e-01   +3.726706088834258e-01   +8.710362959597870e-01   +6.907116834163451e-01   -1.561312660383521e-01   -7.062774497737544e-02   +4.291884190200763e-01   +4.454006949557245e-01   +1.429231379538020e-01   +2.519160869324574e-01   -2.852656957927988e-01   +1.094265629328443e-01   +6.530811526282275e-02   +1.650420687823442e-01; -3.756335224945055e-01   +5.088173742796136e-01   +2.018769369193150e-01   -4.759595915817481e-01   +3.186913089891507e-01   +3.273851717367191e-01   -3.001725478334316e-01   +6.046795622141739e-02   -1.694469089611104e-01   +2.672260582043721e-01   +7.594695418269823e-01   -7.983887911374465e-02   -8.215944652530230e-02   +5.283760931472696e-01   -3.320368568075596e-01   -2.291904650939016e-01; +3.266410560742982e-01   -3.114051635445636e-01   +3.907308807221942e-01   +2.310567876367521e-01   -9.767568272735210e-02   -6.280382218157098e-03   +1.584592773737366e-01   +1.477944676965198e-01   +1.773538956737465e-01   -2.690690921540327e-01   +2.911449485480246e-01   +2.778423106092911e-02   +7.833326483483297e-01   +1.879790916231276e-01   +7.555819785253431e-02   +1.086138256346684e-01; -7.668870319337765e-01   +2.947459200376130e-01   -4.117457045573767e-01   +4.267043036330520e-01   +8.288318914601264e-01   +2.397563062197153e-01   -7.358097214877519e-02   +6.836743720540329e-01   -2.677858380257488e-01   +3.076892117955655e-01   +5.085273546062402e-01   +1.053009335982442e-01   -1.915260996214175e-02   +2.065725729155637e-01   -4.669572853238499e-02   +3.484150996338645e-01];
L1E_L1I_iGABA_netcon = [+6.507448742262466e-02   +8.481524254753329e-01   -3.964771077674943e-01   -2.476880699556082e-01   +3.677342606068031e-01   +3.727158286244802e-01   +7.055933483243356e-01   +3.921312348666900e-01   -5.295399073330022e-01   -1.211790123754986e-01   -3.028716570123990e-01   +5.887987886169921e-01   +8.271394743344263e-01   -3.152305699352809e-01   +5.377390567935862e-01   +6.939490975519540e-01; -3.299497742406588e-01   -1.123080867416189e-01   +9.424570575568176e-01   -3.608492894595129e-01   +5.985462660424901e-01   -4.202286589113101e-01   +6.633816252341005e-01   +5.796194859734607e-01   +2.999505577656605e-01   +3.095687674383916e-01   +3.920222445145086e-01   -1.936241704963031e-01   +4.946009872719322e-01   +4.960003736622941e-01   +6.093611621489131e-01   -9.707900663531369e-02; +5.457222834684804e-02   +4.601126711115135e-01   -2.658374965929479e-01   +3.894576249303364e-01   -1.642612098244066e-01   -2.437015541584640e-01   -1.986825285723952e-01   -2.379644733279499e-01   +1.957866672810155e-01   +3.122183231685789e-01   -6.187478681329596e-02   +7.139094819994065e-01   +2.867318299454798e-02   -4.649890385897653e-01   +6.173261921479508e-01   +5.602850902452201e-02; +3.578634085756527e-01   -1.089577242405569e-01   -3.427714659438175e-01   +1.742858532885404e-01   +1.091912375322417e-01   +2.262527241880734e-01   -1.664187223773330e-02   -1.079156366038394e-01   +2.034683901562426e-01   +2.973518778873804e-01   +5.143477541490402e-01   +9.208689767498195e-02   -1.442869115131607e-02   +3.983405636031783e-01   +2.381364214545698e-01   -9.063432059971137e-02; -4.168124336946728e-02   +3.932094402537985e-01   +5.837903563872754e-01   -2.521035499574998e-03   +6.227074101944092e-01   -2.326356814237251e-01   -1.123048242198004e-01   -3.896480852459887e-01   +2.024588364597960e-01   +3.069677389644553e-01   -5.592170314331636e-02   +7.498157430534704e-01   +6.755306841263793e-01   +4.370666004078565e-01   -3.262694136985232e-01   +2.870838264856576e-01; +2.416424245482474e-01   -5.647525326834266e-02   +1.403784385755144e-01   -4.417069936132284e-01   -2.248489019814652e-02   +4.494411487068609e-01   -9.856132187364222e-02   -3.414104306606275e-01   +4.342688818574805e-02   -6.679410714114538e-02   -1.189417477368657e-01   +5.319918772056554e-01   +2.298300403458172e-01   -2.602684721317011e-01   +2.429716978868739e-01   -8.228550097855498e-02; -7.642476455082620e-01   -4.319628366167771e-01   -3.605176491289164e-01   -5.642221467602488e-01   +5.225630426852302e-01   -9.432237000968022e-02   -2.595051502711385e-01   -2.529834584084984e-01   +5.381641203554246e-01   +5.380408207501631e-01   +6.357185885520045e-01   +3.025196500021660e-02   -2.021311629407148e-01   +3.937886020893176e-01   +6.572608098597421e-01   +4.091528861778777e-02; +3.944129772027961e-01   +2.415328838819417e-01   -2.852834295838412e-01   -4.612510473790775e-02   +1.306838061180882e-01   -1.444743542502336e-01   +8.618362086279111e-01   -6.269153793931864e-02   +6.757628040908575e-01   +2.578366713426866e-01   -1.632238698542603e-01   -4.712240168963500e-02   +8.136368296878398e-01   +4.989009711723413e-01   +3.958728488668278e-01   +8.067754314781258e-01; +2.648042992439495e-01   +6.962286541165664e-01   -9.189337039602452e-03   -1.610267987328657e-01   -5.589972487120910e-01   +6.448086107365339e-01   +1.067095935440915e-01   +4.852385081619692e-02   +1.513870283384165e-01   -5.998730557176176e-01   -8.616590716676181e-02   -2.643338523394247e-01   -2.124002298575922e-01   +7.126294991598292e-02   +8.965370629995201e-01   -7.032962794172318e-02; +3.708886819923107e-01   +7.103913829631056e-01   -4.336103366686243e-04   -4.268810833354144e-01   -2.212736897671029e-01   +3.977657799638604e-02   -3.064496136746192e-01   +6.151329753587467e-03   +6.448126640791725e-01   -5.990506171887782e-03   -5.001557668535359e-01   +9.263862612940146e-02   +6.287235472879719e-01   +2.657849912748076e-01   +7.486474453651362e-02   +1.848540509802279e-01; +3.030511524873530e-01   -6.978511727252119e-02   +3.205753691018448e-01   +6.107095597162384e-01   +3.668732579011373e-01   -7.499236279480059e-02   +3.327104692665195e-01   -2.300383732897289e-01   +5.147238798210950e-01   +3.191984359798287e-01   -3.729618399434322e-01   +3.502374219658768e-01   +4.363299051190246e-01   +3.710392827750599e-01   +1.887371064744671e-01   -6.984854326869361e-01; +1.632325887915147e-01   +1.039778467867253e-01   +2.389810262767650e-01   -5.713615031292807e-01   +4.839904627112546e-02   +1.947681018895610e-02   -2.940628670233971e-01   +1.078251850829582e-01   +1.987184369464163e-02   -1.542069708760417e-01   +3.112362268372630e-02   -7.862096008705664e-02   +5.614087994450185e-01   -1.151768003342996e-01   +5.494495250047330e-01   +1.775609211595837e-01; +4.727565663644626e-01   +2.995877434860078e-01   +7.137148267728101e-02   +3.256000070777038e-01   -1.693851642030429e-01   -1.389698375320869e-01   +1.970154874597350e-01   +1.349833097001052e-01   +2.358701307341504e-01   -1.754842181557923e-01   -9.841558158002119e-02   -2.791524089215110e-01   +2.612510282851399e-01   +3.226049243523606e-01   +2.603931119387712e-01   +9.342184908971239e-02; +3.869601515669843e-01   -1.878936116241756e-01   -2.901470751335721e-01   +3.909350314432737e-01   -2.485373658750368e-02   -3.443438497094322e-01   +1.776941419506965e-01   +3.893605386064428e-01   +6.137265434820726e-01   -9.029712482628827e-02   +2.969995943632694e-01   +1.858060090850518e-01   -1.905227984513629e-01   -5.222112465138853e-02   -1.310758222243025e-01   -4.874557880679368e-02; -4.337556859631424e-02   +3.919551553056154e-01   +1.323520026294732e-02   +1.647284649520438e-03   -1.534249115363562e-01   +5.974258566945113e-02   +1.899393016305529e-01   +8.104232515434232e-02   +6.705469957160405e-01   +5.101880371142081e-02   +7.207393338985733e-01   +5.133934465750046e-02   -2.148375240328242e-01   -7.056301342315744e-01   +1.000000000000000e+00   +2.177109414192060e-02; -4.461967314860301e-01   +5.400868120892948e-01   -1.416955687592619e-01   -1.408182024451064e-01   -3.377806829985266e-01   +8.864317313287365e-02   +1.745481482785866e-02   -2.006597163877716e-02   -2.643357473886591e-01   +7.378553876342636e-02   -3.507027933896601e-01   -1.283221290859997e-01   +2.504204158066209e-01   +4.793008868033110e-01   -6.567973525663805e-02   +3.091485314420715e-01];
L2I_L1I_iGABA_netcon = [-1.312880410179352e-01   -2.598718187801863e-01   +1.904286628679602e-01   +5.070572020853811e-01   -3.636979995583488e-01   +4.606136053179883e-01   +6.856999479041635e-03   -2.905674944001509e-01; +6.144205023577431e-03   +7.513347153565021e-01   -2.313889186727290e-02   -4.942346518782319e-02   +4.848212791519739e-01   +5.103290287753962e-01   +5.684984014192128e-02   -2.447805309643961e-01; +4.451112466355036e-01   -5.261092956095310e-02   -1.175327651578008e-01   +3.715107305241445e-01   +4.048949887995444e-02   +8.480621131376286e-02   -8.058944212556939e-02   +2.164771668458060e-01; +1.634178783331507e-01   +1.373514612556189e-02   +6.412465861380200e-01   +3.045409185201849e-01   +2.075769937616042e-01   +4.234175813085106e-01   +3.158752742398325e-01   -2.136358893204699e-01; +6.763308717312648e-02   -4.544412434044947e-01   +6.480667340112072e-01   +5.565315516671014e-01   +5.444275842663930e-01   +5.425355815577588e-01   +3.438760361826159e-01   +1.027352317477349e-01; +4.104967652267720e-02   +7.942737516623312e-03   +3.234215581231829e-01   +5.146133743888328e-01   -1.399860971370527e-01   +4.689103911235006e-01   +4.670821844055386e-01   +5.566377291782676e-01; +2.559183834098440e-01   +1.237486281620041e-02   +1.702880417458073e-01   -8.812214057787066e-03   +1.659519511201998e-01   +6.784260418158771e-01   +4.321439567758134e-01   +5.274944443494081e-02; -2.937551433808259e-01   +5.444489615458490e-01   +1.069747564055756e-01   +2.255906517124226e-01   +5.248103291059073e-01   -1.255765361254199e-01   +3.369039081852645e-01   +3.406020264050821e-02; +7.249836555340758e-02   +9.494537175405721e-01   -4.358359896582342e-01   +3.914851718191525e-01   +3.583474058587121e-01   +4.773758532601496e-01   +2.469310133903070e-01   -2.574983624551008e-01; -2.222974061046616e-01   -2.880137314488516e-01   +3.712451241381174e-01   -1.488604198156875e-01   +1.005213743290040e-01   +1.247283306761702e-01   -6.196403555168698e-01   +7.066693164382447e-02; +1.010906433230374e-03   +1.062853357962078e-02   +9.596932275639043e-02   +2.996907560341648e-01   +7.420022207542210e-02   -1.509947934876192e-01   +1.300847877744461e-01   +2.844852605656127e-01; +3.917818757267829e-01   +2.927341570295959e-01   +3.036270251439264e-01   -2.468966076886237e-01   -3.137826614116269e-02   -1.429674684797711e-01   +7.639878239709806e-01   +4.698389704097679e-01; +4.155853735674356e-01   +3.283755828429256e-01   +5.861055032232125e-02   +2.445346099483000e-01   +5.458827894859988e-01   -2.837893686082216e-01   -3.150086508214930e-01   -1.295490877344664e-01; -2.417043886671003e-01   -3.660594468994198e-01   -9.607632959321365e-02   -4.031698524684871e-01   +2.044677709040710e-01   -4.967528845705915e-02   +4.064728799486239e-01   +4.787193049480055e-01; +5.153242730837564e-01   +3.008315683762512e-01   +3.815710070083973e-01   +1.346697749969671e-01   -3.027378154587314e-01   +6.225158867315579e-01   +6.433967190078690e-01   +2.381627079014107e-01; -5.360368773935185e-02   -1.317049037508947e-02   +2.299550642876600e-01   +4.502262452785466e-01   +4.008923193694214e-01   +2.041691989870080e-01   -1.502249149605915e-01   +1.562302059116101e-01];
L1I_L2I_iGABA_netcon = [+4.159978918118850e-01   -2.546289932027549e-01   -6.824024208489202e-02   +3.171496736252686e-01   +5.695260350671984e-02   +1.745939632789442e-01   -3.663208316601803e-01   -5.909178253068507e-02   -1.391962260910305e-01   +3.301415632326085e-01   -1.545190810080119e-01   -8.135957897309455e-02   -2.199544419688078e-02   -5.466382658528876e-02   -2.201027172929625e-01   +2.995298857588831e-01; +2.290624648826623e-01   -4.488697219851429e-01   -3.247269831677057e-02   -1.845975857130968e-01   -1.801848044784091e-01   -8.156991799207729e-02   +2.594469974336857e-01   +4.016099268710093e-01   -7.238212527217328e-02   +8.129335248927065e-01   +2.412407616760286e-01   -1.553989167027736e-01   +5.210626866637678e-02   -2.650533894469860e-01   +4.561804139322606e-01   +2.837475421210434e-01; +3.444864372856883e-01   -8.701661972262573e-02   +2.612998172636752e-01   -2.746939958355540e-02   +1.864197367456310e-02   -2.916805099870228e-01   +3.206410080300850e-01   +1.640622819221284e-01   -1.247169817464620e-01   -9.588499655833579e-02   -2.812574454187730e-01   +1.807262401856885e-01   +3.580808349321267e-01   +4.228602676034851e-01   +4.548399875488928e-01   +2.315370354404372e-02; +2.339062931690081e-01   +4.611855252718716e-01   +4.535991346707308e-01   -9.686032853388722e-02   +4.183870685155942e-01   +8.659342847606720e-01   +1.984358645207127e-01   +4.888223496839002e-02   -6.455774332530477e-02   +6.719986914661005e-01   +3.763111859998677e-01   +3.796769331422561e-01   +2.232603491974255e-01   +7.728675554787713e-01   +3.193479528256636e-01   +5.132138225867245e-01; -3.710792932861605e-01   +2.335720258345383e-01   +1.704044469300576e-01   +2.142671285206222e-01   +2.987379918587735e-01   +4.873871862599378e-01   +4.751545764108287e-01   +3.196989219020379e-01   +3.318688763719815e-01   +2.684920839252970e-01   +1.845822257522145e-01   +6.481575504971845e-02   -7.020919342747411e-01   +2.488978859876848e-01   +3.408097818423890e-01   +5.604264870467360e-01; +5.549800704872600e-02   +4.816145635997502e-01   -7.003199483230393e-01   +2.411313381888926e-01   +5.813357676988991e-03   -6.860444072392972e-02   +4.603535908063140e-01   +2.564803833880359e-01   +2.225046889229636e-01   +2.921704464204097e-01   -2.987005704592597e-02   -4.064302376044243e-02   +1.911131950949079e-01   +8.212109323922548e-01   +2.739155313714960e-01   +1.300248599330147e-01; +1.283608118396939e-01   +2.969014998409722e-01   -3.226273573271103e-01   +1.844988138440349e-01   +3.990563778138478e-01   -4.022631271923640e-01   +4.256495274954676e-01   -4.144539621801874e-02   -3.133914941634720e-01   -3.745797240601266e-01   +2.215654872351118e-01   +4.126955598379426e-01   +1.868860390081004e-01   +2.148645612376737e-01   +1.949348190126335e-01   +8.891523639451644e-02; +2.327014180411930e-01   +1.847727357369124e-01   +1.947112972538421e-01   -3.570359611523947e-02   +1.604382985867771e-01   +3.120112910154815e-01   -1.794582603023421e-01   -1.414168794451850e-01   +1.942364765163916e-01   +2.679361776491386e-01   +1.949863262925396e-01   +5.672119860481731e-01   -1.310097673853318e-01   +1.342733374436871e-01   +2.427110921157940e-01   +6.293109531010719e-01];
L2E_L1E_iAMPA_netcon = [+2.932349699790457e-01   -5.429900281079444e-01   -1.313525029253872e-01   +4.485124509107256e-01   +6.177335522413517e-01   +3.527558348244378e-01   +5.001933753175739e-01   -5.182367183160699e-02; -8.905779364189592e-02   +3.810527566483041e-02   -4.012718864028694e-01   +3.719738925070520e-01   +2.365185162028169e-01   +4.908114575431526e-01   +1.653898401651081e-01   +2.926893762883082e-01; +4.823727167578996e-01   -6.022023075458354e-02   +9.573140117235215e-02   +2.356204382986445e-01   -1.511704864519385e-01   -1.002720657766952e-01   +1.290630532346507e-01   +1.719976675199786e-01; +4.514262403468011e-01   -2.733432915390019e-01   -2.584941931390111e-01   +4.141468642093601e-01   +6.826438375370469e-02   +9.006831874557355e-03   -2.232839104375151e-01   -5.219250685269160e-02; +2.277751338976286e-04   +1.988980370880533e-02   +3.844985585490818e-01   -2.871088948536666e-01   +1.809420917035301e-02   +6.401862188181492e-02   +5.927377377962756e-03   +3.319740367768725e-01; +6.238697409827697e-01   -1.106835351093331e-01   +1.488250734206284e-01   +5.729076853413897e-01   +4.364920746181885e-01   +5.414106513614199e-01   +5.279609067549300e-01   +2.539007591342135e-01; -3.151147663109855e-01   +7.370646359555447e-01   +2.724504115612305e-02   -2.648582052633949e-01   -1.702714345525881e-01   +2.489584663144677e-01   +5.484320554794698e-01   -3.585163884828648e-01; +1.017643733211652e-01   +3.717971270475831e-01   +7.941374678776398e-01   +4.921006628242389e-02   +1.486387808201961e-02   +1.349170224208286e-01   +5.170316760293746e-01   -5.442022889218791e-02; +2.686900116365195e-01   -9.147136517605804e-02   +6.461380551366873e-01   +7.964966371666227e-01   -4.814881063459823e-01   +4.135976954640809e-01   +5.255916472395944e-01   -7.731525610709836e-02; -1.753751664308106e-01   +2.149595964969115e-01   +6.965393604062019e-02   +5.687406941359908e-01   +3.077602555021905e-02   -2.466016150060338e-01   -1.796056938000729e-01   -2.882086342387938e-01; -8.889723039820466e-02   +6.961020536430581e-01   +7.197216960428336e-01   +3.498955189520851e-02   +4.469237483099570e-02   +2.566433746750467e-02   -1.318587345748570e-01   +4.516704685630743e-02; +6.779765229691331e-02   -1.827946589601394e-01   +5.197537364453872e-01   -2.543522273228239e-01   -3.202595642147293e-01   +1.084503169613264e-01   -1.131887033790616e-01   -3.474669841875053e-01; -1.220630793534051e-01   +4.255317184469723e-01   -1.601793298199325e-01   +1.036059987514173e-02   +4.606005824483472e-01   -3.506281146785136e-01   +3.039999082440546e-02   -4.952668250973020e-02; -1.246327051537172e-01   +9.387255976494486e-01   -2.630105286124181e-01   -1.283415552234677e-01   +5.426886898200014e-01   +4.637242805996025e-02   -2.361953820347173e-01   +2.734981680282295e-01; +3.591013818302839e-01   +3.979370598740348e-01   -4.451427412171656e-02   +2.281920817891471e-01   -6.108254345300046e-02   -4.737425542335778e-02   -1.571124082039023e-01   -1.718338285771429e-01; +7.576140302641789e-02   -1.085436255291327e-01   -4.534153358055404e-01   +1.984100318946431e-01   +2.039324025842697e-01   +2.552504014181557e-01   +7.789650000252774e-01   -5.251601747418852e-02];
L1E_L2E_iAMPA_netcon = [+4.455980662574331e-01   +1.628776788400643e-01   +1.234850606742305e-01   -2.270258570087348e-01   +3.033376738931448e-01   +4.206424070773069e-01   +3.182988838375465e-01   +3.512056582901280e-02   -6.279836330203233e-02   -1.607027504510491e-01   +6.975814277466015e-01   +3.487178351391554e-04   -8.240752233396292e-02   -1.674880267602568e-01   -1.031917864603635e-01   +2.548702659428747e-01; +3.109885318141067e-01   +5.944158127013652e-02   +2.850395008065568e-01   -2.035360925712742e-01   +3.131444061727466e-01   +1.728361011647793e-01   +7.065871577010755e-01   +2.336411722949992e-01   -5.440226210937542e-02   -8.252869366942561e-02   +3.848219577247354e-01   -1.476465361876644e-01   +5.988511891048622e-01   +4.226672118328935e-01   -1.015639017723813e-01   -6.316222517682673e-01; +9.727801172252289e-01   -1.930144306955252e-02   -1.331923414573137e-02   +2.973467728364830e-01   +1.906008999366378e-01   -2.863130688731211e-01   -1.703822778297980e-01   +1.185838266989650e-01   +1.409911392548091e-01   -4.145032238088175e-01   -1.740892314354183e-01   +3.553373278174439e-01   -2.022821485780792e-01   +6.292214154374743e-01   +1.300140021982525e-01   +6.220273575673817e-02; +6.386328734203937e-03   -8.707668165638097e-02   -2.510284041818019e-01   +4.197847831214116e-01   -2.090598571135640e-01   +8.119981881962087e-01   +5.514505899601712e-01   -1.244516184704969e-01   -8.910523957694595e-02   +1.869914094210779e-01   +4.784083510398434e-01   -2.791943242151653e-01   -1.551756768253809e-01   +9.110020075553220e-01   +4.541892752580101e-01   +2.394061420621808e-02; -1.830174122830177e-01   -4.017963752845604e-01   +4.365806583680758e-02   +2.576004511553689e-01   -2.928318758061106e-01   +1.642423153192667e-01   +3.774249850639789e-01   +1.959477767633123e-01   +4.277610927411915e-01   -8.313496966692499e-02   +2.120645519366758e-01   -4.755484869852650e-01   -4.114916049970864e-01   -9.448799398245578e-02   +1.421641933728874e-01   -2.691695826218075e-01; +3.903319512533752e-02   +4.917657234419540e-01   +8.669802845558992e-02   +6.803899409012482e-01   -1.464467739946987e-01   -1.766718469406020e-01   +9.147775638359599e-01   -2.701552638587474e-01   +2.259943282942725e-03   +1.705379656062660e-01   +4.399852247137044e-01   -4.442654263206017e-03   -2.277176663856406e-01   -2.821630840629026e-02   -2.278809602683952e-01   +6.670222376208693e-01; +1.791854197894631e-01   +3.678492572406007e-01   +1.787825030607917e-01   -1.144906622219394e-01   +2.532005179239575e-01   +2.734054582987346e-01   +4.837388928524303e-01   -4.443535945907535e-01   -1.265652287591271e-01   -1.864616779487230e-02   -1.552835014328113e-01   +4.027775426045457e-02   -6.267753326497639e-01   +5.495782086962711e-01   +6.278999602526691e-01   +4.544092078475497e-01; +5.628799309435023e-01   +3.345830067356285e-02   +2.499911581317006e-01   +5.367240191988379e-01   +4.171382837246080e-01   +5.711967466763149e-01   -6.345717519336448e-02   +1.432330442758812e-01   +1.692804129450858e-01   +3.464451568675643e-01   +5.346545205542082e-02   -4.094577572336253e-02   -7.826766970147254e-01   -2.302975788415752e-02   +3.956996705528795e-01   +3.571386259871956e-01];
L2I_L2E_iAMPA_netcon = [+5.473027404999208e-02   +6.992016137754801e-01   +2.811485910293495e-01   -1.618727886242036e-01   +1.141867305720939e-01   +1.999937201390521e-01   -7.163753138845211e-02   +6.825666163733209e-01; +6.929283394560923e-01   +3.870197562536726e-01   +4.335483223396208e-01   +8.880095295505903e-01   +3.263439129112775e-01   +3.353974278043689e-01   +1.752041186741775e-01   +4.790951823581379e-01; +1.761318910621272e-01   +1.474701810086657e-01   -3.571389241202064e-01   +4.684641354335364e-01   -2.780461289769835e-01   +1.035180999274725e-01   +4.134481263608429e-01   +4.254737411749018e-02; +4.270688146844751e-01   +5.377497731368113e-01   -6.603589960713435e-01   +3.904903727835225e-01   +5.262889810258414e-01   +2.138493292133473e-02   +2.286817874816712e-01   +4.905461873458922e-01; +4.260606839526969e-01   +1.648260498101251e-01   -3.598765267322398e-01   +4.828845745355477e-02   +7.652523777459027e-01   -2.873223736918160e-02   +1.284349247362515e-01   -1.162831493955117e-01; +3.816758897093354e-01   +3.690862625177246e-01   -3.333956677996787e-01   +4.906554642747184e-01   -6.419367357338415e-01   +7.345454599821266e-02   +1.478511672215034e-01   -1.909233877119994e-01; +5.280066762248070e-01   -2.645093055125883e-01   +2.121891089362020e-01   +4.789485233283173e-01   +2.171043275131264e-01   -2.821390598567715e-01   +8.006362064057964e-01   -7.142760322173223e-01; +2.477580856483164e-01   -6.633839063737018e-02   -6.790671871148544e-01   +2.680580260515320e-01   -2.698695058189254e-01   -1.495081428179524e-01   +9.887982990287991e-02   +9.072057972137281e-01];
L2E_L2I_iGABA_netcon = [+2.950744090560969e-01   +4.603010066061778e-01   +6.427923078999273e-02   -2.067314795313134e-01   +2.266090953056610e-02   -1.021561553667290e-01   -2.841107112905594e-01   +6.264062488568652e-01; +2.000381954327558e-01   +1.984099271298618e-01   +2.684902971679322e-01   +9.750565589550798e-01   +4.121985867391920e-01   -2.249970854967613e-01   -3.036847509677050e-01   +2.872466986726447e-01; +1.704712680489530e-01   +5.816171777241512e-01   -5.606387937996620e-01   -4.030642227659147e-01   +1.469644367219051e-01   +6.191709054901201e-01   +2.035214210548118e-01   +1.441700560247114e-01; +2.655365089535634e-01   +1.685981555546024e-01   +1.404931550305240e-01   +5.779635302588171e-01   +5.637615826611673e-01   -2.495903871685723e-01   -2.916841840525956e-01   +3.166409741019667e-02; -2.043002571945629e-01   -7.672760864782703e-02   -2.796568931826269e-01   +4.392201001048728e-01   +4.885651499754087e-01   +6.911195910586251e-03   +7.595836194218698e-03   +2.330527141776304e-01; +8.283114418345845e-01   +2.369544320293015e-02   +2.000996172257694e-01   +2.241643229103719e-01   +3.229488650880976e-01   +1.399628642410958e-04   +4.044795149240303e-01   -3.502805474106250e-01; +6.064849047558725e-03   +5.528388019585673e-02   -3.553306348416299e-01   +8.858033877423648e-02   -9.878862769823772e-02   -1.058209998825324e-01   +1.509579398856841e-01   +7.600921114206679e-01; +9.029403449838515e-02   +1.488728022620837e-01   +3.949588737948184e-01   -1.636217709005593e-01   +5.072228098579421e-01   +2.589933444960786e-01   +2.856458283891937e-01   +4.392033905301997e-01];
L3E_L2E_iAMPA_netcon = [+1.231669635817916e-02   -3.332211826439914e-01   -2.164145256355038e-01   +2.567832285394503e-01   +7.416492921571428e-01   +2.378899590110261e-01   -1.928518561722835e-01   +1.000000000000000e+00   +5.114815919138447e-01   +1.980752034297717e-01   +2.151478403917839e-01   -5.693093771549679e-01; -2.720303343198715e-01   +1.949129252072783e-01   -1.207871082533686e-01   -6.371505434076193e-01   -3.774226249095591e-01   -2.545262081036318e-01   -2.155939649862989e-01   -2.490303239231159e-01   +8.851004442995170e-02   +4.984496334248137e-01   -1.683214538166921e-01   +5.211327402290720e-01; -6.817149862987314e-01   -2.124926334968148e-01   +5.714247830212492e-01   +1.690619977030582e-01   -1.065805769444359e-02   +6.514137437362361e-02   -4.521532745282285e-02   -5.190801134337119e-02   +5.964492997943941e-01   -6.230445321197178e-01   +7.310539542895016e-01   +4.624369399636800e-01; +4.051671527597831e-01   +4.105657010312425e-01   -2.317802376332416e-01   +2.908004111984236e-01   +6.370749804953143e-01   +2.013474866905982e-01   +3.502575508847922e-01   +8.917941199061031e-01   -2.766545608286513e-01   -2.606182676914794e-01   -1.600970862227804e-01   +3.431801138798539e-01; -7.092256566883942e-02   +4.000998750920457e-01   +4.138595655692565e-01   +2.466508874185926e-01   +4.481134149982413e-01   +4.703868316808632e-01   +1.247035237279045e-01   +4.917887871267219e-02   -4.539286759714996e-01   +3.584307883436437e-01   +6.348532914259909e-02   +3.084527048550951e-01; +1.509503407412196e-01   +9.674782045781047e-02   +3.022137618846812e-01   +2.853032427350399e-02   +7.199265712133796e-01   +5.047471732942150e-01   -3.125703312393466e-01   -6.525938402257263e-02   -2.082823568322207e-01   +3.589496800088580e-01   +7.254554618268384e-02   -1.861094642351363e-01; +4.921908440710982e-01   +2.319083490101898e-01   -4.427976271711043e-02   -1.717780378039966e-01   +1.736904496426856e-01   +4.166890384057799e-01   -1.122171127050193e-01   +2.496401003093882e-01   -1.430054462475541e-01   -5.335716594011055e-02   +5.069289140877609e-02   +2.749882497956498e-01; -2.848007026434763e-02   +7.388598015586468e-01   +7.315248702119694e-02   -7.398889201917956e-01   +3.358947625945081e-01   -2.610882402662905e-01   -2.351828220282513e-01   -1.072313557698859e-03   +2.400976448638991e-01   +1.065813299350503e-02   +5.397451563202728e-01   -9.796289316031050e-02];
L3I_L2I_iGABA_netcon = [+7.102522501563840e-01   +6.283832351243313e-01   -5.289386410846267e-02   +1.339647642775195e-01   -4.231277017349226e-01   -2.160010964826020e-02   +1.000000000000000e+00   +4.854171754517231e-01   +1.838389273409328e-01   +3.402560614656507e-01   +1.274929652668890e-01   +2.794793497084225e-01; -2.645020816998991e-02   -3.391312070825570e-02   +2.070821357912546e-01   -2.122145166720033e-01   +9.457846279660632e-03   +9.328151241609767e-02   +1.659785015093100e-01   -4.133069723461827e-02   +1.235258175005010e-01   -2.224961622734620e-01   +1.387364238420706e-01   +2.597269390778116e-01; +1.033860086383299e-01   -1.667236516833456e-01   -1.080069300794440e-01   -1.934177048175375e-01   -3.303108064013990e-01   +4.921162713076072e-01   +3.323040617619081e-02   +6.939951024160809e-02   +5.026911100993372e-02   -1.667422356665212e-01   +3.968845947375556e-02   +5.414621208912487e-01; +6.979201759732157e-01   +2.643600967699198e-01   +3.710388359336022e-01   -1.955633810079697e-01   -1.383295704934643e-01   +2.481131058243904e-01   +9.009762795521359e-02   -2.491311518813766e-01   +1.160217247837268e-01   +4.049314750955374e-01   +3.225713388900864e-01   -8.991039762251532e-03; +1.306365166230917e-01   +3.929620475083000e-01   -1.927104671916932e-01   -1.980168649732308e-01   +6.038410759379727e-02   +4.464992095873480e-01   +9.038893306173415e-02   +3.411496010538678e-01   +2.842919730164157e-01   +1.059271460039148e-01   +1.180929290928290e-01   +2.096444523648182e-01; -2.297963409926521e-01   +6.601518795826766e-02   +4.328665039282506e-01   -5.443740459452730e-02   +5.401315900436124e-02   -9.727612505225763e-02   -9.144983242162276e-02   -2.101721363328161e-01   -2.201631399175347e-02   -7.195505421902414e-02   -7.354023881317528e-01   -1.703744742262280e-02; +2.037304118089742e-01   +1.699677521502788e-01   +4.104405782762603e-01   +2.850172124199868e-01   +4.105676473223578e-01   +5.897081347076358e-01   +3.311877867462929e-01   +2.969071821376057e-02   -6.094248544668694e-01   +2.183230007720260e-01   +4.101685898204974e-01   -2.398823902355378e-01; -6.101949222380555e-02   -3.060242219268712e-02   +3.490397793306405e-01   +1.223982034716869e-01   -1.164331114341340e-02   +4.302687317269193e-01   +2.347103112558477e-01   +4.433446940958983e-01   +6.134716363000429e-01   +1.841663462580830e-01   +2.596894890846702e-01   +2.735151467885100e-01];
L2E_L3E_iAMPA_netcon = [+6.145790889256311e-01   +4.488327378104114e-01   +5.084732692788795e-01   -6.513777856259847e-01   -1.120079386075406e-02   +1.865754482546950e-01   +6.223713665691706e-01   +2.065232559793259e-01; +3.295525614991094e-01   -9.653952273616322e-02   -1.775418907842054e-01   +6.236699054027364e-02   +9.379101036302212e-01   -5.680539391375165e-01   -8.686477395847253e-01   -5.606114955587626e-01; +1.581885732787658e-01   +1.821484002067836e-01   +3.203894250349433e-01   +3.623785870073051e-02   -1.389342592778764e-01   +2.968786865815563e-01   +8.227233766257970e-02   -1.213096615471960e-01; +4.434650758754051e-01   +5.069161914850562e-01   +7.646086205959939e-01   +8.145850980940913e-01   -5.606505469434706e-02   +5.563279353446091e-01   -8.671589235202917e-02   -4.709711188429587e-01; -1.801931212708211e-02   -1.491108513718448e-02   +3.362352475099190e-01   +3.689079050719490e-01   +4.484427155653969e-02   -1.621250683831053e-01   -9.824714015977479e-02   -5.860514077582070e-01; +5.484321888739124e-02   +2.332870219451783e-01   +3.612578194959045e-01   +5.368339699472282e-01   -1.355021580380840e-01   +4.615269253914795e-02   -7.332311833235845e-02   +2.477359184586636e-01; +2.764887803632575e-01   +7.696149657683072e-01   +6.742504905544761e-01   -2.525292306327210e-01   +5.129750858221058e-01   +2.079154827349157e-01   +6.891121297616092e-01   +1.088833066269424e-01; +3.975237276425495e-01   +4.697372968944794e-01   +3.412640207720524e-02   +1.677743795749191e-01   -4.850775586758265e-01   +2.139729460962130e-01   +3.179850932456491e-01   +7.041607543802498e-01; -1.881856379876979e-01   +5.421659993176108e-01   +5.691960836838810e-01   +7.288217175230216e-01   +9.555931172146773e-02   -1.776034070757514e-01   +3.391024304871391e-01   +1.233288760695588e-01; -3.106006944703773e-01   +1.887070729594511e-01   +5.446005274183753e-01   +1.966774904977374e-01   +1.795344027344457e-01   -4.175230438736489e-01   +5.650054505582711e-01   +4.770450786493421e-02; +7.983087944090377e-01   +6.034313484783486e-01   +7.411538963704568e-02   +4.729750229409448e-01   +1.659245254544459e-01   +9.605166951737216e-01   -5.309571530016469e-01   +7.035943734424857e-02; -1.617894115151536e-01   +4.723619022840482e-01   +6.361779312021001e-01   -2.835799691848296e-02   -9.756514226477714e-02   -9.687868962939906e-02   -2.855545331347143e-02   +2.772853238798021e-01];
L2I_L3I_iGABA_netcon = [-5.118937213814065e-02   -2.031041489583014e-01   +2.836462132232447e-01   +1.856042808977561e-01   +2.949781366950233e-01   +7.077345197810366e-01   +5.550990133353745e-01   +1.268717903625104e-01; -2.961341740453159e-01   +4.289411012769179e-01   +3.852017327289950e-01   -2.183621243659542e-01   -1.777327323171742e-01   -3.209058437526446e-03   +3.372103375258922e-01   +3.696916498163592e-01; +1.436093052515758e-01   +8.592430354136428e-01   +4.200408138862567e-01   +1.064022833920274e-01   +2.917388350649580e-01   +4.892042189237289e-01   -3.969431831499132e-02   +8.837245125218046e-02; +1.171037213625034e-01   -3.194419626648457e-01   +4.274800446793606e-01   -1.344200406952456e-01   -3.303309905023327e-01   +1.410436312022340e-01   +3.531191636253869e-01   +3.854106466604463e-01; -1.611151444031786e-01   -1.670451748466990e-01   +1.573229952225947e-01   +4.543927861777368e-01   +1.270131055758026e-01   +4.639306895769041e-01   +3.560745464781041e-01   -1.862613965169228e-01; -7.448401355216860e-02   +6.232064225276790e-01   +1.623895757800971e-01   +2.610123715359941e-01   +5.264669323379633e-01   +2.461099168005094e-01   -5.180208520346866e-01   -5.256731051720755e-02; -2.491896676322902e-01   +9.818465465708368e-01   +5.357258907786482e-01   +1.353878509153707e-01   -1.693263470945557e-01   -1.240661631831903e-01   +8.104823351825329e-01   +4.168893820256581e-01; -4.880084094450974e-01   +4.450850967151519e-01   +3.405579088335511e-01   +7.741468174650365e-02   +1.531555731065112e-01   +4.385021350247114e-01   +2.237025510611897e-02   +7.417272486223365e-01; -6.717763648826220e-01   +8.756584684593899e-01   +3.164580068780357e-01   -3.928728447535159e-02   +5.925025752866230e-02   -1.315498356798801e-01   +1.711778279604863e-01   +1.935038886290322e-01; -8.480349771918463e-02   -3.222043060187543e-01   +5.629048531175502e-01   +2.282578270950071e-01   +3.874204638093323e-01   +4.035345994724613e-01   +4.951724791582955e-02   +1.155172112088049e-01; +6.130117449046388e-01   -2.133522737942430e-01   -6.216325723955810e-01   +5.897866613619995e-01   +2.101317798548583e-01   -2.286112900416999e-01   +4.641198054167293e-01   +2.043667863634832e-01; -1.485829780331119e-01   +6.179173041310776e-01   +2.570218895305214e-01   +3.074949376101522e-01   +2.637919954882432e-01   +4.162187137709519e-01   +1.152929807453418e-01   -1.730605722337171e-01];
L3I_L3E_iAMPA_netcon = [+1.849375267644161e-01   -7.712500344375011e-01   -3.898880773694156e-02   +1.396311181220027e-01   +8.058171683966903e-02   +2.095911407819267e-01   +6.192166358841514e-02   +4.171223354086590e-01   +7.794300563543980e-01   +7.257582059086169e-02   +1.630075164310668e-01   +5.352418930166269e-01; +1.190067266680765e-01   +2.512397278847611e-01   +1.808290904210887e-01   +5.012013847543506e-01   +4.685177002749094e-01   +3.398364363464880e-01   +4.981238563280457e-01   +8.734555091449231e-01   +5.590093561996862e-01   +9.640171964975171e-02   +1.498888698204083e-01   -4.508251711971181e-01; +2.969056527765457e-01   +3.846923836840855e-01   +2.912976857819029e-01   -3.200972367636093e-01   +8.824130113242631e-01   +3.724463269903855e-01   +6.524648918186190e-01   -2.479939126194384e-01   +6.311025451405973e-01   -9.884907819489025e-02   -9.733593326628656e-02   -5.038820661680792e-02; +1.144214026552879e-01   +2.746679813147090e-01   +1.375409089961365e-01   -3.526886723177827e-01   +5.464631992783284e-01   +6.355730655846856e-02   -1.979043500937612e-02   +6.241303900060267e-01   -4.072801822697363e-01   +3.201575982049829e-01   +2.677649321693138e-02   +3.890591173084575e-01; -3.146602158036783e-01   +2.698329290584435e-01   +7.235580692273638e-01   +5.764361786990787e-01   +3.466486742778896e-01   +4.722757290055321e-02   +4.259576931083850e-02   +1.891354575096595e-01   +2.501878157570553e-01   -1.193414353043739e-01   +1.302295818105590e-01   +1.068334618232055e-01; +3.801805437335056e-01   -3.248088519939543e-01   -3.212173349964945e-01   -1.138953035034658e-01   -1.595329266278918e-01   -3.188031310927384e-01   +7.300444647132044e-01   +9.281352446335482e-03   +1.752161303301453e-01   +4.410627549744389e-01   -7.195844278938178e-02   +9.883365803740348e-01; +3.054781543673107e-01   +2.587109671440133e-01   -1.312846630473210e-01   -9.843014471255801e-02   +3.058959746836087e-01   +8.681989106679341e-02   +1.885027653847592e-01   +1.283305575507696e-01   +2.548113029980652e-01   -2.795020859543856e-02   +8.375104019276086e-02   -2.040351038490089e-01; +1.905681060067007e-01   +3.373920340054872e-01   -3.297916985851880e-01   -3.637940315602063e-01   +4.709156125741741e-01   +2.924446009833016e-01   +1.237442541519036e-02   -5.600398001823130e-02   -2.168494307258069e-01   -4.378775077310116e-01   -6.246464256416360e-01   +2.068087625246240e-01; -2.587881396319626e-01   +6.668476367730299e-01   +3.525249934627218e-01   +8.246827152636895e-01   -8.126223572842269e-02   +6.070045523528422e-01   +3.852889326555362e-01   +4.257916042248989e-01   +3.256665332003559e-01   +5.345359773264626e-01   +1.586426885989601e-01   +3.884744568343897e-01; +9.926643176283003e-01   -5.976511354876031e-01   +4.944345288904172e-01   -2.968473803807437e-01   +2.214791028465618e-01   -4.520117210771314e-01   +9.479307452282816e-02   +2.767898787858649e-01   -1.603312399565758e-01   -1.832491802483047e-01   +5.797245537044670e-01   -4.658614254136463e-01; -2.417632171784243e-01   +7.740161496738480e-01   +3.890697726217259e-01   +2.803067886868191e-01   -2.099282490835910e-02   +7.150589679093711e-02   +5.515039911011815e-01   +3.772588425879134e-01   +5.219438230118452e-01   +2.115233101526543e-01   +7.828977432297361e-02   +6.845752192529305e-01; +1.242621100314227e-02   +1.562929921130848e-01   +1.368543209112780e-01   +5.137622947020964e-01   -1.061839892517910e-01   -2.265290541227899e-01   -3.972811477940366e-01   +4.172466881021960e-01   -9.888218960320369e-02   -2.120964808905096e-01   +2.328050043934961e-01   -2.757282847277435e-01];
L3E_L3I_iGABA_netcon = [+1.322267443245799e-02   +3.139502082961373e-02   +4.664536842123923e-01   +3.285974026998174e-01   +3.550049334126830e-01   -2.872768490566788e-02   -2.184116745854744e-01   +2.978766475536558e-01   -1.508070327448773e-01   +3.109946183549421e-01   +5.220989063342589e-01   +4.231985253342816e-01; +3.428042273614138e-01   -4.967235747377540e-01   +2.491194096957983e-01   +1.763088239140730e-01   +5.004298883483363e-01   -3.700487743575839e-01   +9.853974103236475e-02   +1.649366862202055e-01   -3.410599704540418e-01   +1.547424565485102e-01   -6.963095544556576e-01   -1.356033748968033e-01; +1.886024402172375e-01   -1.989932649251406e-01   -4.865653136305456e-01   -2.115590939258834e-01   -1.032642223466662e-01   +4.108416609292292e-01   +3.401235942716910e-01   -2.321476414583802e-01   -7.748451056830800e-02   -1.487185606903322e-01   -3.949310681876579e-01   +1.143456967560057e-01; +3.330563228127583e-01   -1.333285228613454e-01   -2.712245401898724e-01   +6.632986571789740e-01   +9.468562343124637e-01   -2.182066563181902e-01   +1.257897699123766e-01   -1.906287614064649e-02   +9.268308560056578e-01   +4.918511227131289e-01   +3.803565007232915e-01   -1.517895737051514e-01; +1.156601329411373e-01   +4.502318565415129e-01   -2.612431639123194e-01   +1.763886583372123e-01   -2.368030280233498e-01   -2.456081184786057e-01   +2.700030830595402e-01   +2.854396515892056e-01   -3.488137462643802e-01   +7.133095219759006e-01   +5.379279894537321e-01   -1.044242856938987e-02; +2.336181912758765e-01   +3.985595214099150e-02   -1.508939315639268e-01   -1.143006992475776e-01   +2.595186616600821e-01   +1.741165229556841e-01   +2.591033751061027e-01   -2.648330403406945e-03   +2.977116619131595e-01   +8.936167334370483e-02   -1.473397515732651e-01   +6.109443782725709e-02; -1.884408068673930e-01   +1.299071640836455e-01   +1.225344714183434e-01   +8.219303753408358e-01   -2.804005029926297e-02   +6.484127458457332e-01   +3.522097183243594e-01   +8.631464056794873e-01   -1.564572700914636e-02   +3.274953488424547e-01   +2.711574643019278e-01   +3.331935317325215e-01; -4.081691890006391e-02   +2.683188520555101e-01   +6.834276779010515e-01   -7.634416259468432e-02   +2.550463080421528e-01   -4.610936549645526e-01   -6.700133797544754e-01   +5.760647824392008e-01   -4.019078399030254e-01   -4.450780240112631e-01   +5.132238359372128e-01   +6.874279651559990e-02; +3.069443192778968e-01   -2.480636952730366e-01   +6.353357316595587e-01   -3.192623099063072e-01   +2.296191180459332e-01   -8.668515483348085e-02   -5.633889214544247e-01   -4.764475739006188e-02   +2.873105065176553e-01   +3.460295557106222e-01   -2.458341818612851e-01   +5.396891815105677e-01; +3.021653106656258e-01   -2.693816568114929e-01   +3.013764357813990e-01   -1.007409927234135e-01   -5.816637158312198e-01   +1.264865565844119e-01   -4.260237458642767e-01   +2.875675064461815e-01   -1.910876263571819e-01   +1.162791295698825e-01   +1.806006948218297e-01   +2.187640896879472e-01; -1.293022767310627e-01   -2.779247289539547e-03   +6.182811625676072e-02   -3.903999637725302e-03   -2.382451544475266e-01   +3.241176971623436e-02   +2.976754084098436e-01   +5.443825064966998e-03   +3.436143413320913e-02   -6.225271959853766e-01   +1.383638416177657e-01   +4.359875574096450e-01; +1.154038361143797e-01   -1.431267625863012e-01   -5.426920890987473e-01   -1.690989235146713e-01   +1.000000000000000e+00   +1.541806890099491e-01   +5.358306312241329e-01   +3.605613327771147e-01   -7.061342866271916e-02   -3.936803461940546e-01   +7.482929684049844e-02   -5.645465084409054e-01];
L2E_Input1_iAMPA_netcon = [+8.211947552231785e-01   +8.464375536978894e-01   +7.658398996491090e-01   +3.752636602053320e-01   +2.657961934855265e-01   +2.810168946601970e-01   +8.788650793804540e-01   +7.441788387067129e-01];
L2I_Input2_iAMPA_netcon = [+6.603621862110448e-01   +8.058528528778170e-01   +2.766992189093488e-01   +2.309721309417394e-01   +6.582189489006415e-02   +7.357795161446505e-01   -3.920465625290780e-01   -2.621604219524093e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
