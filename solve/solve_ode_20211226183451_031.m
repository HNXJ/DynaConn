function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.286211289232690e-01   +8.950922800456986e-01   +5.433225800561885e-01   -1.609165191740088e-01   +9.106679486887045e-02   +5.215429864726716e-01   +3.044896925015515e-02   -5.352340723351680e-01   +7.706774003055287e-01   +9.839359667350698e-01   -3.889205067408208e-02   -1.920941560410752e-01   +4.885411259257882e-01   -6.530710362483211e-01   -1.596400668876266e-01   +6.287515635891726e-02; +1.829483652922930e-01   -6.642492783948095e-01   +9.020638895181317e-01   -1.609361249364211e-01   +3.390964235723560e-02   -6.387647734379894e-01   +5.930210968568788e-01   -3.473998320705603e-01   -5.749863465077851e-01   +4.584320543147692e-01   -5.468212735185358e-02   -4.242025405755320e-02   +6.561181493140592e-01   -5.390978080218265e-01   +4.436602015307266e-02   +2.672308153094360e-01; +8.625382858204149e-01   +7.310997501417256e-02   -7.393285005208813e-01   +4.745402576197406e-01   +4.150345023593907e-01   +1.937250553039306e-01   -2.072263240494130e-01   -7.088992976277245e-02   +1.166048183607684e-01   -1.090538967866352e-01   -6.860835950476353e-01   -6.169958265558544e-01   -2.893674452470746e-01   +9.175736250472076e-01   -8.050297811295333e-01   +7.343107471038252e-02; -4.671351589874028e-01   -3.291528326488066e-01   -4.838585512351776e-02   -7.153893629511326e-01   -6.413897426908431e-02   +2.655180319695994e-01   -2.610637354697679e-01   +3.554244156518852e-01   +5.756615358265992e-01   +3.469757961432028e-01   -2.520716004958461e-01   +4.997564001355836e-01   +3.861718915446307e-01   -3.446563690480484e-01   +1.338391699792720e-01   +8.243914324010654e-01; -9.015544209780793e-01   -3.921173164113716e-01   -2.955325622635760e-01   +7.480713073172912e-02   -1.082986480348207e-01   +1.984921373752540e-01   -1.953729768623814e-01   +8.239816444256126e-02   +9.860575074577707e-02   +3.049408076333741e-01   +8.049653566469453e-02   +1.978503551879488e-01   +2.626628116653235e-01   -4.354828822498945e-02   -3.510972943737466e-01   +4.076369607168552e-01; +5.942960398705844e-01   -9.280977981985560e-01   +2.456528076395482e-01   +2.138413238233317e-02   -8.143814648850968e-01   +7.212047671630684e-01   +7.292325499758605e-01   -3.821474771450569e-01   -2.880615197195590e-01   +8.647128489583413e-01   -3.016850577307595e-01   -1.720045949968355e-01   -1.721949491776906e-01   -5.695396411765509e-01   +2.540744764842605e-01   +2.471026402527282e-01; +6.512170450510270e-01   +1.496661962797509e-01   +8.025501178061638e-01   -3.211554589698984e-01   -5.946164298749225e-01   -2.838555693926100e-01   -3.264806335577135e-01   +2.186144124354350e-01   +5.397373653161812e-01   -6.254884283499914e-01   +8.261275474801004e-01   +4.530861135926709e-03   +1.394089681711988e-01   -4.499014514966211e-01   -1.109133370713351e-01   -5.060666030997141e-01; -6.962764677202570e-01   +2.251867619858445e-01   +6.135679652077199e-01   +5.264941043867776e-01   +3.987461044216713e-01   -1.704367369987513e-01   -3.980198488615393e-01   -4.065557994795811e-01   +5.886265161696550e-01   +8.593794532913421e-01   -2.288010087416146e-01   +4.803597436760058e-01   +1.684345390655731e-01   +5.579414779904462e-01   -5.285126007080408e-01   +6.205099352431499e-01; +6.023411197732974e-01   +6.086959567595007e-01   -2.374140288277095e-01   -6.009130928555300e-02   -8.161089201922953e-01   -3.132707170664308e-02   -5.645234394919223e-02   +1.283690441254781e-01   -3.037325432977670e-01   +3.652440024384977e-01   -1.000000000000000e+00   -5.384754072972933e-01   -1.715024870791048e-01   -1.067148850703196e-01   -7.372150150388392e-02   +5.582446098561403e-01; -2.546911578790964e-01   -5.444882465217267e-01   +5.684474608447495e-01   +3.484968420122465e-01   +3.131294959939654e-01   +7.967768972632575e-01   -3.391734654965776e-01   +7.954678821333484e-01   +4.606168902403174e-01   -4.893558334644549e-01   +4.323282986634596e-01   -1.822901837395017e-01   +5.208510043752206e-01   +3.503811154587179e-01   +2.258408793654984e-01   +3.725085487624107e-02; +4.145646690844554e-01   +1.247784275486684e-01   +3.897899148017265e-01   -6.421323028309572e-03   +6.598115649528584e-02   -8.309030691497882e-01   +7.297821232175064e-01   -5.314124358272073e-01   -8.347984299888442e-02   +7.351573209365383e-01   -3.817657637981139e-01   -4.327208770666595e-01   +3.975079791503642e-01   +7.686692335204084e-01   -4.727127056666426e-01   +1.515273271665443e-01; -2.392838192010726e-02   +6.066692341801263e-01   +3.035082444891754e-01   +1.211900257848275e-01   +6.177505682013203e-01   +6.376236213509311e-01   -5.400453203486004e-01   +4.024533808047698e-01   +1.279895317268471e-01   -2.953525726882009e-01   -8.705339965048703e-01   +4.793265859574237e-01   +3.686818772626737e-01   -3.954118585723097e-01   -1.809952479657934e-01   -2.166251893517862e-02; -4.104105541500052e-01   +5.531744170793159e-01   +8.264974369412024e-01   -3.299949053497185e-01   -3.755306058727642e-01   +7.971880854704579e-01   +3.263140398254931e-01   +8.325106338521274e-02   +2.711858211549025e-01   +3.607452040684298e-01   -5.762937119211835e-02   -6.075958676593392e-01   -1.421883634891710e-01   +8.359060676647555e-01   +6.751215221596961e-01   +2.588851886833411e-01; -1.139607880045121e-01   +5.715996596627351e-01   +3.978981865004976e-01   +5.702829363870232e-01   -1.618340823104946e-01   -4.154041472337817e-01   -3.538142908337547e-01   +6.750495972897789e-01   +8.424297050062797e-01   +1.900976879564041e-01   +4.996785933675897e-01   -3.053567484055321e-01   +1.658100886386503e-01   +2.044605380941306e-02   +7.168952149215023e-01   -6.923324585459756e-01; -1.388081238040385e-01   -4.652237988237998e-01   +9.501126781217499e-01   -2.860856486468139e-01   +6.048954613446932e-02   +7.298229577831161e-01   -3.914557206604916e-01   +3.712885575147075e-01   -2.072894143058155e-01   -2.109038296070597e-01   -8.593258741066137e-01   +1.056503812830623e-01   +7.236592873795442e-03   +9.353368758766224e-02   -1.798065643839095e-01   -1.265617070469769e-01; +4.563867996945699e-01   -3.383319745830557e-01   -9.189865689678023e-01   -5.254037828371737e-01   -2.207804494485873e-02   -6.319318296328791e-01   -5.795272768246296e-02   -5.243421923808183e-01   +7.011022781179970e-01   +2.301378686376750e-02   +4.520361065566539e-01   +5.580897959486215e-01   -6.696981817762225e-01   +6.454476538773546e-01   -5.047773036315083e-01   -2.795620659732669e-01];
L1E_L1I_iGABA_netcon = [-3.570168484313282e-01   +3.822698309924674e-01   -2.569659494968198e-01   +1.063643076384615e-01   +6.985001296299829e-01   +1.346743300346653e-02   -4.282955860334267e-01   -6.472549013301852e-01   -2.736380957213840e-01   +5.162291232011869e-01   +3.394386176956948e-01   +5.021275786382181e-01   -2.360870918618983e-01   -2.332082342395218e-01   +3.134050592516600e-01   +7.941488099317997e-01; +2.481514132583404e-01   +3.492005814636155e-01   +6.885004794982887e-01   +1.072488988862669e-01   -3.411109658920317e-01   -6.484431989051895e-01   -3.289519583199397e-01   +3.792024465198844e-01   +2.109400633981465e-01   +7.622574447955360e-02   +7.215843398791466e-01   +4.671787740863705e-01   -2.454841020362266e-01   +3.184885072059016e-01   +8.141371556357928e-01   +1.401607896988172e-01; +1.357894316879415e-02   +4.267187146213019e-01   -2.094665489744102e-01   -3.776354042567014e-01   +1.010502683931424e-01   -1.520123738216515e-01   -2.931217170381528e-01   +2.941565701834068e-01   -2.019726726389617e-01   +4.507600400324031e-01   +2.970259799980260e-01   -4.423893480796445e-01   +4.037679825472416e-01   +8.523847220922443e-01   -2.822703202882209e-01   +1.712353464569623e-01; +2.800598770809660e-01   -6.776551140171887e-01   +8.509233437334401e-02   -5.117007934164271e-04   +3.519550337224349e-01   -4.861775068442355e-02   +6.401032654789578e-01   +6.275855946905140e-01   -3.626481435848998e-01   -4.169524955720965e-01   +4.833956408750831e-01   +2.285897770706760e-01   +5.940445711552833e-01   +9.722818928105598e-02   +3.906740878606960e-01   +1.748496175293087e-01; -7.504888706852131e-02   -1.396171934390231e-01   -3.117750308146557e-01   +5.294107613522567e-01   +1.462081204858985e-01   -2.084710022524928e-01   -7.701189074755306e-02   +5.073066777600573e-01   -5.302632171514906e-01   +7.575847559896584e-02   +3.136525923191788e-01   -2.924950897571076e-01   +5.528081440980598e-01   -6.567778776087037e-01   -1.897783959222061e-01   -4.933738342813668e-01; +1.567278457925139e-01   -4.133988685985244e-01   -1.410210816748979e-01   -4.410868863335203e-01   -2.652346627915568e-01   -1.488473036850185e-01   -5.096089915937303e-01   +5.437864798248500e-03   +5.151625222461644e-01   -6.857811339619935e-01   -3.872638656536616e-01   -7.065425535507966e-02   +8.506362895585375e-01   +8.558034320083021e-01   +5.542181809874978e-01   -3.979674690276663e-02; -7.307218193873913e-02   -4.902275208132520e-01   +6.551146733782227e-02   +5.373270437671613e-01   +6.884578707619207e-02   +7.922770767256501e-02   -4.114127841291030e-01   -4.741298910915219e-01   +3.062982047367853e-02   +2.615003197715488e-01   +5.228798311363857e-02   +5.868596355655860e-01   -3.165872178037722e-01   +5.609696218159564e-01   +9.346674174210702e-02   -1.256625996495666e-01; +1.390587819007436e-01   +2.850707455351873e-01   +5.449681515273501e-01   +2.220594954562099e-01   -2.615607112051088e-01   +3.925444937093032e-01   +1.246852165593733e-01   +6.989376713889827e-01   -1.748698144085285e-01   -4.817685814072345e-01   -1.214582612524763e-01   +5.758031137676197e-01   -1.150353291624722e-01   -7.198465404294273e-02   +1.137384118068736e-01   +1.325838739803978e-01; +7.736223324939210e-01   -5.257922858652053e-01   +6.691490433437619e-01   +5.107738434003705e-01   +6.873804471560092e-01   +5.503757801636024e-01   -5.003375233984911e-02   -6.436792835918480e-01   -2.273853540451258e-02   +4.231063420100786e-02   -6.128992247091297e-01   -5.903537529321190e-01   -2.206430218494237e-01   +7.033017102895653e-01   +7.883888721574249e-01   +5.859041090905109e-02; +5.338623853174886e-01   +5.841383588231098e-01   -1.082780677504946e-01   +5.184924284366339e-01   -1.334609399493756e-01   -8.105666269468065e-01   +3.298834562724449e-01   -6.068056514700784e-01   -6.393752678596940e-02   +4.807013305679658e-01   +3.776903946264255e-01   -1.888273200900464e-01   -7.558120057407224e-01   +2.286598213087590e-01   -1.000000000000000e+00   +4.297669880523916e-01; +1.257416845805885e-01   -1.218688851642006e-01   -6.522806662486832e-01   +1.502278620861960e-01   -5.145449057069043e-01   +6.779077607872779e-01   +2.464918073917118e-01   +5.027243058828834e-01   +6.117777385743250e-01   +3.370633040228736e-02   -2.775741176575781e-01   +7.571891989704264e-01   +3.651952748766427e-01   +5.064541672205749e-01   +5.859956373941982e-02   -2.074154964943256e-01; +4.062031686231740e-01   +4.302905043806585e-02   +2.447878743970244e-01   +8.883688428401867e-01   +9.663303053056275e-01   -5.901884406427414e-03   +8.332703023533440e-02   -2.600481489892677e-01   +5.407440589970206e-01   +5.069197212091182e-01   -1.182501988935871e-01   +2.076836551339753e-01   -6.343375462409472e-01   +9.466814217578219e-02   -2.903293725061634e-01   +3.902721305796596e-01; -1.984932412484929e-01   +1.496201685295105e-01   -8.009854910551221e-01   +5.415286163017548e-01   -3.685794110035901e-01   -1.254166020600264e-02   +1.360169866094379e-01   +3.824405765656082e-01   +6.727111149597798e-01   +1.101492431751485e-01   +1.241065028084059e-01   +5.921876862457036e-01   -9.218912957436081e-01   -4.694726549834948e-01   -3.554195789582755e-01   -2.468757828265186e-02; +3.379506013580429e-01   -4.762113297081532e-01   +4.696295946363244e-02   -8.706467401814556e-03   +3.580541068291933e-01   -9.661940123782492e-01   +2.223162759746187e-01   +8.169614613814596e-02   -3.715662857433146e-01   +6.082991804968816e-01   -3.027960233229879e-01   -1.596722448981986e-01   +7.569120589375944e-02   +2.429702925258056e-02   +2.667718032694814e-01   +5.501942850433951e-01; +1.846025866183789e-02   -4.357801189463948e-01   +7.323010209209468e-01   -6.311987786994823e-01   +3.942724018862902e-01   +6.940901628989857e-01   +4.911930855688745e-01   -6.823222114300261e-01   +4.495815226181035e-01   +3.791674654173096e-01   -3.892351189294479e-01   -1.271408331567828e-01   -2.952118015276310e-01   -4.168037001983538e-01   -5.846920078920679e-01   -3.642306263215306e-01; +3.925686559192346e-02   +3.959457508428654e-01   +1.117059247208402e-02   +1.228027675223819e-01   +3.187443918518600e-02   -6.694930823968805e-01   +7.397176929539940e-01   +1.791486467213616e-01   +2.505365551039913e-01   +1.348980940095184e-02   -2.318573046050489e-01   -4.917074672250174e-02   -5.199306348418715e-01   +2.485509946209769e-01   +7.555321330653469e-01   -4.309983912421105e-01];
L2I_L1I_iGABA_netcon = [-2.411364591752224e-01   -5.062296293850045e-01   +4.856600188534917e-01   -7.895945291810060e-01   -5.882523558802906e-01   -7.476795256563482e-01   +6.191447869208820e-01   -6.672366045528334e-01; +6.729188779769888e-01   +6.401945595978733e-01   +4.771453136854029e-01   +6.309654991482478e-01   +3.571143679674323e-01   +2.320579870282825e-01   -2.433320874960387e-01   +2.186579864747577e-03; -4.895673381011338e-02   +4.039465505689313e-01   +9.220543418499422e-01   +5.694056925021695e-01   +5.225268328716297e-01   -2.540971869617646e-01   -4.434897774460640e-01   -4.063441312157302e-01; +7.189612072337085e-01   +5.201932341762295e-01   -5.541302367341010e-01   -9.808874575691987e-02   +6.117691456594552e-01   -2.023139327984652e-01   +9.190442883318495e-01   -5.550693441085889e-01; -7.218079248772504e-01   +4.436905369672185e-01   +6.895129871456644e-01   -4.798170737561712e-01   -1.339681522951875e-01   +6.506904753012586e-01   -3.752256624571403e-01   +6.014606374131205e-01; +3.523661672190211e-01   -1.504319294837963e-01   -8.331216544395645e-02   +1.401718206356142e-01   -2.562180907133912e-01   +1.816530452611375e-01   +7.053901701949278e-01   +4.458926649715213e-01; -3.678745480902593e-01   +8.638222659669417e-01   +6.697658798717769e-01   +1.837352933787961e-01   +7.136856866059836e-01   -3.229106418332393e-01   +3.476620005252811e-01   -4.238420607567198e-01; -4.108543919449944e-01   +3.668219253053193e-01   +5.227770811595401e-01   +4.889655069991476e-01   +2.403775936857043e-01   +1.245213027451320e-01   -5.692450885586788e-01   +8.040909117557329e-01; +5.520440196940722e-01   -3.940164392942739e-01   +6.946569410358175e-01   +4.625980518088428e-01   +7.301107543472605e-01   +2.799073223103712e-01   +6.596557755600992e-02   +6.456618702193488e-01; -4.502448728570050e-01   -5.827993402864428e-01   -2.566540955330128e-01   -5.108941346573671e-02   -6.384904014948711e-01   -2.874858068811514e-01   -8.129258541681779e-01   +1.414777440309815e-01; -3.556905644065287e-01   +5.158004765743178e-02   +6.998651443356751e-01   -8.630031385129112e-02   -5.306278954375212e-01   -6.054833648765532e-01   -3.395009388592705e-01   +1.771673234453354e-01; -2.790927439284890e-01   -6.370331497138071e-02   -3.635119718611206e-01   -3.021654014395316e-01   -7.280285130171857e-02   -7.433887858512427e-01   -5.599148774055591e-01   -1.378753848006297e-01; +1.955029985340042e-02   -1.110888011745994e-02   -5.190328358187947e-01   +6.930047010252728e-01   +5.573239333196815e-02   +5.229813920610649e-01   +5.715454574531545e-01   -1.035613733704691e-01; -5.668717078203129e-01   -9.752713351432339e-02   +4.216968093672901e-01   -3.491180410675693e-01   +2.539024240180968e-01   +3.472162830692471e-01   -3.481679341781728e-01   -2.994372190367504e-01; -4.226790950178420e-01   +7.898111374351771e-01   +2.373353543598205e-01   +6.374646707060476e-01   -4.381976385575520e-01   -5.600710809273056e-01   +8.185298327391875e-02   +2.182164296195764e-01; +4.158062647720012e-01   +1.000000000000000e+00   -1.428723762069987e-02   -2.983962808119016e-01   -1.529790965680185e-01   -9.030788681365302e-02   -9.827297925446167e-02   +6.737109990374168e-01];
L1I_L2I_iGABA_netcon = [+2.816227966564349e-01   +7.560444829202649e-01   -5.691076709239967e-01   +6.737050937950854e-01   -5.528729261191466e-01   +6.471081766727946e-01   -2.418545846007358e-01   +6.488241758286883e-01   +1.332770364040114e-01   -3.709791492965332e-01   +4.884391251485006e-01   +1.374009887324769e-02   -5.369638601688186e-01   +7.047455739020425e-01   +3.138753329546718e-01   +1.707783556201905e-01; -8.754512423251456e-01   +2.936806864117934e-01   +2.250380582911682e-01   -2.418797499664426e-01   -7.864836078405071e-02   -2.388932653184015e-01   -4.108731399913478e-01   +1.719268112147785e-01   -5.447012595834856e-01   +7.805650831776807e-01   -1.000000000000000e+00   +1.912369644658281e-02   -1.187253586977288e-01   +5.574140271015088e-01   +1.943945963073316e-01   -4.923519778729765e-01; +2.930410418840034e-01   +8.966555672926797e-01   +2.422657137070622e-01   -1.471579630259296e-01   -2.015357989428191e-01   -2.992314075800026e-01   -5.179508325585648e-01   -7.122473442329058e-02   -5.621581094171898e-01   -8.187342942225306e-02   +2.455542483904921e-01   -6.801481426949180e-01   +5.934522870598954e-01   +3.294868048178068e-01   -4.774138188769032e-01   -4.696091607128322e-01; +2.402846709709398e-01   -3.413358057721310e-01   -4.225473833161034e-01   +2.535088597761191e-01   -3.947742028990183e-02   +5.474727704183704e-01   +2.747831461355541e-01   -6.709948328172727e-01   +2.450435029266668e-01   +2.025375263847155e-01   +4.108172979765196e-02   -9.047704686690631e-01   -9.353475580779259e-02   +1.261963963335647e-01   +9.893545508829547e-02   -6.569790047224486e-01; -3.682127858121661e-01   +2.765935582001799e-01   +6.696488492818595e-01   -4.777535055174184e-01   +7.642898734538418e-01   -5.177750671492406e-01   +6.168162125683374e-01   +2.749189936021945e-01   -5.086895260126610e-01   -2.468733241276032e-01   +9.736590018588183e-01   +4.792492231743287e-01   -3.390496955169579e-02   +3.207198621798426e-01   +5.080085704945239e-01   -5.255591322183797e-01; +2.429871205022810e-01   -5.984321671530164e-01   +2.083509442205822e-01   -7.081580199132574e-01   +4.222498701688234e-01   -3.566237683705338e-01   -5.232109198659367e-01   +6.414369680320823e-01   -1.002192298940994e-01   -3.725827389937023e-01   -5.497394013631997e-01   +5.134118925990191e-01   +3.747841977732275e-01   -5.709993397993458e-01   -4.938557780819630e-01   +3.905038546197338e-01; -2.962317005205732e-01   +2.593598357974722e-01   -4.685097262972036e-01   +6.510878794996239e-01   +7.611864016296566e-01   -6.444076289844047e-01   -5.838850926253879e-01   +2.441071173349089e-01   +5.182965867608080e-01   +4.492500197286690e-02   -6.044905267793375e-01   +7.561816498110612e-01   -4.745751096786259e-01   +7.946878263168517e-03   -9.642361753922284e-02   -1.394876159737941e-02; +4.142954702629271e-01   -6.394884619512779e-02   -1.314851266918099e-01   +1.399508433414350e-01   -3.196015220213568e-01   -5.495822908644649e-01   -2.470595308310028e-01   -5.467143924302242e-01   +8.573805036868732e-01   +2.223910856304600e-01   -1.715715338166883e-01   +1.167249023935457e-02   +1.458909682719293e-01   -4.343865702462429e-01   +5.464374275663577e-01   -2.362491903808355e-01];
L2E_L1E_iAMPA_netcon = [+2.228873322653719e-01   +7.973229525195142e-01   +4.664314879839417e-01   -6.861243310153925e-01   +2.559205832902350e-01   +2.139441851528472e-01   -2.444853075843143e-01   -1.929470896441726e-01; +4.571289483840730e-01   -2.991393965329352e-01   -2.869537646817240e-01   -5.891490531462003e-02   -2.075941635211464e-01   +3.097927173790638e-01   +7.336015230180067e-02   +1.000000000000000e+00; +3.273621581573221e-01   -6.201890704469950e-01   -8.351387990019321e-01   -5.769125926946159e-01   -5.161480438853504e-01   -2.137487541442995e-01   -7.518653834266177e-02   -4.310539103593582e-01; -7.818568881292232e-01   -1.549465717572241e-01   -2.875345959649361e-01   +5.040883033312842e-01   +2.664417435721470e-01   +7.722812168156816e-02   -2.567497681699801e-02   -3.425074209946819e-01; -5.166805017502272e-01   +5.297949405011686e-01   -6.671211655605852e-02   +8.185586080235823e-01   +4.227821389103127e-01   +1.640902909485118e-01   +5.456765688370808e-01   -5.295101524011692e-01; +4.949972218081596e-01   +2.373755095167192e-01   -2.460547615367092e-01   -1.792501826863154e-02   -1.214351428193660e-01   +4.141246060661583e-01   -5.565714752500202e-01   -2.762655014568300e-01; +3.137378465071263e-01   +8.402227253962188e-02   -2.608113859199698e-02   -3.592112171845029e-01   -1.481638616999940e-01   +3.724950344629678e-01   -8.506206492088367e-01   +7.603823407789807e-01; -2.097887711904741e-01   -5.753205551387819e-01   -7.172474034906481e-01   +2.972544933216114e-01   +6.213026699543118e-01   -9.269591063301262e-01   +2.027582847677090e-01   +2.064215405100909e-01; +1.756222527596232e-01   -6.507987716727900e-01   -5.757114844398925e-01   -3.528656664425173e-02   +7.046778326030376e-01   +3.260602675777591e-01   +7.153226162049068e-01   +8.944990527293185e-01; -4.863154803566690e-01   -3.128677504719846e-01   +2.480997767491829e-01   -5.283186206829616e-01   +7.149606483929175e-01   -1.953901252771864e-01   -2.251327189957587e-02   -2.440982154956629e-01; -9.288787686174145e-02   +4.686199997889166e-01   -4.552524217125856e-01   -6.449858089863293e-01   -5.190091289824021e-01   -7.415315789647237e-01   +5.951372880483744e-01   -1.845451659851607e-01; +1.870470576115740e-02   -1.409061963339198e-01   +1.685608895821781e-01   -2.009224959582117e-01   +8.918925795946498e-01   +2.265097963336675e-01   +1.658769082875516e-01   -3.132789139766875e-01; +4.471470894923549e-02   -3.305138586317380e-01   +3.780966720721269e-01   +6.130090650309915e-01   -5.066371192044775e-01   +1.977245473321635e-01   +2.198161264901496e-02   -3.406856028928531e-01; -4.457767297428850e-02   -1.326162167007674e-01   +3.213065520918499e-01   +4.025251265960830e-01   -2.573160700534344e-02   -1.802651189905342e-01   +8.302681419444471e-01   +5.284488501056861e-01; +5.492420339751957e-01   -4.535773834862106e-01   +2.739798124778434e-01   +2.507842715290663e-01   +7.121053730246506e-01   -5.588123460172553e-01   +1.543565788341263e-01   -9.982504086347896e-02; +1.982767080087569e-01   +5.826361114064651e-01   -1.328588759122394e-01   +3.295837202635128e-01   -5.876881392832674e-01   +5.687997043037141e-01   -6.781065770354666e-01   -2.349714732580825e-01];
L1E_L2E_iAMPA_netcon = [-1.870396312399767e-01   +5.697093963818874e-01   -5.725039766363110e-01   -6.651531471423401e-01   -1.952277175738963e-01   +8.170471637046416e-01   +8.170384725148939e-01   -2.861547700360312e-01   -2.687173905501927e-02   +5.032434818834888e-01   +5.443273967620467e-02   +8.875846168138809e-01   -6.137654355073232e-01   -1.756990519316416e-02   -3.572352376185218e-01   -3.021516420120103e-01; +7.614915764335465e-01   -7.689957753458644e-01   -5.211166434241877e-02   +3.259911471382668e-01   -2.537650081148635e-01   -4.374212301997774e-01   +6.239409382758369e-01   -5.404326285340695e-02   +8.284964619257916e-01   +6.717085130873790e-01   -6.440673800392800e-01   -1.767595749894399e-01   -6.245520300190488e-02   +1.000000000000000e+00   +5.031391436831423e-01   -4.615266484954563e-01; -6.532694227298083e-01   +4.064620669913839e-01   +2.664241805465377e-02   -6.477272418774586e-01   +3.642649284084933e-01   +5.120919399034227e-01   +3.455333609368750e-01   +5.058820125746513e-01   +1.111772850569339e-01   +5.575448444694341e-01   -1.106332444361544e-01   +5.534520752955100e-01   -9.492779867275343e-02   +1.504078909255686e-01   +6.733675543630926e-01   -1.679941788167336e-02; +4.289200430206014e-01   +6.046191197895017e-01   -7.331906807794221e-02   -3.604411319169182e-01   -2.009717414519885e-01   +5.252439749400843e-01   +2.313562705678114e-02   +3.730368414246475e-01   +5.646448256155517e-02   +2.593304300465801e-01   -1.494634838036150e-01   +2.965725747029210e-02   -6.012916172597774e-01   +8.113473258200079e-01   -3.336851748835895e-01   -9.105269781979702e-02; -1.423445801747807e-01   +2.490692853681839e-01   -5.864792421323149e-01   -8.133634862039122e-01   -9.114136054808685e-01   +8.699768543725447e-02   +5.169059873897707e-01   -2.702747916084356e-01   +4.026228986960522e-01   -7.294886901111340e-01   -7.597662746213091e-02   -5.412182721477060e-01   +6.702089777715904e-01   +2.520469862224067e-01   +2.577484617996675e-01   +2.487342151568436e-01; +1.653720438622868e-01   +5.360652776188876e-02   +8.653960037123666e-02   -2.301103802520235e-01   +1.425663349370365e-01   -4.352226642350446e-01   -2.377738758740201e-01   +3.731736992967116e-01   -1.095202630829869e-01   +5.535063607911386e-01   -8.924835009915121e-02   +4.452742014538434e-01   +1.195123756785295e-01   +4.185389889193926e-01   -4.469442915365167e-01   +1.580593941870189e-01; -3.243143514461928e-01   +9.622678003829724e-02   -2.179959628579984e-01   +8.247464632313639e-01   +3.632450134614876e-01   +6.003394820101366e-01   -6.617585427873608e-01   +5.682667213970461e-01   -5.240913869739305e-01   -1.390778393457253e-01   -1.762795222303972e-01   -4.622307102015739e-01   -4.873397418250381e-01   +1.388286628921640e-02   -1.015832981892854e-01   +1.154243199558793e-01; +6.244781141805952e-02   +2.466529042038605e-01   +8.171345200249902e-02   -1.480325594408828e-01   -2.985413594610303e-01   -7.318564653058006e-01   -1.154613922033906e-01   +3.708865136394618e-01   -2.219037034867977e-01   +4.310728002474441e-02   -3.576494227399993e-01   +4.973237269527135e-01   +5.424684057711604e-01   -9.852641373832705e-02   -1.673543924474014e-01   +1.880311578812843e-01];
L2I_L2E_iAMPA_netcon = [+7.807741584205404e-01   +5.661502936863722e-01   -2.473683476010524e-01   +5.322719919395540e-01   +5.556929432966242e-01   +3.792334802086827e-01   +6.151820559312041e-01   -7.626412293983646e-02; -2.374107831237368e-01   +5.133847019059911e-01   -1.964616601721936e-01   +5.336014130204897e-01   +9.247017408619644e-02   -4.225729983711288e-01   -7.080038599490913e-01   +5.823768609782987e-01; -6.858040817539271e-02   +5.008595571147400e-01   +2.963416882333878e-02   -3.925627096001471e-01   +7.760871131921931e-01   -2.816685353237829e-01   +8.204567554310355e-01   +5.286263626681578e-01; -1.058890601383098e-01   +8.071054561906567e-02   +5.657475915047249e-01   +5.136714051182719e-01   +2.831481234713342e-01   +4.023247689516089e-01   -1.011592922290545e-02   +3.159716349149361e-01; +2.773410430898215e-01   +2.276542908783843e-01   -1.983505810336878e-02   +8.108169225710873e-01   +3.040179294300644e-01   -3.823340703757143e-01   +1.000000000000000e+00   -4.243987124056361e-01; +6.287671578478612e-01   +3.266299196735308e-01   +2.678498182142349e-01   -5.221363714107158e-01   +5.556915941474876e-01   -6.102701603853140e-01   +2.281081619499134e-01   -9.070771991773148e-01; +6.476768138687341e-01   +7.145735725256155e-01   -6.119552325616374e-01   +1.738656385643381e-01   +3.137886453079773e-01   +5.306049024707640e-01   -3.574394979997664e-01   +3.392917807091886e-01; -8.309226104292575e-02   -3.531166400494882e-01   -4.935146910101604e-02   -1.498757823676050e-01   -3.446081681534492e-01   -6.056060664335743e-01   -6.846254200146146e-01   -3.200181372574997e-01];
L2E_L2I_iGABA_netcon = [+3.085890827704635e-01   -8.847452278162398e-01   +2.820966374755601e-01   +5.926074836545178e-01   +4.946140689280673e-02   -1.313441052256482e-01   +6.402382292655141e-02   -2.564681786952298e-01; -6.266385089046208e-01   +1.213732486541501e-01   +5.243564768684782e-01   -4.278655586953674e-01   +3.562072650448659e-01   +8.537471383499474e-01   -1.167848140174488e-01   +7.393578209625240e-02; +3.373228589402777e-01   +1.916741641737768e-01   +1.575442066009322e-01   +1.143585412985953e-01   -3.043471165431718e-01   -1.356881295892398e-01   -8.635731832803369e-01   +6.983909872356003e-01; +3.738497212983301e-01   -7.825407644298286e-01   +3.116219552574868e-01   -6.651667548671779e-02   +8.970924431417436e-01   -8.083209060448578e-01   +8.599548908220437e-01   +8.990893023060606e-02; +7.297101578764780e-01   -3.881571935722036e-01   +9.163259707368752e-02   +9.130260070814837e-01   +1.519276571461719e-01   -2.361867398515891e-01   +8.119654471086879e-01   +5.052778472442743e-02; +2.395881812708632e-01   -5.338640847405404e-02   +4.011670393194769e-01   +6.220773116314058e-02   -6.136437654691131e-01   -8.658820974239022e-02   +2.697804934011654e-01   +1.199869262886554e-01; -4.924395802137182e-01   -6.350200311563802e-01   -1.000000000000000e+00   -9.240626084924644e-02   -6.033262541681433e-01   -3.138247148921678e-02   +8.207340550603643e-01   -4.255654656632052e-01; -1.009666761667024e-01   -7.457244660231577e-02   -8.769977672923454e-02   -1.816474048817184e-01   +5.625661579467499e-01   +1.112985156597085e-01   +5.051337107991338e-01   -2.967784234071418e-01];
L3E_L2E_iAMPA_netcon = [+7.607441316502914e-01   +6.643322887448543e-01   -1.284913546689721e-01   -1.809633518288064e-02   -2.147931205161194e-01   +4.927382143187286e-01   -1.000000000000000e+00   +3.063640020190451e-01   +1.391866064039929e-01   +4.727069121609651e-01   -3.609677104966998e-01   +6.818690670716945e-02; -2.562540324347464e-02   +8.871060314707344e-01   +9.367550991187866e-01   +7.496933873521118e-01   -7.597255766500592e-01   +2.591507283341809e-01   -4.288412667396176e-01   +6.581136447442177e-01   -2.201482998842391e-01   -2.366055482484662e-01   +4.715151806902153e-01   +1.856059608575320e-01; -2.900700435307448e-01   +4.318124113729771e-01   +3.728619646967475e-01   +5.416686016143106e-01   -3.737193503511654e-01   -4.289599819134582e-01   +1.444344233808112e-01   +6.685942076038476e-01   +2.151803873644125e-01   +5.527210343824538e-01   -5.255142162977309e-01   +2.945393520217179e-01; +3.583133302335954e-01   -9.141332346518197e-02   -3.405941717357325e-02   -1.756323523076672e-01   -5.142557564464717e-03   +1.770708498286998e-01   -5.815499466599909e-01   -1.655247704213949e-01   +9.198900956834275e-01   +4.501934128682031e-01   +2.237724719343388e-01   -9.409344654552149e-01; -6.210994220076457e-02   -1.038964455105250e-01   -4.578111544131315e-01   -1.067308163863389e-01   +3.673751616735121e-01   -4.266343637236601e-01   +8.148467966617561e-01   -4.732205690771703e-01   +1.225726973846786e-01   +1.799312537069904e-01   -2.721093889405030e-01   -4.116073082687708e-02; -1.991538562717401e-01   -6.301521977993068e-01   +4.667479577831034e-01   +9.329400158114558e-02   +5.546659291110245e-01   +3.398040995069818e-01   +4.066151862298075e-02   +5.470456544903196e-01   +3.549047040422085e-01   +9.316994769976526e-02   -1.745378245291552e-01   +7.457751450627946e-01; +7.110986754338483e-01   +2.459027495518000e-02   -3.984782094778376e-01   -2.403089583687246e-01   -3.510025681037899e-01   +2.527004776906985e-01   -6.785551453164020e-02   +1.623155903114124e-01   +1.054431409575641e-01   +3.144711491430781e-01   +5.663187713229579e-01   +3.447349801703197e-01; -3.174953336069538e-01   -8.684037384450231e-01   +6.629479016756048e-01   +3.952526480301547e-01   -3.487141858915050e-01   +5.793687640455318e-01   -2.488366854005570e-01   -6.183829823846850e-01   -4.675098246384156e-01   -1.382451894751368e-01   +1.933113793384282e-01   -5.599863771157928e-01];
L3I_L2I_iGABA_netcon = [-3.046951375901070e-01   -3.325395740374813e-01   -4.294523032028634e-01   -1.235101489741052e-01   -5.690249314251589e-01   +3.976093812783430e-01   -1.095336687407645e-01   -5.977358214857705e-01   +6.886745457213928e-01   +3.433194290762651e-01   -8.376439208234506e-01   -4.087088822358310e-01; +3.332623352356269e-01   -7.815475092609122e-01   +7.504643777705804e-01   -7.772628129272088e-01   +1.897040059114793e-01   +2.731010919212541e-01   +1.000000000000000e+00   -2.917490107404644e-01   +8.218276274287488e-01   +5.845721080288355e-02   +4.668732583919243e-01   +3.049231094568949e-01; -1.490155678213849e-01   +5.029585203410564e-01   +1.444212451853093e-01   +3.674117690088462e-01   -3.779404527935740e-01   +8.268902375301316e-01   +8.457555519500288e-01   +1.275241517627233e-01   -4.314820795218630e-01   +5.273359997107827e-01   -3.437673915190829e-01   -2.470534428541984e-01; -2.076638072821528e-01   +8.961198645987527e-01   +5.826682634938788e-01   +2.680692891460290e-01   -6.298876052084890e-01   +6.884557594877237e-02   +7.922603917456901e-01   -6.525938639271419e-01   +7.198594654481857e-01   -6.747300919877071e-01   +8.094995829886610e-01   +5.701404102767145e-01; -7.614770717463383e-01   +4.263643481367793e-01   +6.342534571750046e-02   -3.167399522479102e-01   +4.615781425496446e-01   +9.823011752682987e-01   -7.292112290842098e-01   -4.928495945345659e-01   +6.520559482124980e-01   +6.254377438292760e-01   +5.307411663593834e-01   +1.235585600961679e-02; -5.923175470306670e-01   +9.651015835477819e-01   -9.217293256609000e-01   -8.209515509041619e-01   +6.406635404269506e-01   +2.470566132566624e-01   -2.790738735415349e-01   +5.816516564992423e-01   -4.475086391257094e-02   +8.082081564643694e-01   -6.102861526838393e-01   +7.887948850651615e-01; +7.782877432783961e-01   +4.427031352609427e-01   +1.150661017219686e-01   -7.558242052414966e-03   -1.182505178204429e-01   -2.797491215871869e-01   +5.990753744085809e-01   +8.176217530939607e-01   +5.706730906858637e-01   +4.744148984407426e-01   +1.099649968196848e-01   -8.314220292909928e-01; +5.911910452855649e-01   -8.871137532547616e-01   +4.788725500024069e-01   -2.417713754147649e-01   -3.282745657996446e-01   +3.846981415783816e-01   +5.040271497843509e-01   +3.228826505029879e-01   -7.576840390188987e-01   -1.174155039973869e-01   +3.003909337600533e-01   +3.275711358412256e-01];
L2E_L3E_iAMPA_netcon = [-2.008467357851537e-01   -6.308430386987705e-01   -1.440423761956092e-01   +5.874064261357629e-01   +8.088791175100043e-01   -1.230606981367931e-01   +4.250875275842487e-01   +3.328834495988804e-02; +2.740936923278326e-01   -1.261301581875142e-01   -1.043478321657548e-01   +2.127849092040159e-01   +5.838932062623837e-01   -3.689148735830078e-01   -3.545108679535829e-01   -2.584469003736332e-02; -4.332506493986182e-01   -6.930430331206167e-01   +4.711451742167143e-01   +2.248843557753758e-01   +5.360036675268637e-02   -2.389339832040463e-01   -5.407873585098877e-01   +7.388210309661645e-01; +3.983483507036836e-01   +4.562471687528873e-01   -9.965402491698813e-01   -8.999346363590437e-02   -2.889106952348356e-01   -3.633469303054978e-01   +1.869887565216553e-01   -6.164747869907529e-01; +9.457703524425072e-02   +8.745131456351978e-01   -7.313975641304705e-01   -4.297479831708425e-01   +8.789297752563668e-01   +6.324029415560818e-01   -3.183439174073771e-01   +3.195283077241113e-02; +7.391675490683313e-01   -1.936771797164358e-01   +8.182857200252615e-02   +3.571311114639211e-01   -4.824577492993018e-01   +1.937471106280798e-01   -3.172930019729578e-01   +1.474826580052644e-01; -8.749392713295567e-01   -2.136664067947411e-01   -5.368410794177642e-01   +2.433934519657664e-01   -3.758102598220375e-02   -8.806761211921179e-01   -5.207324618574863e-01   -2.600858102703663e-01; -1.571567974754847e-02   +1.802900172279259e-01   +7.018957168646240e-01   +6.525045218342419e-02   -2.376519187200362e-01   -4.043452348326284e-02   -2.746284781979507e-01   +8.692865557770513e-01; -1.158411129432431e-01   +6.862245560991462e-01   +1.832025475327757e-01   -4.187270619236738e-01   +5.010560806633544e-01   -2.941897784161080e-01   +2.016656297689074e-01   -3.705376035895300e-01; -1.211615633669189e-01   +2.974071185179753e-01   -4.151720029655391e-01   -4.420974097221631e-01   -1.000000000000000e+00   -9.516951146084746e-01   +3.575917394112869e-01   -6.791914077107252e-01; +1.412694785950437e-01   -7.898425331688547e-01   -7.473967065687539e-01   -3.229689001952655e-01   +2.475172258385792e-01   -1.221433022590323e-02   +3.524971019963451e-01   +7.054737478047792e-01; +1.376308340356419e-01   +5.508744375733085e-01   -5.654558693577787e-01   +2.327636654353515e-01   -3.401847557832434e-01   -3.552646305558567e-01   +2.714972226786257e-01   +1.096171318947262e-01];
L2I_L3I_iGABA_netcon = [-5.698657703125119e-02   +8.810460310702504e-01   +3.003374879967747e-01   +5.438103567974759e-01   +2.743223071449779e-01   +6.071188706890925e-01   -4.696752140123089e-01   +8.460684981386331e-01; -8.310609153776961e-01   -7.338193525155079e-01   +2.464715353348547e-01   +7.974524825721790e-02   +7.133825226094898e-01   -3.993960585983819e-02   +4.216042547012037e-01   -5.357539535703838e-01; -4.142877605251916e-01   +4.471504065753651e-01   +2.453384065906896e-01   -2.247337753945992e-01   +8.295788070054350e-01   -6.487308763669452e-01   -4.403978208563893e-01   -2.303642251926550e-01; -6.298276139950183e-01   -2.319909131292643e-01   +3.265666158737054e-01   +3.261293882342016e-01   +2.126912269342541e-01   -4.011575373259993e-01   +5.741484903821896e-01   +3.867246861592966e-01; +6.200739734327412e-01   -1.114631406146021e-01   -6.995684328024443e-01   +4.140229407786548e-01   -4.109320503668802e-02   +3.616258465876469e-01   -5.606140480338841e-01   -3.761904935758956e-01; +5.195836536145183e-01   -5.287413776626594e-02   -6.190432827529049e-01   +3.790729431925312e-01   +8.842451415297352e-02   +4.435583273897891e-01   +2.287127601369758e-01   +6.751617060072327e-01; -2.958897339831738e-01   +3.341600933755521e-01   -4.409328957094882e-02   -1.741951176434373e-01   +6.727331130090486e-01   -1.473489386361154e-02   +2.078159319602549e-01   +8.869826142646414e-01; +4.561192336499781e-01   +6.930966706372896e-01   -2.979369421331362e-01   +5.145838314223729e-01   +2.273662318974571e-01   +3.333403420282778e-01   +2.670258499258208e-01   -1.229089244128801e-01; +4.128346238290714e-01   +1.000000000000000e+00   +4.410381634325344e-01   +4.081376975457394e-01   -1.995896059978081e-01   -1.874602822043226e-01   +9.122594224742583e-01   -1.082587816556617e-01; -5.885280684753599e-02   -1.830043659247863e-01   +2.329549670886106e-01   +3.125995525697553e-02   +1.003607969709971e-01   +6.341144401198417e-01   +2.993365005500933e-01   -7.022386454956961e-02; -3.581192533822473e-01   +4.366109818933341e-01   -3.180232648307389e-01   +9.860894874471852e-02   -2.434636471995492e-01   -3.742577405063488e-01   -3.906622251049605e-03   -6.815250139820448e-01; -2.868485997080479e-01   -8.830652691820377e-02   -5.473272085098381e-02   +6.455955036766959e-01   +2.987005425769099e-01   -5.675804268067288e-01   -7.476077440838043e-01   -4.495698650648458e-01];
L3I_L3E_iAMPA_netcon = [-1.173733644123232e-01   +1.862058096520731e-01   +3.817077564508630e-01   +7.650564909282266e-02   -2.617883886296981e-01   -3.170943879193447e-01   +2.096689455813764e-01   -4.054975971640482e-01   -3.789477852517245e-01   -6.961143925623491e-01   +3.440289720138595e-01   +6.010761468651016e-01; -1.058661557597982e-01   +1.726454481012097e-01   +9.659461063783900e-02   -1.813543079401837e-01   +5.547419254770706e-01   -1.184527134207994e-01   +5.289562977129293e-01   -5.176742542178088e-01   +2.547208178885439e-02   +1.796702866430015e-01   -2.674497306516077e-01   +4.221009591195601e-01; +1.841019944193894e-01   -1.310909209840564e-01   -4.701127655710579e-01   -1.790839003713951e-01   +4.807335844235224e-01   +1.812592383379339e-01   +3.672293590952952e-01   +1.694951339778264e-01   -2.159808818202557e-01   +6.885559923990323e-01   +4.830845242106185e-01   +3.112560993804300e-01; -2.522765487066560e-01   +7.333617021090711e-01   -5.678086083572832e-01   +2.460416792765507e-01   +3.043087582913022e-01   +5.608494324755912e-01   +3.210401351062918e-01   +3.693461448553342e-01   +4.841170361830150e-02   -1.169060878086256e-01   -1.838755451409625e-01   +4.034533730958987e-01; +1.947600442295812e-02   +1.999853637415446e-02   +3.742669855671565e-01   +4.361412825456208e-01   +5.404785872218463e-01   -5.916869176305292e-01   +5.474011070426935e-01   -8.406873946067558e-01   +7.054788458174882e-01   +4.583894321452666e-01   -2.536535262008332e-01   +2.665298833734230e-01; +1.520600947838234e-01   +6.090239736769620e-01   +6.541349101184082e-01   +4.398323426641488e-01   -5.101620742128182e-01   +5.192542206874184e-01   -3.334718380659229e-01   +7.457732266190592e-02   +2.398612958671567e-01   -8.180538745751197e-02   +6.710464689443016e-01   -5.005203431510497e-01; +1.000000000000000e+00   +2.311034941663865e-01   +4.549025621598402e-01   -1.982036679839538e-01   -3.966948490996319e-01   -1.079434218201951e-01   +5.175452023900711e-01   +9.871964698065191e-01   -6.754193770825727e-01   -4.748922415662908e-01   +4.657611250237852e-01   +2.026079190687979e-01; +7.386934269474992e-01   -8.238990160097911e-01   +4.235218793790401e-01   +2.185234005949176e-01   +4.732676602016849e-01   -3.874878285616482e-01   +4.346545166474123e-01   +2.666686311029297e-01   +4.759858524847657e-01   +2.502416920667939e-01   +5.417982982441599e-01   -2.016612030484576e-01; -2.379966415632095e-01   +6.013684393165095e-02   -4.849554688095837e-01   +3.233882217741331e-02   -2.503648920177166e-01   -4.184376375612139e-01   +9.049590611693760e-02   -2.207650336858814e-01   -3.537183445962799e-01   +5.033050274188045e-01   +3.929360260466499e-01   -4.207078873957077e-01; -2.229741809542350e-01   +5.493246685784093e-01   -2.868490864575255e-01   -9.985270295057826e-02   +3.814585293139360e-01   +7.665560734724578e-01   +2.521049203039571e-01   +1.311706289310531e-01   +5.285331021503901e-01   +6.704544226359521e-01   +3.692601199085380e-01   +5.965557240121567e-01; +1.312971028154759e-01   +5.046882268336279e-01   +2.839641756260594e-01   +3.886270212869365e-01   +2.779980557612259e-01   +9.133172902387844e-01   +7.113099171605066e-01   -6.450265881833538e-02   -2.571102529933315e-01   +3.952682266281999e-01   -2.691102244278577e-01   +7.203954048408505e-01; +4.666148798726194e-01   -2.055042181287627e-01   +2.588320180261950e-01   -3.537006740124710e-01   +6.760270701137899e-01   +5.066131888143149e-01   -3.327988174963371e-01   +2.580132205257569e-01   +2.594060148605722e-01   +5.652269371431042e-01   -4.097910436469002e-01   +1.287366680142466e-03];
L3E_L3I_iGABA_netcon = [+1.067971269198892e-01   -4.853258724331887e-01   +4.426501248548086e-01   -3.108527475493335e-01   -2.435604775652181e-01   -6.197633403845899e-01   +7.418246008391425e-01   +2.464610955659809e-01   -8.188902843309952e-02   +5.372817767116819e-01   +5.003477026284076e-01   -1.620413444134577e-01; +4.858156858394882e-01   -3.950008964705082e-01   -7.410673076318643e-01   +3.869366285908447e-01   +3.428989529321821e-01   -1.799622235267317e-01   +7.515748908300367e-01   +1.068064416004053e-01   +6.125448232966186e-01   +1.088389319841042e-01   +5.162755592094577e-01   -4.905757497443962e-01; +4.385222770901662e-01   +1.377909713388143e-01   -3.965830579979749e-01   +3.908951451711764e-01   -2.538655304398979e-01   -4.075445493699011e-01   +5.625901898102503e-01   +1.812375191342629e-01   -4.265205683922540e-01   +1.724810811247813e-01   -5.825610828672481e-01   -1.494866498346802e-02; +4.004212522954704e-01   -2.753747618590740e-01   -7.242986912753844e-01   +1.486553211981765e-01   -2.673899816416337e-01   +9.638724108873877e-01   -1.227854163419753e-01   -9.139686159088293e-01   +5.614289879263750e-01   -6.326865846858994e-01   +4.363561544088576e-01   +1.282243696087109e-01; -7.189412642830358e-03   +6.304533583556900e-02   -6.123470277559044e-02   +5.687922872776876e-01   -1.998875612744649e-01   +2.682543682041294e-01   +2.190275441813968e-02   +2.238889255129025e-01   +3.844363749148427e-02   -4.587973898539672e-01   -1.304155375195467e-01   -1.131437413168117e-01; -2.869337707046734e-01   -6.198019373171032e-01   -3.937532109220381e-01   -6.242303780086147e-01   -2.689610549090681e-01   +6.133405086091800e-01   +3.701817846641940e-01   -5.181882320800787e-01   -3.042670632574562e-01   +2.858149737949922e-01   +3.881841809222705e-02   +2.066790940033713e-01; -6.149638751947779e-03   -1.751114651051365e-01   +3.565408790137499e-01   -1.449659771257162e-01   -9.174125879049556e-02   +2.158525961237245e-01   -2.134876958415278e-01   +4.704916671779722e-02   -4.813110149442039e-01   -9.071974412716122e-02   +5.299895408254590e-01   -1.426443636889456e-02; +2.290145285704702e-01   -5.360809758278680e-02   -1.607929119456239e-01   -9.643128299512603e-02   +8.376588136289017e-01   -6.603892657025043e-01   -1.802830097864931e-02   +2.150973942970112e-01   -1.089639263968902e-01   -5.421033063402677e-01   -1.000000000000000e+00   -3.876972485684194e-01; -7.581705079797994e-02   +4.959901839731748e-01   -7.074608158438810e-02   +4.661251909452326e-01   +5.286490575522160e-01   -2.980674777739004e-01   +5.472625584762649e-01   -1.311425110697113e-01   -7.184417198664729e-01   +9.153739809459409e-02   +4.183193473318662e-02   -2.929544885842456e-01; +6.850509972854095e-01   -4.270718871697872e-01   +1.690861211152046e-03   -2.404453419947448e-01   +8.241663820253684e-01   +2.118649789089696e-01   -4.057352174573696e-01   +1.653704928798128e-01   +5.617938573196345e-01   +4.094083739641611e-01   +9.302633729850585e-02   +6.436497264292163e-01; +1.042320335497379e-01   -4.703830525588948e-01   +3.856565224700602e-01   +5.482807998685488e-01   +1.056564823150042e-01   -3.092996316838273e-01   -3.013840923704844e-01   -2.349714836871185e-01   +6.311422505977755e-01   +2.696131814346137e-01   +3.542103070318511e-01   -5.240413401949461e-01; -2.159168687089560e-01   +5.073426268091731e-01   +3.126758362092075e-01   -1.436992750841988e-01   +2.037632320585888e-01   -7.566577797845406e-02   +3.527248354847554e-02   +2.525192464292846e-01   -5.535132558035685e-01   +1.560387469474753e-01   +5.345713041297773e-02   +5.047652672692261e-01];
L2E_Input1_iAMPA_netcon = [+8.744689712795489e-02   +7.943870484624114e-01   -8.517045844594022e-01   +9.016379113402453e-01   +2.031029769328223e-01   -7.605241790443996e-01   +4.793608034363878e-01   -8.475111573192309e-01];
L2I_Input2_iAMPA_netcon = [-3.389853239785332e-01   +4.857161485674936e-01   +5.811382172956647e-01   -5.176520680960850e-01   +2.623512667011103e-01   +5.535450616974920e-01   -2.842575696253828e-01   +8.435696134047748e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
