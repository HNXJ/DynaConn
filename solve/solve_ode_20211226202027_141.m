function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.010210965415787e-01   +2.826617686918618e-01   +4.408552223042652e-01   -2.605704687357246e-01   -1.345065126471093e-01   -2.734337119471794e-01   +1.934753733142325e-01   -1.266988378651476e-01   +2.034326834953389e-02   +3.851342147642488e-01   -1.748359425726658e-01   -7.275776064450493e-02   +5.540754741891519e-02   -2.152373713087294e-01   +2.939781425023801e-01   -1.077984989550003e-01; -2.530322033247851e-01   +4.190178878843449e-02   -1.469114964582484e-01   +1.408690077245233e-01   +2.111132432753912e-01   -3.432885997320206e-01   +4.265353303210337e-02   -2.264200643775494e-02   +1.435426895296474e-01   -1.023492157370145e-01   +2.327411400061655e-02   +2.042265602900458e-01   -5.042600783306800e-01   -3.810002968821287e-01   +2.411401174195278e-01   -2.212303085506610e-02; +1.207712089775118e-01   -3.892806954546348e-02   -4.419453839263021e-01   +2.622923102870373e-01   +1.844092966641047e-01   +7.027879888339988e-02   +1.559676317895494e-01   -1.023283805103971e-01   +4.535039025193727e-03   +6.345732153112077e-02   +1.401300230155840e-01   +7.986484273451276e-02   -2.239653477594346e-01   +8.629582214901346e-02   -1.655043619806913e-01   +8.997922627683061e-02; -1.581620873683470e-01   +3.717849192836300e-01   +1.768705702024747e-01   -2.243361938221195e-01   -4.134392662738920e-01   +2.366144872725193e-01   +2.979856627312895e-02   -2.491130673261416e-02   -3.256051282712134e-01   -4.849641446329784e-01   +2.142433427982064e-01   +4.144063127512022e-01   -4.283349356911846e-01   +4.931088274734148e-01   +1.163371485880073e-01   +1.633311082079359e-01; +1.565001344503822e-02   +2.773908279529239e-01   +1.225175286994253e-01   -2.611353156790315e-01   +2.405877624180244e-02   +1.478527096958686e-01   +2.089436807457128e-01   -1.904647574276756e-02   -1.952344195872433e-01   -1.008307545330776e-02   +1.488128656252369e-01   -1.175041326254927e-01   -1.332897765154055e-01   +3.518904873117902e-01   -3.856851374069166e-01   -2.941306405825446e-01; +3.972697886620373e-02   -3.015530345882844e-01   +1.062849501651857e-01   +1.212197998042288e-01   +1.725214158126090e-01   +1.017125646398733e-01   -3.690335059667695e-01   +1.011944147270681e-01   +4.997544417262573e-01   +1.642075001308248e-01   +4.349508706799866e-02   +1.592340333809872e-01   -1.223219803382999e-01   +2.551227082299991e-01   -4.244584793794997e-01   -1.680034703910258e-01; +9.601629578154250e-02   +1.730536407534115e-01   -1.991428827217838e-01   +2.322519388342487e-01   +3.298137503793216e-02   +3.563598283351996e-02   -1.935367463914967e-01   -2.881951389143315e-01   -4.091090000475001e-02   -1.664888678069952e-01   -3.105858664913677e-02   +7.209042174683593e-02   +2.449788852223366e-01   -2.707647213587957e-01   -2.779383120522388e-01   +1.260321164495862e-01; -2.749840714172180e-02   +5.009242883420261e-01   -4.819369749524913e-02   -1.917196870871611e-01   +1.703471275727435e-01   +8.060309951067862e-02   +1.182654541102951e-02   -1.357912655813543e-01   -2.321892190139466e-01   +3.166636297413836e-02   -1.254541310650120e-01   +5.780159415879405e-02   -1.858613748716403e-01   -3.587761418371331e-01   -2.052148118717360e-02   +5.552727126409018e-01; +2.527262081627717e-01   -3.425671997513332e-01   +7.885362988123787e-02   +1.984124253681604e-02   +1.831562656251244e-01   +3.551053870529533e-02   +3.350693234424573e-01   +1.298318855305007e-01   -1.580357822696828e-01   -8.357711235878890e-02   +9.086228691284193e-02   +3.811172383889409e-02   +7.169766125254129e-02   -2.037738066877735e-01   +1.219715621209771e-01   -1.845229846141117e-01; -1.995483554634746e-01   +4.329922133015824e-01   +3.977260759748062e-01   -6.506471851456960e-02   -4.615335162846473e-02   -5.410287263397671e-01   +1.839608202328178e-01   +1.687137362651742e-01   +4.779708254730904e-01   -7.936194854359592e-02   +4.917833486308876e-01   -2.607888355295401e-01   -2.342271630243155e-01   +2.271049698364954e-01   -2.639919432691528e-01   -1.362260413655303e-02; -1.651243452015225e-01   -3.346085699252644e-01   -4.031930757351367e-01   +1.887930074077523e-01   +8.056038533246905e-02   -2.226278535315658e-01   +1.472808515789161e-01   +1.535124074314366e-01   -1.911706416979336e-01   -3.475070637524536e-01   +3.221038785813378e-01   -4.301163097774220e-01   +3.961174555534089e-01   +1.732301425137424e-01   -3.254855263826947e-01   +2.050853044174547e-01; +2.390048470841578e-01   +4.421411315685611e-01   +4.545210587299725e-01   -7.156747297943400e-02   -1.682494814076904e-01   -3.019938335220193e-02   -5.231875374242569e-02   -1.014465314227396e-01   +5.552760126201380e-02   -8.291363796195758e-02   +7.561826034315694e-02   -7.778724655869458e-02   +1.293155420025912e-01   -2.031940346831028e-01   -1.230994911080939e-01   -3.260219592756217e-01; +1.406610410012003e-01   +4.883980339444897e-01   +2.183173209254585e-01   -4.585175714558435e-01   -4.850619398447109e-04   -2.121349205991738e-02   +1.537068948885878e-01   +6.174265246888588e-02   +1.139062548629447e-01   +2.928700106024105e-01   +2.013996062637772e-01   -2.747103231967538e-01   +4.968699677158362e-01   +3.010032538421160e-01   -9.137960043023929e-02   -1.838478540013234e-01; +9.943206295370444e-02   +2.020280473958669e-02   -4.042177615487162e-02   -2.812661033241698e-02   -1.521128819235587e-01   -3.248942982671052e-01   -3.506390555152045e-01   -1.250120017943641e-01   -1.435710312202357e-01   +1.565255135078336e-02   +1.210253620432762e-01   -3.083876263102216e-01   -4.597789913930039e-02   -3.764490915987836e-01   +1.397125811514069e-01   +9.413588650654600e-03; -1.019926996437100e-01   +2.140105632120625e-01   -2.746081331476748e-01   -2.257214835913140e-01   +5.412685474771012e-02   +8.033785113757583e-02   -1.333121210151132e-01   +1.983866116446349e-01   +4.365182565132888e-02   -1.372916047039764e-01   +1.211123005144661e-01   -3.942151803466482e-01   +1.399652515228318e-01   -1.485168793477160e-01   +6.391965062175213e-02   +6.344433497681304e-02; -3.411405979462459e-02   -1.090601182746389e-01   -1.384384568826072e-02   +2.132893372492444e-01   -6.318782973349055e-02   -1.007816179989184e-01   +2.405874739154074e-01   -4.863695971117981e-01   +4.745663917361015e-01   -9.738554270905631e-02   -2.965598041578911e-01   -2.998941714021028e-01   +1.142879045247634e-01   -1.000575360273808e-01   -1.189513985798923e-02   -9.254504882763553e-02];
L1E_L1I_iGABA_netcon = [+1.078316978233344e-01   -3.630441386954163e-02   -6.974202453672936e-02   -3.704170111446972e-01   +3.108081120367372e-01   -4.207625649382400e-01   +3.273675548342087e-01   -1.057554050986360e-01   +2.908169723698375e-01   +5.451737557333472e-02   -3.708012757551922e-01   +1.620490485210884e-01   -1.071866202956777e-01   -1.831026994669275e-01   -1.403328497550461e-01   -4.259111615196348e-01; -4.162241779842616e-01   -2.796419728403603e-01   -7.046203495701384e-03   +1.313732856740839e-01   +4.451134775214071e-01   +1.425859525412397e-01   -4.346133670199295e-02   +4.963184274038097e-02   +1.245851595242255e-01   +1.252242763310411e-01   +1.065670086631510e-01   -3.328593503562000e-01   +2.225365694419204e-01   -1.969375360266862e-01   +5.500179292955987e-03   +1.011580031417548e-01; +2.455246348084338e-01   +8.365447825033004e-02   -5.310578233311410e-02   +3.048011403110730e-01   +2.033487864505168e-01   -2.223678297908400e-01   -2.199711919272101e-01   +1.060689655236376e-02   +2.492129398562622e-01   +1.485626323582896e-01   -7.145809132602399e-02   -2.270667920986583e-01   -3.821492927618915e-01   -2.042990002295605e-02   +1.718027247717268e-01   +4.510732058252113e-01; -1.434886128221925e-01   -3.353275628665302e-01   -3.476958050297406e-01   +1.022811345218646e-01   +3.417117265280839e-02   +1.639389790912408e-01   +1.013871995629205e-01   -9.255483461169070e-02   -1.995035502446013e-01   -1.243042151847640e-01   +1.960980171888040e-02   +4.113229315944911e-01   +9.361648921830978e-02   +1.003261182382526e-01   -2.627887620890996e-01   -1.770998220804445e-01; -1.286995283265406e-01   -2.803733797329931e-01   -7.370969992405627e-02   -4.123117836527426e-01   -8.294214417689065e-02   +1.876707739944671e-01   +3.270805416167672e-01   -7.671597577975846e-02   -1.818289386652377e-04   +8.792236473958941e-02   +1.018758231352068e-02   +3.538417963074504e-02   +3.396383702438299e-01   -4.089172692059102e-01   +8.811080712235533e-03   +2.550510328531643e-01; +1.238871953011255e-01   +1.965178825646372e-01   +2.005535371087186e-01   +6.868137133130116e-02   -1.452686234609124e-01   -3.665816034396506e-02   +7.869245381070758e-02   -2.436326193572189e-02   -1.309379721173651e-01   +7.979701201845321e-02   +2.724371802465114e-01   -2.719246727598024e-01   +2.762422731945124e-01   -3.936434925471249e-02   +3.797333118853770e-01   +1.174948916927727e-01; -1.526970270286545e-01   +7.852940612106300e-02   -4.434527882739712e-01   +5.650885653658374e-01   -2.666394583518664e-01   +2.475541850229729e-01   -2.212199902446843e-01   -9.892901601137989e-03   -1.424170355281510e-01   -1.770146374816003e-01   -1.078312680929459e-01   -1.832382832354588e-01   +4.101334285927489e-01   -1.385531713276295e-01   -1.566729157085758e-02   -3.854170578426672e-03; +3.893239621233822e-02   -7.418345725668779e-02   -1.210024892273634e-02   -2.110485898397690e-02   +3.672709337520451e-01   +4.336965669725054e-01   -2.558909801825788e-01   -1.508196850498553e-01   -1.903898110650674e-01   +3.180111883229707e-01   +1.423910219890828e-01   +2.109516739822297e-01   -2.902277865604131e-02   -5.773928544271074e-02   -5.017137476686682e-01   +4.780928677460998e-01; +2.564516543980511e-01   +3.047952949665904e-01   -6.049029155485141e-02   -3.605275516068627e-01   +4.120158664947500e-01   +1.966331691667902e-01   +3.811985722300064e-01   +3.530492721361514e-01   -1.648261692354661e-01   -1.463691459939194e-01   -2.710590181809964e-01   -5.113734869492495e-02   -1.342284029261320e-01   +1.229086092048167e-01   +7.213093650014997e-02   -1.265415473235370e-01; +1.319946835239066e-02   -2.126787252386215e-01   +3.991582934950179e-01   +5.567732174619461e-02   +1.395673426950595e-01   +2.327839019219014e-01   -6.159680822630603e-02   -1.316878016967880e-01   +2.430666752573196e-03   +2.580391573875178e-01   -4.376247213283958e-01   +3.034199599505745e-01   -3.329081143197783e-01   -2.164459676044520e-01   -1.474825585073710e-01   -2.297276338496435e-01; +1.758849241354359e-01   -4.566827332538116e-01   -3.228665722970400e-01   +3.013067982387903e-01   +3.041939739800564e-01   +1.831623870867136e-01   +2.553366348192124e-02   -1.128904517462291e-01   +5.192130182813327e-01   -4.021014864004094e-02   +3.121290134541307e-02   +3.470897466468976e-01   +7.164154852453275e-02   +6.132422898604621e-02   +2.308653366214634e-02   +4.535110622754039e-02; +3.757896761152890e-01   +2.608925813270856e-01   -9.898232788479540e-02   -2.288046110892379e-01   -2.812014221742119e-01   +1.102436180937559e-01   +2.047839766462422e-01   +3.851833968317785e-01   -3.320976215887078e-02   -1.531450963736034e-01   +7.341595019148958e-02   +1.888792738474393e-01   -2.361787354769110e-01   +1.427718431514278e-01   -1.905694751341579e-01   +6.402055636519613e-02; -3.619855133107919e-05   +1.085025955936731e-01   +8.282975582221190e-02   +2.119189313524328e-01   -7.038199455448890e-02   +6.801266283057072e-02   -1.658507118273272e-01   -1.900987384197146e-01   -4.724864969199328e-01   -3.044146951034538e-02   +2.016123012090774e-02   +6.068579280400839e-02   +1.089996464076466e-01   +3.718729736382274e-01   +2.282275443158537e-01   +2.450786801410907e-01; +1.536441413407200e-01   +7.965488002692844e-02   -1.156671314692704e-01   +2.272755585791793e-01   +9.774919935389637e-02   +3.424646813743978e-02   +2.572631346569648e-01   +2.949204632242957e-01   -3.354529854529401e-02   +1.665004991203466e-01   +1.873744300108357e-01   -2.201783766270426e-01   +2.815899284966893e-01   -4.972842785792210e-02   -1.624860648210888e-01   -8.812450282110916e-03; +7.416287100775246e-02   +1.142997375475410e-01   +7.225814398766586e-02   -4.861911958923445e-01   +3.200948721422364e-01   +5.025134728872414e-01   +2.864305179911611e-01   +1.221010821870947e-01   -1.810458609901419e-01   +5.285390225690287e-02   +1.807818402602152e-01   -2.693573809861727e-02   -2.577949072100166e-01   -5.455873195161029e-02   -8.600849670765337e-02   +1.505348190653126e-01; -2.683197738514961e-02   +2.586646425818509e-01   -1.368627386559309e-01   -2.583770553942554e-01   -2.152271561661898e-01   -1.014336349704390e-01   -6.303467591040136e-02   -3.802374894847991e-01   -1.811681898654100e-01   -7.495698683346280e-02   -5.458174428819426e-02   -1.692921644750784e-01   -3.554220266167069e-02   -1.583611683352648e-02   -1.000047380301068e-01   +4.345102547607323e-02];
L2I_L1I_iGABA_netcon = [+4.909677305936011e-01   +3.137661836966399e-01   +2.508108062057393e-01   -2.708492275935154e-01   +1.585159388984466e-01   -1.193654206378596e-01   -2.464011681384509e-01   +2.088811479470421e-01; -3.841800934889621e-02   -1.321257962633099e-01   -7.953014827069450e-02   -1.702985300297046e-01   -7.480477268481979e-02   +4.544118102262271e-01   +2.780621484118301e-01   -3.675687612805427e-01; -4.245184163208408e-01   +1.667414790230894e-01   -1.649078524205251e-01   +1.492686159684167e-02   -1.374036115536915e-01   -8.398825483325614e-02   +2.494497588558424e-01   +2.150167159055330e-01; +1.676370293854357e-01   +1.213174257215458e-01   -2.852321927136180e-01   -6.964657046490298e-02   -2.284798859553189e-01   -1.347238159873655e-01   +7.061036146966877e-02   -2.149141870628335e-01; +2.588880638655401e-01   -3.481906456724063e-02   +2.562086751490647e-01   -3.592767742841070e-03   -7.513531038523071e-02   +1.727012360162423e-01   +1.947945783427427e-02   +1.536258678952825e-01; -8.697156507700902e-02   -6.164844210958847e-02   +5.510762426060163e-01   -9.768841295053175e-02   +1.575345576456955e-01   -2.253845757744600e-01   +2.586235595026165e-01   -1.779047858025409e-01; +2.672126730718847e-01   -2.103000541313065e-01   +5.536833831625800e-02   -1.199682685588515e-01   +5.396497598256760e-01   -5.062767578097846e-01   -1.144378537384652e-02   +7.496053999703360e-02; -3.356670815244259e-01   +2.808130621267002e-01   +1.537078351852352e-01   +1.898990741796809e-01   -4.534089232353753e-02   +1.307455858158224e-02   -1.730268517087972e-01   -2.403758584253149e-01; -2.848449380312629e-02   -9.287864419718680e-02   -3.945958448954656e-02   +4.850520333996640e-01   -1.306264511498915e-01   +1.138768247778740e-01   -4.343835013161043e-02   +2.985022033051035e-01; +9.732546408288198e-02   +2.553919644135833e-02   -4.429120928167586e-01   -2.821405495248679e-01   +3.464034909763546e-01   -2.355675869639611e-01   -1.868869435911854e-01   +1.447479497346274e-01; -7.390133035236557e-03   +9.384654729266681e-02   +2.266044669549268e-01   -9.782393622643271e-03   -7.938243310492317e-03   -3.336826220117858e-01   -1.574434879568480e-01   -4.887474666249044e-01; +3.308845486515596e-01   +5.070930599797706e-01   +3.720180915391734e-02   +2.812373660496568e-01   -3.627171698318626e-01   -2.989946789648603e-01   +2.034630529524020e-01   -1.712168458527693e-01; +1.544354965266235e-01   +3.112680940879445e-01   +3.446308549188604e-02   -1.167020783739618e-01   -1.537560336153685e-01   -1.253055405180965e-01   +1.050417380476551e-02   +7.910901894422367e-02; +1.886245945294954e-02   +3.516917221645119e-01   -4.396694318536298e-02   +5.072466909620732e-02   -7.656487505216984e-02   -3.685300692031402e-01   +2.932879493771383e-01   +2.770974476542485e-01; +1.274067606931072e-01   +6.806627149223794e-02   -6.905043918903492e-02   +2.202507863067025e-01   +1.276835928077104e-01   +3.719140705339887e-01   +9.751479236030326e-02   -2.222689256862363e-01; -3.543551678702801e-01   +2.544113886747139e-01   -1.505521400530109e-01   -3.836795200896821e-02   +3.325813317165875e-01   +2.061567022671321e-01   -3.115111871518031e-02   +4.497588429846890e-02];
L1I_L2I_iGABA_netcon = [-4.414088587098114e-01   -1.637545204821546e-01   -3.732433571447517e-02   +3.821631255167697e-01   -7.325551834189289e-02   +4.518410730962967e-02   -1.846022823648845e-01   -8.043961413230737e-02   -1.461596803792823e-01   +1.096817341586089e-01   +8.456150245989272e-02   -3.278032220018850e-01   +1.342778255864650e-01   -5.425711311258283e-02   +6.319768196945819e-02   +1.543700361699166e-01; -1.785462373862917e-01   -1.427758418562635e-01   +1.139235004023417e-01   +2.460715046504280e-02   +1.207850691853440e-01   +1.563202893619065e-01   +1.135241723667192e-01   -1.890352052644063e-01   +1.990371108707687e-01   +2.196255059921563e-01   +1.087822791143827e-01   +1.528472747227829e-01   -4.268876817702275e-02   -1.240546582932363e-01   +2.061685819661245e-01   -6.001297671859737e-02; -2.938080099150045e-01   -7.500695109478239e-02   +2.820369666083155e-01   +8.643432544529778e-02   -1.267491848557404e-01   +1.872352087235464e-02   -9.023549962898805e-02   +2.110306376333488e-01   +6.350088975976269e-02   -4.027942031640072e-01   -2.478366767713283e-02   -3.195751070770422e-01   +2.077427958333047e-02   -2.685983774055757e-01   -2.348447552582038e-01   -7.453399860249135e-02; +2.454912847803273e-01   +2.943445129377390e-01   +2.158504914306338e-03   -1.626139830119462e-01   +1.093980080056958e-01   +2.226243349843712e-01   -2.817710147765807e-01   +3.313762779734063e-01   +1.934371466819421e-01   +5.085157585991378e-02   +2.073894927071507e-02   +2.240796892223376e-01   -3.190489813310015e-01   -2.964609445208957e-01   +2.845021362942258e-01   +1.984358153095939e-01; +2.042212360940872e-01   +2.128219862307370e-01   +2.515495702687315e-01   +1.544618047941227e-01   +1.794518035779710e-01   +1.032378407837947e-01   +3.380351072416174e-02   -2.214282634173423e-01   -3.860303348550531e-01   -4.064952641463845e-01   -4.055312585570382e-03   +9.001376888437725e-02   -1.551483506308303e-01   -7.869131577636074e-02   +1.394463414220320e-01   +4.184709198696307e-01; -7.990213851607297e-02   -1.790511499878706e-01   -4.495994655585084e-02   +2.953733940058371e-01   -5.545303030648555e-02   +1.792503249699230e-01   -2.786430537781633e-01   +2.269690253706531e-01   +2.871227269294039e-01   -1.127745776658019e-01   -2.112509089639374e-01   -4.605710546313045e-01   +1.553023707228985e-01   -8.625329988261218e-02   +2.641740150896049e-01   +1.238379389362305e-01; +1.794631685508986e-01   +3.816656176792873e-01   -2.623955477398384e-01   -4.431084038811777e-01   +2.304535432950994e-01   -1.429369622776590e-01   -2.009563496343832e-01   +7.530674628295865e-02   -1.641572398484956e-01   +3.971107381831088e-01   -2.426493833389801e-01   +3.367745773398434e-01   -2.171483611178169e-01   +7.962156313953514e-02   -3.586529110576096e-02   -4.708387842219289e-01; -1.999180598994997e-02   -2.326269909741925e-01   -3.734949300101650e-01   -2.314780016536180e-01   -3.148307847272384e-01   -3.769190051391780e-02   -5.785350005776678e-02   -2.791936880140191e-01   -3.478777082336940e-01   -4.335807623805001e-02   -1.458456213670050e-01   +2.951423133727759e-02   -3.318969318114482e-01   -2.698414083855680e-02   +2.422607322311638e-02   -1.739875841719287e-01];
L2E_L1E_iAMPA_netcon = [-1.066133431169526e-01   -2.471920563013561e-01   -4.691759296461124e-01   +1.305521928378179e-01   +1.813669537648533e-01   +2.577629032270896e-01   -4.554861816992868e-02   -1.224654691717943e-01; -1.178327014304453e-01   +2.951709283190249e-02   +1.410947444998609e-01   -1.172971239043506e-01   +3.059404611799404e-01   +2.601851115070787e-01   -1.021526568479409e-01   +3.300626639065612e-01; -2.216010871506680e-01   +1.550345007915320e-01   -2.370661028778260e-01   -3.733357557870248e-02   -1.094123612447559e-01   +5.427049353418328e-02   -1.605384647199472e-02   +4.254637170348432e-03; -3.009056776489712e-01   -1.786396457614900e-01   +1.760340438557301e-01   +2.630132855546676e-01   +1.155756994090697e-01   -3.726922356830662e-01   -5.437306852774289e-02   +1.564845855328572e-01; +4.442716232244367e-01   +9.424453495686470e-03   -2.942638135026926e-01   +2.563063973128701e-01   -1.626461263667056e-03   -4.518271953682959e-01   +1.489431258952527e-02   +9.718227574903138e-02; +1.169583976583065e-01   +2.155470107863308e-01   -1.498350168112339e-01   +1.301530179575778e-01   -1.739548729348343e-01   -1.286718688804973e-01   -9.142891081110520e-02   +1.057741733001098e-01; -1.298199057924709e-01   -1.844111799041573e-01   +5.938189101617536e-02   -5.995131422029366e-02   +3.410257747007103e-02   -4.589033603106796e-01   +1.825350501058188e-01   +1.190289702302705e-02; +1.034456992743364e-01   +4.954616868787287e-02   -4.643508773152075e-02   +1.192506319922093e-01   -2.541249136928122e-01   +1.019944114560227e-01   -6.644870707109699e-02   -1.194471433086282e-01; +2.769732256511563e-02   +1.352179974109374e-01   -2.007373750634163e-01   +2.212791360559159e-01   +1.575899847145154e-02   -8.039189670892674e-02   +1.902564049112890e-03   +3.857081775532439e-01; -2.183215051872119e-01   +2.552697457859758e-01   +2.783054810057529e-02   -3.060904394282359e-01   +3.057759824273351e-01   -3.252219250363624e-02   +2.192246878397748e-01   -1.925384816676088e-01; +1.467687225888916e-01   -2.150612676129897e-02   +2.531029650602822e-01   +1.490917037620441e-01   -1.677352184905900e-02   +2.390117974186177e-01   -3.616310354155535e-01   -1.315590142693691e-01; -1.242492969580898e-01   +1.598089045398010e-02   +1.276634239897070e-01   -5.349164344143892e-01   -1.885200694831165e-01   +1.798154315495919e-01   -3.711038164963226e-02   -1.459821539137008e-01; -2.980379813253892e-02   -5.258208294478599e-01   +3.304972514029508e-01   +4.320776387211649e-02   -1.284637966776626e-01   +1.874059501427081e-01   +8.027986629940041e-02   -1.384045740245133e-01; +3.511377738062570e-01   -3.357986611419850e-01   +8.942015250033933e-02   +9.573866895789424e-02   +4.201424494048540e-01   -6.168495724111830e-02   -1.033475050205490e-01   +4.833731176935473e-02; -1.046548685117005e-01   -1.270227491391324e-01   +1.748705590222318e-01   -2.329170810817335e-01   +1.123078584384246e-01   -2.659493095440334e-02   -2.445581892895289e-01   +4.628068571554804e-01; -5.129396373662494e-02   +2.222356259062503e-01   +2.544997597370318e-01   +1.607198839405754e-01   -2.168493649248108e-01   +2.762548487682470e-01   -2.728359281671805e-02   +3.337272804190746e-01];
L1E_L2E_iAMPA_netcon = [+4.128550785124513e-01   -1.929965829362577e-01   -2.165909157592878e-01   +2.536962935868678e-01   -1.426338273852649e-01   -2.769994124639510e-01   +4.047776626601591e-01   +3.812920817749129e-01   +1.983036010246044e-01   +6.205738526518458e-02   +1.994059317044891e-01   -1.508617004915957e-01   +3.627593087482553e-01   -4.931475801661445e-02   -2.772373201118888e-02   -9.434470566755698e-02; -1.758801886512275e-01   +3.000975151511914e-02   -3.577405425049966e-02   -4.869316600923249e-01   +4.058823439094361e-02   -1.591707044834952e-01   -4.695615001775498e-02   +2.169599042886143e-01   -1.663119982942163e-03   +5.716856961715006e-02   -1.448291455544753e-01   +3.033756477258868e-01   -3.722551947782761e-01   -3.336659282923733e-01   +2.576366605736642e-01   +1.020565657092920e-01; -2.997380984824805e-01   +3.929458078674914e-01   +1.727459877135021e-01   +1.916142138350305e-01   -3.051931525459979e-01   +2.118732243125694e-01   -8.481920337433113e-02   +3.242719889225550e-01   +1.373741563166826e-01   -1.642946587877721e-01   +2.105592587501494e-01   -1.330317516320000e-01   +7.080594617483033e-03   -1.408745141817073e-02   +1.203509084897763e-01   +1.217767940796093e-01; -2.980859984827500e-01   +1.375813998999263e-01   +1.475805048153594e-01   -2.384092575099209e-01   -2.787092363430312e-01   -1.899488778561242e-02   -9.223903116984011e-02   +2.825689853339879e-01   -1.733263701386441e-01   -2.054757614011306e-01   -3.007030417594939e-01   +1.186235116148073e-01   -4.973796629892663e-01   +3.883119261443597e-02   -1.949421128078269e-01   -4.879784765188891e-02; +8.614210495174535e-02   +6.479980353619620e-02   +5.654418600673138e-01   +8.333164968076685e-02   -2.745432299660479e-01   -2.087994405956363e-01   +8.731108739596399e-03   -1.604250977225813e-01   -4.583115503462649e-01   +3.098050675506539e-01   -1.923981065658433e-01   -9.129991166373272e-02   -3.460873346306008e-01   +3.981282495206391e-01   +3.131946711703257e-01   +1.477860696331429e-01; -3.960801925189816e-01   -8.458574001982827e-02   +1.298696932356012e-01   +3.480106111713325e-01   +2.170849025298349e-01   +1.192419778896926e-01   -5.194644400683049e-01   +2.945775101416829e-01   -8.551057465514328e-02   +2.751278987272349e-01   -2.864572435634569e-01   -2.248635857404581e-01   +1.723203578801112e-01   +1.668756591376031e-01   -2.523983735080926e-02   -7.260983435537050e-03; +1.446300806725986e-02   +3.320797675603546e-02   -3.092352620781733e-01   -1.979750079778071e-01   +3.124738471721470e-01   +5.863259032890070e-01   -1.484239312351636e-01   +4.343121036837292e-01   -3.105285996530003e-01   +1.435228300074378e-01   -3.601063832275599e-02   +5.552757972084377e-02   +2.217871645730774e-01   -3.432574341759375e-01   +2.750346313215523e-01   +3.720129037197497e-01; +6.781938391651972e-02   +2.809563077566382e-01   -1.353546808413024e-02   +6.568058017545458e-02   +6.579049834140432e-02   -7.957938636142942e-02   -1.609122483220095e-01   -1.280519312289673e-01   +1.758652443426505e-01   +2.265289641507312e-01   +2.025628674129432e-01   +7.269602571007086e-02   -1.053613955450300e-01   -3.474537349475525e-01   +4.235483561434478e-02   -9.002103653993135e-02];
L2I_L2E_iAMPA_netcon = [-2.534182965875958e-01   +1.289556689978927e-01   +8.509167166643414e-02   -2.677659521010892e-01   -2.206722215490599e-03   -2.239993218401271e-01   +1.857906139235776e-01   -6.549516843168141e-02; -1.418271538117909e-01   -7.646419460446072e-02   -1.088260055105994e-01   +3.536306456658120e-01   -5.125236139183813e-02   +5.391861322024977e-02   +6.392300772244400e-02   +1.105073110336984e-01; +4.573407005153160e-02   -9.069005835786681e-02   -3.923846164722158e-01   -2.624537206084057e-01   -3.791583850155905e-01   -2.509733862489176e-01   -9.964747699760487e-02   -8.292581163308783e-02; -1.200221992146660e-01   +1.814055065911761e-01   -5.625941555655278e-01   +1.732790075656269e-01   -4.732406556680843e-02   -9.330485559941444e-02   -5.770055853772507e-02   -6.584446625930088e-02; +2.436513994982190e-02   -1.792494773814634e-01   +3.411931243675357e-01   +2.923208245574800e-01   +2.276558642325356e-01   -1.766569358442416e-01   -3.000133048381717e-01   -3.885810628219281e-01; +3.873289601256881e-01   +7.470832876472849e-03   -1.511791426360416e-01   +5.392050326266822e-01   +6.161285917812021e-02   +4.668426553798295e-03   +1.692475265894888e-02   -2.361435322808425e-01; -2.015244603717812e-01   +2.213948617506996e-01   +2.642671754831439e-01   -3.195788584491580e-01   -2.822695702405407e-01   -5.087617880675358e-01   +5.686607291500684e-02   +1.974981375951599e-01; -4.889112118073542e-02   +1.016960989314341e-01   +9.159275505357816e-03   -6.905502775049277e-02   -2.279598791477991e-01   +3.272745543671551e-01   +4.382092645212314e-01   -3.912804392347293e-01];
L2E_L2I_iGABA_netcon = [-2.244451967717163e-01   -1.383278986643927e-01   +2.367383740142732e-01   +1.269110571900619e-01   -3.404875959747256e-02   -3.083514751829293e-01   -1.346118454681415e-01   +2.486625227310061e-01; +3.880530314611953e-01   -9.450862558419705e-02   +2.844366352077042e-01   -4.863032540179315e-02   -1.433686471552260e-01   -4.458100016846068e-01   +9.088218925257791e-02   -4.132025479191683e-01; -1.622190711222925e-01   +1.041480605633397e-01   +1.551787500551388e-01   +8.611624119186806e-02   +2.873338613878934e-01   +1.279000071754008e-01   -2.054421666147944e-01   -7.867026825392848e-02; -4.166852487354814e-02   +1.406231358141303e-01   +1.586619021183788e-03   -5.948002804889794e-02   -5.256734205225246e-02   +2.688430747142669e-01   -1.124207613568230e-01   +3.095479115332960e-01; +4.358308055854124e-01   -3.059408095422395e-01   -3.364613534668368e-01   +7.324263282647930e-02   +2.835377604797008e-01   +4.260054165955174e-01   -5.573893363479927e-02   +1.270526276006768e-01; -1.323844590396827e-01   +1.971586236770987e-01   -1.508975223698071e-01   +7.950481668234904e-02   +4.457093629229520e-01   +2.487443687948312e-01   +3.067192942722324e-02   -2.787193862365608e-01; -5.697220593819332e-02   +1.625919776019322e-01   +4.572275025083098e-01   +2.561864275052222e-01   +8.983834221875370e-02   +5.930103199275563e-02   +7.804345397867112e-03   -1.290477692000145e-01; +3.035263236309769e-02   -1.015141192695312e-01   +1.517887044841313e-01   -1.097642768927118e-01   +3.198385035400009e-02   +2.529417798874425e-01   +1.594685799289347e-01   +2.925129376578368e-01];
L3E_L2E_iAMPA_netcon = [+1.457300384718634e-01   -3.349408808412876e-01   +1.666199743323094e-01   -3.334219716946923e-02   -2.507640127467496e-01   +3.850711347611688e-02   +1.200620038386055e-01   -2.525547042137202e-01   -1.908492770694452e-01   -2.776631392628293e-01   -3.383520275459330e-01   +2.622839834737872e-01; +2.395957973715403e-01   -2.489403798757174e-01   +1.046760530449877e-01   -2.304559550572828e-01   -6.227329879574175e-02   -1.336325268987995e-01   -2.415718335055815e-01   +9.992972906512490e-02   -2.333063283209686e-01   -7.297071370057415e-02   -2.193236351245946e-01   +8.496216232997457e-02; -2.030045248662929e-01   +3.115944177781945e-01   -1.368297348050165e-01   -2.469031123907815e-01   +4.299159265505369e-02   +1.065809721054005e-01   -3.618767910951093e-01   +2.596376519557705e-02   +4.695970162301877e-02   -2.244710249706239e-02   -2.329033530037578e-01   -1.365369558698447e-01; -3.171404231166954e-01   -1.306567120404625e-03   +2.793760741975715e-01   -2.868612835873302e-02   -2.242535491351647e-01   +2.261247638846681e-01   +1.759514488963896e-01   +2.990497575772216e-01   -2.133028646187564e-01   +4.553600617339143e-03   -2.302994372166644e-01   +1.812279990291247e-01; +1.423278466889625e-01   +3.789380803599541e-01   -1.224124834392817e-02   -1.008418833967854e-02   -7.482589289275721e-02   -3.265273121260043e-03   -1.709501497665666e-01   -1.232329894936741e-01   +1.194143491993882e-01   +1.745856359939243e-01   +8.335720962284705e-02   -2.308976144392404e-01; -1.054346123154991e-01   -1.200968420643764e-01   -2.919127403764604e-01   -2.934971060776290e-02   -1.457280913290311e-01   -1.226372665385828e-01   +4.243115006129624e-01   -8.668878702218430e-02   +1.134188615204943e-01   +1.677053749146226e-02   +1.937111113924465e-01   -6.154017642430003e-02; +1.253074632147395e-01   -3.378570776098636e-01   +3.211316041125557e-01   -1.670565830990685e-01   +4.781942194143812e-02   +9.566162758892470e-02   +3.677180602544393e-01   -6.081332292639620e-02   -2.029582851953038e-01   +9.748248976797740e-02   -1.807737154790633e-01   -2.500057241199149e-01; -1.617815804497025e-01   -2.701698756810852e-02   +6.367739654242537e-01   +3.781098367288334e-01   +1.734279572683390e-01   +7.742828565746607e-02   -2.553699870850032e-02   +3.922791701315338e-01   -8.714878527603943e-02   -1.157433156281465e-01   -3.480135690167102e-01   -1.646802678358545e-01];
L3I_L2I_iGABA_netcon = [-1.121561812664398e-01   +3.862415324257147e-01   -4.916244851290945e-02   +8.391816595337262e-02   +5.477375323613567e-02   -1.917099082073839e-01   -8.428272216459473e-02   -1.234855182193703e-01   -2.100372986167015e-01   +1.233507268023952e-01   +1.146778402330450e-01   +1.271458839981827e-01; +1.213024189979915e-01   -3.436283192925506e-01   -2.681162999992975e-01   +2.903462603412112e-02   -2.046593447132856e-01   -2.262066763090289e-01   -5.480596765296998e-02   -1.046010682371447e-01   -2.337318709428871e-01   -1.011295627288036e-02   +1.590469908328907e-01   +1.826540924426854e-01; +9.901896750524095e-02   +1.153746618092488e-01   -6.533090731237802e-02   -2.148223048309217e-01   +6.268424109062043e-02   -1.560099719861506e-01   -2.033643216949730e-01   +7.942269453908957e-02   -1.657963944047560e-01   +3.315109094089785e-01   -3.418999103934194e-01   +2.719122865682086e-02; -2.244674607052817e-01   -2.484903551911498e-01   +3.017090257396797e-01   -8.920209590188966e-02   +2.673983033658413e-01   +1.399063577109718e-01   -2.895887670380992e-01   -1.014402355545711e-01   +3.080177465663833e-01   -1.410807326840198e-01   +9.300405123418373e-02   +9.481668701826207e-04; +3.384347028571711e-01   -1.605316000132427e-01   +3.146673184374514e-01   -2.473305222994369e-01   -2.785300224628304e-01   +2.888849171518534e-01   -6.111682170621752e-02   -4.478901085903403e-03   -3.001342398565685e-01   +3.824514948234186e-01   -2.854998155782738e-01   +1.430618425761157e-01; +3.374082786097241e-01   -2.915042030650140e-01   +1.337899538027429e-01   +2.907276792182942e-02   +1.460832184047652e-01   -2.607692425570219e-01   +3.001720236918750e-01   +7.947110305521272e-02   -2.147556228163663e-01   -1.020003348597936e-01   -3.752810433242829e-01   +2.276828266815771e-01; +1.567619239343752e-01   +2.982039488778189e-01   -9.866220244578194e-02   -5.688809493449385e-01   -2.343576979136565e-01   +1.743669134396913e-01   +8.857885125929518e-02   -3.576385743132376e-02   +1.166226504933103e-01   -3.471197811707448e-01   -5.798236349663768e-03   -1.779783028273413e-01; +9.221036348963178e-02   -4.391506384098377e-01   +1.931945937281576e-01   +1.267959346716260e-01   +4.566939903606783e-02   +3.422654591899328e-01   +3.561455065535267e-01   +1.017373638193291e-01   -3.706869314081190e-01   +1.589171911362608e-01   -2.922651399269274e-01   +1.196965907407421e-01];
L2E_L3E_iAMPA_netcon = [+6.290027511062182e-02   +1.617608863442359e-01   +9.988231071453504e-02   +7.840458524027810e-02   -9.779649585688013e-02   +4.444449498094135e-01   -1.081967268619848e-03   +5.813165223121890e-02; -1.473854744565131e-01   -3.716580146448403e-01   +9.111735241139704e-02   +2.275482120650635e-01   -3.724055420644989e-01   +6.731925491688492e-02   -1.613806133581970e-01   -1.271749042638276e-01; -6.461298070237306e-02   +1.475890272069039e-01   -5.045081524270555e-02   +2.488161008866940e-01   -1.699304067199053e-01   -2.468583637895254e-01   -1.673506934944128e-01   -7.017836375385250e-03; -2.596358788538813e-02   +5.368784678679905e-02   +6.050832470547504e-02   +2.005369730345845e-01   -2.728938847642021e-01   -2.218425447987173e-01   -1.291299915226611e-01   -4.664338036631018e-02; +3.662163177971985e-01   -2.062958127960063e-01   -1.853954209640740e-05   +3.409262449436943e-01   +1.927830326363519e-01   -3.248942114193571e-01   -1.248868607419240e-01   -2.011534299376440e-01; -3.502978382598371e-01   +1.409488007780573e-01   -3.271540749501947e-02   -1.751573064674426e-01   -7.204190208802225e-02   +1.828113261619486e-01   +1.728530172290401e-01   -3.299676695233795e-01; +1.513007449792960e-01   +1.905338377017245e-02   +5.405215838916663e-02   +8.495920395463263e-02   -8.757180324996805e-02   -3.652123254411803e-01   +2.194722491165333e-01   +1.067524154117505e-01; -1.266868309679405e-01   +4.385111227517933e-01   +6.719058353220317e-02   +6.118575911130149e-02   +6.817586110873688e-02   -3.516967811613553e-01   -2.322693626801777e-01   +1.978113642225986e-01; -1.387306012050988e-02   -1.770636150572497e-01   -3.171120430353518e-01   -1.564456489773035e-01   +5.097771271804170e-01   -4.638968893458642e-02   -4.703809983791366e-01   -2.812809288998461e-01; -1.036297505450059e-02   +1.730758432263675e-01   -1.333841515583532e-02   -1.044916936517936e-01   +1.356652322915851e-01   -7.645033714337049e-02   -9.006040958471956e-02   +1.624942391048999e-01; +2.221649261075920e-01   -4.756453489481082e-01   -6.419322110267808e-02   -3.921955896291275e-01   +3.125669483498132e-01   -3.870703025887277e-01   +2.977834762975065e-01   +2.578575051375231e-01; -1.192747315232388e-01   +9.959737438851526e-02   +5.056594234408962e-03   +1.045383272770718e-01   -1.386309500215879e-01   +3.985448516744794e-02   -8.012155765807022e-02   +2.065357052919624e-01];
L2I_L3I_iGABA_netcon = [-5.026061095393266e-01   +1.482818076710449e-01   +2.829264294889437e-01   -9.661446498438098e-02   -2.141778860451785e-01   +1.771916422995864e-01   -4.365000872776222e-02   -5.447459475223917e-02; -5.916618008220708e-01   -6.195835695950982e-02   -1.216428624764444e-01   +4.155451826460366e-01   -2.638466203989859e-03   +1.314144590487695e-01   +1.167758519101247e-01   +1.743246933471519e-01; -1.976772627529672e-02   +1.338275569764799e-01   +2.196159147628078e-01   +1.306356878277967e-01   -1.603445934895263e-01   +1.617129983493282e-04   +1.974819810878447e-01   -2.691253101181312e-01; -1.495823700400625e-01   -8.127211911056362e-02   -1.051570811843750e-01   +2.585857910956462e-01   -2.586197046975129e-01   +2.220308518801541e-01   +3.799723923005228e-01   +1.332236227924608e-01; -2.999437974207368e-01   +5.819506962164391e-02   +1.836613776202673e-01   +1.075238077694513e-01   -3.811057460475009e-02   -2.086521495561823e-01   -1.367846446777046e-01   +1.554489339699167e-01; +2.138728498595240e-01   +1.199311773911185e-02   -1.342983350664710e-01   -2.223941734991589e-02   -2.739779730661703e-01   +7.943937748167967e-02   -2.459916114828040e-01   -2.520544823894717e-01; -8.657796775782928e-02   -2.613136334760217e-01   -6.991471710210706e-02   -5.735363140584748e-02   -1.243226583255103e-01   +1.425007045939377e-01   -1.866612233703759e-01   -1.865372115588786e-01; -3.933058292671548e-02   +2.420963137889170e-01   -1.110389059631575e-01   -2.576637676932600e-01   -1.691292388190442e-01   -1.921987540990851e-01   -5.491932444109431e-01   +1.192546495200431e-01; +8.989471168588586e-02   -3.084062248610911e-01   +1.818782152066367e-01   -5.079500192464699e-01   -1.962617979337519e-01   -4.169761941622853e-01   -2.112187307850837e-01   +1.907676751621897e-01; -1.113489655365254e-01   +1.136975324317963e-01   -1.994053796716049e-01   -2.645717232699667e-01   +2.718674254826119e-01   +2.528901659768094e-01   -3.608631107308036e-02   +8.835474676608343e-02; -2.113491046114547e-01   +5.312679495616337e-01   +5.475608608257018e-01   +2.729804080590316e-01   +3.813124605605003e-02   -2.180989518768864e-01   -1.658224729075681e-01   +2.256798801318567e-01; +1.292791650495880e-01   +2.724088205746480e-02   +9.249318242039489e-02   +2.155713737224023e-01   +6.914342168277179e-02   +8.728529951410072e-02   -5.599298848304248e-01   +2.794160270440449e-01];
L3I_L3E_iAMPA_netcon = [-7.580037054804006e-02   -2.682958406550567e-01   -1.808488518777963e-01   +4.920911883630656e-01   -8.722071085974099e-02   -3.461045929096525e-01   -2.821404026919808e-01   +6.583937007997878e-02   +3.852501032336295e-03   -1.021960092083294e-02   -2.489870826986461e-01   -2.612554485355856e-01; +8.018386023678610e-02   -1.174292145201904e-01   +1.637648021004616e-01   -3.785636890243940e-01   -2.854710122889205e-01   -8.787139138958551e-02   +5.805453635220661e-02   -9.154644147751800e-03   -4.466847436424384e-02   +4.295033761189276e-02   -2.830888430689791e-01   -1.265914554479940e-01; +8.038502229825285e-02   +9.780142131070731e-02   +1.104014226408420e-01   +3.023940268062931e-01   +1.972853967598147e-01   +4.127579551514909e-01   +1.611679982955994e-01   +1.204176450608696e-01   +1.271086105236826e-01   -2.221604452203559e-01   -1.906970252485346e-01   -2.472836422865614e-01; +2.131485947168277e-01   -1.509617882003530e-01   -2.372641510126352e-01   +5.150756364563462e-02   +4.780728961084796e-01   +2.426413364361725e-01   +6.624763504163192e-02   -3.502478249795699e-02   +2.014461598515422e-01   -2.709759025104557e-01   -2.845470732584313e-02   -5.896772814799158e-02; -1.415734554764140e-02   -7.574804633502664e-03   -1.845125995162862e-01   +3.586091776941958e-01   +3.600166354456106e-01   -2.503594423175406e-02   +5.544145645040048e-02   -2.183618144672909e-01   -1.318142460735926e-01   -4.101940858573954e-01   -3.612687147804449e-01   -2.155698549337400e-01; +1.818386845062307e-01   +3.203722293676466e-01   +2.739803830514149e-01   +2.007893622905176e-01   +3.103988709909020e-01   -1.612184870814585e-01   +1.994079652222077e-02   -4.323000582844735e-02   +1.207620543815785e-02   +2.685166775387431e-01   +8.620105776981385e-02   -1.313221465769367e-01; +2.832827449985182e-01   -1.521041570497815e-01   -1.097403886353951e-01   +1.911055342756509e-01   -1.398986472509526e-01   +4.283845067643145e-02   +1.196798979691069e-01   +3.976058451494097e-03   -1.461519669328641e-01   -1.513115335677175e-01   -1.650233800120265e-01   -1.954534440040635e-01; +2.829275562460589e-01   -3.874751226679019e-01   +2.610593256920947e-01   +9.503657774744517e-02   +3.490949719919547e-01   -2.642235599914497e-01   +2.055576890013564e-01   +2.906124843121575e-01   +4.127903305345365e-02   -5.534050076384994e-02   -7.828211307238070e-02   -1.327886036654594e-01; +2.519435812084847e-01   +1.224888004853490e-01   +5.769031802055546e-02   +1.036864190462377e-01   +1.843810748750134e-01   +1.158961733228783e-01   +2.950961479519726e-01   +7.064586593453975e-02   +1.267291262633848e-01   -4.500307630240014e-01   +1.499007078605440e-02   +1.673576358664204e-01; -1.021870256326666e-01   -2.527596955556001e-01   +3.445965442652464e-01   +3.306356319404911e-02   -5.191764655579960e-02   +3.276007663953373e-02   +8.099544739313268e-02   +2.276186552012289e-01   -4.967386004993413e-02   +1.728240002494548e-02   +1.925398525653240e-01   +1.680208795614335e-01; +2.249933139374334e-02   -2.660679988443676e-01   -1.249365324972905e-01   +1.854784468591481e-01   +1.285606679052247e-01   -6.903657396047480e-03   -3.175439529203959e-01   -1.645152706913500e-01   -3.220585650959369e-01   +5.523203968497264e-02   +4.443077804734670e-02   -5.312593877962905e-03; +1.042023225674900e-01   -7.147634829078459e-02   +6.882127576312436e-02   +1.343897625189039e-01   -2.163356525101864e-01   -2.746071521633909e-01   -1.231379154655250e-01   -3.169878480949910e-02   -3.025307421241717e-02   -1.648987143818062e-02   -5.297252433791666e-02   +4.005286837298377e-01];
L3E_L3I_iGABA_netcon = [+1.652182672252021e-01   +8.824312954170058e-02   -1.191960188592538e-01   +2.959788241133838e-01   +2.072475546188021e-01   -6.651439936635989e-02   +2.826477344846194e-01   +2.820171010332670e-01   -5.736760288766104e-02   +2.975018910218747e-01   +9.443889746798231e-02   -6.983897256840549e-02; -4.580449759141782e-02   -3.477461821985826e-01   +3.565496556516785e-01   -6.380976417666961e-02   +1.868955269716166e-01   -2.757274903445559e-01   -1.115623788783787e-02   -2.448368806007968e-01   -3.820711647071302e-01   +1.953189174367788e-01   +4.531430502370021e-02   -2.692194266813582e-01; -1.901845350576227e-01   +8.074247662210633e-03   +3.860097378523469e-02   +1.198415680929504e-01   -1.274592642091663e-01   -1.364377550778567e-02   -3.648330769932584e-02   +3.646177055257378e-01   +2.749882564139272e-01   +2.209407020013829e-01   -1.616280757242735e-01   -4.350935352473358e-01; +4.715252725576225e-02   -2.073715571275650e-01   -3.874239360221753e-01   -3.900895438135875e-01   +4.169144985497752e-03   +3.131597743466146e-01   -1.901531973736837e-01   -5.175110426908407e-01   -1.691334342863008e-01   +2.119552401540603e-01   +8.695698667165819e-02   -9.171204449784498e-02; +6.636267250759134e-02   +2.777849602584173e-01   -3.509720021578416e-01   +8.711771671006435e-02   -4.063380632854192e-01   +4.614440580629121e-01   +3.980065458187803e-01   -9.219894692297219e-02   -1.662998958247751e-01   -4.487852775473958e-02   +5.266913645624360e-02   -6.820770271635462e-02; -1.504315976022481e-01   -1.341183021004801e-02   +1.372455446359943e-01   +4.550955347026931e-01   +3.210167587108662e-01   -8.171264504496306e-02   +4.166116390157505e-02   +3.730095040288353e-02   -1.166781937100036e-01   -2.319534508355275e-01   +2.347547841669777e-01   +4.673985802451439e-01; +1.317443499048764e-01   -2.876323635102686e-01   +1.951528130195744e-01   +1.463786311686553e-01   +1.030075492498927e-01   +2.220114892903308e-02   +2.159204687246145e-01   -3.138253761303698e-01   -2.471490626742014e-01   +1.837556076115463e-01   -2.779516863142374e-01   -2.452048703245265e-01; +1.152703581405005e-01   -7.764508108924126e-02   -1.004183514296136e-01   +2.946851401612466e-03   -2.983682887584119e-01   +1.498108448908009e-01   +1.996918702068895e-02   -1.906443416049992e-01   +2.750063430609208e-01   -2.774046757119977e-02   -4.192461217469377e-03   -4.051772232914965e-01; -3.417102252641378e-02   +6.342074906217458e-02   -1.225079789368901e-01   -6.079463885624790e-02   +1.518706380212533e-01   -1.255857077828042e-01   +3.070007639980237e-01   -6.201511085333443e-02   -9.180448519161416e-03   +3.880693845414730e-02   +1.206791611474394e-01   +1.527328496961442e-01; -2.480469510209746e-01   +1.633633450121649e-01   +2.563394763624506e-01   +8.325046336702492e-02   +4.983513536326675e-01   -9.780738842988407e-02   -1.761302758215162e-01   +3.734339851167126e-02   +5.276671331533866e-02   -1.949153303627210e-01   -7.623820895616462e-02   +2.008037048519898e-02; -3.311653470746395e-01   +1.922102427079625e-01   +2.102158823756349e-01   +1.354660184232429e-02   -5.108571103046007e-01   +2.237913050178426e-01   -1.982145739777599e-01   -1.675573609851786e-01   -1.420954800730692e-01   +1.607184586389015e-01   +3.998299531549809e-02   +3.645881935052656e-01; -1.595820450419637e-01   +1.197710782759490e-01   -1.626022506399663e-01   +2.539456493123599e-01   -1.976520990153333e-01   +2.692715192812336e-01   -3.132491701230455e-01   -3.732650389300995e-01   +2.621874712288129e-01   -3.023252099796561e-01   +4.992084510166170e-01   -1.934888316740657e-01];
L2E_Input1_iAMPA_netcon = [+3.198614617631735e-01   -8.203851282092897e-02   -2.613652986001453e-01   +4.258395493073955e-03   +2.469440590906033e-02   -1.297554071929453e-02   -2.039795815416593e-01   -3.129854214010709e-01];
L2I_Input2_iAMPA_netcon = [-1.240107012760019e-01   -2.687065021050917e-01   -2.114796375897712e-02   -2.511544077914145e-02   +3.018000576539187e-02   -8.527876377845189e-02   -1.131743620495655e-01   +2.461444238974455e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
