function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.606491436857920e-01   +7.566981790661395e-01   -1.937519484088480e-01   +2.614859589762696e-01   -1.204310731600192e-01   +9.089762695718396e-01   +5.656208678760297e-02   -9.991742708136035e-02   -1.107519997012562e-01   +1.729724646468394e-01   -1.625325281316173e-01   -4.156144418921940e-01   -6.918652599025887e-01   -8.121867180268049e-01   +1.567349704619979e-01   +3.345735625850021e-01; +6.836865797884496e-01   -1.143477473453003e-01   -2.933464315401363e-01   -3.032669261964016e-01   +1.664740333896356e-01   +2.316685176368506e-01   +9.890247374987086e-02   -6.216926107206009e-01   +6.948140764390690e-01   +6.605360194642885e-01   -1.790644664793419e-01   +3.210364246665144e-01   -8.993421155652317e-02   -5.903305407517511e-01   +6.257169962715299e-01   +1.086603810507223e-01; -7.798474961569346e-01   +3.915947422819024e-01   -7.559257346849031e-01   +1.982311110115612e-01   -4.080572163446831e-01   -3.869501808829983e-01   -5.771905115597355e-02   +4.547827810557356e-01   -8.507628109743211e-02   +6.026179009153609e-01   -3.633989988994906e-01   -2.509056193726917e-01   +3.449029940351960e-01   -6.486091893452960e-01   -5.490580072180453e-01   -2.486088399463351e-01; +4.342237497729611e-01   +2.136382308082868e-01   -2.594311509443871e-01   +1.376645831357109e-01   -6.148243010634039e-01   +2.804307546964484e-02   +7.917224686750944e-01   -7.862952499859550e-01   -3.916225170314003e-01   -1.000000000000000e+00   +5.980403086335234e-01   -3.288604737543174e-02   -8.407040997109242e-01   -2.682939227782961e-01   +1.768601538617657e-01   +2.508958740463907e-02; +4.932829081296619e-01   -5.911277049654508e-01   -2.699446469324985e-01   +1.666317541839437e-01   -2.802621545276127e-01   +6.659219769702766e-02   +8.458416248392299e-01   +9.945710819209073e-02   -1.146256253290328e-01   +1.031387103924792e-02   +1.276651385823338e-02   -5.730211851318492e-01   -2.754817420269196e-01   -2.790200696060043e-01   -2.924371606732286e-01   -3.190240875529236e-01; -4.345974597866579e-01   -8.585743359401300e-01   +4.417161539337768e-02   -2.809998840119900e-01   -8.592682366436694e-01   -3.443762537602948e-01   -1.865243796854144e-01   +4.396548540473006e-01   -2.805572186279380e-01   -2.241100805415047e-01   +4.106279498124715e-01   +6.088876621763335e-01   -4.575297793347319e-01   -4.092416657461803e-01   -1.551217560447916e-01   +3.545364378550235e-01; +8.625487354820378e-02   -2.904537771819923e-01   +7.262858540472500e-01   +4.728781138211702e-01   +3.700707081410856e-01   +3.873058396847980e-01   -2.343669887361380e-01   +2.726015015699853e-01   +3.663103359560214e-01   +3.163253183401599e-01   -3.355123702379186e-01   +1.005884139160304e-01   -2.336091037700624e-01   -1.625514963626273e-02   +4.038176311075504e-01   +2.627441481408322e-01; +1.009674848327109e-01   +5.592413666274970e-01   +1.024425183473342e-01   +2.207458382127154e-02   +5.318426936913127e-02   +4.623838252582872e-03   +5.066160010841197e-01   +3.922885876634691e-01   -2.297673963958855e-01   +3.273459720608163e-01   -5.545697291501294e-01   -6.205797216249178e-01   -1.921062594720538e-01   +2.533797749842954e-01   +3.030749817779247e-01   +1.267805665655596e-01; -3.849489652838692e-01   +6.629847982856232e-01   -4.590502447731204e-01   -6.581164690313683e-01   -1.630548093433883e-01   -3.456976154168681e-01   +7.094334335660927e-01   -2.215793499655428e-01   +5.618733051394538e-01   +5.949558255454616e-01   -4.045069167859414e-01   -4.059961366622321e-01   -1.918054354862617e-01   +7.799376989721292e-03   -2.944063052821957e-02   -3.905941407747540e-03; -4.274722142246692e-01   +2.668283075844905e-01   -6.243514799104142e-01   +1.477712851823909e-01   -6.696180202815407e-01   -3.706757738441285e-01   -3.510137063559733e-01   -1.418028308780271e-02   +7.809640318644805e-02   +1.775777763962711e-01   +2.432634711252050e-01   -5.110825626352595e-01   +4.568835533638129e-01   -2.379619184445134e-01   +3.926331520349131e-01   -3.210630762550616e-01; -2.896476000509740e-01   +3.526328833448207e-01   -3.612854129183768e-01   -6.225218529578435e-01   -4.703433853541931e-01   -2.168145402041503e-01   -4.389698365701468e-01   -4.477423289179212e-01   +4.243538813655263e-01   -2.097168239792279e-01   -2.270028974602090e-01   -6.796096282115329e-01   -1.438119919448385e-02   +5.706780668014395e-01   -2.658564228494535e-01   +3.420082825072313e-02; -4.170807171479122e-01   -2.633696722939119e-01   +1.822079067543391e-01   -6.608691055590991e-01   -2.462893972367225e-01   -3.137634535539672e-01   -5.722516184015044e-02   +3.590573826200194e-01   +1.391539722154514e-02   +5.914049846755822e-01   -6.214779210802980e-01   +2.425147520628234e-01   -7.335036089013071e-01   -4.305226115590376e-02   +1.078607521160371e-01   -2.403929413821734e-01; +5.093492625734307e-01   +1.727196658448724e-01   -1.358489976151976e-01   +3.664523932943100e-01   +3.088376299067083e-01   +1.917822611492612e-01   +6.016772268885713e-01   +4.516131181370188e-01   -7.646531681643136e-01   +2.682236762924285e-01   +1.417708750472651e-01   -1.289464797705389e-01   -1.124451200712759e-01   -6.515846946518848e-01   +6.152659843195938e-01   -5.346479983025536e-01; +6.342904111660627e-01   -1.013062503407190e-01   +2.380537472601414e-01   +7.068875980613003e-01   +5.389088187616560e-01   +3.195201466648203e-01   +6.179255155453352e-02   +1.828157977477920e-01   +3.346034846556185e-01   +1.076771250019601e-01   -2.416500276521517e-01   -5.521115204378920e-01   -7.452648102615655e-02   -2.546213572868937e-01   -5.521832511019167e-01   -4.518570698176851e-01; +5.639353409920800e-01   +2.833906479437963e-01   +5.477991138709565e-01   -6.562591022980651e-01   +6.716764938098171e-02   -3.783218007871639e-01   -5.102767749537736e-02   +6.758724581042533e-01   -1.927631185910942e-01   +6.731485178548339e-03   -6.386060476298040e-01   -6.031205063337963e-01   +2.352822709053196e-01   -3.076808854169654e-01   +3.147132475614429e-02   +6.554559536473794e-01; +3.881870586572194e-01   -5.380732762067910e-01   +2.526441933482716e-01   +2.632854863325882e-01   -7.224209563836137e-01   -9.520184467663425e-01   +4.474167331811620e-01   +2.875390025551063e-01   +2.657829251190525e-01   +3.746871594343347e-01   -1.128185963456697e-01   +4.419332483309637e-02   +2.696024816266097e-01   +2.905678207044757e-01   -3.146152194072199e-01   +3.648761766624232e-01];
L1E_L1I_iGABA_netcon = [+7.592294755214463e-01   -5.091114986498323e-01   +2.988244274032345e-01   +9.881281526446145e-02   +8.377009398440280e-02   -3.522461472628698e-01   +1.542388054357348e-01   -5.444516580081299e-01   -1.598046886866329e-01   +6.217417549735894e-03   +4.522400257011224e-01   +5.584019166889622e-03   +1.075085941025659e-01   -9.422012390399076e-02   -2.838126978671988e-01   -3.031475094460260e-01; +1.356745579696502e-01   +9.544702070491044e-02   +4.091885110280513e-01   -1.789174404258859e-01   -7.970654914615510e-02   -6.878251854723326e-01   -6.116648371960619e-01   +2.578058989557552e-01   +7.436518347786034e-01   +7.705279491351337e-01   -3.337425058823141e-01   +9.268411200239126e-01   -2.066034307775370e-01   +3.251231507637024e-01   +3.460550294316823e-01   -1.547419857199503e-01; -4.261836020422190e-01   +9.208339465552070e-01   +7.142551835307868e-01   +2.770246101844704e-01   -1.170829088171088e-01   +2.545979912368646e-01   -3.524209559311672e-01   +3.967541946435164e-01   +3.988713426803049e-01   +2.661872982063249e-01   +6.226773108896100e-01   -1.982467964443538e-01   -6.794878221243504e-01   -3.114600403730439e-01   -2.172196476145105e-01   +1.056082442507240e-01; -1.948207247160498e-01   +5.926232021539715e-01   +1.798264097635849e-01   -8.879490941630559e-02   -3.147357230849593e-01   +3.214915814021977e-01   -5.088138996930883e-01   +2.788835014316522e-01   +2.556679419558224e-01   -2.068414561036913e-01   +9.169181002136425e-01   -6.601418580814674e-01   +2.232332416301076e-01   +1.221125169966637e-01   -6.520713206818075e-01   -4.252522029247758e-01; -5.571443092770089e-01   -2.455131624166969e-01   +3.089917389183634e-02   +5.752960043476762e-01   +6.126863039773609e-01   -6.397368884464866e-01   +6.156300150514130e-01   +7.986965888510600e-01   +3.001365284824343e-02   -2.453213022192861e-01   +3.223994781814461e-01   -3.754205911789038e-01   +4.750998077369922e-01   +2.479201520058413e-01   +7.589017631341852e-01   +3.038569391894192e-02; -4.323722901895184e-01   -2.307919663465842e-01   +4.122913884575542e-01   -5.902329384536885e-01   -2.632414586985760e-01   +5.194596135896727e-01   -7.551656695294809e-01   +3.012293135974629e-01   +3.320144000228650e-01   +1.014949446908378e-01   +2.089928161912205e-01   +4.544000506237703e-02   -7.760734383411769e-02   +8.694148422535943e-01   +6.696012604651809e-02   +3.530839860845569e-01; -6.651527854434940e-01   +2.219659818696543e-01   -2.405020907144688e-01   +7.080804191229232e-01   +1.839637273991067e-01   +2.451805058648654e-01   -7.910229076664768e-02   -3.898822745072654e-01   -1.387743820454312e-01   -6.073944030566194e-01   -8.227658012403762e-01   +4.295678639477120e-01   +1.134402360356161e-02   -2.186956122192758e-01   +5.052386160398081e-02   -1.499022017956676e-01; +4.653359601882883e-01   +3.397496431535006e-01   +6.280160590101191e-01   +5.903932331239476e-01   +7.226116535935310e-01   -3.597134392494850e-01   -5.727376367923586e-01   +7.498489961593516e-02   +5.598468432251923e-01   +2.591450639210185e-01   +3.846606175619655e-01   +2.546199581218855e-01   +6.089557527859731e-02   -1.000000000000000e+00   +2.442449708232384e-01   +4.292826177867160e-01; +2.135344202564969e-01   -1.416884218240080e-01   +3.060870481951179e-01   +3.831326021268875e-01   -3.086157388465492e-01   -1.303528936685519e-01   -3.729683656474262e-01   -2.158580756381115e-01   +6.638292368320233e-03   -5.763271163650009e-01   -2.597876067176084e-01   -6.718293506175563e-02   -3.192631842517926e-01   -1.714657532622386e-01   +5.629521692759901e-01   +1.408416567407045e-01; +2.647768000174390e-01   +4.555157077913688e-01   -3.991079980536035e-02   +6.645382381387386e-01   -1.462998890720022e-01   -7.176026474488172e-01   -6.096902411522921e-01   +9.882212805889952e-03   +3.373024071778522e-01   +7.465596089103588e-02   -4.892020702209001e-01   -3.130404782212091e-01   +2.290607026840673e-01   +3.304591774466568e-01   +5.190759109557669e-01   -2.216089017861443e-01; -7.054734674492160e-01   +3.111641044977861e-01   -5.152608576487439e-01   -1.062221022411925e-01   +5.058495919904379e-02   +1.769646735116953e-01   -4.135351330429292e-01   +2.644556569244405e-01   -2.387996499795133e-01   +2.521521501412596e-01   -4.552768918966959e-02   +5.538998168555181e-02   +3.924803236163866e-01   +1.998195544500236e-01   +5.856860994267140e-01   +6.588501325288836e-01; -1.836199155417659e-01   -3.294491690858606e-01   -1.521254850102532e-01   +6.514645297510179e-01   +1.611609023045709e-01   -5.821071016826741e-01   +6.928689003939700e-01   +1.134480458083898e-02   +3.281649877492162e-02   -9.597174735002210e-02   -3.213614023391001e-01   +7.641920436818108e-01   -3.933928866991618e-01   +4.263932800139684e-02   +5.883734836905749e-02   -6.871623469902730e-01; +4.393246298056525e-01   +2.650904222478771e-01   -4.874042082639328e-01   +3.921257449345521e-01   +2.730308291171014e-01   +2.690381518800882e-01   -3.328295548431063e-01   +1.741544883249753e-01   +2.224743699306907e-01   +8.711694337890369e-01   -7.009864818016420e-01   +3.384704974514061e-01   -2.554702016333233e-01   +4.469998849737328e-01   +4.685453250536697e-01   +3.778542065700324e-01; +3.496379851077519e-01   +5.102646135804922e-01   -2.160812490454850e-01   -1.302379726798900e-01   -2.805525767967873e-02   -6.651569245436678e-01   +2.468563475895678e-01   -5.684354991970375e-01   -7.603745853314403e-02   +1.208713339699765e-01   -3.076145065214898e-01   -1.562264759577920e-01   +4.983326087299457e-01   -4.507059769498289e-01   +2.742757926920639e-01   -3.607772827056889e-01; -4.518083067051435e-01   -1.579777938140091e-01   +3.351346979113284e-01   -1.823565310900179e-01   +1.105726279178254e-01   -3.504785413539635e-01   +5.019399051589835e-01   +3.139766294267935e-01   +4.602615588232227e-01   +2.955245555564128e-01   +5.104883209421452e-01   -1.036535211958413e-01   -6.466466271886292e-01   -2.717980168211194e-01   +2.455650457868916e-01   -3.602679821017062e-01; +1.975598505157513e-01   -2.167206188462039e-01   +4.032307880041717e-01   +4.589653886426431e-01   +6.888823438930536e-01   +4.705978689381478e-01   -3.613149926003559e-02   +8.572904635837240e-02   -4.007160105747865e-01   -1.335857993521160e-01   +1.543276034541963e-01   -6.232937362112183e-01   -1.813366239422020e-01   -3.586826544044963e-01   +5.856265669326838e-01   +9.747366713575513e-02];
L2I_L1I_iGABA_netcon = [-6.125901823233725e-01   +1.540062895989910e-01   +9.173090742288996e-01   -4.977079526115343e-01   +8.854937732748835e-02   +1.619211856080618e-01   -5.891888954681034e-01   +2.167136345109187e-01; +2.820285368573714e-01   +1.112032081747860e-01   -3.271062317090074e-01   -1.008109373403769e-01   +7.696601999453575e-01   -1.804582827253397e-01   +8.924654907429744e-01   +1.526082147117364e-01; +7.840426328588659e-01   -4.054374697471660e-02   +8.354433558081668e-02   +2.142991571712355e-01   -1.410750204124983e-01   +2.989154494261151e-01   -1.641521564037683e-01   +8.283598985407584e-01; -6.483820613453183e-01   +3.764624831215537e-01   +2.896667598901781e-01   -1.395429337088054e-01   -5.698342887798120e-01   -3.457480795483379e-01   +7.166627183466608e-01   +3.596607773186605e-01; -5.351316361338860e-01   -2.935434657282135e-01   -3.043104782301342e-01   -7.844750388874588e-01   -3.980541216681953e-01   +9.962029792467529e-01   +8.000818860391424e-01   -2.979954532118562e-01; +1.659164521866575e-01   -2.542224896679796e-01   -5.124710755323213e-02   -8.376578306756285e-01   -6.901492189946512e-01   -6.756812278148061e-02   -3.724316416365793e-01   -2.411770409873634e-01; +5.970463385784426e-01   +2.633050288779856e-01   +2.616454287867814e-01   +2.966370444512033e-01   +1.744519442037065e-01   -4.876546781245912e-01   +1.000000000000000e+00   +6.155682485328762e-01; +1.782920571705119e-01   -3.490085472578211e-01   -3.874387819247223e-01   -2.783175671698457e-01   +5.085370583340253e-01   +4.604069921185414e-01   -2.828830334529799e-03   +5.100504219114090e-01; -8.582092228507431e-01   +5.794415778029498e-01   -2.603358895566730e-01   -1.317897561289892e-02   -2.070630713966941e-01   +7.589582545026735e-01   -2.621798551199582e-01   -8.978444089337388e-02; +4.899120532216039e-01   -2.390784450508499e-01   -2.407070858441972e-01   -8.619966311729713e-01   +7.798462177438896e-01   +5.894691040364609e-01   -3.592750495988496e-01   +3.245863793326619e-01; -5.451773848458752e-01   +3.022091490995353e-01   -4.159646749971928e-01   +2.760686620915790e-01   -4.761069369596457e-01   +9.898436265666724e-01   -5.202960573661031e-01   -6.532115288559379e-01; +9.155262468749532e-01   +4.606336938368579e-02   +3.419113014493592e-01   -2.925198256048803e-01   -2.968637699705372e-01   -6.143334487622778e-01   -3.280201556669159e-01   -4.975441038643464e-01; +1.306079677433571e-01   -1.429123564750102e-01   +1.563461060955442e-01   -2.918528620263498e-02   +7.251154228209351e-01   -7.542902140204043e-01   -2.141775642821089e-01   +5.380330166060696e-01; +6.600925484022107e-03   -6.365881029701638e-01   -7.551920544335058e-01   +7.874328980099508e-01   +4.860737237431012e-01   +8.895380730241306e-02   +3.529462230034774e-01   +3.392745230431523e-01; +7.814782675463889e-01   -6.725580484130161e-02   +1.303243637429387e-01   +3.964954802904628e-02   -8.539456999659054e-02   +6.105725975776800e-01   +4.521070755908567e-01   -6.942759017993285e-01; -1.572867504555829e-01   -5.855357407465738e-02   +5.242387836269059e-01   -8.058418311710629e-02   +8.760063195058182e-01   -5.776570699097395e-02   -2.589965658689816e-02   +3.414025123860674e-01];
L1I_L2I_iGABA_netcon = [-2.510480549370516e-01   +2.063060694482458e-01   +9.804658713411800e-02   +2.002075021132557e-02   +6.251148044412015e-01   +6.185490900099233e-01   +1.982108083491227e-01   -5.786954180202272e-01   -3.626614255902637e-01   +2.132009445724536e-01   -1.106309498153373e-01   +5.320450522168452e-01   +8.590082633092041e-01   -4.850316679463977e-01   +7.410282665097935e-02   +2.313901585451281e-01; +1.530205990132096e-01   -8.689909107326450e-02   -2.598742365792925e-01   +3.479647982966435e-01   -6.766848727504741e-02   +7.386686252771961e-01   +1.404691666125626e-01   -3.997471362333040e-02   -3.962439204874695e-01   -1.662319211502632e-01   -5.609296252461400e-01   +5.323612845064882e-01   +5.612468765543175e-01   -5.271167792032663e-01   -1.237831189349789e-01   -4.827635128626007e-01; +5.715822813958398e-01   +2.210728952032025e-01   -1.254359637031800e-01   -2.277540109134621e-01   -4.887998814554730e-01   +2.349369271379633e-01   +5.617927401590335e-01   +1.310905081966338e-01   -7.293610941095406e-02   +8.918449566368478e-02   -6.169695048049767e-01   +4.455428593299745e-02   +5.884662209337215e-01   +5.123711723792219e-01   +1.230673231416459e-01   +6.783612502048297e-02; +9.757010000205903e-01   -6.875683673004116e-01   -3.156418418973119e-01   -4.330698609916053e-02   +1.957832322942443e-01   +2.834823159085809e-01   -1.561423177059716e-01   +4.322105153329634e-02   -1.815826803444048e-01   -3.176700629406320e-01   +5.201998049867662e-01   +1.213681352757821e-01   -9.891938318920852e-01   +3.832121838286864e-01   -9.749699222580720e-02   +1.715197060345576e-01; -4.869232858252650e-01   +2.075186534614291e-01   -3.576079255835775e-01   -8.425038875035412e-01   -2.204927410000341e-01   -6.161219043857173e-01   +3.627141082434256e-02   +3.574581391894689e-01   +7.110150317796347e-02   +2.847766422093370e-01   -3.650438266452695e-01   -2.975953685527915e-01   -2.080235569474501e-01   -1.808840829489432e-01   +1.384669894187415e-01   -2.413649648992408e-01; -4.845410308021213e-01   +4.860921542425448e-02   +7.894538381396494e-01   -2.847569885165613e-01   +2.687278230617225e-01   +6.046696235784157e-01   +3.967873536231972e-02   -2.864333853978997e-01   +3.210858399736216e-01   +5.524914187901165e-01   +3.079075586127506e-01   +7.404863391289371e-01   -2.476964656589933e-01   -2.396846450953027e-01   -2.546488589496623e-01   -2.259917337952181e-01; +7.979215416542057e-01   -2.302964738509118e-01   -5.943910686652527e-01   +3.323982407041147e-01   +1.000000000000000e+00   +2.861525658488948e-01   -5.809570020071237e-01   -2.460784439471098e-01   +7.129731365343400e-01   +5.402543835143686e-01   -7.458730688085767e-01   +1.141651402882045e-01   -2.809556016386454e-01   -1.099223237634582e-01   -5.361217276994109e-01   +1.611436973528886e-01; -4.989309277441363e-01   -6.178319768419942e-02   +9.648582310537729e-02   -4.753656661902476e-01   -4.642184315154172e-01   -5.808477553242803e-01   +6.874553656327793e-02   +8.045537374640243e-01   -2.046783957736472e-01   +1.121696147514115e-01   -2.155252879871497e-02   -2.329162630993236e-01   -2.670964367382869e-02   +8.137991307324423e-02   +4.313355782162596e-01   +5.146749225541422e-01];
L2E_L1E_iAMPA_netcon = [+2.229750819637653e-01   -3.693593933211651e-02   -1.547524730766991e-01   -7.656370600725447e-01   -8.220174579385831e-01   -3.336061086814649e-01   -8.367844384686531e-01   +1.150549294504984e-01; +2.363754306267322e-01   +2.547902825095846e-01   +9.810711488937160e-01   -4.709444176182767e-01   +2.457099729371749e-01   -6.106148093845242e-01   -3.085061711786874e-02   +2.320689062319474e-01; +3.636991138542733e-01   -5.318302201235342e-01   -3.838227899311898e-01   +4.439357439773680e-01   -3.355935155648204e-01   +5.995744776383561e-01   +1.428870716947069e-01   +2.005303046290855e-01; -5.175866944057217e-01   +2.453505376911009e-02   +6.082797217719771e-01   -1.817685557282630e-01   +5.195205389810293e-01   +7.306067766885463e-01   -4.520220467596821e-01   -2.751472386626974e-02; +2.578994463785762e-01   -1.883094638129058e-01   -3.113512682056302e-01   +1.000000000000000e+00   -2.720916235838557e-01   -1.962703856767128e-01   -3.525019838006231e-01   -6.324054007419376e-01; +2.072172510523312e-01   +9.900149822068341e-02   -7.454174430315021e-02   +5.167652058777529e-01   -5.104120797153037e-01   +4.662836516696215e-01   -3.144048171802937e-01   +1.761739623409552e-01; +8.456886165921483e-02   +2.334277835772865e-01   -8.214639011492068e-01   -1.433677752771365e-01   -4.241055049233710e-01   +5.685298478444938e-01   -3.728672137696232e-01   -3.990700396949544e-02; +7.261208690037652e-02   +3.391489092931360e-01   -6.791168391518246e-01   +5.094253279196073e-01   +1.260827631014823e-01   -6.326807470054105e-01   -8.661702944754793e-02   +6.909519775751648e-01; -5.775094274206515e-01   +3.126364140315446e-01   +5.233058254076014e-01   +1.682006033067722e-01   +6.635526800742689e-01   -5.729236922438764e-02   -7.043603537776757e-01   +5.485068193755491e-01; +3.768871230610659e-01   -2.565206818633716e-02   +2.443714365366866e-01   +6.218280845186354e-01   -1.096632097856690e-01   -5.219931189119934e-01   +9.005176631282863e-02   +6.334442736510615e-01; -1.559117332827185e-01   -5.921984957859069e-01   -4.005866731353000e-01   -6.166955872282062e-01   -3.000132861683538e-02   -6.982711641659213e-01   +1.815911315674832e-01   -7.854268390023234e-02; -6.567438084927905e-01   -2.929752374813299e-01   -6.286989992779423e-01   +1.703817586825136e-01   +5.457698739168739e-01   -1.699359995187543e-01   +3.413592124373169e-02   -5.376059653497630e-01; +1.439056357146164e-02   -5.026995021448701e-01   -1.031296973824489e-01   -6.384492933243807e-01   -3.629752997056750e-01   -6.736730372230245e-01   +5.588601392670585e-01   +4.520465412549342e-01; -2.309792818160387e-03   +4.671078249735459e-01   -6.858580795539022e-01   +1.730305794988951e-01   +2.794931132191766e-02   -4.163242494268296e-01   +6.402150148583593e-01   -7.499458184549637e-01; -3.443514510080476e-01   -4.769073947724785e-01   -2.177571845227592e-01   +5.759317259915440e-01   -1.741525126461080e-01   -5.799057959597569e-01   -1.848954409781327e-01   +3.067080925906814e-01; +3.210912032856159e-02   +5.388851349976378e-01   -3.879383183131031e-01   -8.625096041511134e-02   -3.992686753073720e-01   +5.369524982498017e-01   -4.938999589342594e-01   -1.007078853036343e-01];
L1E_L2E_iAMPA_netcon = [-1.012018442820109e-02   -4.749597590798094e-01   +6.048831567547824e-01   -3.614281604347556e-01   +2.510043378422336e-01   +8.211430279785696e-01   +1.626982441365984e-01   -2.847799554885040e-01   -3.462886787869310e-01   -8.180781630746812e-01   +5.713770762990786e-01   +8.529939031872258e-02   +2.292749127624980e-01   -3.962606207093810e-01   +1.212013031868735e-01   -1.819293011717035e-01; +8.160113824982462e-02   -5.123528603366219e-01   +4.702024121387596e-01   +1.480119474733109e-01   -1.760895932273951e-01   +6.290431928408241e-01   -3.165570795692220e-01   -1.815366076325382e-02   -1.224355501152979e-01   +4.454445375897723e-01   +5.995397232837425e-02   +3.117440745742715e-01   -4.349601665992819e-02   -3.439731127531170e-01   +2.865960451609997e-01   -1.718023659378290e-01; -1.000000000000000e+00   -3.285386666127035e-01   +4.806450848511439e-01   +2.196453790875875e-01   +6.499633182224812e-01   +6.243302582524496e-01   -3.166018457751398e-01   -2.063368702425317e-01   -3.754207434408360e-02   -2.360384737137831e-01   -4.054886348186573e-01   -4.871002610775909e-01   -7.404424798231412e-01   -1.936098961981521e-01   +5.074497758932414e-01   +1.486928689938213e-01; +4.221697400940772e-02   -5.917118756624982e-01   +1.295192440045118e-01   -3.466919322204705e-01   +7.782849106239598e-01   -7.969043524350695e-02   -7.194913643399088e-02   +6.277098088574519e-01   +3.021780305213405e-02   +7.022808631174597e-01   +3.037670222017609e-02   +2.954859711605065e-02   +6.452322556833767e-01   -2.700404611522217e-01   +9.517230578915810e-02   -5.072942403187163e-01; +4.588995883946371e-01   +4.215287326755444e-01   -6.455215778467920e-02   -6.439972606667971e-02   -1.750106313066372e-01   +2.250288096754458e-01   +6.364188125134185e-01   -4.680492400730936e-01   +2.253785611842877e-01   -3.607089044089083e-01   -4.441914279508197e-01   +4.732206300330144e-01   +3.700785030904185e-02   +2.009855631729938e-02   +2.366339450920812e-01   -4.400416889515583e-01; +5.876611413782447e-01   -4.853971805895034e-01   -4.236585047599211e-01   +5.563183837079372e-01   -5.289510402658253e-01   +4.782414947255233e-02   -4.692445256120860e-01   -2.446806483458428e-01   -1.311680442340624e-01   -2.403405695626242e-01   -1.022812678104405e-01   -9.944147498609699e-03   +4.670792963830889e-01   -8.448983322744090e-01   -1.726604434686568e-02   +2.564516066086704e-01; -6.943757321218170e-01   -5.965208345218104e-01   -3.257634242033171e-01   -2.224165286056334e-01   -3.261635362510337e-01   -7.022528425793266e-02   -2.214526293290437e-01   +6.951479644062303e-02   -4.160492102091583e-02   +4.486277307789146e-01   +2.819309484805965e-01   -5.233828911719604e-01   -3.565341146251210e-02   +1.224474596915245e-01   -5.152385662392416e-01   +3.960720014875943e-01; -2.103142042997816e-01   +2.041458659333565e-01   -5.217876115744056e-01   +2.723921087226361e-01   -2.246321712993492e-01   -2.482611389305058e-01   -6.381637340025413e-01   +9.482491004546666e-02   -8.405568488964661e-01   +1.086475293536774e-01   +7.297914218214589e-02   -1.478511198565212e-02   -9.677520385288993e-02   -2.722113347870317e-01   +6.873064938504114e-01   -1.164956147681480e-01];
L2I_L2E_iAMPA_netcon = [+9.090333544111480e-01   -1.495653660668231e-01   -7.475901761615145e-01   -3.574890768706576e-01   -1.957025566843104e-01   +1.788481305884473e-01   +2.276553956048291e-01   -2.746045535260627e-01; -2.549700716140538e-02   -2.844592589558570e-01   -6.420681526809909e-01   -3.873991107338327e-01   +4.968681276384733e-01   -4.492870949935259e-01   +2.127201743945003e-01   -1.661041266297819e-01; +4.160925199173487e-02   +6.311404850251306e-03   -7.810683394836588e-01   -1.054838967425326e-01   -2.380881085708954e-01   -6.464355599603470e-01   -1.100166038247514e-03   +2.355941174686327e-01; -6.349149495469366e-01   +2.153405921560916e-02   +1.000000000000000e+00   -4.792151859601383e-01   -2.194037227302267e-02   +3.431003938777943e-01   +4.498703656533819e-01   -3.549368314311838e-01; -1.839192108388704e-01   -3.936255467620085e-01   -2.102147482367709e-01   +1.906668021005801e-01   -3.516142859161505e-01   -6.114233872391514e-01   -1.106716763889405e-01   +3.858945132688556e-01; +8.047173645689513e-02   +4.869008039503652e-02   +5.856757300345180e-01   +4.118290542701332e-01   -1.274395611806199e-01   +3.128734025197098e-01   -3.809182875577253e-01   +2.441255645577113e-01; +5.459157725506383e-01   +1.510141690915451e-01   +3.058999278639205e-01   +2.310365635574478e-01   +5.409835605148641e-01   -2.510818714408566e-01   -3.909396590398814e-02   +1.495930138111692e-01; +4.560979313415872e-01   -5.638628850998464e-01   +2.019925125088783e-01   -2.131562543347142e-01   +4.902696875149072e-01   -6.046856618129859e-01   -6.085859261617933e-02   +7.205550958597363e-01];
L2E_L2I_iGABA_netcon = [+5.904242010522420e-01   +3.797177034904546e-01   -1.573499379393721e-01   -3.074135132287295e-01   -2.931504605735672e-01   -1.929264672260620e-01   +6.978978058595904e-01   +5.487340801452268e-01; -4.439204359735744e-01   +4.452146553731675e-01   -5.888336100646016e-01   +2.371505035174418e-01   -3.889861130198355e-01   +7.303804816091957e-01   -6.690728144394908e-01   +7.038486725753224e-01; -9.250699970381998e-01   -8.171297033105090e-01   -5.824860021004947e-01   +7.170742873411167e-01   +5.445068911025084e-01   -3.513726043473955e-01   +3.455300937361225e-01   -9.228753855032167e-01; +4.405971818413935e-01   -5.087884669494056e-01   -4.664588695327366e-01   +1.598737916778730e-01   +7.827900083532305e-01   -4.078430426013148e-01   -6.783274566749010e-01   -6.045998230166818e-01; +4.101865485271875e-01   -1.408994860997380e-01   -1.174408115435377e-01   +3.788492920164479e-01   +3.293703117972878e-01   +5.645249427192449e-01   -1.736087071186253e-01   +2.222200240506486e-01; -1.000000000000000e+00   +3.378873900683482e-01   +2.096770113355405e-01   +2.315819954621406e-01   +3.599011925757408e-02   +1.513447859976890e-01   -3.616276582794552e-03   +9.081334049557580e-01; +8.756084740406317e-01   -3.945981069183491e-02   +1.840747424974635e-01   -1.545267242107800e-01   +6.192769268648817e-01   -3.097020985041948e-01   -4.492270128720227e-01   -5.537947274070422e-01; -6.913823973601630e-01   -1.557897477238246e-01   -7.017109186319801e-01   -7.541372957946747e-01   +5.144537337073360e-01   +1.089631531757625e-01   +6.273023537681836e-01   +6.093487875968446e-01];
L3E_L2E_iAMPA_netcon = [+5.675072541787127e-01   +6.743772350794451e-01   -4.079924410428050e-01   +1.417283950691296e-01   +3.873630696602385e-01   +5.240054182784034e-01   -6.745919741225113e-01   -4.558098589964570e-01   +2.848890629403651e-01   -2.151064807757636e-01   -1.049385463914287e-01   +8.566055609056881e-01; -7.109492513175777e-02   +7.606941110532633e-01   -1.644078537907230e-01   +9.631022490858870e-01   +1.402574129596344e-01   +5.789528784580403e-01   +5.928792013898348e-02   -3.345743776190616e-01   +4.147512948356339e-01   +5.109842334851488e-01   -4.020999924727332e-01   -1.215464251048469e-01; +1.620097007332555e-01   -2.024812288686132e-01   +1.325064199396093e-02   +4.046973765622803e-01   -5.187791807478395e-01   +6.857861251837906e-01   -6.573487909959730e-01   -2.930675443065291e-02   -3.920764838361392e-01   +4.117401883682395e-01   +3.272197669280060e-01   -1.000000000000000e+00; -2.752675641696000e-03   -3.383465280480123e-01   +2.415789713585268e-01   +2.928142105887112e-01   -3.719082287274889e-01   +4.270988378431463e-01   -5.273961282658861e-01   -6.900549543122332e-01   +8.343544151020806e-02   -7.027678580400085e-01   -6.102855413949465e-01   +3.494894592418020e-01; +5.209007279590231e-01   -5.169471256953763e-01   -7.008205419487436e-02   -5.501833791288364e-01   +5.703668378668713e-01   +6.163218061033005e-01   -4.104536715996354e-02   +5.600227072012075e-01   -4.655121958593131e-01   +7.281881587207594e-01   -1.588807848960998e-02   +3.537957731069117e-01; +3.788101147415299e-01   -3.277915786864605e-01   -8.816389151076260e-01   +7.097860916589934e-01   +5.927605123652815e-01   -1.644587486829227e-01   +6.800762681982957e-01   +9.176919631703653e-02   +2.003726073350358e-01   +6.921334402521360e-01   +1.888987117472269e-02   -4.416054148595218e-01; +2.786745663019536e-01   +8.076129795634157e-01   -5.713729768952809e-01   -7.684049301333349e-01   +5.958543626728015e-01   -2.940510854222309e-01   -2.749047746281127e-01   -5.575612660898041e-01   +5.036270703571875e-01   -5.029701501038821e-01   -1.462265837730537e-01   -6.508004452474675e-01; -9.035653515694790e-02   -3.465730913882148e-01   -4.416362749869818e-01   +6.637724315379229e-01   -4.859975762735622e-01   -3.861019292951950e-01   -7.080356854181973e-01   -1.170018770037422e-01   +6.512902072194567e-01   -4.759487298871087e-01   +3.855250224561214e-01   -4.964295372601162e-01];
L3I_L2I_iGABA_netcon = [+5.515950094042863e-01   +1.296437525389770e-01   -3.803154695655631e-01   -3.229086677074758e-01   +2.987061236989358e-01   +6.309184807292694e-01   -6.160325131873395e-01   +4.286781268206455e-01   +4.365746301451917e-01   +4.218370746886721e-01   -7.137778608464909e-01   -8.325439437710671e-01; +9.272657638770015e-02   -1.407254829142993e-01   -5.100980495274404e-01   -3.368126789788304e-01   -1.144458678855755e-01   +6.056488715000694e-01   +3.066217451549414e-01   -4.051419968264159e-01   +1.381644937811360e-01   +5.440540173370296e-01   -1.697844422945674e-01   +5.404669632666775e-01; +2.237797698952525e-01   +2.849501433197834e-01   -8.631796574895882e-01   -1.491653685422309e-01   +5.087927481520426e-01   -2.455521330214728e-01   -1.321922119875389e-01   -4.076995368218990e-01   -3.765338645591547e-01   -3.919667031386450e-02   -6.752575061242275e-01   -4.953851943370850e-01; +6.209562890083677e-01   +2.376431390520954e-02   +9.290440797634665e-01   -1.639432261502317e-01   +2.757839069170028e-01   +3.965623124941059e-01   +3.038304449034656e-01   +8.358201380278840e-02   +7.271828542853404e-01   -6.469220907419784e-01   +2.340103106429445e-01   +6.564653284066109e-01; +7.703461287923145e-01   -4.370752036799752e-01   -4.849743794648059e-03   -5.813602112804855e-01   -3.076753012350629e-01   +6.801653614303979e-01   +4.686100925382299e-01   -2.536521868634169e-01   +1.804125055571185e-01   +4.429146547984381e-01   +5.606709177980598e-01   +7.066581798777439e-01; -1.490564342047804e-01   -5.800940059509024e-02   -1.000000000000000e+00   +1.136940090066724e-01   -2.596862894618845e-01   -4.708719639168165e-01   -5.732982852368198e-01   +2.826999739514760e-01   +1.349441069488912e-01   -4.556814867275546e-01   -4.222991348981729e-01   +3.908776401144921e-01; -2.113969224794632e-01   +3.240763333513111e-01   +9.825897997955325e-01   -2.170137517966350e-01   +5.544318699037259e-01   +3.910014288091468e-01   +6.238281480372699e-01   -1.192349846024886e-01   -6.421573637042044e-01   -4.878325713623249e-01   +1.052078308090780e-01   -1.884467476448698e-01; +7.476413938259814e-02   -4.273176269240093e-01   +3.244073565296696e-01   +6.143044748701609e-01   +7.083069826407267e-01   -1.441217577683856e-01   -1.670387686468010e-01   +2.052750844309110e-01   -6.322198341693844e-01   +2.282169713559299e-01   +5.701359533075627e-01   +2.960033583442405e-01];
L2E_L3E_iAMPA_netcon = [-3.989330692848641e-01   +7.015423396704743e-01   +1.000000000000000e+00   -4.002610898555264e-01   -8.981259653783250e-02   -1.519355764127782e-01   -3.464951213203826e-01   +7.089988336832053e-01; +4.381859406902281e-02   -2.620632974192241e-01   +7.278928908706519e-01   +2.770138987012099e-01   +3.312972927820469e-01   +1.327685091012547e-01   +2.425422117777128e-01   -2.358379735108458e-01; +9.053369059013395e-01   +5.443024224095721e-01   -3.644425737687623e-01   +3.175030104964249e-01   -4.739074968522656e-01   +7.336995070842832e-01   +1.921449251518384e-01   +6.254831974611531e-02; +1.248360770675259e-01   +1.484887799320893e-01   -7.000911508085278e-02   -4.977260126308444e-01   +1.426704328278032e-01   +8.485713071340931e-01   -2.343044155001029e-01   +4.468837223006542e-01; -3.583899981975632e-01   -2.528632389625637e-01   -5.038303241047531e-01   +4.836174423468684e-01   +7.051608810948046e-01   -2.302984680816825e-01   -1.919580677970449e-01   +6.126066162030439e-01; +1.430852307805038e-01   +6.405642070716357e-01   +1.463082417516451e-01   -3.899820465789313e-01   +2.019269089121862e-01   -1.284536756490665e-01   -3.261222831499308e-01   +1.195676076509848e-03; -7.196087244146967e-01   -3.675067468847025e-01   +8.491626505636217e-02   +1.443071053910044e-01   -3.006577395187092e-01   -4.294371634950395e-01   +9.032803557844357e-02   -4.284874261586250e-01; +1.211524348590752e-01   +2.852081617289581e-01   +3.289079532124612e-02   -4.134101777166860e-01   -1.024925842004396e-01   +6.590443722794397e-02   -4.524809678648544e-01   +4.876614138162843e-01; +2.381166400557138e-01   -9.212138883109855e-02   +3.060172286932004e-01   -6.559870841917340e-01   -4.826021444552525e-01   -1.520437211398490e-01   -7.243930253945278e-01   -2.470730921676031e-01; -3.190197348048203e-01   -6.770998279309449e-02   +1.288955316628720e-01   -9.617681004338628e-02   -1.480462055848555e-02   -1.140569443395378e-01   +3.070612218859708e-01   -5.626436676364956e-01; -3.820719237908358e-01   -6.365360574625553e-01   -6.783671638541290e-01   +5.598130322656875e-01   -5.806571726455990e-01   +3.151834140945700e-03   -2.079954880610327e-01   +2.468518609239526e-01; +1.857819943086182e-02   +1.210868652174844e-01   -2.160251937439239e-01   +6.124807337458025e-01   -8.928752616826277e-01   -3.787949296648428e-01   -2.095262470524073e-01   -9.299955550255047e-02];
L2I_L3I_iGABA_netcon = [+2.674800285101546e-02   -3.104395851552211e-01   -6.534100917446004e-01   -5.695966083251565e-01   +3.563386870336084e-02   -4.867031483498580e-01   +3.245395728665781e-01   +4.062306412560899e-01; -3.531663711764746e-01   -4.720759086505932e-01   +3.892153705809422e-01   +3.603944303270830e-01   +5.350518418362923e-01   -6.047285725694124e-01   +7.723388949088271e-01   -4.420020363928509e-01; -2.147014835256923e-01   -4.154360280265327e-01   +2.292864689940542e-02   -1.650222049977294e-01   -5.460614958902082e-01   -4.270177376834907e-01   -4.706805491748541e-01   +2.104728044485760e-01; -7.350848316643426e-01   -5.910444469798987e-01   -6.230145442207727e-01   +8.066033512714297e-01   +2.558105347432134e-01   +2.543728744514603e-01   -5.837971150412599e-01   +2.655396470130121e-01; -5.284742837383071e-01   -3.180172596919825e-01   -7.874363223822602e-01   +7.363433787147711e-01   -5.313425116569205e-01   +6.509326206332108e-01   +5.524053958828795e-01   +5.914978006426579e-01; +5.083798026068400e-01   -1.156594241007047e-01   +2.035899680755059e-01   +6.057992508391313e-01   +6.861406118586376e-01   +5.706733291313272e-01   -4.571607467459531e-01   -7.143709153754053e-02; -4.197130320554467e-01   -1.539022911770626e-01   +1.968781276240178e-01   +5.479628981650088e-01   -1.249494133439487e-01   +1.000000000000000e+00   +4.423030228839242e-01   +4.997416217238526e-01; +3.860412992697790e-01   +4.412288195159532e-01   +3.405166279431097e-01   +7.199991271766418e-01   -5.365968003245408e-01   +9.459118406247844e-01   -6.753157401103368e-02   +3.356046444281159e-01; +2.146150683692572e-01   +4.631298366037632e-01   +9.898755340815925e-01   -7.494990991339594e-01   -1.132302617760502e-01   +3.273238415302923e-02   +3.201649495503820e-01   +4.471486204786506e-01; -4.495061995912995e-01   -8.929713494034344e-01   +3.381111160183580e-01   -4.408304584301525e-02   +7.427400093323424e-01   -2.598661516116242e-01   +5.082135664822106e-01   +5.767080772211872e-03; +4.218317203025317e-01   -1.217073772385561e-01   -3.715039011449323e-01   -5.386140544998885e-01   +5.605907862254553e-01   +1.973680680702515e-01   -4.640362958054155e-01   +4.286481677897161e-01; +3.640054479164806e-01   +7.248246019471887e-01   +3.296043279274994e-01   +1.960886168993784e-01   +2.985531147551295e-01   +5.283796223097090e-01   -5.785736962059947e-01   +1.355319964114762e-01];
L3I_L3E_iAMPA_netcon = [-4.993550479332847e-01   -7.579048151865038e-01   +1.256958665801736e-01   +1.207266496189255e-01   -4.947859998337717e-01   -4.271581648863250e-02   -6.166825015189609e-01   -3.561740533219247e-01   +6.383511311685953e-01   +2.014046311787860e-01   -1.752076126080486e-01   +6.914279679380533e-01; +4.105783047168789e-01   +3.132188683844439e-01   +6.921653693932481e-01   -8.407107670711348e-01   +7.261288053614426e-01   +3.177747131385578e-01   +7.632800374313491e-01   +2.210511574321903e-01   -5.480159676969041e-01   -8.788343116419718e-01   +2.425885404984315e-01   -2.306615285210703e-01; -8.087661934555310e-01   +1.500389066079413e-01   +1.293301632986543e-01   -5.616839413500973e-02   +1.594531522016155e-01   +5.927964960128072e-01   -1.955834107133279e-01   -2.612033543679798e-01   +6.401569499301494e-01   +1.552144183293592e-01   -6.784693190038008e-02   -5.020727890055329e-01; -2.483455351729232e-01   +2.765371734867012e-01   -6.428603044987767e-01   +1.786236178346551e-01   -1.478399882146829e-02   +1.508641713061426e-01   -3.921113835942306e-01   +7.647883266903289e-01   -1.808568816766444e-01   +3.509117072934733e-01   -7.315439533596425e-01   +2.832943343044974e-01; -4.523614485119609e-01   -4.348074350616312e-01   +3.055820737916201e-01   +1.837043514939876e-01   -9.143385060800682e-02   +7.487440152813939e-02   +4.826582671746230e-02   -2.829825137322533e-01   +8.275892659632299e-02   -7.461600673079611e-01   -3.587388662712290e-01   -5.663641053320394e-01; +7.557362322285428e-02   -1.515208455548972e-03   +3.635033442776426e-01   +1.200194384945314e-01   +5.235600086706522e-02   +9.317831541498115e-01   -6.349271544531466e-01   +2.322987540056329e-01   -3.962889033266573e-02   +5.058382187588784e-01   +1.442498823217926e-01   +5.839891089822837e-02; -2.075474538289062e-01   -1.147450139361905e-01   +3.649793083258608e-01   +5.085848453291194e-03   -7.976413678831474e-01   +5.987304875670891e-01   +4.446271431127923e-01   +6.687482824971781e-01   +4.132151534910519e-01   +5.019560473735565e-01   +4.534442793688117e-01   +6.385956887749744e-01; +2.936020314403395e-01   -2.446270260093025e-01   -6.484397253758754e-02   +2.652234613870661e-02   +5.894167756929539e-01   -3.331867644799011e-01   +3.416027268932800e-01   -3.309259635686813e-02   +7.604144174112545e-01   +2.637104135121555e-01   +4.005535678858588e-01   -1.012759744898548e-01; -8.136943598847479e-01   +3.236854742110697e-01   +1.140230276504218e-01   -4.562967476669377e-01   +1.811263383046765e-01   -4.645844623388197e-01   +2.930345733398184e-01   +1.050518784869643e-02   -1.295706524594345e-01   -2.573601380682670e-01   -3.285092724803139e-01   -1.163528477633736e-01; +5.437353035998247e-01   -7.671829868102963e-02   -1.650052576468231e-01   -6.797172551771891e-02   +4.567540048547184e-02   +4.108154597133434e-01   -5.020421111025307e-01   +1.504891710572445e-01   -7.153224231000525e-01   +3.986808119135625e-01   -1.000000000000000e+00   -1.227119296751262e-01; -2.942818019502262e-01   +5.139246540947749e-01   +1.847567750090616e-02   -8.567149358407371e-01   +1.327819700024446e-01   +3.748911793224006e-01   +2.276829545184895e-01   -3.672634414439793e-01   -4.862476559436329e-01   +5.630504539596363e-01   +7.123024424535088e-01   -3.690091950845215e-01; -4.433951523316986e-01   +3.163575645816880e-01   +6.112837271448673e-01   -2.967856155826666e-01   -4.194328748121630e-01   +5.493048843932563e-01   -4.560607657618986e-02   -1.181971509671963e-01   +2.712834343041509e-01   -3.629454398901029e-01   -9.414694836042681e-02   -8.061677811009887e-02];
L3E_L3I_iGABA_netcon = [-1.584690096679640e-01   +4.620039178352087e-01   -9.675313315630171e-01   +1.764144792752630e-01   -1.711671985313675e-01   +5.181625503493154e-01   +6.784766197864854e-01   +7.571957617340893e-01   +8.934227393923930e-01   -8.823037719863571e-01   +5.891500552180952e-01   +7.185308884776412e-01; -6.680810829931318e-01   -3.894040843145132e-01   +1.458637431823472e-01   -2.058419490851200e-01   +2.012679588682225e-01   -5.242118662994372e-01   -1.635431404478105e-02   -6.221698739316533e-01   +9.845562162772608e-01   -8.809029127422395e-01   +6.875717836872018e-01   +3.602082133529774e-03; +6.359720133237265e-01   -3.957286644116730e-01   -6.867795207401367e-01   -1.042148390307231e-01   -4.583274150244038e-01   -2.555996122546537e-01   -4.965036292222507e-01   +5.103561315950986e-01   -1.070409657001168e-01   +2.939185435640668e-01   -4.761316629264558e-01   +1.818812094254076e-01; +4.066436262852334e-01   +4.082709210106230e-01   -3.364741875577816e-01   -4.706849438295202e-01   -6.650893287299838e-01   +4.361307018831426e-01   +9.782899801016715e-01   -8.393905859536006e-01   +2.731588815010292e-01   -7.645916981145606e-01   +6.396687335565555e-01   -3.245827148506771e-02; +1.398928874866630e-01   -4.039045909362347e-01   +1.222657368766244e-02   -5.023550676929860e-01   +6.110663543070750e-02   +1.892643039320286e-01   -7.338375669850806e-01   -5.064818795452061e-01   -7.616209262664925e-01   +7.940360434587935e-01   -4.549324266253995e-01   +8.306295680660581e-01; -2.732305715051466e-01   -5.275377347410358e-01   +3.756598275121197e-01   +4.557900586157585e-01   -6.321438250976475e-01   -7.126380913148374e-01   +7.546515409003526e-01   -3.732302316188539e-01   +4.452998245022717e-01   +6.405746791177927e-02   -2.537896168383697e-01   -9.040135089254114e-01; +8.898820793572021e-02   -5.829457225667576e-01   +1.353303951914066e-02   -4.455051281672838e-01   -2.718232292904759e-01   -5.051243234902375e-01   -7.300370611101964e-01   -3.874197061940635e-01   -5.657934449152634e-01   +6.316073318333093e-02   -8.857445374585311e-01   -3.389943478461380e-01; +8.720710217198012e-01   +2.430443134193150e-01   -7.114149217892998e-01   +7.870220995429708e-01   -5.335132644225242e-01   +1.125140112638503e-01   -2.045369809745501e-01   +4.041742623557135e-01   -6.657652485121802e-01   +5.488720420035690e-01   +3.599533182269506e-02   -8.699992861452017e-01; -2.979923653846658e-01   -5.619796465603493e-01   -4.953813238934855e-01   +2.852977998708238e-01   +6.685085555288377e-01   -2.493143692853087e-01   +9.373412692355781e-02   -3.428303571375772e-01   +1.659549478122168e-01   +6.174899089926869e-01   +2.769326117434573e-01   -8.647674040968137e-01; +6.485704047795011e-01   +2.455042299081304e-01   +1.880570590571602e-01   +8.032947060633013e-01   -5.773540374929552e-01   +2.710774071328347e-01   -1.000000000000000e+00   -4.761010360684636e-01   -7.612193558637428e-01   -1.557261156478900e-02   +3.643994730798517e-01   -2.967457145359447e-01; -1.568439977183890e-01   +6.087302164913356e-01   -7.636222221032647e-02   +7.438383296472713e-01   -7.476544766676454e-01   -1.704010150586713e-01   +3.249693215815478e-01   +2.210150436117014e-01   +1.878142138830478e-02   +2.967920302999714e-01   +3.572018879223529e-01   -2.100527675427553e-01; +2.533211772563226e-02   -8.945435124568967e-01   -2.439120566311524e-01   +1.633846331465185e-01   +6.284086786385230e-01   +4.729555793140075e-01   +1.718074213046591e-01   +2.142418893438323e-01   -2.616327354545541e-01   +8.762417768091675e-01   +8.093420777998767e-01   -7.945771974719673e-01];
L2E_Input1_iAMPA_netcon = [-4.971531140459715e-01   -3.417094463316824e-01   +5.721046319413453e-01   +6.261756807409867e-01   +1.000000000000000e+00   -8.916906635666136e-01   +5.215237444072868e-01   +5.744069035222322e-01];
L2I_Input2_iAMPA_netcon = [+2.669284437830972e-01   -7.691886306810982e-01   +5.440365829902830e-01   -8.188657634211507e-01   -5.434204531572634e-02   +3.602444282526773e-01   -5.013845475350927e-01   +4.989882827314077e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
