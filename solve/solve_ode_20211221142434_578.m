function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.276186881217343e-01   +3.441091525062634e-01   +3.290101764637725e-01   +4.775582981273796e-01   -2.558979075414257e-01   +2.756295725172802e-01   +6.900294236853766e-02   -9.080841543239526e-02   -1.563887489225015e-01   +5.462998769665416e-01   +2.329065873487171e-01   -2.142104793820184e-01   -1.194138452516186e-01   -6.215539013756790e-01   -2.021193036619724e-01   -4.056342645267413e-02; +1.755776856958489e-01   +6.409719579092565e-01   -6.350555820518317e-01   +3.796838229143057e-01   +3.068469149115575e-01   -5.507380381141689e-01   +1.989407573595257e-01   +2.091626441690417e-01   -6.020570840376878e-01   +2.309011444218838e-02   -3.655533787565898e-01   +2.153803273736918e-01   +6.515286234538434e-02   +1.887049643928736e-01   +7.900871520358130e-01   -1.403762911954009e-02; +2.261701268008313e-01   +5.210967781719915e-01   +3.813735131992924e-01   -2.560329248798918e-01   +1.696462668174572e-01   +9.385277561142753e-02   -5.026088270703605e-01   -1.094333181955437e-01   +5.309509135477858e-01   +3.283052441163881e-01   -4.151546238758950e-01   +6.743534950019279e-01   -1.602378246131807e-01   -3.003780434625961e-01   -6.092257750643948e-02   -4.153125648714417e-01; -1.104557575062107e-01   +3.821697795693391e-01   +3.326557353199735e-01   +7.891104854009931e-02   +7.996937088386218e-02   -2.935239888737264e-01   +1.731610484915034e-01   +8.883557276272037e-02   -2.362521718521127e-01   +5.620466423053690e-02   +1.951107346395493e-01   -1.170083317270481e-01   -6.174547970193851e-03   +3.985324667232720e-01   -2.345750932142517e-01   -4.849818308464977e-01; -2.872110413616482e-01   +2.287701176465767e-01   +1.700676334227542e-01   +2.592844773785370e-01   -1.564845656571789e-01   +8.434466942635096e-01   -3.764411431636451e-02   +1.855431548642237e-01   -2.703029789028625e-01   +6.888963997402417e-01   -3.061894981063650e-01   -7.475784457320381e-02   +4.170914329397810e-01   -4.855765550848185e-02   +2.794935942989271e-01   +1.275655227613945e-01; +1.296187912066439e-02   -3.408091767219991e-01   +2.668319487078138e-01   -2.774881338890323e-01   -1.429758687305733e-01   +6.947209372040194e-01   +1.079433894618224e-01   -4.329327112895835e-02   -3.877607383445048e-01   -2.785340116462784e-01   +3.884713397228325e-01   +1.059912423127053e-01   +1.549270884504463e-01   +1.246405842317391e-01   +2.980497720027290e-01   +4.414886454348040e-01; -2.014348493207325e-01   +6.069731931349440e-01   -3.957666916922068e-02   -3.219892596346292e-01   +3.483556870402284e-01   -3.168771968283367e-01   +2.351095169229268e-01   -2.805029450121510e-01   +2.688344290046959e-01   +3.207174547085394e-01   -3.194255738859115e-01   -1.476145710058320e-02   -2.491805871428243e-01   +3.233342103150721e-01   -4.208781199865506e-01   -3.549015034142678e-01; -3.405383928701305e-01   -3.809961481613815e-02   +2.070717020015733e-01   -7.595795000665376e-02   +5.471950371273621e-01   -2.606442820777299e-01   +2.774853131510795e-01   +1.445925697646731e-01   +3.581075075531188e-01   +5.615678502118842e-01   +2.581768596375384e-01   -1.343271158644781e-01   -5.818380831629596e-03   +5.403532278705222e-01   +3.632208124534975e-02   +1.576345408811894e-01; -1.499233278924198e-01   +1.052143988562058e-01   +1.823524989168823e-02   -2.281315997156004e-01   -1.526109691069139e-01   +2.350195682041389e-01   +1.794698122112457e-01   +2.447171170845236e-01   +1.533791940904888e-01   +2.094802935041208e-01   -2.575464099983270e-01   -4.567430640475757e-02   +1.159987771276719e-01   +3.609988974658673e-01   +1.769680684783616e-01   -1.476658927309986e-01; -2.913101293788840e-02   -9.985562276726632e-02   +9.422574288886426e-02   -1.332647528367660e-01   -7.702344300800021e-01   +2.057022487912923e-01   -2.527811826471609e-01   -1.085062588534913e-01   +1.547178875201173e-01   -1.590204718008310e-01   +2.781360104900097e-02   +2.895890146611764e-02   +3.640769235848051e-02   -6.313080378987324e-02   +1.277499244342833e-01   +3.786103089749838e-02; -1.324656138425268e-01   +3.563891732379838e-01   +4.832880861817801e-01   +1.770911477644931e-01   -1.780052928427367e-01   -1.633999809338442e-01   +2.359284649232295e-02   -4.313449263031384e-01   +1.746413497946103e-01   +2.821929255450590e-01   +3.855406828194651e-01   -8.256885839232346e-02   +1.239912015308318e-01   +5.399009506745598e-01   -1.514732525742978e-01   -4.736162314594595e-01; +2.396891966895734e-01   -6.329169372694394e-01   +4.253904077158474e-01   +1.946609060631731e-01   +8.010067418610543e-01   -2.651859038154163e-01   -3.569523941155077e-01   -1.147774018676672e-01   +1.762188957452934e-01   -1.430768336132951e-01   +2.415883584253094e-01   +2.552962332937294e-01   +1.642583059015452e-01   -3.200626468949584e-01   -1.814001228706169e-01   -1.476931676832442e-01; +2.804164927628017e-01   +6.991604057870126e-01   +5.624185544035223e-02   -2.252595375802706e-01   -1.753430728879221e-01   -6.203163027715305e-01   -2.313745138671805e-01   +5.188672191310826e-01   +3.306184927881546e-01   -5.188631028101930e-01   -7.660876175199158e-03   -1.382651823029463e-01   -1.906333886241288e-01   -4.506170366811289e-01   -2.273941426188341e-01   +5.864249853822285e-01; +2.649848325612459e-01   +6.808992785630767e-02   +1.248673380324234e-01   +1.191594375297998e-01   -2.343703960865577e-01   -4.602784303616028e-02   -1.553377182611824e-01   +4.285006631199366e-01   -6.591284070880625e-01   -2.536393522633675e-01   +5.618609749798796e-02   -1.612113405356047e-01   -2.237523067388816e-01   +3.252150738034493e-02   +6.075087999521961e-01   -2.165011672758905e-01; +2.915039435025706e-02   -2.213713682040065e-01   +3.009419793921351e-01   +2.568152139537246e-01   +2.628268676753087e-01   +6.751952203004329e-02   +5.677706951290107e-01   -1.028976863137943e-01   +4.362698276344219e-01   +2.220355053048780e-02   -2.641274251780085e-01   +4.194676168254948e-01   -4.301063427595392e-02   -5.712822817984340e-02   -4.196820671208317e-01   +3.982091094912222e-01; +8.881131568929734e-02   -3.862330527892793e-01   +1.827434545497227e-02   -3.768642320640361e-01   +8.473268670880285e-02   -1.511821316034480e-01   -3.363175405517749e-01   +2.600806726155674e-01   +7.500792894809500e-03   -4.631778050065090e-01   -1.276620446114668e-01   -2.845573799588422e-02   +4.497949017930800e-02   -3.421556621661126e-01   +3.221823999373771e-01   +1.349483480932697e-01];
L1E_L1I_iGABA_netcon = [-1.205533287313243e-02   +3.444504300262841e-02   -5.773040019002980e-01   -5.859573387301411e-01   -4.688333438442472e-02   -6.857330275483642e-01   +7.727159952336786e-02   -4.853935090683163e-02   +6.096131138805062e-01   +1.504336910568252e-01   -3.618649727258177e-01   -2.542950556085880e-01   +5.554691680230065e-01   -1.545172534924639e-01   -2.615888989261140e-01   -3.686960165918474e-01; +1.847557741942398e-01   -4.054309872052807e-02   +3.151236953387955e-01   +5.212251143258863e-01   -8.927951724773678e-02   -2.525809979201373e-01   -7.686137755822109e-03   +4.776436670757092e-01   +2.688076721707777e-01   +3.865602464513359e-01   -9.249406229992409e-02   +2.022739014601911e-01   +6.633344301965746e-01   -1.514926809687471e-01   +5.891696153336927e-01   -2.337518190415575e-01; +9.199899053630954e-02   -3.644859543639334e-01   -1.001352269800081e-01   -2.656177546466940e-01   +3.716472461083492e-02   +1.440487169596874e-01   +1.805741967234737e-01   -4.918500837268090e-01   +4.525857697271228e-01   +5.158828006687925e-02   +3.015847454614292e-01   +2.715385006749896e-01   +5.987941803769656e-01   +3.107278869602201e-01   -3.525422637981520e-01   +7.020607214261213e-01; -4.522940444615405e-01   -5.666814099267473e-01   +4.754074948974762e-01   +2.730576903818973e-01   -1.785387448870885e-01   -5.650958501805711e-02   -4.799431643765888e-03   -1.170338646445159e-01   -7.878500542355614e-02   +5.747925214009959e-01   -5.343471242283842e-01   +1.332344879116241e-01   +2.547568029338995e-01   +1.705153302914761e-01   -8.354605159873289e-02   +5.127112602606509e-02; -7.977814645104517e-02   +5.540487550357504e-02   +2.150952981878462e-01   +2.527825624352564e-01   +4.080337072023122e-01   +3.575767045297124e-01   -5.401430300124033e-01   +1.888667696897788e-01   +1.743781180439038e-01   -3.016507822641362e-01   -2.666958508835305e-01   +4.551429448781685e-01   -5.160420722443543e-01   +6.137194780930953e-02   +3.985986744600521e-01   -3.333903852106524e-02; -3.511233799487308e-01   -1.771402117471411e-01   -2.053219424802883e-01   +1.144945514278213e-01   -5.523934513677287e-02   +7.215755191673540e-01   -3.416526511745567e-01   +4.243048527479447e-02   +2.441843690644612e-01   +6.868814089889088e-01   -2.883238268359752e-01   +4.582742846991812e-01   +5.486824137519115e-01   +4.561765207671233e-01   -5.662788669778203e-02   -3.751861950902020e-01; -4.088402240037513e-01   +1.644289909778915e-01   -2.577000031574682e-01   -4.658526081749005e-02   -9.135826785307381e-02   -6.025775603719573e-01   -8.255497069866236e-02   -7.093355264797886e-02   -1.670462304407178e-01   -2.792112313705322e-01   +4.796141975634575e-01   -4.869533922522890e-01   +3.934791522361060e-01   -5.682506868473309e-01   +1.228831049599523e-01   +2.207855766995756e-01; +5.653807677754900e-01   +2.131065506709797e-01   +3.450180494243892e-01   +2.551487838471102e-01   -3.953417840215575e-01   -2.030249614023491e-01   +9.821685210778322e-04   -7.077029131747015e-02   +3.109905045439041e-01   -4.564686493916258e-01   -4.869840858083017e-01   -5.689759323782535e-02   +2.885438030810468e-01   +3.637264780452541e-01   +4.402292910449138e-01   -3.872912793908590e-01; +3.346913937467209e-01   +1.829427828782221e-02   -8.268596613273769e-01   -1.643210968983765e-01   +1.874287076272351e-01   -1.518492805918355e-01   -6.074625663575761e-01   -1.226039816872140e-01   +7.003144021762133e-01   +6.892313106857660e-02   +5.264647971843897e-01   -6.360751699663476e-01   +5.799441732487941e-01   +1.413545468712481e-01   -2.550434377811873e-01   -2.124299816343204e-01; -4.129834380973357e-01   +1.301657378191004e-03   -4.952480319095452e-01   +9.275536038947463e-02   +3.824380258761796e-01   -3.011678565556191e-02   +4.025347849649191e-01   +4.738888872258718e-01   -1.719578346622536e-03   +2.949065629828838e-01   +1.499788141804881e-01   -1.174916754669210e-01   -4.644129158337160e-01   -3.315917356260540e-01   -1.389166307010901e-01   -4.071896558251990e-01; -4.544534923772995e-01   -3.053614377251165e-01   +4.188123856737176e-03   +7.032498823472365e-01   -2.544040403085389e-01   +9.509116674573151e-02   +1.375366021022170e-01   +2.363343068437661e-01   -4.252495037916578e-01   +1.616568584376418e-01   -3.128775200425858e-01   -5.765632833388187e-01   +1.295585850571514e-01   +2.549106476940703e-01   -1.305742373036892e-02   -1.898088193005225e-02; -1.656571755942648e-01   -1.597565508301310e-01   +1.111281071910512e-02   -2.666635639015594e-01   -1.021486267282149e-01   +7.167976810721513e-02   -1.199812227111355e-01   -2.086288289209270e-01   -1.242452349419314e-01   +6.621359576616868e-01   +1.514741382583469e-01   -3.157790165208132e-01   +1.655420949736904e-01   +6.544628597093045e-01   -5.013864646632108e-01   -3.777924983701239e-01; -6.103859602143547e-02   +2.586581400311481e-01   -1.133542253949582e-01   +6.586757898551260e-01   +6.198266482690037e-02   +3.009037537141750e-03   -2.095350797503083e-01   -2.205306944143902e-01   -3.491221791846712e-01   -5.786121502934654e-01   -7.290131696638685e-02   -3.528374153639179e-02   +1.855554530436986e-01   -3.272517085710129e-01   -8.376608574118091e-03   -3.801025561141344e-02; -4.568144541091995e-01   +5.205215596499875e-01   +7.144749070202416e-02   +4.164628449911693e-01   -6.225423543612517e-01   -2.806203796576418e-01   +4.479863587638123e-01   -2.072420222284966e-01   -8.961386982507832e-02   -2.924110496649990e-01   +5.479971906204670e-01   +4.305729104123492e-01   -9.038120668525342e-02   +1.628823354872631e-01   -4.980985259087367e-01   -3.631206478153851e-01; +3.486635709160012e-02   -1.232247997641778e-02   +7.449193785652696e-01   +1.405707404971115e-01   +1.467632784519883e-01   -6.698467226807679e-02   -4.032485625391501e-01   -7.420305564284143e-01   +3.951756528825165e-01   -7.316378561276149e-03   +1.854260443956783e-01   -6.449121774392510e-01   -2.347483295874332e-01   +2.960925475578947e-01   +2.843864412464929e-01   +3.553178911595846e-01; +9.311359168020174e-02   -1.020744663229007e-01   -1.692412946258735e-01   -4.594057266684441e-01   -3.866249672310815e-01   +4.938329768661431e-01   +1.734763704405030e-01   +5.370067503941613e-02   -8.686459969490830e-02   -2.746266639051527e-01   -2.598989456683328e-01   -1.758488641151351e-01   -3.164510373180828e-01   +3.800107714757525e-01   +3.636736465949425e-01   +1.231326953513332e-01];
L2I_L1I_iGABA_netcon = [+7.335249903244423e-02   -1.432591259627713e-01   -1.088353650049566e-01   +4.072086349035683e-01   -3.083345121408427e-01   -2.465983342326576e-01   +1.588614379205845e-01   -4.693773072067155e-01; -7.832391954124260e-02   +3.518705258841522e-01   -5.502910838196180e-01   -4.189214944235115e-01   -6.314835566866910e-02   +8.614070431074153e-02   -5.802371486115904e-02   +2.897175277240739e-01; -8.282665474037652e-02   +6.580217208691046e-02   -4.313516568399441e-01   -6.496777211232314e-02   -3.219621618309262e-01   +1.789231366285430e-01   -1.227473090659523e-01   +3.321549508551855e-01; +6.018706673465596e-01   +5.556797324588446e-01   +3.932822854057141e-01   -1.893992942683496e-01   -5.640632306796488e-02   -4.173025459014933e-01   -3.371398205134296e-01   -4.030222761976973e-01; -1.635255801069614e-01   +5.038770069398186e-01   +4.617770536768102e-01   +2.194016016993475e-01   -5.466791424320853e-01   +4.400878635626666e-01   +7.000217533433276e-01   -2.350133058835846e-01; +4.191677841100272e-02   +1.197729859535513e-01   +5.321435814118937e-01   +3.104305452439564e-01   +8.641918943710747e-02   -7.488394396061050e-02   +3.152879871709795e-01   +2.027790832044038e-01; +5.650918300308116e-02   +4.187307342629220e-01   +9.583527670688499e-02   -5.174956923445542e-01   -1.675601196237410e-01   +2.122914157752974e-01   +3.816000021790105e-01   -2.516692491610179e-01; +3.052741706654385e-01   -3.739164955604893e-01   -2.264670256205340e-01   -4.252535247513373e-02   +1.378829029978731e-01   +2.187283098508468e-02   +2.129186209848842e-01   +7.928730940585973e-02; +1.324705275815196e-01   +3.001200499231982e-01   +2.387126678106131e-01   +6.569136431645602e-01   +4.665706395685822e-01   -3.351730815000770e-01   +8.998547829536231e-02   +3.345273026255647e-02; +2.996274349452568e-01   +1.917150087825767e-01   -1.355030595415509e-02   -2.341328792573371e-01   +3.394957195255326e-01   +2.284267802831331e-01   +3.783693969183541e-01   -3.039722444890786e-01; +1.305608076845026e-01   +1.601872185824002e-01   +3.411145499297550e-01   +3.819097877134777e-01   -2.756234466174678e-01   -4.796538030126668e-01   +6.174742096497731e-01   +3.073292999312076e-01; -2.442752044850091e-01   +4.734721577513820e-01   +1.393285970612162e-01   -1.250828175104586e-02   -4.029677770807445e-01   -4.644840321831676e-01   -3.370226936103857e-01   +1.640513382423001e-01; -2.499965854400964e-01   +2.705902901793050e-01   -3.760377118833704e-01   +1.363829721657221e-01   -4.714924938569224e-01   -3.278482638628052e-01   +9.166765394606841e-03   -3.060532102075891e-01; +1.479659275506211e-01   +3.872200134836233e-01   -5.664257380974592e-02   +6.961201602737372e-01   +1.394565112357371e-01   +2.439288703803341e-01   -7.897155809222198e-01   +6.187287694958504e-01; -7.723545626359504e-02   -6.800798784236803e-02   +4.809859718395905e-02   -1.017201417976973e-01   +6.473804538478511e-01   +2.463790150612363e-01   -1.331636375469404e-01   -2.704874390957758e-01; +7.265385907098032e-01   -7.937280152771383e-01   +1.258146225366254e-01   -3.864754337853345e-02   +8.135444089783957e-02   +2.995537308102973e-01   +6.880287265810636e-02   +4.371079759856200e-01];
L1I_L2I_iGABA_netcon = [+3.155277526500126e-01   -5.541951327158812e-02   -2.750179468362791e-01   +1.763761823102729e-01   -5.602252936608945e-01   -4.887029280531685e-01   -5.587848389657507e-03   -9.256475197657985e-02   +2.357622907395492e-01   +3.489569132810919e-01   +4.523566771812705e-01   +2.787058748026272e-02   +2.068028265578698e-01   +2.395721503339611e-01   +2.843576962315105e-01   +1.188712083068804e-01; +4.805313563768347e-01   -3.439430024132058e-01   +4.082546226838338e-01   -5.472806620761564e-01   +1.671423616507348e-01   -1.508270826308145e-01   +2.151221225140928e-01   +1.105075548876550e-01   -1.499161501632444e-01   +2.049402635540662e-01   +1.523385510517269e-03   -3.153422607991452e-01   -1.162131725075410e-01   -2.177825958690059e-01   +3.579163672194086e-01   -4.872111966873908e-01; -4.894954412404049e-01   +3.165554849499634e-01   +7.713234498787168e-02   -2.295530831538985e-01   -2.471692246424623e-02   -4.542318213410627e-01   +3.383015536671856e-01   -6.562351281510180e-02   -2.661286211647708e-01   -8.057547635927617e-02   -3.094901317491970e-02   +4.760133206132151e-01   +8.396178671902743e-02   +2.749583450723390e-02   +7.420332985440418e-01   +3.902695045210264e-02; +3.740794697139403e-01   +1.518281404524695e-03   -7.550182772931856e-02   -1.628592165099686e-01   -3.906020738333019e-01   -9.104997029181357e-02   -3.176415499845120e-01   -1.420195658054730e-01   +1.783695142615232e-01   -1.855079824324507e-01   +5.935241989079860e-01   +4.430758166796740e-02   +2.549109170896114e-01   +7.931050303185381e-01   -1.604030597067760e-01   +6.492815772177517e-02; +1.592658628980823e-01   -5.148366706066693e-03   +5.247697740038030e-01   +1.627525504381752e-01   -1.605299320359324e-01   -2.141015371392941e-01   -3.135821246413795e-01   -1.658033518854554e-01   +1.060853486560635e-02   +1.419722105680162e-01   +3.318725422148265e-02   -5.704950309157208e-01   -1.048747187967869e-01   -2.672741907246811e-01   -1.158149434428628e-01   +4.683716206588247e-01; +6.532200190853638e-01   +3.983395907430834e-01   -3.221626439740704e-01   -8.172736629354582e-03   +1.324386570214362e-01   -3.677937051519617e-01   +3.326073315483722e-01   +1.913897584086001e-01   -1.035917700342867e-01   -2.849757309375493e-02   +3.731810186017555e-01   +3.078447452008627e-01   -6.157383669812478e-02   +1.373038171692663e-01   +1.987657611211173e-01   +9.199577612706338e-02; +2.311698437471144e-01   +1.533110077610519e-01   +5.723780782827833e-01   +1.295595104578017e-01   -5.875135698361164e-03   +1.596688554133563e-01   -2.629885615258774e-01   -5.529947017440154e-01   +2.678559825940946e-02   +1.993192003313888e-01   +5.540298250714363e-01   -3.146100476086041e-01   -1.956465851511406e-01   -2.537906080398032e-01   +2.274644330030622e-01   -3.097767223885289e-01; -1.083387156525416e-01   -5.417858757550192e-02   +6.875267311704773e-02   +3.108479992169715e-01   -1.944521268850259e-01   -2.122017403246756e-01   -1.379174236575031e-01   +2.539113169318793e-01   -3.438055263538233e-02   +1.050144078109553e-02   -4.109972499287822e-01   +1.829781884272514e-01   +2.404775993867159e-01   -2.571291549129152e-02   -1.500730717206731e-01   +2.284429123191257e-01];
L2E_L1E_iAMPA_netcon = [-9.570272243198459e-02   +3.277012363250277e-01   -3.457087355553433e-01   -3.147638082688349e-01   -6.485995938486377e-02   +6.007188733652719e-02   +1.101760909683344e-01   +1.870408091419348e-01; +2.284313663538480e-01   +8.209454892834752e-01   +2.187536803031904e-01   +4.280179039280368e-01   -1.251617824692507e-01   -5.699675748025848e-01   +1.651121320988021e-01   -2.257998772034522e-01; +3.361100666107990e-01   -4.210086064462075e-01   +1.169635211013596e-01   +2.393983235227923e-01   -5.405001285589366e-01   +4.244937922009863e-01   +3.384235193096166e-01   +4.949339333207217e-01; +4.836229134458265e-01   +3.750608970556954e-01   +6.962244134103740e-01   -1.851027678531316e-01   -5.803736820644005e-01   +3.063364910696977e-01   -1.913112242902696e-01   +2.048099843687359e-01; -1.521935753738397e-01   +6.392431685001283e-01   +1.219668071851352e-01   +1.514154793364843e-01   +6.673493646615113e-01   +3.822040846525460e-01   -8.129139140748166e-02   -1.372812292834925e-01; +2.909141332697096e-01   +3.407043342945305e-01   -5.233020445537299e-01   -1.847108619100158e-01   +1.318538866419585e-01   +8.665464685255686e-01   -2.056072493345366e-01   -2.502072059261948e-01; -1.265231763474365e-01   +2.287298211102934e-01   +1.141580605030547e-01   +1.714436186426344e-01   +1.444685100450722e-01   -7.099843678025656e-01   +9.469217716524014e-02   +5.576244682469880e-01; -3.152240395327852e-01   -5.556280633816555e-02   -7.993426883253707e-01   +4.231624823794743e-02   -5.249693078097249e-01   -8.956877124964556e-02   -3.690512478820082e-02   -7.823136246059422e-01; -3.449876285473725e-01   -3.414191616439545e-01   -3.160919410003596e-01   -1.119452456047137e-01   +2.116897899406731e-01   +5.645125601799059e-02   -2.005168553622081e-01   +4.485969128078408e-01; +2.422559490716504e-02   -1.911576305962922e-01   +3.060602987123890e-02   +2.701837209991436e-01   -1.652629824814571e-01   +1.159937264093048e-01   -1.829508874838235e-01   -8.927015059910046e-02; +2.544240978113311e-01   +2.060246641254044e-01   +1.423380893456018e-01   +2.567762396698522e-01   -6.936888987093170e-01   +3.956147605380526e-01   +2.355027468158084e-01   +2.693385140235134e-01; -1.568458977679524e-01   -7.514951136807069e-02   +8.003478945188469e-02   +1.807016409671712e-01   +3.974686263914425e-02   -1.906626713796377e-01   -3.007705822378359e-03   +3.498150967040602e-01; -5.259407161279842e-01   -1.423950114349402e-01   +1.540932436449025e-01   -5.203368598681670e-01   +4.554727523507990e-01   +1.488443413698869e-01   +5.009105583071507e-02   -4.084595383902977e-01; -2.203112808393495e-01   -7.756334916934254e-03   +8.943917134553872e-02   +1.434477033977519e-01   +2.228931931030756e-01   +1.190903334611804e-01   -8.633401775402626e-01   +5.657846220602843e-01; +2.403814458703889e-01   +3.281715286683198e-02   -4.216392839874712e-01   +7.186632641187844e-02   +5.610501440991100e-01   -2.263506724628604e-01   +3.045069889180957e-01   -3.808257706471889e-01; +3.037591930411168e-01   -3.538683035149467e-02   -5.277719917440044e-02   +1.258600797521492e-01   -1.293853328001555e-02   +9.088663666483654e-02   -1.394185846202976e-01   -3.166129182210796e-01];
L1E_L2E_iAMPA_netcon = [-3.001882872677266e-01   -5.466742194452496e-02   +1.852635290163573e-01   +1.683338000086730e-01   +6.271288935267405e-01   +3.732201937095218e-01   +1.693021049592732e-01   -4.129606244796857e-01   -9.432650975105439e-02   -7.813834895001459e-02   -1.275577964738118e-01   +7.169334915278651e-02   +1.292481314561682e-01   -4.074194347649683e-01   -4.871272488714491e-02   -5.596722102536957e-01; +3.664712208055912e-02   -1.021278407802775e-01   -1.937561159497763e-01   +2.356636559291411e-01   -2.531338106880858e-02   -2.514601084930635e-01   -4.198369336556722e-01   -2.515798372967171e-02   +5.485595199678928e-02   +2.423265048049849e-01   +2.334579779672535e-01   -2.501276486584206e-01   -6.616463137223830e-01   +6.670006448429490e-02   +6.069849930069895e-01   -7.737752532199452e-01; -2.130355519223799e-01   +3.686672293912462e-01   +1.117650333331083e-01   -5.118630185616145e-01   -3.681068669861553e-01   -8.014137978795631e-02   -2.489827221597657e-01   +1.478551325392628e-01   -3.825258949911087e-01   -4.484384955529239e-02   -2.696757473021977e-01   -7.659310091878326e-02   +2.566618138465036e-01   -5.248846627358414e-01   -1.953168146191623e-01   +3.560383163804407e-01; +8.857490125834833e-02   -3.290517388850134e-01   -4.757244463497752e-02   -1.584167608428774e-01   -1.668985811171404e-01   +1.361256217277385e-01   +2.606421995026057e-01   -1.774341532754841e-01   -2.246779053112151e-01   -2.162447214443497e-01   +1.555042818037120e-01   -3.167694242228993e-01   +3.688350279575710e-02   +9.174475616713376e-02   -3.589245833791144e-01   +4.529617154883026e-01; -5.705465315327329e-01   +2.155543078060021e-01   +8.211941742758586e-01   +4.466825051621718e-01   -3.919837164591153e-01   -4.573353201817127e-01   +5.247696319457696e-01   +2.774720188489722e-01   -4.628334933604180e-01   +1.429091371420765e-01   -2.458573508795374e-01   +4.011180997587447e-01   -3.204361266338711e-01   +1.771989013973312e-01   +8.058332102178754e-02   +2.792752709083703e-01; +2.545187118477947e-01   +2.546306956585818e-01   +1.805475373640484e-01   +9.061861149056910e-03   +7.171312015591602e-02   +5.881590168341541e-03   +5.523262098732976e-02   -2.455388295148589e-02   +3.784454247228502e-01   -2.506404778995944e-01   -5.386918083794773e-02   -1.611983500639204e-01   +1.928716360437935e-01   +6.037591032914549e-01   -4.740433886744348e-01   +3.297986276577791e-03; -2.884805387004518e-01   +1.059714233396257e-01   -7.081210253363310e-02   +5.636286334685718e-01   -4.430845549126876e-01   +5.364042931718012e-01   -2.125817773111477e-01   +9.778469301537494e-02   +2.161907318460677e-01   -2.244350435585830e-01   +4.385709481205894e-01   -3.364600774015191e-01   +3.844415029575453e-01   +3.531405549061442e-01   -1.717380418420176e-01   +4.101808071825901e-01; +5.795135411734886e-01   -7.621956025444360e-02   -2.158280481615512e-01   +7.757424129467780e-02   -1.163713572307047e-02   +6.762335057568925e-02   +3.078946279902631e-02   -1.047209345809212e-01   -5.127172932592353e-01   -1.541846138151308e-01   +7.562619078861240e-01   -1.919074952287657e-01   +2.259942965021384e-01   -1.068199101091635e-01   -3.031740909965239e-01   -2.178017449705670e-01];
L2I_L2E_iAMPA_netcon = [-1.551982914794783e-01   +5.981565288044055e-02   +4.163843392001608e-01   +2.836204428255736e-01   -3.790389720706513e-04   +2.093954399364728e-01   +9.632451985293998e-02   -5.204686319042434e-01; -5.086719329705360e-02   -1.719970287455615e-01   -6.577629552389437e-01   -2.325287881693644e-01   +1.177175964887342e-01   -1.829786135868136e-01   -4.939079249764913e-01   +7.734677999673625e-02; +3.766020880591434e-01   -2.182084367464441e-01   +5.973530881326621e-02   -1.212160576935472e-01   -2.589386736300291e-01   +4.974308043076813e-01   -3.064561662423720e-01   -4.459326335761163e-01; -6.624881119844596e-02   -7.315043989877653e-01   -9.672527390088194e-02   -3.920532550478741e-01   -5.562828380094219e-02   -5.794288904354572e-02   -1.138036262423751e-01   -4.140923078937786e-02; -5.244817368966062e-01   +3.110549219699884e-01   +3.097286727205778e-01   +1.494885404364352e-02   -4.408440788436893e-01   -6.574940230335391e-02   -5.864364707979067e-01   +6.225044318706099e-01; -2.227157040503608e-01   -4.909600626357796e-01   +1.475266389634060e-01   -2.193594837315766e-01   -4.119093716679317e-01   -5.431775621416846e-02   +2.677455793683640e-02   -6.400841097733123e-01; +1.862615178635024e-01   -8.671285273204021e-01   +3.755558873864436e-01   -4.536623294274954e-01   -1.154753907718719e-01   +2.520969085547410e-01   -6.066284346134447e-01   -6.788437361838305e-01; +4.759131613496728e-01   -3.210886531249502e-01   -4.832905052465649e-01   +1.667712448525710e-01   +5.117776022280238e-02   -4.853524287101874e-01   +5.541419363451875e-01   -4.006786051575323e-01];
L2E_L2I_iGABA_netcon = [-3.251104194529041e-01   +4.917025830595005e-01   -3.629410602621430e-01   +3.777553636403769e-02   +2.168927487538289e-01   +3.480016906484341e-01   +1.446451093450550e-01   -5.351933381080601e-01; +5.215951916678396e-02   +1.036980641073184e-01   -9.190882148025892e-02   +4.333991079647770e-01   -4.579915774066531e-01   +5.101404189526730e-01   +4.490179207070668e-01   -1.574543810951443e-01; +1.808420789515461e-01   -2.323067519429069e-01   +2.030120313743138e-01   +2.126040685339390e-01   +4.631351673576454e-01   -5.728872776922295e-03   -2.521075308641074e-01   +9.263711009462264e-02; +8.958255893936125e-01   -6.088621292189478e-02   +2.194560007716403e-01   +5.023189298996742e-02   -1.547807694678544e-01   -2.234139770913024e-01   -2.609479150765633e-01   +1.526332629344495e-01; +7.328766964457946e-01   +1.031642153492029e-01   +2.530729389270530e-01   +2.325680831359107e-01   +2.425658875749767e-01   -4.526869413160076e-02   -5.121302328680810e-01   -8.272089939100742e-02; +1.087682296901774e-01   -1.963421091585134e-01   -1.130301673396121e-01   -4.304878825100142e-01   -6.470539001112442e-01   -4.939618476243841e-01   +1.969946979575534e-01   +1.862926771928784e-01; -6.987142369700812e-02   +4.241821384683429e-02   +1.721487343603291e-01   -2.160197904008127e-01   -3.465662263507797e-01   +2.781507740825079e-01   +5.204644622837619e-02   -2.677836474911995e-01; -1.633218421211499e-01   -7.823037331631816e-02   +5.464566483243166e-01   -3.083009913950810e-01   +1.994372167957346e-01   -2.301755689359234e-01   -1.643906183616517e-01   +7.419705899023580e-01];
L3E_L2E_iAMPA_netcon = [-3.103187218057757e-01   +7.213200217554377e-02   +1.642511719846176e-02   -3.313460934568535e-01   -2.059559647694466e-02   +5.216722976333167e-01   +3.732861009614850e-01   -4.355185549336434e-01   +1.079019885389413e-01   +1.282201617889956e-01   +1.289500452921284e-01   +2.377069470730544e-01; -2.593494415316353e-01   +4.892356249430415e-01   +5.001657084281966e-02   -9.369098727815194e-02   +3.210249150328205e-01   -7.284635182909937e-01   -1.284393772318773e-02   +2.457063947264513e-01   +2.058000897283913e-01   +2.151257517919015e-02   -3.391635009466591e-02   +1.623001126446582e-01; -4.193585424503621e-01   -1.076973768231183e-01   +5.535766527415616e-01   -4.527970354231899e-01   +5.103694761142512e-02   +3.675788321143733e-01   -3.910546947478185e-01   -2.632970971999938e-01   +6.065749340445900e-01   +2.917819735663628e-01   -8.831335578603991e-02   -2.151500580774265e-01; +6.132644829824171e-01   -4.063759501410706e-01   -4.840104507329828e-01   +2.391353975156121e-02   +7.531599973231204e-01   -1.702686351372377e-01   -5.802757325716533e-01   +2.058849182402352e-01   +2.548964528466912e-01   +3.239250416834726e-01   -7.339481105903222e-01   +3.905479961068857e-02; -4.984248328751497e-01   +2.466522747578499e-01   -1.227239018409444e-01   -1.386897363883668e-01   +3.243185120934390e-01   +4.203197523025552e-01   -6.440421631208366e-01   -1.499927051451575e-01   -1.542846416343335e-02   +5.466999651062712e-01   -1.966243057158213e-01   -2.652262219601709e-02; +7.428061380134384e-01   -1.400259620499633e-01   -4.743699609226305e-01   -9.054581159141646e-01   +4.126192934804886e-01   +5.988703117160862e-01   +1.487425841041579e-01   +8.503655109679158e-01   -7.728333060531942e-02   -5.118542388656894e-02   +4.412551900996745e-01   +1.855740799647431e-01; +1.552736413044013e-02   +1.349857655629296e-01   +5.535414618775879e-01   -5.674029080162968e-02   -2.118361448529515e-01   -4.197467274762973e-02   -9.606436472701607e-02   -5.019001127130194e-01   -1.719558726811974e-02   -4.287310012739567e-01   -4.175391865427643e-01   +1.668055103252099e-02; +5.492869528497457e-02   -8.789148458824739e-02   +2.733269223752691e-01   -1.960518723635162e-01   +2.039268613242956e-01   +1.085440021982395e-01   -2.058016192189136e-01   +5.033015660221601e-02   -7.680116444625885e-01   -2.290058262589419e-01   +1.638922953633972e-01   -4.826401304852260e-01];
L3I_L2I_iGABA_netcon = [+2.883606841310285e-01   +6.904310517318751e-02   +5.662269271918087e-01   -6.266918247920472e-02   +7.558970216038642e-01   +8.890798342531447e-02   +3.638734873211460e-01   -4.541918876813083e-01   -9.235843969212232e-04   +5.395949787810551e-01   -2.231712391827625e-01   +8.739473062805242e-02; -2.044899184636791e-01   +3.550603669698911e-01   -2.865518130181187e-01   +2.677805282596302e-01   -1.286573933628413e-01   -1.274255937383509e-01   -9.277840732329665e-03   +5.004340430479407e-01   +6.387358073917692e-01   -6.084629372431551e-01   +2.217228787635322e-01   +5.506731744329006e-01; +4.939945670207918e-03   -2.734806306090601e-01   +5.025365195514300e-01   +2.594983346083491e-01   -1.127616283336379e-02   +4.801285389774105e-01   -5.240692150465035e-01   -8.206036907616171e-02   -1.801953918996408e-01   +7.871136559409482e-01   +1.777229031312554e-01   +4.938104277063934e-01; -1.581221613197640e-01   -1.192480434829146e-01   -2.153808947166856e-01   -2.719312712178873e-01   +1.212347072116907e-02   -1.579960912563396e-01   +1.489182083630563e-01   +3.483336659058468e-01   +1.676555942172271e-01   +1.427627282645374e-01   +3.171979009178932e-01   +2.613704340810405e-02; -4.703666569438542e-02   +1.220322275145889e-01   -4.320460147838733e-01   +4.075790889759821e-01   +1.410365063746173e-02   -1.917587464676912e-01   +1.154190357733869e-01   -3.423492640615676e-01   +1.702883909834232e-01   -5.964606885122551e-01   +1.846377724363313e-01   -1.329636604382682e-01; -2.757413441805142e-01   +9.215059358794550e-02   +5.422456765863963e-01   -9.848280704108699e-02   -2.676247550828911e-01   -5.528148636861810e-01   -2.878391703207006e-01   -1.153340327177801e-01   -9.055425059141899e-01   +6.045690332147149e-01   +1.082739033991107e-01   -2.207873777595960e-01; -1.639123793185094e-01   -6.233915514720240e-01   -4.722049138361213e-01   +4.470639005948831e-01   -1.858492062981161e-01   +4.295206940096813e-02   +3.602543129031326e-01   +3.568033244505984e-01   +3.810011309331661e-01   -1.551947014341466e-01   -1.747178112251044e-01   +1.465140330163111e-01; -4.199630999279323e-02   -5.556840007392047e-01   +2.459255117632642e-01   +1.665256106554202e-01   -4.512024304448553e-01   +2.453484594806562e-01   -1.378020590957367e-01   +1.259718506012614e-03   +1.459802690514092e-01   +6.712525170562891e-02   -2.341972781790800e-01   -3.518645866793577e-01];
L2E_L3E_iAMPA_netcon = [+2.977424528875505e-01   +1.075539592910637e-01   +3.895456225849915e-01   -2.753384082657198e-01   -6.938154465828347e-01   +8.276575343665303e-01   +3.161335767454091e-02   +9.173070355856157e-02; -2.043606067840877e-01   +3.284686055338011e-01   +2.619178090459204e-01   -1.124489095872874e-01   +1.993777132469250e-01   -4.145953313648378e-01   +7.180452788738660e-02   -2.700459320225331e-02; -6.584981754772119e-02   -3.297181779347911e-01   -3.499662985053613e-02   -7.100237056997007e-01   +4.503136747211736e-01   -3.151887084897676e-01   +2.108060338471093e-03   +4.236971587414072e-01; -2.530954932541836e-01   +2.717889658644665e-01   +1.977257006399912e-01   -3.120448175379915e-01   -2.807328282181246e-01   -4.465294808488633e-01   +1.809046031570174e-01   +2.084842018829029e-01; -2.068523772987644e-01   -4.496372504011287e-02   -4.241711333206328e-01   -2.120558277107942e-03   +2.447956207659502e-01   -2.927315567574608e-01   +2.666847006877301e-01   -3.668418731036771e-01; +5.412202032339705e-01   +5.225657644248607e-01   +5.002469295155629e-01   -1.889672474464952e-01   +1.748508946806574e-01   -2.147691553064452e-01   -1.290535807044215e-01   -4.041967167464323e-02; -2.980067584693291e-01   -6.734332114518014e-02   -3.661382400302711e-01   +7.033084976997419e-01   +5.683265149991545e-02   -5.375093446633658e-01   -2.621664322822957e-01   +2.115696338620610e-01; -2.117193162402225e-01   +2.436445050033494e-01   +5.569659967506595e-01   -6.417338204068535e-02   -1.257363534630228e-02   -8.577593931008827e-02   -6.441633391278435e-01   +2.154874028107336e-01; +1.072077699707929e-01   +6.738551301207095e-01   +3.610656328795088e-01   -2.599732628587662e-01   +2.404480670008188e-01   -4.162209480448223e-01   -2.886464630957775e-02   +1.500174492777381e-01; -5.050721451286643e-01   -1.883869709181953e-01   +5.001920355381867e-02   +1.813228596275309e-01   -5.630452119794713e-01   +1.784764750946425e-01   -1.213508039608032e-01   +2.229178850767304e-01; -1.938444046059122e-01   +1.207883751550160e-01   -5.261276781011595e-02   -3.057065055813734e-01   +5.746240867375820e-02   +1.463822968318459e-01   +1.721872020228106e-01   -1.653207338467708e-01; -1.805926239374672e-01   -4.113826049326288e-01   -3.250956092683952e-01   -1.735944383772595e-01   -1.499859862035779e-01   -6.759253394116513e-02   -3.457413191688738e-01   +3.577131887934576e-01];
L2I_L3I_iGABA_netcon = [+3.670976633472627e-01   +3.421351216372348e-01   +2.647629523178557e-01   +3.621598762670468e-01   +5.118955243537937e-02   +6.148789636409036e-02   +1.527165968404542e-01   +7.166957972693239e-01; +8.809998319448206e-02   +2.605551994659900e-01   -6.914738358845658e-01   -2.937402965532169e-01   -3.184328303963376e-01   +4.023224630100695e-01   +6.978669136777891e-01   +6.481046328846056e-02; +2.201073229368860e-01   +3.386589373045219e-01   -8.300178743378468e-03   +3.559834366233921e-01   -3.229462514339370e-01   -2.864745267618649e-01   -5.019889643002012e-02   +5.003359230742920e-02; +1.072005333319523e-01   +8.164319717700495e-02   +4.127343146081544e-01   -3.193247631805616e-01   +1.822450231200974e-01   -3.286543383017964e-01   -5.692803887681775e-01   +1.068436024719227e-01; -2.189076668943996e-03   +3.876696104727165e-01   -1.803446996528091e-01   +1.422581220121655e-01   -3.866756562008834e-01   +4.462188992439711e-01   +5.573512443929403e-01   -1.086324850456076e-01; -2.300020590289065e-02   -3.361250274513523e-01   -8.001037435868302e-02   -8.892993867542290e-02   +4.925136442376730e-01   -1.732444411343258e-01   -2.499186928776811e-01   +3.622623008277942e-01; +3.273485931634390e-01   -6.772193485967387e-02   -1.645306987626192e-01   +2.323518642967531e-01   +2.235459670772697e-01   +2.962697833827956e-01   -4.793202857204805e-02   +3.433352251332622e-01; -1.231107351181830e-01   +1.806908374327311e-01   -2.828574959368962e-01   +3.001844158063891e-01   +2.671456564237762e-01   +8.708996451349545e-02   -5.980691293908099e-01   -4.133863349339810e-01; -3.518948154670070e-01   -2.834986041982529e-01   +3.796668324609907e-01   -3.821235075265067e-01   +2.379631794470803e-01   -2.601554614718040e-02   -6.331935774552930e-01   +2.629233111437586e-01; -8.462320031379143e-02   -3.275687696578857e-01   -2.637916208090679e-01   +9.977948987928736e-02   -5.154133043766693e-01   -7.034752429477219e-02   +3.350196415946399e-01   -3.377691394239285e-01; +5.389131694481002e-01   -4.245297936662726e-02   +2.519553062427765e-01   -2.344476712194404e-01   +4.641785700416821e-01   +7.617144393408614e-01   +9.190212910614448e-03   -3.680749964311450e-01; +3.429872455323048e-01   -8.816346095680701e-02   -4.533778006818382e-01   -5.468539342750084e-01   -7.632891580783850e-02   +6.896158350853565e-02   +2.998696291569415e-01   +1.976155699937640e-01];
L3I_L3E_iAMPA_netcon = [-3.582259604156587e-01   -1.526433726915849e-01   +4.025155901882731e-01   +1.682287043698884e-02   -8.616481607522035e-02   +8.538329089027743e-01   +4.092206230884148e-01   -7.430203238248914e-01   +1.874089984531325e-01   +3.678623464784272e-03   +1.969112973369787e-01   -2.991012655777276e-01; -7.338946398501639e-01   -1.917950697267187e-01   +3.136771356784356e-03   -2.763562762368083e-01   +5.244209020436074e-01   +2.237907058895209e-01   -4.125041322753648e-01   -1.466693228465263e-01   -1.193872515452791e-01   +3.746099295629025e-01   +1.416179604681418e-01   -3.112494790019232e-01; -1.334148241818036e-01   -2.378687984487806e-01   +7.338924619194470e-03   +7.406019138913857e-01   +4.871622193052885e-03   -4.603293423052553e-03   +3.600157552551586e-01   +1.773875859418058e-01   +4.785993188043586e-01   -1.117422623734850e-01   -5.210594703549876e-01   +2.255517644488594e-01; +3.864017357605478e-01   -4.133428012080180e-01   +4.533502930054294e-01   +3.690401349480411e-01   +9.772407470740466e-02   -1.636020773135492e-01   +5.241367788157348e-01   -3.843086128809471e-01   +1.787835857516665e-01   -2.346118109790794e-02   +1.698200837136701e-02   +3.409367145616528e-01; -2.584664938338179e-01   -1.674385577817181e-01   +1.526167615984676e-01   +3.214529187207597e-01   +1.761214663265413e-01   -1.057473900369733e-01   -2.207523604268105e-01   +2.012518819855299e-01   +1.206717605518844e-01   -1.843462574845761e-01   +3.225884384080201e-01   +1.492373972577383e-01; -9.635910662206815e-04   -3.082874770583125e-01   +3.876520497192835e-01   -5.874928352647582e-02   -5.561343450073697e-03   +2.915833531119444e-01   +2.505901604378447e-01   -3.070041512129886e-01   -3.170461198115428e-01   -6.989414852707446e-02   +3.208180095811740e-01   +3.242047744690430e-01; -6.171756962992291e-01   +3.470070803205244e-01   -2.234829254053021e-01   +9.551661112512905e-02   -1.616008851118068e-01   -2.611202999392986e-01   -2.715875612075283e-02   +9.215023713536077e-02   +1.827810535398953e-01   +4.436053325561487e-02   -2.704228033029600e-02   -2.759431293217345e-01; +8.932527194028092e-02   -1.909427163604214e-01   -1.000444278811720e-01   +1.433813255846853e-01   +5.423014933159974e-02   -8.493151349974008e-02   -5.130225684058747e-01   +1.090927975439014e-01   +3.079949821333634e-02   +2.263198462357421e-01   +3.840928480747657e-02   -2.675446747374564e-01; +8.886598519651112e-02   +2.206259306339218e-01   +2.589734240080189e-02   -5.478634732509617e-01   +1.341606292193795e-02   -3.234172388413797e-01   -9.996085535964527e-02   -3.933305488642527e-01   +4.139473828866057e-01   +4.495348840444238e-01   -2.981649376807064e-01   -5.524736288847100e-02; +3.948360806356129e-01   -2.084168269828872e-01   +2.859784688581216e-01   +3.861230138201073e-01   +1.721448826455538e-01   -6.937390005301106e-02   +2.095359147762735e-01   +5.190388927771644e-01   +1.223382311532888e-01   +2.243519755308227e-01   +2.854939743737960e-01   -6.293598301146153e-01; +2.356963237849934e-01   +4.396049149741527e-01   -1.924828151378314e-01   +4.262153632508650e-01   -1.648219304098104e-01   -3.828230394065864e-01   +7.165619300498948e-01   -1.831150872611764e-02   -1.010795785672715e-01   +3.141878092918974e-01   +1.993840404726661e-01   -1.027717358774335e-01; -2.000509512136728e-01   +2.291932000437937e-01   +2.384205906569509e-01   -1.450051654073992e-01   -3.844794267132993e-01   -3.767839726700684e-01   +2.959662445763932e-01   -9.266393646858602e-02   +3.654249448622888e-02   +5.979149275827916e-01   +3.422540417058800e-02   +1.750901517058892e-01];
L3E_L3I_iGABA_netcon = [+1.281880955899105e-01   +1.116488475110405e-01   -3.195077894654874e-01   -3.714226203440869e-01   +5.369714663394599e-02   -4.734575323256882e-01   -2.181687262529874e-01   -1.319734788446390e-01   -4.860558260132601e-02   +3.714482221042563e-02   -3.028016735436018e-01   -9.424446925392260e-02; +1.894514875518065e-01   -6.561965025351364e-01   +4.199262495461725e-01   +4.845650475792980e-01   +3.105398551359026e-02   +6.484335205139939e-01   +2.245938849297604e-01   -2.343946868056691e-01   +5.682929302986950e-01   -3.395448806210290e-01   +3.853069307956880e-01   +3.067435664717185e-01; -1.783990473806702e-01   +1.846757122601966e-01   -2.614820971535735e-01   +2.839287292798703e-01   +5.076943402564770e-01   -2.136796828417636e-02   +5.950560620958580e-01   +3.870847924808191e-01   +2.229330285086814e-01   -1.196783770801491e-02   -4.351114371086940e-02   +7.651122131126742e-02; -3.548876446182572e-01   +4.607788169618929e-01   -3.021332696618327e-01   -4.971953237491710e-01   -7.836126906058138e-01   +7.529134663517814e-01   -1.369287044249459e-02   -7.828259466428301e-02   -2.131539106908888e-01   +4.802317054674866e-01   -1.340618500970294e-01   -9.618035400218068e-02; -1.251270136159376e-01   +1.360156669261775e-01   -1.041697305494718e-01   -2.382677914647950e-01   +2.803646075219920e-01   +2.839037311888707e-01   -4.199327769933547e-02   +6.120060003370562e-01   +2.692645236869894e-02   -1.488627763468426e-01   -1.266782516754468e-01   -4.792781119982604e-01; -1.250789527205157e-02   -4.338234845088252e-01   -2.127248893134057e-01   +2.708923404795092e-01   +1.148362958339908e-01   +7.974271417671944e-01   -3.487138698663855e-02   -3.816421616328733e-01   -3.880762528128034e-01   -2.215048533464126e-01   -2.401297056068449e-02   -2.377295328764440e-01; -3.378054672073180e-05   +4.252959325757603e-01   -1.345951829813411e-01   +1.978348129187208e-01   +3.065250330094269e-01   +3.462293629544670e-01   -1.029788555511184e-01   -2.146176526625767e-01   +1.691562045835183e-01   +4.486246003219093e-01   +4.057893662958302e-01   -4.232947819232759e-01; +1.316734833535513e-01   -1.458796062654512e-01   +7.495673169365394e-02   -3.292277980635328e-01   +2.449151645102565e-01   +2.474710339342258e-02   +4.696333636303316e-01   +3.347633184491688e-01   +1.904266622170115e-01   -4.814502846476846e-01   -4.493222615572575e-01   -1.521152120896833e-01; +4.263882124074357e-01   -2.121087439715452e-03   +5.196238748189231e-01   +5.369859892721087e-03   -6.533226904563801e-02   +3.014071397887541e-01   +4.560163695015101e-01   -2.786975164942790e-01   -4.385778340883077e-01   -2.788900648791434e-03   -6.985408246354495e-01   -5.671870094968055e-02; -6.594359214666896e-02   -2.259552451547509e-01   -6.419647067221747e-02   -7.820390883626244e-02   -1.758465851524168e-01   +7.289474584835381e-02   +2.661580169661289e-01   +8.813313406422754e-02   +5.624300323642903e-01   +3.345051339008290e-01   -3.656334453624630e-01   +2.611496566612385e-01; -3.199174624089213e-01   -3.862558113752532e-01   -1.415078574236069e-02   -1.566862291897854e-01   +6.058699861320195e-01   +1.126268652955170e-01   +4.901814627566911e-01   +3.568300892967486e-01   -1.551377560964412e-01   -3.957130978658224e-01   +1.891811931248174e-01   -4.547187838585970e-01; -4.612657781060042e-01   +8.230389600672509e-01   +1.805186352633343e-01   -4.815270044559566e-02   -3.960395842190023e-01   +2.343337217007578e-01   -4.524927457956681e-01   +1.754092681877542e-01   +7.688491177269620e-02   -4.035882093089928e-01   -2.893371437036594e-01   -2.595296659885467e-01];
L2E_Input1_iAMPA_netcon = [-7.466587382090034e-01   -3.531542484377333e-01   -2.830872932264860e-01   +7.774021691059876e-01   +4.372249767639365e-02   +1.310556113684301e-01   -1.794794149027562e-01   -4.661877255656630e-01];
L2I_Input2_iAMPA_netcon = [-1.941876217646935e-01   -8.583760735923468e-02   -5.746228252466747e-01   +4.118692601653458e-01   +2.960727111996490e-01   -4.725480812701672e-01   +5.188709453301933e-01   -4.864400484003190e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
