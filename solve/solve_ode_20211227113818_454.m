function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.788148719132184e-01   +1.837525638238273e-01   +3.935336872930810e-01   -2.328798011880854e-01   +1.949338543833854e-01   +3.001882102953020e-01   -1.381278524558467e-01   -3.201214606301683e-01   +1.151327483572841e-01   +6.189680127863906e-01   -1.763607169553842e-01   +3.186290367409053e-01   -3.975306732008604e-03   +2.256895297909759e-02   +2.301777710131348e-01   -1.093880243878623e-01; +1.244438444549921e-01   -4.055219834651080e-02   +3.161452278062076e-01   -1.069583948566496e-01   -4.447845252370963e-02   -2.185484943310936e-01   -2.930674352720654e-01   +1.884292755964609e-01   -2.306616180308770e-01   +2.838602450766011e-01   +1.601824974196202e-01   -4.204690355400725e-01   -3.991265452889879e-02   +2.969908552644649e-01   +1.711775208502835e-01   -9.364985188086122e-02; +3.190880770490652e-01   +1.550571254656217e-01   -4.042666411429928e-01   +5.129804637270345e-01   +1.994655025606494e-01   +2.194579213588441e-01   -7.476675864704033e-02   -2.737535257292703e-01   +4.413310249139281e-01   -3.864752164278825e-01   +1.276668692349836e-01   -6.705943365713460e-02   -5.715162626041621e-01   -1.223469239640742e-02   -2.335811612258245e-01   +3.898169684788840e-01; -7.583589876991054e-02   -3.079585544593719e-01   +1.102994044277272e-01   -5.408940314288282e-02   -1.308061385532459e-01   -3.359309415516441e-01   -9.245547318428773e-03   -3.728779778161145e-02   +1.292942890240049e-01   +1.528179554553137e-01   +3.729732502407797e-01   +2.723691177883376e-01   +2.333643729571501e-01   +3.255915851893383e-01   -1.546200940214202e-01   +4.141646783917542e-01; -2.004664362809638e-01   -1.592717544128872e-01   +7.911355947806283e-02   +1.248642718417208e-01   +9.453844935656011e-02   +1.047254161213535e-02   -2.405487051354405e-02   -5.901341150248032e-02   +3.200045205364332e-01   +3.712329525029938e-01   +2.855795424299115e-01   +1.511212030462088e-01   +2.406751867462733e-01   +1.986658600701335e-01   +2.612701624928582e-02   +3.035828040636175e-01; -2.483496093730905e-01   +1.378919111092654e-01   -3.058066026773154e-02   +1.850369357337988e-01   +4.547527826472962e-01   +7.137421882116690e-02   -1.355590584331486e-01   -5.978415537211815e-02   +1.283854821338915e-01   -2.699580831317605e-01   +2.856319181593401e-01   +6.852312152860891e-02   +2.676843246910368e-01   -8.829320218817753e-02   -2.120878493551909e-01   -2.317688039896078e-01; -9.977422559703208e-02   -7.017810659721552e-02   +2.345470029841172e-01   -2.828274601908676e-01   -8.913644642823240e-02   -1.223728620233361e-02   -3.855952683377589e-01   -3.327368497325772e-02   +4.561377004189363e-02   +3.036638410214116e-01   +1.284424073368303e-01   -2.611209067647826e-02   +1.717986327375980e-02   +4.185911223751276e-02   +1.725200251633628e-01   +2.651345576788364e-01; -1.999724417473287e-01   -3.080123500311871e-02   -6.695964838961392e-02   +1.861109498589369e-01   -4.805764112245758e-03   -2.143949342698213e-01   +1.527999171725805e-01   -2.581040807596221e-01   -2.959434581485644e-01   -1.003108270781188e-01   +3.169551022212312e-01   -1.984817851892828e-01   -1.497479885286721e-01   -1.119985863276566e-01   -4.791843846176596e-01   -4.050615046829182e-01; -8.565772381702252e-02   +1.077110855586728e-01   +4.514828705568267e-01   -2.794358417612907e-01   +3.913792815666059e-02   -3.857778619857335e-01   -3.794424403262625e-02   +7.882485973383013e-02   +1.207763204600929e-01   +8.132281853898764e-02   +4.084206121918899e-01   -1.990865360273992e-01   +8.352199503836813e-02   -2.005248662106235e-01   +3.763177085329212e-01   -4.137791141038408e-01; -1.481448036533997e-01   +7.636229233840038e-02   +2.387119900352514e-01   +2.117166515530389e-01   +1.863648645160109e-01   -1.758578021683368e-01   -1.180184730127726e-01   -3.386993713415075e-01   +7.184920574701814e-02   -3.169275189323334e-01   +1.030397748117860e-01   -2.659284545959166e-01   -2.081965555697399e-01   +1.697750301982222e-01   -5.612258287518512e-01   +2.144188974063894e-01; -6.112869128413918e-01   -6.999972563620366e-04   -3.143776292465412e-01   -1.846741980280868e-01   +4.626430882552023e-02   +2.361331832816472e-01   -4.887209564992932e-02   -2.924173160259739e-01   +1.743851300255236e-01   -7.303474856416495e-02   +1.564596423312986e-01   +1.771414308260425e-01   +3.053227796692193e-01   +1.582402473970224e-01   -1.928965558787482e-01   +1.612995454914347e-01; -2.106364470596307e-01   -2.872325141378659e-01   +2.660484874180645e-01   +1.689743695661414e-01   -1.313380784429792e-01   +3.242685033176094e-01   -4.281661987247506e-02   +2.981771788581487e-01   -3.082788841102157e-02   -2.636001485254929e-01   -1.906471597155295e-01   +8.073376090836798e-02   +1.894130807815632e-01   +2.724423534045837e-01   +1.542222953151220e-03   +2.185607638702771e-01; +2.241284470303089e-02   -3.387555587091839e-01   +1.917089365956343e-02   -2.760575357409185e-01   -9.700561454939519e-02   +1.011769392005083e-01   -2.258704894256598e-01   -1.540035447012771e-01   -1.902326695690661e-01   -6.132497131859043e-02   -6.932284564586721e-02   +2.240460462119959e-01   -2.950085853704124e-01   +1.324138538462652e-01   +2.394067425087657e-01   -3.029550003718667e-01; -2.016093720759094e-01   -1.591087115358447e-01   +1.811572215052570e-01   +3.966572228660594e-01   +2.779468285791895e-01   -2.731749050297394e-01   -6.260049620597474e-01   +5.243863263107538e-01   -1.101864424965699e-01   +3.882181064108511e-02   -3.425582109521950e-01   +1.342442202978403e-01   +2.513189856829692e-01   -4.110008212691253e-02   +9.363058189587400e-02   -1.192771578792803e-01; +2.215367024197522e-01   -1.029387360290770e-01   -6.234542543859725e-01   -1.418612893780510e-01   -3.248421177868890e-02   -1.280445504152294e-01   +5.504907657446956e-01   -4.341942638544155e-02   -3.029874123705009e-01   -1.476190026964317e-01   -2.614172534834354e-02   -3.063258721544313e-01   +2.662722534300714e-01   -3.212550838890912e-02   +6.161449765725015e-02   -3.146689666152590e-01; +9.644674633399752e-02   -1.872577665358763e-01   +1.257398043334692e-01   -3.915674438351688e-01   +2.056708355012516e-01   +2.991866046298664e-01   +1.256261279403312e-01   -7.909704117578217e-02   +1.852769330051644e-01   -6.186661543274804e-02   +3.463300973661755e-01   -4.584926960791637e-01   +6.813394450203954e-02   -2.505931436149079e-02   +4.158798909821244e-02   -3.453454403229680e-01];
L1E_L1I_iGABA_netcon = [-1.544660671811027e-01   +2.344169733531617e-01   -4.584390862498846e-01   +1.650038029888098e-01   +1.855376463150573e-01   +5.550532351671988e-01   -4.443860122303378e-02   -3.098708088441823e-01   +1.027580734957253e-01   +5.506750142187258e-01   +3.287348211766808e-01   -2.906374835320240e-01   -6.228598023085838e-02   -4.835902222166413e-01   +3.932251185501584e-03   -2.379443741138997e-01; -3.618950310140477e-02   -7.049021374515352e-03   -3.704779315057512e-01   -1.121011561704273e-01   -1.303482187391974e-01   +7.417375980423545e-03   -2.295390767083925e-01   +1.819947392356597e-01   +2.666904550951419e-01   -2.203805424656632e-01   +2.918568669955368e-02   -5.907630102638610e-02   +1.949114637302158e-01   +3.299374067173659e-01   -1.008539496478229e-01   +4.774390936056461e-02; +1.931522781218838e-02   +2.581431581904119e-01   -6.997909177886973e-02   -2.917596713713598e-01   +3.469501747256090e-01   -6.903867829633796e-02   -1.720888062466666e-01   +3.996107814548344e-01   +1.227787697271848e-02   +6.204151444978873e-02   +1.232622193154642e-01   -4.691066998525930e-02   +4.009366738374305e-01   -5.003246259973282e-01   +3.464857704792610e-01   -4.056121624090289e-01; -2.893095055342244e-01   -1.222087135069521e-01   -1.062431781097049e-01   +2.161266274805942e-01   -5.286278794574313e-01   -2.861446452788672e-01   +4.505679699595755e-01   +3.266533999515774e-01   -1.741876422864527e-01   -5.096877385453547e-01   +1.115618576591338e-01   +2.727446883454504e-01   +2.363903740957810e-01   +2.742077102392220e-01   -3.183828172163073e-01   -1.141528815014660e-01; -3.909707313213863e-02   -1.076249495720044e-01   -3.944437734278512e-01   -3.449412248001908e-01   -1.047217679260178e-02   -6.851820008467338e-02   +7.622169278421517e-02   +4.204989136549749e-02   -8.431982383399178e-02   +1.628652902419439e-01   +2.479726193670439e-01   -1.309433160342394e-01   -1.479437710889071e-01   +2.179315144529285e-02   +2.229196981489541e-01   +8.441719001883102e-02; +5.842124746160998e-03   +7.809380640904248e-02   -4.888871419008547e-02   -8.105779822680996e-02   +1.345682969260796e-01   +4.130530215932960e-01   -2.848646098732658e-01   +6.149623223041906e-02   -3.202455503912240e-01   -1.081177823145326e-01   +1.565910385738136e-01   -1.157852272712147e-01   -7.661922659270037e-02   -3.290617433419479e-01   -4.776180205017133e-02   +1.651766475169808e-02; -3.340480917089745e-01   -4.075929873380754e-02   -1.791199428309355e-01   +2.574506698994388e-01   -2.111031596833110e-02   +6.371426954086433e-02   -1.486504646774825e-02   -1.344625895729864e-01   +3.460620614047291e-01   +3.360012644465982e-01   -2.075286399467783e-01   +3.347372899980219e-01   -4.602620484824629e-01   -1.928096549555364e-01   +3.550264311198136e-01   +8.603333313132003e-02; -3.740372104767969e-01   -4.195657469254221e-02   +1.933275698325769e-01   -3.160201608017165e-01   -1.867528628223485e-01   -3.087485279492869e-02   -6.678362945643103e-02   +5.543861772879188e-01   +1.932548783181728e-01   -3.781432247392905e-01   -6.244104488466105e-03   +1.431393243445428e-01   -2.538508395572700e-01   +2.838927537680316e-01   +2.319149049626478e-01   -1.559371152441920e-01; -4.002763400734939e-01   +1.026569837238696e-01   -1.135857983377648e-01   +5.596444072445355e-02   +2.203041412170888e-01   +4.412092354712502e-01   +2.713743711704444e-02   +1.547829683309800e-01   -1.077412484509678e-01   +2.049559985857746e-01   -3.800747733301288e-01   -3.803126356006107e-01   +2.642572297824024e-01   +2.413357071645101e-01   -3.699535705787643e-01   +3.752492666004558e-01; +6.062202515039106e-02   -4.842788937960427e-02   -1.412810788812516e-01   -1.511338619475950e-01   +1.473620341388099e-01   +3.336865164014362e-01   -1.991868079431018e-01   -1.732799798644047e-01   -3.269963206282259e-02   -2.780704121014410e-01   -2.336985477274458e-01   +3.008062784956760e-01   +2.122439455045503e-01   -2.493185512701789e-01   -6.876251521255707e-02   -4.119485063852438e-02; +1.085176230130047e-03   -3.067874226216817e-01   +5.859644507955743e-02   +4.770525850530385e-01   +3.005663686408498e-01   -2.413818315467946e-01   -4.449732053862200e-02   -5.095748009118057e-01   -3.118628417319886e-01   -2.756562404189574e-01   +1.174148480648648e-01   -4.516141023546411e-02   +3.894539056137192e-01   +1.696776227702281e-01   -4.470749608221186e-02   +4.218309691918948e-01; +3.170811350348562e-01   +2.213674918308678e-01   -1.452811786350890e-01   +1.802684988539832e-01   +3.800040417572002e-02   +3.252163764672201e-01   -9.860148263787330e-02   +4.764484344780012e-02   +1.708992917460382e-01   +2.671815094522246e-01   +3.379413056630991e-01   -1.042015992001914e-01   -6.756891235640886e-02   -2.646222377129103e-01   +3.326510123910133e-02   -1.879579467758361e-01; +5.484544240336015e-02   +1.709777721676686e-01   +5.302917803985953e-01   -6.593271963840207e-02   -4.285577497472073e-02   -6.192511387548503e-02   -1.777171465847980e-01   +4.196546987721360e-01   -9.267107999251553e-02   -5.979501941337917e-02   +1.431548135416572e-01   +3.322880619138290e-01   +8.247546502048932e-02   -2.053473825889855e-01   -3.090879705045828e-01   -1.914505262241275e-01; +3.099508440255510e-01   +1.972456415676821e-01   -2.484546391680593e-01   -1.268182540410046e-02   +3.261135295753503e-02   -1.202296195252442e-01   -2.912384405351207e-01   -3.734050290309134e-01   +5.356582689981593e-01   +1.430912667671540e-01   -6.785235484329419e-02   -2.542456008620598e-01   +6.703568197273629e-02   +1.019210157843839e-01   -1.706927136864558e-01   -3.636377985299952e-01; +3.354832245810999e-01   -1.020479496766865e-01   -3.127110764100961e-01   +1.937678757806503e-01   -3.146502372809936e-01   +3.850637316102632e-01   +2.158809281665161e-02   +3.331486199682918e-02   -8.066989794472161e-02   -4.184709007217761e-01   -1.028749637723559e-01   -7.234986725197647e-01   -7.600241318377327e-02   +1.976374526254570e-01   -2.019882181310788e-01   -3.908174032549202e-01; -2.393119608243720e-01   -3.000635360097288e-01   -2.855488143381899e-01   +3.288466923918029e-01   -2.480872956958043e-01   +2.839738406553748e-02   +1.541941727414733e-01   +2.575072745242947e-01   +3.675341633875669e-01   +4.725862247806784e-01   -2.750270174846486e-01   +6.012644015716034e-01   -4.925358719175923e-02   -2.225348968673452e-01   +3.983119865943624e-02   -4.247998940925798e-01];
L2I_L1I_iGABA_netcon = [+2.663855499286314e-01   -6.679189520471090e-02   -3.219194782833121e-02   -4.323437608127151e-01   -5.075157280019569e-02   +7.922983499311961e-02   -2.220254622993561e-01   -2.395473731538162e-01; -1.865335943114479e-01   -1.407416788888309e-01   -1.496791550610422e-01   -1.997340811437260e-01   -7.788426537134778e-02   +4.233012180572565e-01   +3.217718531760386e-02   +2.831431406407925e-01; +1.798724732132734e-01   -3.400253191998200e-01   +1.099439074450763e-01   +1.658166284457159e-01   +4.159630357218532e-01   -4.543326232956129e-01   +3.611084203626529e-02   -2.330172354828307e-01; -1.612600255459487e-01   +2.252838511540016e-01   +3.548989726153880e-02   -1.617011727510612e-01   -8.720377904972659e-02   -1.959658470977013e-01   +4.958355045686685e-02   -1.340023563441975e-01; -1.522937090577683e-01   -4.606240258873261e-02   +2.145426154297012e-01   -5.829308244169867e-02   +1.758986706951712e-01   +4.021310562417978e-01   -3.781344389196090e-01   +1.924404004292555e-01; -9.988326892384142e-02   +1.510274447372773e-01   +1.919202359467761e-01   -8.212941500938864e-02   +1.904353397763600e-01   -1.769975024971054e-01   -2.127207663008692e-01   +1.418503742654987e-01; +1.858754859775967e-01   -1.789566778664333e-02   +4.315905580589294e-02   +3.847505061933172e-01   -2.124690832253148e-01   +3.848187148943653e-02   -1.549166708922832e-02   +4.654858917858752e-02; +1.798709935326841e-01   +1.362966854108024e-01   -2.499229777041518e-01   +1.181365917639347e-01   -9.431765604281675e-02   +1.287306574390568e-01   -1.719589892814609e-01   +2.914821570601202e-01; -6.176223518481112e-02   +3.414200639652625e-01   +4.231061348575929e-01   -6.122627423846239e-02   -1.310744058245392e-01   -1.321909835647274e-01   +2.011231590495179e-01   +5.942539071979980e-02; +3.755890745991317e-01   +1.780955308064755e-03   +3.182914698745450e-02   +1.986852555654193e-01   +1.591056840723332e-01   -3.567043358684123e-02   -5.248589130378187e-01   -3.845175340357891e-01; -1.220501358996486e-01   +2.468106094584858e-01   -1.460588769814691e-01   +4.331862931564395e-01   -1.322369136338092e-02   -7.202206880090538e-01   -1.866440931850759e-01   -1.104458904353015e-01; -6.097043616381848e-01   -4.244877480837617e-01   +2.160556855427086e-01   +4.132084346410314e-02   +8.541842159643584e-02   -1.643135015786842e-01   -1.740396803195767e-01   +2.530962102160323e-01; -2.796987092842980e-02   +3.394891125118814e-02   -1.474052146995428e-01   +2.954536601330705e-01   -1.153612658089003e-01   +1.079940339481732e-01   +1.622808169371456e-02   +2.733829708925026e-02; +1.722173730141071e-01   +9.183523668833932e-02   +1.436798674154125e-01   -2.369425708693791e-01   +1.252067848355199e-01   -2.461701958080562e-01   -5.177904358887096e-02   -1.002251933136216e-01; +1.709949659084256e-01   -1.174821539215085e-01   +4.748020062727917e-02   +6.339953778949153e-02   +2.366548408554611e-01   +1.516362009518820e-01   +1.738865616036724e-01   +5.342413169877519e-03; -3.060432263511381e-02   +1.289410191958938e-01   +3.632537220365643e-01   -1.105440789855175e-01   -5.425089624124736e-01   +3.644835764060602e-01   -8.831814452734672e-02   +9.468130852683271e-02];
L1I_L2I_iGABA_netcon = [-9.094723503717478e-02   -1.688602426846124e-01   -1.230467080614569e-01   +3.431681257506703e-01   +3.747360101820953e-01   -3.103273804451077e-01   -1.154229941612447e-01   +4.873863750612970e-02   -6.309364016849556e-02   -1.564321378632216e-01   -5.785983269699448e-02   -3.725604080417600e-01   -1.430510108684880e-01   -2.380497518373832e-02   -7.681994582653259e-02   +1.921703913861247e-01; -4.080227740592003e-01   -1.141944865902584e-01   +5.766160505671758e-01   -9.308813475415706e-03   +3.834512224124227e-01   -1.284117240786471e-01   -1.650687397711252e-01   +4.116615157798700e-02   -2.364597873972945e-01   +1.585538111349790e-02   +4.030637680392335e-01   +1.413717063549620e-01   +1.913008778561626e-01   -4.701831422710537e-02   -2.596359379468924e-02   +3.233404481349324e-02; -1.731365583924135e-01   -1.149118443418158e-01   -1.475982756569766e-02   +6.438135591028088e-02   +1.661320769082482e-01   +9.488518845366777e-02   +4.177660561427016e-01   +7.445671426140776e-03   +3.944073274281278e-02   -2.770065495502103e-01   -4.479928447221164e-01   +3.541223556127697e-01   -1.218822725510267e-01   -2.552565453691730e-01   +3.523507520693420e-01   +1.019996994412160e-02; +9.216493882087620e-02   -1.263208649984952e-01   -2.443519861583877e-01   +9.757066996598911e-02   +2.917076908849109e-02   -3.194955905536239e-01   +2.897943913632006e-01   +7.654883924918587e-02   -6.572187683227865e-02   +1.896864412480054e-02   +1.443643675523109e-02   +2.488385772801804e-01   -9.964437066553783e-02   -1.038780435275252e-01   +2.118854995265233e-02   +4.661964640675962e-01; -1.685469094499864e-01   +1.722104698768871e-01   +9.931009453576857e-02   -1.503733235080774e-01   -4.054706518556960e-01   -4.164003295712424e-01   -3.437059903485495e-01   -1.684090992038252e-01   -5.943484547744271e-02   +1.424190026203156e-01   +4.013862552992075e-01   +1.896311714362408e-01   -1.702466397485738e-02   -1.043972472657623e-01   +1.672827509307078e-01   -2.505165328016497e-01; -4.521790525773306e-02   +3.543075634204496e-01   -3.854077251881272e-02   +6.432203000972472e-02   +1.924772967372196e-01   +1.586030788401052e-01   +2.053601749528705e-01   +1.996969940362264e-02   +9.342210509818889e-02   -5.930714989402910e-02   +1.700866812389709e-01   -1.251948162604025e-02   +4.463222853276345e-02   +1.738954433663056e-01   +7.999315792422795e-02   -4.206512278516057e-02; +3.873111749348328e-01   -4.675440770141262e-02   -1.960177387652209e-01   +2.405643666492255e-01   -1.556220526434985e-01   +2.853585697950421e-01   -1.160353596371239e-01   -1.424333344549642e-01   +3.800859353777635e-01   +1.275845651511784e-01   -1.531779869480926e-01   +2.333324552089527e-01   -5.770817711588191e-01   -5.478542580436155e-02   +1.286241115920997e-01   +2.686304251963073e-01; +1.465346852993362e-01   -1.208742039155492e-01   -2.635957329075662e-01   -6.574672191285155e-02   +5.461837242026431e-01   +1.406300070974043e-01   -8.537913213276921e-02   +1.031187490178503e-02   +1.729349004892634e-01   -5.795740543065397e-02   +2.923277813153600e-01   -3.415597487653989e-01   -3.433593596966111e-01   -2.784644980788580e-01   +2.514143927478710e-01   +1.112690974858142e-02];
L2E_L1E_iAMPA_netcon = [-1.451819094345015e-01   +2.649567065368812e-01   -2.762765902467439e-01   -4.049807607110934e-01   +1.545183401293419e-01   -4.656656184214567e-02   +3.380072782790137e-01   -2.859420314995937e-01; +3.479581663310805e-03   -1.259436878681727e-02   -8.532497084772993e-02   +2.566045311099854e-01   +1.337927208314485e-01   -3.805825718558988e-01   -8.855069210610543e-02   -9.702299146443925e-02; -9.964585826520142e-02   +2.755392599204848e-03   -3.736835612386122e-01   -1.809286073367513e-01   +3.128807564147220e-01   -3.548814547234052e-01   -1.785737306827219e-01   -2.061914285634671e-02; +2.848131951061208e-01   -1.081579917156929e-01   -1.881023106237786e-01   -1.643780186250129e-01   +5.620789219046329e-02   -2.418484926054814e-01   -8.955736335226480e-02   -3.678649427459185e-01; -2.065413278180009e-01   -1.976482850167136e-01   +1.576667336253026e-01   -3.839874128076487e-03   -4.063058968741279e-02   -1.353736132017627e-02   +9.091891489918624e-02   -3.233751706778117e-02; +2.093575228976220e-01   -1.629496021249842e-01   +3.616612470551842e-01   +1.325406749358893e-02   +1.007326213915783e-01   -1.788419771506533e-02   +5.669975346329162e-02   -4.261782099471155e-01; -3.011140818733056e-01   +1.105607381992055e-01   +1.840070879826124e-01   -2.686872391930159e-01   -3.100615479058323e-01   +1.196726805774377e-01   -3.712463810266947e-01   -3.129036022512524e-01; -4.275685410842028e-01   +4.525638996526587e-01   +1.659064519235398e-01   +8.885348894278612e-02   +2.619083188708052e-01   -1.614628185463884e-01   -5.647824541956158e-02   +2.485611535917192e-01; +2.312593230518080e-01   +9.791543482317067e-02   +2.365693947134098e-02   +2.010746810076717e-01   -5.483200902540544e-02   +1.467228038125634e-01   -2.859951196564700e-01   -3.355230155427339e-01; +1.037898624840593e-01   -4.085088726921031e-01   -2.940175091986935e-01   -2.419210170350350e-02   -4.159260313067022e-01   -3.259588379793750e-01   +2.459657524069536e-02   -2.394956169744470e-01; +2.451298543291330e-02   +2.337846709425886e-01   -8.716736049492843e-02   +1.644751444401036e-01   -8.972394027220870e-02   -2.194381059775946e-01   -4.529138618667855e-03   -1.384807454337078e-01; -2.480237315401050e-02   -1.616850121456591e-01   +8.160406654292041e-02   +1.154232365936885e-01   -1.659185624759217e-01   +1.948383447306240e-01   +3.031326789705183e-02   -6.159537960527626e-01; -3.415544449244421e-01   +3.065789405730620e-01   -4.261187339957151e-01   -2.620548427308661e-01   -4.685958876631561e-01   -1.912954215975518e-01   +1.931006141872946e-01   +4.609113127496961e-02; -1.991619406332089e-01   -1.794559450937388e-01   -1.879967060147287e-01   -1.509208888563661e-01   -1.135433271715972e-01   +3.113320672379961e-01   -2.248517087659991e-01   +4.466794429599491e-03; -1.012534083510213e-01   -6.111910191147098e-02   -1.442730185652025e-01   +3.303874540746425e-02   -1.439411333718910e-01   -6.949644133147968e-02   +1.437523506601648e-01   +2.750331474863945e-01; -1.164961058051262e-01   +4.861397765095485e-02   +2.479357504916223e-01   -1.907296346389160e-01   +2.968028269877087e-01   -1.177393868875810e-01   +7.021661755666082e-02   -3.241865064398733e-01];
L1E_L2E_iAMPA_netcon = [-2.095902555704068e-01   +2.626425684374556e-01   +5.881547266116192e-01   -2.915482355654252e-01   +1.092554487101707e-01   +7.779103919974717e-03   +5.245430437004779e-01   -4.271957576125932e-01   -9.225497575405675e-02   -1.440208336402812e-02   -1.412647922358884e-01   +1.320284027440901e-01   +2.718630998723228e-01   +1.678638163902141e-01   -2.710171844187166e-01   +3.000671464182916e-01; +8.309231045340365e-02   +1.578837953839302e-01   +5.413317143985696e-01   -5.060427889501433e-01   -3.601193884045235e-01   +1.943350660972651e-01   -2.341984648978745e-01   -1.334786932400222e-01   +9.367236468751958e-02   -1.740991921594104e-02   -2.883577345039535e-01   +1.440557718683784e-01   -5.133467395387590e-02   -8.246211167327172e-02   +2.835696182956780e-01   -1.620493144029177e-01; +3.203911872518079e-01   +3.139823396203316e-01   +2.102887000569471e-01   +1.847940134091409e-01   -2.898208035791977e-01   -1.289731059941148e-01   +4.782955595179567e-01   +1.616891408455517e-01   +1.457286827146188e-01   -8.170696175383504e-02   +4.068008152380467e-01   +1.924337265927868e-01   -4.813501455361580e-04   +3.085357372414771e-02   -1.167862077529425e-01   -1.232138562002654e-01; +2.110307964070436e-01   +4.705509122946617e-01   -4.795544446437976e-02   +1.625864181240815e-01   +1.138120511418743e-01   -2.175197514267159e-01   -2.683176653324779e-02   +3.870700618503097e-01   +4.800534058030846e-02   -1.903395392717529e-01   -1.314094787905489e-01   -2.054812293709043e-01   +3.994102989022263e-01   -2.002048887018916e-01   -1.237104145399992e-01   +1.258189639108440e-01; -3.815228676901633e-01   -1.127086010914957e-01   -5.259816021919320e-01   +5.602340574577154e-02   +1.068734029899445e-01   +8.535272338085606e-02   -1.211094839355773e-01   -1.358913128234851e-01   +1.712617162112846e-01   -1.788034043750049e-01   -3.283837330405949e-01   -4.173876723793584e-01   +6.298895773095411e-02   +1.269619167103431e-01   -3.487016133226948e-02   +2.193757894879006e-01; +6.166106607297189e-02   -2.807439848241731e-01   -1.069776335751879e-02   +2.520368480319952e-01   -1.032194205024551e-01   -2.362987099406574e-02   -2.229101075569961e-01   +1.356281326838547e-01   +3.649142053408881e-01   -1.778148974447981e-01   -1.925368715234300e-01   +1.746839604051872e-01   -2.639092156902158e-01   +1.410048482948447e-01   +1.218704930895046e-01   -1.446593699698408e-01; -1.082953896694567e-01   +3.091017159930906e-01   +2.960255869259233e-01   -1.965879097535697e-02   -5.465813690258790e-02   +4.827048281287267e-02   +1.704662598114426e-01   -2.553216811930289e-02   -3.691968462688619e-02   -6.744696952017093e-02   -1.877354668414761e-01   -3.444109099240883e-01   +6.576967377951359e-02   -3.136622164057439e-01   -1.005951890114405e-01   -1.210581125621087e-01; +2.758091581378169e-01   -1.842837478740673e-01   -1.997371254375241e-01   +1.427423650018570e-01   +1.358168218095032e-01   +2.002041034832338e-01   +9.866927397928457e-02   +1.012946675139152e-02   +3.475359191243380e-01   +1.310274066654336e-01   -4.630637399407077e-01   -3.325150203028895e-01   +2.229314525746501e-02   -4.415381587064555e-01   -1.586608617852198e-01   -1.359603492878370e-01];
L2I_L2E_iAMPA_netcon = [+8.142825146910340e-02   -2.039089524273123e-01   +2.071749616562839e-01   -1.684158804933000e-01   -7.947402415431563e-02   +3.451145417043924e-01   +2.314752914800689e-01   -2.563608561721168e-01; -5.352020992907180e-02   +2.654295753134992e-02   +3.430337848377756e-01   +4.599049705805726e-01   +3.594175784462128e-02   +3.839938164445406e-01   +1.530918521750871e-02   +1.900166150316619e-01; +8.191942288442204e-02   +4.959759589798010e-02   -5.693119328114180e-02   +6.835596288378816e-02   -5.853322413440135e-02   +3.729265630542897e-01   -1.669885848045239e-02   -5.953233136633407e-02; +3.924269135677686e-01   -6.163351417934082e-02   -5.990838183830324e-03   -1.163576253190418e-01   +5.071865345529534e-03   -1.282259509750008e-01   +3.270454577357947e-01   +1.260209065326905e-01; -2.418391628884318e-01   -2.615563327184810e-01   -2.604745499020517e-01   +1.570552514402203e-01   -4.956496620869169e-02   -9.322270492758924e-02   +2.786152947623701e-01   -6.958148403179286e-02; +1.850052617368854e-01   +2.347331048564168e-01   +2.001695841526082e-01   +1.419480210679153e-02   +3.328629330165762e-01   +2.132445888034904e-01   +1.846964310771954e-01   +1.366013736724097e-01; +4.014574339671596e-01   +2.624973607916836e-02   -2.426947416282557e-01   +2.073439975425946e-01   -2.087540364889467e-01   -3.982174370788953e-01   -2.025830113841197e-01   +3.385641885418725e-02; -1.654941378751708e-01   +1.748128456790075e-01   -3.427873317906280e-01   -3.496662666629952e-01   -2.580154572427240e-02   +2.487734654802418e-01   -7.492422097532003e-02   +6.396189048025550e-02];
L2E_L2I_iGABA_netcon = [+1.833392725349746e-01   +5.292688106466489e-01   +7.851651730258404e-02   +1.378017292980601e-01   -4.319480364704626e-01   +1.038390476189434e-01   -1.909958853182698e-01   -1.078442067302598e-01; +4.240657877348647e-01   -2.263786108404958e-01   +1.311629088322890e-01   +3.482733786950980e-02   +3.727483887958000e-02   -3.467342496935184e-02   -6.245963211372385e-02   +2.966042201246599e-01; +4.021235102049223e-02   -1.137328106494387e-01   -4.428566917389792e-01   +8.530591114486882e-03   -1.288814185445623e-01   -9.980990577776085e-02   -4.275483284546113e-01   -2.935818992426308e-01; -1.620565635672662e-01   +3.569187397753871e-01   +1.042624364817955e-01   +3.742226168447619e-01   -8.938409098618558e-02   +3.184039602620478e-01   +2.181322838312167e-01   +3.194126666278008e-01; +1.832431628682456e-02   +2.935409922460469e-03   +1.393355313415809e-01   -6.025278939012252e-02   -9.061008340246715e-02   +1.751349691673071e-01   +1.201817257452614e-02   -5.863894322417870e-01; +1.911844307011994e-01   +6.862744285122778e-02   +1.238457457926557e-01   +1.446445890622715e-01   -2.729802861210620e-01   +1.202873016965811e-01   +1.283881404296807e-01   -6.101894651960107e-03; +7.354830635482659e-02   +2.013648203942671e-01   -9.616874455945094e-02   +1.840914239320536e-01   -1.005559557495534e-01   -1.114833199712133e-01   +1.018139737449050e-02   -1.231247320944921e-02; -1.641252014506480e-01   -2.162015465843938e-01   +1.378290073222330e-01   -8.351219390762162e-02   -7.258925509251279e-02   -1.650743627476636e-01   -2.488085338915055e-02   +7.042501216237945e-02];
L3E_L2E_iAMPA_netcon = [-3.568480003689355e-01   +2.588719283269438e-01   +6.771129291491390e-02   +7.203302733837322e-02   -2.218466124151947e-01   +3.372282546364885e-01   +4.906565656767697e-03   -8.486149225721008e-02   -1.572608754921375e-01   -7.866960388871780e-02   -3.163221014732037e-01   -4.580196304130433e-01; +5.237898196679100e-02   -1.184743032515298e-01   -2.580654538619646e-01   +1.615859295317725e-01   +1.855030871146835e-01   +2.641335650332065e-01   -2.785607597134433e-01   +1.142615322128685e-01   -3.211310088726175e-01   +3.833909568359589e-02   -3.192735284686313e-01   -3.669968784789747e-01; +3.096143201894038e-01   -9.500599604389634e-02   -5.228724834962117e-03   +3.447569013424966e-01   +1.601249143228436e-02   -3.281735413302881e-01   -1.799771530380524e-01   +3.277560790812156e-01   +2.771574602001388e-01   -1.179795714933687e-01   -1.726239021086376e-01   +2.639359066839884e-01; +3.118008392803778e-01   +1.107028252253808e-01   +6.060074780163166e-02   -2.901912311200280e-01   -4.076776234198612e-02   +3.846484577940943e-01   +2.855847414040213e-01   +1.662733113376084e-01   +1.942129086401434e-01   -2.882207900328565e-01   +3.491358578462630e-01   -9.199856056965161e-02; +9.987115804720767e-02   +2.864204925909084e-01   +5.860649363273698e-02   -2.419444841738680e-01   -2.753969770971374e-01   -6.554056375449713e-02   -2.489911590220438e-01   -3.773602649011025e-01   -2.520399883422766e-02   +9.422050491524708e-02   -8.879594207156587e-02   -1.078387614084955e-01; +1.489121944222127e-01   +1.484976098742081e-01   +1.009525277618524e-01   -2.205727329016056e-01   +5.028332052221977e-01   -1.288994871989532e-01   -1.968117098535647e-01   -1.035967656482799e-01   -2.620030797632871e-01   +1.620332394533092e-01   -2.720785079619566e-01   +9.468958217774938e-02; +2.625414614511495e-02   -1.545918812422547e-01   -3.327866481987501e-02   +3.023929986627506e-02   -1.975087157289349e-01   +7.220953459838489e-02   +3.327452792218569e-01   -8.466578703048894e-02   +7.074762912876573e-02   -5.351125830052879e-02   +2.674199562089027e-02   -2.326121589811332e-01; -5.110665046552534e-02   -1.101879377415667e-01   -4.979020658843780e-02   -9.349978788526569e-02   +1.835726708042183e-01   -3.885994759278209e-02   -7.291845647963885e-02   -1.408531553023322e-01   +1.273030644323196e-01   -3.482420504123468e-01   +1.550115749784394e-01   +3.551756100771093e-01];
L3I_L2I_iGABA_netcon = [+1.035563340969350e-01   +2.239133062253958e-01   +5.927338343100713e-02   +3.913618650914045e-01   +1.178196473887797e-01   -1.933160926630471e-01   -1.382374884265578e-01   +2.485873225052938e-01   +1.969005277379473e-01   -6.844196024961391e-02   +1.911701977688110e-02   +8.377037452021147e-02; -1.907875754232748e-01   -4.679885402997154e-01   -1.689228926242735e-01   -1.568973854566884e-01   +5.290608331839697e-01   +3.650356592500553e-02   +3.046131982227162e-01   +4.825039988135600e-01   -4.650602007592820e-02   -2.655497953107120e-01   -4.360111011464271e-02   -4.864030170322876e-01; +2.319312395510488e-01   -3.536172415397696e-01   -3.085362645430213e-01   +2.255285704183842e-01   +3.540122377334172e-01   -7.026988042832298e-02   +2.129919468427471e-02   +1.659905364997590e-01   -1.791496363675198e-01   +1.347023591596825e-01   +2.277710033663383e-01   +1.076159613429143e-01; -3.897174720699596e-02   +5.076787374321966e-02   +1.243886539489895e-01   +9.792881164407891e-02   -9.001132173983444e-02   -1.387413882426034e-01   +2.250678496115553e-01   +1.062459567853103e-01   +8.585149358011913e-02   +1.884903684321851e-02   -1.520760048762404e-01   +1.722982629492545e-01; -1.999026921917250e-01   -2.452222256278034e-01   +7.013666925989945e-02   -6.240887801877654e-02   -1.796518050114794e-02   +5.740348391313306e-01   -3.899704589251571e-01   -5.149990410939923e-01   +1.621358594039511e-01   -1.779385526272095e-01   -1.184905817741619e-01   +1.313516693991142e-01; -8.355177888829102e-02   +3.171950888992400e-03   +2.341559401320946e-01   -1.092856339173113e-01   -2.994498286475482e-01   -3.831587983426951e-01   +9.151743450361402e-02   +3.393054853582937e-01   -9.119606549848552e-02   +7.512092301298684e-02   +1.547478697590981e-01   +2.966614862982443e-01; -3.384893440436821e-01   -2.253227597407508e-01   +3.673259412149498e-01   -1.224131039037819e-01   +3.025983795160568e-01   +3.648545165791726e-01   +3.577290995307206e-01   +2.985648853788839e-01   +5.588857984638471e-03   -2.021765669443230e-01   -2.042338893013281e-01   +1.801557207429928e-01; -4.119350330776619e-02   -6.916555304847484e-02   -4.360798837708662e-01   -9.013619253873756e-02   -2.673978346076017e-02   -1.414642288914271e-01   +2.509529848420795e-01   +2.405341644187392e-02   +1.202261513651203e-02   +3.055394034262278e-01   -1.216447676298351e-01   +1.359820764665798e-01];
L2E_L3E_iAMPA_netcon = [-2.021801799614232e-01   -1.877530918757180e-01   +9.837827849016439e-02   -7.775889559239663e-02   +4.196746144256724e-01   -2.576501479440279e-01   +1.038750393081862e-01   +2.885857163715602e-01; -2.333676624248019e-01   -1.519735259114310e-02   +3.301564169827764e-01   -1.937317899647213e-01   -4.475512628449204e-01   +1.938518441958472e-01   -1.539573694453966e-01   +1.208087405768513e-02; +4.014784316524601e-02   +1.623150371034163e-01   -2.303303120405873e-01   -9.292534788211215e-02   -5.563492005847327e-02   -4.652243761197142e-02   +3.423748967618017e-01   -1.190844029682958e-01; -3.377312171976361e-01   +5.171838056745697e-01   -1.393518549600797e-01   -2.964317852618524e-01   +1.808267601005808e-01   -2.961149918082919e-01   -1.727096813240354e-01   -6.608735198976282e-02; +3.428205686974036e-01   -3.956571327801946e-02   +4.932988821572272e-02   -1.701431502793704e-01   -6.199903750411168e-02   -3.111371380308571e-01   +1.679953168987314e-02   +3.328678874306440e-01; +1.096415775100735e-01   -1.449083230454207e-01   +1.543633876898145e-01   -2.384081208797343e-01   -1.074765753987529e-01   +1.585365111561958e-01   +2.726382418409343e-01   +1.046985825114125e-01; -1.417347145241606e-01   +5.159447215983197e-01   -2.557938901130172e-02   +2.405701864013610e-01   +2.422784434283805e-01   +1.291452325631386e-01   -2.057099490091718e-01   -1.995072765441592e-01; +9.121053451437688e-02   +5.786270456617539e-01   -2.756733867140954e-01   +5.760805812604486e-02   -1.123509447060002e-01   -1.563271266473591e-01   -4.754530089602994e-02   +3.288416612288991e-01; -2.870940508960198e-01   +1.637545391574075e-01   +3.534558555330699e-01   +4.423740430594734e-01   +1.358147000198014e-01   -7.372050862178431e-02   -4.740199512791271e-02   +5.404211676699761e-02; -2.014253630778085e-01   +1.870456640309975e-01   -3.658526813373004e-01   -3.712118588055606e-01   +2.915091304248812e-02   +2.851423991871019e-01   +6.525523167132957e-01   +3.634672886085091e-02; +2.720525503682691e-01   +9.024032734825910e-03   +2.000214903106098e-01   -2.300091282100124e-01   +1.539978687551721e-01   +1.231375579113383e-01   -2.220615188303416e-01   -3.731591962381027e-01; +1.063966755112020e-01   +1.591782324213279e-01   +1.026347347417437e-01   -3.883873421680461e-01   +1.767953595533746e-01   -1.589383294470180e-01   +9.022304704184761e-02   -4.112526130559449e-02];
L2I_L3I_iGABA_netcon = [+2.550936318884042e-01   -4.319498464303509e-01   +4.515869728659333e-02   +4.273722844653136e-01   -7.384672732416256e-02   -1.914276130976144e-01   +1.871045059521673e-01   +2.129642336319970e-01; +8.292308193983844e-02   +8.143446469897614e-02   +2.072395145228077e-01   +1.915654592692326e-01   +1.939484230474345e-01   +4.211006261447044e-02   -3.561578336626857e-01   -3.865534751488688e-01; -9.010892337707010e-02   +1.876561250230463e-01   -6.171958543295064e-02   +9.618381499571882e-02   +2.969328704716705e-01   +2.496647227299453e-01   +2.971827854845294e-02   -1.759225443025269e-01; +1.223094265991953e-01   +1.621119719179039e-01   -2.182082311017889e-01   +3.601835803592844e-01   -3.947679399061570e-02   +1.790718738096831e-01   +1.526091056563738e-01   +2.971187189452010e-01; -8.030930365618658e-02   -2.745095939750037e-01   +2.825252612962454e-01   -9.513588110621327e-02   +1.102055267561994e-02   +1.276232614108754e-01   -3.633385168150779e-01   -1.058744806758580e-01; -1.571638394049942e-01   +3.209635655316775e-01   -2.697538590011999e-01   +1.497747142177890e-01   +1.306778406923865e-01   +1.206465207281977e-01   -1.642462517678938e-01   +1.745915963227242e-01; +1.904041547358990e-01   +2.223336580734549e-01   -1.827711278492310e-01   -2.936919575457543e-01   -8.964101944751758e-02   +9.327815603349518e-02   -2.185360663551417e-01   +1.829862029306972e-01; -1.066014524919048e-01   -4.565712995622286e-01   +3.592581410129595e-01   -5.809461253923964e-02   -2.234611520883946e-01   +9.292764212301996e-02   +4.053456778381642e-01   -1.849458193987744e-02; -3.479544469977802e-01   +3.316080015703317e-01   +1.144536027656674e-01   +2.363584896343113e-01   +2.549944689631116e-01   -1.043323128894948e-01   -1.924833735430785e-01   +2.308048721303946e-01; +1.728002703935417e-02   +1.293174098271609e-01   +3.215765522214490e-01   +1.912381777086465e-02   -1.340534291475378e-01   +5.294608743103360e-02   -4.906256995296820e-02   +2.906608334496291e-01; -9.381696070897519e-02   -4.188399021266606e-02   +5.190648710925315e-01   -5.880507924211664e-02   -2.163158462604015e-01   +1.485714057330119e-01   -2.417625929632360e-01   -1.663689473601135e-02; +1.848752784213600e-01   -1.506550554803353e-01   -2.470738429613221e-01   +3.649631821129149e-01   -1.237305700949182e-02   -5.575336240456206e-02   -3.963114259894005e-02   -2.743220908912584e-01];
L3I_L3E_iAMPA_netcon = [-3.541335275497954e-01   -1.826489084446916e-01   -7.787661999589010e-02   +1.445706311861851e-01   -8.895367345422907e-02   +5.684804990849002e-03   +2.496456382541088e-01   -2.247667281417975e-01   -3.521315275866153e-01   -1.994699320609728e-01   -7.282953681391140e-02   +2.214397986814675e-01; -3.267904312415930e-01   -2.849820532944388e-01   +1.707243104894876e-02   -2.287385875789803e-01   -1.164880903927318e-01   +3.048435646829931e-01   -3.255675465142558e-01   +6.719410460321296e-02   -1.150877828604333e-02   +8.246347251165592e-02   -1.191986855129353e-01   -2.199837775508665e-02; -3.046852389618208e-01   -1.172437816461136e-01   -1.435999534967670e-01   -4.428494120788032e-02   -3.297859463800426e-02   -1.839302422658989e-01   +2.746052060994140e-01   -1.479301822828460e-02   +3.451503751204462e-01   -1.846464261297426e-01   +5.492151234747730e-02   -1.635181978511984e-01; -2.492642867923935e-01   +2.594946881870385e-01   -7.256896759590081e-02   -1.119947042311920e-02   +6.318854785869313e-03   +2.307369897566525e-01   -3.424779700714969e-01   -1.870198145720082e-01   -5.414052175075162e-01   +2.769376010467364e-01   +1.769426922859757e-01   +2.038422541546218e-01; -2.043133504911159e-01   -2.021850784201006e-01   -1.004455871660032e-01   +5.098817441942066e-01   -1.792051612379318e-01   +1.531283179545448e-01   +2.091950127896050e-01   +3.916438098757644e-02   +1.291060981196124e-01   +5.986541383267394e-02   +1.958536497173294e-01   -1.902719278708945e-01; -2.551798616570008e-01   +8.507585257453003e-02   +8.853568159997405e-02   +5.831304729994243e-02   +5.871495024366384e-01   -2.705119101930797e-01   +2.081821890358352e-01   +7.876107105368718e-02   +9.103874711151722e-02   -5.570816017248653e-02   -4.873715058317873e-01   -1.860744399426636e-01; +1.160784713650635e-01   -4.341194325514375e-02   +6.043284875522432e-02   +3.281308154895601e-02   +1.351792868390569e-01   +1.473538292055837e-02   -8.561887284600039e-02   -1.052142839736969e-01   +6.581945789483347e-02   -1.091971265189371e-01   +3.156113512437798e-01   +7.006782980802845e-02; +5.943434647394334e-01   -4.822033704879911e-02   +5.280315699593341e-02   +3.447949914536488e-02   +1.669838761084877e-01   +1.533201860454589e-01   -3.526149444443026e-01   -5.626261808401584e-02   -5.198978035314884e-01   +3.190202685209343e-01   -8.116890802989070e-02   +1.228162873503246e-01; +1.658444314965430e-01   +3.161662783509359e-01   +6.233391437768142e-02   +1.630476285267393e-01   +1.238047687903175e-01   -2.332212890786663e-01   +1.924654371482509e-03   +1.628787598559522e-01   +3.161890896808852e-01   +8.150221361478729e-02   -1.457815133446977e-01   -3.626712093904124e-01; +2.801569961400259e-01   +1.362991646988858e-01   +3.358232816265925e-01   -1.568899620292223e-02   +2.777682558668045e-02   -3.129966790920765e-01   +2.218317912221831e-01   -4.291691080115015e-01   -3.175816847639129e-01   -2.825748602013414e-01   -1.260767958390279e-01   -1.317079531140879e-01; +9.799842268719974e-02   +1.389095599237301e-01   -1.717385224184139e-01   +4.161417398950050e-01   -2.742159304612286e-01   -1.920591747150714e-01   +6.866673505967646e-02   -9.368602455100061e-02   -3.865336220686813e-01   +2.028685008689537e-01   -2.181781761255580e-01   -7.844946134890274e-02; -1.405749237698246e-01   -5.719195239554493e-02   +2.835133706504952e-01   +1.212161566548947e-01   +4.714854000109819e-03   +1.899008316281108e-01   +2.422373974715544e-01   -3.126094005241130e-01   +1.208315575109145e-01   +4.359906427245612e-01   -1.976752957031508e-01   -2.448877340812853e-01];
L3E_L3I_iGABA_netcon = [+5.023122086191184e-01   -3.194810237580172e-01   +4.728721329474513e-01   -4.153954560304941e-02   +1.629083213146099e-01   +9.863551017552503e-02   +6.759391993877428e-02   +2.666994681739008e-01   -8.425625975045967e-02   -1.458877901893478e-01   +1.064052971747612e-02   -1.495111435718270e-01; -2.500669839991032e-01   -4.260587216015773e-01   -1.048935297500643e-01   +1.653385979434201e-01   -1.478470355007083e-01   -1.034971679608722e-01   +2.510795939785662e-01   -1.732989638020814e-01   +5.868271447569420e-01   -2.244866639587176e-01   -1.608801462065149e-02   -4.344216141445077e-02; -4.630443150557475e-01   -3.280336706721468e-01   -3.313785717239363e-01   -2.009841710161055e-01   +1.354100553590135e-01   +2.572324570445088e-01   -4.145894441951627e-02   +1.249995784784745e-01   -3.811099943029694e-01   -5.442336101086242e-02   -1.611771631817028e-01   +2.937441913068314e-01; -2.746453751153171e-01   -1.531162703153687e-01   -2.657813167858624e-01   +8.617186249985347e-02   +2.476227519647488e-01   -8.423664292938478e-02   -2.387312109934167e-01   -2.869738515018079e-01   -7.590434599062101e-02   -1.022280754594671e-01   +1.488927284451885e-01   -3.252991984870723e-01; +2.365589067709171e-01   +5.909460021867947e-01   +4.248952217148718e-01   +8.970731820954879e-02   -4.820085057990040e-02   +1.105244873583092e-02   -1.809508486170006e-01   -3.494872659255106e-01   +1.758015010267604e-01   -4.116054441644594e-01   -5.860669733423460e-02   +1.479335974006930e-01; -1.312467002304754e-01   -3.999696312120515e-02   +1.742689309784820e-01   +3.368895018548435e-02   -4.252055158125820e-02   +1.397094224376030e-01   -5.169082449493013e-02   +2.373461068791415e-01   +3.033455252189061e-01   +4.499708551098236e-01   +3.386163673399890e-01   +4.494707982359094e-01; -3.191070211756815e-01   +8.750989894326261e-02   +1.011599311629536e-01   -4.372641205952130e-02   +3.036105497787372e-01   -1.194145679179482e-01   -1.247985278386320e-02   +2.672164773078003e-01   -4.992731318777658e-01   -1.834530429466882e-01   +1.699427378190707e-01   +1.175765212586621e-01; -4.310870052216739e-02   -3.035189247270995e-01   +2.590762629688290e-02   -1.214973571786251e-01   -3.433234702338441e-01   +3.840553900382744e-01   +1.052045524659801e-01   +3.452683385082600e-01   -2.876030044928737e-01   +2.570020620184474e-01   -1.098484306595665e-01   -5.296638467300163e-01; +2.234302251482955e-01   +1.882638993768743e-01   -1.607194751585680e-02   -2.378918000889922e-01   -4.670745912114123e-01   -3.544807239557857e-03   +3.295571854652272e-01   +2.268028423978144e-02   -2.265962412036883e-02   -4.773041341026611e-01   -4.435581402174305e-01   +1.037200287374065e-01; +3.622238347834136e-01   -1.892456200941925e-01   -1.651714794534278e-01   +4.714706715381688e-01   -1.384984704673280e-01   -7.076553113800838e-02   -3.897264031378591e-01   +1.225075233904788e-01   -3.883135722055545e-01   +6.662613351722656e-02   +1.702087776472935e-01   +3.500089970127020e-01; -2.750119990363427e-01   +3.109590572067707e-01   +7.072041152407757e-02   -3.002493771491789e-01   -2.701388808403874e-01   +1.844209163807073e-01   -2.363265269136146e-01   +8.763113010533424e-02   -2.010708163864577e-01   +2.542668724772142e-02   -7.056946453863680e-02   -7.727422537736819e-02; +4.906989792523473e-01   +5.062400147805901e-02   -9.751879900046695e-02   +3.758558202530204e-01   +6.694455132014407e-02   -3.742333050036441e-02   -1.741787139007805e-01   +4.956430895967970e-01   -1.671019543697211e-01   +2.207658159261286e-01   +2.691320741155101e-01   -3.442382384571469e-01];
L2E_Input1_iAMPA_netcon = [-3.593122405184815e-01   +4.009478384420136e-01   -1.761526469269258e-01   -9.097157429037964e-02   -4.654151863500217e-02   +1.222657525034002e-02   +2.829435461228796e-03   +2.493327616834435e-01];
L2I_Input2_iAMPA_netcon = [-1.399237576641674e-01   -1.320678171793455e-01   -2.093145985769699e-01   +2.203214085941169e-02   -4.466076072533937e-01   -1.598760952384394e-02   +2.863297753195658e-01   +2.378064750114704e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
