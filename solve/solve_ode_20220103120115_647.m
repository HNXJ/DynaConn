function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.710894890856613e-01   +1.089237841798301e-02   +5.114996002316804e-01   -4.139007668332835e-03   +2.269586552767005e-01   +5.839381837263016e-01   +8.575449205124297e-02   +2.741292720919507e-01   +3.157062085410127e-01   +7.820824107429883e-01   +1.013822535937939e-01   +2.971977540419274e-01   +2.408017741036233e-01   +5.227946930714634e-01   +4.488062369414249e-01   -2.241030579818873e-02; +5.619657137946622e-01   +2.045449250303891e-01   -2.308219333708913e-01   +5.758505713032764e-02   +4.985296112072246e-01   +5.038195723649984e-01   -3.568821412119056e-02   +4.004660152107534e-01   +2.984835867325971e-01   +1.989085826675431e-01   +3.403109196348618e-01   +5.143157787212451e-01   +3.752754874471902e-01   +7.017305103911664e-01   -9.280167539819560e-02   +2.808675788593097e-01; +4.402050903291450e-01   +3.892359003829103e-01   -7.910517170936836e-02   +3.599652562632772e-01   +5.067046536553548e-01   +2.023749139680216e-01   +2.095182363132633e-01   +1.428033959973166e-01   +2.118252643259893e-01   +4.019279141898254e-01   +1.065862609003273e-01   +2.489988756653822e-01   +3.695932058849892e-01   +6.112533961754736e-01   -5.201640283703841e-02   +4.085982315636122e-01; +5.146275197282251e-01   +3.465180800708296e-01   +7.192841607967065e-01   +9.631574765431247e-01   +6.880828936257676e-01   +3.783028168369992e-01   +7.268957028070503e-01   +8.633412025745553e-01   +8.835974544664229e-01   +4.318015078289553e-01   +4.019437035787665e-01   +2.096254687753760e-01   +3.274936925165241e-01   +5.723769681347116e-01   +2.058519315439885e-01   +3.796892735816406e-01; +4.567784307912131e-01   +6.241937146074308e-01   +4.846644596938665e-01   +8.667809804511034e-01   +9.405567741974798e-02   -1.040550571817033e-01   +1.099196488379851e-01   +8.485748146008947e-01   +5.628375430945715e-01   +5.408988417022973e-01   +7.934820113064711e-01   +3.284972041339801e-01   +6.381870433217236e-01   -1.432308533254887e-01   +5.782629923905344e-02   +4.894344910639293e-01; +2.953078209440181e-01   +2.375905960083081e-01   +5.707819149693193e-01   -1.927586470960004e-02   +1.065706751337337e-01   +7.035150457751920e-01   +3.913717080677379e-01   +5.066217032848939e-01   +2.333151795980809e-01   +4.057183889142024e-01   +1.399624542790807e-01   +6.497806012299040e-01   +1.459440299070728e-02   +3.653619433641426e-01   +4.407567369316014e-01   +6.076051592905044e-01; +5.186540136430292e-01   +6.369802751485486e-01   +9.711898848657645e-02   +7.986997890927577e-02   +3.806085506258984e-01   +3.830954301511506e-01   +5.973164495919905e-01   -5.419240028304525e-02   +2.316320277334725e-01   +3.108165748049269e-01   +6.107681920789719e-01   +4.881454086847042e-01   +5.762488107420198e-01   +2.528579029168188e-02   -6.774799784478505e-02   +2.389702723450795e-01; +7.791994713148184e-01   +8.076683266553921e-01   +4.077939627397535e-01   -5.878512545128747e-02   +4.341151450183917e-01   -1.157246342935793e-01   +4.822280002860331e-01   +2.597280614408987e-01   +4.584862607947131e-01   +6.275597310895245e-01   +2.983891306316681e-01   +9.725548332944046e-02   +3.695366904857051e-01   +2.101399284912824e-01   +2.457683702039802e-02   +5.978457268807346e-01; +1.885658968778509e-01   +4.923294323426904e-01   +8.612337182097418e-02   +2.809091336852548e-01   +6.624004891881021e-01   -7.498415722719012e-02   +4.900628405615342e-01   +5.024878024025671e-01   +1.531907156062809e-01   +2.494328322302751e-01   +5.290906490011835e-01   -2.125736542012913e-01   +1.924417823063173e-01   +3.164020695932542e-01   +1.982862997841642e-01   +1.010676196702009e-01; +3.587401147706958e-01   +4.972053309422089e-01   +2.830379133772040e-01   +3.752773027853854e-01   +6.351204282048372e-01   +4.597220441983534e-01   +4.784878986446939e-01   +3.832771004573700e-01   +1.757960935965460e-02   +5.531840677835272e-02   +2.435614513022162e-01   +4.614987638775938e-01   +6.443544771952596e-01   +5.913613693794738e-01   +2.946607433082647e-01   +5.879648849930781e-01; +4.008035232094225e-01   +4.111240195412244e-01   +1.825114415851681e-01   +5.405211248562694e-01   +6.354056806963014e-01   +1.724219391432052e-01   +3.300340426004326e-01   +7.157773157460976e-01   +3.728263503852430e-01   -9.793061646726699e-02   +3.531019300767534e-02   +5.271198902351123e-01   +5.029543492278939e-01   +3.070042206124274e-01   +3.148429878971231e-01   -1.599361019182336e-01; +2.604773850846983e-01   -2.314356198715667e-02   +4.392265972793830e-01   +5.432293731937684e-01   +4.700712996726918e-01   -3.125440111463449e-02   +2.529455283546392e-01   -8.718992788706939e-02   -1.986241100030196e-01   +5.378215627133718e-01   +7.895503849973778e-02   -1.570815112185059e-01   +6.565895376868630e-01   +6.037193767674119e-01   +1.191382133635266e-01   +3.952514684042225e-01; +2.231511748679212e-01   +1.674892201823676e-01   +1.000000000000000e+00   +7.186175263811884e-01   +5.915618504950707e-01   +7.775620157114830e-01   +3.493062272634845e-01   +2.847937255411732e-01   +7.810655057718088e-02   +2.647014951766939e-01   +2.711574156150285e-01   +5.546288642197585e-01   +4.060831783210256e-01   +4.020696503472202e-01   +4.787826089633760e-01   +4.145822643972555e-01; +5.466903297838567e-01   +6.906234543224357e-01   +6.664746740470971e-01   +5.668527981075298e-01   +7.377456460197709e-01   +4.546742430656799e-01   +2.106347743704743e-01   +2.437984188505649e-01   +4.590121967542404e-01   -1.072515994710447e-01   +3.434221700488583e-01   +1.734393739059610e-01   +1.554185748968604e-01   -8.406327662673205e-02   -1.935191333914139e-02   +1.525506140998009e-01; -2.266283871322048e-02   +4.277591325669755e-01   +2.990017395334286e-01   +3.993983517013526e-01   +5.219708401008463e-01   +7.654899467443746e-01   -1.442085374636227e-02   +1.703731046652083e-01   -1.856632794254454e-01   +4.380721395719308e-01   +6.108272074657617e-01   +7.566524723206075e-01   +5.469770385043624e-01   +7.879018338244396e-01   +4.551990855205206e-01   +2.439217494841099e-01; +6.016632369894019e-01   +2.281356804836485e-01   -2.450870864864368e-01   +1.369548880748725e-01   +6.151940130712389e-01   +3.026561470827011e-01   -1.006061838380143e-01   +1.079079461423924e-01   +3.093451153279342e-01   +3.492064360848298e-01   +4.531035221774676e-01   +3.038999288857780e-01   +5.891003887024148e-01   -2.031146570056472e-01   +5.582705791146920e-01   +4.231869970367769e-01];
L1E_L1I_iGABA_netcon = [+4.811192465129367e-01   +6.865799172451182e-01   +7.097550319473704e-01   -8.161231708536203e-03   +1.606003757686041e-04   -7.552785337575225e-02   +4.165386321505687e-01   +7.035805160473689e-02   +5.902753567690453e-01   +5.363401434524362e-01   +5.530082766882074e-01   +3.945643785421729e-01   +7.044113910689190e-01   +3.123727697759677e-01   +4.473010288088808e-01   +2.903018604535920e-01; +3.365529376772600e-02   +2.082082750851548e-01   +3.280173008104900e-02   +2.026895782188533e-01   +2.254535531282212e-01   +2.686312682777827e-01   +2.478107483732920e-01   -1.880130524423633e-01   +7.848517595928535e-01   +4.518828847096216e-01   +4.982351416926697e-01   +1.793415390952495e-02   +2.688107969601095e-01   +2.679244435823804e-01   +4.179174158336995e-01   +3.494465921310778e-01; +5.865662649104418e-01   +4.328064053200296e-01   +4.340288115010538e-01   +3.925313048297557e-02   +6.350200616585990e-01   +7.987975659055625e-01   +1.935786593677298e-01   +2.644353361086327e-01   +3.973496954621391e-01   +8.083058818142087e-02   +7.378586135104332e-01   +5.984357504305380e-01   +7.042825101939966e-01   +1.721420013247207e-01   +5.218575597946450e-01   +6.313409884064649e-01; +5.822935148388791e-02   -7.189303835519512e-02   +1.225151223388359e-01   +5.387002953124574e-01   +7.086798597337406e-01   +3.746644669055162e-01   +7.563619687820982e-01   +4.419053381325930e-01   +4.737446866345277e-01   +8.701932974843501e-01   +1.978079144961175e-01   +2.882598095190715e-01   +6.598166412465908e-01   +2.501924777879902e-03   +5.526554726293939e-01   +5.425507526454618e-01; +8.284579233162551e-02   +2.963118360419610e-01   -1.535992952842596e-01   +2.370825194800627e-01   +2.349099906254195e-01   +4.282735274904289e-01   +6.410462909641167e-01   +6.598019471873871e-01   +3.145241093831885e-01   +4.483318852803304e-01   +3.085236057421895e-01   +6.167428307171157e-01   +2.328049320189849e-01   +3.753080358826198e-01   +4.584012496352643e-01   +2.864371060599279e-01; +5.968279728067015e-01   +4.331315879284100e-01   +2.839938743029466e-01   +6.352558414002164e-02   +2.821042634301054e-01   +1.433508383885310e-01   +3.106940847019670e-01   +3.608122980744591e-01   -7.721573958221077e-02   +6.363315450953848e-01   +3.530641030749166e-01   +2.668572735015744e-01   +1.371801035805234e-01   +3.863033162427047e-01   +3.884855146802963e-01   +6.095327485451261e-01; +6.870538988768354e-02   +6.036598640126841e-01   +1.390965461684140e-01   +2.182004949976483e-01   +1.482179951824933e-01   -4.163758869313162e-01   +7.864548404259224e-01   +5.392633155206370e-01   +2.640488630620408e-01   -2.094146726243287e-01   +2.686761982641240e-01   +2.837528768522120e-02   +3.056292243290735e-01   +5.474306387172954e-01   +6.284157662556874e-01   +3.797223650558238e-01; +4.155985621983663e-01   +7.683788490280240e-01   +6.948855121116561e-01   +2.473402249485507e-01   +3.612676802030742e-01   +5.725385527601492e-01   +1.005054276737061e-02   -5.160231589456143e-02   +3.741841201071939e-01   +4.287472776902407e-01   +7.457065864525180e-01   +5.256047239935573e-02   +4.865209151526567e-01   +7.249151986385305e-01   +4.885041535390576e-01   +1.433148610370044e-01; +6.343886869132329e-02   +1.891272132232484e-01   +4.840460420595338e-01   +5.132624557206833e-01   +7.292887199404201e-01   +2.811621001197905e-01   +6.640498731149604e-01   +7.103119449112127e-02   +4.846285742446682e-01   +1.775084821894193e-01   -9.547662434913148e-02   +3.653487303176898e-01   +4.047099548274107e-01   +6.561581059865136e-01   +4.241777889063948e-01   +2.136435597163014e-01; +1.310861330623284e-01   +7.232503893678920e-01   +4.710868767661885e-01   +9.202871855483820e-02   +2.720508368952779e-01   +5.396112144851891e-01   +2.561302009054564e-01   +5.571332111534252e-02   +2.554878413358976e-01   +4.244806842533431e-01   +3.193106153721187e-01   +6.904563451919203e-01   +4.871261704516877e-01   +2.402791346611432e-01   +4.875587698357060e-01   +1.258644195440443e-01; +2.511257700811957e-02   +5.586057738202701e-01   +8.333238516471992e-01   +7.204125766145724e-01   +5.155836137627494e-01   +8.156564317066446e-02   +1.851027254592356e-01   +6.071140368311297e-01   +6.514192199556367e-01   +4.302116429457085e-01   +6.210361871694620e-01   +3.175066571231808e-01   +1.840324990629799e-01   +5.590142601041909e-01   +9.478351923888637e-02   +6.167836890219263e-01; +7.120312804131949e-01   +4.142942370988301e-02   +5.370584101557878e-02   +5.697873811494636e-01   +6.831657395180051e-01   +2.539184936168857e-01   +3.237492722128865e-01   +3.939295450442364e-01   -6.076638346117647e-02   +2.205601468593985e-01   +4.757644095521902e-01   +4.469681145246712e-01   -3.219987211539082e-02   +1.531381929532389e-01   +2.914524594884441e-01   +5.800447244382825e-01; +4.222864204366406e-01   +6.749668746320693e-01   +6.850601898549622e-01   +1.813877435038036e-01   +3.322760183244040e-01   +9.250384903585572e-01   +2.371783810084217e-01   +5.713844364131898e-01   +4.766246689550349e-01   +5.193630874229956e-01   +7.852738700104797e-01   +2.352272438788127e-02   +7.235612005338266e-01   +2.094857784368728e-01   +9.440406149032764e-02   +4.675092281505729e-01; +4.497690880253172e-01   +3.499172915059564e-01   +3.819274521890431e-01   +7.722972250697604e-01   +8.851220749070350e-01   +7.352761942355618e-01   +7.470492213073204e-01   -3.728492589019804e-02   +1.168482892832211e-01   +3.622902585019486e-01   +1.196391391569830e-01   +6.168338921710051e-01   +4.904994685406746e-01   +4.248114899825485e-01   +5.086111927425240e-01   +4.271279472655162e-01; +7.446037497556637e-01   +9.403370124827610e-01   +1.394110453421323e-01   -9.985209835565818e-02   +5.089882258344173e-01   +2.580851221782049e-01   +3.949200696152425e-01   +1.846380314181103e-01   +6.522718017445734e-01   -1.587668214981139e-01   +5.265223725352675e-01   +4.068811273284058e-01   +6.660047184952451e-01   -2.717848817043947e-01   +2.099869181604430e-01   -2.745041055030435e-01; -1.170888354674374e-01   +2.886149204815496e-01   +7.019647672635381e-01   -3.066386693937836e-02   +1.580473383647874e-01   +5.727310432845392e-01   +1.325709427977585e-01   +8.073389645002016e-01   +5.505185032622210e-01   +9.687542355663985e-02   +2.754884304335415e-01   +7.701966884513769e-01   -2.771646724273021e-02   -3.918389536474973e-02   +7.400262191252750e-02   +1.854862127378926e-01];
L2I_L1I_iGABA_netcon = [+3.423223139938267e-01   +1.396800340467845e-01   +7.914735256867151e-01   +8.038198764075150e-02   +7.406876618325479e-01   +5.339180143359157e-01   +7.426831048970173e-01   +9.488019923021950e-01; +1.679346454114852e-01   +2.511049021918241e-01   +4.265961498776339e-01   +2.253901796146561e-01   +5.804736845732195e-01   -6.711356619387980e-03   +2.546400789240885e-01   +6.131828116906494e-02; +6.413989659867882e-01   +4.395004091453757e-01   -1.147478852896985e-01   +2.296535476794705e-01   +5.593067671919403e-01   +1.644485829822128e-01   +5.588349036509277e-01   +4.135764738693349e-01; +5.206524225864815e-01   +5.759863253387617e-01   +1.552346375403913e-01   +5.259216370247981e-01   +2.996752124689532e-01   +1.880676220101821e-01   -5.256955780774435e-02   +5.211063544296515e-02; +2.593327259934394e-01   +4.880426236959148e-01   -2.881850850296918e-02   +8.225390181248644e-02   +6.303403296355190e-01   +2.035642374368263e-01   +5.322581234379412e-01   +5.187900959983499e-01; +5.392233414631390e-01   +5.605218438002315e-01   +4.149035622047913e-01   +5.377852287716908e-01   +4.520417854079674e-01   +3.557702418129691e-02   +5.986235461056811e-01   +9.456643350603500e-02; +2.535803150628902e-01   +5.506986913780252e-01   +4.892296323566943e-01   +6.909094352798367e-01   +5.203410006144765e-02   +1.696404348829149e-01   +2.426002461775911e-01   +4.521251641810865e-01; +5.057644206692078e-01   +2.727223549604139e-01   -1.353487114618433e-01   +2.803096840563939e-01   +1.157097526199998e-01   +5.350646956409463e-01   +2.737324723167502e-01   +3.099190057507108e-01; +2.481727922543415e-01   +2.434869621729071e-01   +7.395716586678108e-01   +3.525187864445863e-01   +2.794614769289663e-01   +9.072752837277563e-01   +3.438484149243756e-01   +8.510754866954900e-01; +5.655705779570757e-01   +3.268600217151008e-01   +4.421818857922137e-02   -3.441695894073509e-02   +5.573881607537489e-01   -2.127408597338443e-01   +2.554221991894946e-01   +2.775055010085228e-01; +3.306963571563816e-01   +4.970383873886203e-01   +3.125640970382801e-01   +8.887609804967967e-01   +1.272056187127329e-01   +4.632088877186374e-01   +1.000000000000000e+00   +6.837726371320327e-01; +5.370484344749736e-01   +8.967744441472498e-01   -1.201989948997426e-01   +9.591520238454844e-02   +2.719354361333893e-01   +5.323833690701670e-01   +4.905985968167803e-01   +2.264595032085818e-01; +9.373299079134371e-01   +2.423611515716717e-01   +6.201998174650677e-01   +8.059845675205282e-02   +4.380816894230415e-01   +4.529437832954238e-02   +6.163260056176080e-01   +8.797970359499808e-02; +6.726205402952798e-01   +3.090008675450757e-01   +4.579508051553819e-01   +1.102335991470428e-01   +2.580948285243469e-01   +4.686972078030630e-01   +9.789540128911594e-03   +1.394366021727083e-01; -1.123503370143276e-01   +7.259702477090602e-01   +6.827719250110249e-01   +2.860370569974541e-01   +2.590184958409640e-01   +5.507735516312798e-01   +9.595585479488863e-02   +3.880451685783370e-01; +1.454658749324150e-01   +6.215820730098326e-01   +3.189368325662050e-01   +4.711412067906999e-01   +2.200240726111105e-01   +3.773503377613400e-01   +3.194469206152206e-01   +4.748429977214981e-02];
L1I_L2I_iGABA_netcon = [+2.437814928221946e-01   +4.673876638479016e-01   +2.746953046854920e-01   +3.508619075183690e-01   +7.347136145975787e-01   -5.172130677962738e-02   +6.125336966863166e-01   +3.356847640103950e-02   +3.715559757172045e-01   +5.455653679112846e-01   +3.411025038988267e-01   +4.868901996745330e-01   +6.237942668981906e-01   +2.940706568100563e-01   +6.885717964161089e-02   +5.765553535718716e-01; +7.375706747172270e-01   +4.600334805081286e-01   +6.460208635307203e-01   +5.226964599617465e-01   +6.524382189988600e-01   +9.771333359909745e-01   +4.899617399437166e-01   +2.326102661591654e-01   +5.970700187753952e-01   -4.074772102246269e-02   -1.224466625055345e-02   +7.331863813421040e-01   +5.614653451663102e-01   +2.091734201138315e-01   +5.352068928535701e-01   +9.188147961840475e-01; +3.178740930068644e-01   +1.517146576893238e-02   +5.038741865505802e-01   +4.675207179745023e-01   +4.354764935874231e-01   +7.381694765828508e-01   +4.215080603843965e-01   +4.932371120596498e-01   +4.737420104849713e-01   +4.257357213767421e-01   -5.016180319325893e-02   +3.476677292920027e-01   +3.035197305730389e-02   +7.987071827191052e-01   +3.849547828039949e-01   +1.763935948875843e-01; -1.421323946067172e-01   +6.443616956114325e-01   +4.808710301519731e-01   -1.571467352405637e-01   +4.649508646434103e-01   +3.935842153486477e-01   +9.531773291130473e-01   +3.629602347856568e-01   +7.960275993742187e-01   +1.693348980913659e-02   +2.575494478113650e-01   +7.703276724578043e-01   +3.651200603427478e-01   +4.988839689614974e-01   +7.875174241322952e-01   +6.539114443759759e-01; +4.857405592137882e-01   +6.951605071811352e-01   +4.466938957219963e-01   +4.340997978603792e-01   +5.457745948813715e-03   +1.704567279351631e-01   +6.742901643708543e-01   -6.200338511110531e-02   -6.817317303026917e-02   +5.312838545550320e-01   +5.074358645218752e-01   +5.664679305264381e-01   +8.800384225373885e-02   +4.544757765269924e-02   +5.537527940908834e-01   +7.151368861200098e-01; +7.844597126267848e-01   +4.571245030070647e-01   +3.666328503142256e-01   -1.974068876344191e-01   +2.408083677253763e-01   +1.016439840806244e-01   +7.376263099769317e-01   +3.096985113626727e-01   +1.952154228580474e-01   +8.077481018418775e-01   +9.296694079680120e-01   +1.125665998619126e-02   +1.557852376705166e-01   +5.409894454536237e-01   +3.544890661524254e-01   +3.808457560890693e-01; +1.701100379287302e-01   +6.304457760886567e-01   +6.212685586627167e-01   +2.914182521490357e-01   +3.851666246213930e-01   +8.669466888259931e-01   +5.444515599910270e-01   +7.652266311291513e-02   +1.188157840631393e-01   +1.781900543706336e-02   +4.567404837633014e-01   +1.604780938136826e-01   +7.352226689891634e-01   +8.291440443576488e-01   +1.782714225699121e-01   +6.222021415897563e-01; +2.788318448251523e-01   +6.626198893938948e-01   +4.775002991869911e-01   +7.987413873383677e-01   +6.108833403392909e-01   +4.072897691260586e-01   +4.808671943984952e-01   -6.727208897236919e-02   -1.721419170296642e-02   +2.269678612748278e-01   +1.522914893932248e-01   +3.959574002001584e-01   +1.142218451849702e-01   +7.138392251905292e-01   +4.997549587982468e-01   +5.455492162100568e-01];
L2E_L1E_iAMPA_netcon = [-1.826670637487706e-02   +2.003942599273758e-01   +6.761577644771485e-01   +5.316077845855849e-01   +5.970996481873408e-01   +2.850691034181803e-01   +5.212797733871101e-01   +8.593140971173564e-01; +6.472903214263415e-01   +2.416745353780806e-01   +2.272246954274287e-01   +3.667220142178234e-01   +3.156286854514822e-01   +3.958820609220083e-01   +1.189355655296431e-01   +4.129415888346067e-01; +2.103446100057726e-01   +2.701071267260088e-01   +4.928936983464948e-01   +1.000000000000000e+00   +2.236977768714318e-01   +4.410098920828738e-01   -2.195373902101378e-01   +7.051935717760869e-01; +2.564593078155608e-01   +1.161004240741701e-01   +4.077905719419803e-01   +5.846791787431598e-01   +5.554440786762873e-01   +2.926597985353734e-01   +5.670997076845181e-01   +4.513856397038631e-01; +8.704380438172019e-01   +6.499027894050154e-01   +2.868153220112360e-01   +1.385648628567634e-01   +3.400821753227493e-01   +3.384630896435294e-01   +2.793918193816721e-01   +3.012670786881725e-01; +6.718388765969125e-01   +2.445267020798001e-01   +7.699110623904873e-01   +8.203501731130796e-01   +7.202376381554966e-01   +5.873694843688407e-01   +5.209752602695582e-01   +8.521147563644094e-01; +5.808948888866041e-01   +3.028933994658911e-01   +1.925495694786005e-01   -4.247205532270114e-02   +6.360450311731435e-01   +4.310085051879471e-01   +1.733606564654415e-01   +8.211898454463025e-01; +6.821555467859378e-01   +4.660564917909144e-01   +3.177705210741040e-01   +3.279054927141389e-01   +3.717732843987755e-02   -1.321789754911848e-01   +4.320208404894063e-01   +8.048103070143789e-01; +1.232841300395832e-01   +1.680946516724191e-01   +3.003804694758426e-01   +1.729566114325615e-01   +6.549940187614856e-01   +6.348832626999839e-01   +2.862039233437358e-01   -6.530095920921952e-02; +3.729653265227786e-01   +3.218457946595464e-01   +3.894100962037216e-01   +6.958552024422988e-01   +4.215418520134538e-01   -1.877965559979590e-01   +8.912034987955929e-01   -6.133383221546434e-03; -3.328776249352758e-02   +7.377927070213235e-02   +3.822445889931685e-01   +5.757237249846076e-01   +2.213696234033332e-01   +5.013224286915940e-01   +7.565900470375380e-01   +3.661260827681810e-01; +7.844593931677093e-01   +1.785791974866229e-01   +9.288068646609178e-02   +7.455884711908379e-01   +5.385834791462154e-01   +1.668453363257250e-01   +3.459752446540671e-01   +6.248838214661838e-01; +1.090951789539229e-01   +5.388883742934447e-01   +3.629469112763696e-01   +2.627649846282213e-01   +4.384988092293269e-01   +3.658059562009672e-01   +3.739366982806931e-02   +3.412263716070718e-01; +2.056018206182362e-02   +6.348359913080990e-01   +6.842260779386412e-01   +5.213445301916507e-01   +3.052231253593017e-01   +5.100984013091118e-01   +2.309976499240724e-01   +7.538474876140872e-01; +3.604471174698843e-01   +3.001187200177641e-01   +4.238984561222398e-01   +7.128667532274011e-01   +6.520282885060673e-01   +4.843634159270535e-01   +5.013009985974852e-01   +6.853580114997795e-01; +3.583011313430542e-01   +2.250441136849954e-01   +2.547640720008445e-01   +3.298784781085580e-01   +7.573454875681079e-01   +1.642668736910703e-01   -3.796277794768151e-02   +1.769870744248978e-01];
L1E_L2E_iAMPA_netcon = [+4.568960280319606e-01   +5.626148363692048e-01   +2.747071724536434e-01   +5.732590668576780e-01   -8.118372337545386e-02   +4.077500792911251e-01   +1.303794821533040e-01   +6.969595189864253e-01   +7.691574433958278e-01   +2.460402965724378e-01   +4.438351729584639e-01   +6.763925566597671e-01   +5.728573705240673e-01   +2.501838494786725e-01   -5.010328845259823e-02   +6.590009394596235e-01; +4.005661266517277e-01   +5.288908695261006e-01   +8.531423051184380e-01   +6.039983993533460e-01   +4.973535656919290e-01   +5.712606298633855e-01   +4.013553326889454e-01   -2.670591059272980e-01   +2.169646187515656e-01   +6.164911879110573e-01   +1.575923929979467e-01   -9.844362177813079e-02   +4.716381410673181e-01   +6.916916060082694e-02   +1.574920914636266e-01   +1.777410949683215e-01; +1.330707497230716e-01   +3.879338374205471e-01   +6.404073936205664e-01   +7.332511844290959e-01   -2.520121956409652e-01   +2.219441950008258e-01   +5.809829266621278e-02   +1.026767820060460e-01   +3.269378770993477e-01   +2.157818744169446e-01   +8.528419288521082e-01   +5.261762913868988e-01   +3.401381624626702e-01   +6.187890974495558e-01   +6.362785374996498e-01   +3.972126419772333e-01; -2.841040810223001e-02   +6.276087628181816e-01   +3.845830525858721e-01   +5.382516450406523e-01   -1.247102239810277e-01   +5.371317193209636e-01   +5.697709645144007e-02   +1.548834821135765e-01   +2.746066324315705e-01   +4.111616197848417e-01   +5.239822562154436e-01   +2.602180333701857e-01   +3.230190462572933e-01   +4.006958844550947e-01   +2.473724352624840e-01   +6.918271252257872e-02; +1.513108623365886e-01   +6.746933294223898e-01   +6.927353316572218e-01   +1.264156353561778e-01   +3.203637402739220e-01   +6.859449663246748e-01   +4.308596845431539e-01   +2.155012269789380e-01   +5.046155204787539e-01   +6.210382686951484e-01   +9.700344616130528e-01   -5.130142698819751e-02   +7.372497148696101e-01   +7.731517280715356e-01   +1.915963187037806e-01   +1.865202055608160e-01; +3.010955688791275e-01   +1.293251715461157e-01   +4.177769142444410e-01   +5.022649627068132e-01   +3.591274962935293e-01   +4.042351993043617e-01   +7.315309413600014e-01   +2.323271098126603e-01   +9.610767807284397e-02   +5.574092533358355e-01   +1.662431002000369e-01   +4.846873432098851e-01   +3.764034441129489e-01   +3.419290578285612e-01   +6.231437387505232e-01   +6.126282247133651e-01; +4.936907915056404e-01   +2.821996009550498e-01   +4.083354714610124e-01   +4.958967094525120e-01   +3.135901267353828e-01   +2.139758750245305e-01   +8.650110268732069e-01   +7.624565635414300e-01   +2.482690505833223e-01   +4.607971169679067e-01   +6.297735323653834e-01   +6.125099853701476e-01   +6.381266760188017e-02   +4.383465664725954e-01   +4.144588878117952e-01   +2.031333438269372e-01; +4.925220046025819e-01   +5.669658243221055e-01   +4.391226027826396e-01   +1.107137682158676e-02   +7.060931564239734e-01   +3.179593691094449e-01   +3.842377425685948e-01   +4.711381649784133e-01   +3.447363846689484e-01   +2.776732767409579e-01   +4.280666987212994e-01   +2.159089700864845e-01   +1.493669012138782e-02   -1.134543045795827e-01   +3.516292034090536e-01   +3.449786094693816e-01];
L2I_L2E_iAMPA_netcon = [+2.843146551766390e-01   +7.863616954029130e-01   +6.993989529708997e-01   +5.516155963356972e-01   +3.872308922183721e-01   -8.212271351221184e-03   +8.157897497625797e-01   +7.678315508338924e-01; +6.420713120950845e-01   +8.816012815675420e-01   +1.994037489185804e-01   -1.368578297216338e-01   +5.261572293708309e-01   -1.548140747248742e-01   +1.123356070128156e-01   +3.447959529046918e-01; +7.789593933927185e-01   +5.546843160825913e-01   +7.220309844941718e-01   +2.142553530829501e-01   +3.646935092667704e-01   +7.789750355166662e-01   +3.962696794412630e-02   +3.021757397682577e-01; +4.507183856286139e-01   +6.946765548717841e-01   +3.491970621054681e-01   +6.283833141531796e-02   +5.651579016001838e-01   +8.186111638005148e-01   +6.671772451042320e-01   +6.289393293732074e-01; +8.688375873378765e-01   +1.947441476567190e-01   +4.431247631096569e-01   +7.828562535555977e-02   +3.100605049816666e-01   +8.222816587158157e-01   +5.444101387636523e-01   +3.497292576763562e-01; +1.074044662236340e-02   +2.246216854992715e-01   +3.106963154900444e-03   +3.547355131066757e-01   -4.243787786446590e-02   +7.959810804527966e-01   +7.744778127159023e-01   +1.859474956130725e-01; +9.261570116503240e-01   +2.843261429748759e-01   +4.421455549737780e-01   +5.409079117434931e-02   +1.936870829411038e-01   +1.123521280403854e-01   +5.849929069557497e-01   +4.686501168833473e-01; +1.155378627843839e-01   +3.259443268475208e-01   +4.357314261150920e-01   -1.109715191607927e-02   +7.011745729819122e-01   +6.700276455989813e-01   +1.452904671327710e-01   +9.739421000367375e-02];
L2E_L2I_iGABA_netcon = [+7.561904063359145e-01   +7.052710382662063e-01   +7.640363733872512e-01   +6.521356748169095e-01   +3.737264485186177e-01   +9.714540702870633e-02   +3.476666174105287e-01   +2.674685098342059e-01; +5.029480645543417e-01   +1.000000000000000e+00   +8.528871597073947e-01   +8.881653366962838e-01   +2.179157763330033e-01   +4.024311983469560e-01   +3.321337715322503e-03   +7.523662825395617e-01; +1.011148409337238e-01   +7.437036546971785e-01   +7.818900271270847e-01   +8.087431521834370e-01   +5.347474008618658e-01   +1.543227879685129e-02   +7.412973475588416e-01   +1.344442879209392e-01; +4.426838743085275e-01   +3.674530384336640e-01   +8.130850729840424e-01   +1.673399453580058e-01   +5.415893698551096e-01   +4.414130014245335e-01   +4.539485336991194e-01   -1.834933811863103e-01; +4.980251920976895e-01   +9.530194951013231e-01   +5.901234197411249e-01   +5.254705805467710e-01   +5.381776181019656e-01   +3.442842600789287e-01   +7.923759357470579e-01   +2.657382811397720e-02; -3.623854709073616e-02   +9.708069523633583e-02   -1.779583659150387e-01   +2.906394574994781e-01   +7.131367094006209e-01   +3.775927720007151e-01   +4.983718853557800e-01   +2.226702809426855e-01; +4.465819361902726e-01   +8.158483771892056e-01   +1.602670015470837e-01   +4.218821505695503e-01   +4.997552346860984e-01   +9.708716749678642e-01   +5.259773773045715e-01   +8.071654727718590e-01; +3.818516951359371e-01   +3.495724111015674e-01   +3.459762030061096e-01   +8.057288968403012e-01   +3.568207451363499e-01   +3.958189829880709e-01   +1.561917822315090e-01   +8.744201530182030e-02];
L3E_L2E_iAMPA_netcon = [+2.653722778687799e-01   +1.513319870143744e-01   +5.300074530770800e-01   +3.157730177671916e-01   +6.164108894765370e-01   +4.233136882073843e-01   +5.366411048124398e-01   +4.873196933211120e-01   +1.187835771394613e-01   +5.771243637113980e-01   +1.000000000000000e+00   +5.346732382065202e-01; +2.790448218529478e-01   +2.586868495271655e-01   +6.054743320025943e-01   +2.622605015635724e-01   +3.028237585605288e-01   +2.621946664916712e-01   +1.755910195136711e-01   +8.153092796048147e-01   +1.972168183201379e-01   +4.877422275732044e-01   +4.240596612110257e-01   -3.933670681181151e-02; +5.053588534173821e-02   +5.795552866140822e-02   -1.067685232454798e-01   +4.508798179490407e-01   +4.588646128603164e-02   +4.391934465349017e-01   +1.968097688771349e-01   +2.451910300714586e-01   +6.191811178851828e-02   +1.317869188079765e-01   +1.626765783444687e-01   +3.187437200347878e-01; +4.388190969275773e-01   +3.607609068388298e-01   +6.669853803087709e-02   +4.479172527344243e-01   +4.522749197048824e-01   +8.512841346459794e-02   +2.895346044599307e-01   +1.054282982806243e-01   +5.739893876601704e-01   +1.134286377914452e-01   +3.388453898221610e-01   +5.330567936608342e-01; +6.106912258993347e-01   -3.718523204125299e-02   +5.467577388347694e-01   +5.057563595318261e-01   +4.377496448713860e-01   +8.041784777669201e-01   +4.623766066746438e-01   +5.404109520381122e-01   +7.636641694601189e-02   +7.777099952325124e-01   +4.687959132272910e-01   +2.663882845804895e-01; +5.941380348016406e-01   +5.470746085930354e-01   -9.477643071964664e-02   +5.288347881373943e-01   +2.703114310147231e-01   +5.963946940523996e-01   +5.164106920697255e-01   -2.026924900783439e-01   +1.199880783720393e-01   +6.220499873982103e-01   +1.341355680004999e-01   +4.808498139783615e-01; +7.418611579063344e-02   +4.023297799418819e-01   +3.447992336381010e-01   -9.334901382059964e-02   +9.714833595533335e-01   +6.023130293858892e-02   +4.174028600625859e-01   +6.316219531863513e-01   +1.022660334698700e-01   +3.316438639897281e-01   +8.096124053451395e-02   +6.312322042651342e-01; +2.007197234177932e-01   +1.247440333273787e-01   +1.992340243914274e-02   +1.352732815266703e-01   +5.877534026845644e-01   -1.799880393757265e-02   +5.048788408417979e-01   +9.091205683501967e-02   +2.690049373526171e-01   +3.191537920724370e-01   +4.451803961681630e-01   +9.709143477582099e-03];
L3I_L2I_iGABA_netcon = [+7.688224975530772e-01   +4.475430603065542e-01   +5.981472772917468e-01   +2.127126297102062e-01   +1.773708372197447e-01   +5.144998575434513e-01   +5.532120757266894e-01   +2.085942110169507e-01   +3.250538499179931e-01   +3.755502066027543e-01   +5.654942228385486e-01   +7.765539899116326e-01; +3.422210879626327e-01   -3.669377345175038e-01   -1.218610289133941e-01   +6.903906948793544e-01   +3.236396753626494e-01   +5.892506001524713e-01   +4.291046053635382e-01   +2.319875286501284e-01   +7.141625633932015e-01   -7.586439323721880e-03   +6.454562690893566e-01   +3.256272837117078e-01; +2.073745950903187e-01   +4.909773637435209e-01   +7.768360703722849e-01   +6.698350060744850e-01   +7.113047166207025e-02   +3.717138739367246e-01   +1.445851007915979e-01   +6.051759102128292e-01   +5.362720849651968e-01   +4.184592926913941e-01   +7.197616278396793e-01   +8.781032763005594e-01; -1.725846361899089e-01   +3.445459125828420e-01   +9.424423363687519e-01   +3.866944050087030e-01   +5.066143993250098e-01   +5.866993244978885e-01   +1.059483580877446e-01   +3.919319106423032e-01   +7.232442805644763e-02   +2.507121936844069e-01   +2.928702763795135e-03   +1.136281449733329e-01; +2.256353607751072e-01   +4.500487137349504e-01   +1.583805729469672e-01   -9.475698269314563e-03   +2.945137284323385e-01   +2.322548993358750e-01   +1.259084700538266e-01   +2.798386912298174e-01   +3.565330487126079e-01   +6.693118605571717e-01   +8.954684166442239e-01   +7.470494073694397e-01; -1.244637106786143e-01   +7.106437298549156e-01   +3.460260582139064e-02   +5.218848788733332e-01   +2.030256076742959e-01   +1.002236722701343e-01   -1.272566860143499e-01   +2.392161408042038e-01   +2.100365377230671e-01   +6.874536444462093e-01   +6.739258822527063e-01   +7.298587814393890e-01; +5.645198323234588e-01   +5.269389300873206e-01   +6.641846634208096e-01   +3.837839553662017e-01   +5.674901033687004e-01   +3.322865852958347e-01   +3.869201371975849e-01   +3.818050337058610e-01   +1.810048237144955e-01   +7.326333585170856e-01   +2.543719085780743e-01   +4.543696030287425e-01; +4.342172800547439e-01   +8.846103438307116e-01   +3.137370578070394e-01   +8.815515474052230e-02   +3.157054801731832e-01   -1.716883155787795e-01   +1.000000000000000e+00   +5.719980560431644e-01   +7.392084930792591e-01   +6.118682128061714e-01   +3.243887852389803e-01   +7.547720128754525e-01];
L2E_L3E_iAMPA_netcon = [+7.057426741379455e-02   +2.820572372276699e-01   +2.824510864601185e-01   +4.459363297372249e-01   +6.198050889604398e-01   +3.298988862796934e-01   +2.215942855041411e-01   +1.690843421952113e-01; +5.855187803125123e-01   +7.218231710690970e-01   +1.254224820777738e-01   +5.417782596860533e-01   +9.695417541120378e-02   +5.831455057367473e-01   +5.918214212296476e-02   +5.812118273780567e-01; +7.705189184641998e-01   +4.284904132260818e-01   +1.391265561850629e-01   -2.483325121841894e-02   +7.440445061074820e-01   +1.831082486603119e-02   +2.689794200673153e-01   +2.892733188380410e-01; +3.631123925983229e-01   +7.261172380169384e-01   +4.844247723510084e-01   +4.132384542966615e-01   +6.182706291919779e-01   +3.792333892439860e-01   +3.022477047044557e-01   +6.326826000129014e-01; +2.486439553539176e-01   -1.039961143664956e-01   +6.306914010376192e-01   +4.947779891055877e-01   +4.364640454153513e-01   +1.430205199738342e-01   +7.664832973764947e-01   +2.444388222555414e-01; +3.877403210914493e-01   +5.530207928158059e-01   +2.295105721006438e-01   +9.390097091761707e-01   +1.534850321775402e-01   +6.569995555576215e-01   +2.997121658303082e-01   +5.672978543151315e-01; -3.952681029758231e-01   +3.620671151032027e-01   +4.431397847694108e-01   +3.587218455838370e-01   +1.498142165491375e-01   +4.672276292664303e-02   +8.912538825720002e-01   +5.953530891146267e-01; +1.496916327177696e-01   +8.735773698486773e-01   +2.700983327875104e-01   +1.470672963607372e-01   +4.138993779657285e-01   +4.693455998192048e-01   +7.336302464254287e-01   +3.098322977653392e-02; +6.886212745761320e-01   +8.537793691014076e-01   +5.780745852578184e-01   +7.787903669712489e-01   +1.351255697089790e-01   +5.113875613197995e-01   +4.889115892663345e-01   +1.000000000000000e+00; +4.393419014955480e-01   +1.332455284383481e-01   +2.221392886845686e-01   +6.053056061293981e-01   +2.983159589442643e-01   +2.614996812180295e-01   +8.246703422509831e-01   -2.914589577420911e-01; +1.764204742952215e-01   +4.916461157665206e-01   +1.071749691348595e-02   -1.532499870357489e-01   +4.121054742607519e-01   -1.206199933345278e-02   +2.712340127207258e-01   +8.524228374766164e-01; +5.647334781623894e-01   +3.427296192941606e-01   +4.899829573879849e-01   +6.347193473661643e-01   +8.608807835719759e-01   +1.581099031711777e-01   -6.802475712057832e-02   +4.832508326833783e-01];
L2I_L3I_iGABA_netcon = [+3.245881360807072e-01   +3.033050999463036e-01   -1.260242758973406e-01   +9.177879544103534e-01   +3.974047485930359e-01   +5.074717493889682e-02   +5.930200075477319e-01   +2.059140582345039e-01; +2.748865277073569e-01   +2.886828471596548e-01   +2.205917180761558e-01   +1.138167147200815e-01   +1.720521359724703e-01   +5.123005691950281e-01   +8.057082525154922e-01   +3.034149439267833e-01; +1.169312849243960e-01   +5.526056892736699e-01   -8.953969132507807e-02   +6.749889775914377e-01   +2.334499799307772e-01   -2.317183576275104e-02   +3.168110528628442e-01   +3.251472473646060e-01; +8.014750080889005e-02   -3.699282665353194e-01   +4.507979810362283e-01   +4.947171029051187e-01   +6.847584795989996e-01   +1.091495162466355e-01   +5.798855123955160e-01   +2.383562444908001e-01; +3.468099461635844e-01   +4.694362024387746e-01   +2.943162017612568e-01   +6.884953426957913e-02   +2.635080670866419e-01   +3.259505447978432e-01   +3.754723332500483e-01   +6.481343984357826e-01; +2.955634846189992e-03   +4.742541402558438e-01   -6.854319019607599e-02   +4.356215253699317e-01   +4.101310202870581e-01   +6.417818524076315e-01   +1.476120492135575e-01   +3.909499123284159e-01; +5.183110114982710e-01   +1.667380685277463e-01   +3.132981335454607e-01   +5.842064834991089e-01   +3.038333296368935e-01   -8.704198643032987e-02   +1.138884991088950e-01   +3.735672127171077e-01; +5.114656927190195e-01   +7.372706029173555e-01   +4.651610738192075e-01   +2.463593113339952e-01   +1.449586924205801e-01   +5.548284068606684e-01   +3.107076490979906e-01   -4.160604943539761e-02; -3.982627918795136e-02   +1.631627601397825e-01   +3.674531466908318e-01   +3.626345025807581e-01   +6.950339781807282e-01   +4.755759718318325e-01   +5.360002311886964e-01   +1.043566152791443e-01; +6.399441216315896e-01   +2.218345688837358e-01   +4.155572532560758e-01   +2.152744248797039e-01   +4.843347240384678e-01   -1.288600217051470e-01   +1.167901111656447e-04   +9.142677828717637e-02; +3.344514245934240e-01   +6.984299573762447e-01   +1.905341397398468e-01   +6.549856450940804e-01   +7.745165651964483e-02   +9.456350311734604e-02   +2.046696567060562e-01   +1.096541883259984e-01; -5.784966638229640e-02   +2.366238803592384e-01   -1.239407795212647e-01   +2.908276473741949e-01   +6.605222356382766e-01   +6.981471176651798e-01   +7.607648797759328e-01   +2.064124936580482e-01];
L3I_L3E_iAMPA_netcon = [+2.873976002542220e-01   +7.511978755875913e-01   -1.602947137326776e-01   +2.864362989174231e-01   +8.976495824425748e-01   +1.777170560510171e-01   +6.911756693866881e-01   +6.239073573108394e-01   -7.096121062869354e-02   +1.370576072093895e-01   +1.483467674857465e-01   +4.963618830833391e-01; +8.326303787587881e-01   +8.414716496860607e-01   +5.100362995774237e-01   +1.932013969071341e-01   -4.871273303252166e-02   +7.814457025558138e-01   +6.449873882969260e-01   +9.021053117559258e-01   -4.000057878572511e-02   +8.905617470492329e-01   +4.831093823355568e-01   +5.503251065757087e-01; +4.901485487526275e-01   +6.628503618219584e-01   +2.968923753376634e-01   -2.961450672336972e-01   +7.021243669394717e-01   +7.256883813811008e-01   +3.810080798032806e-01   +7.357616950338762e-01   +2.000273036177613e-02   +5.800785708697003e-01   +9.566954561505204e-01   +5.061623566308434e-01; +7.027056267363542e-01   +4.356040903858033e-01   +3.290265661874978e-01   +8.288604038510407e-01   +7.294306113634086e-01   +9.086967174927110e-01   +8.421199119207952e-01   +8.146841152492649e-01   +1.258917575685694e-01   +7.756392902093027e-01   +4.968902539923813e-01   +6.618488745219933e-01; +8.353407472523074e-02   +5.748443175540576e-02   +1.714993786363388e-01   -4.447016740044476e-02   +6.765198483083867e-01   +9.182533163742140e-01   +1.622750666898164e-01   +7.122556284173521e-01   +7.708709817020578e-01   +3.607908970536621e-01   +7.843309426534504e-01   -1.348453434515745e-01; +3.589942110483419e-01   +7.781903922930102e-01   +2.055735808512315e-01   +6.926468094643278e-01   +4.760562614873383e-01   +7.817073827512448e-02   +4.034814196610626e-01   -1.589199726366067e-01   +3.916677871471785e-01   +4.560083085885737e-01   +4.033015239102801e-01   +2.942958343040092e-01; +1.030641076195193e-01   +3.566727107573749e-01   +2.231383274292643e-01   +1.088189064576278e-01   +1.000000000000000e+00   +3.010700657773051e-01   +4.141620411909253e-01   +5.557081451724278e-01   +2.227286059839576e-01   +4.764646528250001e-01   +4.381872310288431e-01   +3.202099038572526e-01; +2.416583348100136e-01   +6.039202926316254e-02   +3.937741605595415e-01   +2.327747676719508e-01   +3.314589315364144e-01   -1.798058400060791e-02   +1.786085531044674e-01   +2.526971262747703e-01   -5.795779014615481e-03   +7.776123259457988e-01   +4.097874193236088e-01   +3.391721086841540e-01; +1.525703507383578e-01   +2.990295618938988e-01   +4.908089687749738e-01   +2.887873707469523e-01   +3.719675106586146e-01   +8.637020532780973e-02   +2.025160753331311e-01   +3.122478431930666e-01   +7.325924523317459e-01   -9.764833105810904e-02   +2.677469592865403e-01   +4.316609243195878e-01; +5.127663790311937e-01   +7.352911142598083e-01   +4.215335698601732e-01   +4.834320245538052e-01   -2.128611155434879e-01   +3.941272822517835e-01   +7.300008324662993e-01   +5.722521200085733e-01   +7.284868847697314e-01   -4.786063314301081e-02   +5.905692685182428e-01   +3.568087756344407e-01; +1.209516619600537e-01   +9.757116477870353e-02   +5.173119319174424e-01   +4.483352383371342e-01   +9.441973738031391e-02   +3.586518259526833e-01   +7.552726764715578e-02   +7.251074091035061e-01   +8.401601793490739e-01   +8.629822008416408e-01   +8.394852516104660e-02   +5.065871338641046e-01; -5.294398401052639e-02   +4.683614673733281e-01   +1.378060239349091e-01   +6.390866654076826e-01   +8.965829952302299e-01   +1.040164806938884e-01   +2.138133783540163e-01   +4.107552680169608e-01   +6.814251902502366e-01   +3.767155761257859e-01   +3.414253684203853e-01   +3.775338138557133e-01];
L3E_L3I_iGABA_netcon = [+5.393605699471233e-01   +9.722433373888323e-02   +1.311876909190464e-02   +5.438081727702075e-01   +3.549224068814734e-01   +7.172920196862892e-01   +6.335903661019663e-01   +8.496463919850270e-01   +7.451627966508834e-01   +2.800674370978112e-01   +2.909392075602297e-01   +4.127872679341810e-01; +3.982139355855802e-01   +1.711226144712843e-01   +7.752453007164395e-01   +2.405913681647139e-01   +3.010759371986065e-01   +6.239284888791510e-01   +1.000000000000000e+00   +1.884146140806952e-01   +3.645959550205728e-01   +2.628876729252388e-01   +1.753942374869219e-01   +4.479143664501547e-01; +1.178442891334738e-01   -5.457975610781705e-03   -1.142867215921540e-01   +3.327065389812935e-01   +2.710686809187958e-01   +3.763036816512715e-01   +5.526651759634970e-01   +5.979016224044168e-01   +5.039274697891541e-01   +5.091675287588879e-01   +4.953308696313836e-01   +3.422972547564526e-01; +3.873607886827058e-01   +7.749225917112066e-01   +4.580487601426603e-01   +1.648797284460115e-01   +6.248665429569895e-01   -5.740646589970186e-02   +5.069912073145458e-01   +3.360278364578396e-01   +3.510426037747464e-01   -1.532657146854614e-01   +4.919880826842630e-01   +2.905584588092096e-01; +8.421672162319117e-02   -5.126081954077837e-02   +3.070776865758576e-01   +2.825743369603123e-01   +2.642955777875964e-01   +1.648551951428409e-01   +5.177086262703506e-01   +3.372546849694994e-01   +3.702610391928733e-01   +9.934229411519747e-02   +4.491535048260943e-01   +9.141445762737522e-04; +9.046993892180066e-02   +3.016229088561493e-02   +5.606627938501690e-01   +5.579143891307573e-01   +4.229823009205334e-01   +2.609543671289732e-02   -2.811792637716445e-02   +2.370236322045963e-01   +3.095515898403949e-01   +6.167187248308962e-01   +5.629710924794817e-01   -2.054311508580291e-01; +5.111608096264710e-01   +3.272241962293377e-01   +5.971449184740807e-01   +1.663871423620251e-01   +5.750486446411692e-01   +4.554552077617529e-01   -4.287792052635118e-02   +5.429638479478928e-01   +6.252202428002387e-01   +2.546719231706649e-01   +4.908746229723608e-01   +3.069435234972769e-01; +1.029714522059571e-01   +1.780603011567549e-01   +1.023979167072740e-01   +6.882516507125626e-01   +5.219674904231817e-01   +2.883628922505132e-01   +5.204647317559939e-01   +1.166914435829968e-01   +2.738098863456324e-01   +2.627635825107228e-01   +3.520068333893324e-01   +7.419515571013123e-01; +2.959303880323380e-01   +2.291540729950892e-01   +5.342940998927845e-01   +6.430948108720829e-01   +4.241660742284695e-01   -5.550451742190629e-02   +4.725283218255371e-01   +4.977267897201461e-01   +2.351661124740258e-01   +2.228370756663181e-01   +5.121457525149476e-01   +7.334231539804955e-01; +3.569208723969869e-01   +7.651931659179806e-01   +9.251938294065731e-01   +8.085307213148777e-01   +2.005787787562182e-01   +2.465089750203697e-01   +6.961159834794834e-01   -1.336667523317246e-01   +8.025468435643552e-01   +4.581158737889315e-01   +1.633746103597105e-01   +1.659507134337300e-01; +5.660539320134048e-02   +3.785473936667547e-01   +2.254183269178828e-01   +5.940789090146539e-01   +6.399554104366268e-01   +2.710670915912813e-01   +6.676806523714240e-01   +7.430178279875055e-01   +6.711826865314905e-01   +4.014813675144444e-01   +1.638842472949611e-01   +7.690823704539104e-01; +6.653380581254564e-01   +7.887982454157451e-02   +4.442215441934774e-01   +5.525431385429483e-01   +3.966416348034977e-01   +4.212019572554576e-01   +3.220212595580014e-01   +3.087263238148024e-01   +2.084359782105298e-01   +2.881880896735242e-01   -1.644925161167473e-01   +2.894243812984078e-01];
L2E_Input1_iAMPA_netcon = [+5.403009820124306e-01   +7.331578379129307e-01   +6.647622871049017e-01   +6.598125118398358e-01   +8.893482010526989e-01   +5.728412837134539e-01   +1.000000000000000e+00   +4.699313081300079e-01];
L2I_Input2_iAMPA_netcon = [+8.519422894677671e-01   +6.403311183883261e-01   +5.564682131150671e-01   +6.701924814793566e-01   +5.530186728123293e-01   +8.069917748912528e-01   +3.783353677807826e-01   +6.331578114397566e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
