function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.006767373347166e-01   -1.682855088198432e-01   +5.707732796315568e-01   +3.032550602539784e-01   +2.493528367208806e-01   +7.266237950508904e-01   -1.784456772628238e-01   +3.878950865829151e-01   +2.066762562573775e-01   +8.542071113388751e-01   +3.619533556136508e-01   +2.705817295433480e-01   +1.076465796356234e-01   +1.566530379998200e-01   -1.547017160042001e-01   -3.293256524623643e-02; +6.018554757412198e-02   +1.901405905583032e-01   -1.549732373486020e-02   +9.000443164568216e-01   +2.496673231154489e-02   +3.110815619562672e-01   -2.506709186915447e-02   +4.289158705780820e-01   +6.462354590150012e-01   +2.354832179768650e-01   +7.209523991664736e-01   +6.417037224599675e-01   +2.919573466480132e-01   +3.620550542187345e-01   +1.734152223600592e-01   +1.740980540725190e-02; +8.197618582144495e-01   +2.161911075700904e-01   +1.207644851399958e-01   +6.056873065015093e-02   +2.511617763205482e-01   +3.681520776513729e-01   +5.916324372026286e-01   +2.169043128429143e-01   +2.376433113500020e-01   +5.281363308007687e-01   +4.879649335623690e-01   +2.402529425579650e-02   +3.647611845208492e-01   -1.667198224384544e-01   +2.885491468346378e-02   +2.327252240778574e-01; +1.961366075109189e-01   -3.177909993614547e-01   +6.800391218498465e-02   +4.028030775680663e-01   +1.055200540505966e-01   +1.776341227098134e-02   +9.438317305007846e-01   +8.201666377361134e-01   +4.237863829782380e-01   -1.245075766902163e-01   +2.646147910658990e-01   +6.556509289870747e-01   +1.348901364495751e-01   +5.474691137650147e-01   -3.377847651233779e-03   +6.424578510096923e-01; +8.181133484538611e-01   +2.313357611401808e-01   +6.994557654564747e-01   +7.235545028708645e-01   +9.288000042530904e-02   +4.781790109877277e-01   -2.110243693431134e-01   +5.693221336745770e-01   +2.381242941812188e-01   +3.541003817886389e-01   +3.597916053465972e-01   -1.679444993017888e-01   +1.320448887116171e-01   +3.507373812278418e-01   +3.902234521652821e-01   +2.078964499516154e-01; -1.864751974787077e-01   +5.765834247582634e-01   +3.641035103639593e-01   +1.097737258854852e-01   +6.828015372087474e-01   +3.287342831518785e-01   +8.498184255610548e-01   +2.277980401863432e-01   +2.890871951419652e-01   +4.410973121273616e-01   +3.750164497021643e-01   +8.974003320392467e-02   +6.388984391417644e-01   +4.185557689405907e-01   +4.215148037565689e-02   +9.149089964554619e-02; +4.517344459349086e-01   +4.835316586687768e-01   +2.430528410067185e-01   -1.520991648111705e-01   +2.131401604819169e-01   +2.288305228433576e-01   +1.412901628272736e-01   +9.705101229368693e-02   +5.866575434510185e-01   +5.394241896323740e-01   -3.277525637995125e-02   +3.901199600381277e-01   +3.369272384660550e-01   +3.624724197442297e-01   +4.560084463791611e-01   +3.842492748607615e-01; +4.119510282365824e-01   +6.039347994251718e-01   +2.197882339969175e-02   +9.610810697089535e-01   +1.595230257280752e-01   +1.669425351787641e-01   +5.629155739140881e-01   +7.781559635557870e-01   +9.062437916426282e-01   +6.407316027269769e-01   +2.887948178610417e-01   +6.962904194200620e-01   +2.404191180473476e-01   +2.514569882402933e-01   +2.297436562918547e-01   +4.969056185987022e-01; -1.446232124869152e-01   +5.707068495781299e-01   -3.213905302494720e-01   +3.715545660535541e-01   +4.887940683720261e-02   +4.208593603771646e-01   +3.150112872923772e-01   -1.463022284404706e-01   +3.356085976546301e-01   +6.400621173635737e-01   +7.484956299730465e-01   -4.684756251896667e-01   +5.689002172273920e-01   +3.706369851258166e-01   -9.581946809195080e-02   +3.259665141151368e-02; +1.083782069653496e-01   +2.692241770568499e-01   +5.203720159720147e-01   +6.453497704453730e-01   +6.500212453436555e-01   +2.568870906454155e-01   +5.371708180164325e-01   +1.863519624319811e-01   +1.766200463947823e-01   -7.752854611654141e-03   +4.351944635329922e-02   +2.933610551833667e-01   +7.448885344744456e-01   +8.337130233504111e-02   +2.219741867401145e-01   +4.829418718525014e-01; +1.597389613553984e-02   +8.528861013053672e-01   +3.876396647235542e-01   +2.146107074336964e-01   +6.356233494976080e-01   +8.568331248578406e-01   +8.393070417123814e-01   +1.613754038769027e-01   +1.214064637274806e-01   +6.178299786610378e-01   +1.434368229399842e-01   +4.297601193897343e-01   -1.296097208982684e-01   +5.684602917557667e-01   +7.567618137467469e-01   +3.758565546863829e-01; +7.040406643358472e-01   +8.592449059352709e-02   +4.293696903171237e-02   +1.525271941192543e-01   +3.573486468410617e-01   +4.209556973118649e-01   -7.135296729525130e-02   +4.096219791890965e-01   +7.504164939788104e-01   -3.713450837670802e-01   +9.059995254442806e-02   +4.701761934844392e-01   +3.832033385151359e-01   +4.095775669014387e-01   +5.963755389848567e-02   +2.740047943791598e-01; -1.993348314841861e-01   +6.526195358106676e-01   +6.763349119572488e-01   +6.172214157135888e-01   +7.036158582268681e-01   +5.522945092000329e-01   +2.102709182265071e-01   +5.151074503853463e-01   +8.526645123342028e-01   +5.145980115111335e-01   +1.485205775895798e-01   +7.587665020025081e-03   -2.527717003617509e-01   +1.397755534347360e-01   +7.052305987445519e-02   +1.038132282324145e-01; +2.438837797015844e-01   +5.813193007960679e-01   +5.207467957445361e-01   -3.545867490358642e-01   +1.334648695895576e-01   +5.956777867468082e-01   +1.682990850111059e-01   +3.170910466320422e-01   -1.138195416998539e-01   -7.059229613155873e-03   +9.627104117434813e-01   +5.303035994329532e-01   +6.674149787239926e-01   +4.245444156282916e-01   +3.196020822396057e-01   +4.453351397169258e-01; +4.980118667732017e-01   +6.966607694065080e-02   +6.225294199251626e-01   +8.235953789534781e-01   -4.697133859182574e-02   +8.214250144522206e-03   +4.903331540055578e-01   -4.972262344424293e-03   -1.981482422011791e-01   +3.127476452650758e-01   +3.139059629467656e-01   +2.739162203151908e-01   +4.182040946741958e-01   +3.091858108583035e-01   +3.012465466643401e-01   -7.240697524867798e-02; -1.808588311636729e-01   +5.085052973683949e-01   +1.852892012300189e-01   +7.058374015671088e-01   +9.507624364455343e-01   +7.890279035649651e-01   -9.360365373976112e-02   +7.512678615416823e-01   -1.449714558181342e-01   +7.008092084364557e-01   +6.348859106867452e-01   +2.756469898006288e-01   +1.143389333259348e-01   +8.409207610126435e-01   +6.295704944632954e-01   -1.839186130051969e-02];
L1E_L1I_iGABA_netcon = [+2.827801715898068e-01   +3.223327977418500e-01   +2.494344795653561e-01   +2.674238961375114e-02   +4.428668307520467e-01   -2.092678444597637e-01   +2.837862798371981e-01   +1.396574813727799e-01   +1.627098072507699e-01   +3.121834393567388e-02   +3.549799215742174e-01   +8.322493788690674e-02   +5.011930802933792e-01   -2.639195376428555e-01   -2.523154838807933e-01   +8.447010713510161e-01; -1.514313929936056e-01   -2.282320750207311e-01   +2.484407896408594e-01   -5.206797486484704e-02   +1.264476868083345e-01   +2.506219080392380e-01   +4.268440667743775e-01   +2.215659925120692e-01   +7.260189569209613e-01   +1.373859394275289e-01   +5.313067894460902e-01   +2.912058981783072e-01   +5.608610962239511e-01   +1.492316209377838e-01   -3.480983497954192e-02   -2.184777842599523e-01; +1.215634151614489e-01   +1.811775520323164e-01   +1.134649240223305e-01   +5.725731569758958e-01   +3.009649568104051e-01   -7.810350557845323e-02   +3.229911024725457e-02   +1.627779672440596e-01   +1.086168306262951e-01   +9.515585302948282e-01   +2.349155194943456e-01   +1.540845779181621e-01   +1.920803120272761e-01   -3.881006494512612e-01   +1.289847138681618e-01   +6.652790671487963e-01; +4.554031216494234e-01   -1.084815761813810e-01   -1.813452429256893e-02   +3.630832631776554e-01   -5.754039070765909e-02   -2.395737055516133e-02   +1.184553400560184e-01   -6.086380185792922e-02   -9.401353101537677e-02   -5.507831980651084e-02   +4.548673967725851e-02   +4.742584270500822e-01   +1.180646322190211e-01   +3.938529111015076e-01   +3.083374882832148e-01   +1.964636978990916e-01; +2.663316081834876e-01   +2.528139753222030e-01   +6.355311321222337e-02   +1.526338065124419e-01   +5.718208686518674e-01   -4.196728560061637e-01   +3.327580308328005e-01   -6.667706334018711e-02   +1.824464872832443e-01   +1.990157540122109e-01   -2.191216527388179e-01   +4.827010815949623e-01   +3.947963666167913e-01   -1.793182761400597e-01   -5.736376380364899e-02   +4.759265614930234e-01; +1.443650540504426e-01   +1.688251751713566e-01   +4.394444139612039e-01   +1.467721259303054e-01   +1.102376152391005e-01   +4.851010824207814e-01   +1.654673513926990e-01   -1.025582069714472e-01   -3.131138119267205e-02   +2.825280916172259e-01   -4.281031470271694e-02   +2.556706256527939e-01   -7.382440753414900e-02   -1.537028323149793e-01   +6.741058287782532e-01   +5.383831387163492e-01; +1.087230871609918e-04   -1.280397518632320e-03   -1.462611794806344e-01   +4.845412418158188e-02   +1.931584218141152e-01   +2.415638083613321e-01   +2.520735085865058e-02   -1.020656774961173e-01   -7.074373793896505e-02   -3.039131424368443e-03   +3.891827035540013e-01   -5.317417927633727e-02   +4.576905497523037e-01   -2.751882404482446e-01   +5.192201765882271e-01   +2.725885956838465e-02; +3.920914151518332e-01   +5.578382497630087e-01   -6.229851274532117e-02   +2.155127345290570e-01   -1.056327167059354e-01   -1.893405085853608e-01   +5.101371872481361e-01   +7.957313336040064e-03   +4.895043575286703e-01   -2.251502614805632e-01   +2.937704463340049e-01   -2.090626745725911e-01   +2.853915090021064e-01   +2.006549873798814e-01   -8.150866256823869e-02   +1.179101815210921e-01; +5.714917855023938e-01   +4.686949587060395e-01   +4.922747514610102e-01   +8.479118776444176e-02   +1.470456437308939e-01   +5.911838695184662e-01   +2.882063287474383e-01   +3.733084858910976e-02   +3.609510307187058e-01   +2.525849869742247e-01   +2.345679703606170e-01   +2.404278395335760e-01   +1.017718045093802e-01   -1.186122539766369e-01   +7.076129194044907e-01   +3.481968865970475e-01; +2.563106541230389e-01   +5.238321196880958e-01   -1.486644724395210e-01   +4.111100900428707e-01   +6.830531932093095e-02   +3.340537040989013e-01   +5.541595059653993e-02   +1.894377140127808e-02   +3.389729708577010e-01   +1.565875040975352e-01   -8.070878303523907e-02   +3.077242125405834e-01   +1.706169890353867e-01   +4.912920837550435e-01   +2.061278015306585e-01   +4.632489303887730e-01; +1.282867237405866e-01   +1.301991397875747e-01   +4.906563484111761e-01   -6.078205557913552e-03   +2.887698744973666e-01   +3.505174315696942e-01   +2.149919917008589e-01   +3.720793365600286e-03   +3.656278619815684e-01   +1.307140848174337e-01   +9.108818422703405e-03   +4.242317919850845e-01   +4.571349187458166e-01   +1.452521897191199e-01   +1.137939177505598e-01   +2.960933282145751e-01; +3.493438987227553e-01   +1.687022299268215e-01   +1.857291434064886e-01   -2.422327728619202e-01   +6.546001039919480e-03   +3.522857616164560e-01   +1.588782271791095e-01   +4.670604177687135e-01   -1.123482653256525e-01   +2.740709695089576e-01   +3.828878400518382e-01   +5.888880459393158e-01   -2.881772494352367e-01   +3.147095181363730e-01   -3.341895506620923e-03   +3.223769559899586e-01; +2.965459778414910e-01   +2.419742303651941e-01   -1.933302752241920e-01   +7.350382323417353e-01   +3.658055421065258e-02   +5.927703138207273e-02   +4.508893404223689e-02   +3.544462537786053e-01   +1.052286858791764e-01   -2.524430567033049e-01   +2.890500776617319e-01   +3.686501380147277e-01   +2.120450991615860e-01   +2.882388472984050e-01   +4.277813348524859e-01   +7.304210102733871e-02; +2.187700144593468e-01   +3.559869801604598e-02   +3.143496019609675e-01   +5.249909422075814e-01   +3.027059410420340e-01   +7.979604137248118e-02   +2.101589181919912e-01   +1.817380102172356e-01   +2.144879237810597e-01   -1.019638360522478e-01   +1.734628071959717e-01   -2.413260719139570e-01   -4.325240139383096e-02   -4.493490466916192e-02   +2.197186316982587e-01   +9.606752250140335e-02; +4.240783557363987e-01   -5.723050918244876e-04   +6.826117050929234e-02   +1.809008124919947e-02   -1.186275675591505e-01   +2.074179692446513e-01   +1.266983015202093e-01   +1.033427137428339e-02   +3.264679938158377e-01   +1.995609292151960e-01   +5.300493099943476e-01   +3.728321026162799e-01   +1.159811152277763e-02   -3.115881641817478e-01   +2.295546890837320e-01   +2.342196152894147e-01; +3.188847374185695e-01   +5.159311608097517e-04   +4.708019851813699e-01   -2.071336260877328e-02   +4.001248604441793e-01   +2.322591118039673e-01   +4.649408778504902e-02   +2.763571840292124e-01   -1.159432569075867e-01   +2.449478906479113e-01   +3.298744783981275e-01   +3.945321696734357e-01   +3.521662184626659e-01   +2.652447773914289e-01   -9.578939659317584e-02   +4.767577034723086e-01];
L2I_L1I_iGABA_netcon = [+4.008336262867125e-01   +7.714071811013347e-02   +1.951462514209090e-01   +4.706555043176106e-01   +3.799853357305796e-02   -1.044080793803084e-01   +1.554162013015702e-01   +9.021950710959099e-02; +4.895196569388099e-01   +6.126020879544382e-01   +1.421199100277517e-01   +3.310383602836943e-01   +4.418638373715018e-01   +2.303620112735482e-01   +3.319866178786803e-01   -1.844923580888886e-01; +4.348253255497104e-01   -8.752791805594679e-03   +6.337239960107487e-01   +4.123126716631647e-02   +5.738908655993544e-01   +2.035687270047674e-01   +1.645128204063833e-01   -2.188844954837752e-01; +6.033595092931420e-01   +3.444562070113402e-01   +4.342579454993444e-01   +9.466759227594028e-02   +8.163739405586471e-01   +3.409848555296701e-01   +6.657727220301826e-01   +4.578893407971866e-01; +9.956942987094670e-02   +5.902740842454295e-01   +2.443195766448520e-01   +3.012281196194050e-01   +4.171240512444928e-01   -3.327003834879540e-02   +3.694899196593384e-01   +1.038051788056982e-01; +3.661913089649732e-01   -5.547560973911165e-02   +3.950995085051011e-01   +3.059554693679863e-01   +3.365620984408278e-01   +4.295753435747476e-01   +1.536637731068788e-01   +4.704431282056871e-01; +7.344791139670815e-01   +6.146146732731234e-01   +4.065496377207424e-01   +1.110981953111753e-01   +3.948879635104251e-01   +2.209715887299194e-01   +4.752529783113607e-01   +7.864541012699779e-02; +2.795596786860896e-01   +3.491910826675810e-01   +4.546290235983854e-01   +1.441135399462901e-01   +2.182360466755896e-01   +6.135739873893488e-02   +1.486646326761885e-01   +3.554803553733267e-01; +5.296574604735449e-01   +1.000000000000000e+00   -1.432574001292065e-01   +7.151074409381409e-01   -4.196425686916283e-02   +3.846019662736931e-01   +1.000003992511832e-01   +3.322843632371558e-01; -3.407572402746667e-02   -1.030029184198528e-01   +1.519596677927691e-01   +4.919514636213516e-01   +6.577653635344641e-01   -9.972340598358817e-02   -4.236744825774277e-02   +7.557927387279434e-01; +1.509681047374405e-01   +1.617603644624331e-01   +4.602742269960876e-01   +5.681268392754182e-01   +1.133189823927665e-01   -5.570727722205934e-02   +2.863940786032318e-01   +1.142282747332446e-01; -7.020370723681511e-03   +5.288156564292211e-01   +2.864429894627144e-01   +4.134626710664547e-01   +7.201039157273183e-03   +3.405220945616275e-01   +1.899839414899497e-01   +2.491550742955597e-01; +2.196672001650936e-01   +4.712634760734292e-01   +7.872355286479179e-01   -1.498179906327299e-01   -7.169977769616101e-02   +2.131852174817342e-01   -2.783889696256162e-01   +8.875895108259594e-03; +1.764949300011839e-01   -2.915861425459260e-02   +1.242940767644493e-01   -1.133677681242043e-01   +5.422673837541131e-01   +2.409117743937434e-01   +3.432213750983547e-01   +1.995478300661379e-01; +5.161186880228056e-01   +5.340393676445929e-01   +4.870473463605380e-01   +7.145104156550484e-01   +2.328119084539383e-01   +8.676465371003722e-01   +5.439056791313258e-01   +6.162396844321498e-01; -2.264800010500427e-01   +1.000814811162622e-01   +5.296384054863910e-01   +2.828965833014356e-02   +1.100411483859540e-01   +1.594711610676294e-01   +1.989233785515672e-01   +6.823117466888143e-01];
L1I_L2I_iGABA_netcon = [+3.054505311085433e-01   +4.261282979523254e-01   -3.385660935441410e-02   +4.346971209035126e-01   +7.869710589220849e-02   +1.749443826567690e-01   +2.812506187205182e-01   +4.093874828242941e-01   -3.050831418074046e-01   +5.029363594830859e-01   +1.027962086614761e-01   +1.639757003258837e-01   +6.167372428783493e-01   +1.209639755443115e-01   +1.438934598114408e-01   +2.514365370164166e-01; +1.613923383320691e-01   +1.393572120829536e-01   +3.726609109391871e-02   +3.997364088495829e-01   -2.420618284846366e-01   +3.722261138052967e-01   +6.456523577364904e-01   +1.278635851054656e-01   +4.019545055469632e-01   +5.573253151278512e-01   +1.067049395315467e-01   -2.562381471807264e-01   +7.413384490312215e-02   -4.762820408814495e-01   +1.709554408983107e-01   +5.724242885467593e-01; +1.758687008403099e-01   +1.008404336782867e-01   +3.138383877065347e-01   +2.322878853263081e-01   +2.916451504155710e-01   +3.030694972407774e-01   +4.914180662468752e-01   +4.918170399576285e-01   -1.731259532545764e-01   +3.061650939779385e-01   -2.892822016196611e-02   +3.807277711196453e-01   +4.600957620950231e-01   +5.071717058366159e-01   +5.506014013214786e-01   +1.641381396760466e-01; +4.986861047063387e-01   +1.447672455037929e-01   +2.749301074221205e-01   +3.801777055892624e-02   +5.785015222331514e-01   +2.204096807307155e-01   +5.044923102485189e-01   +5.553143802405753e-01   -2.894165428140032e-02   +4.843368959590574e-01   +3.725180796771096e-01   +4.239018291411729e-01   +3.904115793105683e-01   +1.206072335533375e-01   +5.536985222258961e-01   +1.395232267883792e-01; +4.271448162770050e-02   +3.019249953415052e-01   +1.183356688664391e-01   +1.430802410712748e-01   +7.214132896093768e-02   +1.000000000000000e+00   +3.256938077529778e-01   -3.621337033209382e-02   +4.811477928928544e-01   +2.157816899977592e-01   +1.066609810206859e-01   +1.008966455255720e-01   -1.929052071419323e-01   +3.311295122077276e-01   +1.864421868029208e-01   +5.468641204784289e-01; +1.129033858557203e-01   +3.100659848556149e-01   -3.302196215592936e-02   +7.725844528191094e-01   +1.117965703840803e-01   +4.949154951542752e-01   +4.642229431048435e-01   +2.388347577751004e-01   +4.178089470751285e-02   -2.516537424782719e-01   +5.531866974638071e-01   -3.652034139684202e-02   +5.834947870464856e-01   +6.057044811819263e-01   +4.418314276232627e-01   +1.706585514036740e-01; +5.011957967163239e-01   +8.274496602519116e-01   +1.153732634286255e-02   +5.160584864092830e-01   +3.351329673746572e-01   -3.848542804449916e-02   +5.661098417397763e-01   -4.675262725851398e-03   +1.223629620528069e-01   +4.512501766080744e-01   +2.126488747561340e-01   +2.556846199874972e-01   -1.515075921927126e-02   +3.443115818230665e-01   +2.398254218869268e-01   +3.864570802686703e-01; +5.135587369498392e-01   +2.707501262188793e-01   +2.952100876977103e-01   +3.572813716132103e-01   +9.800342227870755e-02   +6.303829103258265e-01   +4.293238656306478e-01   +2.668131299857108e-01   +7.826363165657138e-02   +1.928270751554110e-01   +7.333092169826215e-01   +4.805633429853006e-01   +3.461050480425987e-01   +2.369109861556776e-01   +3.665244527747809e-01   +7.312510293700102e-02];
L2E_L1E_iAMPA_netcon = [+5.021906343325425e-01   +7.931816992721208e-02   +7.054326872679113e-02   +3.484935982797170e-01   +6.079861030565979e-01   +4.303079969067956e-01   +1.811162641737273e-01   +1.141056558392239e-01; -3.508489873106537e-02   +5.779715145000879e-01   -7.688763864703596e-02   +6.556466678538352e-02   +3.515199052904374e-01   -5.358114891220767e-02   +4.820551589664225e-01   +6.002622725488027e-01; +1.008207800995763e-01   +7.451603784971198e-01   +5.183982134818755e-01   +1.859687898230896e-01   +1.912555015711629e-01   +3.970541344348591e-01   +5.119506157469970e-01   +1.611828708308154e-01; +7.041869881278804e-01   +2.337383962210451e-01   -2.053576177743698e-01   +4.246001822467575e-01   +3.081698531932407e-01   +9.376056747915323e-02   +9.098255902250808e-02   +3.143625435197871e-02; -1.467308997365676e-01   +5.989462773789124e-01   +5.048217341529859e-01   +1.717787953522110e-01   +6.085188720117451e-01   +8.001777697091141e-02   +5.287842916411317e-01   +7.975333528003715e-01; +4.337318343977639e-01   -3.431367672033877e-01   +6.163097266845526e-01   +5.223118978870474e-02   +4.586355015389831e-01   +7.502119823322051e-01   +5.733414476224425e-01   +2.403377132755268e-01; +1.658721809641406e-01   +3.554946953934038e-01   -7.653956491620305e-02   +4.604873126469987e-01   -4.679326429396139e-02   +4.197822219186133e-01   +1.000000000000000e+00   +1.998048840448161e-01; +5.804551743515578e-02   +5.028849765608719e-01   +8.051093419028678e-01   +2.866810536920638e-02   +6.812798578391011e-01   +4.056371971633063e-01   +3.080051650771606e-01   +1.140380822135627e-01; +7.339368467478237e-01   +1.310500531706221e-01   +1.928592264973948e-01   +9.996542209939083e-01   +1.953485050265156e-01   +7.487528049429946e-01   +1.373070003303807e-01   +3.104561248072184e-01; +3.202906163948266e-01   +6.546396669815719e-01   +2.220892615411899e-01   +4.802530533652445e-01   +9.770150300996261e-03   -7.645397452702705e-03   +3.006092979648721e-01   +2.929333229887647e-01; +5.788756582912329e-03   +4.247761219005421e-01   +2.779800167700530e-01   +1.718511745045446e-01   +2.331045835251926e-02   +2.698647096883233e-01   -1.480591523001715e-01   +3.172756628157392e-01; +1.440098518929155e-01   +1.340383317129780e-01   +8.525919669647083e-01   +4.691408386268522e-02   +1.435850602100565e-01   +4.268877753965028e-01   -1.977359781330217e-01   +1.898471893908667e-01; +4.858361402795183e-02   +3.963379863042206e-01   +7.010251693358924e-02   +3.037565838453191e-01   +2.211697553856209e-01   -2.664628300612660e-02   +5.626168894099403e-01   +2.140001452449032e-02; +2.977673019976382e-01   +3.617238537908596e-01   -7.710430799746434e-02   +4.395718880279820e-01   +1.610185338328755e-01   -1.685633327518372e-01   +3.854246086100843e-01   +1.079450548975783e-01; -1.321498511189066e-02   -2.638806374548026e-01   +2.231389880718852e-01   +3.369248677849426e-01   +1.850238992245156e-01   +4.345445261578960e-01   -1.091008544782313e-01   +4.892425936627602e-03; +3.374017424970379e-01   +9.319495696347645e-02   -4.030321842891965e-02   +8.135967595641704e-02   +5.125477767157798e-01   +4.404378334069733e-01   +2.598319060405466e-01   +7.907795687772413e-01];
L1E_L2E_iAMPA_netcon = [+1.719386552939526e-01   +2.994931576264073e-01   +7.960870113554196e-02   +2.306003364625065e-01   +1.997637655733115e-01   +5.095822198658015e-01   +2.338411460816431e-01   +9.067428315082117e-02   +2.328693643637338e-01   +2.811739768283698e-01   +3.691049826751455e-01   +6.174237926014107e-01   +5.000660261748250e-01   +9.777180850784642e-02   -2.642207967495394e-01   +5.264917373340778e-02; +3.692947763499074e-01   -3.373187590733736e-01   +3.545019799297197e-01   +2.837415400240672e-01   +1.279020970414834e-01   +1.018279541810589e-01   +1.889133891864846e-01   +1.946954085066035e-01   +7.013575696778993e-02   +2.842700093859708e-01   +8.797535722158473e-02   +5.716265941750592e-01   +4.498112921569637e-01   +2.797456408384461e-01   +5.380137155467741e-01   +2.685503640961456e-02; +7.099275522098587e-01   +1.222299444609133e-01   +7.021224214018321e-02   -2.671142029842895e-02   +2.398357918723721e-01   +4.672885725409759e-01   +3.457460764831539e-01   +5.537264411828908e-01   +4.595729605737270e-01   +6.630294574251597e-02   +3.194507561373069e-01   +3.246577079380709e-01   +7.318236923890548e-02   +2.630947939084780e-01   +5.856741191981052e-02   -6.842187733287555e-02; +4.507968403804364e-01   +1.635859650487485e-01   +5.894546899474349e-01   +1.659160793859168e-01   +9.623800336472480e-03   +3.258876593551432e-01   +9.869462029528608e-01   +4.588154980814034e-02   +2.994799013899281e-01   +3.978111275287574e-01   +5.105847982726635e-01   -9.562617542743646e-02   +9.162691722337055e-02   +3.863337806118174e-01   +5.092491994645157e-01   -3.525029748097996e-02; +3.072679019764539e-01   -5.081085161010807e-02   +8.218451589175527e-01   +2.288504634701482e-01   +4.509197705782729e-01   +4.236325582775220e-01   +7.028518210156076e-01   +2.480742351514834e-01   +4.455184935199974e-01   +1.519119860152376e-01   +1.696601769950380e-01   -3.454654391267662e-01   +4.795267848043842e-01   +2.095728453842842e-01   +9.878582618325910e-01   +2.260412721789993e-01; +2.145941862483357e-01   +6.371735913614597e-01   +5.045623617461098e-01   +6.154334773754698e-01   +2.892608723793082e-01   -3.327858160537325e-02   +4.628713080061922e-01   +3.847385962708760e-01   +4.891775709656510e-01   +2.306420747433986e-01   +5.266428037824850e-01   -5.898258536882063e-03   +6.773060400011641e-02   -2.870588507588112e-01   -1.168883464331840e-01   +4.863168439866739e-01; +6.957329856195506e-02   +6.520279798865766e-02   +2.715258198534999e-01   +4.201200144582563e-01   +1.391051943162841e-01   +7.733983603349720e-02   +6.287009672566544e-01   +2.561975052165249e-01   -1.851230026173631e-01   +2.452455696158528e-01   +7.600998307475890e-02   -2.962162137719994e-01   -2.386851738434474e-01   +1.811296577990994e-01   +3.563560133118457e-01   +1.966200822606568e-01; +4.535584012562991e-01   +1.208249771023021e-01   +2.426294946495991e-01   +6.447150499555442e-01   +5.035728262088419e-01   +8.672330474075949e-01   +6.840184927542404e-01   +1.770465688789363e-01   -6.001383667190975e-02   +7.087339404556963e-01   +3.195152361726681e-01   +3.287025969036740e-01   -3.315185743723124e-02   +1.832364597270402e-01   +2.842936091551783e-01   +1.764155065042841e-01];
L2I_L2E_iAMPA_netcon = [+4.703626680079790e-01   +3.647383122518038e-01   +5.158169540616537e-01   +3.389768621879656e-01   +4.865600767469326e-02   +5.340555425931086e-01   +4.357853381280509e-01   +4.716810463770558e-01; +5.435594390839114e-01   +7.638829427973204e-02   +6.026675381487554e-01   +4.787292156710201e-01   +3.708849595491253e-01   +8.896371995662396e-02   +1.169267754874185e-01   +2.050263117097898e-01; +2.057586058394867e-01   +6.531970103811323e-01   +2.448005834229982e-01   -1.751132002433823e-01   -3.898072949234836e-02   +1.505418401699284e-01   +3.813758178918954e-01   +5.213938247921462e-04; +2.069535289230343e-01   +3.228452853256760e-01   +1.874093544732031e-01   +5.716941147766182e-01   +2.911007450133302e-01   -5.553543988487889e-02   +1.190064198683505e-01   +1.206062705622203e-01; +3.789832603221565e-01   +2.283063486613358e-01   +4.205306839086268e-02   +3.974460082259403e-01   +2.703332835036672e-01   +1.667693244550701e-01   +6.867257105460660e-01   +1.140657271369072e-01; +1.219265493755350e-01   +2.343885659865800e-01   +2.921913434534997e-01   +4.147250691931802e-01   -5.890504133986978e-02   +2.509434695722749e-01   +2.024049816034378e-01   +2.671302501540112e-01; +1.197866814481963e-01   +4.337145041896196e-02   +1.581615766240047e-01   +4.769658025384305e-01   +3.165728424100673e-01   +7.559779271762532e-02   +1.000000000000000e+00   -1.333377793543155e-02; +5.541977486405926e-01   +1.015790629180391e-01   -2.903211418098056e-01   +3.704599843437305e-01   +2.672397499200790e-01   +2.365310822020804e-01   -1.499224794655835e-01   +4.719620097218157e-01];
L2E_L2I_iGABA_netcon = [-6.513490065332420e-02   +5.459761141431546e-01   +4.176448281477108e-01   +1.296210442124511e-01   -6.723989292092723e-02   +2.513460777503339e-01   +1.990449663915983e-01   +5.246596843072356e-01; +2.492411047602524e-01   +4.865824122456329e-01   +3.943813409848814e-01   +4.386227354138105e-01   +3.177736784088313e-01   +3.669868643006842e-01   -3.306844208242159e-01   +2.590309521316462e-01; +1.220158464462854e-01   +5.922751889644161e-01   -9.406042602379816e-02   +1.945903407959510e-02   +4.207097273112682e-01   +6.504147159772314e-01   -1.124761878205748e-02   +1.000000000000000e+00; -1.632494722197383e-01   +3.031737973418561e-01   +1.527781825478689e-01   +5.069841395383833e-01   +5.336830264656517e-01   +6.620413499207954e-02   -2.065720104266757e-01   +2.825065189069721e-02; +2.587471997350571e-01   -1.679746736055550e-01   -6.264219105181497e-02   +5.225565212551724e-01   +6.452030521339283e-01   +3.505981547395806e-01   +6.960444222580779e-02   +1.208744170407972e-01; +1.776724970482134e-01   +1.383673637728486e-01   +1.131429383632117e-01   +2.517091561213567e-01   +2.625161428981965e-01   -4.929675848727545e-02   +1.887824819212597e-01   +8.289769615312657e-02; +4.237999124899003e-01   +3.521030949571369e-01   -9.756374982700282e-02   +2.509043360025633e-01   -3.306846779507027e-02   -1.255798890254431e-01   +1.533764076814979e-01   +8.890538266226903e-01; +3.036359380773700e-01   +6.698927229353718e-01   +5.510754595198551e-01   -2.354511436480277e-01   +3.100901079094002e-01   +7.275791782025917e-02   +5.293981743973688e-01   +4.344278814636028e-01];
L3E_L2E_iAMPA_netcon = [+5.401676735009169e-01   -2.253888866217430e-01   +1.136086174111884e-01   +2.253851448605854e-01   +6.446846624611923e-01   +2.915628045791611e-01   +3.227601994777471e-01   +4.727108309199267e-01   +1.579584854513394e-01   +5.153693287614251e-02   -8.491392510075704e-02   +2.701885039017307e-01; +2.680155348034127e-01   +8.462008616291691e-01   +2.613070997680531e-01   +2.520795814719896e-01   +2.787032876968574e-01   -5.299556007249464e-01   +9.448258118399236e-02   +2.833370872940536e-01   -2.969113651143031e-02   +2.031991484319412e-02   +1.860799441826133e-01   +3.949897497363417e-01; -3.885857249728136e-02   -3.409034488713392e-02   +3.395758286299481e-01   +3.238638502165729e-01   +8.203628524472198e-01   +3.290265070886150e-01   +4.527404825268799e-01   +3.961667864333165e-01   +4.090070669689664e-01   -2.542789719303226e-01   +2.422783198252771e-01   +6.859010797218478e-01; +1.499924210550586e-01   +2.545300169553232e-01   +2.368185314417378e-01   +8.412096161478991e-02   +6.052133086752113e-01   +1.683539890321612e-01   +2.312420250789103e-01   +2.620881223909514e-01   +4.732390403218323e-01   +7.705524855944865e-01   +5.480860482368968e-02   +1.407320579442734e-01; +6.794174905172762e-01   +2.422035601988684e-02   +4.123938854589050e-01   -1.768347090499719e-01   +8.603074046121082e-01   +2.644635022723399e-01   +1.538993524164312e-01   +7.057556899071236e-02   +3.682326879806129e-01   +4.328967456757246e-01   +6.515000234234940e-01   +5.457696250718546e-01; +6.441567613880028e-01   +6.430033287761292e-01   +5.259125841524432e-01   -1.143167226713726e-01   +3.955077345916674e-01   +9.894267504651730e-01   +3.898484419844856e-01   -9.943833488934156e-03   +9.981189921561918e-02   +5.920942379857678e-01   -8.288367163125097e-02   +4.875503453209084e-01; +3.524500055092440e-01   +4.955463203959261e-02   +6.727197445061516e-01   +2.018609818349144e-01   +2.538050917658191e-01   +3.850791264846600e-01   +1.688257118921768e-01   +5.001092441956534e-01   +4.658665451672559e-01   +4.820153707692238e-01   -1.626327948955823e-01   +2.967429493941867e-01; -1.854605009434246e-02   +7.077473255054935e-01   +6.063101313315029e-01   -3.905768017028516e-01   +6.997798163852739e-01   -2.055347828600685e-02   -3.368083907502756e-02   +1.337853048727891e-01   +5.048975751208269e-01   +5.820133078550466e-01   +1.580082250490707e-01   +2.245047558916682e-01];
L3I_L2I_iGABA_netcon = [+6.128572127157913e-01   +5.757090957810254e-01   +2.583355949513139e-01   +3.266886926122483e-01   -1.315503145594150e-01   +1.570574998773453e-01   +5.481579358575928e-01   +4.737517006299650e-01   +8.175484723522686e-01   +2.472672106934484e-01   +2.573279975858143e-01   +5.187775199987220e-01; +1.964409407384926e-01   +2.273662692864847e-01   +4.638871359638376e-02   +3.747541962413171e-01   +7.889243584286743e-01   +3.629781552222224e-01   +4.912332188835384e-01   +4.959790906813524e-02   +2.383316529846945e-01   +1.198239190746844e-01   +4.801798078550003e-01   -3.508579399406448e-01; +3.252164705680341e-02   +5.945203700011094e-01   +5.347521374985399e-01   -1.167614165878378e-01   +4.559079307845604e-02   -1.117259719714220e-02   +4.735464418863272e-01   +7.907651050526096e-01   +2.532168912370375e-01   +3.150769774402728e-01   -3.308294853556534e-02   +8.148005091105818e-01; +5.757931605754495e-01   +5.152693116283139e-01   +3.067986458460084e-01   -9.457324518515960e-02   +2.721921584985310e-01   +4.524142123210390e-01   -1.418006061937419e-02   +2.378268988304260e-01   +2.683142559621822e-01   +3.317023556624935e-01   +5.820175308163851e-01   +3.778181378897081e-01; +1.185026214771168e-01   +4.700123436629495e-01   +2.063390614219659e-01   +6.220172035781789e-01   +5.705358107924147e-01   +4.599409951655299e-01   +1.446626673850789e-02   +9.846045429077477e-01   +7.310945693738123e-01   +1.001451739807410e-02   +1.558720532082546e-01   +6.445234851071371e-01; -4.628198233642317e-02   +5.922672647477950e-01   +1.870132578746538e-01   +5.062686100222236e-01   +7.893377404564870e-01   +2.485675841422869e-01   +2.305072837144542e-01   +1.663861400778764e-01   +3.776125425925144e-01   +1.710361931627065e-01   +3.978441891560905e-01   +4.008675280923768e-01; +5.027493877428185e-01   +2.358685506126493e-01   +6.457391917459419e-01   +6.619499894262837e-02   +9.727956413316585e-02   +5.791944379596925e-01   +4.588624524574293e-01   -2.427701462814991e-02   -2.911523395693611e-01   +4.486425762611099e-01   +6.186152314844106e-01   +3.957433493819471e-01; +5.916366686202607e-02   +2.647039267453137e-01   +6.578362153967401e-01   +6.683844656892453e-01   -2.798884529519183e-01   +4.911553535897394e-01   +7.118893395270616e-01   +2.242663805084498e-01   +7.176211108267165e-01   +3.283723755279729e-01   +6.324423774899514e-01   +3.626634073315664e-01];
L2E_L3E_iAMPA_netcon = [+4.528901675412888e-01   +1.090897149715847e-01   -1.957949766946500e-03   +4.358126504489276e-02   +9.219547455035791e-02   -8.494932380790202e-02   +2.397371532664601e-01   -7.226437089423333e-02; +3.125602358416997e-01   +2.411107086178536e-01   +3.683976532793178e-01   +3.109388701388652e-01   +4.108241594543403e-01   -9.444098262766359e-02   -2.690660485435567e-01   -3.678036024394930e-01; +5.436676784986109e-01   -1.129890457601523e-01   +4.078611329839756e-01   +4.862123718212820e-01   +9.466454610418119e-02   +1.264630667074694e-01   +2.557180009570043e-01   +3.107419525712848e-01; +2.336621220563580e-01   +9.640175428043116e-02   +4.976028223438824e-01   +8.691085307839245e-01   +7.228772695978660e-01   +5.277172627267416e-01   -1.265329173265221e-02   +9.902793207599324e-02; +1.156996136728208e-01   +4.815853533677462e-01   +2.863094160650864e-01   +7.064109576734303e-01   +8.541121609843524e-01   +5.755255581070670e-02   +3.050847636642989e-02   +1.358107812485216e-01; +3.484519469626053e-01   +6.371363641328660e-01   +6.776714907988211e-01   +7.029978906340110e-01   +6.590353694168489e-01   +2.847391412317942e-01   +5.399895312580297e-01   -6.256653321235237e-03; +1.904489701045225e-02   +2.849623488902773e-01   +7.506306424953366e-01   +1.743533877456951e-01   -1.787299540768913e-04   -5.676697857434171e-02   +3.762761472438272e-02   +3.724034725963396e-01; +2.562022043050042e-01   +3.799657349660662e-01   +3.275487818492510e-01   +1.657783951997690e-01   +2.105388201016633e-01   +1.685667591279231e-01   +4.540113662720833e-01   +1.000000000000000e+00; +5.737822429663446e-01   +2.799438055618138e-01   +2.552889294038183e-01   +1.292683834405220e-01   +3.067180030954320e-01   +1.910349445478677e-02   +5.985276236828876e-01   -1.485938473983758e-01; -1.720277038008025e-01   +3.463159102605614e-01   +2.211190520471761e-01   +3.157322478525593e-01   -2.985489016351305e-02   -7.690378843405218e-02   +6.012792890222145e-01   +8.398394997523193e-02; +3.100175280777854e-01   +3.502726492944397e-02   -1.842085309114711e-01   +7.109590569849699e-01   +4.574840385541355e-01   +4.762892191303737e-01   +3.267825830277246e-01   +5.885287859060215e-01; -9.396229911667392e-03   +8.226817173439996e-01   +6.734152812437837e-01   +4.568091362726843e-01   +8.518277516299512e-02   +1.529276500111752e-02   -3.978320454838016e-02   +4.883325441386015e-01];
L2I_L3I_iGABA_netcon = [-3.545746079006617e-01   +1.827555765594316e-01   +6.588403855536342e-01   +4.169350634439632e-01   -1.580841352936064e-01   +5.731375468578073e-01   +1.453951584800128e-01   -3.896097475165602e-01; +1.116374453002791e-01   +4.109975174767599e-01   +1.481723489296174e-01   +2.638262647573720e-01   +4.028828967481997e-01   +2.715302491717371e-01   +2.729937319182676e-01   +2.015160471597826e-01; +6.675297379562183e-01   +5.386855768277317e-01   +2.359259129567449e-01   +6.428073853347330e-01   +1.485282548731161e-02   +1.000000000000000e+00   +3.522551053392467e-01   -8.506871962823279e-02; +6.586550913748343e-02   +3.210784084103550e-01   +7.342234697176908e-01   -1.313503313321374e-01   +3.780441396635132e-01   +4.087836530373617e-01   +2.736960833293364e-02   +4.022426892286124e-01; +6.282638901150145e-01   +3.759381942213763e-01   +7.632456958633338e-02   +5.293806049375772e-01   +8.230649621072056e-02   +3.070379591939721e-01   +2.352744837234216e-01   +5.451629279716536e-02; -6.103121131257522e-02   +3.985526073896687e-01   +5.897081845397674e-01   -3.552182560552632e-01   +2.795518784706812e-01   +6.284854638548995e-01   -5.537868925407809e-02   -1.994879026202860e-01; +5.732148192203733e-01   +1.910656672478319e-01   +4.431847869442052e-01   +3.986894133477276e-01   +4.340230074537051e-02   +5.890955833433840e-01   +6.452820544410104e-01   +2.672880048034219e-01; -2.514345543509179e-01   +6.881098533076430e-01   -1.084562969783491e-01   +3.661920319623271e-02   +9.565246975591428e-02   +2.012929835366462e-01   +2.747411349358262e-02   +6.301538503919288e-01; -5.397969905776658e-01   +6.417085729000875e-01   +4.939771735404735e-01   -1.243395711134763e-02   +4.088668350225008e-02   +5.071804686488220e-01   +3.452390181818619e-01   +3.042941464998435e-01; +5.109672296024640e-01   -1.230261281311121e-01   +3.272019642149053e-01   +3.293549050730721e-02   +4.331051898108834e-01   +7.044052690671826e-01   +1.147617746444990e-01   +5.888515781714427e-01; +7.855954974311368e-01   +3.540909809562724e-02   -8.521596834809121e-02   -3.412165982999395e-02   +4.508525296500572e-01   -6.432380801534790e-02   +3.454039077663889e-01   +8.359586212394038e-01; -3.685445907907717e-01   +5.168601905076736e-01   -2.332378779726186e-01   +6.046896201456693e-01   +8.484617378226734e-01   +3.046406450444271e-01   +3.507987382100733e-02   +4.047450624598598e-01];
L3I_L3E_iAMPA_netcon = [+5.155602332170524e-01   +3.101594564580643e-01   +7.322213713718449e-02   +4.129724053326194e-01   +4.869340636702336e-01   +2.574461941430509e-02   +2.539301421507421e-01   +1.136681122864148e-01   -2.222506255423861e-01   +4.019017931821174e-01   -2.053556206878555e-01   +6.454238645018751e-01; +2.938714213880749e-01   +1.362450478258088e-01   +2.733564750792149e-01   +5.482922293605631e-01   +6.528793874468433e-01   +1.549951243794573e-01   +2.190008949966870e-01   +4.169391624785821e-01   +4.965094222502292e-01   +4.148686660852955e-01   -8.005128553986092e-02   +1.197033461298437e-01; +4.604505673719737e-01   +5.114133206791416e-01   +7.368935054410584e-01   +4.518268921337393e-01   +8.096648272126781e-01   +4.258685600368652e-01   +6.488073691943170e-01   -3.146080339245794e-01   +5.190580297495752e-01   +6.548783775130990e-01   +1.777094878181434e-01   +5.616817049474622e-01; +4.001639692670171e-01   +6.500673577702335e-01   +5.675399298992546e-01   -5.672314421372408e-02   +2.985291096162819e-01   +8.186778070529628e-01   -4.274315173105507e-01   +4.542938279548918e-01   +2.949325452200960e-01   +2.335506544202173e-01   +7.889184040309127e-02   +2.499436358450935e-01; +1.506469512229103e-01   +1.903316472717083e-02   +7.609184272480802e-01   -2.286834718707323e-02   +4.338243327846789e-01   +1.402305407089183e-01   -4.296914230781465e-02   +4.008134746604722e-01   +6.174525281230194e-01   +6.101277173399261e-01   +3.839980213517163e-01   +1.620861525780176e-01; -1.791742319909981e-02   +1.914178708021191e-01   +3.499375824628886e-01   +1.714966283177424e-02   +4.293768658940324e-02   -7.844873971561997e-02   +4.738711275302487e-01   +2.859439114124007e-01   +2.492175651567590e-01   -4.843543501418106e-02   +2.842404437729519e-01   +3.859614019261595e-01; -9.367006104728440e-02   +4.723507131523247e-02   -2.360359592924351e-01   +1.667104583601616e-01   +4.710657765596623e-01   -3.680158071545573e-02   +5.846458129148735e-01   +6.040594381848067e-01   -2.319906294870111e-01   +1.802075354412577e-01   +4.771218772710057e-01   +7.047273628827327e-02; +1.520018749082996e-01   +2.978056172687565e-01   +3.516507576635238e-01   +1.705122200687836e-01   -1.913577212088004e-01   +2.779354591421300e-01   +1.408858459849144e-01   +5.652688518002712e-01   +3.554342924565574e-01   -2.966043455662805e-01   +1.155088573921209e-01   +5.210736629165894e-01; +1.868975196105656e-01   +5.719824191916903e-01   -1.623487504540438e-01   +2.301976043467653e-01   +2.174463656447122e-01   +8.791398393409308e-01   +1.732353709675175e-01   +5.344145473705300e-01   +3.632246114923373e-01   +5.564515065683253e-01   +7.637582044176120e-01   +6.265063071854321e-01; +7.329553998232163e-01   -3.750233882586892e-01   +6.603838717077585e-01   +3.637971176291822e-01   +2.960809398628662e-01   -2.941109398531602e-01   +3.602741949749595e-01   +9.583680398356451e-02   +3.978641541603827e-01   -4.649419751115416e-02   +9.857560616879174e-01   +4.431790223219079e-02; -2.352777837670923e-01   +1.837665822981403e-01   +5.948867392475976e-01   +5.423143968892085e-01   +6.401498513580297e-01   +1.344094947103335e-01   +4.849925512899858e-01   +4.685377374245251e-01   +8.085495619213148e-01   +3.578758620119413e-02   +2.255956365174034e-01   +6.215527965009979e-01; +1.291839738930961e-03   +4.685374996954820e-02   +2.908698652086685e-01   +1.926978865319057e-01   -1.673523166939546e-01   -1.208467731228030e-01   -1.718927273442657e-01   +3.400614070661719e-01   +8.992096796705659e-01   +1.028100835290969e-01   +1.946670671190750e-01   +1.811497352246547e-01];
L3E_L3I_iGABA_netcon = [-3.223158080907773e-02   +4.325200546516488e-01   +1.307804152143871e-01   +5.128783946702579e-01   +3.516625358634264e-01   +7.114835369934651e-02   -1.111520739723770e-01   +9.934974157017180e-02   +4.641720720873935e-02   +4.990689771230379e-01   +4.758051774515004e-01   +1.883610028010351e-01; +4.496929956777270e-01   +1.436324056586263e-01   +1.030590936310990e-01   -9.717093144123938e-02   +2.454156397034771e-01   +1.675076996438714e-01   +3.675095075242793e-02   +3.940915752630990e-01   -2.112880549328324e-01   +9.009407288967287e-02   +1.812505537294345e-02   +2.047923209212322e-02; +2.078185920319809e-01   +1.016270917119890e-01   -1.052142321654858e-01   -1.944617777027774e-02   +2.839532378367935e-01   +4.231474461470770e-01   +3.520139005734967e-01   +2.288906583364172e-01   -2.266367311993776e-01   +4.684429243573476e-01   -1.421745195043422e-01   -1.748843507148237e-01; +2.700141706904410e-01   +3.865661342465039e-01   -1.160930473969133e-01   +4.048177498121897e-02   +6.896975612038571e-01   +9.145573883677044e-02   -2.173591301448191e-01   +9.924549295462150e-02   +6.926898712809054e-01   +6.233846230055404e-01   +2.616918920480977e-01   +2.749384019681533e-01; +3.845033910785096e-01   +9.590684281460871e-03   +1.049190967754576e-01   +5.146612640988399e-01   +1.358008625473439e-02   +1.643288470706026e-01   -2.454259667615289e-01   +4.450445824684668e-01   +1.897981656158527e-01   +5.100415009628601e-01   +3.264720465585288e-01   +3.102446172647908e-01; +3.063286996624668e-01   -7.014442133518206e-02   -7.849604595793444e-02   +1.409896696876510e-02   +2.723425592311023e-01   +2.697109347119708e-01   +1.485144134580302e-01   +3.146833223395105e-01   +4.413039326311313e-01   +3.559660961175319e-01   +3.695339558011378e-01   -2.481178997033896e-02; -1.142234092829579e-01   +3.846661091470392e-01   +7.254692626734949e-01   +8.744128074499120e-01   +3.671283384930321e-01   +6.657506625487344e-02   +4.509468219136052e-01   +5.089329770927852e-01   +6.743394276456002e-02   +4.014017651768398e-01   +4.418649959411954e-01   -7.411315618152588e-02; +1.770007093390092e-01   +2.151527380651166e-01   +4.755651197721538e-01   +1.457905166043886e-01   +1.477954430017984e-01   +3.110446021654756e-01   +2.427703653199393e-01   +4.133522291033560e-01   +7.420340384799284e-02   +2.390162954680496e-01   +3.074068292460617e-01   +3.321359289173086e-01; +7.364077762414938e-02   +3.292287817699272e-01   +7.896691629170702e-02   -1.560941972405109e-02   +1.394628556509453e-01   +1.103449180596662e-01   -2.375209414764444e-01   +2.078917304638139e-01   +6.306004450908290e-01   +6.537231436723765e-01   +4.347511899827105e-01   +4.623334961965836e-01; -1.522979509767917e-02   +2.240885775888327e-01   +3.266672653251261e-01   +1.866944095225888e-01   -1.800814832452550e-01   +1.527079997937066e-01   +4.578173607726242e-01   +6.480916476921933e-02   +2.168792705660774e-01   +1.409386639564511e-03   +3.441387355077163e-01   +2.091201402968470e-01; -1.782471348097477e-01   +2.197402828715578e-01   +2.645679036907861e-01   -1.048870855911740e-01   +3.726386352999678e-01   +2.389179688951162e-02   +4.779242255202352e-01   +1.426604634626526e-01   +1.258923391071629e-01   +2.909529357577774e-01   +2.599231192213478e-01   +1.449364351956705e-01; +1.964677272345906e-01   +4.603947521204957e-01   -4.815693052565569e-02   +1.940262521032242e-01   +6.576562573947796e-01   +5.969288879836280e-01   +6.155366887058105e-01   +1.962972526220197e-01   +2.444600806954724e-01   -1.972382163120927e-01   +2.330115661142463e-01   -5.678254964043427e-02];
L2E_Input1_iAMPA_netcon = [+4.603119706413811e-01   +7.015343573450477e-01   +8.770628601478807e-01   +8.741313265349344e-01   +6.886047908258853e-01   +8.414735434192345e-01   +6.276004781712641e-01   +9.133878557390518e-01];
L2I_Input2_iAMPA_netcon = [+6.553645237272299e-01   +5.277769025782930e-01   +8.326094111823765e-01   +8.016799037045991e-01   +2.501123334247288e-01   +8.768897984984982e-01   +3.441667730491639e-01   +1.137097805273401e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
