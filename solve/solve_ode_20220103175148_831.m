function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.061874234250788e-02   -2.864436827087729e-01   +4.703811387691706e-01   +1.997947036965162e-01   -6.362435017328530e-01   -4.209330799049409e-01   -6.667493315947114e-02   +9.558244141711008e-01   +1.288809504914038e-01   -5.027846681571015e-01   -3.951038773751241e-01   +7.154163295357219e-02   -4.395847993950583e-01   +6.259278605485894e-01   +1.807980397628178e-01   +4.370665420414415e-02; +9.604870280922054e-01   +3.625351985419950e-02   +5.520160631386979e-01   +6.347758730786479e-01   +8.210288282919596e-01   -2.213715036102937e-01   +4.427421112741267e-01   -1.587818100737411e-01   -1.517095271923327e-01   +2.553523084782383e-01   +3.021249032050941e-01   -3.731481897262156e-01   +4.552142099788372e-01   -2.414963555474646e-01   -6.535079290156789e-01   -9.054189182461700e-01; -3.411024839049190e-01   +5.489355740837313e-01   -1.609533515534494e-01   +5.893043543646896e-01   -1.724638287473342e-01   +7.238040688447583e-03   -4.035412009515090e-01   +1.421784811599831e-01   -4.582851681620839e-01   -7.418472695339590e-02   +1.003889711980030e-01   +4.471687759755834e-01   +3.009291957332604e-01   -5.410002259407600e-01   -5.004751111424260e-01   -4.862410263172612e-01; +6.204119840256324e-01   -9.362636042235362e-01   -1.656444828460936e-01   -6.900429081269537e-01   -1.396719644988972e-01   +2.183458593553745e-01   -4.482125470214270e-02   +6.651175750644158e-01   -3.170629897372290e-01   -5.790306961159746e-01   -3.192642327534917e-01   -8.829545601280786e-01   +7.747664463570313e-01   +4.564322663623674e-01   -4.511003023142058e-01   -2.132774277706415e-01; -7.123796074034922e-01   +5.847077307733998e-01   -7.200792839314843e-01   +6.349533127144228e-01   -2.163347233556569e-01   -8.337712950499713e-01   -6.107063801316237e-01   -4.052861622857945e-01   -6.067392206105419e-02   -7.370017179330319e-01   -7.367373981684671e-01   -2.245614012683349e-01   +1.173285447864287e-01   -1.918233536902651e-01   +6.102774450206855e-01   -1.320297386192534e-01; +7.328197449639937e-01   -1.316547936180794e-01   -9.639905848243223e-01   +4.226527810093892e-01   +3.192141940392424e-01   -4.606502848276945e-01   +2.426209922278278e-01   +6.010370904156958e-01   -3.952331551719139e-01   -4.557185381349552e-01   -1.872187103663087e-01   +7.138116842896916e-01   +6.827768571999040e-01   +4.827752241375836e-01   +7.890431589747740e-01   +3.158671028085160e-02; -9.077080014252821e-01   +1.662374656008341e-01   -4.469360013991310e-01   +5.307861284045514e-01   +5.912501647751789e-01   -3.879879009661714e-01   +1.653653161964780e-01   -2.748268208692337e-01   -6.699048870410398e-01   +2.975877379587036e-01   -2.783914380641752e-01   -6.037899569148961e-01   -5.134002182526924e-02   +1.884760286166113e-01   +1.526469866149898e-01   +5.796792648788791e-01; +6.111465098849754e-01   +4.820306441593463e-01   -1.010415249445135e-01   -8.679312963382841e-01   -2.714332634597940e-03   -8.017511483722302e-01   +5.885056646376079e-01   +2.557567209817023e-01   +1.629695414555000e-01   +3.424387899226636e-01   -5.107908509004890e-01   +6.624926470747904e-01   -1.179923408800900e-01   -6.352239571706784e-01   +1.534856722911408e-02   +7.822315564557321e-01; +2.371311187373997e-01   +3.044727293397681e-01   -5.003912320479850e-01   -2.715025596143781e-01   -1.192849835721948e-01   -4.222423706149298e-01   -6.144694582199645e-01   -9.557611714992933e-01   -2.032491419613389e-01   -1.618919650503196e-01   -2.249967849086300e-01   +2.929658697602872e-02   -3.151411009157774e-02   -9.653849835825384e-03   -9.609641940868546e-02   -6.342528258939852e-01; -4.474807300714040e-02   -6.537049444416054e-01   -6.035873527577504e-01   -2.585437602932332e-01   -2.440674056160579e-02   +4.961829822881922e-01   -2.048479555032544e-01   +4.555471469072624e-01   +4.946960831704034e-01   +7.048711655650629e-01   +3.694349396341167e-01   +4.448014528031066e-01   +6.235095018136215e-02   -7.015589998972460e-01   +3.897544033393404e-02   -7.812964325999424e-01; -5.701977887054009e-01   -4.882877769617445e-01   -7.984757979239168e-01   -5.877862624196830e-01   +1.895984882114844e-02   +8.334431033342006e-01   -3.686941294227553e-01   +8.339649422469482e-01   -8.243745076835860e-01   -2.787501680643387e-01   -7.460835175965432e-01   -1.191345595639210e-01   +2.130329074725343e-01   -2.798926325351775e-01   -2.488474802674930e-01   -6.770607998913952e-01; +8.617117787103471e-01   -2.778838917458054e-01   +8.417518648262626e-02   -1.023246559640839e-01   +3.419636651540698e-01   -2.293248852835761e-01   -6.834423011197661e-01   +3.021006354862167e-01   +6.285797317289066e-01   +1.561047026736797e-01   -4.941685610784616e-01   -2.062687663248885e-01   +3.883824089390014e-01   +1.428173014364741e-01   +6.977858869670552e-01   +8.799412248206607e-01; +6.859672224362954e-01   +4.929304047523808e-01   +4.050679421057191e-01   -7.197601697894992e-01   +1.826174696293623e-01   -7.172576981702170e-01   -1.185346853511984e-01   +6.020732518988939e-01   -4.830714923498723e-01   +5.650851620676057e-01   -7.581613993345323e-01   +7.435129554364743e-01   -9.055956575079456e-01   -3.696018037261668e-01   -1.324579102262634e-01   +7.189144331960406e-01; +6.266134520015244e-01   -7.224722583491493e-01   +1.393455148671378e-01   -3.682505719705957e-01   +2.695919228636610e-01   -6.933204373117658e-01   -5.197169437932926e-02   +1.663498538747936e-01   -2.711251059864301e-01   +3.133788557840225e-01   +3.939461631477285e-01   +4.235085174021992e-01   +2.814553494683553e-01   +2.984011961077768e-01   +7.881323427016790e-01   -7.834367601673493e-01; +1.742389992961415e-01   -4.788103912742631e-01   +4.412573930905884e-01   +1.709534530264660e-01   +7.504065186375455e-01   -2.145158199462949e-01   +5.445616675090005e-01   -7.337910828025637e-01   -7.509918362719662e-01   -4.159344724840579e-01   +6.431924958748214e-01   -5.551194233123263e-01   +4.855568621382982e-01   +2.878350791810773e-01   +2.308766516275894e-01   +6.136632265423209e-01; +6.852538207186768e-01   +2.533406810228920e-01   +5.716176527938303e-01   -9.249765064613075e-02   -3.630352346161617e-01   -8.061799516325657e-02   +1.251206420565204e-01   +1.682471310471832e-02   +1.988333737885252e-01   +6.803896528621494e-01   +7.641051912693716e-01   +3.564224222026378e-01   -4.867217281168620e-01   +1.469954578970144e-01   -9.091498782791254e-01   +3.174611300023191e-01];
L1E_L1I_iGABA_netcon = [+5.881837637393226e-01   +4.451428903180440e-01   +3.892969285619474e-01   +7.261362867821689e-01   -4.944994255707493e-01   -2.032816475194406e-01   +3.556990413426049e-02   -8.784859806922506e-02   -8.165860613214241e-01   -4.565445188986718e-01   -7.928676543123412e-01   -1.000000000000000e+00   +3.840425214442333e-01   -1.608908390450703e-01   +1.342040717260143e-02   -7.681173649428223e-01; +7.816211813316299e-01   +1.404849887283544e-02   +6.505738970557419e-01   -2.033352992848931e-01   -2.672205916166138e-01   -3.680619824510231e-01   +7.329062865724435e-01   -3.650806096460894e-02   -3.601606310431306e-01   -4.967961206266258e-01   +5.008918775258698e-01   -5.083445371393391e-01   +7.226342278203237e-01   +9.107230668003061e-01   +5.231941054498204e-01   +1.996532842330966e-01; +4.778292980389648e-01   -4.783608583434667e-01   +1.505892101751244e-01   +1.849962461384495e-01   -2.355949473221575e-01   -1.581029431901069e-01   -4.390651044527208e-01   +4.785193692184757e-01   +7.830464706423536e-01   -1.133923671438841e-01   -6.492840310788566e-01   -3.726123374097290e-01   -9.184084010537372e-02   +8.178773675488853e-02   -2.027438495225738e-01   +6.611033663579013e-01; +1.683822286400914e-01   -6.869686903779511e-01   +4.336555117886909e-01   -6.344288493837676e-01   +4.749883669773383e-01   -8.179801207731668e-02   +7.117532711419613e-01   +5.685839910373519e-01   -4.885047742531572e-01   -6.905648023588855e-01   +4.311425664464308e-01   +2.412692619003142e-01   +1.700177937733194e-01   +5.555407085027148e-01   -6.049722120948702e-01   +8.559047827055369e-01; -3.698549492871656e-01   +3.751959952699672e-01   +8.087457476280733e-03   -3.748760471067740e-03   +5.344547593065045e-01   -4.403304890866759e-01   -2.491826608308368e-01   +1.331691901408258e-01   +5.254392431295208e-01   -1.145520013418652e-01   +4.545378993650460e-01   -6.759093476837944e-01   +5.794466890205361e-01   -5.396651132983984e-01   +3.965767366962542e-01   -7.401642738044175e-01; -2.410579726538240e-01   -2.158242090472164e-01   -8.569056617008497e-03   -5.541081047874599e-01   -4.072923417512169e-01   +4.716486287830675e-01   +4.470124616389949e-01   -9.607989464815372e-01   -5.234644217099519e-03   -8.314677533355705e-01   -2.406806216600917e-01   +2.489517282613504e-01   +3.722598342283355e-01   +3.031153650446944e-01   +3.775153511193166e-01   +6.469237664271726e-01; +7.483059300792753e-01   +3.806256796674589e-02   +1.233100141401415e-02   -1.456821968896158e-01   -6.624032202122523e-01   -4.969092071764066e-02   +2.681147455609048e-01   +3.118590698105462e-01   -8.890676360740127e-01   -2.846025576974206e-01   -3.652397948802991e-01   -1.435186544636313e-01   -5.941946960564516e-01   +4.970442782821803e-01   -3.505103598105418e-01   +5.951431072151793e-01; -3.740182961030473e-03   -1.236788819405608e-01   +6.261826697722684e-01   -1.453209433615319e-02   -1.634490639311515e-01   +4.748743604875292e-01   +5.032702985250488e-01   +8.541928511667762e-01   +4.232339936982545e-01   -2.701397404338537e-01   -7.052994502899487e-02   -6.851332499875631e-01   -4.334667519859661e-01   +6.728372200364455e-02   +5.648135907031058e-01   +1.108665623326571e-01; -2.259307709428074e-01   +7.698599828131801e-01   -3.804521189216031e-02   +4.487599263959621e-01   +3.483044743139993e-02   -3.650284755126276e-01   -2.958491302691600e-01   -6.942415623703885e-01   +2.705982990946238e-01   -3.800568937558045e-01   +4.929931661431698e-01   +3.741336706559345e-01   +8.491316638989778e-02   +7.606359016383321e-02   -5.061241408233749e-01   -3.106390553532972e-01; +3.506583389386259e-02   -9.926029150143356e-01   -5.931557810942398e-01   -4.041924832823981e-01   +2.734969475478847e-01   -2.126919791333555e-02   +4.601716301253710e-01   -1.650945246359504e-01   +8.766188078558519e-02   -5.636103075674316e-01   +5.486674696805142e-01   +1.547202728857513e-01   -7.201890602936333e-01   -2.414281397646367e-01   +5.762239855917033e-01   -1.687349891401394e-01; -6.230602059573563e-01   -7.145623401783120e-01   +1.149399877204566e-01   -5.098446218824204e-01   -6.486543944140705e-01   +1.103698835867031e-01   -1.836817936273507e-01   +7.419146276535992e-01   +4.289033352230753e-01   -6.236029919786134e-02   -5.285218757947752e-01   +4.800444140175890e-01   +4.512686150014464e-01   -3.964549561840339e-01   +3.065172537441899e-01   -2.428464546708867e-01; -4.771884986935174e-01   +4.077486119704138e-01   -1.155162115839166e-02   +1.963983744708035e-01   -3.875064953492519e-01   -3.633941425717933e-01   -6.625789733862267e-01   -1.369236517490088e-01   -1.775790789301105e-02   -3.426312907118200e-01   +3.075183311177882e-01   +4.737888055652404e-01   -3.375582972127087e-01   -5.698225125405331e-01   +1.723545314239464e-02   -4.797481469194399e-02; -2.041186384653197e-01   -5.674977413596511e-01   +6.555193257037710e-01   -6.409829841522433e-01   +3.298634905739422e-01   -4.225530516440545e-02   +3.934051085329907e-01   -8.784248017237488e-01   +4.016704736072015e-01   +2.140352008754876e-01   +5.969237310623829e-01   +3.932478036052052e-01   -2.132188494678659e-01   -3.956453287094408e-01   +7.670719007749742e-01   +7.638861660546492e-01; +1.946505775002363e-01   +6.611611513829523e-01   -3.807252852720653e-01   -5.501148702559395e-01   -3.488710986885991e-01   -3.154153429175484e-01   -2.152427675462878e-01   -5.982903404517886e-01   -5.343567139322771e-01   +1.349236555167466e-01   +1.915165387872955e-01   -4.205625868324655e-01   -2.285530294628043e-01   +2.340595956350436e-01   +4.196841999398085e-01   -1.058517791140133e-01; +3.568152811501393e-01   +6.078056588139619e-01   -5.793221110810304e-01   -7.177567502811432e-01   +1.892484308313823e-01   -5.131611143628783e-01   +4.591635833629860e-01   +3.242008877704658e-01   +5.527937036095791e-01   +1.536102725262775e-01   -4.103344470866219e-01   -1.498486108453637e-01   +6.008829809935322e-01   +4.649482817292163e-01   -4.559535541914432e-01   -4.466163867489088e-01; +8.831527034398257e-02   -1.571180197346836e-03   -6.380446065315365e-02   +3.497055205010418e-02   -4.004982960626819e-01   -4.721779007117523e-01   -1.903423356181735e-01   -2.224563747809001e-01   +6.250802208337023e-01   +7.435790999196992e-01   -4.011188548093918e-02   +2.626528233930227e-01   +6.570375515185116e-01   +6.798379724153985e-03   -4.391448566891044e-01   +3.192432554633141e-01];
L2I_L1I_iGABA_netcon = [+1.542518756067801e-01   -7.366646950544269e-01   +2.808511998726186e-01   +6.088243597708165e-01   -1.081652622424177e-01   +1.040385319795428e-01   +8.426940376467104e-02   +4.288075926884053e-01; +4.426582487481696e-01   -1.667638275109601e-01   +4.473255554025095e-01   -1.726038520759768e-01   +2.433518643335677e-01   +2.060342712599719e-01   +5.687060589476885e-02   +2.587656280318679e-01; -7.922299154604439e-01   -8.063809515288999e-01   -1.836093591195389e-01   -4.095003415926630e-01   -1.161482831555461e-01   +2.315419056206790e-01   +4.075478230195613e-01   +7.981537143616400e-01; +3.183679734270401e-01   +9.740864839754971e-01   +5.925874793291787e-01   +4.634673830916231e-01   -5.554211229819356e-01   +6.305228413455246e-01   +4.896592760043817e-01   +2.587811858464452e-01; -8.085607909136826e-01   +6.298902612815445e-01   +2.663479484837159e-02   -1.287757543431669e-01   +3.774005707689463e-01   -9.008073511337347e-01   +7.016753422949003e-02   +5.210627354804219e-01; -3.038061394954408e-01   -1.124007841633840e-01   -2.470029020069280e-01   +3.447515898573105e-01   -6.912855091788199e-01   +6.611630236580671e-01   -6.461762214511079e-01   -4.472057254070634e-01; -5.674284156427292e-02   -8.434208894745510e-01   +9.265666311307296e-01   -1.739160612565510e-03   -3.774741094671749e-01   +4.329163998627415e-02   +4.387768071984929e-01   +7.497058599243640e-01; +8.812893980373081e-01   -2.110868608171335e-01   -5.803707437179961e-01   +5.938889467263108e-01   -5.894172533525460e-02   +1.359480728211371e-01   -5.791686245644547e-01   +1.530016656345929e-01; -5.087830745840706e-01   +1.955394421582461e-01   -7.313129483626919e-01   -4.491246867519816e-02   +2.070985010505291e-01   -4.378261773205638e-01   +7.764489627202110e-01   +1.304602737745623e-01; +8.977444564025461e-01   +2.020487147887099e-01   +2.116633879044451e-01   -3.256204707626017e-01   -3.694835622788199e-01   -4.112045353979291e-01   -5.507624762457550e-01   +2.249721554598479e-01; +2.446915198322169e-01   -8.269806370184163e-01   +5.715147425042093e-01   -2.186790727393224e-01   +1.988553787511938e-01   +2.949025870434778e-01   -1.410578215549296e-01   +3.958095685521772e-01; -2.232819179761913e-01   -4.950314096922254e-01   -2.578570072679091e-01   +6.084997343666944e-01   +3.257412674980957e-01   +5.738797582231325e-01   -2.083797467125175e-01   +5.466051381560977e-01; +4.587766633100782e-01   +3.265416482247288e-01   +4.901308612101170e-01   +9.346636029574069e-01   -7.017756470636977e-01   -4.961680414830164e-01   +1.000000000000000e+00   -5.623380335002091e-01; -3.907202159120012e-01   +6.265792756135574e-01   +8.854248822706159e-03   -6.192900809350047e-02   -2.568141978473364e-01   -2.052599430596230e-01   -1.697838493934108e-01   +7.183353493868179e-01; -4.119803884733043e-01   -7.644359087764846e-01   -1.226863879635517e-01   -2.382740363728023e-01   +4.402996806957174e-01   +2.376867385650338e-01   +4.221780990735240e-01   +1.120900308103210e-01; -7.519220683908402e-02   +1.432581023266732e-01   -6.869724289487337e-01   +3.324054856634943e-01   +2.828481652197309e-01   +6.410244748980972e-01   -6.630611157302995e-01   -1.316758742504068e-01];
L1I_L2I_iGABA_netcon = [-3.838661831840626e-01   +1.858120730316911e-01   -3.395008096830461e-01   +1.906469802327584e-01   -1.465891257928036e-01   -2.900263792149311e-01   -3.155513857254647e-01   +1.899767209948087e-01   +4.255442649253743e-01   -7.429891822748367e-01   -1.000000000000000e+00   +6.882161000717261e-01   -8.207656864045874e-02   -3.357233921308431e-01   +7.329533844624442e-01   +6.299361978202798e-01; -5.686055051355371e-01   +3.813397226788382e-01   +6.190470157830619e-01   -1.801535022070668e-01   +3.597460370660645e-01   -2.702643631452520e-01   -7.069937327442090e-01   +1.427288142175062e-01   +1.074439967229243e-01   -1.865268901674449e-02   -6.704290962452168e-01   +1.498600414918161e-01   +7.129855994194696e-01   +3.210994772519902e-01   +2.155028639431083e-01   +5.850818091414440e-01; +5.947599734197864e-01   -1.865360615486668e-01   +4.525957079296687e-02   +6.643955018947475e-01   -6.904391904748584e-02   +4.331816500676510e-01   -4.708718382068018e-01   -1.832924343823603e-02   +3.683251292792410e-01   +1.776655979363656e-01   +2.778415011128787e-02   +4.948859319688061e-01   -5.463189462629571e-01   +8.192389598877410e-01   +3.757696170653752e-03   +5.625214019112716e-01; -7.492795305733131e-01   +1.087750872695900e-01   -5.984592572231107e-01   -6.674855039198745e-01   -9.641815586996643e-01   +2.725808966661915e-01   +9.574867956870926e-02   -2.772759146347155e-01   -5.689316575093477e-01   -8.681741873631245e-01   -1.199793599100501e-01   -2.733244401261558e-01   -3.449257135080629e-01   +3.947013712107804e-01   +6.060989921566013e-01   -6.833275752135908e-01; +6.997675760863675e-01   +9.462878474448023e-02   +3.770273528866650e-01   +4.708106190569422e-02   -6.294209711444778e-01   +4.043182470817628e-01   +7.564274318008299e-01   +6.868607110200156e-01   -3.086513354681574e-01   -3.639307544561635e-01   -6.842133199424519e-01   +3.160403102373570e-01   -8.073993346421404e-01   -4.055495017801187e-01   +6.014567373859285e-01   -8.801039016417805e-01; -6.709961642295393e-01   -4.565225531772205e-01   -1.890812471102018e-01   +5.303355404374704e-01   -7.811833401103145e-01   +8.060406791668286e-01   -7.799069432421449e-01   +7.362127626517528e-02   +5.452864488931171e-01   -8.529630533545105e-01   -8.768947270153107e-01   +1.694957090899976e-01   -2.821136264786909e-01   +2.758451250267067e-01   -8.291577398007548e-02   -2.852940369954646e-01; -7.860496440055154e-01   -4.132098338323257e-01   -7.093618250694004e-01   +7.592636070411946e-02   +5.137737582102490e-01   +2.810371735137941e-01   -1.488187769522963e-01   -1.289259901856257e-02   +6.577070712808258e-01   +5.566236071250242e-01   -5.794120078940663e-01   -6.508204023459150e-01   -2.665307376156369e-01   +6.381534918407408e-01   -1.602220137750981e-01   -3.536712852719194e-01; -8.918051909679422e-01   -3.215141782261360e-01   +1.995158589604894e-01   -6.103221818116243e-01   +3.072682036898491e-01   +5.370631511288541e-01   +1.916243065969327e-01   +9.318292870517045e-01   +7.814942856903830e-01   +7.731310785090900e-01   -5.689421839647913e-01   -2.316201164355226e-01   -1.244447352881284e-01   -7.637356935436618e-01   +3.126190937485243e-01   +5.481912019747887e-01];
L2E_L1E_iAMPA_netcon = [+2.290776761815370e-01   -5.148883769152738e-01   +3.074169201899808e-01   +3.531697856220971e-01   +7.232927585363519e-01   -5.221628580381582e-01   +1.967039330089022e-01   +6.703941549434219e-01; -7.171827854189288e-01   +5.214617987295173e-02   -4.225966645479268e-01   +4.717162048285514e-02   +3.263379386580723e-01   -7.886207179677425e-01   +1.999109370638860e-01   +1.825129944805966e-01; -3.001422080690705e-01   +2.180056009969251e-01   +1.279913385170761e-01   -1.737894075549020e-01   +4.347883338412241e-02   +9.418083700719652e-01   +3.655051390679181e-01   -8.959727199526395e-01; +8.324067112644385e-01   -1.866545970091238e-01   -6.824267396174379e-01   -7.115727938070527e-01   +2.711016466221787e-01   +6.416616806285699e-01   -3.991312076532833e-01   -1.858394292227828e-01; -7.609312354512598e-02   +5.880877507014783e-01   -4.141709862036601e-01   +1.429511586076907e-01   +5.287203201484937e-01   -2.047021196237309e-02   +6.913502880388972e-01   -7.382715433536922e-01; +7.182867150580665e-01   -3.278529038777610e-01   +2.435598303933444e-02   -1.424827403227860e-02   -8.378601032083494e-01   +7.596894490008903e-01   +4.366506503179169e-01   -6.027128192677084e-01; +7.338524357400197e-01   -5.262361222614160e-01   +2.012248986637385e-01   -2.400309470169039e-02   -7.016700851254656e-01   +5.172029236861836e-01   +7.493547697612324e-01   -6.225346315888527e-01; -5.923469996820039e-01   +2.744707024800476e-01   -4.135352975266849e-01   -1.954224222156475e-01   +5.789681451573411e-01   +5.408781828317265e-01   -9.163903548688372e-01   -5.153145208238803e-01; +4.267685851487848e-01   -1.773679475951481e-01   +6.065327426042250e-01   -2.140704310493070e-01   -2.506869985854813e-01   +6.662041675523369e-01   +6.581524730182767e-01   -9.021402026738284e-01; +1.913954847165023e-01   -4.809395411484926e-01   -3.660005079143321e-02   +2.874380326085058e-01   +2.322636762668326e-01   -3.888692800886155e-01   -5.465445981420922e-01   +4.247580995980154e-01; -1.166604882660940e-01   -6.318359728562377e-01   +5.262178068401180e-01   +5.502159845043252e-02   +8.064545196144766e-01   -9.751724183664047e-01   -6.933069776673731e-01   +5.187828773904031e-02; +3.107055052514485e-01   -8.475734389532309e-01   +4.006997002230437e-01   -5.447376943449973e-01   +7.748169950572524e-01   -5.448288152554670e-02   +1.844984175342973e-01   -4.051078929232554e-02; -3.132369521088079e-01   +6.391498995063261e-01   -2.961730687730256e-01   -5.427599746751536e-01   -5.166797943823600e-01   +2.992258434991025e-02   +5.444113233751141e-01   +7.079504876863728e-01; +1.763898288348387e-01   -2.159314785115276e-01   -6.058288461327784e-01   -9.500052182994145e-01   -3.692138761595420e-02   -4.627202498362080e-01   +6.600944274004754e-01   +5.972690881311029e-01; +3.972808214579118e-01   +5.507999702027098e-02   +8.190290959677275e-01   +4.922033900472929e-01   -5.626903616343083e-01   -5.805097199937965e-01   +3.089410591382145e-01   -1.783140172603236e-01; -9.528244065024460e-01   +5.664607046923265e-01   +7.427336127960106e-01   +4.788038465035745e-01   -3.879828530569594e-02   +3.138784881678154e-01   +4.299210054192075e-01   +9.245224343149031e-02];
L1E_L2E_iAMPA_netcon = [-2.611176513864112e-01   +5.868262419237835e-01   +1.998241616973503e-01   +7.049962891946914e-01   -1.103679677505604e-01   -9.197083149113037e-01   +9.529880941055955e-01   -3.734744606767861e-01   +3.391437864890601e-01   +2.420193383151428e-01   -4.971586091029458e-01   +6.517386101961017e-01   -4.441789744872282e-01   -7.755614131600008e-01   +2.508833173722851e-01   +3.716321661413230e-01; -1.537102391461216e-01   -3.681086447871475e-02   -8.519216387108449e-01   -8.594021798425535e-01   -8.139730521722812e-01   -4.358483073590303e-01   +1.762276226822198e-01   -8.227232236815315e-01   -6.476316860795865e-01   +8.420874858468704e-01   +6.325980363845407e-01   -4.620599882784009e-02   +5.983793378938044e-01   +5.891838804615069e-01   +2.509877304484523e-01   -8.039012411949444e-01; -7.318138534533888e-01   +1.473102756244199e-01   -8.433058104676900e-01   -3.495364307820107e-03   -8.792723508565908e-01   +1.928085693456002e-01   -6.917534772960064e-01   -1.673494973141452e-01   -1.000000000000000e+00   +4.377452932633112e-01   -6.634644725729040e-01   +9.428162438348769e-01   +9.538767333013244e-01   -2.883145400953506e-02   +3.681968737476160e-01   -1.033573055092067e-01; +4.198955174229802e-01   +4.165884892806463e-01   -1.210612636418352e-01   -1.611007715360193e-01   +3.995725226603891e-01   +3.819310882427898e-01   +2.368184084052987e-01   +5.858485867038188e-01   -1.929442955230464e-01   -8.691229213129256e-01   +6.931215837746576e-03   -9.285241794290590e-02   +4.333777376538603e-01   -6.044653883571433e-01   -8.553520732493156e-01   -7.387831416251639e-01; -3.215146538861374e-01   -9.781906229011514e-02   +2.376873706130045e-01   -3.481595116930529e-01   +3.880725239144964e-01   +5.062288813094973e-01   +5.787741560969756e-01   +3.558350014495913e-01   -3.523127534385987e-01   +8.891765440674304e-01   -4.155471053527589e-01   -1.262421929947397e-01   -9.036315257120233e-01   -4.706288934589659e-01   +1.226413134663879e-01   +1.381707470803375e-01; +5.495103067730373e-02   +4.163805608879891e-01   -2.446648437081385e-01   -5.054755819378360e-01   +3.266878582379337e-02   -2.151197101330966e-01   -7.246107921513891e-01   -2.953289182675521e-01   -3.219862603355479e-01   +4.715353840398373e-01   -6.449521042256555e-02   +4.038057586709583e-02   +4.237829381853726e-01   +5.366549915948469e-01   +5.790066335249313e-01   -1.125370548890549e-01; +7.095704927761752e-01   +2.914718439003077e-01   -6.223920034389475e-01   +7.521593110700624e-01   +2.467272297167646e-01   +8.303801099585558e-01   +5.441270878492348e-01   -2.346327705538770e-01   -2.183736706963705e-01   -7.969445787389778e-02   +6.840213375106897e-01   -1.889946654323936e-01   +6.679197479932598e-01   -3.927723007867022e-02   -5.554880048018038e-01   -4.054086330699802e-01; -9.557129430592927e-02   -1.571134775871997e-02   -6.199736014308650e-01   -2.225213854170754e-01   +7.942111522990462e-01   -9.837473161121556e-02   +2.610038985467585e-01   -2.311754211377975e-01   +6.256856922340497e-01   +5.813058236515486e-01   -6.215628233860941e-02   -1.143730026710924e-02   +1.472104660716230e-01   -3.062910256336924e-01   -3.709362585288036e-01   -3.963828991643696e-01];
L2I_L2E_iAMPA_netcon = [-6.255443448972975e-01   +8.154742910470663e-01   -5.091706369523651e-01   +1.134426837832136e-01   +3.429186721008904e-01   -2.099813652598076e-01   +7.947412330037802e-01   -1.377644862289338e-01; +3.646915014965129e-01   -6.734602481642883e-01   +4.219996563500487e-01   -6.592667716243205e-01   +8.345142992421068e-01   -8.041154525329749e-01   -1.720793886479842e-01   +6.356997883100388e-01; -7.506646559491195e-02   +3.942718846625557e-01   +1.843137692679498e-01   -1.856725430374183e-01   +1.898396380669416e-01   -3.103924513381249e-01   -2.728443771775708e-01   -1.059726877051184e-01; +8.203150113466921e-02   -4.682635787348347e-01   -7.745606924389988e-01   -5.767113784228945e-01   -1.486945740947923e-01   +5.919206524292828e-01   -2.958135961411920e-01   +5.341921941297613e-01; +1.111631686800573e-01   -3.612197206114103e-02   -4.001438283730824e-01   -6.039538492088090e-02   +5.697634181420728e-01   +7.385811942751896e-01   -6.321337556146747e-01   +3.168437257601605e-01; +7.290240431124364e-01   -9.986294154533335e-01   -4.192954967457052e-01   +3.069911779816848e-01   -4.425873058811290e-01   -5.631670848700341e-01   +8.047113791240501e-01   -6.586569159709620e-01; -5.601280867762557e-01   -2.095393233908170e-01   -2.416251147929683e-01   +7.754717143005966e-01   +3.692686315261074e-01   +7.019510127097963e-01   +5.578785541179161e-01   +9.207984542969470e-01; -9.306255334204447e-01   -2.393028101491616e-01   +7.717199144551955e-01   -3.637789175129899e-01   +3.435873257156196e-01   -8.408048706977569e-01   +1.462981694970722e-01   +6.169335218685957e-01];
L2E_L2I_iGABA_netcon = [-7.646247379201845e-01   -6.052459546284283e-01   -7.257623543177784e-01   +5.675251245260882e-01   -6.589623177975079e-01   -4.369785885289355e-01   -6.423431655916014e-01   -3.066628446274117e-01; +2.514040061676082e-01   -7.567123826939596e-01   +3.511260812743895e-02   -1.884929887370861e-01   +2.805485296410396e-01   -7.897677432596203e-02   +8.526478214872359e-01   -7.116036700488152e-01; -4.440913349381420e-01   +8.916595929907303e-01   +4.638747077191365e-01   +1.468676654987409e-01   +3.266827323663453e-01   -9.386835292190084e-01   +8.517307115617804e-01   -2.779878570992813e-01; +1.089301516185618e-01   +2.897801195820023e-01   +2.519799067441676e-01   -2.695371012824659e-01   +8.895110589531501e-01   -6.214054731206353e-01   -5.145161465359345e-01   -8.872472262460315e-02; +4.890840084024949e-01   +5.930051592726546e-01   -2.219453613376493e-01   +9.532244734905571e-01   +6.586799962240882e-01   +5.283994318283763e-01   +1.886708308148327e-03   -6.141899165929311e-01; +1.570280656643816e-01   +3.996923925666722e-01   +5.942170385392295e-02   -1.580925879141152e-01   -8.745196008877709e-02   -1.695625641921966e-02   -3.252632471198083e-01   +3.251169604087061e-02; +4.240153059682544e-01   +2.200019031139607e-01   +6.040515016029830e-01   +5.676261568097400e-01   -7.108850052531932e-01   +7.449077667028380e-01   +5.989890071156497e-01   -5.452776675710258e-01; -8.265962684399975e-01   +3.013470685284873e-02   +2.975922506742505e-01   -3.345655893103274e-01   +9.605637252684571e-02   -3.322027923224257e-01   +2.362173705543243e-01   +9.131352439874549e-01];
L3E_L2E_iAMPA_netcon = [-3.817298671173625e-01   -6.708815506529052e-01   +1.706504257070915e-01   -7.075928640584043e-01   -1.902971393097080e-01   -1.582487757158099e-01   -2.469921589951897e-01   +6.259326662938924e-01   +4.924686449821199e-01   +6.119581065886832e-01   +1.116564728659804e-01   -1.319947365890211e-01; -7.172758193653477e-01   -1.335656275266072e-01   -2.975236136023471e-01   -5.983455488759536e-01   +2.942939371060691e-01   +4.778680428548236e-01   +3.534544408255938e-01   -3.844159865622545e-02   +2.967460295162133e-01   +3.498273174564785e-01   +1.373509791477953e-01   -5.674616321006132e-01; +5.779495376473186e-01   +6.207208968303819e-01   -8.958465124608292e-01   -5.630606460953167e-02   +3.798807652630464e-01   +4.229738944630519e-01   -1.489610406989045e-01   +2.654418687142046e-01   -5.577136009090123e-01   +6.284295672269173e-01   -4.881519280354729e-01   -5.189034579771787e-01; +3.668062316987530e-01   +1.603000313019455e-01   -6.746964297657778e-01   -5.191257678404093e-01   +5.880989855443682e-01   +1.900129520249352e-01   -6.898713795450276e-02   -5.791764541573597e-01   +2.430467633971052e-01   +3.977043296179275e-01   +7.786534301386411e-01   +2.167938225953402e-01; -2.238080686670394e-01   -3.751513509029002e-01   +2.948350014934384e-01   -1.049483725218953e-01   -3.157629540651433e-02   +9.137105905176329e-02   -4.681214072665906e-01   -1.629540781952204e-01   -4.408165517268834e-01   -7.749993338127652e-01   -3.777114743433548e-02   -6.251282886501093e-01; -5.248120616372711e-01   +5.110014894974262e-01   +5.473731599483327e-01   -6.922908400046998e-01   -8.389939890758952e-01   -6.077576588518714e-01   -3.471692404239817e-01   +2.619715297165155e-01   +4.870258357989815e-03   -1.747105721803566e-01   -8.092862249927122e-01   +5.662236161197811e-02; +1.662054915107152e-01   +4.241098749554651e-01   -5.718081809051377e-01   -4.283653531635604e-01   +6.979781996418980e-01   -2.038906021175071e-01   +6.220488421997596e-01   -4.961030017254013e-01   +1.500816459056047e-01   +4.974043359653498e-01   +4.840632035375696e-01   +6.527092805998885e-01; -3.578355626924756e-01   +4.161054250209693e-01   +6.905546867996526e-01   -9.234615374779829e-01   -2.226113527247821e-01   -5.336026624343005e-01   +8.786300934190456e-01   +6.094359734421557e-01   -4.136020368514766e-01   -1.698165721553623e-01   -6.511796931564868e-01   +1.000000000000000e+00];
L3I_L2I_iGABA_netcon = [-7.189861026236641e-01   +8.183658171968984e-01   -5.325744288943023e-01   -3.077591431531391e-01   -6.120503350277965e-01   -2.787631775239547e-01   +6.476885295269403e-01   -3.138771174079811e-01   -8.920165090620479e-01   -4.871754191705579e-01   -2.349474177873778e-01   +5.999214741727525e-01; +2.080712363198468e-01   +6.208693467950412e-03   +3.110375965977169e-01   +1.707854522179494e-02   +4.174875542864424e-01   +5.173566329427981e-01   +4.439554473729527e-01   +9.181811066080528e-04   +5.698974864755771e-01   +8.532867289433237e-02   +6.747086801814735e-01   -8.988901399052895e-01; +1.701082110990732e-01   +9.789409162668445e-01   +4.397144134727570e-01   -3.342867635327152e-01   +2.787963205692055e-01   -5.539911897182147e-01   -4.054482675642173e-01   +2.780756451166059e-01   +7.023668957505870e-01   +1.623007271019206e-01   +5.136700973653417e-02   +2.234542731555322e-01; -6.797881664823442e-01   -6.193069104145735e-02   +5.002952481795490e-01   -6.865033082044973e-02   -5.596488894765856e-01   +2.925809225223059e-01   +1.860147942309802e-01   +6.504757919529718e-01   -4.297545711757618e-01   -9.441552595801712e-01   -1.049018262329498e-01   -5.703888873704442e-01; +3.118000258284425e-01   -5.223540740180994e-01   -4.123651402588318e-03   -3.223116101138757e-01   +7.164431896646353e-04   -2.954768513362543e-01   -9.844236212583957e-02   +2.611537844588107e-01   -2.111102648976911e-01   +2.073200852305876e-01   +3.318575615145248e-01   +3.653883411010550e-01; +8.139371668462739e-01   -5.979116255960766e-01   -2.895161780787208e-01   -8.115681399918795e-01   -6.518706020001949e-01   +1.088622049808765e-01   -4.079044856825080e-03   +7.526509623678405e-01   -1.001211629688778e-01   -5.776715314145486e-02   -9.478515625899371e-01   +8.199200258254570e-02; -8.101437293433144e-01   +1.331113002047574e-01   -1.673628324722086e-01   -2.110310688427168e-01   -1.212044142055594e-01   -3.942713202097758e-01   -5.462783958125719e-01   +8.442142646618723e-01   +7.933015695994499e-01   -2.219144927281630e-01   +1.197538872561444e-01   -4.228629830605536e-01; +4.079753061416023e-01   +1.935801233117967e-01   +9.613862082962437e-01   +5.238611261310072e-01   +2.280435295788665e-01   +6.988329825881207e-01   -7.126961717087564e-01   -5.724533104450014e-02   +2.592369154676495e-01   -8.632034733209331e-01   +3.146756765347720e-01   +5.491395667223593e-01];
L2E_L3E_iAMPA_netcon = [+1.000000000000000e+00   +1.079438034976535e-01   -6.137779838174998e-01   -7.767164595605898e-02   +1.218968256585517e-01   -5.610136202530700e-01   -4.449408059269964e-01   -7.150820323214848e-01; +4.099086984979317e-01   +1.377568000037933e-01   -1.613791396352799e-01   -4.454034471063080e-01   -1.897435102322307e-01   +2.203295928098615e-01   +4.967077805922440e-01   +1.334826137436055e-01; +4.531657986644872e-01   +1.139667437674660e-02   +3.289805115234501e-01   +3.210010682132373e-01   -2.098291548074001e-01   +2.915343865474708e-02   -5.806030775925495e-01   +1.382038820247730e-01; -6.049674421855388e-01   -3.191416802844821e-01   -2.331702684487481e-01   -2.974240126185639e-01   +7.636356633938765e-01   -3.247219328272112e-01   -1.518887187268682e-01   -1.951788999284637e-01; +2.851934442439718e-01   -5.985660185201011e-01   -5.858332812659477e-01   +2.789906959579392e-01   +6.021058057016822e-01   -5.067064972017662e-01   +9.921406281571173e-02   -6.477992121708673e-02; -4.616797159755892e-01   +1.264411766869518e-01   +5.866943229385618e-01   -1.411452820520890e-01   +4.974798690680187e-01   -2.782096918221304e-01   +3.208747537675282e-01   -6.036356514433675e-01; +1.806555575004485e-01   -9.001562760387599e-02   -1.355909607887659e-01   +1.815131963721021e-01   -2.819436519814868e-01   -1.589616517251814e-01   -2.344243442527308e-01   +3.022269610655696e-01; +4.308002166243722e-01   +4.601351217049686e-01   -7.537623064634469e-01   +2.085093412964766e-01   -3.490839904534556e-01   -3.459579681272332e-02   -1.836862598106513e-01   +5.833154767870541e-01; -1.952219567737376e-01   -4.999567766095619e-01   -1.181379393445950e-01   -3.052743132101008e-01   -8.112730533581117e-02   -3.318449334028698e-01   -1.416650563610835e-01   -6.417496577015383e-02; -1.382097773922545e-02   -3.742081754368385e-02   -4.318088414582115e-02   -1.084226791899517e-01   -6.499822125401210e-03   +6.314644966283284e-01   -2.112205426459252e-01   -2.792074396086092e-01; -6.080312515585646e-01   -2.064398829257010e-01   -1.522796153771891e-01   -6.364976298131825e-03   -4.697948082620002e-01   +2.156629610204791e-01   +3.476585652991256e-01   -8.893908905255831e-01; +7.015335708217771e-01   -8.913786978887744e-01   -9.309165222892827e-01   +2.973820865123932e-01   -6.065708183962597e-01   -2.481200147134225e-01   -5.957214867211715e-01   -8.586990196216951e-02];
L2I_L3I_iGABA_netcon = [+5.257600268624669e-01   +6.645811198076171e-02   -2.788574889488966e-01   -3.745249182863061e-01   +5.598452937008190e-01   -3.851927075058389e-01   -6.782790750566881e-01   +6.135952697592697e-01; -1.131472604312646e-01   +5.445053737383198e-01   -4.602197405267655e-02   -3.533409431189720e-01   -6.262774817369390e-01   +3.805979959311190e-01   -7.736935559714422e-01   +3.268141114453580e-01; -4.121888083747468e-01   +2.821718560242755e-01   -1.636658573254457e-01   -2.270457051550742e-01   +9.528138757054030e-02   +3.368747569303920e-02   +1.000000000000000e+00   +5.862952192384540e-01; -3.827562756963463e-01   +3.858617410965218e-01   -2.656592723289795e-01   +2.889199706664601e-01   -4.609678281543174e-01   -5.433203534732954e-01   +2.225450105609216e-01   -7.089053438358437e-01; +3.590910527233837e-01   -4.664489847628157e-01   -4.296752718924590e-01   -2.861473801277205e-01   +2.712622076908938e-02   -4.408702791796637e-01   +3.753991373194991e-01   +1.995252646783730e-02; +7.005360880341777e-01   -1.818512588324057e-01   +5.381841652534380e-01   +1.257107586650970e-01   -1.321854686409851e-01   +2.785964477047405e-01   -3.926090473185030e-01   -2.624508143766450e-01; -5.319758477025810e-01   +3.480780445898580e-02   +2.149836833833525e-01   +1.601123353558583e-01   +3.613846826900681e-01   -1.510231510799676e-01   +3.751460945922050e-02   -1.962033511900321e-01; -9.575976509750445e-01   +3.376366892109710e-01   +2.486897278014446e-03   -1.471155473897210e-01   +4.883410476617687e-01   -8.497700565992121e-01   -7.137512319519831e-01   +1.674266543074913e-01; -6.113921352643449e-01   +4.926637480625644e-01   -3.823464060156246e-01   +3.926637725927277e-01   -2.251069273908864e-01   -8.435536731187343e-02   -1.374827802456057e-01   -4.772971603371784e-01; -2.330192169568252e-01   +1.864431065065860e-03   +3.136194032805918e-01   -6.080402711974187e-02   +1.625988558107145e-01   -4.190252800848407e-01   -5.434358451371976e-01   +5.631354040728109e-01; +4.491736328476180e-01   +9.567616014506983e-03   +2.991451120886016e-01   +3.680307363043383e-02   +7.889875108373888e-02   +1.011432128648496e-01   -6.105351411931063e-01   -5.237332201382445e-01; -2.130614110713804e-01   -4.835499940145548e-01   -5.760594090557237e-01   +4.408617080663830e-01   -8.483402515534096e-01   +1.642003734126653e-01   -4.112607406294691e-01   -1.046957996888147e-01];
L3I_L3E_iAMPA_netcon = [-3.103819842436523e-01   +2.380692174291783e-01   +5.227462252361956e-01   +1.991459188983793e-01   -1.612554387245692e-01   +5.687078936233291e-01   -1.466017254328815e-01   -5.630841293595004e-02   +3.509855381200954e-01   +6.321964735932465e-01   -2.232692138421759e-01   +7.236725343476422e-02; +6.603662877055987e-01   +2.806069266607216e-01   -4.945554033539661e-01   -7.374360983188907e-01   -5.620563249578776e-03   -5.863031782137305e-01   +7.831890862763231e-01   -7.712752950724002e-01   -5.477627011148580e-01   +5.998400833203769e-01   +2.814589750888716e-01   -9.018293101716793e-01; -3.604214434287498e-02   -5.794407482397819e-01   +6.315663694694317e-01   +4.222993037590739e-01   +2.266022530153007e-01   -8.067264582042538e-01   +6.639366960830867e-01   -8.686895324350792e-01   -2.629177628792376e-01   -3.636070595847635e-01   -1.940215922108323e-01   +2.190395184289827e-02; +4.655558946526768e-01   +5.960032253803210e-01   -6.526119794663382e-01   -4.520874222445406e-01   -5.481296549402387e-01   -5.362826619481964e-01   +5.030775825813512e-01   +5.278630698344778e-01   -2.254985427928688e-01   +2.453589239980742e-01   -3.153368262503478e-01   +5.566791792455762e-01; -1.499667288658809e-01   -4.531337177297119e-01   +1.105561682981753e-01   +3.122036288994036e-01   -3.146904829288458e-01   +1.987930781795291e-01   -4.168886835210787e-01   -3.377848884119313e-01   +1.832149266607635e-01   +5.683147422382134e-01   +3.965948495184893e-01   -2.042447548122154e-01; -2.309536855486839e-01   -4.308319856912143e-01   -1.005896890787186e-03   +5.203263253006718e-01   -2.382480986621259e-02   -9.176231234968751e-02   +4.620836181792017e-01   -2.204106172962072e-01   +7.521444918466362e-01   -1.516847352368670e-01   -8.072466865297536e-01   +5.234068636646628e-01; +4.084564041837230e-01   +8.387795073826785e-01   -1.000000000000000e+00   +7.162513404873970e-01   -2.560990870125684e-01   +5.278312243584231e-01   +4.181935503535983e-01   +1.256406696726046e-01   -2.736636661962162e-01   -3.046518765757232e-01   +7.200386294338178e-01   +5.811822164238182e-01; +8.427500522086825e-01   -4.580330394554256e-01   -4.442840809211006e-01   +1.168444298290422e-01   +1.021228650090860e-01   -4.049633890201438e-01   +5.166474365799566e-01   +6.230447226009881e-01   -1.948115462226389e-01   +1.880469446969558e-01   +8.152326381383621e-01   -8.649402861379253e-01; -5.008459661179113e-01   +1.513434921250349e-02   -6.880124464967123e-01   -4.532976294844379e-01   +5.860566917992216e-01   +4.625274498303359e-01   -7.470659165739098e-02   -7.970715858282758e-01   -5.598420629200553e-01   -7.786389662262863e-02   -4.993440531877381e-01   +9.215668888335746e-02; -5.479353707390029e-01   -5.483475827875215e-01   +7.910941390572314e-01   -3.961265481090241e-01   +2.778633140088024e-01   -6.723927202153621e-01   -3.426129446022400e-01   +6.254885842261412e-01   +2.241110316846646e-01   +5.303361931369817e-01   +2.177608083417223e-01   +3.382508719001733e-01; -9.131909986851955e-02   +1.087084203610711e-01   -2.933971030025848e-01   +3.911217607709251e-01   +2.371429793467971e-01   -3.840137117524997e-01   +2.330654839880219e-01   +2.674193513882033e-01   -5.773569808521517e-01   +8.644760216671303e-02   -1.394609190759037e-01   +7.598965134153063e-01; +4.504425861955608e-01   +7.498850311260041e-01   +8.794999854951327e-02   -2.596963339212800e-02   +7.279041078781107e-01   +2.728855975910668e-01   +3.748221037797490e-02   -7.203023756438164e-01   -8.308426164786943e-01   +5.786987888683638e-01   +1.577490706509826e-01   +9.559325436496819e-01];
L3E_L3I_iGABA_netcon = [+6.190901820776754e-01   +8.372366259463759e-01   +9.001263083751864e-03   +8.304095234977861e-03   -3.324539627047673e-01   +7.157320903032871e-01   +3.745991742670770e-01   +9.653968558010911e-01   -8.501926179212708e-01   +2.424962183337380e-01   +7.990759542364811e-01   -5.618885373614954e-01; +6.291340258623049e-02   +4.853151319519707e-01   +2.734619469028576e-01   +2.735218051069064e-01   -2.647945364860147e-02   +2.957413972349043e-01   +7.900823396426340e-01   +3.077999873379601e-01   +5.059827944215637e-01   +6.039575031527645e-01   -1.515230198930307e-01   +3.250871089003009e-01; -8.822119773078924e-02   +1.018775497554997e-01   +6.073558908735459e-02   -3.773897690995119e-01   -6.690090135529442e-01   +6.727050947846999e-01   -2.428695744455095e-01   +7.162985507936581e-01   +6.212730388594001e-01   +3.628171617143411e-01   -8.222424233035095e-01   -2.326218128677191e-01; -8.939103741306694e-01   +5.940631745300309e-01   +6.259524394041834e-01   +3.373855669849624e-01   +8.528738256183517e-02   +4.406819622994171e-01   -4.097644646324023e-01   +2.351228615192639e-01   +5.304304989071537e-01   -4.045398013508664e-01   +1.155448787326410e-01   -4.691524247099855e-01; +4.850031873817974e-01   +5.839752951570057e-02   -9.847340870466230e-02   +5.688550902926146e-01   +3.673580108687446e-01   +5.301569888908301e-01   -5.789078656930302e-01   +1.502644520110362e-01   +3.081508235065158e-01   +5.010790706190382e-01   +9.529282539475780e-01   -5.026010960467302e-01; +7.314042813516883e-01   +3.353094344232250e-01   -7.931755787339277e-01   +1.825418875144683e-01   -7.129709350485421e-01   +3.845185678674331e-01   +6.762299565535207e-01   -3.499386295906450e-01   +8.845725595664206e-01   -5.858557993730540e-01   -2.206216154567927e-01   -5.824708411969217e-01; +8.558492775470755e-01   +4.639473872415123e-01   +6.887540557795652e-01   -3.744103748247649e-01   +3.768809478528831e-01   -1.722155756776977e-01   -2.566941457720191e-02   +8.542728111151141e-01   +5.797715435047432e-01   +2.800537412436466e-01   +5.214839887630587e-01   -1.345117313773971e-01; -3.383695341702616e-01   +3.724622664938337e-02   +2.675541389713340e-01   +1.098026831143532e-01   +8.238105341156337e-01   +6.954274952151788e-01   +7.806377957398881e-02   -6.971413868493780e-02   -3.341460843298353e-01   +7.922652637514870e-01   -4.867280275703055e-01   +3.584952782415008e-01; -6.804548085200965e-01   -2.336128121785440e-01   +9.055055520553232e-01   +8.724290048853328e-01   +3.448838715223230e-01   +4.814912113992786e-01   -2.199294773445372e-01   +1.144250281898324e-01   -4.511371109688921e-01   +7.015522862262127e-01   +5.928621553450630e-01   -3.570465535003970e-01; +6.452469291800120e-01   +4.510308156005270e-01   +7.334856091235616e-01   +6.470654897643506e-01   +2.613281566029466e-01   -2.550971908831616e-01   -5.177824872800343e-01   +3.964074913246068e-01   +3.967192759393297e-01   +1.914303160192312e-01   -3.740447811228471e-01   -3.421925798933690e-01; +7.222452131881524e-01   +2.012328119972880e-01   +3.724698805737851e-01   +5.046324084833812e-01   -1.298240611305807e-01   -3.348228005641185e-01   -1.449669472751089e-01   +2.831374259554371e-01   +4.357986330333622e-01   +2.752749051735700e-01   -3.331927078194515e-01   -3.679173962110701e-01; -5.313324112815035e-01   -9.654741629328494e-02   -1.149136371371483e-01   -1.000000000000000e+00   -4.446424583979633e-01   +6.471740158629445e-02   +4.525285073859643e-01   -4.172078484143831e-01   +7.426901280751054e-01   +6.347181530100687e-01   -2.127685092778643e-01   -4.849665520893284e-02];
L2E_Input1_iAMPA_netcon = [-1.951136019653109e-01   +7.730847712192207e-01   -1.141524437607113e-01   +3.737369000363641e-01   -9.980343865285027e-01   -1.069856391503122e-01   -6.941775105331595e-01   +1.632265976069516e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +3.922425448543506e-01   +8.245830583387906e-01   -6.187555704224604e-01   +4.747240479442888e-01   +3.689801053715875e-02   -7.506362261181156e-01   -3.039820915153312e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
