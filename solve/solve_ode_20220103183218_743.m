function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.144887860906151e-01   +9.495706774565343e-01   +7.006840110453331e-01   +1.646113948616763e-01   +9.202748209014064e-01   +2.114425990118005e-01   +7.416569765747645e-01   +3.031781045676242e-01   +5.352090501797818e-01   +8.354604318111291e-01   +9.726058521572469e-01   +9.700381471247261e-01   +6.987780204324078e-01   +3.693141697421323e-01   +2.982940662380670e-01   +3.823666398899301e-01; +3.509539936527873e-01   +1.010883007165190e-02   +1.384247769566421e-01   +1.695401093996609e-01   +7.825292734058058e-02   +8.113302938878681e-01   +7.993511142499135e-01   +7.544625646774881e-01   +7.932092509291740e-01   +1.887757391750139e-01   +4.750644561745754e-01   +6.617424816911686e-01   +3.671119085825543e-01   +2.754546870347365e-01   +6.878098412911614e-01   +9.607335769294384e-01; +2.023174990160914e-01   +4.771688645260618e-01   +8.322824843950292e-02   +7.095769195489853e-01   +3.160463990254430e-01   +3.816770133717219e-01   +6.599980881972448e-01   +9.547570791963916e-01   +4.724313724715013e-02   +9.272047498050409e-01   +8.709076056178463e-01   +2.004200913085896e-01   +5.457893632838143e-01   +7.051976385197700e-02   +7.774400748873634e-01   +8.104903568462015e-01; +2.340934073889928e-02   +4.915548109990545e-01   +4.306149370594839e-01   +8.395469360076697e-01   +6.339456711095425e-01   +8.632273017161390e-01   +4.398007458352708e-01   +4.737130765867842e-03   +4.612940673466074e-01   +4.193829386520763e-01   +9.421539280423468e-01   +9.004791890463958e-01   +5.137241019551932e-01   +1.559749223967616e-01   +7.166662499141498e-01   +8.937146433236243e-01; +7.658491025598286e-01   +5.166860199557588e-01   +9.004394165257665e-01   +8.273837480436344e-02   +9.073018469175972e-01   +3.222361434687726e-01   +5.779610385533354e-01   +4.033607277904789e-01   +9.402854880646138e-01   +2.996780813218557e-01   +2.419783206268260e-01   +4.802201868880165e-01   +7.690457065975848e-01   +3.634122951491215e-01   +2.752076862526051e-01   +6.781189868601771e-02; +5.716929086115646e-01   +2.879804421246814e-01   +7.214939285292833e-01   +8.363579494531292e-01   +7.980012617514306e-01   +3.813813442443703e-01   +5.181547622556621e-01   +1.571697402185618e-01   +4.754692136789567e-01   +3.547455205982294e-01   +9.188858772847317e-01   +6.666231049732344e-01   +7.501813260795419e-02   +7.146851964228784e-01   +1.734159920428389e-02   +9.033378024129406e-01; +5.807258982910060e-01   +5.623305345757618e-01   +6.859910674039440e-01   +5.502971560822780e-01   +6.484965602973410e-01   +6.449380486564575e-01   +7.274846996718505e-01   +8.285505495589350e-01   +7.781888051328943e-01   +9.752349725216871e-01   +6.327047693626283e-01   +5.274462357500758e-01   +5.290288009481385e-03   +5.393618014305026e-01   +1.773167655721991e-02   +6.732666050482475e-01; +3.859645370093795e-01   +5.149261723827855e-01   +2.079512589053386e-01   +9.670315710691864e-01   +4.388553231947061e-01   +3.891565891753120e-01   +2.217162967166073e-01   +2.862330868479718e-01   +1.103310297754157e-01   +5.370790192923457e-01   +2.881140199590057e-01   +7.036198446478337e-01   +4.073421242508028e-01   +2.349812720493612e-01   +9.327241763491633e-01   +3.447103172107561e-01; +5.540130683213156e-01   +6.720304447149219e-01   +5.252388048117708e-01   +6.730599686260008e-01   +7.492532774161893e-01   +7.404419499031514e-02   +9.977518433599649e-01   +9.785516447856426e-01   +5.193971599317435e-01   +7.928143449465556e-01   +8.482530769928192e-01   +7.174921697029899e-01   +6.625051201861970e-01   +4.721772746354140e-01   +9.347423239078715e-01   +8.443216164993342e-01; +1.872215445002175e-01   +6.168815891013085e-01   +8.238666619695180e-01   +3.352791159596911e-01   +8.303471036344237e-01   +1.543072509021918e-02   +6.224088505062705e-01   +6.238914552640407e-01   +6.383515510516395e-01   +7.981032103059614e-01   +1.604493122450485e-01   +2.945340995378162e-01   +3.727023566655145e-01   +7.186502866045719e-01   +3.760051417693905e-01   +1.969760796564783e-01; +1.179430260871698e-01   +5.648367128718221e-01   +1.817255743508986e-01   +2.157623549852700e-01   +3.477609411117431e-01   +8.737632679568446e-01   +9.879344139457626e-01   +7.486473183162771e-01   +5.758180668891799e-01   +1.399485010522710e-01   +8.274776047261992e-01   +1.147597284906698e-01   +3.962662237126562e-01   +5.176750246474663e-01   +1.046694112291289e-01   +8.436383213780081e-01; +5.297784247108469e-02   +5.079754491685983e-01   +5.162349814188114e-01   +5.702985836450981e-01   +1.505294561770090e-01   +1.592574810481041e-01   +4.919567751176043e-01   +8.841626803695067e-01   +8.397549319471359e-01   +4.555787284474949e-01   +2.166738180055073e-01   +3.319630790233472e-01   +1.368373831121920e-01   +5.156572597742303e-01   +7.239660343536130e-01   +4.276051170844788e-01; +9.371860824791178e-01   +6.659096101527497e-01   +3.556628351425279e-01   +4.774333352159967e-03   +5.046732067004589e-01   +9.228665675885497e-01   +5.252828795447306e-01   +3.333388426433201e-01   +1.171043317135177e-01   +4.542056311285115e-01   +2.699370427686466e-01   +4.646342137257155e-01   +3.379181196785975e-01   +3.925553169819977e-01   +4.562977766366789e-01   +5.582362760262829e-01; +7.423313715423168e-01   +6.409392005564706e-01   +6.529391067534683e-01   +5.913678623962411e-01   +4.133980705075366e-01   +5.656783244021190e-01   +8.564587237971829e-01   +9.439797105030440e-02   +5.035827891154368e-02   +9.587071626088456e-01   +9.046514290781897e-02   +7.149274383592492e-01   +1.230086449900233e-01   +4.848964132306238e-01   +1.429717466927828e-02   +4.452334927850239e-01; +2.396021155285444e-01   +1.404563753184696e-01   +2.812333448656578e-01   +8.962071524443467e-01   +1.768193787241390e-01   +9.233165766224256e-01   +2.543861785312644e-01   +4.454207181471130e-01   +5.223171325587059e-01   +5.024172472518881e-02   +9.160893122883312e-01   +3.974446939793500e-01   +3.700144163328928e-01   +7.410733202134221e-01   +1.167899167157664e-01   +7.614605242690403e-01; +2.026176759881672e-01   +1.818988487327922e-01   +4.330944611558353e-01   +2.597161401415299e-01   +4.924643914548312e-01   +5.951274454562291e-01   +5.775252345186557e-01   +2.364558215201723e-01   +7.044064067287783e-01   +3.876956593245730e-02   +7.313189395054616e-01   +2.398526529964639e-01   +2.466820039444514e-01   +7.081431055094669e-01   +6.609121152613229e-01   +9.630983186100105e-02];
L1E_L1I_iGABA_netcon = [+8.405552026494366e-01   +7.482876840611287e-01   +8.719568838966093e-01   +4.352836288568767e-01   +9.228554885948079e-01   +7.701258687145867e-01   +3.229557454212389e-01   +6.426321857867371e-01   +9.518933300289534e-02   +2.812583018351499e-02   +1.294911907841459e-01   +5.194051405227146e-01   +8.758122179998282e-01   +5.737865861507495e-01   +1.715728842074370e-01   +6.335598958712942e-01; +6.151626241682132e-01   +9.934700025675149e-01   +3.123627356776162e-01   +1.462156867136639e-01   +8.861744217351043e-01   +2.729694531296775e-01   +9.655166074217243e-01   +4.365975152451509e-01   +2.953485720098837e-01   +5.109697044420456e-01   +4.310173280221492e-01   +2.059490543993037e-01   +8.040132917602466e-01   +2.928607551525564e-01   +5.580174616179487e-02   +3.420693804764682e-01; +6.654994397017286e-01   +3.743564927994191e-01   +4.311411079580885e-01   +6.532600797052672e-01   +5.905207581325526e-01   +5.241530633974307e-01   +3.532639883299572e-01   +4.807818277865802e-01   +3.294422558353688e-01   +8.656378825621502e-01   +4.790917844012559e-01   +7.676013932436072e-01   +6.430395306278793e-01   +1.401492694661129e-01   +2.178545443780000e-01   +1.549199054321913e-01; +7.782518281043561e-01   +5.079405806882298e-01   +3.790041555193199e-01   +7.250941536601656e-01   +8.363483792578934e-01   +4.093499242989067e-01   +3.185061957688418e-01   +9.898501013258937e-02   +4.753479576919220e-01   +5.789901158738500e-01   +6.738772829226773e-01   +3.880909304973679e-01   +7.348937176786718e-01   +4.305853935072259e-02   +2.068901379597615e-01   +4.017941244897860e-01; +3.165758329921546e-01   +7.529828530645319e-01   +6.528043128016352e-01   +1.702471708245819e-01   +7.825742103173565e-01   +7.822760350734577e-01   +9.137447699690071e-01   +8.053027319743323e-01   +2.405390027211356e-01   +4.272037604199219e-01   +3.538948967557485e-01   +6.862878799807269e-02   +6.640303872084241e-01   +6.255030907630945e-01   +2.155113493836091e-01   +9.126653584469834e-01; +3.284623659575530e-01   +1.328853013448056e-01   +2.467131502031327e-01   +3.395356711703297e-01   +7.881248628107851e-01   +2.628276116880865e-02   +8.836456336702637e-01   +6.088116132814257e-02   +4.564629314972983e-01   +7.194790106314942e-01   +4.461848993986280e-02   +7.519266841653415e-01   +8.853775727775285e-01   +6.057395247162225e-01   +5.780558727299061e-01   +1.558858473754341e-01; +6.303772664066064e-01   +5.174097682901375e-01   +6.890237002613813e-01   +1.034506257285191e-01   +6.974223658299502e-01   +4.109810489213933e-01   +3.618823827798003e-01   +9.569659497284854e-01   +7.551496253755534e-01   +2.293966505526274e-01   +2.922789541330204e-01   +4.561406411117409e-01   +8.526850233236878e-01   +3.692444806315772e-01   +3.567433384226468e-02   +4.682977230104329e-01; +9.017269206348347e-01   +9.073214262112335e-01   +3.289047577219009e-01   +4.489772355388652e-02   +1.990830770193380e-02   +8.265420288512505e-01   +7.411864855570759e-01   +7.725383663325659e-01   +7.152469933527842e-01   +5.654841960063780e-02   +7.984601415629919e-01   +3.157624282922402e-01   +4.072175821384627e-01   +8.346889289331413e-01   +7.978529043365903e-01   +8.019572417911386e-02; +3.703510963032465e-01   +1.013291115972446e-01   +8.734517734691534e-01   +4.747069134731640e-01   +3.245153716989970e-01   +5.916425327070459e-01   +1.239813290555671e-01   +4.465030081840343e-01   +2.323221954505267e-01   +9.752849739077627e-01   +6.485144702867466e-01   +2.754600808818195e-01   +1.113086712519115e-01   +5.166114531022374e-01   +1.345409464597330e-01   +3.384449549824522e-01; +8.833057731254832e-01   +1.810857831249691e-01   +9.977889102282682e-01   +4.768123103743900e-01   +9.462627309451194e-01   +2.094301192609095e-01   +5.918750973842126e-01   +1.653963498060047e-01   +7.026998822075563e-01   +9.695925285502272e-01   +7.092560970914598e-01   +5.752614731994750e-01   +4.085216526492371e-01   +8.110618852055512e-01   +5.799908809667986e-01   +4.924383173811424e-01; +1.189462200995541e-01   +1.791886441346061e-01   +6.881266895729081e-01   +5.529566375906492e-01   +4.049070623074262e-01   +2.918155552549752e-01   +4.391731427950420e-01   +8.013459000123158e-02   +3.039315738705889e-01   +1.316582919840464e-01   +7.573965971938691e-01   +9.125546573597645e-01   +3.355210935729293e-01   +5.770166689855222e-01   +8.336815252115495e-02   +5.001453652249589e-01; +9.149988085307306e-02   +5.379083669122077e-01   +3.458599661920255e-01   +6.478799594333174e-01   +6.254526907414832e-01   +2.667993495439339e-01   +9.633827310232772e-01   +7.408800856455477e-01   +4.694919069564319e-01   +1.376619457604592e-03   +3.904646878120850e-01   +4.490647389230193e-01   +1.096866326380483e-01   +7.135015493952347e-01   +2.291326941468480e-01   +1.314585545684753e-01; +5.449403688625511e-01   +9.757175726892825e-01   +5.598680265066358e-01   +3.491393148008322e-01   +8.508831577791829e-01   +9.329830953903190e-01   +9.744845911058853e-01   +5.348802042393085e-01   +4.379406535228173e-01   +9.327326430537015e-01   +3.650647154002608e-01   +9.812933922811449e-01   +8.583234426063892e-01   +7.326412464906475e-01   +4.470985311159339e-01   +7.673773383853925e-02; +6.012000020280526e-01   +8.425328073364053e-01   +8.923444944475356e-01   +2.535094430771614e-01   +3.672466316619908e-01   +5.526150298124562e-01   +2.488299723740192e-01   +4.854869091119126e-01   +7.298378859304274e-01   +7.397602842192472e-01   +8.127090549688111e-01   +1.035866359773487e-01   +8.964900769700220e-01   +4.450682868586910e-01   +1.785481368080756e-01   +6.760534293445087e-01; +7.246378987235542e-01   +6.691919775968855e-01   +6.485249371493714e-01   +1.798672083882280e-01   +2.032581869940059e-01   +4.305368887233064e-01   +7.737344384899854e-01   +8.859142797531210e-01   +8.740819287282142e-01   +4.290866542785874e-01   +3.866956266770343e-01   +4.180898537122383e-01   +6.905412858496714e-01   +2.809115422275658e-01   +4.132139606876067e-01   +1.179106461692286e-01; +9.936382443786579e-01   +1.346359915684987e-02   +3.794601843832287e-01   +4.778722618854220e-01   +9.080861117192083e-01   +3.251874623382555e-01   +7.087843323911851e-01   +5.882705358411988e-01   +9.111793140351809e-01   +9.441603192755410e-01   +8.701227206019504e-01   +3.873475586606906e-01   +7.457419954182392e-01   +1.541003107524184e-01   +9.654947818256372e-01   +9.899037003858849e-01];
L2I_L1I_iGABA_netcon = [+5.716499857498959e-01   +5.641023855764355e-01   +1.056780175367927e-01   +4.523570162513053e-01   +7.986137931686014e-01   +9.764179809188568e-01   +2.219836252191678e-01   +7.590912048596113e-01; +5.665878348129785e-01   +9.538049721346604e-01   +1.277145587594550e-01   +5.670400438161358e-01   +5.441088195363252e-01   +4.242424001487659e-01   +6.243821558871067e-02   +4.957025730448478e-01; +6.075726135442494e-01   +1.319071719538224e-02   +4.343682221024009e-01   +8.178805846335737e-01   +2.582802462518565e-01   +3.925463174666114e-01   +8.279103113927412e-01   +8.258213204283630e-01; +4.652916753843538e-01   +1.252781407621386e-01   +9.299549501530842e-01   +3.606706869435721e-01   +7.785434179166553e-01   +4.592025875719291e-01   +4.102561640093985e-02   +9.179967198852746e-01; +4.353459901861116e-01   +8.561580729266869e-01   +1.388914644968049e-01   +2.421043699636380e-01   +7.770749454325725e-01   +1.280882769461950e-01   +9.114675304430985e-01   +7.096488226996885e-01; +6.729372808028536e-02   +2.217079982045609e-01   +8.206739481715593e-01   +7.629695165628001e-01   +1.444009418513035e-01   +4.623824222127637e-01   +4.531086774176381e-01   +8.013586780136336e-01; +6.389478379584036e-01   +7.032829025929990e-01   +9.317140127622520e-01   +3.828113828915290e-03   +8.257355612689727e-01   +2.659974108600868e-01   +2.804067526931747e-01   +9.570908002442138e-01; +4.254075224921477e-01   +7.764697200928773e-01   +5.710845029578462e-01   +2.771490835178904e-01   +6.243831261765621e-01   +1.037806593998424e-01   +7.550630286648713e-01   +9.515280725126402e-01; +7.526357882789015e-01   +4.239169411842404e-01   +4.991589492063819e-01   +3.118655821250488e-02   +4.617528839801597e-01   +6.593644665818732e-01   +9.269224352887808e-01   +2.955234641435213e-01; +3.062436574181430e-01   +7.297194435784121e-01   +9.289057724175941e-01   +6.692598014666593e-01   +4.845607500297202e-01   +9.433698927530068e-01   +1.408453915548493e-01   +3.535864562052690e-01; +5.999535778624298e-01   +4.537055414757444e-01   +8.641702101101109e-01   +9.724497179368154e-01   +2.197566446835734e-01   +7.657742377297215e-01   +9.454357076929211e-01   +5.442673794473218e-01; +3.308171331436200e-01   +8.033879550490735e-01   +2.542265641627220e-01   +9.448264432109982e-01   +8.542043460692351e-01   +4.043888921415163e-02   +3.142922358625357e-01   +2.117952987483613e-01; +6.462743668750912e-01   +4.311338432379108e-01   +4.562438064467713e-01   +4.784357054149698e-02   +8.767897601966758e-01   +2.609222862396040e-01   +2.078465526636419e-01   +8.041266417213201e-02; +4.853504397413860e-03   +1.518965833703175e-01   +7.382896162259666e-01   +2.880533248696493e-01   +8.391364085470334e-01   +6.415107584996016e-01   +4.607118482456450e-01   +5.104955090497907e-01; +1.476860495644710e-01   +8.023293530507006e-01   +7.539765032357862e-01   +4.820476391098565e-01   +4.425351994154047e-01   +8.958748662339093e-02   +5.936272633449690e-01   +1.992349179596079e-01; +2.473862182821527e-01   +3.730287411078346e-01   +2.371257954674811e-01   +8.858234921645222e-01   +5.425333751597402e-01   +7.270395828662712e-02   +5.496193227308913e-01   +1.426091118974873e-01];
L1I_L2I_iGABA_netcon = [+7.106507473222705e-01   +8.706385015605056e-01   +6.148734969470109e-01   +4.892055632228493e-02   +1.441073822777842e-01   +2.349371161158974e-01   +8.404816873654284e-01   +3.670054829522804e-01   +7.104776512155438e-01   +3.902722143839245e-01   +2.445970658754877e-01   +6.722725095875227e-01   +1.625212389053585e-01   +5.710416073902810e-01   +4.523537527087960e-02   +4.472755789044978e-02; +6.068549634687104e-01   +8.029007483131432e-01   +6.164498271700459e-01   +5.287423723681145e-02   +7.454002824044353e-01   +5.521241740031854e-01   +2.008418234394021e-01   +5.589874853342052e-01   +1.890900099940462e-01   +7.257471215272894e-01   +5.073535472909734e-01   +3.355747430281083e-01   +1.072239778691427e-01   +8.121099969710495e-01   +4.352357394710524e-01   +9.227250758063553e-01; +1.600769952540848e-01   +6.212387767547228e-01   +3.094293636723283e-01   +5.994749147498540e-01   +9.517697618724391e-01   +1.130706206621599e-01   +6.153687435935570e-01   +8.338810041421132e-01   +2.298246715480816e-01   +6.340353709161013e-01   +7.335815109549965e-01   +5.483152409214594e-01   +7.456770980877868e-01   +6.740369334751930e-01   +9.258192536518656e-01   +1.771397729400871e-01; +4.811035388771251e-01   +4.771861563424952e-01   +1.314240634174724e-01   +6.608924886025104e-01   +2.631298077929615e-01   +8.220995212752932e-01   +1.594068455443772e-01   +7.151770238368245e-01   +9.987388272922181e-01   +9.964761633508976e-02   +7.795196174445012e-01   +5.348206589782561e-01   +2.162048524737668e-01   +4.418539725457413e-01   +8.862424859652401e-01   +7.447392046525145e-01; +2.903755694708829e-01   +1.975573406951187e-02   +6.021595777787174e-01   +4.858342898183796e-01   +9.027179985312807e-02   +6.577390697076578e-01   +5.876557157602350e-01   +1.169627394415083e-01   +9.014896365952170e-01   +4.950567249572007e-01   +6.845324708665065e-01   +9.073844429539654e-01   +4.865958460628712e-01   +8.879807122652336e-01   +9.571807190064889e-02   +4.710050075831314e-01; +4.029015918083739e-01   +1.195355303936254e-01   +8.919228591601415e-01   +9.779542769483380e-01   +2.324762352450261e-01   +2.349744000650270e-01   +5.435705058196029e-01   +7.394842075693733e-01   +1.451578313484709e-02   +5.555882468917804e-01   +8.146499774386847e-01   +2.841024287786807e-01   +4.990117287604097e-02   +7.875510353874799e-01   +6.845624744739173e-01   +2.531678292506054e-01; +4.899792103983177e-01   +7.242501081310202e-01   +5.654401074804158e-01   +8.672593173117328e-01   +8.907469333620247e-01   +3.039127704017545e-01   +6.866401988054615e-01   +9.222901860035904e-01   +8.343800341142408e-01   +5.249780524278807e-02   +4.232014527314803e-01   +1.387915770744083e-01   +5.786402904838746e-01   +5.858878770133794e-01   +1.115349342606902e-02   +6.650224070260020e-01; +8.624125608537652e-01   +6.685385034410432e-01   +6.322390982055873e-01   +9.559828219774400e-01   +1.985841833757237e-01   +3.252819842257956e-01   +6.999757295757600e-01   +9.201764302860335e-01   +2.524007476709928e-01   +8.143657561593122e-02   +4.948915938429238e-01   +9.550124307167034e-01   +4.951629198536063e-01   +6.196723681602323e-01   +1.254470274380618e-01   +6.075436081283534e-01];
L2E_L1E_iAMPA_netcon = [+3.714782100939930e-01   +5.616690846454990e-01   +2.064248094439086e-01   +5.189247188910068e-01   +2.949554116730080e-01   +7.059116105787989e-02   +2.827217767438352e-01   +2.641608899436687e-01; +4.329877096931478e-01   +1.864762511208523e-01   +1.383167756446377e-01   +6.832106615991655e-01   +6.185077196584040e-01   +5.916897272994287e-01   +9.291538566951674e-01   +8.998476223578480e-01; +7.185065024801014e-01   +6.066232614402582e-01   +8.047808889397667e-02   +2.077945964361436e-01   +8.697125127606504e-01   +7.848714664810351e-02   +7.590371380110880e-01   +1.554247869107247e-01; +1.955510618182658e-01   +7.338917744791447e-01   +9.344633890568325e-02   +9.725290629104502e-01   +8.153372436919257e-01   +3.987392813507495e-01   +2.600346350400869e-01   +5.533096641774374e-01; +4.465206993466225e-02   +8.346973032092884e-01   +5.510664574635585e-01   +3.490802463028584e-01   +2.086020168544289e-01   +5.505381234140420e-02   +2.449021455631045e-01   +4.227672012321602e-01; +3.133605067610225e-01   +2.742281558000004e-01   +7.318670943075128e-01   +1.814938977207091e-01   +7.476748012361235e-01   +1.258135704690212e-01   +1.625168709096887e-01   +5.479127520758305e-01; +7.933117792830571e-01   +6.084875684015842e-01   +5.466373347496927e-01   +2.437308862492999e-01   +1.997333301819852e-01   +2.439634748062114e-01   +2.891547822887602e-01   +7.465882959504947e-01; +4.123903416403939e-02   +5.485096177622886e-01   +5.021473040812730e-02   +2.570541900899786e-01   +5.801126606561726e-01   +9.397823591633844e-01   +5.656126232606437e-01   +1.171079769403198e-02; +2.151095296528725e-01   +2.760861853379306e-01   +6.371046844948719e-01   +2.186965407665619e-01   +8.760016274924793e-01   +2.070887016679132e-01   +4.005148063562406e-01   -7.891364923499207e-04; +2.707245456111620e-01   +3.388453931509399e-01   +9.917441837649179e-01   +3.848738373691233e-02   +7.173169813232109e-01   +3.282384193078028e-01   +9.860221069697225e-01   +1.913889039401120e-02; +7.927068630226831e-01   +5.707281666515250e-01   +9.104907998193863e-01   +3.517387974699596e-01   +6.970282376052450e-01   +8.644663593764709e-01   +5.453482845271247e-01   +3.534607762507826e-01; +9.851955052207183e-01   +7.425929358370001e-01   +7.726783332408484e-01   +8.964555981633748e-01   +4.609102610254873e-01   +9.193049184329856e-01   +9.335477317128766e-01   +4.289498565930182e-01; +9.845211625450535e-02   +7.639592678018157e-01   +1.955103955173579e-01   +1.371354962464477e-01   +5.037339827844526e-01   +2.141991690513907e-02   +9.876353258748749e-01   +5.452141871252916e-01; +1.997465554266205e-01   +4.047530359549797e-01   +3.068681345743789e-02   +9.515841085849500e-01   +8.001522267576600e-01   +3.604723580692186e-01   +8.335455598735120e-01   +4.825926496031340e-01; +1.183806756294804e-01   +1.553318742560196e-01   +3.769133710598486e-01   +9.068696771341722e-01   +9.339386313094060e-01   +5.324515964051346e-01   +1.811992698214936e-01   +9.172863455231273e-01; +6.393211935038869e-01   +2.051567412081467e-01   +5.783532801328569e-01   +4.116424248837153e-01   +7.924333922900926e-01   +4.049227442812908e-01   +3.101712112234805e-01   +4.149395403795553e-01];
L1E_L2E_iAMPA_netcon = [+4.962535902550295e-01   +4.528202692379111e-01   +6.132507862861848e-01   +4.918966304593086e-01   +2.328170925974587e-01   +7.134332694016297e-01   +6.863599510517989e-01   +6.353413460822671e-01   +5.203455568793504e-01   +2.392677664472385e-01   +8.718747858803156e-01   +1.750442375727344e-01   +1.378606351828718e-01   +2.478737134989832e-01   +1.814195021289201e-01   +3.028425147674553e-02; +8.321809599812454e-01   +3.626321090430917e-01   +1.032364993473659e-01   +6.632509539133643e-01   +8.369138842912747e-01   +3.820631256877447e-01   +9.752644823746961e-01   +6.217348719502028e-01   +6.719825073956391e-01   +7.275250705085771e-01   +6.621146521566734e-01   +2.982666196517439e-01   +2.844063592311660e-01   +7.483741890723332e-01   +1.504229602911900e-01   +2.492101993644604e-01; +1.847415478951833e-01   +2.972654671861520e-01   +7.554781054853600e-01   +1.793664929538568e-01   +7.347414013294756e-01   +3.799128977102363e-01   +7.558530429647220e-01   +4.090457059836654e-01   +7.717565000390135e-01   +1.264979921354635e-01   +5.449711700410308e-01   +1.077139365893268e-01   +4.167512358963321e-03   +9.313541368143252e-01   +1.348822994586917e-01   +9.886429953861404e-01; +3.396803692041397e-01   +2.399655584670209e-01   +5.396844403480993e-01   +4.756232325182582e-01   +4.891101846558385e-01   +7.180092748632136e-01   +5.554118608035756e-01   +4.302779571621824e-01   +4.630986916773694e-01   +4.356293045178414e-02   +2.473819441619114e-01   +4.507545025332578e-01   +3.103997643051100e-01   +3.055139066834241e-02   +1.654413567570370e-01   +6.312833372819778e-01; +6.932839936277645e-01   +1.361727613436376e-01   +4.460891157854503e-01   +5.032811058547457e-01   +8.523125028669846e-01   +8.317673920666332e-01   +2.855193675276902e-02   +5.110703822557274e-01   +9.042087941797012e-01   +6.535302426818440e-01   +1.097261418002920e-01   +5.858031580233835e-01   +9.071031155278731e-01   +4.312526658028743e-01   +9.204702779373501e-01   +3.616314890673029e-01; +6.938469856232728e-01   +1.010840795180384e-01   +7.442430550791636e-01   +6.027618492110937e-01   +7.216863088115565e-01   +6.696427315481409e-01   +1.894084461793105e-01   +2.609116659315880e-01   +2.438565025518295e-02   +1.994784150776154e-01   +9.714226853757995e-01   +2.204654450834837e-01   +2.931984969669865e-01   +8.276707893464275e-01   +2.605903553469829e-01   +9.905987744224005e-02; +3.697868208426061e-01   +2.324995441266739e-01   +3.883783870647423e-01   +2.449985757277122e-01   +5.214598331353871e-01   +6.492715696573119e-01   +9.372878116765637e-01   +4.234427047595025e-01   +4.845691147355169e-01   +9.721677920465241e-01   +5.883899853365971e-01   +1.060423097202279e-01   +8.262078908813461e-01   +9.955741123944769e-01   +2.042716174294655e-01   +4.154290505488614e-01; +3.131898341802048e-02   +3.481135212263051e-01   +5.329103672641421e-01   +5.206079989235944e-01   +9.383311440118355e-01   +5.615814074572758e-01   +3.927591654445169e-01   +5.250500033750901e-01   +2.720270683614143e-01   +8.229937295213825e-01   +8.172109068825405e-01   +5.613337540868262e-01   +7.379363466678956e-01   +9.219275151280899e-01   +6.185407581470717e-01   +9.275600295651208e-01];
L2I_L2E_iAMPA_netcon = [+6.753243320777567e-01   +6.121239689004180e-01   +4.303243288972292e-02   +7.986777476758282e-01   +5.194962672241982e-01   +8.231202186617099e-01   +6.458215692940226e-01   +3.870999412600605e-01; +2.390186849380835e-02   +9.445020008942393e-01   +5.480251657950003e-02   +9.341067324880712e-01   +6.645628055328846e-02   +1.111281232567440e-01   +3.451169159665396e-02   +1.702311587635582e-01; +7.364362692184410e-01   +9.617196717934385e-01   +4.062237663223716e-01   +9.396886295953354e-01   +2.877482277499025e-01   +2.576834398321817e-02   +5.642085890439446e-01   +4.434697830940725e-01; +2.190691160218168e-01   +3.656597355044356e-01   +9.792180377344586e-01   +1.428325768636888e-01   +7.157949930509653e-01   +7.656162877271230e-03   +3.080686408870186e-01   +8.796841379561851e-01; +8.550353328975161e-01   +8.001285823114561e-01   +7.140296756637230e-01   +3.244390058581823e-01   +8.879849509091441e-01   +3.357341811300347e-01   +2.625636922326499e-01   +4.037477358121823e-01; +1.586100103164219e-01   +7.226226209086924e-01   +9.885630669597408e-01   +4.268060541529443e-01   +3.638644642817301e-01   +6.675779797390961e-01   +7.188216946781175e-01   +1.658724768590013e-01; +6.715834174470957e-01   +9.512538811306179e-01   +6.441061152601467e-01   +7.071259579055497e-01   +5.671005893507838e-01   +5.912468713674268e-01   +3.088822478520570e-01   +6.648358533009914e-01; +9.341187222715494e-01   +1.228088806340409e-02   +5.029562267055535e-01   +6.174855492005714e-01   +8.812183857179988e-01   +7.765929827277804e-02   +9.011450298154955e-01   +9.296002508660171e-01];
L2E_L2I_iGABA_netcon = [+6.122252397889098e-02   +5.238914707606334e-01   +3.486074304133194e-01   +2.574844164921840e-01   +4.537960003088946e-02   +9.005721147505524e-01   +3.444917019005083e-01   +4.527102262660483e-01; +3.539118447338352e-01   +6.581052018259083e-02   +5.587204331116042e-01   +9.826791604489586e-01   +3.628758603194034e-01   +5.502272241427368e-01   +9.353060688945788e-01   +6.737846312502040e-01; +9.321155267149805e-01   +1.839227153236782e-01   +6.911066550217684e-01   +3.478561497622255e-01   +3.936874590993220e-02   +7.115888944046828e-01   +9.116406969509875e-01   +7.707953510975820e-01; +2.401785598154416e-01   +3.137721258012940e-01   +5.568116846686738e-03   +3.941979380477179e-01   +4.907688938307080e-01   +7.151766577540092e-01   +7.261263380246007e-01   +9.228109337076520e-01; +1.076628994082469e-01   +2.469224240804676e-01   +4.810675857104087e-02   +7.516989471431335e-01   +7.254754346529386e-01   +1.731689952246827e-01   +4.415873822250458e-01   +6.523728089614124e-01; +7.101778779346514e-01   +3.215312562383680e-01   +3.021698072623238e-01   +1.093813848424628e-01   +1.712941634930128e-02   +3.527546706346283e-01   +1.468228856450737e-01   +5.041798183666609e-01; +6.434690911838552e-03   +8.728998862892471e-01   +8.742913934553377e-01   +5.952195964064894e-01   +5.117356851421199e-01   +3.778701121964664e-01   +8.306181061051857e-01   +3.426783525476568e-01; +1.770793797302027e-01   +3.048645403064076e-01   +6.243879856649457e-01   +1.205839422071634e-01   +2.435198878024022e-01   +7.590370387024957e-01   +2.490104558607992e-01   +9.442958309166104e-01];
L3E_L2E_iAMPA_netcon = [+7.900271335329737e-02   +1.759115610406699e-02   +3.680250616932200e-01   +4.950039109395853e-01   +2.136640082380898e-02   +9.626801202571765e-01   +3.548536995211073e-01   +2.348441722589711e-02   +2.069462025472853e-01   +7.093176758304000e-02   +2.423533909779920e-01   +1.000000000000000e+00; +9.492899080182327e-01   +9.779714624581294e-01   +1.179903435321215e-01   +6.486389419484083e-02   +8.070412561312302e-01   +3.912449115615483e-01   +2.271847676946822e-01   +1.283834449407816e-01   +3.523359527782200e-01   +7.441255320028067e-01   +5.364143946369706e-01   +3.410633885834993e-01; +6.652128333810677e-01   +7.176755178463664e-01   +5.112469024356585e-01   +8.702509141294833e-01   +7.965658143577651e-01   +6.621355209246705e-01   +7.259560032716852e-01   +6.636036942571220e-01   +8.882650287122191e-01   +9.898229042548742e-01   +3.345640171465250e-01   +8.281075164594737e-01; +1.688267008527786e-01   +8.749299972111700e-01   +5.870345052402083e-03   +9.985115753096685e-01   +4.174469287567111e-01   +5.826063403467567e-01   +7.722119083365406e-01   +5.084335048207163e-01   +8.172156333647035e-01   +7.692092335029761e-01   +6.697691292482623e-01   +1.100426826139438e-01; +1.979915068358253e-01   +8.152586704851068e-01   +8.704503406040498e-01   +1.179095636870353e-01   +6.320652315170155e-01   +5.166046570194086e-02   +3.376555333178049e-01   +7.679425307923002e-02   +3.185493154405123e-01   +8.865182336362717e-01   +8.765191728224533e-01   +7.784824522668633e-01; +9.910110960222747e-01   +3.598074551982871e-02   +9.067491885620721e-01   +1.045037016710763e-01   +5.677199551328873e-01   +7.299222721250041e-02   +5.711465006207836e-01   +5.354095674571732e-01   +5.969386869922627e-01   +4.181749950940435e-02   +9.803880268539569e-01   +1.538355604710064e-01; +9.304224627949232e-01   +9.448845585292209e-02   +1.105870806861666e-01   +1.472012440241073e-01   +9.043590845019646e-01   +2.311467480752665e-01   +6.364564277207855e-01   +6.842478497655992e-01   +6.990092355121512e-01   +7.980349116143989e-01   +1.374679634896030e-01   +7.329783443912498e-01; +9.764972415361181e-01   +9.432499803460417e-02   +4.331552617475250e-02   +1.305246339589389e-01   +7.519551284833093e-01   +4.139298435750364e-01   +3.691430345257312e-01   +5.891902021860046e-01   +1.798130058172019e-01   +7.102959039889027e-01   +8.817795757561460e-01   +1.184114378627954e-01];
L3I_L2I_iGABA_netcon = [+7.685002423029287e-01   +5.372387736008913e-01   +5.964956529463139e-01   +3.050929323045556e-01   +9.654588006502377e-01   +1.137355385762362e-01   +2.927186927454722e-01   +7.954520650579763e-01   +9.234150014408814e-01   +9.969281193708250e-01   +3.102015945055661e-01   +9.926000156322662e-01; +6.364610139079356e-01   +4.480750866549963e-01   +5.604787898277216e-01   +7.577005543216331e-01   +5.481487087710464e-01   +6.364966793346954e-02   +1.679140594846087e-01   +4.920617363032040e-02   +3.885730603757493e-01   +2.936460263899479e-01   +4.488957346660539e-01   +9.179930423511194e-01; +7.958598834352780e-01   +1.143557530182886e-01   +7.730409949826918e-02   +6.521160989922009e-01   +9.789348791757818e-01   +4.696217709401559e-02   +7.236033959431877e-01   +1.807425501139723e-01   +7.485901716099925e-01   +5.243338816419285e-01   +2.024832413001401e-01   +6.859960619951398e-01; +9.633552345189937e-01   +7.194786652087440e-01   +7.672927506839904e-01   +3.327354905697951e-01   +1.269831130660914e-01   +1.304915083012436e-01   +2.985009805262330e-01   +2.479914395282838e-01   +8.781626578790066e-01   +3.588127163872333e-01   +9.446324904093460e-01   +2.151093274185389e-01; +7.131175857187092e-01   +1.840917520226962e-01   +8.625832276900529e-01   +9.775534910166894e-01   +1.609060511153560e-01   +4.908530645395792e-01   +6.795158093375090e-01   +2.601686527304662e-01   +3.948905281309845e-01   +5.191631061779488e-01   +2.892706956776287e-01   +3.130545119464782e-01; +6.444362102807301e-01   +3.251969489394557e-01   +7.020924423006462e-01   +5.301390573638189e-01   +3.352508237021589e-01   +4.716901540519300e-01   +7.514828229787750e-01   +6.483854413877361e-01   +1.696145263150233e-01   +4.952906014187389e-01   +1.148038126254558e-01   +2.276307656309431e-01; +5.170284189661780e-01   +9.674957125794058e-01   +1.114198224718430e-01   +7.538751959742498e-01   +5.310347419008421e-01   +1.570158727920403e-01   +7.454426995085708e-01   +9.835133281419556e-02   +4.405618169108696e-01   +1.805009269676991e-01   +6.696416245839333e-02   +7.050359118839806e-01; +9.534055232013877e-01   +6.979213452966581e-01   +6.590001984417982e-01   +2.633964687665057e-01   +6.900494472931099e-01   +1.366753483476712e-01   +7.819939549809127e-01   +4.693862416202510e-01   +8.514711159457208e-01   +4.820096256642293e-01   +7.288482235600667e-01   +3.723512305798691e-01];
L2E_L3E_iAMPA_netcon = [+6.553831898572499e-01   +3.849753972633980e-01   +2.356363568829315e-01   +4.661099099841001e-01   +9.068827997128397e-01   +9.542290358079649e-01   +7.659705439622684e-01   +3.565541290027754e-01; +3.828726149907684e-01   +2.192182334184328e-02   +9.146051577567483e-01   +2.874631658835180e-01   +6.808167557419860e-01   +1.893555410250025e-02   +8.975272114999437e-01   +6.604063986205201e-01; +3.033541540405509e-01   +3.306277941872820e-01   +4.872982324941947e-01   +2.757843531296679e-01   +8.432400444540902e-01   +4.983133884861272e-01   +7.950345217071684e-01   +5.926675684689905e-01; +1.545810360922002e-01   +4.882609849888949e-01   +5.881930110853896e-01   +1.444603919556484e-01   +9.524953240286574e-02   +3.366210845846807e-01   +9.494041662884705e-01   +5.542335321668090e-02; +7.761838412013973e-01   +2.651333623284049e-01   +9.557536263736357e-01   +1.440408942603465e-01   +7.399476192701085e-01   +6.663424579889010e-01   +5.380711356966299e-01   +2.086053369458999e-01; +7.127820916741268e-01   +5.299137898454231e-01   +8.271587031924768e-02   +2.659307468010630e-01   +5.483189210338394e-01   +1.643973979433561e-01   +1.607194940767851e-01   +5.999441101855160e-01; +1.735232856688941e-01   +4.162860607881114e-01   +2.195988290413592e-01   +6.050327705784438e-01   +2.540553367263543e-01   +2.270279679842784e-01   +1.357932976244424e-01   +2.678499860118690e-01; +4.495085495950490e-01   +1.694430905362113e-03   +1.624107853617811e-01   +1.050626611874630e-01   +7.170828455785284e-01   +1.158218925810438e-01   +2.715902663618268e-02   +1.142367688403945e-01; +8.411497501916907e-01   +8.926550607380239e-01   +3.909424611001238e-01   +4.887808681947546e-01   +3.621977430989083e-01   +9.888375710414152e-01   +6.868690122539981e-01   +2.187731675241348e-01; +7.009617943295340e-01   +2.426141264385319e-01   +1.870224529210931e-01   +8.957672540844458e-01   +8.478884035133339e-01   +1.410973934726520e-01   +5.841251255321793e-01   +8.793468303811842e-01; +7.645907570216333e-01   +8.008956169880797e-01   +7.594752245400997e-01   +1.901159967995726e-01   +8.218751470288550e-01   +7.685474610021579e-01   +2.971185450779507e-01   +4.630186733515087e-01; +9.766136399830696e-01   +5.787467089486600e-01   +2.323444952546356e-01   +5.363590864557535e-02   +6.178951565591972e-01   +6.264223028611072e-01   +7.341047372146939e-02   +7.318223340015904e-01];
L2I_L3I_iGABA_netcon = [+5.900948537349754e-01   +1.449868324698963e-01   +3.477305788268705e-01   +3.746477641764010e-01   +5.943314994345803e-01   +5.139189954718929e-01   +7.752815636959125e-01   +2.686399477018620e-01; +8.431342821444354e-01   +9.904327260566823e-01   +4.526061463942053e-02   +5.346012968951275e-01   +4.752230961399218e-01   +2.396510948906071e-01   +1.821006977511181e-01   +5.953163198219027e-01; +6.093461677261142e-01   +4.814288106916245e-01   +9.476862498265760e-01   +9.747353928574789e-01   +3.786189052474498e-01   +2.704193554282697e-01   +4.525135207907760e-01   +6.851630995197403e-01; +7.434641511855143e-01   +4.251404861428491e-02   +8.594694327643921e-01   +9.949490910997264e-01   +9.823343213027698e-01   +4.094302535877260e-01   +3.053470600667499e-01   +4.142780397764630e-01; +8.513913197968843e-01   +2.659760031926612e-01   +1.391682309418789e-01   +4.112041989401609e-01   +1.410419961459382e-01   +2.652002976790897e-01   +3.843256749362367e-01   +5.100959413476044e-01; +1.453695018280359e-01   +6.701026814639734e-01   +5.857006933527834e-01   +4.473488080150111e-01   +2.721951658565566e-01   +8.552000464122098e-01   +7.978736657976717e-01   +8.164734287888193e-01; +7.395574499862754e-01   +1.444588304410993e-01   +6.252306446474347e-02   +2.448064611046485e-01   +2.234163324892217e-01   +4.805170885002744e-01   +7.808559456136498e-01   +5.404333481042545e-01; +1.798290573972744e-02   +7.760874897689750e-01   +9.529153799824263e-01   +5.983965107806636e-01   +7.927409223583175e-01   +3.375349239403165e-01   +6.459187183293070e-01   +5.894374600319747e-01; +2.304807700272067e-01   +2.669734539233232e-01   +4.958432311684324e-01   +7.520934395258935e-02   +8.200482085532919e-01   +6.345925318728588e-01   +2.418586675295696e-01   +5.380076660195846e-01; +5.376782633880445e-01   +8.818607592304031e-01   +2.534314207599284e-02   +9.089610461329285e-01   +7.994257235365210e-01   +4.166868595312862e-01   +6.044904954459177e-01   +5.406625409940512e-01; +7.154084596751470e-01   +3.610287687645499e-01   +5.208608234903085e-02   +4.769883498291128e-01   +1.153646734941417e-01   +5.435761988989667e-01   +4.185952504878490e-01   +1.544373907006916e-01; +4.322139773108780e-01   +1.215261007895189e-02   +3.029579699666486e-01   +5.042358299562700e-01   +6.406861407341056e-01   +3.379106601821672e-01   +2.966059405285437e-01   +6.991729883845774e-01];
L3I_L3E_iAMPA_netcon = [+6.011539085494372e-02   +7.755473543142084e-01   +5.545102793646799e-01   +5.690075052121693e-01   +9.129863047495624e-01   +8.318716874297934e-01   +8.468139865634062e-01   +8.627208629752335e-01   +5.267723968447644e-01   +9.919395010027388e-01   +4.807531634236534e-01   +3.497360556493855e-01; +9.239870362216797e-01   +8.335537668491143e-01   +8.481874438515574e-01   +9.337323058506715e-01   +5.890809987635057e-01   +3.997567734393548e-01   +6.292986629644489e-01   +8.529624697925404e-01   +5.660066724108335e-01   +7.007604130637466e-01   +7.403467728314895e-01   +3.955270894353008e-01; +1.834777696465106e-01   +5.925121989854534e-01   +9.693346205843604e-01   +7.794820390628392e-01   +5.775050255911606e-01   +7.051330877380216e-02   +4.405603075617656e-01   +9.486917678896647e-01   +9.814657508470814e-01   +8.394837269314750e-01   +5.946155232635891e-01   +9.899476228740226e-01; +5.392337087977699e-01   +7.598615241629376e-01   +4.667633625299877e-01   +5.985514033905834e-01   +6.518828265809480e-01   +3.779769665941990e-01   +2.304955600171484e-01   +6.999366228804640e-01   +9.625490347243464e-01   +7.352838361277650e-01   +2.552712827991425e-01   +2.942809687977508e-01; +3.996581370818814e-01   +6.618615477171849e-01   +7.694406753639117e-01   +6.386029361730668e-02   +4.300827093949025e-01   +8.577181622213754e-01   +5.264617975471177e-02   +3.581767278882150e-01   +5.566901313219901e-01   +9.947238388247952e-01   +6.085534417606330e-01   +2.315418817883283e-01; +1.007527098749585e-02   +5.849785518294637e-01   +2.303783586599267e-02   +5.370739027368405e-01   +9.395825336008774e-01   +2.752063648499413e-02   +7.043557415365994e-01   +3.769943208183199e-01   +5.234491013939380e-01   +5.052744296873722e-01   +2.323123205566793e-01   +3.278511731988659e-01; +1.075947187370398e-01   +2.545763024129700e-02   +6.740437590403107e-01   +8.602113910617124e-01   +1.022304569141171e-01   +4.193242294372272e-01   +8.498404334243276e-01   +8.479742092491155e-01   +4.709623462510254e-01   +1.910469475931917e-01   +1.942720201825869e-01   +1.691084597688306e-01; +8.542141524586753e-01   +6.836671655458914e-01   +8.406157610809648e-01   +3.373918583273128e-01   +4.090998621030604e-01   +2.526481752471264e-01   +4.037617297320313e-01   +3.869705048673555e-01   +8.984627385656068e-01   +9.523885150600725e-01   +2.110123935905004e-03   +3.807108055162002e-01; +3.322820787552567e-01   +3.233962637547991e-01   +6.912144463044743e-01   +1.790940352177357e-01   +8.922018873574699e-01   +7.082195461464216e-02   +2.910671224181048e-01   +7.722620575371573e-01   +4.795502732471528e-01   +4.515121919950644e-01   +6.508674726135627e-01   +5.295386250104108e-01; +1.439903732541290e-01   +8.301631699457609e-02   +8.978882238582815e-01   +8.791015217660869e-01   +7.380448319204285e-01   +9.150124853418193e-01   +2.587881185083233e-01   +7.759897345939630e-01   +4.892362216753940e-01   +6.024097041219664e-01   +3.983703028448148e-01   +5.941305476653831e-01; +7.996557639032598e-01   +7.458723811364006e-01   +9.505892237289935e-02   +8.402776487880224e-01   +9.585944203328179e-01   +2.636257819824116e-01   +5.093508307874148e-01   +4.280452228176287e-01   +3.115767317731765e-01   +6.444438559831169e-01   +2.696191997446017e-01   +1.682951476921950e-01; +6.514732858161462e-01   +9.638859114659791e-01   +7.635145644854870e-02   +8.275411584879133e-01   +9.749595970600342e-01   +1.062337958579406e-01   +1.175863844404153e-01   +4.859559593941293e-01   +8.531480779839600e-01   +7.594855959782241e-01   +5.352935415715893e-03   +6.567507254510233e-02];
L3E_L3I_iGABA_netcon = [+4.412806526412105e-01   +6.457773130463881e-02   +6.020895920796937e-03   +4.959044344138385e-01   +5.427274110874081e-01   +2.541318560018906e-01   +7.181188921437471e-01   +7.582548090942421e-01   +3.804050511444554e-01   +4.475020723775239e-01   +2.015567064096609e-01   +6.568754709080625e-01; +5.675861081554989e-02   +8.068755350689745e-01   +1.292062006661066e-01   +1.931257069213612e-01   +2.163018773937961e-01   +3.336371222535752e-01   +2.264057960965211e-01   +8.916158051013831e-01   +6.070387832557312e-01   +3.929289769870472e-01   +8.282584512118862e-01   +9.047351351232851e-01; +6.276060330740623e-01   +9.136752446274006e-01   +3.095545359863289e-01   +6.440486473709047e-01   +2.693484422831225e-01   +6.000028424426709e-01   +4.963248563682656e-01   +7.318385003416693e-01   +1.642336171075754e-01   +6.754573206673830e-01   +4.398458138720066e-01   +8.391138969172384e-01; +8.072815209067833e-01   +4.278088233115500e-01   +2.382784252884984e-01   +2.572752571812064e-01   +1.358912461401348e-01   +4.801150650295402e-01   +4.779709108891884e-01   +6.911414424185887e-01   +9.996617892655799e-02   +3.431136778740923e-02   +4.168415623753646e-02   +1.688895371619579e-01; +4.037133775421611e-01   +1.907844966793192e-01   +6.537927025645270e-01   +9.396696867237996e-01   +1.604503079317129e-02   +8.997093684547633e-01   +4.311080728896091e-01   +6.445281794001302e-01   +6.193062599601863e-01   +7.814344654791524e-01   +7.645063909498339e-01   +1.621819337810750e-01; +8.863258536904626e-01   +1.867275155504455e-01   +8.093799029854687e-01   +2.914717113452014e-01   +1.353122428781376e-02   +2.874467078086959e-01   +5.571029009977067e-01   +6.165665276203807e-01   +9.625359518318708e-01   +3.747794692163377e-01   +9.202922038020543e-02   +1.387760009430866e-01; +7.185098953233766e-01   +6.714656012419878e-01   +7.391648574583948e-01   +1.423601613752320e-01   +9.844163857504561e-01   +7.471463790640878e-02   +2.048983610123563e-01   +7.367000525432392e-02   +6.719693366837381e-01   +6.387708498158536e-01   +6.568388142823879e-01   +1.586954355302672e-01; +1.973512533180525e-01   +5.254980257590117e-01   +1.231093091751724e-01   +8.646584921385895e-01   +6.466777332335214e-01   +3.873415376879275e-01   +2.754806282051547e-01   +5.479700123553046e-01   +4.695788651969048e-01   +4.956356488454417e-01   +2.688324031479572e-01   +3.999437632415515e-01; +3.710232367258437e-01   +7.738756303835634e-01   +1.763734562798588e-01   +8.854950625667880e-01   +8.116862477522959e-01   +1.895364432550816e-01   +8.093257002261219e-01   +8.764990757676427e-01   +3.343415362133492e-01   +2.220099070572116e-01   +4.364484731489187e-01   +6.615240754055007e-01; +2.065616236882225e-01   +3.015358232745757e-01   +2.688963330637434e-01   +6.598820622637696e-01   +2.772894708869850e-01   +7.293810318903018e-01   +1.012817509024742e-01   +9.849871679717260e-01   +5.876999266743123e-01   +2.151909979389350e-01   +8.506131006095753e-01   +2.235768116855182e-01; +2.609360369540435e-01   +4.736678051660182e-01   +8.144181011606161e-01   +9.999906975716709e-01   +1.453421053398073e-02   +4.255285350374754e-01   +3.605699044147964e-02   +7.021960811028774e-02   +5.440199351796019e-01   +4.550120054245781e-01   +9.048836601971443e-01   +6.454021578453086e-01; +9.922901795850704e-01   +7.105502960707119e-01   +5.938465826665382e-01   +2.632442861981658e-01   +1.033263105219924e-01   +2.676120126906074e-01   +6.939007426151908e-02   +2.715107066063371e-02   +4.053565401108003e-02   +6.320014928087425e-01   +2.868227103143009e-01   +6.105960357243249e-01];
L2E_Input1_iAMPA_netcon = [+9.969274657461171e-01   +9.928145831910923e-01   +9.940722669982416e-01   +9.900054351941899e-01   +9.921031839398524e-01   +9.983947563917659e-01   +9.863538947684228e-01   +9.976366838859859e-01];
L2I_Input2_iAMPA_netcon = [+9.989784577974384e-01   +9.964777416610014e-01   +9.921162881824143e-01   +9.891095995582252e-01   +9.914847060584393e-01   +9.885108762835045e-01   +9.925766526230753e-01   +9.978192301689971e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
