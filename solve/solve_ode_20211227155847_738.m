function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.235946807148353e-03   +4.137116338328416e-02   +4.598243738350372e-02   +6.182354411263216e-03   +4.708224569531045e-02   +2.824593820533912e-03   +3.649114538591285e-02   +2.666112849899007e-02   -1.750471033543217e-02   +4.223470516210161e-04   +4.447544913135938e-02   +6.962243259128098e-02   -1.402931944250861e-03   -1.619585821494773e-02   +7.881250128746879e-02   +1.578135246366982e-02; +1.400505621464407e-02   -6.121884937060735e-02   +2.335476130006750e-03   +1.043649116306689e-01   +5.394400793523033e-02   +8.471478529943285e-02   +6.514640471581561e-03   +2.821715389452965e-03   +3.574689709096476e-02   +4.172982152690800e-02   +3.843907679032633e-02   +3.900593156371814e-02   +8.024007281337811e-02   +3.454265718031671e-02   -4.644014451835200e-03   +2.498877124594935e-02; +4.443648412758172e-02   +5.166508275008223e-02   +3.766704399850003e-02   +6.040116403736532e-04   -8.749515556596281e-03   +5.001415241492697e-02   -1.267715431804092e-02   +2.248640600329542e-03   +2.673262299428304e-02   +4.803045596948573e-02   -6.385797194438882e-02   +5.200431806566651e-02   -2.008993012722582e-02   +6.167107585263754e-02   +3.295832988456893e-02   +1.891375923401126e-02; +1.950432427580052e-02   +9.520623811243432e-02   +3.383735406577450e-02   +5.906897653362049e-02   +5.540254490565690e-02   +5.463577038035258e-02   +2.564068788751114e-02   +4.354688955167206e-02   +5.167241918927780e-02   +2.261459527911068e-02   -2.724499463914488e-02   -5.248541776773396e-02   +3.978663578901204e-02   -6.194670097821015e-02   +7.001405567312084e-02   +7.834947610350507e-02; +3.696795351344221e-02   +2.828539745156719e-02   +7.615586030165628e-02   +4.234074188239871e-02   +2.803540069316795e-02   +5.477541346108106e-02   +4.676327158631233e-02   +5.567722856117371e-02   -5.438061914174613e-02   +3.847967498098039e-03   -3.003037057959946e-02   -4.070965805014848e-02   +2.901104923647519e-02   +1.719716628786112e-02   +4.493499625622789e-02   +8.882830208239942e-02; +7.456915601880687e-02   +7.318766895704990e-02   -4.152275671301774e-02   +3.943227537550120e-02   +4.721597139354680e-02   -5.695867018335452e-03   +6.493037980471732e-02   +6.145575999151919e-03   +3.406524055564791e-02   +2.771531966761436e-02   +1.359193425673272e-01   +9.071793319788762e-02   -5.306948501256723e-02   +4.617089645404736e-03   +3.669211785036691e-02   -2.183850168024532e-02; -4.177304595459927e-02   -4.275298189553432e-02   +6.346778545910714e-02   +6.056539925161067e-02   +4.781759717491749e-02   -3.782823619362626e-02   +9.581108462958943e-02   -1.288716782358593e-02   +1.243310464841317e-01   +9.893123746144965e-03   -6.180999069624476e-03   +1.191047861957706e-02   +3.418163715101630e-02   +6.718170687953617e-02   +9.600439420811012e-03   +7.961266669269153e-02; +3.546107422807013e-02   +8.403043920270085e-02   +2.025004526050382e-02   +8.883533936189580e-03   -5.877991124040602e-03   +7.030735175908832e-02   +7.085951666141788e-02   -1.430351351230676e-02   -5.716476233735986e-02   -3.618118193020560e-04   +7.353756223631008e-02   +1.158170412256246e-02   +3.511434898677865e-02   -1.224810192141480e-02   +2.045821732268842e-02   -3.931442223589926e-02; +6.207997327680184e-02   +6.264389871881619e-03   +5.580901412491127e-03   +1.261814019256391e-02   +5.638742457974613e-02   -2.795588358274082e-02   +1.010909878760637e-02   +1.917954157950601e-02   -1.734730309143371e-02   -3.207147177658189e-02   +1.044997805778549e-01   +2.864551978861598e-02   +4.402662938833130e-02   +4.360493117567017e-02   -1.685381971821975e-02   +7.851949354683271e-02; +5.572609979849238e-02   +1.112125949596970e-01   +5.212797843770734e-02   +6.276387576640699e-02   +3.810065444728480e-02   +9.056567540631848e-02   -2.364056174631725e-02   +1.265849825954466e-02   -1.381326031404003e-02   +5.809919987713055e-02   +9.861482276693014e-02   +7.892503006852111e-02   +1.173864127427810e-01   +2.647893476632286e-02   +1.582569232040307e-02   -2.831964349676557e-03; +2.355260371104709e-02   -1.259789565635138e-02   +3.800456751927445e-02   +2.767625612897080e-02   +3.550281589610129e-02   +1.139677564466205e-01   +4.812177834617520e-02   +2.346163035914176e-04   +5.905803813787928e-02   +1.020963842666113e-02   +1.557362663362577e-03   -1.155579958736074e-02   +7.668324366725840e-02   +1.625038977119324e-03   +1.644946656439893e-02   +2.650369572991369e-02; +2.164663432622518e-02   +5.689691050321524e-02   +1.709456035297538e-02   +3.788457529513711e-02   -6.332516771463114e-03   -2.208718871769682e-02   +5.806321448845357e-02   +5.300297792062552e-02   +9.870307100376570e-02   -3.424575131128875e-02   +9.348970366319950e-02   +2.313533572698271e-03   +8.727915757171087e-03   +6.873220391282980e-02   +7.603678169860627e-02   +1.064321032026335e-01; +9.908778382352841e-02   +5.651848497581363e-02   +2.005939914892799e-02   +1.646457369289060e-02   +2.781801137754331e-02   +2.509987867899038e-02   +4.714959141843813e-02   -2.128361312375037e-02   +1.400593851228326e-02   +5.964894610526566e-02   +5.554796778319226e-02   -1.729252973432537e-02   +2.694285108767232e-02   -3.375343533456154e-04   +6.187429757996174e-02   -6.701351575982457e-02; +7.996733983467399e-02   -2.300414924385383e-02   +9.397271322457391e-03   +7.315187440097731e-02   +5.279920338363417e-02   +7.384676115684966e-02   +6.216606791539959e-02   -4.465171282105042e-02   +8.448899646672170e-02   +1.980514505169747e-02   +4.056338817893151e-02   +4.643711647941599e-02   +3.077684325583945e-02   +1.934551660425248e-02   +5.890512987650523e-02   +1.168090529843872e-01; +2.436551238777843e-02   +4.906169075545834e-02   +9.608113866732878e-03   +2.522990870789053e-02   +4.660076534494351e-02   -3.469067326332711e-02   -8.513217402812225e-03   +5.334096762553378e-02   +8.799620312759070e-02   -2.959000985491575e-04   +3.826196250439138e-02   -5.667343139419456e-02   +7.284847236672666e-02   +7.432956305612334e-02   +3.645284932772443e-02   +2.844389215090778e-03; +5.334795298990390e-02   +6.477520721545523e-03   -4.267284325956782e-03   -1.274257365690901e-02   +8.285947296206107e-02   +5.546763862592236e-02   +2.631922875398614e-02   +2.214067696648670e-02   +5.221566801984285e-02   +2.316095368932411e-02   +3.301242371907755e-02   +1.250267234411860e-02   +8.963908646648611e-02   +6.232567161682815e-02   +4.633743059057014e-02   +7.119663677417284e-02];
L1E_L1I_iGABA_netcon = [+7.915636326314132e-03   +9.875085380288877e-02   +1.314457537332179e-02   +6.219990097870279e-02   +1.892809521362452e-02   +4.027525980515650e-02   +2.303549129353952e-02   -1.562600489564708e-02   +7.790970238252695e-02   -5.586485090750621e-03   -9.279522247417706e-03   +7.902171484171428e-03   +4.254846836988676e-02   +1.722696460889657e-02   +1.640379621936340e-02   +7.158171560601589e-02; +3.252778897634089e-02   -4.175361141213052e-02   +9.774015705412381e-02   +1.556510435895158e-02   -5.958044107448916e-02   +1.204805937223701e-03   +9.767959002856054e-03   +7.572047386431112e-02   -1.228418054388712e-03   -5.281872395834721e-02   +3.225106322949258e-02   +5.396386328050213e-02   +4.664341633260165e-02   +3.465040196247237e-02   +4.840790985840907e-02   +5.186387463568658e-02; -4.789531965504875e-02   +9.806369981714531e-02   -2.846897635063100e-02   -1.595288324058382e-02   -2.606056122611391e-02   -8.712935341916028e-03   +5.833887554678120e-02   +4.679783776156870e-02   +1.509925564186849e-03   +1.675890429262344e-02   +6.677831683879941e-02   +6.387799792564347e-02   +5.503549433025755e-02   -2.378589479839053e-02   +4.990604077156335e-02   +3.997750434686877e-03; +4.765044756264593e-02   +3.407730025965493e-02   +6.625353961149157e-02   -5.800975648912983e-02   +2.915312560930006e-02   +8.657843025930144e-02   +3.585865305096805e-02   +1.598560044805260e-02   +2.793310708479611e-02   +7.341686506156997e-02   +4.968447372371534e-02   +6.271129714284310e-02   +4.845332378851840e-02   +2.004032046059619e-02   +4.264328677582485e-02   -1.263273309347320e-02; +4.087970713888368e-02   +5.694057762295626e-02   +8.143671329060630e-02   +4.976633140117767e-02   +5.335125592257042e-02   +7.867609179813992e-02   +3.239951253700399e-02   +3.415202055126307e-02   +8.013036823709946e-02   +1.664547709074419e-02   +7.883715355049729e-02   -6.260567917210432e-03   -1.588984656962663e-02   -1.442691211100434e-02   +4.142166146858853e-02   +4.211558670178012e-02; +6.847354419269326e-02   -8.060935993536808e-03   +2.410565552625866e-02   +6.093904224063585e-02   +6.953553619168797e-02   -2.793671334047242e-02   +1.239475154659250e-02   -6.507527774121276e-03   +1.130534913008908e-01   +6.462386257974595e-02   +7.485745126326220e-02   -2.290793965038095e-02   +9.442154621670545e-02   -6.466314315775695e-02   +2.334327447185225e-02   +4.002770626143730e-02; -9.963996864316076e-03   +5.590769723793769e-02   +6.345398215366783e-02   +3.219955107105946e-02   +3.903263199624692e-02   +4.923778971354201e-02   +6.841375360001074e-02   -3.617144101031502e-03   +7.399156626300749e-03   +4.265610747380665e-02   -1.407133300065411e-02   +7.599834515206347e-02   +1.426541124093707e-02   -3.558958025996539e-02   +1.483751639011375e-02   +3.618725510722245e-02; +2.653475119579198e-02   +5.978247480104028e-02   +5.126034097938496e-02   +5.128412195709027e-02   +2.754491873058760e-02   +3.001566767889119e-02   -1.303557200614932e-02   -5.557727180471800e-02   +3.377591128205845e-02   +1.733492542043761e-02   +3.270512767175884e-02   -1.067686849955603e-02   -5.112264266139629e-04   +6.151863997118725e-02   -2.681613574754693e-02   +1.288082677698562e-01; -8.581160204647735e-03   +7.347602352759046e-02   +5.268108631909257e-02   -4.228718336640236e-02   +4.042425930173814e-02   -1.710827567161097e-02   -3.542629151095353e-02   +3.113900810957113e-02   +6.965823629991319e-02   -1.629960421679370e-02   +6.114609938076301e-02   +2.041189634405766e-02   +2.825953917517600e-02   +9.821880090194376e-02   +2.663175511236427e-02   +8.995786799840562e-02; +4.010485365566864e-02   +5.769754778184370e-02   -4.534912257698812e-03   +5.187945972824707e-02   +8.002198606129374e-03   +5.022350306915975e-02   +1.127281027499226e-01   +2.938112782281510e-02   +8.367583720577743e-02   +4.229875574419614e-02   +3.974623316519896e-02   +8.724999932627873e-02   +3.535379713244616e-02   +1.158537859131503e-01   +8.484232094770178e-02   +1.181444104419423e-02; +4.440468816434431e-02   +7.698742373447401e-03   -2.392823020258848e-02   +4.858541971350291e-02   +3.809249144698720e-02   +9.002729342150102e-02   +1.055196439559045e-03   +3.779165972436280e-02   +5.434094703507147e-02   +8.329945327065105e-02   +3.170424801709965e-02   +5.968388784684469e-02   +4.744528140474248e-03   +5.950020381342996e-02   -3.666806452642572e-02   +7.509812472491650e-02; +1.552619724722107e-02   -1.315003602753383e-02   +4.183074604159642e-02   +6.199315927057157e-02   +2.486165737738091e-02   -1.277384026540356e-02   +1.037059272433391e-02   +4.900107530932196e-02   -5.222594866031253e-02   +6.259863209626118e-02   +2.515135436157985e-02   -2.556618824289719e-02   +4.387876191392057e-02   +6.334066818242799e-02   +5.993686375716560e-02   +8.623745719439797e-02; +4.829972631757423e-03   +3.790905724805059e-02   +8.753281912326989e-02   +4.337827588427560e-02   -1.964589894235244e-02   +1.879262118672503e-02   +6.588407142238926e-04   +1.650622148687604e-02   +4.154533131750462e-02   +5.709402410861807e-02   +5.958569452799717e-02   -1.500554086050889e-02   +4.762950068771184e-02   +4.920318069199915e-02   +5.196181257595957e-02   +4.262670726800824e-03; +7.346100131850605e-03   +4.329328206987500e-02   +2.218849150448925e-02   -1.610212423480105e-02   +2.490050010761490e-02   -4.004391179928551e-02   -2.158854247731899e-02   +3.005717175557551e-02   +3.568976120791589e-03   +5.575399993952220e-02   -3.444044647196549e-02   +2.956927929758569e-02   +1.592320140532382e-02   +5.300754445368696e-02   -4.671139172258214e-02   +3.686704714886610e-03; +2.370326272869509e-02   -2.407078418728152e-02   +2.636485688805062e-02   +3.803314195144061e-02   -2.242556547717366e-02   +5.137890418930897e-02   +3.344504225304688e-02   +7.283451369367829e-03   +9.354745194661029e-02   +2.470384663032670e-02   +5.517466824130146e-03   +4.668718313531310e-02   -2.832276165386216e-02   -1.544791374672065e-02   +5.095809015120615e-02   +9.127929400732958e-02; +1.923108697306983e-02   -1.171720288808762e-02   +1.629516331181322e-02   -2.188070326873815e-04   +3.062293801985120e-02   +1.405546956665214e-01   -4.082287078469544e-02   -4.341833666166186e-03   +1.017858415110925e-01   +4.862565361414820e-02   +1.146270202915093e-01   +1.646480920277083e-02   -3.138381867806767e-02   +6.976679692786583e-02   +6.237564034955429e-02   -1.439092526606800e-02];
L2I_L1I_iGABA_netcon = [+4.231250193483248e-02   +4.254661418253974e-02   +1.377210306830100e-02   +1.686679077265972e-04   +3.050076583556140e-02   -2.210162010167836e-02   +4.471194399983794e-02   +2.496032168368940e-02; +7.363147747865869e-03   +9.509911190761300e-03   +2.957277672372732e-02   +4.245587401724897e-02   -4.623527431643090e-02   +1.772983451852299e-02   +8.889200778705172e-02   +3.785275856841924e-02; -1.237722245639272e-03   -6.266131387671309e-03   +1.026322091094141e-01   +9.723253447074368e-03   +1.382594935634940e-02   -1.051843152477537e-02   +8.045437846254806e-02   +1.545666179495779e-02; +9.574721933527428e-02   +7.970032149983780e-02   +4.280702556336578e-02   -5.764826580319120e-03   +6.960182242029386e-02   +3.093189299111126e-02   -4.509677696515769e-04   +1.268845931974762e-01; +6.127723498988157e-02   +4.974348587841396e-02   -2.265369788169071e-02   -9.715946925984292e-03   +1.820265801306357e-02   +5.571677300190756e-02   -4.534754827409665e-02   +2.549306610509787e-03; +3.999862967298096e-02   +8.546619870860390e-02   +8.569833185470842e-02   -2.005860002898498e-02   +7.928440198856052e-02   +3.930379104567111e-02   +2.397116509293797e-02   -1.941685414262118e-02; +5.698772499592584e-02   +4.496530223517092e-02   -5.609851497522497e-02   +2.519393982675200e-02   +2.251702489976228e-02   -3.943007261997192e-02   -9.766621426956473e-03   +7.225507050279947e-02; -7.728273676485497e-03   +4.806019783214543e-02   -3.372011550433900e-02   +1.048979606634178e-01   +2.701821652398790e-02   -1.099412605714989e-02   +3.781119459950868e-02   +1.727405348454944e-02; -4.912857302624390e-03   +9.809250058207579e-02   +2.057277745360868e-02   +2.390188541184683e-02   +2.775665593019209e-02   +2.275688282237436e-02   +3.975634901748776e-02   +3.406496354696969e-02; -7.194890652053381e-03   +2.955362139136719e-02   -2.435220703668212e-02   +5.334336395868223e-02   +5.066934072217582e-02   -3.124842628351425e-02   +4.000352837723313e-03   -1.142533251131079e-02; +6.790203228890349e-02   +3.687622626892186e-02   +7.379112715151120e-02   +5.308369551892800e-02   -1.563127555507921e-02   -2.672374591407047e-02   +9.187074772274181e-02   +7.648623369168502e-02; +3.582333955794570e-03   +3.497773784653635e-02   +1.113582473767551e-04   +4.652907333845639e-02   +7.859861973984673e-02   +8.431503791880847e-02   +6.080460933597114e-02   +5.241433731668409e-02; -2.701263004218411e-02   -6.089426222061917e-02   -2.619508770464470e-02   +1.083540792381800e-01   +8.075631261518133e-02   +7.792970564146422e-02   -2.698834554000003e-02   -3.977460439026567e-02; -5.789776852618705e-03   -3.850474155283463e-02   +5.919531914574407e-02   -2.609135813280488e-02   +3.557941985235752e-02   -2.143784580256626e-02   +1.653768298203189e-02   +5.204663650213012e-02; +3.859012078557119e-02   +6.855352895329996e-03   +6.660511989940847e-03   +6.237471040358877e-02   +1.376460392390816e-02   +7.690213265637241e-02   +1.113074394662636e-01   +7.166748897275756e-02; +3.071899295448534e-02   +8.940967696071579e-02   +1.935198545407201e-02   +8.415791437198028e-02   +4.011156670011275e-02   +4.298338899296053e-02   +4.833074929618239e-02   -5.618662425200337e-03];
L1I_L2I_iGABA_netcon = [-4.332093708880111e-02   +3.621259470037728e-02   -7.840847824984776e-03   -4.339043332191136e-02   +6.182028349911249e-02   +5.836884715286209e-02   +4.978570343025936e-02   +8.561535372787629e-02   +5.829881120850028e-02   +9.293644668997891e-02   +6.783306925286142e-02   +2.566437406514186e-02   -2.218163286531865e-02   +2.735680463932256e-02   +2.551972468470005e-02   -2.035517174114088e-02; +7.283219229703118e-02   +1.230544988348353e-02   +1.139422882136681e-02   +1.556552382039203e-02   +3.170508617635249e-02   +1.017421091006585e-02   +4.248698252452582e-02   +5.597528644821493e-02   +6.445894357428006e-02   +7.452189382646832e-02   +2.852634915411494e-02   -3.300604419479252e-02   +9.858469085900860e-02   -7.419223193166155e-03   -7.266339406759156e-03   +4.835914426888652e-02; +4.587906120226343e-02   +3.573319908967480e-02   +8.633509070818746e-02   +4.261524370455901e-03   +9.740462949051031e-02   -3.280477131555816e-02   +5.740887948717453e-02   +6.853368782851140e-03   +2.393724040188623e-02   +7.273411369002297e-02   +6.029730480314029e-02   +5.673131567259244e-02   +6.668272170823035e-02   -6.134971204478373e-02   -3.295021655002357e-02   -3.237247572430885e-03; +2.874884557474526e-02   +6.697597251579593e-02   +5.875356812481656e-02   +1.650789793614229e-02   +4.994259669311740e-02   +4.454652130937245e-02   +8.812973794763805e-04   +3.959300637704043e-02   +7.700983203295236e-03   +8.054217449226470e-02   +5.384432446769871e-02   -2.679158218750058e-02   +4.041558738138459e-02   +5.634638224865915e-02   -2.586613863173769e-03   +8.388379755344096e-02; +4.698084632918237e-02   +2.586687368059096e-02   +7.703120815592096e-02   +7.398626466625119e-02   +1.119597120450570e-01   +5.799758071495867e-02   +5.703945368263349e-03   -1.834530917282179e-02   +9.052710733737136e-02   +3.293274044402144e-02   +1.869292232777421e-02   +4.371282744037921e-02   +2.089057600644606e-02   -1.302956869171365e-03   +6.022758044152205e-02   +7.120532165711126e-02; +1.398730832115509e-02   +2.413746863040874e-02   -3.242250509377026e-02   +8.888241905767053e-02   +8.577127993903241e-02   +5.590156437521462e-02   -2.741943107105969e-02   +2.266717045651286e-03   +3.742814863544781e-02   +2.742537395257566e-02   +6.708214161122017e-02   +2.971172111068248e-02   -7.906259379344445e-02   +6.869529873240394e-02   +4.078440504089809e-02   +9.516959296225652e-02; +4.516104654934674e-02   +9.110247738940563e-03   +5.655370511650540e-02   +6.418299371679326e-02   -2.327418590625577e-02   +6.233571489499550e-02   +1.897247437509622e-02   +2.358848749005424e-02   +4.028530907998150e-02   +3.605344422010865e-02   +4.439113754420704e-02   +2.865854833579374e-02   +2.937130549717492e-02   +1.109438815842267e-02   +6.327014180182257e-02   +3.153921578460513e-02; +1.837661576981671e-02   +5.116196259979142e-02   +4.804533084175824e-02   +4.385868643939031e-02   +4.397695117235587e-02   +6.464580039179318e-02   +7.943119014927592e-02   -3.023003010640548e-02   +7.310827542943843e-02   +6.234436769860119e-02   +8.472198871068996e-02   +6.480782305682152e-03   +1.510671221603873e-02   -5.176382764205193e-03   +4.106988169504567e-02   -6.504593031263932e-02];
L2E_L1E_iAMPA_netcon = [+1.403032208849615e-03   +9.589961837288254e-02   +3.882055154027915e-02   +8.334386889638007e-02   -5.463554451811359e-03   +8.574924626543176e-03   +6.438665876544408e-02   +7.437442948584339e-04; -4.704545947427619e-02   +3.179510610251845e-03   +1.711106577609224e-02   -2.168778078327312e-02   +2.767624566557115e-03   +1.971656944916859e-03   +1.720292089362541e-02   -2.345388398346005e-02; -1.973845107228247e-02   +4.226770294747737e-03   +9.115157286893195e-02   +6.724348210160105e-02   +2.357980978620503e-03   +4.651451602237015e-02   +9.331298110316136e-02   -8.679992462838021e-03; +7.851861872063312e-02   -5.820842637550394e-03   -4.187297388840826e-02   +4.855594570986715e-02   +1.176442383437675e-03   +3.440189096707651e-02   +4.011872138254120e-02   -3.600883748725681e-02; +7.060737629328767e-02   +1.113136270104407e-01   +8.824741491731940e-03   -4.650413801708059e-03   +6.171243578310190e-02   +4.730774746776407e-02   -7.505318090805430e-03   -5.881620314524207e-02; +1.074540938812186e-01   +2.406029009759059e-02   +2.290669992385484e-02   +3.549520633800849e-02   -2.182020588729015e-02   +5.344626017102284e-02   +8.690978141647814e-02   +2.536408294847204e-02; +9.433224103377165e-03   +4.410818804773511e-02   +4.203864238737811e-02   +1.329524081149281e-02   +8.430923444789903e-03   +1.066227833433306e-01   +4.499285564583131e-02   +9.043893713812304e-02; +5.942676687356870e-02   +1.043959699900830e-01   +6.814070757556172e-02   +2.119138849449230e-02   +8.429925675850292e-02   +2.181909030525583e-02   +2.867917510829852e-02   +7.926929404869781e-02; +7.658347691615389e-02   -1.572319918188258e-02   -2.902474667297028e-02   +1.216929069166850e-02   +8.951443427770077e-02   +3.001548080878076e-02   +5.725721588034719e-02   +9.167482882280109e-02; +8.402290047753700e-03   +5.974182579823377e-02   +1.554521753823824e-02   +1.060846084371635e-02   +6.285781435719021e-02   +2.147641218257398e-02   -3.799214693329065e-02   +1.155269980115019e-02; +7.904872015863582e-02   +6.147566186730916e-02   -2.949998768176094e-03   +1.076926392814122e-02   +1.950887009709637e-02   +7.171607689372077e-02   +4.807628573970174e-02   -2.288284903714893e-02; +1.598393463853687e-02   +2.529074156834969e-02   +2.044479261816074e-03   +5.942054668796082e-02   +2.587787753950525e-02   +7.367792531484951e-02   -6.350650446980284e-03   +7.126447735376448e-02; +1.731157889175326e-02   +6.827901913339487e-02   +9.110440863068166e-02   +1.531169184831263e-02   +6.106652201518688e-02   -4.448338934673557e-02   +8.150628850994114e-02   +3.997735528344908e-02; +1.126246433030699e-02   +1.597563449798577e-04   +7.825064810463139e-02   +7.216478480733669e-02   -2.426111161990219e-02   +6.337080299767686e-02   +3.644435883430590e-03   +2.837192339427412e-02; +4.647462728951286e-02   +3.694222824228383e-02   -5.153499147615957e-02   +1.401649158096089e-02   +2.965070871621567e-02   +1.694717039420868e-03   +2.419330198627692e-02   +3.499823343406850e-02; +4.478618319180470e-02   +3.568591205921729e-02   +4.627934518029220e-02   +1.549355937572861e-02   +3.145565210097770e-02   -4.265897516600699e-02   +3.964760783160793e-02   +2.844281990210524e-02];
L1E_L2E_iAMPA_netcon = [-7.273894714255615e-03   +3.995515070131642e-02   +6.889364012900248e-02   +5.009003368812074e-02   +5.179623757525009e-02   +6.944754086997280e-02   +1.383345995053004e-02   +4.774392849978386e-02   +1.185224338259999e-01   -4.448232816714436e-02   +4.965839795153824e-02   -1.810091047658725e-02   +1.370031202784308e-02   -4.284172652970904e-02   +1.665737937834082e-02   +6.547407090591412e-02; +8.000024154354135e-03   +1.813285130965658e-02   +7.919761123243770e-03   +4.117288370071926e-02   +2.531605270064874e-02   -1.643439067520828e-03   +2.887958525671210e-02   -4.570203013014985e-02   -3.303418023959652e-02   -7.987460228956950e-02   -6.246134108237452e-02   -4.578562898710645e-03   +8.217824125321038e-02   -2.700408805451530e-02   +2.398924662535606e-02   +2.167030723129088e-02; -7.079532991868756e-03   +2.973039679678213e-02   +9.293256765099557e-02   +6.328149984457533e-02   +7.845847037085059e-02   +4.085355348252807e-02   +1.451347261742800e-03   +5.173841425971631e-02   +4.413699264654707e-02   -5.858441778590373e-03   -2.790159659563180e-02   +5.890565764345091e-02   -1.162943807409712e-02   +1.093044918870273e-02   +7.258271890132886e-03   +5.282624740897753e-02; +3.361494059251066e-03   -2.725076976684394e-02   +1.971251006347575e-02   +1.074564033128566e-01   -1.329572179390917e-02   +2.438980624907335e-02   +4.022317284213733e-02   +2.622241349772791e-02   +7.780624302421438e-02   +1.310527547664808e-01   +4.446026598594471e-02   -5.128605654489655e-03   +4.292844716427950e-02   -1.430868859265122e-02   +3.363216344112210e-02   +9.069737940432528e-02; +5.420862146779198e-02   +3.099609599140858e-02   -2.370395979434114e-02   +1.627865092309117e-02   +1.107858798562364e-01   +1.060710370929216e-01   +5.637024250207952e-02   +4.432639264499080e-02   +2.762741863064107e-02   +3.902028769034700e-02   +1.094886567338524e-01   +1.516382173665709e-02   -2.175048558847024e-03   +7.382242774487800e-02   +3.277490675464059e-02   +2.531685289863529e-02; +5.006005529556815e-02   +3.859851408745431e-02   -2.316017102986723e-02   -1.567523563219699e-03   +2.814957740301364e-02   +4.922806162611098e-02   +3.934979363071985e-03   +2.422961007427933e-02   +9.030299521766831e-02   +2.655246752094854e-02   +1.621489270775136e-02   -1.916376137861197e-02   +4.339515963324160e-02   +4.186711020109963e-02   +5.244574783531701e-02   +2.404098741450330e-02; +3.664615032327302e-02   +1.821617894128423e-02   +2.907545256204937e-02   +3.188615854212196e-02   +6.914885972662294e-02   -9.267620696918333e-03   +1.327477572456911e-02   +3.709628460538312e-02   +2.933669453246650e-02   +3.343997373609951e-02   +1.004999047165920e-03   +4.858130135887409e-03   +1.533574723246367e-02   +1.473625983453344e-02   +7.633463867111986e-02   +5.179837463730215e-02; -1.079721275140711e-02   -4.848610489308864e-02   +9.744505941762696e-02   +4.647150595585958e-02   +2.581545870805308e-02   +6.025508481203624e-02   +5.199993758800595e-02   -2.655632932280356e-02   +1.225230930661344e-02   +8.644060251830787e-02   +1.086562348734855e-01   +1.166711605428962e-02   +4.769541346588695e-02   +2.054178177370713e-02   +8.504348634739799e-02   +4.462415070179437e-02];
L2I_L2E_iAMPA_netcon = [+2.584967661519263e-02   +2.678911533555585e-02   -1.064707383112092e-02   -3.615196421493627e-02   +5.962169334494798e-02   +3.815976472519394e-02   -3.050059413417012e-02   +6.278442358544302e-02; -2.244121545876393e-02   +6.583804447604816e-02   +3.830749607213343e-02   -1.435741382156605e-02   -3.281617393347116e-03   +5.508010992311878e-02   -1.478939124628699e-02   +1.275800224659902e-02; -1.870629038954090e-02   +2.447697124997947e-02   -2.086718783123998e-03   -9.384430686941973e-03   +5.569626186558282e-02   +9.241943900017906e-02   +2.726199479396700e-02   +1.858456750359093e-02; +2.155176997590063e-02   +4.960320776374789e-02   +2.158368202180929e-02   +2.308865121858016e-02   +4.164064801102506e-02   +3.132571557550635e-02   +5.273455519666996e-02   +5.464798093930485e-02; +3.805418739409095e-05   +7.323802461155798e-02   +2.220689125106395e-03   +1.044221976454857e-02   +1.828362873483779e-02   +3.082031120649633e-02   +4.800181545067583e-02   +1.100049361844696e-01; +2.446860969514434e-02   +3.075556795152096e-02   +4.298868893546294e-02   -7.685886581470998e-03   +7.018718691372214e-02   +1.622252712074412e-02   +1.694115061796667e-02   +1.177978398533632e-02; -3.034394599109550e-02   +7.228270756677752e-03   +4.096424439854394e-02   +7.536925332709896e-02   -6.218041201321822e-02   +5.721102979440371e-02   -2.883689254233141e-02   +8.958307075564977e-02; +4.294205929917152e-03   +5.603810611722822e-02   +9.224323064174515e-02   +4.998139317815562e-02   +2.639855906490624e-02   +3.076863002420183e-02   -1.143723414863396e-03   -1.781997528861167e-02];
L2E_L2I_iGABA_netcon = [+4.407023019902402e-02   +6.680222019725691e-02   +2.607702069761767e-03   -2.121052842358774e-02   +1.599814701125590e-02   +6.480118227136404e-02   +3.843489826385330e-02   -4.094970026428389e-02; +1.005602176901758e-01   +4.008422176313113e-02   -1.265952601932699e-02   +4.862730791315381e-02   +2.774213500583223e-02   +1.233171564301912e-02   +3.497209126827777e-02   +3.528408373801748e-02; -4.628824652283928e-03   +4.017591657554662e-02   +3.302693864151065e-02   +3.168025426329299e-02   +2.568733883621029e-02   +7.638843196582225e-02   +1.670739866153715e-02   +2.649635755368721e-02; +7.160125251323432e-02   +2.942571889101644e-02   +5.308992833597997e-02   +1.230301869753134e-02   +5.321762149968114e-02   +1.163269742424294e-01   +3.786748660815972e-02   +2.525485606009898e-02; +3.256063316260965e-02   +3.910863306971222e-02   +4.763390993570317e-02   -1.083860303820025e-02   +5.109739052087237e-02   +2.570285106879511e-02   +9.318387403699335e-02   +1.383086336850112e-02; +6.566054735237763e-02   +4.594400140054056e-02   +6.253135629973994e-02   +2.069996809017257e-02   +1.119716137420317e-02   +7.530068965683391e-02   +1.313016015415600e-02   -5.336078537145448e-02; +9.122260051403609e-02   -1.254383814163272e-02   +5.626830802020154e-02   +1.509405267161170e-02   +1.637197226449996e-02   +1.532499757379616e-02   +7.666966222254182e-04   -5.079162276942241e-02; +1.008448629565885e-02   -9.971540346210976e-03   -7.444859042539892e-03   +3.932295883538792e-02   +3.216480955570709e-02   +2.992697476395121e-02   +4.454331643975484e-04   +2.511641346228284e-02];
L3E_L2E_iAMPA_netcon = [-4.356804231610082e-02   +5.245262077582680e-02   +1.203365385574301e-02   +4.498219191923716e-03   +8.336918285230384e-02   +3.072461116702694e-02   +4.500120354947780e-02   +3.332579232537703e-02   -2.220351505439693e-02   +8.649563753131390e-02   +6.322322753675191e-02   +2.784116098744595e-02; -1.241281346328032e-02   +5.918892502005975e-02   +2.407625652957944e-02   +4.982639325357288e-02   +3.759934731852500e-02   +1.083785212261155e-01   +2.671961787591019e-03   -4.482840042880567e-03   +6.405965113832435e-02   -3.750139520294614e-02   +7.738259918432910e-02   +1.867576545852482e-02; +3.924460097329203e-02   +1.089104751588013e-01   +6.509640503979441e-02   +2.337226713024418e-02   +2.547006409554719e-02   +2.055895093432192e-02   +4.165012988047753e-02   +8.008076880788669e-03   +1.134583789324297e-02   +8.326678215035432e-02   +2.134251212520460e-02   +3.501170565460070e-02; +3.333067844197120e-02   +5.265277520997985e-02   +6.162202793675922e-02   +2.254000585891456e-02   -1.240743843991461e-02   +2.117591909559729e-02   +5.105057560072313e-03   +4.740400957281697e-02   -2.430591061079151e-02   +7.380353012165902e-02   +3.317053626092119e-02   +1.084022724355359e-03; -1.308409206526878e-03   +6.255747407160347e-02   +1.307824337858348e-01   +8.781498404268112e-02   +3.662499323559845e-03   +7.468495236461058e-02   +1.852291809601646e-02   +5.805697896444788e-02   +2.085082330302013e-02   +5.273830196916383e-02   +8.150878965556022e-02   +1.322269398577493e-02; +5.060259572834677e-02   +7.559345569705340e-03   -1.719581680077097e-02   +6.364941856057868e-02   +7.369653568582966e-02   -1.511118206251814e-03   +6.249369150618182e-02   +6.686276193699953e-02   +3.431687243392338e-02   +2.614207984625401e-02   +1.828014473619343e-03   -4.029228698908751e-02; +7.927713960942884e-02   +5.803576357780030e-02   +5.686313432247402e-02   -2.227248782585332e-03   -1.566898018117661e-02   +5.045412526031141e-02   +1.239749450322516e-03   +4.667917739936779e-03   +3.576815707946453e-02   +3.548044268361115e-02   +1.174962444781470e-01   +7.506377933687192e-02; +1.656244358681937e-02   +4.510126431830159e-02   +5.078113895370201e-02   +5.667180117739630e-02   +3.117389715946626e-02   +2.898489886046094e-02   -1.567184864423219e-02   -4.009467909529005e-02   +1.208996631994334e-02   -1.846114154151482e-02   -7.768290446257639e-03   -1.389479506289692e-03];
L3I_L2I_iGABA_netcon = [+8.965874098302454e-02   +7.896242481664298e-02   -2.943726703065035e-02   +6.699643797857932e-02   +3.307549928611803e-02   +7.384897116314778e-03   +1.965326576027145e-02   +5.662575992955248e-02   +4.983742220194317e-02   +5.009844542050518e-02   +6.846239303880865e-02   -3.150209086733038e-02; +2.885287660097190e-02   -1.506035041289494e-02   +2.481729106696978e-02   +4.836457958430113e-02   +1.018085500660260e-02   +8.099129416757864e-02   +4.610501075069302e-02   +3.113835993204308e-03   +9.464321190598913e-03   +6.791085007962967e-02   +4.639839211516237e-02   -4.954400295001672e-02; +1.594796936891194e-02   +1.064409435863998e-01   +6.376073589705352e-03   +5.232792262271939e-02   +9.205957985094279e-02   +1.626427399552784e-02   +4.925458954470940e-02   +3.749951867795626e-02   +1.017098494172492e-01   -3.490092565530552e-02   +4.495634256679252e-02   +5.832562692436480e-02; +3.140146751382163e-02   +6.099728002097058e-02   +8.598971721442733e-02   -7.922908587848056e-03   +1.099922586675097e-01   +4.630579353114003e-02   -4.669423570094678e-02   +4.804362271355375e-02   +9.118286199074131e-02   +1.804593228218562e-02   -1.931520614885674e-02   +1.106563376820478e-01; +3.387859464505379e-02   +3.450961436918393e-02   +9.677791596607231e-02   +3.793138852948379e-02   +1.254662452353330e-01   +1.406229555035678e-02   -2.773090440123815e-02   +1.103207453179594e-01   -3.909528117074097e-03   -1.427759500147762e-02   +1.481693306008549e-02   +6.319948433430186e-02; +4.609893887326944e-02   +7.718068894684363e-02   +5.726240338027158e-02   +2.651425257210924e-02   +7.250286280600840e-02   +4.071193537062374e-02   +1.278814870472752e-02   -9.851185515080192e-03   -2.281548178065724e-02   +5.679847032910157e-02   +4.273641797466662e-02   -1.062796067889675e-02; +2.532114687888619e-02   +4.659592556672682e-02   +4.391896626927144e-02   +6.962879848098152e-02   +2.034335237867767e-02   +5.862296726355616e-02   +7.261090201731869e-04   -1.087204200040764e-03   -4.215789374464844e-02   +4.671167791496107e-02   +5.385061035470456e-02   +4.594900228449795e-02; +5.764972323955221e-02   -1.308991069784750e-02   +3.589082228891236e-02   -1.574909371274396e-03   +7.819672789555017e-02   +8.967823513093146e-02   +5.567256718144249e-02   +6.737565884817467e-02   +1.158021126990319e-02   +8.306346804236722e-02   +4.954547385736165e-03   +3.280683889872837e-02];
L2E_L3E_iAMPA_netcon = [+6.901963599586873e-02   +2.897583855288230e-02   +4.648409795625030e-02   +6.508874428913106e-03   -3.371361145084492e-03   +4.023954127270519e-02   -2.416863748558260e-02   -9.704655876171770e-03; +5.254818952145075e-02   +7.215581453611691e-02   +7.365064884484240e-02   -2.589823475008262e-02   +1.330349920993663e-01   +7.482396576985471e-02   +2.412709613648680e-02   +3.833800935748698e-02; -2.407496146225258e-02   +1.078042798073913e-02   +5.317453077134660e-04   +3.642940446387854e-02   +1.534847990951795e-02   +8.209698377735178e-02   +9.077739718901057e-02   -7.330129925244562e-03; +1.150156859075490e-02   +3.112645873525427e-02   +1.942549140155191e-02   +1.008031393180841e-01   +3.729955751060218e-02   +8.479079950669421e-02   +4.724946900131710e-02   +4.419912017771967e-02; +4.292807484260225e-02   +1.059958252680456e-01   +4.815262069110814e-02   +2.502454707084511e-02   +4.504379222371752e-02   -3.950720634160769e-02   +4.483199886027876e-02   +1.937138826418466e-04; +5.870410513694174e-03   +9.754007640915849e-02   +1.745882892570067e-02   -6.225915115981683e-03   +7.137978764383734e-02   +5.068477350617545e-02   +5.637025224978318e-02   +5.862028899316907e-02; -1.239301856686430e-02   -6.045631277681118e-03   +8.536484068158415e-03   +2.752205079776256e-02   +4.639046416224726e-02   +1.802004655875811e-02   -2.270156400627381e-02   +4.934118042486810e-02; -1.095107112723405e-02   -5.315907138241224e-02   -1.349752953415653e-02   +2.437042353249921e-02   +4.270559231460661e-02   -3.732672507679513e-02   +2.682150602377546e-02   +2.955205946567743e-02; +6.709539295369654e-02   +3.644297255850058e-02   +9.557538255393025e-03   +4.945236372530717e-02   +9.343727573538043e-03   -1.099645361489431e-02   +6.306711688763197e-02   +4.739402966511333e-02; -2.146383683958225e-02   +2.182649087892123e-03   +2.585799953935571e-02   +2.351672066941989e-02   -2.725917782560641e-02   +1.666372595782874e-02   -1.107764644358201e-02   +2.274777489797664e-02; +5.088068285324130e-02   +2.337375400885939e-02   +5.471047505737783e-02   +5.324006674946104e-02   -4.194490030170691e-02   +1.488993947472403e-02   +1.310225600535594e-03   +4.210540540670566e-02; +5.842946572468406e-03   -5.438008249406940e-04   +8.997082150065269e-02   +4.226243491463864e-02   +9.554643875363223e-03   +2.117408468959242e-02   +5.117097837871731e-02   +4.564899190835472e-02];
L2I_L3I_iGABA_netcon = [+2.150978321243313e-02   +3.432634867721798e-02   -5.616116194477172e-03   +2.280359191911743e-02   +3.566805085737270e-02   -1.622553098901261e-02   -3.001509752802514e-02   +3.716708167023433e-02; -1.894029322820019e-03   +6.836620664050522e-02   -2.249696994854291e-02   +6.331782940120628e-02   -3.433306541798625e-02   +2.960887977060413e-02   +3.890957047406329e-02   +3.096244800831589e-02; +2.997302224003628e-02   +5.765245762438594e-02   +5.755670991039581e-02   +4.109571772532253e-02   -1.943414761091870e-03   +8.448157701006891e-03   +5.597278691200674e-02   +6.587917057139460e-02; +5.817243160264132e-02   +3.933770218188380e-03   +2.652416552817445e-02   +8.301692151402953e-02   -5.618681091815493e-04   -1.409132756256766e-02   +2.752521469850028e-02   +4.054930221179377e-02; +5.529039743691644e-02   +7.290236399948731e-02   +4.993470908348991e-02   +1.798045203474944e-02   +3.501477089000604e-02   +5.162964136321106e-02   +5.424300489340203e-02   +5.915046350658939e-02; +4.908146772323277e-02   +5.184130813887287e-02   +2.363418358455817e-02   +2.606144330747430e-02   +6.066834578978138e-02   +2.701951029701675e-02   +5.591105256706794e-02   +2.609554919135375e-02; +7.346616771868643e-02   +1.487982439640500e-02   +3.370964764744583e-02   +5.356301815398132e-02   +3.358958892075186e-02   -6.441613350842084e-03   -1.880626535474706e-02   +2.344748612900841e-02; +6.805554023836046e-03   -5.541297160569522e-02   +7.858768700930299e-02   +8.307526016782459e-02   +6.174749170346913e-02   -2.705663044355913e-02   +1.160906201451646e-02   -1.228237356792401e-02; -6.915138254285445e-03   +3.176591804327746e-03   +9.661450977121280e-02   +3.857465145177558e-02   +4.190246585133559e-02   +3.281932694957065e-02   +3.802865695599620e-02   +8.890391968392124e-02; -8.545615932234883e-03   +1.026472680646102e-02   -2.242201195234515e-02   +4.319475790596367e-02   +9.643832264428281e-02   -2.162775053189738e-02   +5.591391956096068e-02   +6.673416823465449e-02; -1.622547891933393e-02   +6.450610491670691e-02   +1.445381243200995e-02   +3.085928706494158e-02   +2.330307297884093e-02   +3.914408877670508e-02   +3.587805102781597e-02   -1.871562539742431e-03; -1.124643566058830e-02   +9.627914592870811e-03   +4.129700970187609e-03   -1.408154098905217e-02   +2.410689328266061e-02   +4.576424741509024e-02   +1.326659770748002e-02   -1.886436738916705e-02];
L3I_L3E_iAMPA_netcon = [+1.706587755310393e-04   -6.835938890525696e-03   +3.677299082056184e-02   +4.139025764796742e-02   -4.317735450328723e-02   +6.276291400785088e-02   +6.497425638209428e-02   -3.965517935345887e-02   -3.754938490844031e-02   +1.565122726708723e-02   +5.182816901243491e-02   -1.958854296819153e-02; +4.050660989658596e-02   -4.887293260671558e-02   -1.252527517077829e-02   +2.292073761447181e-02   +2.589451957377839e-02   +3.227371877601500e-02   +7.245635035556343e-02   +4.407426705190772e-02   +5.057677312165942e-02   -1.385536133984674e-03   +6.849191381009462e-02   +9.567336513721508e-02; -3.455277374409883e-02   +6.206232168673391e-02   +1.315780321710833e-02   -2.314054100422217e-02   +2.459775535856383e-02   +7.256860821541895e-02   -1.421622072454658e-02   -4.223888792446322e-03   -1.183334797603347e-02   +6.020371498570333e-02   -4.427436128393627e-03   +6.306897286196872e-02; +1.714535966151750e-02   +3.982039906753542e-03   -4.238883582897020e-02   +4.357797790614815e-02   -1.543722384041769e-02   +2.847238807151760e-02   +2.632619647557284e-02   +4.964637084708898e-02   +3.665818993258051e-02   +2.831059148756063e-02   -1.025267030576881e-02   +5.557494675725820e-02; +1.793323502105035e-03   +6.258784337352684e-02   +8.335563734314454e-03   -4.594925765172972e-03   +2.943467148991577e-02   -2.612836995667560e-02   -3.085958811492512e-02   +4.216930903655480e-02   +1.260734164963043e-02   +2.307741822571300e-02   +1.054481072383477e-02   +6.698631913317427e-02; +3.364365580471163e-02   -5.697584737804894e-03   +2.816162674744897e-02   +1.015737863132238e-01   +1.500187228648258e-02   +6.010003228723726e-02   +3.228419688663702e-03   +3.019800255076684e-02   +8.169123221025630e-02   +1.368218790962123e-02   +3.549542652360436e-02   +5.180541037580960e-02; -2.364731946643894e-02   +4.182546452409479e-02   +6.844087999516572e-02   -2.214839436917312e-02   +4.401046068313266e-02   +3.317904224157557e-02   +3.646921120102265e-02   +9.048344303144526e-02   +3.257470588916291e-02   +1.899168593276488e-02   -2.339581538865807e-02   -1.904023059200463e-02; +5.634068222151233e-02   +7.948245073358273e-02   -4.997855391820549e-04   +1.093940083773872e-01   +6.862863915976283e-02   +1.770228180917558e-02   -4.909481126934868e-02   +6.369026725097329e-02   -3.471149053360942e-02   +4.492464384014366e-02   +1.853393438027859e-02   -4.019687200179331e-02; -7.087288463717825e-02   -1.403907281220127e-02   -2.705661594216622e-02   -9.952830678681218e-03   +2.367769381569847e-02   +1.063248863544673e-02   +2.133606428775594e-02   -1.006162393850732e-03   -2.910608010900815e-02   +5.507022303823832e-02   +2.910541153887967e-02   +1.453405930561276e-02; +6.581927510170554e-02   +1.361037939883233e-04   -6.819156273861321e-03   +2.165478234608420e-02   +2.006600492095779e-02   +3.208815648955016e-02   +3.046922965160520e-02   +1.218159101263436e-01   +8.514422530633958e-02   +1.952209053982251e-02   -3.601077936363318e-02   +5.650723128172026e-02; +7.447233028535226e-02   +2.287432816752371e-02   +1.826786334342407e-02   -2.817296755955330e-02   -2.278885662984844e-02   -4.203841847021001e-03   +3.654258221141900e-04   +4.788587238584809e-02   +1.918068417823676e-02   -3.970678183499802e-02   -1.556549556821355e-02   +5.017128807007817e-02; +4.810882057935884e-02   -5.763172545166050e-03   +5.220430714675582e-02   +7.980993087824186e-02   -2.668442228052817e-02   +3.581188187080576e-02   +8.605096410652202e-02   +2.084606764619366e-02   -2.748797027453558e-02   +3.222535962734070e-02   +4.727467886733611e-02   +6.545528466273504e-02];
L3E_L3I_iGABA_netcon = [+8.948749287694081e-03   +4.652384295915500e-02   +4.453765607103436e-02   +1.196930152343033e-01   +4.004254178009696e-02   +6.399937297090146e-02   +1.529662999424312e-02   -8.840798990703839e-03   +3.274623905475374e-02   +5.833267316689766e-02   +7.359528090578273e-02   +3.235958098681141e-02; -1.568275711661294e-02   +9.507570160439799e-03   +6.067644391545710e-02   +2.576791313554946e-02   +1.031758996053246e-02   +1.871712102381048e-02   +3.982414293285375e-02   +4.616098066390718e-02   -5.660082598876138e-02   +7.574542183258616e-02   +4.700782798111974e-02   +7.979803963872198e-03; +5.988340958678567e-02   -1.544321292122693e-02   +4.982295443114867e-02   +8.190449413103892e-02   +4.183927844598394e-02   +5.062591915087965e-02   +4.291505354064454e-02   +5.722961238698710e-02   -9.252955295134762e-03   +9.779120131608500e-02   +3.955192617607688e-02   -1.699942149921431e-02; +1.727957452829344e-02   +4.748594159952238e-02   -8.865417466076947e-03   -2.315982050129482e-02   -2.145425969878852e-03   +7.729302887098635e-02   +3.079684756330203e-02   -5.963839610119093e-03   +7.597039609186543e-03   -4.334958143291150e-02   +7.278552362030420e-02   -2.949574511994593e-02; +7.361137161353036e-02   +4.662844097641343e-02   +7.101305149266060e-02   +3.984963220536993e-02   -2.246954574618831e-02   +2.685186054011295e-02   +7.195460606213618e-04   +5.417957745655733e-02   -6.623125674582384e-04   +8.784752463943929e-02   +2.653977973476392e-02   +3.444587737262944e-02; +1.211995588359100e-03   +6.490308194316258e-03   +3.255843531106206e-02   +3.066985803417052e-02   +6.167616051695889e-02   +4.909107325487488e-02   +2.063792438862697e-02   +3.363487687304596e-02   +3.955566230998880e-02   +2.891347095001063e-02   +5.149635122513244e-02   +3.735511836472489e-03; +5.833373224597261e-03   +3.858345152888625e-02   -5.472549507728432e-03   -5.400976158231287e-02   +5.242603661680886e-02   +3.392251317738704e-02   +8.433388018303593e-03   +4.166652879468846e-02   -8.430230463379720e-03   +5.041319482984891e-02   +2.348901339598487e-02   -1.431281608334925e-02; +7.211214342248697e-02   +2.403662085219376e-02   +4.839944365440236e-03   +1.147843740183679e-01   +1.547899356346461e-02   -5.301334768318746e-03   -1.836478996981201e-02   +5.780628421168555e-02   +4.090821324784502e-02   +1.053705639128949e-02   +3.909399103579099e-02   +1.330078793314753e-02; +7.651538439847739e-03   +8.186760652120832e-02   -2.836831346327155e-03   -6.140689072839362e-03   +1.051051655619381e-01   +5.731646435517287e-02   +2.461998335610632e-02   -3.649077531291410e-02   -1.183485413632338e-02   +5.734175384815940e-02   +6.877392593849475e-02   +2.717041245163447e-02; +3.340024697209926e-03   +3.575619074101555e-02   +4.858222383206809e-02   +2.597686816701777e-03   +5.307741964195662e-03   -8.745203861435444e-04   +4.146044761945477e-02   +4.600607534549830e-02   -8.918817001732981e-03   +5.682603672203479e-02   +7.956479433098927e-02   -1.144448031539610e-03; +5.326550187183280e-02   +3.532442908835264e-02   +1.799694117411146e-02   +1.142295109123387e-02   +5.141160698599095e-02   -3.310663203176382e-02   -1.853580329538570e-02   +1.612592904614871e-02   +1.413267585735124e-02   -4.449585234120883e-02   +1.235183909681083e-01   +4.449832655498715e-02; +2.168664795140503e-02   +2.868334720208107e-02   -1.486448298957905e-03   +1.874806553137732e-02   +3.032091141794456e-02   -1.832664034393957e-03   +8.652730667572081e-02   -4.507914382464836e-03   -6.855555806681607e-04   +1.615461019719969e-02   -1.066576976258529e-02   +2.422173425473824e-02];
L2E_Input1_iAMPA_netcon = [+2.345649551069262e-02   +3.104779361822557e-02   +1.626885762582515e-02   -7.448843810073221e-03   +1.953725007960610e-02   +2.779679600259431e-03   +3.989358263619527e-02   +8.420585515850047e-02];
L2I_Input2_iAMPA_netcon = [+6.534660171571068e-02   +3.394485591521673e-02   +4.261305364138666e-02   +2.930797812843824e-02   +6.402635547122700e-03   -3.185598638687776e-02   +9.681084106989134e-02   +1.631079412086474e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
