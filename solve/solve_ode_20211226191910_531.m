function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.162562144982414e-02   +4.510730767706349e-02   -2.873023653234204e-01   +2.399495322550629e-01   +1.761981316222596e-02   -2.232725557270271e-01   -1.199351064996310e-01   -2.534402060881599e-01   -4.189608513526738e-02   -1.715466285216747e-01   +2.765344405009998e-01   -1.181869532467934e-01   -2.922131174491771e-01   -1.324439835358613e-01   -1.352395949774766e-01   +2.020421342136264e-02; +7.313331521533534e-02   -3.379200392856996e-01   +2.279381457503141e-02   +3.671215060667375e-01   -7.611652172466371e-02   -6.306215763305929e-03   -2.372256375937048e-01   +9.730027469603336e-02   -2.930752802428380e-01   +1.844874591818879e-01   +2.132296830800705e-03   +2.772505183453829e-01   -7.789529595005992e-02   +5.564154907317792e-02   -5.853399510136681e-02   -2.687793355275110e-01; -3.405426960505935e-01   -1.748990809218813e-01   -2.119347824421886e-01   -1.976075785557909e-01   +6.322663853169277e-02   +7.937100362107025e-02   +1.163352545466035e-01   -2.431709444141210e-01   -9.424231693286733e-02   +5.326248128739915e-02   -1.363570899965280e-01   -1.007732660795623e-01   +1.526819867063508e-01   +8.237486887415525e-02   +1.811840498401490e-01   -2.036514334117538e-01; -3.546714914042129e-01   -2.409698912394455e-01   -3.306664760936900e-01   +2.326441114387783e-02   +2.277971839532608e-01   +1.296051850841587e-01   +1.048264967958689e-01   -1.427513370814021e-01   -9.936026355803724e-03   +2.148001585899694e-01   +1.277950420768252e-01   -3.031408816300636e-01   +1.172989008702746e-01   -2.764982489722739e-01   +1.981419491443287e-01   +4.207573063672387e-02; -3.925484371490339e-01   -1.033083907281981e-01   -7.684549406931268e-02   +1.893324583823905e-01   -1.783134996056445e-01   +1.740063101066532e-01   -2.809330847204756e-01   +6.947604650061488e-02   -3.953941513692666e-01   -1.908234033967342e-01   -1.096058804939509e-01   -3.981512223196557e-02   -1.291018016914551e-01   +2.414170198947504e-02   +1.870864606143095e-01   +3.205563970262648e-01; -3.316285109386036e-02   -1.674669081724078e-01   +6.695543660017539e-02   +1.834274612319826e-01   -1.940102047494494e-01   +1.281699825179031e-01   +1.118954317623017e-01   -9.777448524509252e-02   +2.247213845453389e-01   -1.420227137473458e-01   -2.196709132171909e-01   +2.153553498465720e-01   -1.757449711196839e-02   +1.134649999742368e-02   +3.163984420826534e-01   +4.302412341025911e-01; +6.169231337010810e-02   -5.191185608529286e-02   -7.268725738332145e-02   +3.405175565970234e-01   -3.579136587775626e-01   -2.769426168864371e-01   +6.915702869419701e-02   -2.746385184192770e-01   +9.887336724845448e-02   -8.953743355303535e-02   +9.730840927719320e-02   +3.952849123922275e-03   -8.723134005332192e-02   -1.282545423640878e-01   +2.974592375117138e-01   +6.193824030697206e-02; -2.678989583031752e-01   +1.115950494634403e-01   +1.540417957422662e-01   -2.555538738401353e-01   -5.858835177946095e-03   -3.296577793661558e-01   -7.807852594255324e-02   -3.806023760496992e-01   +8.129318717123468e-03   +1.040891431152203e-01   -7.871313278695155e-02   -4.422704148835946e-02   -1.053544138813950e-01   -5.348931634566886e-02   -7.128991570321391e-02   +2.578225652042199e-01; -2.210439167072891e-01   +2.657519701440857e-01   +1.243512208980925e-01   -2.485290153893194e-01   -2.385361244593291e-01   -1.993369112544816e-01   -1.090716250048487e-01   +1.425239654845917e-01   -2.324861177733613e-01   -2.702450471102252e-02   -1.035446842162999e-01   +1.691727583804066e-01   +2.355530030580354e-01   +1.961588621708861e-01   -1.587047934473168e-01   +1.463704707253376e-01; -9.396037541953181e-02   +2.134280092130836e-01   +1.448553875604078e-02   -1.631592361251323e-01   +4.263362961152654e-02   -1.403558974181924e-01   -1.804401866831685e-01   -2.529028445961051e-01   -3.527592844990685e-02   -1.396256488213310e-01   -1.345175833783759e-01   +1.344229945529962e-03   -3.808609892215295e-01   -1.486764704445819e-01   -2.761416588044293e-01   -5.060147421202934e-02; -8.959135009525121e-02   +9.566477663808388e-02   -3.577514235948165e-01   -2.185907820193010e-01   +3.785133072198801e-02   -7.973213496148343e-02   +2.689339393236193e-01   -5.074504097358731e-02   -1.250467688493805e-01   +3.192066654278569e-03   -2.796840506739438e-01   +9.208698737167836e-02   +3.100814140465308e-01   -1.796161133680510e-01   +7.299288684335696e-02   +1.521346249108204e-01; +2.767014804654904e-01   +2.524377459473177e-02   +3.283647588714425e-01   -4.209433184250294e-01   +1.786405384364790e-01   +3.046730045592320e-01   +5.323625544691192e-02   +1.384284853948665e-01   +1.877936383119475e-01   +2.669796387437445e-01   +2.325273902052276e-01   -4.506046991738596e-01   -1.298970367829405e-01   +2.997696756947266e-01   -2.778316976793860e-01   -1.405944137742047e-01; +2.380182523016336e-01   -2.079726542860552e-01   +3.232732507869664e-02   +1.373950795629047e-01   -1.685237527874330e-01   +1.457488261818843e-01   -3.489803597549833e-02   -1.328726551681743e-01   -1.856942635479681e-02   -4.421311124876368e-01   +1.862162819330624e-01   -2.269133746351156e-02   +7.487576791757475e-03   +1.347776557737646e-01   -2.860431798393045e-01   +2.303673705823087e-01; +5.073343868316284e-02   +7.018654428432006e-02   -8.951767094988575e-02   +2.764929851288322e-01   -3.991120730772846e-02   +1.247539136998524e-01   +1.396823440742598e-01   -1.399785514791792e-01   -5.381734690987475e-02   -4.480767275132815e-02   -4.575113984247954e-01   -1.463674562864554e-01   -4.221393676195700e-03   -8.749842969905716e-02   -1.221268522346166e-01   -2.143755588665978e-01; +1.423126688148922e-01   -2.366207371183090e-02   -3.409501173528232e-02   +5.976943812614598e-02   +1.537080822860943e-01   +9.192942732574677e-03   -1.936667181308502e-01   +1.344352226377979e-01   -1.956033344433541e-01   -3.309606030093873e-01   -2.323608689496502e-01   +3.145801742416017e-01   +1.966913598866644e-01   -1.747084865314429e-01   +3.350639080058831e-02   -3.625613022739059e-01; +1.735250283670127e-02   +2.247315222012707e-02   -1.707593355227652e-01   +4.412679758537150e-02   +1.219559799617486e-01   +1.559704196444544e-01   -6.245904671506881e-02   +4.553673108752689e-02   -1.178675534199144e-01   -2.410929898915043e-01   +6.540863152634371e-02   +3.564195031263245e-01   -2.921878407992275e-02   +5.752039471133093e-02   +1.876802938055428e-01   +1.113296672443877e-01];
L1E_L1I_iGABA_netcon = [+1.158573804205181e-01   +8.181333281955350e-02   -1.233024392960949e-01   +8.742675422449964e-02   +1.863043929517436e-02   +2.367045876465770e-01   +4.694379794811841e-02   +1.417935288202518e-01   -1.130493461048327e-01   -1.864012501258493e-01   -9.280599860845071e-02   +5.434068806046197e-02   +8.124023382747268e-02   -1.628619304997275e-02   +7.977714391517288e-02   -5.234202495199262e-02; +3.634893678408588e-02   +9.810159246335395e-02   +3.704041763337523e-02   -2.488701287140081e-01   -1.830683949379731e-01   -1.685546562017565e-02   -7.494732272894335e-02   +2.398168810841247e-02   +6.673027280569878e-02   -1.596508201813619e-01   -3.931238358360725e-02   -1.215149344943093e-01   -1.988225682806324e-02   -7.278927603826446e-02   -2.038187055408092e-01   -3.472312261702526e-01; -1.211478459391554e-02   +2.204724824794545e-01   +7.385559984146296e-02   +1.888895601223658e-01   +3.753870461094960e-01   -6.397531188434183e-02   -9.133218726709522e-02   -2.779909529178600e-01   -3.130863393201504e-01   -2.610615525269546e-01   -2.678554184321584e-01   +3.250860627211358e-02   -2.997134896516849e-02   -2.012757653338511e-01   -1.675157027432828e-01   +4.739306182652543e-02; +2.231778015456122e-01   -2.819131436302390e-01   -1.233382985498330e-01   +2.691010430923822e-02   +2.383162791056914e-01   +2.063829058009661e-01   -1.154753404449266e-01   +1.643165647513596e-01   -8.882407075610360e-03   +3.038833150208973e-01   -1.114106930203493e-01   -2.847674686892392e-01   -4.050799210460945e-02   +5.774203312475662e-04   +3.960519931177534e-01   -2.981765616346288e-02; +7.849922685752626e-02   +7.889428062931429e-02   -1.621065048284050e-01   +1.309148149176421e-01   +6.277805760336215e-02   -6.468684286062931e-02   -3.435597082387086e-02   -1.744474370800999e-01   +3.374701808145367e-02   +4.720257274828832e-03   -1.765543017650639e-01   -2.010329511099826e-01   +2.803329242997804e-02   -1.257193100854653e-02   +1.516595066989805e-01   -2.436936068679117e-01; +3.333112066516268e-01   -1.036797336641362e-01   +3.549515103034828e-01   +7.032544716709482e-02   -2.390545006174319e-01   -1.552871676817978e-01   +1.475429222180244e-01   -1.193768138882791e-01   -1.323733038507713e-01   +1.938283257784330e-01   -2.566834242857783e-01   +8.391922070678652e-02   +8.325313320380251e-02   +2.710659045853138e-01   -7.419505538835003e-02   +4.834066215070199e-02; +1.195721632096124e-01   -2.150913898759865e-01   +1.193288261644622e-01   -2.880567406341203e-01   +3.160274369658772e-02   +2.157409720462405e-02   -7.783400340888777e-02   +3.462250731367600e-01   -5.382407095965640e-02   -3.364177376306958e-02   -1.106688658400554e-01   +2.022789986533345e-01   +2.012852438505008e-01   -8.424155149693531e-03   -1.023386756115395e-01   -6.603276651742299e-02; +1.766229524974355e-01   -4.200534392872260e-01   +8.328286368681505e-02   +3.075377342218747e-01   -1.975885009225510e-01   +2.903146925802388e-01   -5.497200143630282e-03   -5.325675453432087e-02   +2.616013651042108e-01   +2.731297171932129e-01   +1.630023398724819e-01   +2.296541660123749e-01   -3.116422677548659e-01   +1.636340106806257e-01   +9.623420979073495e-02   +2.042086980764756e-01; -4.626431981708445e-02   +3.595599460169592e-01   -3.308155126905966e-02   +2.406846821374847e-01   -2.240459732200743e-01   +1.084880019703553e-01   +1.271553803127915e-01   +1.298153081615428e-01   -2.198390693435678e-03   +2.313197517123377e-01   -3.564237124187634e-01   -6.139408077500255e-02   +4.448784510594402e-02   +7.047537967719728e-02   +9.296796525955538e-02   +4.828812132449898e-01; -5.121660728855795e-03   +8.346639696031888e-04   -2.688030754680914e-01   -3.169410433599127e-01   +1.466703960999010e-01   +2.795486374411164e-01   -8.835245752672896e-02   +1.233230867454327e-01   -2.048441127694484e-01   -2.079208029385349e-01   -3.451422438426643e-01   +1.221567671288909e-01   -5.098117541812189e-02   +1.765182623242301e-01   +1.698878945983610e-02   +4.693505384717639e-01; +2.936975221742495e-01   +2.649320942515997e-01   -7.909480631051151e-02   +7.943006193288898e-02   +2.089487210511669e-01   -2.577878269109427e-01   -2.031067613978202e-01   -2.447527277803917e-03   +5.795837196396805e-02   -8.871602780448967e-02   -3.653724915457186e-02   +2.475084134749661e-01   -3.052282882804562e-01   -6.382097616521065e-02   +7.919269130010383e-02   -2.612687435407454e-01; -1.671376369741119e-01   -3.568773085776809e-02   +1.090473933263924e-01   +3.158966635627114e-02   -1.411168586332638e-01   -5.768290160792067e-02   +1.710685586328166e-01   +6.780796560940933e-02   +8.691371104598938e-02   +1.759646057458216e-01   +1.308434758262919e-01   -9.918022507038267e-02   +8.108696316722300e-02   +2.210317178213498e-01   +2.912073522330189e-01   -4.050385214623065e-02; -1.067719289126383e-01   +4.181434601456072e-02   +2.815862998929863e-01   +1.165793739893018e-01   -1.307532558323203e-01   -2.652647313546251e-01   +7.223943920731875e-02   +4.058381950014915e-01   -1.488753267723212e-01   -5.734985880549970e-02   +1.063906119439999e-01   +3.169520323448766e-01   +1.444436907553519e-01   +2.418811210915391e-02   +1.009762505483803e-01   -9.229315613519529e-03; +1.741455064087791e-01   +1.520443224449474e-02   -2.068369976247702e-01   +1.048593044899124e-01   -1.518173842717825e-01   +1.594038832185837e-01   -2.832716703230231e-01   +2.337436107487926e-01   -8.241149323065647e-02   +1.305408283347209e-01   +2.368231715380616e-01   +1.818981301325695e-01   -2.012295717438264e-02   +3.612646340129601e-01   +1.419039174059185e-01   +9.440933825949431e-02; -3.000234713039803e-02   +4.866616345237604e-01   -4.137905781152726e-02   -1.826772369907287e-01   -9.131589747612445e-02   +1.432236119569230e-01   -1.723398218588505e-01   -1.570626622174983e-01   +2.176726891179460e-01   -7.290691913543201e-03   +1.184082074169326e-01   -2.351862942399474e-01   +2.738005051080949e-01   -1.450646695073450e-01   +7.352415036719795e-02   +4.442436938504464e-01; +2.043454063610913e-01   +1.097282436458826e-01   +1.024254871278872e-01   -1.129712887673283e-01   +3.013123880145364e-02   +1.842327252813370e-01   +2.980546929933336e-01   -1.802877160919686e-02   -6.789078140138217e-02   -1.333286007162067e-01   -1.144647264605831e-01   -1.642343678270513e-01   -7.125833388709761e-02   -3.257891962709072e-01   -7.007064679597336e-02   +1.385905449879639e-01];
L2I_L1I_iGABA_netcon = [-1.188823305375922e-01   +1.630951586786024e-01   +3.106606717441433e-02   +1.730219979867753e-01   -1.049113231360409e-01   +2.161484759874191e-02   -6.037810680364945e-02   -2.191392523257417e-01; -1.775723566709324e-01   +2.256585657503578e-01   +7.790925882089141e-02   +9.622192393557556e-02   -4.635852085748046e-02   -4.457950254702317e-02   -9.748420966465277e-02   -2.999565179404418e-02; +6.527272004846981e-03   +3.366928418370693e-01   -1.112805810320131e-01   +1.501375852793529e-03   +1.131164103216726e-01   +2.285257890326894e-01   +5.946399094786452e-02   -2.210958796615187e-01; -2.524119621209879e-01   -2.196943392438514e-01   +2.464777757590405e-01   -1.593978629532459e-01   +2.588139871621507e-01   -1.589250774306296e-01   +1.762462860682477e-01   -1.001133491265713e-01; -1.097769370627671e-01   +2.723827177015313e-02   -1.559816112228163e-01   +3.494719027103761e-01   +3.872578108321724e-02   +1.065742765342125e-01   +1.649531306169740e-01   +3.278062454762087e-01; -6.898162158991727e-02   +1.667334986515911e-02   -1.554775128124130e-01   -1.017774651823092e-01   +4.902833189563997e-02   -6.741210989662814e-02   -2.751671261513763e-01   -2.518201901276930e-01; +4.160645273553533e-02   -1.105306383153078e-01   +2.555566468643473e-03   +1.435296578750297e-02   +2.204307883557491e-01   +8.656229387718800e-02   -3.455347853911285e-02   -9.678459677527451e-02; +2.030276920813510e-01   -9.183078810338555e-02   -7.350454227623372e-02   +1.143606887222806e-01   +1.424046404828669e-03   +3.582521131261938e-01   +2.071725352314414e-01   +1.946753317174075e-01; -1.717857907098839e-01   +2.216480220811416e-01   +2.234999179367348e-01   -8.900702267929352e-02   +4.348319042679287e-01   +4.681904933715926e-02   -1.201260204477431e-01   -1.381901915957421e-01; +5.388954140783118e-02   +3.319298114320178e-01   -2.626971007005758e-01   -3.580286616730070e-02   +1.082968883453731e-01   +1.144241647407095e-01   -4.592097912348240e-01   -1.071340371962885e-01; -8.310707415413363e-02   -4.688894750292020e-01   +2.539922228846239e-01   +2.699466410241533e-02   +5.352310836679880e-02   +1.241840923281052e-01   -1.254195527436914e-01   -5.614133010795443e-02; -9.974646794059475e-03   +1.356304911492660e-01   +1.107403691019064e-01   +2.143175644595176e-01   +2.216778781358169e-01   +1.539679691429893e-02   +3.541225561742907e-02   +2.758552705704187e-01; -1.930795554437597e-01   +2.441842953662307e-01   +5.012378426522093e-02   +2.259232498857205e-01   -1.491718667186178e-01   -2.310801159540743e-01   -8.307736345824115e-03   -5.385738974317283e-02; -1.010586286917235e-01   +1.913568214630008e-01   -1.648395355559769e-01   -1.046373070444416e-01   +1.617687906192654e-01   +8.946145370513453e-02   +9.570605405789745e-03   +2.618320729197211e-02; -2.249584362125044e-01   -3.922519425772472e-01   -3.559154630133178e-01   +6.910436578741469e-02   -9.970462504275203e-02   +1.518317137723649e-01   +1.000142182301397e-01   +1.659973497314813e-01; -3.863795725721836e-02   +3.201649277632862e-01   +1.069775455711320e-01   +8.492336046625236e-02   +9.929334973960471e-02   +9.517356140036087e-02   +2.459372774464574e-02   +6.136518005257326e-02];
L1I_L2I_iGABA_netcon = [-5.584838197918787e-02   -2.496526125128759e-01   +2.524212383264717e-01   -3.694601908713463e-01   +3.508545304146860e-02   +2.714892087897433e-01   -3.912438427475972e-01   +1.446783534539426e-01   +2.661521669118649e-04   -3.816436661741671e-01   -6.518779026873589e-02   -2.162139638385523e-01   -2.571121780795059e-01   +2.614739254394813e-01   +1.039936073699518e-01   -1.007390803313361e-01; +3.139987207676999e-01   -1.105549297812830e-01   -6.146481006478020e-02   -3.562648421794644e-01   -2.451297012458291e-01   -9.320845780113672e-02   -2.115216338519540e-01   +3.467524416708786e-01   +7.091666027337767e-03   -1.552885700050102e-02   +1.990185761539884e-01   -4.005928189260631e-01   -9.539632706066650e-02   +2.195937424198307e-01   -2.500377869532074e-01   -1.362476682573255e-01; -2.454707335696608e-02   -2.115391711932488e-01   +6.057590028909018e-02   +3.069499313419924e-02   +1.007575974723601e-01   -1.968213901054219e-01   -3.020099739585790e-01   +2.612118726603846e-01   -2.673561930097282e-01   +1.823609944857417e-01   -2.411634980118256e-02   -3.548940346143006e-02   -3.877394943408621e-03   +2.857667183794467e-01   -1.095258611371098e-01   -2.686945131540497e-01; -1.059697104823343e-01   -2.192518180206601e-01   -1.060487252303336e-02   +6.913571268778756e-03   -3.432647666824658e-02   +1.982831013050575e-02   +2.121781909162140e-01   +2.451154019446029e-02   +1.343712022868171e-01   -2.462419729208745e-02   -2.484707494606385e-02   -2.659412125988789e-01   -3.022000847564594e-02   -6.152043412991982e-03   +1.623719314367641e-02   +2.657735183459922e-03; +3.024782379193480e-01   -3.447641859920487e-01   +9.379241663889186e-02   -1.867935320866008e-01   -4.263534718663382e-02   -2.163885469012817e-01   +8.987815970545016e-02   -8.102019413503407e-02   -4.551654993903973e-01   -3.720874986256275e-02   -7.653991457496437e-02   -3.398553265501761e-02   +1.979650018129023e-01   -2.781618321069936e-01   +1.466412137908859e-01   +8.516558005472320e-02; +5.267235635348390e-02   +2.908243296309169e-01   -2.342808984664902e-01   -2.018494565739950e-01   +2.455418562226399e-01   +1.925180643235419e-01   +1.347748262438365e-01   -2.443381319440526e-01   -1.079099862384237e-01   -3.847976295528518e-02   -1.904715734129813e-01   -1.926027203169955e-01   +1.753151759527227e-01   -1.023655976342528e-01   -1.373909549525901e-01   -7.436132447186333e-02; -1.516960087073160e-02   -2.405289516997021e-01   -1.721554035537236e-01   +3.012848883767440e-01   -2.304612280953346e-01   -1.537533179867478e-01   -2.507643983283108e-01   +2.101823120845311e-02   -1.443146279538358e-01   +1.479876302249098e-01   -1.648338981769589e-01   +1.983794281418372e-01   +1.130812080069568e-01   +4.058054267019993e-01   +2.631375437131395e-02   -1.489384462843112e-01; -1.845560379581026e-01   -4.122653431256105e-01   +2.015114966192311e-01   -9.022764675299724e-02   -2.085677124275306e-01   -3.207888120889617e-02   -1.447290427952319e-02   -2.436350240358961e-01   +2.592664869171275e-03   +7.813152267713824e-02   -1.390324944223251e-01   -1.500504588511456e-01   +8.183496566215533e-02   -3.289599350091117e-01   -4.852454046937642e-02   +2.039947562741012e-02];
L2E_L1E_iAMPA_netcon = [-1.487760185522403e-01   +3.131511160937577e-01   +6.633369806468937e-03   -1.737917876033721e-01   +1.169137717952193e-01   -1.228951826205388e-01   +2.221369748106473e-02   -3.190093800232272e-01; -1.949628233911255e-02   +2.783844596244978e-02   -3.203804964819956e-02   +2.414750779755367e-01   -1.012073410135826e-02   -1.969918743784065e-01   +1.122367474344050e-01   -4.028992670060331e-01; +2.860487203295901e-01   +1.177900906507134e-01   -2.855294614505542e-01   +1.216488164874602e-03   +1.713392383161326e-01   -1.263096265597211e-01   +3.743157863896004e-02   +2.160223628880710e-01; -6.014105590528610e-02   +1.567736948214608e-01   +3.529493226098797e-01   +6.537075551779239e-02   -1.083755243059086e-01   -4.307634654059855e-01   +2.885938305047568e-01   -2.855061048469077e-02; +1.046665399925413e-01   +2.609852780867604e-01   +1.783994139333256e-02   +1.019138360897204e-01   -1.847319020861657e-01   -2.195705934497935e-01   -2.510968246611818e-01   +2.571075124440581e-01; +1.000704059762536e-01   +2.945510916994842e-01   +3.154173303051998e-01   +5.709344151851023e-02   -1.793024302138868e-01   +1.955800220508683e-01   +9.327177274212438e-02   +1.693350492745238e-01; -1.615637937053041e-01   +3.087093652162809e-03   +9.239887759506776e-02   +2.423477282840318e-01   +2.031775423929613e-01   -4.328165442258153e-02   -7.496280646141336e-02   -4.082991866927699e-01; +1.329022580078411e-01   +7.908835294409608e-02   -2.092065052636923e-01   -1.840975041019156e-01   +3.770604044881665e-03   +1.068600852575891e-01   -1.115003023594594e-01   +2.683657109376278e-03; -8.972000394039721e-02   -7.698295108343670e-02   +2.568571097556263e-01   -2.497846045040525e-01   +2.745753070668616e-01   +7.569329728516042e-02   +2.623504209480096e-01   -2.477542078805355e-01; -4.495697487037863e-02   -1.035400235581603e-02   +3.117145124210088e-01   +1.731865749339168e-02   +1.118291872919705e-01   +7.066461623169611e-02   -3.163457644721546e-01   +1.127906721462723e-01; +1.698514234823215e-03   +1.684096094389046e-01   +9.414252405273904e-02   +4.308677424176253e-03   +1.045269367917524e-01   +5.488503901194798e-02   +6.741708362873911e-03   +3.705978962382922e-02; +8.490882553366474e-02   -1.241463193245199e-01   -1.800836744073243e-01   -2.271620897316987e-01   -7.481347904697369e-02   +8.967076714351541e-03   -4.626381113928560e-01   +4.139934460316548e-01; -1.042572382213618e-01   +1.529549436648621e-01   -3.342156441364212e-01   +7.804930843988130e-02   +1.745490673401084e-01   -9.230024587791305e-02   +1.265577575169380e-01   -3.917294063110707e-02; +1.774758976800634e-01   -1.535535210783215e-01   +2.315938710002004e-02   +2.675035015285822e-01   -5.473830158071440e-02   +4.235172605056754e-02   -1.368831567924968e-01   -1.589668791657252e-01; +5.388888251050905e-02   +1.855904271552501e-02   +2.116122621917841e-01   +1.728281468222348e-01   +2.798415998326264e-02   +1.767114880615958e-01   +9.698463792943422e-02   -1.484814023475263e-01; -1.394077892380365e-01   -2.678617078077391e-01   -9.558873431122161e-02   -2.406012337088848e-01   -1.633490603638364e-01   -5.764924912956193e-02   +5.872685751448437e-02   -2.299424985067283e-02];
L1E_L2E_iAMPA_netcon = [-2.288539848242043e-01   -1.501209640911127e-01   -7.542289771863471e-02   +1.702047213472492e-01   -1.780585892946589e-01   +1.379824876258957e-01   -2.505563081910508e-03   +1.248035804356241e-01   -9.291063926515175e-02   +1.446205205826006e-01   -8.192663225949620e-02   -1.601858876581554e-01   +4.217696455184125e-02   +2.666015472922725e-01   +1.897032639799608e-01   -2.600813434868445e-01; -1.274069864277942e-02   -2.620314787585746e-01   +5.310178976151464e-02   +2.817030442400816e-01   +9.831580838671397e-02   +1.340972446308486e-01   -1.933638780574656e-01   +5.493315230788420e-02   -2.377421677354713e-02   +1.380107218689393e-01   +7.773739082092923e-02   +1.625015389046117e-02   -1.973295811889874e-01   +2.343078334524240e-01   +1.859929012342530e-02   -3.276127995802546e-01; -2.006892431961977e-01   +1.295521551151746e-01   +4.531884918077100e-01   -3.522746528798375e-01   -1.320749221255244e-01   -9.562313898610383e-02   +1.008576059845677e-02   +2.157400689655074e-01   -1.875375301616853e-02   -1.658607885610318e-01   -6.348429462769077e-02   -8.588118408767759e-02   +2.985167329682722e-03   -8.658369712534407e-02   +1.813148014131519e-01   +8.280962980524900e-02; -3.204553653868417e-02   -1.060946981948281e-01   +1.692647775049421e-01   -1.253299064576762e-01   +3.375063056682467e-01   +1.081641219170358e-01   -1.454992602237263e-01   +1.435892084761227e-01   +1.161401539641240e-01   -2.175742758257347e-01   -4.195788255554355e-01   +1.639712802890042e-01   +2.369713264400093e-02   +3.709769873058395e-01   +6.323262782805573e-02   -6.810034834343696e-02; -8.374660462148385e-02   -2.991401620779016e-01   +2.255578718951711e-01   -2.001299264920088e-01   +1.241940309792136e-01   +2.230753976595991e-01   -1.212774685814470e-01   +2.203313704925992e-01   +4.634836734130797e-01   -2.032250754947066e-01   +1.077476599761984e-01   +4.076777397671005e-02   +2.309807167428058e-01   +9.567944670231168e-02   +5.393211603627309e-02   +2.442183764992762e-01; +1.552112557171899e-01   -1.051971527949700e-01   +3.130249820081019e-01   +1.088165663528149e-01   +1.745397480728283e-02   +5.070304305237309e-03   -2.263759419451195e-01   +3.091588314269867e-01   +1.663198816446493e-02   -1.185785007837826e-01   -5.844617501618053e-03   +1.256478811344971e-01   +3.121822470935023e-01   +1.603033179512685e-01   +2.629395774928965e-01   -2.803692016447635e-01; -7.301764752665299e-02   -6.763408743540048e-02   -8.259897507297842e-02   -4.786623941183264e-02   +1.668157047197828e-01   +1.618496082190987e-02   -1.173712028211493e-01   -9.174605538121695e-02   +2.219630259291902e-01   -1.700620633700961e-01   +4.245190977134306e-03   +2.741843885015983e-01   -2.650646891422955e-01   -4.210224288277506e-01   +3.116584267299397e-01   +3.076192433621923e-01; -8.093048706025491e-02   -2.250808719082429e-01   -2.191561847255271e-01   +3.264013291825706e-01   -9.761085491762130e-02   +1.384160885204755e-01   -2.372104273512170e-01   +5.521112501983432e-01   +7.710533849244722e-03   -3.032818425007496e-01   +9.941295902888990e-02   +1.448417842235710e-01   -2.014166936442539e-01   -1.402306710032680e-01   -1.918873904354598e-01   -2.665895814136262e-01];
L2I_L2E_iAMPA_netcon = [+1.591590388312080e-01   +8.302877426362792e-03   -2.703096956593017e-02   +2.261477396827991e-01   +1.535457509395054e-01   -7.197480749657510e-02   -5.271107410729740e-02   +2.049828730877644e-01; +1.019697828012626e-01   +3.358398244021727e-01   +2.089536506641819e-01   +8.917742290685772e-02   +1.838485589367896e-03   +8.984082914361324e-02   -2.068747311814834e-01   +3.152302433607491e-02; +1.343778917801418e-01   -5.913086016713128e-02   -4.807507244474648e-01   -3.379232368530046e-01   -1.954175333907113e-02   -1.414623831611518e-01   +3.634918019425658e-02   +1.667151113093816e-01; -1.302882903352156e-01   +1.715419249957386e-02   -1.433473561190432e-01   -1.258188244650626e-01   +4.429939237006333e-02   +3.506738870060335e-01   +1.089851503688130e-02   -5.731615123694228e-02; -3.940262948998015e-01   +3.978411108957261e-04   -1.906663906613573e-01   -2.382649326632551e-01   -1.545122490458815e-01   +8.650792858810401e-02   -1.673902518469790e-01   -1.888113817357525e-01; +1.940229425475122e-01   +8.402655440322261e-02   -1.565789619305124e-01   -2.967541317092592e-03   +1.643629525701079e-01   +1.505794425255943e-01   +2.058361593664552e-02   -6.725148190168782e-02; -1.946204261102540e-01   -4.408235680830359e-02   +1.288001790589942e-01   -1.198016971436702e-02   +1.425933183354619e-02   -2.347860114629177e-02   -2.221196976251049e-01   +1.372609694988503e-01; -3.686884187334042e-01   -3.780640141610571e-02   -2.645379779421149e-01   +3.911282725744210e-01   -8.992670699760696e-02   -1.312334803437077e-01   +2.879781210596102e-02   +1.979556771443595e-01];
L2E_L2I_iGABA_netcon = [-3.793376561384125e-01   +1.447615699241951e-01   -1.696735940671367e-01   +1.523623967890438e-02   +4.345577095593841e-01   -9.556128363883434e-02   -2.375738841089238e-01   +1.502633160004136e-01; +1.372518385367048e-01   +2.302358922620422e-01   +2.955547610228669e-02   -9.609113510518821e-02   +6.981010030345032e-02   +2.462420216692998e-01   +1.386068191601280e-01   -2.222000109502009e-01; +4.832809164385425e-02   +1.428757307168452e-01   +2.989423403845251e-02   +1.727850720178755e-01   +8.681571413159353e-02   -2.717946831775320e-01   -2.279612529894698e-03   +2.077627385499219e-01; +3.723429932639260e-01   +9.781019897419127e-03   -7.884015779726561e-02   -4.459076504027409e-02   +8.886933262410107e-03   -2.362203800056641e-01   +8.766055485255148e-02   +7.309549983248029e-02; +1.066039758779838e-01   +2.067883338174245e-01   -7.651617515158207e-02   +2.591668168788822e-01   -1.678552436158284e-01   +2.370888676071466e-01   +2.109189638205855e-01   +9.415390173132712e-02; -2.235013977554650e-01   +3.702210638082711e-01   -1.121464489502166e-01   +3.231522555261900e-02   -2.067637382620513e-01   +2.440133662007167e-01   +2.540276788070461e-01   +1.120495534630274e-01; -4.076754152546588e-02   -3.383144088418761e-01   +2.104736294750494e-01   +2.467662545524160e-01   +3.139622835734389e-01   +7.788216545918719e-02   +1.313963967457282e-01   -1.075809019677331e-01; +1.771723697066974e-01   -1.595650783392934e-01   +1.104918825388073e-01   +2.531488010817509e-01   +3.079851421999913e-01   +2.968271779810587e-01   +2.513712205944904e-02   +1.478360729082069e-01];
L3E_L2E_iAMPA_netcon = [+8.570560391921310e-02   +8.746349452259217e-03   -1.461638354002897e-01   +1.753309114213108e-01   +9.258907788461686e-02   +2.313709183184766e-01   +2.432264476083812e-02   -1.770355613635740e-01   +2.277787292549016e-02   +3.560323317410066e-02   +1.684785205164515e-01   +3.088457458011555e-01; -1.266234170433064e-01   -4.392383923432966e-02   -2.377257646524396e-01   -4.243346000796996e-02   +2.681237073208712e-01   -2.237313998288951e-01   -1.612772135001138e-01   +1.704650862799412e-01   -2.477967412502763e-01   -6.534309535326678e-02   -1.654493540029455e-01   +3.280795647329902e-01; +2.571702081252920e-01   +6.160379100866244e-02   +3.598427858955691e-01   +1.059397141329693e-01   +5.076403582738130e-02   +2.834830611611250e-01   -1.893419307216392e-01   +5.996474100976970e-02   +2.220365630572692e-01   +3.629338027514260e-02   -1.532392384005479e-01   +2.804674725353833e-01; +3.106299912680437e-01   -1.809944924735553e-01   -3.459816052352383e-01   -8.103499536774475e-02   -1.680129623039351e-01   +4.087160603315618e-02   +3.709474071344452e-01   -6.360470346975843e-02   +1.722314628967609e-01   -2.848763157206157e-02   +9.613423090992232e-02   +2.274743192265246e-02; +7.783609217981707e-02   +1.814367679885578e-01   +1.557589453485595e-01   -2.591368933417326e-02   +2.242665075857811e-01   -1.595461119618096e-01   -4.779984626596538e-02   -1.100408556180819e-02   -1.410084603932491e-01   +2.666054520452448e-01   -4.168745289927812e-02   +7.978650760550370e-02; +7.971225361412165e-02   -1.204084852735768e-02   -3.191461677258480e-01   +4.035957050369338e-02   -4.618702649300263e-02   +2.387685912327140e-01   -5.714281359948642e-02   +1.268629128326609e-01   -4.152051363070527e-02   +2.435208318797497e-01   +2.807503266480272e-01   +9.137087740393827e-02; -3.031205400291084e-01   -1.326799528812711e-01   +3.611414357937093e-01   +3.764411061399073e-01   -6.003806392787694e-02   -1.711868359868454e-01   -3.982184033584106e-01   -1.319677304554219e-01   +1.619615095400219e-01   -4.393452709131704e-01   +2.651809407337097e-02   -1.717811420686118e-01; -3.941269208872475e-01   -9.467711786419412e-02   +1.375821403997589e-01   +6.151857715696824e-02   +1.701341460144138e-01   +1.144414356448466e-01   -3.796516818044432e-01   +1.664548601116252e-01   +2.711734642767262e-01   +1.843837889949501e-02   +6.532652365188768e-03   +2.874658369861387e-02];
L3I_L2I_iGABA_netcon = [-1.114483723756640e-01   +6.060589826831060e-02   -1.050295766230756e-01   -2.129493616971450e-01   +2.710390390367356e-02   +3.696152183704093e-01   +1.406091526567879e-01   +4.665765451161269e-02   +1.017123957963716e-01   -2.212154365554931e-01   +1.762608091726178e-01   -1.352354677830999e-01; -1.389482136860261e-01   +5.391932206031869e-02   -1.058299765560695e-01   -2.575509922697858e-01   +2.778311051328594e-02   -1.171308686962414e-01   -1.962253849157627e-01   -2.321678111345873e-01   +1.106838002039253e-01   -5.371200158754195e-02   -2.768942472014945e-01   -1.632999092901728e-01; +7.047853072933030e-02   -1.168415864725741e-01   +1.594762459307082e-01   -1.202701008723339e-01   -8.401200512588332e-02   -2.278291033179507e-01   +1.996641017393901e-01   +1.880061265775855e-01   +1.355518512484255e-01   -1.737462576730606e-01   -2.810756099142050e-01   -1.194363788388188e-01; -1.612430389661240e-01   +1.773493385958703e-01   +5.624253614237355e-02   -1.071355326304926e-01   +2.746789988547845e-01   -1.386953973854684e-01   -3.123171082345352e-02   +1.194418037748557e-01   -1.080481532374798e-01   +1.176143576753240e-01   -1.678145643794965e-01   -1.694983919013363e-03; -1.841967784557223e-01   +2.402708653020726e-01   +3.247839230514533e-02   +3.250226370893683e-01   +2.589873794740921e-01   +2.902755205123015e-02   +6.167527033963649e-02   +3.067415138826472e-01   +3.148244973729916e-01   -1.277235747318083e-01   +7.791042671494267e-02   +1.587314036373245e-01; -1.446691759589314e-01   +2.270547537462941e-01   -2.117029032447175e-01   -9.981855877787849e-02   -6.303809632593153e-02   -8.823167254289495e-02   +9.906890786497977e-02   +3.304831553788612e-01   +1.338094357833984e-01   -2.080515857381417e-01   +1.045065307517384e-01   +1.549535990390053e-01; +4.260634834867509e-02   -1.284365599409188e-01   -1.748175070246206e-02   +1.936062368286956e-02   +3.230960122944111e-02   +2.437350762516873e-01   -1.496497375951176e-01   +2.107826655741395e-01   -1.540764366068351e-01   +2.493997683746171e-01   -2.216777098403141e-01   +1.626368713296980e-01; -3.058390462203974e-01   -3.372865377230234e-01   +6.698798658753669e-02   -1.957456628578153e-01   -2.306339013829206e-04   +3.326153812471509e-02   -3.354358907251035e-01   -2.447004966530017e-01   +2.300959609373606e-01   +4.384577643144488e-02   -1.120363733466208e-01   -1.739330880963889e-01];
L2E_L3E_iAMPA_netcon = [-1.231828209236755e-01   +1.602877063464203e-01   +1.529530187204086e-01   -3.561710457970091e-01   -2.117237295485601e-01   -2.558285104247597e-01   +2.002952860090507e-01   -2.246447200758474e-01; +1.769820702644329e-01   -1.693790928493273e-01   +6.553486037104379e-02   +1.478029149557732e-01   +2.347881726064156e-01   -1.558655873299379e-01   +9.246434414704766e-02   +1.170585657403447e-01; -1.990243913713809e-01   -8.619904386355091e-02   +3.252489992098705e-01   -1.150543300753857e-02   +9.935839955373227e-02   -1.628592658818113e-01   -2.340299177578191e-01   +1.576377652043813e-01; +4.996636758751810e-02   +1.270408293458780e-01   -1.318432551119808e-01   +1.960662880533945e-01   -1.182551463559246e-01   -3.558451032107019e-01   -6.803839410649533e-02   +8.423660675783980e-02; -2.850436933019095e-02   -2.497783361592626e-01   +1.287190226476343e-02   -1.730862707300371e-02   -1.647647285615137e-01   -2.795234048435299e-01   -2.111366743156558e-01   -2.630693440882300e-01; -1.739726535982025e-01   +1.275870772195951e-02   -5.966982220976766e-02   +3.733712963646219e-02   -7.041406636355708e-02   -1.312007691092484e-02   -1.226450217060279e-01   -3.692650418693108e-01; +3.190344283442416e-01   +4.493077075158393e-01   +1.162824491528530e-01   -4.546248373605356e-02   +6.275726822538580e-02   +1.084598754877346e-01   -2.965423645227254e-01   +2.617619118505610e-01; -8.986599447498431e-02   +9.379757447178272e-02   +1.257258941322831e-01   -4.039023237705818e-01   +1.965682560393917e-01   +8.497642107797115e-02   -2.765390357686331e-02   -2.140382678753167e-02; +3.134201056154471e-01   -2.880522356372573e-01   +2.910336015580105e-02   -7.768158379195693e-02   +3.698125040443069e-02   -8.379363182889923e-02   +2.625369279949663e-02   -1.916558474616817e-01; +5.716193094023398e-02   +6.807224695571408e-02   +9.668294842164350e-02   -1.627885220802180e-02   +1.819417250911645e-01   -1.414661251380647e-01   +4.908537722187131e-02   -8.584782217112460e-02; -4.435505486603224e-02   -2.975904565330130e-01   -3.087352236746244e-01   +2.609434318908581e-01   -3.066829575664257e-01   +3.915711932103682e-01   -1.977040668913694e-01   -1.147189945723427e-01; +1.068298278444842e-02   -5.527014460514251e-02   -2.485575175653660e-01   -9.717469057641670e-02   +1.080051263900594e-05   -3.785796734252755e-01   -2.504640323909936e-01   -1.227044526387922e-01];
L2I_L3I_iGABA_netcon = [-2.467619061897790e-01   -8.847358034525039e-02   +1.774523131212219e-01   -9.938908840175523e-02   +2.372900094806142e-01   -6.563897729747747e-03   -2.359493752709707e-01   -1.543629402276812e-02; -2.858098585963539e-01   -1.395649821472272e-01   -1.851648292534094e-01   -1.431050617340427e-01   -3.757162255391241e-02   +2.972475010181169e-01   -2.978769484794258e-01   -9.910256774944524e-02; +2.608704329794103e-01   +1.317301034607798e-01   -1.440881799751653e-01   +1.569488890147666e-01   +2.842381586225547e-01   +1.768278510079987e-01   -1.218260271296009e-01   +5.565574482426858e-02; -3.026965175064168e-01   +7.854877765868223e-02   +1.133786113683688e-01   +1.708621875271276e-01   -1.370393441783885e-01   -3.681069639320335e-01   +7.861493816447818e-02   +1.415721693909846e-01; +1.307045628008675e-01   +1.634700424777719e-02   +1.670620930813188e-01   +4.319949641253928e-03   -7.880266845865996e-02   -7.383442349912065e-03   +1.193059472491576e-01   -2.016192076150805e-01; +9.877701176837247e-02   -4.096334854704335e-01   +2.125724048645169e-02   +2.392236914843142e-01   -3.394562911349291e-01   +1.498673075577611e-01   -7.163495647824580e-02   +3.542911694518529e-01; +1.724765904524765e-01   +1.782523528056673e-01   +7.590111178471150e-02   -2.007710522105851e-01   +2.367759112595927e-01   -1.830671146663397e-01   +3.738030488006626e-01   -8.369287812465452e-02; +4.848459888259732e-02   -1.018124600229580e-01   -1.830213272361353e-01   -7.060032256744252e-02   -2.537844793844077e-01   -4.481167418436519e-02   +4.025279625140200e-01   -2.875183432619761e-01; +7.392790701952179e-02   -4.058162886606151e-01   -1.521692982623986e-01   +7.906534653759864e-02   -1.991075208504625e-01   +5.331857650406788e-02   +7.224975456499505e-02   -3.381401457288593e-01; +2.282212758729365e-01   -6.597915620066297e-02   -1.125244674118891e-01   +4.615765059018602e-02   -1.576205879556839e-01   +6.738045920736530e-02   +2.165667592415227e-01   +8.641329124917134e-02; -4.431692268502294e-01   -3.290845224064411e-01   -7.772290957924087e-02   -1.185673129779267e-01   -1.090831983139642e-01   -1.230797529728779e-01   -3.062567877138412e-02   +1.510346096314670e-01; +3.774469629843268e-01   +1.212354317976548e-01   +1.804555755965137e-01   +7.679038856968573e-02   +1.074712451519705e-01   +3.627870518257831e-03   +4.235475825775052e-01   -4.782324853865386e-03];
L3I_L3E_iAMPA_netcon = [-2.568027172762986e-01   +6.012244841965371e-02   -9.430746826039721e-02   +2.680073427191515e-02   -1.303606378538410e-01   -7.496245610599173e-02   -3.471365464136919e-01   +1.822337584333031e-01   -2.227286753900339e-01   +9.011665758917889e-02   +2.162769194930190e-02   -1.104961012754023e-01; +2.051692762801691e-02   -1.545631987659305e-01   +4.351666981416077e-02   -2.095908862398192e-02   -1.786306505487731e-01   +2.689815437518953e-01   +1.065491078017110e-01   +1.995807922659796e-01   +1.227259604339440e-01   +4.480890335202928e-01   -4.761876534000950e-02   +4.950092273400919e-02; -1.008779044366671e-03   +1.728406557172649e-01   -1.773076822781544e-01   +1.318003238081800e-01   -2.012288819649302e-01   +6.704542925638322e-02   +8.284665314983816e-02   -6.826168975508645e-02   -9.079425941891694e-02   +9.072254497164486e-02   -2.023760509234937e-01   +9.647459921203611e-03; +6.058311954178728e-02   +2.754339577557544e-01   -3.367748506668640e-01   +3.604149988410707e-02   -1.429513206210548e-01   +9.610758366792954e-02   +4.661605593113208e-02   -2.832658212525143e-01   +1.168302300444570e-01   -4.473634859682958e-01   +6.207670260953200e-02   -2.028875009852924e-01; -1.636068012640497e-01   +5.926061776912220e-02   -1.827459975070455e-01   +3.693917950122029e-01   +1.170054845900529e-01   -1.843343750688744e-01   +3.659321862469196e-01   +1.228464981435244e-01   +6.372982802593824e-02   -2.306604974643082e-01   +3.569809710764748e-01   +2.086636323658184e-01; -9.204805889378648e-02   +1.427411058155675e-01   -2.483694485718654e-01   +1.680443366968859e-01   -7.245454898706523e-02   -1.825400645533631e-02   +1.549392309133341e-01   -2.261318985647514e-01   -5.756688103407635e-02   -3.710477650745430e-01   -1.931583605439108e-01   +7.027197988387887e-02; +3.250773065627786e-01   -2.996969292742646e-02   +1.744433495534183e-01   +1.750302847783446e-01   -5.044032608200200e-02   -2.404642600193765e-01   -3.357562215062380e-01   -1.730048006104332e-01   -1.255744818261030e-01   +3.425087704118315e-02   +3.792758327870666e-02   -4.081942509758559e-01; +9.443997259820083e-02   -6.077749118687445e-02   +1.823422702769065e-01   -1.246091961786703e-01   -2.774581168259930e-01   +1.137853121447197e-01   +2.189672315291554e-01   +1.291438009941667e-01   -2.419133246342157e-01   -1.515228008574679e-01   -3.671033742208601e-01   -6.733244431464963e-02; +3.605299465851567e-02   +7.898343471297124e-02   +1.919814742599108e-01   +8.086366090721052e-02   -1.416219592619556e-01   +2.794941234501718e-01   +1.285078335730285e-01   -4.057823823837009e-02   -3.049303529768765e-01   +1.609500078000109e-01   +2.562397080950828e-02   -1.392707554048443e-01; +2.733638817647274e-01   +2.138030425619100e-01   +6.372432646237175e-02   -8.791481769189902e-02   +8.329447599529893e-02   -2.397990180809381e-01   +1.135620813091679e-01   +8.262489297953035e-02   +7.090582642211157e-04   -3.064608818419923e-02   +9.968773978798562e-02   +6.104164032268744e-02; +6.725445913338297e-02   -1.503208951612255e-01   -3.673861568982094e-01   +1.060401009619446e-01   -1.085143909599730e-01   -8.144038128421142e-02   +8.615687037140263e-02   +1.876065723190411e-01   +2.609472573794762e-01   -3.886641948429783e-01   -1.213724786791976e-01   -1.137808088659409e-01; -1.281235643315325e-01   +2.647542483270694e-01   -2.020135349742347e-01   -1.285078869884403e-02   -6.045153664547154e-02   +9.410812340717924e-03   +3.069218311519517e-01   +1.189824861247824e-01   -2.002323173589415e-01   -2.576098180176072e-01   -1.007397952258086e-01   -2.049771475548667e-01];
L3E_L3I_iGABA_netcon = [-1.000868228365450e-01   -2.039163414587776e-01   +2.536541434483663e-01   +2.251704377660733e-02   -1.813532801705445e-03   -3.138739157912860e-02   -1.676111796958625e-01   -1.456867278322265e-02   -2.568141594947493e-01   -2.230017010943785e-01   +6.924251859742805e-02   +2.916201380030183e-01; +2.721978931742146e-01   -3.520021091231910e-01   +2.571561617729166e-01   -6.966474364794813e-02   -1.765148751842601e-01   +2.053283480486174e-01   +2.626866084921224e-01   +1.837860354924413e-01   -5.391323788312977e-02   -6.130589160053723e-02   +3.516049503055252e-02   +2.309295689563047e-01; -2.039559042528277e-02   +1.835774124478481e-01   +4.966415558386988e-02   -2.209850145530592e-02   +5.851991333356882e-02   -2.246537032546724e-01   +3.820905443427458e-01   +1.419378914101760e-01   -3.210723904424558e-02   -3.167597253862254e-02   -2.780030817413186e-02   -1.277732224316447e-01; -3.049056380233831e-01   -2.534756672647755e-01   -1.481626806744681e-02   +1.639136000373430e-01   -8.170160230723561e-02   +1.886300690617930e-02   -3.460160388540407e-01   +2.555244142249742e-01   +2.226307887560398e-02   +3.468461758885140e-01   +3.512604324333464e-01   -5.149564760411339e-02; +3.012671606744595e-01   +1.952814833804198e-01   +1.026828227463744e-02   -2.205790894112931e-01   +1.816990012960027e-01   -5.673441537038927e-02   +8.722166808040473e-02   +1.316837590697173e-01   +4.979092715472389e-02   -2.349305575318250e-01   -3.852009758618566e-01   -2.775931169572673e-02; -8.384595178420187e-02   +2.979865303977122e-01   -1.488118165019239e-02   -9.676136181908145e-02   +1.426955316763264e-01   +3.648601580477095e-01   -3.455337860514004e-01   -6.933510723536246e-02   +5.805033034127086e-02   +3.652918066350131e-02   +1.939351675654856e-01   -1.478463276564405e-01; -3.216023248191010e-01   +8.300940243173022e-02   +2.666023078475733e-01   -1.050282391198999e-01   -1.552344381801741e-02   -2.801154003978183e-01   -4.068998570816396e-02   +2.968704736512490e-01   +2.731661310902882e-01   +1.991664337008573e-01   +3.910889918864112e-01   +1.011548637587403e-02; -1.973428138029908e-01   -3.486356649820543e-02   +6.530602895016387e-02   -1.106986239900322e-01   -4.972132437858968e-02   -1.452225507473339e-01   +1.075375828806158e-01   -1.325001918401167e-01   -2.915221752008473e-01   -1.013280918737139e-01   +1.562807343909961e-01   +1.436239460319599e-01; -2.588621791324767e-01   -2.864414633522109e-01   +4.593293211350706e-02   -2.478370035492704e-01   +2.423568619449986e-01   -1.703573807690822e-02   +3.832157549335788e-01   +2.743762296636949e-01   +2.385073243520414e-01   +2.806218147597851e-01   +5.819897383249431e-02   +1.136509756700804e-01; -1.520540894764838e-02   -1.057225303562155e-01   +1.504752909641044e-01   -2.190133439898492e-02   -1.951629167797631e-01   -2.598399338488328e-01   +1.494956330333575e-01   +9.687345235364012e-02   +1.159773949596981e-01   +2.537124375079489e-01   -2.896435356713835e-01   +4.090245900286673e-01; -2.626546767945076e-02   +3.568305926454565e-02   -2.266229783859380e-01   +4.040342726326521e-02   -3.540929230369746e-01   -1.364709924443231e-01   +1.511092848497983e-01   +6.771961962488424e-02   -1.152528818130279e-01   -3.582975791395628e-01   -2.998550580188529e-01   +1.762323367143591e-01; +9.713502422946922e-02   +3.184501763783092e-04   -3.124669732956331e-03   -1.263140226491406e-01   -1.966731651874574e-01   +2.247567311275704e-01   -2.310476592149933e-01   -1.485818174012217e-01   +7.316545498640079e-02   +2.001896105211189e-01   -6.363455310782791e-02   +1.460282185585928e-01];
L2E_Input1_iAMPA_netcon = [+2.475615222585687e-01   +2.288463083911457e-01   +1.923924058868820e-01   -2.190488036374992e-01   +1.250398814279139e-01   +1.100299332476329e-01   -2.337526311609190e-01   +1.023173670515112e-01];
L2I_Input2_iAMPA_netcon = [+7.851702583053531e-02   +2.467637385330723e-01   -1.586209501714267e-02   -2.962878052982171e-02   -1.601402590351190e-01   +2.348715199086628e-01   +1.499082407896428e-01   -7.285122206946662e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
