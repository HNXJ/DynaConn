function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.170436361638165e-01   +8.733407617346852e-01   -4.576832933729280e-01   -2.422945151169422e-01   +8.382204414665411e-01   +7.675383827567319e-01   +2.114754897809372e-01   +5.088572769949604e-01   +2.749675847340347e-01   +5.345639244394949e-02   -1.204812959968709e-01   +7.437037694140517e-01   -2.183389399063788e-01   +3.976415385321731e-01   +5.151596745390458e-02   +3.329112945652418e-01; +1.542377077550592e-01   -5.171779552196802e-02   +3.841306729622764e-01   +7.940678848066002e-01   -7.764308298646445e-02   +5.714135079215058e-01   +2.550600936226797e-01   +4.309207839253634e-01   +2.835483876260728e-01   -1.849683252254255e-01   +2.191033999541055e-01   +1.930827081324697e-01   -2.057864202220855e-02   +7.404541924508793e-01   +1.558923931560644e-01   +4.625318670004224e-01; -2.580639582401639e-03   -1.234662530158828e-02   +4.769292736957654e-01   +1.222987325960179e-01   -1.745563926066614e-01   -1.130803088636466e-01   +6.235329982688406e-01   -1.314042694584280e-01   -2.650811175718382e-01   -1.614305724952087e-01   +3.641188975082684e-01   +2.045104226755569e-01   -4.509222697288455e-01   -1.078127427124706e-01   +6.110523713026283e-01   +3.251087358636378e-01; +7.374424831221984e-01   +7.916671970962736e-01   +2.620365171755701e-01   +9.318512120738766e-02   +7.563081415187474e-01   +2.599174359904625e-01   +7.239608419340928e-01   +2.268894446060905e-01   +6.081873196352203e-01   -1.227404389816983e-01   +6.343289257707674e-01   +1.770338204739456e-01   +2.108362147305361e-01   +3.106072235174852e-01   -5.300252503620219e-02   +7.797335882956924e-01; -1.059291036220092e-01   -6.038330252959162e-02   +8.602769783015932e-01   +5.123846552359282e-01   -4.181959686835341e-01   +2.429154893975574e-01   -3.308439988052429e-01   -2.110832136504077e-01   +2.679848099836545e-01   -1.821221225021216e-01   +3.333313388312452e-01   +4.239836922799425e-01   +7.183283590940823e-01   +4.743767792416878e-01   +3.273403266726042e-01   +1.081138897588956e-01; -2.491987539516338e-01   +2.165784054315309e-01   +4.555954609501162e-01   -1.644111875983108e-01   -1.498818738507060e-01   +4.830711336128929e-02   +3.824530902660926e-01   +6.419811006381254e-01   +9.125329461801805e-03   -1.092595437584133e-01   +2.183761915395609e-01   +8.209037117778594e-01   -3.155075253649531e-02   +3.403768555611864e-01   +2.182599652202855e-01   +1.000000000000000e+00; -3.090656599923938e-01   +3.560734731220096e-01   +2.769325881510133e-01   -1.076751781227318e-01   +1.359384660307012e-01   +7.441263784943533e-02   +1.428518035752236e-01   -1.154833039957665e-02   -3.878442031616709e-01   +6.124276608749689e-01   +1.937800691853035e-01   -1.025908830310862e-01   +6.112692567288462e-01   +4.227054308301695e-01   +1.150836172131702e-01   +3.494465496522959e-01; +5.355420825030512e-01   +1.348042344144338e-01   +4.127271799406637e-01   -9.032081402486358e-02   +4.539029776335625e-01   -2.783401872114984e-01   -1.651456039249826e-01   +1.074966630826808e-01   +1.462538648841490e-01   +1.566025205965909e-02   +7.528088138013591e-01   +5.585101596593143e-01   +1.244226894571018e-01   +8.018380921036716e-01   -3.109497564857270e-01   +1.198041906854321e-01; +4.989158376973770e-01   +9.066592361656987e-01   +3.024745633629977e-01   +6.429733810482150e-01   +3.770781611079169e-01   -3.300001186447551e-01   +8.355696074032858e-01   -3.273291433310165e-01   +4.570862497457047e-01   +2.677185544388759e-01   -8.288106571363741e-03   +2.037659440514706e-01   +5.176956330162619e-01   +8.658560927043344e-01   +4.868801874740561e-01   +6.011882175717940e-01; +8.550227926355997e-01   +3.238889632160309e-01   -1.931216119408744e-01   -3.432823994219866e-01   +3.928320868928203e-01   +5.003402796952466e-01   -3.006607120200664e-01   +2.288822356496218e-01   +5.863155216986139e-02   +5.264053789120483e-01   +6.180537104943513e-01   +6.539395157301875e-01   +6.810120917044798e-02   +4.015022973348646e-01   +4.935071281848818e-01   -2.659495878535285e-02; +6.450742022816048e-01   +2.136621676977933e-01   +7.846568871884293e-01   -2.496128041382784e-01   -3.963546517324570e-01   +5.546560631347905e-01   +5.492889018537407e-01   -1.412442489072626e-02   -3.081319674572887e-01   +4.716547034079142e-01   +4.508272785367727e-01   +1.073455413321151e-02   +5.263205705030726e-01   -2.268434009757714e-01   +1.928069951989904e-01   +8.167238701036109e-01; +4.381842861726983e-01   -1.859751074442491e-01   +1.232346293024096e-01   -4.673555696976961e-01   +4.938565836669404e-01   -1.157644204678577e-01   -1.510170180918180e-01   +1.134617498695453e-01   +4.071380648637250e-02   -3.144977990044506e-01   +8.916187816538489e-01   +6.030083409624099e-01   -1.805064709534369e-01   +3.090777742444087e-01   +9.355746959727109e-01   +2.104519841510087e-01; +4.966805059620400e-01   +4.728863420462471e-01   +5.114325932648952e-01   +3.314193347321250e-01   +6.732988898915515e-01   -3.174584317974794e-01   +4.399477003531447e-01   +2.427785159965659e-01   -7.096831444161944e-02   +2.211756384804575e-01   -1.301506225954155e-01   -4.412547438509232e-01   +1.814449241368528e-01   +6.580859716955373e-01   +2.542303223539011e-01   +1.411142781653836e-01; +4.422803350195174e-01   +1.965470130929881e-01   -4.603485790755230e-02   +6.784893122752825e-01   +5.108772627301212e-01   +5.779466925156665e-01   +7.018552628083155e-03   +5.633549962750011e-01   -1.558208975367228e-01   -1.181217580525477e-02   +5.384296256597793e-01   +6.779153747324035e-01   -1.544001973057669e-01   -7.116723217331178e-02   +5.651524856715432e-01   -2.765794184870216e-01; +1.388964103119826e-01   +5.487912539552766e-01   -2.552639361479040e-01   +1.333242264113052e-01   +1.935950052442363e-01   +1.703003580552087e-02   +4.716847061324620e-02   +2.505890425331956e-01   -1.938487965187418e-01   +2.701604470908636e-01   -3.116169377365702e-01   +7.159463539965156e-01   +8.785205006713185e-01   +5.204922127951019e-01   +6.265238392385686e-01   -3.438593737703361e-01; +4.932842533563448e-01   +4.708352241707145e-01   +3.246390142460538e-01   -2.124322421734780e-01   +2.290974883512253e-01   +3.805282611550604e-01   +5.154503643441553e-01   +3.233098183616034e-01   -2.163832529612702e-01   -2.761965735131949e-01   -4.092315674114550e-01   +1.672365410862293e-01   +3.570711887997841e-01   +5.313799095115236e-01   -5.232080587936778e-02   +3.188598097023981e-01];
L1E_L1I_iGABA_netcon = [+7.748314172247033e-01   -1.353755217043174e-01   +5.019262732464254e-01   +6.247391097679125e-01   -7.626743140572703e-02   +3.914476693406638e-01   -3.378385472050413e-01   +3.082629219762532e-01   +5.418205913497599e-02   +5.228492665800782e-02   +2.071715528992063e-01   +4.412930936164693e-01   +1.027566194638973e-02   +7.684480100020007e-01   +1.875101446591536e-01   -5.484625115688946e-02; +7.843557842653972e-01   -2.563622486872059e-01   +4.699273594163876e-01   +2.953638520743239e-01   -6.563682859929751e-03   +4.644703843217455e-01   -2.954881996133569e-01   +6.064168048777248e-01   -4.312260832253049e-01   +3.144087244928983e-01   -1.487728725721427e-01   +3.737783618369752e-01   -9.816779530242171e-02   -7.296238500040887e-02   +3.644841854417624e-01   +3.259584638567702e-01; +4.780901466102325e-01   +6.725432824764961e-01   +2.443208778295959e-01   +5.900978332086256e-01   -4.441689806592819e-01   -5.529680617021996e-01   +5.147610876091899e-01   +8.384192946085177e-01   -2.137576016732745e-01   +8.842303471553317e-01   -9.350704260395717e-02   -2.746457400502095e-01   +4.240841573032860e-01   -8.214286836666092e-02   +2.307167817797271e-01   +5.535447063175111e-01; -2.709211947665435e-01   +8.781185107845598e-01   -3.688367611671816e-01   +4.489173853848252e-01   +3.441543815026797e-01   +5.105688100058515e-01   +3.210307126751998e-01   +3.351678416048017e-01   +1.162115850058010e-01   -7.934668225358207e-02   +5.772490097992696e-01   +1.221426797301010e-01   +4.322101938306749e-01   -3.992793293751197e-01   -1.940415500113477e-01   +9.147637588626051e-01; +1.808967042050687e-01   +2.480319784834295e-02   +4.613157283655399e-02   +3.531754669865924e-01   -1.427906216057070e-01   +8.257231245303951e-01   -2.926382723303067e-01   +5.692564029312273e-01   +2.808508433328450e-01   +1.391348965717045e-01   -1.100771585136722e-01   +2.227468434104555e-01   +2.410294023957811e-01   +1.122593093806153e-02   -1.004614195991067e-01   +5.049975534653254e-01; -2.454311721391190e-01   +3.203986862957491e-01   +2.643333631368736e-01   +5.329697680620070e-01   -1.271386764485420e-01   -2.127248091874704e-01   +6.746246321094923e-01   -2.265214273294149e-01   +6.609428684105606e-01   +4.813520943748335e-01   +8.443982210553913e-01   +6.942762553087274e-01   +1.450474475399273e-01   -3.175888938798965e-01   +2.810796300507535e-01   -3.965107683127599e-01; +5.208057348901321e-02   +9.780046620389073e-01   +3.809315872332156e-01   +7.968862769082948e-01   +8.650650519435135e-02   +1.267356827725308e-01   -4.376290266263699e-01   +4.775887171526904e-01   +6.127783968179686e-01   -1.636297534779616e-01   +2.636057163237432e-01   +4.409816380947071e-01   +2.444199250175435e-01   +2.887462208293401e-01   +6.141697588596998e-01   -8.027513577969832e-02; +7.818285433982414e-01   +5.412773151469166e-01   +2.255543863109982e-01   -1.869615683835580e-01   +3.061008623148136e-01   +3.521813295554040e-01   -1.364933776553613e-01   +4.020958354844274e-01   +3.387796181695398e-01   +4.244733362383554e-01   -3.107381210467614e-01   +2.613827156610425e-01   +8.190441129652279e-01   +1.223734974520162e-01   -1.267642881423388e-01   +6.349881476158786e-01; +6.283474672783385e-01   +5.104953856857986e-01   -3.457153240047974e-01   +4.360377190237718e-01   -1.834001312822868e-01   -1.583783370535518e-01   +9.417336521535666e-01   -2.295430826665791e-01   +5.983420374472177e-01   +9.999114736682592e-01   -1.729649374163227e-02   +2.683495517695495e-01   +5.238273374204807e-01   +8.091311301144277e-01   -2.621184025500837e-01   +5.805951400560429e-02; +1.247716281040011e-01   +7.723379018147066e-01   -1.132168955635094e-02   +1.058703210515542e-01   -7.290880401646144e-02   +3.002063186549256e-01   +6.735146781762926e-01   +4.253669874741045e-01   +3.455445792121469e-01   +6.930835024565926e-01   +5.117757171990022e-01   -4.091955903784552e-02   +2.694287948664540e-01   +6.655837042914836e-01   +1.601609868201351e-01   +2.558026870128650e-01; +6.403764691183365e-01   +5.751038137703718e-01   +4.119670954592473e-01   +2.766726188090977e-01   -4.144430395021040e-01   +6.793736526597299e-01   -1.072886760843007e-02   +6.281343277455509e-02   +2.399678750715369e-01   +9.229219472211192e-01   +4.531857611905646e-02   +1.000000000000000e+00   +7.920176262585817e-01   +5.793485309152936e-01   +6.074454420124619e-01   +2.374764909972895e-01; +4.706371613575824e-01   +1.936802080748021e-02   +5.435807589008904e-02   +4.559454578451905e-01   +5.275449064392754e-02   +3.475064987857096e-01   +7.112731569094862e-01   +8.451557012297026e-01   +2.717848836345223e-01   +5.329851732647117e-01   +5.250264009800693e-01   +5.763588140345174e-01   -2.144544740018482e-01   +8.482102875211754e-01   +2.389192830337922e-01   +2.421976626194316e-01; +3.836569559664643e-01   -1.303972846177761e-01   +4.101928282267001e-01   +7.298763756857738e-01   +2.514826018128749e-01   +5.364450070411120e-02   -1.011387212852788e-01   -4.772449673874767e-01   -1.862487026961420e-01   -2.217903584275373e-01   +6.609460010391556e-02   +5.076186799119294e-01   +2.829965816202429e-01   -9.567518748301089e-02   -3.988734414273044e-01   +6.880240708239471e-02; +2.447648142085906e-01   -8.481422837882244e-02   +1.817645051001082e-01   +3.077055520441777e-01   -2.769682803203903e-01   +8.605838395412672e-02   +7.841998664317210e-01   +6.072658405806260e-01   +5.409955757345749e-01   +1.381198739318450e-01   +6.007488476105689e-01   +1.544028719722284e-01   +7.049650352977127e-01   +9.241374011396081e-01   +5.110904238665490e-01   -1.193132981437200e-01; +1.624480778303166e-01   -2.192237083846785e-01   +5.121974598309919e-01   +9.599103600106153e-02   -3.238602249556105e-01   +3.361205693920439e-04   +5.340294182891007e-01   +5.844695753089967e-01   +6.930557459822930e-01   +1.582378155160496e-01   +3.718223555137939e-01   -1.782174595285614e-01   +9.524283241545271e-01   -2.381962736414494e-01   +6.633971121984504e-01   +2.314570068423165e-01; +6.043387341081314e-01   +3.612422155874081e-01   +8.151309986100396e-01   -4.964323660148335e-02   +5.788386891829561e-01   -1.312802011615367e-01   +5.855881132229522e-02   -3.849201893923738e-02   -1.903122795314843e-01   +6.560939280214513e-02   +2.519938068801815e-01   +9.239640791838096e-01   +9.599893398411721e-02   +2.567746437737876e-01   -8.612648142105148e-02   +5.609338860625062e-01];
L2I_L1I_iGABA_netcon = [-2.673043849824058e-01   +7.194489284754528e-01   -8.101560626794287e-02   +7.148450432348580e-02   -3.661055537661091e-01   -3.764183541893782e-01   -1.883861234210700e-01   +1.996277048586404e-01; -9.251857795920189e-02   +2.744202192112814e-02   +5.466337303406272e-01   +2.503815297264556e-02   +1.000000000000000e+00   +7.390888129896929e-01   +4.389243716329123e-01   +1.847378648095777e-01; +1.299425200754822e-01   +6.632707965100068e-01   +4.991822829420628e-01   -6.494691694833236e-02   -3.932779125160164e-01   -3.573057878094648e-01   +2.658816736372406e-01   -4.725531974316260e-01; +9.639865389995104e-01   +3.392863097881402e-01   +6.623321974586663e-01   +2.048520404391205e-01   +4.616478359149088e-01   +4.810302121626782e-01   +2.656913876012243e-01   +2.802008222956970e-01; +5.112520007220593e-01   +6.090118578330690e-01   +2.718755967082734e-02   +3.465607795951798e-01   +6.993715174050673e-01   +7.850974033479533e-01   -2.265189470926364e-01   +7.671908534639553e-01; +9.872940372216878e-02   +1.660943337743893e-01   -6.699352364706011e-02   -1.857719991175087e-01   -2.191499241262015e-01   -2.174964235516106e-01   -2.087923279749222e-02   -1.254351929734070e-01; +1.885814659426897e-01   +2.882138980185874e-01   -4.767674871395323e-01   +2.075934230711668e-01   +4.577259326116939e-01   +4.087961735166198e-01   +6.977567190544361e-01   +7.067632287569940e-01; +4.322427994800050e-01   +3.758049920565757e-02   +6.082986098807290e-01   +6.658612891881988e-01   -2.228523600015863e-02   -3.579899482548589e-01   +2.144080251714981e-01   +3.300349525786012e-01; +1.194081185900982e-01   +2.294141709983727e-01   +6.428778694710273e-01   +2.215448903992271e-01   -2.063891060884973e-02   +4.667615524530381e-01   -1.035901124232252e-03   +7.464728362902560e-01; -2.549440710607444e-01   -4.190448792749885e-01   +1.724786453850488e-01   -8.066687967679251e-02   +2.487200134827136e-01   -2.395926919907690e-01   -7.030277854017861e-03   -1.728887757250809e-01; +4.081750782952032e-01   +4.033412443955087e-01   +6.647008316562907e-01   +9.202125886559167e-01   +3.198291573507969e-01   -2.014595736155526e-01   +6.424533494788393e-01   +8.842786272874280e-01; +5.358091484134692e-01   +2.955060379547965e-01   +9.842568100654604e-02   +6.143333545666552e-02   -1.317210778698829e-01   -1.653335840450204e-01   +8.358209095698723e-01   -4.542667236086499e-02; -3.137764480786399e-01   +2.967545716669864e-01   +2.602787899152252e-01   +3.460004368957139e-01   +3.869965737212410e-01   +5.123279396695928e-01   -2.116737880913254e-01   +7.539481973116277e-02; +1.924973453151851e-01   +4.020435336560464e-01   -4.277388914534761e-02   +2.270316955251862e-01   +2.118543220805783e-01   +7.716395871683690e-02   +5.056669689383134e-01   +3.687394111158058e-01; +5.044144264423688e-01   +4.588233317219714e-01   +5.604604282513926e-01   +9.220253338849451e-01   -2.617815042480905e-02   -1.092607135485754e-01   +4.850119315887096e-01   +7.043821508206763e-01; +1.877078215379865e-01   +1.202355295094239e-01   +2.804056857170672e-01   +5.778304759150754e-01   +7.633095481289559e-02   -5.966207977591793e-02   -1.105487126786285e-01   +3.093335420711004e-01];
L1I_L2I_iGABA_netcon = [+4.245946877211375e-01   -2.920924218646431e-01   +2.795698568398341e-01   -8.579281440297451e-02   +3.081020664276700e-01   -1.049449674961321e-01   -4.048034308775137e-01   +1.958923924080360e-01   +8.518003394943571e-01   +2.216028895726704e-01   +1.791786296840724e-01   +1.189329578091155e-01   +9.951707763469508e-01   +7.725154428083895e-01   +8.891655737908705e-01   +6.142139950751797e-01; -6.644912731490919e-02   -2.787892342476258e-01   -1.163890816650267e-01   +3.969904402893494e-03   +5.590988767199442e-01   +5.788998511976042e-02   +3.955741348851563e-01   -5.282299786613409e-01   -4.444836983317678e-03   +9.186921130611506e-01   -7.304400303817252e-02   +6.046084971278400e-01   +4.930397278357061e-01   +5.419787208527650e-02   +5.113989235416863e-01   +6.484206746509830e-01; -1.120102856389426e-01   -3.920134413090789e-02   -3.854461844460599e-01   +9.788203512360384e-02   +3.803902414836061e-01   +5.658893861614646e-01   +7.644051771091360e-01   +7.397633828268582e-01   -5.951434166503401e-02   +5.354801182421067e-01   +7.915825673133465e-01   +6.889312229188483e-01   +1.000000000000000e+00   -4.211019169277416e-01   -7.134572138948844e-02   -4.096758504874719e-01; +7.887242321979461e-01   +4.608639469635051e-02   -1.284527818343986e-01   -2.718649941655775e-01   +5.038454517791142e-02   +8.538018300303385e-02   +5.437771655034140e-01   +5.610964768499681e-01   +5.392426464963554e-01   +9.413313452837208e-01   +8.317101429748629e-01   +6.102940095483764e-01   +7.985346121642289e-01   -2.083032197975594e-01   +2.916447095437895e-01   +1.857444219021811e-01; +4.114749033591418e-02   +8.873290041554175e-01   -3.567661668621117e-01   +7.497809482533038e-01   -1.349985314054300e-01   -1.396972507265361e-01   +1.760431435764772e-02   +5.707924106215628e-01   -3.287099082227050e-01   +1.032790240547002e-01   +2.770820752489193e-01   +8.952751465930433e-01   -1.074184683979041e-01   +2.917959772933343e-01   -3.933418426902939e-01   +2.384600987064778e-02; -3.186339709383265e-02   +3.708086821601874e-01   -1.792284811049650e-01   +6.222501205030638e-01   +2.266216840397957e-01   -3.352628505340124e-02   -5.748188004258384e-02   +1.827449637819907e-01   -6.627433377018627e-02   +3.615644604665370e-01   +4.855128336387765e-01   +7.163955503596261e-01   +3.843231252481464e-01   +3.910624144600552e-01   -2.559070493945566e-01   +1.792964361718917e-01; +9.770200922084255e-02   +8.776824387563787e-01   +1.359091168250957e-01   -2.245822139597446e-01   +1.081822142024375e-02   +6.393434536518476e-01   +4.655859858929568e-01   -2.896029362497117e-01   -6.642121532980559e-02   +3.412399062598609e-01   +4.730524991629737e-02   +5.754564683367654e-01   +6.297123940638323e-01   +9.899827995539573e-01   -1.425148268042747e-02   +2.598172586734276e-01; -3.495090635418829e-01   +1.462833208732095e-01   +7.861835532938621e-02   -1.145614361516059e-01   +9.635227989461503e-01   +8.314089898405461e-01   -3.800503526603635e-02   +4.987629161067975e-01   +6.046380953085010e-01   +7.532326646178106e-01   +7.760691866688406e-01   +5.133644668067299e-01   -1.349618532716242e-01   +3.939741166296775e-01   +4.017480550794355e-01   +5.565155870669830e-01];
L2E_L1E_iAMPA_netcon = [+3.612707620930404e-01   +4.575957268110009e-01   -4.014514985663461e-01   -4.033250895678833e-02   +4.550491132687813e-01   +1.872998259847437e-01   +3.813086261350685e-01   +4.035908791595139e-01; +1.733077638465743e-01   +6.164051708829889e-01   -2.345563473706883e-01   +9.652229074090104e-01   +1.961244731151769e-01   +2.690982466041014e-01   +6.327556930480153e-01   +3.251363154760369e-01; +3.834775709927090e-01   +2.675174693068112e-01   +2.792130734561426e-01   -5.725626136444308e-02   +7.927336804344416e-01   -3.074445766482113e-02   +7.943724899455770e-01   +2.548778900880562e-01; +7.694882904978536e-01   +7.880295489901820e-01   +7.638320998429794e-01   +4.396921991887162e-01   +7.209410573551907e-01   +4.508720086669606e-01   -2.159049428321216e-01   -2.643311308420022e-01; +2.090568033994792e-01   +3.776907658059186e-01   +7.120337816755218e-01   +4.657594588603544e-01   +4.538253049461474e-01   +4.774607968779692e-01   +5.950974645663517e-01   -6.415037312878229e-02; -8.369554428610411e-02   -1.250178307278849e-01   +1.005463157382156e-01   +2.024413209790439e-02   +4.868090648089162e-02   +7.764223089043945e-02   +4.618573154240854e-01   -2.753865392253512e-01; +3.651396938802572e-01   +1.564929833553788e-01   -1.087702249272867e-01   +1.336609328012300e-03   -1.876138434001205e-02   +5.813147686236220e-02   +2.523898210846720e-01   +6.555936668803222e-01; -1.247267201900382e-01   +2.549086774512189e-01   +2.391284884478452e-01   +2.113430509846832e-01   +3.962211820914339e-01   +8.403026200591032e-01   +7.412094925534415e-01   +5.239153522050973e-01; +3.189994425148256e-01   +2.708368539708593e-02   +2.542763597472755e-01   +7.040894317962517e-01   +7.338472647843474e-01   +7.435823907912571e-01   +9.325171254355363e-02   +2.175319082485681e-01; -7.774170317339286e-02   +5.523220178354701e-01   -2.390638837329637e-01   +7.191296981645240e-02   +5.526617417058452e-02   +5.531892009418333e-01   +1.425939376055411e-02   -2.844801054981208e-02; -8.896002244672042e-02   -2.351056077437538e-02   +1.000000000000000e+00   +6.015809529253410e-01   -1.081961302950069e-01   +5.477730249520768e-01   +1.392309618267926e-01   +6.742052892506876e-01; -1.377491478834338e-01   +3.527165427636247e-01   -3.667047520276002e-01   -3.860391482413206e-02   +6.462213807400645e-01   +3.750653986123181e-01   +7.066905066240194e-02   -1.267218804892432e-01; +2.845447408590627e-01   +6.002872181401635e-03   +2.804767926035955e-01   -2.596483098874358e-01   -1.912186452546288e-02   +2.716939932495827e-01   -7.991979280751424e-03   +5.233681736071106e-01; -3.978563407195089e-01   +3.044364160034259e-01   +4.569117684886519e-01   +2.656005400645445e-01   +4.682513930964017e-01   -6.392520625495207e-02   +7.218290189821529e-01   -9.390370374196952e-02; +3.240576148582822e-01   -2.522551013516021e-01   +3.607427104963801e-01   +6.027626308082495e-01   +5.068549854386885e-01   -1.099332066945471e-01   -1.610571529595680e-01   +6.217760548952518e-01; -4.553598108641752e-01   -4.118297059948340e-01   +5.425141974071840e-01   +2.327190820985069e-01   +2.598755806060163e-01   +9.918873743499013e-02   +4.437458976491024e-01   +3.536737748811390e-01];
L1E_L2E_iAMPA_netcon = [+6.073121358998420e-01   +2.191910158866905e-01   -1.691848804641254e-01   +6.157111040949402e-02   -5.028341845028882e-01   -3.541560273362705e-01   -4.345463434734716e-01   +8.476578616055273e-01   -1.022968725942458e-03   +4.590733496702462e-01   +9.164600551652551e-01   +4.035296089203762e-01   -7.473384350727129e-02   +2.781296715508362e-02   +4.883684105814898e-02   +3.784663735741403e-01; -1.418669083480479e-01   +4.919531052267354e-01   +5.034752746307314e-01   +4.768661733076651e-01   -1.967630331415522e-01   -5.213990700668576e-01   +9.822631160529960e-02   +8.879006194082599e-01   -1.925846178851502e-01   +3.699699388831122e-01   +1.423542392803853e-01   +6.769835463686729e-01   +3.780818026457756e-01   -9.149593477676446e-02   +8.179112825429737e-01   +7.014133124776170e-01; +2.151302981779298e-01   -8.061657355658716e-03   +5.592263973103073e-01   +3.716711535189104e-01   +4.443209227971817e-01   +2.741135371245267e-01   +6.769169247482711e-01   +1.146363693688195e-02   +7.570153507072282e-02   -9.833878032895986e-02   -9.394609335263700e-02   +7.394953026499860e-01   +8.534847340581782e-01   +5.472415880119326e-01   +5.114998461599910e-02   +2.769926468913195e-01; +6.721600489303238e-03   +4.375221681202948e-01   -2.335161187333302e-01   +3.898532195140038e-01   -7.928111425983689e-02   +7.848511957544930e-01   -3.673954762224828e-01   +7.049848563859427e-01   -5.010635103949145e-02   -3.340357272822079e-01   +3.098241350172939e-01   +3.830956434299984e-01   +7.187274716130299e-01   +4.074514479552419e-01   -3.927195658156150e-02   +2.441466695104481e-02; +1.987481305789952e-01   +1.787049476991587e-01   +7.686130254774919e-01   +3.984366118448195e-01   +8.366356083582195e-01   -9.440940679099516e-02   +3.961276369942517e-02   +4.239532460781364e-01   +7.098379817484120e-01   -1.334616917053208e-01   +3.334985453517669e-01   +5.102125853369327e-01   +2.035313256597016e-01   +3.357680543899396e-01   +7.558330442740677e-01   +9.510896888104293e-01; -5.911507034562505e-02   -3.767022266026125e-01   -3.204647849852965e-01   +4.775730824884680e-01   -5.000306797133779e-02   -1.829597761736546e-01   -5.784926848677729e-02   -2.146736407713200e-01   +4.680336228451758e-02   +2.928218309544941e-02   +3.035285034267245e-01   +7.600736598413651e-01   +6.192932243080366e-01   +4.990447082418176e-01   +5.840323983919793e-01   +3.670767373589720e-01; -1.622040928928728e-01   +1.635242223614519e-01   +5.475027108300107e-01   +6.122746711014777e-01   +9.040851344043728e-01   -6.515499214974173e-02   -3.118869582634766e-02   +6.169681219569705e-01   +1.000000000000000e+00   +2.084688817515092e-01   -1.537076800000133e-01   -2.316420873362602e-01   +5.210473818714516e-01   +5.536191024759023e-02   -1.520003009995684e-01   -1.570084834348987e-01; +5.494482736386926e-01   +5.345385101345612e-01   +8.915291393984873e-01   +2.218477746132824e-01   +5.404637112001635e-01   +7.556021110619929e-01   -5.965737649076636e-02   +3.348406681778467e-01   +1.202501134225461e-01   +7.826500209013915e-01   +7.320851160031291e-01   +1.901751785855579e-01   +3.937290445089467e-01   +5.818319110049611e-01   -3.149875103928372e-01   +2.732099997119380e-01];
L2I_L2E_iAMPA_netcon = [-1.719870632816840e-01   -1.806100286931865e-01   -7.675584557220277e-02   -5.227416165457427e-02   -1.736535943010973e-01   -2.681820401882427e-02   -2.881268355118781e-01   +1.000000000000000e+00; +3.582781806712321e-01   +8.940876669209135e-01   +3.939888341080103e-01   +6.782162121893855e-01   +5.940001268766761e-01   -1.403101910756504e-01   +3.384034519962567e-01   +6.334376770210899e-01; +8.249249364717030e-02   -4.832772750982198e-04   +1.755043346377718e-01   -1.173450201143356e-02   +1.079612294286820e-01   +9.952488315970457e-01   +3.521703871418275e-01   +9.290800659448603e-01; +1.475810051622256e-01   -2.876027138625832e-01   +4.077387813906414e-01   +2.727246744180252e-01   +2.933349869621677e-01   -7.486511765718867e-02   +1.454427038240764e-03   +3.650585521137150e-01; +3.766171438356456e-01   -7.675796152324650e-02   -2.010641084254305e-01   -1.599498937651851e-01   +6.629237643506838e-01   +3.899392795443862e-01   -4.205133413709535e-03   +9.223210963439978e-01; -2.437657016521811e-01   -3.543681397233033e-02   -3.727710293283319e-01   +4.564387299466783e-01   -3.697057967010224e-01   -1.647536256034285e-01   -5.533970835190047e-01   -7.354453181959331e-02; +9.399743944388433e-01   +9.606171581554376e-01   +2.597762565206392e-01   +4.931411240180232e-01   +7.595929365637214e-01   +3.291719026490570e-01   +6.312901377662232e-02   +4.821412136735014e-01; +7.041258370267405e-01   +4.978871212521241e-01   -3.454772948627990e-01   +1.435199032080725e-01   -5.670287406580284e-02   +1.574289349794596e-01   +7.505167934619120e-01   +2.768277080772488e-01];
L2E_L2I_iGABA_netcon = [+7.146522195587734e-02   -4.134782931972144e-01   +3.176643558740431e-01   +1.040393699627969e-01   +7.613654404721461e-02   +5.221020010001640e-01   +5.192324328805352e-01   +7.303322392181523e-01; +6.304109931426968e-01   +3.255449931701664e-01   -2.571790117847346e-02   +1.197884764420788e-01   +2.271344413901880e-01   +7.772194337190950e-01   +1.220767746934910e-01   +5.279896995748827e-01; +3.506066694522514e-01   -3.504357754198312e-01   +2.400913423835685e-02   -2.868031010627800e-01   -2.606577933940433e-01   -7.203777475685193e-02   +6.470608310438581e-01   +7.865964472583935e-01; -3.729395324444894e-01   +3.865818781220188e-01   +1.117454079760299e-01   +6.901487877360022e-01   +1.391004384569886e-02   +3.881962701910127e-01   +9.982355597837411e-01   -1.031456813124621e-01; +3.204235889241008e-01   -3.306845959611052e-01   -2.721366175050530e-01   +6.997986463194008e-01   +5.678465042106758e-01   +3.328273839489564e-01   -3.482382576594794e-01   +6.166071045155200e-01; +1.393586527107981e-01   -5.412489471336875e-02   -1.149810154836496e-01   +4.708555039913193e-01   +7.360631100959543e-01   +7.302218240991453e-01   -3.520386306114241e-01   +2.467662461550663e-01; -3.033531543555811e-01   -2.013921386238830e-01   +2.221890289236542e-01   +4.054071185964364e-01   +6.704329689116447e-01   +6.933055644468177e-01   +6.785645931127148e-01   +4.143320789035270e-01; +6.379048092791767e-02   -1.489290003072173e-01   -3.085559492903002e-02   +5.082964280820240e-01   +9.897529214456977e-02   +6.704061971914264e-01   +1.000000000000000e+00   +4.180057652054933e-01];
L3E_L2E_iAMPA_netcon = [-5.765236273610624e-01   -8.285874865258831e-02   +6.989014902361431e-01   +4.156915523373459e-01   -2.137427588969046e-01   -6.891622294972517e-02   +1.933298936466818e-01   +2.869361708789070e-01   +5.158671119921885e-01   +3.625197576580619e-01   +5.368129111776867e-01   +1.142410322792870e-01; +4.532982409018548e-01   -4.614164672475942e-02   -5.283429779622861e-02   +7.115054404799677e-01   +1.198911278848426e-01   +7.905402003536113e-02   +7.835010365965414e-01   +1.472663981055326e-01   +2.614866225969655e-01   -2.730574664022388e-01   +7.476689793910606e-01   +5.081786054466331e-02; -1.295537565552428e-01   -7.899354063892809e-02   +5.122689742142527e-01   +7.595113982664455e-01   -3.139084592945816e-01   -5.609741534029857e-01   +4.427010163544151e-01   +7.994868141678526e-01   -2.817257533313336e-01   +7.163444949078567e-01   +2.174949446034313e-01   +5.417731311937388e-01; +3.815390026131327e-01   +7.851070420471015e-01   -3.486844936340929e-01   +2.425481108213236e-01   +2.909707488270277e-01   +4.986514647703689e-01   -2.475672930106256e-01   +8.509689011533904e-01   +1.063416991089726e-01   +8.896690655859659e-01   +5.989889761001800e-01   -1.449520507333499e-01; +1.330399472376881e-01   +7.060109543374932e-01   -3.085938730143174e-01   +6.159840318481691e-02   -2.013864806765366e-01   +9.640336427426575e-02   +5.405723061806821e-01   +8.583736590421505e-02   +5.173654450232057e-01   -2.208972951002004e-01   -1.332534665069531e-01   +3.494867487507637e-02; -5.042283562514507e-01   +2.809818840243866e-01   +5.052885591500039e-01   +3.601223561755302e-01   +2.922830690847626e-01   -1.478908061499637e-01   +6.089973987855247e-01   +7.804097671728749e-01   -1.617600115043895e-01   +3.766112534386678e-01   +1.000000000000000e+00   -1.121464024429761e-02; -1.928553769271541e-01   -1.085938916135947e-01   +3.859422143754223e-01   +7.268711151999346e-01   +7.404350976235693e-01   -3.855368883002018e-01   +6.360193482902452e-01   +2.154623989584051e-02   +4.446511220732700e-01   +8.194192873388013e-01   -4.807083652126677e-01   +9.231254370897881e-01; +5.683391285431345e-01   +6.557587268635341e-01   +8.214467864625935e-01   +4.328344056188203e-01   +4.321386574579035e-01   +5.491534002327818e-03   +4.719381488729154e-01   +1.875417703161162e-01   -3.702187466422411e-01   +6.368306818887439e-01   -2.369000268235823e-01   +2.090828001339844e-01];
L3I_L2I_iGABA_netcon = [+4.404778170202916e-01   +6.562000637560041e-01   +2.568140913362655e-02   +4.008724917558729e-01   +6.647618561279517e-01   +3.256539896892953e-01   +1.735226585812692e-02   -4.035833116126991e-01   +9.655378137615327e-02   +6.475781353206217e-01   +5.348491347788777e-01   +4.095699603233960e-01; -5.550723505973547e-02   +8.373850084388283e-01   -3.298545688677121e-01   -8.959319523689019e-02   +2.391620958728924e-01   +1.905189189426735e-01   -3.454962882374285e-02   -1.359256541599194e-01   +6.597517834618208e-01   -2.139178828960810e-01   +1.772728258018964e-01   -4.224036946819771e-01; +4.197213951985410e-01   +9.421894488440499e-01   +4.100941459944998e-01   +2.989345158594189e-01   +6.200263326009110e-01   +5.526648103710072e-01   +4.304685956982687e-01   +5.790742357338154e-01   -3.974144946881629e-03   +7.330942697218622e-01   +4.986910771791865e-01   +5.048519435490273e-01; +7.654834863358060e-01   +5.299315665336296e-01   -1.778873866999675e-02   +6.820762793673626e-01   -2.375344169192042e-01   +3.866380130977132e-01   -3.658752684443073e-02   +1.000000000000000e+00   +2.316517047616444e-01   -9.718045649146068e-03   +4.266681836807120e-01   +5.348607916070796e-01; -1.633005565127617e-01   +6.243253169478735e-01   -4.329897695786140e-01   +3.214691083261808e-01   -1.430563523576499e-01   +9.490514955176517e-01   -2.213782333998854e-01   +5.567441070504611e-01   +2.181048927593904e-01   +3.199692560387993e-01   +8.650828921480102e-01   -1.021778737864868e-01; +7.832284352072536e-01   +5.169273835204093e-01   -7.686824525594955e-02   +3.200841973735535e-01   +3.521846767103681e-01   -2.117563490403735e-02   +2.436582448096349e-01   +4.502472148326800e-01   +8.585011322313219e-02   +5.083328835539460e-01   +3.195577452699073e-01   -3.173434785150089e-02; -1.859709678418682e-01   +7.742547914996125e-01   -1.297196397206317e-01   +4.289769801547103e-01   +3.734753170843046e-01   +3.305931544476864e-01   -3.230804347853852e-01   +4.057866112720810e-01   -1.426346224834821e-01   +1.426019322549668e-01   +1.412564358911731e-01   +4.816801711635708e-01; -1.185788382296563e-01   +4.473777606191242e-01   +2.134787935612129e-01   +7.390885069441041e-01   +8.307572472076637e-02   +5.706745596228823e-01   +1.665965586715213e-02   +6.726091157841666e-01   +3.741553158019879e-01   -4.429426693008692e-02   +2.199577169962707e-01   +6.172585764210197e-01];
L2E_L3E_iAMPA_netcon = [+1.363943792838584e-01   +4.172399163165693e-01   +9.217661086546833e-01   +3.764916468813922e-01   +1.341825464614226e-01   -1.293370033989162e-01   +6.961691005847988e-01   +2.326465701776461e-01; +1.661889956972804e-01   +4.089090072915212e-01   -3.799046140567114e-01   +5.622821612051089e-01   -2.678018673902819e-03   +2.562795021929606e-01   +5.973397984277244e-01   +1.396410303934347e-01; +5.486261426470279e-01   +5.275716460346761e-01   +4.832217697122119e-01   +2.249090953061555e-01   -6.086730316312698e-03   +4.644272796906103e-01   +1.117542195962527e-01   +4.849164463573172e-01; +1.633998595563874e-01   +6.108567453011845e-01   +9.630554711259772e-01   +3.251005761116155e-01   +7.949774020172421e-01   +5.771796023749116e-01   +7.695331338991901e-01   +8.937507395038216e-01; +1.388660324944895e-02   +1.529856349130351e-01   +3.626164484213462e-01   +5.949808314261563e-01   +7.122870842380122e-01   -3.871198698443948e-01   +6.499779638775105e-01   -2.247922286448447e-01; -1.010711534384288e-01   +1.426665194057677e-01   +4.611122125049449e-02   +2.374113928310138e-01   -2.134291078828733e-01   -3.744626291044069e-01   +5.225829006265958e-02   -4.165245945561318e-01; +4.836637765012410e-02   +6.233708055369217e-01   -2.337637619274242e-01   +2.022591862852382e-01   +1.686289740321823e-01   +2.569499665139394e-02   -5.289301140684336e-01   -3.615914866292054e-01; +6.209985625378348e-01   -2.409452291137646e-01   +6.181351223246641e-01   +4.439973023396180e-01   +7.330265391780754e-01   -2.831636267693641e-01   +3.189609633695780e-01   -7.935132038395616e-02; -1.104465854998598e-01   +6.233580220619022e-01   -1.070812251486221e-02   -3.868823313023802e-02   +2.572766538960486e-01   +4.285350278778626e-01   +9.767768826514163e-02   +1.000000000000000e+00; +3.483816409596397e-01   +6.377526700636857e-01   -1.063174653127286e-02   -2.962285578235090e-01   -2.378884635907524e-02   +5.461251974713157e-01   +3.007064395303011e-01   +1.755339231036055e-01; +9.625772197977858e-02   -2.640697588533492e-01   -2.779795910838285e-01   +1.316649486199127e-01   +5.784976454117651e-03   +2.488931468123991e-01   +1.387286154538296e-01   -8.063252735505952e-02; -3.046098111727758e-01   -3.675581915423080e-02   +6.173838174193084e-01   +6.563027364131917e-01   +4.563879758791420e-01   +6.837841129950387e-01   +2.808161397433183e-02   -9.416271819450546e-02];
L2I_L3I_iGABA_netcon = [-6.528769306193012e-03   +4.189553233493574e-01   +6.865382375216853e-01   +2.463172019728172e-01   +6.355422252586599e-01   +6.766116815292470e-01   +2.257831217564972e-02   +4.125040988730296e-01; +4.586103071498659e-01   +3.457284501332017e-01   -1.359764575041042e-01   +7.224502576660620e-01   +4.394792215945407e-01   -1.172830457870361e-01   +5.659319680356145e-01   +6.982880999080230e-01; +8.073970074814717e-01   -3.674727647012806e-01   +7.053526390694291e-02   +5.101928238231406e-01   -1.110448843238641e-01   +1.977148252370333e-01   +7.242799183550210e-01   +2.892546584244517e-01; -2.281089094893577e-01   -3.947989166031355e-01   -1.415392876695576e-01   +9.591720487929609e-02   +7.971165233408475e-02   -1.737289112841176e-01   +6.721565888507357e-01   +8.116075536999116e-01; +6.120240109055377e-01   +3.971594095823470e-01   +7.968779136330139e-01   -7.760628843126070e-02   -2.098532274648413e-01   +2.198734860577689e-01   +1.348429181036721e-01   +8.439606290687663e-01; -3.834124372823288e-01   +1.000000000000000e+00   +7.488740002872334e-01   -1.625604194219472e-01   +7.642169707696033e-01   +2.413776404259113e-01   -3.279399423212302e-01   +5.865524071466501e-01; +6.901065090250215e-03   -4.323794460966945e-01   +4.535421757089285e-01   -3.084123555256396e-01   +5.321061244263474e-01   -1.470670671168428e-01   +6.993432125065050e-01   +6.516828087208429e-01; +6.253434392370517e-01   +5.290791249702422e-01   +4.007375096698596e-01   +7.180430883018851e-01   +4.557832917216937e-01   +3.263714367533908e-01   +5.528996943506540e-01   +7.397271239489155e-01; +3.402779274832784e-01   +9.655311110101537e-02   +7.116085537389001e-01   +5.550529384036363e-01   -2.523063748589890e-01   +6.890851425317120e-01   +3.073288764587489e-01   -2.853231812574746e-01; +6.612949081314013e-01   +4.014229984268202e-01   +2.871939305246494e-01   +4.794414193759867e-01   +1.658879098398852e-01   +9.918865065675900e-01   -3.060164446447266e-01   +5.145468544890666e-01; +8.642107157746349e-01   +1.463643428779263e-01   +6.307987517785476e-01   +4.475596279968241e-01   +2.143561913316320e-01   -2.099292526875899e-01   +4.430545080782156e-02   +6.088171668138031e-03; -5.181820579465340e-02   +8.453382444712004e-01   -4.726698254475799e-01   +2.194454498606940e-01   +9.490356400969056e-02   -1.514274827535324e-01   +9.062785672970405e-01   +5.554820018665722e-01];
L3I_L3E_iAMPA_netcon = [+7.770770442704624e-01   +2.656001361564313e-01   +5.687404095196672e-01   +2.210745551474159e-01   +1.367808817745020e-01   +8.295479962524754e-01   +5.116263068601449e-01   +6.185089666643297e-02   -3.087917039730848e-01   +5.793342594045526e-01   +5.527949745415528e-01   +3.983575846508885e-02; +5.868556435719438e-01   +7.062295634277022e-01   +9.174436092529789e-02   +5.325602850090153e-01   +5.565203047116921e-01   -4.768001409951193e-02   +2.705549598059062e-01   +2.991318951141694e-01   +3.729765406806668e-01   +2.754744381732081e-02   +1.669922078339139e-02   +7.620877995269110e-01; +4.769662510240530e-01   +5.844350320307250e-01   +7.460799597276419e-02   -1.039635190096462e-01   +1.433045209471863e-01   +7.303070270475830e-01   +3.232880876171393e-01   -3.380906543061136e-01   +9.329350591824914e-01   +6.642540109210913e-01   -4.705895429994491e-01   +6.480762841868519e-01; +5.356117787326518e-01   +5.424639630470542e-01   +1.000000000000000e+00   +5.981435511084217e-01   +2.110723345320505e-01   +1.994840766572892e-01   +8.121729264000784e-01   +6.951590882396051e-01   -1.561899723229347e-01   +4.347686493837533e-01   +1.485699683758649e-01   +2.740329217029126e-01; +4.049205718305926e-01   +1.000508856443335e-01   -1.144709626187359e-01   +5.558699971311886e-01   +1.254364113482118e-01   +3.693104317146690e-01   -3.897207966959418e-02   +3.305350326361638e-01   +9.018054299887147e-01   -4.067706702326158e-02   -4.723029857150272e-01   +2.930346728934974e-02; +3.732296321751959e-01   -2.745146889246085e-01   -5.782279393070901e-02   +7.063012728793768e-01   +2.891594640239438e-01   -1.172530526338181e-01   +5.091217125460835e-01   +4.521802519833001e-01   +6.774765522367436e-01   +6.427536300515405e-01   -2.833162942502635e-01   +5.765317249169287e-01; +1.975366987169674e-01   +6.406552857385128e-01   +2.296321283840803e-01   +5.987632063894336e-01   -1.198446906605966e-01   +6.032960751555279e-01   +5.413862037837535e-01   +2.721720290555878e-01   +3.930433034632692e-01   -6.711103591148661e-02   -3.370162404810026e-01   -1.436199866464444e-01; +9.103889251090267e-01   +8.003690976450656e-01   +4.851926094179620e-02   -2.322956139274771e-01   -3.643514458138735e-01   +1.565775816450976e-01   +1.555982434193749e-01   +4.152447501492260e-01   +4.214951800398115e-02   +2.055673072220160e-01   +8.886091689751295e-01   +3.432060415927792e-01; +2.365814660041056e-02   +5.798222272077561e-01   +7.453058430219910e-01   +1.186569764860183e-01   +2.066565660410939e-01   -4.884898404048346e-01   +8.678401834384369e-02   +6.559155407618145e-02   -3.549831569341220e-01   +5.070375834242945e-01   +1.041064035083526e-01   +6.236266706850098e-01; +2.118078610819806e-01   +2.826592119881781e-01   +1.427788561517174e-01   -5.292700300840372e-01   +4.273027460518200e-01   +4.421168310541816e-01   +2.568369137100683e-01   +5.011257600478344e-01   -4.730131115290430e-01   -7.203955351583884e-02   +1.786865590344374e-01   +8.055045586482700e-01; -2.391203834263732e-01   +9.071228699356618e-01   +3.030736806215649e-02   +4.197916548179589e-01   +4.317154376724306e-01   +2.437502330309280e-01   -2.378681204769136e-01   +5.166214156366004e-01   +8.801335227423344e-01   +7.690336278510893e-01   +9.195034885317651e-01   +4.576550503460975e-01; -2.617358869975072e-01   +8.478289850158607e-03   +7.446215265052867e-01   -2.982415071703850e-02   +7.739544373044959e-01   +7.052109421432574e-01   -2.836289496062129e-01   +6.354922425444788e-01   +6.243988714961324e-01   +2.879362116031680e-01   +4.236375586518140e-01   -2.503728820157539e-01];
L3E_L3I_iGABA_netcon = [+2.447904961861085e-01   +9.081881819008861e-02   +1.636978074968790e-01   +1.955962436779638e-01   +4.856488573030387e-01   -2.063814244098627e-01   +4.220937870284248e-01   -1.461660715639493e-01   -3.556073515084246e-01   +4.064287861286739e-01   +4.259203303846185e-01   -2.396870230229966e-01; -1.932879381289224e-01   -1.860991752073978e-02   +2.141380629391087e-01   +5.607317065444113e-01   +9.317671989028189e-01   +2.916442122168662e-02   -1.468059475644076e-01   +3.453247819838911e-01   +3.812826161910631e-01   +7.074620413452639e-01   +5.126244219167129e-01   -1.974915423851518e-01; +2.666297299234171e-01   +7.710851582363126e-01   +2.802232285110091e-01   +6.957251508505945e-01   -2.163642861022127e-01   +6.699404123750814e-01   -1.730682251370989e-01   +7.390003041536486e-01   +1.046535857274004e-01   +1.501470406335061e-01   +5.313130264639343e-01   +2.199941888520265e-01; -3.980585221993012e-01   +1.644072738848409e-02   +9.290500480130384e-01   +1.000000000000000e+00   +7.053122441190711e-01   +2.442174717450146e-01   -3.310210669227092e-01   -9.461951579838692e-03   +2.698302730561896e-01   +8.012807484126844e-02   -2.008871278507607e-01   +9.061185548777740e-03; +1.938193318088064e-02   +8.607932608992487e-01   -1.622570030238157e-02   +6.164101037792591e-01   +7.785385449371015e-01   +7.277581614951034e-01   +1.023785317737644e-01   +1.236814416388171e-01   +1.746120176995790e-02   +6.655358465569328e-01   +5.899037263267929e-01   +2.260473613174104e-01; +6.868973374617373e-01   +2.150872431717980e-01   -2.092458580285963e-01   +2.455732045083177e-01   -2.527421627359209e-01   +8.140084137212457e-01   -3.811898749490102e-01   +7.719061696183953e-01   +9.207759406862647e-01   +8.839090738270532e-01   +7.923481392998837e-01   +3.659070314789519e-01; +8.477423609471505e-01   +2.281624778997103e-01   -3.402863050188336e-01   +5.622880193335528e-01   +5.823537733373059e-01   +1.773515244559492e-02   +8.330322348100080e-01   -2.078499020181869e-01   +3.624963294088070e-01   +5.310482153312663e-01   +9.537420457192177e-01   +2.727409665905350e-01; -1.520095455974627e-01   +4.944552974938771e-01   +5.580649986542742e-01   -1.658374510876611e-01   +2.484448978344596e-01   +6.558926590157154e-01   +2.880051171080048e-01   +7.144010062140933e-01   +2.107932665208877e-01   +7.601664485563053e-01   -3.379107956861989e-01   +2.021861035449236e-01; +7.713641525559238e-01   -1.224488342952345e-01   +8.031885459230458e-02   +1.777208353605672e-01   +5.155987282335434e-01   -2.411676694544995e-01   +7.230236481845285e-01   +6.376923339478732e-01   +4.906578777207830e-02   +6.977807062662764e-01   +4.586999111043987e-01   +1.857981861546538e-01; +3.877280854801805e-01   -1.462615373994474e-01   +5.001113757634762e-01   +2.304329610568129e-01   +3.383140691603114e-01   +7.080793854921180e-01   +3.457392462546801e-01   +3.086241216485946e-01   +6.751805190918740e-01   +4.950140046261454e-01   +7.587600848482715e-03   +6.347708254036769e-01; +7.935632183127874e-01   +4.364913640386405e-01   -2.745722095397932e-01   -1.520863068991813e-02   +7.966637174953440e-01   +5.446708263990622e-01   +2.835867672364915e-01   +6.582221447757889e-01   +3.482681263226495e-01   +2.988543011830798e-01   -3.509203106638315e-01   +5.690595107218350e-01; -4.346964595775689e-01   -2.590140509836245e-01   +1.897105007365006e-01   -1.440012549226335e-01   +2.903112778443849e-01   -4.152130563003580e-01   +1.697691487697560e-01   +1.048263082206777e-03   +3.811930727092477e-01   +4.031143515238944e-01   +6.018161434652756e-01   +6.773447259287724e-01];
L2E_Input1_iAMPA_netcon = [+7.171670904011214e-01   +4.422201245910402e-01   -4.035848576105878e-01   -2.950204513007900e-01   +5.087571948809482e-01   +4.073516132126642e-01   +1.000000000000000e+00   +2.908867629036120e-01];
L2I_Input2_iAMPA_netcon = [+2.157511298301372e-01   +3.073203903331673e-01   +6.040577143576694e-02   -1.104610059957527e-01   -2.293552735783044e-02   +3.285296224892940e-01   +6.499878287576488e-02   +9.102104253332881e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
