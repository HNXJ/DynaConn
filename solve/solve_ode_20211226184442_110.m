function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.747983359195521e-01   +5.866788028034856e-01   -3.485310057733721e-01   +2.882563858175332e-01   +7.540918648004643e-01   -4.938446991859099e-01   +6.849930511536814e-01   +2.730908075647155e-01   +6.216214703411373e-01   -7.475905636018826e-02   -1.138370346758896e-01   +4.560929615618298e-01   +4.643917007033568e-03   -1.847897388789361e-01   +6.747423276529697e-02   +6.184465152459357e-01; -3.070089781132007e-01   -5.562232542273545e-01   -2.987769279341424e-01   +2.478358434608147e-02   -1.736679728721741e-01   -7.171404055552741e-01   -6.747334935208328e-01   -6.523725183773220e-01   +3.592247036812605e-02   -1.089203503401864e-01   +2.172026474827067e-02   +4.790453165394377e-01   -5.253293481804295e-01   -1.396854434440552e-01   -4.246506801227481e-01   -7.556750155538207e-02; +6.212447818437249e-02   +2.392555115526302e-01   -3.371776301454548e-01   -3.691983027465878e-01   +7.207563269457407e-01   +7.549320015542674e-01   +3.269968538891479e-01   +5.251516878002090e-01   -6.667383690864093e-02   -1.265625804272106e-01   -6.499982034004288e-01   -6.987925712962941e-01   +6.022201015545876e-01   +4.483322908885387e-01   -1.760684944113233e-01   -1.465945263253491e-02; +1.414360796072620e-01   +5.485696272222659e-01   -2.936326523016305e-01   +4.493898791945210e-01   +3.231318325816812e-01   -1.059587810312550e-01   -2.057318432228772e-01   -3.911177852793497e-01   -4.943623707568376e-01   -1.929615663970647e-01   -1.000000000000000e+00   -5.231934574246677e-01   -4.567785462819234e-01   +1.262321553958056e-01   +6.531951267620084e-01   -4.791988556355881e-02; +4.803999475830651e-01   +1.143292339973855e-01   -5.948762706565587e-01   -1.281892080884195e-01   -2.613719361214009e-01   -6.381209187568315e-01   +3.630866356795627e-01   -1.486508201750225e-01   -6.142131170946423e-02   +6.709113219050459e-01   +3.322893398387649e-01   +3.919785421384673e-01   +6.433707055405320e-01   +6.387558860070508e-01   -1.619820274974824e-01   +5.265936938913073e-01; -2.504691938882171e-01   -7.086939266114560e-01   -2.109864887798417e-01   -5.152749127552202e-01   +4.908740443329974e-02   +9.618444501015920e-02   +2.032259827067482e-01   +4.957514760341751e-01   -4.532169680027524e-02   -6.492139051350734e-01   -9.310958004205444e-03   +4.566687315653042e-01   -2.037602802067274e-01   +4.367852382773454e-02   +9.600057823227971e-02   -2.419373914239946e-01; -1.447193890067615e-02   +1.497517630794089e-02   -7.386602312741772e-02   -8.536338450650320e-02   -5.706273521459618e-01   +1.062629744707763e-01   -1.834610246661330e-01   +1.297890487710485e-02   -6.493191605461414e-01   -8.197733857021129e-01   +5.222151636269041e-01   -8.081469004874915e-01   +7.511523622103273e-01   -4.869147865798804e-01   -4.002983767117483e-01   -2.937961976430352e-02; -5.593935081559683e-01   +7.102740928803544e-03   +7.321244906226047e-01   +7.827611278785818e-01   +2.301364173968034e-01   +1.579069639377341e-01   +4.445039175058192e-01   +2.750313708807668e-01   -4.129881382927680e-01   +6.240540528281748e-01   +4.347717968441616e-01   +1.634322486285328e-01   -6.805884243874478e-02   +2.959162779202425e-02   -2.028568007404580e-01   +1.141448137319373e-01; +2.216135740898945e-01   +1.310080277524817e-01   -8.485611471826482e-02   +3.051078112733440e-01   -1.724602782374337e-01   +1.597316454900523e-01   -1.990591019812440e-01   -8.059535208065454e-01   -3.842386321831043e-01   +6.169419957673788e-01   -7.660419086842976e-01   -8.849096313425413e-02   +4.653047484638971e-01   +1.535417836893150e-02   -4.928096299557067e-02   +2.572582997415084e-01; +3.155077204108819e-02   +2.879292983781523e-01   +1.910491949154544e-01   +2.561137364524341e-01   +5.525025423931341e-01   +7.042419562841811e-01   -1.565456481953611e-02   +5.083294272167432e-01   +3.473945607798646e-01   -6.354703787154510e-01   -4.128579317290272e-01   +4.173636238710729e-01   -1.986941417080431e-01   -1.476735394857899e-01   +7.285963645898494e-02   -4.448959409489986e-01; +1.422812175840081e-01   -4.733286063615422e-01   -5.767686016867738e-01   -1.184403871028756e-01   -4.486818519572956e-01   -3.137915636600161e-01   +4.974115259790164e-01   -4.978493468516122e-01   -6.923398058289167e-01   +2.303381313502522e-01   -3.136240618408939e-01   +6.452231386104285e-01   -1.772511719146153e-01   +4.008695765504698e-01   +7.730335262966115e-01   -4.576073015143411e-01; +7.357496510239475e-01   -6.076517953859565e-01   +6.011259699153824e-01   -7.315259754564436e-02   +1.025443402756606e-01   +6.270564587577236e-01   +2.243858968281561e-01   +7.531294515460299e-01   -5.915728876645840e-01   -7.199947614322714e-01   -6.572504542080364e-01   -1.461225242678801e-02   +5.526395949865435e-01   -3.469040999260417e-01   -5.066692515365362e-01   -4.614712023529433e-01; -3.507152576540312e-01   -3.167586075632851e-01   -6.278076627982652e-01   -7.248824807795521e-01   +6.632904995656720e-01   -4.227363961385982e-01   +1.958280059556320e-01   +5.470426141922435e-01   +4.080262039521364e-01   +3.099916059187391e-01   -2.997860461830497e-01   +3.490590573831548e-01   -5.441651049045944e-01   -5.115860529167174e-01   +3.931621199219931e-01   +3.645886431820667e-02; +5.115792759823934e-01   -1.784617566599543e-01   -6.836714342637950e-01   -4.280073742728746e-01   -8.162821610999156e-01   -2.809713880488195e-01   +1.196791438713196e-01   -2.803197068270886e-01   +2.983661828933242e-01   +3.547269082773229e-01   -4.195095804124051e-01   -1.587142086980118e-01   -4.755508888531513e-01   +4.499572757926434e-01   +6.415266426125377e-01   -2.978779469734639e-01; +3.353239402318329e-01   -3.276601820771138e-01   +6.684642651028316e-01   -6.653109246964899e-02   +1.192843204887075e-01   -1.186212562925406e-01   -3.083670617088974e-01   +2.886331839469095e-01   -9.548637685375098e-01   -6.133063983319713e-01   -3.398918043032554e-02   -1.276696616953895e-01   +1.225881902970502e-01   +2.238400663357652e-01   -8.069199474510080e-01   +5.515792550002051e-01; -7.018464759311234e-01   -3.040243766459475e-01   +4.602240674882406e-01   +1.439790448755149e-01   +3.122881393205871e-01   -1.863827828550133e-01   +5.257128574612807e-01   -5.519258090118082e-01   +1.935038552965112e-01   -3.255430365277006e-01   -3.368005075201542e-01   +6.534850990475914e-01   -2.092894049231105e-01   -8.095030449129383e-01   -1.454411864912624e-01   +5.325072866136277e-01];
L1E_L1I_iGABA_netcon = [+3.219431000215076e-02   -3.990382834337595e-01   +4.527933622031986e-02   -1.830870368956066e-01   -8.526689852501081e-01   +5.820796631761398e-01   +7.469552413784766e-01   +3.116501058473957e-01   +1.909660808985602e-01   +1.927802230795888e-01   +7.116192015299815e-02   +5.352464301364321e-01   +1.055274296698723e-01   +3.362588304741337e-01   -5.153288505068531e-01   +5.557628405797914e-01; +8.605659242296361e-01   +8.667574339135611e-01   +1.908720710507548e-01   +3.930821042450682e-01   +6.111512266174941e-01   +1.324193401444869e-01   -1.667412640620985e-01   -6.529319395336105e-01   -3.298364221177584e-01   +4.068946991622847e-01   +5.770784764501450e-01   -4.252590231711714e-01   -9.676789509050954e-01   +2.434761658432872e-01   +4.759520850754272e-01   +8.307449089177583e-02; -3.946290351977585e-02   -6.892642729842512e-01   +2.940526139004228e-01   -8.263762268771220e-01   -7.154312800806513e-01   -4.789442968758138e-02   +3.114862457997687e-01   +6.195998277213728e-01   +7.802890914930277e-01   -2.061701043911339e-01   +4.170117099084626e-01   +7.802700294191406e-01   +4.236703847715857e-01   -5.628068175268330e-01   -7.679926669417476e-01   +4.753469481177068e-01; +4.514139892621443e-01   +7.650688994040793e-01   -3.470973233984220e-01   -3.936365848926738e-02   +7.099982749645154e-01   -1.727722095266664e-01   -3.177902633116346e-01   -9.836429012889508e-03   +3.357201637199061e-01   +6.060365177990849e-01   +4.293414106355395e-01   +7.238920085225284e-01   -3.906123646602782e-01   -3.417451920487429e-01   +2.914950421485252e-01   -5.716947695250513e-01; +2.636926306675789e-01   +4.049536561192777e-01   -7.343377362606948e-01   +8.533978980987672e-01   +2.584190418360554e-01   +9.197837803608774e-01   -3.764272184790821e-02   -5.739322489811410e-01   -1.956561945890299e-01   +1.709213705366220e-01   -9.127637557612922e-02   +6.331652755899210e-01   +5.122035491222010e-01   -8.227416658579617e-01   -7.634525679478221e-01   -7.236343723090473e-01; -2.320788863364392e-01   +6.664542101066927e-01   +2.576333342093343e-01   +5.394424628438619e-01   -7.068892111098887e-01   -1.757226989998128e-01   -5.346110010723969e-01   -6.601892304497070e-01   +8.067436352437620e-01   +6.078779027372890e-01   -5.557600683716402e-01   +7.526244632741014e-01   +1.084229067005416e-02   +2.650374756929988e-01   +4.787944761434522e-01   +4.215957862996117e-01; -4.959356296182868e-01   +2.019523369577647e-02   +3.707693501292499e-01   +3.503921102062567e-02   +5.197924442302113e-01   +5.443242396268997e-01   +3.495428088896969e-01   +5.708226007627761e-01   +2.825157237640633e-02   -2.214410100664213e-01   +6.705262858384285e-01   +4.916583077303467e-01   -8.216753402478680e-01   +8.780097729998985e-01   -9.133026136815178e-01   +6.154982012203377e-01; -1.345241543229884e-01   -3.478961393815964e-01   +6.313543906968522e-01   +5.040947511945112e-01   -4.467524915269348e-01   +8.606765933791302e-01   -6.909665035612668e-01   +8.634233620206654e-01   +9.978621890261014e-01   -2.867708032400415e-01   +4.040409055183214e-01   -1.429656056720432e-01   -6.300739052983932e-01   +3.725438156370992e-01   -3.882051092766241e-01   -4.410176199457162e-01; -3.716955035460493e-01   -1.480488577027865e-01   +6.752504693666711e-01   -3.871072591335236e-01   -2.012129189749801e-02   -2.553882523523701e-01   -8.778035240100333e-01   +4.093472596873431e-01   +2.938745935891091e-02   +2.205860086612014e-01   +9.264597227539124e-02   +7.806653836550996e-01   +3.810093119530128e-01   +4.244560783330070e-02   +6.471561151795093e-01   +9.030888088968535e-02; -5.298534749564500e-01   +5.037104246354700e-01   +2.729814248639772e-01   -2.477911094449618e-01   +3.544546855623329e-01   +4.622249045618146e-01   -4.917344220158483e-01   -7.079738985426935e-01   -5.612570644992553e-01   +1.498632484698153e-01   +2.597871788762715e-01   -5.724063212090156e-01   -1.771765957992383e-01   -2.449640194105023e-01   +7.571420469981266e-01   -1.580015425822311e-01; -3.265605114415938e-01   -1.188257161924158e-01   -1.408028874795051e-01   +8.801023029105255e-01   -7.979598288544847e-01   -1.740783430248271e-01   +3.038571054403270e-01   +3.683429133408007e-01   +4.167259653222042e-01   -2.844960490334459e-01   -2.059029269647983e-01   +8.476241887967770e-01   -6.493347212098536e-01   -3.437773016217742e-01   -3.376319698908594e-01   -6.721974167723606e-01; -3.572640063865209e-01   -6.233003307656247e-01   -8.148753550590386e-01   +8.565214484340278e-01   +1.104280381767951e-01   +3.219581160363564e-01   -8.689259021246953e-01   +2.715658670182670e-01   +4.528425786766984e-01   -6.475286401902738e-01   +9.098365187642777e-01   -7.492712783539903e-01   -8.128191898286830e-01   -5.307310628671675e-01   +2.088326052506582e-01   -2.189084121223873e-01; -7.198208401642289e-01   +8.842699641127602e-01   -3.093279242122542e-01   +3.965242567949132e-01   +4.757049469051666e-01   +4.912949967836026e-01   +3.190176918931529e-01   -2.858778322318289e-02   +8.722966064351981e-01   -9.358114387734220e-01   -7.703054233362313e-01   +4.910635131790930e-01   -3.173767944291223e-01   -6.112464775078347e-01   -1.343355479732666e-01   -1.694422708038660e-01; +1.251597551882233e-01   +6.727236372657258e-01   +4.985118181458619e-01   -3.468922587451353e-01   -4.541940453510294e-01   +2.898766064045434e-01   -2.732005353972312e-01   +6.122287064393086e-01   -5.848957492191121e-01   -7.098837708146591e-01   -6.821007355755558e-01   +2.868211950209515e-01   +4.071597267119382e-01   -6.704873886368725e-01   +2.694163679954383e-01   +4.505668632670996e-01; -4.665805852043869e-01   +1.000000000000000e+00   -4.409437394035625e-01   +5.400445407467278e-02   -4.869297746399396e-01   -7.561579047591761e-01   -3.273836959850160e-01   -1.654322754192233e-01   +2.460114157838380e-01   -7.636006058241924e-01   +3.399011011869861e-01   +4.336719530929256e-01   +3.557907969406547e-01   -1.712434605394436e-01   +1.162898437091582e-02   -4.278922650008726e-03; -9.089294889724744e-02   -6.621774962779807e-01   -6.712447086987331e-01   +1.126962274096633e-01   +6.790100464268665e-02   -5.816491896805583e-01   +1.315259860064427e-01   +8.121296164289130e-01   -8.028530764928385e-01   -9.246600350952818e-01   +6.656598910580758e-01   -6.514250282524905e-01   -8.433945714854347e-01   -6.088827534353924e-01   +1.187784473026832e-01   -3.689180886369642e-01];
L2I_L1I_iGABA_netcon = [+5.225544012616991e-01   -1.838169811726935e-01   -8.856178758257053e-01   +7.464743671207406e-01   +6.446090094017810e-01   -2.895987790747028e-01   +2.889517570606332e-01   +4.074713986991793e-01; +4.971273447160920e-02   -2.934276040839451e-01   +7.360304215244243e-01   +2.598908001472113e-01   -6.662238532708219e-01   +4.406092625318678e-01   +6.283337191754077e-01   -5.027356932458468e-01; +1.988900998919467e-01   -2.269824084499930e-01   +7.781348445841140e-01   -1.502971020505127e-01   +7.782140394492534e-01   +2.923658422912228e-01   +1.971131755631411e-01   +3.720055177229445e-01; +2.312856650418483e-02   -4.596949814988247e-01   -1.994883055461068e-01   +1.723720881964081e-01   +4.416745874181378e-01   -5.378946623492165e-01   -5.179428244032968e-02   +1.139061357643257e-01; -5.522077096760876e-01   +3.680085338948453e-01   -4.399775805358146e-01   -1.139753052217993e-01   -5.846769778511541e-01   +6.041889262650290e-01   -1.689079475850250e-01   +8.901096056833796e-01; +5.340314944383804e-01   +3.492656013007868e-01   -1.467962805321206e-01   -2.089912898436886e-02   -3.852665414875908e-01   +4.090335069485795e-01   -8.230167156624782e-01   -8.223133535135111e-01; +4.549522318638199e-01   +3.791267111143900e-01   +1.253031206153821e-02   +4.779514519690641e-01   -2.732758017089978e-01   +6.916828570462931e-01   +5.060974976534838e-02   -6.493353836615519e-01; +6.674711457907742e-01   -8.261512682838561e-01   -4.344895267623006e-01   -4.271105740095838e-01   +5.558853040627170e-01   -7.852350427176765e-01   -6.163539108763160e-01   +1.000000000000000e+00; -6.636562713750166e-01   -4.476452103924310e-01   -3.687987531879859e-01   +1.658448745391520e-01   -2.601008328399342e-01   +2.051682145328306e-01   -5.246420163850070e-01   -3.014911818739914e-01; +1.379890285337413e-01   -3.231767957982284e-01   +7.249445436731532e-01   -6.254585706271326e-01   -3.681257487960304e-01   -1.335630637082014e-01   -1.427199692150763e-01   +1.261723861073935e-01; +9.767066627595629e-01   -2.766326176263801e-02   -8.453944909783376e-01   +1.220097877871376e-01   +3.462191779521438e-01   +2.071819818039798e-01   -6.553359293504496e-01   -5.037930827504863e-01; +5.155915550933522e-01   +2.086367162271348e-01   -1.702410417464617e-01   -1.749970569838498e-01   +4.980000378175235e-01   +3.655562677887528e-01   -7.461004845396134e-01   +1.358249483165006e-01; -6.594120279311565e-01   +2.076690780104329e-01   +1.495936356833091e-01   -9.408508025084051e-01   -4.833213938664270e-01   +2.922206721337653e-01   +5.749686537611008e-01   +8.989990100936446e-01; +6.601629124494657e-02   +2.279364649025261e-01   -7.023341786982381e-01   -6.114979452518402e-01   +2.418095987112086e-01   -6.450111543055753e-01   -2.195632628907756e-01   +4.675351209531666e-01; -8.883147901997965e-02   +5.741609752034089e-01   +5.178571858224511e-01   +6.944074196959649e-02   -5.191252998261919e-01   -3.580194763061150e-01   +6.648790252954775e-01   +5.811179552595387e-01; +1.637280632400587e-01   +5.655775087578091e-01   +6.163133116744709e-01   -3.613007594842285e-01   -7.598948508953843e-01   +5.494387562297266e-01   -3.404828565505580e-01   +8.342300201118867e-01];
L1I_L2I_iGABA_netcon = [+2.331285393662842e-01   +5.169721024085265e-01   +7.528784369416062e-01   +5.536310973068543e-03   +9.458518636841677e-03   +3.802254301612703e-02   -6.161525101386334e-01   +2.762472406862255e-01   +3.236176588679067e-01   -8.617044449155037e-01   +3.356945007781131e-01   +8.824447549046134e-01   -6.488672227786666e-01   -2.242363485008986e-01   +5.897097569579951e-01   -3.493930084605167e-01; -5.188112930887520e-01   -2.288834258079210e-01   +3.379083591923623e-01   -2.118199213727940e-01   -8.892846982016395e-01   +6.547725785066382e-01   -3.960186548561886e-02   +4.339031001038413e-01   +7.535364083965302e-01   -7.951612315804920e-01   -4.302986519080700e-01   -9.295332091550962e-01   +6.329221674642740e-02   +6.460127997786244e-01   +4.528334804567963e-01   +6.455858755085043e-01; -6.526720062479195e-01   -7.010481854960527e-01   +1.215485923542813e-02   -2.638364640349141e-01   +7.352670478577492e-02   +1.423185870379025e-01   +8.982810587829836e-02   +6.861233891743477e-01   -4.154142427011568e-01   +4.464888920973724e-01   +3.521340558941813e-01   -5.878722421797886e-02   -1.032813552195056e-01   -4.608644943040943e-01   +1.000000000000000e+00   +4.194360873009167e-01; +2.082169494598529e-01   -2.188025156968762e-02   +1.535880212687339e-01   -7.154894577850524e-01   -4.774985328802434e-02   +7.451064029725478e-01   +7.765720217289784e-01   -1.574157150699993e-03   -5.588528789951671e-01   -2.664561594989206e-01   +5.595002313479129e-01   -5.555259872035521e-01   +1.818184231048081e-01   -2.372721851281341e-03   +5.535256019083862e-02   +8.459342475504309e-01; +8.606115526118398e-02   +2.888435381844048e-01   +8.512952560102457e-02   +8.898177464097209e-01   -9.108245844165597e-01   -6.308009095386021e-01   +1.491500411798298e-01   +8.109843094916589e-01   +4.737542964886785e-02   -1.171448171537803e-01   -6.190197027189748e-01   +7.509382722791342e-01   +1.274414946101836e-01   +7.405428498318224e-01   -2.822733031813107e-01   +5.793768585124232e-01; +2.540803105902846e-01   +4.068536210771277e-01   -4.597397447384091e-01   -3.508398519684623e-01   -5.495982161822771e-01   -5.443068828881845e-01   -3.676751117902457e-01   -5.223612367616023e-01   +4.756676785826279e-01   -1.212433491007084e-01   +6.151018034545908e-01   -5.843414314743884e-01   -6.529915534967019e-01   -8.441465977551098e-01   -3.074299553478372e-02   +7.757921894270232e-01; +4.445467248004831e-01   +7.984674955461866e-01   +4.822342621563576e-01   -3.242423017921494e-01   +3.149290998761326e-01   -1.631839124812618e-01   +6.201511199391572e-01   -5.546833821333923e-01   -6.496548795273236e-01   +3.124279410861160e-01   -3.830580950824755e-01   +1.587669093789171e-01   -2.451393534471007e-01   -2.427338686997241e-01   -8.033152396716188e-01   +3.500117725351496e-01; -8.567558490222638e-01   -6.779740850604121e-01   +4.523003690803717e-01   -4.979144268209040e-01   +1.300564513592290e-01   -1.010059969968078e-01   -1.589466145277913e-01   +2.221623568039239e-01   -7.325330425809585e-01   -5.506932874897712e-01   -2.621140887167916e-01   -1.861834398285469e-03   -1.466365373171763e-01   +2.309604928144768e-01   -4.990661890211491e-01   -2.948453244743137e-01];
L2E_L1E_iAMPA_netcon = [+1.967629536220145e-01   -3.551551586208602e-01   +8.002704469178489e-01   -3.314497260619010e-01   -3.687288835464369e-01   -3.791820103862127e-01   +2.669992661826168e-01   -7.484711422965528e-01; +1.000000000000000e+00   -1.108295323806681e-01   -6.245890996303420e-01   -2.000046054764647e-01   -2.763048977143249e-01   +6.158656054651238e-01   +6.725855422046175e-01   -2.909826852853780e-01; -7.099449345649702e-01   -8.489980382629715e-01   +5.679292875884807e-01   +6.222305469723822e-01   -4.261671173515570e-02   -5.347571941527980e-01   +3.137149239288283e-01   -2.466277975162577e-01; -6.092269189449676e-01   +7.085025986363466e-01   +5.619653209428482e-01   -5.412990788402342e-01   +8.303481496373908e-01   -4.646883435678250e-01   +3.219074692125901e-01   +6.633718678523051e-01; -7.163459178796736e-01   -1.070357787370411e-01   -4.540848847560921e-01   -6.466202670138996e-01   -3.471805306422306e-01   +4.907247551975870e-03   +2.102738703785134e-01   -7.082922068260171e-01; +1.861754069774393e-01   -7.006848881625326e-01   -5.078313303423911e-02   +5.545516979185955e-01   +9.763512029645997e-01   -3.424963035572903e-01   -6.496220136820756e-01   +5.105872477089364e-01; -3.682943384353232e-01   +1.644866140516386e-01   +3.242801108546977e-01   +7.631308004348436e-01   +4.513727705917499e-01   +1.013454041388718e-01   -6.452890268028089e-01   -5.336284283293012e-01; -6.101246514355448e-01   +6.284591583848148e-01   -8.991845328794481e-01   +1.535678828826438e-01   +3.831972212426151e-01   +4.951739714934886e-01   +1.871386456815416e-03   +5.884593940515076e-01; -7.044866727502558e-01   -3.506082929522645e-01   +4.059073004569519e-01   +3.147027353716890e-01   -6.486444884541412e-01   -1.674505092005867e-01   -3.720174232431128e-01   -6.350187502108491e-01; +4.536524839589247e-01   -4.410420195399312e-02   +3.792654767255418e-01   +5.842810640403645e-01   -2.959256447581495e-01   +5.174765820301712e-01   +3.340706885219188e-02   -8.927371646878887e-01; +6.483694304085015e-01   -4.901984483173698e-01   -3.132072831313010e-01   -1.315896336609502e-01   -3.306258428365949e-01   +3.652495270838433e-01   -6.943365889310731e-01   +1.591147924539580e-01; +2.721469421520835e-01   -7.960576992670071e-01   +2.284426108318825e-01   +2.553856673694216e-01   +6.199025168398581e-01   -1.418304508558444e-01   -2.026490530536354e-01   -4.216345958821281e-01; +8.374958400370406e-01   +6.188812258912116e-01   +2.730439611306712e-01   +5.323654965631106e-01   +2.165305303130762e-02   +7.206557009321969e-01   -2.570767994781232e-02   -2.138435180351327e-01; -3.494859694361768e-01   -7.405476758248379e-02   +2.406391079404610e-01   -8.390143841829661e-01   +4.886594890637008e-01   +3.199643196828461e-02   +5.273181502485825e-01   -6.927618456541489e-02; -6.096432008725560e-01   -8.960930139076903e-01   -5.362793349483985e-01   -3.908817936384550e-01   +4.879364987856417e-01   +2.745330008244649e-01   +2.514800079973191e-01   -9.613655128343686e-01; -2.872082998031278e-01   +8.036988016059208e-01   +7.163298911608741e-02   +8.215115035464186e-01   +9.587918781145129e-01   -7.295373352653316e-01   +2.768491797232924e-01   -7.860527972843010e-01];
L1E_L2E_iAMPA_netcon = [-8.263438099684242e-01   +2.825965607881731e-01   -5.896302919113344e-01   +5.692663219480935e-01   -1.274778251182610e-01   +8.431307038734505e-01   +3.765522355517920e-01   +6.173839283327305e-01   -5.988525611644772e-02   -1.704521634374170e-01   -1.663332647749331e-01   +2.127785264558701e-01   -2.510941162424553e-01   -9.180221247382544e-01   +2.898330941010867e-01   -4.987675141119295e-01; +1.829915896211072e-01   +2.787846610917471e-01   -5.166980592379447e-01   -5.247153499691406e-02   +1.622574939304168e-01   -2.670352931067858e-01   +6.605140064841992e-01   -6.575404552361655e-02   -3.739574951149666e-01   +4.872050216507973e-01   -1.434390601474735e-01   -5.662665060174273e-01   -5.447579414807571e-02   -3.729207319939536e-01   -1.627261839333055e-02   +2.257154844848316e-02; -1.253169560402209e-01   +7.825827999489771e-01   +7.198141124214028e-01   -6.442498119032658e-01   -2.148237278303212e-01   +7.228684150927023e-01   +8.086285182607834e-01   -7.710270437473670e-01   +4.638904794509667e-02   -1.279240316531845e-01   -1.833730101364810e-01   +1.812352738893639e-01   +7.389461785491385e-01   +1.719021944878837e-01   -1.338249437427453e-01   -2.327481748636226e-01; -5.204012755129540e-02   -1.297252849761907e-01   +1.277483469304271e-01   +8.186500202548463e-01   +3.464901969094603e-01   -4.795630594331294e-01   -4.853347969333154e-01   -4.790646491214611e-01   -4.468668515288787e-01   +7.632809779933324e-01   +5.028733324545826e-02   -7.310425759097371e-01   +5.261957391598585e-02   +5.704732694550219e-01   -6.932644064161270e-02   -1.073887504746121e-01; +6.735202063263424e-01   -5.796253511396505e-01   -3.686603718428618e-02   -7.791973936957324e-01   +1.833356776751513e-01   -2.823460305428107e-01   +4.177944859821072e-01   -1.427608000906238e-01   -6.451434887244853e-01   -1.247433396906614e-01   -6.917421754625115e-01   -6.628804238413629e-01   -8.019833090659008e-01   +2.954201695758403e-01   -5.540061013541793e-01   -6.786999688422046e-01; -8.905163096756459e-02   -4.536065804230788e-01   -1.862638362473084e-01   -7.133023794299591e-02   -7.679538853216711e-01   -2.648168768277160e-01   -3.304804744208164e-01   +2.363071049774382e-01   -9.724217171779829e-01   -1.005797727605645e-01   +1.257946920180853e-02   -2.515118659568212e-01   +7.601830355563260e-01   +9.358509277593229e-01   +5.816265871477139e-02   -5.474510354725508e-01; +6.884507110041030e-01   +1.000000000000000e+00   +8.098842740774400e-03   -3.960261941866127e-01   +5.666517772078770e-02   -2.673334660821818e-01   +6.801629065700976e-03   -2.633157542215646e-01   -7.326342695136312e-01   +7.500783805091099e-01   +3.191558136395133e-01   -4.704444318828268e-01   -2.672640290771699e-02   +6.258504767842531e-02   +5.620313596239312e-01   -5.370990786418766e-02; +2.261673029606318e-01   -5.781427895983029e-01   +5.178256693113226e-01   -4.193515660861744e-01   -3.211751661732298e-01   -3.208680586525141e-01   -2.216286753212378e-02   -4.049052470004671e-01   +2.881788724619110e-01   -5.871292734169938e-01   -5.145795985339648e-02   +5.847931275826991e-01   +1.574847647109927e-01   +5.767002590406527e-01   -8.079936185351250e-01   +6.290256682986368e-02];
L2I_L2E_iAMPA_netcon = [-1.761529856517001e-01   -4.943807490716134e-01   +2.541031989802672e-01   -1.361802312603133e-01   +2.645870579294349e-02   +4.326641599410757e-01   -5.645290708213272e-01   -7.786798102446576e-01; -6.595282346955433e-01   +3.927737638253127e-01   -1.940657084706726e-01   +2.821513827211628e-01   -4.986719722241228e-01   -6.209859705333484e-01   +3.277282186622659e-02   -4.484952764567703e-01; -1.961520850154491e-01   -6.098772186437138e-03   +5.546282178933343e-01   +6.199043399735465e-01   +2.872850629915827e-01   -7.264309682639791e-01   +7.900065161793238e-01   +2.506912769961290e-01; +8.060714665533542e-01   -4.394330132498233e-01   +5.352693021185490e-01   -3.350522223903524e-01   +7.682497191146745e-01   -7.320961742667040e-01   -4.310252279882368e-01   +6.082321521779829e-01; -2.657550183233296e-02   +6.036242048382181e-01   -6.873073238993815e-02   -3.877832037924099e-01   -7.625879897330503e-01   +6.292741869655171e-01   -9.012430178418376e-01   -8.542928823245463e-01; -1.426738296863918e-01   -1.409470895107124e-01   -5.056670485975798e-01   +3.540797712987327e-01   +4.261022497123065e-01   +1.000000000000000e+00   -7.157487143645663e-03   -4.196893945730275e-02; -7.200163446433785e-02   -1.064952362164339e-01   +3.166903712949306e-01   -4.724850186964507e-01   -9.192357836371864e-01   -6.008793303104809e-01   +1.835564049387420e-01   +1.026404738026630e-02; -6.188992671678494e-01   +9.851438994820471e-01   +9.041148482374600e-01   +2.891622896503542e-01   +2.394826306738392e-02   -4.751383730651003e-01   -4.537739030967988e-01   -8.752875494269049e-01];
L2E_L2I_iGABA_netcon = [+1.937328890160845e-01   +3.001909429962490e-01   +9.482620173445068e-01   +4.889489794671323e-02   -6.806041741313881e-01   +7.166263846079957e-01   -4.739486772234374e-01   -5.337311217107249e-01; +1.772847935648073e-01   -3.343846301989926e-01   -4.230522012977162e-01   -2.346590419980524e-01   +9.410195905797770e-01   +9.318030296502431e-01   -2.529786593290221e-02   -3.724873914101046e-01; +1.094322398895650e-01   -6.388514736193956e-01   +2.165963066340811e-01   -3.091323641323704e-01   -4.677338544990329e-01   -3.912005274339675e-01   +6.530812745987210e-01   -2.889480663189686e-01; -7.648174008127039e-01   +6.790446451662429e-01   +7.698313706859333e-01   -3.120752897713359e-01   -3.208640480209549e-01   -4.354693039028243e-01   -5.990854145327723e-01   +5.708531831555056e-01; -2.052655237898274e-01   -2.089134871703129e-01   +1.250655023898856e-02   +4.600849174396122e-01   -3.090196541212974e-01   +7.160128047463823e-01   -9.046840247880104e-01   -4.196261953950524e-01; +1.491276531931460e-01   -4.960008673621697e-01   -7.034857290179078e-01   +8.129156853404544e-02   +8.043443618242139e-01   +2.718152865667008e-01   +7.113395227112465e-01   +5.583463931252652e-01; -5.763526313651893e-01   +9.063696420312494e-01   +2.153415347501583e-01   +2.662399581527014e-01   -9.987522276767154e-02   -3.013167973999683e-01   -8.008058615848782e-02   -1.000000000000000e+00; +7.835576797506233e-01   +2.776280484247314e-01   +3.308620999922895e-01   -1.798614052753366e-01   -9.619927061590249e-01   +3.350320016511676e-01   +9.036087417003801e-01   -6.200573059844722e-01];
L3E_L2E_iAMPA_netcon = [+3.260875501990457e-01   +2.045119934857294e-01   -3.050133042958539e-01   +5.046616471992066e-01   +9.299782552845549e-01   -4.436078982227297e-01   -2.234383246596569e-01   -3.519809541059064e-01   +7.728455666951478e-01   +1.011746329081861e-01   +6.391300109796669e-01   -9.407730719397493e-02; +3.746226103861487e-01   -3.002972615745700e-01   +1.326186277626733e-01   +1.881928985110764e-01   -7.775173858541508e-01   -4.505899574439772e-01   -8.119441762653233e-01   +5.097853352632215e-01   -6.704930967252837e-01   -6.660216762968858e-01   -7.306071741841190e-01   -2.251304297167867e-01; -1.413134937147010e-01   +5.958006551321459e-01   -1.370761528068893e-01   +9.433973071975101e-02   -5.632065518217997e-01   -2.661062432418381e-01   -7.633007356658362e-01   +1.521586941165058e-01   -4.605514117636887e-01   +7.021476550069419e-01   -6.762663345963937e-01   +3.641876024704833e-01; +6.370063717946758e-01   +6.931088537564526e-01   -5.351633300762565e-01   +6.493548243789064e-02   +2.448796003898328e-01   -1.833415553145767e-02   +5.684527206392940e-01   +4.920247456518878e-01   -1.842027182056061e-01   +6.032495942393966e-01   +6.058548740680595e-01   -4.097277863685707e-01; +4.971933730308489e-01   +4.614702146821559e-01   +2.221004645254422e-01   -7.775741557302082e-01   +2.360396742787916e-01   -7.780515375002114e-02   -3.512700411275272e-01   +3.181463756964931e-01   -4.117209908132749e-01   -7.351985458082851e-01   +8.322245183309797e-01   +4.438349901800259e-01; +4.660512463902501e-01   -5.434654826414701e-01   +4.146788736689176e-01   +2.327641156948194e-01   +2.182926651367461e-01   +3.361268719800688e-01   -6.692552536328132e-03   -4.258687899627067e-01   +3.058523195023766e-01   -5.751818335938380e-01   -6.485088529182917e-01   +2.545294266701887e-01; +3.141462635155818e-01   +4.863947579911821e-01   -5.392147028501836e-01   -7.781516296250369e-01   -7.880641354102726e-02   -7.655872388384320e-02   +7.493394150442882e-01   +7.644030556012243e-01   +8.522271536162712e-02   -6.163227364402517e-01   +6.063779072322739e-01   +1.796595597883690e-02; +6.205695673340629e-01   +3.159683600727964e-01   +1.000000000000000e+00   +1.267741531213265e-01   -7.694641694688108e-01   -7.777448559298564e-01   +3.051606805160455e-01   -4.160201611066537e-01   +6.793617662655832e-01   +3.979471609348832e-01   +4.888359343833220e-01   +4.500882419219462e-01];
L3I_L2I_iGABA_netcon = [-2.181691583464830e-02   +6.588278064032069e-01   -3.459940611236858e-01   +4.364243155564549e-02   +9.447800799679565e-01   -5.358051782628399e-01   +9.635236271002795e-01   +7.292774524392858e-01   +9.962359698425403e-01   +6.946289522854481e-01   -7.192865073582233e-01   +4.888649242254913e-01; -4.441384809651803e-01   -8.947975697209844e-02   -6.955897874343331e-03   -5.580258639609961e-01   -8.597502802642878e-02   -9.872971256155177e-02   +7.570252949598026e-01   -4.966711537832973e-01   -4.650039259162479e-01   +7.608188404357087e-01   -9.031809476903244e-01   +2.682924220616786e-01; -4.928362464961566e-01   -1.207815990214086e-01   -5.605149884128087e-01   +2.926707053233095e-01   -1.611720754647148e-01   -7.473155844527284e-01   -5.180575715873254e-03   -8.500310231163738e-01   +6.414916897731822e-01   -5.172851098549640e-01   +4.711082764481048e-01   -4.096313133068841e-01; -4.593047717599055e-02   -7.803815871614896e-01   +2.280616130207461e-01   +3.812287668190451e-02   -4.166976433571074e-02   -4.014036468847204e-01   +6.359422013615675e-01   +6.735838028641563e-01   +2.040844843408861e-01   -1.734910175430406e-01   +9.074852376020749e-01   +2.113517505321266e-01; -2.784951876368649e-01   -6.928689399904425e-01   +2.866904702006881e-01   -2.894283271568059e-01   -3.985869784002262e-01   +3.345225127138298e-01   +2.827839393186588e-01   -2.443427337446596e-01   +7.883216612144526e-01   +5.995963736348056e-01   +2.713663834143212e-01   -3.882123258192963e-01; +8.629780463069270e-01   -7.967346411215449e-01   +5.856107631979957e-02   -5.000913440380919e-01   +5.662922935186974e-01   +1.312988113372499e-01   +4.168194168469106e-01   -4.124818883616638e-01   +2.026133918053475e-01   +8.699802462510892e-01   -8.014024277691886e-01   -6.290587804460637e-02; +1.872537821423505e-01   +2.179748880976126e-02   -5.120628327426453e-01   +2.258840589124952e-01   +1.565990691952073e-01   -8.199475210843210e-02   -1.422549563758219e-01   +6.432290337359865e-02   +1.322920231464376e-01   +7.116447529757486e-01   +7.896638530795238e-01   +2.374000220935197e-01; +1.778182155175274e-01   -6.433897908367738e-01   -1.755612304901865e-02   +6.711764402158965e-01   -3.715113222302474e-01   +1.000000000000000e+00   -7.254770100203131e-01   -1.501832633412802e-01   -5.713715655637832e-02   -8.817277933012491e-01   +9.982295946105944e-01   -4.143118825403190e-01];
L2E_L3E_iAMPA_netcon = [-5.870431826658927e-01   -2.242557119098023e-01   +1.548577851113218e-01   -4.639394487933353e-01   +7.802308048477596e-01   +8.106361136480056e-02   -2.200823414844673e-01   +4.799238209037387e-02; -2.113012998171041e-01   -3.180870769567536e-01   -4.204886485935539e-01   +2.816044915156057e-04   +3.846887745596767e-01   -2.876229266398019e-01   +3.312065609238437e-01   +1.686907271086538e-01; -1.001367699613602e-01   -6.328973679812808e-01   -1.053142291510173e-01   -5.512162015880100e-01   -4.978663098826374e-02   +5.873487373973809e-03   -5.838505734636947e-01   +3.581166687842813e-01; -2.739247013156322e-01   -2.578845139945757e-01   -6.916898142052696e-02   +2.304322010147965e-01   +1.208871802040908e-01   +3.491541570024473e-01   +2.330269188907431e-01   +3.224391741312016e-01; +4.094253305010740e-01   +5.116019465890241e-01   -3.193155945408435e-01   -2.969810227206341e-01   -5.084428947776609e-01   -6.245629332394813e-01   +3.997220584653663e-01   -5.841726803704373e-02; +7.533199029186405e-02   -6.917835619898866e-02   +2.207177409582181e-02   +1.000000000000000e+00   -1.740606460715798e-01   -3.944473428544523e-01   -1.511696350686837e-01   +2.642753818156118e-01; -1.067222521550017e-01   -4.396830449856137e-01   +7.044107370699680e-01   -4.571154863911835e-01   -6.909982289831635e-01   -2.920288049253092e-01   -4.515916416958772e-01   +3.756215901562361e-01; +1.868154971321344e-01   -7.150532386268557e-01   +3.701309902661582e-01   +4.805481993826400e-01   +6.578659650836828e-02   +3.330672213280387e-01   +1.143298574527209e-01   -4.526776117226862e-01; -3.576953646343141e-01   +3.008504948138710e-01   -7.786974638928694e-01   +6.649057247219418e-01   +5.931940513019811e-01   +5.246882652095891e-01   -4.737200758724011e-02   -4.019563745360049e-01; +4.719691377098608e-01   -5.699079823049497e-02   -7.766232338386057e-01   +1.129979998789391e-02   +4.498088801389520e-01   -3.947339122778642e-01   -2.367234468907969e-01   -1.952874569865211e-01; -1.890600619413342e-01   -2.947544846870912e-01   -3.565344176448036e-01   +2.506905437229394e-01   +1.598197834433704e-01   +6.436341804477934e-01   +3.274563400694007e-01   +3.594906559219808e-01; +3.012606783881033e-01   +3.524924580077125e-01   -4.476447753882794e-02   -3.634231074939315e-01   +6.144828501719132e-01   +9.110015047738197e-02   +8.332010093978147e-01   -5.548398808890384e-01];
L2I_L3I_iGABA_netcon = [-5.700908689428946e-01   +8.074177541427181e-01   +6.222595440132200e-01   +4.978850232679473e-01   -3.822208717462491e-01   +2.713114362299465e-01   -5.587390347690785e-01   +3.149789092053799e-01; +5.936918659175047e-01   +5.999493178817218e-01   +3.352972165149484e-02   +1.452149908717378e-01   +8.763819268243255e-01   +5.226518587614002e-01   -7.948092876377050e-02   +7.527790124649748e-02; +5.126179537361832e-01   -1.354196001377032e-01   +3.901437526277161e-01   -2.692082755321618e-01   +2.493301443899091e-01   +2.972968630971705e-01   -1.987682539176504e-01   +6.940940376542178e-01; +4.699512894898051e-01   +4.210313275823947e-01   +5.087782887381941e-01   +7.743429929507930e-01   +2.312500507021690e-02   +5.394954543441081e-02   +5.483435362369081e-01   +8.806147418072646e-01; -5.682759056314118e-01   -3.698988393644786e-01   -3.875196931881505e-02   +1.662114000898559e-02   -2.404753801584377e-03   -5.261205122223668e-01   -8.952029898694577e-01   +1.578484583693232e-01; +4.792889813615930e-01   +6.415019412607818e-03   -7.107663012552201e-02   +4.644162952405837e-01   +9.142629800294050e-01   -1.000000000000000e+00   -3.146426415935425e-01   -3.123176995667153e-01; +5.667857339760733e-02   -2.417494909623842e-01   -3.864992131931356e-01   +2.902441686544651e-01   +5.785279029497160e-01   -7.861817718180616e-02   +5.576684572278733e-02   -2.351133810780513e-01; -3.273971208643233e-01   +4.630692255576727e-02   +1.843744123468202e-01   +4.074394674303795e-01   +3.411554409078510e-02   -3.497706238989380e-02   +8.942523355452797e-01   +7.689673581383531e-02; +7.484710858367687e-01   +1.021608056047057e-01   +6.690405304260362e-01   -6.019510801133084e-01   +4.376158680755191e-01   -4.405367204734229e-01   -6.372601734762865e-01   -9.668874922988875e-02; -6.842410587892613e-01   +1.108803964988381e-01   -4.054173375958617e-01   -7.391172151354622e-01   +6.347108127830561e-01   +6.465625025389673e-01   +2.607338165171240e-01   -8.224419724241864e-01; -6.869313670601449e-01   -6.501856489837398e-01   -3.914141983963151e-01   -2.087467333060401e-01   +3.180032477827107e-01   -1.628917554835744e-01   -5.755057921237462e-01   +4.829532742463295e-01; +1.525863983206587e-01   +5.497408147777704e-01   -2.565794466579486e-01   +3.958962436029597e-01   -2.213300840389196e-01   +7.471891009390678e-01   +2.252378730276135e-01   -5.261019068804155e-01];
L3I_L3E_iAMPA_netcon = [-1.826390634714744e-01   -3.037834745822902e-01   +4.015397564180030e-01   -8.215613752951556e-02   +2.913478101874202e-01   -2.993397365625956e-01   +7.678017819252865e-01   +1.167991010690227e-01   +7.681193226695007e-01   -6.890400829657851e-01   -8.179468199161530e-02   +6.443972289415697e-01; -1.000000000000000e+00   -1.037329819530502e-01   -3.866383124695846e-01   +6.498323886583719e-02   +6.674912531956723e-01   -5.336018966418423e-02   +1.472422806406561e-01   -1.565497226530749e-01   -4.299007869529035e-01   +5.132088221445438e-01   -4.389360047587586e-01   +2.357364439918666e-01; -5.581009305682981e-01   +5.704994259661430e-01   -5.740109997631769e-01   -3.517895175703248e-01   +2.431062536303249e-01   +4.061402820970053e-01   +2.775513797916960e-01   -5.974812454184995e-01   +4.239718099006968e-01   -5.620309254119471e-01   +3.404403681564577e-01   -5.776056769443524e-01; -9.008230915375648e-01   +3.631615435284444e-01   +1.068648762834065e-01   +5.839736579203059e-01   +4.120226624903367e-01   -6.040434714881182e-01   -5.941434531173785e-01   +7.448396439622285e-01   -1.269649114548742e-01   +2.320649933408720e-01   -7.550298083002039e-01   +5.977165355476234e-02; +7.033482870346325e-01   +8.255518699052398e-01   +5.465021106682205e-01   +4.242998445318122e-01   -2.111383238360076e-01   +2.474281614654679e-01   -3.440800057335675e-01   -1.722968507050879e-01   -2.436198091861875e-01   -5.402031415038611e-01   -1.039434364632085e-01   +8.623719140546132e-02; -6.967192322663100e-02   -3.078631706363649e-01   +5.781622945119186e-01   -2.840557855637494e-02   +6.256560431222222e-02   +4.158275052057074e-01   -8.797490940061338e-02   +5.032949555426126e-01   -4.614106757457489e-01   +7.975307076352676e-01   +4.797782405919541e-01   -9.657417251380916e-01; -6.073282597815931e-01   +2.973559606490665e-01   +2.017711599265034e-01   +9.368255136471092e-01   +5.030383266020833e-01   -5.536741278073675e-01   -4.618789424691622e-01   +1.749094881982305e-01   -1.957531540662429e-02   +2.179114256940990e-01   +2.174468670110087e-02   +7.763773952559914e-02; +2.053485398699424e-02   +6.114750834540633e-01   -3.389696671949285e-01   -8.288666879555026e-01   +6.500257107029770e-01   +7.034205011537948e-01   +3.682413872494661e-01   -5.186895162626507e-01   -2.978896609813795e-01   +3.537580208568675e-01   -3.104188812522837e-02   -4.845954116650163e-01; -4.603083821010969e-01   +3.604224868944368e-01   +1.094125344893750e-01   +3.157637233621493e-01   +1.762360164214442e-01   +2.151510905414550e-01   +3.955359031309416e-01   +4.034480548987676e-01   +1.263572303803008e-01   +2.435391811341399e-01   +1.964295388523865e-01   +8.201580074601806e-01; -1.788033883251844e-01   -3.145421354521894e-01   -2.372589022546221e-01   -4.164986998874720e-01   -3.437416382138638e-01   +7.037685384177461e-01   +7.358743067201922e-01   +3.340764025856700e-02   -7.572976831867222e-01   +5.460034585380008e-01   +5.574451111013643e-01   +2.583302077993022e-01; -1.574964527685599e-01   -6.251952628044799e-01   -5.310363778577039e-01   +8.638513846511804e-01   +5.232900431261159e-01   -1.439393917750736e-01   -5.593756130800815e-02   -2.173246677611255e-01   +1.335597359027956e-01   -3.144459378077782e-01   +4.335894119235392e-01   +4.768646230374872e-01; +3.375801963232313e-01   +6.750859632181315e-01   -1.072996678828413e-01   +1.059394780389609e-01   -4.841151465275874e-01   -2.396672863382145e-01   -3.136933289764241e-01   +3.804890392020809e-01   -8.628495598879274e-01   -4.010205132878416e-01   +7.374222614668480e-01   -5.452395750254359e-01];
L3E_L3I_iGABA_netcon = [-6.611687718511507e-01   -2.185422142167746e-01   +4.869416022055149e-01   -2.723350118902206e-01   -5.170821295551847e-01   +2.405458158691661e-01   +1.747907664229102e-01   +5.221823316329537e-01   +2.438704276477927e-01   -1.854964277661988e-01   -1.930252409603123e-01   -4.386966812344730e-01; +1.786533786029255e-01   +1.304485677698620e-01   +5.303857534362051e-01   -9.225638420686569e-01   +7.896304622949907e-01   -3.576280212017553e-01   -4.758554115275597e-01   -8.648239382387513e-01   -3.757542362158304e-01   -6.807649395945463e-02   +9.635034396198867e-02   +9.342769151096568e-02; +1.166689132290744e-01   -2.482596161130632e-01   -1.618043564998660e-01   +4.140423149423611e-01   +1.370835090820353e-01   -5.400473279361098e-02   -1.285840460435928e-01   +3.808355881403442e-01   +5.356832129485826e-01   +5.821829431492545e-02   -2.625160907668026e-02   -4.465344812608514e-01; +7.472428724160565e-01   -3.687453871683640e-02   +3.017385653084053e-01   -3.383078756957883e-01   -1.992637790864426e-02   +1.345292775430129e-01   +3.489664081135943e-01   +3.828182980475154e-01   +4.677860525197572e-01   -5.395977404345241e-01   -6.408157000267360e-01   +4.499639346964854e-01; -5.020578223086928e-01   +1.762541749447399e-01   -6.134701906152987e-01   +6.486586320793528e-01   -3.526859483595972e-01   -1.264384154995147e-01   +6.458888809393289e-02   -5.992075836702888e-01   -8.648491812472460e-01   -1.256084575243790e-01   -2.671892885413913e-01   +7.412395356859620e-01; +3.099284209213430e-01   +4.139175275637547e-01   -2.705583392423176e-01   +2.474863362047053e-01   +2.770242046086049e-01   +7.347092347348684e-02   +6.346666555764015e-01   +7.863387591959475e-01   +2.467837239141289e-01   -7.650416281026992e-01   -7.079031895732170e-01   -3.883166581455598e-01; +7.154807784335976e-01   +5.437198192148395e-01   -2.470852608460012e-01   +5.586602564922368e-01   +2.477611468993216e-01   -7.750539396650775e-01   -2.177531811524091e-01   +4.689669104751953e-01   -6.372485504344040e-01   +2.474292435031130e-02   -4.748999968705147e-01   +3.138724309155463e-01; -1.753882569259786e-01   -9.308480679735895e-01   +4.477400158651178e-01   +6.396518236664042e-01   +4.426938256841620e-01   +2.933464801570612e-01   -2.625346940384438e-01   -4.134384482621009e-01   +3.178263697104042e-02   +1.708004412755089e-01   +7.215733470596811e-01   -1.211371359977032e-01; +4.723901713919847e-01   +6.546786783943737e-02   -5.527292797272433e-01   +5.926787645818294e-01   -7.325561052522366e-01   -6.292438501376439e-01   +1.662316199299349e-02   -8.597120601676850e-02   +2.794168303172527e-02   -9.574725860038886e-01   +7.823660828655734e-01   +7.247995016923049e-01; +5.223923370669760e-01   +4.212633042946298e-02   -2.600691430128066e-01   +5.136560391725941e-01   +4.080678892935593e-01   -2.173211493921609e-01   -3.181681495961705e-01   +1.248859572220263e-01   +3.240319157835600e-01   -5.126802129488898e-01   +4.045484247406953e-01   +1.909075417500964e-01; +6.900161373311682e-01   -3.134079182216420e-01   -8.620089499451901e-01   +2.883974092499037e-01   +8.817452112810924e-01   -1.046421560751385e-01   +7.072791645339612e-01   -5.952592720237723e-02   +9.746509727866498e-01   +4.196717616131886e-01   +1.192453898407384e-01   -1.719848329812326e-01; -5.910372437548196e-03   +6.498964534632314e-01   -2.651301899252069e-01   +8.096010172814185e-02   +5.158440679987280e-01   -5.467409199015848e-01   -8.534325274250159e-01   -3.808755704821919e-01   +7.068417136893069e-01   -9.452238275765907e-01   -5.125029291194022e-01   +1.000000000000000e+00];
L2E_Input1_iAMPA_netcon = [+8.310255450006024e-01   +8.109350361912699e-01   -1.375774041414442e-01   -4.684102457428452e-01   +7.455715860615621e-02   +1.000000000000000e+00   +8.338149713659071e-01   -2.391268758476458e-01];
L2I_Input2_iAMPA_netcon = [+8.385366486545148e-01   -5.443767278962413e-01   +9.260445584589461e-01   -1.322402792646459e-01   -7.998652465870312e-01   +8.335076293530517e-01   +1.271533182962486e-01   -1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
