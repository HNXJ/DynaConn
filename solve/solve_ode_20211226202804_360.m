function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.285872559122516e-01   +9.097079688994578e-02   +1.896237842894206e-01   +3.914064548581841e-02   +1.651015680396190e-01   -2.092685290025802e-01   +3.227209341328147e-01   -1.782970362660089e-01   -1.475694712873304e-01   +1.974077733932000e-01   -2.814771565031872e-01   +2.767080277505203e-01   +1.997793716558612e-01   +3.658983103989442e-01   -1.596089420478958e-01   +7.519249208965947e-02; +8.834774209864744e-02   -2.696972796995313e-01   -5.003250989010288e-01   -1.486134479293641e-01   -9.476037738638934e-02   +3.529233416843105e-01   +1.525037767965544e-01   -3.307620747798065e-01   +1.530104008751654e-01   +1.466087731781762e-01   -7.279611515843804e-02   -3.425786282886397e-01   -2.580140777610806e-01   +6.908626265570084e-02   -2.186559242042024e-01   -5.019878700837672e-02; +1.667543697692611e-01   +2.453897154884279e-01   -6.365509633199874e-02   +1.316138051938898e-01   -5.336378235711844e-02   +2.609222696541770e-01   +3.636738447074734e-02   -2.704990138796438e-01   -2.127319509180128e-01   -4.545421079333395e-03   +1.799517956616143e-01   +2.778884944561845e-02   +9.090312014749000e-02   -7.765541964579718e-02   -1.472075724513868e-01   -9.739905503961754e-02; -6.824134358486039e-02   +2.366878260266717e-01   +8.740203030470141e-02   -2.704425990583783e-01   -1.306382640508194e-01   -1.983323207673435e-02   +1.917018690309674e-01   +6.063330847848684e-02   +2.663415963324098e-01   -2.374104850811158e-01   -3.475016050433183e-02   +3.154118810319373e-01   +3.668901992552295e-01   -6.096737375117535e-02   -1.203789442241177e-02   -1.270388588257623e-01; +3.414711913782694e-01   +3.199871792615048e-01   -1.222734206609914e-01   -1.576370462239310e-01   +9.600135840199561e-02   +2.282921734831890e-02   +2.212808751730092e-01   +3.680927141829013e-01   -1.630956130601104e-01   +3.504260279258131e-02   +1.369069103482483e-01   -2.017728651828126e-01   +1.282774162861677e-01   -6.521660526484119e-03   -3.938046423332933e-01   +7.655921593763818e-02; +1.706830374362885e-01   +1.622219700423232e-01   -2.423421770291169e-01   -2.197869610559646e-01   +1.127278368142629e-01   -1.539044214766167e-01   +9.741563160471502e-02   +9.604617154839348e-02   +1.569413385460046e-01   +7.538653315134554e-02   +1.154933966190182e-01   -2.275410769349821e-01   -7.042137066324526e-02   -9.155068393576657e-02   -2.882856430152510e-01   +1.456799363281400e-01; +2.117012171366736e-01   +1.808760214016817e-01   +2.009394677095099e-01   +2.082030079085871e-01   +1.525315704109365e-01   -1.365731238681282e-01   -7.874789774315982e-02   +2.147849508250932e-02   +1.600598982193446e-02   -1.910001085216201e-01   -2.204453197237541e-01   +1.829085061375291e-01   -1.046425119772940e-01   -2.926001152681248e-01   +3.481007189837050e-01   +2.274268495854130e-01; -5.776029299141288e-01   +4.623169335134107e-01   -1.243673591065500e-02   -3.724915300961295e-01   -1.656627666455769e-01   +7.215220448732330e-03   -4.868144633206392e-01   -3.736262431107138e-01   +1.759135092669038e-01   -4.620010040999603e-02   -1.563191939822396e-01   +2.289623546598243e-01   +2.347606616863391e-01   -5.796338260614007e-01   +2.032295851206581e-01   -9.415725338627161e-02; -1.616251285680880e-01   -5.386107579407715e-02   +2.637212800412568e-01   +2.920302614758478e-01   +1.780856623554188e-01   -1.287836467315354e-01   +2.092828547089366e-01   -1.150609028917101e-01   -8.336279692637658e-02   -4.556803607805726e-01   +1.943153528024060e-01   -2.572266611096629e-01   +1.233156789881351e-01   -1.682200001039084e-01   -2.860646083053587e-01   +5.147007365332257e-02; -9.005079269913017e-02   +1.333434739439159e-01   -2.738775747900619e-02   +3.918534820005365e-02   +2.772753809761069e-01   -1.039377506626184e-01   +1.381154596252213e-01   -1.157051513575518e-01   -8.385412500889386e-02   +1.609776821713081e-02   +5.839793966058980e-02   +2.241826383881869e-01   -2.350231655675696e-01   +3.604191193583518e-02   +1.135863412377937e-01   +2.276643193104956e-01; +3.725469462044098e-02   -7.902659668759858e-02   +3.163880342920439e-01   +2.689978491103154e-01   -3.617097903001443e-01   -1.583730688831270e-01   +2.002771949028279e-01   +1.359675023359509e-01   +1.394512610981561e-01   -1.054940943044009e-01   -1.249101846298980e-02   -1.586041271416120e-01   +2.199709792906079e-01   +8.977031433058724e-03   +3.309988830399492e-01   -7.125415722249792e-02; -1.682933589288611e-01   -2.375560312313468e-01   -4.655850428088101e-02   -9.205573412802490e-02   -3.253042863067783e-01   -2.986872886835384e-03   +1.148311024218502e-01   +1.485231692338447e-01   +2.301892409322725e-01   -1.348402731746898e-01   -2.521128278334123e-01   -2.114432446171433e-01   -1.533433568862184e-01   -1.057308233581083e-01   +5.648536501219943e-02   -1.982160626428876e-01; -3.239103307813163e-01   +9.055751010364793e-02   +5.174137142870663e-01   +3.134709088955811e-01   +8.837388396982351e-02   -5.068683937703358e-02   -2.063240807991700e-01   -2.234279910371227e-01   +1.750923312367702e-02   +2.583176893049869e-01   -1.069055624678517e-01   -4.195062229049092e-03   -7.188431497394469e-02   +6.431437504502781e-02   +9.216703647151021e-02   +4.349699995050743e-02; -5.811270049761705e-02   +1.101557956508288e-01   +8.521700364200227e-02   +1.020298263480694e-01   +3.350150645505771e-02   -2.596867732503884e-01   -2.716306126402614e-01   +1.541672976032535e-01   -3.413453108133672e-01   -1.718118358449091e-01   -1.942353759452831e-02   -2.510818618878724e-01   -1.665171818131026e-01   +2.010456279386478e-01   -1.331809085735461e-01   +1.163143993598315e-01; +5.520066994419215e-02   +1.576010087774355e-01   +1.499318444558747e-01   +4.714284898775686e-02   +6.602666243069585e-03   -2.488854721741393e-01   -2.829747654851200e-02   -3.481730921811271e-02   -7.530222417619234e-02   +2.056376406695852e-01   -2.812294274132122e-01   -4.850912574979153e-03   +8.049907863746091e-03   +2.717010350174695e-01   +5.283353507823868e-02   -2.019005369822898e-01; -4.181076802878669e-02   -2.520253223043138e-01   -3.171363081895801e-02   -8.531428809668526e-02   -2.310630523407715e-01   -1.806517385888218e-02   +8.482350083469821e-02   -5.830566040867885e-01   +1.277451005498372e-01   +3.586727839201100e-02   -8.948385701969067e-02   +3.422256882781394e-02   -1.784057998394260e-01   +4.414261918339216e-02   +5.496549954509539e-02   -2.292105751433634e-01];
L1E_L1I_iGABA_netcon = [+2.642901677703381e-01   +1.355366863374545e-01   -2.784053595106705e-01   +6.883765833938639e-02   -1.237845951854748e-01   -1.504365723839212e-01   +1.754588397857882e-01   +5.241812229866785e-01   +2.472788057462577e-01   -2.066264648447538e-02   -2.897008125725786e-01   -1.297981071842721e-01   +7.134865658258221e-02   -2.331013920456666e-01   +3.604582724983139e-01   -1.959664151708038e-01; -5.148779786862299e-01   -3.471188324245580e-02   -8.513777156535643e-02   -4.152291728969261e-02   -4.172756042211399e-02   +7.538102084320406e-02   +3.258997758896673e-01   -5.098939654315331e-02   +1.774436440785453e-01   -3.090167235343982e-02   +2.152937347277533e-01   +2.931797899670552e-02   +6.720613163387298e-02   -1.204519924124936e-01   -3.285998842402989e-01   +9.321284069424009e-02; +1.904921675533444e-01   -4.590718905569396e-02   +2.820210830908899e-01   -8.308989947382685e-02   +3.062341901763064e-01   -5.209608307734402e-01   -6.692939067952500e-02   +1.003743454491638e-01   +3.475281035337953e-01   -2.360768558160579e-01   -3.145199730278486e-01   +2.816067410463899e-01   -1.381624562931772e-01   -1.593971108379365e-01   -2.049756085891288e-01   -5.637168637174150e-02; -9.266192477573056e-02   +1.825406320460939e-01   -2.649241562255721e-01   -1.253389134790661e-02   +3.966555106790284e-01   -5.690119128332706e-02   +1.259661493086234e-01   +3.512497797005004e-03   -2.349668857860754e-01   -4.431595350676598e-01   +2.392666974067763e-01   +6.961500159740612e-03   +6.804200358407621e-02   -9.496983185796322e-02   +1.824999902250476e-01   +2.906576005419094e-01; +1.959081421213196e-01   -2.447267486316956e-01   -1.830857249791723e-01   +1.098635355306739e-01   +9.155219628255290e-02   -1.419721582338416e-01   -3.407050065745956e-01   -3.149220109572430e-01   +1.945135024416771e-01   +6.212345986983876e-02   -1.198371514220170e-01   -9.863815000080731e-02   +1.259020485260429e-01   +6.204972515019921e-02   -3.524079474487710e-02   +6.550506578619243e-02; +2.306466586657806e-01   +1.949467393412246e-01   -1.402390816785178e-01   +7.240922629780204e-02   +7.681905137287968e-02   -1.088541695151851e-04   -2.731836701789447e-02   +2.644659030238110e-01   -1.295843565021230e-01   +6.916147535232786e-04   -1.065669157008721e-02   -1.651175128763603e-01   +1.323409953233178e-01   +2.172838606010936e-01   +5.333522507037804e-02   +2.274914332626762e-01; +1.282883298432226e-01   -2.647184413237241e-01   -4.975353859626220e-01   +2.430640171799003e-01   -3.224843184682769e-01   -4.782590677390955e-02   +2.234548841397821e-01   +2.571962792275865e-01   -1.039024370173842e-01   -2.403501848407790e-01   +8.814680150817952e-02   -9.050584091564982e-02   +3.985545555459364e-01   +1.737609476277750e-01   -9.419237186825116e-02   +6.353635680253832e-02; -1.096138511899778e-01   -1.025644999010808e-01   +1.305235640590892e-01   +1.207961973787108e-01   +2.527757341915485e-01   +1.929549953825242e-01   -7.993708023188900e-02   +4.313743591979884e-01   -2.036560092708181e-01   +5.040892041871519e-01   +7.128379353759004e-02   +2.665195897291233e-01   -4.250984728885822e-02   +6.633159840170476e-02   -5.330091485035689e-02   -1.592173504806753e-01; -1.306391814289064e-01   +2.125942586333864e-01   -1.970892956426013e-01   -1.862574795088154e-01   +3.149889189025462e-01   +4.593623561298804e-01   -3.689972637771622e-01   -1.317726645081192e-01   +2.477951489710321e-01   +1.198577185632326e-01   +6.236852305813159e-02   +1.187690610083588e-01   +4.548444201591012e-02   -1.190224524205334e-01   +1.834452839250840e-01   -2.701091252188662e-01; -1.291029724126785e-01   -6.902223391270562e-02   +1.697402489180330e-01   -8.070572209539494e-02   -2.141635020058558e-01   +3.953364133240043e-01   +1.386083643403047e-01   +4.213527239708520e-01   -4.924361126114532e-01   +7.496008902052317e-02   -3.659949190823981e-01   +6.781699054447693e-02   -2.391181941939583e-01   +7.645545789052709e-02   +1.339144805285466e-01   +7.506745738131287e-02; +3.752024843622327e-01   -1.488060596018429e-01   -2.125355354628642e-01   -2.135810033613744e-01   +2.983523976729655e-01   +5.649739823353470e-02   +2.671989484049400e-01   -7.331108830152484e-02   +1.183802736590437e-01   -8.200417886135750e-02   +1.819497052095869e-01   +3.187245461380702e-01   -1.488258657666803e-01   +6.183411484114183e-02   +5.033554931239992e-01   -1.016951821323646e-01; +4.846780743299608e-01   +7.719295505024716e-02   +5.475870117472847e-02   +1.036861240620216e-01   -2.055259757491556e-01   +3.171335329581998e-01   -2.187629744385237e-01   -1.146454797304085e-01   -3.054996226775794e-01   +1.146625396971419e-01   -1.326970356677648e-02   +3.013472221700827e-01   -1.182157690926790e-01   +5.745849254557713e-02   -2.405979857576539e-01   +1.567980823237094e-01; -1.966249261254778e-01   +4.248446975219521e-02   -7.610696872714189e-02   +1.441001109415995e-01   +1.133738693712083e-01   +9.494559944313137e-02   -3.400495986540677e-02   -4.132307446543282e-02   -1.157073258750352e-02   -9.176299788261727e-02   +6.132858409536762e-02   -4.598067343860291e-02   +1.792031280451161e-01   +1.246403796233111e-01   +2.575020950626129e-01   +1.050308299909311e-01; +6.828190022548858e-02   -1.995134375113032e-01   +9.649897721353590e-02   +9.415753614700884e-02   +4.895018977094152e-02   +2.379993543760319e-02   -1.583913901743923e-01   +1.494454378310001e-01   -1.979080233898333e-01   +1.309247276819261e-01   +1.653194778984631e-01   -7.640533387824316e-02   -1.499335158424881e-01   +4.450319074468404e-02   -3.450992172940269e-01   -3.765516609177694e-01; -1.110676119323422e-01   +2.651219643086871e-01   +1.572630739689857e-01   -1.569770356507603e-01   -3.448534543817857e-01   +3.308102405613408e-01   +2.911474373374251e-01   -1.406051288271588e-02   -1.218230868749218e-02   +1.310512843088378e-02   +1.836762498581824e-01   -9.975330524574162e-02   -7.073794312292184e-02   -1.118203105428064e-01   -2.742017613584738e-03   +2.981581406901295e-01; -2.176833441756713e-01   -1.649843604156249e-02   +9.501576283131608e-02   +2.507077110569647e-01   +4.890364407418135e-03   -5.113186864540994e-02   +2.138687700976278e-01   -6.490013249717638e-03   +7.760532454828596e-02   -1.326665397358509e-02   +5.681718928188097e-02   -2.849201651659597e-01   +2.898291918738263e-02   +7.439176056160908e-02   +2.045995198311260e-01   -1.259285493706683e-01];
L2I_L1I_iGABA_netcon = [+2.787892449119776e-01   -1.425219841426797e-01   +9.833392193081282e-02   -3.094654770194731e-01   +4.438401867055820e-01   -2.901959785341867e-01   +8.878127473987166e-02   -2.380633344151655e-01; -5.456782723613394e-02   -1.734738539540883e-01   +6.879887014389464e-02   +2.493527221652752e-01   +4.986639744195605e-03   -2.414630972768075e-01   +1.690235266074577e-01   -2.206094724261659e-01; -1.670721969114813e-01   +1.054551829796839e-01   +6.819374959614621e-02   -1.291969809089522e-01   +5.434359373852343e-02   +1.016413703901257e-01   -2.816128846007351e-02   -5.450200876309473e-01; -1.340663877563264e-01   +1.206499889447443e-01   -1.036650902434211e-02   +1.745489744924013e-01   +7.117526560953977e-02   +2.007455768573621e-01   -5.759742943664557e-02   +2.443603384548502e-01; +4.328229016374574e-02   -2.264745486671948e-01   +3.727331084855345e-01   +7.832812471566031e-03   -5.535783278828112e-02   +2.149699447951846e-01   -2.115311507464423e-01   +2.710837921169794e-01; -5.447748129413075e-02   -1.675040994743369e-01   +4.404254455782446e-01   +8.863837758330108e-02   +4.368968133667117e-02   -1.806036287234113e-01   -1.568390865858284e-01   -2.046083406186533e-04; +2.600943670196455e-01   -1.355482113114536e-01   -1.107540054229327e-01   -2.007958178589461e-01   +3.215907201695254e-01   +1.672900691439571e-01   -7.640248227165752e-02   +2.033995675573229e-01; -6.267644128851764e-01   +3.782949342370606e-01   +9.701420417863775e-02   -2.333326144399389e-01   -3.407247860568354e-01   +2.039127756110504e-01   -1.583828353158571e-02   -3.469770413869760e-01; +2.157813952109178e-01   +6.899535484378216e-03   -2.142396449244731e-02   +1.155515734468130e-01   +2.257163415928551e-01   -1.751432733790867e-01   -8.000369102553029e-03   -3.142855983540399e-01; +1.002315658756252e-01   +1.890579381678204e-01   -2.744115076191057e-01   +3.060915345797586e-01   -1.617109795724189e-01   -2.603582357457737e-01   +1.052741756182412e-01   +3.133516973490031e-01; +1.689012682210322e-01   -3.874535312676088e-01   -1.506052679985530e-01   +9.327102427242775e-02   +5.154951688876428e-02   -1.946620442479011e-01   -8.793148265303186e-02   -2.863186232161192e-01; +1.357199488625745e-01   +1.559625233012071e-01   +2.102269090155323e-01   +2.714082498334954e-01   +1.142908633723050e-02   +6.181054575096574e-02   +1.097496111950711e-01   -3.116417465596777e-01; +3.077189552721983e-02   +9.328478563128420e-02   +1.130693379508278e-01   +1.896949221362577e-01   +4.237711177950996e-01   +2.171910376732605e-01   -8.287374320335730e-02   -6.841734319925202e-02; +8.130804182904632e-02   +1.068894504654008e-01   +2.465043868938749e-01   -3.072934722998568e-01   +1.990558949643215e-02   -2.131917305006840e-01   -2.728542132261354e-02   -1.141947061177214e-01; +2.733783035353990e-01   -2.186555762807143e-01   +1.622355448123691e-01   +3.889118887709476e-01   -1.022104684888196e-01   -5.333393501429533e-02   -5.400515543319439e-01   -4.013740723378180e-01; +8.904884445641013e-02   -1.364398314378309e-02   -7.070684024872983e-03   +2.487033037784190e-01   +1.725062026293159e-01   +9.707273776115574e-02   +1.620634714142920e-01   -7.709879089818659e-02];
L1I_L2I_iGABA_netcon = [+8.384801525970875e-03   -7.261413489822822e-03   -2.677564812958262e-01   +1.436108467293474e-01   -3.068263250683972e-01   -1.527574061259769e-01   -3.513263740613898e-02   -2.597337902159329e-01   -2.497161266191345e-01   +3.548889788355308e-02   +5.002790269908023e-01   -1.124932275003111e-01   +2.398566881388152e-01   +1.735379281699444e-02   +4.757883918291980e-02   -3.136488728058043e-02; +1.878130332727433e-01   +1.497230941388683e-01   -8.822147995596198e-02   +1.466471002221703e-01   -8.684710111731830e-03   +5.896496445223096e-03   +3.868876463205070e-02   +1.225081896972660e-01   +3.043595850091571e-01   +5.366613491065534e-02   +8.865368137705461e-02   -2.404599215112885e-01   -1.248364704246919e-01   -2.537540566677708e-01   -2.634541401689941e-02   +1.984348575071600e-01; -3.811943239969374e-01   +7.180958700906592e-02   -5.860940802650497e-03   +2.021645465248587e-01   -2.318411917955410e-01   +1.747566016233862e-02   -1.767205094032885e-01   -8.309639324439497e-02   -2.239229710996252e-01   -3.290576190226448e-01   -6.304418169926206e-02   -3.656194641696645e-01   -2.595478193116184e-01   +7.643247951777589e-02   +2.064035709717263e-03   -1.769526623217814e-01; +4.856180316706402e-02   +3.089357669363718e-02   -1.186364624669459e-02   -5.010265279203410e-01   +3.365186278332175e-02   -2.926015485198150e-01   +1.486484944720570e-02   +9.002057982386479e-02   +7.731097726649749e-02   -8.722431383496125e-02   -2.281847904429737e-01   +5.886559843732351e-01   -4.079854936463712e-01   -3.342104798308790e-01   -2.484039455604152e-01   +1.507747629524916e-01; +1.324812336794009e-01   -5.991202140851153e-02   +2.219898165995748e-01   -5.422814980355826e-02   +1.001778994736962e-01   +2.974129029495510e-01   -1.970514749516558e-02   -3.015780148359490e-01   -2.383892653107238e-01   +8.056533797986570e-03   -1.467022889024971e-01   -4.033298899896473e-02   -1.501362184545935e-02   -2.607937979462178e-01   +2.042506763180802e-01   -6.480022047529316e-04; -5.431370304077419e-02   -2.855988557950847e-01   +1.422464561767927e-01   -2.914907392752808e-02   -4.155520654305688e-01   -2.208086346408795e-03   +2.712386201572642e-01   +2.034984797381061e-01   -2.728510466958059e-01   -1.766496906656679e-01   -1.971186787711972e-01   -2.836494294862346e-01   -2.737408610832496e-01   -2.202307284705135e-03   +1.350301067883243e-01   +5.104013483648681e-02; +1.055324060571157e-01   +9.035555714791701e-02   -3.628983399583614e-01   -4.597468131725355e-01   -3.617248891424256e-02   +2.430994773072149e-01   +1.415841201144135e-01   +1.386551122353807e-01   +1.418136446797619e-01   -1.516153013484495e-01   -3.730480091135698e-01   -3.469620973376038e-02   +1.266690374936019e-02   +1.249919697742489e-01   +5.725098111024227e-02   -2.775951429924320e-02; -3.239988778469024e-01   +1.824338506625887e-01   -1.658781046592593e-01   -2.371568893928397e-01   +7.636130162846529e-02   -1.264852992480019e-01   +1.435131576578014e-01   -1.153088213339436e-01   -1.412585919594319e-01   +2.676807381489092e-01   -3.663225795275182e-01   +1.188952924135415e-01   -1.185063251129565e-01   +2.922752053809787e-02   +2.329007041125656e-01   +3.798316685405982e-01];
L2E_L1E_iAMPA_netcon = [-8.770888207069857e-02   -3.078600329473315e-01   -1.955487834371742e-01   +1.872125351180674e-01   +3.223910812102504e-01   +3.375047012456116e-01   +1.659133947565762e-01   -2.721719490809454e-01; -7.428700937282527e-02   -1.329622193389577e-01   +2.273860484760327e-01   +1.733350563080509e-02   -3.391919350628316e-01   -2.432758099971322e-01   +1.281623097006315e-01   -2.322930177754531e-01; +5.458264440459198e-02   -9.180078600009904e-02   +1.724892417476183e-01   +8.520253742574427e-02   +2.508751747880955e-01   -2.355063173535064e-01   +3.430679100831720e-01   -4.666357950037027e-02; -1.433611646714826e-01   -1.634759006517108e-01   -1.455577378698117e-01   -1.142623240714012e-01   -2.610599573982864e-01   -3.033093280011702e-01   +3.984244294399842e-01   +2.763971003218123e-02; +3.192484739757359e-02   -9.266878074938495e-02   -3.784062180796365e-02   -1.486543102045521e-02   -3.171950035990206e-01   -8.840437696748676e-02   +2.129170613750579e-02   +3.349603282547753e-01; -2.687974829841993e-01   +1.107346618285917e-01   +3.139022318865023e-01   -2.434808584086711e-01   +1.326845242441245e-02   -2.770916303665658e-02   -7.670887332422315e-02   +2.881580970025691e-02; +1.073593461972469e-01   -2.243850094401384e-02   +1.188556882997173e-01   +2.239174526385035e-01   +1.056367619625402e-01   +1.614151433650926e-01   +3.012469448823039e-01   +2.902197494477333e-01; +2.147604723954237e-02   -9.795994166041108e-02   -4.663992234176592e-02   +1.275389412868382e-01   +1.863310877119490e-02   -4.247446881354113e-01   +1.710076980826993e-01   +1.693241882071202e-01; +1.026405570261732e-01   +1.734910464624150e-01   -6.925125394159026e-02   -3.572067269214174e-01   -3.009287983040867e-01   +1.031136018864582e-01   +2.694457678014223e-01   +1.635595050148722e-01; +2.484755935369043e-02   +2.995005608741184e-01   +2.116159933017783e-01   -7.497374241291993e-02   +1.657778938673549e-01   +4.395287245541264e-02   -1.327539041331927e-01   -2.239495451276977e-01; +1.486924413250714e-01   -9.377498519597725e-02   -2.503229232935207e-01   -3.926976406977467e-01   +2.556863327614096e-01   -3.777362739728618e-01   +6.082972931795640e-03   -4.045533246777204e-01; -9.173427016453631e-02   -4.299929933020424e-01   -2.838860441821894e-02   -2.462667960312212e-01   -6.086987878926860e-02   -1.303623041702489e-01   +1.882935837433319e-01   +5.406574221102657e-02; -3.280657175322532e-01   -1.603288317395518e-01   +4.586182020544831e-02   -1.929887302307631e-01   +1.117665513380565e-01   -1.331653603197218e-01   +3.334274352336071e-01   +2.607649609109621e-01; -1.054064735949952e-01   -4.137411947520847e-03   +1.781475724785025e-01   -6.392301851569843e-02   +1.373680886738467e-01   -7.035851728481042e-03   +2.308975321859179e-01   +2.852077145946156e-01; -1.236824232724087e-01   +1.519756303582978e-02   +8.080483323801466e-02   +2.445317111048907e-02   +9.584639524378143e-02   -5.740091175472792e-03   -8.679333643316081e-02   +4.364540228659980e-01; -9.259981578327837e-03   +1.278928332648452e-02   -2.546713873439965e-03   +2.764995286681252e-01   +6.522157565861182e-02   +3.809186104066377e-01   +4.011140596553759e-01   +4.820941502524827e-02];
L1E_L2E_iAMPA_netcon = [-2.089581336374494e-01   +3.365459649280566e-01   -3.653222651330333e-01   +4.907561085086259e-02   +3.670021268613415e-02   -2.771696255060392e-01   +2.397487262801989e-01   +4.186471267146497e-01   -6.499450909863019e-02   +4.231691706010580e-02   +1.018199870730832e-01   +1.933188246408292e-02   +2.493835375320159e-01   +1.523754165637089e-01   +2.522870046395485e-01   -1.589119450057062e-01; +1.820244354787794e-01   -9.004844717275351e-02   -1.312500581570654e-01   -1.296790355445643e-01   +5.000119356289519e-02   +3.980503740736713e-02   -1.061402332196841e-01   -1.755419275383002e-03   +2.081717034440071e-01   +8.461210465081832e-02   -2.002388949200390e-01   +1.366301251144003e-01   -1.457577258572864e-01   +1.010631769215426e-01   +4.234343193466748e-01   -4.468067388886229e-01; -5.158906662482664e-01   +3.942575478334480e-02   +5.295252007570814e-02   +1.632622866055461e-02   -2.124151107960315e-01   +3.096157462906039e-01   -1.802018492552432e-01   +1.912505632020311e-01   +1.666620595033375e-01   +1.152321349974962e-01   -1.501499452218498e-01   +6.546550801260051e-02   -1.864206724119905e-01   +6.029362858731365e-02   +1.125817920270263e-01   -3.338232562883724e-01; +2.808603920467384e-01   +8.799567443843147e-02   +8.589219190371183e-02   +2.661674929854313e-02   -2.497006715126409e-02   +1.677983348886446e-01   -1.931454844434090e-01   +1.480017172000782e-01   +3.388426375552576e-01   -5.130937609823615e-02   +6.404965350732428e-02   +3.712419923758487e-01   -4.981441780844204e-01   -2.125376506448895e-01   +3.411409371200109e-01   -9.536074036601689e-03; -1.142568448953752e-01   -3.842541580533697e-02   +2.383861625467202e-01   +1.500855193709368e-01   -7.506118768430267e-02   +1.381078809640725e-01   -2.167465228607939e-01   +2.016048175198976e-01   -4.525396137237128e-02   +5.252985742774934e-01   -1.770773016150585e-01   -4.200000157744107e-01   +2.826374191201185e-01   -1.632689209824279e-01   +7.297136978520335e-02   +2.764775003073282e-01; -2.828430576275470e-01   +3.308427946536507e-01   +1.305184114931787e-01   +1.225968173905107e-01   +1.301599095161887e-01   -1.488077040609232e-01   +8.987245026337259e-02   +1.804742244865651e-01   +8.792678244621108e-02   +2.156809449054893e-01   -4.429461751054914e-01   +1.720817173444538e-01   +2.449503919361586e-02   +3.160494926772708e-01   -2.300150580535741e-01   +3.852764688570219e-02; +2.811247991554925e-01   -9.692931874284466e-02   -6.773935468110641e-02   -9.644266017353810e-02   +1.134075028138208e-01   +3.698103679753788e-02   -1.716743300542818e-01   -5.481405734249519e-02   +1.958048063506974e-01   -2.204275965943868e-02   +1.461898743986632e-01   -2.157221144056375e-01   +1.447321501619387e-01   -3.627779873152637e-02   +8.775465282269262e-02   +2.887354577041349e-01; +7.554814161629980e-03   -1.537701047837276e-01   -2.129105912249858e-02   -1.626293246026815e-01   -2.855355289503565e-01   -2.846058244091139e-01   -2.135955991707049e-01   +1.358168336207764e-02   +2.107353611434331e-01   -1.859176818314442e-01   +1.908146453460745e-01   -9.483749116223097e-02   -2.195756978623305e-02   -3.254315027925955e-01   -5.105069041582765e-02   -2.027976207401505e-01];
L2I_L2E_iAMPA_netcon = [+3.377776877838763e-01   -2.584106691588206e-01   +9.516015108303644e-02   +7.880897727037318e-02   +2.844348366887775e-01   +9.509610757966080e-03   -1.082635681106581e-01   -7.932923742182560e-03; +1.615519459900750e-01   +8.935184600602181e-02   -8.711122000727839e-02   -5.149730318422303e-02   +3.359766183924713e-01   -1.424227570819359e-01   -1.949770822630233e-01   -7.771229727228809e-02; -2.005991096073659e-01   +1.095049216491631e-01   -2.896445787369870e-01   -1.849744574575738e-01   -5.330207362151166e-01   +8.132081831629626e-02   +4.608112982349472e-01   -4.688197215581986e-01; -1.128875814492351e-01   -4.426981031132898e-03   +9.082408781704308e-02   -5.253311964264455e-02   -1.185194470016748e-01   -6.584482562427205e-02   +1.520124777636198e-01   +2.616357234393601e-04; -2.227383574476892e-01   +2.543788638133935e-01   -3.006354834201742e-01   +2.119736154894828e-01   +4.622706483361859e-01   +4.582492059213855e-02   +4.947876522881108e-01   -1.312460409564305e-01; -1.921359393692497e-02   +6.977910547184368e-02   +9.228147413701918e-02   +2.512255571702745e-01   -2.322028324338489e-01   -6.092439660883753e-02   -6.492836169603444e-04   +3.477236457580919e-01; +2.525326115114451e-01   -2.050749539275703e-01   -1.389012811333493e-01   +9.909174580686102e-02   -7.046560064275209e-02   +1.088216917720352e-01   -1.320348674965829e-01   +1.579586639956712e-01; -2.691558948180081e-01   -3.810759535583522e-01   -3.248396866246468e-01   +3.136648292802163e-01   +1.386588970773804e-02   -2.417677957832647e-01   -6.633961997224534e-02   +2.077607631951527e-01];
L2E_L2I_iGABA_netcon = [+4.712124971444231e-02   +2.619792369764656e-02   +2.451582006671630e-01   +2.977652804244661e-01   -4.844361731716965e-02   -3.476183482315754e-01   -2.741035308519802e-01   -2.259368744032697e-01; -1.567760016971272e-01   -2.288109210748948e-02   +1.880735171349309e-02   +2.304469669374909e-01   +3.669345843111331e-01   -2.201945739192406e-01   +1.515671071381852e-01   +7.814089517151088e-02; +5.086446750612743e-02   +3.951851123127709e-01   -1.200451881392095e-01   -3.675129570681529e-02   +2.887748974742358e-01   -8.898225697299594e-02   -1.196134545628556e-01   +1.648408787014837e-01; -2.449893394316343e-01   -3.345854696711899e-02   +7.153872220755716e-02   +3.425762310236181e-01   +1.403336837520078e-01   -1.047352472546102e-01   -1.216321138751347e-01   -3.233198543740634e-01; +4.779627459343643e-01   -4.329873756156609e-01   +1.043230791739190e-01   -3.083725489976824e-02   +8.348495640633372e-02   +4.215766203179029e-01   -9.831790281892766e-02   -2.389738206808932e-02; +7.956035636450062e-02   +4.202902066998484e-01   -1.017819603797324e-01   -1.297737124158393e-01   -2.209903165168102e-01   +1.442721805180951e-01   -3.081483534393695e-01   +2.459446928095605e-01; +1.970489444489869e-01   -1.955419618278772e-01   +1.177412471776824e-01   +1.319278057961500e-01   +1.422628416110632e-01   -1.053870202922918e-01   -5.623461137623307e-02   +3.808995237773524e-02; +5.745535890957079e-02   -1.137297931591675e-01   +7.996527260769078e-02   -1.102230724295889e-01   -2.321823794408420e-01   +2.906161817250388e-01   -4.926674267504469e-02   +1.062686068341389e-01];
L3E_L2E_iAMPA_netcon = [+2.796955816765755e-01   -1.334659106547504e-01   +1.049965579719427e-01   -2.072878442059776e-02   +2.827819053108519e-01   -1.870237206270386e-02   +1.961894439490390e-01   -1.004359844828157e-01   -3.828387360880890e-01   -1.198675778050275e-02   -3.086171584921726e-01   -7.161093118173124e-02; +3.977388336021111e-01   -5.630895074979923e-02   -7.092334804151612e-03   -9.818125751323367e-02   -3.345992388090741e-02   -1.475906842613214e-01   +3.445020283625509e-02   +2.408858786676150e-01   +1.146070767401405e-02   +2.657012446905146e-01   -1.403046892744781e-02   +2.815776745976224e-01; -2.405748978355457e-01   +2.295448607455183e-01   +1.122890667650158e-01   +2.427522066252665e-01   -5.470600760521563e-02   +3.714545221236538e-01   +2.760403389998047e-01   -1.672830902368302e-01   +3.595664273707274e-01   +1.642357905986099e-01   -1.869193350334830e-01   -2.931302706463651e-01; -2.096855455030907e-01   +6.529901249796377e-02   +1.005240243176944e-01   +5.984628646089170e-02   -1.497107419777249e-01   +2.467096923341434e-01   +2.740986724377787e-01   -1.371687331544641e-02   +9.215330546337445e-02   -2.925876249368015e-02   -8.119733288696473e-04   -1.283134200121500e-01; +8.814051978806577e-02   -1.175193156660070e-01   +2.068540164241042e-02   +1.891709116676661e-01   +2.144178416436290e-02   -7.577441194320800e-03   -2.666291034904129e-01   -6.304973383581883e-02   +2.134895854720695e-01   +9.101948798650547e-03   -1.573045412403037e-01   -1.802209085488746e-02; -1.769365959037095e-03   -3.433209162060841e-02   -6.112319060801951e-02   -8.306676171068625e-02   +5.513029115272503e-02   +3.379532146231888e-01   -8.721800109800087e-03   -1.861836232963679e-01   +1.625713535927854e-01   +1.236433759251713e-01   +3.070547841947520e-01   -1.791312414316457e-01; -2.324023696767337e-01   -8.327227013063072e-02   +1.903357776715383e-01   -1.425347573630700e-01   +1.110328475897933e-01   -2.118681218096554e-01   -2.801771078792713e-01   +1.701538666691179e-01   +1.741118655242146e-02   -1.287987811703311e-01   -3.299278850013234e-02   -3.614373848219632e-01; -6.196708185799064e-01   +3.213683051655009e-02   +1.311986171841276e-01   +4.150342782740319e-01   -2.482139231920866e-01   -7.136113521830023e-03   -4.484731329429892e-01   -3.170803470963427e-01   -7.853365201638755e-02   -6.693750639604815e-02   -5.618653228251089e-02   +3.158532584197946e-02];
L3I_L2I_iGABA_netcon = [-3.010061449234746e-01   +2.220232028109430e-01   -1.101483394108626e-01   +2.283162688737435e-01   -9.078294206671005e-02   -3.273613773843119e-01   +1.465437595024232e-01   +2.653925828859093e-01   +1.410165835591777e-01   +2.603163724701221e-02   +2.838582801927862e-01   +8.985058990897796e-02; +2.515083672899044e-01   +1.793745962253608e-01   -9.455962047000116e-02   -1.440771639611763e-01   -1.893966385548200e-01   -9.975616132951218e-02   +4.317358835447279e-01   +3.334880657054258e-01   -3.320674944220655e-01   -3.172727542636651e-01   +8.024729111995273e-02   +3.443083648152074e-01; +2.121015153077488e-01   -1.564235135881287e-02   +9.429052324907998e-02   -3.735513571097270e-01   -6.559836738092822e-02   +1.659747123726847e-01   +1.859418526497616e-01   +1.078926937381697e-01   -8.028116627296220e-02   -1.963165011780913e-01   +9.539527442320425e-02   +6.712508445027465e-03; +5.174385941431064e-02   -1.986751541974752e-01   +2.481020797703351e-01   +1.491334484382362e-02   -2.810131221843521e-01   +9.840090832014733e-02   +5.696182806815150e-03   +3.294109240316184e-02   +1.081619393662659e-01   -1.852403207010351e-01   +1.969834778293831e-01   +1.716541791675169e-01; -3.374095288161355e-02   -4.282308737834063e-01   -2.527776387927971e-01   +1.922967522667079e-02   +2.701918274270504e-01   +2.835713172515120e-01   -2.595315297838227e-01   -3.388191797296183e-02   +2.993320358416225e-01   +8.306826010431605e-02   +2.694910721847217e-01   +2.683273754331931e-01; +5.432398060721511e-01   +6.918288184164480e-02   -3.873781130461277e-01   -1.749319581587749e-03   +2.121541205797348e-01   +2.557077352010487e-02   +1.903614792954907e-01   -2.653044115420584e-01   -2.356097311422871e-01   +7.147411713375508e-02   -3.244076080403456e-01   -3.986220657742773e-02; +2.352419661114175e-01   +2.106754995595376e-01   -1.162963926886341e-01   -1.948231244823368e-01   -2.074033528124017e-01   +1.856119781570450e-01   +5.227723125510704e-01   +1.521509734949905e-01   +7.604672729882639e-02   +1.696145262112867e-01   -3.402474802878160e-01   -3.466816678404351e-01; -9.644722802930401e-02   +3.108092923867617e-02   +2.364170261620002e-02   +1.124941464119398e-01   -3.341828908309374e-02   -9.217066105109709e-03   +4.186528351835472e-03   -1.666409066233296e-01   -3.284460785239690e-01   +1.060802330659798e-01   +1.246609493842572e-01   +8.029007119985801e-02];
L2E_L3E_iAMPA_netcon = [+2.286574616555533e-01   -4.853683724725053e-01   -2.838559020065246e-02   -2.869650236206346e-01   -4.734339234587631e-03   +1.532091427606189e-01   +2.338451310030564e-01   +8.532137566593462e-03; -7.739703730041590e-02   -4.972327872533844e-02   +2.297852042227973e-01   -1.586601281250983e-01   +1.960287762390404e-01   -1.025362352493539e-01   -2.424948038903499e-01   +8.416245579519076e-02; +1.744793262147517e-01   -4.704014346509208e-02   -1.703106314391897e-01   +8.311444424185711e-02   -1.991108622911028e-01   -1.058517365962864e-01   +2.773690290006266e-01   +1.564775780376248e-01; +2.053591219253636e-01   -2.505519849876316e-01   -1.146091096180663e-01   -5.644487429123194e-02   +6.848940877283319e-02   +8.037972980374943e-02   -5.422166505215645e-01   +6.204566330480266e-02; +1.242602861507656e-01   -9.601718088598835e-02   -1.726462246121702e-02   +2.084057304863550e-01   -2.211076200226911e-02   -1.060755960362397e-02   +2.416911439439363e-02   -3.715314931415544e-01; +1.377107885026503e-01   -2.791312401104876e-03   -3.994776494344055e-01   -2.980802424357835e-01   -9.065826054744543e-02   +2.209332471318902e-01   -1.733628260885882e-01   -2.975275985702449e-01; +1.315794069020293e-01   +1.078569802389602e-02   -5.382169624458256e-02   -9.474498709359495e-02   -1.748384318456393e-01   -3.229313393034016e-01   +2.295598916854913e-01   -3.907546306592485e-03; +3.107237943690359e-01   +2.332841016637927e-01   -4.294931279219227e-02   -1.156985385451696e-01   -2.909087580137699e-01   +8.168429504023807e-02   +1.869995892184042e-01   +3.483807424920437e-02; +1.634964707419585e-01   +4.327534541234355e-02   -2.810912938398100e-01   -2.270747513038561e-01   +6.019247528325019e-01   +1.439846556891867e-01   -6.154372328592432e-02   -2.265491160745760e-01; -1.188005174802040e-03   -2.027343932325454e-01   -2.914571041881158e-01   -1.557225004504920e-01   +6.771314200611459e-02   +1.851676518097734e-01   +1.881642301061889e-01   +2.268036235143515e-01; -1.005315696782842e-02   -6.580654997682908e-02   +1.863119599953960e-01   -4.238823741805597e-02   +1.974560824958570e-01   -1.171433366251942e-01   +2.179697446841605e-01   +2.385997921588112e-02; -1.557189985963543e-01   +1.193355656491676e-01   +3.076932305303155e-01   +1.970425349157855e-01   +8.242553575300111e-02   -2.045593948743384e-01   -1.146514070795981e-01   -1.008811013869447e-01];
L2I_L3I_iGABA_netcon = [-2.826325543095134e-01   -1.811278188582855e-01   +4.085163588206947e-01   -1.811922167334409e-01   -9.881813079301000e-02   +2.232988648705879e-01   -1.472451592665562e-01   -2.122062564743103e-01; +4.139502318942657e-02   +6.888636588860292e-02   -2.269040331766968e-01   +3.366683349307789e-01   -2.208906449319816e-01   +2.354428851545434e-02   +3.379937651249872e-02   -3.741880770782220e-01; +1.155708169465442e-01   +2.436606056811177e-01   +2.062291526706682e-01   -2.955613134111407e-01   -1.337022367268326e-01   -4.765111936235205e-02   +3.661877815048012e-01   +3.385360153860795e-01; +2.214911328382274e-01   +1.810358025132645e-01   -1.351968434403718e-01   +2.891379986537651e-01   +1.023200399167712e-01   +1.999373176648284e-01   +1.888660063317263e-01   +2.451687813187053e-01; +1.267251426280645e-01   -5.354429490571316e-02   -1.712997823811346e-01   +1.631619654471804e-01   +3.448183929155940e-01   -1.427579898897934e-01   +1.599241705257600e-01   +9.993160002160369e-02; +1.124418150509339e-01   -3.864066973158801e-02   -3.574260762579541e-02   +4.620447892898266e-02   -9.906061144667497e-02   -2.639225663292853e-01   +3.741877618156074e-02   -7.912304218510308e-02; +1.446732137713753e-01   +3.224380452569689e-02   +2.196326028581353e-01   -9.218153887616232e-02   +2.547075249341185e-01   +4.133088656530368e-01   +2.706285052126538e-01   +6.661389779086026e-02; -8.375418238793902e-02   -6.513412691542736e-03   +1.230888042161073e-01   -1.145071077718037e-01   +5.306609851126562e-01   -2.508801154406525e-01   +2.294426995628768e-02   +1.112014845176284e-01; -2.278556354811463e-01   -4.382728856116930e-03   +1.052245027628338e-01   +8.465014221518816e-02   -1.628448826789330e-02   +2.241552715159359e-01   +2.228724094274312e-01   +2.390726078452524e-01; +1.948629549873035e-01   +3.976009774595917e-01   -1.221970336309361e-01   -1.962113533751940e-01   -2.423941270430849e-01   +1.860876258880066e-01   -1.015667093275164e-01   -5.660461960241750e-02; -1.747980981557558e-02   -5.940246478745168e-02   +5.448115449494075e-01   -8.621178761155404e-02   +4.977763050858594e-02   +5.307173967487958e-02   -2.417021299472986e-01   +1.708240912473415e-01; -2.017760657080877e-02   +2.078848676040386e-01   -1.115483975580433e-01   +2.090882480800486e-01   -2.901539988251894e-01   +1.398115666447229e-01   -3.046726175581086e-01   +4.731789054136487e-03];
L3I_L3E_iAMPA_netcon = [+2.794337190516992e-01   +7.761149542153595e-02   -3.938154733096944e-03   +1.626852721340199e-01   +1.730099590109359e-01   -3.277266639195971e-02   +5.582182991219292e-03   +1.982965724514311e-01   +1.178458800976287e-02   -4.132937979330133e-01   +1.760562015750405e-01   -6.353077236700949e-02; -2.101115248846928e-01   -4.565415485667682e-02   -1.441265715963488e-02   -8.802529440465792e-02   +1.788997040727361e-01   +1.271051776883923e-01   +1.332582893007689e-01   -3.278055018648773e-01   +4.240035628001566e-01   -3.244485714029558e-01   -4.013109229892604e-01   -1.968120391151979e-01; -3.553291897831039e-02   +3.481000091982032e-01   +2.026757414766878e-01   -1.516273091402630e-01   -1.102476096796122e-02   +2.476331514803124e-01   +4.127935403270421e-02   +2.863821608737294e-01   +2.531778398564863e-01   -4.504603985068642e-02   -2.785801154186029e-01   -3.430548664483181e-01; +8.557213328985969e-02   +3.122778832944526e-02   +2.884134494271602e-01   +2.716885211891411e-01   +6.408584353010770e-02   -2.811622797382621e-01   +2.218715235223087e-01   -4.454555479869289e-02   +4.752886320660232e-01   +1.432782272935553e-01   +2.485868132944707e-01   +6.081178548289758e-02; +4.656539161402352e-02   -4.114877815437039e-01   -2.601444743155154e-02   +1.978908978332602e-01   -2.207633308201112e-01   -2.296589060377788e-01   -3.211188325237411e-02   +3.223219339586721e-01   +1.437314306585839e-01   -8.514645127824597e-02   +3.140404432391573e-01   -8.934677378260678e-02; +3.207635784812862e-01   +2.633617199778970e-01   -3.104773250941318e-01   +4.199999551360052e-01   +5.253078992729360e-02   -5.327135802259567e-01   -1.628980139552624e-01   -1.667135814947805e-01   -8.756806757135438e-02   +3.330141549917481e-01   -2.141853978866203e-01   -2.386105075459798e-01; -1.508073022875952e-01   -1.890586681562897e-01   -1.067602042733197e-01   -2.574146059021830e-01   +1.682947987052484e-01   +1.387585746360302e-01   +2.312304418420023e-01   +2.848012249588755e-02   -3.221965811260425e-01   +3.014010060396393e-01   +3.229544521585208e-01   -2.043789903713842e-02; +1.785263528354746e-01   -8.846282048458513e-02   -1.356768648434217e-02   +7.854785262226822e-02   +3.243680300080127e-01   +7.416767365169497e-02   -1.426873601885298e-01   +7.368994839965802e-02   +1.072003029327240e-01   +2.315344599361659e-01   +5.272575263431812e-02   +1.366630069699297e-01; +1.864882353507156e-01   +1.277063730115710e-01   +1.011816685178644e-01   +7.362971499791519e-02   -1.660056007308611e-01   -5.664335523771077e-02   -2.853191857593639e-02   +1.864826265204552e-01   -3.500225473036103e-01   -3.078509797023712e-01   -6.970310377809583e-03   -5.125732079671206e-02; +2.754946831130803e-02   -1.139768324176216e-02   -9.376123157780772e-02   +1.240937561694744e-01   -3.497129236976367e-01   -6.394003235506143e-02   -1.632163582010262e-01   +4.139296702112396e-01   +6.496928784641154e-02   -2.431086401404716e-01   +2.907004848062353e-01   -4.916633272534002e-02; -1.269405968984679e-01   +2.301817438851879e-01   +2.174739479161604e-02   -1.163063571993426e-01   +2.427447618426947e-01   -2.348784150628037e-01   +7.189492680292085e-02   -7.418110673357264e-02   -1.969601516313001e-01   +1.123670995628297e-01   -5.915447443001844e-02   +3.537134072064578e-01; -4.718555395134061e-02   -9.242847003210683e-02   +2.191023937152723e-01   +3.670220319865755e-01   -1.505947524476965e-01   +1.373718294217234e-01   -2.629276354340079e-01   -2.546966111605675e-01   -2.350592006909182e-02   +1.849570352385049e-01   -4.727216196192036e-02   +1.314301765774859e-02];
L3E_L3I_iGABA_netcon = [-1.233986328130101e-01   -8.390716781620730e-02   +2.636015393073894e-01   +4.152300577027229e-01   +2.945594688313831e-01   -3.406812923329165e-01   -3.483839848181755e-02   +2.813521987593955e-01   +3.523640217785816e-01   +1.695625823010140e-01   -6.078174595447801e-03   -1.929620515980053e-01; +2.459308514090911e-01   +1.608196004895908e-01   +8.286513278823240e-02   +2.278403957716185e-01   +1.260655268539043e-01   -1.217482456078223e-01   -1.884602586067021e-02   +5.484115730024589e-02   -1.404898258622255e-01   -3.598484446356137e-01   -3.756069303227738e-01   +2.119516217643056e-01; -1.162761636367225e-01   +2.138787669582373e-02   +2.295585298640410e-01   -5.026200413858148e-02   -1.238960724633899e-01   -3.651743449903044e-03   +1.731646159797660e-01   +7.000214621477796e-02   +4.821562686617552e-01   +6.494082331359863e-02   -1.478855023771229e-01   +5.159731818221999e-02; +1.305134281825879e-01   -2.036250788915338e-01   -5.149106172761733e-02   +3.291007549968172e-01   +2.580967821962949e-01   -4.311447772374985e-02   +9.255796891447456e-02   -2.911091699758537e-01   +6.843578018507003e-02   -1.455259801075069e-01   +2.201778417801269e-01   +1.068331453350884e-01; +1.452202665899356e-01   +2.032288915911784e-01   +9.810455363569476e-02   -2.337334432140309e-01   -1.270961960718837e-01   -8.999252709335145e-03   +5.989183821515054e-02   -4.194573614864701e-01   -3.517498543582515e-01   +6.471701671873589e-02   +2.824733689744224e-01   -2.149380707674248e-01; +1.467116809736178e-01   -1.031604076695563e-01   +7.283040403983906e-02   +2.182485870893681e-01   +1.146223943821889e-01   -3.492576296774848e-02   +3.213150902440192e-01   +2.265034184480705e-01   -3.193714976373756e-02   -1.627710205572319e-01   +1.391017435413918e-01   +7.020855809659018e-02; +1.235597942191441e-02   -4.101601357091449e-01   +4.141953527199117e-01   +2.798840445130639e-02   +1.099620625627067e-01   +4.873830993105538e-02   -4.719723659273357e-02   +9.299114903913923e-02   +1.937552596299488e-01   +4.140642195323665e-01   +5.827768638790345e-03   -4.574706373370974e-02; -1.915246621167352e-01   -8.583615303045355e-02   -3.331856468224319e-01   +2.333965102623418e-01   -5.740514237143538e-01   -6.382310541576758e-02   +9.215393683866401e-02   +1.827156932710246e-01   -1.117475897593952e-01   -8.432830695090206e-02   -3.819975168438794e-01   +1.093782077627113e-01; -5.475768295844256e-02   +4.256440670385494e-01   -2.349235419950783e-02   +1.228427544222962e-01   +3.711176991072513e-01   -2.683478982108647e-03   -9.041068329417201e-02   +4.400734557367264e-01   -5.035804318661281e-02   -1.365899556235979e-01   -1.519759231031825e-01   +8.931837238354787e-03; -3.030058395067557e-01   -2.258093671831189e-01   +7.287423634060694e-02   -1.788780877247535e-01   -4.107104101849099e-03   -1.046095913083604e-01   +8.242994637726690e-02   +4.235794228726897e-01   -2.339154524969960e-01   -2.251265806706537e-01   +1.630705713952728e-01   +2.445524330487389e-01; +1.900882347842980e-01   +8.601685414144022e-03   -3.819468295495407e-02   -6.378021484642231e-02   -4.324000273227187e-02   +7.810711436398093e-02   -2.127649943140121e-01   -2.075057974271933e-01   -2.238278168429286e-01   -3.230170638499181e-01   -2.766419492240922e-01   +1.898435852570564e-01; -5.094782457901736e-01   -1.591993503219785e-01   -2.417290759941016e-01   +1.968219165802189e-01   +3.842502805098630e-01   -1.020690907729746e-01   +1.621990958835671e-01   -2.670190947343291e-01   -7.118188126011726e-03   +6.842574577107900e-02   -1.844398089136982e-01   -3.489459259406919e-01];
L2E_Input1_iAMPA_netcon = [-9.194532370081143e-02   -1.794203091256087e-01   -9.123163218674998e-02   -2.240996068277289e-02   -1.477248231296157e-01   -1.355792844705908e-01   +3.854993858835432e-02   -4.124157051288790e-01];
L2I_Input2_iAMPA_netcon = [+1.033006458351202e-02   +4.181605042451558e-02   +2.482373427931538e-01   +5.035700861313681e-02   +2.680957540743928e-02   -8.155197541457634e-02   -3.212098137509659e-01   -3.860426884150894e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
