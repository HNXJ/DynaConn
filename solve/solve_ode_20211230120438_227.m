function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.327410900394498e-02   +8.509284626697354e-02   +4.631535728804819e-02   +8.513916505057521e-02   +1.021510965577542e-01   -1.192166533183820e-02   +5.522894048105525e-02   +9.405025807768444e-02   +1.048117012697797e-01   +2.343052577400392e-02   +7.009742864949289e-02   -4.358834355868722e-02   -1.207847738858381e-02   +1.077254202370508e-01   +1.768369288847327e-02   +3.457659636570155e-02; +1.983924238271812e-02   +7.139633034497082e-02   +1.042488316213767e-01   -2.994964434498645e-02   +4.321003925919321e-02   +1.119130558745543e-01   +5.698475079971635e-03   +2.290482863789532e-02   +1.029434676609980e-01   +6.254279868921249e-02   +1.044523540957350e-01   +1.057766802352709e-02   -4.313773617713157e-02   +4.399370445738501e-02   -5.479638851180288e-02   +4.490312905317183e-02; -9.252014765883274e-02   +3.983837551610533e-02   +6.475000491099968e-02   -4.573464000424596e-02   -7.033010832441020e-02   +1.431974299316400e-01   +8.062041906562761e-02   -1.730142707502622e-02   +8.944002217674274e-02   +3.189825276700759e-02   +1.482129849236699e-01   +8.015311133772883e-02   -5.996041330280040e-02   +6.512197067249906e-02   +1.238563707008908e-01   +4.118307216540046e-02; +1.011402635305379e-01   -2.904514557935971e-02   +2.125117774831074e-02   +9.520866781624912e-02   +1.331148501875510e-01   +7.148593711919501e-03   -3.487757631192252e-02   -2.651287090384295e-02   -1.827159917381252e-02   +1.309857299082994e-01   +6.940150087839198e-02   +6.000415194769973e-02   -8.386289926007237e-02   +3.154270499065320e-02   +1.642334949775669e-01   +1.217956148420406e-01; -1.018989490010613e-02   +9.072684958266675e-02   +4.501027642107750e-02   -1.406008193440254e-02   -3.156224155766581e-02   +5.660560909927526e-02   +1.739780963112491e-02   +9.484781692991891e-03   +7.789607461165950e-03   +3.033088503170623e-02   +5.865361561531480e-02   -1.631389176497217e-02   +8.887610953811470e-02   -3.331916555401581e-02   +1.312574967416099e-01   -2.830100393902590e-03; +6.867509767894673e-03   -4.055193920182582e-02   +1.252858735866305e-01   -7.962429489231716e-02   -7.637261661845510e-02   +5.728825133902834e-02   +1.101998598866487e-01   +2.177946198670996e-02   +1.159656078973441e-01   -2.259151429764899e-02   +2.978858027785607e-02   +8.775590918325324e-02   +1.395765155019646e-01   +3.671107019306957e-02   +1.352054506305443e-01   -2.491372215269301e-03; +8.726711515710980e-02   +4.657066249620918e-02   +5.953867097624351e-02   -1.809974188307834e-03   -2.879019130538370e-02   +1.993426535196072e-02   +3.578756222041066e-02   +1.689885982794949e-03   +1.685438137788481e-01   +2.679509372907818e-02   +2.816538635802533e-02   +5.501718478337739e-02   -6.857904522852201e-03   +3.278384756646843e-02   +4.007826654731141e-02   +4.012226040300688e-02; +1.012709712208222e-01   -6.534405335407314e-02   -2.381547553095262e-02   +6.491553390007790e-02   +8.987652768013484e-02   -4.215759470413608e-02   +3.988307803299065e-02   -2.839444295342566e-02   +1.771643864644702e-02   -1.459377275115886e-03   +1.656011677697165e-02   -3.595751429234526e-02   +2.863359989292660e-02   +9.891526968947949e-03   -7.230316852687924e-02   -7.782879254709868e-02; +8.955246785231116e-02   +6.605619521733597e-03   +1.048948042552010e-01   +3.842397122383227e-02   -3.858087298525257e-02   -3.924034666132618e-03   +1.022702563419481e-02   +8.743836060783185e-03   +1.055749554264743e-01   +5.730530405753170e-02   -1.056250816539628e-01   +6.391909472643365e-02   +1.290492098555321e-02   -2.900989843276842e-02   +2.353035511718946e-02   -4.775323673051882e-02; +1.450263816359623e-01   -1.593772230396083e-02   +8.891627980852719e-02   -4.132962044629346e-02   -4.225644113557514e-02   +5.527926518546539e-02   +7.405925629150481e-02   +5.798281779270199e-03   +1.135511809104746e-01   +8.227599013830356e-02   +1.604257212737881e-03   -3.896950128718686e-03   +8.378292302729390e-02   +7.195016107982859e-02   -1.406751254969269e-02   -4.261291241303372e-02; +9.177147981733320e-02   -1.030512126834811e-01   +3.185721190903459e-02   +7.207488899816544e-02   +1.143899354182285e-02   -1.912927486786887e-02   -2.020647063621391e-02   +6.653863196362177e-02   +4.446079487659284e-02   +1.031760208674625e-01   +2.357460506445916e-02   +9.302090900747094e-03   -1.291522014685072e-02   +7.861104179943200e-02   -2.839664622109123e-03   +8.122088859165577e-02; +3.408793449754154e-02   +2.965430391702667e-02   -7.746169704032252e-02   -2.712164640856434e-02   -6.257548777433278e-02   +7.891784287753666e-02   -3.362777529522744e-02   -1.725702165597725e-02   +3.287944854060956e-02   +4.544514949860941e-02   -3.268051690177499e-03   +4.237802391742552e-02   -3.445734027208684e-02   +1.681805990512299e-01   -3.612939168963576e-02   +5.248699344095269e-02; +8.788655626241286e-02   +1.333046618255279e-01   +7.096185515413225e-02   +1.063825864553708e-01   +9.781053317070183e-02   +5.647787937736848e-03   -4.060061988844948e-02   +7.824923032663515e-03   +4.386896997282821e-02   +1.552552806737446e-04   +2.747552462649495e-02   -1.339673264203397e-02   +2.905161512555821e-02   +3.872987792067024e-02   +1.500787429329674e-01   +3.818424157457299e-02; +1.326239399808353e-03   +1.352698281130266e-01   -1.035342478736605e-02   +4.895050678791954e-02   +3.631583706684252e-02   +1.550219877048457e-03   -5.724664857068313e-04   +9.288802573521501e-02   +3.860958405580107e-02   +1.333642348195235e-01   -9.842124554990006e-03   +6.956957978213214e-02   -4.848931945385090e-02   +1.865945639784347e-02   -2.687290064772092e-02   +9.512651406452780e-02; +1.552733718642526e-02   -5.946990386501765e-02   -7.931523320244721e-04   +5.646336917905262e-02   +5.099132469940636e-02   +6.504741356388588e-02   -1.719965011775801e-02   +1.795983458812384e-01   +3.707584421780280e-02   +3.904147656420850e-02   -2.616668472215345e-02   -5.683012394223655e-02   -5.962880010485999e-02   -2.118506823211538e-02   +6.545952902580310e-03   -3.666906899285381e-02; +9.072377908843138e-02   +1.517818507287652e-01   -9.720588641601692e-02   +7.743060995043920e-02   +1.394563413749192e-01   +6.814216791964856e-02   -5.151220169623043e-02   -4.569002916055778e-02   -1.898565919129624e-03   +1.267709532091159e-01   +1.675509439447871e-02   +2.417323230408429e-02   -3.364491776245751e-02   +6.172061333313181e-02   +9.000112344833940e-02   +5.541411171002576e-02];
L1E_L1I_iGABA_netcon = [-1.763619323085794e-02   -2.680417244380640e-02   -3.408024907944668e-02   +7.780458685810888e-03   +1.282799712858872e-01   +7.138775596941575e-02   -5.745384669025932e-02   +8.339268140470277e-02   +5.547471907088278e-02   +2.170803752290595e-02   -7.427087834268986e-02   +1.160982287686800e-01   -1.758630342615669e-03   -7.658719161089424e-02   -1.676134135204579e-02   -1.822682539696761e-02; +1.272530371925095e-01   +1.055335940113826e-01   +5.082555462753865e-02   -1.035562690587345e-02   +1.107432930688795e-02   -7.884716245469731e-02   -1.061480324279117e-01   -2.999887608275027e-03   -2.874609332731336e-02   +5.572836384893579e-02   -4.429147574596402e-02   +1.113280223018845e-01   +5.766415146554685e-02   -1.832043575096454e-02   +7.436418631517841e-02   +3.123690039451606e-02; -3.121534820822046e-02   +7.760624686473640e-02   +1.415613185200096e-01   -5.891564520523308e-02   +1.553760454910570e-01   +1.404559850564009e-01   +5.002350745716207e-02   -1.414123130352012e-02   +5.115662513294189e-02   +1.586997057461294e-01   +5.158886941496070e-02   +1.043486138756031e-01   -7.697724234067174e-02   +1.602267444922235e-01   +3.229352140084848e-02   -9.171455699013001e-02; +7.645303581926967e-02   +2.340366309292591e-02   -9.221315299684185e-02   -5.732371625923546e-02   +2.694515030451270e-02   -3.670096124714653e-03   +4.088545165164343e-02   +1.087407768749521e-01   -1.203522069452989e-01   -6.505633549367515e-02   +1.159651751176253e-01   +5.654092469275936e-02   +7.559706890662718e-02   -1.916124024350113e-02   +2.610090959241566e-02   +1.166610055185103e-01; +8.173107246053823e-02   +5.007989156061448e-02   +6.073898158226618e-02   +4.290360338804505e-02   +7.409936858790143e-02   +1.326233143095736e-01   -1.166604504944969e-01   -1.638967121544515e-02   +1.229708688020161e-01   +8.987934296469470e-03   -1.435586861684784e-02   +7.361656641620415e-02   -5.538421863605320e-02   +3.005516850295719e-02   +9.636862221649489e-02   +3.577858086063845e-02; +4.589900264527128e-02   -3.668680790577036e-02   -3.266815746859246e-02   -2.742174345109785e-02   -1.482267152516353e-02   -1.314689473686689e-02   +9.383475063777016e-02   -5.563485739313413e-02   +1.134527646452700e-01   +1.370184265867369e-01   -1.229287888236089e-01   -1.210899137690615e-02   -1.406838083518671e-02   +4.971231485935804e-02   +3.735763363874571e-02   +1.600522967466682e-02; -3.183441893517917e-02   +9.552612660945761e-02   +1.438696753522643e-01   +2.045443192326404e-02   +8.622615882645081e-02   +6.856709903011057e-02   +1.031192758300045e-01   +5.184820193173750e-02   +5.633576637206748e-02   +1.185420563742091e-02   -3.655270301265667e-02   -9.048336404934802e-03   +2.439219019162400e-03   -5.155374267367141e-02   +1.180800209162269e-02   +4.453597759085130e-02; +4.654661979357384e-03   +7.980081458150669e-02   +6.902306476050331e-02   +1.183169350061223e-01   +4.467655875259042e-02   -6.477275132898545e-02   -1.181012630422880e-02   +7.947317495169376e-02   -3.185800155142268e-02   -3.489235874388666e-02   +5.987415159625885e-03   +9.285975364388424e-02   -2.293052635985498e-02   +4.438215340531034e-02   +5.147854522129266e-02   +5.314378099939790e-02; -1.512707066235260e-02   +1.713675700834069e-01   +1.428336413895347e-01   +1.566400571915740e-01   +6.883326301730169e-02   +7.347426084736250e-02   -1.759262641901826e-02   +6.720604721457421e-02   -1.579701130564464e-02   -6.587426646095459e-02   +3.208163422402585e-02   +1.374360453912489e-01   +2.319775009659138e-02   -1.438886345694370e-02   +4.092848940845475e-02   +1.323226963254144e-01; +1.943163977624389e-02   +4.561105804784232e-02   -5.884131136275549e-02   +5.878128446728173e-02   +7.856821459497457e-02   +8.842769962866423e-02   -5.494840509589657e-02   -5.037523052146177e-02   -5.175642745235742e-02   +4.151749299757670e-02   +2.625711145316365e-02   +1.332982992692182e-01   +3.618101853199651e-02   +7.944761980947340e-02   -6.110625854210847e-02   +6.098834946288197e-02; +4.070073321606833e-02   +8.242090728097584e-02   -5.233853321104803e-02   -2.886234170466558e-02   +7.327170477120284e-02   -2.950164207665112e-02   -1.136924394926058e-02   -5.126186374510972e-02   +1.538805429645774e-01   +9.250589568121327e-02   -4.720449146755637e-02   +3.644213121529164e-02   +6.735500921801169e-02   +1.498914438501002e-02   +8.829450189852164e-02   +9.352437548618871e-02; +4.238203492730282e-02   -3.224048517485756e-02   +3.223580483912637e-02   +1.049662116534225e-01   +5.408510782682591e-02   +1.538393733592620e-02   -1.546351514843881e-02   +4.559913790817913e-02   +1.165074838551425e-01   +1.709901153578840e-02   +2.723653033488024e-02   +1.133571841766801e-01   +1.175455053351157e-01   +1.259290482403724e-02   -4.936836126177375e-02   +7.341864127231032e-02; -3.178190454483758e-02   -7.713527330302532e-02   -1.722866945739010e-02   +4.536934430177950e-02   +5.720203172148641e-04   +6.938234718430886e-04   +7.701700857434315e-02   +6.225677507007801e-02   -1.519840106086006e-02   +1.148489812230306e-01   +7.809737940931895e-02   +1.519375039916819e-02   -8.281308482227628e-02   +8.397769260991440e-02   -1.280107039848104e-01   +8.172035406992526e-02; +6.331159536456318e-02   -6.186743306169673e-02   +9.161619848744632e-02   +8.640430767390495e-02   -3.424038502314078e-02   -4.637995085101831e-02   +1.084621681813256e-01   +3.470257850394301e-04   +6.774606274234499e-02   +9.531737984442769e-02   -6.036045001334638e-02   +5.716856900506428e-02   -3.469300822419827e-02   +7.583300572918958e-02   -7.418381263118328e-03   -7.646893563269481e-02; -3.388842144177737e-02   +1.065172025611626e-01   -5.419614971337225e-02   +1.302176286226192e-02   +6.621949091235345e-02   +6.125158111653173e-02   -7.491747907694340e-03   -3.498601204623136e-02   +1.135031929287173e-01   +3.518487997084967e-02   -3.357490713482204e-02   +1.230542326633582e-02   +4.243471702645908e-02   -1.174811265888361e-02   -9.450259753832801e-03   +7.817986779529272e-02; +6.540889939732243e-02   +1.252895800720921e-02   -1.386877260862975e-02   +6.416652312869594e-03   -8.026333783698050e-02   +7.010722370752950e-02   +3.913302162368138e-02   +5.745239358332866e-02   -3.563676492502463e-02   +1.171279756698119e-01   -8.729526447020594e-02   +1.212103556895500e-01   +6.451730955315781e-02   -1.412198966337001e-02   +9.179422532613932e-03   +3.189790512217187e-02];
L2I_L1I_iGABA_netcon = [+1.680023749485649e-01   +8.409580000219537e-02   +7.351498055848407e-02   +3.597189899816945e-02   +5.396394884508101e-02   +7.970565317006570e-02   -6.827593882445095e-02   +8.574153395911381e-03; -1.399350556267078e-03   +1.013154968559391e-01   -4.457532339463535e-02   +1.302285243634939e-03   -1.161870783061153e-02   -7.705102820580606e-02   -2.645788152516697e-02   +6.392548423215252e-02; -2.797278380064653e-02   +8.950425112870322e-02   -1.706769724169885e-02   -9.106453272427603e-02   +4.547119421611140e-02   +1.223249324037669e-01   +1.537267486867357e-01   +2.852038471250959e-02; -5.423481303308749e-03   +8.438595705285282e-02   +2.929720786686602e-02   +1.196972830111111e-01   -7.402567797564966e-02   -3.272546470000010e-02   +2.714052960764669e-02   -7.030410197229119e-02; -1.167137852560547e-01   -8.130565493427905e-03   +3.085571837514888e-02   -7.890708986295172e-02   +9.303902594172235e-03   +1.233509637646952e-01   +1.002202726633887e-01   +7.675224775482145e-02; +9.235363894491788e-02   +4.832460163234389e-02   +5.452677811981373e-02   -2.833334769821808e-02   +8.045014872902800e-02   +2.231904227668670e-02   +9.306734334631797e-02   +4.582662001243785e-02; +5.576721731331745e-02   +4.413706021650349e-03   +5.458539316201921e-02   -1.500223170702865e-01   -6.129234981812786e-02   +5.907222543916701e-02   -4.661066777690767e-02   +1.107598045100246e-02; +6.131143972241825e-02   +2.100206686297863e-02   +2.885898518584849e-02   -1.327045856578476e-02   -4.576057474319509e-02   -7.536401238445703e-02   +4.607381321839661e-02   +1.001761791339800e-02; +1.495278510575705e-02   -5.094073491102091e-02   +7.857777828605039e-02   -3.523811165340877e-02   +5.766535216434432e-02   +5.515932304160395e-02   +5.663626763721671e-02   -2.947239410827526e-02; -1.230492135081380e-02   +9.562755536663795e-02   +1.047633209238915e-02   -6.185055620868018e-02   -4.731129089651429e-03   +2.007486404298665e-02   +8.633653854124905e-02   +3.997568828129199e-02; +3.966754315112210e-03   +8.411056728275967e-02   -3.964194933259388e-02   -1.619949330542360e-02   +9.207457877705733e-03   +4.972777833137178e-02   +1.192235623498702e-02   +1.508103752129613e-01; +1.249819858211421e-01   -3.351351910890309e-02   +1.285716409238765e-01   +6.772220041734456e-02   +1.628661872666019e-02   +2.645883066454063e-02   -1.876837403625919e-02   +5.565459221950304e-02; +3.117299040321148e-02   +5.932934122044599e-02   +5.908529375690846e-02   +6.190863983670178e-04   +2.568742127998476e-02   +3.120189588545968e-02   -5.295594143619176e-02   +5.774870270175477e-03; +9.572488071056681e-02   -1.048336159752664e-02   +8.015763426128903e-03   +1.066325513237784e-01   -2.078634215070502e-02   -4.017971290960969e-03   +3.702164534649070e-02   -2.830607854975389e-02; +1.304185636570214e-01   +3.133083357853059e-02   +1.341432177678628e-01   +1.314827625598163e-01   +1.551106801670785e-01   -3.435835546574922e-02   +5.483099404141711e-02   +2.859024498868789e-02; -3.977368052537442e-02   +7.526170427263812e-02   +8.512702075911066e-02   -2.649696935556924e-02   +1.161960943734411e-01   -3.629997606914612e-02   +1.027876867905027e-01   -5.044857925302716e-03];
L1I_L2I_iGABA_netcon = [+7.479292920665870e-02   +1.148089902428251e-01   +3.467982207578207e-02   -4.776827111463558e-03   +2.332923768725553e-02   +3.798826126004395e-02   +9.544136080633470e-02   -1.991508145871593e-02   +4.764383725135422e-02   -6.142439505222513e-02   -7.569397821467758e-02   -2.319612387137432e-02   -2.030265956385829e-02   +8.040500009081003e-02   +1.161621031307987e-01   +1.169567962805129e-01; -3.774589910605870e-02   +7.204832033095376e-02   -8.833752931207203e-02   -7.344623110620949e-02   +4.537416679177824e-03   -8.270197112215265e-02   -3.283752986067726e-02   +7.281193210351710e-03   -6.496266599841576e-02   -1.597274222600201e-02   +3.520788237174192e-02   -4.856799718066043e-03   +8.300526809427300e-02   +5.035464407119912e-02   -1.016066445100998e-01   -5.438044074751805e-02; +2.871650433835035e-02   -4.051754551294448e-02   -1.263904843086186e-01   +1.228611773455319e-01   +1.775010690306241e-02   -4.417028854434863e-04   +8.477174865302334e-02   +7.098160175955798e-04   +2.776179370274263e-02   +3.776727462361242e-02   +6.815052199695744e-02   -2.168968306641794e-02   -3.560209636305001e-02   -1.194225580284921e-02   +5.988109772010177e-02   +1.249382017768062e-02; +8.883675747475686e-03   +2.467677989572940e-02   +4.828292879012930e-02   +3.380921018524104e-02   +6.147860559627792e-03   -9.254078600886936e-03   +1.637228111835285e-02   -3.223894945541716e-03   +1.827613889566256e-02   +3.659966769000529e-02   +4.799261543049757e-02   -3.299992643212350e-02   -1.804321207406825e-02   +2.850165127810277e-02   +1.138506315318334e-01   -2.680423435527004e-03; +1.033249682768033e-02   +8.596261011674039e-02   +3.514287898942931e-02   -7.474751191054013e-02   +1.142486454824455e-01   -9.148399498176769e-03   +3.703533072978615e-02   +1.541507297320842e-02   -1.947044917852818e-02   +5.209982614129159e-02   +2.583098386209574e-02   -1.174549237117980e-01   +1.072157759623301e-01   +2.134434367628491e-02   -1.298095000940846e-02   -8.175551210941551e-02; +9.185686627968516e-02   -6.432457408169551e-02   -6.896581693013611e-02   +1.015452198173335e-01   -4.703589551763167e-02   -1.624344198813726e-02   +6.749918580721409e-04   +1.388988712315224e-01   +7.724956627702063e-02   +2.758305802979473e-02   -2.404999864034392e-02   +1.430096229020948e-01   +6.649890632096506e-04   +8.051056031756193e-02   +3.791872285658956e-02   +8.594610929058807e-02; +4.870080580248853e-02   +8.937542039139906e-03   +2.916890407666525e-02   +3.554608730573507e-02   +1.284456190702838e-01   +1.463317443329371e-01   -2.921930985792899e-03   +3.367899703836415e-02   +1.010349376617117e-01   +7.332641758247507e-02   +2.532056362996594e-02   -3.845887931023009e-02   -1.187558465030551e-01   +1.118364425627792e-02   +4.496496034696765e-02   +4.910812169809739e-02; -7.721978565550090e-03   -4.101339787674414e-02   +4.241349318499849e-02   -9.437175640436714e-02   +5.442766321910909e-02   -2.485177383531352e-02   -6.020677273904414e-02   +9.026806070156851e-02   -4.407408587565513e-02   +1.220373002561901e-01   -3.373383587509997e-02   +1.888262734642424e-02   +2.336504299338905e-02   +6.699241028251904e-02   -4.580373977971190e-02   +3.882803165881109e-02];
L2E_L1E_iAMPA_netcon = [-8.620880219156292e-02   -3.207800437494204e-02   +2.900346026483527e-02   +7.996019177587757e-02   -1.031030598932003e-02   +9.802352826831885e-02   +3.360333454845194e-02   +3.074308633057611e-02; +7.231881102565031e-02   +5.227906780947641e-02   -1.987023622631302e-02   +2.346133851236518e-02   +1.205081397489552e-01   +2.313174980984999e-02   +4.514039035268014e-02   -7.249425301749753e-02; +1.073396147476388e-01   -1.593189827331981e-02   -9.467551499499013e-03   +3.021273854867036e-03   +6.614328165724867e-03   +1.042327071120919e-01   -8.218161752960920e-02   +7.887341161065788e-02; -7.099082484166713e-03   -9.508260215443448e-02   +1.239396010997357e-02   -3.062054101402796e-02   -7.820438531886126e-02   +6.847282145062643e-02   -2.050283654466228e-02   +6.997362809175957e-02; +1.524731849746550e-03   -4.508003244144296e-02   +6.792442518025535e-03   +1.045463113121683e-01   +1.133818318670794e-02   +3.503384038229339e-02   +8.449493477098532e-02   +6.380877480580950e-03; +5.093286111503351e-02   -1.026204695293056e-02   +1.074115538379536e-01   +6.067153641518147e-03   +1.612178290315797e-01   +1.692259524849739e-02   +2.001251033128186e-02   +2.222772286994802e-02; -7.437094827293635e-03   +7.395015970196796e-02   -6.871690994427726e-02   +5.339544517828870e-02   +9.719450428391155e-02   +5.912101351264654e-02   +3.693186704090700e-03   +1.570224132327725e-02; +7.746592607370575e-02   -1.601483477150767e-02   +9.519216928524296e-02   -1.965874251612162e-02   +9.033241260677131e-02   -1.183393950015284e-02   -1.676416629064142e-02   +1.896522947958117e-02; +2.416533322352867e-02   +2.061946844810712e-02   +3.246310369276438e-02   +1.033706702715454e-01   +9.381985394721624e-02   -9.832431384882462e-03   -1.813955182894005e-02   -3.709121698788061e-02; +3.731672274836603e-02   +4.909838399888614e-02   +6.051364954409399e-02   -4.274262110768170e-02   -6.166075202741706e-02   -9.124809116434504e-02   -6.240895205564248e-02   +2.003352853834083e-02; +2.276114547508567e-02   -9.755959170508477e-02   +3.575969554670352e-02   +5.065707556120184e-02   +1.061134344070946e-01   -6.234532634038184e-02   -6.916155184210267e-03   +6.490325404305823e-02; +9.045064929280099e-03   -6.845724713667131e-02   -1.163007142263556e-02   +5.337656293204711e-02   -6.689097609299083e-02   +3.050980887088946e-02   +1.024229264655386e-01   +1.548162174163783e-02; +1.107276400690774e-02   +1.326498236751135e-02   +3.976216763528000e-02   +1.234507980651510e-01   +1.226564513870829e-01   +1.155053790865916e-02   -3.645874326882050e-02   +7.756430024710280e-02; +5.412943691656401e-02   -8.213017518484966e-02   +1.038983422772838e-01   +6.896776312693673e-02   +6.658695701094838e-02   -7.927444749924663e-03   +3.191247446919286e-02   -6.786351122377914e-02; +3.921142544885799e-02   +1.068617591447068e-02   +8.918204956689850e-02   +1.744156314082948e-02   -1.418153117925707e-02   +2.175923900768358e-02   +1.371986637797371e-01   +4.231617192331840e-02; +1.094509439899512e-01   +7.008820952084288e-02   +1.615582667295218e-02   -1.126691376739840e-02   +1.363002005128625e-01   +1.211836228132511e-02   +1.022203702933554e-02   +2.204546303992983e-02];
L1E_L2E_iAMPA_netcon = [+2.382169023604534e-02   +2.557900129733321e-02   -9.147912419835480e-02   +3.699566195051204e-02   +5.303911210794827e-02   +5.192940376780355e-02   -2.137711996659668e-02   +8.235403681745820e-02   +5.289642655586180e-02   +6.318041357178709e-02   +1.774365573918121e-01   +1.875846543392903e-02   +5.219184917710398e-02   -7.235700061722219e-03   -3.477678704316436e-03   -2.434140076254735e-02; +3.546674768716521e-02   +5.384260373931310e-02   -2.094922032857859e-02   +1.541554606059660e-02   -1.237701786340443e-01   +6.517341185291330e-02   -3.403797250906838e-02   -2.224816115928874e-02   -5.472878174292005e-02   +6.235707816052732e-02   -7.231421459288723e-02   -9.098371548103132e-03   -2.905432039789616e-03   +6.426482870704776e-02   +5.533974052605616e-02   +3.023893410352462e-02; +5.598750691432975e-02   +1.041644773633275e-02   +8.824402856637284e-02   -6.395120161927922e-02   +9.704783392534279e-02   +5.412765872081444e-02   -9.832870562307769e-02   +6.174554318386988e-02   +4.711349077011886e-02   -8.213572762803710e-02   +7.622705112290726e-02   -3.509135942464518e-02   +5.688555773878325e-02   +4.147241495448412e-02   -3.517144927465537e-02   +1.610329983741264e-01; -2.202065733372459e-02   +2.736352623354566e-02   +3.135873392691490e-02   +6.011919782648206e-02   +8.408326444179916e-02   +8.342878797319703e-02   +4.064069494831082e-03   -3.144270760185307e-02   +7.051534784347788e-02   +2.350361987362032e-02   +6.187107696846358e-02   +5.504405970443751e-02   -3.476136202618213e-02   -1.657844848911830e-02   +9.455972264278056e-02   -7.911835144186168e-02; -9.665234342089821e-02   -9.202585194275541e-02   +5.930539827355856e-03   +4.894460519285648e-02   +3.806107219930787e-02   +1.056857637734934e-01   +5.931555059977946e-02   +1.266860103383469e-02   +2.218361054627092e-02   +6.880925976208069e-02   -3.098423854881505e-03   +1.210293536717543e-01   +9.425725610742475e-02   +5.943851259820700e-02   -1.050172172059421e-01   +1.313487248732410e-01; +2.320372316358406e-03   +8.323730816112124e-02   +3.109153700215935e-02   +8.591583081100621e-02   +1.070840475841291e-01   +3.093218628101208e-02   +1.370098660545940e-02   +1.950489618162635e-02   +8.358985693140319e-02   +3.883223181886639e-02   +8.430674572191330e-02   +7.954949111798496e-02   -6.700622717942309e-02   +1.077144336004799e-01   -3.891931045827559e-02   -4.670423515579731e-02; +4.704406223879957e-02   +5.642687281176487e-02   +3.379591585157226e-02   -2.683077661982267e-02   +1.001349253546688e-01   +1.694693328033969e-02   -4.638337315897294e-03   +4.801811522648203e-02   -2.692677186813931e-02   +1.018562661320783e-01   -9.156410082373900e-02   +1.919341905214926e-03   +3.379127896583010e-02   +6.518857400424821e-03   +1.147917161084796e-01   +3.255770157276937e-02; +3.045326852123347e-02   -1.105326419165449e-01   +1.157494175466733e-02   +9.766020576004984e-02   -2.906191777968325e-02   +2.685529998682074e-04   -1.998515752391400e-02   +1.835024192979006e-02   +3.083046381491199e-02   +1.170746764030118e-01   -4.440810852208163e-02   -4.012852739039757e-03   -6.592651729575905e-02   +5.654546505693590e-02   -6.245546795186908e-02   -4.818425597019525e-02];
L2I_L2E_iAMPA_netcon = [-5.935693730575477e-03   -4.706596801817717e-03   +9.620994330285876e-03   +2.886293629473092e-02   -3.702773883616902e-02   -4.740097659867605e-02   -8.562917783078793e-02   +2.722832091812002e-02; -3.446084980466076e-02   +5.939283191231733e-02   -4.819887581306050e-02   +1.073232388094193e-01   +8.740700589604435e-02   -5.564953676873455e-02   +1.856132221147961e-02   +5.212421581768104e-03; +1.178255152187925e-01   -9.516350373709415e-02   +8.617674131113626e-02   -6.944342368819173e-02   -5.261366338249231e-03   +4.113983374044978e-02   -5.847197832013824e-03   +4.919081160510363e-02; +8.672366203067906e-02   +3.029191378422934e-02   +4.891161643794786e-02   -7.128824295667421e-02   +6.437452741382106e-02   -8.233807285169006e-03   +1.192659088198122e-02   +8.524720754625988e-02; +7.675859779988670e-02   +9.289096630212559e-03   -7.356578062349838e-03   +1.251203851841545e-01   -3.459617656478639e-02   +8.280958378954834e-02   +2.870239114315030e-02   +8.493221071635787e-02; +7.722968705156692e-02   -1.424607588614780e-02   +1.909250874159419e-02   +7.603908989775124e-02   -6.538919871142923e-02   -7.829064243917552e-02   +3.391568862649127e-02   -3.022536053541757e-02; -3.193358016090328e-02   +8.970559266086306e-02   +6.116000268195830e-02   +3.977578926941172e-02   +7.390853768934835e-02   -9.056246151250262e-02   +1.166255371138045e-01   +1.436590001581086e-01; -8.739704749926554e-02   +1.440900900913537e-02   +2.838558582069368e-02   +7.483892750733942e-02   +1.222522740352831e-01   +7.403971574844093e-02   +8.368300572783234e-02   +2.611080018805000e-02];
L2E_L2I_iGABA_netcon = [-6.572163927280786e-03   +2.889459128447790e-02   +7.973108230287584e-02   +6.875372180052031e-02   -1.193534188987460e-02   +3.399271330722317e-02   +5.921136569446801e-02   -2.506377792196629e-02; +4.338806728512044e-02   -2.508142235891346e-02   +8.920818603854483e-02   -1.362528473773033e-03   +8.940358054741572e-02   -6.084913734929658e-02   +1.007521173972460e-01   +5.605604502808374e-02; +1.133234349377664e-02   -6.803645006847953e-02   +1.730990960814282e-02   +5.197559713213932e-02   +3.648201828582597e-02   +7.410372702855152e-02   +4.422028076595864e-02   +5.678679173075525e-04; -2.780608555465188e-02   +1.009330205888288e-01   -4.853238035154325e-02   +2.175481464790543e-02   +4.336602498115514e-02   +8.889891137198308e-02   +1.413324609594499e-01   -1.460821497975916e-02; +1.550588940912118e-02   +5.298443341444692e-03   +9.863727501401298e-02   -1.588720469223193e-02   +2.075721307006775e-02   -3.363358507038288e-02   -3.415339418489081e-02   +2.874167332659949e-02; -9.156408585174747e-04   -6.196753203887287e-02   -2.481352157942272e-02   +7.407100610082300e-02   +1.588760818237034e-02   -4.510309613565353e-02   +3.669454655881293e-02   +3.548019377988637e-02; +2.591465438171704e-02   -2.098312115056298e-02   +3.398941047528787e-02   -2.128356322334820e-02   +5.161740958972785e-02   -7.171931383191099e-02   -1.240326774910345e-02   +3.636337984123354e-02; +1.525210612114184e-02   +4.303153801259316e-02   +1.446574575372815e-01   +8.717466322416625e-02   -3.604790057077258e-02   +2.580978053581629e-02   +1.175686845644671e-01   +2.595212755417461e-02];
L3E_L2E_iAMPA_netcon = [+6.492698555932151e-02   -1.036410160056913e-01   +4.437016572204922e-02   -5.520174129439773e-02   +8.395422707564391e-02   +3.215355630006084e-02   -1.289936962971223e-02   +1.072132913937212e-01   -2.463941533089290e-02   +3.622858937412532e-02   +7.232029035292795e-02   +9.525703706567679e-02; +7.956323112475788e-02   -5.047764000735425e-02   -6.641037648807160e-02   +9.776641638816075e-02   -8.975104529159555e-02   +6.401051096332928e-02   +8.935750984505263e-02   +6.553411467683722e-02   +2.144392717027324e-02   +2.096334574245953e-02   -1.623048406330220e-02   -3.520220186214260e-02; +3.360941880052130e-02   +3.298662494640118e-02   -2.944032932335069e-03   +1.324884998529919e-01   +3.453014560292866e-02   -5.550003311062490e-02   +8.112617576361504e-02   +3.017613509901678e-02   +1.090390902704780e-01   +8.355414774813098e-02   +2.940652042961685e-03   +2.676723362310699e-03; +1.526271289129418e-02   -7.379773686076799e-02   +2.870524947740490e-02   +9.395297835309305e-02   -5.937772832006058e-02   +2.485171907542501e-02   -3.530608549942272e-02   +8.950253240295250e-02   +3.730436291850078e-02   -9.356068113673349e-02   +1.429864644623232e-02   +1.200275418849096e-01; +1.421964696579810e-01   +3.484784902067740e-02   +1.027249302377846e-01   +2.096313360565924e-02   +5.980299537616943e-02   +4.261773890217350e-02   +3.982284395751373e-02   -4.820791182562695e-02   -4.950485332869513e-02   -9.372489405174747e-03   +2.810140519450988e-02   +7.133950304645448e-02; -1.004621910632529e-01   +6.825291256030522e-02   +7.857920393399517e-02   +7.314974617527434e-03   -3.046179560417146e-02   -3.822658117389538e-02   +3.187299732608673e-02   -8.482548460033025e-03   +4.391525034686768e-02   -2.114803526266375e-02   -3.558046590062398e-02   +1.221897705733459e-01; +1.506356536440750e-01   +8.211161612856306e-02   +7.665567390679551e-02   +9.204650250467922e-02   +1.649485881654325e-02   +5.717486051235819e-02   +1.714316655366754e-01   -2.235809106318484e-02   +4.646884831464547e-02   +9.903890037770122e-02   +1.045420902532730e-01   +5.592070193545409e-02; +6.180686619281690e-02   +5.003728906420914e-02   +1.465833725602997e-01   +3.026520402670992e-02   +4.395747857597997e-02   -3.634587502291995e-02   +1.588921672895806e-01   +9.484996431632857e-03   -8.478233579672501e-02   +1.062117952359182e-01   +2.686417164710964e-02   +4.103089540965699e-02];
L3I_L2I_iGABA_netcon = [-6.383282418535610e-02   +5.536069180608849e-02   +1.501821588040450e-03   -5.146036812276727e-02   -3.086032310184257e-02   +2.168306153904358e-02   +1.174424181032123e-01   +9.968786338324112e-03   +2.549078203292503e-02   +5.745438195227374e-02   +1.333084827974562e-01   +4.437781014212792e-02; +9.710242820932703e-03   +9.247254360503315e-02   +1.071821027135918e-01   +1.126511762402723e-01   -6.430110303699919e-02   +1.388991889789857e-01   +1.328358767050482e-01   +1.069172935470956e-02   +4.703747313415694e-03   +4.961133892069619e-03   +7.580105803463189e-03   -7.960277894382625e-03; +3.749034134977267e-02   +2.123067014287122e-02   +7.796307577639609e-02   +1.043167066013892e-02   +9.540614973157746e-02   -6.624198155555157e-02   -1.801041828951221e-02   -7.054065825654295e-02   +1.303380270499916e-01   -5.719471827370197e-03   +9.807766959641241e-02   +5.510196115897294e-03; +2.646375545020792e-02   -3.660821006630972e-02   +6.137091321280647e-02   +6.600819626405677e-02   +1.712953311783616e-01   +2.108599924315793e-03   -3.244373404145964e-02   -2.223550720922254e-03   +1.012206296565882e-01   +5.169571971806998e-02   +6.569629789587668e-02   +2.596869760160626e-02; +7.762438250438940e-02   -4.994532604169574e-02   +1.198417159452459e-01   -3.719704473976068e-02   +3.508519656987436e-02   +7.045973555482132e-02   -1.951556919364674e-02   +3.113321380125549e-02   -4.263216175570255e-02   +1.014092956295676e-02   +8.316683230391589e-02   +3.096689494727968e-02; -2.777520250960997e-02   +6.227973495527351e-02   +6.864092350321181e-02   +7.179746125481963e-02   -8.298392356307312e-03   +4.263595731391476e-02   +9.651574432911786e-02   +9.936193276010914e-02   -1.379401906888717e-02   -5.356439060096488e-03   -2.675151224808797e-02   +3.727363552163888e-02; +1.418435793537675e-01   -3.023407312415707e-02   +8.898124371714032e-02   +1.838294616389871e-02   +8.625560792531985e-02   +1.133892427836815e-01   -8.733152570765984e-02   +2.988581797268015e-02   +9.304197260373853e-02   +5.183393293252631e-02   +6.546324688565372e-02   -8.272224679148062e-03; -5.378469772728066e-03   +2.163893362125664e-02   +3.632343509903874e-02   -1.752026826487416e-02   +2.665964693626404e-02   -2.909750553785372e-02   -5.698551862435688e-03   +9.382514142607225e-02   +9.273536249181152e-02   +7.494252918058295e-02   +6.847438411606541e-02   -1.167432981442686e-02];
L2E_L3E_iAMPA_netcon = [+2.234362180701306e-02   +5.945916926231726e-04   +1.334676152810047e-02   +1.479713467202714e-02   -9.361618403932371e-03   +1.347667436379695e-01   +1.264333109091122e-01   +1.364258500747458e-01; +8.753571641817329e-02   +2.411394728927860e-02   +2.731232584076444e-02   +1.031389915222056e-02   -3.260872181277514e-02   +5.291840408412356e-02   +7.994857490295995e-02   +4.865880267710303e-02; -5.708931861740527e-02   -2.227764294336169e-02   -1.057983236233170e-01   +8.059067059886854e-02   +1.401740547836184e-01   -1.918332130650998e-02   +9.435422812462366e-02   +1.357362026163710e-01; -3.294571638265993e-02   +3.481597377950534e-02   -6.766017693117424e-02   -2.665551723369570e-02   +7.353220717182238e-02   +6.555742806082221e-02   +9.088787778277276e-02   +7.618604051586648e-02; +1.004022737627615e-02   +2.861284693334840e-02   +5.091552225630503e-04   +6.178694439922065e-02   -3.828116851518584e-02   -4.822227274397435e-02   -5.399255985292500e-02   +2.884949306866707e-02; +4.068040720045060e-02   +5.313499193803806e-02   +1.088572365854367e-01   +8.795851576339633e-03   -2.050738498583541e-02   +2.087016830683004e-02   +3.922469898086502e-02   +3.348450495968283e-03; -7.752491769767338e-02   -6.465404138322445e-02   +1.038921273565281e-01   +1.015529129478336e-01   -3.946164397303340e-02   +3.462045834971928e-03   +7.631547382197709e-02   -2.166364342896649e-02; +5.554662170265191e-02   -6.975129842599090e-02   +1.725519767228816e-02   +3.775217881162625e-02   -2.593439323596061e-02   +7.760307470477354e-02   +4.214761728812529e-03   -3.434635977627928e-05; +6.435086940226492e-02   +5.865835484678219e-03   +1.014459384267346e-01   +5.358990640822476e-02   +2.466048150540295e-02   -4.959145324262664e-02   +1.024021865473573e-02   -3.661352104479720e-03; -3.700028486614124e-02   +5.842724377138803e-02   -6.848632639892455e-02   +2.112710084118095e-02   +1.085096425676776e-01   +3.017248114962985e-02   +3.918606868196294e-02   +4.052783667282148e-02; +1.052266973380048e-01   -1.825139949485940e-02   +8.757577583526709e-03   +9.410260578751706e-02   +7.385398966348640e-02   +4.167800076422822e-02   +2.979271001507254e-02   +1.267600853851749e-01; -1.230418996666771e-02   +6.875733937206445e-02   +5.107255802698479e-02   -2.878623001448596e-02   +2.616939026268394e-02   -5.754743392587505e-02   +6.299286361313572e-02   +7.997381761268924e-02];
L2I_L3I_iGABA_netcon = [+5.781711937535985e-02   +7.144800230997043e-02   -2.054706584313666e-02   -4.256660832132622e-02   +1.069648130616030e-01   +1.455157275332086e-01   +6.421059603073540e-02   +9.572612084736409e-02; -3.408196416669365e-02   +2.010246041826976e-02   +1.175519586051736e-01   +8.587494981023100e-02   -5.563841402334978e-02   -5.545165305021835e-02   +1.423393783043982e-01   +3.459297561072233e-02; +1.370404883278329e-01   -1.537474243234904e-02   +6.438275189569211e-02   -1.392351767374001e-02   +7.886361668674158e-02   +8.493011616173043e-02   +2.992363226533711e-02   +1.250420724910213e-01; +1.447610487814072e-02   -1.123560708142711e-01   -3.758261276192171e-02   -1.529500389226317e-02   +8.241945415340627e-03   -1.978042840978599e-02   -2.058704886525112e-02   +5.334420832305108e-02; -1.254899690867840e-02   -1.428492300198885e-02   +4.511473101773030e-02   -7.458114224230623e-02   +2.293688540260283e-03   -1.729206996210467e-03   +3.945735435166019e-02   +2.739796103790993e-02; -1.013243142156023e-01   -2.925669662064489e-02   +1.187517732555740e-01   +4.694883065308324e-02   +3.192263464524622e-02   +9.673939111887024e-02   -7.516040936138119e-02   -4.234746564810712e-02; +6.577250898729219e-02   +1.039945357826144e-01   +1.555865164887848e-01   -2.233407516350010e-02   +9.154648390569241e-02   +1.384572594951720e-03   +6.649595434772501e-02   -1.109682913614088e-01; -4.536111828692305e-02   -4.332141851227803e-02   +3.163714222331120e-02   +1.564608309557181e-04   -3.779257985366243e-02   +3.643417365237960e-02   -1.923246435177078e-03   +5.383449602935962e-02; +6.857526224362261e-02   -4.114917131909067e-02   +1.511774651581962e-02   +1.145504797525544e-01   +2.078154233550878e-02   +5.839492308389525e-02   +1.169626966668631e-01   +5.474052758564791e-03; +2.887046678217677e-02   +5.782661748953242e-02   -7.120084061620671e-02   +3.986912277673976e-02   +1.071178459945015e-01   +7.582003372913218e-02   -8.945651290459974e-03   -2.953613702053884e-02; +8.981186595231055e-02   +6.037845025590018e-03   -4.349840784374709e-02   +8.746318218814175e-02   +2.392935051732372e-02   +6.255082796260436e-02   -7.317855301521521e-03   +9.646688544480141e-02; -1.505048274638904e-02   +9.356109793357377e-02   +3.810508353156782e-02   -7.999417411929319e-04   +3.088726178568663e-04   +5.436219853293052e-02   -1.085999919910825e-02   +7.800017591467802e-02];
L3I_L3E_iAMPA_netcon = [+2.497168182954174e-02   +4.268569117820264e-02   -4.037312197542549e-02   +1.112793605901641e-01   +3.454469710461065e-02   -1.554686858531052e-02   +1.118672553567870e-01   -7.544047802589132e-02   +8.608831831817593e-02   -2.494903091896208e-02   +6.002914395727138e-02   -2.467172321681507e-02; +9.817813024687666e-02   +9.712503480598836e-02   +9.005187151921179e-02   -3.556416382811518e-02   -6.199278645185256e-02   +1.095577276231027e-02   +1.107539066434607e-01   +1.347728254746141e-01   +3.056767910460876e-02   +5.638736191199038e-02   +5.508378456202624e-02   +1.430411721145644e-01; -2.921818936885133e-03   -1.767382879361526e-02   +2.667676760018942e-02   +3.370711908501944e-02   -2.793486487341995e-02   +6.207176309622865e-02   -9.600056692026432e-03   +2.599993989731186e-02   -1.551126958450196e-02   -4.438064264517187e-02   +2.988203216647358e-02   -3.431043040734728e-02; +2.111407466009915e-02   +6.681170008911939e-02   +1.599269406060891e-02   +8.729786554693622e-02   -2.822571801049098e-02   +1.489738838844338e-02   -6.204279878923905e-02   +8.403276412259177e-02   +3.034158104248756e-02   -1.989380576936035e-02   +1.043815627499855e-01   -4.172354666026051e-02; +5.920035707046027e-02   -3.420361133182948e-02   -6.425177478115481e-02   +3.329376088146814e-02   -5.472268993452266e-02   +1.764317962805232e-02   +4.932831414730507e-02   +4.322522701289395e-02   -5.901278461718945e-02   +2.908816904581828e-02   +5.802592329570253e-02   +1.997553707901865e-02; +4.566459114980878e-02   +9.296615868507797e-02   +4.418780360521049e-02   +4.585229399387738e-02   +3.834126439011820e-02   +6.122409781013112e-02   -4.510500008661670e-02   -5.270261219196536e-02   -1.054959172825924e-02   +4.558973604004781e-02   -1.674019670958381e-02   +1.626746688121309e-01; -2.675762405830360e-02   -2.522546332385918e-03   +7.590185946314904e-02   +7.369694566213120e-02   +5.641553022311297e-02   -8.904044520818152e-03   +2.871882409073922e-02   -2.294895209393327e-05   +4.137483883707636e-02   +1.236705183150941e-01   -9.249788918768070e-02   -1.817109542316823e-02; +1.992656545125737e-02   +6.391184673108065e-02   -2.416940265176544e-02   +3.591773792715018e-02   +7.166702243647287e-03   -2.320612179517284e-03   +1.221509784873218e-02   -2.381849848402897e-02   -1.857842018574674e-02   +3.484403341295919e-02   +1.152276276247234e-01   +5.830296921914598e-02; +1.587171529201833e-02   +6.689072324636494e-02   -5.930899886265592e-02   -3.543689141507857e-03   +3.743445194527981e-02   -4.993192995587431e-02   +2.204647838699293e-02   -2.621669481035795e-03   +9.370673973587040e-03   -1.626341022690284e-02   -3.320223713325064e-02   +1.587362139542851e-02; +1.201259850574412e-02   +1.338303475379043e-02   -8.057986170555722e-03   -2.356477228652472e-02   +1.900302173371189e-02   +1.591089469408073e-01   +3.538868260625269e-02   -1.419023483626334e-02   +3.514188583097405e-02   +7.258096040800448e-02   -2.659181710638000e-02   +9.280130749794901e-02; +5.377033373513802e-02   -4.640061307875817e-02   +6.582860343420413e-02   +1.348619775374837e-02   +6.444530006973036e-02   +6.008372491658946e-02   +6.058999700985238e-02   -7.174116949380042e-02   -3.734086510593437e-02   +2.592543250655484e-02   +1.062173693736931e-01   -9.015606304466513e-03; +9.462052594105333e-04   -3.985258006079764e-02   +9.598125784922590e-02   -6.617182606502986e-04   +1.249834210138899e-01   +1.046674325462428e-01   +1.276753248854338e-02   +5.121318586152841e-02   -4.881445708776763e-02   -4.116905044137888e-02   +2.178656655791181e-02   +5.113207326626276e-04];
L3E_L3I_iGABA_netcon = [+6.537747372456909e-02   +6.437020340657050e-02   +7.224532656511048e-02   +8.844006268134412e-02   +4.538034093794635e-02   +9.378361909438787e-02   +8.675227455576068e-02   +9.195804539902264e-02   +8.246589681885814e-02   +7.579473587214357e-02   +5.345488314074999e-02   +3.816222090903563e-02; +1.212408575130375e-01   +5.806267163854988e-02   +3.488177117343435e-02   +1.281856637029057e-02   +4.973795687697635e-02   +1.755202284819693e-01   -8.011585884931609e-02   +3.948195955756313e-02   -1.561110325401783e-02   +8.170824334982429e-02   -1.335728296219392e-02   +7.158935829842680e-02; +5.046274465115997e-02   +1.098952249736841e-01   +5.045346699544690e-02   +4.081981800471529e-02   +7.954088331973765e-02   +5.566703321917654e-02   -1.688725419071666e-02   -5.348905796122554e-02   +4.399231889129156e-02   +8.466296475848713e-02   +1.276786005188063e-01   +2.616719390798150e-02; +7.537069180154435e-02   -8.022271160133282e-02   +9.323776183907242e-02   +6.365325603537511e-02   +1.631230483247961e-01   -9.306360489447609e-03   -4.345058700332614e-03   +8.827226668549223e-02   +6.808229676604362e-02   +7.025699227665350e-02   -4.582399927458301e-02   +7.086314378906050e-02; -2.761052909883956e-02   +6.229737900635934e-02   -1.055403886903122e-02   +7.970760117365000e-03   +2.105415479882797e-02   +2.397190467284839e-02   -7.025894461152919e-03   -5.408033473456265e-02   -4.050237403411147e-03   +5.020734167951990e-02   -7.282011049838578e-02   +2.047796065081134e-02; -1.001050740772785e-02   +1.596167710157255e-01   +1.113689487670197e-01   -5.631436855729156e-02   +1.249734432320500e-01   +7.075643981666284e-02   +4.593744433153588e-02   +3.307444773451131e-02   +2.952035833242182e-02   +5.567232468970108e-02   +8.539220009943861e-02   -2.613966656499551e-03; +6.062141029904607e-04   +6.974168706980195e-02   +2.777069081661674e-02   -1.257406519286145e-02   -7.489664746956501e-02   -2.661886601908520e-02   +4.681865490919233e-03   -3.732599166896486e-04   +1.233881344882812e-01   -1.264931964697783e-02   +2.971417102624929e-02   -8.322371932032774e-02; -5.302394240339084e-03   -3.417170250067311e-03   +1.288487104281915e-01   +1.006408560670189e-01   -3.110980287414158e-02   -4.691351947002628e-02   +2.930030691287827e-02   +1.099720248598694e-01   +7.447003889318493e-02   -3.930423212126007e-02   +1.559706931345760e-02   -4.163693372396468e-02; +4.207693921654874e-02   +6.777022638199133e-02   +1.016513802698486e-01   +1.571814564315599e-03   +4.563032654928251e-02   +5.934673168542667e-02   +6.809971907892343e-02   -3.872682224718752e-02   +2.928089132821400e-02   +7.206692285118524e-02   +2.338643817620165e-02   +6.756206855466269e-02; +9.303247774048205e-02   +2.592175281851529e-02   +6.471755116406136e-02   +4.552304689198372e-02   +1.326041216012486e-01   -1.743297671262718e-02   +7.903849777146343e-02   -2.656942767760396e-03   +2.913536675566694e-02   +5.270854965448955e-02   +2.897268994157400e-02   +5.998814575993126e-03; +5.140789320340076e-02   +6.593811725526917e-02   -5.476252825921893e-02   -6.292879997727985e-03   +7.571058941670157e-02   +5.060675615481199e-02   +6.130154869528803e-02   +1.487371162156435e-02   +2.881212473012680e-02   +1.143993386089499e-01   +8.834588179103767e-03   +8.949618597193145e-03; -1.653365305398045e-02   +8.498572280408513e-02   +4.062777944412800e-02   +9.083761486175025e-02   +2.139215155740572e-02   -6.037160602607100e-02   +2.497516960996592e-02   +5.612971571425786e-02   +5.217968954098719e-02   +3.942644037198768e-02   +6.573596560450030e-02   -4.984724474732173e-02];
L2E_Input1_iAMPA_netcon = [+9.508930763360691e-02   -1.021293231634129e-01   +9.701251697268115e-02   +9.976775730400611e-02   +8.294720507477546e-02   +9.760073361987952e-02   -5.129935369977230e-02   -1.027473793317738e-02];
L2I_Input2_iAMPA_netcon = [+1.645120876748437e-02   +5.493758318579515e-02   +5.467378756745098e-02   -1.779904506835109e-02   +2.252265737568694e-02   +6.836129186315651e-02   +3.560664482485767e-02   +5.360337396146334e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
