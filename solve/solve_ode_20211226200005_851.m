function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.573942615520093e-01   -1.831567666647848e-01   -8.698127050918845e-03   +3.704855096205321e-02   +3.119575378804722e-01   +3.503135502920213e-01   -3.372104257650999e-01   -2.131459663445621e-01   -4.265274409241737e-02   -1.883823776277719e-01   -1.339756129906575e-01   +6.992920314436379e-03   +3.297588121938691e-01   -2.738051024725845e-01   -1.199741940062895e-01   +4.906205931962630e-01; +3.481202052601515e-01   +2.435642535791713e-01   +4.676233223776312e-01   +1.966347586921702e-01   -6.711453132588677e-02   -1.435457757262877e-01   +8.279937340017371e-02   +3.305591528622893e-01   -3.754051724765287e-02   +1.124366478847200e-01   +3.970345491721609e-02   -1.439970899854100e-01   -3.477175036341395e-01   +6.887668314222331e-02   -1.108231232902223e-02   +1.904152361973858e-01; +1.270244541327963e-01   +2.231944346422838e-02   +1.805558192922873e-01   -2.529153314399224e-01   +7.008448978718931e-01   +2.272041274136086e-01   +2.219689535135344e-01   +4.979122471570750e-01   +2.494018667841219e-01   +2.302071856471354e-01   -7.697767141910913e-02   -6.577240154783767e-03   -1.373524258261430e-01   +3.190656862194262e-01   -7.525153074449439e-03   +1.875751319297930e-01; +4.496234687402528e-01   +7.731790618240589e-02   -1.649032221156168e-01   -2.215145941228943e-02   +6.798039897243384e-02   -1.249093397405538e-01   +2.654504824125233e-01   -1.457974654156940e-01   +3.941501354180996e-01   +6.508624902761139e-01   +5.533904011480593e-02   +2.460262232269492e-01   -2.762961002063286e-02   -5.002624654313530e-02   +5.994177932461399e-01   +3.332501141186988e-01; -6.174964399491051e-02   -1.054991983898792e-02   -1.281376423829267e-01   -1.432933010149527e-01   -2.391030152667063e-01   +3.676370593466436e-01   -3.072511808714896e-01   +3.859221448547941e-01   +2.736442473638546e-01   +1.720347455661031e-01   +3.638738920095896e-02   +3.888942070353042e-02   +3.795818580588805e-01   +4.157791165918738e-01   +4.518108352900048e-02   -1.578267549616642e-01; +1.817667243297389e-01   -3.539444226324245e-01   +2.078494297583431e-01   +1.459156769784970e-01   -1.416590533637164e-01   +1.364712812594471e-01   +5.072364983948258e-02   +3.648562041540885e-01   -2.979431068148991e-01   -2.655192661237639e-01   -2.143453087891859e-01   -5.315127455070870e-02   -3.081670837945352e-01   -8.159080321422470e-02   +2.986912617498067e-01   -2.534575698584372e-01; -1.386308092307922e-01   +3.170344119078944e-02   +3.139612680650636e-01   -2.001427894571126e-01   -3.554598734343346e-01   -5.634863859943075e-02   +1.017558258146657e-01   -1.107908514234578e-01   -1.857035760589099e-01   +4.051935987456403e-01   +1.243687001798326e-01   +3.715702073437206e-01   +4.845981085774297e-02   +5.550124914020008e-02   +3.416776131680689e-01   -7.586119111700190e-02; -1.054144698446488e-01   -3.748521018143628e-01   +1.980453435283516e-01   -1.180328500753001e-01   -8.051057660012766e-02   -2.415014182474228e-03   +1.427126695350807e-01   +3.634165953417741e-01   -3.245763729809423e-02   +4.105938159555114e-01   -2.892015470908272e-01   +4.039933368063985e-02   -5.739503430371483e-02   +5.093959872050302e-02   +7.457867413567520e-02   +1.441397211673235e-01; +4.317769511531582e-01   +2.652901331911423e-01   +7.237521491108438e-02   +2.903699675434273e-01   -2.014673076633652e-01   +9.460644804269898e-02   +4.432980547554786e-01   +2.643646552874509e-02   -1.499607280277199e-01   +2.089832038210271e-01   +1.551110202537070e-01   +4.276920845229247e-02   -5.029512209453559e-02   +4.022136068342249e-01   +1.172499578365674e-02   -2.625768775209882e-01; +4.818958873120287e-01   +5.251151010007694e-02   -4.165383010877433e-02   +8.757085569845968e-02   -7.269754064232443e-02   -7.121055287731409e-02   +7.597424496157591e-02   +2.599153860171807e-01   -5.310429601669738e-01   -1.464624874211936e-01   +4.375595047681213e-01   +3.594346223106778e-01   +9.845914026514299e-02   +1.327327495951795e-01   +8.025538803661825e-02   +2.255956040669251e-01; -3.251967212141914e-01   -2.426563796545281e-02   -3.509323410751336e-01   -4.371928015771886e-01   +1.719942460854658e-01   +2.038707111436308e-01   +1.644714637982720e-01   +8.264451719161159e-02   +2.265388357125408e-01   +3.988486006494003e-02   +1.506624086124934e-01   -2.400203064503006e-01   +2.906563983138489e-01   +4.031053593289883e-01   +1.254162303995225e-01   -3.337432750973416e-01; -2.824027345821455e-01   +3.627917097089610e-02   -1.651669265829984e-01   -1.299931993473686e-01   +8.889665081067080e-02   +3.918200416476273e-01   +4.960352680412256e-01   +1.509268523248410e-01   -3.495001466653740e-01   -2.036494100309343e-01   -2.489338705874165e-01   -6.192770097509104e-02   +1.611711850151546e-01   -4.197086801278869e-01   +3.279636713377124e-01   +2.280456788839076e-01; +3.048079411355605e-01   +4.505713558729673e-01   +1.606115381236024e-01   +1.276794494543453e-01   -2.716305636154780e-01   -2.587259036670789e-01   +5.048692521261756e-01   -1.485774598177775e-01   +7.433565093746641e-02   +3.179923143257087e-01   -5.583162973608641e-01   -8.002652577259002e-02   +2.036245231077253e-01   +2.360429197962187e-01   -2.202904962434916e-01   -7.291573247324910e-02; +5.435586050589363e-01   +1.942142841518713e-01   -1.592770936382959e-01   +2.953616244218009e-01   +2.141085198099364e-01   -1.468602262790331e-02   +2.616301756369049e-01   +3.317658228783979e-02   +2.256489911895710e-01   -2.547073229904318e-01   -2.753290063734334e-01   +3.398316420873534e-01   +2.378095052429133e-01   -3.110086822001112e-02   +2.415247039811142e-01   -4.501288288037324e-01; -2.475196023715155e-01   -2.022299959766022e-02   -2.238182252329166e-02   -2.446609828223873e-01   +1.271834663747609e-01   +1.797470431466207e-01   -1.026462204317197e-02   +4.364025335498626e-01   -1.129997036843904e-01   +2.146877115761885e-01   -3.223893354671603e-01   +3.807626125995378e-01   +4.377733209461636e-01   +1.268823655213160e-02   -4.506733251865454e-02   +7.818913886063684e-02; +5.351018786762236e-02   -3.657798793410637e-01   -2.180201628685752e-01   +1.087077746388965e-01   -3.060798942470460e-01   +1.756443190675483e-01   +5.262153500769113e-01   -2.302498556563393e-01   +3.779007306208066e-01   +1.106932058912498e-01   +4.301250501455237e-01   +3.993999711868408e-02   -3.158174710196678e-01   +1.274153166957489e-01   +3.378761844967497e-02   -1.633107086675885e-01];
L1E_L1I_iGABA_netcon = [+2.137975659607171e-01   -3.990598054185406e-02   +3.065338159761893e-01   +3.565593665593697e-01   -1.094397204542209e-01   -2.382633583769197e-01   -4.113568737567213e-01   +3.142505080703474e-01   +4.663999820284983e-01   +6.121331112389637e-02   -1.425497777276917e-01   -1.395055878592686e-01   -6.679045322455418e-02   +2.570552646244277e-01   -1.865956532122985e-01   +3.104311404329030e-01; -1.596043187586629e-01   +1.997217551472898e-01   +9.101714245797152e-02   -2.415367953052601e-01   +9.587561974427651e-02   +1.057486057047046e-01   -4.347667296474200e-02   +1.933971506260210e-01   -1.599788214301165e-01   +1.731089646779388e-01   +4.244685186911938e-01   +4.507804406082926e-01   -1.754186867706308e-01   +4.048031400928973e-01   +2.911848667362501e-01   +2.145890335525275e-01; -3.180044538620977e-02   +4.272573422512188e-02   +4.368328170199165e-01   -1.766108957811359e-01   +8.886462323170635e-02   +3.498786242602508e-01   +3.615967545273768e-02   -2.858062808868028e-02   -2.097656778552164e-02   -4.276494523085671e-02   +4.343585040904289e-02   +2.738414946664366e-02   -1.783005740172744e-01   +5.434323432094118e-02   +7.916387655817349e-02   +5.976499246100810e-01; +1.685643402390008e-01   +1.895015691262211e-01   -1.801882858302520e-01   +3.001327836947880e-01   +4.213293321953456e-01   +3.369899335870527e-01   -2.769023318776504e-01   +4.837243913559052e-01   -3.725227269378662e-01   -4.120349561064449e-01   -3.744302012563416e-01   +2.473120938553920e-01   +4.116302650102019e-01   -3.228349537069079e-01   +5.130803332861583e-01   -2.162266086825829e-01; +6.015211493536068e-01   -4.623506716523288e-01   -1.075756929081500e-01   +1.579975640570532e-01   +4.859044835636586e-01   +1.623139205638727e-01   -3.950705062732364e-01   +5.280538538620059e-01   +1.168528357862414e-01   +1.454121018663498e-01   -4.259715179151355e-01   +1.548215063725263e-01   +2.550012539140181e-01   -1.368686383153614e-01   +4.324075540440279e-01   +3.121743761297274e-01; +3.549939925004080e-01   +2.907674481718822e-01   +4.713356789677920e-01   +2.920366838568926e-01   +3.586260164131095e-01   +3.741565820768135e-01   +3.948940001677359e-01   -2.429506181388383e-01   +1.384742374186878e-01   +3.215236469667108e-01   +3.221108794568051e-01   +1.767301060705419e-01   -2.595424084751413e-01   +3.439143532609537e-01   -6.527278776786338e-02   -3.818713391005552e-01; +2.311629276296560e-01   -3.082463078153392e-01   +4.143280083442116e-01   +1.935278226341371e-01   -7.038599495836154e-02   +1.729301135716065e-01   +3.101664569066215e-01   +1.926497397405348e-01   -4.021853503790501e-03   -1.262983206922082e-01   -6.127443577380472e-02   -2.055132812666582e-01   +1.876900646317881e-01   -1.702721416981265e-01   -3.403155579825249e-01   -7.064226925622888e-02; +4.858086561514786e-01   +1.530715724990879e-01   +5.544006122012028e-01   -1.081549368114735e-01   -6.121270472993498e-02   -9.006140385035394e-02   -3.243021404377865e-02   -5.127268415863523e-01   -2.027491363724037e-01   +1.023901026879965e-01   -3.232746393380547e-01   -2.365585737405668e-01   +1.907264083250342e-01   +3.488397890604304e-01   +2.453030165997851e-01   +1.741250957215279e-02; +2.136959355453426e-01   +4.097019238311619e-01   +7.630247624259051e-02   -3.325259660155056e-01   +1.886748283480117e-01   -1.997415691261570e-01   +1.354384359815506e-01   -2.406116155321522e-01   -9.999753229514846e-02   +3.971333708147456e-01   -2.663184785330619e-02   +6.223461817964009e-01   +3.960392602985179e-01   +4.339527924837964e-01   +3.749620635243948e-01   +3.084310465625928e-01; +1.586285957128115e-01   +8.246279512831048e-02   +3.689426623380630e-02   +1.055075057532673e-01   +1.324262288176056e-01   +2.623755915539868e-01   +5.664983772122113e-01   +5.175291137314761e-01   -9.298198016383591e-02   -9.617098187242851e-03   -1.035530876915788e-01   +2.003632860906294e-01   -4.053138947607563e-01   +4.634637214666328e-02   +2.796283470684413e-01   +2.506867322839297e-01; -3.896885680520236e-02   +2.658717267045983e-01   -3.042635744306127e-01   -2.820144595766502e-01   +4.022748375872274e-01   -2.102221033082030e-01   +2.171221888108234e-01   -3.238739952112257e-01   +8.780820581466799e-02   +1.480787267911761e-01   -2.010664374092599e-02   +1.093803872672132e-01   -7.214849650219168e-02   +2.561341208868664e-02   +2.761923285959964e-01   +1.098260557975968e-01; -1.392523933957273e-01   -4.062060512241463e-02   +4.408851504391668e-01   +2.103376534506108e-01   +2.082512511551356e-01   +2.002378699288001e-01   -1.421232446543427e-01   +4.053621919618016e-01   +2.118515721223191e-02   +5.196869968046112e-01   +3.049544647274777e-01   -2.964936551037438e-02   -2.194522380217995e-01   +4.177612782409539e-02   +3.814945154212990e-01   -9.201649212497053e-02; +2.767769200650491e-01   +2.126405006212158e-01   +3.699005940068461e-01   -2.688378285532558e-01   +2.960573412232441e-01   -1.366543307925983e-01   -1.438360890130004e-02   -1.697274090912018e-01   -2.201938307826416e-01   -1.083435105898248e-01   +3.355826916221627e-01   -4.408404434343426e-02   -1.437990425183754e-01   +1.655391747583930e-01   -7.955176756907247e-02   -3.067811857199518e-01; -5.312159963163782e-03   -1.871349618015832e-01   -1.565560196037086e-01   +4.620386975043398e-01   +6.659667648786410e-02   +3.506594044115213e-01   +6.904403516167026e-02   +3.364289073135494e-01   +3.511415299234913e-01   +2.776092710044742e-01   +8.825553641873321e-02   +1.330856508071216e-01   +2.055647871312359e-01   +2.024160826300631e-01   -3.805716853674019e-01   +3.057065882669526e-01; +1.874655669848498e-01   +4.336845736727967e-01   -1.113492964328256e-01   -4.159205552345971e-02   -1.436728592209249e-01   +2.039704159794771e-01   +1.436790571995580e-01   +3.242916648461197e-02   -5.566062449686636e-02   +6.066446819184734e-03   -1.373921063770684e-01   -3.679313622699991e-02   -1.754746855664940e-01   -2.675761429752041e-01   +1.140617709633305e-01   +1.374607912053820e-01; +2.430552781133190e-01   +2.072107395350082e-01   -1.457046813679679e-01   +2.729068135151512e-01   -1.414932341713914e-01   +2.822965577936455e-01   -1.234462547949310e-02   +2.618012670325105e-01   +2.819121717310562e-01   +3.841267759405450e-01   +1.826676024527699e-01   +1.394657176350219e-01   -9.859974617869707e-03   -9.377975377372588e-02   -1.271160062450205e-01   +2.717339315115145e-01];
L2I_L1I_iGABA_netcon = [+2.908505649970675e-01   +1.882953644706280e-01   +1.080715515864115e-01   +1.230575818924154e-01   +3.580476629741552e-01   +4.151066447719226e-01   -8.871240853343790e-02   +1.466207688301991e-01; +2.576376594120491e-02   +5.929679925849152e-01   +9.244598730658102e-02   -7.199584989825952e-03   +1.219196278248553e-01   +2.500461846269367e-01   +2.275110783855964e-01   +2.124653416518008e-01; +2.876563459628259e-01   +1.357915326040855e-01   +3.720023734044000e-01   -2.709453318089021e-01   +2.522313174987555e-01   +3.576517415818402e-01   -4.079628411154403e-01   -1.444666118270746e-01; +1.164254948586537e-01   +1.506120066553751e-01   -2.968499990631600e-02   -4.549907996831495e-02   +9.473292809537498e-02   +2.513792030084613e-01   +3.553379892068697e-01   +4.069600331749483e-02; +2.562171170045019e-01   -1.650680577161089e-01   -2.735076137336052e-01   +3.275730555824027e-02   +1.395222688342377e-01   -1.552648110745245e-01   +3.902591046016468e-02   +1.989203634720266e-01; -1.376025428361500e-01   -4.350710000557583e-01   -9.353246206257074e-02   +2.366295348778404e-01   -1.202599088694151e-01   +4.424843151164484e-02   +1.995506036820500e-02   +2.839355940721627e-01; +2.988972328566017e-01   +3.900669536172464e-01   -2.443192299722390e-01   +2.148038713857344e-01   +1.145463951225218e-01   -7.524393773381000e-02   +7.098008671766048e-02   -5.317718378264893e-02; -2.250425569049677e-01   +1.715836080102856e-01   -3.268736311697319e-02   +1.968241202716698e-02   -1.223327794288996e-01   +2.742000414882368e-01   -3.472291557231210e-01   +4.524328881228927e-02; -2.275145726343401e-02   -3.060374397238154e-02   -1.252798014015352e-01   +1.604759163773396e-02   +4.760658175689225e-01   -9.687876059611522e-02   -1.545096973055894e-01   +1.551455642876339e-01; -6.842822978372232e-02   -9.028675522995830e-02   -1.785406034447834e-02   -2.429271394315257e-01   +1.369308962369009e-01   -1.815904652306950e-01   -1.679636565891600e-01   -2.539062677189667e-02; +2.297145324156462e-01   -4.292224303573036e-01   +1.727511839000327e-01   -1.066500438633839e-01   -1.921579970848181e-02   +3.028939623951865e-01   +4.090617522411563e-01   +5.082993754408401e-01; -5.090324869813165e-02   -2.602593549684663e-01   -1.124072448614831e-01   +3.940291077620680e-01   +2.434878985628903e-01   +2.840106593487542e-01   -7.827565597509006e-02   +3.675719786713363e-01; +4.385975600144840e-02   +1.858277365987502e-01   -5.908359682880933e-02   +1.388338142777680e-02   +3.994350468385050e-01   +4.191700409291827e-01   +2.962101340481106e-01   +1.404509321185096e-02; -3.218838130967793e-01   +4.745387306481055e-01   -3.714146132107102e-02   -3.959723143374352e-01   +9.831571685797214e-02   +1.396450969706818e-01   -2.793754880724502e-01   -2.022346526367192e-01; +1.165684442142526e-01   -1.434173053744252e-01   +1.979549348656846e-01   +2.446673389061580e-01   +1.144826100509604e-01   +1.459137228345660e-01   +1.395356417901034e-01   -4.083324636992123e-01; -1.289608381569046e-01   -2.203826708667580e-01   +6.468776319674843e-02   +1.134428964431388e-01   -2.825050800047899e-01   +5.821954005157716e-02   +2.910344697831992e-01   -1.231421785040669e-01];
L1I_L2I_iGABA_netcon = [-9.420107824828930e-02   -4.345846909221370e-01   +4.670984753008425e-02   -1.796223241763609e-01   +5.682676727495813e-02   -2.101275776612741e-01   +2.678479348793783e-01   -3.182892168297417e-01   -1.311333656245095e-01   +1.059799514772242e-01   -9.754989418891635e-02   +2.118261550441987e-01   +2.402337820220616e-01   +3.737665517559609e-01   -1.002315889098745e-01   -3.536828664480854e-01; +2.328596049483423e-01   -1.040840415832579e-01   -2.691199632212334e-02   -2.355089185426520e-01   -2.360771698380844e-02   -3.994033325045327e-02   +3.037035586978237e-03   +2.497470256331123e-01   +1.984399322261248e-01   +3.593248264853433e-01   +9.580202731453957e-02   +1.205281538837104e-01   -8.099785187316522e-02   -2.986837988730820e-02   +3.414929340065574e-01   -1.270743585556635e-01; -1.755781964250220e-01   +1.720985769191386e-01   -2.304617849611737e-02   -1.446203596520451e-01   +3.276239931955771e-01   -1.668051908124824e-01   -2.749090078242680e-01   +1.720420778926482e-01   +6.278309647207667e-02   -2.736520492473224e-02   -2.080733804400197e-01   +1.530899841475497e-01   +1.764816167907352e-02   -8.611428216362439e-02   +5.582850736280795e-02   +2.362232535210832e-01; +1.143253448334644e-01   +4.014497775672371e-01   +1.536563851083823e-01   -1.290939330121084e-01   +2.418781393369880e-01   -1.875865549595186e-01   -1.818505375825651e-01   -1.291874278954502e-01   -8.895083836703166e-02   +3.174123091965361e-01   -1.006272075365334e-01   -3.005665361262466e-01   +3.125070204005445e-01   +4.060279674645423e-01   +3.610039324069379e-01   +3.721886284671426e-01; +1.111873539932720e-01   -2.091965647965988e-02   +1.296611982731895e-01   -2.876372793002130e-01   -4.854880711263743e-02   -8.473133811093601e-02   +2.703124152612785e-02   -2.315630699652627e-03   +9.974431606525475e-02   -2.278923805097556e-01   +6.019620161540211e-01   -1.873130627247099e-01   -4.797956923478930e-01   +1.039266594433307e-01   +1.248423370478925e-01   -9.008047559507060e-02; -4.093637206774060e-01   -2.641812166003571e-01   -2.388561473953149e-01   -1.475950819153422e-01   +2.608367200677351e-01   -2.242624947074196e-01   -9.886008264691912e-02   +1.362914754431895e-01   -1.804243073406118e-01   -4.784407147708685e-01   +4.023208896907794e-01   +5.148030012476431e-01   +6.549565230643482e-01   +1.129517776562280e-01   -1.957780533899403e-01   -1.762207763066171e-01; -1.093369594759812e-01   +3.015339878141720e-01   -1.068653959490636e-01   +9.131201843464556e-02   +1.974496129849300e-01   +2.041623337764824e-01   +1.313011697647088e-01   +2.810919578836402e-01   +3.307616538417636e-01   +4.321243308186075e-01   -2.837429474716834e-01   +3.303704667671004e-02   +5.301247973643952e-01   +2.053244871867035e-01   +2.929952829785324e-01   +6.228641363058107e-02; -3.185905701323914e-01   +1.599787118305237e-01   +3.300569122755827e-02   +1.367740837164304e-01   +1.465560672180282e-01   +8.909295823227970e-03   -2.422473530703108e-01   -1.560445809792383e-01   -1.096140464492193e-01   +3.103824670413652e-01   +2.055897362917176e-01   +1.041131848145708e-01   -3.572376808063772e-01   +1.711961498011230e-02   +3.996849779932866e-01   -2.107155390104005e-01];
L2E_L1E_iAMPA_netcon = [+2.013458975048894e-01   +1.912839577991804e-01   +3.176967654579168e-02   -4.238954144376202e-01   +4.530307807053392e-01   +1.383229087375437e-01   -3.278926054601842e-01   -2.618909199509642e-02; +1.090899750233950e-01   -1.032218780544234e-01   +1.167332186671537e-01   -3.917273051839744e-01   +3.744703785562646e-01   -1.615632488121656e-01   -4.455221729238136e-02   -4.474492363667440e-02; +2.944114519009300e-01   +4.719218688481356e-01   +2.196776266690900e-01   +1.018139794604043e-01   +3.417694903240086e-01   +5.057069605151555e-02   +3.614974441833335e-01   +1.160935458608734e-01; +5.228831930780289e-01   +1.282188316933826e-01   -4.136162214904052e-01   +2.762931946682760e-01   +5.381028959215779e-02   +5.276843023561589e-01   -2.399074255933411e-01   -1.333008568565016e-01; +4.167611307877179e-01   +5.139350653869215e-01   +4.852030484464030e-02   +3.617764106935474e-01   +1.094591264964261e-01   -3.320310181383354e-01   -1.495873075966740e-02   +3.088249856673613e-01; -2.151148144309308e-01   +1.381338567223139e-01   +8.834268304538928e-05   +2.277957179414222e-01   +3.191263352416240e-02   -1.110119992823246e-01   +4.139386112870533e-02   -7.457646098060047e-02; +2.842419751952216e-01   +2.712687013178691e-01   +4.374781297230106e-01   +3.542910199082847e-01   -3.700710013993020e-01   +9.579751812473863e-03   -3.253560746621503e-03   +4.168628399239859e-01; +2.634492616341041e-02   +4.518485363001500e-01   +1.762872623898671e-01   -4.323158123307915e-01   +7.814942624083393e-02   -2.702282290365706e-01   -2.387340304068764e-01   +1.072311613420834e-01; +3.957297611035214e-01   +1.556171050958963e-01   +3.399636233723200e-01   -7.502592162821398e-02   -2.667154656943457e-02   -2.270962374342820e-01   -2.850832065029565e-01   +1.495773290544848e-01; -9.713616539989266e-02   +3.849766082691610e-01   -2.567678691697688e-01   +7.032927624733208e-02   +1.962530737666056e-02   +8.509056198556807e-02   +3.093667463090142e-01   +3.001803074280913e-01; -2.501615240685285e-01   -5.808217879834248e-02   +6.053465784793532e-02   -4.820987171104221e-01   -1.153302573205665e-01   -1.496264672842078e-01   -2.328057661397856e-02   -3.099057780488956e-02; -1.463533047519433e-01   -6.012771391441011e-02   +3.801363613855446e-01   +1.001464943669268e-01   -6.957815231200742e-02   +6.262721675214394e-02   +3.002940418146637e-01   -5.737886266654363e-02; -1.938123683550503e-01   +2.790798614128037e-03   +4.505286621962722e-04   +1.514627908985740e-01   +3.174975802829496e-01   +1.977017875017339e-01   -1.005797273539475e-01   +1.470814877259141e-03; -1.164251012424001e-01   +1.832084872515634e-01   -4.459909756447289e-01   +2.772557246833336e-01   -6.262497319386223e-01   +1.135758444137141e-01   -5.371544938874830e-02   -1.907275062428193e-01; -1.319478426461705e-01   -7.099777383524991e-02   -2.408362995956577e-01   +3.965362445293678e-01   +3.461211576459561e-01   +9.704628961522481e-02   +2.874793124146402e-01   +1.757889743092708e-01; -2.200347482112329e-01   -2.199081441106802e-02   -1.263182880319679e-01   +3.899013506708207e-01   +2.225263493223699e-01   +2.625942489138020e-01   -9.015790601899791e-02   -1.340786436591447e-01];
L1E_L2E_iAMPA_netcon = [+3.887285576162467e-01   -7.487548122525564e-02   -1.856878983254674e-02   -1.106101869616142e-01   -2.504498420254301e-01   +3.439780036843726e-01   +1.919959611814504e-01   +3.247627230750411e-02   +1.411418681754502e-02   +3.090693828458358e-01   -4.641966688457937e-02   +1.812938753207064e-01   +3.749727230261268e-01   -2.798265039121520e-01   -5.054187092418475e-02   -5.185255956465569e-01; -1.090774611585941e-01   -1.169536089525903e-01   +3.795350612345497e-01   -1.269938350518952e-01   -5.194182866891073e-02   +3.566231025541899e-01   +3.766972763695898e-01   -2.331893003037226e-01   +1.960186491006831e-02   +2.622079762355158e-01   -2.275218448009083e-01   -8.429451849936727e-02   +4.236817408845822e-01   -8.366183701296304e-02   +3.313546155020173e-01   -3.413025704384341e-01; -2.650888488144281e-01   -4.061577224524131e-01   -3.845873210851696e-01   +2.119319281269527e-01   +1.068758786391213e-01   +2.356822658838561e-01   +4.327108801508237e-01   +5.139984627742016e-02   +6.458155451502703e-02   -5.936928638575600e-02   -7.423376233537674e-02   -4.028194310904418e-01   -3.814530952672369e-02   -1.203963431372508e-01   +6.157920884557738e-02   +3.275001130952054e-01; +1.121218727630186e-01   -2.958333762394382e-01   +3.716853762947143e-01   -1.597409801980254e-01   -2.844732985671263e-01   +4.478406462324229e-01   -1.739775508733346e-02   -1.039668738327621e-02   -7.119728364903172e-02   -1.302786661083317e-01   +4.100703679010736e-01   +2.245710713680734e-02   +1.371918358522526e-01   -4.903192811647537e-02   +2.827948911844262e-01   -1.855862573151287e-01; +1.869462340692815e-01   -4.998276260373088e-02   +1.995127571375411e-01   +4.035881757424489e-02   +2.388116574746513e-01   +3.193428879342606e-01   +2.693413003471711e-01   -2.809925294610999e-01   -6.048716894839062e-02   -2.372279704001818e-01   -3.933799703276338e-01   -1.329102542062559e-01   -3.020586509811762e-01   +3.451166380804047e-01   +2.320266049377404e-01   +3.038301774372502e-01; +2.174719954275668e-01   -1.710517798200722e-01   +5.415814160619370e-02   -1.332282016403141e-02   +2.179703717344118e-01   -3.738738437279222e-02   -2.115605273769934e-01   +8.104673789128777e-02   +8.085429498257141e-02   +3.516345874405594e-02   +1.610686893067685e-01   -1.204795145106422e-01   +5.759699389395366e-01   +1.574950709366675e-01   +2.307509588643138e-01   +2.696603881303468e-01; +1.770237278276778e-01   +3.985887791812673e-01   +1.229604576220738e-01   -1.541803392970562e-01   -2.780673937868387e-01   +3.006761551916195e-01   +1.529245757893033e-02   -1.274400722546930e-01   +2.978735681219853e-01   -4.736503425290925e-01   -4.884146796666779e-02   +3.690244568980520e-01   +2.262078976024205e-01   +2.170860113334450e-01   -5.680091909734189e-02   +1.335529072384790e-01; +1.752104731147842e-01   -2.058142007750652e-01   +1.516482066820540e-01   -4.732079429475786e-01   +1.187652200347702e-01   -9.759325530483645e-02   +5.057567823453098e-03   +2.239234274862034e-01   -2.551331574906922e-01   -2.357274601066996e-01   -6.820454929625222e-02   +1.684897760713658e-01   +1.042548430850722e-01   +3.593075707613487e-01   -2.835195362348359e-01   -3.509416771712644e-02];
L2I_L2E_iAMPA_netcon = [+5.053395426008312e-01   +1.331119048020050e-01   +3.894009910880848e-01   +3.283195412897271e-01   +6.688894422151381e-02   +2.507159089252582e-01   -2.101792940689208e-01   +2.454347666187435e-01; +1.291972388846509e-01   +5.337467536596985e-01   +6.688020980349763e-02   +2.167475423783467e-01   -1.429616396819227e-01   +3.642811103297658e-01   +4.231596785588404e-03   +3.104204372497379e-01; -2.951854148663628e-02   +1.728219523246503e-01   -3.669836433400391e-02   +3.827814854765529e-01   -9.105473502070398e-02   +2.378265067076032e-01   +2.518118344969488e-01   +1.557627500155126e-02; -3.795974697309384e-01   -2.930718251524598e-02   +4.416041081662234e-01   +4.755577148127418e-01   +3.157689802615535e-02   +5.320850332093657e-02   +1.875108663076629e-01   -4.767475464785172e-01; +7.354320928274513e-02   +6.547626626429468e-01   -2.401792654456939e-01   +3.184935385785750e-02   -8.677547750326130e-02   +2.837282763440990e-01   +2.056799162634039e-01   -8.785793477562190e-02; +2.380046851938938e-01   +2.385751783419736e-01   -7.686413681194453e-02   -3.682235940540179e-02   +3.270747159389882e-01   -3.924824561606724e-02   +7.031980062470183e-01   +3.573234288276852e-01; +4.751059425869428e-02   -2.843295371642680e-01   +3.179819201920607e-02   +3.638327545095194e-01   +1.252250275503463e-01   -1.350474479055193e-01   -1.879609689266355e-01   +2.304991742450915e-02; +3.019670785541974e-01   +3.884819796539339e-01   -2.060415813933635e-01   +3.103915854212355e-01   +8.359119665188444e-02   +1.503438664659000e-01   -1.292176708800804e-01   +5.600683317978754e-02];
L2E_L2I_iGABA_netcon = [+2.614923990508070e-01   -1.922607899936963e-02   +2.622053676792778e-01   +1.263247496505861e-01   +2.608747286385302e-02   +3.187377402869407e-01   +2.404285020927180e-01   -8.483490820878642e-02; +7.906805984351033e-02   +1.890167149806832e-03   +2.266852651445526e-01   -2.314974754509249e-01   +3.848442643162892e-01   -1.882299490098958e-01   +5.028524828137571e-01   +2.039775645489715e-01; -3.488966754329073e-02   +2.948347764592522e-02   +8.678459925785677e-02   +3.083829447916783e-01   -2.528139388673744e-01   +4.607172878703282e-01   -2.625850210609698e-02   -2.035324265004678e-01; +1.060956656779985e-01   -1.349225757868069e-01   +2.152568643196676e-01   +2.739280966463550e-01   +3.141759447071240e-01   -5.530957858257508e-02   -4.280978595156947e-01   +1.419264936882298e-01; +1.930161560995382e-01   +8.501734394094981e-02   +6.245232260611056e-02   +1.221190070338083e-01   -8.745474371538589e-02   -1.606968867121465e-02   +2.530157085491683e-01   +2.630431353994968e-01; +2.932289857437774e-01   -2.365664948706103e-01   -2.887647121828372e-01   +1.863147201329598e-01   +3.451758386332461e-01   -2.576445751144727e-01   +1.233660988580662e-01   +2.353735435846898e-01; +1.034736319012128e-01   +1.242745872677124e-01   +5.464701196793462e-01   -2.053134813683350e-01   +1.260479047668060e-01   +6.135675750560156e-01   +9.048956903168161e-02   -2.030458026987400e-01; +5.418820148272724e-01   +7.106318970111132e-02   -1.289464760281622e-01   +8.919188752021311e-02   -1.028553647708663e-01   -1.586494588085923e-01   +1.518241627621996e-01   +4.225612003597307e-01];
L3E_L2E_iAMPA_netcon = [+1.372280712231842e-01   -4.597556773782951e-02   +1.273035550333754e-01   -3.691451290380175e-01   +4.230186978304741e-02   +2.733160184194741e-01   +1.960711580987801e-01   +4.362760691847669e-01   +3.238771661083563e-01   +2.876195151249065e-01   +1.069898008635756e-01   +5.042475588575008e-01; -3.048332446842715e-01   -4.761236106474333e-02   +4.241362236615157e-01   -9.241550557622810e-03   -2.698676338732226e-01   -1.014325661988876e-01   +2.442776012437156e-01   +2.161019214493321e-01   -1.238805427407207e-01   +9.183479065176092e-02   -1.050944943714131e-01   -1.398661825366924e-01; -3.977496731063956e-03   +4.475359675860125e-02   +4.609217081792745e-01   -1.640216406819895e-01   -5.363110402210079e-02   +7.492607900314953e-02   +6.054042373223223e-01   +7.490336080970068e-02   -8.687872886512557e-02   -1.238033895756712e-01   +3.458138687395870e-01   -2.780682407648196e-01; +3.065973093292633e-01   -1.760941050395303e-01   +4.748532599209589e-01   +7.095586459279901e-02   -1.271571152315180e-01   +5.780390044212842e-02   -1.536771229719545e-01   -2.142576752024891e-01   +1.412703691139481e-01   -2.601792758869732e-01   +1.510509288309241e-01   -1.462526064637713e-01; +4.792839040648993e-01   +5.271600252510000e-01   +3.103594054198766e-01   -1.121751661708227e-01   +2.202310448083803e-01   +2.220651585870967e-01   -6.853814100236832e-03   +2.982507802898871e-01   -3.891284865750286e-01   +3.280963759762138e-01   +3.002049663536450e-01   +4.476450408478557e-01; +1.959289457619066e-01   +1.038628133565413e-02   +2.862090005709612e-01   +1.333629874263093e-01   +1.174780994245763e-01   +5.010835867434287e-01   +1.111141591302583e-02   -1.237103226118365e-01   -4.074138580869323e-01   +1.593751161896098e-03   +8.599307008217522e-02   -2.114569052884240e-01; +1.442675436127467e-01   +1.620736021061963e-01   +7.156749909282227e-02   -1.501605267797738e-01   +4.961498056667114e-01   +2.535527416355841e-01   +5.297672679130643e-01   +5.755584150470993e-02   -4.001457388661063e-02   -9.495717041224302e-03   +2.254875839910349e-01   -1.355166825378255e-01; -5.603319871117097e-01   +3.218221584638099e-01   +8.434710709556079e-02   -8.291351230951659e-02   +1.316629576604050e-01   -9.115719480743628e-02   -4.590078808989714e-02   +3.121011003190642e-02   -3.363292891527693e-01   +4.769987040768734e-01   +1.141294951314259e-01   +4.765716669864231e-01];
L3I_L2I_iGABA_netcon = [-4.755165231955437e-02   +7.364386594780660e-01   -9.205183797067820e-02   -8.873760052220070e-03   +2.922924859485729e-02   +2.291878964492649e-01   -3.221023336570431e-01   +5.710493956684123e-02   +3.520129383866546e-02   +2.345945149380556e-01   -5.179519295141104e-02   +4.333271513149616e-01; -7.065352841274769e-03   +1.980085129662272e-01   +1.254598143196891e-01   +3.931763310815027e-02   +1.400881323569835e-01   -8.327289016551685e-02   -4.689543682584516e-01   +8.955607967224097e-02   +5.469574463773939e-02   +1.193794791227001e-02   +4.617796680650893e-01   -2.765511820643342e-02; +4.193172218188104e-01   -9.015603487669402e-02   +9.901528301295195e-02   -6.677482258527255e-02   -4.004179645611768e-01   -5.849678398983291e-02   -3.485331034048257e-02   +1.187136750547989e-01   +7.933907937239215e-02   -2.609976691447444e-01   +3.284490383280129e-01   -2.690244501631760e-02; +4.901282534919787e-01   +4.424509403075724e-02   +5.849971070980584e-02   +2.744335166488052e-02   -1.239212906521425e-01   +4.260638906778057e-01   +1.003124122267945e-02   +3.149880483493820e-01   +2.166212876315270e-01   +3.894128070717123e-02   +2.453878349710409e-01   +2.568513532800920e-01; +1.455943962340399e-01   +4.530340063830212e-01   +5.589431030773322e-01   +2.622050922603308e-01   -1.386079145689181e-01   -1.852715209636321e-02   +1.483706081407444e-01   +1.972470376848689e-01   +6.647544960120631e-02   +3.552893639324127e-01   +6.396854618048327e-02   +1.390531301265320e-01; -4.234328129081769e-02   -2.384441929469133e-02   +8.832550434090336e-02   +2.270608570768761e-01   +6.522661543938155e-01   -4.237174840256304e-02   -1.096202473634028e-01   -1.459055949522918e-01   +1.773525326527342e-01   -9.367903846658009e-02   +1.844667007913851e-01   +1.362433318736960e-01; -1.037514416384036e-02   +1.274660792871365e-02   +5.342918556788623e-01   +2.879638701026940e-02   +4.474102913034140e-01   +1.836433536668598e-01   +5.161225107765758e-01   +6.207346350295919e-01   +3.911969989044925e-01   -1.313684196431978e-01   +4.212542359900164e-02   +1.766402826857178e-01; +4.433838770668785e-01   +1.315730560008943e-01   -1.367337868521367e-01   +9.393281422219368e-02   -3.426427566513877e-01   +1.435828007624455e-01   -3.882886928990045e-02   -5.502439255651650e-02   -2.839875780028853e-01   -2.397110064459563e-01   -1.036478636104383e-01   -7.405653303513351e-03];
L2E_L3E_iAMPA_netcon = [+2.017333224225299e-01   +2.763087269431553e-01   +3.562489553156439e-01   +3.289818976997287e-01   +3.314815239589882e-01   +1.521699679555157e-01   -5.006034585586693e-01   -2.218253918283176e-01; +9.882088028105429e-02   +1.377446436826362e-01   +3.547614328332761e-01   +2.863943514759959e-01   +2.450111690314568e-01   -7.396622810232355e-02   +2.488769137006609e-01   -2.836401981742754e-01; +1.303336728194034e-01   +1.846680776964782e-01   -1.279167106358036e-02   -1.486400069278601e-01   -4.469688988959367e-02   -1.021519286441835e-01   -2.507924517727065e-01   -1.161652244778691e-01; +1.863327539471067e-01   +5.049150253082911e-01   +1.139433151403166e-01   -7.463265624178245e-02   +4.818858685135201e-01   +6.638588511191417e-01   +1.604365865183053e-01   +3.222743137690736e-01; -7.847611150663554e-02   +2.316452967663354e-01   -4.956819519279329e-02   -2.910234281856420e-01   -2.847125123419615e-01   +3.281734186182185e-01   -6.323663097244180e-02   -3.412103634344912e-01; +2.002162047541986e-01   -1.942591301505448e-02   +2.935830897125248e-01   +9.164920745886825e-03   +4.971442373524078e-01   -1.453395509066690e-01   -9.094604985724471e-02   -1.804671529922103e-01; -9.319094398649388e-02   +1.445365089677322e-01   -4.768516722480984e-01   +1.768827225435235e-01   -1.093206341316668e-01   +1.535264212726300e-01   -1.177241211072036e-01   +1.568412492305638e-01; -1.106823991531245e-01   +3.104071603200993e-01   -4.242678398284360e-01   +4.780218474931160e-01   +1.949429226930356e-01   +2.794105158440251e-01   +2.097969067428119e-01   +2.977325250311156e-01; -1.520183293330121e-01   -4.915952448131427e-02   -4.276932717717991e-02   +3.847309487733764e-01   +7.176984814623712e-02   -5.006365860938191e-01   +1.005234384498463e-02   -7.351836104412809e-02; +2.961505482863758e-01   +3.426648743546320e-01   +4.526988369175067e-02   +1.065906681476333e-01   -1.079235949008135e-01   +2.842067090052124e-02   -1.475466959101712e-01   +6.122203050954377e-01; +9.500815746601443e-03   +1.481440457912000e-01   +1.256316315214643e-01   -1.901447562787501e-02   +3.349848449794667e-01   +4.225629900905081e-03   +1.674164338953212e-01   +3.953421407798391e-01; +2.025541237649492e-01   -8.831044103483815e-02   -1.273915171423295e-01   +2.124144936947604e-01   +3.607053571982545e-01   -2.224923100813229e-01   +4.301671095976372e-01   -3.358965493391448e-01];
L2I_L3I_iGABA_netcon = [-1.392948913796415e-01   +3.852789313499368e-02   +2.877446458367209e-01   +7.037134654416352e-02   +6.604288723101082e-01   +6.159118553951851e-01   -9.297750677826483e-02   -2.304814618787107e-01; +1.079187676290843e-01   +2.819971867592398e-01   -3.623277452045632e-01   -2.692639225924857e-01   +6.495637159163800e-02   +3.017373371712321e-01   +1.788886685549395e-01   +6.399771983239970e-02; +4.532600988673319e-01   +5.642449568512552e-02   -2.013175056405170e-01   +4.631261404461168e-01   -1.451067807704533e-02   -1.919227552565380e-01   +1.139902100887605e-01   -7.100677098797828e-02; +1.213767909284284e-01   -1.879233402109058e-01   +1.626325112954793e-01   +1.574192509830745e-01   -1.268888736473060e-01   +4.878027662769909e-01   +6.516394429619886e-02   +2.390357248816374e-01; -1.432187245467411e-01   -2.639994844564560e-02   -3.366268378722204e-01   +1.673931171739018e-01   +1.248958408283029e-01   -4.132045093481870e-01   +1.713003384232699e-02   -2.463083488765188e-01; +2.062662483697453e-01   -3.726308043650174e-02   -3.458753621709461e-01   +9.612087126101977e-02   -6.552626275205306e-02   +3.997029949799524e-02   +3.458708947135632e-01   +9.460152512489385e-02; -3.286433271788726e-02   +2.861125241277795e-01   -2.712291156917581e-02   -1.748195843061944e-01   -2.383314443217801e-01   +2.355368162656001e-01   -1.825917884081858e-01   -6.338845036349706e-02; -7.365048625220193e-02   -1.302485108989391e-01   -1.012801090785560e-01   +1.885515921603484e-01   +2.675569435081948e-02   -1.551184240256850e-02   -5.440489190784228e-02   +3.565701679608763e-01; -2.798057588801376e-01   +9.265739799482328e-02   -1.895946632992113e-01   -2.869572313002057e-01   +3.581087701946971e-01   +3.361028272521006e-01   -1.895030344060285e-02   -7.305045871224955e-02; +2.451407163392386e-01   +3.022808730914744e-01   -1.851117034102449e-01   +1.684492667576084e-01   -2.241274907113613e-01   +4.740823914670146e-01   -2.440330443062166e-01   +5.139188491769855e-01; -2.935104255040908e-01   +2.081535534729393e-01   +5.132775674895493e-03   -1.545136827764371e-01   -1.356600646540558e-01   -4.120820205938126e-01   +1.372653150277539e-01   -1.620072542712860e-01; +1.104866920720853e-01   +6.237477892621529e-02   +1.323389402622447e-01   +3.365612753835768e-01   -3.621232992631823e-01   -9.203878140980062e-02   -6.398444915688102e-02   -1.476890320085914e-02];
L3I_L3E_iAMPA_netcon = [+2.329843447776807e-01   -4.989615969696941e-01   -1.349881161046479e-01   +3.283658255176968e-01   -8.038591547194240e-02   +1.433913358730800e-01   +1.581626268529512e-01   +2.809448804254143e-01   -1.022766873683052e-02   +3.053602141877750e-01   -2.082091294039143e-02   -1.098469309260842e-01; +3.009859857864920e-01   -1.904243766631954e-01   +2.498134316418903e-01   -1.679150170434271e-01   +1.783257941292533e-01   -2.381494529056851e-01   +2.792658678242238e-01   +4.252317852302376e-01   +3.007767725418601e-01   +6.865624113437080e-02   -3.195113222716715e-01   +1.829885452449250e-01; +3.715897687787736e-01   -2.509739842569392e-01   -5.556920665520144e-01   -1.152148090632228e-01   +9.340211388986104e-02   +4.502987954133098e-02   +4.553150474591526e-01   +1.300678157196566e-01   +9.441036118977995e-02   -1.297238005728191e-02   -1.465207092094220e-01   +2.808586033606533e-01; -2.806784060047850e-01   +4.446698194355127e-01   -2.685382519522334e-01   +2.327091291271250e-01   +1.646411409088428e-01   -1.533701573142188e-01   +2.193061920149899e-01   +6.807912369871499e-02   +7.574334655843384e-02   -1.321511959568478e-03   +9.506734334297263e-03   +1.487576184843348e-01; +4.249522700156996e-01   +2.651745806942334e-01   +6.157758456820688e-01   -1.220502071731649e-01   +4.672670524583691e-01   -2.078749086642704e-01   +2.884621943819456e-01   +1.776647765652280e-02   +3.616168248296049e-01   +8.750646891988352e-02   -1.883411209598244e-01   -1.343024262162240e-01; +2.958809878901177e-01   +2.221899024772832e-01   +4.189827382055429e-01   +1.557515964452439e-01   -2.725724954877010e-01   -3.567615543576824e-01   -2.749306423516881e-03   -1.076599132760554e-01   +3.640225233016562e-01   +4.096255759429064e-01   +1.035592984205786e-01   +6.236118533682959e-01; +2.711055579220724e-01   -8.752970620881573e-02   +4.113721156438434e-01   +2.522496315962643e-01   -2.550676638311175e-02   +3.192585799591483e-01   +4.289898855895998e-01   -1.896579701625323e-01   -1.853588141877995e-02   -1.895063961996536e-02   +1.438489413799580e-01   -3.899030425528877e-02; -2.289553094174850e-01   -1.762400601043583e-01   +2.202125572372553e-02   +2.113713607362635e-01   +2.216162863557780e-01   -1.126936339413243e-03   +1.304416153262341e-01   +4.706568466296371e-01   +3.937055392991825e-02   -2.123956509249723e-01   -2.059433965253285e-01   +3.341629283124294e-01; +6.021085132411069e-02   +5.336355333663775e-02   +1.492184707813585e-01   +3.714691015744234e-01   +3.283966636281808e-01   -8.636742750262236e-02   +7.239241404788166e-02   -3.851628163352661e-02   -2.787532310264686e-01   -1.700841091406457e-01   +2.130049658242705e-02   +2.355021318424917e-01; +4.310527953699947e-01   -2.806201031171802e-03   -1.509656016428378e-01   -1.639574077852646e-01   +1.305074922347078e-01   +4.890646488028464e-01   -1.158400315486854e-01   +3.586268695596558e-03   -1.646465708019149e-02   -2.547198123190805e-01   +1.503202740020206e-01   +2.848447975643109e-01; +1.991470494409452e-01   +2.463796289754697e-01   +3.003538941855270e-01   +4.554405318750603e-02   -8.684180310471372e-02   +3.164671038705382e-01   +2.535243461781388e-01   +4.933126915408106e-02   +2.048679524709530e-01   -3.465166814699288e-01   -3.264936151951595e-01   +1.646101908743358e-01; +3.836018738878108e-01   -1.632637424741125e-01   +4.947095996316474e-01   +7.198035067217168e-02   +2.264839795426377e-01   -4.241215817474979e-01   -1.783411364161003e-01   -2.185088928865097e-01   -2.348237731406340e-01   -1.671550380238206e-01   -4.264174953383465e-03   -1.968263836104905e-03];
L3E_L3I_iGABA_netcon = [-3.251319180784297e-01   +3.373661322704633e-01   +1.572907542715830e-01   +4.947199603179353e-02   +7.756334231758799e-02   +8.891737682073469e-02   -5.242912479621261e-02   +5.476387383326199e-01   +7.842278313768550e-02   +2.788751751458369e-01   -5.248924674775857e-02   +3.179019390047312e-01; +2.730969294580589e-01   -5.563520668265810e-02   +7.360829931651158e-03   -8.133943304306748e-02   -3.194538162012972e-01   -3.618287097450129e-01   +3.547140248182964e-02   +2.796881505139813e-01   +2.129115973612436e-01   +1.556911797829197e-01   +1.091857763074210e-01   +6.270166186113173e-02; +4.061130427202007e-02   -3.315375302135916e-02   -1.500396634225744e-01   +3.589935269377549e-01   +3.264766336833019e-01   +7.866782722993546e-01   -1.143186270040506e-01   +1.333188453478971e-01   -6.078091019312906e-02   +7.126923906665847e-02   +1.631545368824108e-02   -3.768375299016737e-02; +2.081542268343017e-01   +8.926685306319722e-02   +1.637675940063490e-01   -4.518288661200422e-01   -2.521620921116976e-01   -1.221722995591395e-01   -5.716717749073044e-02   +4.522779465774605e-01   +6.499509457283439e-02   +6.251053276308075e-02   -2.198605577884427e-01   -1.271546382063237e-01; +2.090015861201721e-01   -2.171186754210745e-01   +2.574564244980286e-01   -3.720305119836150e-01   +1.646388041077961e-01   -2.038184903504242e-01   +1.768248536720987e-01   +4.458583554393107e-01   +4.264410753767742e-02   +8.239545660726205e-02   -3.326203920765468e-01   +7.083443675378114e-02; +8.417106255971374e-02   +2.921650408851755e-01   +5.141285317620563e-01   +1.027269310896995e-01   -9.660110740422982e-02   +6.083739893825914e-02   -1.302375562768130e-01   -1.269284694095927e-01   -1.241049119479829e-01   -2.538322955121175e-01   -1.298351672840242e-02   +9.615057942718788e-02; -7.740554357690764e-02   +1.962114345190951e-02   +1.690682867341227e-01   -1.931904723559070e-01   +4.459663224158759e-01   +2.560606900427186e-01   -1.433684682122716e-02   +1.058939312791400e-01   +4.233063491839950e-01   -1.699256910492659e-01   +3.219488196173400e-01   -2.536316840087769e-01; -4.614166887151713e-02   +2.058593919211645e-01   +2.268704418985060e-01   -8.960575188711334e-02   +3.312395708056995e-01   +1.206333725380152e-01   -1.559466789454823e-01   +3.147358102172850e-01   -5.293082198019776e-02   -2.145515545294474e-01   -1.608049141567617e-01   +1.863671806805887e-01; -3.249583583982229e-01   -9.954692518190991e-02   -3.351725402771359e-01   +2.102239536181972e-01   +9.887066551460343e-02   -1.058565577591624e-02   +3.873153871343065e-01   -2.507634487532078e-01   +2.123058690370828e-01   -1.500620945406731e-01   +4.032329850758946e-01   +4.839306127639732e-01; +1.601167328099402e-01   -1.806602806807577e-01   +6.421802515175258e-01   +1.215259900527938e-01   -2.862191742944187e-01   +4.751851017589307e-01   -1.817333728912063e-01   -3.047742654446092e-01   -2.772299734699101e-01   +5.240767281177774e-01   +1.721577974744829e-01   +1.819021257782539e-01; +4.814332655391019e-01   -3.612700246530812e-01   +9.164855485673480e-03   -5.066013325649012e-02   +8.544371064073508e-02   +3.468605102900124e-01   +2.744615836023664e-01   -7.950796108081067e-02   +1.323198244074417e-01   +9.814355618719701e-03   +2.454202030842958e-02   +3.308877051967002e-03; -1.766591343721723e-01   +2.501073502458055e-01   -9.604195436851411e-02   -2.037350938804591e-02   +3.106727569509024e-01   +4.346674915394488e-01   -2.446208210912488e-01   -1.144117596309705e-01   +1.308388915965010e-01   -2.945371912526511e-02   -5.766563969966046e-02   -8.752085199944461e-02];
L2E_Input1_iAMPA_netcon = [-1.692342336073420e-01   -2.538858495351419e-01   -7.286957254819354e-02   +2.965233871168668e-01   +3.102837127929069e-02   -1.239407589251006e-01   +6.260165302310706e-01   +2.472451233532868e-01];
L2I_Input2_iAMPA_netcon = [-3.858466830347282e-03   -1.323911101240354e-01   +2.227726403940269e-02   -8.401085448517909e-02   +3.004757212240775e-01   +7.016233802120145e-03   -3.165033989090812e-01   +5.573674573778150e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
