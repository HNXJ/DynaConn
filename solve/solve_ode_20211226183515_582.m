function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.765860695400781e-01   -1.854028065886847e-01   +2.604268407660685e-01   +7.465912458122198e-02   -3.060458995669098e-01   +9.027291618026120e-01   +2.567948117783699e-01   -5.822123920712601e-01   +6.228916361966943e-01   +1.886773250552368e-02   +3.032352116862955e-01   -7.917749887457211e-01   +7.264461733941239e-01   -4.379079639016798e-01   -2.736849156613680e-01   -2.315713576398034e-02; +4.285484653715845e-02   +3.246051560057421e-01   +3.085153732799437e-01   -5.462755499752118e-02   -4.427083674626840e-01   +6.014249044965086e-03   +3.404726371964208e-01   -1.951470770365286e-01   +2.558541386869588e-02   +6.545215990516460e-01   -3.826751918908072e-01   +1.910844100908061e-01   +7.532700172234500e-01   +3.434928283217454e-01   +5.482567226470312e-01   -6.274130246901520e-02; +4.479544163288179e-01   +1.942574297975926e-01   +2.004219664184084e-03   +4.303064785577882e-01   +8.503972872590165e-02   -2.282376529538248e-01   +2.499255233859086e-01   +1.832679503565134e-01   -2.171604296592989e-01   +4.164012815004424e-01   -6.013199910299878e-01   -4.348699059440774e-02   +2.666286992661941e-01   -1.621264521406474e-01   -4.159616861900392e-01   +1.683407318908245e-01; -5.776439251605713e-01   -7.739288658718850e-02   +7.603666400963666e-02   -6.004733644373289e-01   +5.776429975141788e-02   +7.692644851241864e-01   -9.340834691459142e-02   +1.459371499808973e-01   -2.750640950215608e-01   +2.564914323223388e-01   +3.077320532907744e-01   +2.737744604989049e-03   +1.305116322949358e-01   +3.197518961891224e-01   -2.543816343674954e-02   +5.078454003723297e-01; +1.872735979111095e-01   -4.829777519093169e-01   -3.766201873160920e-01   +6.969356817747005e-02   -2.235080720680781e-01   -5.550503306055585e-01   +4.003291004265455e-01   +2.793323421666718e-01   +5.578897265338261e-01   +4.154403301478767e-02   +3.125309652228770e-01   +5.430024149490317e-01   -8.084507137482215e-02   +1.471581499250834e-01   -9.371570019394097e-02   +9.728171600918822e-01; +2.545928899547576e-01   +2.741971123269183e-01   -6.435832294374276e-01   +6.419521539491195e-01   +4.630089155884693e-01   +9.561743135724201e-01   -3.008301664424939e-02   -4.292554431706996e-01   -2.765587830973952e-01   +1.000000000000000e+00   -1.484869519539112e-01   -4.964612452105138e-02   -2.722055821026140e-01   -3.026880984268151e-02   -2.966246747576477e-01   -3.295444131548076e-01; +3.335743709255290e-01   -2.185309492739351e-01   -1.138912174640251e-01   -1.502389881905354e-01   -7.750726030746729e-01   -5.503206792833600e-01   -4.848002130280565e-01   -3.601718210630664e-01   +3.173974747089982e-01   -7.125761690958440e-01   +6.321936036032676e-01   +6.504460549523128e-02   -1.511632912105870e-01   +9.489880783936318e-02   +1.128907396450863e-01   -4.647890555014308e-01; +2.954576356194322e-01   +3.369490595774068e-01   -1.994756435561530e-01   +7.209178069263126e-01   +1.908717159978229e-01   -5.229597574441955e-01   -6.305962421869533e-01   -5.811232269827239e-01   -2.827152832373409e-01   -2.225842422418338e-01   +7.148601088738896e-01   -1.295757923371460e-01   +9.749434251847870e-02   +1.766798432264050e-01   +2.006536474481840e-01   +4.654803716303904e-01; +3.613742412489790e-01   -4.090251410691441e-01   +5.243714757307613e-02   -6.925505837680517e-01   -1.625848124168872e-01   -2.356092212126966e-02   +3.240290698157208e-01   +2.561365238863408e-01   -3.618720618981306e-02   +5.716774773636004e-01   -7.025744309338506e-01   -4.900891264265053e-01   +2.775457256293222e-01   +1.954601637604425e-01   +5.852779317313400e-01   -5.291987552127582e-01; -4.674792066211461e-03   -1.152158080252996e-01   +2.362893410039697e-01   +2.641550602615217e-02   -6.036056049497064e-02   +5.635189968632698e-01   +5.312012965897328e-01   +6.313904614496436e-01   +6.520365647487625e-01   -5.764027358865959e-01   +9.657863126514429e-02   -8.832061955487726e-01   +8.562440326257622e-01   +8.011382056967907e-01   -4.834746108397844e-02   +3.294597699928707e-01; -4.670567074216808e-02   +8.647103918899864e-02   -8.775710381633989e-02   -3.633750349381632e-01   +1.701103333133952e-01   -7.598828712315934e-01   +2.415243375989594e-01   +6.587600255871419e-02   +6.700133636104713e-02   +2.789187997324473e-01   -2.638856293609778e-01   -3.649123984381241e-05   -7.851873547014104e-02   +4.541642887920296e-01   -9.169732723046081e-02   +2.107654620133792e-01; -1.702958331951947e-01   -5.777066784774431e-01   -2.624488939088001e-01   +6.211367337657198e-01   -3.851359324972619e-01   +7.948760615922985e-01   -3.247014999527991e-01   -9.038332047477081e-02   +3.347486734650643e-01   +4.593291119885216e-02   -1.207424625629262e-01   +9.924709163968035e-01   -5.841172414613629e-01   -2.995024058397533e-01   +1.787318875605104e-01   +4.578324556793294e-02; +4.905562721390415e-02   +7.346503699208464e-01   -1.215315373655558e-01   -3.724823330420864e-02   -5.703760252219247e-01   +7.056457211710631e-01   +4.674849384781795e-01   +1.573308876676970e-01   -4.246472444526503e-01   +5.247573452482929e-01   -1.739950553330940e-01   -6.892873608400527e-01   +7.438712603136572e-01   -1.167658068531132e-01   -1.915691861373023e-01   -1.242988947103985e-01; -1.908781999159808e-01   +2.450618473680284e-01   -1.845272354193596e-01   +7.565771082007572e-02   -3.038332908817760e-01   +2.396976934188933e-01   -3.564747253333959e-01   +1.308923299888496e-01   +6.381188672705060e-01   +1.754810750232330e-01   +3.463715100898884e-01   +4.516022722449218e-01   +7.097546582866074e-01   +4.325846864291530e-01   +4.497816803336817e-01   -5.550360335173218e-01; +8.075674573575341e-02   -5.978172051792805e-01   +3.334697013754149e-01   +3.952802902246833e-02   -5.427078926829721e-01   -2.364981038620058e-01   -6.834787972291906e-01   -2.417709186357994e-01   -1.971037262851708e-02   -6.661612592528746e-02   -8.291769314651626e-01   -2.969017327079482e-01   -2.447668048109826e-01   +8.709332333999333e-02   -2.923272605262091e-01   +4.834657989080530e-01; +9.505801601097407e-01   -7.354576459795634e-01   -2.187330376433224e-01   -1.262502878423728e-02   +3.694083505202217e-01   -6.580933117224810e-02   -1.468815700205762e-02   +1.925066395599635e-01   -1.397546321893749e-01   -1.392029760503465e-01   +4.209004401069796e-01   +3.407482058683002e-01   +1.928444004524775e-03   -3.310459601197286e-01   +1.595368707364997e-01   +1.948298025349991e-01];
L1E_L1I_iGABA_netcon = [-6.962424809146922e-01   -4.299945611129727e-01   +6.256826979512108e-01   +3.466649874083246e-01   +8.868254097487525e-02   -1.911809514768376e-01   -1.476390557746600e-01   -4.920664330735961e-01   +4.492761936291688e-01   +4.921745725382820e-01   +3.656155033839767e-01   -6.148354770261779e-01   -1.040060753043821e-01   +1.595561666704241e-01   +9.503851441880715e-03   +5.602817525600473e-01; -5.844845738305140e-01   +1.898846732603859e-01   -2.645307128340203e-02   +1.681264154780929e-01   +1.915364366518661e-01   -1.609439456627986e-01   -3.102401683528453e-01   +2.692828658093393e-01   +5.320909978948765e-01   +3.662270986660799e-01   +3.729657585569416e-01   -1.697905552630960e-01   -2.469328791210491e-01   +2.417317045925677e-01   +3.183344538572614e-01   +4.705272553199816e-02; -2.653883161676532e-01   -4.107370485428311e-02   -2.678691359911025e-01   +6.093631567238658e-02   -2.211769596973858e-01   -2.788414314950364e-01   -9.973138196440529e-02   +4.350591279211578e-01   +2.270241501922418e-01   +9.858812392953366e-02   -4.313499163196526e-01   +2.200796788038419e-01   +2.530251797209283e-01   +5.050295131236641e-02   -1.464737916958933e-01   +4.287916645273607e-01; +7.276027011982062e-01   -3.434714420683347e-01   +7.674398519266279e-01   +2.286439001694023e-02   -4.412832715216529e-01   -2.764918550411748e-01   -3.129455176319805e-01   +6.480472010711367e-01   +3.070166197852326e-01   +5.442276520780039e-02   +1.464929742284087e-01   -9.395148420394323e-02   +2.480068971074242e-01   +4.303307327327456e-01   +1.147623497284327e-01   -4.242134429073982e-01; +2.177765681093033e-01   +2.094171112028548e-01   -4.820835758674035e-01   +2.706552845371273e-01   -4.709136717160430e-01   +1.461988298484176e-01   +4.593107097323895e-02   +3.586014389246216e-01   -2.294749516861815e-01   -1.706627834737945e-01   -1.679197524185451e-01   -1.902661692269673e-01   +1.023310142541198e-01   -3.529157444737936e-01   -2.995358641451323e-01   -1.873579458268123e-01; +1.894740751890782e-01   +2.435600149032853e-01   -1.287506078806706e-01   +2.538074143026753e-01   +3.101548851592777e-02   -2.198273135991294e-01   +5.684868970073607e-02   +4.615928210654150e-01   -4.043251559842137e-01   +3.471476883781240e-01   -3.477701790088205e-01   +4.643727889753153e-02   +2.930649669034553e-01   +1.000000000000000e+00   +2.978681148073825e-01   +4.210919357781719e-01; +6.091375199936582e-01   -1.926151107625158e-01   +3.041450414134736e-01   +4.820656247695329e-01   -1.746912620363628e-01   -2.629885103907526e-01   +7.062082476769568e-02   -6.107170378115771e-02   -2.780305288446043e-01   +9.650099888955880e-03   +1.173134822225564e-01   +5.035384853965584e-01   -2.802889634974889e-01   +2.563292983857147e-01   +1.958015257654344e-01   -1.963389344986002e-01; +4.000325710860926e-01   +8.263801483793763e-02   +2.380653275647043e-01   -5.733940662278801e-01   +7.019235231735298e-01   -1.083989927725731e-02   +8.889282556899425e-02   +2.254389824463119e-01   -1.787479249527672e-02   -8.561268335618955e-02   -7.475356440512836e-01   +5.525408845265735e-01   +1.016576447550184e-01   -6.262656717917466e-02   +1.873393995493870e-01   -7.749930391583440e-02; -1.224163976769541e-01   -1.639890187504239e-01   +4.404308512431106e-01   +4.339469675156287e-01   -8.707589125074966e-02   +1.415475524311928e-01   -2.811586891325730e-01   +3.370794944595557e-01   +8.924047819336281e-02   +2.479634452377205e-01   -1.422850976061854e-02   -8.655593340855846e-01   -1.938132067225250e-02   +4.354272953978991e-01   -1.850356614985126e-01   +7.094502946907486e-02; -1.726654324305172e-01   +1.415222249371404e-01   +3.173144133379970e-01   +2.345864094082762e-01   +6.262815611991576e-01   -4.075814023767655e-01   +8.761046459712200e-02   -4.076285222687796e-01   -2.759479214103135e-01   +1.337114085867761e-01   +5.797341890686221e-01   +1.158904837753562e-01   +1.901680121340651e-01   +8.566277941841788e-02   -5.668968296836003e-01   +1.576987319009547e-01; -5.102370861265946e-01   -3.849938876889674e-01   -1.658414289719211e-01   +2.950087214009545e-01   +3.048832678882333e-01   +7.954975694744595e-02   -2.983062629655901e-02   -5.697338097739688e-03   +2.854763332251243e-01   -4.950949484622650e-01   -5.843254205111144e-01   +4.777196809708661e-01   -1.199370677478551e-01   -2.546028847649890e-01   -7.535987461631825e-01   -2.095378010829540e-01; +1.560995249155498e-01   +6.295261877652358e-02   -2.266576090644521e-01   +6.461410348673993e-01   -9.441814693981490e-02   +4.202650303730303e-01   -2.089942329642459e-01   +8.797197882395223e-02   +3.412536184226452e-01   +7.726557092746916e-02   -4.408334024677075e-01   -6.482063021660177e-02   -6.596103956201739e-01   +4.339661228009947e-01   -4.365850939392038e-01   -1.344506264653699e-01; +3.881878200511137e-01   -5.697555516455228e-01   -4.625870254682237e-01   +3.433280099722401e-01   +4.150415178283934e-02   +2.193969605411659e-01   +8.057563172599669e-03   +1.610690674800856e-01   +2.182868341057055e-01   -3.738013111611881e-01   -5.259058143841748e-02   +3.205906450547526e-01   +8.722271360310144e-02   -6.356561817946468e-01   -1.607091157145444e-02   +3.903957448790925e-02; +1.972465201935596e-01   -2.199153903864954e-01   -2.297558118485519e-01   -2.434750826290201e-01   +4.666324623598005e-02   -1.578302873668483e-01   +3.305204337623266e-01   -1.981300277641899e-01   +8.331908767324445e-02   +3.853352729328830e-01   -1.779508752285738e-01   +5.735567011248850e-02   +3.207386653224401e-01   -1.729199293158195e-02   +2.078626447428426e-01   +2.013808244318707e-01; -2.639239858661366e-01   -2.895649033484248e-01   +4.627399358758563e-01   -6.083578806711018e-02   +1.546719228992957e-02   +1.650445674760580e-01   +3.850722390280017e-01   +4.461227714672616e-01   -6.748569235791026e-02   +3.957728163029495e-02   -2.978364105898076e-01   -5.587262253350107e-02   +4.606306731045567e-01   -4.760643128074931e-01   +5.321877924022032e-01   +9.787095416965030e-02; +6.358722820340985e-01   -2.525994223673489e-01   +5.574524965170528e-02   +4.361615453259089e-01   +4.269239626897596e-01   -4.082934409023939e-01   +4.346270825220937e-01   +7.605707823890422e-01   +1.296642126452400e-01   -1.712342745875517e-01   +6.271819199193418e-02   +3.171370878866313e-01   -2.887497226943342e-02   +7.373284361615930e-02   +7.727066107255161e-01   +7.854587204103085e-02];
L2I_L1I_iGABA_netcon = [+4.067660835462839e-01   -4.354031224882894e-02   -2.459630943336642e-01   +7.360362953815276e-02   +6.154889172090142e-02   -1.030930016998175e-01   +9.701558796767943e-01   -5.807098600837860e-01; +2.604397462617876e-01   +2.676277570322914e-01   +5.712271858761525e-01   +1.267640780790642e-01   -3.226246044963626e-02   +2.093192285705947e-01   +2.701969922419935e-01   +1.397588576132537e-01; -6.986434681446650e-01   -2.883343527790903e-01   +7.631557914216912e-01   +3.661841116349616e-01   +3.234245262487324e-01   -1.015712497121450e-02   -4.725357588964443e-01   -1.679801908285698e-01; +7.553363407084415e-01   +1.821694851237747e-01   -2.806359327656291e-01   -8.428254207619763e-02   -3.208177249317654e-01   -2.867356230219254e-01   +1.000000000000000e+00   +1.994244932034794e-01; +2.012878553546114e-01   +2.046037251836006e-01   +7.728319596508963e-01   +2.263842566284777e-02   +3.139044681553515e-01   -3.576845434258748e-02   -4.113528957993740e-02   -2.078170110431027e-02; +3.813935403471077e-01   -8.670678847354574e-01   +3.458181196393426e-01   -3.115006596259793e-01   -5.332555512294332e-01   +5.403514526907293e-01   +9.173028408262908e-01   +3.205907797369980e-01; -5.004164483205213e-01   -7.644698507955755e-02   +1.998696149419807e-01   +3.921410503155034e-01   -3.196031850885889e-01   -7.447985378964650e-02   -1.040447578328847e-01   +3.260904089666915e-01; +3.283757118821863e-01   -3.606599998931430e-01   +9.070627848007794e-03   -3.417630866693750e-01   -3.299060598782843e-01   -4.844036342275689e-01   +2.793511252411306e-01   +4.090803519134090e-01; -5.045205046717313e-02   -5.626618239539423e-01   +4.193260128818024e-01   +3.969252478680319e-01   -2.418400620317920e-01   +1.096662312010816e-01   +4.609246188044418e-01   -2.888871738879509e-02; +2.051337659150275e-01   -2.313708694836312e-02   +3.040892700055727e-01   -6.552754731393284e-01   -2.098814745266256e-01   -4.751440267322088e-02   -9.724115787134990e-01   +4.100301294247884e-02; -1.234373939849266e-01   +5.938956752178189e-02   +9.029562892060229e-01   -1.389874696776404e-01   +1.788910334017671e-01   -9.479544308375728e-01   +2.031110143184137e-01   +2.704961527024338e-01; -1.733183903018688e-01   -5.789529099649549e-01   -2.014992356959294e-01   +1.333617468598446e-01   +3.635497454703202e-02   -7.840290747537795e-01   -5.439784105282335e-01   +2.585809755942762e-02; -3.823519457935391e-01   +5.485954735585230e-01   +3.664120084579530e-01   -2.475250399009407e-01   +5.644270254278203e-01   +4.887915010603545e-01   +3.424398879952457e-01   -6.181114118528289e-03; -4.789379720274847e-01   +7.595084835155076e-01   +4.360400162368493e-01   -4.004799578673736e-01   +2.226199633085869e-01   +4.103227999831435e-02   -7.823444966177719e-01   -3.552655564129517e-01; -1.513703045559091e-01   +6.053280409600340e-01   -8.789018131883689e-02   +4.438258184193840e-01   +9.302726560887334e-02   -6.350883324198533e-01   -8.369090882424005e-03   -9.380252084845821e-02; +1.948500024795990e-01   +9.460744434095865e-02   +4.431002749786175e-01   -3.428928105807710e-01   +6.041751702273555e-01   +1.973550746054295e-01   -2.781852619011115e-01   +6.395161836803946e-01];
L1I_L2I_iGABA_netcon = [+8.893952074454913e-01   +3.786187952447510e-01   -7.069859463059796e-01   +6.939100366899265e-01   +3.814126856051922e-02   +4.743962622931991e-01   -4.035112635085633e-01   -1.835874142570706e-01   -3.893338634586879e-01   -5.019541784660730e-02   +1.470793652465493e-01   -7.455630383987120e-01   -7.060620824986300e-01   +7.692543264886135e-01   +4.140522995595345e-01   +4.172155058401513e-01; +2.824613792070396e-01   -1.384939288825027e-01   +2.335189484040398e-01   -3.561717383728868e-01   +4.339968806798553e-01   -6.446213542974651e-01   -3.970067168622781e-01   -1.312677932104490e-01   -6.148070125251436e-01   +1.069200207667018e-01   -4.857402747319692e-01   +5.854867770773480e-01   -2.252252513256758e-01   +8.926915726140483e-02   -4.414565822027954e-01   -1.271987060200910e-01; +5.871950093496314e-01   +1.220644396032829e-01   -6.602029464195622e-01   -3.131123198585084e-01   -1.928667862098253e-01   -2.023719443334517e-01   -2.847398493882870e-01   -4.682591410911047e-01   -1.152168268716533e-01   -2.167909275059469e-01   +1.246506329858814e-02   -3.394216444307224e-01   +4.902405538111039e-01   -3.563567970954706e-01   +3.530510336909168e-01   -3.994331465278294e-01; -5.163260581040900e-02   -2.759809771038654e-01   +4.429250220932923e-01   -4.095429237717508e-01   -6.976892077363406e-01   +1.551923242815281e-01   +5.297648991404136e-01   -1.373726389874239e-01   +9.123614091181185e-01   -1.162946557737897e-01   +6.848915754704540e-01   -4.260018355269974e-01   +1.450968064266442e-01   -4.073584974144953e-01   -3.925302153758754e-03   -5.369232166215983e-01; +1.359392755144015e-01   -2.395408058591242e-01   +3.721163947729266e-01   -2.007849832358836e-01   +3.625403407124904e-01   -6.826319764054003e-01   +1.941163405810850e-01   -1.735439502800251e-01   -7.521945959620897e-01   -1.901571313668065e-01   +1.790315582857393e-01   +6.692606669473578e-02   -2.880143418099109e-01   -1.550091373438869e-01   +2.102975025126434e-01   -7.015740388664715e-01; +5.363041136243627e-01   -4.346980199108537e-01   -9.994256591917096e-02   -3.955402310519590e-01   -7.338350195929780e-02   +2.869599147461023e-01   -5.113001227693195e-01   +4.685417982717284e-01   -6.203562620028404e-02   +2.424645422674782e-01   -6.681733739069129e-01   +2.598856871911265e-02   -2.792065412572329e-01   -1.349690131705748e-01   +1.577003507742792e-01   +2.396708069499363e-01; -4.162840619241389e-01   -7.982766537919299e-02   -3.281380097061008e-01   +5.311276933592183e-01   +5.921423671842815e-01   -1.000000000000000e+00   -5.810934524644081e-01   +5.178615959699812e-01   +3.375499186203906e-01   +4.537413885294829e-01   -5.175312208391745e-01   +3.395027630654888e-02   +2.079614665868418e-01   +2.241296060133907e-01   -2.027188715477528e-01   +2.624330010005343e-01; +3.035731862012196e-01   -4.638181597671991e-02   +5.597319687811277e-01   +1.235365093554986e-01   -1.391734526968833e-01   -8.867574769422483e-01   +7.029058679418868e-02   -5.182279523967871e-02   +7.999564545557106e-02   +3.961738212487806e-01   +6.328396320249419e-01   +2.654328770079871e-02   +1.634041732911178e-01   -1.282283166107874e-01   +8.324960042977634e-01   -3.045715620917311e-01];
L2E_L1E_iAMPA_netcon = [+3.157732627916305e-01   +5.185880386980076e-01   +1.466819624277469e-01   -4.315291384394899e-01   -3.685267206053996e-01   +2.007018093076882e-01   +2.298667137565459e-01   -3.992960552061418e-01; +7.619274244229278e-02   -4.131078653751554e-01   -6.826695934173401e-01   -1.995368789867678e-01   +1.994365016619715e-01   -2.578773408685902e-01   -3.401717771148781e-01   +5.564213875650909e-01; +2.030555516195135e-01   -3.423959364122066e-01   +5.523123763948538e-02   -3.220664308292597e-01   -1.354501096328822e-01   -7.161516443839278e-01   +1.346294310054310e-01   -2.517397382818822e-01; -6.292644902062376e-01   -1.327886366422606e-01   -1.364772624350113e-01   +5.673406399324441e-01   -3.846036533532566e-01   -1.382983080355135e-01   +3.154175980108325e-01   +5.574822655196980e-01; +1.970049731430070e-01   -9.636952664370654e-02   -1.847193248783672e-01   +8.873568415730220e-01   +6.024658840120738e-01   -1.877168246188502e-02   +5.182337487458654e-01   +1.147782964056547e-01; +5.861797278349493e-01   -7.295225754470359e-01   -4.642406073335145e-01   +9.565015329899827e-02   -6.826319645341848e-01   -2.579043773466948e-01   -7.008262514416717e-01   -4.232871078383602e-01; -4.144824728533185e-01   +7.615899158417203e-02   +5.550949160681880e-02   -1.097229321752228e-01   +4.053774508542497e-02   +1.364109320859643e-01   -1.895028266166497e-01   +7.567662917218360e-01; +1.799516094436436e-01   -5.263122389897908e-01   +2.626468579609881e-01   -3.406846430989188e-01   +8.457133575994610e-01   -2.017643606119682e-01   -3.931149815893683e-01   -2.455826574876951e-01; +2.549858359152907e-01   -9.082586971621587e-02   -4.362507052834116e-01   -1.063535104743790e-01   -2.736720697758735e-01   +1.385297276723885e-02   +3.627855445682558e-01   +1.029010395595802e-01; -4.076577621988313e-01   +2.956318464626059e-01   +1.173401022058909e-01   -1.470012967109530e-01   +4.067493548658051e-01   -2.780451865242201e-01   +7.621021136147303e-01   -3.718230585924593e-01; +1.159236082678380e-02   +4.206053445783605e-01   +3.509564621419305e-01   +2.012590021293464e-01   +7.909321724255926e-02   -1.000000000000000e+00   -3.297685778293651e-01   -2.719633344856471e-01; -4.008941623796884e-01   +5.707484380962505e-01   -2.795719549499581e-01   -2.550360260885468e-01   +1.834602836502307e-01   -3.732291642584624e-01   +7.113258241791041e-01   -4.494200246297360e-01; -1.664841695769187e-02   -5.786117963971393e-02   +5.594605493814870e-01   +5.858042046800080e-01   -2.803259781825826e-03   -3.461933606248468e-01   -1.140693064432312e-01   -1.666579005799824e-01; +3.790174062766564e-01   +5.962076244513319e-01   +1.930962664938327e-01   -3.834186892861409e-01   +2.246681546896811e-01   -3.281128298371684e-01   +2.340020838301858e-01   +3.042545355103342e-01; +1.800386469031180e-01   -1.450048830701079e-02   +1.777588904296843e-01   -3.498407101086008e-01   -3.209786234681785e-01   -4.740110402544710e-01   -5.114933478125059e-01   +2.001182925384049e-02; -1.199810899477844e-01   +8.145679951782230e-02   +1.976493505248513e-02   +6.023560351917268e-02   -5.697439781343585e-01   -1.208508024497606e-01   +1.092751276001171e-01   +6.274789168189094e-01];
L1E_L2E_iAMPA_netcon = [-1.860149021838762e-01   +5.923110172892582e-01   -8.314542675142387e-01   +1.421739685173864e-01   -2.763402543996513e-03   +5.950054011050508e-01   +2.428727324310486e-02   -2.663272776524139e-01   -1.660856527538032e-01   +2.727171021317636e-01   -5.599651181379660e-01   +1.000000000000000e+00   -2.373960182666732e-01   -4.820804798139703e-01   -2.308979736216689e-01   -8.793460133079516e-01; +1.503484671312748e-01   -4.982282946285470e-01   +6.311201908864848e-02   -5.238502335785292e-01   -5.672542386383294e-01   -1.724048017361448e-01   -1.240424386957465e-02   +3.051734880012755e-01   +1.616363016471232e-01   +7.832914672961019e-01   -1.998482221552856e-01   +5.273807771680422e-01   -1.584477174998074e-01   +8.082220825340422e-01   +6.035720735116158e-01   -1.737295698776684e-02; -7.215832406536370e-02   +3.281646314004656e-01   +4.871151493368128e-01   -2.825031827193049e-01   +7.990757387083671e-01   +7.244709252749747e-01   -4.772331220804217e-01   +9.171518270063045e-02   +2.024311907863107e-01   +8.066408659400161e-04   -6.701941947979040e-02   -3.758470061101205e-01   -3.761613222930509e-01   +2.349791279725918e-01   +4.955034334728828e-01   -5.009222542571116e-01; +1.502037808083164e-01   +1.252853816695064e-01   -3.737603211935978e-01   -1.277901232519771e-01   +2.992218794627486e-01   -6.256734303061981e-03   +5.475515510600811e-01   +3.875450004438652e-01   +3.584024587314677e-01   +5.768489053350495e-01   +2.140370203949879e-01   +7.766058300381942e-01   +3.053493435341063e-01   -1.742510399678034e-01   +4.605573654321238e-02   -3.119387154790707e-01; -6.228394098170696e-01   -6.385049533818124e-02   -3.364991200955636e-01   -3.601486519737904e-01   +9.979583324328302e-02   -2.161048384321437e-01   +7.988773257823768e-02   +4.139716027830710e-01   -6.619670007551851e-02   -3.484238724404957e-01   -3.151517609061511e-01   +1.417385144251951e-01   +2.541030883510530e-01   +5.924926151759190e-03   +6.251773625907163e-01   +5.536503925149052e-01; +5.468016271929206e-01   -1.522584651619380e-01   -5.898289074636635e-01   -1.345235860144509e-01   +1.405096180807911e-01   -3.539804690052307e-01   -4.806875227829041e-01   +5.314885021324683e-03   +5.135688910401494e-01   +7.682148640493370e-01   -5.068058503098685e-01   -5.486959270145182e-01   -4.234883811248157e-01   +2.296990244580488e-01   -1.172415291799197e-02   +6.736660163094427e-01; -1.703017840451835e-01   -1.791834547919025e-01   +2.904969268221913e-01   +7.547571375989897e-01   -4.217240966865933e-01   +4.621496340392497e-01   +2.900801928416540e-01   +2.351298792785944e-01   -6.118128399791147e-01   -3.885087764853773e-01   -1.491895758172657e-01   -3.063770857992458e-01   +3.856764950120000e-01   -2.325557857531883e-01   -8.074281044094992e-01   +1.403007596728377e-02; +2.707818684028536e-01   +2.284936219014719e-01   -2.346103756999266e-01   +3.299952806347772e-01   +4.413479780887187e-01   +3.852013290283466e-01   -6.283257782190960e-01   +3.046156794663376e-01   +1.097436067165476e-01   -2.741370321750080e-01   -5.002327169482000e-01   -1.675134444411271e-01   +5.886459282993518e-01   -4.276424316340602e-01   -2.794963295877061e-01   +4.519372173709786e-01];
L2I_L2E_iAMPA_netcon = [-9.293807632007352e-02   -8.660500148142691e-02   -4.922120618854551e-01   +3.522085516846329e-01   +3.289195977659061e-02   +1.000000000000000e+00   +8.224229033143847e-01   -7.925078514996445e-01; +6.924303957579637e-01   +1.224125496844841e-02   +1.089137908605818e-01   +5.190378659796105e-01   +5.092065154680507e-01   +2.382613808870273e-01   -6.608282252560482e-01   +1.979614643137153e-01; +2.042568595588030e-01   +1.002957991277610e-01   -3.719598099268788e-01   -4.062308325217594e-01   +1.061885334611831e-01   +1.113336471084992e-01   +6.492054829736463e-01   +2.380893436257937e-01; -4.212051681991626e-01   +2.452893528412046e-01   -6.341773497870817e-01   +2.736910691552360e-01   -3.293968913755062e-01   -1.394613935247375e-01   -3.928688872312107e-01   +1.771859525177898e-01; +3.725462795479882e-01   +4.522920667997639e-01   +6.080406023056552e-01   +9.500420795911438e-01   +2.785837395011439e-01   +1.809442157215006e-01   +4.095094295468573e-01   -3.550207573564624e-01; +1.968061171519995e-01   +1.423773902067540e-02   +4.335012172949525e-01   -1.276145463238947e-01   +3.353554121356752e-01   -5.529999550487586e-02   -7.721041959946262e-01   -8.030177326950787e-01; -2.069321039632739e-01   -7.883583506614388e-02   +1.318113685761448e-02   -1.300147660373564e-01   +3.559416982498120e-01   -2.089102023463427e-01   -5.878731337115345e-01   -1.764993469773737e-01; -4.017714714747005e-01   -8.593001110785216e-02   +1.038712087480391e-01   -5.007443204986852e-01   +7.866878607191554e-01   -9.284496127043339e-01   -1.813474290673752e-01   -8.476623910919162e-01];
L2E_L2I_iGABA_netcon = [+8.383598870934190e-01   -5.664594417581380e-01   -9.970967215048060e-02   -6.210752481577236e-01   +6.638134358329089e-01   +5.243887208992534e-01   +2.238992071149505e-01   -5.715788705639973e-01; -6.458159915574179e-01   -3.345643867578186e-01   +1.267128430052158e-01   -9.577627136494946e-02   +5.486103112495563e-02   +4.942439458664792e-01   -2.191448774479651e-01   -2.807748273719804e-01; -2.653663879873972e-01   -5.415415417861462e-01   +9.426087225020498e-02   -1.618629911868404e-01   -2.616655581096211e-01   -8.503530504206880e-03   -5.384796629885493e-01   +6.505582831006118e-01; +9.160164156907052e-02   +1.285092493055399e-01   -2.718554043259657e-01   -2.337398180089079e-01   +9.359006690231164e-01   -7.628653419474296e-01   +3.775240353643761e-01   +5.129333610552254e-01; +4.983722645183085e-01   -7.574125486729706e-01   -2.604743144995426e-01   +5.848304834680462e-01   +1.170999877380350e-01   +5.079497984992964e-02   +8.509205479472578e-01   -1.681285279798074e-01; -2.862464205126944e-01   -1.873699478841254e-01   +4.346429018120099e-01   -2.885136596711071e-01   +5.296849104019759e-01   +2.053225139203353e-02   -9.573726389286792e-02   -4.768400594269108e-01; +1.258675270644712e-01   +4.003892816779679e-01   +5.315371000920829e-01   +4.471005542650014e-02   -8.891723276350851e-01   -1.017789102643831e-01   -7.153281979580861e-02   -3.146965012510054e-01; +1.436500555705114e-01   -9.458933399491422e-01   -5.555196983308193e-01   +3.477124190766955e-01   +2.390421949959774e-01   +5.038520938807145e-02   -7.413432982483303e-02   -8.676301977133659e-01];
L3E_L2E_iAMPA_netcon = [-8.605143918127871e-02   +1.572806301176819e-01   -8.083959296025931e-01   +2.265301912737207e-02   -9.790912838244317e-02   +2.856343497721781e-01   -5.208399482020921e-01   -2.470500686842533e-02   +5.247922270154670e-01   -4.027450755301520e-01   -1.404413171374686e-02   -2.765890939120576e-01; +3.812957884978578e-01   +7.946950338351220e-02   +4.379469220389088e-01   +8.692435274846392e-01   -1.986633897499751e-01   +4.374017029014445e-03   -9.329156501749356e-02   +7.603212851736895e-01   +5.603693215824558e-01   -4.900190065331522e-01   -1.329828324806991e-01   -3.332636085188354e-01; +2.671357043790131e-02   +2.077745833926564e-01   -3.641546817551040e-01   +4.930893481848299e-01   -4.732160824471348e-01   -3.388529599615361e-01   -2.544988674318829e-01   -1.898503832630989e-01   +3.185099071284278e-01   -5.629285847733363e-01   +3.974270374244458e-01   +2.084328710092932e-01; -2.829658335226034e-01   +3.138987765220118e-01   -6.043281815303100e-01   +3.348300197329669e-03   +3.358471482330576e-01   -1.020227593025125e-02   +1.700679058902070e-01   -9.176853916494415e-02   +4.418803720254924e-01   -2.955962892997019e-01   -4.567054075847751e-01   -5.717482669179870e-01; +4.247979605174043e-01   -6.701694354531376e-01   -3.429102524230242e-02   +3.676978974689760e-02   -1.032092576245090e-01   -1.122646291555946e-01   -2.600260202756233e-02   -9.757694072534866e-01   +2.113096064949000e-01   -2.304637548980483e-01   +3.078720292497116e-01   +5.736693821081920e-01; +6.040063521405152e-01   -4.994445490544507e-02   +3.808733526624907e-01   -4.213458779659831e-01   +1.376019410259952e-01   +7.798038625428523e-01   +3.584956847660854e-01   +5.087156727801663e-01   -3.599426134638012e-01   +1.189416514544878e-01   +2.533594164195428e-01   -1.797114231855935e-01; -5.959582161079235e-02   -4.768387758620242e-02   -3.641536886573030e-01   +5.534567235859572e-02   -6.892908080082468e-01   -6.384347459820600e-01   -7.837016819709243e-01   +4.584922123721309e-01   -5.280394963490802e-01   +6.872015620572030e-01   +6.243883880845967e-02   -9.524901458964199e-02; +5.000929966727274e-01   -3.830553936252099e-01   +5.565826725538012e-01   +3.085016982668504e-01   -5.132530752364838e-02   -8.040084941081333e-04   +2.805364460460341e-01   +2.945276139579032e-01   +3.471754609083583e-02   +2.398481012149707e-01   +1.000000000000000e+00   -6.610622536114580e-01];
L3I_L2I_iGABA_netcon = [+3.537334215065687e-01   -1.033157720084119e-01   -5.533381771966399e-01   +2.721421484695442e-01   -2.711874957019898e-01   -1.851282857366975e-01   -3.512943886420002e-01   -2.260385222784526e-01   -7.876644569703797e-03   +3.698175014593806e-01   +3.203946882823008e-02   +3.259242198860609e-01; +3.372881882228472e-01   -5.770267517571614e-01   +6.601732741815307e-01   -4.208312467028854e-01   -1.264895972854020e-01   +3.580240676249115e-01   +1.718131760900162e-01   -1.756192877433041e-02   +3.878810743478429e-01   +1.352784281318710e-01   +2.841146094657229e-02   +3.525369825547398e-01; -3.404348918967237e-03   +2.251377612051656e-01   +9.390742195202705e-02   +1.151583354076310e-01   +8.786115352229343e-02   +2.898470233764692e-01   -1.349132947361291e-01   -1.258656409173176e-01   -7.256575818486016e-01   +2.489377855840159e-02   -4.030696105383522e-01   -4.988143627607956e-01; -1.264962464984080e-01   +6.084264575878061e-01   +5.274251396097059e-01   -5.191761274405092e-03   +6.594396644119022e-02   -4.853054979240867e-01   +8.766946229717787e-01   -1.685218920159631e-01   +6.947471007110482e-01   -7.810466849848285e-01   +7.440800967064107e-01   +4.288757054770265e-01; -1.000000000000000e+00   +5.699239491211378e-02   -5.753012297929712e-02   -3.056773803168276e-01   +6.394667549969768e-01   +6.174435451672687e-01   -2.362998212905225e-01   -4.466021612932967e-01   +2.398491280942883e-01   -5.750438586833385e-01   +1.904995376407272e-01   -4.343399044488925e-01; -1.985253819255144e-01   -1.373799782344362e-01   +2.168809554627558e-02   -9.304266370636364e-01   +1.488138312091447e-01   -3.888500697748533e-01   +2.296560110955800e-01   +5.007859499293402e-01   +1.827362253147034e-01   -3.033967665972228e-01   +1.353434158439112e-02   +5.563028177900374e-01; +1.832093451467685e-01   +7.136240896246224e-01   -2.068521164292794e-01   +2.195563440960231e-01   -1.771765576726902e-02   -3.497974507423520e-01   +2.651324411435150e-02   +5.199575966167947e-01   +4.351631344907207e-01   -2.814372130726481e-02   -2.975942277726264e-01   -2.933808355750709e-01; +1.488992360064549e-01   +1.317162071927587e-01   +2.081090675300084e-01   +3.406978845708796e-01   +3.380062768142004e-01   +3.109790626208304e-01   +6.139116526015473e-01   +7.371770598320997e-01   -1.325623661662901e-01   -3.876587008095310e-01   +8.245934760217036e-01   -4.158525705082511e-01];
L2E_L3E_iAMPA_netcon = [+1.646799824407619e-01   -4.923489596454709e-01   -5.343215785182457e-01   -2.711169476596681e-01   +8.902133174350240e-01   +5.795941063738814e-03   +6.243997071119454e-01   +6.005013631564210e-02; +6.721940326666501e-01   +1.556942201853097e-02   -5.417458114713870e-02   +3.013551338836739e-01   +3.388013829379363e-01   -7.008293702924836e-01   -2.776609380117735e-01   -1.626448349601730e-01; -4.891946209386682e-01   -3.244497117299787e-01   +3.172037781194418e-01   +5.016130509201365e-01   -4.565992309902908e-01   +2.127863328137839e-01   -2.272252214912428e-01   -3.633901677922390e-01; +3.227533594268464e-01   -4.790191434560785e-01   +3.535357229862562e-02   -7.496119618324672e-02   +1.534825984143476e-01   +1.445490129253137e-01   +9.007277057049050e-02   -1.631149681061264e-02; -2.269777944107233e-01   -2.441964508096546e-02   -7.822530405583735e-01   -2.149822732406791e-01   -3.360919911760125e-01   +2.245567089257480e-01   -7.580760587150088e-01   +2.074189459348131e-01; +4.447720643412054e-01   -6.541559305924222e-03   +2.606397058234577e-01   +1.117627223966709e-01   -2.340420565291473e-01   +2.587026803988074e-01   -2.081578400739464e-01   -1.403059807708251e-01; -3.689415010804963e-01   -8.246532940607083e-02   -4.265030761503170e-01   +4.550432912366116e-01   -6.564327613666059e-01   -8.534016720263535e-02   -5.642712314252605e-01   +3.016589868133239e-02; +3.586808331034368e-01   +3.955357535843408e-01   -9.399829136371739e-02   -5.403530418810556e-01   -3.296987076680335e-01   -1.165323399918347e-01   -7.463051358155317e-01   -1.857009680799464e-01; -2.081161062484119e-01   -2.637230050932353e-01   +2.721000868741018e-01   +2.843218871196858e-01   +5.524636092307169e-01   +5.154344562017062e-01   +4.170452695203156e-01   -2.680434058024143e-01; -1.583456034225730e-01   -1.565345965984943e-01   -2.495918788733663e-01   -1.270557426205091e-01   -1.000000000000000e+00   -6.917259044457787e-01   +4.570668882043215e-01   -9.264789936461076e-02; -1.341583678705875e-01   -6.469110071842236e-02   -1.087889570231356e-01   -4.057573854112249e-02   +5.339741347791809e-02   -4.844608391112292e-01   +7.143708424780124e-02   +3.713669843642373e-01; +1.371467959063641e-01   -4.329481877158270e-02   +2.044596848317640e-01   +2.666897967547035e-01   +1.688482187885796e-01   +5.914974630542755e-01   +1.796078388236446e-01   -1.618146115545470e-01];
L2I_L3I_iGABA_netcon = [-2.931833474455742e-01   +7.582078356836592e-01   +3.150916364433868e-02   -9.687551791883874e-02   +1.426361229127486e-02   -4.498724481363586e-01   +2.709901892649975e-02   -1.247636265266893e-01; -1.132717653902275e-02   -4.271765153065543e-01   +6.222634747747748e-01   -3.350886078113093e-01   +4.176513855456847e-01   +6.696783323213777e-02   -5.494098477258490e-01   -6.494209119815464e-02; +1.628745805868012e-01   -5.396653858771871e-02   +1.918283491796905e-01   +1.412364136049440e-01   +8.253363214638719e-01   +1.678002864278977e-01   -2.937709248426417e-01   -3.590041798329782e-01; +2.135882384717579e-01   -1.538512491088244e-01   +2.544741005542967e-01   +5.007055299924984e-02   -5.185781964470171e-01   +2.486764059297696e-01   +4.527846502579764e-01   +2.571379698772375e-01; +5.452747917399685e-01   +2.116114551337410e-02   -1.275661086126232e-01   +4.643437369804283e-01   +5.451658593466412e-01   -4.706890731636281e-01   -4.428524016013056e-01   +1.962204163758064e-01; +3.499445849093522e-01   -2.276450395380517e-02   -2.978316300429163e-01   +2.187245457251188e-01   +5.751763733145889e-01   +5.297198467093277e-01   +3.359241766277646e-01   -3.317441127826690e-01; -2.851383015361197e-01   +6.055866144707884e-02   -3.273277787731066e-01   +9.793038200381358e-02   +6.520536172631639e-01   +4.525048231605482e-02   -8.288785956287806e-02   -3.062729626110950e-01; +3.728135629317181e-01   +1.256080397462397e-02   +2.517913415811234e-01   +2.256634219691611e-01   +2.137220429903723e-02   -2.504292149990105e-01   -2.057514284071582e-01   +1.775837087105592e-01; +1.276313931399710e-01   +1.000000000000000e+00   +6.358498939096313e-01   +7.215995392315441e-02   +1.521747312198885e-01   +8.273319637613369e-02   -1.697925598072436e-01   +4.712237071035266e-01; +3.302365257033218e-01   -6.125761787135878e-01   +3.067848539730081e-01   +2.446908054675150e-03   -6.459946319016668e-02   -1.957904450989350e-01   +6.001101447362532e-03   -7.731594127062474e-02; -5.178774131985623e-02   +1.290530623858774e-01   -4.015721350912461e-01   +3.067744896249502e-01   -5.942618466908280e-01   -1.655363896553806e-01   -9.625483685476445e-03   -5.513354734775643e-01; -4.785222373820319e-01   +3.241510328695564e-01   +3.317660388541705e-02   +4.059386491201614e-01   -4.258280297007339e-01   -2.280198212933119e-01   +2.862939777427564e-01   -2.191549111620373e-01];
L3I_L3E_iAMPA_netcon = [-4.593393544924222e-01   +4.088551752951185e-02   -3.738187852101093e-01   +2.081368689344538e-01   -3.677875167035300e-01   -1.085218958280717e-01   -3.619535305748033e-01   +2.637263136326165e-01   +1.064225027962105e-01   -2.415624550049095e-01   +1.960802437824442e-01   +4.456621880110306e-01; -6.435708638510265e-01   +4.794383011159886e-01   -3.441160855449416e-02   +1.427764577126255e-01   +6.459517684302943e-01   -3.300835387508631e-01   +5.414944940271418e-01   +1.199977861701518e-01   -2.683103411279399e-01   +4.648896512382597e-01   -3.872612846291137e-01   +3.094741696433457e-01; +5.522418257445845e-01   +4.007521427120111e-01   -5.966295429557126e-01   +4.809527380801191e-01   -2.694969086858379e-01   +8.335857316116806e-02   +8.223975423117733e-01   -1.610820344461275e-01   -6.315940711686976e-01   +2.592256402224007e-01   +5.413043884133834e-01   -2.437068512723929e-02; -1.211197555948686e-01   +4.181884362963040e-01   -1.280336383926474e-01   +7.319777436934138e-01   -1.106536237610132e-01   +7.695276555577216e-01   -5.018759142794923e-01   -3.118523260815468e-01   -1.803216769015262e-01   -1.749518085156554e-01   +4.101448163507699e-01   +4.033604977800155e-01; -7.792616921839232e-02   -3.200131346313240e-01   +2.833111314077617e-01   +3.570493017283831e-01   -2.850697341778233e-01   -3.294499986321295e-01   +2.627128052726531e-01   -6.247523491659365e-01   +6.507005313109845e-01   +1.202439127056744e-01   -1.816108360521240e-01   +2.338692602474748e-01; +6.032142998643136e-01   -2.658665834993845e-01   +4.349923858459884e-01   +3.276205858643080e-01   -2.675090552331832e-01   +1.994628323251848e-01   -1.196826629515878e-01   +3.570916041824022e-01   +1.747478383779714e-01   +5.230924426463809e-01   +5.077910769555205e-01   -2.900466740141364e-01; +2.109506114966549e-01   -3.033694367931252e-01   +3.094656158279917e-02   +6.099503861023057e-01   -7.185254205275721e-03   -6.003348631920938e-01   -5.845848995110973e-01   +2.164105097877056e-01   +3.792181910047412e-01   +2.851370594540372e-01   +4.872665660993394e-02   +4.478484455476756e-01; +5.876042156868286e-01   -5.670090677471834e-01   +1.000000000000000e+00   -3.144517012741803e-01   +3.188881855894335e-01   -6.010019489603591e-01   -4.984524509028253e-01   -6.934782006536586e-02   -2.267225543201865e-01   -6.013087913836759e-01   +7.447658374464547e-02   +2.137447316315235e-01; +2.283328604535842e-01   +7.934084948794966e-01   -5.288626013181291e-01   -1.431763192933748e-01   +1.861755612059826e-01   -2.709034939210516e-02   -3.948059425939865e-01   +3.202341077938714e-01   -1.453686418655040e-01   -2.878682186532800e-01   +4.350349149267780e-01   +4.523907304407810e-01; -3.144611706795107e-01   +6.667626880914732e-01   -2.205922348421203e-01   -2.187086337778380e-02   +3.149094285169098e-01   -4.955286444815346e-03   -1.102680860704982e-01   +3.415129058829301e-01   +9.306188592885576e-01   -3.521161264072850e-01   -8.060603078223764e-02   +5.181778724595562e-01; -1.146782680172359e-01   -2.628823811003443e-01   -1.962056229687406e-01   -2.863040969288189e-01   +2.450502010517772e-01   +5.328313084426242e-01   +9.170631803333021e-02   +5.724629757759158e-01   -9.595402258233343e-01   -5.486994617609832e-01   -2.011718203579211e-01   -7.247650670104885e-02; +3.422049836325301e-01   +4.182442499943300e-01   -1.906535381881630e-01   +1.712745742377232e-01   +1.451769730412384e-01   -2.011834544849502e-01   -1.968254551921725e-01   +3.366266709432897e-01   -5.057516233687299e-02   -5.398586740876683e-01   -5.565855361800354e-01   -6.148138197751509e-01];
L3E_L3I_iGABA_netcon = [+3.079525361683665e-01   -3.604223827789367e-01   -2.167601411264356e-01   -3.852291322628935e-01   +1.842881587664790e-02   -1.246310046819283e-01   +2.110800402179409e-01   -2.741872075445396e-01   -3.862057913131438e-01   +2.409053523768518e-01   +2.688474804583652e-01   -3.885812540113165e-01; -8.711385759544105e-02   -2.842444678504377e-01   -7.444303019927687e-01   -2.343798393069019e-02   +2.130790134658136e-01   -4.366555647406078e-01   +5.347234751105759e-01   -7.360209886248825e-02   +1.169879545689756e-01   +1.690651387792201e-01   +1.926360105143953e-01   -2.118197441148151e-01; +3.479720356579954e-01   -2.860573640634467e-03   -4.372045756652487e-01   +1.398925653100701e-01   +1.085815959513656e-01   -2.412397289719778e-01   +8.683443773117081e-01   +4.494759942547569e-01   -3.688123324992202e-01   +3.381523634091995e-01   -2.639571777081258e-01   +2.849931760938232e-02; +6.739492123008842e-01   +4.405865704099983e-01   -4.578150525957277e-01   -2.235151516145476e-01   -7.261964696712684e-01   -3.135147802441869e-01   -5.696572489649975e-01   -3.128464380088561e-01   +1.931286744734164e-01   +3.371569726949710e-01   +2.089368647026751e-01   -2.017327967041121e-02; +7.353638584441602e-03   -1.873163813667647e-01   -1.034560132099682e-03   +8.441408898522023e-01   -6.341645843200443e-01   +5.039383777773796e-01   +4.668943531431556e-01   -1.039642016209041e-01   -1.197525166509032e-01   -4.298270738062647e-01   -2.122105567780982e-01   +2.395360197694474e-01; +5.653871217956929e-02   -4.856083868594934e-01   +1.990711192958283e-01   -3.911778812896999e-01   +1.875029562757359e-01   -1.152628545078367e-01   -5.572789525537631e-01   +2.304784341983496e-01   +5.321679378012897e-01   -1.766719284268417e-01   -1.152786113831246e-01   +1.566106114543367e-01; +2.188200895370253e-01   +4.911984455832707e-01   +2.209999568956446e-01   -2.278053800336043e-01   -4.094289586494704e-02   +2.643043656215490e-01   -4.057576077524165e-01   -4.328088162410609e-01   -1.907095229831259e-01   -4.261156440112899e-01   +5.181498770724521e-02   +7.191582981964620e-01; +6.116447197269649e-01   +5.645835181751824e-02   -4.250229358046953e-01   +6.587740289729113e-02   +9.400184497294648e-01   -8.071575153289958e-01   +6.114141200908185e-01   +1.126119676386829e-01   -4.180272114766191e-01   -8.594286562691997e-01   +4.306896596022699e-01   -1.265944176498790e-01; +2.808802430827256e-02   +9.853453450606855e-01   +9.632942460836474e-02   +5.991772777089022e-02   +3.834063888261595e-01   +9.201910530880437e-02   +8.273787774220462e-02   +3.767257791389989e-01   +4.600142215139876e-01   +5.286136095898940e-01   +1.801947168038426e-01   -6.531403896532522e-01; -2.090337654460045e-01   -2.330616452651051e-01   -3.034416964671494e-04   -7.712227371545650e-01   +6.630145818819977e-01   -5.693918210443155e-02   -5.073748760458954e-01   +9.946984973223688e-02   +5.112015537620248e-01   +4.682560891369000e-01   -1.231996021194316e-01   +4.401111836632696e-01; -2.974802795149186e-01   -2.826142918303942e-02   -2.489263558744285e-01   +4.452580779733450e-01   -2.206347751738108e-01   -4.770738024167737e-01   +4.259814498049219e-02   +4.227290094771208e-01   +4.133163372857590e-01   +2.434327450835676e-01   +5.554201069612392e-01   -4.529474998151926e-01; +2.159497519622343e-01   -9.797289953518772e-02   -1.499126871952026e-01   +5.613452862417176e-01   +2.628844678432639e-01   +2.102975458890549e-01   +4.159458760383022e-02   +1.143298856934865e-01   -5.603765662374695e-01   -2.247150809835730e-03   -1.932085384171657e-02   +1.503818831318972e-01];
L2E_Input1_iAMPA_netcon = [+2.433274651455422e-01   +2.347534336117331e-02   +2.932150497339284e-01   +3.748452186822882e-01   -4.198888652778897e-01   -1.000000000000000e+00   +8.629178662236778e-01   -4.408992829279385e-01];
L2I_Input2_iAMPA_netcon = [-1.000000000000000e+00   +4.266246751867557e-01   -5.447416767503224e-01   -3.054097534501758e-01   -3.813058977226955e-01   +2.388027754118526e-01   +1.786532523284780e-01   -4.805278018706094e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
