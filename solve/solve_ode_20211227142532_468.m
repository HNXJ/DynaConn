function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.206578783921511e-03   -7.627384242632907e-03   +2.730878335646164e-02   -3.807670379104356e-03   +6.483922819619552e-03   -7.789791184201939e-02   +2.088532894230377e-02   -8.257865631223581e-02   +2.561800105820395e-02   +5.877114044635159e-04   +1.293256142472742e-02   +5.249438309305108e-02   +4.266808044462726e-02   -6.073781485873141e-02   +4.013152998363773e-02   +4.392177256156382e-02; -7.447036512964078e-02   +2.700467844875169e-02   -4.665691645558734e-02   +1.993395501619206e-02   -2.616150823613850e-02   +6.042035283183021e-02   +3.116323994317683e-02   +2.966019736301382e-02   -5.297184783497554e-02   -3.729640137658730e-02   -6.420559823726625e-02   +9.467631538206420e-02   +1.376742615358754e-02   -1.058929440086731e-02   -3.153912311385581e-02   +5.173310138698364e-02; -1.224989523148731e-02   -6.737143952289780e-02   +3.569189435000730e-03   +1.107386714246466e-01   -1.116129872330638e-02   -4.942014305468501e-02   -1.424131723621528e-01   -9.744720780633867e-02   -1.127747726438072e-01   +3.430439974794735e-02   +5.464222493874804e-02   +8.828725314531051e-03   +1.129560676837999e-01   -6.820782662407684e-02   +8.131503898877816e-02   +2.625123060242028e-02; -7.429896966413632e-03   -3.266835491156074e-02   +2.497007165462090e-02   +3.707889653626398e-02   -6.362354315345587e-04   +3.111066925620454e-02   +1.660908804327067e-02   +1.937116395783249e-02   -1.254605024037872e-01   -9.128906842438110e-02   +4.510014584059168e-02   +7.293372540286290e-02   +1.072768805861731e-01   +4.432174099427152e-02   +5.130549009591656e-02   +2.077567126813016e-02; -2.269008326394351e-02   -1.975293297208962e-02   -8.175830874790313e-02   -2.564969849742245e-02   -1.420963288806348e-01   -6.543324313926855e-03   +5.220158074587714e-02   +8.843633674489712e-02   +8.545130056506955e-02   -9.622069518208573e-02   +5.412416928102806e-02   +8.282201291333505e-02   -1.063024299153061e-02   +4.534507585973854e-02   -4.599632631287535e-02   -2.199508858666806e-02; -1.272008352861926e-01   +9.952913268614016e-02   +1.183383505096042e-01   -6.036764508431337e-02   +2.487398522642579e-02   +5.554819293105120e-02   +3.451533452934734e-02   -4.912272243296649e-03   -3.985683331873172e-02   -2.572876001288790e-04   -9.548019846142643e-03   -2.593870741482448e-03   +8.092469860495022e-02   -6.740910584241033e-02   -1.175785550047931e-01   +3.993840068253071e-02; +3.303452697471342e-02   +1.103645758636887e-01   -9.084479301048079e-02   -9.719473550451486e-02   -9.198945698300807e-02   -5.689257092678510e-02   +8.335005306155104e-03   -2.494147635551915e-02   +8.838601420255351e-02   -4.604497677758271e-02   -4.831329771200512e-03   +4.488194913859346e-02   +8.235249324121219e-02   -5.325893187735000e-02   +1.122826139780950e-01   +9.245376433037691e-02; +1.766594693717491e-02   +1.182155196385740e-01   +1.440608936887144e-01   -1.155534683570171e-01   -6.255238319052897e-02   -8.652559527364738e-02   +1.008664252002523e-01   +8.958166032109491e-02   -6.557392843122395e-02   +3.076562061602053e-02   +9.633633422146870e-02   -9.545549843991033e-02   +2.603570389692659e-02   +3.221594818975557e-02   +4.745095930974261e-02   +2.732142870188328e-02; -2.947446006000806e-02   -6.298354487188909e-02   +9.968695486494326e-02   +4.216559515094206e-02   -3.025384605799320e-02   +6.135154585081135e-02   +6.310113692462242e-02   -5.399824883246091e-02   -8.662880034083928e-02   +8.111764722459549e-03   +2.183067773634566e-02   -4.262025999699942e-02   +1.243640142966407e-01   +1.078134328270357e-01   -1.466776732231748e-02   -3.905396400964267e-03; +3.374216148677218e-02   -7.265375764707586e-02   -1.729423909120575e-02   +1.406587698514660e-01   +1.736027953143430e-01   -2.617096444368662e-02   -1.577871048395519e-02   -2.891009679555048e-02   +4.832318221527471e-02   +5.656193100293652e-03   -5.573995806039998e-02   +1.359550830747355e-02   +6.254531316899806e-02   +1.078773734123318e-01   -7.736764130550490e-02   -1.226500301276690e-01; +6.152314700978354e-02   +1.646712627482913e-02   -4.836815471836348e-02   -3.528335902865868e-02   -5.946881420557406e-03   +1.473799541187868e-01   -5.309177127940785e-02   -3.305425976189796e-02   +9.613831552503618e-02   -4.945866485876768e-02   +4.057762526842039e-02   -5.716937784382492e-02   -1.120098936553461e-01   -3.525745337964649e-02   -1.140783058822236e-01   +2.297510866245434e-02; +8.875797715722443e-03   -1.080159924756622e-01   +1.472495235495414e-02   +2.921762857364654e-02   -4.317655344293728e-02   -3.966494443702568e-02   +2.562177081885678e-02   +5.957498424620813e-02   -7.593573605296638e-02   +6.677880666406553e-02   +1.579779747827560e-02   +5.438385719439235e-02   -2.778249831047652e-02   +2.522611218201496e-02   +7.737496403899141e-02   +2.241790238653808e-02; -1.213907107962857e-02   -6.028288751284464e-02   +1.329321031784300e-02   +1.669404278888833e-03   +3.679752089373507e-02   -7.501888222392383e-02   +6.229792003579461e-02   -1.007108011190143e-01   +3.429064158597670e-02   -7.228977453845961e-02   +3.808774194513479e-03   +7.628314223009329e-02   -2.302371767369006e-03   +7.163654540209342e-02   -1.490117457701694e-02   -2.198873820807524e-02; +3.911366406307121e-02   -3.044818094716407e-02   -2.792001902916076e-02   -2.527481913161233e-02   +6.887623433959403e-02   -1.307750043913808e-01   +6.919364834805039e-02   +4.636665523784513e-02   +2.900181098043160e-02   +1.706060161776726e-02   -5.494758409379076e-02   -5.361111952135689e-02   -5.523841498167476e-02   -6.525261527525814e-02   +1.259108732167396e-01   -2.446691979695011e-02; -2.847435917112894e-02   -2.867924308998131e-02   -2.129434375488974e-02   +1.384512444233339e-02   +6.768923868200648e-02   -8.178213963162892e-02   +5.153264929494901e-02   +1.057180464315520e-01   -4.955196458953462e-02   +4.992438224078828e-02   +1.949544555996020e-02   +4.061579310856911e-03   +1.300623163577949e-02   -8.683614256274172e-02   -9.910522180060662e-02   -1.978239235431912e-01; -3.239632312722809e-02   +6.448386779787509e-03   +3.620850448353570e-02   -4.022597055543192e-02   -8.268341583869021e-02   -3.203906652976762e-03   -8.019909946316953e-02   -1.251691360635126e-01   -2.460303156485442e-02   -2.568497468509179e-04   -7.634529676759766e-02   +2.466710171932569e-02   -1.942200437367992e-02   -3.583733317267780e-02   -6.371161094252682e-02   +7.975592514674995e-02];
L1E_L1I_iGABA_netcon = [-1.815065371831229e-02   +7.070858754224266e-02   -3.524596377275940e-02   +1.151912542794690e-01   -1.125793360275150e-02   -6.624529441844478e-02   -1.074125340447327e-01   -5.019839075259114e-02   +7.026367436648367e-02   -3.963745253495592e-02   -4.823441691118678e-02   -1.150737362142181e-01   +4.688903562216286e-02   -5.593753204495563e-02   -4.944230639784159e-02   -1.155425575259607e-01; +1.526514303818154e-02   -4.033238457108862e-02   +1.682362551296257e-02   +3.007291488375019e-02   +1.589034642296056e-01   -8.533718544327076e-02   -1.095126374714698e-01   -6.175317156449093e-02   +4.633138684313339e-02   -7.171029502318417e-02   -1.103133067964140e-02   +4.883431396086943e-02   +1.273312947601599e-02   +2.645727387130915e-02   -5.553029450882795e-02   -2.893886926751028e-02; -5.408893289085986e-03   +1.000236762960159e-01   +3.557425608132492e-03   +5.336028637465773e-02   -9.168013955337792e-02   +7.090494538446186e-02   -3.977307771351304e-02   +8.126591868157683e-02   -1.146135158338645e-01   -7.830185774191273e-02   +1.124843604004056e-01   -1.077995948440326e-01   +4.007136197012946e-02   +7.433623834408993e-03   +7.788275397925534e-02   +4.829750787807898e-02; +3.899614176230068e-02   -2.068960028280351e-02   +1.481473064895996e-02   -5.245316301759161e-02   +3.170606380198153e-02   -8.546214895162647e-03   -5.126096367837456e-02   +6.686431769107018e-02   -6.540880477882120e-02   +1.276839564182057e-03   +1.395101531390502e-01   -1.115023363736643e-03   -1.261388921640527e-01   -1.980862641701093e-02   -1.958797073473905e-02   -6.936066823517320e-02; -1.449852941659931e-01   -7.178275344172837e-03   -6.763415119057091e-02   -3.163602322396260e-02   +3.362517238085759e-02   +4.024773126672301e-02   +8.309796225573153e-02   +1.582470635792160e-01   +1.284267275002154e-01   +3.289368404889287e-02   -4.529294462395028e-02   -2.978679672743267e-02   +8.712357663148330e-02   +4.384572176176131e-02   -4.968667565511503e-02   +3.604163573435105e-02; +1.195366855468297e-01   +4.208221681135137e-02   +6.407110453859256e-02   +6.968099072902298e-02   +7.011297903028124e-03   -4.015788781566780e-02   +5.628693974638369e-02   -5.382779061295140e-02   -9.397570240477143e-03   -1.336738441873461e-01   +1.131802373891793e-02   -1.098739763811578e-02   +6.376958195086366e-03   +3.489807090374077e-02   +9.954997376806331e-02   +8.389969586392817e-03; -3.107938802174165e-04   -3.697490354146334e-02   -1.641757932686942e-01   +8.097695679097643e-02   -1.215018880976764e-01   +1.884018172445665e-01   +1.882110051433442e-02   +9.606144683448894e-02   -4.185065809787049e-02   +8.989884577405208e-02   +3.256049372410440e-02   +2.749455949235817e-02   +9.089544649682826e-04   -8.699553430487697e-02   -6.101499211477636e-02   +5.139333130118561e-02; +1.531449461381437e-02   -8.729358235937645e-02   -4.540250093476618e-02   -6.610503203228954e-02   -5.426956150319515e-02   -1.087747806674544e-01   +4.617407159192412e-02   +8.033007092948657e-02   -3.978285690344922e-03   +4.646311934603752e-03   -1.280653724864948e-02   +3.614436736325829e-02   -1.040028739987749e-02   +1.216889333573996e-02   +9.453502167819505e-02   +1.411503360770559e-01; -3.707842146748357e-02   -2.971792636081193e-02   +1.037464552058801e-01   +8.797300944092160e-02   +8.371623073140209e-02   -3.597493019492638e-02   +4.988490665114061e-02   -2.519567535307750e-03   -8.554601983722010e-02   -9.845480023522429e-02   -1.282671060834730e-02   +9.388233877940414e-03   +5.153327336502363e-02   +1.145969778611757e-01   +7.513171360654743e-02   +2.488455547818281e-02; -5.071155217143231e-02   -5.526661276479673e-02   -4.473604885631430e-02   +1.533898886963453e-01   -4.995909244810572e-02   +1.354908750365060e-01   -6.491695571301434e-02   +2.881067201392179e-02   -9.097739923570590e-02   -5.401380926315493e-02   -9.834974416066879e-02   -1.608797811579254e-02   +1.723250146808890e-02   +7.142040110416986e-02   -1.241755105889620e-02   -6.587729735638755e-02; -1.458001528007267e-01   -1.472200755390217e-01   -6.314555347432566e-02   -1.294624009676020e-01   -5.810877818108520e-02   -1.059944046465043e-01   -2.592725930697093e-02   -8.896832321086234e-02   +5.193211336071288e-02   -7.238907237902011e-02   -2.473398478934487e-02   -7.375542324580298e-02   -7.387396404186695e-03   +3.912522899124520e-02   -2.936471336603168e-02   -2.253576699689338e-02; -1.705801453342044e-02   +1.233382405747446e-01   -1.120525626242209e-02   -7.234165593269484e-02   +4.487528962094149e-02   -8.813167652455409e-03   -8.814519441014965e-02   -6.291414245493368e-02   +1.394586812960728e-01   +5.754896896856373e-03   -1.000728272719544e-01   -9.233770725049831e-02   +3.420341071748403e-02   -4.721583742580744e-02   -2.614699056583071e-02   +4.339049578649694e-02; +4.955892131693073e-03   -6.564446215962466e-03   +1.843259086158661e-02   +5.801321695109308e-02   +4.328718306848615e-02   +1.130405745593015e-01   -7.557392733268553e-02   -1.199689829429670e-03   -1.049261637866484e-01   +2.572794633190008e-02   +2.725121056711074e-02   -2.252752911731515e-02   -1.101977878932474e-01   -5.928977951200043e-02   -1.319127272396551e-01   -7.611448312891430e-04; +3.897417184198557e-02   -9.360683194290480e-02   +5.891991761969280e-02   +1.869184294278411e-02   -1.190828231399854e-01   -5.429611894587547e-02   -8.123009152209759e-03   -7.938309440575532e-02   +8.627126898490968e-02   -7.627731566386825e-04   -8.834341339195628e-02   +4.145899271310829e-02   +7.535399546480134e-03   -4.645531648161239e-02   +3.975153959098895e-03   +9.454438473765456e-02; -8.125640451148002e-02   -1.325408920789569e-01   -1.939519151961597e-04   +5.056535914500863e-02   +1.302668162805422e-02   +4.764718362774926e-02   +1.045604339564444e-01   -2.366355239720375e-02   +1.158293015758945e-01   +6.207673219627496e-02   -2.998924582275336e-02   +1.553374471321173e-02   +5.648945789607980e-02   -1.114797067586917e-01   +1.787946559021011e-03   -1.518250686729923e-01; +9.830136587994184e-03   +1.496539932888108e-01   +1.423612805479009e-01   -9.923472622287899e-02   +4.921506121367653e-02   -9.752663566360348e-02   -1.144465745140197e-02   -2.375183179359813e-02   -9.639727693321634e-02   -7.880671468808140e-03   -3.612393940602678e-02   -1.021342499951311e-01   -4.254985351323295e-02   -4.922494657046399e-02   -8.202362018953852e-02   -2.172120452471924e-02];
L2I_L1I_iGABA_netcon = [-1.452275566571611e-02   -6.718283526871519e-02   -3.867542204939967e-02   -1.404134413482929e-01   -8.368145417391254e-02   +4.739786970647209e-03   +9.916805683928968e-02   -8.663009049340556e-02; -6.819856618663951e-02   +1.386208733559754e-03   -3.365857401443122e-02   -1.877046532118191e-02   -4.245595953548854e-03   +2.602847863157102e-02   +1.473834147197016e-02   +1.917489591140971e-02; -1.075483940503448e-01   +4.265660630775379e-02   -8.442391369540175e-02   -2.907916683470655e-03   +1.745102679659681e-01   -5.678047685525634e-02   -5.115909991500471e-02   -1.257790372772897e-01; -1.176203688539269e-01   +3.438701205750587e-02   -1.744342244252254e-01   -2.553691063138383e-02   -2.479868356576508e-02   -8.618439087916050e-03   -4.642742094949615e-02   -3.002627046157398e-02; -9.521319376177025e-02   -8.696556029854474e-03   -9.824258583295259e-02   +7.662274360893406e-02   +6.097749539674831e-02   +5.510399351459884e-02   -5.091593128976936e-02   +8.396511020626791e-02; +9.597973022325855e-02   +7.419412653756902e-02   +8.695792124968907e-02   -2.069569376967836e-02   +1.205562774026380e-01   +3.395482345755037e-02   -1.026015740939454e-01   +1.249019332827378e-02; -6.509872868593609e-02   +1.063792796628419e-01   -8.559833687798545e-02   +3.056661633092993e-02   -6.386590153696470e-03   +5.754093463965113e-02   +2.604671202816595e-02   +7.142352500791710e-02; +1.733061307156268e-02   -6.751180264018118e-02   -1.106442587795738e-01   +7.538013945081534e-02   +5.901778719232900e-02   +3.016235370362667e-02   -6.131252614104116e-02   +5.418229560236247e-02; -8.548523947605705e-02   -8.296974715255410e-02   +7.253090920418294e-02   +8.603885234383570e-02   -5.602903242231745e-02   +4.052840363087337e-02   +9.351922101995400e-02   +1.231808899792530e-01; +3.583148873425356e-02   -5.642756383555237e-02   +6.089380127338961e-02   -3.179766082919303e-02   -9.728660145830856e-02   +1.016039811420727e-01   +2.181924461257393e-02   -1.188879424813377e-01; -1.001553237008867e-01   +9.172450700410710e-02   +3.951777167941918e-02   +1.327379877265865e-01   -9.529381686823998e-02   -1.258709992755927e-01   +2.619633885984787e-02   +8.073762178004715e-02; +5.567634491288785e-02   +4.240430993970278e-02   -4.313754934875343e-02   +1.613432593212172e-03   -4.300933015212649e-02   +6.605289710580582e-02   -4.257864301498687e-02   +8.739090778980732e-02; -3.460723387030777e-02   +2.299379776748111e-02   -2.724343410031657e-02   +1.747316298186961e-02   +2.821731119768571e-03   +1.155144992387338e-01   -1.217097500646200e-02   -1.547319529001380e-02; +9.073317500466399e-02   -4.964158026407510e-02   +5.409010490527489e-02   +1.194464422291610e-01   -6.800072261967866e-02   +5.164250102907815e-02   -7.792595689900808e-02   +1.572959503926659e-02; -4.940442141783952e-02   -1.002309360523323e-01   +8.409128216190739e-02   -7.928229000575035e-02   -9.760659888082512e-03   +8.551509908530075e-02   -6.309762780796857e-02   -4.467478190256211e-02; -1.460616370028285e-01   +1.690975164548390e-02   -8.508557183075369e-02   -6.085302339756988e-02   -3.122406499207025e-02   +1.471571884358821e-02   +1.922966472580534e-02   -1.198727243070157e-02];
L1I_L2I_iGABA_netcon = [-8.362161409834996e-03   -2.592841865407515e-02   +5.738056232369158e-02   -2.593347994630162e-02   -1.090981762478292e-01   +2.222192391720050e-02   +2.817819366729869e-02   +9.044587562151887e-02   +5.937734976383954e-02   -4.404035410620148e-02   +2.723172842106428e-02   +3.205511591767447e-02   -1.644420419224919e-02   +7.036017653855292e-02   -6.831645294687073e-02   -7.657279142846753e-03; -1.698528641499549e-01   +7.293428214338629e-02   -2.903931519714245e-02   +1.803951226977611e-02   -5.063865997474081e-02   -7.712102802823333e-02   -8.085303140493108e-02   +1.423347249976273e-01   -1.703453481608127e-02   +9.006760179975952e-03   -5.732520938582043e-02   -1.163787502468155e-01   +3.813510921614423e-02   -1.316051830571740e-02   -8.660584607592435e-02   +4.015491716164112e-02; +1.911331285282020e-02   +2.574356540314104e-02   -4.732517070890795e-02   -8.803870487761978e-02   +1.639514508947471e-02   +4.961465396696298e-02   -5.566758351866812e-02   +1.941293903225278e-02   +2.109621703610744e-02   -1.032543987460617e-01   -3.062089808744151e-02   +8.045550333020406e-02   -6.522073111301686e-02   +7.367777620893083e-02   -5.118394739895067e-02   -1.554806606959721e-02; -6.778735931619839e-02   -7.288344526045595e-02   +2.177796867019096e-03   +1.346424969565813e-02   -5.808682782050911e-02   +7.072550243095062e-02   -6.330319658598926e-02   -3.343155383625988e-02   -4.357509881118344e-02   -9.358988175855242e-02   -8.058661916115259e-02   +7.127693655612881e-02   -7.635441176662056e-02   -2.644971296312425e-02   +3.457514470244933e-02   -1.422804022924058e-01; +9.310623411664135e-02   -5.185027152834086e-02   +3.693932686062489e-03   -4.006257388995878e-02   +4.562239194772262e-02   +1.150838950919916e-01   -1.747910339089528e-02   -4.408372255283853e-02   -5.005870852507648e-02   -2.787689038365848e-03   +1.150201920803239e-02   -6.378924430665112e-02   +4.412456624349168e-02   +6.512845153800496e-02   +4.257646571678205e-02   -2.932647778978273e-03; -1.391725075452709e-01   -2.298140671420101e-02   +4.894397717146978e-02   +8.269363155786526e-02   -3.668542322719265e-02   +8.920207960985999e-02   +3.391144576288113e-04   +9.433673989755656e-02   -5.948730670703502e-02   +4.416103714765672e-02   +1.114335666505502e-02   -2.416333625076326e-02   +1.217668452761250e-02   +4.341823478415846e-02   -9.054819476224954e-02   -1.567237673684396e-01; -5.032963411830420e-02   +8.917558724038366e-03   -3.539202402509170e-04   -1.093812001101562e-01   +1.745000655448975e-01   +1.274190262945835e-01   +4.073129025738820e-02   +1.206565475515207e-01   -1.489224453633506e-02   -1.190523689273029e-01   -1.333112115516397e-02   +7.603376687255796e-02   +5.930199236890208e-02   +2.205038676272720e-02   +6.409189327311732e-02   +4.176433436037266e-02; +9.097068329198479e-02   -1.273051993452090e-01   +3.173437008038439e-03   -2.890186594957219e-02   -3.063199031235472e-02   -4.228686589507444e-02   +7.559655254250067e-02   +2.366060253337960e-03   +2.901410368253547e-02   +7.041170425377455e-02   -3.257498877023439e-02   +1.531221100694360e-02   -4.053520439397008e-02   -1.797899557941822e-02   +3.004605799991134e-02   -6.586427638733895e-02];
L2E_L1E_iAMPA_netcon = [-9.668696668759313e-02   +3.598948024669887e-02   -3.913930228280316e-02   +2.948687151272381e-02   +2.032105229134045e-02   -1.262175135763785e-01   +6.247604669410729e-02   +3.640367687835816e-02; -4.700330849384497e-02   -7.116494923764816e-03   -6.462554558974927e-02   +2.605269826785278e-02   -2.112724487357618e-02   -7.740959432689366e-02   +4.172001963232720e-02   +1.138762881892747e-02; +5.010556819548388e-02   -8.850370469999172e-02   -9.769058960739664e-02   -1.897538645428584e-02   -5.992648928426041e-02   -3.981922167511807e-02   +1.073968054028795e-01   +6.977223798882272e-02; +1.015483872018888e-01   +8.972620718435688e-02   +9.410853354253988e-03   +1.627363505543351e-02   -5.748054764589137e-02   +9.356289328409259e-02   +5.512867241416440e-04   -2.062948135846217e-02; +7.509499418839656e-02   +2.652645467931969e-02   +5.901258449853614e-03   -7.378585862807562e-02   -7.210053530883784e-02   -5.454167808668937e-02   +5.233528683969565e-02   -4.785162826449085e-02; +8.523617195205267e-02   -6.884935905572760e-02   -2.496590587839052e-02   -6.471967235721612e-02   -8.597383646169061e-02   -5.315894613267944e-02   +2.526698301707652e-02   +1.171349577379651e-01; +5.054482843146214e-02   -2.879499748747097e-02   -9.347671324118142e-02   -8.302911442409452e-02   +3.657607650887422e-02   -2.873989199244035e-02   -2.301979255455364e-02   +1.150143793321592e-01; +9.663291564946146e-02   +8.654090816926183e-03   +7.053587232587963e-04   +6.489231847381148e-02   +3.838932940636521e-02   -2.427771257941296e-02   +1.435198122296701e-01   +3.799696925274613e-02; +2.849965784909462e-02   -1.617400627886152e-01   -4.042997795298514e-02   -7.252822577037916e-03   +7.969600510719740e-02   +3.235936290283894e-02   +6.977540074679922e-02   -1.139718043866250e-01; +1.049600902169205e-01   -1.078926809124715e-01   -1.615532898178430e-02   -2.457964644752160e-02   +5.482116935787568e-02   +3.001971027112126e-02   -2.015410326660744e-02   -1.041505771447091e-02; +4.363578652570722e-02   -9.833859060018013e-03   -4.196780803809260e-02   -5.657146286859573e-02   +8.811496364850471e-02   -8.732565528605488e-02   +8.263120968632891e-03   +1.352159096202027e-02; +1.529053686524312e-03   -3.252944667905990e-02   -9.800139601360548e-03   -5.425190224239618e-02   -9.008611753465298e-02   +2.813124401432552e-02   -1.614765537212121e-02   -8.905070100716300e-02; +4.366244357159337e-02   +2.962699913760911e-02   +3.430025898166676e-02   -1.054487793625097e-01   -3.974173881465865e-02   +3.039235852229232e-02   +1.138557826793989e-03   +1.258849047402136e-01; -8.694521910671418e-02   +2.424824688552505e-02   -4.605404437705191e-02   -1.048673916662976e-01   +6.628085389752056e-03   -3.893305572780522e-02   -1.567964962964289e-02   -1.001303874309911e-01; -2.205469884802674e-02   +4.762897934848042e-02   +5.487822396992356e-02   -2.438733709069246e-03   +3.622831622366939e-02   -3.647524458939567e-02   +1.579409337725849e-03   +2.280086393564473e-03; -6.019257239905344e-02   +1.197582039223632e-02   -5.651618867008169e-02   +1.935197152472667e-02   +1.265859468110873e-02   +1.365064556733696e-01   +1.841948522477620e-03   -4.719366461747597e-02];
L1E_L2E_iAMPA_netcon = [-3.534575478698232e-02   +1.045500378250316e-01   -1.162874404335180e-01   -5.694439380661248e-03   +1.236642650890061e-02   +7.691693060752751e-02   +5.553251038148601e-03   +2.432816709075574e-02   -1.065381078548496e-01   +2.529226428797582e-02   +1.373811274180389e-01   -5.483797543819613e-02   -1.199057602995378e-02   -3.064081132617875e-02   +2.539332366768107e-02   -7.211811730635231e-02; -3.414523200452427e-02   -6.541455744413885e-03   -7.254801104538687e-02   +1.025211331648697e-01   +1.000228920584525e-01   -8.194172684734099e-03   +9.974756836996074e-03   +3.355389323331644e-02   +3.943323761755915e-02   -3.635830566812957e-02   +1.856896840257616e-02   +3.137855814489009e-02   -2.420307971826555e-02   -2.573934453173209e-02   -7.795085185687162e-02   -7.224114437721790e-02; -3.768012308192013e-02   +5.851181335619113e-02   +1.001719573326645e-01   +4.758852570681225e-02   +8.492600849950568e-03   +4.065306951526007e-03   -2.050409136281158e-03   -2.259639669984195e-02   -1.269018480201971e-01   -3.762507700666967e-02   +3.108620424968085e-02   -6.169875053214435e-02   -1.852990370601507e-03   +1.884589328574397e-01   +4.051396432962455e-02   -9.479061919792658e-02; +7.718616919528405e-02   -3.901453778455061e-02   -3.280281242098453e-02   +2.479511283297485e-02   -2.071788076309217e-02   -1.192054855012728e-02   -3.283788021698157e-02   -8.926706022920766e-02   -3.612008357249709e-02   -5.480907951866356e-02   +1.205450381280592e-02   +1.952716355526354e-02   -8.719653345379262e-03   -5.323122185334053e-03   -4.268782357228243e-02   +5.120037625762534e-02; +2.024838949732419e-01   -1.020309940342934e-01   +2.828845531583593e-02   -3.231072065963699e-02   -1.351921755661005e-02   +5.365792946842710e-02   -7.675913201748766e-02   -1.314529635854470e-03   +6.018249681765216e-02   -3.424550386976184e-02   +8.297739175745229e-02   -5.423676859589095e-02   -1.809688615405766e-02   +4.180621896339597e-02   +4.493041764925164e-02   -3.652246376836124e-02; +3.729563512736593e-02   -9.415335121861722e-02   +3.597140017021450e-02   +5.880516072988690e-02   -1.043546561847454e-02   +1.360791098036070e-01   +5.784798115843737e-02   -1.933631431599498e-02   -1.424641584395527e-01   -2.625989473934712e-02   -1.258181599135793e-01   +1.005802492606253e-01   +8.062094189069782e-02   +2.330802600447419e-02   +1.090480489522513e-01   +3.895582236952546e-03; -2.142708920569662e-02   +1.164231239954931e-02   +2.875812441902002e-02   -4.252315023783334e-02   -9.845867648167658e-02   +3.765263379405626e-02   -7.031214277322929e-02   -3.759829797632270e-02   -4.540485447124829e-02   -5.888970617017047e-02   +6.788029163911469e-02   -4.893339947333942e-02   +2.199128062387766e-02   +8.472255264334384e-02   -3.941252067543990e-02   -4.741915926286291e-02; -8.298210384974723e-02   -2.491045755338578e-02   +1.525564333237006e-02   -3.694122819271118e-02   +2.892351432461382e-03   -3.237749974713029e-02   +2.573270844748337e-02   -9.271775352270285e-03   -2.875085935175676e-02   +1.808293540487177e-02   +1.226117703302003e-01   +8.688685662210423e-02   +6.162975880078629e-02   -7.678473380999234e-02   -1.834631728139613e-02   +1.128567680766550e-01];
L2I_L2E_iAMPA_netcon = [+1.660685314885469e-01   -7.793521665507346e-02   -1.408094990578416e-02   -4.255406357414224e-02   +5.794499295659135e-02   +1.067392259784361e-02   +2.917140136135897e-02   -9.500502698991918e-02; -2.798473257258070e-02   -5.206918862178718e-02   -5.093964599392700e-02   +1.173043325870255e-01   -4.993083427862718e-02   -1.547906477988883e-02   -1.360459702096754e-02   +4.572974832436676e-03; -7.313977745277186e-02   +5.734508100140226e-02   -5.794060574965633e-02   +2.070654607583691e-02   -7.751957548834401e-02   +4.021373586409308e-02   +2.599967783217417e-02   -2.701899535553195e-02; +5.423623519544161e-02   -2.662302630877657e-02   +1.299535461267017e-03   +9.751864723969364e-02   -1.078962595395739e-01   +6.134856488613825e-02   -1.644329553066989e-02   -2.649176728217987e-02; -5.930556291086579e-02   +5.056184153772766e-02   +5.050011754620588e-02   -4.208070528642804e-02   +2.274132100136170e-02   +8.595897357138915e-02   +1.371581314906086e-01   +9.688003867335918e-02; +1.665580291146138e-03   -9.455601371650006e-02   -3.814893000930631e-02   +1.139268529938378e-01   +5.884536962073448e-02   -6.733837850834255e-02   -1.348863689492265e-01   -3.573882125847341e-02; -1.205768840436321e-01   +3.161106800883681e-02   +2.721674469966068e-02   +4.715334371858376e-04   -6.138005221472175e-02   +1.049009309634644e-01   -2.986823965006304e-02   -1.417687090162104e-02; -6.199255109346325e-02   -3.217171993342850e-02   +2.977040817875872e-02   -4.655185051336134e-02   +6.922203330649199e-02   -1.006144106985180e-01   -6.998360588296156e-02   +2.225985114273284e-02];
L2E_L2I_iGABA_netcon = [-2.090637264567453e-02   -7.043721915318937e-02   -2.448949043169563e-02   +8.802690651321810e-02   -5.326692316374496e-02   -4.319590881387882e-02   +2.399091415163174e-02   -3.348309560221336e-02; +7.585785662855736e-02   -1.193114781073376e-01   +8.833055221089835e-02   -2.870423922182528e-03   +8.875597881817579e-02   -4.602834933292714e-02   +2.697409347312302e-03   +1.055297972470949e-01; -1.460728790734278e-01   +1.803691768372506e-01   -4.100054345349330e-02   +7.366284150209823e-02   +9.164361328791180e-02   -5.523496176727499e-02   +8.912334000598666e-02   -8.055654113074867e-02; +7.745335230229042e-02   -1.724277376292834e-02   +8.567410615688181e-02   -8.360754765022486e-02   +2.992415762068020e-02   -6.826769748013461e-02   -9.031313822866156e-03   -5.033991384919680e-02; -9.231675049046423e-02   -3.865099509441933e-02   -6.446308812436419e-02   +3.652600009583749e-04   -4.098800894153254e-02   -2.399824798660951e-02   -3.440856187099085e-02   -3.870822931482155e-03; +3.825518418098248e-02   -8.941941543566526e-02   +6.460715552558860e-02   +6.329762555650123e-02   +8.490732886566960e-03   +3.804279007397610e-02   +5.713611921144625e-03   +1.201744230184906e-02; -1.368407526580106e-03   +3.874156382321421e-03   +4.132647614559370e-02   +1.670405807604779e-01   -3.407320514407343e-02   +9.337585805589148e-02   +9.665621211160846e-02   +4.104999741583557e-02; -6.671944715510911e-02   +1.306764198118121e-01   +5.027533187608883e-02   +8.692783411054880e-03   -6.912009743112726e-02   -3.619788410867456e-02   -1.829062416006271e-02   -3.717209621629364e-02];
L3E_L2E_iAMPA_netcon = [-6.754050784685929e-02   +3.336270746585415e-02   +4.121690134758572e-02   -2.281098195736887e-02   +1.286723007736187e-01   -3.223400848070851e-03   -8.333825055566041e-02   -4.009278458410901e-02   -1.091793302441237e-01   -3.895657300136555e-02   +8.039448772049959e-02   +6.989316509976123e-02; -1.657750431247027e-03   -1.984162284595408e-02   +7.206911556835587e-02   -3.386520098351309e-02   +8.047961609828178e-02   -9.799450926516205e-02   -2.895248825029421e-03   +2.587433504843903e-02   +8.908536133843152e-02   -1.795798394810371e-02   -1.671000524748471e-02   -8.798580541487622e-02; +8.680397166200303e-02   -2.680573150209365e-02   -1.024850537311533e-01   +6.452511549641084e-03   +9.803471656292370e-02   +2.754922753159104e-02   -1.989511708787579e-02   -6.644615481343823e-02   -6.090465082087992e-02   -3.569407011579116e-02   -9.320248740706082e-02   -3.214564713425120e-02; -2.663573114801015e-03   -1.404575617577856e-02   +5.546246439370089e-02   -9.840669719688704e-03   +4.554157943029333e-02   +8.088697710441634e-02   +3.151568873643376e-02   +7.122560253119317e-02   -2.906693925927202e-02   +7.350130665111039e-02   -2.155051182011943e-02   +3.424093637812402e-02; +9.336366590451631e-02   +5.673213869539415e-02   -6.795665492486354e-02   -1.656270953903873e-02   -5.387241780017334e-03   -1.936356620550266e-02   -9.646327316642386e-03   -5.084738070198883e-02   +2.770913874794490e-02   +5.008927722458738e-02   +5.031789111889424e-02   +2.827857228219317e-02; -9.125404209692101e-02   +4.535308643182852e-02   -6.935119775377391e-04   +5.682391491233209e-02   +5.315098859607856e-02   +1.159451871608764e-01   +2.548839644830019e-02   +2.274991753439062e-03   +1.804508094589313e-02   +1.854239600504924e-03   +1.183399999853651e-01   -8.280362178358527e-02; -2.697411764466334e-02   -5.041195026989025e-02   +2.282503799790246e-03   -6.199373610743675e-02   +5.931189336702215e-02   -1.033775319228005e-01   +5.176002899883455e-02   -2.889633505823384e-03   -3.472916494851140e-02   +4.553977937359902e-02   +3.822382548065341e-02   +7.297253983470146e-02; -8.330155464141945e-02   -1.111056305661997e-01   -2.961294253940607e-02   +4.920125793539004e-02   +3.882213504895148e-02   -1.479894811451180e-02   +3.778074467225104e-02   +7.433252965521814e-02   +1.185194427853714e-02   -1.305761161779405e-03   +2.925835417459679e-02   -8.538526751006999e-02];
L3I_L2I_iGABA_netcon = [+3.947592379627615e-02   -8.861030004313165e-02   +2.440730645026820e-02   +1.191538968448425e-03   -1.239526054350127e-02   +3.292440793021342e-02   +6.298800113027116e-02   +2.118344398684922e-02   +1.568190663639437e-02   -1.320043807930403e-01   +5.202237516110730e-02   -5.705357489154095e-02; +8.848926590055055e-02   +5.920595756809886e-02   +5.431041955281737e-02   -4.851705352442862e-02   -5.382751600972327e-03   +4.382043231776732e-03   +8.380815718560659e-02   +5.386113573164025e-02   +3.994725305176774e-02   +3.364763013672625e-02   +7.479517585201582e-02   +4.594956972959174e-02; -1.049448281832789e-01   -7.660961370202640e-02   +2.756235483133038e-02   +1.124727077490862e-01   +5.861475964922977e-02   +2.921066522736473e-02   +1.805098427258783e-02   -9.783144186454411e-02   +7.993316258214496e-02   -5.136858029320547e-02   +8.643319097060161e-02   +7.025201080982292e-03; -2.016748831794379e-02   +1.294319572848562e-01   +5.777661200785544e-03   -3.551198567456158e-02   +4.706308919610844e-02   -5.321525520909073e-02   +6.819398391302986e-02   +5.027112096961234e-02   +5.691112241667654e-02   -2.295694616060405e-02   +5.528056482173646e-02   -2.434724507735105e-02; +8.164853776223648e-02   -2.919558916982087e-03   +5.276415509544910e-02   +1.902100293345155e-02   -6.640410067324540e-02   +1.052082075673144e-01   -3.712080951887933e-03   +2.732180895674853e-02   -8.169660910985752e-02   +6.832727365700655e-02   +1.358812364803221e-02   +6.274006925985590e-02; +2.945196399049730e-02   -1.026375861198510e-01   -1.433371876374250e-01   -1.922534885355796e-02   -9.071954105679711e-02   -8.249052886508176e-02   -9.969182637663963e-03   +4.228917533401340e-02   -8.971098389993500e-02   -3.619892152528120e-02   +2.229232582814122e-02   +1.046998610179310e-01; -2.122700907260784e-03   +6.745567968462235e-02   -4.783139535594596e-02   -5.377645348419024e-02   -1.255595120317566e-01   -3.097265016820859e-02   -6.225465198914120e-02   -4.962878005047108e-02   -6.034522496739461e-02   -1.009538463706411e-01   -6.771979046959700e-02   +7.518693916286238e-02; -4.196326177695220e-02   +6.216675486227045e-02   -1.882939043001767e-02   -3.609804502925931e-03   -9.307820338440274e-03   +4.692131636855152e-02   +2.013707297404826e-02   +7.772440980233983e-02   -9.631749158809889e-02   -7.275282986775861e-02   +9.882507278576218e-02   -2.579882538429337e-02];
L2E_L3E_iAMPA_netcon = [+1.077391474018575e-01   -2.306174608045454e-02   -9.197667429679500e-02   +1.006061409444925e-02   +5.144758484075189e-02   -5.282457109688487e-02   -1.201871907043700e-01   +2.204531293393022e-02; +8.075883297371439e-02   -4.371331803940219e-02   -7.969366534396453e-03   -1.184370175244093e-01   -5.334273761881337e-02   -4.150489593372597e-02   -4.472134097501178e-02   +1.599955798941766e-01; -5.860774658794474e-02   +1.288607046738705e-01   -1.614210740144357e-03   -4.130154221823127e-02   +5.162492324670184e-02   -3.030931126459002e-02   +6.498635734391703e-02   +4.162433430844394e-02; +1.213906238320759e-01   +1.320907617189321e-01   -2.476314644609280e-02   -1.186441437531835e-02   +7.258624298395485e-03   -4.144247181661679e-02   +2.191664141176847e-02   +5.563477113630753e-02; -5.379189455767547e-02   +8.733324887101879e-02   -8.672459137756876e-03   +1.328427891787927e-02   -3.758126302643141e-02   -3.941112769640964e-02   -1.182240705727618e-01   -2.225468767649159e-02; +2.324490099991817e-02   -1.054283674378396e-01   +7.420262198722824e-02   +8.048734708766875e-02   +3.118270558702677e-02   -4.458700609629596e-02   -7.442672364760815e-02   +7.027298661985858e-02; -1.398993007929438e-02   -8.918202617031167e-02   +5.812056153087123e-02   +1.015827224615523e-01   -1.091296774156943e-02   +4.558035225070346e-03   -3.669270648783418e-02   +1.898477487912666e-02; -2.895616742551163e-02   +3.717902715597680e-02   -2.052592889334351e-02   -2.156436347119220e-03   +2.337562619307211e-02   -8.578836213358125e-02   +2.424821960486758e-02   +8.328462886169259e-02; +7.987084605494349e-02   -9.328138982086709e-02   +8.168570295270783e-02   +8.115830204239059e-02   +7.491798597003689e-02   +4.528865166914224e-02   +5.436200812982387e-02   -9.191963391060534e-03; -1.033787239791052e-01   -6.782941229037458e-02   +7.401802021593530e-03   -3.411276586296011e-02   -2.469507432049545e-02   -8.352657144620784e-02   +4.485141271280896e-02   +6.502558507134774e-02; -5.175424712602943e-03   +1.884447728783792e-02   -8.558067358366551e-02   +5.026266023325270e-02   +5.595480722043270e-02   +3.210342449957567e-02   -1.767208350568632e-02   -2.653738628256366e-03; -5.583374292475723e-02   -1.531421608157108e-02   -5.596069502851731e-03   +7.258507370655945e-02   -1.886262657765278e-02   -5.276555112246698e-02   +1.097443645554014e-02   -1.358633829719976e-01];
L2I_L3I_iGABA_netcon = [-2.388898359335263e-02   +2.456125736404457e-02   +5.251743445973638e-02   -1.208566506019790e-01   -5.248883671437372e-02   -1.688265260348066e-02   +7.044558412752340e-02   -4.764671562313694e-04; -7.801754773829850e-02   +2.257067620203969e-02   -1.681562191729634e-02   +2.955260556468991e-02   -5.519024698723148e-02   -1.543274223832413e-02   +1.510228419250429e-01   -1.890920594260475e-02; +8.883622829608905e-02   -8.170658889077890e-03   -6.934201715021950e-02   -1.287432115990328e-01   +2.483343864735018e-02   +8.778208354240601e-03   +5.221303581761121e-02   +7.351980451102846e-02; +2.560947549706966e-02   +6.316311538430920e-02   -5.249332671091345e-03   -2.907659171677340e-02   +2.541293408520982e-02   -3.479260090826605e-02   +8.038196817735704e-02   -1.267957004002754e-01; -1.103721442987084e-01   +1.356350090026867e-03   -1.028237673775434e-01   -3.041272945683526e-02   +5.801269277168050e-02   +3.338140806007937e-02   -2.501193211403917e-02   +4.094856481376795e-02; +6.452563990540791e-02   -5.374568412586772e-02   -5.420438533232452e-02   -3.971311137502419e-03   +7.931569124840768e-02   +1.058237360703511e-01   +1.015045099033992e-01   +8.232169202080218e-03; +3.272615323966069e-02   +3.667194741698869e-02   +6.762763449707659e-02   -9.731715370401224e-02   +3.822292609644615e-02   -6.546401993694717e-02   +1.572892630671500e-02   +2.958355951356139e-02; -5.461755972687627e-03   +1.178543996002494e-01   +1.137653481732225e-02   +2.895347645697311e-02   -5.129400583808345e-02   +4.623942159820012e-02   -8.534647908976886e-02   -6.947762738232817e-02; +9.051276409786510e-02   +5.139371564072531e-02   -2.418757459281155e-02   +3.012696890273921e-02   +4.656942945846965e-02   +2.045476817417000e-02   +1.481584193334166e-01   -2.681184623369432e-02; -7.118614448131657e-03   -1.407424999098246e-03   -6.598989994503360e-02   -5.316300330734543e-03   -4.619923661186846e-03   -1.032751097326762e-01   -4.060615382918556e-02   +8.994385092060582e-04; -6.993066444567123e-02   -2.105065827476996e-02   -3.960878961865671e-02   +7.036724052996163e-02   +8.715365595217314e-02   +8.962097530058739e-02   +9.353035394136996e-04   -1.921173371687888e-02; -1.140151449336772e-01   +1.271416071589271e-01   +1.111155661718314e-02   +1.535790820874882e-01   -2.885657258469537e-02   -1.941716172171670e-02   +6.455998567610116e-03   -7.584371372885361e-02];
L3I_L3E_iAMPA_netcon = [+1.309345591229810e-01   -3.027140147455947e-02   +1.828353125191278e-01   +5.669598915736302e-02   -4.342544494174982e-03   +7.228224736521055e-02   -1.079505053369572e-01   -2.125736327029813e-02   -4.199138647165197e-02   +1.969258589194393e-02   -1.215260291507197e-02   +1.008338072470642e-02; -3.257082501119601e-02   -6.538283604374938e-02   +1.184951799594089e-01   -3.548748583436093e-02   -8.093532794419271e-04   -1.883390174001324e-01   +6.090557423527544e-02   +1.620854773321123e-01   +1.391040050700074e-01   +1.458983867320717e-02   -9.247397839075711e-02   +3.377228082554341e-02; -2.006802781005169e-02   -6.832266177826171e-02   -1.278099110664611e-01   -1.519867713443793e-02   +9.256176394511696e-02   +2.470807655118826e-02   +1.516347045572619e-02   +3.620760010219630e-02   +1.894424970217115e-02   -7.182129552242161e-02   -5.187264568344397e-02   +7.903279923231038e-02; +2.394716965090659e-02   +8.896906598027211e-03   +8.297714882775695e-02   -1.386518168979251e-03   -3.089654998481125e-02   +6.015510399698508e-02   -9.328144195863902e-02   +1.816721186086901e-02   +6.294185555745044e-02   -2.970551533660137e-02   -7.019818892154964e-02   +1.445039535642112e-01; -5.263714484357367e-02   -1.848183483283109e-01   -1.295688074934488e-01   -1.097982311167477e-01   -2.738051520755409e-02   -6.674571677944086e-02   +5.068331441150570e-02   +1.792731634401682e-02   -6.268513868102051e-02   -1.204490904770668e-01   -7.369153019579897e-03   -3.584918859098189e-02; +1.306185157569488e-02   +3.745826711356198e-02   +2.374839885395831e-02   -4.658255521712347e-02   -7.229343533683559e-02   +4.388239156492074e-02   +2.644091687364599e-02   +1.818981731501853e-02   -4.186261204393162e-02   +1.173159280841085e-01   +8.102190782283999e-02   +1.814741629946615e-02; +4.329828961094917e-02   -4.626988549214636e-02   -5.877557345207547e-02   +3.513889688946026e-02   +4.355611963359417e-02   -2.057492212140827e-02   +3.740782223823667e-02   +1.751453437486327e-02   +3.116714706844605e-02   -2.408916628487139e-02   +2.660333548004616e-02   +9.257793941916279e-02; -2.209747244730272e-03   -2.444137272544276e-02   +6.968325760211762e-02   +6.468339305402010e-02   +9.393416838796737e-02   +7.631166640079479e-02   +1.933861902508339e-03   +1.814363401765744e-02   +4.540434856486587e-02   -3.981077245006327e-02   +3.077051468959901e-02   +3.818125565164813e-02; +1.300183012379434e-01   -6.026892513093740e-02   +6.345373146709593e-02   -1.587225496947973e-01   +8.283476083988855e-03   +8.229751158683329e-02   +6.169434515834974e-02   +1.429569970885962e-02   -6.786020285019835e-02   -6.068306420761053e-03   +9.392826491573237e-03   -1.400882551102585e-01; +1.531970902850771e-02   -8.028790020120771e-02   -6.963570291119431e-02   +6.166427349956168e-02   -5.535466475864535e-02   -1.697848743682475e-02   -2.798911895262592e-02   -5.710291197577889e-02   +3.226291781643233e-02   +4.928412734876852e-02   +5.306077046610184e-02   -3.918245700695083e-03; +4.145626972822990e-02   +4.356347606715308e-02   -1.319671642688236e-01   -6.980502764425324e-02   +1.082373821894001e-01   -1.306113415292547e-01   -5.159934513599285e-02   +4.032954165209128e-02   +5.298999087203310e-02   -1.750282835225818e-02   +8.768595980453341e-02   +4.978123743569371e-02; -9.082628008264339e-02   +1.217839741757423e-01   +4.331567457917859e-02   +3.186976717456520e-02   +3.241326646955842e-02   -1.087122895582052e-01   +6.103254470708604e-02   -8.651597759887650e-02   -4.581765356534021e-02   +9.091113708694361e-02   +1.081363019399214e-01   +1.862579513912183e-02];
L3E_L3I_iGABA_netcon = [-6.124834635394924e-02   +4.844283085306318e-02   +8.094090563260070e-02   -3.438322843686703e-02   -1.096868645274009e-01   -1.275525416756979e-01   +3.509145648783905e-02   -3.151501498489556e-02   -1.010968678188663e-01   -8.053775737373732e-03   -1.591825034186091e-02   +1.378367278745461e-02; -4.110118098971271e-02   -6.741992710368360e-03   +1.900942794921232e-03   -3.316392442905591e-02   +1.560724857687293e-01   -2.994528378763417e-02   +5.858025367067137e-03   +1.183674141138041e-02   -6.802335739170229e-02   -8.020749045428185e-02   +1.451649505086158e-01   -8.319801769788960e-03; -8.669120950600778e-02   +7.254753430207067e-03   +4.640279521067681e-02   +3.213500594607761e-02   +3.623289824582042e-02   -3.736151756515337e-02   +1.917380095355011e-02   +1.837961931077483e-02   -7.892808598812191e-02   -6.018633905988485e-02   -2.748469803079865e-02   -1.389415317178055e-02; -2.117570592982523e-02   -4.503984280473686e-02   -4.764175880495364e-02   +1.009668011623845e-02   +3.450080439234728e-02   +1.005939647842444e-01   -1.706027958938840e-02   +7.585700850521061e-03   +8.222460701824072e-02   +1.068467761759865e-02   -4.350497257355972e-02   +4.345755900680091e-02; +2.373316960700366e-02   -3.186275067955505e-02   +1.618756376220941e-02   +1.316108306138197e-02   +4.575204862057791e-02   +3.243000076314436e-02   -2.632834415540806e-02   -1.153674654734906e-01   +3.064535529905185e-02   +2.507093688767363e-02   -5.046984086544863e-02   +1.561709633532673e-01; -1.578180188615292e-02   -3.323866243901046e-02   +1.345100824712510e-01   +7.491505700516015e-03   +1.401863336424992e-02   +3.059916364762272e-03   -4.335325302934852e-03   -1.060315371303017e-01   -7.845606663573501e-02   -4.588769962286751e-02   -5.639173283576832e-02   +3.995589399174587e-03; -1.141362228826347e-01   -2.431913741337911e-02   +4.519346791446885e-02   -1.176817264914787e-01   -9.285822964671692e-02   -1.216520971188125e-01   -4.710388356794270e-02   +1.154448866569275e-02   +2.342853621301175e-02   +1.357056911053739e-01   -6.027666006644946e-03   -4.640841863614052e-02; +4.755042754054230e-03   +6.074323107423285e-03   -1.009240060176853e-01   -2.632783883726551e-02   -7.706902982834547e-02   +1.555560032858823e-02   +5.179865530204027e-02   +4.801610893550379e-02   -3.822043814587756e-03   +5.453714774385110e-02   -7.400654696723458e-02   -4.745395597788938e-02; -4.476917046727050e-02   +1.231585911759432e-01   +5.891024160796439e-02   -7.412444248412831e-02   -1.208173835360983e-01   -1.746909238846624e-01   -1.156481663961428e-01   +4.195962273709812e-02   +1.025192681812541e-01   +7.238822128274178e-02   +5.229586292113389e-02   +5.443936719241063e-02; -2.256554409538063e-02   -7.056098089379012e-02   -2.354733842515937e-03   -1.925797160702964e-02   +6.957962632661724e-02   -6.851852534887695e-02   -5.633567333980670e-02   -2.874143495719312e-03   +7.008023387629903e-04   -3.713919912168441e-03   -1.771083175521578e-02   -7.812834736343305e-02; +1.074745478563143e-01   +1.743935719595435e-02   -2.037036709906201e-02   +3.364397634912424e-02   -1.521418258379094e-02   +1.522446447059026e-01   +3.652887461542068e-02   -4.144949835572004e-02   +5.711660689417011e-02   +7.638189806016996e-02   -2.625220298948067e-02   -5.880879656281699e-03; +2.301240258231470e-02   +4.591388678882137e-02   +6.337519380906342e-02   -1.137007911241415e-03   +1.218233617381176e-01   +2.590156635614654e-03   -3.706652273091033e-02   +7.824456078431838e-02   +1.330532987535527e-02   +1.329469742381687e-01   +3.067316743549976e-02   -6.875678218394568e-02];
L2E_Input1_iAMPA_netcon = [+5.799584987205824e-03   -4.233666368123337e-02   +5.281883384092333e-02   -5.934363552697607e-02   +4.993812255330445e-02   -5.914842666611288e-02   +5.994027469023468e-02   +6.183673175897194e-02];
L2I_Input2_iAMPA_netcon = [-7.893808439665513e-02   -2.564084322296501e-02   -5.743427653933278e-02   -1.583868617685365e-01   +7.026814055244147e-02   -9.259262065222877e-02   +1.235715490323874e-01   -5.103772059242546e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
