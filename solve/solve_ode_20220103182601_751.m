function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.131075614325598e-01   +9.489747830548851e-01   +6.987408850885924e-01   +1.655410719799777e-01   +9.174009148910862e-01   +2.151318332480039e-01   +7.422080828288199e-01   +3.065242929813146e-01   +5.401157754233054e-01   +8.403514960404326e-01   +9.722455402994329e-01   +9.708805191639253e-01   +6.999656788570843e-01   +3.668743377534788e-01   +2.974782497519380e-01   +3.830590136485901e-01; +3.496591040513567e-01   +7.058990882185046e-03   +1.389805269024881e-01   +1.696406475108041e-01   +7.745972271816517e-02   +8.121518387172098e-01   +7.961672372004339e-01   +7.589353358074110e-01   +7.905087548409691e-01   +1.903942841345763e-01   +4.716785596900324e-01   +6.650694280246729e-01   +3.700350636538781e-01   +2.771290096861962e-01   +6.898963480297777e-01   +9.644532900691618e-01; +2.032003557642728e-01   +4.758789104999229e-01   +8.478212716644343e-02   +7.060245664167935e-01   +3.177903092223759e-01   +3.809269300301978e-01   +6.574107374109742e-01   +9.558009750843721e-01   +4.912183770329837e-02   +9.246263883685626e-01   +8.704104346463341e-01   +2.003152272856005e-01   +5.482938470951950e-01   +7.350221449729873e-02   +7.830085624238925e-01   +8.099479954277690e-01; +2.688584110651423e-02   +4.871692962443464e-01   +4.273944357501239e-01   +8.352433153229911e-01   +6.330252426071572e-01   +8.580291172355498e-01   +4.390546292013853e-01   +5.360822206117300e-03   +4.616085340975712e-01   +4.193521827355530e-01   +9.416702161129824e-01   +9.027781683787827e-01   +5.123750134483176e-01   +1.603515528020099e-01   +7.140664363654547e-01   +8.919245263270088e-01; +7.695362265987311e-01   +5.134436443063413e-01   +8.994800022519208e-01   +8.271680710012215e-02   +9.055274891286087e-01   +3.221561986420486e-01   +5.803413866742740e-01   +4.000663138929305e-01   +9.377903660152940e-01   +3.038730622931902e-01   +2.423850350075627e-01   +4.807235481274502e-01   +7.684073425940320e-01   +3.628061218767343e-01   +2.726373807533167e-01   +6.551761830531291e-02; +5.715681326394457e-01   +2.902025592923730e-01   +7.164816745429085e-01   +8.335224776271218e-01   +8.013963769866088e-01   +3.799579992251267e-01   +5.120384296106514e-01   +1.578595212492782e-01   +4.806372561295048e-01   +3.547113493366285e-01   +9.209901443352313e-01   +6.676245637008202e-01   +7.618359292873868e-02   +7.142047944118634e-01   +2.009115452967350e-02   +9.003051082021111e-01; +5.777068831239340e-01   +5.585357065786395e-01   +6.847228762568238e-01   +5.510002443973042e-01   +6.477915231812644e-01   +6.450862072923768e-01   +7.284519512700376e-01   +8.312549946721405e-01   +7.794407654972627e-01   +9.754567311008566e-01   +6.351812112808165e-01   +5.299281347546702e-01   +6.459081902617673e-03   +5.423950475575160e-01   +1.322527116419570e-02   +6.738462239788496e-01; +3.907177828406667e-01   +5.197167614047480e-01   +2.046654267335045e-01   +9.654690318234921e-01   +4.467849680309521e-01   +3.930785764785330e-01   +2.237335792710100e-01   +2.865854380702471e-01   +1.109614981705720e-01   +5.377963893310581e-01   +2.880190502051515e-01   +7.048118446586185e-01   +4.015246218617936e-01   +2.320713786036132e-01   +9.291847529157489e-01   +3.455711094365955e-01; +5.537720146275724e-01   +6.739199080088761e-01   +5.268248362161886e-01   +6.711666688567827e-01   +7.482498566709547e-01   +7.246960845036890e-02   +9.995527469119027e-01   +9.819640793216506e-01   +5.200530473931149e-01   +7.958230985385196e-01   +8.485907778547265e-01   +7.123401894923256e-01   +6.603569412522857e-01   +4.654138697544944e-01   +9.328920187586089e-01   +8.401807335787014e-01; +1.870494656947443e-01   +6.196817647478244e-01   +8.224392716216975e-01   +3.387702833929244e-01   +8.300987675862523e-01   +1.443378491789784e-02   +6.199284091566304e-01   +6.228340897560938e-01   +6.380509689112135e-01   +8.036289967872045e-01   +1.653653286708536e-01   +2.988969047497581e-01   +3.731557867796009e-01   +7.176777074045768e-01   +3.715651342439072e-01   +1.958195509949310e-01; +1.150715741202428e-01   +5.680776257791142e-01   +1.823858944591223e-01   +2.120989185821536e-01   +3.483624669091036e-01   +8.771751467437517e-01   +9.931443582881080e-01   +7.437625219526818e-01   +5.786132790949728e-01   +1.373374974879192e-01   +8.259501023650349e-01   +1.097896396994207e-01   +3.964231033213004e-01   +5.200709797056097e-01   +1.032911407981629e-01   +8.468017221527022e-01; +5.380944657039126e-02   +5.082099561979844e-01   +5.149116519706158e-01   +5.706026329178145e-01   +1.520691978833325e-01   +1.627559077477752e-01   +4.921282398266695e-01   +8.854845409128878e-01   +8.407521781358922e-01   +4.549914502113491e-01   +2.202289016192981e-01   +3.318665492044118e-01   +1.384210642728809e-01   +5.122733717510183e-01   +7.206867640487971e-01   +4.290190147978444e-01; +9.371928759492596e-01   +6.707720296755230e-01   +3.550714800338711e-01   +4.159725867866724e-03   +5.032322832666439e-01   +9.166743796051343e-01   +5.311230978973448e-01   +3.360091717679337e-01   +1.167102972457427e-01   +4.514816419014872e-01   +2.769501777937362e-01   +4.623366763550816e-01   +3.396458027506160e-01   +3.960747391280005e-01   +4.557435983828586e-01   +5.544007697580332e-01; +7.435665041737424e-01   +6.367350524493941e-01   +6.530278099575805e-01   +5.944891589711592e-01   +4.095239218092674e-01   +5.630215119528570e-01   +8.599421836483544e-01   +9.255464742572440e-02   +5.169971236463727e-02   +9.611122293386546e-01   +9.313272056157415e-02   +7.178402077245335e-01   +1.223921650338364e-01   +4.781239323625576e-01   +1.239084719911523e-02   +4.450477824385471e-01; +2.358097263458729e-01   +1.442645160071545e-01   +2.818805534049633e-01   +8.958027676426346e-01   +1.742481862451706e-01   +9.259472113191984e-01   +2.532653548382586e-01   +4.471023049665276e-01   +5.170369958221976e-01   +5.119246976006783e-02   +9.169391200422884e-01   +4.007760255104995e-01   +3.688613995556199e-01   +7.430562420305630e-01   +1.176342274370765e-01   +7.634517697058419e-01; +2.044941959382200e-01   +1.826567986590880e-01   +4.352503764865996e-01   +2.576416849541895e-01   +4.952155685687410e-01   +5.975063251312429e-01   +5.764506886277525e-01   +2.402104706537518e-01   +7.028277736125905e-01   +3.863065768618961e-02   +7.299151540101998e-01   +2.416472616962474e-01   +2.474885773844801e-01   +7.036158099113542e-01   +6.630894459091523e-01   +9.507179190058378e-02];
L1E_L1I_iGABA_netcon = [+8.419527985674026e-01   +7.528511331685203e-01   +8.691966630106750e-01   +4.355183810844704e-01   +9.188108052183435e-01   +7.708547162176206e-01   +3.233965654784240e-01   +6.424805420794418e-01   +9.596911483325442e-02   +2.894367119532459e-02   +1.282307773568830e-01   +5.171494397647629e-01   +8.806671074275314e-01   +5.737766676821663e-01   +1.741972494642738e-01   +6.398532194196295e-01; +6.211882885961624e-01   +9.937263978483408e-01   +3.130979463924614e-01   +1.407331778156342e-01   +8.931229252827324e-01   +2.781600444100125e-01   +9.673486836231969e-01   +4.407972712731694e-01   +2.985242734060757e-01   +5.110366338732402e-01   +4.352335595831986e-01   +2.069438419164242e-01   +8.041482216723265e-01   +2.920196801751305e-01   +5.516377479789811e-02   +3.398281232980871e-01; +6.660442321091115e-01   +3.734929983533348e-01   +4.300961379527605e-01   +6.516177068074821e-01   +5.880649810031902e-01   +5.219796098128416e-01   +3.513762065856934e-01   +4.807084588762401e-01   +3.309595777987132e-01   +8.663174557887979e-01   +4.817856271899185e-01   +7.751639787743992e-01   +6.491383473221657e-01   +1.438051251675218e-01   +2.213303694016067e-01   +1.530728853400587e-01; +7.842754823266938e-01   +5.091150978317401e-01   +3.802530722694920e-01   +7.285359443697466e-01   +8.358454213684138e-01   +4.128088742240643e-01   +3.191272791441948e-01   +9.808284782932029e-02   +4.772957939348817e-01   +5.764316457537876e-01   +6.771073901040366e-01   +3.878017706083615e-01   +7.343750766959104e-01   +4.463840179612518e-02   +2.024154737235994e-01   +4.003433634807432e-01; +3.182747829224971e-01   +7.589364341975259e-01   +6.573174623229363e-01   +1.736191347614329e-01   +7.808117858688012e-01   +7.855425633914701e-01   +9.165232577661512e-01   +8.053164852977749e-01   +2.412778672249339e-01   +4.247633884771364e-01   +3.520820866403388e-01   +6.943781514943163e-02   +6.648985451796587e-01   +6.212744520277014e-01   +2.117220307410176e-01   +9.154354685128100e-01; +3.213433252878479e-01   +1.378387121060889e-01   +2.446297971940158e-01   +3.394658750563721e-01   +7.918192350208052e-01   +2.578087833336729e-02   +8.844220428104379e-01   +6.196616424298325e-02   +4.569297780598655e-01   +7.231621539093215e-01   +4.685553448947839e-02   +7.499452021933385e-01   +8.876709537104339e-01   +6.078787379893309e-01   +5.811301207270581e-01   +1.544138184277511e-01; +6.270387890855192e-01   +5.198759660956334e-01   +6.886089502322185e-01   +1.033968606483599e-01   +6.964659395824537e-01   +4.073626064316502e-01   +3.600998071208215e-01   +9.543487634346396e-01   +7.558156614487767e-01   +2.288813802766805e-01   +2.942657199140893e-01   +4.593241687117627e-01   +8.545413018010772e-01   +3.746844722438065e-01   +3.509517549383812e-02   +4.657773705446134e-01; +9.011197235334594e-01   +9.113126309012620e-01   +3.287619602171474e-01   +4.567340793493354e-02   +1.690152847312236e-02   +8.299145437245503e-01   +7.422064694614564e-01   +7.764535742359318e-01   +7.143100211407916e-01   +5.725397012144341e-02   +8.040099512957107e-01   +3.118792890417736e-01   +4.103418963734243e-01   +8.338006178690749e-01   +7.974392802124339e-01   +8.247853897951946e-02; +3.720952717835093e-01   +1.015589972677080e-01   +8.765201080510424e-01   +4.736414815504801e-01   +3.280482412349554e-01   +5.917381940169502e-01   +1.216276212437470e-01   +4.472253211067150e-01   +2.331332668960419e-01   +9.772143216392410e-01   +6.493202923157483e-01   +2.730189657320876e-01   +1.145723569050667e-01   +5.184242700478765e-01   +1.392928985778289e-01   +3.363623026784978e-01; +8.891049821361495e-01   +1.837434758117659e-01   +1.000000000000000e+00   +4.747943365020877e-01   +9.501986281451900e-01   +2.118987448726761e-01   +5.941702519771033e-01   +1.665575152346177e-01   +6.978444436930005e-01   +9.739488645523561e-01   +7.122287922593039e-01   +5.776087337221617e-01   +4.116922408396613e-01   +8.153148737503702e-01   +5.759046165746424e-01   +4.883710061045452e-01; +1.134471213703312e-01   +1.767022149875414e-01   +6.872843268695936e-01   +5.505122377938930e-01   +4.084296796890768e-01   +2.931771000814368e-01   +4.360228647834495e-01   +7.843169953747546e-02   +3.033605505369298e-01   +1.289883759673432e-01   +7.597939024837921e-01   +9.146989501556346e-01   +3.328606477110440e-01   +5.826120927720256e-01   +8.278206760701183e-02   +5.020597885547277e-01; +9.407577700493887e-02   +5.335324173024421e-01   +3.493232358046910e-01   +6.431664255835172e-01   +6.250314072086592e-01   +2.709558318019076e-01   +9.679219170053821e-01   +7.450759762279833e-01   +4.693676781898275e-01   +3.182727231757476e-03   +3.893647938326651e-01   +4.504393122019012e-01   +1.058158227365649e-01   +7.122388624688387e-01   +2.287704260294701e-01   +1.310070077553689e-01; +5.415695939525134e-01   +9.773585905827902e-01   +5.583064005453479e-01   +3.479033366939631e-01   +8.527430042521277e-01   +9.380701791111823e-01   +9.760127096680007e-01   +5.349728600469283e-01   +4.361483010891087e-01   +9.346688200057657e-01   +3.640078974537355e-01   +9.816585563513968e-01   +8.624635205721455e-01   +7.315212999906295e-01   +4.405346895794070e-01   +7.579783154676406e-02; +6.008742611627420e-01   +8.416829757413335e-01   +8.926493128894861e-01   +2.558534171858619e-01   +3.698720316889574e-01   +5.577423559387737e-01   +2.467888767576881e-01   +4.864446220014237e-01   +7.302580069090863e-01   +7.401309869347661e-01   +8.120500686932692e-01   +1.042331975582958e-01   +9.033748385653619e-01   +4.473704607261063e-01   +1.748031771430392e-01   +6.717952229574444e-01; +7.252513271621940e-01   +6.696549420262925e-01   +6.517615643092013e-01   +1.835429303208379e-01   +2.043339651509324e-01   +4.351196906352125e-01   +7.787615704025832e-01   +8.863884446184574e-01   +8.774662811227758e-01   +4.284107465663836e-01   +3.876869002437330e-01   +4.221780034875057e-01   +6.928248779545039e-01   +2.789241129292673e-01   +4.146467653174229e-01   +1.169863055003523e-01; +9.903770940787403e-01   +1.254892588571307e-02   +3.810979313792196e-01   +4.793230148676312e-01   +9.107509639118643e-01   +3.254475018910136e-01   +7.100777944533044e-01   +5.864101744932635e-01   +9.112081110687372e-01   +9.450032969909103e-01   +8.715216427201654e-01   +3.898985816613373e-01   +7.455750758657631e-01   +1.595156207493554e-01   +9.654717734646410e-01   +9.850874300804240e-01];
L2I_L1I_iGABA_netcon = [+5.756588937375325e-01   +5.659846256181448e-01   +1.067066229657561e-01   +4.544457027862450e-01   +8.006298691101408e-01   +9.718878599248089e-01   +2.235765147672649e-01   +7.562380216978793e-01; +5.579001157293598e-01   +9.485244158625197e-01   +1.364814821328369e-01   +5.664019410936225e-01   +5.443866982858168e-01   +4.233839282485043e-01   +6.579062461643477e-02   +5.000621548230001e-01; +6.034358363349760e-01   +1.518560389160350e-02   +4.373982510722546e-01   +8.193647803577796e-01   +2.574445119304652e-01   +3.885775452752233e-01   +8.301396400219271e-01   +8.246224787528224e-01; +4.656302984542716e-01   +1.245160344956551e-01   +9.307254990571056e-01   +3.632390615892309e-01   +7.793359109970529e-01   +4.590799626002163e-01   +3.724749668928830e-02   +9.161658909586433e-01; +4.383017940034269e-01   +8.538773937197424e-01   +1.378608764156194e-01   +2.397058602843063e-01   +7.784178017993755e-01   +1.322510312061847e-01   +9.111525428743037e-01   +7.069112225505118e-01; +6.948070403289880e-02   +2.200781624231799e-01   +8.193658423316211e-01   +7.667784574797688e-01   +1.509178873774177e-01   +4.653533306533859e-01   +4.570883513934557e-01   +8.036799581983352e-01; +6.378300988867016e-01   +6.994862993357496e-01   +9.334690090982483e-01   +3.451678752466624e-03   +8.286539713260639e-01   +2.664618010256193e-01   +2.837726980585009e-01   +9.619751192877505e-01; +4.267748202366751e-01   +7.799708402102089e-01   +5.742575385841981e-01   +2.777747596998451e-01   +6.229010755446268e-01   +1.029962506667747e-01   +7.546187991263493e-01   +9.490396856503084e-01; +7.541498527476368e-01   +4.278551365683730e-01   +4.979377173763395e-01   +3.111730911053768e-02   +4.659005642348100e-01   +6.569281921169613e-01   +9.294220724786223e-01   +2.929865846320883e-01; +3.039843303021854e-01   +7.306000236876992e-01   +9.239789505742755e-01   +6.647806119715176e-01   +4.884972343917545e-01   +9.367970863740148e-01   +1.373145112335114e-01   +3.570439022243608e-01; +5.983508752297954e-01   +4.529492579763642e-01   +8.596557625882870e-01   +9.743756702883064e-01   +2.210298073478438e-01   +7.683943478092119e-01   +9.461332704237680e-01   +5.450787978140390e-01; +3.304940186994866e-01   +8.060404412553540e-01   +2.507454046940473e-01   +9.476033961652938e-01   +8.539195574498032e-01   +4.247549774046762e-02   +3.129456626164775e-01   +2.090827115541866e-01; +6.457559675757479e-01   +4.347864605130645e-01   +4.566128018049879e-01   +5.277805993177070e-02   +8.791441206937373e-01   +2.573451441989299e-01   +2.039896891696139e-01   +7.704485285174109e-02; +2.597259358688909e-03   +1.498612081780456e-01   +7.378981363683527e-01   +2.902631583650290e-01   +8.351511445014761e-01   +6.452004726381411e-01   +4.646148545895179e-01   +5.096191747323436e-01; +1.467329881783754e-01   +8.003627328631669e-01   +7.511345628230935e-01   +4.810396507721966e-01   +4.399829303198433e-01   +8.514118981257453e-02   +5.984350863268856e-01   +1.944884779402300e-01; +2.498552813060431e-01   +3.769170673170890e-01   +2.379244355913544e-01   +8.853900810889336e-01   +5.446431760411168e-01   +7.459070077434735e-02   +5.472914412747883e-01   +1.419629859681499e-01];
L1I_L2I_iGABA_netcon = [+7.149592625775003e-01   +8.751990794342441e-01   +6.175713129901851e-01   +4.993895573350381e-02   +1.512631667826722e-01   +2.366340561388364e-01   +8.458350746055655e-01   +3.721270908991380e-01   +7.153557770131415e-01   +3.914864424926617e-01   +2.435129169292919e-01   +6.809942802060086e-01   +1.633766126683497e-01   +5.758492697625190e-01   +5.078457848696070e-02   +4.696011316849467e-02; +6.121913647588980e-01   +8.045767638584097e-01   +6.207455141921464e-01   +5.390503581270735e-02   +7.510777370658892e-01   +5.531700005858345e-01   +1.991130746248234e-01   +5.672648811577494e-01   +1.936097267372716e-01   +7.301642050221763e-01   +5.083593548758735e-01   +3.393888593700953e-01   +1.130863837851904e-01   +8.174138319029384e-01   +4.354460169004413e-01   +9.290478384479497e-01; +1.622782552055322e-01   +6.226841732604919e-01   +3.111055026532512e-01   +6.031594485736367e-01   +9.525630613809858e-01   +1.166208150289827e-01   +6.152159361866080e-01   +8.402292414060315e-01   +2.367104703562732e-01   +6.367771747406223e-01   +7.376275292865555e-01   +5.503434336480248e-01   +7.492964574361555e-01   +6.796225117046307e-01   +9.266018840593713e-01   +1.799683312722577e-01; +4.870314064750442e-01   +4.806819360738821e-01   +1.352870004592637e-01   +6.635576793685394e-01   +2.603169422639209e-01   +8.292161277205258e-01   +1.557563664294180e-01   +7.195668690785054e-01   +9.988413317193235e-01   +9.943514032292268e-02   +7.850606955201466e-01   +5.369313413390452e-01   +2.198181151410943e-01   +4.435823031622858e-01   +8.856323064573922e-01   +7.521235688561880e-01; +2.875687168747788e-01   +2.200565058471660e-02   +6.057800245862608e-01   +4.905445678982888e-01   +9.445471982490414e-02   +6.571456204260715e-01   +5.860844309323495e-01   +1.113815877892612e-01   +9.060216387850657e-01   +4.997719897969953e-01   +6.847746884062642e-01   +9.086856440070912e-01   +4.875997850635962e-01   +8.967121522617586e-01   +9.396829572116998e-02   +4.694819593442805e-01; +4.007135872650506e-01   +1.274199457453827e-01   +8.990630254288938e-01   +9.828418956615186e-01   +2.313440534985952e-01   +2.302888626751402e-01   +5.447383263460631e-01   +7.468336006147245e-01   +1.020317600836011e-02   +5.576450779027166e-01   +8.178894743892550e-01   +2.862730039377275e-01   +4.469445321730418e-02   +7.896901348520263e-01   +6.853585218891852e-01   +2.483945840129031e-01; +4.908066187772491e-01   +7.237604099927016e-01   +5.688437514875810e-01   +8.669375991210815e-01   +8.985739931410596e-01   +3.025492255001455e-01   +6.923323059988848e-01   +9.256960032439611e-01   +8.397156629305871e-01   +5.508725624203726e-02   +4.261728236238735e-01   +1.356513884965619e-01   +5.828712676091192e-01   +5.933664680419654e-01   +1.591141743117287e-02   +6.636021164914618e-01; +8.648540708059231e-01   +6.711748726261247e-01   +6.383079493517453e-01   +9.620544580727798e-01   +1.987223257306571e-01   +3.250387388379999e-01   +7.029930842347418e-01   +9.289463095066854e-01   +2.527469410436696e-01   +8.411411242418154e-02   +4.938603842689233e-01   +9.615494622511844e-01   +4.992319632425980e-01   +6.271796087228947e-01   +1.265309879400500e-01   +6.160744862453187e-01];
L2E_L1E_iAMPA_netcon = [+3.731043017598693e-01   +5.651832404324834e-01   +1.999141612654926e-01   +5.205804172021616e-01   +2.936473539003989e-01   +7.002923025095606e-02   +2.820130848662087e-01   +2.632604890899722e-01; +4.390107930857167e-01   +1.862217757987422e-01   +1.460309403286672e-01   +6.837442256127642e-01   +6.147369413232949e-01   +5.897895935485773e-01   +9.302430874818333e-01   +8.972466384213483e-01; +7.236990273907773e-01   +6.045424973682608e-01   +7.556368358396333e-02   +2.154033294815740e-01   +8.677376609026153e-01   +7.762755068168388e-02   +7.588963426864109e-01   +1.592548221599250e-01; +1.976821883412880e-01   +7.303814974922073e-01   +9.374486775615003e-02   +9.705355549392818e-01   +8.157378950897810e-01   +3.959027236273627e-01   +2.604244807435359e-01   +5.506450157610384e-01; +4.578237575227973e-02   +8.376452801439793e-01   +5.481351836579953e-01   +3.447447800071460e-01   +2.089520639412338e-01   +5.130723566040592e-02   +2.429549693384346e-01   +4.223762594927024e-01; +3.093697437231882e-01   +2.783589674749086e-01   +7.328735342460164e-01   +1.825108633304519e-01   +7.540386769897277e-01   +1.264781543685141e-01   +1.622593253471760e-01   +5.462209461935482e-01; +7.938374762873883e-01   +6.076264067647653e-01   +5.467944912156792e-01   +2.448765118863782e-01   +2.032796232142400e-01   +2.373019407162372e-01   +2.932772230941960e-01   +7.482207500110802e-01; +4.286758218507971e-02   +5.492982853429511e-01   +4.396696391918148e-02   +2.623740634378939e-01   +5.821968834339034e-01   +9.434545282339714e-01   +5.680065103318032e-01   +1.424800047873098e-02; +2.127176951455503e-01   +2.789376865727726e-01   +6.395054530497383e-01   +2.183113735057978e-01   +8.765632542958790e-01   +2.051884722116492e-01   +3.972455125344310e-01   +2.732876003745472e-04; +2.701690950206223e-01   +3.377600554112609e-01   +9.905760870464555e-01   +3.863492745182929e-02   +7.192281351388221e-01   +3.280742374399305e-01   +9.848234786801993e-01   +2.078363869941809e-02; +7.908205118596180e-01   +5.728551432323874e-01   +9.162639165738067e-01   +3.501478058707465e-01   +6.982799595776320e-01   +8.673593400532423e-01   +5.474117027519402e-01   +3.470377684240553e-01; +9.810916618228025e-01   +7.478895312962759e-01   +7.744665672285911e-01   +8.994589798095748e-01   +4.603060424737586e-01   +9.249167104220377e-01   +9.347236553882501e-01   +4.288086889213968e-01; +9.252994014648125e-02   +7.650132143383828e-01   +1.946995207499564e-01   +1.377944608556441e-01   +5.036073089100930e-01   +2.114099968714019e-02   +9.864825793556330e-01   +5.404233067589712e-01; +1.960491840910741e-01   +4.031042075431725e-01   +3.283118994252660e-02   +9.508967269472158e-01   +7.978100648278740e-01   +3.641504121606174e-01   +8.301854593099565e-01   +4.814682522167102e-01; +1.183424487588846e-01   +1.561772158526417e-01   +3.794990229622089e-01   +9.034772973232555e-01   +9.374248657100132e-01   +5.339452872930286e-01   +1.802693687552421e-01   +9.120703761075285e-01; +6.415837344443165e-01   +2.039265547216420e-01   +5.755871961088561e-01   +4.096460590786506e-01   +7.944198663827053e-01   +4.105477040068057e-01   +3.142061655554458e-01   +4.178855313898310e-01];
L1E_L2E_iAMPA_netcon = [+4.988326672676849e-01   +4.578520638194115e-01   +6.172253218484357e-01   +4.926252987638782e-01   +2.380250157716094e-01   +7.154551600785206e-01   +6.820422957587030e-01   +6.371614448499436e-01   +5.209193737814096e-01   +2.425009780365542e-01   +8.713311869294590e-01   +1.756515966406664e-01   +1.357856343727110e-01   +2.435533074033428e-01   +1.839540463457713e-01   +3.078138655391569e-02; +8.392489578431712e-01   +3.652765568084681e-01   +9.995066192309041e-02   +6.622055945824116e-01   +8.346674688088420e-01   +3.775821366397824e-01   +9.741182574567394e-01   +6.221575211472585e-01   +6.727886340583212e-01   +7.309493744986139e-01   +6.647631324386984e-01   +2.989660246936047e-01   +2.901295693490625e-01   +7.449006260923489e-01   +1.526957301139668e-01   +2.519503986442602e-01; +1.812782735995039e-01   +2.927118900837011e-01   +7.587115276565211e-01   +1.777422462859361e-01   +7.326228654955965e-01   +3.791292323372937e-01   +7.570405906576142e-01   +4.097981658179371e-01   +7.762244167318655e-01   +1.239937853064294e-01   +5.470863361888110e-01   +1.049289786804888e-01   +3.727393089995965e-03   +9.302939476574013e-01   +1.340058836665802e-01   +9.884581138968260e-01; +3.407619599849123e-01   +2.371651291683137e-01   +5.402811169649677e-01   +4.749860276304589e-01   +4.881825357332665e-01   +7.157731582721111e-01   +5.526192287928354e-01   +4.357839956072069e-01   +4.620902188771222e-01   +3.801158100353023e-02   +2.431965173912142e-01   +4.574501705072931e-01   +3.064278914644754e-01   +3.734811396468626e-02   +1.654894071748187e-01   +6.320104653650425e-01; +6.932480191076870e-01   +1.375972884172657e-01   +4.472918935147573e-01   +5.026224974240844e-01   +8.488847299756399e-01   +8.306588044768475e-01   +2.626776111644008e-02   +5.137285140349795e-01   +9.088253983002594e-01   +6.496410820253924e-01   +1.084745908756445e-01   +5.857726142387814e-01   +9.077553526794844e-01   +4.273574829649716e-01   +9.252276472106660e-01   +3.549134170757192e-01; +6.880891456052508e-01   +1.014052547746741e-01   +7.412997348184468e-01   +5.987326593590853e-01   +7.198013976157274e-01   +6.684662057758355e-01   +1.913670855291119e-01   +2.620655654949721e-01   +2.178986347171036e-02   +1.967534730972155e-01   +9.682047761869472e-01   +2.189420647384683e-01   +2.952467179907366e-01   +8.234362734185445e-01   +2.622295419154240e-01   +1.006353707322196e-01; +3.710067938018011e-01   +2.383659637992765e-01   +3.864490032650061e-01   +2.450175806916946e-01   +5.198286220238287e-01   +6.468952740938244e-01   +9.422096095531934e-01   +4.197461565588432e-01   +4.877190540850131e-01   +9.740813216184557e-01   +5.859478557529844e-01   +1.058594635287065e-01   +8.272129700640373e-01   +9.972956971671103e-01   +2.051505096190262e-01   +4.110526474184286e-01; +2.984574659884055e-02   +3.471809782959246e-01   +5.326846608205734e-01   +5.197823594425005e-01   +9.372053292915717e-01   +5.603121678507752e-01   +3.950661614659907e-01   +5.176611261384801e-01   +2.725831106628073e-01   +8.269471485813270e-01   +8.147189822181837e-01   +5.618745376944194e-01   +7.359184131923248e-01   +9.225764316140322e-01   +6.186896629721840e-01   +9.290660757307521e-01];
L2I_L2E_iAMPA_netcon = [+6.791998281688941e-01   +6.151151166919439e-01   +3.760232410402072e-02   +7.998882179837312e-01   +5.197441827851963e-01   +8.231528909382991e-01   +6.485988498984828e-01   +3.851062791539245e-01; +2.149352475301063e-02   +9.419705510706673e-01   +5.333268247211736e-02   +9.370145324959298e-01   +6.349312837100257e-02   +1.073497295540546e-01   +3.312273796824047e-02   +1.675165356132910e-01; +7.300878417612592e-01   +9.647967897347414e-01   +4.083315669294107e-01   +9.391955633726127e-01   +2.891585701323169e-01   +2.264030458877522e-02   +5.636776485841812e-01   +4.439129033017191e-01; +2.151426295276028e-01   +3.680655935707550e-01   +9.782997662088916e-01   +1.459538370864190e-01   +7.147311212787373e-01   +9.518654432674538e-03   +3.108144520802824e-01   +8.740067227329973e-01; +8.531742674653887e-01   +7.922482507518154e-01   +7.096361532119975e-01   +3.245512605457527e-01   +8.867817924680294e-01   +3.361022674957985e-01   +2.632948512611835e-01   +4.044315868690913e-01; +1.568966627288806e-01   +7.210039253637019e-01   +9.929148391397721e-01   +4.254640241067436e-01   +3.670839830720414e-01   +6.662222120890048e-01   +7.198686983904267e-01   +1.664225455372635e-01; +6.704222927120316e-01   +9.520789090898476e-01   +6.496460152005827e-01   +7.071578571476005e-01   +5.615140145713579e-01   +5.911268274778101e-01   +3.056716127805477e-01   +6.636865489942483e-01; +9.325059451522965e-01   +1.438284607399533e-02   +5.038690437345432e-01   +6.192690819064933e-01   +8.798819555511543e-01   +8.041067714824783e-02   +9.022657023353485e-01   +9.297910089279582e-01];
L2E_L2I_iGABA_netcon = [+6.484171449902917e-02   +5.222777079334679e-01   +3.428070146134377e-01   +2.571194671331838e-01   +4.458842891806783e-02   +9.053223311391074e-01   +3.413943341027569e-01   +4.559812977584478e-01; +3.566589571054497e-01   +6.044466532284387e-02   +5.551953476968895e-01   +9.828142456405150e-01   +3.619938956438755e-01   +5.564945130921263e-01   +9.375625294830369e-01   +6.702307066622022e-01; +9.270090498865364e-01   +1.819086395156532e-01   +6.866672157794216e-01   +3.502186681615421e-01   +4.256546406655479e-02   +7.110831353829814e-01   +9.111681108738028e-01   +7.703411066265997e-01; +2.405983122680033e-01   +3.146592927892899e-01   +3.809085944907630e-03   +3.927239837276826e-01   +4.891437516635382e-01   +7.174268189695724e-01   +7.293112523510991e-01   +9.283370468271909e-01; +1.120139027554235e-01   +2.447422381844533e-01   +5.015811062231136e-02   +7.501870206996477e-01   +7.289220824748838e-01   +1.736644512887889e-01   +4.437740216178423e-01   +6.510904736367423e-01; +7.099074094983218e-01   +3.186185867152294e-01   +3.078311597828389e-01   +1.103712785128194e-01   +1.345154036870577e-02   +3.523017370796608e-01   +1.473106430150320e-01   +5.039812318948547e-01; +4.656866777669258e-03   +8.725609700121691e-01   +8.750606064903875e-01   +5.981448314384836e-01   +5.046782295031192e-01   +3.708876985584363e-01   +8.323127464277773e-01   +3.442112683759598e-01; +1.792540048209995e-01   +2.992256732773808e-01   +6.271341127414990e-01   +1.230180532662803e-01   +2.502820515654758e-01   +7.595708629959912e-01   +2.482621987985244e-01   +9.404521456093073e-01];
L3E_L2E_iAMPA_netcon = [+7.732504962539001e-02   +1.757716130584300e-02   +3.711507449150619e-01   +4.912285012402408e-01   +1.858340762054881e-02   +9.654356727127318e-01   +3.594453188850127e-01   +2.124037118978279e-02   +2.040829686977149e-01   +6.686870827911376e-02   +2.427800135046353e-01   +9.988552872080284e-01; +9.554850820239047e-01   +9.848555851034623e-01   +1.214871356334458e-01   +6.584147988289837e-02   +8.093243522665060e-01   +3.873865031971680e-01   +2.312246026548390e-01   +1.283304975194215e-01   +3.550328235442231e-01   +7.500460007384766e-01   +5.408729382270903e-01   +3.406990754474727e-01; +6.647434894810397e-01   +7.247529262231788e-01   +5.091917091711479e-01   +8.711798206583667e-01   +7.982266964508846e-01   +6.613415813827842e-01   +7.250625046753045e-01   +6.692782873806854e-01   +8.968711303237078e-01   +9.970638179717072e-01   +3.366442892801286e-01   +8.308278448678784e-01; +1.698212080293405e-01   +8.773783190150902e-01   +5.432594330962685e-03   +9.976618676539979e-01   +4.147919635986721e-01   +5.840507202473935e-01   +7.760867467249369e-01   +5.121898410017311e-01   +8.193994512124534e-01   +7.711395014800251e-01   +6.703749032453052e-01   +1.141574928999858e-01; +1.998872775873816e-01   +8.152250088293447e-01   +8.719775323671878e-01   +1.210815135518009e-01   +6.400190230924561e-01   +4.854070767568623e-02   +3.361373128586683e-01   +7.525176743418008e-02   +3.147795270627674e-01   +8.913035544837352e-01   +8.795805573207430e-01   +7.802269950067906e-01; +9.884305368095309e-01   +3.646853019409576e-02   +9.092670598684807e-01   +1.057351487566190e-01   +5.672672213870394e-01   +7.836290291493914e-02   +5.708708419937439e-01   +5.362323853515311e-01   +5.988284402540894e-01   +4.344335593761359e-02   +9.744527144968071e-01   +1.538800917518680e-01; +9.372970637275934e-01   +9.497370766564622e-02   +1.109980706057543e-01   +1.488708374061188e-01   +9.132115357714693e-01   +2.302122435040270e-01   +6.382017604045894e-01   +6.853636706126002e-01   +7.036766422261568e-01   +7.981754075867376e-01   +1.346480928388298e-01   +7.318206475897995e-01; +9.803553002447383e-01   +9.734795789044362e-02   +4.053524781395691e-02   +1.279219127075800e-01   +7.540054170999837e-01   +4.143785935009055e-01   +3.658205876136625e-01   +5.889705923418879e-01   +1.783679491579270e-01   +7.134607497844269e-01   +8.836322658536154e-01   +1.169025751151813e-01];
L3I_L2I_iGABA_netcon = [+7.677908994626770e-01   +5.405337989155724e-01   +6.000634494506134e-01   +3.063083453461398e-01   +9.611193525320257e-01   +1.115295893079336e-01   +2.969172498961382e-01   +7.927930008744524e-01   +9.178903694716078e-01   +9.951926468323933e-01   +3.089768028518954e-01   +9.958686717184025e-01; +6.387782255944561e-01   +4.505385782265777e-01   +5.626885171544710e-01   +7.585331510485982e-01   +5.460180328593567e-01   +6.397858810872863e-02   +1.665488147875666e-01   +5.068204129075454e-02   +3.868140950123890e-01   +2.901872679999825e-01   +4.411747318117020e-01   +9.185127501625578e-01; +8.006009146573438e-01   +1.137538459672299e-01   +7.303201278182903e-02   +6.502441232924735e-01   +9.789763550807350e-01   +4.394291370035736e-02   +7.231126488250430e-01   +1.844526993033967e-01   +7.497154929627187e-01   +5.221583801239058e-01   +2.034077148646841e-01   +6.949375163143201e-01; +9.657457222184070e-01   +7.160385712920169e-01   +7.645238333408970e-01   +3.299720268624415e-01   +1.232612193198669e-01   +1.276706764891433e-01   +2.967997146073552e-01   +2.479282738828454e-01   +8.765225503382514e-01   +3.635167163540621e-01   +9.433395270536404e-01   +2.199904854300632e-01; +7.130563210432148e-01   +1.854495694440283e-01   +8.708871790982342e-01   +9.789173523738618e-01   +1.583365389461642e-01   +4.921674120683018e-01   +6.757651269017004e-01   +2.560767174654531e-01   +4.008209777280860e-01   +5.225831789583909e-01   +2.895421891071756e-01   +3.086870202961513e-01; +6.463904707702447e-01   +3.262758425942468e-01   +7.016325772129740e-01   +5.305556291672483e-01   +3.348699674498079e-01   +4.668186882875323e-01   +7.531168715475915e-01   +6.508206775241010e-01   +1.691350585975475e-01   +4.951758389365589e-01   +1.162602283010974e-01   +2.287722098320808e-01; +5.167118028277932e-01   +9.707000832544597e-01   +1.126363123707849e-01   +7.527794530788627e-01   +5.284178148079203e-01   +1.564846052081775e-01   +7.454710272951901e-01   +9.943759696600948e-02   +4.425267314615038e-01   +1.852299230942230e-01   +6.573035204867356e-02   +7.023563437650260e-01; +9.548086249427333e-01   +6.928536126808841e-01   +6.617900185195904e-01   +2.639379826586712e-01   +6.879487287011746e-01   +1.327337212680015e-01   +7.789719496482236e-01   +4.699473052105516e-01   +8.546861659681458e-01   +4.874499163826514e-01   +7.272654393607131e-01   +3.756693632584341e-01];
L2E_L3E_iAMPA_netcon = [+6.504256390636431e-01   +3.826972980212191e-01   +2.322083801438113e-01   +4.664992944834857e-01   +9.108658509484303e-01   +9.514360375436035e-01   +7.602470059001449e-01   +3.533579571037743e-01; +3.775374386172546e-01   +2.662841562493130e-02   +9.109698000896741e-01   +2.878714387752571e-01   +6.817331375698971e-01   +1.881089055010056e-02   +8.919442236022660e-01   +6.642539474646099e-01; +3.057602912445180e-01   +3.307067997668994e-01   +4.884932381048262e-01   +2.756465518831048e-01   +8.455658435634363e-01   +5.020725199983557e-01   +7.917054090502121e-01   +5.939625114861151e-01; +1.575426632126987e-01   +4.954422169026865e-01   +5.901974312785369e-01   +1.455367883760323e-01   +9.499679318889109e-02   +3.331018499165625e-01   +9.424073149116120e-01   +5.254720451813975e-02; +7.772088238268821e-01   +2.691678437225680e-01   +9.555335508696527e-01   +1.402356295188683e-01   +7.363956240044530e-01   +6.666875296465080e-01   +5.339595042588328e-01   +2.107927709388779e-01; +7.157149944063022e-01   +5.329791110568579e-01   +8.528526659364710e-02   +2.655812427557036e-01   +5.510198418355421e-01   +1.618061481299719e-01   +1.594993112024350e-01   +5.958756517259816e-01; +1.767782454806213e-01   +4.171532985321759e-01   +2.220535073564223e-01   +6.056692275718105e-01   +2.511591385082477e-01   +2.232749541653525e-01   +1.338957161214077e-01   +2.667598317280670e-01; +4.485265344508063e-01   +6.799735708157334e-03   +1.608283783415700e-01   +1.015530993367329e-01   +7.214876039388465e-01   +1.122409353103873e-01   +2.615107656701877e-02   +1.186116804140422e-01; +8.393947043346024e-01   +8.959423194344669e-01   +3.891234778909614e-01   +4.911681012457236e-01   +3.645739635322481e-01   +9.919402372389344e-01   +6.872063101595518e-01   +2.156671477228340e-01; +7.007270330018623e-01   +2.385426473581689e-01   +1.852402029273886e-01   +8.943067477669137e-01   +8.465247911216321e-01   +1.465659095363467e-01   +5.804189836030100e-01   +8.777832894806463e-01; +7.650504980665874e-01   +8.041206417995890e-01   +7.619267909809339e-01   +1.839278851186971e-01   +8.248402361232845e-01   +7.651819074253793e-01   +2.972313953690691e-01   +4.626221034397265e-01; +9.764953048171263e-01   +5.813576430296354e-01   +2.331056561128514e-01   +5.232143840447673e-02   +6.196456542093399e-01   +6.258150822093496e-01   +7.441195271078152e-02   +7.296099539878911e-01];
L2I_L3I_iGABA_netcon = [+5.882244546377023e-01   +1.449764210656231e-01   +3.433163891452754e-01   +3.728754869459616e-01   +5.967397132185119e-01   +5.122204435004014e-01   +7.743654572889734e-01   +2.631345344611437e-01; +8.431397555053558e-01   +9.914542494346973e-01   +4.395441478917058e-02   +5.352091511437995e-01   +4.759976101728241e-01   +2.435292526310443e-01   +1.812601556462181e-01   +5.967506554792013e-01; +6.039120645039311e-01   +4.797717576349848e-01   +9.486506449124550e-01   +9.714670629552781e-01   +3.773457408093163e-01   +2.659111287509399e-01   +4.520589228502418e-01   +6.836314822426544e-01; +7.484168763936023e-01   +4.114224996936693e-02   +8.607897173565127e-01   +9.967921001279868e-01   +9.799632815872776e-01   +4.140403660214373e-01   +3.032614813310777e-01   +4.175604449154917e-01; +8.526807957867457e-01   +2.709626965416215e-01   +1.381895028831439e-01   +4.078435385938560e-01   +1.375945215363950e-01   +2.631508552377731e-01   +3.797253016090766e-01   +5.184599307355056e-01; +1.463151947446484e-01   +6.721815957318228e-01   +5.821931129465647e-01   +4.495509179060833e-01   +2.708824771355620e-01   +8.531579032466801e-01   +7.943928322063230e-01   +8.135023596696246e-01; +7.378786160946215e-01   +1.421095490179503e-01   +6.092797876498027e-02   +2.403782370575895e-01   +2.259434690525925e-01   +4.834889981470266e-01   +7.809231400032557e-01   +5.445539286484955e-01; +1.372128643534857e-02   +7.728111893301942e-01   +9.525909969901422e-01   +5.955755630988691e-01   +7.913338760857395e-01   +3.340539799357735e-01   +6.439959930881387e-01   +5.912429103525068e-01; +2.328990688824182e-01   +2.656855619491488e-01   +4.976406272423700e-01   +7.347748980930829e-02   +8.195356409992706e-01   +6.328611934731121e-01   +2.407839343614995e-01   +5.378685547480555e-01; +5.406054087628873e-01   +8.831216115569334e-01   +2.551056648249730e-02   +9.115383993917556e-01   +8.022416376899578e-01   +4.184435153826035e-01   +6.035993697319784e-01   +5.456352191724242e-01; +7.097981909687855e-01   +3.618175959884374e-01   +5.215346173081047e-02   +4.737302121682726e-01   +1.201803804691681e-01   +5.427102029090408e-01   +4.207558837102585e-01   +1.527100424414008e-01; +4.332383850904777e-01   +1.369942057586437e-02   +3.099786213282601e-01   +5.026677969766682e-01   +6.410314208145708e-01   +3.373959735252707e-01   +3.013609968983940e-01   +6.998246929651172e-01];
L3I_L3E_iAMPA_netcon = [+6.149356131947828e-02   +7.799307187177715e-01   +5.567473888337110e-01   +5.687197076387651e-01   +9.147775624257289e-01   +8.357152396099867e-01   +8.523028370479787e-01   +8.669972788336253e-01   +5.301281778767690e-01   +9.930247537276100e-01   +4.794959527034955e-01   +3.531405481018711e-01; +9.231060361320256e-01   +8.333114168119717e-01   +8.511228106917642e-01   +9.359309135050237e-01   +5.888555559324173e-01   +3.990610916805239e-01   +6.274484765295731e-01   +8.560765468431821e-01   +5.715524377892548e-01   +7.008459740660012e-01   +7.406698460785937e-01   +3.979243213818737e-01; +1.822536669469472e-01   +5.960678869645867e-01   +9.725447041409745e-01   +7.755454034550376e-01   +5.774447919386279e-01   +6.806046934555944e-02   +4.420594204730399e-01   +9.468460926502086e-01   +9.816588803068659e-01   +8.385759963435341e-01   +5.897423955446984e-01   +9.966594667495720e-01; +5.361301049569421e-01   +7.606423830808209e-01   +4.698223078477144e-01   +6.014770509818005e-01   +6.506275498728830e-01   +3.765712907945789e-01   +2.302017230034916e-01   +6.952515281099337e-01   +9.612925829426372e-01   +7.298731178985112e-01   +2.564255623026263e-01   +2.899667831150325e-01; +3.972985045331677e-01   +6.602958349049094e-01   +7.755899368292585e-01   +6.459045871801393e-02   +4.320972371681823e-01   +8.599488806579807e-01   +4.843593247192487e-02   +3.623920157595921e-01   +5.583993876575015e-01   +9.994621952026014e-01   +6.143048347364363e-01   +2.354542037562012e-01; +8.671412838151329e-03   +5.883955002729540e-01   +2.508162342829028e-02   +5.344360817588771e-01   +9.387990233245890e-01   +2.860703737678115e-02   +7.060753525900408e-01   +3.825593443219270e-01   +5.247092041080854e-01   +5.049346622490863e-01   +2.288344097291335e-01   +3.322096609608052e-01; +1.092003425943051e-01   +2.116116411164172e-02   +6.756119998709313e-01   +8.605553844831249e-01   +1.040403042231309e-01   +4.267165640685482e-01   +8.529756216931587e-01   +8.546621464363673e-01   +4.734605919803711e-01   +1.954036731897360e-01   +1.898653697872850e-01   +1.674938488145342e-01; +8.563734568968459e-01   +6.882237203635304e-01   +8.392395740074331e-01   +3.427763948695005e-01   +4.116371360846733e-01   +2.482262060765054e-01   +4.014767136423155e-01   +3.850500449287060e-01   +8.961567714165185e-01   +9.547096351209147e-01   +3.788894210798987e-03   +3.848683662047608e-01; +3.351254545763058e-01   +3.245390231701309e-01   +6.924698425379300e-01   +1.813508680096092e-01   +8.955160510437835e-01   +7.027491832635106e-02   +2.909583096729235e-01   +7.721634216907878e-01   +4.818930586883652e-01   +4.526052669017690e-01   +6.523829048007699e-01   +5.290605148284758e-01; +1.423561703620756e-01   +8.994739230396581e-02   +9.002477915121692e-01   +8.868773167557067e-01   +7.366390940528437e-01   +9.208473464223248e-01   +2.541788274829149e-01   +7.828682166691067e-01   +4.922643899104998e-01   +6.018156054569970e-01   +4.011570611431629e-01   +5.949973228633406e-01; +7.977520880012297e-01   +7.484741336002984e-01   +9.082098378998871e-02   +8.446623600748514e-01   +9.600173754231491e-01   +2.666420539567809e-01   +5.111197977715595e-01   +4.260805629008376e-01   +3.114213210151489e-01   +6.432829709309285e-01   +2.692617374729143e-01   +1.670308248707982e-01; +6.535951470260805e-01   +9.719131146179906e-01   +7.727475055411219e-02   +8.265394438839601e-01   +9.761465417658165e-01   +1.072366675591021e-01   +1.169928009383572e-01   +4.883921031691572e-01   +8.584087617128274e-01   +7.557207982611860e-01   +8.667553769042439e-03   +6.019048349469432e-02];
L3E_L3I_iGABA_netcon = [+4.441960103374606e-01   +6.349998944641727e-02   +7.053950033944005e-03   +5.005241770025143e-01   +5.417656328647447e-01   +2.489526651043499e-01   +7.214850887197011e-01   +7.594427023694883e-01   +3.792139077610286e-01   +4.469332998338886e-01   +2.021049743351444e-01   +6.536030653008199e-01; +5.755434707437405e-02   +8.054360646154543e-01   +1.285412686183125e-01   +1.922644688483408e-01   +2.214527433555279e-01   +3.376830384326696e-01   +2.233951582778429e-01   +8.852002340202184e-01   +6.091772205730388e-01   +3.906865992698746e-01   +8.314247615756010e-01   +9.011943004154818e-01; +6.278722175353270e-01   +9.122828297297477e-01   +3.082955707266966e-01   +6.463221040661975e-01   +2.671578213291551e-01   +6.003671098325396e-01   +4.933346430710427e-01   +7.293742080744473e-01   +1.604834411226233e-01   +6.754916644021258e-01   +4.410708243461370e-01   +8.372887627757044e-01; +8.077664598012979e-01   +4.226651122343028e-01   +2.352788595141981e-01   +2.558420737642871e-01   +1.363771460508531e-01   +4.799907168982202e-01   +4.750799178708529e-01   +6.870197125070620e-01   +1.030775094805584e-01   +3.186712018129392e-02   +4.346585603365306e-02   +1.646221268870497e-01; +4.022985152595825e-01   +1.890186648931775e-01   +6.532840722444091e-01   +9.417509860774482e-01   +1.318606382132443e-02   +9.017160252001029e-01   +4.344811070445826e-01   +6.515093574867020e-01   +6.177320465947944e-01   +7.802321562505814e-01   +7.647583398152775e-01   +1.600783844697038e-01; +8.879944044938651e-01   +1.847101324380618e-01   +8.040044564669221e-01   +2.925231149694626e-01   +1.254660259464383e-02   +2.876900181399239e-01   +5.566974189741177e-01   +6.225962856699682e-01   +9.592717840545297e-01   +3.722176325353576e-01   +9.507106633740779e-02   +1.343926147457422e-01; +7.178336242065252e-01   +6.694784075924990e-01   +7.358786213865891e-01   +1.452227071329487e-01   +9.891113897566819e-01   +7.787945235904432e-02   +2.069977541705515e-01   +7.715668283933080e-02   +6.676129926376135e-01   +6.370180668581331e-01   +6.565292925881090e-01   +1.542144680266074e-01; +2.054668257564896e-01   +5.208876177162043e-01   +1.186315843649743e-01   +8.641612817607639e-01   +6.488113767129102e-01   +3.834605966131903e-01   +2.787009206552727e-01   +5.479719021140944e-01   +4.735334221190589e-01   +4.928186302796419e-01   +2.641156981895401e-01   +3.979599034471246e-01; +3.728171950426489e-01   +7.803709714327721e-01   +1.726499499588942e-01   +8.839585491840809e-01   +8.071118156034799e-01   +1.863083609425073e-01   +8.022919616562411e-01   +8.754889128253711e-01   +3.338289796296633e-01   +2.289181095708020e-01   +4.420330956259027e-01   +6.594550582743294e-01; +2.123066894488827e-01   +3.035139432749527e-01   +2.652126574584712e-01   +6.585427603703261e-01   +2.807759429178474e-01   +7.293601526082334e-01   +1.011377954303790e-01   +9.839269213273458e-01   +5.889058326776194e-01   +2.131922278987161e-01   +8.467420799166597e-01   +2.225570710389164e-01; +2.571417794258699e-01   +4.695706875651299e-01   +8.182795975749013e-01   +9.956283737130748e-01   +1.570878331138128e-02   +4.289824270466756e-01   +3.545612221000186e-02   +6.811500606285510e-02   +5.481241568746015e-01   +4.513591666975025e-01   +9.040782944865940e-01   +6.426207683562470e-01; +9.935430741069371e-01   +7.078561533131613e-01   +5.878926870702070e-01   +2.596753168261090e-01   +1.010233387991683e-01   +2.643433309987596e-01   +7.270231160363286e-02   +2.999419109657980e-02   +4.095433746728054e-02   +6.285680963572927e-01   +2.810274246185690e-01   +6.118754208541503e-01];
L2E_Input1_iAMPA_netcon = [+9.988521563337822e-01   +9.971937867112509e-01   +9.978596783918472e-01   +9.936662199943976e-01   +9.943598290865756e-01   +9.995439120838521e-01   +9.921960426684446e-01   +9.933372320646345e-01];
L2I_Input2_iAMPA_netcon = [+9.985467494444448e-01   +9.965631712462807e-01   +9.983095938575649e-01   +9.940779511280071e-01   +9.978237913047373e-01   +9.965415471774997e-01   +9.973594806567891e-01   +9.980799259895777e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
