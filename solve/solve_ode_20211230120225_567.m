function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.080453409117270e-02   +9.547213679668730e-02   +5.738008659227660e-02   +7.911569956412445e-02   +8.302435597494968e-02   +4.094794368365658e-02   +6.379134277982142e-02   +5.128783529051122e-02   +6.116263134400908e-02   +6.715726725191752e-02   +4.720431878730887e-02   +8.066981824099196e-03   -1.548726472609485e-02   +6.713254056662432e-02   +1.637920558204799e-02   +3.056595220774327e-02; +6.829209923064287e-03   +2.860967046158208e-02   +7.413430021372400e-02   +2.090960268669478e-02   +2.133482279330383e-02   +9.568387731919195e-02   +9.320001975552383e-02   +1.646480182686107e-02   +3.818138405330372e-02   +6.446434512198415e-02   +1.220964677350787e-01   -4.079102857115094e-03   +2.662181539625585e-02   +1.901308540638903e-02   -4.278152145470879e-02   +2.051300908059942e-02; -4.323337942597356e-02   +2.119525307208757e-02   +5.971559927013712e-02   -2.035457557971362e-02   +3.321128274309984e-03   +1.106580637689369e-01   +4.521761561004452e-02   +1.778075674023373e-02   +1.530086531825126e-01   +2.291350332944084e-02   +1.294558644573997e-01   +6.786897216792431e-02   -1.512608313554185e-02   +1.043167759885739e-01   +9.804925897873186e-02   +2.129091080788545e-02; +1.096120217707858e-01   +1.780690995331028e-02   +6.715796435676513e-02   +5.647602391169662e-02   +1.050237967756618e-01   +1.154266293059927e-02   +4.381071734678636e-02   -5.727331461375180e-02   +3.564580382753593e-02   +1.051499876299863e-01   +3.537617236418628e-02   -5.082459090513976e-04   -5.465095504320944e-02   +2.994973746537367e-02   +1.156713867090590e-01   +1.105923788887108e-01; +7.012900892097673e-02   +6.341735786357838e-02   +1.302434472744788e-01   -2.726256453963325e-03   +4.989664494283498e-02   -6.868333301690401e-03   -4.665527177014912e-03   +6.745808194259766e-02   +2.651797492401376e-02   +9.203273830969155e-02   +9.368364300150411e-02   +4.865785821214608e-02   +3.518995802917671e-02   +4.207681794080642e-02   +1.124035629462615e-01   -3.314022861989992e-02; -5.405070564488942e-03   +7.739315874306762e-03   +8.443701489805089e-02   -3.721212450277604e-02   -2.008233347675020e-02   +4.552055092458643e-02   +1.331812220654413e-01   +3.874511204261555e-02   +1.096524896372273e-01   +2.711478089946348e-02   -2.781370846930921e-02   +2.268844877554190e-02   +9.863490502096865e-02   +1.493502436996303e-02   +8.319869926767111e-02   +2.884153385714330e-02; +4.060728271093289e-02   +4.208360990331405e-02   +9.434553796086745e-03   +7.951735313118011e-02   +4.682688369544109e-02   -6.059069379698602e-02   +8.208348844902084e-02   +1.745861807199687e-03   +1.427424955379034e-01   +8.092288341964296e-02   +7.684371497927423e-03   +9.715995643489829e-03   +1.431714736135508e-02   +1.030789080544100e-01   +1.017660891739421e-01   +2.293872556703165e-02; +4.696039118521828e-02   -5.412671638035182e-02   +5.550259542594517e-02   +3.829588685106861e-02   +1.162652142702929e-01   -7.636975724830836e-02   +1.167261419991796e-02   +2.358018422839618e-02   +2.961106944190336e-02   +7.021254576189188e-02   -4.005419940567913e-02   -2.410374802279399e-03   +5.940584689210358e-02   +9.327007699531464e-03   +1.387592346471796e-03   -3.797488917733739e-02; +7.435770635619275e-02   -9.510632618184724e-03   +1.004938985040563e-01   +8.348250246652381e-02   +2.955839227182296e-03   -3.379658439330829e-02   +3.080126240363177e-02   -3.522169445015598e-02   +1.086466251078833e-01   +7.867158496266732e-02   -4.530028350686106e-02   +1.968290689904669e-02   +3.446711467670483e-02   -4.531451126213406e-02   +1.037802820174352e-01   -1.468383553996930e-02; +9.502494322398050e-02   +5.087655743851636e-02   +6.554501987517726e-02   +3.163179560715589e-02   +3.727891198205126e-02   +1.215926246583130e-02   +1.978154934976245e-02   +4.933228106489615e-02   +6.767553032954061e-02   +4.896987999368703e-02   +8.139678437471792e-02   -6.030932279500245e-03   +4.650271146663662e-02   +1.514236225564201e-02   +2.481300690007768e-02   +1.587552267697919e-02; +5.983975945806558e-02   -4.266919735885047e-02   -5.720954080164604e-03   +3.841153307132097e-02   +6.315788856582583e-02   -1.993651713366682e-02   +4.884977938902747e-02   +1.572542514874308e-01   +4.249000549332611e-02   +4.324477435556234e-02   +2.449568783696099e-03   -1.066704551024379e-03   +6.734438630023951e-02   +1.079848697050216e-02   +1.046111815054104e-02   +4.742292711665608e-02; +8.125434900657277e-03   +9.766850286431794e-02   -1.154068890529795e-02   +1.581274349089291e-02   -3.250303623812663e-02   +3.613750386587475e-02   +1.394974812120231e-02   +2.849905069041964e-02   +6.058249305250462e-02   +1.653234957940369e-02   -2.742889038282934e-02   +1.633183949845634e-02   -5.130419964987618e-03   +1.337775407819136e-01   +4.296261182592649e-02   +4.713346390645201e-02; +2.635597059206127e-02   +9.797342560940339e-02   +3.124615994843018e-02   +7.814414857170374e-02   +3.269668129376926e-02   +1.410827814487783e-03   +9.647198722094396e-03   -4.040246376669909e-02   +2.269376802008607e-02   -2.856925816294656e-02   +5.134736539414423e-02   -9.546778190090439e-03   +1.061353073226456e-01   -7.863735449432641e-03   +1.121429503117785e-01   -2.712811132390448e-02; +1.149863089682575e-02   +7.700915924843958e-02   +4.306960742753223e-02   +6.854590221136805e-02   +1.246534949460465e-01   -3.316442419381117e-02   -4.116069052922106e-03   +7.222034272058708e-02   +2.119708919708374e-02   +1.211119157832631e-01   +7.820338699477403e-02   -4.263900616562878e-03   +2.545784790888704e-02   +6.248545346265595e-03   +3.310897278095530e-02   +5.073544580612505e-02; +1.820180046779842e-02   -5.570011749642090e-03   +2.547074387452518e-04   +4.234604293922996e-02   +3.044923717796381e-02   +2.131377968981802e-02   -3.292427401303027e-02   +1.370006118087407e-01   +5.029187641425969e-02   +8.369744617186385e-02   -3.617858354416927e-02   -4.388278788933588e-02   -2.227241735192188e-02   +6.369458923472376e-02   +8.653703483765628e-02   -2.204106798098137e-02; +7.762797428316798e-02   +1.340427490233208e-01   -3.469882781487478e-02   +6.480934574649000e-02   +9.894188250905570e-02   +9.323690767835210e-02   +1.189384701955863e-02   -6.367992647093910e-02   +4.949380529581950e-02   +7.404478514141589e-02   -1.474648812554317e-02   -1.714558790132258e-02   +4.807327534426768e-02   +9.800743787375545e-02   +6.834611280613284e-02   +5.079599232475464e-02];
L1E_L1I_iGABA_netcon = [-7.597124125851741e-02   +5.792033352174200e-03   -1.163911141679779e-03   +3.392217081334917e-02   +8.538779813753522e-02   +8.259843223155756e-02   -5.155165345508052e-03   +2.724350148426156e-02   +1.978286546637461e-02   +7.505583658842817e-03   -3.499745625077202e-02   +6.551055201690366e-02   -7.296067171378448e-02   -6.991615201168520e-02   -3.481306863253601e-02   +4.873509093192926e-02; +7.213075073706267e-02   +5.557519434024756e-02   +6.271426340558819e-02   +6.035541977485884e-02   +1.356294109032567e-02   -7.971827914744646e-02   -5.524334282150549e-02   +6.525834784380499e-02   -3.945200527102249e-02   +1.154719983283996e-01   +2.340783314554892e-02   +7.589810871805809e-02   -1.102896207183807e-02   +2.891302221275390e-02   +2.910191646289568e-02   +4.386392332021692e-02; +2.624251813969288e-02   +1.070040658294973e-02   +1.297412773793962e-01   +1.250135397741111e-02   +1.314429770384367e-01   +8.554487835203373e-02   +7.885371924363371e-02   -6.154251106256756e-03   +1.746805421040792e-02   +1.460663772695454e-01   +4.888172140144936e-02   +1.286049184853858e-01   -2.481376059134921e-02   +1.444520319958921e-01   +3.921542392021136e-02   -4.175313075688609e-02; +4.038107455549669e-02   -3.099243176773119e-02   -2.535748068216639e-02   -4.662792241499682e-02   +1.158623783483983e-02   +6.026163932280254e-02   +4.187889033935491e-02   +6.482862152289148e-02   -7.877208402563443e-02   -4.168634825080984e-03   +6.376746106224022e-02   +1.155106199002534e-02   +1.701604292917745e-02   -4.997750723504790e-02   +1.224474671582033e-01   +7.595758039132787e-02; +4.374619209602337e-02   -1.237521906446385e-02   +4.549703793965965e-02   +8.709607917742916e-02   +2.202998043068898e-02   +7.395338769204832e-02   -7.445316556186621e-02   -5.314348405896602e-02   +1.343567067883974e-01   +1.364522571109894e-02   +3.000173244282839e-02   +1.214054364793697e-02   +2.066669339716510e-02   +5.771010207549358e-02   +6.253109621399648e-02   +3.939613669874736e-02; +3.513790654535480e-03   +9.802953143007071e-03   +4.323622329239973e-02   -6.726133995494407e-02   +3.949516865715120e-02   +6.638864714166988e-02   +9.469901446908451e-02   -7.197561358915697e-03   +1.149881364842882e-01   +9.657009259210000e-02   -6.965743509508369e-02   +3.168345023018938e-02   -7.315704815320853e-02   +9.338543618715556e-02   +1.311628617183650e-01   -3.316782861866166e-02; +3.458874790832098e-03   +1.657609867479047e-01   +1.272369426786606e-01   +1.171732837084402e-01   +7.923618746663917e-02   +6.521184883234672e-02   +5.365587840653559e-02   -4.214836002816164e-04   +5.268012893555650e-02   -1.653310353689815e-02   +4.602251842398183e-02   +3.829185444468411e-02   +3.390287885327548e-02   +1.061586887635454e-02   -3.920103216105206e-03   +1.090599242618291e-01; +7.936929286466939e-02   +6.286049815595580e-02   +6.936552463568094e-02   +9.524532139766070e-02   +6.402306840432682e-02   +5.157287135319344e-03   +3.705995350424451e-02   +6.511435736039900e-02   +4.328061208709862e-02   -5.144828425508946e-03   +4.054263450764958e-02   +7.410674355612416e-02   -5.379144702858749e-02   +1.317950302066376e-01   -3.627020027771483e-03   +2.820649427833093e-02; -1.628403139564562e-02   +1.267184525275167e-01   +9.755204684118145e-02   +1.132010508042501e-01   +5.374121832979561e-02   +1.658058674937657e-02   -1.591349337594143e-02   +5.644951869676987e-02   +3.031906016453136e-02   +1.797704842665185e-03   +3.394618476483180e-02   +1.074340194644480e-01   +9.572564494550552e-02   +5.420548852901677e-02   -2.316419043633607e-02   +9.244570996072177e-02; +3.802399080026233e-02   +3.111242611535626e-02   -2.147464988026328e-02   +6.230846926541387e-02   +7.009685981666938e-02   +7.650942217589114e-02   -2.389526397638866e-04   -3.413324505569473e-02   -7.711876544730073e-02   +5.941494311817904e-03   -7.248783725212837e-03   +9.904602984941145e-02   +2.846201820632353e-02   +4.065075328050827e-02   +8.362755080263313e-03   +4.386566191168863e-02; +1.887778150446713e-02   +1.519765670099957e-01   +2.351877025792391e-02   +3.743813624771228e-02   +7.266210205580743e-02   +5.162899161974574e-02   -9.651854495083347e-03   -5.149024148717644e-03   +1.008806909781311e-01   +4.975668150934735e-02   +3.307955764358519e-02   +1.184292008294653e-01   +1.256049565963971e-01   +4.861028036302382e-02   +2.679539907970749e-02   +3.773146195153433e-02; -1.367987729478415e-02   +1.650146605234823e-02   +5.377683225952915e-02   +7.542576582585346e-02   +6.021475578464508e-02   +7.895198033831580e-02   +5.851815392815506e-02   -1.515060142491796e-02   +1.036498043056684e-01   -4.133684384098658e-02   +9.565428918995476e-02   +5.775080276624316e-02   +9.935518279824672e-02   +1.331132332304258e-02   -3.099170035142169e-02   +1.029485119176797e-01; +1.666357499107698e-05   -2.538347712415728e-02   +2.114648613827538e-02   +5.446088184256549e-02   +8.348477528674625e-03   +9.163031720851314e-02   +6.035475535723055e-02   +7.518380880752092e-02   +5.571414890252601e-03   +7.120732532712040e-02   +5.999841051686865e-02   +2.878835140371246e-03   -2.020412488758205e-02   +4.420376834923478e-02   -7.172144133902161e-02   +5.208031231399440e-02; +4.050267726839140e-02   -2.126464579418281e-02   +6.108498373951723e-02   +6.977476128326011e-02   +4.876607077826953e-02   +3.414672929450573e-02   +7.872128434195806e-02   -4.581160829154041e-02   +5.400347059789444e-02   +7.759660617428703e-02   -2.627001443393170e-03   +1.006347338377665e-01   -1.916916513542668e-02   +5.676409607631120e-02   -2.253365911744616e-03   -2.098152113285839e-02; +1.923418865092587e-04   +9.994179833022614e-02   +1.393682411501651e-02   +3.328532826267104e-02   +7.735851232802574e-02   -8.036930803368543e-03   -3.299399873717893e-02   -1.245639986925602e-02   +6.933127638160538e-02   +2.620092422128984e-02   +4.531841849329662e-02   +5.484404825468667e-02   +4.728728577139841e-02   +3.242668887930733e-02   -3.242237239139176e-02   +2.724878150971019e-02; +1.095164732154364e-01   +1.036831742743692e-01   +3.855515299669215e-02   +5.255720586975765e-04   -3.566935688735083e-02   +4.085495698870522e-02   +1.647654800924517e-02   -3.296476818062038e-03   -5.051565170643174e-03   +1.024741574763256e-01   -5.169640087993810e-02   +6.251384256748811e-02   +9.541862708092170e-03   +3.318430670122292e-02   +5.586443117710879e-02   +1.053225376508419e-02];
L2I_L1I_iGABA_netcon = [+1.200473067489549e-01   +1.903909160766068e-02   +2.229767880324193e-02   +6.236930074781584e-02   +4.230795184255315e-03   +1.154273508406256e-01   -2.004291879822415e-02   +7.758829609849799e-02; -2.599277943026636e-02   +3.649113623375916e-02   +2.455567143872038e-02   -1.687833229223529e-02   +6.118019558263066e-02   -8.870320529625303e-03   +2.614670298053085e-02   +7.504788003246528e-02; -3.836233700328522e-02   +3.956323261787194e-02   +1.632603209830877e-03   -3.146172551646269e-02   +1.183377919774780e-01   +9.077920698485321e-02   +1.228546530789026e-01   -6.879756841283484e-03; +5.364204295230726e-03   +8.979913974927708e-02   +5.983940890363788e-02   +7.450108098138536e-02   -8.971682009859397e-02   +2.471918613387152e-02   +5.912216648080482e-02   -3.293189451032538e-02; -6.820401806659059e-02   +3.559934268690489e-02   +2.849289552876873e-02   -4.602053959387142e-02   +6.286305472259340e-02   +6.588936778871649e-02   +3.477837758938732e-02   +1.748025284457327e-02; +3.319732004523471e-02   +8.946712756283287e-02   +1.031786703529970e-01   -1.063266444215056e-02   +4.487104041278020e-02   -2.750666379112765e-02   +4.358852740451503e-02   +3.625727870817181e-03; +6.982843573912907e-02   +2.036434106498914e-03   -1.546108364193186e-02   -1.014973125719184e-01   -1.712893271788425e-03   +1.573928208535647e-01   -2.006679843320202e-02   +5.986816948075531e-02; +4.125526051365405e-02   +2.114465422439857e-02   +9.399522115997813e-02   +5.397338891109400e-02   +2.077404896592351e-02   -6.224272168391276e-02   +6.548635002887881e-02   +3.123372488005037e-02; -1.098162185544399e-03   -1.323745429415448e-02   +7.384168825326862e-03   +4.422623787769886e-02   +5.692987708849674e-02   +7.479864271092591e-02   +4.307501391257582e-02   -8.112038084074496e-03; -7.459863456665498e-02   +1.525192602728603e-01   +6.329699293160118e-02   -3.882324394895353e-02   +2.226283647744927e-02   -1.316273091779717e-02   +8.392343939009059e-02   +7.242604177423322e-02; -7.203164674786845e-02   +1.186274635470548e-01   +1.235768148107331e-02   +7.648735830537447e-03   +4.303400673099710e-02   +9.081745344856822e-03   -6.687230733992806e-03   +1.138108856074469e-01; +1.003761131090583e-01   +3.584008186425595e-02   +1.022502533328172e-01   +1.441879730571291e-02   +3.289724308232398e-02   -4.239783268372908e-02   +4.983498083825916e-02   +5.087835945797414e-02; +8.664617009683195e-02   +1.027969237645785e-01   +2.879829882738038e-02   -1.298074251767536e-02   +1.044975393058495e-01   -3.519196143582122e-02   +1.324523851349577e-02   -2.302989733370511e-02; +5.290459394456300e-02   +3.433852723762045e-02   +2.858834439281489e-02   +7.734135043457127e-02   -8.492129454206046e-02   +7.434948973906933e-03   +1.235212045391370e-01   +3.857088102917169e-02; +9.871836281011374e-02   +3.630907161172711e-02   +1.040694983118930e-01   +8.083919575056973e-02   +1.078149962057077e-01   +1.508667704098118e-02   -2.318374463592442e-02   -3.156435494041410e-02; -4.891536051771544e-02   +1.489227255871449e-01   +1.347117371048230e-01   +4.109484969149893e-02   +6.857600927642549e-02   +1.878680520791258e-02   +5.358386352500838e-02   +1.462624501486186e-03];
L1I_L2I_iGABA_netcon = [+1.842274447653163e-02   +7.076813635502315e-02   +5.736549871908944e-02   -5.366177787165144e-02   +1.154208242187539e-01   -2.372508725237378e-02   +3.366211233053513e-02   +8.450187634449659e-03   +5.784920564307592e-02   -3.698153762206960e-02   -6.041335359898162e-03   -1.649740865224031e-02   +3.546640627559105e-02   +5.530890192718325e-02   +8.594385510064587e-02   +8.546118193476344e-02; +3.275121721224167e-02   +2.147436376003313e-02   -4.772037588659962e-02   -6.140509376371603e-02   +3.940975591394193e-02   -1.471803305603802e-02   +3.367048766992493e-02   +1.293694909982098e-02   -1.741232774037182e-03   -1.786560613850775e-02   +1.816937407517687e-02   -2.778844993723048e-02   +6.822183005971792e-02   +1.012218386522185e-01   -7.225215719898673e-02   -7.943971713597085e-03; +2.980000226477564e-02   +4.036721923803586e-02   -9.898903343816759e-02   +1.461505079388494e-01   +1.527314129983778e-02   +1.082900082040133e-02   +1.205076734682550e-01   +5.840173037935729e-02   +6.599421777001810e-02   -1.272711830715076e-02   +4.920452224590498e-02   +1.190365654524172e-02   +1.890377182739834e-02   +5.135385372915001e-02   -1.016299613716364e-03   +3.495945566757176e-02; -4.837300621289089e-03   +5.628992576190572e-02   +4.676098576998118e-02   +2.684615603636061e-02   -5.351805572842740e-03   +7.729510017532196e-02   -1.959337870236579e-02   +2.600085293210641e-02   +8.445571195605110e-02   +4.835269951339440e-02   +1.199993584199923e-01   -5.336464295028804e-02   +6.072401250283553e-02   +3.345459020528486e-02   +5.931132761988461e-02   +7.909941399566387e-03; +2.172796111483827e-03   +3.799079887376573e-02   +2.913380000248508e-02   -7.833490323861743e-03   +6.802164874204077e-02   +3.642203722148545e-02   -1.705276252684458e-02   -1.488402087491827e-02   +1.312099759041518e-02   +8.692276484751059e-02   +3.335929860390612e-02   -6.614831029204390e-02   +1.324220698499651e-01   -5.651761752208362e-02   +6.019891637501353e-02   -3.413420848802402e-02; +5.985329549620879e-02   +8.120341069886090e-03   -7.823969134607310e-02   +8.317147752961188e-02   +8.689446643892998e-03   +1.615304488097330e-03   -5.147679343996361e-02   +9.501165778813148e-02   +7.905116550381371e-02   +5.943717316153601e-02   +1.897522381368909e-02   +1.067595968574115e-01   +2.328798828674659e-02   +5.290159218805045e-02   +8.659764517785350e-02   +9.056885797902570e-02; +3.559082971636277e-02   +4.686500321802792e-02   +8.239841201679358e-02   +5.887584624064036e-02   +1.075930526504573e-01   +9.566960115348423e-02   +4.848114490054204e-03   -1.841192628418735e-02   +8.261459041141762e-02   +7.795592255721912e-02   +3.216214357781683e-02   +1.013887783331927e-02   -6.085096716508617e-02   +5.121580531151668e-02   +9.336427008801994e-02   +6.774735498002701e-02; +4.886493312797839e-02   +2.299299994800248e-02   +2.065109099692971e-02   -8.648406840588357e-02   +8.100770163647407e-02   +1.977512317548046e-02   +1.614338903257145e-02   +5.871835519719523e-02   -3.506912846470590e-02   +6.644711470359516e-02   +4.100614559587172e-02   -1.541893208116982e-02   +6.846171601400756e-02   +3.901780142883760e-02   -3.105562548494745e-02   -7.270965108913339e-03];
L2E_L1E_iAMPA_netcon = [-5.916524520587503e-02   +8.296084463454746e-03   +1.224066514452801e-01   +7.270397897271916e-02   +4.868699566225904e-02   +8.494004449296952e-02   +7.436823314535564e-02   +1.210173744974826e-01; +7.450145569241595e-02   -5.151537799962930e-03   +3.728186934271391e-02   +3.019434667320414e-02   +8.093967644613730e-02   -5.011169414467716e-02   +3.059548569301045e-02   -6.996530755793860e-02; +4.403707257111047e-02   +2.075074268146940e-02   +5.488753708155571e-03   +2.604172139877886e-02   +7.031194546466382e-02   +7.349302380291077e-02   -2.251406216085350e-02   +3.793635100799390e-02; -7.688692815312670e-02   -4.019152448338256e-02   -3.234276353806681e-03   +1.668360842092342e-02   -7.955744593178990e-02   +3.889238273597625e-04   +1.109131945453154e-02   +1.024989501211525e-01; +5.829563712735814e-03   +1.630285059244074e-02   -1.243721911396134e-02   +5.799389300418738e-02   +3.377890147635794e-02   +5.688844774649080e-02   +1.003829710800583e-01   -1.207351904095257e-02; +5.921134084867982e-02   +5.277346665319069e-02   +6.106519098971018e-02   +7.411450500128612e-03   +1.577928227650863e-01   +6.923012234568764e-02   +5.796317999129066e-03   +2.140765395961279e-02; +4.938409519868871e-02   +4.492786145266725e-02   -3.226780746553099e-02   +7.294770402928025e-02   +8.853239453680731e-02   +1.092373713985278e-01   +1.764905012002900e-02   +1.551801689551704e-02; +7.956995866227268e-02   +2.321455003343333e-02   +2.998960416359591e-02   +6.073795107926108e-02   +5.478772651991272e-02   -2.297664629824660e-02   -5.184390293019066e-02   +1.096542301968026e-01; -1.853715630904702e-03   +6.601768501700491e-03   -1.377852154096454e-02   +1.513137790612586e-01   +1.135020993795475e-01   +1.323887552813532e-02   -3.347839041857143e-03   +2.659390786308929e-03; -1.224838961010179e-02   +3.758644070618754e-02   +9.285711575160747e-03   +1.941387012059115e-02   +6.534616720397574e-03   -4.604454255572143e-02   -3.451153986813840e-02   +1.020820188756174e-01; +4.562729719078294e-02   -5.706790621044729e-02   +3.058907764539397e-03   -2.432819271819629e-03   +9.183790676575063e-02   -1.062185627476519e-01   -1.674688738501965e-03   +7.141187033592759e-02; +2.162274668653431e-02   -4.252759374313406e-02   +2.289219711962217e-02   +1.030302074070438e-01   +1.801795179799538e-03   +1.313746345480250e-02   +6.573994999989188e-02   +4.479183209393095e-02; -3.852060277792821e-02   +1.129544918481339e-02   +9.362726499267356e-02   +7.569392096220122e-02   +6.852517050112784e-02   +2.258878619820187e-02   -2.669973998578326e-02   +5.389337198899401e-02; +7.954167551887466e-02   -2.244301157895105e-02   +8.448293784603844e-02   +3.844696781070076e-02   +3.439494389331108e-02   +5.755150118609015e-02   +1.841120739858804e-02   -2.792411913582526e-02; +3.616372940076956e-02   +3.434175037486824e-02   +7.945727252967101e-02   +1.087029052696972e-01   -1.277855505329956e-02   +3.286626138454964e-02   +8.536124190814330e-02   +5.946344502340112e-02; +1.468921717016888e-01   +1.765318612714518e-01   +3.114939494966485e-02   +2.955483252172830e-02   +9.141757395822919e-02   +6.557426038451612e-02   -2.609492722499406e-03   +3.250807433947922e-02];
L1E_L2E_iAMPA_netcon = [+5.463682512906660e-02   +1.423584158155140e-02   -2.400906884903575e-02   -4.753854926424383e-03   +3.611063048811847e-02   +1.206854781158246e-02   -2.828141352592948e-02   +9.734655161157423e-02   +1.281664379249278e-01   +1.387468702253366e-04   +1.465448195391210e-01   +1.278278926913613e-03   +8.596262876874327e-03   +9.388881177237761e-03   +2.425267831507461e-02   -7.393573187086470e-03; +8.667686406637262e-02   +9.098589159556446e-02   +2.419920419441234e-02   -7.600883561726698e-04   -7.848057623855088e-02   +8.746526602813203e-03   +3.377958466273310e-02   -4.064806468466165e-02   +1.676647873446253e-02   +9.636823340379033e-03   -6.097318897510130e-02   -1.471177841451523e-02   -5.148806087195840e-02   +1.174532427051092e-02   -1.068585232172934e-02   +1.267007681148395e-04; +1.120177781296316e-01   +1.046721038796076e-01   +1.317680721523732e-01   -4.577219036609292e-02   +3.404254338149100e-02   -1.341579177351002e-02   -3.671798844384387e-02   +6.753995780786200e-02   +1.402554326900541e-02   -2.234625995004158e-02   +6.414678139621917e-02   +4.261633922528106e-02   -2.048928899960303e-02   +3.467728752597252e-03   +4.051002880153685e-02   +1.579060501556707e-01; -2.128968801020493e-02   +4.521857570024215e-02   +4.277014904913928e-02   +3.673397834605605e-03   +9.028454250987168e-02   +3.332497548113564e-02   +8.406776030503815e-02   +2.230637619213185e-02   +5.576224573952451e-02   +1.846717689805903e-02   +1.082066539504710e-01   -1.932789581893493e-02   +3.377859170166995e-02   +6.646743542239159e-02   +3.164181927018475e-02   -1.704421367056684e-02; -6.079072715058632e-02   -3.985779231864684e-02   +8.049296066398616e-02   +4.642284425899568e-02   -8.459090273343906e-03   +6.073669761870158e-02   +5.600031868593812e-03   +3.864982963214678e-02   +4.202940893752411e-02   +4.905832782418985e-02   +3.571489470040871e-02   +6.886184125109082e-02   +3.666505492814703e-02   +1.445473181975609e-01   -6.625135444629519e-02   +9.345492168313452e-02; +4.704097082912342e-02   +4.707296535387970e-02   +1.812990908705664e-03   +4.251597282246876e-02   +4.396106827051877e-02   -1.353513024377440e-02   +5.797793292868419e-02   -4.201835897367254e-02   +4.703197856738497e-02   +2.738417849424639e-02   +5.598422237323443e-02   +3.023227451190471e-02   -1.447943506331473e-02   +8.239343928334944e-02   -2.540971372093490e-02   -1.648154877869226e-02; +9.357062085850440e-02   +1.151401120866635e-01   +1.911859280255414e-02   -1.094716858372343e-03   +1.162987662617598e-01   +6.832623137339965e-02   +7.000281513342377e-02   +2.618354887008092e-02   -3.594083316091258e-02   +4.275810144915271e-02   -5.557062338410927e-02   +1.046766034497210e-02   +3.943279464429381e-02   +5.012712857984981e-02   +6.851265036394216e-02   +3.454612142424975e-02; +2.590467499780529e-02   -7.432223091563987e-02   +1.459106220006559e-02   +9.807299350877070e-02   +2.715183617607416e-02   -6.473355934040484e-02   -6.997037213143991e-03   +6.087170134738441e-02   +4.951082800474145e-02   +6.611153665430346e-02   -3.755616123691532e-02   +2.814335739160123e-02   -3.940628171715195e-02   +1.001069858259503e-01   -8.673850392242333e-02   +4.899261659482191e-03];
L2I_L2E_iAMPA_netcon = [+1.043823534442878e-02   +6.460668488322452e-02   +3.730435087456166e-02   +2.443433971136004e-02   +1.698087306380170e-03   -3.394984706848746e-02   -7.122931511843869e-02   -4.365080431998814e-02; -6.523859727378296e-04   +8.803051393249320e-02   +1.060674296167421e-02   +1.127554312515888e-01   +2.429651985030657e-02   -2.850036851811916e-03   +2.885274359100663e-02   +3.169277870585681e-02; +8.622353565326364e-02   -3.885309703585177e-02   +6.549356251949374e-02   -1.457589828440434e-03   +6.764580807987032e-03   +5.103336393173760e-02   -3.389615691341079e-02   +1.052354591151018e-01; +7.464987225800797e-02   -3.830064422165548e-02   +6.468777122632341e-02   -2.357120275919727e-02   +1.145118908460235e-02   +2.720958278241288e-02   +3.107964872641107e-02   +7.708894610148165e-02; +1.291962706671976e-01   +4.444984211911837e-02   +9.623012121155725e-03   +7.537189662298834e-02   +3.591249253106120e-02   +1.375428368491239e-01   +2.759888396425804e-02   +6.326300300594716e-02; +4.801125409472145e-02   +5.057504846013264e-02   -1.203269900119984e-02   +7.038184794935305e-02   -3.732373373560063e-02   -1.944019142791630e-02   -7.490277028349479e-03   +3.282409788617385e-02; -2.346140289371067e-02   +4.731441720771870e-02   +2.222662221151996e-02   +5.855882285333302e-03   +1.314636380603222e-01   -2.167316217051555e-02   +8.004688162399279e-02   +1.080827311896350e-01; -2.778519404738768e-02   +3.409145907588449e-02   -5.613888026361868e-02   +1.017021513288631e-02   +9.347757794727611e-02   +5.988706035546495e-02   +7.208896981265503e-02   +7.180830065558264e-02];
L2E_L2I_iGABA_netcon = [+7.579126393000270e-02   -2.489454837170945e-02   +4.796877828877341e-02   +1.260306047519814e-01   +3.718051947088351e-02   +2.790651826380128e-02   +7.144609888571665e-02   +2.326468358077214e-02; -2.311954557212327e-02   +9.645303484793106e-03   +9.741410993225433e-02   +2.333326179847075e-02   +2.807456406482917e-02   -9.519877850388424e-03   +5.421378715201574e-02   +7.196332726750482e-02; +5.139492782633438e-02   -3.498832851359027e-03   +5.647447115968355e-03   +4.604748905031800e-03   -5.264496438357972e-04   +6.647018536377669e-02   +2.362006881292074e-02   -2.702368154169592e-02; +3.538363830962692e-02   +6.682672367448526e-02   -6.045709011221033e-02   -4.616621058456953e-02   +2.021285918229677e-02   +8.252920791925455e-02   +1.315203087992778e-01   -5.632357429399564e-02; +7.557031695811324e-02   -3.482427693754118e-05   +5.192919564436118e-02   -2.925594352760254e-02   -3.685639866234685e-02   +4.405491717524337e-02   +3.380714735389410e-02   +3.421983547039793e-02; +4.667664590323264e-02   -1.675815997969097e-02   +1.241212824148830e-02   +3.715603501625100e-02   +5.857064325680576e-02   -3.525135927676887e-02   +2.883868094427002e-02   +7.386810328190299e-02; +2.461488552651852e-02   +7.617665698074823e-03   +6.393844035253177e-02   +5.564582608967293e-03   +1.227196503061207e-01   -8.064129261759836e-03   -6.307982760819962e-02   -2.232248480080113e-02; +2.959307116900293e-02   +6.158022182696770e-02   +8.896607234236362e-02   +4.941089248512125e-02   +4.037720200652397e-02   +6.408887214330927e-02   +9.130039553083406e-02   +5.774611208524868e-02];
L3E_L2E_iAMPA_netcon = [+2.943334287182984e-02   -4.743847061227478e-02   +8.647977325318451e-02   -3.800891821726472e-03   +1.122046156567813e-01   +9.414077905031644e-02   +2.322149675206134e-02   +7.835328731796379e-02   +2.134385496349468e-02   +7.071196733325372e-02   +1.387572789011123e-01   +1.268579579791172e-01; +4.292889174922675e-02   +1.723308151820092e-02   +6.711463034886025e-03   +8.886054966941595e-02   -2.021977423080354e-02   -2.916287919044119e-03   +1.075716600289139e-01   +2.910201786752132e-02   -1.265642754110420e-02   +6.572608113192238e-02   -1.745602809762688e-02   +2.947620078376065e-02; +8.398535470589706e-02   +4.607407551346440e-02   +5.685479544776353e-02   +1.204324668522434e-01   +7.185354677063588e-02   -2.069121883823279e-02   +1.016076218426906e-01   +6.893484342061711e-02   +7.587787825241703e-02   +4.277650120453436e-02   +6.920024252286136e-02   +8.004006347732047e-03; -5.017598093965334e-04   -3.054461110185296e-02   -3.934552418194752e-02   +4.989807602507933e-02   +1.296604699977550e-02   -4.939238147914266e-02   +2.447831981639961e-02   +4.433471344788478e-02   +2.336256506006451e-02   -4.602446532919137e-02   -2.141295693250240e-02   +8.012880162535904e-02; +9.686795551574315e-02   -1.797295729902472e-03   +6.469907005715977e-02   +1.194775992499205e-02   -1.197048143156625e-03   -3.144450739630351e-02   +9.933206115394884e-02   -5.111032509199797e-02   -2.991440398850157e-02   -6.876332678378897e-03   +6.179225459809298e-02   +3.606047828169837e-02; -6.309979195178028e-02   +1.659728709789611e-02   +6.913317593910170e-02   -3.420820326436548e-03   -3.269844406967666e-02   +2.704165595569836e-02   +1.279655055690232e-02   +4.615185123537927e-02   +4.970528826612443e-02   -4.118675889190528e-02   +3.123634427647284e-02   +8.400231338377565e-02; +1.382813252884031e-01   +4.018796991729625e-02   +5.495279893247672e-02   +1.188444259479146e-01   -5.911940409797969e-02   +2.387534975607168e-02   +1.623655456771362e-01   -4.676667648928405e-02   -2.333663097607667e-03   +7.143816924484139e-02   +5.798743180118440e-02   -4.888938441794053e-03; +1.071127298866739e-01   +7.515868486174489e-02   +1.283464517840679e-01   +5.834700645530777e-02   +2.135493697259201e-02   +5.088586529752425e-03   +1.132958600671366e-01   -3.454483017774333e-02   -2.971129338183191e-02   +4.805566424225663e-02   +4.014643854358832e-02   +2.693723837396756e-02];
L3I_L2I_iGABA_netcon = [-9.155318622729298e-03   +2.014027634774150e-02   +6.149987876255508e-03   +7.477702296076930e-03   +4.017631025348614e-02   +8.651509528191603e-02   +1.123007578613604e-01   +1.039996101405642e-01   +2.072434041884082e-02   +1.463565075234692e-02   +1.146228888221759e-01   +5.158272427401939e-02; +2.511022933438344e-02   +9.125179634249274e-02   +1.140071415460110e-01   +1.244385126411372e-01   -1.824579547823935e-02   +8.434443992880589e-02   +1.106010663953925e-01   +1.015524550531978e-01   +2.563710628913862e-02   +8.807014852148906e-02   +5.259496951652852e-02   +8.099682174992201e-02; +2.728165640057562e-02   +4.429486907383351e-02   +9.467898561815376e-02   +1.222104097529449e-02   +6.499012570951690e-02   -1.682676125942598e-02   +4.955177012625548e-03   -7.435119533224879e-02   +1.025285248837320e-01   -5.260383797670923e-02   +3.173378312325953e-02   +4.853748405327768e-02; +2.830126714624621e-02   +7.861202785609953e-03   +6.570874721866317e-02   +3.339717251692401e-02   +1.328283747331437e-01   -4.045630148287122e-02   -7.346610563524729e-02   -2.456826369756000e-02   +8.871272084516187e-02   +1.298660461718737e-01   +5.634336242436452e-02   +1.514668965931466e-02; +7.424278722710027e-02   +2.344437024134579e-03   +8.666482119019583e-02   -5.009857536317627e-02   +1.136954407566779e-02   +1.284821422143504e-02   -4.961850832002236e-02   +3.854638997899980e-02   -5.203927858424411e-02   +3.029690344369746e-02   +5.634771387151782e-02   -4.069095557968017e-02; +6.510243514459942e-03   +5.590823553657857e-02   +4.870226041364685e-02   -4.236138646476865e-04   +2.573200560238254e-02   -1.646582686264953e-02   +1.184520003383841e-01   +3.441954234226795e-02   +6.564509735885678e-03   -7.777925483183337e-02   +7.853830489667585e-03   -6.909436804269915e-03; +9.550829710863008e-02   +5.023586929407618e-02   +6.352876497860442e-02   +3.496735830510579e-02   +6.276169417168125e-02   +1.160843664316451e-01   -2.759312505738499e-02   +3.847160622094822e-02   +1.203578027538235e-01   +7.233179883059200e-02   +3.144931288637621e-02   -8.620696954152495e-03; +5.883301517792171e-02   +1.125347579129440e-01   +5.319745745853752e-02   +3.544967751084623e-02   -2.794822017891075e-02   +3.186939975819895e-02   -3.184517187062628e-02   +5.448212644221042e-02   +3.418856177491013e-02   +3.180771874050131e-02   +7.907926333646410e-02   +4.018093756882957e-02];
L2E_L3E_iAMPA_netcon = [+7.518293903227510e-02   +7.902986222567916e-02   +6.005965417481320e-02   -4.825973718995798e-03   -2.760342313213107e-02   +7.674845121557403e-02   +9.396146443561240e-02   +1.276312443167059e-01; +4.918850269233178e-02   +6.134527170888316e-02   +1.016036107944255e-01   -3.515370493366930e-02   -1.069954043260829e-02   +6.415009317846147e-02   +5.821346923078502e-02   +4.352450353061807e-02; -6.425360340147661e-02   -7.169303880813322e-03   -8.948336842900910e-02   +3.492115113159267e-02   +1.063014479610765e-01   +3.361363448663349e-02   +6.961547373480917e-02   +1.008405987946937e-01; +4.850094251452554e-02   -3.904235572617882e-03   +4.347088984116516e-03   -4.051633410547845e-02   +7.154584807890838e-02   +8.342944202552608e-03   +3.690660041953033e-02   +1.730790146341667e-02; +2.076830315354882e-02   +4.552117040146508e-02   -2.786749428547589e-04   +7.051569009800192e-02   -1.519414605799130e-02   +2.435473322955954e-02   -3.217552675284698e-02   +4.869115276847866e-02; +2.085512155342406e-02   -1.881167265909778e-02   +1.118416459673796e-01   +4.613992649938654e-02   +2.075898877568497e-03   +6.285615972981019e-02   +4.881786667200785e-02   +8.724116111307539e-02; -2.404066107456940e-02   -1.521473137891396e-02   +5.002210340856018e-02   +8.976651021871025e-02   -8.314690070929699e-03   -3.829227418814264e-03   +6.308873252189187e-02   +3.965782241295086e-02; +6.497775892319987e-02   -1.313503458238200e-02   +7.251194885582142e-02   +7.067513168765927e-02   -4.331782984094868e-02   +7.597247441518597e-02   +1.641381494407495e-02   -1.478785987500296e-02; +2.969477215468363e-02   +2.228377299363996e-02   +5.302161015293206e-02   +7.582302386872707e-02   +4.111021599747804e-02   +6.613276295902517e-03   -1.579887417845032e-02   +3.732491342989796e-02; +1.698028319350359e-02   +5.787025433827944e-02   -5.088578915883694e-02   +4.618895992196505e-02   +6.586765027489838e-02   +4.273498772415811e-02   +1.294614564166211e-01   -5.698492282139443e-03; +7.991556347475255e-02   -1.720154279355689e-03   +5.573501969272852e-02   +8.148625754825815e-02   +5.463184460883289e-02   +8.407016370711382e-02   +2.228541841166713e-02   +1.333050552497303e-01; +2.653959112546130e-02   +6.477783882730453e-02   -5.569145500748447e-03   +5.467925734947189e-02   +4.907381317012846e-02   -1.561675288294437e-02   +2.223428789412049e-02   +8.702220011020334e-02];
L2I_L3I_iGABA_netcon = [+7.380944614442361e-02   +7.177843356845745e-02   +1.438480269270466e-02   -8.261580172234370e-03   +1.476174066637195e-01   +1.431258243619714e-01   +7.918213917864264e-02   +5.091540309823370e-02; +6.831608406559282e-03   +7.534808685734198e-02   +6.565592831351869e-02   +4.906013427583972e-02   +1.247753327962089e-02   +1.701403480423355e-02   +8.741921972327733e-02   +6.810681119258850e-02; +1.050131035252319e-01   -1.983480496014589e-02   -4.970359856681605e-03   +3.276509203487249e-02   +1.774505759514174e-02   +4.657140939494987e-02   +5.403597897597957e-02   +1.357993192072123e-01; +9.211334574498913e-02   -6.483501363282834e-02   +1.996826518477492e-02   -1.269110703811939e-02   -1.474887653367206e-02   -1.842642376724379e-02   -1.712033021426859e-02   +2.151141799024944e-02; -9.751495876947326e-03   +4.900489205438802e-02   -2.617719971327618e-03   -5.873135679269569e-02   +1.086885581201199e-02   +2.031316277487049e-03   +2.224170984659974e-02   +3.233816496499961e-02; -4.548327632778511e-02   +2.435879161564834e-02   +5.638119679046432e-02   +1.123260731387538e-01   -2.321382878922837e-02   +3.279216968322757e-02   -7.825546088873005e-03   -1.246078851760322e-01; +1.133002028318997e-02   +4.463166773159832e-02   +1.127606962905362e-01   +5.763788143423385e-02   +4.383870801239284e-02   +3.311765704870424e-02   +1.954072492101339e-03   -5.176564125149788e-02; +2.877210260916269e-02   +3.710178412402454e-03   +5.912404839122867e-02   +8.520883286492477e-02   -5.698666193240247e-02   +7.460709948023753e-02   +4.810956031196820e-02   +8.653106550413149e-02; +2.702355276860332e-02   -7.756932470969591e-03   +3.725763264580031e-02   +1.622920226129068e-01   -2.168880661625589e-02   +8.986088892578126e-03   +9.243913597739992e-02   +3.449733539101327e-02; +4.193618900967909e-02   +1.242644996442665e-01   -2.908469981696999e-02   +1.043616483617812e-01   +7.799847089377142e-02   +2.091431025661199e-02   +4.895459470638489e-02   +1.647236352760168e-02; +9.607331282388476e-02   -5.378263362437368e-04   +1.263695361577070e-02   +6.861263543156756e-02   +1.119783921498476e-02   +1.361571872719341e-01   +1.627137616521705e-02   +1.073358425227860e-01; +6.098162380483627e-02   +2.540691704035919e-02   +7.443961833815262e-03   +4.218809550471200e-02   +5.723515677164403e-03   +3.495853989576023e-02   +3.264756459990863e-02   +5.948921201376085e-02];
L3I_L3E_iAMPA_netcon = [+3.976240428675074e-02   +1.633385805643458e-02   +1.901529866900422e-02   +1.421086876768365e-01   +6.911890797014485e-02   -3.273682965337514e-02   +8.253251947252499e-02   -1.574910973536068e-02   +5.658002719883400e-02   -1.999582843703338e-02   +3.317877635936688e-02   +3.634448142706866e-02; +9.352753191723587e-02   +3.883999091034508e-02   +3.834404375025512e-02   +3.538782741913895e-02   +3.439101033654001e-03   +9.137390219206512e-02   +4.946059951806740e-02   +1.124019260555259e-01   +6.743233891362743e-02   +8.949783841680885e-02   +1.359112659868122e-01   +1.363850739625353e-01; -7.718802770435641e-03   +5.778442843850060e-02   +4.703950186089263e-02   +5.211229655379700e-02   +4.319437893465176e-02   +5.478906163836604e-02   +8.472050955782334e-03   +4.464653547786511e-02   +6.669141731676942e-02   +3.577917657887356e-02   +7.224644864524336e-02   +2.723051456158831e-02; +4.680577171424331e-02   +4.216747566185147e-02   +1.102244790305722e-01   +9.303834445926688e-02   -3.540993057311289e-02   +2.618376700354669e-03   -2.162709736418651e-02   +2.658630428069399e-02   +6.159884356509014e-02   +2.329011866595881e-02   +8.817777797966558e-02   -3.728892330904464e-02; +3.625120090839608e-02   +2.514794909069053e-02   -4.252155288831879e-02   +7.180369405190977e-02   -1.545199929504520e-02   +5.214962329439625e-03   +1.081625021279087e-01   +1.053115601678020e-02   -6.485342404989720e-02   +8.587500802475251e-02   +5.928408044849658e-02   +9.180248618948543e-02; +7.339468061384731e-02   +2.517067096222455e-02   +2.182989648859826e-02   +6.065072581668701e-03   +6.462012485371925e-02   +9.617083373730891e-02   -9.372679694289942e-03   +1.869936066208363e-02   +4.092329230953391e-02   +9.366999906247238e-04   +3.437333381055407e-02   +1.119860886272915e-01; +2.839144798238914e-02   +7.387084310532284e-02   +6.218659154665704e-02   +8.666467762686368e-02   +3.140397551534037e-02   +8.001429524254269e-02   +4.535895716453772e-02   +6.989637185190177e-02   +1.144035819967336e-01   +8.948729033709361e-02   -3.205953273416932e-02   +6.435062207052790e-02; +3.394433843912865e-02   +1.017504257477977e-01   +2.832670938308930e-02   +1.456099795002110e-02   +5.828994694673427e-02   +5.401766277345505e-03   +1.494838249667242e-02   -6.876665750067362e-03   +6.203770111017055e-02   +5.211890997716614e-03   +5.676678606044540e-02   +6.172458950604210e-02; +7.395761476502564e-03   +8.344989811125283e-02   -4.277770154571194e-02   +7.154095738315480e-02   -1.569052664400093e-02   +1.048226512175611e-02   +2.681940089589357e-02   +2.444192901786203e-03   +7.559081532656187e-02   +6.933665358027442e-02   -2.032070538351574e-02   +5.889046685472115e-03; +8.736656633734439e-03   +1.033275123041786e-02   -1.191248794867720e-02   -5.079312809943842e-02   +4.655914114870591e-02   +1.138754562890694e-01   +1.181368304606713e-01   -7.367522749971343e-02   +1.126042013485480e-01   +8.949574340536104e-02   -1.459517034026767e-02   +3.948153676638884e-02; +6.476264129934531e-02   +1.426939504547427e-02   +1.132004943195857e-01   -4.151241946816255e-02   +6.910475550942571e-02   +3.926624096857627e-02   +7.833893840182755e-02   -5.773538381463795e-03   -6.670335372635422e-03   +6.743018704164452e-03   +4.239322546778822e-02   -3.944864067327207e-02; +5.886255906473935e-02   -5.720958841182221e-02   +7.753750333480570e-02   +6.480485364438636e-02   +1.089755796113123e-01   +7.351414263619828e-02   -1.319006006851555e-02   +1.206054416099065e-01   -4.065489600757197e-02   +2.255408399709692e-02   -5.921189518211355e-02   -3.016191645366031e-02];
L3E_L3I_iGABA_netcon = [+1.708109061408487e-03   +7.311129340655262e-03   +3.163704257733182e-03   +3.998699448800274e-02   +6.800326572000848e-02   +7.970370261536756e-02   +3.444798852190188e-02   +6.206735263784535e-02   +1.251102163166915e-01   +6.486955914468094e-02   +6.612121062607407e-02   +2.991869324230194e-02; +7.762300412364279e-02   +8.725850368369421e-02   +7.330320890195000e-02   +3.659351886795934e-02   +6.564369534430449e-02   +1.611613362408522e-01   -8.056483449965207e-02   +1.247889029188922e-01   +7.025442362046738e-02   +3.526430952356458e-02   +1.028596071228564e-02   +6.973131740750459e-02; +1.461278151379578e-02   +4.785856221385957e-02   +1.649989707043398e-02   -2.388266076050058e-02   +9.104899634202429e-02   +1.970238529008714e-02   -4.463602945035712e-03   +2.316445818246099e-02   +6.446851410039664e-02   +1.770584209112689e-02   +8.607199720387021e-02   +3.921079916811010e-03; +1.155114006388337e-02   -1.268819714326071e-02   +5.486920035544404e-02   +1.032734110045120e-01   +1.284911613714843e-01   -8.258082478518173e-03   +4.637678689051208e-03   +7.218755827935638e-02   -4.915134974282951e-03   +1.300521878831477e-01   -3.888201542975266e-02   +4.412204663258812e-02; +5.526480251878817e-02   +1.148703591725602e-01   +7.671057167705268e-02   +4.844251988046774e-02   +8.390600695849046e-02   +3.061312757055720e-02   +7.180668398754009e-02   -1.039745887161824e-02   +6.445433876462344e-03   +1.227668449496665e-02   -1.951641570349352e-02   +3.688009288374451e-02; +7.873132068453428e-02   +1.229252104563342e-01   +5.897547514290392e-02   +1.746171974622858e-02   +1.032594622707396e-01   +1.556831690829011e-02   -1.096427514383291e-02   -3.929576203846805e-02   +8.679416510570065e-02   +1.096586174086886e-03   +3.452604682370927e-02   +6.245947110380388e-02; +3.455691241939774e-02   +2.717312525039831e-03   -6.851997637254120e-03   -5.608806558728040e-03   -5.540180791447202e-03   +5.132238852148802e-02   +2.946633888769650e-02   +7.601631723155156e-02   +8.800753459858084e-02   +2.327813813732933e-03   +5.052802515054580e-02   -3.090536357042840e-02; -1.276162939038589e-02   +5.288729794045637e-02   +7.891047491182061e-02   +6.286474112519592e-02   -3.107712460575574e-02   -7.626222635151140e-03   -1.408893741441091e-02   +1.102358784488277e-01   +1.019508517990510e-02   +1.046565382551826e-02   +1.439991359880188e-02   +3.585779335470746e-02; +2.004475031788874e-02   +6.355620801323801e-02   +6.022969152163421e-02   -4.197889309572610e-02   -8.386025189393315e-03   +5.577966290711410e-02   +3.434448196818149e-02   +9.023858527218931e-03   -1.635166843822282e-02   +6.570092962096133e-02   +4.368437304738632e-02   +5.700345054021212e-02; +2.807757678462008e-02   +6.073810597501017e-02   +2.812461480914104e-02   +7.435788949268858e-02   +7.867300337273084e-02   +1.125001121806854e-02   +6.211185784825862e-02   +3.060748486252683e-02   +1.372375387177117e-03   -2.305361926392095e-02   +6.064990218753008e-02   +4.377568123986572e-02; +6.933101889400649e-02   +1.612128278603977e-02   +6.766357953636656e-03   +2.011687013283351e-02   +4.189809645777726e-02   +1.509256786473178e-02   +4.291531731846171e-02   +6.315691877417048e-02   +1.079828161948361e-01   +5.946279657481737e-02   -3.401442764742315e-02   -2.040904890304432e-02; -3.140642552799573e-03   +1.442325001062955e-02   +1.206315844917699e-02   +6.514424525397365e-02   +2.793269133834974e-02   -7.894485267754096e-04   +4.107866311502352e-02   +4.731497139970514e-02   +5.999039969009400e-02   +9.662285658944660e-02   +6.358127729149815e-02   +2.967064358828170e-03];
L2E_Input1_iAMPA_netcon = [+1.005206361573355e-01   -5.326690850397894e-02   +6.482888914985063e-02   +1.461747524056023e-01   +2.780383410868951e-02   +5.426147164659526e-02   +2.035691681380475e-02   +5.333866352893262e-02];
L2I_Input2_iAMPA_netcon = [+5.757594768313679e-02   +1.258526734793998e-03   +2.141303317763028e-02   -3.721616039550879e-02   +1.562897525306403e-03   +7.732144173106748e-03   +4.538136130942798e-02   +2.164817983859299e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
