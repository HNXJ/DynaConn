function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.255145653262586e-01   -1.244194142837616e-01   +1.159931446990490e-01   +1.780764889521072e-02   -2.640227562958986e-01   -1.580993000416826e-01   +1.236579470968194e-01   +1.340097866359276e-01   +2.717977659981372e-01   -5.635602716521083e-02   -2.680560550496864e-01   +4.969417534724763e-01   -8.564109397398917e-02   +2.828959544203451e-02   -3.667896089925184e-02   -2.570906409528654e-01; +2.521859982647587e-01   -1.878017423919881e-01   +1.580719508493730e-01   -1.283570554833536e-01   +1.160926463627116e-01   -3.699624561933307e-02   +1.537718277035805e-01   -1.493214195309405e-01   -3.383690216818787e-02   -1.796868387578782e-01   +1.712117465883422e-01   +2.136218602895040e-01   -3.265576754934437e-01   -2.514244131249521e-02   -7.125080174084295e-02   -3.480421685944652e-01; -4.271945228786242e-01   -1.137945102812024e-01   +1.041429606962120e-01   +1.439035331027859e-01   +5.011973004584797e-01   -1.873734263228317e-01   +4.119498453257795e-02   +1.745038641683692e-01   -2.328505751219819e-01   +2.269150171922930e-01   -2.761965944311298e-01   +6.658507205747068e-02   +2.248330860158405e-01   -1.969541594382457e-01   +4.137160154204622e-01   -9.694148145505954e-02; -2.299885873508326e-01   +4.233894755937800e-01   -5.290842905384172e-02   +3.897265119896789e-01   +1.607994456632697e-01   +2.004365301884577e-02   +2.000735977557699e-01   +1.302367900551861e-01   +1.715607026655471e-01   +5.977879179197807e-01   -4.323293897645423e-01   +4.632621903455834e-03   +5.896010224998181e-02   +3.896215585901468e-01   -3.120299841913127e-01   -1.032686686540110e-01; -1.595134138339003e-01   +1.423861805938484e-01   +2.144512325034564e-01   +1.274362078064383e-01   +1.829861709432801e-01   +3.306606609390211e-01   +1.153117054056087e-01   +4.531864806536003e-01   -1.022477425027000e-01   +3.440831872000886e-02   +7.895412423746516e-02   -4.709718555709284e-02   -2.054327514204096e-01   -2.281346355305767e-01   -1.274137751341004e-01   -2.818163779467976e-01; +1.082368411469730e-01   +3.262181621186461e-02   -4.383944778774082e-01   +2.278480555186500e-01   -9.108934570487134e-02   -4.519225421835743e-02   -6.228652540516966e-03   +1.973522097621097e-01   +2.709065899110928e-02   -4.670658637636921e-01   +4.687434202738734e-02   -3.114334099831959e-01   -9.187473671753366e-02   -3.610288836761709e-01   -1.826674844215815e-01   -5.295740257653524e-02; +1.943210202460815e-01   +3.815542247262559e-01   -8.485553132065808e-02   +4.960627001114895e-03   +1.787883883439048e-01   +2.071364638493053e-02   -2.779000921655310e-01   -1.045428463754059e-02   -1.053062959930961e-01   +3.464666834858255e-01   +5.960158821514649e-02   +8.871832810473745e-02   -1.841289711538047e-01   -2.192172954408847e-01   -4.707879013423090e-02   +3.289365659231919e-01; -1.762455344230600e-01   +6.102066090553813e-02   -1.748895609493486e-01   -1.445788249635606e-01   -3.934144446785977e-01   -2.020256282423825e-01   +1.573634418510323e-01   +1.782831042342162e-01   -9.410949739865997e-03   +5.121618795390379e-02   -3.813480744240509e-01   +1.841495356248510e-02   +1.649208520556132e-01   -1.762912532202987e-01   -1.600235427349457e-01   -5.362872894504045e-01; +4.065627437060836e-02   +6.980584687661207e-02   +9.395148590594250e-02   -9.279767898247961e-02   +4.999774347005516e-02   +8.048303134092191e-02   -9.598371816731022e-02   +2.362463869025480e-01   -2.045927559933340e-01   +9.910816895265380e-02   -2.709241339320169e-01   -3.926023696035112e-01   -3.265287549052984e-02   -2.294774418654486e-01   -2.356451698217223e-01   -2.420321974467179e-01; -1.812626686821512e-01   +3.547527137026567e-01   -6.548862513131998e-02   +2.006924703711649e-01   +8.442834286186897e-03   +6.942613957262511e-02   +2.950669200434431e-01   -1.935249441225276e-01   -3.701698986890337e-01   -3.242540153443256e-02   +1.249315887229585e-01   -1.530316173682381e-01   +1.592147982863630e-01   +3.960050085733011e-02   +1.339076841079032e-01   +1.052594089411045e-01; +1.753440257583105e-02   +9.266574027215979e-03   +2.043670724286926e-01   +1.382541861236919e-02   -4.644587988268895e-02   +2.403324648851986e-01   +7.985614588595887e-02   -6.833344840115510e-02   -1.958149275609252e-01   -2.481646054388920e-01   +5.071147969955427e-03   +9.448749023815127e-02   -4.754793508245971e-01   +7.106095474818941e-04   -4.560100131904261e-01   -1.690315060693527e-01; +4.155406548440035e-01   +2.290012679110742e-01   -2.017927513556139e-01   +1.356376476308398e-01   -1.186661372400349e-01   +5.500501505925098e-02   -1.412133527264411e-01   -1.530395859678584e-01   -1.362283792189588e-01   +1.270641360954572e-01   -2.198436352189778e-01   +9.718063753325090e-02   -1.541713402582698e-01   -3.262294860721004e-01   -2.999530305716240e-01   +3.389745818898945e-01; +1.497508343139896e-01   +1.318394657391625e-01   +1.963110783908733e-01   +1.286329816799317e-01   +8.428688467165474e-02   +4.019250004730844e-02   -2.529367305417619e-01   +2.049791457759054e-01   +7.289952054056106e-02   -2.499205882623239e-01   +1.426080114702311e-01   +2.992050741674834e-01   +2.345722066032422e-01   +2.313563562548258e-01   -5.442039127912704e-02   -5.525858807581966e-02; -1.390099603276524e-01   +4.197859036741206e-03   -2.278044621055533e-01   +3.703709064883229e-01   +2.714543859196640e-01   -2.532906174201653e-01   -1.631698728612512e-01   +2.758462058916240e-01   -8.679204687847129e-02   +7.493481248272912e-02   +1.204645466170956e-01   +1.383047587242576e-01   -1.142541652416662e-01   -7.657852113745228e-03   +1.737868364178716e-01   -2.474799665564083e-01; -4.794258880805694e-02   -1.800247163805248e-01   -1.934708539411737e-01   -1.840988486893579e-01   +9.738509292264032e-02   -3.913363749010757e-01   -1.541591416899163e-01   +2.820886815229169e-01   -1.978786552735155e-01   +2.165183449177497e-01   -2.565692423785630e-01   +1.039277917466859e-01   -1.972024496853443e-01   -3.530958014114199e-01   +5.192827349518661e-03   -2.745023956836096e-01; -1.791510124794002e-01   -3.069550077012501e-02   -5.750584874332920e-01   -1.475632104134121e-01   +6.393794534492933e-02   -2.958408974022144e-01   +4.018041363129152e-01   +1.420671644834936e-01   -5.338220154952131e-02   -1.343729963811020e-01   -2.759651750876005e-02   +4.969386730625272e-02   -4.479906864872454e-02   -3.438373411764167e-01   +4.294500600862905e-02   +4.408005399801675e-02];
L1E_L1I_iGABA_netcon = [-2.076721847005894e-01   +4.749111371663182e-02   -4.205736670818963e-01   +3.216574903329106e-02   -3.128007527126316e-01   -3.282262313580082e-01   -5.256442855494554e-02   +3.559299602419234e-01   -3.877503576033443e-02   +4.294226327562313e-02   -3.915127620614092e-02   -3.675434235060843e-01   -1.863010187966230e-01   -1.729672803349728e-01   +2.486217690020179e-01   +3.595813482407169e-01; -2.005659312634865e-01   -1.466718340079934e-01   -5.785799426983924e-02   +4.695879037895941e-02   -8.898659284407216e-02   -7.375050201226087e-02   +1.173984536523815e-01   -5.113242717303557e-02   -7.747020204959154e-02   -2.327878393214999e-01   -1.099507327017036e-02   -4.538146222069764e-01   +3.949467376367302e-02   -2.121578698654745e-01   +9.826391074685467e-02   +9.526961044227608e-02; +8.874251383420655e-02   +2.245045347131703e-01   -2.165651120211532e-01   +1.469693214325611e-01   -1.712144265534812e-01   +2.769835168750502e-02   -1.473060748980636e-01   +3.179666576058154e-02   -1.371356195977641e-01   +1.614165822725491e-02   -3.513697146657547e-01   +3.030623177008128e-01   +2.047596859241405e-01   +9.981175355510727e-02   -4.326014515843201e-02   -1.729122243986896e-01; -1.115626520552849e-01   -3.371942552399785e-01   -1.419145753702430e-02   -5.393613070309474e-01   +6.563092259444690e-02   -3.587769905814578e-02   -4.256978892743850e-01   -2.494812477852838e-01   -1.224029925531963e-01   -3.530955423808970e-01   -4.130885834331048e-01   -9.551426910168442e-02   +8.362093916442645e-02   +8.558429038799191e-02   +1.233346401699474e-01   +1.076568169033550e-01; +2.109096228011881e-01   +7.141329909429486e-02   -1.696059291231019e-01   +3.027406822126032e-02   +2.668408221531518e-01   +3.348775358585716e-01   +2.247716645287486e-01   -2.687438551077345e-02   -2.026397641425371e-01   -1.236674332728611e-01   +1.769496172027965e-01   +2.036171632637639e-01   -2.406623697638645e-02   +1.993310417645375e-01   -1.101546234653307e-02   +1.046565366340027e-01; +1.379484016672339e-01   +3.713083219943875e-02   +1.330896030820950e-01   +1.253559865324264e-01   +3.655202425227811e-01   -1.175154626850648e-01   -4.552183834970551e-01   -1.629332492225569e-01   -1.984706760138858e-01   +1.049627389193819e-01   +2.622083874444282e-02   +7.368860481235610e-02   -7.343369564897315e-02   +4.920720161644878e-01   +6.485613320277061e-01   -8.542567824553962e-02; +4.854015420623398e-02   -3.650562377654670e-02   +1.566468670655578e-01   -4.910404800444369e-01   -3.436523449173820e-02   -1.060571001013537e-01   +2.051450289736663e-01   -1.332482273987382e-01   +3.235482182866199e-01   -1.336833177195407e-01   -1.422919723439331e-01   -1.489523308720728e-01   -2.494767438766769e-01   +1.478096654208898e-02   -4.133341203310509e-02   +2.509693020296666e-01; +4.657012339945048e-01   -2.794054516409062e-01   +1.629649148942778e-01   +4.780547712454727e-01   +2.798343290387700e-01   +3.382037871862441e-01   -5.793240738128988e-02   -1.479601711532293e-01   -2.713328405258041e-01   -5.971715960557736e-02   -1.483429972101321e-01   +4.842356882408785e-02   -1.640706043737076e-01   -1.938201554624693e-01   +8.297084539054059e-02   +1.303895047492296e-01; +2.975202735921216e-01   +6.291996421060757e-02   -4.689751516556609e-02   +1.430246828534633e-01   +2.633957030916394e-02   -3.341617741726774e-01   -4.192478999621637e-01   +3.149055445559791e-02   +2.179101359118169e-01   -3.035721967150607e-01   -1.727815523143345e-01   +1.320318827930244e-01   -2.227528225431314e-01   +1.941059016924310e-01   -2.122597791875558e-01   -9.257939273061763e-02; +1.227072575345926e-01   +4.755914333838704e-02   -1.802025385553766e-01   +2.551301622356347e-01   -4.637204851110158e-01   +2.004757891680661e-01   -3.985744329819145e-01   -1.921704790842776e-03   +3.758040034345009e-01   -1.700315486485316e-02   -3.777722083717789e-01   +2.411498650393396e-01   -9.518479223601256e-02   -1.856369108032640e-01   +1.617907161259691e-02   -1.699336875989526e-01; +2.656961901513807e-01   -4.266315766866264e-01   +1.003856138558276e-01   -9.451392374193068e-02   -3.750515745947191e-01   +3.020500892362168e-02   -1.255363948238073e-01   -1.592475356544623e-03   -1.644945054488288e-01   +4.804810491226010e-01   -3.557812301981226e-01   +1.611179404960048e-01   +6.767745087223707e-02   +8.164732001711787e-02   -2.546959203040766e-01   +2.224266694569792e-01; -2.876831476534203e-01   -3.711094841197593e-01   -1.817088636625284e-01   +3.189056924337759e-01   -2.714622278087002e-01   +6.710732667075472e-02   +1.267855647178239e-01   +3.100029473856189e-01   +9.875648106815071e-02   -2.599111808741745e-01   +2.698753883823053e-01   +2.307235212026934e-02   -2.582294720044997e-02   -1.504738229802232e-01   -1.654259536192046e-01   +3.791154515174990e-01; +2.138324184298968e-01   -2.200103909519842e-01   +6.724131320837436e-02   +2.377479806456395e-01   -1.192052003083162e-01   +1.378764639715835e-01   +5.882271454331678e-02   +5.020812261258503e-02   -7.246577969045517e-02   +8.875460638057388e-02   +3.676331993277758e-01   -7.477801929363814e-02   -1.532652704543455e-02   -1.725452429662305e-02   +6.620098837251298e-02   +3.398350146840168e-02; -5.449853241888417e-03   +3.855923154330944e-01   -2.883676644480236e-01   +1.331619692803114e-01   +3.680034999083534e-01   -3.495625172015747e-02   -3.671114375720026e-01   -1.116903640349115e-01   +5.188744817941092e-01   +9.098296985142847e-02   +1.768315477708871e-02   +1.814433025816345e-01   +2.532510018739862e-01   +2.494098048235374e-01   +4.434443598010301e-02   -2.259015517897099e-02; -1.753782366021653e-02   -3.725546507918379e-01   +4.023323139388119e-01   +1.793952226834437e-01   +1.932875442501897e-01   -2.694005570073290e-01   -9.226987371158155e-02   +1.393606746368004e-01   -1.417566341821688e-01   +3.171632654251105e-03   +1.305601821073246e-01   -8.500746555011833e-02   -1.321721505597964e-01   +1.782202240494326e-01   +2.121346224529996e-02   +8.351193243179961e-02; +1.000654011745639e-02   -7.121765845160517e-02   +1.660355077899533e-01   -1.985125018741848e-01   +3.044842498159049e-01   -3.412142964222007e-01   +2.718627045086244e-01   +5.330793362043915e-02   +5.618105730557336e-02   -3.948204028733985e-01   -8.721519282493871e-02   +1.583134095944420e-01   +1.143968413956615e-01   +2.205785824234598e-01   -1.782399294057436e-01   -3.445570468304864e-01];
L2I_L1I_iGABA_netcon = [-3.661531174456867e-01   -1.240901481439283e-02   +1.414012252567455e-01   -7.010398587128724e-02   +4.527007406222722e-04   +1.970781625027256e-01   -2.776990632052047e-01   +4.280436186596581e-02; +4.134583011853432e-01   +5.131398856758035e-02   -2.936339303143755e-01   -1.558288707188602e-01   -5.529430498200977e-02   -7.234375892688880e-02   +2.415177827398303e-01   -3.283860997221493e-01; -1.090570630125963e-01   -1.248137808697659e-01   -1.000765466272318e-01   -1.975737603158390e-02   +3.072045485543327e-01   +2.707420755902415e-01   +7.238911193053627e-02   -2.657265877331124e-01; -3.240519566983117e-01   +2.808557671843214e-02   -8.582334611897119e-02   +3.602890681418990e-01   -9.364610810148706e-02   +1.678172815815989e-01   +1.140490859773704e-01   +1.020666530808003e-01; +2.541789695363045e-01   -1.756210589611577e-01   +1.437392623167697e-01   -2.439928982647018e-01   +2.864502469278015e-01   -8.099225921940195e-02   +3.829209387824654e-02   -1.724660512085179e-01; -1.620319513617982e-01   +3.300326781168035e-01   -6.323124963480242e-02   -2.815549983245364e-01   +1.689975269231649e-01   -1.445270981723413e-02   -3.888627232242562e-01   -9.957385559509349e-02; -2.424593669896392e-01   -2.039459188643215e-01   +3.895260209697141e-02   +2.621105673968727e-01   -3.209596474096311e-01   -7.270021889173903e-03   +6.554651460532981e-02   +9.196049588129858e-02; -1.248624241253025e-02   -1.447931393350596e-02   -1.451462636532071e-01   -9.124628694353325e-02   -1.880060499660839e-01   +1.864617204056568e-01   -1.537319415359555e-01   -3.152557722215388e-03; -3.257264816816530e-01   +1.827808738020760e-01   -2.199347977497931e-01   +1.313612358379981e-01   +1.310448144728202e-01   -2.166459003562879e-01   +1.281013609443018e-01   +2.417546037107712e-02; -4.158708897638470e-01   +2.562534987701457e-01   -1.582279643170647e-01   +6.733730082836408e-03   +3.696530890462640e-01   -3.184421704472585e-01   +1.674739732339164e-01   -5.031032601498736e-01; +1.155249633928751e-01   -2.995826926564348e-01   -5.052561910852463e-02   +3.207881897294512e-01   +2.314155453226696e-01   +2.714040598854032e-01   -4.417373488779269e-03   +2.283550539063433e-01; -3.051610912188529e-01   -7.274535191882384e-02   +1.027799656430952e-01   +3.221932695782022e-01   +4.654536719966541e-02   -2.177700146024134e-02   +7.093779660647170e-02   +1.759405790677505e-01; +1.413921197307043e-01   +1.443987935234726e-01   -2.273297309488518e-01   +3.045299711316285e-01   +2.779731600296168e-01   -1.655296234055282e-01   -4.964970077196148e-01   +3.757743984273464e-02; -2.072007715502234e-01   -2.386587042051357e-01   +3.199353241712031e-01   +1.457201253634028e-01   +2.887527291790345e-01   +3.792754301651794e-02   +3.077121407610210e-01   -2.175733557179825e-01; +1.816843256070000e-01   -1.718452903974929e-02   -1.411454807339788e-02   -7.074242515324138e-02   +2.610986353279438e-01   +1.481942421142936e-01   +5.042833939849747e-02   +1.318142833978818e-01; +5.657176017636426e-02   -2.082444035640574e-01   +3.341921111413826e-01   +2.146425679748411e-02   -1.028630267965267e-01   +6.508507925470819e-02   -9.652732691909899e-02   +8.104313004474650e-02];
L1I_L2I_iGABA_netcon = [+1.776862228486178e-02   -2.542300751285765e-01   -2.425039800351539e-01   -3.598518470962860e-02   +9.437121886374994e-03   +1.462473205498674e-01   +2.999974871128900e-01   -1.503988488082647e-01   +1.135061044473532e-01   -3.196255446866412e-03   -1.756283560985527e-01   -4.687128347130032e-02   +2.272762427567045e-01   -3.886383859287284e-02   +2.876184947746146e-01   -3.530821177356972e-01; -4.553974353107633e-01   +3.425248320729038e-01   +4.392327571343053e-02   +1.527159768016049e-01   -1.843450001810444e-01   -2.974814878482313e-01   -5.870216332960024e-02   +1.243201603701703e-01   +2.620868739602155e-01   -2.097172499672890e-01   -3.167226795378059e-01   +5.023001513852290e-01   -3.223299663916399e-01   +2.308114619273734e-01   +4.537849964292682e-02   -1.821253731701000e-01; -1.413044141832242e-01   -1.211608887088232e-01   +4.337622704262316e-01   +2.121200062426046e-01   -1.015955681973203e-01   -1.862123562696997e-01   -3.429919181996924e-02   +1.631242922214844e-01   -2.735159552018285e-01   -3.174257433209110e-01   +3.884675340123632e-01   +7.572628463587622e-02   +6.107313907854496e-02   -6.887982561716494e-03   +2.080009071816766e-01   -7.856111156503318e-02; -5.309160556850669e-02   +7.546154720726435e-02   +1.525717060267610e-01   +2.822785970228647e-02   -1.608806227894946e-01   -5.394563327505737e-02   +2.360131061265560e-01   -3.370306193668873e-02   -9.422274626572383e-02   +2.782209018853319e-01   -8.704707947895597e-02   +3.109411566228460e-01   -2.527052083612276e-01   +1.373943424311390e-01   -1.590226630533910e-01   +4.065466790493029e-01; +4.166358388441129e-01   +1.060122425862993e-01   +3.440127341922338e-01   -3.315131926992795e-02   +1.958787830100040e-01   -7.100088673442322e-02   +4.077809350401307e-01   +2.053701896993047e-01   +5.593979644239204e-02   +1.503925949143737e-01   -2.481277400610779e-01   +1.155702339807519e-01   -8.726526584983504e-03   -5.226278918017669e-02   -1.988474818497476e-01   -3.130110296068172e-01; -2.722754462097706e-01   +2.867492873142513e-01   +4.676221091813014e-01   -2.478048735694500e-01   +2.467146833879960e-01   -3.694981492881332e-02   +3.013752515791396e-01   -3.326471890980199e-01   -3.016638497944531e-01   -5.448961419602557e-02   +8.584318614057536e-02   +6.923496982387740e-02   +2.157939591409606e-01   +2.664882425879721e-01   -3.037536415755686e-01   -1.291593784371501e-01; -3.226966515352470e-01   +2.037062007444062e-01   +1.004647538956668e-01   +1.165125779765939e-01   -5.023148457702063e-02   -3.994839907438608e-01   +2.208568028050871e-02   -2.688511918868757e-01   +1.386660496152668e-01   +1.133012012931356e-01   -1.255041472909790e-01   -4.624175982562337e-02   +2.038342327106249e-01   -4.723459560981647e-01   -1.823220684012588e-01   +1.641334994404890e-01; -3.894129179572535e-01   -3.086298109969013e-02   -1.829892511272044e-01   -4.715399462843883e-02   -1.327751647630920e-02   -3.643037394805047e-01   -6.248189696644955e-02   +9.461447515250326e-02   +1.037965975461783e-01   -2.157746252978773e-01   -1.830063032680256e-01   +5.309335396497424e-01   -2.642369979147742e-01   +1.367266649913438e-01   -5.237564387495469e-02   +5.751540990298925e-02];
L2E_L1E_iAMPA_netcon = [-4.923307734692488e-02   +4.041639169826830e-01   +2.377936999944814e-02   -1.083924699293948e-01   -2.920345116133010e-01   -3.619640815240482e-02   -2.548495757916998e-01   -3.968312978354587e-01; +2.287984985385984e-01   +3.360522279507241e-02   -3.217665192466713e-01   +2.281766036805976e-01   -1.517176798939013e-01   +1.832191256881321e-01   +8.570883798972959e-02   -9.555275440813432e-02; -5.112701311654707e-01   +4.066401270380446e-01   +2.419717937463784e-01   -6.664225971120921e-02   +1.303655999887635e-02   -2.039389953034839e-01   -2.603910829326547e-01   +3.011861468572656e-01; -4.088531422594024e-01   -1.237081992090452e-01   +1.066365266890561e-01   -4.538825183674798e-01   +2.460459077014834e-02   -1.771956384359678e-01   +3.180890142824133e-01   +1.998068469015107e-01; -1.626991410300281e-01   -2.921280251899346e-01   +2.756009986484271e-01   -6.732034952704305e-02   -1.220240100783081e-01   -1.843838425486589e-01   +4.290759130611092e-01   +8.070174268738611e-02; -6.445927985912143e-02   +4.472843963042016e-02   +1.522609651671294e-01   -9.235404772628956e-03   -1.800053851723181e-01   -4.575617960014015e-02   -5.241587156115168e-02   +2.478028529023265e-01; +2.345827003494884e-01   -1.123897098817444e-01   -1.856835144327940e-02   +7.885557391270880e-02   +1.593864051889687e-01   -4.081406674849308e-02   -1.295090698406292e-01   -2.577987372528974e-01; -1.005202289639197e-01   -2.062017117991181e-02   -1.339918410184369e-01   -6.499372502558051e-02   +3.467224298432989e-01   -6.152346766957838e-02   -5.870755694893670e-02   -4.567705042011624e-02; -7.687955199145784e-02   +1.887420035017786e-01   -4.299257725461619e-02   -8.985216079504890e-02   +2.018627896631665e-01   -1.006719100871181e-01   +3.998885043916692e-01   -3.331112580984354e-01; +2.686441610722490e-01   -3.401823602551890e-02   +1.395080329096188e-01   -1.931797085862766e-01   -2.086064223644011e-01   +9.398680252770185e-02   +3.231028940458283e-01   -3.080249741245290e-01; -7.088222680648094e-02   +2.261653129837752e-01   +1.539090502556890e-01   +5.244526584788323e-02   -1.558899003357992e-01   +1.797542164009412e-01   -2.038018580765920e-01   +2.455158554116783e-01; +5.439812065283997e-02   -4.425527138544731e-01   +5.710545987888520e-02   -4.142200112858829e-01   -4.089514987370083e-02   +1.610078324308881e-01   -4.032725492602711e-01   -1.021137502291906e-01; +7.485010889922056e-02   -1.096209950556906e-01   -1.353857514056833e-01   +3.801445661495957e-01   +3.160103797013364e-02   -3.274580872812527e-02   -3.539726991068372e-01   -5.472368170170112e-02; +6.140500093725211e-02   -1.256151296186185e-01   -5.000792541710299e-01   -2.854454950084285e-01   +1.320691801138718e-01   +8.154701251633042e-02   -1.634172643809238e-02   -6.233017191373624e-02; -1.302779547242198e-01   +5.117388271444610e-02   +1.587347094581704e-01   +1.339764751929479e-01   +3.285353785046446e-01   -3.781575093177881e-01   +1.349878404310246e-01   +2.195116735061872e-01; -1.569624922085438e-01   +1.180730888529775e-01   -6.723846174248549e-02   -3.459698550776926e-01   -2.456631954937397e-02   +2.608795638691104e-01   +1.297642708527871e-01   -4.918200382913911e-01];
L1E_L2E_iAMPA_netcon = [-8.524565175733564e-02   +1.250609237344397e-01   +4.959455606012382e-02   -1.916937196028140e-01   +1.162471827264112e-01   -2.457088409071557e-01   -9.820427477231219e-02   -1.375501155914276e-01   -5.317549194568088e-01   -2.010473524759251e-02   +1.089932483824755e-02   +2.990000463907446e-01   -3.108232021257010e-01   +1.839471632651855e-01   +2.104483488818248e-02   -7.718434253028293e-02; +9.228167190487631e-02   +3.274901503119341e-01   -2.946409849150469e-02   +2.331808832763176e-01   -1.173400362652642e-01   +2.063541292908716e-01   +6.168711486079105e-02   -5.932082965713945e-02   -4.094107143971254e-02   +5.334782316520135e-02   -2.848219220015135e-01   +1.273947639851545e-01   +1.067280407520967e-01   -4.834543831363367e-01   -1.947102850551982e-01   +1.336836174032989e-02; -1.153815966072289e-01   +1.710476613602011e-01   +2.805514524973375e-02   -3.666185333232421e-01   +2.590288424702984e-01   +3.362341434027501e-02   -3.890600509673354e-02   -9.575547185048239e-02   +1.659326382739000e-01   -3.081919757893450e-01   -1.966238109818363e-01   +1.190375419114249e-01   -5.002177259555826e-02   -3.056363605806805e-02   -7.332038682349683e-02   +1.421817135239329e-01; +9.506665612026143e-02   +8.489969819017151e-02   -9.662072712165333e-02   +1.855791957966629e-01   +5.258470960554683e-02   +7.894537452818318e-05   +4.924315248214337e-02   +2.410361560872233e-01   +3.736846178250447e-02   +3.524110647252429e-02   +3.459006356611489e-01   -2.679049824412582e-01   +9.260373458739360e-02   -7.989313872732658e-02   -1.041042608819100e-01   +1.481533937114644e-01; -6.590275271038151e-02   -3.648014431083633e-01   -2.175631245722104e-02   +7.725767663016508e-02   -2.669821590640055e-01   +1.060176434804144e-02   -7.107148991489044e-02   +9.137632586127946e-02   -1.896181697448248e-01   -1.068103597689721e-01   -2.266687259043234e-01   -6.728331426879512e-02   +8.544490651611497e-02   -4.545510504399616e-02   +5.821836724424558e-01   +1.283762328671979e-01; -5.496487388501160e-01   -4.073549890207806e-02   +2.178955979758023e-01   -2.145603075663249e-01   +2.953353035342895e-01   +2.088898195250363e-01   +1.698693397293481e-01   -1.094621073923077e-01   -8.623175032208115e-02   +1.539773047744062e-01   +2.045080480085716e-01   +3.895830749801604e-01   -2.430030071549190e-01   +3.510120413906697e-01   -1.185721054788040e-01   +1.267633719632156e-01; -1.526554084001638e-01   -3.095223989675064e-01   +3.937249338709458e-01   +1.454099834206453e-02   -3.320787068675304e-02   -1.579271799350826e-02   -2.579183174726679e-01   +9.198183257616577e-02   -1.462809742314947e-01   +1.988103761098519e-01   +2.255380522983724e-01   +1.595978572428157e-01   -3.450064370049262e-02   -2.234430226353302e-01   -2.211511841835320e-01   +7.068091924655755e-02; +5.885016000829843e-03   +3.013128848919255e-01   -8.420169997482117e-02   -1.358334048587686e-01   +4.582392031221003e-02   -1.941976754504724e-01   +2.272455625930735e-01   +2.185172747580120e-01   -4.629893605057055e-02   -1.510671792290554e-01   +5.628644876453298e-02   -1.198157666558704e-01   +4.077616885122673e-02   -2.029228063025270e-01   -3.234948943299177e-01   -9.797884121936047e-02];
L2I_L2E_iAMPA_netcon = [+3.457123592925652e-01   +2.054685720327025e-01   -5.452440508725296e-02   +3.520138986023610e-02   -8.622074248180256e-02   -3.305960519262385e-01   +1.466708643458477e-01   +9.167786687631535e-02; -2.505570339366494e-02   +9.361467343583851e-02   -3.982371786072446e-01   +1.815981700050701e-01   -5.183679692296220e-02   +4.989646898460409e-02   +8.525236436851256e-02   +1.183269986055458e-01; +7.542500477119959e-02   -2.181713486889258e-01   +1.341974340377945e-01   +4.850470630777762e-01   +2.701582555274992e-02   +1.903905837074180e-01   +1.379482998956656e-01   +4.567241360811708e-02; -7.240164228389731e-02   +4.322568174103299e-02   -1.675998804956584e-01   -5.326471695234331e-02   +7.905370213857222e-03   -1.309217540693320e-01   +8.654631329885084e-03   -1.638390526772039e-01; -2.489403327313073e-01   -1.876260021044719e-01   +1.866436863630737e-01   +1.143762945219259e-02   -3.023144450538937e-02   -2.206794548321320e-01   -1.526339125624355e-01   +1.807316520260288e-01; +2.397885706635644e-02   +2.182466677083949e-01   +5.064262737450758e-02   +3.298886239138199e-02   -3.747190750018317e-01   -2.223282993188043e-02   +1.942204884645702e-01   -8.154470486416708e-02; -3.252739220722770e-01   +2.672672600312037e-01   +2.370261290629638e-01   -5.904047742246742e-02   +3.035194646347703e-02   +5.207549725551718e-02   -1.655964825061794e-01   +8.343509223216966e-02; +1.205297457590795e-01   +7.122321534710560e-02   -1.277340417996873e-01   -2.821452538589365e-01   -3.880898111303870e-01   +1.105053128121876e-01   -8.392016710828962e-02   +3.392764544001425e-01];
L2E_L2I_iGABA_netcon = [+4.725121008406298e-02   -1.829202929584651e-01   -1.644381081706576e-01   +4.321721950911059e-03   +2.715668603941917e-01   -1.408558924550583e-01   -1.613126009624150e-02   -1.183470089296941e-01; -2.216853822646791e-01   +5.607841418258208e-02   -1.305735135439307e-01   +2.453804895913495e-01   +1.442871348283380e-01   -5.164071329383263e-03   +2.733882967265193e-02   +4.714812893892735e-01; -1.004293344707162e-01   -1.192037053012601e-04   +1.589058275418089e-01   -3.272457267669016e-01   -1.552635933152575e-01   +2.507773280238523e-02   -7.022287088217266e-02   +1.812257388962650e-01; -1.009794876280781e-01   -2.253769380559351e-01   -1.666429265211752e-01   -3.096547461171769e-01   -2.828565616259073e-01   +3.263966458953527e-01   +5.099593932849323e-01   +3.336763785086629e-01; +2.827380886125155e-01   -3.708381951899746e-01   -2.023152900567373e-02   -1.534743563738875e-01   +2.224090152773148e-01   -3.313110301951527e-01   +1.044072822137340e-01   +1.968490845608153e-01; +2.719731470606602e-01   -2.442697289235955e-01   +1.396223325085550e-01   -2.460780556237123e-01   +6.936948255228688e-02   +5.445962988569846e-01   +1.974330386404081e-01   -2.751103833973083e-01; +1.057452248281114e-01   +4.380600818389124e-01   -5.991844603930607e-02   +8.691665990074535e-02   +3.716363697763420e-02   +2.067329922593626e-01   -2.921990335080046e-01   +1.380303131874915e-01; -4.992613627313086e-02   -6.867323587140015e-02   +3.199264783867390e-01   -1.885868858678290e-01   +2.878061361269411e-01   -3.184255096726843e-01   +1.616053475440565e-02   +4.703544650615741e-01];
L3E_L2E_iAMPA_netcon = [+3.961163138227985e-02   -2.834921727709494e-01   +3.087110951784289e-01   +2.397920182920973e-02   +2.797104702821694e-01   -1.009219109948863e-01   +1.837341335128515e-01   -4.950641275325480e-01   -1.140872709415575e-01   +7.396911172346539e-02   -3.165176531717535e-02   +1.517599018882465e-01; -1.445742682133586e-01   -5.313683062109136e-01   -2.003645798341005e-01   +4.021941481652562e-01   -2.173748152512823e-01   +1.744583207082767e-01   +1.823725328238098e-01   -2.856868898778911e-01   -1.923134304646993e-01   +2.471697913375446e-01   +6.444726274129807e-02   -4.221250666175781e-01; -9.096630806431666e-03   +2.585181230882376e-02   -4.497877049824194e-01   +1.888878227894543e-01   -2.553737129716719e-01   -1.620619143846744e-01   -1.775686037851038e-01   -4.174766124407638e-01   +1.187253675790864e-01   -1.557679811468655e-01   -2.672674270357823e-01   -3.662680282174341e-01; +1.357132896488081e-01   -1.664144493565022e-01   +3.265636726810028e-01   +2.010109414672221e-01   +1.658461023757284e-01   -2.748233334677800e-01   +1.948523297062084e-03   -5.242291204023961e-02   -2.799162815290783e-01   -1.300662288797842e-01   -3.247295357975841e-02   +3.751547835548363e-02; +2.572849646406966e-01   -8.037375183904945e-02   -9.266170683378366e-02   +5.538190250806351e-02   +5.954307633397078e-02   +1.455780622970230e-01   +4.955380573429246e-01   +6.489625571329267e-02   -6.986072081592517e-03   -8.124648403434481e-02   +2.865195823492511e-03   +2.607542894153316e-01; -4.140986609174834e-02   +2.626269847189733e-01   -3.480375672708352e-01   -1.122098153465150e-01   -7.197306622891668e-02   +3.116427404855385e-02   +2.576094125922939e-01   -7.463303955603809e-02   -2.457078863448058e-01   +3.426452562873506e-01   -2.297374234398298e-01   +2.495584375635644e-01; +2.570831311580378e-01   -7.303924915637733e-02   +9.177152112302495e-03   -1.969300921490098e-01   -1.632730433709970e-01   +7.453235609599651e-03   +1.363223504376837e-01   -7.979853457331591e-02   +2.314767803714626e-01   +2.108869442984072e-01   -4.526772603678431e-01   -1.576369716036397e-01; -4.060805939375343e-01   -2.789378245084697e-01   -2.015269731936509e-01   -3.513517249675726e-01   -2.049952482121332e-01   -2.705475943273374e-02   +6.658904665882598e-02   +6.117388812072977e-02   -2.022002482641016e-01   -1.526680502358728e-01   -8.418514988379953e-02   +3.288026592312888e-01];
L3I_L2I_iGABA_netcon = [+2.939754696193858e-01   -2.048739665309987e-01   -5.323197138436403e-03   -2.667960449877736e-01   +1.695354718803823e-01   +1.798006204447327e-01   +6.638004484898094e-02   -4.866974663273264e-01   +6.016093643735685e-02   -2.585581408965513e-01   -4.065456735621607e-02   +4.107203286176929e-01; +3.489092915683831e-01   +5.296187070721754e-02   -7.259016560759879e-02   +1.013037632733237e-01   +3.016982303122240e-01   +4.981363502848374e-01   -3.227282392867175e-01   +1.460208823287552e-01   +1.507491487593279e-01   +1.658749475907580e-01   -6.266032970317179e-03   +2.736770902700108e-01; +2.057416816437297e-01   +1.647447008459880e-01   +4.021398677014318e-01   +4.818411575626474e-02   +1.520030278062588e-01   -1.416248474762997e-01   +3.229666820646478e-02   -1.212339960803458e-01   +1.605687563614842e-02   -2.301294494272416e-01   -5.879516638397300e-02   -2.288548924544001e-01; +5.282133772037159e-01   -1.555941977793915e-01   +4.034908026793646e-01   -2.505760837889878e-01   +9.523745144430815e-02   -1.669703403734176e-01   -1.864734780163661e-01   -2.878823988860666e-01   +2.005278941859158e-01   +1.003457414990602e-01   -3.229537702157323e-03   -4.806178903741481e-01; +2.993348993934906e-01   +5.074398269111659e-02   -1.285136862320596e-01   +8.335203819099357e-03   +3.743341086401213e-02   -1.548562121794632e-01   -2.508018961331397e-01   +3.210971826357886e-02   +3.659348512607455e-01   +2.780243814976885e-01   -2.692768002230244e-01   +1.760039844928521e-02; -1.822556243341170e-02   -1.250972199821379e-02   -2.094309346721276e-01   +1.371215042374665e-01   +2.269007186650754e-01   -5.623939289852498e-03   -3.025255445184886e-03   -1.667552001617221e-01   -1.032392938680202e-01   -2.438519433445487e-01   -2.125923871333442e-01   -2.698604787295166e-01; +6.977804125959247e-04   +1.918373853000580e-01   +1.864853657617530e-01   -2.008634184803382e-02   -5.478234117262346e-02   -4.920670728646928e-01   +7.952087830897736e-03   +2.366207903058161e-01   +2.504609467579882e-01   -3.879978807481368e-02   +1.219027247299240e-01   +1.744038873770679e-02; +6.222497053287008e-01   -2.465750041295840e-01   +5.202954987365641e-02   -3.802034260428980e-01   -6.676928336554711e-02   -6.543552572959299e-03   -3.643005184302380e-01   +2.444023525638480e-01   -8.869861277941425e-02   +7.369438633444675e-02   -2.550222105995658e-01   -1.419103628972178e-01];
L2E_L3E_iAMPA_netcon = [+2.229484733308942e-01   +3.621358675268321e-02   +5.993893324310032e-02   -1.872124783867965e-03   +2.930233817066614e-01   +4.457101666216797e-01   -1.037441918988971e-01   +4.130295485901947e-01; +1.101995129754696e-02   -2.746064340852210e-01   +3.894422615134265e-03   -3.366396698573573e-02   +2.715004498821514e-01   +1.253913561493923e-01   -3.678040624418590e-01   +2.809505180554965e-01; +1.926735167141745e-01   +3.822159670698483e-01   -1.080379462821573e-01   +1.301460319282929e-02   -1.750500146571630e-01   +7.701321481374687e-02   +1.480286370410555e-01   -4.639343242039411e-01; +2.447863180402749e-01   +3.566381943626004e-01   +4.186262665629786e-02   +2.530544254274902e-02   +2.707831067127733e-02   -2.366125927792456e-01   -3.207874574918384e-01   +8.615082598675179e-02; -1.001804150170380e-01   +3.194390577867724e-01   +3.019842322096611e-01   -2.850349297100686e-01   +2.337709803503677e-01   -3.390348070748872e-02   -2.411613661398938e-02   -1.836888780939628e-01; +1.713050663860522e-01   +6.117399681892523e-02   +1.327035854107490e-01   -2.841451892824547e-01   +7.060104933085717e-02   +1.301199600652234e-01   +2.056278348683505e-01   -2.664345092703357e-01; +1.103588385345775e-01   -1.487878054824544e-01   -2.622647319042749e-01   +1.628756473710480e-01   -5.928123190959741e-03   +1.706937031173845e-01   -3.397054267994066e-01   +1.733582796439911e-01; +1.551944526318175e-01   +1.379458472609152e-01   -4.369505423466062e-01   +3.652329330535314e-01   -1.059190979835749e-01   +2.522700031532905e-01   +1.800868721382188e-01   -3.554042565865861e-02; +3.982447433840398e-01   +3.624496121577264e-01   +3.409739920839840e-01   -8.647683846577903e-02   -1.768831398254967e-01   +2.930557244895979e-01   -1.176395198226533e-01   +2.810265399122898e-01; +1.128608158651874e-01   -2.791091888180084e-01   +3.124936254940325e-02   -2.678914788005033e-01   +2.616321710696358e-01   -1.267596499766413e-01   +2.726925883443831e-01   +1.956023989742877e-01; +2.216763392191404e-01   -1.289742338973365e-02   +6.852848459396722e-02   -1.023284132476265e-01   -1.174727210835379e-01   -6.992751855034160e-02   +2.505078425172574e-01   -1.803036146984449e-01; +1.551488732677470e-01   -3.759008474752301e-01   +2.444270139299452e-02   -1.702532368918412e-01   -3.327440973566515e-02   -9.057654070281362e-04   -1.050098289054364e-01   -2.786495510536854e-02];
L2I_L3I_iGABA_netcon = [-1.934307891275661e-01   +1.164036802537750e-02   -7.244517584737792e-02   +8.802326022498530e-03   +4.701904387916153e-02   +1.376563343401664e-01   +3.125752205555591e-01   -2.519279848566487e-01; -1.992713468589589e-01   -1.430452885891687e-01   +8.041001503489281e-02   -1.299131557290408e-01   +5.042073232638298e-02   +8.561682289564823e-02   -3.090327726786243e-01   -3.068515109309630e-02; -8.578191424965012e-02   -6.310775035503252e-02   +4.137182819774573e-01   +2.121505454098279e-01   +2.417567588365039e-01   -2.096053145288687e-01   -1.820703717745117e-02   +6.822726445791734e-02; +2.576651746268882e-01   +2.378223046558406e-01   +7.483130913660091e-02   -3.040077640715651e-02   +4.285339965645956e-01   -1.415098047473741e-01   +1.857741984754215e-01   -4.354680723147832e-01; -8.824777696054949e-02   +2.662766674219105e-01   -1.320888215532743e-01   +2.719864561063042e-01   -1.570733882002490e-01   +1.866438533038761e-01   +2.726310429595284e-01   -3.000485128223583e-01; +7.851187467888229e-02   -1.359829318235489e-01   +2.337288139765754e-01   -1.925892301040157e-01   +1.810483106767850e-01   +2.517597198219537e-01   -2.402310396254261e-01   +3.200470194900972e-01; +1.811294688887993e-01   -1.141377064566792e-01   -4.344504217325210e-01   -9.091439755470435e-02   -4.877440377109640e-01   +5.008937814813219e-02   +1.891329248106644e-01   -3.193754008387503e-01; -1.826990474476079e-01   -1.848424552078171e-01   -8.424197694171964e-03   +2.927618606964795e-02   -2.712493524492928e-01   +2.614273119571150e-01   +2.525473489642367e-02   -1.046730100311898e-01; +2.470600485632284e-01   -4.913384384373613e-02   +2.085080428807215e-01   -4.278149111157194e-02   -1.591822843155235e-01   -3.346132047522422e-01   +8.700485521381100e-02   +7.703395189992272e-02; -2.916688608107667e-01   -2.073028173367005e-01   +2.797856994403559e-01   +9.878382198017162e-02   -7.328478057622165e-02   -2.852754853397078e-02   +2.070315729578407e-01   -1.371020571636596e-01; -1.111780226066607e-01   +1.442372844496223e-01   -5.152221470117488e-02   +6.157436721835681e-02   +1.729050046194971e-01   -6.031595202519689e-02   +4.324242936788428e-01   -1.738078991809443e-01; +9.962644249600557e-02   +2.094381905276288e-01   +2.537302016844762e-01   -3.768917917747375e-03   -3.265310549923984e-01   -5.677806078921677e-02   +1.514934054471830e-01   -2.141845011039757e-01];
L3I_L3E_iAMPA_netcon = [-1.600973055853347e-01   +2.356351502900585e-01   -1.066592173215049e-01   -8.329269560241179e-02   +1.087367857973789e-01   +8.457816028753398e-02   -3.454775757490111e-01   +1.418326637215289e-01   -6.851415074262873e-03   +3.764197160997971e-01   +2.143672578219469e-01   -1.263358978297126e-01; +5.803019113194914e-02   -3.336940628203861e-01   -3.019876973801016e-01   -3.869871865013387e-01   -1.778193824040267e-01   -1.724995176699624e-01   -4.450131043932362e-02   +2.114782312486118e-01   +3.185057425293537e-02   -3.537836311267282e-01   -1.491087793728067e-02   +1.125108627547176e-01; -2.597372055443618e-01   -1.656434277167541e-01   -3.312832374496316e-01   -3.502866382340453e-02   +1.872530928893791e-01   -1.805179117081867e-01   -7.946594568896957e-02   -1.479642136046452e-01   -4.053362896422043e-01   -1.353985162916719e-01   +8.361416032271654e-03   -1.351741174367737e-01; -2.921791803233576e-01   +1.042961731805399e-01   +1.343881975914207e-01   +3.171871408039152e-01   +1.712045067982865e-01   +4.093417250279617e-02   -1.018160669116761e-01   +1.048627150005472e-01   -4.054501717609098e-01   +8.329434136686500e-02   -3.627784357499818e-01   -1.611665981926208e-02; +1.610053483062519e-01   -9.236319571926825e-03   -1.626636864240403e-01   -2.697143998662838e-01   -5.950113743913543e-01   -9.579947738364661e-02   -1.637281063546635e-01   -4.844252629818755e-01   +1.613751392565634e-01   +1.552575501462202e-01   -2.661215347111097e-01   +3.085955531558922e-02; +2.489428217261178e-01   -5.682544757987272e-02   -1.245275203990154e-02   +2.663751820194709e-01   +2.093829867121865e-01   -4.065104491709783e-02   -2.004611763337728e-01   +2.609843047751246e-01   +2.425937824080936e-02   -3.792826173581003e-01   -5.098707384951863e-02   +2.307462614302967e-01; -1.906175159707447e-01   +2.866476183919217e-01   -1.016508780192832e-01   -2.021599311499463e-02   +3.048964768056397e-01   -8.733978404998059e-03   +1.606202079024896e-01   -9.435784104150818e-02   +3.225436918320499e-01   -2.484210609320905e-01   +9.937169251274620e-02   +4.264856153287108e-02; -1.349511874810861e-01   -1.416238455489018e-01   -1.047871289962706e-01   +1.631889057256427e-02   -1.065151070837574e-01   +2.833299604489465e-01   -6.706874713552126e-02   -3.561578867302859e-01   -1.569739861368950e-01   -1.384273872030904e-01   -2.515125956204624e-01   -3.312832164258908e-01; -1.377935058504783e-01   +2.427991359904558e-01   -2.006561891569716e-01   -1.861683512687399e-01   +2.282266722478097e-01   -1.303653983060671e-01   +4.253554851648846e-02   +3.000214882124446e-01   -1.935852532094199e-01   -1.847857226180512e-01   -2.350317244112617e-01   +2.462865241730465e-01; +6.780825715216282e-02   +1.067767363083136e-01   -5.921210795770040e-02   -1.191847328851246e-01   +8.748240481207323e-02   -4.938417685353316e-02   +2.891307050464612e-01   +1.927059495711181e-02   -1.520273829038309e-02   +2.905094323923086e-01   -2.497987999376274e-01   +2.166511000868010e-02; -2.489328947372533e-01   -2.905005897776620e-01   +2.668315453601595e-01   -6.964925948570655e-02   +1.082529369519029e-01   -2.252791433573366e-01   -4.146655208376517e-02   +2.302743659628460e-01   -7.775000314513331e-02   +9.906664412687236e-02   -2.235674496584694e-01   -3.678174397281164e-02; -2.036590018530193e-01   -2.764234250444559e-02   -1.622677242819044e-01   -1.697573967196833e-01   +5.358052249643104e-01   -3.274762187102174e-01   -1.565634453703395e-01   +1.729801878255620e-01   +2.665008602274330e-01   -7.127774197989047e-02   -3.061021761370883e-02   +5.547659507188463e-01];
L3E_L3I_iGABA_netcon = [+2.995991431639446e-01   +2.321933096030491e-01   -2.554026138680404e-02   +5.543323774217172e-02   +2.598941010368887e-01   +2.195937735709683e-03   -2.463879766599336e-01   +1.433431983837393e-01   +4.389929509200474e-03   -1.229067257681035e-01   +2.223941809900239e-01   +7.350396878423819e-02; +1.016588310271818e-01   +4.150512280784718e-01   +1.574791988268837e-01   -1.884279160451560e-01   -7.591037120991512e-02   +1.060877777342258e-01   +1.221206775106909e-01   -5.884277804570802e-02   -1.269374369343266e-01   +2.317978381776032e-01   +3.516279283077636e-02   +3.267450914293273e-02; -1.242251920926740e-01   -2.630351237626091e-01   -1.916631545476981e-01   +2.301981737228800e-01   +2.526630872627323e-01   +7.552167672072982e-02   -1.272008007010500e-02   -2.352688534512571e-01   +1.841126378061357e-01   +3.916343730523048e-01   -1.196619238865984e-01   -1.782599248327068e-01; +1.716610227813778e-01   +5.108934879301109e-02   +2.746312440956453e-02   -5.252625972566126e-02   -1.145682861717268e-01   +3.294879235108099e-01   +6.970316149596650e-02   +1.705232401892496e-01   -3.346342729760596e-01   -2.641016011295381e-01   -9.910776690838863e-02   +2.994661134700611e-01; -7.584438241395251e-02   +4.914018308403563e-02   -6.290378370152533e-03   -9.179693858349373e-02   -2.260392626686221e-01   -7.447223444293422e-02   +1.104416271756951e-01   -3.853797393142600e-02   +2.036630672726774e-01   -3.557170823091805e-01   +3.659092849469452e-02   -3.457723053687374e-01; -7.382655574439104e-02   -3.200619013236669e-01   -1.074420150727252e-01   -1.310675809481678e-01   -1.274091255885344e-01   -1.528622802714903e-01   +7.812916677274670e-04   -1.115586158777670e-01   -1.536766035492938e-01   -6.365839818706267e-01   +9.156317644902018e-02   -5.693764231541805e-02; +1.469575593379669e-01   +1.688358230024754e-01   -5.110412770904348e-02   +5.740424341643519e-02   -2.433620575094185e-01   +2.508036241283237e-02   -1.516255126798883e-01   +4.654316559898419e-01   +1.387614929658922e-01   +1.365181160869678e-01   +2.634233983508110e-01   -4.295375458159936e-01; +9.586418550524869e-02   -2.608194976811534e-02   +4.222754041485071e-01   +1.239670246193696e-01   -3.556857062906216e-01   +6.342199864599198e-02   -7.947461164213612e-02   +4.585138271978886e-01   -5.566517482437452e-02   -1.915770915999702e-01   -5.950340846904317e-02   +5.667156781554188e-02; -1.393702920154774e-01   +3.393046627141157e-01   -3.692702511875083e-01   -2.391693612290893e-02   +8.790551053762378e-02   +4.571076840809988e-01   +7.311068043483056e-02   +2.874473361156208e-01   -1.360944606194868e-01   +1.420224935230924e-02   -3.207102821097854e-01   +6.187935937643585e-02; +2.218024745534100e-01   -7.828215598392826e-02   +1.261094130227458e-01   +1.290093060367651e-01   +1.268169887022340e-01   +2.065405884549159e-01   +2.193699835989004e-01   +2.668987576829796e-01   -3.906554445964592e-01   -2.240768794419342e-01   +6.405763471935690e-02   -1.196400998415312e-01; +1.686136075412702e-01   +1.416929822976955e-01   -7.051172572316147e-02   +1.890945840682094e-01   -1.481437387957376e-01   -2.020017265251519e-01   -3.788422350473546e-02   +4.528205815405477e-01   +4.074533656025867e-01   -1.614959309515426e-03   +1.674071681519924e-01   -2.255492619331569e-01; +1.960344905572640e-01   -2.069956038493794e-01   -3.364737327777387e-01   -2.702636173225981e-02   +1.669956122878517e-01   -7.217668269199991e-02   +1.224086131947475e-01   -2.947698575115537e-01   -3.407539536834384e-01   +8.374493411141370e-02   -6.569460575309773e-02   -7.057791599005520e-02];
L2E_Input1_iAMPA_netcon = [-1.336048364555803e-01   +6.038447794233377e-02   +1.815999359780715e-01   -6.347709214841463e-02   +3.601532814217425e-01   +2.978591773381775e-01   +1.277305486228118e-01   -1.556527524371139e-01];
L2I_Input2_iAMPA_netcon = [-5.211231005600746e-02   -2.185977660458845e-02   +3.219043408555928e-01   +6.466099311014430e-02   +7.126918019840051e-02   -4.765357718749567e-01   +1.681844814313118e-01   +1.778057588342638e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
