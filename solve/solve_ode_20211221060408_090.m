function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.334809129428011e-01   -1.878215508374482e-01   -2.006546282655005e-02   -1.115210526550843e-01   +3.554178153771928e-02   -7.252658303264926e-01   +3.750158720646538e-01   -4.100703255754665e-02   +1.646560965590062e-01   +2.390446788676987e-01   +5.816895751112179e-02   -7.427567001723883e-03   -4.570584746857236e-01   +3.954773155468271e-01   +5.162974006126861e-01   -7.507556556234547e-01; -4.564156999936094e-01   -5.489958129404042e-01   +4.319283239866943e-01   +2.907089997137248e-01   -4.117394329863318e-01   +2.293426656414420e-01   +2.782527183367942e-02   +7.518699668263505e-02   -3.766283914407698e-01   -1.703211269464614e-01   +7.963850935231609e-02   -2.332900298863828e-01   -6.214017698660913e-01   +3.940568189215943e-01   +3.337382085868988e-01   +2.754724683808857e-01; +5.046647134496680e-01   -5.699204163858604e-01   +1.244975385391434e-01   -4.782971043331635e-01   +2.611689504541692e-01   +7.277671031127977e-02   -3.215739454535630e-01   +3.119073308721011e-01   +2.082482213559686e-02   +9.422959934983697e-01   -2.015097933563876e-01   +9.695312105847073e-02   +1.562925792400800e-01   +8.996029830147333e-02   +3.265139813445529e-01   +2.664005729773342e-01; -4.196815171133646e-02   -3.032145830893567e-01   +6.703929213044127e-02   -4.175606777558964e-01   -8.386250877371894e-02   +6.402976804209089e-03   -1.803337264924980e-01   -7.230134688062730e-01   +5.798776032875138e-01   -7.835534277724758e-01   -1.172049012885971e-01   +1.732035933719995e-01   -2.258120134791218e-01   -2.531488197953675e-01   +8.372314449898428e-02   -4.710827468885698e-01; +5.760514099722646e-01   +3.561593771524565e-02   +4.574560183075228e-01   -6.140894659000029e-02   +2.080682868482026e-01   -2.327822973459116e-01   +4.271070196744415e-01   +5.536017988426476e-01   +3.988164437072348e-01   +4.460052189650650e-01   +6.651525862697113e-01   +1.894861238213476e-01   +4.335615674611867e-01   -4.964227167876651e-01   +2.506659833878688e-01   +1.168314677619322e-01; +6.885506337185159e-01   -5.025620314786456e-01   -5.093422526166269e-01   +1.509858493846983e-01   +2.506468503857213e-01   +6.347821449175008e-01   -2.092540346113144e-01   +7.174861230075422e-01   -1.745491374946670e-02   -4.595497326174331e-01   +1.942362060116028e-01   -1.765576147059602e-01   -2.837166247726579e-01   -2.114134428929243e-01   +1.753308533692421e-01   -4.349634418935391e-02; +6.207844250796680e-01   +2.715099207176401e-01   -4.185225913564108e-01   -2.624785975730467e-01   -5.293016032734910e-01   +4.065635665263000e-01   +8.399721671060056e-02   -4.863650197377894e-02   -4.532270437411750e-01   +2.254385950197316e-01   +2.849633266564760e-01   +3.838733177435400e-01   -1.034492270182473e-02   -6.860462925754897e-01   +2.868751518299995e-01   +1.211607579030120e-01; +2.557630764524169e-01   +1.959590568715339e-02   +1.030333755413019e-01   -2.894648661922408e-01   -5.114675988926041e-02   -4.664181095108669e-01   +2.878262626547269e-01   -2.341258296111580e-01   -8.466000216513075e-01   -9.081723600564495e-02   -3.902121144010703e-02   -4.704913501894595e-01   +3.470438279801307e-01   +3.640233945665907e-01   -2.977458820716440e-01   +4.661163010786361e-01; -1.534269434492579e-01   +1.375835889334606e-01   +5.006377413603793e-01   +8.562719701267797e-02   +7.511903826829587e-02   +5.580296982238122e-01   -2.834809662768144e-01   +3.843440112633112e-01   +1.837885628984594e-01   -2.371836601675766e-01   -5.870409561992419e-01   +5.403862933376212e-01   +1.802189900905234e-01   +7.726693149080711e-02   +9.030026927866210e-02   -2.195376502457698e-01; +1.419409591425703e-01   -1.174908766366090e-01   -9.230084682714743e-02   -8.466436083175732e-01   +1.779571630394844e-01   -2.632878143191507e-01   -7.014239263702188e-02   +5.573583873115342e-02   -8.772177385607427e-02   -3.981762250759489e-03   +5.235649979042353e-01   -4.166927554178709e-01   -2.132668819412593e-01   -9.269132493873586e-02   -3.877861555609551e-01   +4.060033855773156e-01; -1.729345896595486e-01   -3.048630901076350e-01   -1.336930037197529e-01   +1.209869436178883e-01   -1.186039882810704e-02   -2.254679143837334e-01   -3.101691463444632e-01   -3.183870683995877e-01   +2.798250265057010e-01   -3.176877443401330e-02   -2.407644536301634e-01   -1.372024955262709e-01   +7.100220788749473e-02   -4.069482993945657e-01   -1.060473058978206e-01   +1.305247899465946e-01; -4.734571786162022e-01   +9.695305372382531e-03   -3.361494706092122e-01   +6.333971148351834e-01   -1.494887937869511e-01   -2.802954611126016e-01   -3.577019745767926e-01   +4.836106564106317e-01   -7.508367338652252e-03   -2.884226578112156e-02   -5.029782297863882e-01   +5.271783729207351e-01   -4.294182923124508e-01   +3.296685360775223e-01   +5.453207150120091e-01   +3.054057789386955e-01; -8.502977558030206e-02   -4.610499627712872e-01   -7.218606321817858e-01   -1.459023109764482e-01   +8.381689875510844e-01   -6.236912213158724e-01   +2.180772768395470e-02   +4.996921559445145e-01   +1.406213406731599e-02   +6.914436229181037e-02   -5.106492065718109e-01   -1.981178457389526e-01   -2.664479838541048e-01   -3.671507733495570e-02   +4.561050527105467e-02   +3.279813866359824e-01; -5.739183489645695e-01   +2.624589189538868e-01   -3.712393779135693e-01   +1.629028050385670e-01   -8.664678294630675e-02   +2.707785177949253e-01   +3.505849600781365e-01   -1.797496373647385e-02   +3.836690301097437e-01   +5.223461957695467e-01   +1.557358230407143e-01   +1.076573156440395e-02   +5.395102587417232e-01   +3.307290702008937e-01   -3.771232148444782e-01   -2.018960165750829e-01; +3.253829015278720e-01   -1.899219740581276e-01   +2.793286865169916e-01   +3.022323427785650e-01   +3.665007589691689e-01   +4.990308135372707e-01   -1.197352597428762e-01   +3.828092022037504e-01   -2.783771181153242e-02   +1.549176255641096e-01   +9.089370168984444e-02   -4.519066091777061e-01   -2.151740249813611e-01   +2.535960975203332e-01   +8.159859319139955e-01   -1.607864790292732e-01; -1.542125550416842e-01   -1.961380803389930e-01   +5.236307066274392e-01   +6.946084504400087e-01   -3.432128110603242e-02   +3.289141435321869e-02   -1.249967605198019e-01   +9.002564134025345e-02   +7.052491379536223e-02   +1.665796148036100e-03   -5.683108015454068e-01   +3.389654154175860e-01   -2.433698793857398e-01   -1.000000000000000e+00   -1.325017278728823e-01   +2.278040988394454e-01];
L1E_L1I_iGABA_netcon = [-1.913491279573624e-01   +2.853549746950248e-01   +4.741172114889529e-01   +9.439138696255592e-02   -6.373602035382536e-01   +2.317664704886876e-01   -4.254942898545325e-02   -1.339559145668251e-01   +9.942205520981390e-02   -2.707071052672540e-01   +1.123857915562080e-01   +4.603528380959174e-01   -2.125658222923009e-01   +2.421560255867648e-01   -2.988634183214317e-01   -1.426827708067496e-01; -4.065795580325863e-01   -5.264024630755096e-01   +5.208238848288269e-01   +5.444547988018568e-01   -4.011501763801839e-01   -4.487817997525118e-01   -4.574657870504990e-01   -2.671470204100868e-02   +2.210737317488586e-01   -4.496292229772442e-02   +9.904990939361641e-01   +2.241504811690324e-01   +1.724848307742330e-01   +4.421020283750250e-01   -7.786902302739172e-02   -1.641756436283826e-02; +7.035027281454420e-01   +2.484601965845676e-01   +5.843209017878634e-02   -1.951524841807037e-01   -2.862303291874351e-01   +3.921238598283480e-01   +3.854236155429325e-01   -1.842123750318025e-01   +4.844202392152819e-01   -1.666068288631253e-01   +5.695238903656694e-01   +1.365078480531305e-01   +2.186141088306356e-01   -1.677791272619654e-01   -7.447558148800071e-01   +7.478362692216831e-01; -3.827300946177126e-02   -1.660126199500343e-01   +9.677956083968056e-01   -5.245703805155711e-01   +2.342911706184296e-01   +9.117207272899307e-02   -5.455642774450821e-01   -5.115856970197098e-01   +7.810196523477384e-01   +6.306553876039800e-01   +1.657389526394651e-01   -3.084074728074005e-01   -2.710481892565767e-01   -2.332093316442498e-01   +3.066121096650063e-01   -4.924233568183495e-01; +1.089308637650482e-01   +7.470076656685565e-01   +3.617967436014778e-01   -8.145144779178535e-01   +3.432026139600411e-01   +4.910218648227270e-02   +4.795526491589644e-01   +4.278962061915335e-01   -1.881541789788164e-01   -4.429313975464698e-01   +6.458554588422342e-01   +5.711427604332298e-03   -5.210702973830953e-01   +2.548551772848075e-01   +3.832511514950532e-01   +4.787534454206541e-01; -6.976849915447639e-01   -3.234022382449404e-01   +7.815075094687778e-01   -1.934471833749714e-01   -5.045635240688531e-01   -4.764477610706466e-01   -7.652707685921756e-01   -2.919266461387703e-01   +8.628575849606786e-02   -7.001886065556298e-02   +4.234404401004213e-01   +2.676102830410113e-01   -2.648290622533880e-01   -9.947493092201741e-03   -4.967401501275556e-01   -3.779243915596998e-01; -5.024084309643653e-01   -1.863174719318025e-01   +1.421628561757949e-01   -1.951380408913083e-01   +2.309643418804459e-01   +6.622638535459626e-01   -2.135504130141479e-01   +7.166123135173533e-01   +4.244762325080438e-01   +4.551522074269082e-01   +3.671477866460895e-01   -3.351120795087674e-01   -2.681656224677793e-01   -8.353333995156038e-01   -4.670948339527145e-01   -6.718941976321851e-01; -4.993680687904279e-01   -7.481905393700053e-02   -2.521677619138952e-01   -7.054689509172116e-01   +2.217617017573357e-01   +7.692114096952338e-01   +4.076344607434026e-02   -6.250824553655827e-01   -1.453282917819608e-01   +4.943544865409668e-01   -4.234706497444405e-01   +5.437468313237245e-01   +3.056767226032654e-01   +3.239582442971644e-01   +1.635641329763015e-01   -2.757517847631388e-01; -1.154262286188214e-01   +3.411067002102949e-02   -4.361739910575306e-01   +4.784634776897344e-01   +4.185126584600453e-01   +5.638242810127315e-01   -4.597463168580025e-01   -3.062623775187764e-01   +5.638141167247576e-01   -2.644799714137624e-01   +2.459187175924396e-02   +7.955094838009945e-01   +5.103121703051111e-01   +2.896915780038276e-01   +1.670854872513409e-01   +1.874804352106583e-01; +1.115363730161083e-01   -3.784542393260472e-01   -6.223135933528873e-01   -1.646323119775931e-01   -3.128475779260371e-01   -6.783894121073145e-01   -1.117656526215846e-01   -2.071638661740499e-01   +6.407408324141071e-02   -6.292881843718726e-01   +5.901343863865348e-01   +4.962074046161152e-03   +4.906960245210284e-01   -5.943968128428545e-01   +2.328399624374912e-01   +1.358789083241241e-01; +5.432909819933803e-01   +5.102152932899841e-01   +2.733586824997736e-01   -2.343346060482812e-01   +2.721091404157365e-01   -1.114187332378514e-01   +7.623145562592368e-01   -8.140013633112916e-01   -7.490219702001135e-01   +1.041475304224227e-01   +5.127420806618608e-02   +7.317809364880461e-01   +1.460345856083106e-01   -5.649468537391259e-01   +1.072131250758115e-01   -3.614705709263805e-01; -5.120024916540908e-01   +5.897149561911008e-01   +1.585351217595607e-02   -1.866879551380271e-01   -8.841205453161277e-02   -2.210879797093823e-01   -4.847088986522963e-03   +3.487652110791278e-01   -1.820406823545209e-01   -1.943891107590650e-01   +1.720037805374139e-01   -6.162992670236950e-01   -2.559565868653854e-01   -5.936908890335386e-02   +4.438396149322862e-01   +4.733343830661712e-03; -2.241065900857108e-01   -6.362575928712825e-01   +4.264892170270423e-01   +3.426832483520987e-01   +3.919002880731400e-01   -6.106820618991411e-01   +6.150893960491535e-01   -2.584550940478414e-01   -4.484345402741367e-01   +4.145192803448227e-01   -2.572773206071253e-01   -2.769779966050051e-01   -4.448147709825076e-01   +4.682907418718399e-01   +1.825083236725994e-01   +7.453205253672673e-02; -1.168804191415900e-02   -4.135139832238941e-01   -2.993251198589877e-01   -6.746504253712104e-01   +4.496854349175633e-01   +3.032739924914929e-01   +4.464045826528657e-01   +4.806334528194189e-01   +2.857394683816208e-01   -5.960522639125317e-01   +6.973037242273378e-01   +3.369047345015483e-01   +2.314797213154071e-01   -2.710627713835225e-01   -6.590340669115060e-01   -1.235637836211869e-01; -5.152719020751766e-01   +4.413115964198833e-01   -5.067792219306918e-01   +1.784919797642485e-02   +1.000000000000000e+00   -5.254878793655201e-01   +2.141286632356369e-02   -7.394312211441951e-01   -1.626150499734697e-01   -5.101071407995968e-01   -4.935254641830169e-01   +5.587561608900015e-01   +8.117906795778062e-01   -3.261075225203553e-01   +2.051514831047005e-01   -1.383525783173489e-01; +2.106860087569128e-01   +5.324947940451142e-01   +7.258244897980117e-01   -7.851338187849007e-02   -4.389171524736697e-01   +4.518277081544181e-01   -1.741098201867184e-02   -7.049227209853848e-01   -1.360067675072943e-01   +2.027087307328570e-01   -8.204821746722283e-01   +5.678368587146784e-03   -4.145961122263359e-01   +5.994521636728057e-01   +5.304649851893427e-01   +1.382315446657119e-01];
L2I_L1I_iGABA_netcon = [-4.888037722624156e-02   +3.410866979749422e-01   -6.314893883506068e-02   +2.028769297532657e-01   +6.395043875197731e-01   -2.488609591682711e-01   -3.567680997209308e-01   +2.072890880228815e-01; +3.530100076381321e-01   -5.763805918529114e-01   -7.519354198647747e-01   +4.349640154047257e-01   -6.916558845607663e-02   +1.018562981045570e-01   -7.343692062930050e-01   -6.275523027421714e-01; +3.509724518108875e-01   +6.840750412500136e-02   -5.821986272402930e-01   +1.540002146109262e-01   -2.580595138629207e-01   +6.798146017126696e-01   -3.570135040697163e-01   -1.000000000000000e+00; +4.622813699799177e-01   +5.050031147115237e-01   +1.841241809778974e-02   -5.809320302447945e-01   +3.324849248290296e-01   -3.394210361358802e-01   -2.109402029542272e-01   -9.943300823834318e-02; +8.073534930463179e-02   -6.305653241727406e-01   +3.284772776273658e-01   -2.116866915938175e-01   +2.258908766008388e-02   +9.337565366162047e-02   +5.597206947850227e-01   -8.720668363444533e-01; -4.425272077454809e-01   +1.752557464325161e-01   -1.149839256709803e-01   -4.002043071416644e-01   -1.869512277424725e-01   -3.471243493864065e-01   -5.153715819017874e-01   -4.832008315937553e-03; +9.931083067096329e-02   +1.746508318361747e-01   +2.793631201132118e-01   +2.488665348385972e-01   -3.980786792603275e-01   -3.734761771434481e-01   -3.578216251593039e-01   +8.366857005731776e-01; -6.766967443624510e-01   +4.870586576566394e-01   -4.574119517693377e-01   +7.895917802462196e-01   +4.392053051460400e-02   -9.868912978478814e-02   -4.778358240306071e-01   +8.793113598283748e-01; -2.708584244004232e-01   -2.246899156764502e-01   -2.886641461224085e-01   -2.105176408238726e-01   -1.977528395562786e-01   +6.220460530970092e-01   +4.463220166280540e-01   -5.484068381904458e-01; -3.691303728950880e-01   -1.897851382525365e-01   -5.939628067333648e-01   +4.935050497161028e-01   -4.448329434197225e-01   -1.246047919385207e-01   -2.679465335031559e-01   -6.540137987739397e-01; -5.087645130803261e-01   -8.369395761621569e-01   -6.933043719913633e-01   -8.138063796557099e-02   -4.150207890238848e-01   -6.245208748767975e-01   -5.556597843882418e-01   -6.788429687845647e-01; -7.064106564889850e-01   +3.572278954280202e-01   +8.803904748038706e-01   -4.400645738237394e-01   -7.150022369040834e-02   +6.489965772529146e-01   -6.294531478940750e-01   +4.441305967264066e-02; -1.903164013155400e-01   +4.900027248813819e-01   +3.189559552429892e-01   -2.486337340921160e-01   +2.279310149153787e-01   +3.054599275471048e-01   -6.911779319397844e-01   -3.308496059902566e-01; -2.394634137412193e-01   -1.647834027765211e-02   -3.867108325101406e-01   +9.204263887373521e-01   +3.912303454051876e-01   -4.064366250865656e-01   +8.219361481493863e-02   -2.511921468778930e-01; +3.388320676547659e-01   -6.215803325510109e-02   -5.815792112614803e-01   -7.762968620121010e-01   -2.707040044695099e-01   +1.954070972449744e-01   +6.883684898145961e-01   -1.877367635945502e-01; -3.339538329531471e-01   +2.686174733983810e-01   +2.974077799795686e-01   -1.149692224383233e-01   +5.921728033859808e-01   -3.394087693304007e-02   +7.827927102523238e-02   +1.187719100290246e-01];
L1I_L2I_iGABA_netcon = [-1.584964152846039e-01   +4.233109774631564e-01   +5.379857709989373e-01   -9.097277904668583e-01   -1.744992735048167e-02   -3.162985513958034e-01   +6.455069120252023e-01   -4.883735050090953e-01   -2.446078501536265e-01   -2.841253876524442e-01   -2.369478918561318e-01   +5.369849089887437e-01   -3.667137781283020e-01   -3.262671384559794e-01   -7.014595700709438e-01   -3.327369006949902e-01; +2.514211372031183e-01   -1.592177166086685e-01   +1.738680300662696e-01   +3.082627667087880e-01   +3.228868713157012e-01   +1.514715895245801e-01   +1.000000000000000e+00   -1.720555566623615e-01   -5.673272020267989e-01   -5.351193305665362e-01   -4.590362334015428e-01   +4.507847357029548e-01   +2.556357866621726e-01   +7.306479286988761e-01   -5.868510266426382e-01   -2.350120355986091e-01; +2.546383744400704e-01   +4.633731868933798e-01   +5.676907821002853e-01   -2.636235473133564e-01   -2.830572311507031e-01   -6.888271768236318e-01   -5.356093249579386e-01   -1.367312425079361e-01   -2.413772962149566e-01   -3.769101912250661e-01   -6.283866014223646e-04   -8.172075864363892e-02   -3.982089375866427e-01   +1.898972698479268e-02   +6.661385494973416e-01   +2.237337193606682e-01; -2.229225554213216e-02   -6.481908491480985e-01   +9.861616580855960e-02   +4.239164138331443e-01   -8.327863212053570e-01   -1.609860851839752e-01   +3.113940722437564e-02   +6.363844571673237e-01   +8.948589062878333e-01   -5.975985233714626e-02   +3.014884888376119e-01   +9.762678597472632e-02   -2.285674732941041e-01   +7.531513002028021e-01   -3.975570341116583e-01   +2.798104071759164e-01; +9.807255967489061e-02   +1.410037894676110e-01   +4.811528507802056e-01   +8.348487153953923e-01   +5.471497622290482e-01   +1.964104959427072e-01   +5.724918838149732e-01   -1.562692321690489e-01   -2.667020419878214e-01   +3.480674372998042e-01   +1.484127652086658e-02   +9.333101486829258e-02   +1.015750774024876e-01   -3.862089064741034e-01   +2.271148880647355e-01   +3.622518160033716e-01; -4.491112670625031e-01   -6.708363729991152e-01   +2.856578628070551e-01   +1.988180708671375e-02   +3.848305650089475e-01   +4.560048142339260e-01   -3.865896027534488e-04   -1.951720619986632e-01   +7.284433702122167e-02   +1.917069463858372e-02   +1.527081179725321e-01   +5.069540247353966e-01   -5.434423733415219e-01   +5.965827979546290e-01   +4.715011823240777e-01   +5.483323469413374e-01; -2.937659925311095e-01   +7.530721522608906e-01   +3.440635879681664e-01   +3.974464941400793e-01   +2.383181506560878e-01   -4.626281584228963e-02   +3.358409283716854e-01   +1.251365551551795e-01   +5.891815917736151e-01   -3.144903531159277e-01   +4.301874147596295e-01   -1.698555698071598e-01   +3.462357298167554e-01   +2.458641557433308e-01   +3.144634079195658e-01   -1.070296823377819e-02; +2.275258430999465e-01   -9.775593556467255e-02   -3.835944948499047e-01   -2.384299244458319e-01   -1.179525267151276e-01   -1.707375683338154e-02   -1.690099053842460e-01   -4.356504868237810e-01   +3.641223777784954e-01   +2.775895134021057e-01   -4.277572268273211e-01   -1.032901954638894e-01   -2.675567338186244e-01   -2.165109062340453e-01   -4.825490783273822e-02   +3.173921722331117e-01];
L2E_L1E_iAMPA_netcon = [-7.460367994498558e-01   +4.411949331088392e-01   -2.744956088474022e-01   -1.000000000000000e+00   +3.106035209208146e-01   +4.863758834125330e-01   -1.799887493588961e-01   -3.145693156110299e-01; +2.757301703021502e-01   +1.816270653794254e-02   -1.650551000780793e-01   -1.818921848684759e-01   -1.225706415479698e-01   +6.553882929288569e-01   +7.290740219564048e-01   +4.825355760267168e-02; -3.274245760376310e-01   +7.592257727632196e-01   -5.724126329391353e-02   +1.659726055986002e-02   +2.015621213407630e-01   +2.781112804026302e-01   -3.974023923797225e-01   +6.149987405890525e-01; -4.982640344513199e-01   -5.785142439550156e-01   -2.411765970170478e-01   +5.954757639002400e-01   +3.217491554884942e-01   -5.855233319830911e-01   -5.956636450684759e-01   +4.991096548586777e-01; +3.630712609001787e-01   -3.779598149288662e-01   +4.996617445972309e-01   -2.039355210298602e-01   -6.880420094850840e-01   +6.561681068446103e-02   +5.245274835230270e-01   +7.645360676543134e-02; +2.967343811010560e-01   -5.606907278750861e-01   +1.044413209959624e-01   +3.136236771465893e-01   +6.485048238297765e-02   -6.702140387524219e-02   -3.542601449812808e-01   -6.573477781542651e-02; +4.097715978156671e-01   -5.184371421200150e-01   +2.825142083119787e-01   +4.468284624765724e-01   -6.373680982504808e-01   +5.127058795112218e-01   -6.286757015016129e-01   +6.401294401654599e-01; -3.184636527701641e-01   -9.642116954889524e-03   +1.883942732031741e-01   -2.562061566169166e-01   +1.899640119353245e-01   +7.238003185365140e-02   +1.431361768805408e-01   +4.802556677360709e-02; +2.575861957299008e-01   +3.447760296081712e-01   +9.668369103873395e-01   +3.021390460721585e-01   +1.314122990437928e-01   -5.893102329940996e-01   -2.615393688493046e-01   +4.002442846738095e-01; +3.050234227930883e-01   +6.528226157156224e-01   -4.897042015735646e-01   -9.779518426946546e-02   -3.847306874444149e-01   +2.444843409015467e-01   -6.276079708432140e-01   +1.099464763423467e-02; -3.334431473635817e-02   -4.808785402011578e-02   -2.555897544530539e-01   +6.472047142396331e-01   +4.592879702738086e-01   -2.074142930085380e-01   -6.140594518957071e-01   +1.907545698513053e-01; +2.055617108376693e-01   -4.764551693408910e-02   +3.970707232521996e-01   -7.162150657801583e-01   -2.068326794427816e-02   +4.402023844737785e-01   -3.569211577356657e-01   +1.039095551024717e-01; +7.101874864835984e-01   -1.180159209382029e-02   +3.026819528371791e-01   -2.800607401538577e-01   +4.214441707502704e-01   -7.310521610056883e-01   -5.862261367834664e-01   +3.220187451093996e-01; -2.949357172257137e-02   +3.675528762343591e-01   +9.719199849011614e-01   +5.727393858008175e-02   -4.720591992419019e-02   -3.954542944023693e-01   -2.089184739231750e-01   +4.012429430109626e-01; -9.000286648292619e-01   -6.708106513384211e-01   -6.466301664552371e-02   -4.936900754139419e-01   +6.218602161912302e-02   -2.886621388030707e-01   +4.579176040532261e-01   +2.508948889903068e-01; -4.796404757415089e-01   +5.265949902706885e-01   -4.236911042843045e-01   -4.788589498078855e-01   -3.800748591307532e-01   +3.845709070285606e-01   +7.682796668721342e-01   -2.258550371896344e-01];
L1E_L2E_iAMPA_netcon = [-4.675210704800830e-01   -3.392558258996337e-01   +2.123341662415312e-01   -6.514890296451438e-01   +2.176077679118581e-01   -5.123921592257918e-01   -5.290323872232138e-01   -4.875479124294510e-01   +4.266011769781463e-01   -1.313588484765254e-01   -5.671144711112072e-01   -6.955586974408607e-01   +4.701635713200752e-01   -2.498655163186957e-01   +5.732079794820416e-03   -9.653019677115633e-02; +4.508932603254299e-01   -2.496246168129501e-01   +3.477561059832112e-01   +1.765976707149443e-01   -1.510013653853207e-01   -8.806477936577213e-01   +3.164210819733996e-01   -2.018304012099985e-01   +2.460124769470695e-01   -2.154651058565068e-01   -4.754917729133452e-01   -8.123846773503010e-01   +6.904012714596926e-02   +1.707494983975772e-01   -3.842698863730658e-01   +7.365788419168003e-02; -1.383755629937531e-02   -2.504799511513329e-01   +3.523129082061234e-01   -3.184220193237442e-01   +1.243991445775521e-01   -5.351948796735303e-01   -1.807078040331166e-02   -3.212810248467692e-01   -1.000000000000000e+00   -1.860867339101787e-01   +4.405799308000637e-01   -2.994513303372653e-01   -1.655741894629726e-01   -5.231511176460254e-01   +1.874348855646503e-01   +3.942510698628843e-01; +3.500382512258607e-01   -5.437006517159391e-02   -4.501223186552355e-01   -1.060357855220867e-01   -6.768928806197667e-01   -6.198338900257206e-02   +3.136843354587273e-01   -2.412251199303694e-01   +4.536233908788706e-01   -2.619474822602269e-01   +3.258907720139265e-01   -7.552004396685009e-01   -9.267573956219560e-02   -3.587698344169402e-01   +2.660513198742546e-01   +6.216798472071106e-02; +5.646389843237435e-01   +4.340576212958536e-01   +4.074390234944155e-01   -1.897072939914032e-01   +1.231977260825928e-02   -3.052412952624549e-01   -9.764014485892379e-02   +1.227904676215808e-01   +1.422143742858540e-01   +1.519318151322586e-01   +2.416506671253654e-01   +2.914673138416707e-01   -3.981927332379018e-01   -3.356088489136345e-01   -1.272057813499167e-01   +2.315641955208052e-01; -2.587012784750107e-01   +1.014249154647842e-01   +3.809829213279921e-01   -1.997939735218991e-01   +8.307780953051108e-01   -3.962096984648101e-01   -4.444525707641090e-01   +2.510971731386560e-01   -7.026307795824928e-01   -4.683557831408952e-01   +4.639172377698352e-01   +1.101864414210335e-01   -7.371494166233300e-01   +2.782326494234134e-01   +3.564172154588799e-01   +1.064173521855712e-01; -2.185216535033093e-01   -1.259061171436639e-01   -3.784167640386233e-01   +4.187951318813072e-02   +1.372417414717108e-01   -3.858800940006059e-01   +5.055729551651731e-01   +5.353518540584152e-01   -2.510317908188708e-01   +2.934846967943053e-01   +5.825164167484469e-01   -7.188521455102284e-01   -4.939470310687882e-02   +1.601414744425829e-01   -4.724981974856265e-02   +9.707362188063302e-02; -4.376114637606413e-01   -2.358017471239966e-01   +3.956279394109107e-01   +1.632497978939389e-01   -7.836138945413778e-01   -6.408767361599333e-01   +1.688709677886771e-01   +1.898315763983348e-01   +3.382936317259942e-01   -2.655351268163481e-01   -3.838178497367918e-01   -4.428839597559269e-01   -5.502460353623405e-02   +6.197910362324880e-01   +2.693923993828261e-01   -7.786961227567406e-01];
L2I_L2E_iAMPA_netcon = [+6.653333801705219e-01   +1.013346651916061e-01   -1.331411557749049e-01   -1.719529656242667e-01   -1.778289246531998e-01   -1.567125986812850e-01   -3.918184356374492e-01   +1.597556962320859e-01; +3.801773927515343e-02   -5.588525467914361e-02   -6.723953122266959e-01   +4.759204732989346e-01   -8.265217394911171e-01   +5.848460408210800e-01   -5.449139662461316e-01   +1.494703264834953e-01; -8.449078996185082e-01   -7.023076080030750e-01   +3.367472269487571e-01   +6.924878121370965e-01   -3.035674276030580e-02   -8.237699418845063e-01   -6.094469967189643e-01   +3.821253436539769e-01; -2.590313560457995e-02   +4.810190897968043e-01   +5.560760049094667e-01   +2.045450357403761e-01   +8.192420278284634e-01   +1.037253140885365e-01   -2.123313880292298e-02   -4.682157125655476e-01; -2.351023351929409e-01   +3.772081890830470e-01   +1.229921488282084e-01   -7.720235487793999e-01   +8.889602088762306e-02   -1.000000000000000e+00   +6.768848031661476e-02   +8.491087576629753e-01; +1.989194945068331e-01   -1.822853846062919e-01   -4.967318803056408e-02   -7.014890985179212e-01   -7.460654349889030e-01   -4.816748725399880e-01   -1.478066791538488e-01   -2.639723344876772e-01; +3.634171289426813e-01   -4.610468561605546e-01   +4.698026565889266e-01   +9.369145413081802e-01   -7.704623265759842e-01   +7.073307616868963e-01   -2.414854615821359e-01   +1.786754426805680e-01; +9.516300563142230e-01   +7.344301613878631e-01   -1.999742424978645e-01   +3.125666722408640e-01   +3.332931726227552e-01   +4.322143398924687e-01   -9.362535727024530e-01   +5.386550494305317e-01];
L2E_L2I_iGABA_netcon = [+6.715007620086652e-02   +3.634383209124517e-01   -1.408180598640820e-01   -2.376436303082215e-01   -1.448095594924336e-01   +6.118857852716724e-01   -1.424729373233798e-01   +3.050393159709332e-01; -5.517437460457594e-01   -2.703667268812044e-01   +1.292597287106228e-02   +6.898170982682360e-01   +6.568406443674818e-02   +6.272328668888089e-01   +6.068146905780507e-01   +4.210395254850104e-01; -4.290610823953593e-01   +1.658036776044506e-01   +1.018229067242701e-01   +2.610743077222790e-01   +4.728398893058378e-01   +2.221962619810644e-01   -4.523527154913252e-01   -1.775590382541955e-01; -7.016900125262805e-02   -6.765824583041029e-01   +2.742886273537201e-01   -4.277860969981878e-01   +4.863338692186490e-01   -5.775304161012768e-01   -9.498268778329984e-01   +1.847889082363157e-01; +5.668612663221969e-01   -5.698595013461205e-01   -4.635315904768649e-02   +1.161269500426060e-01   +6.406178772918165e-01   +2.448216407523308e-01   -5.234840450656622e-01   -4.110872977930320e-01; +1.195414367204788e-02   -6.083091360132943e-01   +2.439258195726546e-01   -5.059300108625135e-01   +1.754298566222030e-01   +4.450395319505775e-02   -7.058950943313441e-01   +3.747814090717906e-01; +6.900296076390414e-01   +3.181846895288408e-02   -7.680245582618757e-01   -7.048502559098738e-01   -7.169421884472947e-02   +8.042546968700507e-01   +2.245735574027693e-01   +1.833441817079099e-01; +5.070048313353538e-01   +1.000000000000000e+00   +3.427875018747856e-01   -2.672985910406670e-01   +1.247643808744103e-01   -8.437963326350077e-02   -6.151792704032881e-01   -8.034388503529150e-01];
L3E_L2E_iAMPA_netcon = [+5.401975836655976e-01   +2.021417096279824e-01   +2.347396660682546e-01   +8.455799319171428e-02   +7.375042070850257e-01   +3.162624870338649e-01   -3.406602024259802e-01   -4.491328191338399e-01   +3.079386988938295e-01   +2.178632155030936e-01   +4.018892392376655e-01   +4.739995117648633e-01; -2.887621661050742e-01   -5.489940617149937e-01   -3.575758045425994e-01   +2.960602644570626e-01   +5.461333762807654e-01   -2.665729902024156e-01   +2.606274061297265e-01   +2.321639367568401e-01   -6.224640176903591e-01   +3.906182495902999e-01   -1.960156123943207e-01   -6.480544076404622e-02; +4.149122375470978e-01   -2.983842591950196e-01   +3.113705024494754e-01   -6.669743723299437e-02   +6.546454468190659e-01   -4.328074963681557e-01   +5.027042042621762e-02   -2.458176772895061e-01   -6.117354719617806e-01   -5.160240864599828e-01   -1.191749393790480e-01   +1.000000000000000e+00; -5.633314389436502e-01   -8.319257748504002e-01   -3.872236749279312e-01   -5.323434335096143e-01   +3.759343521561943e-01   +1.234539888061910e-01   +3.255431090774446e-01   +2.259797107017723e-01   +1.692468323399252e-01   -2.579785795991700e-01   +6.201603807034353e-01   +9.716382837595738e-02; -5.865712212014722e-01   +2.647627620761744e-02   -7.180418057738577e-01   -1.848416987993684e-01   +5.607529381353109e-01   +1.471689237400077e-01   +2.245038829169315e-01   -4.065134603687467e-01   -7.385123636737055e-01   +4.479299781798922e-01   +2.856250274629468e-01   +3.183535812664429e-01; -1.749872338394696e-01   -3.360864492172818e-01   -5.023919518228499e-01   -1.394024836757505e-02   +1.100841928266376e-01   -2.056312324220014e-01   +2.108163632428936e-01   -5.379709126744294e-03   +6.489328758926411e-01   +2.004136454067961e-01   -5.345605632359089e-01   +3.282651736220648e-02; +5.048032026744002e-01   -3.120293343846867e-01   +3.642109898815409e-01   +1.542583469940734e-01   -5.331139009540941e-01   -2.459909308930129e-01   +9.109341331364752e-01   +1.174925666325565e-01   +9.082122860009623e-02   +1.817354884693698e-01   +6.083882757800940e-01   -2.199502140664433e-01; -6.344333510914804e-01   -1.631402641966977e-01   +4.967568315217186e-01   +2.872565357608437e-01   +3.499187339637599e-01   -6.319124731557050e-03   +9.887606552305815e-01   -1.764125306451185e-01   -1.194323450478272e-01   -2.611156054790142e-01   -6.470207079463041e-01   +4.812081627287053e-01];
L3I_L2I_iGABA_netcon = [+5.638937293672917e-01   +6.289752646055010e-01   +4.272956842239579e-01   +7.748590793529034e-01   -6.656219491056893e-01   +2.295834411458260e-02   +6.610416255898935e-01   -2.503366134260231e-01   -1.255503084757734e-01   +6.357058172620736e-01   -1.365498949794140e-01   +5.313825377644579e-01; +4.614224977918049e-01   +3.158452873233093e-02   +2.158286443716245e-01   +7.678582654853915e-01   +8.199054457827474e-01   +2.537592494324842e-02   +1.000000000000000e+00   +4.414923091786243e-01   +2.833316435454175e-02   +3.496225135000809e-01   +2.449522700923765e-01   +5.365144291621728e-01; +1.428416281960597e-01   +8.765949867047597e-01   -2.979777444347284e-01   -8.192840507248168e-01   +4.775374744989956e-01   +6.027564937942913e-01   +7.321073077053838e-01   -4.517848811733505e-01   -3.888106995726011e-01   -5.814175436336660e-01   +5.126719729806538e-01   +1.392242801885870e-01; +9.797822355523641e-01   +3.216665671597360e-01   +7.367948841624267e-01   -2.103061885688602e-01   -1.469001954283563e-01   -6.347264863822473e-02   +7.397130127352288e-01   -6.394566056398674e-01   +6.001885861500971e-01   +6.674591513661047e-01   +4.103785030669787e-01   -1.933092526695765e-01; -1.120991643648785e-01   -9.013463810044248e-02   +1.254327865796499e-01   -9.845747405507337e-01   -8.787516388122387e-01   -2.022082632350594e-01   -8.974422582258903e-01   -2.543922239427064e-01   +1.848396955941954e-02   +1.231487007801096e-01   +2.770173662257346e-01   +1.402341955196936e-01; +7.758009665398330e-01   -3.623121764008358e-02   +3.411319766026308e-01   +7.300055025151160e-01   +2.271123378802875e-01   -8.028502765454029e-01   -6.030305920198543e-01   +6.880954878488582e-02   +5.612702833826457e-01   -5.184751963654392e-01   +5.609149339843754e-01   +8.891628219861415e-02; +4.537398000104947e-01   +1.843347455877236e-01   +5.068580783395764e-01   +3.986385217250274e-01   +6.526245193552118e-01   -5.535191117720529e-01   -3.080796979419713e-01   -2.168030707298219e-01   -6.200823559322817e-01   +1.893234002354799e-02   +3.833711743089894e-01   -2.485368459706373e-01; +1.423791188067328e-02   +2.090144328368956e-02   -9.540891086551112e-01   -2.801178660545063e-01   +4.888223872734337e-01   +9.760441273834157e-01   -3.676237995120514e-01   -4.251229052056029e-01   +1.877010001590598e-01   -3.920420057629979e-01   -4.016938269288879e-01   +5.793663501612187e-02];
L2E_L3E_iAMPA_netcon = [+2.629308900342053e-01   +7.615215330130418e-02   -3.827564720028940e-01   +2.076717788688176e-01   +8.215251281776605e-02   -3.111328761534249e-02   -1.009821162065416e-01   +5.926147835800918e-01; +7.304319444931372e-01   +2.943990669213080e-01   +1.787771043354361e-01   +2.667895783436441e-01   +5.277415565749884e-02   -4.492772037272686e-01   -2.610154954471427e-01   +2.745455436236305e-01; +1.655995618525131e-01   -4.683957869251085e-01   -4.356534091485680e-01   -1.496013750476448e-01   +4.728481454029528e-01   +6.423655841694261e-01   +7.519973297093977e-01   +2.243094669430911e-01; -3.549019731908009e-01   +5.347429021082426e-01   +9.186799087106985e-02   -1.522875284661253e-01   +5.864371729959978e-01   -3.242644707491180e-01   +8.161348914745334e-01   -2.088664828567311e-01; +4.094863620286956e-01   +2.554525935783822e-01   -1.985929234433874e-01   +5.109495429798581e-01   -5.826254301804168e-01   +4.973581359804132e-01   -3.885293810550196e-01   +4.854199516250500e-01; +2.759514345440973e-01   -2.531806514437505e-01   +1.661538209444451e-01   +2.565397853850331e-01   -9.490874844700062e-02   -6.759533859330296e-01   -1.294591839615803e-02   -8.938982292761727e-01; +7.102841478493704e-01   -3.414659113016196e-03   +9.964698861722060e-01   -1.095906162018044e-01   -4.145078322866906e-01   -2.156502975493878e-01   -2.744739372648086e-01   -5.744757784996317e-01; +3.735481782013186e-01   +3.710429279084768e-01   -2.720162993219384e-01   -7.850726038537985e-01   -6.746192594412939e-01   -2.506498832387397e-02   +1.010018567094932e-01   +1.248294463803444e-01; -6.999208774999039e-01   +1.860347761791317e-01   -1.932858360486259e-01   +4.121973528557308e-01   +4.837892276273866e-01   +2.780732077292465e-01   +5.797346095875202e-01   -6.833762290712050e-01; +2.560458649483497e-02   +9.918137271061511e-02   -3.214014355065555e-01   +1.000000000000000e+00   +5.984943480241517e-01   +2.733863100097799e-01   -1.661255031665009e-01   -4.500278253392871e-01; -1.463830011812741e-01   -1.837972453813069e-01   +6.228282519606954e-01   +2.320545107196907e-01   -3.708148569484309e-01   +2.382303982829352e-01   +1.500102298081462e-01   -4.120589978925518e-01; -5.187283559317647e-01   +4.270717184693436e-01   -2.123291030062791e-01   -4.608805746198591e-01   +6.501616288318257e-01   +3.941793512706409e-01   +7.977155192348070e-01   +2.639686656705663e-01];
L2I_L3I_iGABA_netcon = [-7.674365474481238e-01   -2.534179721988353e-01   +2.347592928518454e-02   +2.273321800510470e-02   -9.549398863137887e-02   -1.523193556836824e-01   +3.144967573600448e-01   -2.429263937081642e-01; +1.146536495137067e-01   +4.705373799733227e-01   +3.356488292591493e-01   -7.546412989165883e-01   -4.252139893783438e-01   +1.407846373323116e-01   +1.000000000000000e+00   +4.509554902833653e-01; -8.582720370360504e-01   +5.271788043150240e-01   -4.258623983135128e-01   +6.946380126018077e-02   -2.536636239608695e-01   +4.579076971000584e-01   +4.602015101780476e-01   -4.324204312499332e-01; -1.192821504082076e-01   +5.187644761178468e-01   -1.454148310179184e-01   -9.521101469873970e-03   -8.711293532698805e-01   +8.803041287448354e-02   +3.570714038645366e-01   +3.168086083899941e-01; -1.582623288973451e-01   -1.161590707116485e-01   +5.560618153447517e-01   -2.006004097587564e-01   +8.795253863347119e-01   +6.984258370135218e-01   +2.749677760630041e-01   +2.809429273781215e-01; -2.380741847780670e-01   -2.936521482024282e-01   +2.615691349848115e-02   -3.095663557951278e-01   -1.978583844697869e-01   -1.451167889223871e-01   -6.167712646782567e-01   +2.149137761661405e-01; +5.397347409565706e-01   +2.661212559091462e-01   +3.242883286488737e-01   +5.942198480645728e-01   +5.898560872015922e-01   +3.004983495648140e-01   -2.771338066992040e-03   -4.866737528953214e-01; +1.444639303705131e-01   -4.452928037311510e-01   +3.065316558151664e-01   -3.232811675842079e-01   -4.006885369573441e-01   -5.979027676433821e-02   -5.228530865421914e-01   -9.650376718688300e-03; -3.471648028580235e-01   +1.994338566058524e-01   +2.841601730839615e-01   -4.164044735518130e-01   +1.988980167524437e-01   -4.992981592291112e-01   +5.760729876646123e-01   +6.430385101901713e-01; -3.768040207826157e-01   -5.263632196958070e-01   +6.688220803037499e-03   +4.292533891977955e-01   -3.889830044432785e-01   +4.350785196159688e-01   -8.287185864553138e-02   -1.240059429031422e-01; +7.508011968143491e-01   +2.764597141412651e-01   +4.861777501732408e-01   +1.363162831303781e-01   -3.275144019709313e-01   -4.165091185673083e-01   +3.081298609927212e-01   -1.974975216734760e-01; -4.514379709578594e-01   -3.057968107951566e-01   +7.296753129372936e-01   -1.677180057265567e-01   -9.464922760620942e-02   -1.532111856922882e-01   -2.026905685801497e-01   -2.840231096770503e-01];
L3I_L3E_iAMPA_netcon = [-4.885665538537377e-02   -3.396310308527932e-02   +5.689578899423693e-01   +3.630697757410298e-01   -2.381147203319004e-01   -4.785701517555137e-01   +7.105932598299350e-02   +1.305133395093813e-01   -1.164342699218629e-01   +4.997644387903192e-01   -4.391246990544947e-01   -4.619133761697890e-01; +1.044433843482045e-01   +8.128207343306569e-01   +3.552434147615921e-02   +9.200276360086686e-02   -5.933046879304699e-01   +9.874072907751774e-02   +2.083450473537623e-01   +7.809414312417234e-02   +4.212642079994969e-02   -4.887654252864549e-01   -5.986772113416929e-02   +4.064084858553741e-01; -7.732299563205245e-01   -6.041573164002065e-03   -2.206872235405952e-01   -4.175834127849833e-01   +6.698389692466476e-02   +4.168397546577576e-01   +5.023839947471767e-01   +5.066150689114433e-01   -6.121699168898739e-01   -4.547919486062147e-01   +2.693844266485694e-01   +5.532098328913446e-02; -3.568379605444481e-01   -2.726110194993778e-01   +2.167461543217812e-01   +2.564276161926470e-01   -4.960003640640102e-01   +1.840632416543361e-01   -4.868840477367915e-02   -3.585058263802777e-01   -5.825459375386906e-01   +5.293124843898992e-01   +1.800171743125288e-01   -5.431717676036486e-01; +2.551429511200408e-01   +8.797190879498210e-01   +8.091269075035589e-01   -1.142428511696795e-01   -1.549670103012620e-01   -2.453444646446866e-01   -1.646503812433671e-01   -6.680262808313131e-01   +5.800833404444242e-01   -2.519292486999128e-01   +3.728382626654060e-01   -2.436159637479876e-02; +1.202924762282785e-01   +6.834812234838263e-02   +8.596807488601152e-02   -3.075589254643182e-02   +5.521291378501103e-01   +1.124756918737151e-01   -3.266470611474448e-01   -2.111374873681239e-01   +3.965366280077418e-01   +1.419506388632307e-01   -1.903244333893063e-01   +2.106283932796724e-01; +5.867295677323987e-01   +4.001700575690915e-01   -7.072306600910861e-01   -3.288520793394623e-01   -2.428272183103241e-01   +3.847799583127232e-02   -5.125178731933581e-01   +3.096416723096452e-01   +2.361150470903871e-01   +2.155877144368543e-01   -4.564801384593465e-01   -3.246226528842527e-01; +2.370076451143871e-01   +8.051436048251086e-03   -2.039234607734042e-01   -7.431898162714803e-02   +1.545656179814558e-01   -7.431252041390702e-03   +7.922491994825194e-01   +3.184720317590168e-01   -3.846137345945003e-01   +4.442656929224910e-03   +7.495390869856711e-02   +1.255007798266795e-02; -1.704710451305325e-01   +2.449579401222057e-01   +2.066750714223770e-01   -9.489314537686090e-02   -2.513654262797582e-01   -3.104590402542416e-01   -8.870835128332408e-01   +6.984191580234815e-01   +1.000000000000000e+00   -3.606986529553630e-01   +5.016032711328476e-01   +2.543437187776909e-01; +1.970028510916746e-01   +4.493562452002819e-01   +6.502885468885080e-01   +5.155298354334632e-01   +2.601832666375980e-02   +4.754213690728933e-01   +7.035720611942235e-02   +1.733625080361864e-01   -3.825045609986318e-01   -6.515334183820596e-01   -5.099698630691103e-02   +5.419765213333574e-01; -5.781844763566415e-01   -2.352345648018132e-01   -4.597758906998843e-01   +5.388257693031823e-01   -5.052203114422349e-01   -5.726124165454808e-01   -2.195883585665477e-01   -7.210932364196969e-03   +7.167611486243541e-02   -2.298247707011655e-01   +4.900583142893341e-01   -6.571633147245782e-01; -5.833269136304947e-01   +1.020129251399286e-01   -3.044784978006712e-01   -5.700364409093411e-01   +5.677976190992384e-03   -1.167279786316809e-01   -2.066257260775139e-01   -4.221489858755272e-01   +3.235198275378559e-01   +3.553385181152603e-03   +7.801868166236002e-03   +1.142048185121260e-01];
L3E_L3I_iGABA_netcon = [-1.221569540417292e-01   +3.678026278643782e-01   +3.117445286176360e-01   -1.000050171644116e-01   -2.861619908340364e-01   +8.488236057521201e-02   -3.068260860441293e-01   -9.039430662862737e-02   -9.657889017211381e-01   +6.460888564733631e-01   -2.410972667449864e-01   +1.971091043035328e-01; -3.819194356696270e-02   -6.237704216343316e-01   +3.466502785863642e-01   -1.033530265692104e-01   +3.780436219402570e-01   -1.244029819777568e-01   -4.881805371006325e-01   -7.670357637045597e-01   -8.445085277385719e-01   +5.754430597870414e-01   -1.111504638640479e-01   +8.643374341059775e-01; -7.842821744274829e-01   +8.162081203444405e-01   +1.141751739002519e-01   +1.172115609026013e-01   +2.276470816400842e-01   +4.102936449354448e-01   -2.360349017959125e-01   +3.454759414093975e-01   +1.115230585894397e-01   +1.772814873674119e-01   +3.647678349614167e-01   +7.471098749966770e-01; -3.546162337107776e-01   +4.252257332978867e-01   +1.000000000000000e+00   -9.029240034954554e-01   -2.760290450104155e-02   -1.403944326148070e-02   +8.649344735026847e-02   +2.551739021912163e-02   -9.260938431126006e-01   +4.797927494268371e-01   -7.777975389443227e-01   +3.451208340526949e-02; +8.028406480135550e-01   +4.660475234442248e-01   -1.469176561863561e-03   +6.159322014881349e-01   -5.717479939570990e-01   -2.024553589144719e-01   +2.722071218522275e-01   +2.897143533425793e-01   +3.642262804578201e-01   -1.751978117244204e-01   -5.661239122989544e-01   -6.498684227327661e-01; +1.905649632815353e-01   +6.432796896573835e-01   -2.971069180626452e-01   +2.698133742577682e-02   +4.855518863187874e-01   +3.874549446355899e-01   +2.080411046209720e-02   -6.344155274747715e-02   -6.950291820762591e-01   +6.260646946164791e-01   -2.078235894894575e-01   -7.422853078267800e-01; -7.631024485817379e-01   +2.289713365619131e-01   +2.181971900680429e-01   +5.536003377985615e-01   +6.537574433656830e-02   +5.998138631028854e-01   -7.458744872756845e-02   +3.007148602522493e-01   +3.347908433792183e-01   +4.382379111800306e-01   -8.851939736390706e-01   +3.614417873521534e-01; +6.485763516052516e-01   -3.091165965179494e-01   +3.663774605383271e-01   +5.827116067815605e-01   -8.723628193243591e-01   +4.676160810405210e-01   -4.049692733156136e-01   -9.422635400687185e-01   -1.608906878582175e-02   -7.169219390620762e-01   -1.029584506546571e-01   -4.547483046966819e-01; +3.366481285158882e-01   +4.497269136210827e-01   +6.166349454385792e-01   -3.598196088926431e-01   -6.691287810422708e-02   +9.665739858031965e-01   +3.074650112700835e-01   +5.169793487426880e-02   -6.582741705208141e-01   +7.330521912370790e-02   -1.517482305908938e-01   +4.317217130492003e-02; +2.069283941739204e-01   -6.798028004522977e-01   -6.741910206832753e-03   -6.716434336078154e-01   -1.211853523731550e-01   +7.388616241582300e-01   -1.528090819039214e-01   +1.321949798411821e-01   +6.607926635293477e-01   -2.801910386490342e-01   -5.348512175228263e-01   -2.511947036564821e-01; +4.478350945743157e-01   -2.225494967132312e-01   +4.324000142743065e-02   +4.539424228731264e-01   -2.794328642088348e-01   -4.869147296855505e-01   -3.106053746197892e-02   +2.992921847933727e-01   +8.284643402490461e-01   +2.825317573851099e-01   -1.391594182952517e-01   -8.021792509637096e-03; -3.336444974520021e-01   -7.853077285517962e-01   -4.814033530085760e-01   -5.360641018651634e-01   -1.218385153837797e-01   -4.314274762159290e-01   -1.338176715522454e-01   -8.844045533127043e-02   -3.382616853703729e-01   +4.671577966358718e-01   +6.078606163678716e-01   -7.102284043956596e-01];
L2E_Input1_iAMPA_netcon = [+6.104150021297807e-01   -5.679942524268012e-01   +5.088760302946097e-01   -1.803729210665286e-01   +3.229872669486491e-01   -4.327267706055684e-03   +6.740194798898724e-02   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+1.822226026660453e-01   +5.116373977613516e-01   -1.610668458458271e-01   -4.332303222368475e-01   +8.437021102092184e-01   +1.971008624985468e-02   +9.883399760722767e-01   -4.065926963976554e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
