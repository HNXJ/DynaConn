function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.713030729252616e-02   -8.932543808553575e-02   +1.985353674185095e-01   +8.393740759747359e-02   -1.078888339481573e-01   -1.637714771857204e-01   +2.344667707600935e-01   +6.409875951270187e-02   -6.792300322211434e-02   +2.733215292005199e-02   +1.897578860053524e-01   +3.129776537631682e-02   +2.983936208221864e-02   -3.812943977515425e-01   +1.937259154240665e-01   -3.933057852837410e-01; +1.021653044220914e-01   +1.339794552202426e-01   -8.030116173961112e-02   +3.187421657387037e-01   -1.972136889199032e-01   -3.094125745220189e-01   -1.371856372505111e-01   +2.094068332386603e-02   -2.650104992207796e-01   -1.311897508747757e-01   -1.258915599835284e-01   -1.830055587411650e-01   -2.102882703375507e-01   -1.095520815748641e-01   -9.651125167433094e-02   +1.030827591936792e-01; +1.166590209878599e-01   -2.783681507631842e-01   +1.523277234421837e-01   +2.276173715900970e-01   -3.992931043512821e-01   +2.960281377775860e-02   +1.105468851848638e-01   -1.211555741869782e-01   -3.662013791093298e-01   -1.502260468091297e-01   +3.652489614969408e-01   -9.793598006144015e-02   +1.604011368086874e-01   -1.646317113443846e-01   +2.587254489485962e-01   -1.335741006867913e-01; +3.419778838751134e-01   -3.208248047851617e-01   -3.058380634261326e-01   -1.289449969557513e-01   -1.254162153554247e-01   -5.585732481556956e-01   +4.995157502701411e-02   -3.494606895819308e-02   -6.940636142655654e-02   +1.463122924263846e-01   +2.652466671460588e-01   +3.963769136920071e-02   +4.505894880714764e-01   +2.701136411762049e-01   +2.127025618895889e-01   +1.429514678261258e-01; -6.938100892294802e-02   -2.902253538984976e-01   -9.525136489311634e-02   -1.850225949159506e-01   +7.615284278161072e-02   -1.194858098390075e-02   -5.699295591887608e-02   -5.912217169427087e-02   +3.215984325031322e-01   +2.983924106344198e-01   +6.432321942138444e-02   -1.140193811181930e-02   -1.594543646050545e-01   +3.928607882993045e-02   +1.534597615498924e-01   -1.405607375372526e-01; -1.067922679611738e-01   +3.414294856128460e-01   -6.005953532370907e-02   -1.848668230673487e-01   +2.098642364452522e-02   -3.431989326485166e-02   -4.274998678351159e-01   -9.117714321393802e-02   +2.715953335357725e-01   -2.055451957557419e-01   -2.341681206909631e-01   -3.765083190988396e-01   +1.375338094775284e-01   +1.275400909093946e-01   -4.739638338514758e-01   +2.572535838665240e-01; -3.359741787096387e-03   +2.197380356962294e-01   -1.375954242879299e-01   -8.390505898926211e-03   -2.936945279255133e-01   -4.312451262278584e-01   -2.461022986259895e-01   +1.018744238880211e-01   -1.235294005628784e-01   +1.074441783369078e-01   -3.880620356549067e-02   -7.635770631957231e-02   -7.591142311716302e-02   +1.375197583678164e-02   +1.623018336663206e-01   +5.659484311144663e-02; -1.401655523538335e-01   -1.391489316384157e-01   +4.067793172014497e-01   +2.326792889329363e-01   +2.245272842185498e-01   -1.862010885677371e-01   +4.905985707416693e-01   +7.832768827722274e-02   +2.065183333665237e-01   +1.045189732779025e-01   +1.398802527091891e-01   -1.240051804673481e-01   -4.914971822573999e-03   +2.477511429778647e-01   -5.476013997275886e-02   -1.273488970959213e-02; -2.752951551253424e-01   -2.691301755010386e-01   +4.201481544122160e-01   -7.117930232730890e-02   -2.517104231132880e-01   +1.341243295887898e-01   +1.985108459047163e-01   -1.012913531511028e-01   -1.148459867660523e-02   -8.122740033644858e-02   +1.234050194705272e-01   +9.736214751875653e-02   +2.524176801177835e-01   +2.812629220431710e-01   -1.772223932812572e-01   +1.766943906039699e-01; -1.445835657969032e-01   +1.139725917229882e-01   +1.173324197120784e-01   +1.912669596274488e-01   +1.559472996203989e-01   -2.831953232344521e-02   -2.057227087250190e-01   -1.339357920065937e-01   +2.376463711492992e-01   +9.664232704425856e-02   +1.428658298954074e-01   +1.558042433418091e-01   +8.359545261516402e-02   +3.054742571373368e-01   -1.959001388212616e-01   -2.272352431412475e-01; +2.135374974041176e-01   -1.134929641019120e-01   -9.688882955987807e-02   +7.801297283483304e-02   -9.860358910823244e-02   +2.543835295227564e-01   +1.849554683539945e-02   -2.378399935694126e-01   +2.054658656723057e-01   -2.017592319748404e-01   +1.302022754034389e-01   -1.927475217362842e-02   -1.863526075260608e-01   +8.857781508206146e-02   -4.908824034066522e-02   +2.747033482846814e-01; -2.635035409666049e-01   -1.519882468632819e-01   -3.136068013539096e-01   -2.338876096441327e-02   -4.934959492614688e-03   +2.112179766042027e-01   +3.687184084524283e-01   +3.736106149582123e-01   +2.535677697381772e-02   -7.311938621008796e-02   +1.410314385736444e-01   -1.200387872047008e-01   +4.536299585077753e-02   +8.344850067433501e-02   +7.555810365094306e-02   +6.831009358786416e-02; -4.368080112385807e-01   +1.328489674652126e-01   -8.363935735760661e-02   -1.723448097519175e-01   +2.772696004115219e-01   -2.008726283155594e-01   +2.698489769536402e-01   -3.813868453189658e-01   -1.260464821942929e-01   -3.058279137597923e-01   +1.890483983536102e-01   -2.918659068069753e-01   +5.652796143121656e-02   +2.438970408189438e-01   -2.019379691360666e-02   +1.170418356098880e-01; +5.257554743869797e-03   -1.821870793638956e-01   -2.041781080033993e-02   -1.067987695793758e-01   +8.070678291667339e-02   +3.332765736461724e-02   +7.544525783388611e-02   +1.470924910613740e-02   +7.780386715510648e-02   -1.654859410466255e-01   -3.906739814429083e-02   -8.443963520217559e-02   -1.882225548628122e-01   +2.832376701086408e-01   +2.084158576175380e-01   -1.742390223079310e-01; +1.002582104397758e-01   -2.940630026849860e-01   -6.913688071430683e-02   -5.612743740566790e-02   +1.740409154060706e-01   -8.904110920617460e-02   +2.612879808513324e-01   -3.028892125219236e-02   -3.428702416176823e-02   -2.559957010196277e-01   +4.079900236989736e-02   +2.863417853364492e-02   +2.793780296597739e-01   -2.437306382159988e-01   -4.574221418338559e-01   -4.505988372658537e-01; -1.752823961032273e-01   -2.989052383385423e-03   -7.653842426106051e-02   -3.812110076030415e-01   -1.086711340343246e-01   -2.570953110673975e-01   -1.526650194753122e-01   -2.043001223894714e-01   -6.882883285551977e-03   -3.881177916531957e-01   -3.245192421929874e-01   +2.502802587515268e-01   -1.333622725072901e-01   -1.311287746351609e-01   +2.353194252874767e-01   +2.858506231793180e-01];
L1E_L1I_iGABA_netcon = [+7.477654071817894e-02   +1.070812932973458e-01   +1.360108862959562e-01   +3.229733915220492e-01   +5.387360336813010e-02   -4.460824186303759e-01   -4.251679233932834e-01   +1.154682652316626e-01   -2.013951742423959e-02   -1.653166465336078e-01   -2.489071380447069e-01   +1.972649377133912e-02   -2.971979116678960e-01   -1.098610110068990e-02   -1.427620258630136e-01   -8.051740445448077e-02; -1.180210789014973e-01   +3.411827473224607e-02   +3.866739009772453e-01   +2.223856637767398e-01   +2.181153056377364e-01   -1.052336557227716e-01   -1.062155680596426e-01   +2.141382162358445e-01   -9.363842394842621e-02   +3.529727211642965e-01   +7.888335694233863e-03   +4.279513222114379e-01   +4.277354618576622e-01   +3.412947433774230e-02   -2.553763571297161e-01   +1.270337050115867e-01; +1.074350151137079e-01   +2.510469278122913e-01   -3.530824541574056e-01   +1.681600829947784e-01   -3.517029528938779e-01   +1.472806039858812e-01   +1.727218508037292e-01   +1.856067622895583e-01   +1.864380092284179e-01   +3.350231123732267e-01   +2.783998255762785e-01   -3.843433752576872e-01   -2.519010329197970e-02   -1.527065936142576e-01   -6.571417539414234e-02   -1.546267611376006e-02; -3.562750588200470e-01   -2.926496658862014e-01   -6.071949263884141e-02   +2.052818118448120e-01   +3.368616069948800e-03   -4.586235869701345e-02   -6.994554737855056e-02   +2.104515363993180e-01   +4.728082713890193e-02   -1.884314389925784e-01   +1.104419471480862e-01   +2.486575011187875e-01   -2.167632472830393e-01   -2.971405192669242e-01   -8.692089474671796e-02   -1.854052519489082e-01; -2.701947133258756e-01   -9.604266764701271e-02   -1.181161849208675e-01   -1.480366185004894e-01   -2.607822015154176e-01   -1.082745595422554e-01   +3.670046924379946e-01   +4.174326210402404e-01   +2.612046724083357e-01   +4.870733035029403e-01   -3.606492123141453e-01   -2.632485851762368e-01   +3.464928040618381e-01   +3.360725197064174e-01   +4.327239039434750e-01   +3.094459152806599e-01; +3.376151369715681e-02   +7.749704590949361e-02   +2.788439157258058e-01   +1.774354910826990e-02   -1.049893492350098e-01   +4.155068454591743e-02   +3.590495460276194e-02   +1.607255859304343e-01   +1.178371652210997e-01   -2.488447396084618e-01   -3.258190467021197e-01   -1.534710453935284e-01   -1.369747396565196e-01   -4.439377239499606e-01   -4.412361548083824e-02   +3.285336241896369e-01; -1.111620949088933e-01   +9.083153848105921e-02   -2.927808809966115e-01   +4.116527792751272e-01   -1.048291946693551e-01   +1.436704920631066e-01   -2.539837437083563e-01   +1.439965804653825e-01   +3.306858262608471e-02   +2.242940783420490e-01   +4.991386618575731e-02   +2.189499514108707e-01   -1.051253408111917e-01   +3.512200773237729e-01   -1.325486926071715e-01   +1.217781769420108e-01; +3.863391030481459e-01   +4.352435485033394e-02   -9.706917123390564e-03   +1.293517230071280e-01   +1.187687649687394e-02   -1.604505504373759e-01   +1.945305525140014e-01   +3.829114211660571e-02   -7.080496617248893e-03   -2.212099854092056e-01   -4.901836033706466e-02   +7.620205470094761e-02   -2.540248378180787e-01   +2.479278414839545e-01   +2.049521699170540e-02   -1.592852105521939e-02; +3.923824437688317e-02   -8.128016252814409e-02   -2.014977714220092e-01   +4.473726761426901e-02   +1.325880259614045e-01   +1.139398543541414e-01   +3.262373680426579e-01   +2.635385613686465e-01   -3.162775287745186e-01   -2.017236563367420e-01   -1.301040129063535e-01   +2.508272131489859e-01   -1.319032599101937e-01   +6.321892842291653e-02   +1.050572884042136e-01   +2.402659612242643e-01; -6.119412718119649e-02   -1.346858366571513e-01   -1.904620242811412e-01   +3.884287716749603e-01   -1.061013323741580e-01   +1.891554176547490e-01   +1.390728663460648e-01   -1.710645548281700e-02   +8.766933423094544e-02   +1.960311177360607e-02   -3.142750271994740e-01   -2.122237284522779e-01   +6.464843580288475e-02   +2.975354200981372e-01   -1.618640389295623e-01   +3.096479416467762e-03; -3.205728727607334e-01   -2.534713835212875e-01   +1.801727358524199e-02   -2.449656201150770e-01   -4.181332591515058e-01   -3.359995326658939e-01   -1.481866743401120e-01   -3.833918541301240e-02   +2.511194423620924e-01   -1.656028642409595e-01   +6.345198765371826e-02   +2.653231307968099e-02   -7.651426788945867e-02   -3.452438188012849e-02   +1.605883004790469e-02   +2.948856908368807e-01; +1.029650915839416e-01   +1.339267462091143e-02   -9.854222892745260e-02   +1.519651743353500e-01   -5.924685226199188e-02   +2.014918610752087e-01   -1.758361987531477e-01   -3.714219330176051e-01   +9.942956054335020e-02   -1.874145790241724e-01   -1.488016139536890e-01   -2.752882562521973e-01   -1.462188972221661e-01   -7.315924001422947e-03   -1.332898264165732e-01   +7.449675738931107e-03; -2.577982897035286e-01   +4.769031507023802e-02   -3.743998448045933e-02   +1.719031336549117e-01   +5.469953997255989e-02   +2.377135053538954e-01   -1.677019993115227e-02   -7.387653644991488e-02   -4.702300429502980e-01   -2.306670681090856e-01   +1.562532047099607e-02   -2.234745681181852e-01   +6.040170099035796e-02   -2.020618785867548e-01   -1.659596673400535e-01   +2.159937249892213e-01; +1.564165822069441e-01   -1.492651849013430e-01   -1.168421224277976e-01   -3.633155191725643e-02   -1.181806976712870e-01   -2.149479318049300e-01   +6.471036378516858e-02   -1.391808195874189e-01   +3.012696461346743e-01   -1.006167347486532e-01   +1.092758849625110e-02   +1.054984025857856e-01   -3.940693200153513e-01   +1.785378398672886e-01   +6.023102671606090e-02   -9.919528316939411e-02; +1.031524713560754e-01   -1.671984652859435e-01   +2.837975992595725e-01   +1.127683608480370e-01   +1.661152689444514e-03   +4.869706030252902e-02   +4.114411834707571e-02   -3.327973755217477e-01   +1.793659393215222e-01   -7.150874813411168e-02   -3.669066541368636e-01   -7.069281926157231e-03   +3.335757100469522e-01   -2.397501009021581e-01   -1.694210123815035e-01   +5.146475637520365e-02; +2.283845144874703e-01   +1.260220716298591e-01   +1.937647778758706e-01   -1.244984099078174e-02   -1.729252371754050e-02   -2.889222459960122e-01   +2.676847670297813e-03   -2.939717353968396e-01   -3.618970640456567e-02   -6.375335039003688e-02   +5.639112622159602e-02   +8.058861634488981e-02   +3.512389933804204e-01   +8.175549977076949e-02   -1.519758415188344e-02   -1.451832187388005e-01];
L2I_L1I_iGABA_netcon = [-3.146142309188797e-01   -3.740882736418411e-02   -1.869831002347899e-01   -1.795400171090175e-01   -2.247898916629099e-01   -2.178472409065838e-01   +9.420733789070604e-02   -2.988005650293998e-01; +1.337508357169367e-01   -1.788985782793509e-01   -3.647016489234048e-02   -3.785029677133239e-01   -1.496842249211536e-01   +1.758921585921957e-03   +8.253480763993071e-03   -9.278395645981530e-02; +1.287708011464048e-01   -3.399711541532402e-02   -1.642604302828723e-01   -9.340832196435120e-02   +2.155320830089887e-01   -6.741923204612621e-02   -3.400979369059697e-01   -4.667867502725396e-02; -1.293710124602154e-01   -1.227408169858954e-02   -3.541101752201224e-01   +1.052638181693284e-01   +2.538253069265157e-01   -3.366113511248361e-02   +3.674862544186225e-01   +1.219855445305450e-01; -3.146440864223643e-02   +1.141083996964453e-01   -2.058000987533224e-01   +1.908357938359549e-01   -3.288196010448598e-01   +3.181927069369054e-01   -3.444913062932756e-01   +4.127596648691791e-01; +1.141482628202394e-01   -1.246769620193668e-01   +3.094961007700316e-01   -5.505764913681203e-02   +1.346386685767413e-01   +2.884019366603531e-01   -7.142752832957713e-02   -1.489565386360524e-01; +5.668171556971273e-03   +1.617038164102007e-01   -3.564467312907718e-02   -2.266923337189303e-02   +2.674653950693056e-01   +4.669340915066190e-02   +2.641470419919922e-01   -1.065519337941651e-01; +9.232315807017401e-02   -8.451976045558263e-02   -1.026293180460630e-03   -2.164110347529004e-01   +1.931983887007665e-01   -3.809674842877006e-01   -1.039774621203402e-01   -4.090664506451054e-02; -2.175932008056950e-01   -4.192658689967549e-01   +2.808409256608959e-01   -4.207973361752243e-03   -4.946546815511003e-02   +3.718943178070769e-02   +3.308553380041049e-01   +2.325855863046548e-01; -5.703618987068806e-02   +2.841862332374038e-01   +1.310877772865970e-01   -5.783679029195457e-01   +1.930703259275181e-01   +3.177637672143259e-01   -2.184890754715021e-02   +1.354730119941059e-01; -1.558423018531438e-01   +5.082265937810528e-02   -1.237409118256459e-01   +5.346538312964405e-01   -2.876907368083683e-01   -1.869587910927815e-01   +6.439820415009902e-02   +8.203742723950978e-02; +3.429884892184959e-01   +2.692660077076302e-01   -1.835795495280451e-01   -1.861814709315820e-01   -5.657768861807030e-02   +3.488264676183005e-02   -1.920633348757028e-04   +3.767217410543280e-02; -3.447702318983098e-01   +9.263156795078423e-02   +1.188029201899030e-02   +2.692792547868583e-03   -3.809402851393205e-02   +2.636053232740883e-01   -2.850284480536875e-01   +4.767923255940915e-02; +7.211280785291951e-02   +1.522929322584717e-01   +6.737173036390603e-02   -2.059619071405633e-01   -8.548334912831898e-02   +4.400291566813032e-01   -3.213980108524024e-01   +3.314077453687845e-01; -8.942556482340318e-02   -1.569271947187196e-01   +1.898367835816358e-01   -1.324650452661098e-01   +7.914347662763273e-02   +2.441280411853591e-01   -2.571491027169774e-01   +3.734954333846875e-02; +6.436616444459585e-02   +2.662816119613804e-01   +2.833481196956503e-01   +1.210376683202981e-02   +1.647112351032387e-01   -1.873478609756317e-01   -3.979156323238109e-02   +2.251454808908346e-01];
L1I_L2I_iGABA_netcon = [+3.466149222535261e-02   -1.724287100345794e-01   -1.188993871604602e-01   -2.827697664131857e-01   -2.084588786768395e-01   -1.378402830836908e-01   +1.242202447156955e-01   +3.760827641558092e-01   +2.759234634533081e-02   +3.688882041805199e-02   +1.314295231423120e-01   +4.400000044701063e-01   -7.973395431393895e-02   +3.087526487840256e-01   -8.648298806708279e-02   -3.018928114983858e-01; -3.703824944924847e-02   -1.554174127727001e-01   -3.735194397452249e-01   -1.087624065896571e-02   -8.780932186486887e-02   -2.411608063627772e-02   +2.796988721034540e-01   +3.294739006362954e-01   -3.343058530816728e-01   -1.987559910309880e-01   -2.883819531220007e-01   -5.228090831700374e-02   +1.892851545966467e-01   -2.487058999961621e-01   +1.438557557535797e-01   +2.476389170631983e-01; +9.731072257978424e-03   -3.663231777878547e-01   +2.844119713479930e-01   +1.699435882524078e-01   +3.911247660090217e-01   +3.058748807114131e-01   +2.968103991134325e-01   -7.574191933447405e-02   +2.055712266993673e-01   +8.892041120091963e-02   -1.053085631016686e-01   -1.916614030179941e-01   +1.592203383337926e-01   +1.233887790559539e-01   -1.602768405639988e-01   -3.684197754938168e-03; -1.998989205106424e-01   -1.455546365404247e-01   +2.758017260754986e-01   -8.603218313113668e-02   -7.664062761474214e-02   -3.128564934054135e-01   -3.196402693145249e-01   +1.515450454466823e-01   +3.567214471835114e-01   -2.213273687359821e-01   +6.486102340165394e-02   +3.929060700156540e-01   -3.301234403567731e-01   +5.340483409907897e-02   +1.714439120154214e-01   -4.980147121453483e-01; +2.962263351252054e-01   -1.595605557302870e-01   +4.854992455002234e-01   -1.449481083587462e-01   +1.651872398162407e-01   -1.160520014788542e-01   +1.109274044125540e-02   +6.974059852107106e-02   -8.123197779058922e-02   +4.019113855084973e-02   -2.240084770192858e-01   +2.883864181058508e-01   +1.292274429940171e-01   +9.477799499364048e-02   +7.221235380986332e-02   -3.192403602101868e-01; -1.463375546564998e-01   +5.869357432021612e-02   +1.489602903853943e-01   +2.616721495769969e-02   -8.315396783979889e-02   -2.243015247926598e-01   +6.669354175733103e-02   +3.287465138929518e-01   +3.553719668626761e-02   -9.408942289621354e-02   -1.240399314403440e-01   +3.807287308036646e-02   +1.233450188716067e-01   +4.577164680111973e-02   -1.512912735386357e-01   -1.546615744929052e-01; +3.230394919148005e-03   +2.348293947229003e-01   +1.582382728339020e-01   +3.516908771164798e-01   +5.292205240064787e-02   +2.669173737017395e-01   +1.743521699605991e-01   +3.228671044548638e-01   +5.755795430940985e-02   -2.873662416125448e-01   -2.045314813535009e-01   +1.186701722643978e-01   +1.924972861327328e-01   -1.182915696485801e-01   +7.897085674252213e-02   +3.016806475278933e-02; +1.375766934267959e-02   -3.263059925505323e-01   +1.417918746592374e-01   +3.367164026927049e-01   +5.467098096828416e-02   +4.083884240202548e-01   +2.685410243121539e-01   -1.712975984792198e-01   -1.251216751422332e-01   +4.651014421385360e-02   +1.905751215387229e-01   +8.611570260301457e-02   +1.333502177240351e-01   -1.944555428423609e-01   +1.700945120155411e-01   -2.365131359823580e-03];
L2E_L1E_iAMPA_netcon = [-1.278384152991342e-02   -2.004715430243053e-01   +2.904549062096755e-01   +3.012313853037538e-01   +2.160297475452961e-01   -3.144499174059980e-01   -1.387457065769812e-01   +1.076239027101010e-01; +7.459368511976926e-02   -1.700174384637480e-01   -1.475296180696919e-01   +4.506098548087228e-03   +4.920427933213482e-02   -2.585490681291148e-01   +3.476496096503910e-01   +1.115275747779962e-01; +1.125874585247684e-01   +1.943891274944569e-01   -2.423958042570949e-01   +1.209308053909858e-02   +1.149024979653733e-01   +1.257154662926474e-01   +1.514260171544710e-01   +3.199311055091596e-02; -3.132766512883074e-02   +3.125827621329915e-01   -2.110112606466594e-01   -6.469615501300215e-02   -2.174518721891416e-01   -1.304636090421490e-01   -6.392027096590175e-03   -1.330560276146894e-01; -1.988800480287769e-02   +2.790725000979868e-01   -1.992586106809497e-01   +1.071681522297636e-01   +1.782220077621491e-01   -2.310245587116239e-01   +6.922775006423225e-02   +2.139239746654742e-01; -2.548106859829417e-02   -3.448157296191674e-01   +5.767241177812632e-03   -4.797871026804387e-01   -2.010326728309364e-03   +1.490076990338247e-01   -1.072194214661477e-01   -3.972359805879774e-02; +3.293064637872238e-01   -2.685404577355662e-01   -1.855604270916986e-01   -4.222961745002053e-02   +1.012177707941568e-01   +1.949716268462491e-01   -3.545740237436681e-01   +1.927475686871569e-01; +1.160835053410461e-01   +1.721936311669685e-01   -2.554506951427246e-01   -1.450770822806522e-01   +5.903346771561599e-02   -2.489923654782281e-01   +5.925507401293377e-02   -5.517899856086574e-02; -3.052905288341871e-01   -4.538618714226486e-01   +2.852007676750269e-02   -2.841912636364309e-01   +1.824566756661564e-01   +4.420152028898988e-01   +4.271318670727949e-03   -1.325300262995628e-01; +1.592232340994724e-01   -2.149506131267749e-01   -1.565120745598303e-01   -1.071923611605388e-01   +3.456901083497131e-01   +1.903000522061652e-01   +2.066087716034964e-01   +1.095358887661067e-01; +4.279133968375667e-01   +1.556629845017390e-01   -3.038626730879502e-01   +2.014871408807576e-01   +3.834797015868130e-02   +2.082712570256333e-01   +7.846463389267497e-02   +5.209071220032935e-02; +1.938936065823483e-01   -2.658127953217885e-01   +2.242057065013570e-01   -1.343807372511349e-01   -1.333416356312480e-01   +2.214802356370159e-02   -3.305255123782389e-01   -2.855407873564307e-01; +1.711269861838768e-01   +1.325565252840876e-01   -2.153456831601658e-02   -1.489349155512718e-01   +5.063030274820485e-02   +7.848002175800864e-02   -1.491976814789705e-01   +3.840404114293583e-02; -1.385163982962126e-01   -1.300648175226770e-01   -4.370011794725329e-02   -3.135137206351609e-01   +2.505547840382507e-01   -2.746102656988426e-01   +2.157974949082279e-01   -1.612531311793793e-01; +1.520171999817393e-02   -1.198796074795970e-01   -1.879435440141007e-01   -2.382866119863505e-03   +2.482862210756712e-02   +1.598160378189156e-01   -3.049604782567389e-01   -4.779954299192116e-02; +7.243990605593183e-02   +9.303753965665444e-02   -2.192345940021972e-01   +1.405388388159834e-01   +1.733212397274357e-01   +2.629542067303183e-01   +2.900473996227343e-01   +2.511203570786916e-02];
L1E_L2E_iAMPA_netcon = [+2.069326597415248e-01   +1.012478142163042e-01   +1.106843957268700e-01   +1.152162779468155e-02   +8.266833714039085e-02   +1.257134839092753e-01   -3.363120600077640e-01   +1.545608368533532e-02   +3.638651222865844e-01   +2.452961103572390e-03   +1.539919654668150e-01   -4.176876966338755e-04   -2.224473078431439e-01   -2.909180947988056e-02   +1.232895576196894e-01   -2.439187454022560e-01; -1.031886025393775e-01   +8.089811199967879e-02   -2.133333637290227e-01   -1.491399387717979e-01   +2.202167006489885e-01   -2.642303375051526e-01   +1.205039834409099e-01   -2.082963489784032e-01   -4.735637713088231e-02   -2.018843513355500e-01   -1.860982645734701e-01   -2.346938441744365e-01   +9.879434595865463e-02   +3.011281140448036e-01   -7.993259165742189e-02   -2.530339920476205e-01; +6.193925127982783e-02   -1.630819103566136e-01   +6.306483165598264e-02   +2.680761811822143e-01   +3.542025141293086e-03   +1.903729152357628e-01   -1.256435318416969e-01   -4.057196377226976e-02   -7.731437205790694e-02   -8.951348135649623e-02   +3.805398649377413e-01   -1.231745696145814e-01   -3.270418240349895e-01   +2.340144025035312e-01   -1.441508692221685e-01   +1.617106330344193e-01; +1.813081740376500e-01   -4.236846769458916e-02   -6.208734810648600e-02   +1.346980521422923e-02   +1.429036180077257e-01   +4.037890267633965e-02   +3.088457254504035e-01   -3.983671610662034e-01   +5.680466214740759e-02   -1.164394194983367e-01   -8.856599478946896e-02   +2.534418369790005e-01   +1.389548733331770e-01   +2.266025100409810e-03   -1.227652066593847e-01   -4.994948982370538e-03; +3.981554955600453e-01   -4.423417756245267e-02   +5.199419835861405e-02   +1.133534810887318e-01   -9.426315093320974e-02   +2.902101040550633e-01   +1.674667478424191e-01   +1.846606590047346e-01   -1.042048476424087e-01   -4.819023734746392e-01   +3.459331457102737e-01   +5.661897486779596e-02   -1.730873014420598e-01   +1.768272501829587e-01   +1.526626368828526e-01   +7.119448060048716e-03; +2.806060462394296e-01   +1.447236466254175e-02   +3.022660186245354e-01   +1.579305263121044e-01   -2.760243069962847e-01   +8.523593431989915e-02   +1.272985981261003e-01   +1.330264260986125e-01   -2.633925317167849e-01   -8.494628250196151e-02   -2.728298681747952e-01   +5.380082259800423e-02   -2.237174397007011e-01   +1.010495353732403e-01   +7.636421820567149e-02   +3.460409154944706e-01; -1.594100683332728e-01   -4.040283810339886e-02   +2.970478968198104e-01   +8.081655945824670e-02   -1.633937931091733e-01   +2.636577310255421e-01   +1.284762999897751e-01   -2.273413354261719e-01   -1.373234939630926e-01   -3.724987895929792e-01   +1.526300637565552e-01   +2.014745643240134e-01   -1.174568770939411e-01   +3.477099467624495e-01   -2.044714194848541e-01   +4.086653058632220e-02; -3.529929011771271e-02   -1.895069426060456e-01   +2.102779855450743e-01   -4.136360321033455e-02   +2.172843964676877e-01   -8.358649868191767e-02   -8.059570631277245e-02   -1.334041915190490e-01   -8.782776502447764e-02   +1.677875705724718e-02   +1.318011337889767e-02   +9.371309881373042e-02   +2.610256539917877e-02   -3.236062948406188e-01   +1.030565809022285e-01   +3.834206436751053e-01];
L2I_L2E_iAMPA_netcon = [+3.635670422813608e-01   -7.499306010771824e-02   +2.521916640787601e-01   -2.158415549012417e-01   -2.834672539134632e-02   -2.851362419109312e-01   +1.219477056697703e-02   +1.070599892118411e-01; -1.453011631292117e-01   -1.701320858906150e-02   -3.553782241687742e-01   +2.216840610091855e-01   -4.682838664545966e-02   -7.594557704353135e-02   -1.721723469271791e-01   +2.243022272631518e-02; -3.732760415703456e-01   +1.402550752722417e-01   +6.850746997181029e-02   +2.309400015344232e-02   -3.125159716022272e-01   +1.214253169240166e-01   +1.221488135251642e-01   -3.645479353120777e-01; +3.622578264099931e-02   -2.119960431942702e-01   -4.150273533742858e-02   -3.126464882400261e-02   -1.288044771474473e-01   +3.097126743923562e-01   +1.277980137038164e-01   -1.658967825704268e-01; -1.073065845413903e-01   +1.656483673453725e-02   -1.425966886863683e-01   +1.134880437511982e-01   +6.523726100530176e-02   +1.994132835309268e-01   +3.905319575610948e-01   +9.809222233086073e-02; -1.502091891627924e-01   +3.463006515924322e-02   -1.084297274213092e-02   +4.670850604287446e-02   +1.733866607305802e-01   -1.467105992052591e-01   -2.217548602176136e-01   -5.445807240958678e-02; +1.533240731692706e-01   -2.169957760836373e-01   +6.366634160495920e-02   +2.189083256540029e-01   +2.943656269854630e-01   -1.438068321326809e-01   +1.360978516623342e-01   +3.702294267693350e-02; -2.309727676169002e-01   -6.918697880525987e-03   +1.617351920099444e-01   -3.363496753644227e-01   +2.194572560754773e-01   +2.112821810913701e-01   -2.915711961134222e-02   +2.856732180488115e-01];
L2E_L2I_iGABA_netcon = [-2.533794556052754e-01   -1.144705517656469e-01   +1.294172883188199e-01   +9.601880511947833e-02   -1.019205139253963e-01   +5.567351678203530e-02   +2.421588901630485e-01   -8.890723757102377e-02; -1.321847269809365e-01   -2.231605858145158e-01   +1.467806406697257e-01   -1.147898758620851e-01   +1.670193538041511e-01   -1.823596573491574e-01   +3.397346355656262e-01   +3.604022519538896e-01; -2.975392565105109e-01   +2.332168518406849e-01   +2.458522226488614e-01   -2.133958861098830e-01   -1.533217934466203e-01   +1.215743334365045e-01   +5.213530753639732e-02   -7.949696571532712e-02; +3.744588202423912e-01   -2.899114089807843e-02   +2.482611000634271e-01   -1.959803086108645e-01   +1.646862160692721e-01   -1.214954368777702e-01   +1.218219561870676e-01   -7.741158860212274e-03; -9.816310216406118e-02   -1.878585285350748e-01   -1.428079890485308e-01   +2.268090624416167e-01   +2.061659354407928e-01   -8.780445990882413e-02   +1.980869850024416e-01   +2.084171846271037e-01; -9.560094543250174e-02   -1.625423486322635e-01   +3.161012498644739e-02   +1.378673118350710e-01   -2.892001929594766e-01   -9.857257157090389e-02   -4.836677655607954e-02   +2.111567683469740e-01; +1.956042731263432e-01   -7.222878869699116e-02   +1.898239201705437e-01   +1.069198275254030e-01   +2.420710430941876e-02   +1.581947401572556e-01   +2.552756357760873e-01   +8.779965797682400e-02; -4.316959145074698e-01   +3.575195395275969e-01   +2.959790688067295e-01   -1.385955383610435e-01   +3.562915104996386e-02   -2.860117898756537e-01   -2.459278868703822e-01   +2.941130508340342e-03];
L3E_L2E_iAMPA_netcon = [-2.285077660313591e-01   +4.051916604071229e-02   +2.949713732389733e-01   -3.911635287241346e-01   +7.094887371399816e-02   +2.600409975668614e-01   +2.407193049463922e-01   -2.046626136885878e-01   -4.513800523469840e-01   -1.137261964923251e-01   +1.118614068636685e-01   +9.907688248479452e-02; -4.437843892209618e-01   -4.990686306989389e-02   +4.700084884573454e-02   -1.422701866707328e-01   +1.101101757543495e-01   +1.254844748783016e-01   +1.088558836558957e-01   +1.187088112038889e-01   +1.625378134783091e-02   -1.104660557207112e-01   +1.360296786027109e-01   -1.489798215608805e-01; +8.134059187921423e-02   +1.680401383587187e-01   -6.773606123434019e-02   -1.390051841168121e-01   +1.347696406983396e-01   -4.668681986462578e-02   -4.644853895425669e-02   -2.238165887989494e-01   -9.521017559377036e-02   -3.154768613328289e-01   -3.232373744540397e-01   -2.664915606171577e-01; +3.789880379092342e-02   -1.187162589228073e-01   +2.307670428976063e-01   +9.328700944266621e-02   +1.046537528788769e-01   +3.282784338298906e-01   +2.199988539782895e-01   +9.032113502452419e-02   +2.354274348265428e-02   +1.935835605204470e-01   -2.160698507693001e-02   -1.276095596149161e-01; -1.203255740587981e-01   +2.770624147206369e-01   -5.378169298201827e-02   -1.455066706009089e-01   +8.277461902268679e-02   -7.782540635261324e-02   -3.428786464911549e-01   -4.268510861798201e-01   +2.530542172277051e-01   -1.439605819328689e-01   +8.562367512029194e-02   +5.585263026195518e-03; -1.169676138051184e-01   +1.062930095518174e-01   -6.258936932846879e-02   +3.561078921756060e-01   +2.110176501115363e-01   -5.660006013474752e-02   +1.910374660397320e-01   -3.586553819555524e-01   -4.018844712719948e-01   +1.734491330481930e-01   -1.465838527452422e-01   +1.043396185705438e-01; +1.171997909773965e-01   -1.077522071206044e-01   +1.658873580744243e-01   +3.073996560729519e-02   +3.064410338932870e-01   -9.241654756989504e-02   -2.174886226767279e-01   -2.571275730555210e-01   -3.659310554220171e-02   +5.347660546262223e-02   +7.757879152864895e-02   -3.710805195272524e-02; -4.303075608494521e-01   -2.067463971191282e-01   -2.717845409681809e-01   -2.401187728431591e-01   -1.007127373165162e-03   +6.153435340874341e-03   +1.023994930166557e-01   +2.450121150319499e-02   +9.827552222040062e-02   -1.565026385821413e-01   +3.517758537275502e-01   -4.756037084969196e-01];
L3I_L2I_iGABA_netcon = [+3.261773250818693e-01   -2.076101319009440e-01   -4.066297773734835e-02   +1.555428230104614e-02   -2.160629392169103e-01   -7.502200942362830e-02   +5.967795136937681e-03   -4.894349565244256e-02   +2.960676220631968e-02   +1.085530552745215e-01   +2.272864637448674e-01   +5.064170094301943e-01; +2.928968814561976e-01   -1.053969389615621e-01   -2.738852737377739e-01   +3.189537865053979e-02   -2.596515813054769e-02   -4.252764973885437e-02   +3.069756352689401e-02   +1.836986794809332e-01   -9.865909430411948e-02   +2.443275208830533e-01   +3.873815599476031e-02   +9.713658961415994e-02; +7.261135831229426e-02   -2.232135736259668e-01   +1.936925276920275e-01   +1.103496878296648e-01   -9.086351804974974e-02   -3.825902226291672e-03   +1.235869283872724e-01   -9.494886945147715e-02   -1.587352382602075e-01   -1.871906831357341e-01   -4.572978690290880e-02   +3.217191713386763e-01; -2.228991561438649e-01   +1.337030412219716e-01   -1.309827732512244e-01   +1.317670038530202e-01   +7.126394354146581e-02   +1.331399137989449e-01   +2.563454586272784e-01   +1.624531907262168e-01   +4.248188833973854e-02   -1.526544334418649e-01   -2.093202449459265e-01   +3.002664363212134e-01; +2.227819894605204e-01   +2.023088327920942e-01   +1.636640440118951e-01   +3.185251716406380e-01   -1.191240452219574e-01   +1.834783312882717e-01   -1.680735999356826e-01   +3.042084524391460e-01   -1.524136844274638e-01   +2.734120363601009e-01   +3.767307818067978e-01   +1.174514925809599e-01; -2.430091293899854e-02   +5.707247737246725e-02   -3.562814534184141e-01   +6.603368338671814e-02   -3.053434656445360e-01   -1.927889110079134e-01   +1.264648096648597e-01   -1.995840656884032e-01   -3.695980129074865e-01   -1.280224458472319e-02   +1.327955325874994e-02   +2.089632213549376e-01; -1.286542130604679e-02   -1.734985965396993e-03   +1.699043604634290e-01   +8.702799009406412e-02   +3.757062130350014e-03   +3.157134993020622e-01   -2.697082856094976e-01   -1.594361831149124e-01   +2.057822536624363e-01   -4.774484360628728e-02   -5.846053114416709e-02   -1.537096717241498e-01; -1.278982611959299e-01   -9.716965010657080e-02   +1.533625096395462e-01   +1.529616291274255e-02   +8.384013515325081e-02   +4.128071368296994e-01   -2.239821832009877e-01   +3.556014071091390e-01   +1.599903664725669e-01   -1.234413644127144e-01   +3.910919920397983e-01   -6.041273546603734e-02];
L2E_L3E_iAMPA_netcon = [-1.170302296299275e-01   +1.128469387110018e-01   -2.219986353999432e-01   +1.592518884966528e-01   -2.749819035991663e-02   -1.742773457204375e-01   -6.581497073395531e-02   -1.274573232680166e-01; -4.415497536241461e-02   -5.674436014435221e-02   -2.739653686157557e-01   -6.350697857237864e-02   -1.898898216616646e-01   -1.117848238056195e-01   -3.416157732640633e-01   +4.893471119384284e-02; -2.061919295683952e-01   +3.645853875199890e-01   -2.300599276687648e-01   -4.206944533694505e-02   +5.304503692619450e-02   -1.982404920535326e-01   -6.131014384944389e-02   +3.676798943272834e-02; +3.014554153361141e-01   +1.935406381342058e-01   +7.036468847103206e-02   -1.245640161399106e-02   -2.925264475396423e-01   -9.058572077767578e-03   -1.974191716870210e-01   +2.348860546202027e-01; -8.504380897388361e-02   +1.101943975425846e-01   +2.083531567334340e-02   +3.739162862390646e-01   -1.614091572404028e-01   +4.408951435552508e-01   -8.469470345374631e-02   +7.559893230717012e-02; +2.364391737643771e-01   -8.188670045006108e-02   +1.700376732422288e-01   -6.070064288409514e-02   -6.372475281015005e-02   +1.365981935454154e-01   -1.819895301686702e-01   -9.122476139233604e-02; -8.244129489523352e-02   +1.819672607277536e-02   +3.889404215928374e-01   +1.342613177516669e-01   -2.248999023206801e-01   +3.877696319925771e-01   -2.905412291418018e-01   -1.478805397914830e-01; -1.010490741426421e-01   +6.716063811093215e-02   -1.390059549291327e-01   +1.255533698229741e-03   -2.092133702923231e-01   -3.099886150677373e-01   -2.052365973336726e-02   +1.214666965811212e-03; -2.871894348926610e-03   -3.642530382160356e-02   -8.915999669439939e-02   +2.385841838303713e-01   +3.910454592917588e-01   +2.565226575090349e-01   +6.983505699853068e-02   -4.460972169320911e-02; -1.959787917596916e-01   +9.341567431693829e-02   +4.740673154286375e-02   -1.858855907844678e-01   -1.356567759798280e-01   -4.333013248103880e-02   +1.304293596197704e-01   -1.341671911318149e-01; +7.077203992876059e-02   -9.101562654388876e-02   +4.386615519417494e-02   -1.474087744217766e-01   -2.445807124862258e-01   -2.926135520133670e-02   -9.801557030615715e-02   -1.717025987859496e-01; -1.828020515427366e-01   +4.329959961121402e-03   -1.714939366967401e-01   +8.740988120343934e-03   -3.265865430258694e-02   -1.238034668309074e-01   +8.480974320419843e-02   -2.069407761914665e-01];
L2I_L3I_iGABA_netcon = [-1.967719033149407e-01   +6.736879307344931e-02   -2.801372617950938e-02   -6.890835747901032e-02   -6.065951110694384e-02   -6.015929584200459e-02   -2.592443347478338e-01   -1.327230851834228e-01; +8.483429914589136e-02   +7.454999731356346e-02   -3.608140120709272e-01   -1.566019254008759e-01   -3.188623064609376e-01   +7.974438874779785e-02   +2.372114695140966e-01   -4.868018719737470e-02; +1.257900406463724e-01   +3.725198478876332e-02   +7.102940425572299e-02   +2.490777473700934e-02   +4.477673501435764e-02   +5.591765997969790e-02   -6.964996256825978e-02   +1.312772678965024e-01; +5.834533257467205e-02   +2.185346829515574e-01   +2.076476246156704e-01   -5.571104911137868e-02   -2.722696265758621e-01   -2.501138136007928e-01   +5.005656900740013e-01   -7.249619384325634e-02; -2.635920188336990e-01   -1.318814733336060e-01   -4.242352025027794e-01   -1.979320640973236e-01   +1.029037978862903e-01   +5.600720675517648e-02   -2.527473378157754e-01   -1.204532783528694e-01; +6.495225141616251e-02   -7.740201400533828e-02   -2.163249830389108e-01   +3.294588623373472e-01   +1.571606027074931e-01   +1.213598014802727e-01   -5.035473174761554e-02   +2.047962968817796e-01; +2.830618123976336e-01   +8.050995728999949e-03   +5.194393125012892e-02   +2.653789434331666e-01   +3.113891837804378e-01   -1.247551153501449e-01   -2.271872281944382e-01   -1.837566973325334e-02; -1.333778444207778e-02   +3.953443598002361e-01   -6.234759163144477e-02   +2.945765247102600e-01   -1.373523411972591e-01   -1.917886437402039e-01   -9.626318714549945e-02   -5.413537847315739e-02; +2.387978400399156e-01   -4.194247383451186e-02   +1.476802977483923e-01   +3.594240446631058e-01   +2.786526424567159e-01   +1.175125177191692e-01   +2.228523018344360e-01   +1.101317255880718e-01; +2.601854544850336e-02   -4.601633757092237e-03   -5.326439680716217e-02   +3.909646564065299e-02   -1.993604154964913e-01   -2.710398381073750e-01   -2.340030130868226e-01   +4.011566734164693e-01; -5.144474606758168e-03   -1.012752001180012e-01   -4.656180512066366e-02   +1.707073536598509e-01   -1.138692991348891e-01   -3.274024269274250e-02   -5.159946681354943e-01   +3.418712196813456e-02; -1.615307640880343e-01   +7.704923510979927e-02   -4.471113079196926e-03   -2.952655289110834e-01   -1.089036584875821e-02   -2.965293778728743e-01   +2.451815389637415e-01   +4.370586665743750e-02];
L3I_L3E_iAMPA_netcon = [+2.055208421268548e-01   +3.181139984495204e-02   +3.681498386009622e-01   +4.319517781084615e-01   +1.906659085961178e-01   +2.216411690954753e-01   -9.327413422419821e-02   -3.297820654590675e-01   -9.154998137495748e-03   -3.408927051865490e-02   -4.798663787036940e-01   -5.542030089947161e-02; -1.326752384426291e-01   +8.423156570083051e-03   +2.393511861562878e-01   +5.825788533620604e-03   +2.164869715093725e-01   -4.918594151262408e-01   +2.829403137757573e-01   +2.324993744353955e-01   +4.787044965722271e-01   +4.004652957918499e-02   -1.755600754738744e-01   +5.180650185342948e-02; +3.700674460434897e-01   -2.297359108498573e-01   -1.434788184952471e-01   +2.223437703051475e-01   +3.076809538523906e-01   -1.932844261107063e-01   +1.901464112275406e-01   +5.129898440572410e-02   +1.832714412697563e-01   +2.008889024303614e-02   +4.745886563081710e-02   +2.827718293563809e-01; +2.584816516462303e-01   -2.200867958661785e-01   +3.595231038961726e-01   -4.891626750193182e-02   -2.613353046433573e-01   +4.357756833687369e-02   +2.282344662101621e-02   +5.154133101344222e-02   +2.148160363363974e-01   +1.935239184934095e-01   -6.169780983268391e-02   +1.411504963322525e-01; -3.132281594202476e-01   -2.285374856126818e-01   -8.471480310621093e-02   -2.849661044232126e-01   +1.399444279071162e-01   -1.081436361872284e-01   +2.763202126991540e-01   +1.022982286643433e-01   +1.329906379827530e-01   -2.695633341271061e-02   -6.140049775966339e-02   -3.043618489494825e-01; +1.065282742751736e-01   +3.366455760564468e-01   -1.361712474359924e-01   -2.264113214963977e-01   -2.929623933839667e-01   +2.314586331037846e-02   +2.473568581139249e-02   +2.934630433632001e-01   +8.511332510257269e-02   +1.712623148293991e-01   -2.880723873128573e-02   -4.910849366541604e-02; -8.160464559479119e-02   -4.225607394180586e-01   -1.886476966209656e-01   +2.396804008598008e-01   +5.715695640069327e-01   -1.530075502537079e-01   +4.130342321011810e-01   +1.751395688090661e-01   -1.260795161533292e-01   -4.876725318194781e-02   +9.955438206532032e-02   +2.542568022215456e-02; -2.499098901019474e-01   -1.689097108945037e-01   +3.443709853221594e-01   +3.674392024144685e-01   +1.775555299406101e-01   +4.621000017464150e-02   +7.882777949537408e-02   -2.225437239985671e-02   -3.488305714983726e-02   +1.571953304215007e-01   +3.136915041652373e-01   -5.645390564399368e-02; +5.844836505451359e-02   -1.454066896749157e-01   +2.153372481974752e-01   +3.084923157815381e-01   -8.331427802492371e-02   +4.245318363693674e-01   +1.598816005410337e-01   +3.979016587324224e-01   -1.451451833802576e-01   -9.182939446887667e-02   -1.385803687362401e-01   -1.477570604466727e-01; +2.302231555782315e-01   -4.868612516104848e-03   -2.995865853890720e-02   -2.004594132367348e-01   +1.116168062195574e-01   +7.671039391594923e-02   -3.909543121732219e-02   -1.337518522694600e-01   -6.854978386347509e-02   -1.839650524850059e-01   -1.308461914674411e-01   -1.291552938763211e-01; +3.824785401191235e-01   +8.348525042323959e-03   -4.474607927842050e-02   -2.477727304393087e-01   +6.811316254861174e-02   +2.508415577111071e-02   +1.315308285899734e-01   +3.128636477931382e-02   +8.755638739254459e-03   +7.532822170073049e-02   -9.530384312411383e-02   +2.903493831778515e-01; -3.624161217315464e-02   +2.555670678714908e-01   -1.905548494754298e-01   -1.895789458944056e-01   +2.347486707515590e-01   -1.721668432099045e-01   -1.599644873722433e-01   -5.654265744232658e-02   +4.240309259963547e-02   +2.567316986971816e-01   -9.060155960136429e-03   +7.384141976071901e-02];
L3E_L3I_iGABA_netcon = [-7.168025826546326e-02   +4.444464083914749e-01   -1.816670300357274e-01   -1.425246536510956e-01   +1.194067892583175e-01   -1.952406494443913e-01   +1.119283692876390e-01   +9.377027498039034e-02   +3.195050802678652e-01   -6.488704073051528e-02   +6.251600131865974e-02   -2.309490890640114e-01; -1.853305107799570e-01   -2.254395589127257e-02   -4.420444355170892e-01   -2.085132921306399e-01   +2.710516002311852e-01   -2.581408339074289e-01   -2.680175368563780e-01   +1.537887849735278e-01   +1.182937644919309e-01   -2.541449598779973e-01   +5.019489531887453e-01   +1.250657091974001e-01; +1.723140466473553e-01   -1.822415757342456e-01   +1.639692832207595e-02   +9.067436785787780e-02   -2.315908662891662e-01   +1.750197702481596e-01   +2.476581632159638e-01   +7.151639903040337e-02   -1.237368375479022e-01   -1.470313611671113e-01   +1.193001992458247e-01   -1.723265202699511e-02; +1.761666635821349e-01   -2.279805574362836e-01   +1.307878578898654e-01   -3.294139069540849e-01   -3.672743644392373e-01   +3.136373674864245e-01   -6.614713262787889e-02   -1.301674116046265e-01   +1.235991409017735e-01   -1.040046098876342e-02   +9.128990057430476e-02   -1.388141367930649e-01; -1.978356040670499e-01   -1.707330998598745e-01   +6.626876074409573e-02   +6.072795670851761e-02   -1.211131060016931e-01   -2.650052529511712e-01   -2.239032379208847e-01   -4.088654628659733e-01   -4.446925786644151e-02   +1.802423886867588e-01   -2.181507801563963e-01   +2.212720661228249e-01; -7.198189883227235e-02   -1.384775380451050e-01   +1.981400717912799e-01   -3.484860261826373e-01   -3.044163621185476e-01   -5.116748949272261e-02   +1.253158396817997e-01   -3.236286268016060e-02   -1.684705282355366e-01   +1.006593459074168e-01   +1.228735298069335e-01   +2.445789293932032e-01; -2.167483305288979e-01   -2.396284075326479e-01   +7.374234887247574e-03   +1.415520195860596e-01   -1.221514832629568e-01   -4.333440833304624e-01   +1.824894438916215e-01   -7.017545660515195e-02   -1.098192470909173e-01   +3.599515556813890e-01   +1.634859704216427e-01   -1.938941555673225e-01; -8.545785997433961e-02   +1.504250369624911e-01   +8.286712465779573e-02   +9.951829923772047e-03   -3.494702876024038e-02   +3.268427538996930e-01   -9.365036602779182e-02   +1.790454166604375e-01   -5.789104460945436e-02   +7.897046146727775e-02   -1.401884954642449e-02   -2.993733008775312e-01; -1.622027829969445e-01   +1.236025689289113e-01   +2.360911465266313e-01   -1.191984701419384e-01   -4.190833372692135e-01   -4.209249403766722e-01   -3.962460418524631e-01   +6.272630555760275e-02   -1.143181940917754e-01   +3.174761253746083e-02   +8.367700815099660e-04   -3.142586539125569e-01; +1.866746991411119e-01   -6.818647459669211e-02   -1.046524945314359e-02   -3.656894749817370e-01   -1.745432204756344e-01   +9.746848312493991e-04   -3.718867371579991e-01   -2.187363402829723e-01   +1.850759117456822e-02   +2.182451544804723e-02   -1.408833877384724e-01   -1.830130966435529e-02; +3.795667247899195e-01   +1.932789750288896e-01   -2.761193317358405e-01   -1.476418908723116e-01   -4.933518744497420e-02   +3.288762107756222e-01   +2.277852300219055e-03   +1.449434971467596e-01   -1.701222544579633e-01   +5.743970512615244e-02   +6.711791154750391e-02   -7.196325737361307e-02; +1.692970349436536e-01   -1.385907164132921e-02   +1.409781899528841e-01   -5.787617749040243e-02   +4.590357568599258e-01   -1.350485067399012e-01   -1.684457516511663e-01   -8.900712557766602e-02   +1.098764203001230e-01   +4.870266704019106e-02   +8.281060316356471e-02   +1.269145828426670e-01];
L2E_Input1_iAMPA_netcon = [+2.794017429796249e-01   +2.275547457871329e-01   +3.857825412543736e-01   +1.118707575379724e-01   +2.651419852245506e-01   +1.166772485182571e-01   -6.262264794726519e-02   +5.228839872546436e-02];
L2I_Input2_iAMPA_netcon = [-1.642629931584402e-01   -2.413411434679582e-01   +3.042602633736093e-02   -3.042277922129135e-01   +1.806266639517415e-01   +3.847917179559901e-03   +3.285927103588890e-01   -2.158070166831610e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
