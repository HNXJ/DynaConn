function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.954334571890970e-01   +3.374707079436345e-01   +6.167821167954658e-01   +1.558352281615157e-01   +3.578090794978474e-01   +8.025466657919639e-01   +7.254998887293361e-01   -4.761193130339369e-02   -2.214698900728028e-02   +1.541230223444148e-01   +5.777577813436943e-01   +5.922582406942293e-01   +4.660971237275250e-01   +3.795935847822952e-01   +7.975023681146152e-01   +5.052824350906920e-01; +5.172636515058405e-01   +1.410935930205394e-01   +3.323534924052884e-01   +3.758407048223936e-01   +4.390810136394787e-01   +2.705286402142933e-01   +2.563359901901962e-01   +5.330652023078620e-01   +8.033613763608869e-03   +8.116016884902992e-01   +4.895759039656569e-01   +7.144424937919952e-01   +9.169300944173930e-01   +2.852546224629720e-01   +6.750681407008207e-01   +4.624532944313535e-01; +1.765810527513977e-01   +3.592826031786325e-01   +6.469339056084679e-01   +7.758558617173189e-01   +8.962260623951283e-01   +2.556962316366180e-01   +2.194176308947129e-01   +5.707472736398246e-01   +5.639498597016170e-02   +6.550570500627502e-03   +5.447116169196857e-01   +8.905508452430899e-01   -1.660007731840845e-01   +2.646563585313955e-01   +5.963367870840144e-01   +1.157973434272804e-01; +4.563641294842864e-01   +7.284660085977803e-01   +7.544406560110480e-01   +8.742338791864529e-01   +1.445023137815357e-01   +5.688223972404265e-01   +8.819391688134980e-01   +5.470769550746925e-01   +8.110298016166978e-01   +4.155367909651356e-01   -1.165609060610374e-01   +5.606272824787680e-01   +5.499299779883473e-01   +7.216645738084591e-01   -7.012303784840507e-02   +3.504681776483242e-01; +2.087999650999496e-01   +6.674284913885536e-01   +1.635074924053102e-01   +4.390083267219681e-01   +2.646674412565946e-01   +1.271143434873269e-01   +3.514270405472266e-01   +4.753092756516005e-01   +7.484934611303704e-01   +2.488925673687851e-01   +6.349721385694470e-01   +6.363560928231439e-01   +1.075356738853811e-01   +5.929238711156348e-01   +4.746797872986006e-01   +2.759599155539004e-01; +9.886498211431394e-01   +7.748814314393533e-01   +4.859594392386600e-01   +2.347235965175715e-01   +3.133074827953696e-01   +7.190485271278578e-01   +7.992338096445100e-01   +1.593526047616266e-01   +1.113174715262447e-01   +7.539036489863163e-01   +2.705006415890803e-01   +8.225223849798793e-01   +5.931191300377228e-01   +5.861884548688467e-01   +9.925359809207097e-01   -5.812403548466644e-02; +6.910983432628853e-01   +6.030936231928620e-01   +5.488706434333070e-01   +4.469216913403736e-01   +5.367808383532532e-01   +4.148857639206091e-01   +6.258723712744535e-01   +4.206224233742175e-02   +9.584682409622688e-02   +2.209999854674334e-01   +3.624580394925279e-01   +4.441832319486246e-01   +7.010010408425058e-01   +3.974654626654551e-01   +6.600864031488137e-01   +1.504234465677869e-01; +5.434563740563979e-01   +4.743831396663162e-01   +1.090905907445264e-01   +1.322947091307108e-01   +2.909032397914001e-01   +2.672615297941507e-01   +5.640582246694600e-01   +4.420041027896947e-01   +1.586162935061496e-01   +3.191707526552126e-01   +3.901429796771399e-01   +2.576374915198628e-01   -1.248808434018558e-01   +6.972951904414543e-01   +2.286367347714816e-01   +1.177977077931075e-01; +6.996797330862218e-01   +2.619647276630329e-01   +7.445010874410403e-01   +5.684945136888836e-02   +6.766116875435643e-01   +5.317646791526033e-01   +1.095749004695082e-01   +1.718395207581420e-01   +5.948467261628358e-01   +2.463259711021592e-01   +3.921342007723355e-01   +5.514793910535184e-01   +6.484725621312065e-01   +5.985301347111083e-01   +4.237475506101236e-01   +5.677154838025374e-01; +1.250873478921572e-01   +6.257973910764975e-01   +3.937546718002066e-01   +3.418086888961367e-01   +6.073514833540846e-01   +1.000000000000000e+00   +5.777264191422938e-01   +3.832300527567825e-01   +3.149437488172445e-01   +7.000288481945072e-02   +3.778147900070692e-01   +5.382964085060761e-01   +2.808782516085781e-01   -9.359222400106872e-03   +4.136660795751520e-01   +2.721648109922041e-01; +1.666612525469823e-01   +6.294874219275916e-02   +3.755449564973136e-01   +5.170374209357123e-01   +6.532830461832932e-01   +7.487780611435498e-01   +8.036076907167432e-01   +2.450894456233412e-01   +9.180897427946554e-01   +1.953870302382289e-01   +5.966899526132625e-01   +4.999548850230747e-01   +2.048593118287191e-01   +9.235471005963508e-02   +7.269187020206200e-01   +3.151512102969058e-01; +3.804193704583875e-01   -1.127028428542592e-01   +1.484643972087325e-01   +3.899886799018456e-01   +8.886467437837309e-02   +7.776628579628985e-01   +3.068238485737658e-01   +8.880570872508153e-01   +7.067020645178950e-01   +7.492573132153805e-01   +4.016686143221380e-01   +8.200818314232766e-01   +4.034257927401722e-01   +2.465144271143867e-01   +6.009536196460183e-01   +7.456906004981041e-01; -1.013627745063025e-02   +9.167905163705577e-02   +7.222951532968392e-01   +2.263722011687478e-01   +2.583095617346926e-03   +5.771864277409817e-01   +5.873403370471437e-01   +6.975312004753355e-01   +8.378735382603240e-01   +8.758705738990140e-01   +2.322343253332500e-01   +6.520484383183615e-01   +7.369327764216451e-01   +6.360987320135947e-01   +9.905900999975125e-01   +2.723851349601765e-01; -1.009615244558592e-02   +8.890171426137473e-01   +6.073878913170370e-01   +2.172229080588287e-01   +3.351656840684343e-01   +7.148715646978253e-01   +5.730795678864538e-01   +6.754802738588654e-01   +1.808746335432064e-01   +7.434344038260934e-01   +7.786537752983185e-01   +4.588478071219380e-01   +8.454825679125447e-01   +5.466774479929101e-01   +3.918431485644815e-02   +7.397673808310026e-01; +3.077408336879297e-02   +4.132264417148303e-01   +7.473037037436113e-01   +6.837781967918363e-02   +1.516563664453289e-01   +3.008975512711367e-01   +7.801998989016453e-01   +7.632431075173675e-01   +4.107833595984597e-02   +9.237252213990487e-01   +2.961069028075169e-01   +1.663351730601679e-01   +2.941976915505724e-01   +1.251848367128691e-01   +5.724144325267241e-01   +5.403101484442806e-01; +3.720116289516668e-01   +6.666201314091948e-01   +7.804090263827033e-01   +7.029271145980368e-01   +7.053677147488125e-01   +4.299747855540322e-01   +1.934026383357877e-01   +4.707583410787885e-01   +5.082704989386462e-01   +7.170662460496450e-01   +4.898249440678796e-02   +4.871486878810118e-01   +3.868610652490296e-01   +8.285807253071250e-01   +6.642254539465299e-01   +8.405275032617089e-01];
L1E_L1I_iGABA_netcon = [+3.436109151933179e-01   +1.551472303480623e-01   +2.448337315280682e-01   +4.538929909230437e-01   +3.853447744159050e-01   +4.023406206990975e-01   -1.685443563666381e-02   +4.710748325606677e-01   +5.598276682250483e-01   +1.556988723368653e-01   +5.998670950704659e-01   +4.634475860596472e-01   -1.279462234111198e-03   +5.946186685813601e-01   +6.052884269118217e-01   +2.096471005801549e-01; +3.451454047042756e-01   +3.798336245448239e-02   +6.318957362150197e-01   +5.526279000673588e-01   +3.490460265918890e-01   +1.425789822895174e-01   +5.217190693479524e-01   +3.910595129631565e-01   +4.750818388866099e-02   +3.206187705032478e-01   +1.731179404594748e-01   +3.983968574517218e-01   -6.868796619119164e-02   -4.125722614076615e-02   +5.943209598952244e-01   +3.513876325919675e-01; +4.219910711603092e-01   +7.095253827260470e-02   +4.364477539390841e-01   +5.359021883593106e-01   +4.047818055601827e-01   +4.259547020776107e-01   +4.221666171659750e-01   +5.593408716566151e-01   +2.672581724156113e-01   +3.301776508135694e-01   +4.590016971321682e-01   +3.445843343796222e-01   +8.382834109412816e-01   +5.421716877560969e-01   -1.411045146006197e-01   +7.033569158555634e-01; +4.368569170776505e-02   +7.927077906291328e-01   +5.860133397025535e-01   +2.263149436326429e-01   +7.291919369541208e-01   +6.315008835074066e-01   +9.868743261533636e-02   +5.629975674717274e-01   +2.180807364852422e-01   +4.916474275709951e-02   +6.700076813960511e-02   +2.571867174793885e-01   +1.390408719885514e-01   +4.151383851544137e-01   +1.472980055982313e-01   +4.809235314139190e-01; +2.420581327936299e-01   +8.899971826530631e-02   +9.449132846872042e-02   +3.618938080811158e-01   +6.618339071421059e-02   +4.766271275114056e-01   -9.658825102409851e-02   +4.186951662522797e-02   +1.237798316898042e-01   +1.029641872409926e-01   +1.154732293277628e-01   +8.333074428287987e-01   +2.990581631809708e-01   -9.892450360158250e-02   +5.808655136788041e-01   +9.547907658664193e-01; +5.077151472378442e-01   +6.256537835527995e-02   +1.622502743868240e-01   +2.820661229863925e-01   +5.330278982304999e-02   +4.509391815510759e-01   +2.200342316009227e-01   +7.005005500447085e-01   +4.644379269323117e-01   +8.755603124870578e-01   +6.456642400802267e-01   +8.244296973085727e-01   +5.485758087500653e-01   +4.409007797493528e-01   +1.304691851779268e-02   +2.445585511426999e-01; +5.244135884947784e-01   +1.218063542574584e-01   +8.178468791199781e-02   +2.088558893453051e-02   +7.003289106338425e-01   +4.968090016164372e-01   +7.199814130264444e-01   +6.879058115703970e-02   +3.040990516015861e-01   +8.519554245978415e-01   +2.776686874409040e-02   +6.518385877535613e-01   +3.949154639217735e-01   +4.687618234873857e-01   +1.956309252178671e-01   +1.946805148698769e-01; +3.948208858225834e-01   +1.139308969603794e-01   +7.284328614277228e-01   +9.491858555871323e-01   +1.051405456073499e-01   +5.640364325033366e-01   +1.336378208222746e-01   +6.891155939934624e-01   +2.876858431137893e-01   +2.409755260308496e-01   +6.557762979872732e-02   +6.714956343956470e-01   +4.836621380038985e-01   +5.714552474080112e-02   -6.119339859707721e-02   +5.040734412245221e-01; +1.120935727062314e-01   +7.478395314111445e-01   +4.649082826350810e-01   -5.149695735022707e-02   +6.962966549691864e-01   +3.675574452534264e-01   +4.255662735688753e-01   +3.052612426317047e-01   +2.280949486306287e-01   +7.749699598326892e-01   -8.764075595518184e-02   +7.383290947002860e-01   +1.545760674459042e-01   +2.540585148386857e-01   +1.400289925549327e-01   +3.846565491302379e-01; +3.400055688194081e-01   +4.433550599188850e-01   -3.779687291269318e-02   +4.201355140878592e-02   +6.783679811208926e-01   -1.494819998416806e-01   +4.913263251268303e-01   +8.313911017509972e-01   +2.556376200630777e-02   +6.492415784042341e-01   +8.833398341732240e-02   +7.162757672478899e-01   +2.389237684705759e-01   +2.940723704515111e-01   +4.198367443752143e-01   +7.633856057625804e-01; +8.550272087334490e-01   +4.424612059248960e-01   +5.477894453631224e-01   +7.150597679703248e-01   +6.220572932700783e-01   +4.118813654043135e-01   +8.170534106037824e-02   -3.685987814003014e-02   +6.125127455457351e-01   -4.200375304542858e-02   +4.757525358764115e-01   +5.350917113585499e-01   +1.116987947208423e-01   +8.835640725718641e-01   -4.028776178641479e-02   +4.296141158469650e-01; +6.074446429935111e-02   +5.664282356335016e-01   +3.019925615529808e-01   +8.411677558963567e-01   +3.890905556204904e-02   +2.764759413332725e-01   +2.881003849172088e-01   +3.712338094750089e-01   +8.343254396399731e-01   +3.211359951516696e-01   +6.032720935978071e-01   +7.303327941075324e-01   +1.993359521901161e-01   +6.971332304929261e-01   +5.772399133005812e-01   +4.225845612854910e-01; +9.410691753347382e-03   +5.851450498061070e-01   +1.482959405748129e-02   +5.997360381576650e-01   +6.658793746173022e-02   +5.995822529885380e-01   +4.051612084110113e-01   +4.761031181362338e-01   +4.384263267253045e-01   +5.945864344047777e-01   +1.919388860714839e-01   +9.087306644654392e-02   +2.591444952053814e-01   +3.071282096868311e-01   +2.668331615826958e-01   +7.448363235614837e-01; +8.375753490437046e-01   +3.428853279144183e-02   +4.591255861688739e-01   +6.030169034299097e-01   +4.262955703335051e-01   -9.437572084697635e-02   +3.475983984684519e-01   +5.432712956512931e-02   +5.843825404113541e-01   -8.488852406340897e-04   +4.655601425019836e-01   +6.956394202108597e-01   +4.702764967132744e-01   +7.318603819293735e-01   -4.635021671479696e-02   +3.787443857137673e-01; +9.517983410118759e-02   +4.506973439219615e-01   +4.463656994196165e-02   +2.229910532839578e-01   +5.784808261558329e-01   +3.169321952792999e-01   +7.043050942917606e-01   +5.745363330363584e-01   +8.391786046638057e-01   +6.030836803959111e-01   +6.686315788254908e-01   +3.170699522794006e-01   +2.928988956329947e-01   +7.056805948302351e-02   +3.156708307687245e-01   +3.033687337145849e-01; +3.788705443226204e-01   +1.532488705504495e-01   +5.335650530695996e-01   +2.707091485527404e-02   +3.750028235484305e-01   +7.475682728161043e-01   +4.755075381516844e-01   +1.456885808152243e-01   +6.893705602695398e-01   +7.108017727585838e-01   +7.590269478161688e-01   +4.118067527682737e-01   +4.906917386710144e-01   +9.738252052109309e-02   -5.494830694959815e-02   +4.356748053004823e-02];
L2I_L1I_iGABA_netcon = [+3.676354743176584e-02   +5.349765161783240e-01   +6.208303785782381e-01   +8.933221477142564e-02   +6.998775548976338e-01   +2.112465546052991e-01   +4.845620633197108e-01   +7.317263574080001e-01; +1.657840445837620e-01   +2.284421526682255e-01   +2.370730510957916e-01   +9.803801667112175e-02   +7.960374262369038e-01   +1.076765141584514e-01   +4.664545586754387e-01   +8.376241828133497e-01; +2.238684669402196e-01   +5.288099490267697e-01   +5.025526769256236e-01   +6.084214194532869e-01   +4.362857103379300e-01   +4.603400802590508e-01   +2.037014659935163e-01   +8.880326981584877e-02; +4.138190207033390e-01   +4.863019635200730e-01   +4.430059511223280e-01   +7.764459791019136e-01   +2.719227976078374e-01   +6.307841672724820e-02   +4.913955912283772e-01   +1.261421324954716e-01; +9.988929178138733e-01   +3.157821870020084e-01   +3.257214759570902e-01   -2.833725669203194e-02   +6.149482423960023e-01   +1.105604639518008e-01   +8.990577876489854e-01   +1.275878344998478e-01; +5.257797045430915e-01   +4.917651115098966e-01   +7.234068115960284e-01   +7.799414619615017e-01   +6.772912350387287e-01   +6.343476116579743e-01   +3.177017769865307e-01   +5.655183734214355e-01; +8.481403733580948e-01   +2.815496028698909e-01   +4.164264428497201e-01   +2.469316829810096e-01   +6.907497676077634e-01   +4.134030423976137e-01   -5.884100177974024e-02   +5.196863629348243e-01; +6.223845275755122e-01   +3.875988457647303e-01   +4.436927451033354e-02   +6.276308292063214e-01   +6.480309740703135e-01   +8.236969721788933e-01   +4.907828568477883e-01   +2.215410868506828e-01; -1.893030408800409e-01   +4.785286259561180e-01   +1.363473153135254e-01   +3.663535105866989e-01   +4.000793324696935e-01   +5.519288971520995e-01   +4.993560714982715e-01   +2.522244017304259e-01; +6.150742017754849e-01   +9.441788656229299e-01   +3.349812226750277e-01   +5.530483436602354e-01   +2.409578827895760e-01   +2.055554593769236e-01   +4.312291245241573e-01   +1.786491646642353e-01; +3.011674696294890e-01   +9.687852599907693e-02   +6.069793662560966e-01   +4.987469763983835e-01   -3.272702908604854e-02   +1.097982246234817e-01   +4.415797398524517e-01   +1.077201603320970e-01; +1.639213692811888e-01   +1.669124763328943e-01   +1.850507121339828e-01   +5.191364787273651e-01   +1.591845324956248e-01   +5.009009755658533e-01   +8.721325771145041e-02   -2.708756163382477e-02; +7.282429371586425e-01   +8.505347086987722e-01   +2.354650520571612e-01   +4.842056400100816e-01   +3.435346796351713e-01   +1.449855518427940e-01   +4.446965095659355e-02   +7.885640773779502e-01; +3.232528983710155e-01   +8.329751688322932e-01   -1.377064092876544e-02   +8.717573303917447e-02   +4.727014032083812e-01   +5.057877768008437e-01   +5.601757974556967e-01   +5.039125016477262e-01; +2.859555625320294e-01   +2.986409710376742e-01   +3.351519104456031e-01   +2.403347549378165e-01   +4.908236449343738e-01   +1.020804988518846e-01   -9.013782602277730e-02   +4.614940358811109e-01; -7.841997886473508e-02   +1.515053070775701e-01   +2.233838510815196e-01   +1.479046143261606e-01   +3.832016172794674e-01   +7.189979746647334e-01   +2.302184025843816e-01   +3.497188837498380e-01];
L1I_L2I_iGABA_netcon = [+1.211733056985822e-01   +6.270101508326705e-01   +2.309112374392439e-01   +1.642962490575521e-01   +8.465138946095387e-01   +8.127562660312794e-01   -1.675237693517135e-01   +1.676802957273563e-01   +1.237543121912827e-01   +6.275277682337438e-01   +5.743617977036923e-01   +3.796749602697906e-01   -1.490141981977599e-01   +3.181083110106937e-01   +6.720235517927756e-02   +5.989482185732030e-01; +6.768446823394213e-01   +5.155553905681052e-01   +3.720261934580344e-01   +2.271944641753450e-01   -3.888728824538300e-02   +2.081719933666767e-01   +4.743029050185907e-01   -6.016179647579614e-02   +2.913142188702748e-01   +1.779204439243178e-01   +3.462047425431209e-01   +1.684057605066739e-01   +6.250200947915933e-01   +4.589447224625345e-01   +1.000000000000000e+00   +8.082714113869741e-02; +3.053556256006540e-01   +3.335566924771033e-01   +8.906591550916872e-01   +2.686950591177790e-01   +1.927345865770695e-01   +2.115123290850021e-02   +7.361656102640940e-01   +4.795804640233746e-01   -1.667675861330835e-01   +7.006789134942469e-01   +2.166672416757412e-01   +3.636520273048139e-01   +7.406872940804179e-01   +5.589665703963076e-01   +9.753133413576318e-02   +1.879775208093980e-01; +6.110831268253146e-01   +4.945802042708261e-01   +3.732499231429066e-01   +2.524706967773188e-01   +6.351827031999708e-01   +4.294760688205130e-01   +4.135326460046881e-01   +9.229963433833369e-02   +3.869556359574303e-01   +2.393033139577772e-01   +2.019018480443520e-01   +1.638992690318934e-01   +3.540293814890985e-01   -2.133847569153718e-01   -5.043469231224035e-02   +3.956681792382390e-01; +6.263928425235946e-01   +5.438009441765578e-01   -8.479999566609020e-02   +8.086652123997962e-01   +5.427507031073735e-01   +3.995385872783080e-01   +5.393588296911918e-01   +6.092258414717563e-02   +7.993513428802755e-01   +4.559489242190257e-01   +7.165655355959337e-01   +7.081278470831586e-01   +7.230840635392255e-01   -1.107864223306285e-01   +5.867429604669987e-01   +6.727353359344876e-01; +2.666323459206723e-01   +2.226379155644646e-01   +7.962753154122656e-01   +2.067596955301183e-01   +1.010704066516297e-01   +4.378055895932930e-01   +5.374736971655832e-01   +6.602391440882860e-01   +6.376085695766690e-01   +5.070559310352944e-01   +8.527533540530912e-01   +5.015633659468656e-01   +5.258354137704850e-01   +1.518487460151803e-01   +3.264237769709118e-01   +7.876828721262580e-01; +2.028220929633441e-01   +8.786022720072338e-02   +2.577998102633915e-01   +5.592979922254632e-01   +4.099035604393733e-01   +5.128680664453931e-01   +1.414213557131079e-01   +3.218670729531313e-01   +1.627177046700068e-01   +1.649701983600148e-01   +3.882154330784696e-01   -9.113737335488177e-02   +4.920582631481394e-01   +4.178322557056243e-01   +6.431319239675869e-01   +6.999242225866935e-02; +3.966722224763198e-01   +7.011034706911621e-01   +4.701882302926552e-01   +1.604386614861022e-01   +5.037722967806999e-01   +1.392951726296858e-01   +3.547257127799237e-02   +5.689622731789797e-01   +5.694007947332902e-01   +3.336012105428401e-01   +1.602740946295169e-01   +7.906986307268570e-01   +4.827738720738767e-01   +6.218031092200870e-01   +3.350665634844152e-01   +4.528254915675223e-01];
L2E_L1E_iAMPA_netcon = [+3.578161586500344e-01   +5.101462710483586e-01   +6.196687511179477e-01   +3.559479944796262e-01   +3.129776956695821e-01   +6.944868473500613e-01   +5.740970221129211e-01   -6.195843564666605e-03; +3.476489259084830e-01   +2.242614550223401e-01   +2.875921431248438e-01   +6.608975843757722e-02   +3.242602264126559e-01   +2.906709665247769e-01   +6.156858736768239e-01   +2.484514533033989e-01; +1.709832418777976e-01   +4.353574432310271e-02   +7.772220972120083e-01   +4.473377326347643e-01   +3.360493203879664e-01   +3.947150485646960e-01   -1.441020324063488e-02   +4.904053347875963e-01; +1.640339803319487e-01   +2.443338665856694e-01   +8.742060297427793e-01   +2.001377792369979e-01   +3.195446222514968e-01   +5.984278314337966e-01   +1.020298737690103e-01   +2.458814005277670e-01; +6.131226679806693e-01   +1.918655695968205e-01   +5.507380544584802e-01   +6.942639749702532e-01   +1.669926764000314e-01   +5.065529601142770e-01   +6.416263885724363e-01   +6.560369376116693e-01; +8.538462414610762e-01   +2.576301907757711e-01   +5.149807853806202e-01   +5.273664165079575e-01   +3.624911917684679e-01   +9.131508060606696e-01   +6.239555326649748e-01   +8.535408361022903e-01; +7.730147535280492e-01   +7.262912839185388e-01   +7.882133219247525e-01   +1.555783370714013e-01   +4.654775259959645e-02   -1.425562379353009e-01   +7.072418726578453e-01   +7.017772149649103e-01; +6.456093051586097e-01   +8.119482892541720e-01   +6.642550256503630e-01   +4.018008016625489e-01   +4.586854793533285e-01   +7.507205387122595e-01   +6.626151037705093e-01   +5.996999102131924e-01; +1.234708829921640e-01   +3.531286521722151e-01   +4.894526121025097e-01   +4.859098585223285e-01   +1.187025944057093e-02   +5.280851440540727e-01   +5.706123351935203e-01   +9.126512820346376e-01; +1.112638692339842e-01   +8.705883391355876e-02   +4.519428877821585e-01   +2.986930636536049e-01   +5.738132548592211e-01   +3.280973890650446e-01   +4.446504835772752e-01   +5.651325030113096e-01; +4.570412358383363e-01   +8.014213945657990e-01   +3.518369239080344e-01   +5.457206354763902e-02   +3.727015478369231e-01   +6.708227909659418e-01   +1.791110787366126e-02   -2.511633324982081e-02; -3.087197898761525e-02   +4.821126916193323e-01   +8.024884165241782e-01   +4.006185253303744e-02   +2.325498071432931e-01   -1.548664184245616e-01   +5.555313046376567e-01   +4.145497059444338e-01; +1.097458370855821e-01   +5.396939032153678e-01   +9.962269493443406e-01   -7.958112871862207e-02   +5.246644451482927e-01   +1.625694805877234e-01   -5.436571446504661e-02   +6.465855839676450e-01; +1.921840184108618e-01   +2.003885514290859e-02   +2.648671803598568e-01   +5.871291409547090e-01   +5.698738617792752e-01   +7.653677613187784e-01   +1.720477429305020e-01   +8.313897237609058e-02; +5.772844992449796e-01   +5.760164678168604e-01   +1.572365320127200e-01   +4.474815850225331e-01   +5.079248812998903e-01   +2.082808658218198e-01   +4.107122086372570e-01   +5.218263547423979e-01; +3.939915510698562e-01   +5.702997798151330e-01   +2.164479803425574e-01   +4.658726557724320e-01   +1.001615152223507e-01   +4.628055119406196e-01   +2.604964967259839e-01   +5.091214209768272e-01];
L1E_L2E_iAMPA_netcon = [+6.234023874763268e-01   +4.698337688660683e-01   +1.877957462899363e-01   +5.903169193403456e-01   +8.903072235013649e-01   +8.042258983914100e-02   +3.367620923789739e-01   +6.612951303482735e-01   +3.195558240781940e-02   +3.653899500466063e-01   +4.517834608244352e-01   +8.463705595237995e-01   +5.500315572531575e-02   +1.446724786008867e-01   +8.003203788524483e-01   +2.749695927844901e-01; +1.745091721506085e-02   -1.810725089370502e-02   +4.888264069148109e-01   +2.426918115531004e-01   +2.652850047133459e-01   +9.760041061936196e-03   +2.939889407265116e-01   +1.373591603963677e-01   +5.323186751381406e-01   +9.009689179101015e-01   +4.723094141489317e-01   +1.057482801146243e-01   +8.561641185552301e-01   +9.153115557997213e-01   +4.503944889763449e-01   +5.468118035766643e-01; +2.539293152659773e-01   +7.513080293321981e-01   +2.076749771829949e-01   +2.030368131102193e-02   +6.376258583409776e-01   -1.871867790983323e-02   +8.819233042788659e-01   +6.176225507684849e-01   +6.293920100076977e-01   +4.264256857900517e-01   +6.405851934687632e-01   +1.749617431181665e-01   +4.893700718016339e-01   +3.321253547732492e-01   +7.349832274001548e-02   +3.839270142749175e-01; +7.950472156660489e-01   +2.983545465746551e-01   +3.270063701470135e-01   +2.221493865552738e-01   +2.527725227242033e-01   +4.173373047666822e-01   -6.816747811663390e-02   -1.019688060149113e-03   +7.915480717302853e-01   +3.389422293365701e-01   +3.732974655060145e-01   +1.520004759080987e-01   +5.067307601941345e-01   +6.694315905409072e-01   +5.204561296853983e-01   +4.993041691542546e-01; +4.700618777789789e-01   +1.253001404264811e-01   +2.636503892198661e-01   +4.464571549087301e-01   +3.929329031670613e-01   +5.705197900616478e-01   +2.781745762980349e-01   +3.396252473124655e-01   +3.554169827022329e-01   +4.148107619556514e-01   +2.891510710194788e-01   -4.908872333954056e-02   +1.373003894442584e-02   +5.898665186308272e-01   -1.979214624161583e-01   +7.079167324704552e-01; +9.893795070252185e-01   +1.003799720096052e-01   +1.633838289468727e-01   +6.523733237667135e-01   -3.304192639444184e-02   +1.114777569190530e-01   +5.060548561651248e-01   +1.829533906747871e-01   +4.044238427743729e-01   +1.535251789339497e-01   +3.423358645124460e-01   +8.367443461878051e-01   -1.215304948774751e-01   +1.352797846564185e-01   +4.025390331525948e-01   +6.213947621530765e-01; +2.631678088629265e-01   +1.077243530703528e-01   +3.375903494696560e-01   +2.542491822649134e-01   +7.813034987944678e-01   +4.466212267657209e-01   +8.022650821981273e-02   +6.601215545371957e-01   +3.246945715370579e-01   +8.178640791418406e-01   +4.404856765795146e-01   +1.251489393986543e-01   +2.487800413866285e-01   +1.819706308631129e-01   +5.848550121675072e-01   +1.627363097883080e-01; +3.703865790199452e-01   +2.306871077127669e-01   +7.432949345164298e-01   +5.857479850496612e-02   +6.563774202136339e-01   +2.187145677024226e-01   +2.376493758065720e-01   -3.892474997611810e-02   +2.180223053476056e-01   +7.460147166330786e-01   +4.447948713720167e-01   +3.120443993931635e-02   +8.214432231498622e-01   +6.443774948259784e-01   +2.559365859619927e-01   +2.222427882463051e-01];
L2I_L2E_iAMPA_netcon = [+5.107221010904449e-01   +7.736022832337718e-01   +3.165452800226464e-01   +5.765821452848899e-01   +8.548306956748508e-01   +6.683279147411126e-01   +6.632322187677819e-01   +2.332327086513402e-01; +8.974847585819630e-01   +7.155593790490453e-02   +4.082905648095573e-01   +9.498598074207135e-02   +7.751514013143845e-01   +3.505616998239585e-01   +3.279004596167420e-01   +7.198716351928216e-01; +1.000000000000000e+00   +3.354644275474519e-01   +7.236880343628302e-01   +4.666273071090439e-01   +2.335317024848420e-01   +5.895017219550316e-01   +1.368245672882294e-01   +7.534386684358347e-01; +4.025139628600099e-01   +7.457636687904773e-01   +2.563175640339474e-01   +1.558651398153372e-01   +3.895461981868352e-01   +1.474544497550763e-01   +6.136563517089880e-02   +3.129305518777089e-01; +4.715229373746935e-01   +3.401991373301666e-01   +5.893815029794226e-01   -5.074495701567512e-02   +6.331630154201507e-01   +2.386366867715723e-02   +1.592292028138014e-01   +5.511660521034207e-01; +2.647219962493531e-01   +2.695339519752491e-01   +5.685997094798914e-01   -8.755163442769803e-03   +4.943622970090946e-01   +5.532145599741972e-01   -8.782625864433341e-02   +3.060199772801095e-01; +3.610740189133585e-01   +1.147729174174751e-01   +4.263381559539057e-01   +5.069327522899714e-01   +1.110706787060690e-01   -1.601540094830960e-01   +3.286270039874717e-01   +5.444318189261805e-01; +4.093669197685881e-01   +5.417120620377605e-01   +3.141069475307251e-02   +6.966926353719143e-01   -1.352107470152863e-02   +8.168690819920275e-01   +2.745444841537150e-01   +5.898037134128429e-01];
L2E_L2I_iGABA_netcon = [+1.353297521510197e-01   +2.971666320059602e-01   -1.527861687834008e-01   +8.904912011285765e-01   +4.349555666276659e-01   +8.665016335299158e-01   +7.087958486616747e-01   +1.721407418841685e-01; +5.966573501314346e-01   +5.454294417217643e-01   +4.316743166621647e-01   +4.726107719717582e-01   +6.310791823020104e-01   +3.289080359938844e-01   +1.632803292440903e-01   +8.453929807547530e-01; +3.690723718539087e-01   +1.107206931897780e-01   +4.724032078072642e-01   +5.212964778485151e-01   +2.103941962889057e-01   +3.157964244728909e-01   +1.766439678349183e-01   +7.673132502758212e-01; -1.111516174613932e-02   +5.935468321140190e-01   -2.346762598295444e-02   +7.856047318361224e-01   +4.310765197684849e-01   +4.441270100600836e-01   +9.065099372493958e-01   +8.075583644600310e-01; +3.265841472762246e-01   +5.262829728369582e-01   +1.932430107954026e-01   +2.722041633917867e-01   +5.680196715733064e-02   +5.513590982912553e-01   +8.594429664786930e-02   -3.080905318171258e-02; +6.348483197448458e-01   +8.352554141323124e-01   +1.000000000000000e+00   +9.415000366994086e-01   +7.785774872562944e-01   +5.086038747699931e-01   +3.612002883560826e-01   +4.277797974960233e-01; +1.611998580102750e-01   +3.595264529245827e-01   +1.606126983185594e-01   -7.296515063568668e-02   +3.331118189340743e-01   -1.602478948186030e-01   +2.064558399390984e-01   +6.569617980446902e-01; +1.183432506489867e-02   +5.517065447914270e-01   +5.755925225506519e-01   +1.547876212714255e-01   +3.905092453871149e-01   +4.682043744725108e-01   +4.857209234966156e-01   +7.077907716083147e-01];
L3E_L2E_iAMPA_netcon = [+4.130343370189454e-01   +5.030791718388189e-01   +5.853145878933439e-01   +4.161037125096356e-02   -8.692760009028465e-02   +7.814165693662243e-01   +9.421356832227038e-01   +6.995388320208903e-01   +5.858922408305494e-01   +3.743211194736073e-02   +3.240626297216168e-01   +1.448501627430846e-01; -1.222868119910485e-01   +8.399913600554746e-01   +5.055302971175315e-02   +1.237839159479500e-01   +4.374846661790363e-01   -2.458113468300753e-01   +5.436002194367587e-01   +1.255086670080774e-01   +4.436122837790674e-01   +4.866766720366316e-01   -5.387193023332355e-02   +2.068038342427906e-01; +2.981968352717757e-01   +2.119509171220515e-01   +2.646827018499197e-01   +5.522096415146807e-01   +2.906799021706867e-01   +6.836971564314560e-01   +5.982967745569632e-01   +7.283457067749356e-01   -6.828007575757589e-02   +7.131856380875287e-01   +4.829336390560783e-01   +7.112122040227802e-01; +7.174419938570591e-01   +4.928069428932942e-01   +6.151096240197751e-01   +5.004158151315793e-01   +3.298478764048102e-01   +9.449788642590802e-01   +3.609901919330082e-01   +2.495678777385722e-01   +5.385891733348442e-01   -2.937075713200547e-01   +2.932523355782323e-01   +7.517641638305680e-01; +6.268738754411822e-01   +3.670323318427027e-01   +4.433906257420769e-01   +4.409315434350625e-01   +6.130640348268111e-02   +4.863552407747364e-01   +4.454106093284819e-01   +7.115073082746335e-01   +9.742520717966869e-01   +3.324405309896348e-01   +7.327307438233028e-01   +2.747854277285116e-01; +2.475522115786369e-01   +2.152382055653102e-01   +4.409639518259840e-01   -3.802049529255661e-02   +1.290747483377539e-01   +4.900416941266332e-01   +3.878230364555045e-01   +6.396239219284728e-01   +5.116130606274332e-01   +4.862831836626676e-01   +4.140066222793808e-01   -9.297191347932197e-02; -7.588781814637575e-02   +1.410734350626960e-01   +2.153006887645036e-01   +4.203683039393080e-01   +1.000000000000000e+00   +7.367382757531552e-01   +5.734469163232907e-01   +3.688953545546734e-01   +5.182582602168316e-01   +3.244674264869210e-01   +2.932034268985333e-01   +4.999914697385273e-01; +2.832398881433119e-01   -4.399192070389254e-02   +5.965243508026965e-01   +8.058592315731359e-01   +3.738605852267438e-01   +6.082162035489150e-01   +6.222757016924106e-01   +2.455390049568788e-01   +6.387757216788174e-01   +2.556319540980840e-01   -3.827074868134235e-04   +2.672075955175837e-01];
L3I_L2I_iGABA_netcon = [+7.593200008573462e-01   -5.651996999783038e-02   +3.766229691055289e-01   +6.711910822888495e-01   +2.787700740267147e-01   -3.773870417745655e-02   +1.922610724237051e-01   +2.991627946028632e-01   +2.716837600103426e-01   -4.603291871079429e-02   +1.530574898777955e-01   +9.021717502951381e-01; +8.595634617399126e-01   -6.787635642170006e-02   +1.177164796903366e-01   +5.606848420107036e-01   +8.570284134240036e-01   +4.161846838226176e-01   +3.970987585264299e-01   +5.293736438536584e-01   +2.996930814143544e-01   +4.960646789120066e-01   +1.574160128130339e-01   +4.084498286735662e-01; +8.050669466724648e-01   +1.273149014599669e-01   +7.580241603872806e-01   -1.796459292993021e-01   +7.434634173404286e-01   +2.528986733319044e-01   +5.574097049695329e-01   +1.411082568745470e-01   +3.708024136784431e-01   +5.655345459897021e-01   +2.988183715583350e-01   +9.839242288820121e-01; +5.299652174720578e-01   +3.604639529279381e-01   +8.036343696957532e-01   +9.980313795258756e-01   +5.332039115016727e-01   -3.861920962772710e-02   +7.534367744703885e-01   +1.560699638155073e-01   +8.874295161515253e-01   +5.949438703314888e-02   +1.067444538688148e-01   +5.759932498914547e-01; +2.669334942108654e-01   +3.256605245125450e-01   +4.982599308951567e-01   +2.376605899302680e-01   +5.381630061265643e-01   +7.520963588376832e-01   +3.152439501074672e-01   +1.673870892516796e-01   +2.914800179359186e-02   +1.498742741076595e-01   +1.000000000000000e+00   +2.641164285217427e-02; +8.598152982042859e-01   +1.951789026162762e-01   +5.915830990818897e-01   +8.619999946608841e-01   +6.872931292715302e-01   +1.664821571801336e-01   +3.564877832783156e-01   +3.988690639732748e-02   +4.004697915544732e-01   +1.148679105328524e-01   +2.276204115818036e-01   +1.588425338905224e-01; +5.397446029440601e-01   +6.354885133489878e-01   +8.077832962351197e-01   +3.049308481347299e-01   +2.863671801700380e-01   +7.349553695605451e-01   +5.170337518320443e-01   +6.200237949463338e-01   +1.442814558221656e-02   +9.235855365140091e-01   +3.250220567828586e-01   +7.794934848988065e-01; -6.040856249065466e-02   +3.021796296855145e-01   +6.273599982784708e-01   +5.408720691421439e-01   +5.866416009732810e-02   +1.989020821498021e-01   +1.268874679876565e-01   -1.137923866928523e-01   +5.880432610729962e-01   +5.311864937025265e-01   +3.765254593770097e-01   +6.568252882789596e-02];
L2E_L3E_iAMPA_netcon = [+2.214056596594271e-01   +9.470058680133623e-01   +4.207510542306397e-01   +6.535019651545280e-01   +3.326174694176761e-01   -6.741358019253739e-02   +4.939112068019421e-02   +2.903823258630143e-01; +3.908678570692657e-01   +4.713847784420737e-01   +5.118539320708083e-01   +2.479258237889528e-01   -6.707231551645360e-02   +2.278519057741683e-01   +5.577974415986385e-01   +5.390546620406442e-01; +6.359302894284140e-02   +1.562750491385592e-01   +1.000000000000000e+00   +9.670346577502245e-01   +4.341853759381969e-01   +2.449383244692628e-01   +4.483486029417498e-01   +5.734172122335653e-01; +2.990558111764236e-01   +3.479068666698330e-01   +2.299489684251709e-01   +5.553163559057608e-01   +3.069331095433157e-01   +6.988950620258280e-01   +5.158754433747190e-01   +1.702864191759678e-01; +2.323259102786477e-01   +6.865366351685716e-01   +6.100725778319396e-01   +8.996789319664311e-01   +6.398870557630150e-01   +3.428462723764458e-02   +1.066611717308091e-01   +8.926843997985040e-01; +9.496932920991823e-01   +5.949854493614213e-01   +2.943504116801945e-01   +1.970074059857932e-01   +4.113660338715369e-01   +6.318944353887538e-01   +5.236774252346101e-01   +7.845087710126023e-01; +2.733034358326684e-02   +4.629959602672711e-01   +2.254211437354127e-01   -1.748778615891453e-01   +1.979304798652256e-01   +4.558309425091329e-01   +2.629018451809818e-01   +1.145646136220237e-01; +5.393276480030045e-01   +1.368651667842783e-01   +9.194431844308738e-01   +2.428682651440033e-01   +1.505006471665676e-01   +2.749404730820543e-01   +2.092014621794550e-01   -1.361948981716012e-01; +4.982116914439566e-01   +6.818837659050101e-01   +6.036554786330937e-01   -1.149139992194505e-01   +4.251408895336518e-01   -2.861587349690220e-02   +4.548553608802406e-01   +6.526836722695206e-01; +3.051455405065223e-01   +5.573192083764494e-01   +2.755629077898693e-01   +5.349249964617944e-01   +6.473972965250860e-01   +3.988880388803161e-01   +6.860959721207751e-01   +2.886216895426444e-01; +5.573713672995814e-01   +3.469790535871768e-01   +6.766823400189609e-01   +2.383110831078302e-01   -5.445555266840781e-02   +1.042651767881212e-01   +7.528179560927785e-01   +5.359563067112425e-01; +6.837720051114778e-01   +4.560085894176415e-01   +4.965378989419246e-01   +7.627578592599347e-01   +3.082695830374704e-01   +5.843965450387851e-01   +4.209169137330699e-01   +4.135924206758662e-01];
L2I_L3I_iGABA_netcon = [+3.153370822645345e-01   +1.272506780807840e-01   +7.157402396908866e-01   +2.326249627309701e-01   +1.856707192959135e-01   +4.356013329890357e-01   -1.204533889378501e-01   +5.496260866399486e-01; +2.671866582525619e-01   +3.015894553899036e-03   +5.993295592905696e-01   +5.430247319416002e-01   +4.366988836358747e-01   +3.694893602324636e-01   +7.171322811355709e-01   +4.782835335514434e-01; +2.317457383002800e-01   +6.440216675684005e-01   +2.275645032962365e-01   +3.312285952714894e-01   +3.755904046716638e-03   +8.887966696677836e-01   +3.034018116335260e-01   +5.717207160512451e-01; +4.417365938462650e-01   +3.517211944606283e-01   -8.225607928937120e-02   +3.342085023017357e-01   +5.335836774209227e-01   +2.179354449609476e-01   +3.054038356298730e-01   +1.879996215367399e-01; +5.289253131996222e-01   +3.629401883653140e-01   +4.757657663347514e-01   +6.171630195644994e-01   +2.249523819283679e-01   +4.532336551335444e-01   +3.915149153060014e-02   +1.439784431508292e-01; -2.771120993255201e-01   +1.028144697536030e-01   +4.338971823526943e-01   +7.438465467847445e-01   +6.957311110049433e-01   +6.539972661165406e-01   +6.814443341897429e-01   +6.022618119658932e-02; +3.636239094887142e-01   +2.309966442847846e-01   +3.518089409184086e-01   +5.084083553661098e-01   +1.863583589611494e-01   +7.982885586668174e-01   +7.442991202803919e-01   +1.000000000000000e+00; +4.236736272667848e-01   +4.405742894154556e-01   +1.544983100529042e-01   +2.646869127180461e-01   -1.063178406189086e-01   +1.125938921693208e-01   +1.789590492291308e-01   +2.019010044462319e-01; +2.176478307628975e-01   +2.345907300076460e-01   +1.023289336184990e-01   -1.978182972031752e-01   +5.868433219569279e-01   +1.105539971297231e-01   +9.932623064423556e-02   +3.227793977213072e-01; +1.448937801070546e-01   -1.647716346631536e-01   +6.200467700075969e-01   +5.332689255475239e-01   +6.687896316089622e-01   +6.964119171398517e-01   +6.618545789177657e-01   +1.965788767139965e-01; +4.513685534941105e-01   +2.799698975586093e-01   +7.335698767797827e-01   +1.536199015027113e-01   +6.450937653315362e-01   +3.689520531357796e-01   +6.913370924981161e-01   +1.691743639627982e-01; +5.535609551762906e-01   +1.217504076375866e-01   +2.005744877388127e-01   +1.199610466712074e-01   +5.499810108239477e-01   +7.207892843253606e-01   +2.796229556977024e-01   +8.517663323234259e-02];
L3I_L3E_iAMPA_netcon = [+3.986130730662884e-01   -2.182858324877273e-02   +3.760405057362744e-01   +9.106533437429519e-01   +9.288519936793768e-01   +1.987809908446169e-01   +3.521912470882994e-01   +8.075114748082640e-02   -1.280380785034466e-01   +1.186721203853733e-01   +4.602377394706339e-01   -2.251049940343480e-01; +3.492105659757546e-01   +5.812946735090037e-01   +4.570460936661677e-01   +4.843274485964873e-01   +1.856339597196868e-01   +1.335120854259951e-01   +3.409830640192060e-01   +1.292119028653224e-01   +2.223844078036577e-01   +5.044168070179044e-01   +4.165506359258501e-01   +7.344936618226332e-01; +4.614845230809175e-02   +8.854521561468532e-01   +5.616124291810195e-01   +3.484957057839752e-01   +5.249293914345380e-01   +1.564088667109580e-01   +3.743645732661412e-01   +4.389417583434466e-01   +2.401521218947137e-01   -3.544498621426647e-02   +7.373562858430637e-01   +2.844632740698209e-01; +5.197947169138077e-01   -5.340053812798252e-02   +7.155429079036015e-01   +1.603874508362554e-01   +8.354627254140119e-01   +1.319778318053131e-01   +1.165831776250705e-01   +4.946198674533874e-01   +4.618294937163678e-01   +3.412609643086840e-01   +4.330735343223098e-01   +8.733831410020707e-02; +3.920848275983771e-02   +7.899031527947339e-01   +1.587919842293410e-01   +2.017125432013273e-01   +6.928933033680221e-01   +2.804633284786556e-01   +1.276110835907483e-01   +2.231945143956339e-01   +7.584604191999920e-01   +6.690352988387099e-02   +4.245111304159900e-01   -5.840351320642647e-03; +1.315306483273618e-01   +2.530281463020668e-01   +7.210762729425237e-01   +2.162621380201198e-01   +2.640043359423440e-01   +4.682323911237763e-01   +2.215726352938659e-01   +2.504064800329766e-01   +6.752034402339403e-01   -1.884404173790556e-01   +2.335694555147026e-01   +7.776380607631868e-01; +1.795514202291207e-03   +8.360617680285503e-01   -1.736985793648773e-02   +5.300363266131299e-01   +3.494423089328212e-01   +5.024352885943970e-01   +4.580700454560688e-01   +2.057104309900894e-01   +6.382707501104019e-01   +8.703013327017349e-01   +2.902193885013444e-01   +7.358946743005427e-01; +1.180733160313883e-01   +5.821754790486795e-01   +7.140669172608864e-01   +5.286857623347081e-01   +1.000000000000000e+00   -5.369286824869875e-02   +9.681665959878010e-01   +2.892713543648902e-01   +8.660582740262117e-01   +5.995841832695450e-01   +6.758253641442546e-01   +4.972699558171446e-01; +8.202035871249275e-01   -2.288320472681598e-02   +2.519924355726908e-02   +5.663010783317796e-01   +8.109413079081031e-01   -3.191942800326890e-03   +5.171312259607331e-02   +4.536624629374384e-01   +4.714293155243187e-01   +9.855730906576611e-01   +5.685743629042729e-01   +3.508982298594983e-01; +6.465936556995646e-01   +4.962387307401391e-01   +4.733657371446704e-01   +4.393552324882243e-01   +3.288460633697524e-01   +1.116242807807635e-01   +9.389863285178812e-01   +6.699783341810195e-01   +3.750299138825163e-01   +2.532667916009425e-01   +1.155018473008886e-01   +6.320121862882233e-01; +2.534363580792650e-01   +5.181089302513502e-01   +1.306568725043478e-01   +4.514542087155011e-01   +6.307958961375949e-01   +1.239251423710948e-01   +7.060161406138389e-01   +7.892788131762157e-01   +9.946462710852903e-02   +6.500503061067833e-01   -4.966926326638398e-02   +9.690276246299542e-01; +4.371126964171824e-01   -1.762935311279367e-01   +4.252599724576606e-01   +7.627284207596520e-01   +9.441101850320281e-01   +4.185189642122914e-01   +2.695936421967431e-01   +3.262998843581305e-01   +8.268724088947828e-01   +5.553405379877961e-01   +2.363747240760637e-01   +4.872065417034351e-01];
L3E_L3I_iGABA_netcon = [+9.305927635376403e-02   +4.788637768028515e-01   +3.861998565754599e-01   +5.010816245018886e-01   +7.151989962609269e-01   +4.996120293597459e-01   +7.496736773081983e-01   +9.272713983795100e-01   +9.165476796915681e-01   +2.745467553430214e-01   +2.177747959182854e-01   +5.141194372490551e-01; +5.781662575597670e-01   +6.473901413033636e-01   +6.193862892473228e-01   +7.763719274827693e-01   +4.335779079564856e-01   +1.533030187558724e-01   +6.611340922104374e-01   +7.432057762650210e-01   +7.614465921238499e-01   +6.629813847841528e-01   +2.513436993710496e-01   +4.319827962313088e-01; +4.318922920169597e-01   +9.826953745039035e-01   +2.266309956121091e-01   +7.883507635865172e-01   +1.441075365712822e-01   +5.002516084757499e-01   -8.389684928766100e-03   +4.523244756840650e-01   +1.413220134703634e-01   +8.730775697569899e-02   +7.738105816007099e-02   +1.341847235023948e-01; +1.522032564028713e-01   +6.029283702956040e-02   +8.271329006481863e-01   +1.738768482874450e-03   +1.803312467679948e-01   +2.681113758532164e-02   +8.001254843378263e-01   +4.214600779022351e-01   +5.876710996971207e-01   +4.006706864541958e-01   +5.884912588472564e-02   +2.182401080037957e-01; +8.024762991679169e-01   +6.215961575975573e-01   +8.856063564926063e-01   +3.841352432413250e-01   +6.124743162940325e-01   +6.269519998758550e-01   +6.043460213958866e-01   +9.695341652730711e-01   +1.579561404508344e-01   +8.549093667143939e-01   +4.821945591377576e-01   +4.156639668151954e-01; +8.684095091861109e-01   +7.751700620078444e-01   +4.109701199920076e-01   +5.277837755954039e-01   +3.954603366976380e-01   +7.968152793883059e-01   +3.333947302479831e-01   +7.497105947835840e-01   +1.883000527083928e-01   +5.474560618353091e-01   +3.184496171143732e-02   +1.810522692202946e-01; +6.659009177273172e-01   +6.547404195255071e-01   +1.541524075235886e-01   +9.638641456733564e-01   +4.348049595374664e-01   +2.484682615220138e-01   +4.020135977328153e-01   +2.447933469947056e-01   +1.837905408987485e-01   +2.925886218491979e-01   +9.368899175791149e-01   +5.705267621364094e-01; +8.077060039372812e-01   +1.978358172177155e-01   +4.410996291220908e-01   +4.945989826428999e-01   +7.577010890119128e-01   +3.155349943033865e-01   +1.709409493636344e-01   +3.851784786953220e-01   +3.513981656120325e-01   +8.049464521277762e-01   +1.963952799433044e-01   +4.926556546798234e-01; +2.980138057820568e-01   +2.715162425498981e-01   +6.317443982598827e-01   +5.751985471356318e-01   +2.098187121640509e-01   +5.633684523121975e-01   +6.148801982261136e-02   +5.718090746182042e-01   +2.675307505735004e-01   +1.520306546933324e-01   +8.867993038714634e-01   -6.449148211431396e-02; +2.500129219369337e-01   +6.168168948358306e-01   +3.572583280850758e-01   +2.783245447450433e-01   +3.137846323037863e-02   +6.194507369996941e-01   +2.603302664902594e-02   +7.624299735968644e-01   +2.158667382401873e-01   +4.300420152495860e-01   -1.694274515326328e-01   +1.822853909068640e-01; +8.766177504165669e-01   +2.482573673433352e-01   +7.668006343312667e-01   +2.002672176715189e-01   -3.809494127717361e-02   +2.472451501719365e-01   +5.747798349955772e-01   +1.504585340294129e-01   +2.206776002897244e-01   +1.586472507413451e-01   +4.819235173305837e-01   +4.561849823837707e-01; -6.243316690510649e-02   +3.143263821875224e-01   +7.720967691636186e-01   +7.308655700752148e-02   +1.937066416502176e-01   +4.300880277786600e-01   +7.138928559610587e-01   +6.791534607497065e-01   +1.527586667214892e-01   +1.862784166618188e-01   +2.055243493015971e-01   +3.369892986953220e-01];
L2E_Input1_iAMPA_netcon = [+8.589193335284807e-01   +7.481590799146466e-01   +6.852814188811756e-01   +8.236212981637047e-01   +8.511265566703442e-01   +9.210302787433061e-01   +9.342734387328759e-01   +8.096888878322454e-01];
L2I_Input2_iAMPA_netcon = [+8.648718449804969e-01   +9.342463637731765e-01   +8.660063254041035e-01   +8.050138644628561e-01   +6.851788670009655e-01   +6.536506514800157e-01   +7.667663322208951e-01   +9.206873903595237e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
