function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.384509273529226e-02   -1.130178259297000e-01   -7.467026604103461e-01   +4.248913722933482e-02   +5.309887482478316e-01   -2.746030168757917e-02   -2.015146136624399e-01   -4.812769272992862e-01   +2.955222411329506e-01   -2.707360414439399e-01   +1.642439793370977e-01   +5.290396331024294e-01   +8.346066272381802e-01   +1.669412090407871e-01   +2.348650263562958e-01   +2.831851246737529e-01; +5.473222567520056e-02   +1.382554667460624e-01   +4.773721751835170e-01   -3.207137297159247e-01   -4.968212710200985e-01   +5.491331980947476e-01   -4.092832013134086e-01   +7.427328719587968e-01   -4.132251043026997e-01   -2.244310780418652e-01   -7.183521583733202e-01   +2.532439063428396e-01   -7.285482497774951e-01   +5.509152816572259e-01   -1.162622250923812e-01   -2.901818550259663e-02; +3.965918968803565e-01   +7.834966066034502e-02   +8.391845409802268e-02   -5.434629672041922e-01   -2.889607380762327e-01   -3.808678089355699e-02   +6.127439391847205e-01   +3.925874148478143e-02   -4.162950487064100e-01   +5.974549484762189e-01   -1.911092337056507e-01   -2.084771887380888e-01   +8.360364329673351e-03   +1.804253926053819e-02   +3.357673709193892e-01   -4.608910410279144e-01; +3.797184626845092e-02   +3.653552050534039e-01   -1.297688891193389e-01   +2.741507395336512e-02   +1.782339627762882e-02   -5.524702665316708e-01   +1.378819746826564e-01   +7.482937639413982e-02   +3.705287199772190e-01   -3.029769374159671e-02   +3.240656573440623e-01   -9.072638807534816e-02   -2.769092895047019e-01   -1.059201058261970e-01   -5.396393354161794e-01   -2.839070017721520e-01; -1.964459498537358e-01   +5.154129491388305e-01   -4.004728720630236e-01   +1.125174427698822e-01   +5.778295633684902e-01   +2.797896488021685e-02   +4.504854674503935e-01   +5.088106234372419e-01   +1.929899155919261e-01   +1.677915564774409e-01   +7.693276434694976e-01   -8.190762951739262e-02   +4.268244461317770e-01   -5.458098241547631e-01   -2.619122997879657e-01   +1.018602833949937e-02; +3.626592420030642e-02   +1.107991933075891e-01   +5.354319478702630e-01   -1.087012734150468e-01   +1.097981240363595e-01   -5.390173597048210e-02   +1.884920980178957e-01   +1.277450062662187e-01   -4.377328901864159e-02   +7.904609635833643e-02   +2.365082043490633e-01   +2.207447312412994e-01   +1.393550166241226e-01   +3.774861997078127e-01   +3.862633268214964e-01   -1.881792707728780e-01; +7.787998379160174e-02   +3.008115146898442e-01   -4.438203610682313e-01   +2.123271124811127e-02   +1.482870353386348e-01   -3.966414258597735e-02   -7.272454725291724e-02   -4.251195721471335e-02   -1.601671891109366e-01   +1.240527302037362e-01   +3.248598181395057e-01   -3.414539278292362e-01   +2.563709760160491e-02   -4.911529858928971e-02   +5.959569855723637e-02   -2.115559648048597e-01; +2.464331604559748e-01   +1.786393669803388e-01   +7.098688597056445e-01   -1.546547453893842e-01   -5.369944835552838e-02   +1.140985170050647e-01   -5.917270757295565e-01   -2.665123362574225e-01   -2.405028543031273e-01   +1.410933679693192e-01   -1.580374213393020e-01   +4.363840705065970e-01   -1.045022156648567e-01   -1.041017635504281e-01   -4.437041173869703e-02   +1.554161013389987e-01; -7.810018349690205e-02   +1.969318449048006e-01   -3.484509648191554e-01   +4.489629128922077e-01   -3.616670788207961e-01   -1.833796205788161e-02   +4.840280253337572e-01   -6.721249556199068e-01   -3.073930963637874e-02   -1.015132430071654e-01   +3.305570211444711e-01   +6.552389054352847e-01   +4.082625691474566e-01   +3.881995051118105e-01   -1.240943286444978e-01   -2.183841146871002e-01; -1.473335405962994e-01   +3.741450281059027e-02   +4.202362796030395e-01   +9.233432988394194e-02   +2.065629720663594e-01   -3.273026955043499e-01   +4.954083674335460e-02   +5.378530339217739e-01   +4.499724402711452e-02   -3.350834202879394e-01   -5.281079205350356e-03   -3.741968963760621e-01   +2.456428894900562e-01   -4.553604033844650e-01   +4.445509579586892e-01   -3.241001294675186e-02; -3.874004975523128e-01   +2.792942024490437e-01   +1.538206720348487e-01   -4.385250122573709e-01   -1.090147166594423e-01   +7.311991087794172e-01   -2.348012027486597e-01   +3.704703607464992e-02   -4.619803063712349e-01   +2.800542022903438e-01   +6.275082572814997e-01   +1.408100403481053e-01   -3.440540241387051e-01   +1.206209553193355e-01   -1.922824074482218e-01   +4.523533283465796e-02; +3.703207098069529e-02   +3.870148379469607e-01   +3.512197537342437e-01   +5.353531142018302e-01   -7.959445949846109e-03   -2.848103054991389e-01   +1.028876517131483e-01   +3.744099378505211e-02   -5.892587444369339e-01   -5.864292981344889e-02   -8.286025812613154e-02   -1.929412244979972e-01   -1.333252609650473e-01   +6.227569798148062e-01   -1.742431256999868e-01   +2.656315961575287e-01; +6.705823905267087e-03   +1.559232522935248e-01   +1.131349042962493e-01   -7.938721447731470e-02   -1.752391410548315e-02   -1.000000000000000e+00   -5.359874030657747e-01   +3.225050705114095e-01   +6.632953962530239e-02   -4.876034860288629e-01   -2.566812927243865e-01   +9.437048023384027e-02   -1.880109473867027e-01   -5.072241001145830e-01   +1.936587877507301e-01   +2.996884687166452e-01; +3.402176069809942e-01   -2.009281149624562e-01   -1.621876987374747e-01   +2.563910054570584e-01   -3.690093379804087e-01   -1.415319481972763e-01   -2.323081615236391e-01   -5.818058968286633e-02   +5.290513440403818e-01   -3.433686370908816e-01   -6.174281922970860e-01   +6.835349407752087e-03   +5.859161444503486e-02   -3.969160944950885e-01   -3.518649284571598e-01   -1.269300380860681e-02; +4.396260093258302e-01   -2.031273130028985e-01   +1.505253115350464e-01   +2.631356918923385e-02   -1.244824733639754e-01   -2.057961354338635e-01   +1.879412067666944e-02   +7.246023955351383e-01   +1.630756999603237e-02   -1.333845555073504e-01   +5.961309999968796e-01   +7.374213798328541e-02   -3.204578047508835e-01   -3.526477497301300e-01   -4.501547658971329e-01   +4.078849149962160e-01; +9.268608184598057e-02   +6.622019466849197e-02   -1.636200298728242e-01   -1.739606629296377e-02   -6.311714547665024e-01   -3.523116527073317e-01   +8.172983074541911e-01   -5.899086510956583e-02   +2.587829454726628e-01   +1.121571124344192e-02   +2.463142855093096e-01   +6.151473243603632e-01   +6.234026211952509e-01   +9.536118037475322e-02   -1.631383260696960e-01   +6.114835888485801e-01];
L1E_L1I_iGABA_netcon = [-1.217057178793343e-01   +3.404730059767977e-01   +1.881908277933162e-01   +2.412816425669265e-01   +6.938913951471506e-02   -2.292325164741777e-01   +3.571690936775001e-01   +1.899835189062928e-01   -3.690248838940975e-01   -2.353578344737109e-01   +2.370336040073951e-01   -6.880631267660066e-02   -1.913044776462282e-01   +3.453232719604588e-01   +2.720259652530739e-01   -1.424800116453444e-01; +1.854564925744219e-01   +3.000714449111158e-02   -6.465222752166258e-02   -5.184719473050705e-01   -1.192928666589952e-01   +1.032049012451594e-01   +1.802935639870721e-01   +1.463555719814817e-01   +1.035845779239757e-01   +3.060837891997124e-01   +7.266103574907198e-02   -5.712918228805222e-02   -5.861229871253253e-02   +3.584266234092193e-01   -3.382575650073750e-01   +3.259753248381437e-01; +3.597429140426593e-01   +9.485055143570142e-01   -5.105887497970805e-01   +8.507945922074305e-01   -1.104123878033885e-02   +6.652512729786443e-01   -6.177164223093530e-01   -3.665625317420442e-01   +6.491622912834277e-02   -8.911657649380406e-01   +2.616197752677867e-01   -1.017418041354451e-01   +3.888177410684029e-01   +1.567326780131144e-02   +2.947218476823177e-01   +1.806294483038958e-01; +5.098934475608379e-01   +2.748124889260944e-01   -2.025496515720085e-01   -2.725752444839900e-01   +2.695155789475591e-01   -3.270217243968231e-02   +1.776322818787381e-01   -2.641047011012091e-01   -1.303829115296137e-01   +8.226500588072148e-02   -4.140565619339218e-01   -4.041017896219046e-02   -6.395237855912594e-01   +1.818164774664786e-01   +3.717778328760204e-01   -1.892589481405455e-01; +1.091361984855942e-01   +1.243301965110711e-01   +1.313008990304591e-01   -8.607814358442989e-02   +3.231376135337474e-02   +4.375136099097626e-02   -5.325142227706164e-01   -1.822189176132509e-01   +1.351401435327158e-01   -2.026371450499947e-01   +2.133194851254602e-01   +1.900724271335650e-01   +1.668235211055318e-01   -2.831891245578291e-01   +1.684195658298962e-01   -1.805618189668530e-01; +1.306682698966073e-01   -1.727810407042704e-01   -3.113935704088677e-01   +4.983714153141513e-01   -7.454381631022707e-01   -4.702642474295072e-01   -2.071790660599553e-01   -5.432815027279525e-01   +2.944096251049275e-01   -2.352703525442490e-01   -7.907433500043031e-01   -1.276898472325396e-01   -5.015906259887469e-01   +5.753752044027298e-01   +4.083710007511347e-01   -5.268812124563524e-02; +5.367524164655144e-01   -7.406463753989624e-02   -6.761232979214584e-01   -3.871255792983652e-01   -6.604733428574451e-02   +6.184309974330470e-01   +6.939705716424807e-01   -1.388928483998341e-01   -7.073230827909625e-01   -2.907829855036875e-01   -2.555998006465924e-01   -2.867020776993447e-01   +9.392843102796221e-02   -2.942666955933566e-02   +2.547062180311608e-01   -6.789344631191507e-01; +3.655009676980376e-01   -3.814743853393699e-01   +1.359591655392213e-02   -2.228192254115947e-01   +7.110912258499545e-01   +4.217538178401707e-01   -2.242844835696021e-01   +3.988685687180574e-01   -2.356592447134894e-01   +1.702881020787369e-02   -2.136943857403391e-03   +6.141427881182870e-01   -4.368495708260183e-01   +4.533930660891415e-02   -4.143377208684498e-01   +4.521303045323100e-01; +5.983151761022149e-01   -3.043470652153390e-01   +2.060404535305933e-02   +4.140462801047606e-01   -9.762680179766681e-02   -2.107345120982928e-01   +5.237047787104649e-01   -7.416947188300749e-02   +3.464267896878503e-01   +4.517699130109568e-01   -3.800358624540111e-01   +5.456309093027352e-01   +2.165081944742284e-01   +5.558088827995833e-01   +2.269524439470356e-01   +1.146869476245336e-02; -7.300618577460982e-02   +5.062916800214139e-01   +9.213388477026764e-01   -3.978122991115721e-01   +5.752932288654335e-01   -2.008824918176413e-01   -5.258064101399137e-01   -6.453414906548220e-01   -3.760087558824662e-01   -4.421693625370511e-01   +2.195841500661346e-01   +1.079860445141704e-01   +3.550350840716721e-01   +2.546418045412692e-02   +1.137751404581706e-01   +3.261433187533153e-01; +4.828921808842641e-01   -2.099652929537286e-01   -6.665598596083820e-02   +2.759675111623060e-01   +4.204794389196270e-01   +2.712277560204384e-01   +2.713871127084787e-01   -1.246353868441862e-01   +2.841604007686503e-01   +3.358651609337650e-01   +1.420107649976132e-02   -2.311032015912867e-01   -6.414704161240704e-01   -2.563230516076911e-01   +2.846328183073012e-02   +2.390420895611816e-01; -6.147879947561258e-01   -1.870834208872995e-01   -5.506469662988632e-01   +6.414244795285684e-01   -3.534766671722749e-01   -2.806651670164707e-01   +2.352299042907459e-01   -3.690256186807071e-01   +7.331677212348531e-02   -2.105484755432863e-01   -8.946459539855569e-01   -2.793196589045852e-01   -2.119293282827363e-01   -1.635065025631289e-01   -1.000000000000000e+00   +6.315458002657370e-01; +3.048106050152662e-02   -1.662469469542665e-01   +1.186654261102243e-01   -4.920695509178968e-01   +3.018945909097632e-01   -5.771209612315397e-01   +4.027604538349890e-02   -2.228052487515955e-01   -1.409804511990842e-01   +1.594410151294963e-01   +3.697678286028740e-01   +1.037369656087407e-01   +2.460329007407706e-01   -2.278184846538626e-01   +6.917183990047245e-02   -1.307037448589853e-01; +1.660748279846923e-01   +5.889166574289355e-01   +2.833479710921099e-01   -3.748657839060582e-01   -2.484143395704564e-01   +3.062122166812933e-01   +3.524734901832139e-01   -2.647543209602186e-01   +2.257169589141117e-01   -4.835367806853014e-01   -4.319214134271931e-02   +2.821890423833975e-02   +2.099313881014717e-01   +5.187332737396895e-01   +2.475933500337168e-01   -5.012336194390146e-01; -3.443023829520800e-01   -4.761051843489473e-01   +1.862418324314745e-01   +3.735935900952815e-01   +1.354688491383057e-01   -4.482885961001403e-01   +3.085018568551489e-01   -4.582737655796274e-01   -1.568927942984200e-01   -2.830895395535066e-01   +7.235876469081202e-01   +5.767512322175378e-01   +1.370546913317738e-01   -3.411524737011483e-01   -4.606126921278257e-01   +5.459308412394166e-02; +1.745114976266801e-02   -1.737623114562118e-01   -4.703007882608541e-01   -3.517225859841882e-01   -4.615310045047765e-01   +2.655773472345251e-01   +3.391841815271467e-01   -8.328675975040736e-02   +2.407148142512748e-02   +4.452919547267353e-01   +9.611309898000724e-02   +3.911995624067505e-02   -1.849163408143557e-01   -5.091439798319943e-01   -2.498725112297443e-01   +4.656572577344479e-01];
L2I_L1I_iGABA_netcon = [-3.683394385407859e-01   -8.785699330442145e-01   -1.160028772631478e-01   -6.895764604732484e-02   +1.792261753793411e-01   +2.764796686175175e-01   +5.791776986486442e-02   -1.834339771913447e-01; -5.728591515182620e-02   -6.598948414769477e-02   +6.067810837575136e-01   +3.140323579357300e-01   +1.443502012022505e-01   +1.812332430787331e-01   -5.908098696246732e-02   +6.642896191037580e-03; +1.268801451040149e-01   +6.953982888240086e-02   +4.983257896783111e-01   +1.321966847147568e-01   +4.428595737009487e-01   -4.587692496613048e-01   +2.429993238333700e-01   +1.228079302998614e-01; +1.851467190345065e-01   +6.723513418992821e-01   +2.508100799009563e-01   +2.908977161715171e-01   -1.576289621020634e-01   +4.959842362704704e-01   -1.057763746718325e-01   -3.718065274032647e-01; -1.000000000000000e+00   +3.636056046865385e-01   +1.938166490345461e-01   -3.484031618236973e-01   -3.615721831493992e-01   +5.134691210433358e-01   -4.575331399687391e-01   +4.014599529451655e-01; +1.233741592012231e-01   +2.165117873110490e-01   +3.071738533689098e-01   +1.617300400928934e-01   -5.748846151391139e-01   -3.186133246793300e-01   +7.916111250453114e-01   +8.388301819344057e-01; +2.999749735852739e-01   +9.864024632272099e-02   -2.249168137198962e-01   +1.115936765362361e-01   -5.731924207965358e-01   +6.351100555093926e-01   -2.099697571694022e-02   +1.328092486899196e-01; -9.124184157761780e-01   +4.434233025256112e-01   +4.542325675720736e-02   +1.574355668675012e-01   -5.679051958139069e-01   +3.148929104757056e-01   +3.666534027516132e-01   +1.639135411415412e-01; +4.766198088302209e-01   +5.129683283695067e-01   +2.760181087806287e-01   -3.327904471975474e-01   +8.913334136774227e-02   -1.134091142179636e-01   -2.825850675351156e-01   -1.899830605627491e-01; -2.056058466228832e-01   -1.960029951355274e-01   +3.474805513209278e-01   -1.088357004014334e-01   +5.965509598487263e-01   -9.474810588898843e-01   +4.445259303352193e-01   +5.368602169575520e-01; -3.240108477823019e-01   +1.254991305390434e-01   -2.210808033673948e-01   +2.674576670463796e-01   -9.648411215677273e-01   -1.113217216824204e-01   +2.855985475809346e-02   -1.961846514660275e-01; -4.904386436068413e-01   +2.772436384666006e-01   -3.085974041026461e-01   -3.593749710479859e-02   +6.766030517871111e-01   +3.936411235613543e-01   -5.747152731861656e-01   -4.048360202047777e-01; -8.854222367597005e-03   +8.750991684417281e-01   -2.688572144945972e-01   -1.285053229374354e-01   -1.759826822601762e-01   -4.830754807191825e-01   -8.370283883122138e-01   +2.693010638305723e-01; +1.921508589166025e-01   +1.206854960968490e-01   -4.936325127236836e-01   +6.144985450074601e-02   -2.478110985770902e-02   +5.712401812208215e-01   +4.814313570685176e-01   -2.896350018281912e-01; +3.777261762193362e-01   -6.697935216253533e-01   +9.536631477590063e-02   -8.137269080928378e-01   +6.287836935262672e-01   +7.950724323279043e-01   +1.974982646543025e-01   +4.859918925173034e-01; -1.885743562460966e-01   +5.373275147400138e-01   -2.800528991960378e-01   -7.225258873335327e-01   -4.632178079317243e-01   -2.150709838515103e-01   -3.881081573635662e-01   -1.299991928816013e-01];
L1I_L2I_iGABA_netcon = [-3.599189213530695e-01   -1.924862204210108e-02   +1.797965937686872e-01   +1.538435321664166e-01   +2.113582381557653e-01   +1.266701988920070e-01   -1.861419024873701e-01   +7.362095560033580e-01   +6.345145124246747e-02   -4.933358371051149e-01   +2.457045845469725e-01   +2.436904285422643e-01   -2.318537137422367e-02   -4.876116719186114e-01   -3.942659002329910e-01   -6.135293786420960e-02; -5.106651884036567e-01   -2.888469083785807e-01   -4.638388147080978e-02   -5.586081604157990e-01   -1.000000000000000e+00   -3.079117828193343e-01   -7.809631346565852e-01   -3.205823125443363e-01   -6.043803065567607e-01   +1.576689906190845e-01   -4.200052609625398e-01   +6.827207182938758e-02   +2.376460655095325e-01   +5.838724320350579e-01   +1.499588819650454e-01   -6.490995000887995e-01; +2.818118939833305e-01   +2.006661623304855e-01   +5.848463971972597e-02   +5.844395762495965e-01   -2.401138700181467e-01   -5.167422335929033e-01   -3.403195974270739e-01   -2.331589931091426e-01   -5.619636474752584e-02   -2.327998672934877e-01   +3.009648695093202e-01   +1.082990621306052e-02   +2.123092507585179e-01   +6.078512296763495e-01   +4.629734952277936e-01   +9.575575734948027e-02; +4.575194244412086e-02   +1.807988494223806e-01   -1.111776884022982e-03   +4.243537739701860e-01   -1.075612757648987e-01   -2.003037315839365e-01   -4.013785859215496e-01   -2.511340739426817e-01   +3.824500097872683e-01   -7.899964264597312e-02   -4.771154153523388e-01   +1.530771597585809e-01   -1.596293352686578e-01   -1.707257354165566e-01   +2.060343680799857e-01   +5.900795207701545e-01; -4.757297493988480e-01   +8.074775082170921e-01   +6.880165077151487e-02   +5.610438733601658e-01   -3.804041557871156e-03   +9.310450909900255e-01   +7.017127387826820e-03   +2.177999598396340e-01   -1.984963621228693e-01   -7.072235483812933e-01   -3.000932628894842e-01   +1.662871318217155e-01   +2.493988104442410e-02   +6.682520856201968e-01   -1.220306695603814e-01   -7.477651391855429e-01; -2.948800060935956e-01   -2.036624378525450e-01   -5.759660674843537e-01   -1.591425616922571e-01   +3.470546875195679e-01   +4.690031809828958e-01   -3.279853408470462e-01   -2.812368289584793e-01   +9.965081454584250e-02   +6.453039930697659e-01   +6.372593501412742e-01   -3.215535078500349e-01   -2.178492566046588e-01   -3.224876868382898e-01   +3.298735045925167e-01   -1.690300988388001e-01; +4.057446433205998e-01   +2.793912180013119e-01   +5.094934595557991e-01   +6.237252869493062e-01   -1.477321947768539e-01   -1.384611335263601e-01   -7.598875099817950e-01   +1.489752258697615e-01   -3.474310210335157e-01   -6.768469070058161e-03   -1.367224810130762e-01   +7.018462860987933e-02   -5.093933687536507e-02   +5.518555655431381e-01   -2.384513397946975e-01   -3.651817356988536e-01; -2.370984434937135e-01   +9.708922834616701e-02   +1.043856085067499e-01   -1.448353328873496e-02   -5.146052190956988e-01   +1.902660128702399e-01   -8.681732987095954e-01   -1.393928590246704e-01   +5.831218113426784e-01   -9.165725074113998e-01   +5.724895514313032e-01   +3.577488016990801e-01   -4.044915013636650e-01   +5.828305096420026e-01   +7.583624670659933e-02   -6.480674910832382e-01];
L2E_L1E_iAMPA_netcon = [-1.845260198105844e-01   +4.575009758772261e-02   -5.157757652569296e-01   -1.169961244626480e-02   +5.627280331476053e-01   +4.309626909488799e-01   -4.913919538883058e-02   +4.018948670914005e-01; -2.729575743932489e-01   +1.718243365277972e-01   -4.914758109223542e-01   -4.621123281200147e-01   +4.441610543589889e-01   +5.114364427986317e-01   +6.534295919796913e-01   -7.656137382698205e-01; -2.377716078838216e-01   -6.913028763109297e-02   -6.258185332288733e-01   -6.344131535599822e-01   +8.339265174168456e-02   -2.757428217574978e-01   +1.009184620600198e-01   -4.194141879717170e-01; +1.188293746939486e-01   +4.159534162154860e-01   -6.630907366655256e-02   -3.668255752837452e-01   +2.540038475967406e-01   +3.695184885172139e-01   -4.586151704461257e-01   +2.955743433071860e-01; +1.779098521573167e-01   -7.885758252004095e-01   +2.155834580622600e-01   +3.567335248080785e-01   +2.849551867204521e-01   -8.836789820743066e-02   -9.216519153037832e-01   -5.211894647764050e-01; -9.840326555361025e-01   +3.141800763892047e-01   +5.619469390683213e-02   -4.966860800825114e-01   +2.214720988213652e-01   +3.695766513389572e-01   -9.519356367283441e-02   -2.100895246479135e-01; -8.796141454692260e-01   +5.109555946507124e-01   +4.063874706743788e-02   +1.575023424185814e-01   -1.181566814035785e-01   -1.044851866762854e-01   -3.967831148938202e-01   +6.539194791349290e-03; -8.347969751179924e-01   -1.877207974621476e-01   -1.842365096060250e-02   +5.188480180118485e-01   -1.759424822077377e-01   +5.172376381863417e-01   +3.147027378250274e-01   +1.487466532272576e-01; +6.814123153174456e-02   +3.078369093943290e-02   -2.646939214517248e-01   +6.078802645285369e-02   -1.295671231142334e-01   +4.786778747440406e-01   -2.104439165005240e-01   -7.121194333127174e-01; -5.358911929409009e-01   +3.803218830666314e-01   +4.294194397195539e-01   -1.873606503007125e-01   +1.279453725174861e-01   +1.626001068429400e-01   -4.501806743275670e-01   -8.266779427593048e-01; +2.805911395465170e-01   +6.871984934111103e-02   +1.698073962783161e-01   +7.624017039181161e-01   +3.782302935910488e-01   +2.071637067444195e-01   +9.439795212987191e-01   -6.393467853306385e-01; -5.582188991412779e-01   -2.531743136136125e-02   -2.471005208107484e-01   -6.835805068304110e-01   -4.341882169228513e-01   +6.401319845867820e-01   +1.522771100522157e-01   +1.549468950501158e-01; -3.173176370744278e-01   -2.563106629218381e-01   +1.174319576766334e-01   -4.981706728752687e-01   -7.636037372747790e-01   +3.432606809009631e-01   +5.702677417706190e-01   +1.364092970497617e-01; -8.678497661349134e-01   -9.881439978707007e-01   +7.600862904940442e-01   -2.209297800942089e-01   -1.842892164048133e-01   -5.693277549544540e-01   -3.939842405076323e-01   -5.114919541784577e-01; -7.863108413195746e-02   +3.816002609346960e-01   +1.792266270421679e-01   -3.635140016485049e-01   +4.408236421263014e-01   +5.071112290545983e-01   -2.961477363764555e-01   -9.490476850357973e-01; -5.882809367128687e-01   +1.023617273752786e-01   -8.336172298385069e-03   -5.288107834074063e-02   +4.419627616334941e-01   -2.112622251039038e-01   -5.888014809456157e-01   -1.681958281927465e-01];
L1E_L2E_iAMPA_netcon = [+1.744375605479157e-01   +1.873755930399397e-01   +3.714956378227470e-01   -1.822122185021512e-01   -3.792726516365615e-02   +8.374501796571474e-01   -6.745325976102759e-02   -3.388214164389267e-01   +1.971142925419470e-01   +2.117023458749730e-02   +4.254338449115080e-01   -8.863582187771263e-02   -3.059765426178532e-01   -9.634049803290111e-02   -2.449175860598896e-01   -1.744326172219844e-01; -1.483780214299504e-01   +1.174749315384268e-01   +2.674900959129959e-01   -6.204644967990961e-02   +4.300618533661313e-01   -4.645049744789567e-01   -2.732218760254798e-01   -3.943066993805500e-01   -1.000000000000000e+00   -7.216172052496107e-02   +2.531090992163587e-01   -2.888225926740543e-01   +2.288885609051959e-01   -2.072581865164581e-01   +1.543253763850503e-01   +4.757245722694149e-01; -5.332349076792446e-01   +3.478248891261211e-01   +3.678976737193538e-01   +1.376067061882867e-01   -3.080720014546212e-01   -1.323392813209325e-01   -6.363675372899817e-01   -4.543397972492914e-02   -3.306118220829074e-01   -2.969798682901921e-01   +5.681579674724713e-02   -2.228776480965276e-01   +1.436594741100918e-01   -2.440944789645006e-01   +3.359099631481176e-01   +5.545507003764802e-01; +2.209730357747897e-01   -1.291848388491308e-01   -1.585354889804076e-01   -3.016707329903332e-01   +1.903341438740953e-01   +3.691220377814825e-03   +1.982003970103238e-01   -1.408687879531396e-01   -4.152011141379897e-01   -1.651151213692543e-01   +2.531848761069641e-01   -7.544415657212022e-01   -4.454644234459899e-01   +2.041124268654625e-02   +2.653168803400830e-01   +4.208191126498006e-01; -4.557887430796241e-01   +8.106089177433677e-01   -6.790515008394025e-01   +5.887333719059801e-02   -2.236862005739145e-01   +4.993206731854614e-01   -1.500188150080523e-01   -4.922086358430907e-01   +4.675192671470290e-01   +1.590152634129429e-01   +6.981321026008692e-01   -1.968517111344721e-01   +4.139808110336579e-01   +2.663060665509441e-01   -2.921572038817244e-01   +1.943514616879140e-01; -5.589942990947609e-02   +7.882192041954077e-02   +3.301280798227273e-01   +2.074491864487926e-01   -7.697358226142451e-02   -4.169316472773151e-02   -9.892071153322726e-02   +6.931384583788299e-01   +4.484544764115288e-02   -6.113708326603982e-01   +6.401462150586835e-01   +3.559294821357940e-01   -4.039560695075097e-01   -1.903647777445265e-01   +3.248499677799400e-01   +1.059476492570542e-01; +4.515443438815830e-01   -4.356250370409565e-01   +3.234454525411978e-02   +2.729825015181628e-02   -1.871343017853127e-01   +5.843299567441617e-01   -5.541323524543797e-02   -6.663342590685742e-01   -1.202317424534545e-01   -1.272755048826174e-01   -7.003719440700613e-01   +1.748786290425561e-01   +2.291536374968223e-01   +1.205152478266726e-01   -6.586101677801873e-01   -1.457133796105071e-01; -5.082647662278994e-01   +1.806550855368919e-01   +2.838113939911104e-01   -3.154970820880249e-01   -2.714251524236329e-01   -2.075579269997831e-01   +1.621346686161942e-01   -1.489658161446790e-01   -9.628487894696297e-01   +3.393725905010986e-01   +4.319457118158944e-01   +1.862869053312761e-01   -8.474490274153440e-02   +6.650745849044697e-01   -8.991300729079251e-01   -6.389982748542571e-01];
L2I_L2E_iAMPA_netcon = [+3.780605822964402e-01   +3.459030910172546e-01   -4.515349079110335e-01   +6.166511170187788e-01   -2.691721206963298e-01   -1.006338626888139e-01   +3.703540018596609e-02   -8.828913282904402e-02; -1.349438739936185e-01   -8.666617464325149e-02   -1.095287779917783e-01   +8.718519685326852e-01   +1.311493227835348e-01   +3.480634510768159e-01   +4.270192472128351e-01   -2.016082710725618e-01; +2.223915635093276e-01   +6.881936813195282e-01   +4.939787737501389e-01   +7.626125632413520e-02   -2.332403317835131e-03   +1.387150892794551e-01   +3.926783397471461e-01   -1.564981053173932e-01; +2.207735714129402e-01   -3.152644765745919e-01   +8.179435088040096e-02   +6.760340535655837e-01   +5.691491357612608e-01   -3.491472189103025e-01   +8.360186222443940e-02   -6.367401271587392e-02; +3.325533410618589e-01   -2.304495992768766e-01   +5.353338636425400e-01   -5.683230691878438e-01   +2.114684169534128e-01   +2.676835556669158e-01   -4.936158649002145e-01   +4.644636407533137e-01; +3.327886735085802e-01   +1.000000000000000e+00   -5.781472431915592e-02   -2.666057994677612e-01   -1.030219854052210e-01   +1.571081682903094e-01   -3.082432414309514e-01   +7.398785355108509e-01; +2.048907265631579e-01   -2.744088859078099e-01   +1.797934929761376e-01   +1.749780767930785e-01   -1.157174271951907e-01   +1.788494825630052e-01   -3.079873447853443e-01   -3.405302757248214e-02; -5.534110654889182e-02   +4.903683134094761e-01   +3.508852183544899e-01   -3.663973537491821e-01   -7.222462040545174e-01   +6.236465371306616e-01   -7.171862062392936e-01   -2.613836532718959e-01];
L2E_L2I_iGABA_netcon = [-1.842860153166321e-02   -7.476555651201879e-01   +5.058029394103397e-01   +3.779826308623011e-01   +8.890741673064857e-01   +7.732635459368686e-02   -1.058988177455862e-01   +3.654643234637195e-01; -5.886974002633173e-01   +3.294127746442302e-01   +7.066231565997847e-01   -6.887592239958766e-01   +2.903016638525209e-01   +2.802156402657948e-01   -5.853060019268791e-01   +6.792783608644019e-01; -1.776771190784797e-01   -2.193787161005722e-01   +1.250506995380752e-01   -3.026512562794992e-01   -1.140695139769570e-01   -6.209034400808979e-01   -4.593061110380058e-01   -4.114859276476602e-01; -4.824787272872089e-02   +2.734449457301666e-01   -5.255659409821641e-01   -7.262323925656855e-01   +7.383382769874551e-01   +4.044507331219049e-01   -4.094474237537015e-01   +1.293472822222702e-02; -4.737924144278908e-01   +3.548879422751498e-01   -2.242404262861176e-01   +1.127767144034185e-01   +6.548953336665861e-01   -2.472996086338446e-01   -2.814184214713642e-01   +3.208702092348011e-02; -6.989238871092814e-01   -3.001699438413913e-01   +5.306485794145678e-01   +1.839755026305261e-01   +1.672476722853415e-01   +4.060189852444506e-01   +2.020646082886888e-01   +2.891206374958674e-01; +6.661155527953331e-01   -8.760551660462690e-01   +2.361932707250553e-01   +5.330738568016818e-01   +4.055468953329837e-01   -6.634086113590749e-01   +1.772628664140989e-01   -1.377526952402634e-01; +5.043925952400343e-01   +2.516235106053450e-01   -2.162575212516140e-01   +1.468631394722212e-01   -2.789028808375385e-01   +3.471153178074192e-01   -1.621909475855591e-01   +1.812532790294680e-01];
L3E_L2E_iAMPA_netcon = [-3.878629246216931e-01   +4.040591005686572e-01   +1.446022319804151e-01   +6.209680786178930e-01   -7.275723028316484e-02   -6.288018535699705e-01   +1.828384210841244e-01   -2.412732273838302e-01   -1.653482324196253e-02   +5.121370466558648e-01   -1.620298082784617e-01   +2.236265105047228e-01; +4.656104833325762e-01   +1.021138327470212e-01   +1.512301365256065e-01   +3.939789758765059e-01   -1.496016101108657e-01   +5.417902103794751e-01   -7.876034550056070e-01   +3.101330607681839e-01   +3.194661157070217e-01   -5.154643322171500e-01   -4.123566123344342e-02   +4.209950923470502e-01; +4.676611652699103e-01   -2.033657693443998e-01   +3.387005206282242e-01   -3.348341174154865e-01   +1.018346932584776e-01   -7.535309049499660e-02   -1.534749954197460e-01   +5.640744136638546e-01   -3.017849100143598e-01   -3.099394866532313e-01   -5.702062937777892e-02   +5.820609653113024e-01; +2.716971001454338e-01   +1.781983350359744e-02   -1.274947385977191e-01   +2.254139972849475e-01   -2.753898405418228e-01   +2.173504390616603e-01   -1.227545455061100e-01   -5.619475391159815e-01   +4.716260105537826e-01   +1.934276051977796e-01   -3.630354368494983e-01   +3.932224471474270e-01; -3.683177216076820e-01   -2.531450868877204e-01   -3.984588512792153e-01   +2.607782909300818e-01   -1.976236493878987e-01   -3.378151313610108e-01   -2.572046068485589e-01   +2.665165404220659e-01   -3.801478358174037e-01   +2.026359947675262e-02   -4.824126814427036e-02   -2.802757572549400e-01; -6.767186953109360e-01   -5.542319659870911e-01   -2.102628857220026e-01   +1.828861054870220e-01   +1.806017464769659e-01   +1.627472156381339e-01   -7.053637401785805e-02   -1.502146767415976e-01   -6.222839629045780e-02   -1.718680023441862e-01   -4.639425509518205e-03   +2.606795270345036e-01; +1.008276048518036e-02   -1.312036897941511e-01   +7.089845614856352e-01   +6.774793019553696e-02   -7.646758497061044e-02   +1.904750037899917e-01   +1.875367238409291e-01   -1.253883964816094e-01   +1.358942588627516e-01   -3.708559589041333e-01   +3.048600530083020e-01   -7.286809252020506e-01; +4.825951119430960e-01   +4.664360765875581e-01   +4.494682707138064e-02   -1.305442787175872e-01   +1.936981552312374e-01   +1.423964111423357e-01   +1.000000000000000e+00   +1.387413542990146e-01   +9.398448940742155e-01   -4.207252003050873e-01   -7.492406726515495e-01   -4.034163783090502e-01];
L3I_L2I_iGABA_netcon = [-5.480198048937561e-01   +4.504950447129597e-01   +1.845576162082509e-01   +4.994878088324279e-01   +3.058668973479942e-01   +7.075906374985541e-01   -2.355972776987443e-01   -3.223157244160042e-01   +4.367900223081200e-01   +5.754262094113246e-01   +2.017079217759241e-01   -6.705704168355123e-01; +3.530399091040221e-02   +4.724582468448532e-01   +7.768686760707322e-02   -8.168759793857232e-01   +3.728381850939387e-01   +2.331423169482316e-01   -3.660919040554487e-02   +3.695103815900593e-01   -1.398147877372515e-01   +1.571581795536200e-02   -8.657396711205574e-02   -3.096221110292201e-01; +1.025837618695859e-01   +1.344005602804045e-02   -1.000000000000000e+00   +6.906922513434628e-01   +1.822717346901457e-01   +3.814963744426537e-01   -3.402315356860298e-01   +4.979353649886842e-01   +5.300518873073429e-01   +2.424321440510046e-01   +1.988329560135330e-01   -4.543458658704988e-01; -9.171806457590587e-02   +2.643609532774187e-01   +5.868740921050515e-02   -3.115576941843849e-02   +6.847014618496687e-01   +8.290183419827211e-02   +2.388650541386011e-01   +2.349161547231826e-01   -7.137923612860737e-02   +1.220366764170490e-01   -1.767409070268119e-01   +6.970217834777830e-01; +1.230285438319960e-01   -3.016938561282111e-01   -4.798402060448522e-01   +1.483369672583936e-02   +4.220036125334312e-01   -7.241470621567653e-01   +2.108485852927137e-01   -1.856898882135680e-01   +1.218329856746029e-01   +3.723632748795949e-01   -1.410064190372905e-01   -4.207075729333984e-01; -2.978808689697710e-01   +4.801571462634287e-01   -3.275836063109171e-02   -7.562408842647158e-01   +4.035100416987619e-01   +8.722334791317438e-02   -1.224975457651782e-01   -1.817467205918475e-01   -3.510294226267682e-01   -2.130649284989538e-02   +2.482965955348432e-01   -4.175032740225256e-01; -2.555449946366043e-01   +7.344668787374484e-02   -4.245154884246495e-02   -1.747703681177545e-01   -1.143629651268867e-01   +6.847733437057754e-02   +1.353777523650137e-01   +4.783685798406354e-01   +2.945356124416878e-01   +2.338304093024341e-01   -7.740404890876301e-01   +9.831818347126893e-01; +2.524833648219001e-01   -3.512229364563620e-02   -1.869170952564272e-01   -7.235216312524185e-01   +1.796805135046886e-01   -1.301222428971610e-01   +2.566192416430423e-02   -7.980276492320360e-01   +3.229591543678912e-02   -2.418188194635982e-01   +5.918572330465655e-01   -9.177174310133772e-02];
L2E_L3E_iAMPA_netcon = [+2.837398761440917e-02   +2.140991331140657e-01   +3.618979098189909e-01   -4.721128082253906e-01   -2.662851477366265e-01   +5.389962969769897e-01   +6.741371746209962e-01   -1.964838342816942e-01; -1.860987825864647e-01   +6.576504074043809e-01   +7.459067308387619e-01   -1.995385379121051e-02   +4.912509037526667e-01   +6.444955135792352e-01   +1.421285277718846e-01   +1.977356308614207e-01; -1.222380453403246e-01   +7.069859257450105e-01   -2.830074052741898e-01   -3.602341325867025e-01   -5.681131477297108e-01   +1.522627383396917e-01   -5.188009829224826e-01   -5.038026136555248e-01; -2.916717001563414e-01   -3.860028240720698e-01   +2.699491867655279e-01   +7.030583290840481e-01   -6.660272204123918e-01   +5.609930517054367e-01   +7.037601374472436e-01   -2.820586278619595e-01; +4.815443736469180e-01   +3.778334230525438e-01   +6.958988597433661e-01   -6.704466814167277e-01   +8.942496284917086e-01   +2.780974797801087e-01   +1.411188495818925e-01   -5.442740816203369e-01; -1.171088788942944e-02   +3.848444673718684e-01   +1.286414976938946e-01   -9.180087507339772e-02   -6.924206793390394e-02   +2.955212721406008e-02   -1.435897238059858e-01   +1.662261616192862e-01; -5.374579095207811e-01   -3.395127929483652e-01   +1.900381694532534e-01   +1.730489293680537e-01   -6.639681501906607e-01   +1.807568846933698e-01   +1.169812632058898e-01   -5.570904529352018e-01; +5.973000460575789e-01   +4.859545109027908e-02   +5.831404133587900e-01   -1.779652060950812e-01   +4.879641588573489e-01   -8.047467612389015e-01   -5.470602275038829e-01   -1.011705837102128e-01; +2.751686403208211e-01   +6.941638328700240e-01   -1.000000000000000e+00   +2.282428521901016e-02   +6.905222220503877e-01   +3.706748391232682e-01   -6.456435287830722e-01   +2.224678918360435e-01; -2.318441277260888e-01   +4.888341775132211e-01   -2.636376469473536e-01   +6.520198571475097e-01   +2.918201723074227e-01   +2.073562547632206e-01   -3.171861373762350e-01   +2.308814819988957e-01; +8.334585160811701e-01   -1.853072291136666e-01   -1.902328997423387e-01   +4.757159000477101e-01   -8.936228166403444e-01   +3.445227175295777e-01   -6.330499894398109e-01   +3.004662826077180e-01; -3.534675224967594e-01   -6.979127642970643e-01   +6.394515335613836e-01   -3.325526109118331e-01   +2.503762203536340e-01   -1.174118067484495e-02   -1.447331976422197e-01   -5.040249904625549e-01];
L2I_L3I_iGABA_netcon = [+2.708989381415027e-01   +1.461114042586675e-01   -1.781567677288282e-01   -8.253382984192276e-02   +6.136528219836478e-03   -1.947344164285270e-01   +7.051287150718769e-02   +8.778787189183013e-02; +1.000000000000000e+00   +3.895946618102274e-01   -1.176524911581893e-01   +2.887287147904617e-03   +1.139118913545047e-01   +2.520130714689997e-01   +7.461017414289371e-01   +3.240471766823683e-01; +1.633726938121379e-01   +1.129193135228246e-01   +3.248998792629832e-01   -6.547785528128014e-01   +2.144594237203645e-01   -6.647394543077709e-01   +2.789854843969808e-01   +9.272705425544002e-02; -9.924301507908818e-02   +3.753549208082510e-01   -7.390367626286448e-01   -2.104000610967460e-01   +4.152782835225142e-01   +4.474234121104094e-01   -2.369026481712223e-01   -1.066023969925207e-01; +6.016055692522069e-01   +3.769334083501709e-01   -5.358747525472590e-02   +2.392565985828211e-01   +2.748188683086656e-01   -7.023252447625865e-02   +7.015822253149558e-01   -8.204721688871980e-03; +2.438475393833457e-01   -3.501086123989477e-01   +3.607813604118902e-01   +7.479839409127349e-01   -3.255250086979787e-01   +6.155089684847200e-02   -2.697056980929203e-01   -2.557143124364090e-01; -7.029040746252362e-02   -4.452328525759976e-02   +1.805511157456054e-01   -5.886046535823857e-02   -1.382730901291082e-01   +1.655447754036281e-01   -4.141782318340156e-01   -1.391667125205539e-01; -1.112534794204527e-01   -4.736962569957640e-01   -2.593131975573909e-01   +5.765534445301809e-02   -4.786809007034870e-01   -2.898189689424597e-01   +5.915758254003338e-01   +4.500094160313214e-01; +4.345651384982619e-01   +8.682502506709538e-02   +3.870672486349127e-01   -7.421191616052859e-01   -1.806451329090273e-01   +1.028366179914421e-01   +5.852030007049729e-02   +2.449858434930860e-01; +3.270128708654306e-01   +5.041951038984017e-01   -2.626119642730769e-01   +2.271890117157235e-01   +6.245736255667755e-01   -1.084947122568252e-01   +5.591198034479801e-02   +4.625379373565787e-01; +1.252412460596163e-01   -7.975402131609139e-01   -8.167784946060361e-02   -5.876366205127642e-01   -3.141543193206035e-01   +3.105391662353528e-01   -2.305953153698830e-01   +4.619698044829749e-02; +1.224481367640413e-01   +6.250689549564064e-01   +6.315839907987081e-01   -1.201470565078671e-01   -1.866316766713066e-01   +2.586877149559376e-01   -7.921137982614974e-01   +2.725122263926065e-01];
L3I_L3E_iAMPA_netcon = [-4.287048443316940e-01   -2.939695974379684e-01   +1.788326852000982e-01   -8.812266542738516e-01   -2.277415479234590e-01   +5.673415124626746e-01   +4.938593169011105e-01   -6.041737916520521e-01   -7.441815379446809e-02   -1.103478724223969e-02   -3.053630898229240e-01   -1.487155627283357e-01; +1.226972663339053e-01   +4.071196670504516e-01   -1.972809430704682e-01   +5.374518107652823e-01   +7.863636871189996e-01   +1.279135620330743e-01   +1.765171994440426e-02   +2.624416844055640e-01   -3.193484785392633e-01   +3.258678393141074e-01   +4.360331398824489e-01   +1.572915403525610e-02; -2.852020943993375e-01   -9.451869362160184e-02   +1.406257924418255e-01   +3.792640024028276e-02   +4.559681950684942e-01   -8.625220478032895e-02   -8.934260318374734e-01   +5.394323187759761e-02   -5.966805870696600e-01   -7.244685083603498e-01   -1.532669384431131e-01   +8.411135284760892e-01; +5.203689706816437e-01   -1.244360042142960e-01   +4.602864767990040e-01   +1.706205272577159e-01   -1.081281773080822e-02   -6.521544378923451e-01   +1.207910924911600e-01   +1.644971291841349e-01   -2.305185467597299e-01   -7.892344623138767e-01   -4.826830307678985e-01   +5.469768159143488e-01; -4.099989474880044e-01   -2.419736815955453e-02   +3.691411383096435e-01   -5.607761532481315e-02   +1.404326685319476e-02   +2.873022562434428e-01   +5.712047836750159e-02   -3.502845099236870e-01   +2.411325729326924e-01   -1.897781139528592e-01   +1.927907067092528e-01   +8.673446976575129e-02; +6.254565338878003e-01   -3.771772487038380e-01   +6.593143281190335e-01   +1.200039628712088e-01   -1.618625857443622e-01   -5.151661324321687e-01   +3.149641866488045e-02   -4.485813180843718e-01   +6.262527046315687e-01   -4.395588732925625e-01   -4.302260045125833e-01   +2.750347163595070e-01; +7.034645270638702e-01   -8.977698228490011e-02   +1.053593116826467e-01   -3.932990207214900e-01   -1.225626806638966e-01   -2.764322880099940e-01   -5.272534436236415e-02   +8.939150231133453e-02   -8.417076479344444e-01   +2.243702479753653e-01   -5.127047071001846e-01   -2.475625134911422e-01; -1.543100204678138e-01   -2.361724288343936e-01   +3.262451612012625e-01   -5.399044309554614e-01   -3.031352810530511e-01   +8.791041822483878e-02   +2.454760571731346e-01   +3.481084608741222e-01   -2.951097083391334e-02   +2.747083880696281e-01   +3.477761979209258e-01   +1.025251749924542e-01; +6.151596944412567e-01   +5.868525951720494e-01   -7.713553881551095e-01   +1.389635290447010e-01   +5.428438625980974e-01   +7.611962029686757e-01   -6.633010585231121e-01   -1.483135014857225e-01   -3.400124526006602e-01   +2.691222501751055e-01   +4.087439302159871e-01   -6.271485639975529e-01; -8.449791093388299e-01   +3.012642330155851e-01   +1.056428762122418e-01   -5.970785901684226e-01   -6.601205356497215e-01   +2.366538798716252e-01   -7.064930865544040e-01   +1.967016039932631e-01   -6.333869858512901e-01   -1.465633344157696e-03   -7.962059630680552e-01   -3.662047743041661e-01; +6.832964364889389e-01   +1.278327580421240e-01   +2.323015079821537e-01   +6.659320626168030e-01   -3.534724387055858e-01   +1.623656174695902e-01   +7.850890684317668e-02   -3.767143744228605e-01   -3.987163367869603e-01   -4.310515302067480e-02   -2.589515583742030e-01   +7.671344658549839e-01; +6.107741956366209e-01   +5.641404998522247e-01   -4.885054138629483e-01   -5.183966156816369e-01   +9.545831724405146e-01   -1.480733508192054e-01   +2.849475299693213e-02   +5.104344960369698e-01   +2.167132120215882e-01   -1.995708797126062e-01   +4.547139935830160e-01   -1.157623900037119e-01];
L3E_L3I_iGABA_netcon = [-2.696626437388097e-01   -6.538352477964027e-03   +7.775913398506527e-02   +4.372261862922804e-01   -2.930716967355824e-01   -5.945094387658187e-01   -5.888426437050280e-01   +5.556365286450907e-01   -4.432775878902320e-01   -9.780763434584916e-02   -2.173703174681165e-01   -3.726211852602273e-01; +5.494715783476546e-01   +1.183918785336589e-01   +1.522326365809890e-01   -8.842171629816735e-01   +1.179234566132610e-01   -2.281733314249595e-01   +9.057861018613782e-01   +5.958242712550839e-01   -2.739471336745252e-01   -8.394144617031434e-01   +3.324699546780255e-02   -1.033885754233033e-01; -1.449562981474234e-01   +3.106743764716469e-01   -2.715992947300437e-01   +5.597984171614082e-01   +6.355364496930225e-01   -6.819742349496881e-01   -3.143943880920483e-01   +6.555653646446506e-01   +1.336446550370218e-02   -3.916464482213745e-02   -4.316931716057721e-01   -6.953291879724178e-01; -3.044780626503256e-01   -7.388107935716752e-01   -6.292749814582292e-01   -3.411018286564197e-01   -3.977627590877355e-01   +1.749587525141501e-01   +3.320065186686502e-01   +7.285717541189313e-01   +1.164967681296131e-01   -2.071810467655154e-01   -5.787036481588677e-01   -3.540666014117105e-01; +1.573156084326012e-01   +1.877991464814741e-01   +1.453419177420290e-01   -2.562659208985307e-02   -9.897877671210996e-02   +4.898031123288158e-01   -2.763139587781810e-01   +2.868561144856618e-03   +3.242567046221708e-01   +6.216254521472548e-01   -4.023348917737168e-01   +3.052724670801149e-01; +2.395428779856723e-01   +2.855765476890266e-01   +8.686544245309202e-01   +3.869411241145641e-01   +9.505296648259252e-02   +1.137774198270342e-01   -2.642664584690291e-01   +1.870849178015163e-01   -1.028958969186588e-01   -5.629250696905324e-01   -1.754723443778055e-01   +4.907082339202318e-01; -3.513425270130402e-01   +3.572320769551619e-01   +2.413616767616650e-01   -4.162143700711783e-01   +2.922331700170977e-01   -4.452103762786352e-01   -3.269374381060640e-01   -1.487055052497082e-01   -2.192648327379454e-02   +5.066888398937258e-01   +1.446398112674053e-01   +2.489750698783525e-01; -7.090606562981276e-01   +8.968542595177748e-02   -3.571859938870188e-01   +6.763851342648048e-01   +4.917507590371137e-01   -3.463336416064300e-01   -6.663817105279021e-02   +4.069118451767556e-02   -9.190156898050381e-01   +1.322467517735307e-01   +3.883132068114956e-01   -2.931871189769601e-01; +2.475848524260259e-01   +3.892733274425145e-01   +2.368877797596787e-01   +1.441094925469511e-01   -2.662085640941280e-01   -6.180723068399240e-01   +3.678692391893458e-02   -6.217097851460096e-02   +3.157866018154272e-01   +6.378772454722337e-01   -3.435152353956670e-01   +4.375289106132279e-01; -2.829916203361506e-01   -5.874439745188236e-01   -2.263405489760072e-01   +1.387094589990244e-01   -5.284862921151832e-01   +1.067183624886053e-01   -1.496755654867937e-01   -1.820232693310360e-01   -6.336504120550466e-01   +6.925413537983777e-02   +3.867860406403497e-01   -5.166264244214576e-01; -3.715393624627875e-01   +3.491441958875462e-01   -8.982103366182917e-01   -3.624419013497625e-02   -2.184989476419214e-01   -5.974971471492754e-01   +6.910974710284994e-01   +1.556811217880494e-01   +1.907824696790617e-01   +3.132685009696062e-01   -6.496318348987202e-01   -1.719193519777902e-01; -4.591002405073020e-01   +5.594709906320238e-01   +2.144291585265677e-01   +7.285942182641400e-02   +3.882329479301228e-03   -6.131210998013273e-01   +5.355767755598968e-02   +3.034300132002953e-01   -2.925339637734529e-01   -4.795707022760696e-01   -2.543828372896409e-02   -4.353672920628736e-01];
L2E_Input1_iAMPA_netcon = [+5.327893921463148e-01   -2.886127528006624e-01   +1.302696708881142e-01   -3.237523299090755e-01   +5.197037550332676e-01   +7.009213574773774e-01   +2.386812572294493e-01   -4.673786538485570e-01];
L2I_Input2_iAMPA_netcon = [+2.995740040366205e-01   +9.734099159872523e-01   -1.000000000000000e+00   -6.182590866144421e-01   -6.692511364422424e-01   -4.344716554750495e-01   +6.770095455587388e-02   +2.616216462217533e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
