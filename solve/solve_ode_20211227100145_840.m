function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.003831835147713e-01   +3.856565195876052e-01   +4.543846553283042e-02   -3.524548451011100e-01   +2.137136097044259e-01   -3.755871652261925e-01   -2.180360115000383e-01   +7.714382942294890e-02   -3.370971605834897e-01   -2.339042560243934e-01   +1.606490474914344e-01   +2.494746549997630e-01   -3.437486357426961e-01   -1.494291735859039e-01   +3.259201024691695e-01   -5.146264954349811e-01; -1.021113106024068e-01   -8.478466894127497e-02   +2.915805379756193e-01   -2.092999575997271e-01   -2.803280928331575e-01   -5.637842941638971e-01   -2.731823152718777e-01   -1.455283234727419e-01   +4.865777816962259e-02   -2.915434933431338e-01   +1.438711371785263e-01   -1.360316061607878e-01   -5.273478745937633e-02   -2.444990148657917e-02   +3.502856700690338e-02   -3.597607107289639e-01; +1.904794084206556e-01   +1.436753460765216e-01   -5.569993194955609e-02   +3.403086570264890e-02   -3.240917228694407e-03   +1.094859569851232e-01   +1.338915248061856e-01   +3.703814793457054e-01   -3.444658457364618e-01   +9.426380815285471e-02   +3.274886208808138e-01   +2.146305688871147e-02   -2.201969113967808e-01   +2.608489826530124e-01   +3.027196411292324e-01   -3.808553227719308e-02; -3.816751876330854e-01   -3.190775628949675e-01   +7.729804250552691e-02   -1.689282671805719e-01   -1.896836824481856e-01   +2.579975827440827e-02   -3.228813140456999e-02   +5.710413511469810e-02   +2.231674264404698e-01   +5.693530722610762e-01   +2.216231883986058e-02   -5.365770765592812e-01   +1.658158853937499e-01   -2.644766730451004e-02   +4.499063333150269e-02   -1.581596164471596e-01; +4.747045679638395e-02   +9.606144178147191e-02   -2.239127565068382e-01   -1.881003376429727e-01   -1.703817281805917e-01   +2.046256306911507e-01   -6.548387126775793e-02   +2.871018592467570e-01   +3.579598055702745e-01   +1.175244812941280e-01   -2.561245989523549e-01   +5.741058304161006e-02   +2.210739933108482e-01   -5.983366432304346e-02   -1.790083206183162e-01   -8.050366986125759e-02; -5.420182667802886e-02   +1.759903903727065e-01   -2.745514182120498e-01   +3.294757049878987e-01   -5.192810588753470e-01   -4.721142766971390e-02   +1.051966347165407e-01   -2.732264850795976e-02   -1.694151851570858e-01   -4.691932874513379e-01   -3.698499724733301e-01   +1.929595614975860e-01   -3.932706415570835e-01   -1.029791273749440e-01   +8.500312323280744e-02   -4.139397376001365e-01; -2.486468565930654e-01   +1.744203792449681e-01   +1.175961564819824e-01   +1.058930260170318e-01   +3.321142160289225e-01   +1.719656067458557e-01   +2.892333048911725e-01   +3.305904670859685e-01   -2.177050402442883e-01   -2.102664874302851e-01   -2.129626882341407e-01   -1.369381506821740e-01   -9.705253099421574e-02   -1.310533846726460e-01   -9.162939997811467e-02   +2.709839921696904e-01; -2.217588728693623e-01   +1.009477824054443e-01   -6.516235810158527e-02   +4.044051152420977e-01   -2.301667372613259e-01   +1.432103353718062e-01   +1.459840352236696e-01   +1.629436492538356e-01   -2.667322223742437e-01   +1.434812674650509e-01   +4.718772884937328e-03   +2.497424851728970e-01   +5.048123754539582e-01   +4.617064085878804e-01   -9.370469269919607e-02   -4.905634969385452e-01; -2.544949219665510e-01   +2.059291709517605e-01   -2.546488529323070e-01   +2.759355530663005e-01   -3.084547004871122e-02   +1.267771815190828e-01   +1.640725597059982e-01   -8.830660860221240e-02   +8.482336455924047e-02   +2.149782982210789e-01   +2.605197048364435e-01   +1.062104686787278e-01   -2.884133010695800e-01   -6.267463518489325e-02   +2.379811811567298e-01   -2.808007223935615e-01; +3.125410391756581e-03   -1.246115338241088e-01   +1.752657259388301e-01   -6.466441797561168e-02   -2.882190515696997e-01   +1.501131921601729e-01   -1.113531366617661e-01   -7.397500689071902e-02   -5.477909907856796e-02   +1.277283107763634e-01   -8.225195948862388e-02   -6.490696273998449e-02   +4.477464025619512e-01   +2.496299357627201e-01   -3.564080819327780e-01   +9.653281319588877e-02; -3.030303842696533e-02   -4.502082112701822e-02   -7.737095552439904e-02   -3.099835111932253e-01   -1.607845292707888e-01   -1.604624293591602e-01   +4.946921601777532e-02   -6.900230019228622e-02   +8.692090337217648e-02   -4.285323705816438e-02   -1.778167037187288e-01   -3.352359276963820e-01   -3.512164413124937e-01   -3.244523966028912e-01   -2.519519375044156e-01   +1.539638899544588e-01; -3.060948674390988e-01   +7.768030889964045e-02   +1.015144505279605e-01   +1.240009491773368e-01   +1.083213766108812e-01   +2.643719369970898e-01   +1.691628564160071e-01   -3.078273068782161e-01   -1.253321227424747e-01   -1.584543866940532e-01   +2.067679198260665e-01   -3.917763008686356e-01   -1.803889614458349e-01   -3.833737203525810e-01   +8.973872928579482e-02   +4.106150428496945e-01; -1.040989462294580e-01   -6.968122485921813e-02   +2.192620080292346e-01   +1.668461395828347e-01   +9.282592994314347e-02   +1.324231904827695e-01   -1.483380608679700e-01   +6.222371720084300e-02   -3.927272778837173e-01   -3.825661231106114e-02   +1.977819694446879e-01   +1.780347653929268e-01   +1.723405713485368e-02   -4.708701826724161e-01   -2.106692587241422e-01   +2.033649823223759e-01; -2.802745285336415e-01   +2.409428609370508e-01   -5.532533662643210e-02   +2.289536582124801e-01   +1.846871734119400e-01   -1.004032391205839e-01   +6.010671945364934e-02   +1.856207148637332e-01   +1.102557007206632e-01   +6.268089445260028e-02   -1.774348562017870e-01   +6.762950683707594e-02   +2.199230815691028e-02   +2.165148971283579e-02   -2.936632181381924e-01   -3.337276251485343e-01; -2.990415211666863e-01   -8.674755430573848e-02   +2.560753450964394e-01   -1.101415131953219e-01   +1.304991553947911e-01   -1.224293079493792e-02   -2.219887239557175e-01   +1.014595625344269e-01   -8.489126877561610e-02   +1.343217900169699e-01   +1.745947512218936e-01   +3.598865421361209e-01   -3.715111495864452e-01   +3.236477750957749e-01   -2.763733981741789e-01   -1.021868973042184e-01; +1.975648125727821e-02   +6.303977466165195e-02   -3.444419893664736e-01   -1.810628309341979e-01   -3.428997996237111e-01   -1.532306859078813e-01   -6.073472260077869e-02   +2.838130836467967e-01   +1.212010551318680e-01   +6.648375538265688e-02   +9.063157020373919e-02   +1.273869012251062e-01   -8.560516882968476e-02   +1.644096129654921e-01   -1.073231705916353e-01   -5.729576093230290e-02];
L1E_L1I_iGABA_netcon = [-4.172821831070648e-01   -3.495964328778894e-01   -4.420422451101098e-01   +1.572504606662293e-01   +1.395765133992924e-01   -2.355928740435956e-01   -1.323655242979923e-01   +2.769114755189903e-02   +1.313038649901521e-01   -4.841962725463884e-02   -2.795656617847635e-01   -2.881664750023106e-01   -5.535415053207232e-02   -1.614573245836771e-01   +1.199361082666643e-01   -2.154827227726795e-01; +1.391952463427619e-01   +8.346765672802753e-02   -3.022054616744414e-01   -1.295799112473441e-01   +4.757868556899766e-01   -2.078821405589945e-01   +3.752074880935323e-01   -2.577464173843613e-02   -1.899899799545279e-01   -2.375852617165847e-01   +1.569706134298062e-01   -2.066139097535354e-01   -1.893017512760448e-01   +1.168322351218073e-01   +2.637320541208580e-01   -2.482419869179127e-02; -2.167706841460056e-01   -2.403966406695482e-01   +8.667956869289611e-02   +3.572122849026169e-01   -2.915287943835710e-01   +2.972727038242118e-02   +2.710193738696472e-01   -2.376906681921226e-01   -8.609049661517161e-02   +1.732601911318407e-01   -2.790247600186038e-01   -2.312617114116583e-01   +1.209494697080316e-02   +5.205933827470842e-01   -2.677116847308256e-02   +1.150382710243520e-01; -1.547049259549043e-01   +2.152275732363373e-03   +3.897788959956806e-01   +7.380365710527725e-02   +1.236117363754579e-01   +9.714666462081475e-02   -4.232935576620087e-01   +2.613346167133383e-01   -5.140755718056147e-01   -4.285215321036041e-02   -4.121412416839958e-01   -5.236578311285411e-02   +2.288088355359668e-01   -1.881763406491358e-01   -2.962937438757201e-01   -2.320714338153961e-01; -2.308895360991010e-01   +7.167882748627347e-02   +1.136435026754336e-01   +2.496672894937500e-02   +7.493589537639883e-02   +3.025679257057904e-01   -5.522129918792511e-02   -1.340002913609430e-01   -1.687461542598011e-01   +4.886898053592195e-01   +1.089885962571418e-01   -2.420391190327814e-01   +1.883712410097277e-01   +7.176186483517527e-02   -2.265170193271027e-01   -1.967844958212124e-01; +2.388590566833900e-01   +1.287790032949706e-01   +1.313672393842083e-01   -3.798780473813435e-02   +8.793361058955815e-02   -6.882001480415732e-02   +2.459892738109988e-01   -1.964955544808994e-01   +4.849478976003126e-01   -2.295240928106506e-01   +9.125823013960453e-02   +1.039867614495984e-01   +8.248629738264467e-02   +1.461965070662875e-01   +5.240292957527383e-01   +2.237207089809164e-02; +2.171006329803515e-01   +1.093496435022602e-02   -1.946332723116653e-01   -3.310714168135942e-01   +5.289634082870920e-02   +1.599415827447681e-01   +3.025927217126100e-02   +2.879648603184948e-02   -2.983926227817641e-01   -9.926455425078032e-02   +2.424293395373060e-01   +9.104026150661582e-02   +1.356820541943277e-03   -1.313249444335637e-01   -1.930524818097116e-01   +4.362174097483372e-01; +2.184274794740504e-01   +1.159617498729331e-01   +3.674462474114701e-02   -7.396737486673524e-02   -1.096396505363992e-01   +4.247279457923504e-01   +2.816239723446530e-02   -2.771651254861255e-01   +2.822492244450119e-01   +3.180176097932301e-01   -2.545868536164798e-01   -1.847378707230880e-01   -1.533209098804429e-01   -2.234752950593333e-01   +2.774250769581342e-01   +1.253973521767283e-01; +2.497613588975396e-01   -3.209748624148068e-01   +1.652365338365477e-01   +1.441481957227756e-01   +1.553999821865283e-01   +2.494863321081993e-01   +1.640248764338858e-01   -2.074081109264892e-01   +4.568092215452097e-01   +5.460169057807830e-02   +9.308817277936104e-02   +1.690370569321681e-01   -2.061453741623610e-01   +1.080675090803435e-01   +3.535807535780738e-02   +1.923814357740206e-01; -3.518295710134997e-01   +1.410921347373933e-01   -2.878207905521343e-01   +1.154760108396950e-01   -1.622860956273647e-01   -7.707647847222666e-02   -5.500619809930421e-02   -3.837437723941779e-01   +3.969864890491812e-02   -2.800942578549434e-01   +6.782641661665381e-02   +1.890569020820975e-01   +2.148608325744986e-01   +2.166890838786005e-01   +3.959727376258312e-01   -1.750143662361282e-01; -3.778946770838118e-02   +1.100147975616052e-01   -6.913499280724167e-02   -2.795726328719225e-02   +1.991839300784367e-01   -1.006090607993192e-01   +5.397783652876789e-01   +2.303302402962140e-01   +2.297622148436937e-02   +4.901176966839155e-02   -2.466110377887344e-01   +1.876583258511612e-01   +1.175692529372840e-01   -1.788877919883980e-01   -2.822357926549232e-01   -2.583546361515851e-02; +1.096772959127822e-01   +1.526518382919570e-01   -1.381782849016345e-01   +1.560607509000072e-01   -1.164335656571628e-01   +1.080609293131755e-01   +8.020967610109013e-02   +3.095944479934538e-01   +3.059047387629227e-01   -3.883453390576791e-02   +9.593851603544931e-02   -3.094244368371829e-01   +2.931545834810609e-01   +9.920376748822241e-02   +1.218667844368032e-02   +2.693592184198468e-01; +1.568265777476132e-01   -2.759472749486063e-01   +1.597312234883106e-01   +2.058470458453186e-01   -2.439849942780667e-01   -3.787062824279783e-01   +1.406435735234120e-01   -2.453001283463646e-02   -8.105017254744573e-02   +1.253027412679731e-01   -3.947971002143320e-02   -1.912189221124082e-01   -3.365612057009408e-01   -4.375206791865397e-01   -3.250182619206801e-01   +2.538110016288379e-01; +1.313845276200615e-01   -1.537227920121849e-01   -2.342220756458118e-01   +3.268696128314765e-01   +5.673512361122741e-02   -1.913307305815826e-01   +2.044146084568058e-02   -3.327140812783933e-01   +3.248987696220360e-02   -9.277372552203043e-02   -8.834404915604306e-03   -1.173301598995075e-01   +4.556420764460167e-03   -1.822657706456898e-01   +2.485708831657213e-01   +2.122954501840502e-01; -1.212335661653063e-01   -4.615825003076404e-02   +9.982408604904357e-02   +1.669515753932803e-01   +1.133484774643635e-01   +2.749586151205753e-02   -1.121446402152117e-01   +7.795150650639092e-02   -1.174963387691880e-01   -1.009757452805362e-01   -2.995224501720314e-02   -3.785324489761724e-02   +7.145954179006567e-02   -2.750260230841670e-01   +1.686452091535743e-01   +2.387382983368546e-01; -2.381134666813864e-01   -1.910056036028611e-01   -2.428355894463469e-03   -4.903363805345242e-01   -9.271612634525622e-02   -3.227984850498979e-01   +2.463217999518723e-01   -2.189308156521642e-02   +1.145614707372199e-01   -2.869491886918994e-01   -1.020557799357985e-01   +3.054481617163924e-01   +3.823780869087195e-01   +1.604000554601830e-01   +2.871701126400912e-01   -3.065757117785377e-02];
L2I_L1I_iGABA_netcon = [-3.844325683428342e-01   -1.061391584499028e-01   +2.738489008475919e-01   -1.614731807658681e-01   -1.217843064568287e-01   +4.856785203601982e-01   +1.918021808227536e-01   -1.727955597922497e-02; +5.673363534196188e-02   +1.321094750296664e-01   +1.375214523990161e-01   -2.343668524755805e-01   -2.724364197622860e-01   -2.800281244113234e-01   -3.444606095529018e-03   -1.302510598874476e-01; -1.237186704063176e-01   -1.386614869400249e-01   +3.053760926467400e-02   +1.490338031765829e-01   -9.667626872390478e-03   -2.327800779754360e-01   -6.864349967696162e-02   -1.815989881347268e-01; +4.017928728993259e-01   -2.792343282424134e-02   +1.859388151604329e-01   +3.258990881884667e-01   +1.140277557922652e-01   -2.925572027413324e-01   +3.813958753300820e-02   -2.422709507971396e-01; +3.503416476211337e-02   -5.650132526332663e-01   -1.564305070990245e-01   +3.196123346421716e-02   +1.787338539572337e-01   -3.169019095386297e-01   -2.662544586499669e-01   -1.867378896352673e-01; -4.279714773440535e-02   +1.420211172364341e-01   +2.284807094564887e-01   -2.806150248641905e-01   +1.420194078103355e-01   +3.690339428122513e-01   -1.563638794909034e-01   +3.068863448428207e-01; +7.014926291993002e-02   -1.133877235999677e-01   +1.484883089324391e-01   -1.347829584480126e-01   -2.647854676882943e-01   +2.419085680181713e-01   +6.372478855771395e-02   -1.791180504434086e-01; -1.125582197595692e-01   +2.768261838468266e-01   -1.605619665589284e-01   -4.095324747701506e-02   +6.833474582761245e-02   +4.402965047195267e-01   -7.968374033844876e-02   +2.625362310487860e-01; +2.336244073260726e-01   -6.618036201474231e-02   -1.224722493213999e-01   -1.783045261203874e-01   -5.920828960756658e-02   +8.643703421849686e-02   -5.939407691627074e-02   +2.363287745500406e-01; -2.357650671126950e-01   +2.632357392469364e-01   +1.318137357574173e-01   +8.634659017295315e-02   +3.476265856178349e-01   -1.725263320894580e-01   -2.059592315437521e-01   -9.585558185308718e-02; -6.580373249363528e-02   -2.852970627888581e-01   -3.646285696507029e-01   +3.057246324507790e-01   +3.879519516693256e-02   +3.440276961104850e-02   -2.380112585627983e-01   -1.274701491732163e-01; -4.399253278166165e-01   -1.585599378319108e-02   -1.892116573335349e-02   +4.066203941513457e-01   +4.812177811955379e-01   +2.134055968932390e-01   -1.846148302767270e-01   +5.892834261019250e-02; -2.734388660962199e-01   -2.657427960136682e-03   +7.721510012226096e-02   +3.109712375230960e-01   +2.955271723527172e-01   -4.460707157169950e-02   +6.449368440348038e-02   +1.435859210716874e-01; +1.371805417342195e-01   -2.346014203988208e-01   -1.043586627849473e-01   +2.261551300312065e-01   -2.816178201052099e-01   +1.245211300336224e-03   -2.139060699734109e-01   +5.912384372438508e-02; +6.798696131444344e-02   +1.324811319330172e-01   +1.231554915726940e-01   -1.842765966277068e-02   -1.051175439161594e-01   -2.272618229286549e-01   +3.286980143160199e-01   +2.158959335781755e-01; -3.538194090423441e-03   +6.685791412283264e-02   +3.525601162000965e-01   -1.728052680297734e-01   -2.345063810305066e-01   +3.179555347483358e-01   +1.723118681817175e-01   -1.298380346544963e-01];
L1I_L2I_iGABA_netcon = [+5.908401585536348e-02   -2.451174910907877e-01   +1.682607915000577e-01   +1.945249795853430e-01   -9.147819394691870e-02   -2.429037356665206e-03   -1.781104602390628e-01   +3.903109241106779e-01   +2.927891389440985e-01   -2.104913722955483e-01   +2.159480708055223e-01   +1.866290267724896e-01   +1.962403860435484e-01   +9.142676148518536e-02   +2.002781583169770e-01   -1.107513266485865e-01; +9.479853649601441e-02   +5.828587896475549e-01   -2.161452578839316e-01   -2.864952858012920e-01   -3.472061762864233e-01   -3.681024164128098e-01   -6.056484662661746e-02   +1.099817677334784e-01   +1.465044671845865e-01   -6.205263829476860e-01   -2.174090039810566e-01   +1.255274391633505e-02   -1.844221278836203e-01   +1.421880285949161e-01   -2.770057447153099e-01   +1.092644232473134e-01; -3.845086055155050e-01   -1.159299058584221e-01   -9.779792371493357e-02   +3.714150793622142e-01   -3.565479992955350e-01   +1.271737345703259e-01   +1.910061604263908e-01   -8.613158063238871e-02   +7.637841529080175e-03   +1.469707460983332e-01   -5.751917148419985e-02   +1.253648956392759e-01   -4.910127738133177e-02   -9.509548169569546e-02   +2.215688411811181e-01   -1.707700042339792e-02; +4.543914644757770e-02   -3.093581277534174e-03   +4.430266618100549e-02   +1.678075803771332e-01   +5.687068948938570e-02   -2.989117595207960e-01   -9.671342034725333e-02   +5.745158379259083e-02   -3.260547256981842e-01   +8.426333692951082e-02   -2.666065641367836e-01   +4.961809831503422e-02   -2.038527706417247e-01   +1.185622009709072e-01   -3.536880950839463e-01   +2.143554104896118e-01; +1.446975709667754e-01   -1.296017802629824e-01   +3.986128531901910e-01   -2.861957979863140e-02   +2.359862487657689e-01   -1.420174964681981e-01   +3.536983066138868e-01   +2.743586814732317e-01   +2.209678724490788e-01   +2.929682071213321e-01   -3.747753628408014e-01   +3.448523640959353e-02   +9.234882972388800e-02   +2.214571297646971e-01   +1.361685670025946e-01   -2.520289578091011e-01; -2.631291950061020e-02   -1.192461140264516e-01   -1.053773665533298e-01   +4.231095972888260e-03   +1.214306671463389e-01   +3.959892254757076e-01   +1.562092470955911e-01   -2.407368027578239e-01   -2.257442752186995e-01   +1.719314610484858e-02   -1.866067777272510e-01   -5.748310122644602e-02   +4.011704844250532e-02   -8.836104300096626e-03   +3.259765293355139e-02   -2.564076182096428e-01; +6.021913664778458e-03   +7.048614646015308e-02   -8.791602452999436e-02   -4.876542177687433e-01   -1.509012101694479e-01   -3.812159913436355e-02   -1.736792557798983e-01   +6.519595360165564e-02   +4.147179454430770e-02   -1.109840616679755e-01   +1.317390016463815e-01   +6.132258849427573e-02   -3.197365413000566e-01   +1.922908961893681e-01   -2.475002034501458e-01   +6.008862840641903e-01; -6.873728432270304e-02   -1.395821184582174e-01   -2.300224278976893e-01   -5.219570443071247e-02   +2.344708318604218e-01   -2.005481121689991e-01   +2.460256758664154e-01   +7.410049627332972e-02   +2.290779268688558e-01   +3.244647901241062e-01   +2.895438890814910e-02   +1.632276117926410e-01   -5.020960625541456e-01   -8.022075769097636e-03   +4.244187955016591e-01   +3.598828645698868e-02];
L2E_L1E_iAMPA_netcon = [-1.741370422247572e-01   +3.411429306653396e-01   +6.598808863034736e-02   -3.909930038617900e-01   +9.387469396251596e-04   -5.443328542571131e-02   -4.325202186794582e-01   +1.261842904328828e-01; +7.300295162975062e-02   +4.908344287231977e-02   -5.857167156070794e-01   -4.268788127926318e-01   -4.661934013043903e-02   +3.262323471623027e-02   +6.029372275129027e-02   -3.677452798474629e-01; -6.620387815377055e-02   +1.574130443194897e-01   +5.234910765770554e-01   +2.923083039774919e-01   +2.609401274828638e-02   +4.886864825432572e-01   -1.104280007664511e-01   +2.890213142963297e-02; -3.185551715570890e-01   -2.004399954018437e-01   -2.147878437572339e-01   -2.597096964118135e-01   +1.124671058921130e-01   +1.353996182985323e-02   +2.467425016580065e-01   +2.407263756609002e-01; +1.721926872550573e-01   +4.622118109625585e-01   +3.883105659059610e-01   -2.338406983991873e-01   -8.521995107051553e-03   -6.862495586474671e-02   -1.188608704165556e-01   +3.349560613127589e-02; -1.084838050908294e-01   +4.495249856178567e-01   -1.410997716114479e-02   -8.622366286593353e-03   +9.400949912058365e-02   +9.773706472677099e-02   +9.334709221944823e-02   +2.603728162732729e-01; +2.231850620216964e-01   -2.896978360403036e-01   -4.205772734147980e-03   +4.747378036820198e-01   +1.033017701913545e-01   -1.280552783139391e-01   -3.874525756413322e-01   +2.794637347880644e-01; -3.902131041453826e-01   +2.775860237076221e-01   +6.138706441430355e-02   -6.367414771643029e-02   +4.308816304105741e-01   -7.825242271737888e-02   +1.827361353158648e-01   +2.028850383246249e-01; +1.213824339678451e-01   +1.725918108406150e-01   -3.050942342634878e-02   +1.588284625161995e-02   +9.315397875585742e-02   -5.469113400085004e-02   +2.719586978868841e-01   -3.736614482482398e-01; +2.503781556258677e-01   +4.681334736186835e-02   -6.383202889669808e-02   +2.937246493602142e-02   -2.462306065399962e-01   -2.723171067806831e-02   +4.109122488704149e-01   +2.244270693235305e-01; +3.234351978327978e-01   +1.474167543606358e-01   +4.480524872812575e-01   -7.316032227754646e-02   -2.540096850037549e-02   +1.362422889316254e-01   -2.133856015703528e-02   +9.173537557219831e-02; -2.560630355573440e-01   -2.046805466947998e-01   +1.345363282438225e-02   -6.338480878019681e-02   -3.388216464876045e-01   -3.318612445379895e-02   +1.801341932630651e-01   +1.291389415163589e-01; +1.539554878287663e-01   +9.813224358531933e-02   -7.627574465106732e-02   +4.711618805976272e-01   +1.791984205085978e-01   -1.538473529322583e-01   -2.641472541582289e-01   +6.222743110632151e-02; +4.539961102447154e-01   -1.556593806250550e-01   -1.353951861001073e-01   -2.133654757030126e-01   +9.590772958516396e-02   -4.629061696903858e-04   +1.140491549336154e-01   +2.652209403731789e-01; -4.049602372055358e-01   -3.251743038636646e-01   +7.150632482117195e-02   +2.040960546113394e-01   +2.082144607135959e-01   -3.442090400949132e-01   +1.514329609089398e-01   +2.799525827644307e-01; +8.124935491663965e-02   -1.817493223334874e-01   +7.234379460654590e-02   -2.675316899469485e-01   -2.756558507534313e-01   +2.920959209899611e-01   +3.391969343740662e-01   -2.244271304413246e-01];
L1E_L2E_iAMPA_netcon = [-4.004357267374266e-01   +7.403218406866788e-02   -1.183903150278922e-01   -1.848316936455615e-01   +3.601634617973771e-01   +1.096126595085432e-01   +5.977733794485207e-02   -1.994206208079707e-01   +3.351098116539994e-02   -1.231967371742810e-01   +1.200021708110663e-01   -3.980726395301853e-02   -2.143083084331913e-01   +2.726942699063719e-01   +2.006843392456385e-01   +2.759082202172705e-01; +8.893574201676693e-02   +7.305018820247254e-02   +4.123607135370531e-02   -7.586279227917017e-02   +1.194875951815212e-01   -3.101732086880187e-02   -1.638306325123529e-01   -1.974190336459203e-01   -1.701043564735735e-01   +1.416623409860727e-01   -2.123861240890139e-01   -1.309456565160729e-01   -6.390444714609508e-02   +6.473802411397600e-02   -2.750765537223239e-01   +2.564957993670052e-01; +6.820438376548223e-02   +9.306689303483374e-02   +2.067233260081430e-03   -4.151425549786914e-02   -2.692272013783400e-01   +3.795709720131726e-01   +1.375680170283911e-01   -1.039449159262979e-01   +6.463283627091947e-01   +7.343600068134379e-03   -1.325365127185968e-01   +3.896590097516746e-01   -3.494622134561889e-01   +4.394457771384525e-02   +3.488322016411362e-01   +1.485882945999036e-01; -8.283778880283596e-02   +1.272143008649533e-01   +1.857005741246342e-01   -2.890596901726428e-01   -1.497875857585451e-01   +1.034254460641857e-01   -2.649174143201585e-01   +4.068945162119174e-01   +1.796106680197812e-01   +1.443676599158522e-01   -8.429581043094291e-02   -3.852574955470256e-03   +2.391279810189584e-01   -6.830143227220292e-02   +1.249386775106929e-01   +4.059412185102330e-01; -1.228094920564521e-01   +4.327450287781583e-01   +3.689617938226484e-01   +3.827865104547169e-01   +1.419517504149826e-01   -1.620737458276522e-02   -1.352236045858575e-01   -1.385435958051625e-01   +3.236839346335223e-01   -4.294113225353287e-01   -8.600708252466477e-03   +9.649015901076710e-02   +2.459375184004460e-01   -4.631086822947335e-02   +2.298041091071764e-01   +4.313377042469358e-01; -2.491417952633551e-01   +3.534659885667980e-01   -1.628965247782859e-01   -4.150159605320405e-01   +2.126836204827365e-01   -6.660656729241639e-02   +4.758715703195479e-02   -9.762836341140890e-03   -3.620148100625898e-01   +2.965766057371999e-02   -2.469461037915682e-01   -2.973573229497821e-01   -2.393390372527022e-01   +1.299704217073226e-02   +3.001075421556688e-01   +2.855358662658480e-01; +7.391258231173647e-02   -7.512034295498890e-03   -4.356198626741019e-01   -2.046451346116346e-01   -1.205982137469015e-01   -2.077161328313369e-01   -2.958573895435313e-01   +2.110137157504471e-01   -6.790781813476823e-03   -1.792092496458964e-01   +1.143190141462357e-01   +4.895389473306249e-01   -5.512072376669501e-01   +7.170466880219234e-02   +2.555519030111219e-01   +9.339392740046494e-02; +9.340697321365897e-02   +1.276623695299471e-01   +1.109331735437598e-02   +2.581548242785058e-02   -2.398475266553162e-01   +3.640740535526896e-01   +2.706485301114525e-01   +3.631970712974810e-01   +9.988542209618451e-03   +1.963269404489153e-01   +1.564027791170842e-01   +6.822742254764277e-02   -2.584498741381558e-01   -9.428149684063497e-03   +3.541671115924833e-02   +2.626628946354391e-01];
L2I_L2E_iAMPA_netcon = [+1.206811461678396e-01   +2.727945312976107e-02   +8.466949601954268e-02   +1.445432501416239e-01   -2.798575965706385e-01   +3.411206496091937e-02   +1.275110083774717e-01   -2.300274857929313e-01; -1.415390431087996e-01   +5.566337726219300e-02   -2.296433853540976e-01   +1.644634166291412e-01   -1.764756639341547e-02   +2.265960220345511e-02   +1.106085452887969e-01   +1.193917402880258e-01; +1.269335510767467e-01   +6.016505964386876e-02   -4.530284450783817e-02   +2.782903707072589e-01   -4.328229647339453e-01   +1.363341851380520e-01   +4.663438857588648e-02   -9.381871120346248e-02; -6.438947665348493e-02   +9.936676593271160e-02   +3.821870928998989e-01   +1.924235796656751e-01   -6.471305056881102e-02   +1.609245767104784e-01   +2.539686878087677e-01   -1.166323115716101e-01; -3.829879773692104e-01   -1.869934951574409e-02   -1.719062003944944e-01   -4.501007761115435e-01   +3.369695377707344e-01   -1.783197375658244e-01   -9.945482462935808e-02   -2.184658837074616e-01; -1.047532342925906e-01   +1.194683582339263e-01   +4.347214048691969e-03   +1.714758776879086e-01   +8.990648911561216e-02   +1.886296271052288e-01   +2.406546394020903e-01   +2.335588410447930e-01; -7.295916231574126e-02   +2.219316347855824e-01   +4.180480861733590e-01   -3.184188289369898e-01   +1.877645965233526e-01   +2.394259248382713e-01   +8.768269003690025e-02   +1.480335465899543e-02; -3.850155587688857e-02   +3.448309164627252e-01   -1.668618988359509e-02   -4.767146034716956e-01   -1.432601178796349e-01   -1.651184638122768e-01   -2.512696440138873e-01   +9.841949899374230e-02];
L2E_L2I_iGABA_netcon = [+2.388182844646494e-01   -2.514886596183529e-01   -2.025266218221450e-01   +3.183673078292026e-01   +2.704427112637094e-01   +5.898518962811419e-02   +1.162628954166531e-01   -7.727618861342128e-02; -3.535487823896895e-01   +1.534142727313535e-01   -4.074898169738331e-02   -5.828020584560493e-02   +1.940045443037964e-01   +3.162985658215207e-01   -1.183187166769142e-02   +1.861379124779783e-01; +3.985368587337755e-01   +1.137560347818053e-01   -2.980640127369417e-01   +1.575916085666748e-01   -1.983402216646699e-02   -6.687623879998963e-02   +1.600122261517838e-01   +1.500195100411177e-02; +2.465227642492363e-01   -1.876356877863030e-01   +1.348932706877846e-01   -2.323582805940810e-01   -9.178857351388528e-02   -1.950506698083155e-01   -8.227712616396898e-02   +2.460511503541657e-01; -2.617674030359710e-01   +2.879155442327238e-01   +2.088305238952588e-01   +1.662738667610489e-01   -3.623853556992042e-01   +2.074432993149509e-01   +2.238234226870092e-01   +3.476843958676459e-01; -1.749508714473278e-01   -3.090498734434669e-01   +2.186428908226539e-01   -4.926568917701136e-02   -1.788138334850200e-01   +8.577443344757338e-02   -2.732408075932641e-01   +2.489232542803736e-01; +1.712153808082548e-01   -3.465912077973524e-01   -3.326044935227672e-01   +1.739193089274579e-01   -3.088759455424480e-01   +2.431300088380693e-01   +2.398803602391333e-01   +2.053491596955304e-01; -3.099695299392613e-01   -4.404104274629694e-02   +3.993741644181551e-01   +3.659409512642000e-02   +3.295638496550657e-01   +8.428464840162973e-02   -2.491064802175416e-01   +5.079287961160357e-01];
L3E_L2E_iAMPA_netcon = [-1.133676605377810e-01   -3.937414750202735e-01   -1.312505372781781e-01   -7.011415194088427e-02   +3.783171777722585e-01   -2.818552594158417e-01   -3.119983784731851e-01   -1.776735342649688e-01   +4.003206503564777e-02   -1.379900248357904e-01   -1.464717247530022e-01   -2.504821155879853e-01; -7.245618026553140e-02   +2.322123820548619e-01   -1.652128047148971e-01   +3.019319455620445e-01   -1.022584231470291e-01   -6.897347130288685e-02   -5.876048386776717e-02   +3.097470420575715e-01   +3.050565725354871e-01   +8.659365093141771e-02   +1.121096271739905e-02   +3.123105811169053e-02; +2.588650033328366e-01   +4.368178552043567e-02   +3.846496385225378e-01   +2.021653735545836e-01   -5.078962430296782e-02   +2.103426024927712e-01   +1.057460833364549e-01   +2.242651719728692e-02   +1.792217220306683e-01   -1.964168247958029e-01   -1.968611484624915e-01   +3.037981182939885e-01; +2.206846182672284e-01   +3.367917528415149e-01   -5.222203184951301e-02   +1.646208377411265e-02   +1.422042511733945e-01   -2.608266697973377e-01   +2.549817635427192e-01   +1.979733546785159e-01   -1.503293158026460e-01   +7.238912971346129e-02   +5.532768644741447e-02   -2.742212268396856e-01; +1.239043058807625e-01   -1.401089555901651e-01   +3.083366706462388e-02   +3.480928167081863e-01   +2.178953194672553e-01   +1.024334868269849e-01   -8.924646054275923e-02   -3.321907160156623e-02   +1.465075554937680e-01   -5.215926615727905e-02   +1.621336996800489e-01   +9.526542980874192e-02; -3.138510348620019e-02   -1.320713806218377e-02   +2.181193741545506e-01   +1.772657430902295e-01   -1.295043684308963e-01   +2.490055416389892e-01   -1.700099115952107e-01   +1.074066041605251e-01   -2.425694400512595e-01   +1.689044658793070e-01   -1.839483965392719e-01   -1.868274346057000e-02; -1.388237181864774e-01   +1.394553563180409e-01   -1.763083936423505e-01   -2.315436958945021e-01   +1.116778053383566e-01   -4.339108837019451e-01   +1.390402148795594e-01   -4.547603381337949e-01   +1.137457932828349e-01   -1.036329567305599e-02   -3.632625565808225e-01   -5.072005226538460e-02; -4.962686993144795e-01   +3.119441803001313e-02   -4.068476520419494e-01   +1.937426075659375e-01   -2.040629035384063e-01   -9.639463979296739e-02   +2.645400425608107e-02   +8.522407165304124e-02   -2.331325834729505e-01   -3.332371628571933e-01   +6.526457461788392e-02   -6.287169446053391e-03];
L3I_L2I_iGABA_netcon = [+2.536882414493371e-01   +1.831603373705255e-01   -3.219229815519104e-01   +1.057993302340416e-01   +3.297908031888874e-01   -4.058281953490697e-02   +3.235984787677259e-01   -1.355773728663465e-01   -2.385889323488496e-01   +1.432451522846195e-02   +1.733883926215193e-01   +1.086517552619957e-01; +2.421905655555193e-01   -1.450304278484516e-01   +2.249672876682125e-01   -2.145257948572813e-01   -3.590413414386969e-01   +3.825953961101171e-01   -5.431190650428257e-02   -1.879073488851386e-01   +2.101548918625352e-01   +3.519307053066400e-01   +2.775232947892998e-01   +3.182780631123618e-01; -1.421339011641603e-01   -9.364557239066512e-02   +1.766766146624260e-01   -1.634858355216059e-01   +3.181071451741847e-01   +1.007591439451908e-02   +2.557200300721112e-02   +7.453198391610044e-03   +1.792456487690497e-03   -2.540152931125075e-01   -1.218143659108172e-01   +2.241157582029226e-01; +4.464228861558307e-02   +6.109036592194877e-02   +2.931609550125195e-01   +2.288833114640865e-01   -3.033148405586070e-01   -1.762062336736934e-01   +5.835915062581709e-02   -8.164064653925637e-02   +1.231644087961140e-01   +2.919515522449615e-02   +1.438431972244315e-01   -1.457597915587104e-01; +2.590817309490128e-01   -3.516622487079504e-01   -1.641742124586591e-01   -2.151199309621000e-01   -1.620005368090156e-01   -6.366826709473203e-02   +1.074193796200486e-01   +4.582028880082094e-01   +1.223155977657462e-01   +9.274361127006081e-03   -2.906190785475648e-01   -7.990284892603450e-03; -8.579170518425210e-02   +1.302959107456635e-01   -3.745834143596051e-01   -7.770419029901814e-02   +6.389954746474184e-02   -1.220736592103440e-01   +1.411010718546134e-01   +2.753462195051192e-01   -1.324172128967426e-01   +1.642650002461560e-01   +3.386349700996039e-02   -1.738300925863076e-02; +2.110139563698201e-01   +2.772141382189650e-01   +4.816332723598951e-02   +2.820733374310747e-02   -4.463281152643043e-01   -1.792780177592851e-01   +1.265601568534860e-01   +1.213241960653414e-01   +3.835145760562351e-01   +4.894397901752563e-02   -2.758134072125192e-01   -1.251953506053601e-01; +2.326283909221319e-01   -1.605455505191227e-01   -1.131370495498264e-01   +9.194362365789607e-02   +1.117430758586519e-01   -1.699006334763525e-01   -2.977852053298902e-01   +2.720286522487010e-01   -3.979426713703184e-01   +1.799370061382015e-01   -2.849469862115125e-01   -2.688582075027496e-01];
L2E_L3E_iAMPA_netcon = [+1.032432825090707e-01   +8.288306149872865e-02   -3.261794355041376e-01   -3.050387601233667e-01   +9.520938169259723e-02   +3.199080189076337e-01   -6.557819172458712e-02   +9.291245510038099e-02; -1.371416759368649e-01   -2.128364178372368e-01   +3.434226142509337e-01   +2.433207688518118e-01   +2.634076610558905e-01   -3.993879231072562e-01   -1.868842535405761e-01   +1.788937209975691e-01; +1.656648404771190e-01   +8.641645605308393e-02   +3.390268282144107e-01   +2.490288347328332e-01   -3.478025878342949e-01   +6.414295732078595e-02   -4.453758886628798e-01   -3.834297421182198e-01; +5.780294439112149e-02   +1.701242461377193e-01   -5.671840803180721e-02   +8.133480973223883e-02   +3.145608530827707e-01   +2.354107591290007e-01   -1.825827234310969e-01   +1.112699328826378e-01; -2.061224494919498e-01   +8.893699925550411e-02   +3.692752585689523e-01   -5.173626765616779e-03   -1.585365848349532e-01   +2.225603789815640e-01   +1.920878853221774e-01   +1.294654016951796e-01; +2.213175966863781e-01   -3.412814883131460e-01   +7.121455259985458e-02   -1.764850195933105e-01   +3.038160928695449e-02   +1.756840680425145e-01   -8.718735627703740e-02   -4.483927041923079e-01; -1.017521615961386e-01   -3.831932296084639e-03   -1.165825706382308e-01   +4.134419625547956e-01   -3.959191714546585e-01   +1.426995882817481e-01   +1.718029378305320e-01   +1.853911535107715e-01; +3.284846754953200e-01   -6.713530627634928e-02   +1.335872365311508e-01   -2.038240615182229e-01   -2.469998546535231e-01   +5.885273926800330e-02   -2.871588060882918e-03   -3.033766199647578e-01; -3.025377662057659e-01   +5.468231535685235e-01   +3.065685027679297e-01   -1.308680429003566e-01   -1.148876840976439e-01   +4.993228942279909e-01   +2.817381321625641e-01   -3.047782123443281e-02; -1.511612746491813e-01   -1.097903293235158e-01   +4.590729549769434e-02   +2.770003324278708e-01   -1.208036888810628e-01   -3.428906270773888e-02   -1.387559621294114e-01   +1.448003050684900e-01; +2.265613843487944e-01   -1.561239407089340e-01   -3.263741048740916e-01   -2.163360447189935e-02   -2.640523037911510e-01   +1.434023203522610e-01   +1.084720178625922e-01   -1.200815301299019e-01; +2.791441783161230e-01   +3.242587068214077e-02   +2.007542970997498e-01   -1.260995883859095e-01   +8.536996373470528e-02   +1.471112996000294e-01   -3.041356976941849e-01   -1.316585021828768e-01];
L2I_L3I_iGABA_netcon = [-4.294063128333916e-01   +2.784843753302539e-02   -9.388028252780828e-02   -1.797449564178406e-01   -1.248914452387809e-02   -1.158435690160532e-01   +2.333353678277316e-01   +1.903513766704618e-01; -3.004519525654737e-01   -1.238981960085522e-01   +1.355813931836373e-01   -2.679530080860459e-01   +1.337288804700271e-02   +1.508177060142592e-01   -9.826597730564578e-02   -4.280994404915425e-02; -3.657593064557126e-02   -1.528473542793862e-01   -7.857135133310325e-02   -4.892082763894508e-02   -1.217561943833427e-01   -1.835593993008354e-01   -1.441172802087333e-01   +3.195624437644169e-02; -1.316335863636106e-01   +1.770839459226604e-01   +1.675419807526483e-01   +1.260937579676817e-01   -2.491124656747407e-01   -1.031306536253387e-01   +2.346187854586029e-02   +2.642113968603514e-02; -7.534308767375747e-02   +1.032815112806993e-01   +1.370414807448846e-02   +3.251709348523705e-01   -1.574492043624023e-01   -1.974652492747342e-01   +2.333272497676827e-01   -3.202250402590714e-02; +2.338723182904989e-01   +1.215594028935159e-02   -2.451203711025730e-01   +2.036882021951553e-01   +8.902634364044829e-02   +3.509803331540184e-01   +1.350827985293596e-01   +8.846557063754637e-02; -1.863059141023615e-02   -4.237352174692232e-02   +5.592965772074154e-02   +1.019867323232255e-01   +4.420263411789657e-02   -3.394120313756325e-01   +2.190962042311211e-01   +1.356871412175341e-01; -3.668289096269517e-01   -3.962486176136739e-01   +2.015362975926226e-01   -1.733489671129828e-01   -7.153730185231820e-02   +1.484565977645793e-01   +4.741119848207479e-02   +4.618406706804418e-01; -1.964876949399524e-02   +3.389680226456826e-01   +2.319134659554664e-01   +3.165507015221530e-01   -9.045579224463435e-02   -2.148152385122150e-01   -2.617271264588992e-02   -6.241065025904693e-02; -4.333821010889856e-01   +1.250330152888780e-02   -2.249204095796220e-01   +1.184996585280975e-01   -1.908263409949787e-02   -2.505410497828937e-01   -1.151597608578411e-02   +2.775445390582579e-01; -1.367844796200619e-02   +1.684194441394826e-01   +3.009414696327691e-01   -2.374703375789815e-01   +6.228982517259623e-02   +2.407929598660513e-01   +1.137723531940663e-01   +1.040057374502620e-01; -1.254864455279496e-01   +1.054371857594892e-01   +1.071073112381787e-02   -5.337739243730442e-02   +2.161784494412874e-01   -1.567584064524543e-01   -3.887767861675656e-01   +2.955434813239598e-01];
L3I_L3E_iAMPA_netcon = [-8.675381663949995e-02   -1.791702224201366e-02   +3.560248167662481e-01   -2.761061732494977e-01   +2.530304937579270e-02   -2.944414620858583e-01   -1.194574596240997e-01   -5.356545153885890e-01   -2.117819248145599e-01   +1.661695920379476e-01   +9.440180291713680e-02   -3.355194524219226e-01; -7.732760383056655e-02   -4.909303249246141e-02   +2.014573201260887e-01   +2.377265484990964e-01   +3.995379796241426e-02   +2.245759769166419e-01   -4.543706381744286e-02   +1.960082504134708e-01   -2.780323061360823e-01   -2.336247389010362e-01   +1.767310251385412e-01   +4.050479472253179e-01; +1.106796770879050e-02   -9.757995285180771e-02   -2.921956304820889e-01   -2.665715813905993e-01   +1.122857935073028e-01   -2.601551004842476e-01   +1.456934294689553e-01   -3.206083113095953e-01   -1.637935406131854e-01   -3.381691235527855e-02   +6.983196089737284e-02   -2.688268490105947e-01; -1.222648514514116e-01   -8.983875156849283e-02   -1.499942214860500e-01   +4.115173356016739e-01   -1.262122572345938e-01   -2.207471951844340e-01   +3.308264846566829e-01   -2.046977351906854e-01   -1.966290156374105e-01   -9.436145376645487e-02   -1.236625944948865e-01   -9.507221121353088e-02; +3.022179781307920e-01   -8.009794469941763e-02   -2.957207148893478e-01   +3.614769413380323e-01   -6.235484003864628e-02   -3.543629870660450e-01   -2.997331615938001e-01   +6.606816866683199e-02   -1.626213680512656e-02   +7.999905520596849e-02   -2.467651074425083e-01   +2.279312162060470e-01; +2.392658494934490e-01   +1.837672056065107e-01   +1.223384535765654e-01   +9.234929982601336e-03   +1.793923612196467e-01   +1.275430739394436e-01   +8.399976204821741e-02   +2.738011347050341e-01   -1.844647031086871e-01   -5.652508951501053e-02   +9.395339123490830e-02   +8.863496734046028e-02; +3.717024028242558e-02   -2.273961617117373e-03   +1.756163622818706e-01   +1.314794370414377e-01   +2.900412395437412e-01   -2.865896492430856e-01   -2.940993341408727e-01   +2.300619599999763e-01   +3.504828142847292e-01   +1.605731701102623e-01   +1.274394683058533e-01   +2.452080253677388e-01; +1.186296301339593e-01   -2.494339025198489e-01   +2.243214014991080e-02   +2.210557393010998e-01   -3.193319636639319e-01   +5.189634510217490e-02   -2.902104305784962e-01   -1.564879130385132e-01   -1.840059374816093e-01   +3.021239250253637e-01   -8.826946625517651e-02   -1.248365567954735e-01; +1.595773584516179e-01   +5.437970952057711e-02   +1.036812055937327e-01   +1.419604455628026e-02   -1.381524465394946e-01   +2.382846050408167e-01   +3.687630217900902e-02   -2.735476835961418e-01   +9.111737978604294e-02   -3.927307955033334e-02   +6.571231409537837e-02   -4.519189641640567e-02; -2.720555652889357e-01   +3.487685972130050e-01   -2.301151622826603e-01   -3.905825766965149e-01   -1.666153207594223e-02   +3.277564110855827e-01   +3.801650684297440e-01   -1.144883305191738e-01   -3.340282157241959e-01   -1.202636898461386e-02   -2.685456830719425e-01   -2.299593845215434e-02; -1.164817781715545e-01   +3.838382010124350e-01   +2.278664812861433e-01   +2.583845020818878e-01   -4.224632419331990e-01   +2.229666478408000e-01   -1.496894140259588e-01   -9.103950522392645e-02   +1.957953957630643e-01   -1.645071556226334e-01   -7.027474567764716e-02   -2.505801104679811e-01; -2.470409570573535e-01   +1.713514080254484e-01   -1.264309643806043e-01   -6.989256156114701e-02   +2.825895877356730e-01   -3.781000866930147e-01   +1.364176408638609e-02   -1.345676922470375e-01   +1.227120673199612e-01   +1.907177250117323e-01   +2.982270257162716e-01   +2.324259222738332e-01];
L3E_L3I_iGABA_netcon = [+2.270060519546622e-01   -1.598589899979158e-01   -4.421758551494373e-02   +1.304486876994475e-01   +9.410921656583107e-02   -2.684970980412357e-02   +2.986382023631713e-01   +6.357465934619794e-02   -1.377507360396964e-01   +2.038886699999179e-01   -7.848594267599505e-02   +1.422044484816966e-01; -4.174212916109438e-02   +3.919854951484923e-02   +1.340317589079752e-01   +2.388235274821296e-01   +2.288554009278348e-01   -2.667484746171228e-01   -3.260939554148332e-02   +3.380614321274253e-01   -6.532301842473788e-02   +1.284644611602599e-01   -2.574263109233606e-01   -2.727316687283418e-01; -8.187783599789938e-02   -2.087562166945085e-01   +6.082229880557097e-02   +5.754850569409575e-02   +1.249311183484619e-01   +8.896722788646962e-02   -5.622934848157283e-01   +2.278350514006701e-02   -5.665219549950403e-01   -7.279718134732738e-02   -1.804562074578580e-01   +1.576582272745516e-01; +2.974727485392604e-01   -2.466295854523356e-01   +1.410169805548602e-01   -6.800479477332311e-02   -2.947864372532534e-01   +3.488908884390105e-02   +1.482277436379512e-01   -2.637733930818831e-01   -2.234647098091393e-01   -3.772528021403468e-01   -1.043462742817364e-01   +1.936192539334300e-01; +1.191317565368511e-01   +3.183693180948270e-01   -2.307556010244235e-01   -5.235352649480232e-01   -2.015819552435920e-01   +1.514151576809110e-01   +3.792128259224615e-01   -1.366264501018050e-02   -5.012453755287545e-01   -1.850421243716882e-01   -3.755189348566806e-01   -2.440377997037194e-01; +4.299240434344579e-01   -2.820101229520713e-01   +1.957089498829112e-01   +2.591148309956465e-02   +1.636264675815616e-01   +2.635893057921442e-01   +2.721191474481333e-01   -3.310046297756675e-02   -1.184168077509551e-01   -2.694306972837385e-01   -2.677799558109990e-01   -9.585590013144388e-02; -2.121432461227866e-01   -4.988025322268613e-02   -3.709106344756365e-02   +3.260178825153591e-01   +1.172251704759960e-01   -1.049340442449445e-01   +1.336608307056104e-01   +4.805463753262771e-02   +3.652008613596670e-01   -1.167475107522879e-01   +3.601466247573933e-01   -1.543108777344744e-01; -7.778308730775296e-02   -1.164665863059987e-01   +2.379367935772157e-01   +1.425146847712729e-01   -5.082243620929087e-01   +3.360795889314716e-01   +2.766519062860903e-01   +4.703503721646433e-01   +3.886360616924301e-02   -5.354798672910508e-01   +1.369038469843702e-01   +1.206389009922392e-01; +1.739581556127610e-01   +1.362553714922689e-01   -1.222168756036271e-03   +5.532168946793184e-03   +2.252031375335524e-01   -4.461538698301634e-02   +1.382064461415819e-01   +4.819798024867352e-01   +1.262250908868694e-01   +1.365182870925851e-01   +5.246673006990661e-02   +1.017993762712955e-01; +9.948038069847881e-02   +2.449016261160138e-02   +5.105926612884581e-02   -2.314802116625692e-02   +1.059749834461064e-01   +4.829830478334682e-01   +3.861152175737334e-02   +1.384567085797039e-01   +1.402118412249531e-01   -2.080581522604762e-01   +2.828696796544765e-01   -1.365707081584254e-01; -2.286014589896857e-01   -3.910573661729842e-01   -1.562442980186081e-01   +1.686128890326648e-01   -1.632879872657132e-01   +2.847278810493994e-01   -2.171752136512263e-01   +1.243871532597493e-01   -5.442322739369199e-02   -1.132182115088262e-01   +4.037595602801465e-02   -7.751488817575219e-02; -8.612514784978969e-03   -1.943959686855529e-01   +2.523831725985130e-01   -3.896233173871098e-01   -9.362283416849268e-02   +3.159899082898791e-01   -2.889331606511211e-01   -1.925440949325841e-01   +2.133092747994162e-01   -2.331034836824787e-01   +3.430368540397974e-01   -1.402819185999207e-01];
L2E_Input1_iAMPA_netcon = [-3.695257142450764e-02   -3.677533890040479e-01   -2.176049000234745e-01   +5.098180634541494e-02   +1.323231713889566e-01   +9.762469148858322e-02   +2.674862781636464e-01   +2.750355190311257e-01];
L2I_Input2_iAMPA_netcon = [-2.597875474205116e-01   -7.011948660949333e-02   +4.224884230147583e-01   -7.123701192766653e-02   -3.917457489012163e-02   -2.463350691626047e-01   -5.624700020468987e-02   -4.470762862973918e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
