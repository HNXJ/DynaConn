function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.407321502664345e-01   -6.780333534635231e-02   -3.510949583437054e-01   +3.002112733570056e-01   +1.073776855012164e-01   +1.893882169820892e-01   +2.552596765924548e-01   +1.517206230840304e-01   +3.205020710081691e-02   -2.217404706131055e-01   -2.274090650987710e-01   -4.227567553474887e-02   -2.753836457736826e-01   -2.599638686438926e-01   -2.237534952926591e-03   -1.448792784659192e-01; +1.672210172837524e-01   -2.657323604671681e-01   -7.235208052088124e-02   +8.163799497031277e-03   -2.344439466623816e-01   -1.148773355099253e-01   -2.629660954099545e-01   -7.266906306232905e-02   -2.626987090886161e-02   +2.111110801495239e-01   +1.378765327053298e-01   +6.381474595085587e-02   +1.077306771547114e-03   +5.988320786995034e-02   +1.817929071888984e-01   +1.205469035968623e-02; -9.673070115197718e-02   -3.541983393132012e-01   -8.239316826500739e-03   -2.795167398701343e-01   +1.160586803667670e-01   -9.133798589743947e-02   +3.110981536597886e-02   +2.790149994633300e-01   +2.503038385031475e-02   -2.625449823839324e-01   -3.097592602368146e-02   -2.149479791361600e-01   -7.135943998548634e-02   +1.852234555120192e-01   -1.309093745121401e-01   -1.435542699625842e-01; -2.280873117606080e-01   -1.766338458773660e-01   +4.293560141424047e-02   -1.759658181210564e-01   -1.900763546362361e-01   -6.416914251120402e-02   +1.290387463434559e-02   -4.220603948359577e-01   +2.982033876459330e-01   +2.171112689738845e-01   +1.299614743521039e-01   -6.230391356412036e-02   +1.327589819388076e-01   +1.278756792167739e-01   -1.154311459077375e-01   +2.845587435670852e-01; +5.665671370349706e-02   +1.359726627228864e-01   -3.096348307156654e-01   +2.051460668548030e-02   +3.777407838041109e-01   +7.178373188110043e-03   +8.974411215281862e-02   -1.008659297768221e-01   -2.380223950073855e-01   -3.449562259260635e-01   +1.121345306565643e-02   -3.151692883653431e-01   +1.502320465542583e-01   -1.268611346982362e-03   +6.886611207091486e-02   +4.432915151670817e-02; +6.102624983657613e-02   -2.222354317883532e-01   -2.883294642921679e-03   +3.944911561915770e-01   +1.190626935617173e-01   +1.176224176882129e-02   +1.029397855516436e-01   -3.555011631756558e-02   +2.023656952675415e-01   -2.794534040039021e-01   -4.223399883673701e-02   +1.770040230975123e-01   +3.292034800352136e-01   +3.004569131295521e-01   +1.497231440247176e-01   +2.293192606347309e-02; +2.226689896057650e-01   +2.025353684508499e-01   -4.281431004295680e-02   -1.402917599315655e-01   -2.811822979077291e-01   -5.372221799373154e-02   +1.020829781005269e-01   -2.039655802533255e-01   +2.811800954293800e-02   -7.848844270564657e-02   +2.324291726593603e-01   -9.917071960363025e-02   +9.362458457722325e-02   -1.602818809360313e-01   -1.477731252724837e-02   -1.053870323506176e-01; -3.510131277656831e-01   +6.061174301548221e-02   -2.265914874016395e-01   -1.455486925183229e-02   +3.222964678114876e-01   +2.742193774315204e-01   +3.285294034980816e-01   +6.516140376749482e-03   -2.235602862563304e-01   +3.987522500916771e-02   +2.596632438544911e-01   -1.793968779322025e-01   -1.636184334375883e-01   -1.281373355875401e-02   -1.950834993924151e-01   -1.734850774782393e-01; -1.120223174600715e-01   -3.037260000279032e-02   +1.668756530227314e-01   +7.776566416973382e-02   -2.797683068308091e-01   -2.874101746606339e-02   -1.288419000289864e-01   -8.921497534978343e-02   -1.349974679237194e-01   -1.819868494662626e-02   -2.471011380873929e-01   +2.063958278094026e-01   +4.709373582702097e-01   +1.487755267968709e-02   -4.168134248052849e-01   +1.296472563135918e-01; +2.023278035889640e-02   +3.404536377590863e-01   -5.456158403619822e-02   -3.265458922074495e-01   -1.712830358223030e-01   +1.943665334697913e-01   -5.451336452958207e-02   -1.429601291665868e-01   +3.627503648709403e-01   +2.818198115128369e-01   +2.609019517364329e-01   +1.222527974600955e-02   +1.820948505694286e-02   +8.689978697886377e-02   -2.043720429319739e-01   -3.105703769838644e-01; +1.121688439636278e-01   +1.023761574099710e-01   -7.587352574246128e-02   +3.385896067805137e-01   +2.770379033546633e-01   -9.368731587394402e-03   +4.893316167208434e-01   -2.903186142752551e-01   -2.256048348011554e-01   -6.733722602970763e-02   +1.606127846893070e-01   +6.716206596844000e-02   +3.668483155862282e-02   -4.547041440182308e-02   +1.286399778474953e-01   +7.992158652959043e-02; +3.020880905059523e-02   -1.795622303082166e-01   +2.165525210536826e-01   -3.188696452489326e-01   -2.316975495700614e-01   +2.235487315911114e-01   +1.095372133591770e-01   -1.482782239159077e-01   +1.167111729320194e-01   -9.485558354949869e-02   +3.777095736599320e-01   -3.094992500157883e-01   -1.455790869120234e-01   +3.907831202171662e-01   +1.135243569240143e-01   +5.794844113554980e-02; +2.462037294800829e-01   +2.178468090426547e-01   +8.357979997325318e-02   -2.832692317634596e-01   +8.391710474887885e-02   -1.065844323686554e-02   +1.481860938771961e-01   +6.023533326294229e-02   +4.520564237818352e-02   +9.086093526276731e-02   -5.077038939985613e-02   -6.527043767630414e-05   +2.160765697103395e-01   +2.397555872069511e-01   -2.781556325386785e-01   -7.469794243645939e-02; +6.791717240049294e-02   -1.213309508451308e-01   -1.488000302774808e-01   -1.761527265742379e-01   -9.669633192002750e-02   +2.790182013515141e-01   +5.285913319682856e-02   -3.142825925911488e-01   -2.296367153898821e-02   -1.067055133504558e-01   -1.135096018075417e-01   -3.738895335554697e-02   -1.411776316685106e-01   -3.594826669536884e-02   -6.677500142900096e-02   -5.013066327606477e-02; +2.351160580921860e-01   -1.289715678425418e-01   +3.316451325076610e-01   +1.872604959824160e-01   -7.372900891101380e-02   +1.121691658294318e-01   +1.753925495529628e-01   +2.623236650856688e-01   +2.103741349713680e-01   -2.551372065532431e-01   -8.518685382134272e-02   -4.766494308767397e-02   +1.431694674370515e-01   -3.061175022109271e-02   +1.113289146993555e-01   -3.191572544342126e-01; +3.284100727272065e-01   +3.724033928097648e-02   -4.219115012339894e-02   +3.371276181020572e-01   -2.935139151453284e-01   +1.328309252049639e-01   -2.518813652160057e-04   -2.320070754126427e-01   -1.975600507218154e-01   -3.702433290135038e-01   -1.432062799970401e-01   +2.575108587092720e-01   -4.196157608536063e-01   +2.121711872330607e-02   -1.312432868352488e-01   +2.499005040136162e-01];
L1E_L1I_iGABA_netcon = [-1.373256463196730e-01   +1.127462363407270e-01   +1.446837906085328e-01   -5.889143653825429e-02   -1.420377558471583e-01   +2.366885037724487e-01   -2.922729880999643e-01   +9.051393852428243e-02   +1.552638238131180e-01   +9.203149819203960e-02   -2.938913908244443e-01   -5.939265945984946e-02   +1.548362011010409e-01   -6.175093530675529e-02   +1.163942202743129e-01   +1.480279789773560e-01; -3.026696616836505e-02   +2.790266987680847e-01   +8.412270678336595e-02   -2.332073667079174e-01   -2.948892849968865e-01   -1.517796339583780e-01   +3.252533386967115e-01   -1.978463546626848e-01   +8.100459071949534e-02   +2.940859351595527e-01   +1.275553308754769e-01   -7.231272557019985e-02   -1.122202034707122e-01   +2.592006343672096e-02   -2.322347412309370e-01   -3.442202041367237e-01; -9.978698421535420e-02   +2.469211009589382e-01   -3.645568255489302e-02   -2.666469823172236e-01   -2.631060392300922e-01   -2.755581627548664e-01   -1.809527713856026e-01   -2.847536541863580e-01   +5.557677711465608e-02   +2.819640375966685e-01   +9.517050900766952e-02   -1.854499950143311e-01   -7.440101177200588e-02   -2.413443975941242e-01   +5.150653352107401e-02   +2.773305019154260e-01; +1.454417185360280e-01   +4.475670082468994e-02   -5.481627219990522e-02   -1.166820502010426e-01   +1.358320843270330e-02   +1.410437477025778e-01   -3.339174371909709e-01   +4.859893415889785e-03   -3.923776400271184e-02   +3.932894057980198e-03   -1.054918283056293e-01   -6.836322494791361e-02   +1.828355272603516e-02   -8.829009654110120e-02   +3.879849350475457e-01   +1.248864425643419e-01; +1.091059611833872e-02   -1.800384215800578e-01   -1.046280927557703e-01   -2.217227724700916e-01   -3.515213913388208e-02   -7.286993115683509e-02   +1.228228695381138e-01   +6.811271974747225e-02   +1.247443325816736e-03   -1.137567384866003e-01   -9.555473205162768e-02   +1.214966301638414e-01   -3.906743707054003e-02   +1.707669768413618e-01   +2.036640082482532e-01   -1.338573623892042e-01; +3.906596906327765e-01   -4.002092312972628e-01   -3.253655533865814e-02   -2.978992159879642e-01   -3.544640430421260e-01   -3.021934717710978e-02   -1.930435688850405e-01   +6.527690811302686e-02   +2.678392701496015e-01   -1.527116594183231e-01   -5.895040764350802e-02   -2.066768622181070e-01   -2.049963580273899e-01   +4.588944615022227e-01   -2.238480758750570e-01   -6.408784459893921e-02; +2.455455067835151e-01   +8.329044473672167e-02   -9.332347952910633e-02   +1.375066444361305e-01   -1.185059557039390e-01   +2.539196748538667e-01   -3.223996822717545e-02   +8.822246619114660e-02   -2.317482832168384e-01   -8.546647250807668e-02   -2.122860842724264e-01   +1.397377470837451e-01   -2.633302244390606e-01   -8.299249622846318e-02   +1.357054084043402e-01   -5.987084545425665e-02; -1.486296011644087e-01   -6.307822522752023e-02   -3.280450666563297e-01   +1.998309791575740e-01   +5.086074763211670e-03   -9.816708292891095e-02   +7.860771947389841e-02   +2.167833912474880e-01   -9.494930676640553e-02   +5.565863560157662e-02   -8.756083489493013e-02   +3.336464525680840e-01   -1.102351304761654e-01   -2.580975968459805e-01   +9.643308245720532e-02   +1.528922172258482e-01; -7.592174200440323e-02   +6.246766764642699e-02   +1.295434723288207e-02   +3.207873618726672e-01   +2.793468499830003e-01   +3.638266419731563e-04   +1.832441532513220e-01   +8.102329382821488e-02   +1.329968470452214e-01   +1.751852790923197e-02   +9.846421628070525e-03   +2.567265852257147e-02   -3.078352935112183e-01   +3.994143044781415e-01   +6.263725116530112e-02   +2.426514196304735e-02; +4.289963594607905e-02   -2.118667317327057e-02   -3.019559564122293e-01   +5.584887963276362e-02   +9.131577052178402e-02   +2.558941699239679e-02   -2.777133197396884e-02   +5.919255195299514e-02   -1.721017646213827e-01   -2.217189230799809e-01   -8.494555419005687e-02   +8.087268848529934e-02   +1.076473388428462e-01   -3.048667721405366e-01   -1.046886984970328e-01   +2.855273239031120e-03; +1.201683986081370e-01   -1.307901770331530e-01   -2.309527938002028e-02   +4.422690126998756e-02   +1.078607522195267e-01   -2.395299311886561e-01   -2.731495222403519e-01   +3.183114860190317e-02   +1.755669937720020e-01   +3.200129476369372e-02   +2.451320138472443e-01   +1.195125212156145e-01   -2.865193340147235e-01   -8.034871455727341e-02   -1.381149902282565e-01   +3.377153234925073e-02; -3.627772561852242e-02   +2.950971629269104e-01   -3.884094725265962e-02   -9.408258448985771e-02   -3.491588226518094e-01   +9.616646444092612e-02   -3.369287685355774e-01   +1.096102770309338e-01   +4.018848921535695e-02   +1.258682290473719e-01   +1.597949540438642e-01   -2.278642007650182e-01   +1.463945328918105e-01   -6.658662251601216e-02   +3.776790734946338e-01   +7.124947589718703e-02; +1.676200116415492e-01   +2.181613279139133e-01   +1.563888979216234e-01   +2.325252159342113e-02   +2.999426969505231e-01   +9.229220836721153e-02   +1.289559532232568e-01   +8.353326509687110e-02   -7.320888903070456e-02   -2.778975331880169e-01   +1.895713168322770e-01   +2.371828039203433e-02   -2.085897417272471e-01   +5.585622781336674e-04   +1.792003569293216e-01   -7.549666939068975e-02; +2.820961155141610e-01   +2.336811933074416e-01   +5.770786448942480e-03   +2.689767040112684e-01   +7.223892245369620e-02   +1.201267073257688e-01   -2.919839786758973e-01   +2.183419742442399e-01   -1.836375350776447e-01   -1.839036554262475e-01   -2.486932577374681e-02   +4.022166260852962e-02   +8.039482024113342e-02   +1.239592040732846e-01   -1.062873299916080e-02   +9.718305134266109e-02; +2.318782415332795e-01   +3.310648347052457e-01   +2.617518686480156e-01   +1.085342797773186e-01   -1.160800293365864e-01   +2.935287731474158e-01   -3.928865141744094e-02   +9.691036242843172e-02   +3.163407131492796e-01   -1.040450505249211e-01   -6.487287901269284e-02   -1.802301720673781e-01   +1.508733397746984e-01   +1.170442960899365e-01   +2.309515693025753e-01   +6.144484100643935e-03; -2.441443046496092e-01   -5.425897650790040e-02   +2.132569365748396e-02   -2.074908138478328e-01   +3.683784834998178e-01   -3.090081929480337e-02   +2.567800024551085e-01   +6.904134571869289e-02   -9.155869461815697e-02   -9.851646857038310e-02   -2.696830537025320e-01   +1.980046353428797e-01   +3.142066503845089e-01   -2.816295493196974e-02   +2.137279187323621e-01   +5.118190308206150e-03];
L2I_L1I_iGABA_netcon = [+1.245960823018870e-02   +4.879779940455201e-02   +3.557397838025392e-01   -1.394417551571518e-01   -1.039314062572746e-02   +2.449240278595801e-01   +2.298223247274305e-01   +1.058827159083012e-01; -1.264258355684463e-01   -3.617047862396872e-02   +1.431685156305740e-01   +2.357509531458968e-01   -4.575173173330795e-01   -2.048319404509785e-02   -2.140655716905977e-01   +8.332077582773081e-02; -2.207410729221287e-01   +2.281378660510706e-01   +2.771362030788196e-02   -1.104445086350500e-01   +3.092978730699705e-02   -1.217102903413266e-01   +2.955312159832628e-01   -1.658324451220651e-01; -1.764437549104775e-01   +5.432928552989950e-02   +8.590397891529836e-02   -1.567116939393297e-01   +9.761036073811680e-02   -4.116267460789756e-01   -2.893239347749642e-01   -2.529337270042076e-01; +1.420691719318052e-01   +1.782778703306964e-01   -1.706803439645123e-01   +2.655472396980929e-01   +1.525683431060813e-01   +5.357922105444698e-02   +2.571405322127138e-01   +1.887758098616733e-01; +3.254996478023831e-02   +3.665017639955873e-03   +1.074656880228210e-01   -3.182453851284025e-01   +2.621313953693930e-01   -2.122806076167303e-01   +2.739633816448031e-02   -1.124426823674470e-01; +1.914429903453841e-01   +3.049285974167756e-01   -2.012059935975239e-01   -3.167740084242139e-01   +7.579578530788890e-02   +1.069637239544427e-01   -4.768466574811001e-02   -8.454208935688376e-02; +9.354756664144170e-02   -8.230476638893799e-02   -7.681731878052639e-02   +2.077540085553702e-01   -2.806980462015086e-01   +4.714148237528695e-02   +7.854399399516646e-02   -1.712975319495689e-01; -1.607832851841454e-01   -6.599758620822904e-03   +2.253145861328568e-01   -8.700826963214975e-03   +6.635387872840449e-02   +2.451249245852201e-01   +2.580583978921350e-02   -2.177245735873081e-01; +1.768521694090167e-01   -2.258600654954249e-01   -4.949571228698689e-01   +8.154893599971874e-03   -1.717883970563038e-01   -3.272656639697310e-01   -1.425624330498076e-01   -2.503991720104007e-01; -6.387077077732617e-02   -1.893997598666475e-02   +1.907657968000766e-01   +2.500618067124746e-02   +7.491035332295828e-02   -1.180285462521331e-01   -3.212025074496083e-02   -3.454570813617356e-01; +3.037423520043711e-01   +2.634498855733825e-01   -1.582259266986595e-01   +5.335509610926531e-02   +1.091185025025924e-01   +1.939348473774722e-01   +1.311109589568661e-01   -1.017564270617101e-01; +7.559456561326006e-03   -2.701113682555648e-01   +2.496295716825777e-02   -6.789443138908274e-02   +2.602293750135537e-02   +5.039950834866241e-02   -3.853241713300237e-02   -8.818156313969483e-03; -1.480449461438774e-01   +7.144577563333926e-02   -1.461398451004129e-01   -1.260012524510833e-01   +1.342538605424786e-01   +4.143931438116890e-02   +1.675340300862146e-01   +1.948088573605525e-02; -5.016867222841308e-01   +1.279728714526593e-01   -4.063698431624314e-01   -2.188370801477244e-01   -1.324910824603414e-01   +7.556681325285206e-02   -1.191905153396156e-01   +2.178460582510580e-01; +1.682349690522111e-03   -2.121082674153068e-01   -5.349671790499180e-02   +1.851076410168858e-02   +2.228257291712731e-01   -1.256798800788420e-01   +8.584291862207091e-02   -3.113732172875279e-01];
L1I_L2I_iGABA_netcon = [-8.863905361626263e-02   -2.726524552544245e-01   +2.187242268542300e-02   -1.946325138705650e-01   -2.614720376448383e-01   +2.785218354744815e-01   -1.137359672067479e-01   +6.561031814107307e-02   -1.657515479841285e-01   -2.643684520440258e-01   -3.094870796467559e-01   -2.665082184156309e-01   +2.118064255960736e-01   -1.793189952875017e-01   +3.145468669837423e-01   -1.745712887731352e-01; +1.512806142749614e-01   -1.775397806877995e-01   -2.862205317218544e-02   +9.229184288861664e-02   -3.565707688338891e-01   -1.910413614444059e-01   -1.911338033413761e-01   +5.513275725558885e-01   +5.964566261393273e-03   +2.879542094723502e-01   -1.316710074349615e-01   +6.366949733221680e-02   +7.232310959257827e-02   +3.885803434872919e-01   -2.018476280631701e-01   +1.868281299544782e-01; +4.636089218669456e-02   -1.814153185118859e-01   -1.423986074567401e-01   +1.138084414797066e-01   -5.730211551563469e-02   -2.129249918919725e-01   +2.065736538192212e-01   -9.096214631260355e-03   -2.597188324116790e-01   -8.316664139717761e-02   +8.571433266763730e-02   +4.251818784683170e-02   +2.403445722775336e-01   -6.169433576308084e-02   +3.935736671678561e-02   +3.029972536039078e-02; +3.189795132881640e-01   -2.064212129236534e-01   +3.479945587240005e-01   -1.018332667171017e-01   -1.910022279345892e-01   +2.295514119941004e-02   +2.570794466431935e-01   -1.131572754350444e-01   +2.250087311321725e-01   -1.529398918770918e-01   +1.345126908917429e-01   -2.096681809717227e-01   +1.616939541057455e-01   -9.320953000494039e-02   -1.051999663815995e-01   +1.923125155354206e-01; +3.010259043088592e-01   +8.763391459612024e-03   -2.477190765835158e-01   -1.488285325802124e-01   -9.955889212505839e-02   -2.757337065983019e-01   -6.941540361486909e-02   -1.326069955800997e-01   -4.477376315132919e-01   -2.853681270135853e-01   -2.322056827024981e-01   -4.396488198276020e-02   -2.166577429586154e-02   -1.626502119572009e-01   +2.022267921349716e-01   -4.876815788845678e-02; +1.351592070521304e-01   +6.076989097163299e-02   -1.345697513809627e-02   -3.694433711241780e-01   +2.023316999682665e-01   +2.109158548374976e-01   +1.097666373140986e-01   -5.782936845420045e-02   -3.058354297631760e-01   +6.571916447058669e-02   +1.395443727385991e-01   -4.587468241347437e-02   -1.484110827484382e-01   -1.559021474600245e-02   -2.740452904372522e-01   -1.929402258807285e-01; -2.181282273698203e-01   -1.788323226297652e-01   -1.933285203116333e-02   +3.146303354436600e-01   -1.434913028902788e-01   +3.972933267216860e-02   +9.242281302703090e-02   +1.981619637360181e-01   -6.486233245336941e-02   +4.463011171884952e-02   +5.480786030258609e-02   -3.676552251707365e-01   -7.650434092839417e-02   -1.165432365425884e-01   -2.893533091682832e-01   +9.710330972715869e-02; -1.243510742738740e-01   +2.998581246620467e-01   -3.557553330181699e-01   -2.551627330934393e-01   +3.125479222813762e-01   -2.664789859917978e-01   +2.642676324194434e-01   -3.591044291259921e-03   +3.975497761802810e-03   +1.969740760893470e-01   -2.799879043789063e-01   +4.285160736258070e-02   -2.008623108464075e-02   -3.980992762511631e-02   +2.031909419276255e-01   +7.079131933799943e-02];
L2E_L1E_iAMPA_netcon = [-1.605730841584604e-01   -2.854858242347105e-02   -5.404114873085869e-03   -1.822283938676057e-01   +1.066683137049266e-01   +2.493851657150821e-01   +4.374403670883653e-03   -2.869897059815367e-01; -3.964478868918828e-01   -1.027879578091104e-01   +5.673860432888170e-02   -2.181894960137939e-01   +1.203115490834203e-01   -2.470197308934524e-03   +1.378443578862361e-01   +2.688064401421042e-02; +4.002124837732414e-01   -1.382215288936763e-01   -6.426474299739876e-02   -1.388368897231869e-01   -2.176214311480132e-02   -1.130583031169502e-03   -1.904029798650411e-01   +2.484310742641603e-01; -1.173686548901815e-01   -9.855125293779307e-02   +3.121678616565351e-01   +1.609478256096237e-01   -2.006268223892269e-01   -1.405295052378948e-01   +1.599143848717734e-01   +2.932816635848511e-01; +1.131294550467964e-01   +5.646349338668023e-02   -2.428396971667719e-01   +4.125918951942714e-01   -3.104451403835602e-02   -3.974726812336689e-01   -2.147950623051958e-01   +7.232818701587590e-02; -1.232552460038103e-02   +2.010297639104434e-01   +1.571306064403921e-01   -4.969156649944698e-03   -6.192063790671104e-02   -4.999731747634746e-02   +1.899503472581257e-01   -1.944652875949593e-02; +4.685777212503736e-02   +1.514459124994916e-01   -6.719020022704252e-02   -9.399470983863289e-03   +2.387442903596864e-01   -1.748429558727607e-01   +3.062303379640445e-01   -1.931236565941525e-01; -4.377727145685744e-02   -4.188028486454148e-02   -2.358498847443780e-01   -2.761916281691829e-01   +1.619235086282868e-01   +1.276742846305364e-01   -8.745479474646660e-02   +1.546506435554307e-01; -9.605210616488019e-02   -6.423048647604335e-02   -2.850681003343756e-01   -7.066772193816401e-02   -1.645588115752689e-01   +2.648430003810582e-01   -1.046145998687483e-01   -4.008917037694533e-01; +7.529032968368413e-02   +4.079910241784832e-01   +1.405674017397936e-01   +1.141902841318874e-01   +5.527926978190645e-02   -5.710783178028138e-03   -8.336826130061148e-03   -9.100592479773933e-03; +2.807675796661628e-02   -8.406292865652736e-02   +3.733759310447384e-01   +4.921650846792056e-02   +2.618177915114447e-02   -6.863623169154980e-02   -3.371162400319243e-02   +4.949458559332860e-02; -4.057345748359291e-01   -1.622660603704194e-01   +3.444572729860324e-01   +2.002816629634835e-03   -9.114369912159803e-03   -3.054630910526944e-01   -2.360054489211263e-01   +3.115575211984936e-01; -1.148429647446119e-01   +1.020867813387490e-01   +8.216834957184219e-02   -1.065140638324147e-02   +2.138791259635368e-02   -9.867560680279445e-02   +2.879266638785783e-01   -1.265842051938247e-01; +1.812773804931828e-01   +1.323545002602798e-01   +3.084610619833661e-01   -3.649118661702740e-02   +5.528326852254872e-02   -1.666712055063075e-01   -1.441470558676103e-01   -2.193408040193445e-01; -7.157457345659030e-02   +1.652679901209478e-02   -8.618508913363152e-02   -2.579681712706811e-02   +1.380251538774745e-01   +5.272427732665073e-02   -1.633390008056483e-01   -3.167646432657312e-01; +2.032607284752246e-01   -7.394223925052257e-02   -1.939602176317435e-01   -6.694022835300409e-02   -2.157781116444102e-01   +1.795403617791842e-02   +5.286965865064944e-02   +4.533736001980201e-02];
L1E_L2E_iAMPA_netcon = [+2.717997460803978e-01   +1.394193046931625e-01   +5.272363609848424e-02   +1.121903731974759e-01   +4.839917920745297e-02   +3.095671655263022e-01   +1.222808110057045e-01   +1.972358779084701e-01   -2.015442986515356e-01   +2.106588412065723e-01   +2.930822263233651e-01   -1.053457422543756e-01   -5.609290374502492e-02   +2.851842244355878e-02   +1.776824523193394e-01   -4.395143072972052e-02; +6.610033791180554e-02   -3.801193039997948e-01   +5.749234218636570e-02   -3.351749101686832e-02   +1.380927158805308e-01   -2.848504869193277e-02   -1.466192747553627e-02   -7.872625014394677e-02   +2.400122162813534e-01   -1.341618775147994e-01   -1.891350786277542e-01   -3.063305200479107e-01   +2.481413616271356e-01   +8.909494588100510e-02   +1.584759877368330e-01   +1.592911158846339e-01; -5.432316781653530e-01   +4.338471360093966e-01   +3.626236468127758e-01   -8.099214697691812e-02   +1.374365980417575e-01   +2.912224232496942e-02   -1.654287665613574e-01   +2.955781023388511e-02   +1.075885399515846e-01   +5.742051994449965e-02   +1.443308924550474e-01   -7.510018627458685e-02   -1.165524881546454e-01   -3.851509295419760e-02   -1.991458836341065e-01   -1.353973395116788e-01; -1.242340504208286e-01   -5.047601460510372e-02   +7.798895510879805e-02   +4.446767600580137e-02   +3.706126455130168e-02   -2.952577580368329e-01   -2.879160399512815e-01   -1.531851602034845e-01   -5.012860893870599e-02   +7.580123886580033e-02   -1.872111060815216e-01   +2.371040355123539e-01   +1.064950807799782e-01   +8.604105818277490e-02   +1.806645064927265e-01   -1.950530128457616e-01; -9.746076782849217e-02   -2.091349605992782e-01   +3.318432791978558e-01   +1.130275386076682e-01   +3.634607237923936e-01   -6.535262843273987e-02   -3.171735384895455e-02   +1.491813800191435e-01   +3.342661035718074e-01   -1.153742368169345e-01   -2.004508543346932e-02   +1.426705430446877e-01   +1.760043100473742e-01   -2.595225311012470e-01   -1.476593647852506e-02   +1.280345879758076e-01; +2.951832242912209e-01   -2.686713243870731e-01   -7.283546938302662e-02   +3.192338407496240e-02   -2.629646097646947e-01   +6.266299466768968e-02   -3.343465627988970e-01   +7.807646812813206e-02   +4.164293614563666e-02   +1.907503260034403e-01   -1.526360297196876e-01   +2.573852330571488e-01   +2.434670343259482e-01   +3.175950759714908e-01   +1.469675756496716e-01   +8.923684416699211e-02; +6.514557324059345e-02   -2.838806677135925e-01   +4.068693428596644e-02   +3.461517111749410e-02   +3.401148921648136e-01   -1.149044861092492e-01   -1.218518005909325e-01   +2.502241758745899e-01   +9.417116662861655e-02   -2.522542268235466e-02   +1.658878889625370e-01   +1.472508903162844e-01   -4.825583356494223e-02   -3.688836373692835e-01   +6.103157698634006e-02   +1.426943339881030e-01; +8.343660921092569e-02   -3.249771071083733e-02   -4.490192319220809e-02   -8.986962622372291e-02   +8.252642481320122e-02   -3.895373135449045e-01   -4.359020531581682e-01   -9.709899310067643e-02   -9.229275522353415e-02   -2.444614373619664e-01   +1.302211508231908e-01   -1.415530917529375e-01   -3.694117885241286e-01   -2.052912851532886e-01   -1.191173977745783e-01   -1.837305948501078e-01];
L2I_L2E_iAMPA_netcon = [-3.161959573077276e-01   -2.480485153788570e-01   +1.285416431324620e-01   -1.436652129299646e-01   +2.467409122460148e-01   -3.214297824959534e-01   -3.189559311182162e-01   +1.256453548272951e-01; -1.162791975789959e-01   +2.523143507377377e-01   +2.913982834006943e-01   -2.344551118957556e-01   -6.263619912354634e-03   +4.709216613720134e-01   -2.022440047454949e-01   -1.694979449973500e-01; -4.758018001160152e-02   +1.675533162871293e-02   -5.869409519898633e-01   -2.202006339811044e-01   +4.645966396125683e-02   +9.937224228440793e-02   +6.937977903093875e-02   +1.562232442988668e-01; -2.690644762656289e-01   +2.307304044799696e-01   -2.319277309267788e-01   -1.596141796670935e-01   +5.329979857419744e-02   -1.031336055697524e-01   -2.337761714566398e-02   -5.009355899841999e-02; -3.332122155937037e-01   +1.472178461532654e-01   +4.089377773122552e-02   -3.062403391489870e-01   -1.534478977587056e-01   -3.626607469143450e-02   -1.998682051072195e-01   +1.782615791538065e-01; +7.008495250401917e-02   -1.254113671975199e-01   -1.027704561340619e-01   +4.645633890952730e-02   -1.813241176982863e-01   +2.641261973143736e-01   -3.100990178180625e-02   -2.913856498791368e-01; +2.762523550401303e-01   -1.569626231894652e-01   -3.853222136141754e-02   -1.434192174744728e-01   -2.175197134781452e-01   -2.916522972218989e-01   -8.087014267841516e-02   +4.494686976349115e-01; -4.402155023974756e-02   +1.098324936619794e-01   -3.037790136827883e-01   +1.977447036196589e-01   +3.182309435866901e-02   -1.769382243195159e-01   -2.117858221711982e-03   +1.031528719530375e-01];
L2E_L2I_iGABA_netcon = [-4.329529053877032e-02   +3.199848379529742e-01   -1.859611277681326e-01   -1.996279017820549e-01   +6.031957383983205e-02   +2.645870121350380e-01   -1.991642778199232e-01   -1.969022725514040e-02; +5.363339616141632e-03   +6.383176868192618e-02   +9.400622640835878e-02   -1.643268461459874e-01   +8.253692860194523e-02   -1.817925089856670e-01   -6.531410620017145e-02   -5.966436936528712e-02; -2.872630682256405e-01   +1.575018203541304e-01   +2.027357657849736e-01   +5.720317274058628e-02   +1.864598123989551e-01   +1.519811503014139e-01   +1.389355008335728e-01   -1.053269591628932e-01; +2.456535025280999e-01   +1.208520468457912e-01   -3.738469118624894e-01   -1.682372311631323e-01   -1.884993342499154e-01   -1.082928399672901e-01   +3.156101759964306e-01   +3.344281806834615e-01; -9.300712487773648e-02   +2.513001882616641e-01   -2.812446635806409e-01   +3.557030732346746e-01   +1.498507760566924e-01   +3.882173159629234e-01   -1.235136246709206e-01   -1.253130873539317e-01; -1.661586701262495e-01   -1.391583691148148e-02   +1.188878427464608e-01   +1.013770653593517e-01   -1.715276934314756e-01   -7.644005913585181e-02   +2.389138784839073e-01   -3.564063183043734e-01; -1.013212145161407e-02   -3.065429787244066e-01   -2.265345911140122e-02   +2.493282901579484e-01   -1.669568795908572e-01   +6.036486071433750e-02   +2.018187092070156e-01   -1.501810383922991e-01; -1.451196981266704e-01   +1.904114484582499e-01   -1.380924985347678e-01   -2.071633391134303e-01   -3.514768660087880e-02   +2.352852161402921e-03   -4.069103819500000e-03   -1.866338826734404e-01];
L3E_L2E_iAMPA_netcon = [+3.832248906059558e-01   -3.138942195734435e-01   +1.834531560679075e-01   -8.213332749966533e-02   +2.736292592884643e-01   +4.155004285653449e-01   +6.338787114583966e-03   +5.226351663035156e-02   -1.325813305658387e-02   +3.171921806312796e-02   +6.133724226486666e-02   -1.484487435600691e-01; +1.044545107755521e-01   +2.293493128896891e-02   +1.269964337202173e-01   +1.045011140310443e-01   +4.815401497975724e-02   -5.406539823161975e-02   -2.663757213299394e-01   +3.329918466603170e-01   -1.116751851917172e-01   -2.096364611001260e-01   -1.556070312330533e-01   +1.319305674615386e-01; +3.911349252514702e-01   -5.584259579894528e-02   +1.397819131793548e-01   -2.927080192429417e-01   +2.199322654279790e-01   -9.525795458528782e-02   -6.210261062545089e-03   -9.750134412204123e-02   +4.609919598681484e-01   +3.430607233443039e-02   -3.166851754366247e-01   +6.302960483210265e-02; +1.739184768873324e-01   +2.058045035317606e-01   -4.886422436955673e-02   -1.993837948081178e-01   -4.249113702147862e-01   -1.409417868168331e-02   -1.741351079831489e-01   -2.399139398121786e-01   -3.776430441429539e-02   -4.153550477551154e-01   -2.552120279948768e-01   -3.071211899451439e-01; +7.248935295181164e-02   +1.540774135049062e-01   +3.384953321894691e-01   +1.310835230771583e-01   +4.439797116223462e-01   -4.585431241152416e-01   +2.546753844248408e-01   +7.685396448321022e-02   +2.546059140623671e-01   +1.368555782081994e-01   +7.414743367783458e-02   +1.237118101383117e-01; +1.603048583997779e-01   +1.451900055618728e-01   -2.642343340630452e-01   +6.970565984230204e-02   -3.803914498475137e-02   +2.132003510347242e-01   +8.883565906611342e-02   -3.390859320768623e-01   +3.525042998555367e-01   +2.945764613949767e-01   -1.205997177061150e-01   +6.750597765209156e-02; +1.060359572208753e-01   +2.818806028554849e-01   -2.927068401099481e-02   +5.030044295293530e-02   +2.157015444835714e-01   -4.684286746936081e-02   -2.868562324404023e-04   -4.323940437395096e-02   +2.747190107547336e-02   -1.559898639138182e-01   +1.626973984783602e-01   -1.250334951212203e-01; -3.447206160407821e-01   -3.259123948713932e-02   +2.041972863294175e-01   -4.926583626606144e-02   +2.215866048085615e-01   +2.299694341152087e-01   -3.476632890852848e-01   -5.876761101286523e-02   -1.634842129928227e-01   -6.299429976835660e-02   -1.974401613497115e-01   +1.875848418376551e-01];
L3I_L2I_iGABA_netcon = [-1.204212409068337e-01   -1.007361338567756e-01   -4.903171891476135e-02   -4.361242449993138e-02   +1.361083918735084e-01   +3.643683249815699e-01   +1.840924687731831e-01   +7.735738704907578e-02   +2.709003597813305e-01   +5.300116713929503e-02   +2.031069554942499e-01   -1.713525875514612e-01; +5.309527556529192e-03   +2.449534886649622e-01   -1.052178597415290e-01   -1.390330210663359e-01   -2.172645526876643e-02   -1.180956763168848e-01   -1.505296484581873e-01   -4.357615574187323e-02   +2.990536217792492e-01   +7.020416130849258e-02   +1.235080109279725e-01   -4.049014026873342e-01; +1.059635413507883e-01   +3.236580857566261e-03   +4.512746635508794e-02   +1.039478139896586e-01   -1.200644427510611e-04   +5.198373305081603e-02   +3.750926615417612e-01   +2.398273527309079e-01   +2.664539783080049e-01   -1.575127535937912e-01   -2.718308957740267e-01   -3.660487539539503e-02; +6.146812054448655e-02   +3.232501900999358e-01   +2.365252779024739e-01   -5.720487460311287e-02   +2.379457356307117e-01   -3.801768895091113e-02   -6.595535388846731e-02   +3.754180684127172e-01   +1.350765880953716e-01   -5.104080910000519e-02   -9.350724320454511e-02   -1.693691753673513e-01; -5.390482894712091e-02   -9.930710304264445e-02   -4.890345065587945e-02   +9.985686374428063e-02   -1.373960354393071e-01   +1.684488459059469e-03   -3.949224303275804e-02   +2.653726168453066e-01   +2.765615225357946e-01   +2.313654954242812e-01   +1.775620150005855e-01   +2.036515363218677e-01; -3.661580938610566e-01   -1.810501878655873e-01   -4.158733031277204e-02   +1.098304950961930e-01   +1.229844673249568e-01   -2.181363334316830e-01   +1.745508982711610e-01   +1.934090087657239e-02   +5.769663419159234e-02   +1.493494256107316e-01   +1.631642116255828e-02   +2.184161246224578e-01; +2.131982369066789e-01   +1.342710278510254e-01   +2.492019838902320e-01   -2.636513986019340e-01   +2.793940403842633e-02   -1.134647466915755e-01   -4.152913049048496e-01   +6.237310661080504e-02   -4.863043858287506e-01   -1.807889694629194e-02   -4.701818289234912e-01   +2.997009437928166e-02; -1.321003033588740e-02   +6.190686516774741e-02   +5.930085847846420e-02   -4.274442879782375e-03   +2.001172959325606e-01   -1.895064361197891e-01   -4.566735537609232e-01   -4.818456821812100e-02   -1.922849348771185e-01   -3.267247609418105e-01   +7.856152026003098e-02   +2.172427451775636e-01];
L2E_L3E_iAMPA_netcon = [+9.833982123070444e-02   +1.449501367300238e-01   +1.755708852981014e-02   -3.849716143804989e-01   -5.532072157506406e-02   +3.333010488453063e-01   +3.971373370331029e-01   -1.154226998530447e-01; +1.800214942011932e-01   -1.209112129245124e-01   -1.772857322519314e-01   -1.658195197538970e-01   +2.665155704796146e-01   +1.625044321433111e-01   +6.908508248092526e-02   +5.908280567496557e-02; -1.509790594682065e-01   +2.004439768290027e-01   +2.548544214002166e-01   +7.778558107863404e-02   -5.716026594924480e-02   -2.446821909770629e-02   -8.207438821271699e-02   -1.502732474711436e-01; +3.366575421319028e-01   -4.094347476683957e-02   +1.106915614787461e-01   +2.314886729063559e-01   -2.238616240212977e-01   -1.284449707292619e-01   +3.657515663756765e-01   +3.076533598940256e-01; +1.499690063478697e-01   +9.765116336630560e-02   -2.436118020486946e-01   +1.667792757064552e-01   +3.656182740267513e-01   +2.144240871949359e-01   -9.441116311192321e-02   -1.071942398380342e-01; -1.406692331451236e-01   +1.993189085387245e-01   -1.250387906299270e-02   -1.614336256431692e-01   -1.047671413015968e-02   -1.878601822382190e-01   +2.271827159691360e-01   -3.453489285098763e-01; +4.807640145144627e-01   +3.008938988801101e-02   -1.713398498194487e-01   +2.315657430221299e-01   -1.341826689996078e-01   +3.000194094443603e-03   -2.255733777891297e-01   +3.281894278277768e-02; +2.042576757483065e-01   +2.182316594787453e-01   -1.464627035765422e-01   +3.240103684110390e-02   -2.407051605200678e-02   -3.953226266877900e-01   -1.230383899849383e-02   -1.599554913057986e-01; -6.350099581769214e-02   -3.024405600585234e-01   +1.544270492724747e-01   +2.397516961959986e-01   -1.159131349371902e-01   +1.074078148079978e-01   +4.549151716834721e-02   +1.767127267675923e-01; -6.314633417809178e-02   +6.521095060267848e-02   +2.180784641878604e-01   -2.500873838907891e-02   -1.143409620157467e-01   +9.674918975113633e-02   +2.355825424575647e-01   +1.858283887128347e-01; -2.827564696429070e-02   -3.687189638505751e-01   -3.556298074914786e-01   -8.861377492423050e-03   -1.346589040207239e-01   +1.120673614113514e-01   +2.824946599214035e-01   +2.568289851869642e-01; +8.696088497569955e-02   -1.329507387104264e-01   -1.029198388573696e-01   -1.004747804496648e-01   -2.446253831276116e-02   -2.570127297616905e-01   -3.971727828537385e-01   -3.079134135552296e-01];
L2I_L3I_iGABA_netcon = [-1.203110003325128e-01   -6.830003799815740e-02   -3.796576669255562e-02   -1.900530119056905e-01   +3.311480108485808e-01   -2.678507564667375e-01   -6.713450753407167e-02   -1.716805061676002e-01; -2.487084456180997e-01   +1.927394331408391e-01   -3.510146678085427e-01   +2.270152579354227e-01   -1.401927987289229e-01   +2.681160936460044e-01   -3.615839395005849e-01   -1.899588805577103e-01; +3.789862337140182e-01   +3.907802030508764e-01   -2.645307701488996e-02   +8.585332605825241e-02   +3.386751475839049e-01   +3.004996941717825e-03   -2.660603365122710e-01   -5.250514412329829e-02; -2.619482103488704e-02   -2.308660603164664e-01   -1.059972727579674e-01   +1.871927335505363e-01   -3.275974453959731e-01   -1.540617886351457e-01   +4.139367477055250e-01   -1.439596814392386e-01; -6.195077709883080e-02   +2.494349106716643e-01   +2.749263279965337e-01   +2.150123573058799e-01   +1.711507327009018e-01   +9.907564243277001e-02   +3.495267940385330e-01   -1.982325056833349e-01; -1.149283653421386e-02   -8.719873024534947e-02   -2.812578138064303e-01   +1.933540450023486e-01   -4.309636216968079e-01   -1.291421877240277e-01   +2.936436230518278e-01   -7.481492865457423e-02; +1.332480326489244e-01   +1.276784723824276e-01   -3.666609656339601e-02   +5.690319359203837e-02   +4.663065870972777e-02   +1.308416689328669e-01   +2.936799439686951e-01   +1.529017454218693e-02; +1.506975586149060e-01   -4.006563094982709e-01   +1.948570597666884e-01   -7.363207701158814e-02   +5.113890414904707e-02   +5.157005331826120e-02   +4.375775188389278e-01   +9.678605422278458e-02; -1.416352717633222e-01   -6.701972741424389e-02   +3.155147827159661e-01   -6.911284200021628e-02   -1.160179660391539e-01   +2.395223015077497e-01   -1.290399196550135e-01   -2.841996041552551e-01; +2.485919440263351e-01   +1.534163239911213e-01   -1.576168320122251e-01   -2.276335364055337e-01   +3.838051183235399e-01   +1.219381209069496e-01   +5.273308135471769e-02   -1.001152647336329e-01; +7.970084668352859e-02   +6.734901849361732e-02   -2.104168116788183e-01   +1.049088534343014e-01   -4.599504062594554e-01   -2.192800751149525e-01   -1.195360966711966e-01   +1.051071910566763e-01; +1.357268903563345e-01   +5.535151589263036e-02   +1.193002921625060e-01   -1.978830453489577e-01   -1.957090692401806e-01   -5.765609411108221e-02   +3.455712432859682e-01   +2.249939982255070e-02];
L3I_L3E_iAMPA_netcon = [+8.488685847237126e-02   -2.056721379570910e-01   +2.666853045940915e-01   +2.698378819471397e-01   +1.732298949055357e-01   -1.752555308971141e-01   -3.999839012359340e-01   +6.804173166965549e-02   -2.223791910343120e-01   -9.254892694420166e-02   +4.289315882065184e-02   -7.795341905623182e-02; -9.064856866937251e-02   -1.566544224609736e-01   -2.453654578468237e-01   -5.568263030089659e-02   +8.229792465544612e-02   -6.357377004735271e-02   -1.011363320347817e-01   -1.846830237197072e-02   +1.820801457394763e-02   +1.783383935421184e-01   -8.123261354944523e-02   -1.255916286606002e-01; -2.590209543550478e-01   +4.664940551707091e-01   +1.727921130048136e-01   -1.713253072357807e-01   -2.848248449664548e-01   -1.520807722541084e-02   +2.097325278164094e-01   -4.651305258812453e-02   -1.613552988914033e-01   -4.625845319355303e-02   -3.486357901151431e-01   -2.699915853298240e-01; -2.862169718512254e-01   +3.967441802089403e-01   +1.250070722106334e-01   +1.824226957240856e-01   -2.421257231966535e-01   -1.759492492146262e-01   +3.731900685959066e-02   -2.607013590254272e-01   +1.708703276057438e-01   -7.342867437470238e-02   -3.348922145461353e-01   -3.504787438084528e-01; -1.187880709769033e-01   +1.006028686064946e-01   -3.516194146705796e-01   +5.290126327228791e-01   +2.749199432468891e-01   -6.335455138220869e-02   +3.559575228818433e-01   +9.379718651315538e-02   +3.199648300670816e-01   -1.833366669143683e-01   -8.336496130825208e-02   +1.354040724948550e-01; -1.457068612077566e-01   +2.525819439656309e-01   +1.469713242924882e-01   +3.771572895254706e-01   -1.593880660483730e-01   -2.000730932299030e-01   +3.260518515591341e-01   +1.206250312927029e-01   -1.353120455464344e-01   -1.374176754333563e-01   +1.820263615739783e-01   +1.694556639095787e-02; -1.697767797315048e-01   +2.736700726493195e-02   +3.155192856349427e-01   +7.010027316628115e-02   +2.144447332022958e-01   -2.264041566444866e-01   -2.685560515821542e-01   -3.775650442321588e-01   -2.082232776117842e-01   +3.801586874547246e-01   -1.224355712180703e-01   -3.787360239042771e-01; +1.463893951816199e-01   +3.153432345755058e-02   -3.043972155182266e-01   -1.437125775228458e-01   -1.731300673860071e-01   +2.059323830261125e-01   +2.716558478677429e-01   -8.114738735471450e-02   +2.212534418284044e-02   -3.288336636240940e-03   -8.389179591354647e-02   +1.427749306283192e-02; +1.379151211887037e-01   -2.139354686910820e-01   +2.934889597540186e-01   -1.123874600581396e-01   -3.033690307798406e-01   +2.435241564731300e-01   +2.458180534153896e-01   -2.370715470285072e-01   -2.073963533061622e-01   -3.823907721253192e-01   +7.236397154712640e-02   -2.108682332729117e-01; +1.045223739137371e-01   +2.020101964766779e-01   +1.292862440692382e-01   -1.640476049674392e-01   -2.859308357777485e-01   -1.003077830219213e-01   -2.857165683371491e-01   +5.124555134331521e-02   +2.221014269251405e-02   -1.705726342439364e-01   -2.282757304146593e-01   -1.390854470510880e-02; -3.241097370694226e-02   -2.784232624343184e-01   -2.712769704734126e-01   -2.839337920231151e-01   +1.076329553714563e-01   +1.054640885125222e-01   +9.689707903795394e-02   +1.205441207283254e-01   +5.228456921881659e-02   -2.312757868905389e-01   -2.935713260345813e-01   +7.973283496442940e-03; +4.153939854695655e-02   -3.373758553076737e-01   -2.247360668326418e-01   +3.913578154617173e-02   +7.553302527973674e-02   -1.276564257412451e-01   +1.333511242640013e-01   +1.076781521697974e-01   -1.343777101891541e-01   +2.132993439603406e-01   +1.413572873142506e-01   -3.380471730962596e-01];
L3E_L3I_iGABA_netcon = [-3.146791490136787e-01   -4.065708624413200e-01   +2.132054635425802e-01   -1.238379360269369e-01   -3.895452167253556e-02   +1.346160178916844e-01   +1.321554067255701e-01   -1.762129019977833e-01   +8.291399697636001e-02   +1.899878454913015e-01   +3.442163225887207e-01   -1.760407010945448e-01; +2.888477782032568e-01   -2.813555830999198e-01   -6.174577165107578e-02   -2.266239657108443e-01   -5.052452016300847e-02   +1.439618804667753e-01   -2.270492322973041e-02   -5.638351236367976e-02   -6.660531398371247e-02   +3.075807018118160e-01   -1.676421097499691e-01   -1.689983356502421e-01; +2.500007999876704e-01   +2.300922346838168e-01   -1.694321232254701e-01   +1.132119095593799e-01   +1.803506282788575e-02   +2.370642275525302e-01   +7.546341174922422e-04   +2.795140556823702e-01   -1.334837403776015e-01   -2.465618285762532e-01   -6.968858989328237e-02   -1.656255643324279e-01; -4.520136518843119e-02   -4.886398840689004e-01   +1.891268065592770e-01   -1.303853455950778e-02   -3.632810577556354e-01   -9.041381208621500e-02   -1.286707550085123e-01   +2.233223411641241e-01   -2.016500680807271e-01   -3.070685451277363e-02   +2.461586522264875e-01   +2.885327802916354e-01; -6.521219739957529e-02   +2.918487338314986e-01   +2.391175978418872e-01   +9.350795247859775e-02   +4.238451294207665e-02   +1.941209686775817e-01   +4.075553150773269e-01   -8.589223387938824e-02   -9.395379875779405e-02   -2.557056818585336e-01   -4.367354230260288e-01   -8.691829075845707e-02; +2.965310782103562e-01   -3.845982055716077e-02   +7.283548527230579e-02   +1.229981406242779e-01   -5.363771990099828e-02   -3.961251534763979e-02   +9.915683895485031e-02   -1.260713385295697e-01   +2.361555681401145e-01   -1.770027216361261e-01   +2.483860442978867e-01   +5.442831234142809e-02; -3.192636791276636e-01   +1.736775445759861e-01   +1.444458552844826e-01   -2.328389254428888e-02   +1.194444159205523e-01   -9.061397541075897e-02   +1.687320294796365e-02   +2.754566868603895e-01   +3.390907748003570e-01   +1.252383536073248e-01   +4.457139355853734e-03   -2.084859321829225e-01; -1.422578389702163e-01   +1.533869792075747e-01   -2.853403598231491e-01   -2.137835833372437e-01   +8.216990958366810e-04   -9.148488354360740e-02   +2.624063156718560e-01   -1.788863834668349e-01   +9.949461724085534e-03   -8.352056942944044e-02   -8.167977788179018e-02   +9.751755154320474e-02; -1.899153081894257e-01   -3.065606751371488e-01   +2.055453704238629e-01   -1.901855384408572e-01   -8.051222032342374e-02   -1.104487484449586e-03   -5.756319511780886e-02   +3.761780328769037e-01   +3.281127820036251e-01   -1.125885065160382e-01   +4.954814297715605e-02   +2.099229378734427e-01; +3.140527212708527e-02   -3.868244316874902e-01   -9.414860151296564e-02   -3.926276890403010e-01   +2.348322340693356e-01   -1.843262648979914e-01   +5.332108544493505e-02   -6.073894389576263e-02   +1.712245037200833e-01   +1.319626715546903e-01   -2.743384180828592e-01   +9.384739487541827e-02; +1.024380429687826e-01   -3.362124056287699e-01   +1.123591519103690e-01   -2.995119370976014e-02   -3.705694505771023e-02   +2.048183806516566e-01   +1.885107124015275e-01   +9.270019818415470e-02   +9.658035323792236e-02   -1.836904843365973e-01   -3.444491332003792e-01   +1.280922329052662e-02; +1.048904466533354e-01   -3.262810861044461e-01   +1.928234097127691e-01   +5.092357492954616e-02   +9.025013945422589e-02   +3.063537962894325e-01   -1.625226226909959e-01   +8.216787283262021e-02   +3.334973513811140e-01   -1.190850552721254e-01   -1.747356531021859e-01   -2.148541759332948e-01];
L2E_Input1_iAMPA_netcon = [-2.225051320918467e-01   -2.079075919459550e-03   +1.117867064596671e-01   +6.167734361846754e-02   +1.115007744619506e-02   -1.638702243393753e-01   -1.821776036350198e-01   -2.001285098486530e-01];
L2I_Input2_iAMPA_netcon = [-1.490633658076934e-01   -1.177729111941006e-01   +1.088289808988939e-01   -3.435364815201857e-01   -9.871610705055991e-02   -2.056062940638103e-01   -1.190194662703840e-01   -5.660819266790229e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
